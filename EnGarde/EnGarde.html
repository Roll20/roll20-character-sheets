<div class="sheet-centerIt sheet-topheader">En Garde!</div>
<div class="sheet-wrapper1 ">
    <div class="sheet-name sheet-borderTop sheet-borderLeft sheet-borderRight">
        <div data-i18n="character">Character:</div>  
        <div><input type="text" class="sheet-text_input" name="attr_character_name"></div>    
    </div>
</div>
<div class="sheet-block1 sheet-borderRight">
    <div class="sheet-borderBot">
        <div>
            <h1 data-i18n="STR">STR</h1>
            <div class="sheet-smallHeader" data-i18n="STR-prompt">(Initially 3-18)</div> 
        </div>
    </div>
    <div class="sheet-borderRight sheet-borderBot"><input type="text" class="sheet-text_input sheet-abilities" name="attr_STR" value="0"></div>     
    <div   class="sheet-birth">
        <h1 data-i18n="Birth">Birth</h1>
        <span>
            <textarea name="attr_birth"></textarea> 
        </span>
    </div>
    <div  class="sheet-borderBot">
        <div>
            <h1  data-i18n="CON">CON</h1>
            <div class="sheet-smallHeader" data-i18n="CON-prompt">(3-18)</div>         
        </div>
    </div>
    <div class="sheet-borderBot sheet-borderRight"><input type="text" class="sheet-text_input sheet-abilities" name="attr_CON" value="0"></div>
       
    <div class="sheet-borderBot">
        <div>
            <h1  data-i18n="END">END</h1>
            <div class="sheet-smallHeader" data-i18n="END-prompt">(Max: STRxCON)</div>        
        </div>
    </div>
    <div class="sheet-borderBot sheet-borderRight"><input type="text" class="sheet-text_input sheet-abilities" readonly=readonly name="attr_END" value="0"></div>       
    <div>
        <div class="sheet-EndMAGrid">
            <div class="sheet-borderRight">
                <div class="sheet-EndCurrentGrid">
                    <div>
                        <div><h1  data-i18n="END">END</h1></div>
                        <div class="sheet-smallHeader" data-i18n="current"> </div>                        
                    </div>
                    <div>
                        <textarea  name="attr_end_current"></textarea>
                    </div>
                </div>
            </div>
            <div>
                <div class="sheet-MAGrid">
                    <div>
                        <div><h1 data-i18n="MA">MA</h1></div>
                        <div class="sheet-smallHeader" data-i18n="MA-prompt">Initially 1-6</div>                      
                    </div>
                    <div>
                        <textarea  class="sheet-abilities" name="attr_MA"></textarea>
                    </div>                    
                </div>
            </div>            
        </div>
    </div>
    
    <div  class="sheet-borderBot">
        <div>
            <h1  data-i18n="EXP">EXP</h1>
            <div class="sheet-smallHeader" data-i18n="EXP-prompt">(Base: 3-18)</div> 
        </div>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
         <input type="text" class="sheet-text_input sheet-abilities" name="attr_EXP" value="0">            
    </div>       
    <div class="sheet-practiseGrid">
           <div class="sheet-borderRight sheet-borderBot sheet-practiseGridRow"> 
                <div>
                    <span class="sheet-practiseHeader" data-i18n="Dagger">Dagger</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_dagger_exp" value="0">
                    </span>
                </div>
                
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_dagger" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_dagger_max" value="4"></div>
                </div>
           </div>
           <div class="sheet-borderRight sheet-borderBot sheet-practiseGridRow">
                <div>    
                    <span class="sheet-practiseHeader" data-i18n="Foil">Foil</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_foil_exp" value="0">
                    </span>                    
                </div>
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_foil" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_foil_max" value="4"></div>
                </div>           
           </div>
           <div class="sheet-borderRight sheet-borderBot sheet-practiseGridRow">
                <div>
                    <span class="sheet-practiseHeader" data-i18n="Rapier">Rapier</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_rapier_exp" value="0">
                    </span>                    
                </div>
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_rapier" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_rapier_max" value="4"></div>
                </div>            
           </div>
           <div class="sheet-borderRight sheet-borderBot sheet-practiseGridRow">
                <div>    
                    <span class="sheet-practiseHeader" data-i18n="Sabre">Sabre</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_sabre_exp" value="0">
                    </span>                      
                </div>
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_sabre" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_sabre_max" value="4"></div>
                </div>               
           </div> 
           <div class="sheet-borderRight sheet-borderBot sheet-practiseGridRow">
                <div>
                    <span class="sheet-practiseHeader" data-i18n="Cutlass">Cutlass</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_cutlass_exp" value="0">
                    </span>                      
                </div>
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_cutlass" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_cutlass_max" value="4"></div>
                </div>  
           </div>
           <div class="sheet-borderBot sheet-practiseGridRow">
                <div>
                    <span class="sheet-practiseHeader" data-i18n="2-Hand">2-Hand</span>
                    <span class="sheet-weapon-exp">
                        <input type="text" class="sheet-text_input sheet-practiseVal" name="attr_2hand_exp" value="0">
                    </span>                      
                </div>
                <div class="sheet-pVGrid">
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_2-Hand" value="0"></div>
                    <div>/</div>
                    <div><input type="text" class="sheet-text_input sheet-practiseVal" name="attr_practise_2-Hand_max" value="4"></div>
                </div>           
           </div>               
    </div>    
</div>
<hr>
<div class="sheet-block2-wrapper">
        <div class="sheet-SLGrid">
            <div class="sheet-borderRight">
                <h1 data-i18n="SL">SL</h1>
            </div>
            <div class="sheet-borderRight">
                <span class="sheet-SL_value" >
                    <textarea type="text" class="sheet-text_input  sheet-abilities" name="attr_SL"></textarea>
                </span>            
            </div>
            <div class="sheet-borderRight">
                <span class="sheet-SLHeader" data-i18n="Funds"></span>
                <span class="sheet-funds" >
                    <textarea type="text" class="sheet-text_input" name="attr_funds"></textarea>
                </span>
            </div>
            <div class="sheet-borderRight">
                <span  class="sheet-SLHeader"  data-i18n="Allowance"></span>
                <span class="sheet-allowance" >
                    <textarea type="text" class="sheet-text_input" name="attr_allowance"></textarea>
                </span>                
            </div>
            <div class="sheet-borderRight">
                <span class="sheet-SLHeader"  data-i18n="Horses"></span>
                <span class="sheet-horses" >
                    <textarea type="text" class="sheet-text_input" name="attr_horses"></textarea>
                </span>                                
            </div>
            <div class="sheet-borderRight">
                <span class="sheet-SLHeader"  data-i18n="Date"></span>
                <span class="sheet-date">
                    <textarea type="text" class="sheet-text_input" name="attr_date"></textarea>
                </span>                  
            </div>            
        </div>
</div>
<div class="sheet-monthlyVariables">
    <div class="sheet-borderBot sheet-borderRight">&nbsp;</div>
    <div class="sheet-borderBot sheet-borderRight"><span class="sheet-monthlyVariablesHeader" data-i18n="Income">Income</span></div> 
    <div class="sheet-borderBot sheet-borderRight"><span class="sheet-monthlyVariablesHeader" data-i18n="Spending">Spending</span></div> 
    <div class="sheet-borderBot"><span class="sheet-monthlyVariablesHeader" data-i18n="SPs">SPs</span></div> 

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
    <span data-i18n="allowance-support">Allowance, Support costs: 2 x SL (or 3 x SL for 1 SP) plus horses (3 per horse + 2)</span>
    <span> <input type="text" class="sheet-text_input" name="attr_monthly_allowance_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_allowance_support_income" value="0">
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_allowance_support_spending" value="0">
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_allowance_support_sps" value="0">
    </div> 


    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
    <span data-i18n="title">Title</span>
    <span> <input type="text" class="sheet-text_input" name="attr_title_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_title_income" value="0">
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <div class="sheet-filler"></div>
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_title_sps" value="0">
    </div> 


    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
    <span data-i18n="club-membership">Club membership</span>
    <span> <input type="text" class="sheet-text_input" name="attr_club_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <div class="sheet-filler"></div>
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_club_spending" value="0">    
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_club_sps" value="0">
    </div> 

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
    <span data-i18n="regiment-rank">Regiment and/or Rank</span>
    <span> <input type="text" class="sheet-text_input" name="attr_regiment_rank_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_regiment_rank_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <div class="sheet-filler"></div>    
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_regiment_rank_sps" value="0">
    </div>
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="mistress-details">Mistress (Name, SL & attributes)</span>
        <span> <input type="text" class="sheet-text_input" name="attr_mistress_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_mistress_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_mistress_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_mistress_sps" value="0">
    </div>
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="Appointment">Appointment</span>
        <span> <input type="text" class="sheet-text_input" name="attr_appointment_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_appointment_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
           <div class="sheet-filler"></div>    
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_appointment_sps" value="0">
    </div>
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span class="sheet-borderRight sheet-dispatchesLabel" data-i18n="mentions">Mentions in Despatches </span>
        <span class="sheet-mentionsSpan"> 
            <div class="sheet-mentionsGrid">
                <div  class="sheet-borderRight" data-i18n="mentions-current">Current (1-6 SPs ea.)</div>
                <div class="sheet-borderRight"><input type="text" class="sheet-text_input" name="attr_mentions_current" value=""></div>
                <div class="sheet-borderRight sheet-oldMentionsLabel" >
                    <span data-i18n="mentions-old">Old (1 SP ea.)</span>
                </div>
                <div class="sheet-borderRight"><input type="text" class="sheet-text_input" name="attr_mentions_old" value=""></div>
            </div>
        </span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
           <div class="sheet-filler"></div>    
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
           <div class="sheet-filler"></div>    
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_mentions_sps" value="0">
    </div>
</div>    
<div class="sheet-monthlyVariables">
    <div class="sheet-borderBot sheet-borderRight"><button name="act_reset" type="action" class="sheet-text_roll">RESET</button></div>
    <div class="sheet-borderBot sheet-borderRight"><span class="sheet-monthlyVariablesHeader" data-i18n="Income">Income</span></div> 
    <div class="sheet-borderBot sheet-borderRight"><span class="sheet-monthlyVariablesHeader" data-i18n="Spending">Spending</span></div> 
    <div class="sheet-borderBot"><span class="sheet-monthlyVariablesHeader" data-i18n="SPs">SPs</span></div>     
    
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="week1">Week 1</span>
        <span> <input type="text" class="sheet-text_input" name="attr_week1_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week1_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week1_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week1_sps" value="0">
    </div>  

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="week2">Week 2</span>
        <span> <input type="text" class="sheet-text_input" name="attr_week2_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week2_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week2_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week2_sps" value="0">
    </div>  

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="week3">Week 3</span>
        <span> <input type="text" class="sheet-text_input" name="attr_week3_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week3_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week3_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week3_sps" value="0">
    </div>  

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="week4">Week 4</span>
        <span> <input type="text" class="sheet-text_input" name="attr_week4_desc" value=""></span>
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week4_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week4_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_week4_sps" value="0">
    </div> 
    
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="monthly-values">Monthly Values</span>        
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_monthly_sps" value="0">
    </div> 

    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="total">Total</span>        
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_final_income" value="0"> 
    </div> 
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_final_spending" value="0"> 
    </div> 
    <div class="sheet-borderBot">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_final_sps" value="0">
    </div>  
    
    
</div> 
<div class="sheet-fundAdjust">
    <div class="sheet-borderBot sheet-borderRight sheet-monthlyVariablesDesc">
        <span data-i18n="funds-adjust">Funds Adjustment</span>        
    </div>
    <div class="sheet-borderBot sheet-borderRight">
        <input type="text" class="sheet-text_input sheet-monthlyVariableVals" name="attr_funds_adjustment" value="0"> 
    </div> 
</div>
<hr>   
<div>
    <div class="sheet-diceWrapper">
        <span><button type="roll" class="sheet-text_roll" name="roll_1d6" value="&{template:default} {{1D6=[[1d6+?{Modifier|0}]]}}"><img src="https://raw.githubusercontent.com/Lockbox313/imagedump/master//EnGarde/d6-2.png"></button></span>           
        <span><button type="roll" class="sheet-text_roll" "sheet-text_roll"  name="roll_1d6" value="&{template:default}  {{2D6=[[2d6+?{Modifier|0}]]}}"><img src="https://raw.githubusercontent.com/Lockbox313/imagedump/master//EnGarde/2d6-2.png"></button></span>
    </div>
<div> 



<script type="text/worker">

    on("clicked:reset", function() {
      // write your sheetworker to do things here
      setAttrs({week1_income:0,week2_income:0,week3_income:0,week4_income:0,week1_spending:0,week2_spending:0,week3_spending:0,week4_spending:0,week1_sps:0,week2_sps:0,week3_sps:0,week4_sps:0});
    });


    on("change:str change:con", function(event) {			
        console.log(`change con or str  ${JSON.stringify(event)}`);
        getAttrs(["str","con"], function(values) {
            console.log(`change budo values ${JSON.stringify(values)}`);
            let tot  = parseInt(values.str)*parseInt(values.con);
            setAttrs({end:tot});
        });    
	}); 
    
	const income_listeners = ["monthly_allowance_support_income","title_income","regiment_rank_income","mistress_income","appointment_income"];
	income_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["monthly_allowance_support_income","title_income","regiment_rank_income","mistress_income","appointment_income"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({monthly_income:sum});
			});
			
		});
	});
    
    
    const weekly_income_listeners = ["week1_income","week2_income","week3_income","week4_income","monthly_income"];
	weekly_income_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["week1_income","week2_income","week3_income","week4_income","monthly_income"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({final_income:sum});
			});
			
		});
	});
    
    
	const spending_listeners = ["monthly_allowance_support_spending","club_spending","mistress_spending"];
	spending_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["monthly_allowance_support_spending","club_spending","mistress_spending"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({monthly_spending:sum});
			});
			
		});
	});  


    const weekly_spending_listeners = ["week1_spending","week2_spending","week3_spending","week4_spending","monthly_spending"];
	weekly_spending_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["week1_spending","week2_spending","week3_spending","week4_spending","monthly_spending"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({final_spending:sum});
			});
			
		});
	});



	const sp_listeners = ["monthly_allowance_support_sps","title_sps","club_sps","regiment_rank_sps","regiment_rank_sps","mistress_sps","appointment_sps","mentions_sps"];
	sp_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["monthly_allowance_support_sps","title_sps","club_sps","regiment_rank_sps","regiment_rank_sps","mistress_sps","appointment_sps","mentions_sps"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({monthly_sps:sum});
			});
			
		});
	});    
    
    
    const weekly_sp_listeners = ["week1_sps","week2_sps","week3_sps","week4_sps","monthly_sps"];
	weekly_sp_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["week1_sps","week2_sps","week3_sps","week4_sps","monthly_sps"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = 0;
              for( var el in values ) {
                if( values.hasOwnProperty( el ) ) {
                  sum += parseInt(values[el]);
                }
              }   
              console.log("sum:"+sum)  ;
			  setAttrs({final_sps:sum});
			});
			
		});
	});    
			
            
    const funds_adjustment_listeners = ["final_income","final_spending"];
	funds_adjustment_listeners.forEach(attribute => {
		on(`change:${attribute}`, function(event) {
			console.log(`income listener event ${JSON.stringify(event)}`);
			getAttrs(["final_income","final_spending"], function(values) {
			   console.log(`values ${JSON.stringify(values)}`);

              var sum = parseInt(values.final_income) - parseInt(values.final_spending);
              

              console.log("sum:"+sum)  ;
              
              if (sum > 0){
                sum= "+"+sum;
              } else {
                sum = ""+sum;
              }
              
			  setAttrs({funds_adjustment:sum});
			});
			
		});
	});             
		
</script>

   
    
