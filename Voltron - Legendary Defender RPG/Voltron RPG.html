<div id="Voltron" class="compendium-drop-target">
	<div class="drop-zone">
		<span>Dragging From Compendium</span>
	</div>
	<div class="left-margin">
		<img src="https://flowpedia.info/img/voltron/left-gradient-sm.png">
	</div>
	<input type="hidden" name="attr_settings" value="1">
	<input type="hidden" name="attr_sheet_type" value="pc">
	<div class="content-body">
		<!-- /********** Header **********/ -->
		<div class="header">
			<img style="height: 100px; margin: auto; position: relative; left: -20px;" src="https://flowpedia.info/img/voltron/Voltron-LD-logo.png">
			<div class="name-block">
				<input class="name" type="text" name="attr_character_name" placeholder="Character Name" title="@{character_name}">
			</div>
			<img style="height: 30px; margin: auto;" src="https://flowpedia.info/img/voltron/DiceCore-logo.png">
		</div>
		<div class="header">
			<div class="settings-button">
				<input type="checkbox" checked="checked" name="attr_settings" value="1">
				<span class="settings-widget">y</span>
			</div>
			<div class="settings sheet-type">
				<select name="attr_sheet_type">
					<option value="pc">PC</option>
					<option value="npc">NPC</option>
				</select>
			</div>
		</div>

		<!-- /********** Attributes **********/ -->
		<div class="char-attributes">
			<div class="contents">
				<div class="left-column">
					<div class="init-box-outline">
						<div class="init-box">
							<div class="init-text-box">
								<div></div>
								<div class="init-text">
									<button class="initiative" name="act_initiative" type="action" value=''><span>Initiative</span></button>
								</div>
								<div>
								</div>
							</div>
							<div class="init-box-col">
								<div class="init-header">
									Agility
								</div>
								<input type="hidden" name="attr_agility_wound" value="0">
								<input type="hidden" name="attr_agility" value="">
								<div class="attr-dice-box">
									<div class="attribute-downgrade"></div>
									<div class="attribute-dice rolltype-initiative d4"></div>
									<div class="attribute-dice rolltype-initiative d6"></div>
									<div class="attribute-dice rolltype-initiative d8"></div>
									<div class="attribute-dice rolltype-initiative d10"></div>
									<div class="attribute-dice rolltype-initiative d12"></div>
								</div>
								<div class="init-wound">
									<input type="checkbox" name="attr_agility_wound" value="1">
									<span>Wound</span>
								</div>
							</div>
							<div class="init-box-col">
								<div class="init-header">
									Intellect
								</div>
								<input type="hidden" name="attr_intellect_wound" value="0">
								<input type="hidden" name="attr_intellect" value="">
								<div class="attr-dice-box">
									<div class="attribute-downgrade"></div>
									<div class="attribute-dice rolltype-initiative d4"></div>
									<div class="attribute-dice rolltype-initiative d6"></div>
									<div class="attribute-dice rolltype-initiative d8"></div>
									<div class="attribute-dice rolltype-initiative d10"></div>
									<div class="attribute-dice rolltype-initiative d12"></div>
								</div>
								<div class="init-wound">
									<input type="checkbox" name="attr_intellect_wound" value="1">
									<span>Wound</span>
								</div>
							</div>
							<div class="init-box-col">
								<div class="init-header">
									Channelling
								</div>
								<input type="hidden" name="attr_channelling_wound" value="0">
								<input type="hidden" name="attr_channelling" value="">
								<div class="attr-dice-box">
									<div class="attribute-downgrade"></div>
									<div class="attribute-dice rolltype-initiative d4"></div>
									<div class="attribute-dice rolltype-initiative d6"></div>
									<div class="attribute-dice rolltype-initiative d8"></div>
									<div class="attribute-dice rolltype-initiative d10"></div>
									<div class="attribute-dice rolltype-initiative d12"></div>
								</div>
								<div class="init-wound">
									<input type="checkbox" name="attr_channelling_wound" value="1">
									<span>Wound</span>
								</div>
							</div>
						</div>
					</div>

					<div class="init-box-resolve">
						<div class="init-header">Resolve</div>
						<div class="circle-box"><input type="checkbox" name="attr_resolve_1" value="1"><span class="resolve-circle"></span></div>
						<div class="circle-box"><input type="checkbox" name="attr_resolve_2" value="1"><span class="resolve-circle"></span></div>
						<div class="circle-box"><input type="checkbox" name="attr_resolve_3" value="1"><span class="resolve-circle"></span></div>
						<div class="circle-box"><input type="checkbox" name="attr_resolve_4" value="1"><span class="resolve-circle"></span></div>
						<div class="circle-box"><input type="checkbox" name="attr_resolve_5" value="1"><span class="resolve-circle"></span></div>
					</div>

					<div class="init-box-plot-and-speed">
						<div class="init-box-plot-outline">
							<div class="init-box-plot">
								<div class="init-header">Plot Points<span>(Max 6)</span></div>
								<div class="plot-points"><input type="number" name="attr_plot_points" min="0" max="6" value="0"></div>
							</div>
						</div>
						<div class="init-box-speed-outline">
							<div class="init-box-speed">
								<div class="init-header">Run / Sprint</div>
								<div class="speed"><input type="number" name="attr_run" min="0" value="18"><span> meters /</span></div>
								<div class="speed"><input type="number" name="attr_sprint" min="0" value="36"><span> meters</span></div>
							</div>
						</div>
					</div>

				</div>

				<div class="attr-box-outline">
					<div class="attr-box">
						<div class="attr-box-col">
							<input type="hidden" name="attr_vitality_wound" value="0">
							<input type="hidden" name="attr_vitality" value="">
							<div class="init-header">
								Vitality
							</div>
							<div class="values attr-dice-box">
								<div class="attribute-downgrade"></div>
								<div class="attribute-dice rolltype-attribute rollname-Vitality d4"></div>
								<div class="attribute-dice rolltype-attribute rollname-Vitality d6"></div>
								<div class="attribute-dice rolltype-attribute rollname-Vitality d8"></div>
								<div class="attribute-dice rolltype-attribute rollname-Vitality d10"></div>
								<div class="attribute-dice rolltype-attribute rollname-Vitality d12"></div>
							</div>
							<div class="settings selector">
								<select class="die-select" name="attr_vitality">
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="init-wound">
								<input type="checkbox" name="attr_vitality_wound" value="1">
								<span>Wound</span>
							</div>
						</div>
					</div>
				</div>

				<div class="attr-box-outline">
					<div class="attr-box">
						<div class="attr-box-col">
							<input type="hidden" name="attr_agility_wound" value="0">
							<input type="hidden" name="attr_agility" value="">
							<div class="init-header">
								Agility
							</div>
							<div class="values attr-dice-box">
								<div class="attribute-downgrade"></div>
								<div class="attribute-dice rolltype-attribute rollname-Agility d4"></div>
								<div class="attribute-dice rolltype-attribute rollname-Agility d6"></div>
								<div class="attribute-dice rolltype-attribute rollname-Agility d8"></div>
								<div class="attribute-dice rolltype-attribute rollname-Agility d10"></div>
								<div class="attribute-dice rolltype-attribute rollname-Agility d12"></div>
							</div>
							<div class="settings selector">
								<select class="die-select" name="attr_agility">
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="init-wound">
								<input type="checkbox" name="attr_agility_wound" value="1">
								<span>Wound</span>
							</div>
						</div>
					</div>
				</div>

				<div class="attr-box-outline">
					<div class="attr-box">
						<div class="attr-box-col">
							<input type="hidden" name="attr_resolve_wound" value="0">
							<input type="hidden" name="attr_resolve" value="">
							<div class="init-header">
								Resolve
							</div>
							<div class="values attr-dice-box">
								<div class="attribute-downgrade"></div>
								<div class="attribute-dice rolltype-attribute rollname-Resolve d4"></div>
								<div class="attribute-dice rolltype-attribute rollname-Resolve d6"></div>
								<div class="attribute-dice rolltype-attribute rollname-Resolve d8"></div>
								<div class="attribute-dice rolltype-attribute rollname-Resolve d10"></div>
								<div class="attribute-dice rolltype-attribute rollname-Resolve d12"></div>
							</div>
							<div class="settings selector">
								<select class="die-select" name="attr_resolve">
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="init-wound">
								<input type="checkbox" name="attr_resolve_wound" value="1">
								<span>Wound</span>
							</div>
						</div>
					</div>
				</div>

				<div class="attr-box-outline">
					<div class="attr-box">
						<div class="attr-box-col">
							<input type="hidden" name="attr_intellect_wound" value="0">
							<input type="hidden" name="attr_intellect" value="">
							<div class="init-header">
								Intellect
							</div>
							<div class="values attr-dice-box">
								<div class="attribute-downgrade"></div>
								<div class="attribute-dice rolltype-attribute rollname-Intellect d4"></div>
								<div class="attribute-dice rolltype-attribute rollname-Intellect d6"></div>
								<div class="attribute-dice rolltype-attribute rollname-Intellect d8"></div>
								<div class="attribute-dice rolltype-attribute rollname-Intellect d10"></div>
								<div class="attribute-dice rolltype-attribute rollname-Intellect d12"></div>
							</div>
							<div class="settings selector">
								<select class="die-select" name="attr_intellect">
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="init-wound">
								<input type="checkbox" name="attr_intellect_wound" value="1">
								<span>Wound</span>
							</div>
						</div>
					</div>
				</div>

				<div class="attr-box-outline">
					<div class="attr-box">
						<div class="attr-box-col">
							<input type="hidden" name="attr_influence_wound" value="0">
							<input type="hidden" name="attr_influence" value="">
							<div class="init-header">
								Influence
							</div>
							<div class="values attr-dice-box">
								<div class="attribute-downgrade"></div>
								<div class="attribute-dice rolltype-attribute rollname-Influence d4"></div>
								<div class="attribute-dice rolltype-attribute rollname-Influence d6"></div>
								<div class="attribute-dice rolltype-attribute rollname-Influence d8"></div>
								<div class="attribute-dice rolltype-attribute rollname-Influence d10"></div>
								<div class="attribute-dice rolltype-attribute rollname-Influence d12"></div>
							</div>
							<div class="settings selector">
								<select class="die-select" name="attr_influence">
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="init-wound">
								<input type="checkbox" name="attr_influence_wound" value="1">
								<span>Wound</span>
							</div>
						</div>
					</div>
				</div>

				<div class="channeling-box">
					<div class="attr-box-outline">
						<div class="attr-box">
							<div class="attr-box-col">
								<input type="hidden" name="attr_channelling_wound" value="0">
								<input type="hidden" name="attr_channelling" value="">
								<div class="init-header">
									Channelling
								</div>
								<div class="values attr-dice-box">
									<div class="attribute-downgrade"></div>
									<div class="attribute-dice rolltype-attribute rollname-Channelling d4"></div>
									<div class="attribute-dice rolltype-attribute rollname-Channelling d6"></div>
									<div class="attribute-dice rolltype-attribute rollname-Channelling d8"></div>
									<div class="attribute-dice rolltype-attribute rollname-Channelling d10"></div>
									<div class="attribute-dice rolltype-attribute rollname-Channelling d12"></div>
								</div>
								<div class="settings selector">
									<select class="die-select" name="attr_channelling">
										<option value="d4">d4</option>
										<option value="d6">d6</option>
										<option value="d8">d8</option>
										<option value="d10">d10</option>
										<option value="d12">d12</option>
									</select>
								</div>
								<div class="init-wound">
								<input type="checkbox" name="attr_channelling_wound" value="1">
									<span>Wound</span>
								</div>
							</div>
						</div>
					</div>

					<div class="feat-rolls">
						<div class="feat-roll-header">Feat Roll</div>
						<div class="feat-roll-bubbles">
							<div class="feat-d12 d12"></div>
							<div class="circle-box"><input type="checkbox" name="attr_feat_roll_1" value="1"><span class="feat-oval"></span></div>
							<div class="circle-box"><input type="checkbox" name="attr_feat_roll_2" value="1"><span class="feat-oval"></span></div>
							<div class="circle-box"><input type="checkbox" name="attr_feat_roll_3" value="1"><span class="feat-oval"></span></div>
							<div class="circle-box"><input type="checkbox" name="attr_feat_roll_4" value="1"><span class="feat-oval"></span></div>
						</div>
					</div>
				</div>



			</div>
		</div>

		<!-- /********** Skills **********/ -->
		<div class="skills">
			<div class="bar">
				<div class="spacer"></div>
				<div class="tab">Skills</div>
				<div class="spacer"></div>
			</div>
			<div class="header">
				<div class="no-skill">NO SKILL = <div class="d4"></div></div>
				<div class="standard-complex">
					<div></div>
					<div class="standard-feat"><div>Standard Feat = </div><div class="d8"></div><div> + Skill + Linked Attribute + Modifications(if any)</div></div>
					<div></div>
					<div class="complex-feat"><div>Complex Feat = </div><div class="d6"></div><div> + Skill + Linked Attribute + Modifications(if any)</div></div>
					<div></div>
				</div>
			</div>
			<div class="contents">
				<div class="box-outline">
					<input type="hidden" name="attr_skill_1_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_1_wound" value="0">
						<input type="hidden" name="attr_skill_1_die" value="">
						<input type="hidden" name="attr_skill_1_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_1_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_1_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_1_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_1 d4"></div>
								<div class="rolltype-skill rollname-skill_1 d6"></div>
								<div class="rolltype-skill rollname-skill_1 d8"></div>
								<div class="rolltype-skill rollname-skill_1 d10"></div>
								<div class="rolltype-skill rollname-skill_1 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_1_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_2_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_2_wound" value="0">
						<input type="hidden" name="attr_skill_2_die" value="">
						<input type="hidden" name="attr_skill_2_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_2_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_2_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_2_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_2 d4"></div>
								<div class="rolltype-skill rollname-skill_2 d6"></div>
								<div class="rolltype-skill rollname-skill_2 d8"></div>
								<div class="rolltype-skill rollname-skill_2 d10"></div>
								<div class="rolltype-skill rollname-skill_2 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_2_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_3_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_3_wound" value="0">
						<input type="hidden" name="attr_skill_3_die" value="">
						<input type="hidden" name="attr_skill_3_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_3_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_3_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_3_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_3 d4"></div>
								<div class="rolltype-skill rollname-skill_3 d6"></div>
								<div class="rolltype-skill rollname-skill_3 d8"></div>
								<div class="rolltype-skill rollname-skill_3 d10"></div>
								<div class="rolltype-skill rollname-skill_3 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_3_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_4_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_4_wound" value="0">
						<input type="hidden" name="attr_skill_4_die" value="">
						<input type="hidden" name="attr_skill_4_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_4_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_4_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_4_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_4 d4"></div>
								<div class="rolltype-skill rollname-skill_4 d6"></div>
								<div class="rolltype-skill rollname-skill_4 d8"></div>
								<div class="rolltype-skill rollname-skill_4 d10"></div>
								<div class="rolltype-skill rollname-skill_4 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_4_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_5_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_5_wound" value="0">
						<input type="hidden" name="attr_skill_5_die" value="">
						<input type="hidden" name="attr_skill_5_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_5_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_5_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_5_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_5 d4"></div>
								<div class="rolltype-skill rollname-skill_5 d6"></div>
								<div class="rolltype-skill rollname-skill_5 d8"></div>
								<div class="rolltype-skill rollname-skill_5 d10"></div>
								<div class="rolltype-skill rollname-skill_5 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_5_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_6_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_6_wound" value="0">
						<input type="hidden" name="attr_skill_6_die" value="">
						<input type="hidden" name="attr_skill_6_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_6_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_6_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_6_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_6 d4"></div>
								<div class="rolltype-skill rollname-skill_6 d6"></div>
								<div class="rolltype-skill rollname-skill_6 d8"></div>
								<div class="rolltype-skill rollname-skill_6 d10"></div>
								<div class="rolltype-skill rollname-skill_6 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_6_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_7_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_7_wound" value="0">
						<input type="hidden" name="attr_skill_7_die" value="">
						<input type="hidden" name="attr_skill_7_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_7_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_7_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_7_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_7 d4"></div>
								<div class="rolltype-skill rollname-skill_7 d6"></div>
								<div class="rolltype-skill rollname-skill_7 d8"></div>
								<div class="rolltype-skill rollname-skill_7 d10"></div>
								<div class="rolltype-skill rollname-skill_7 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_7_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_8_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_8_wound" value="0">
						<input type="hidden" name="attr_skill_8_die" value="">
						<input type="hidden" name="attr_skill_8_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_8_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_8_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_8_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_8 d4"></div>
								<div class="rolltype-skill rollname-skill_8 d6"></div>
								<div class="rolltype-skill rollname-skill_8 d8"></div>
								<div class="rolltype-skill rollname-skill_8 d10"></div>
								<div class="rolltype-skill rollname-skill_8 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_8_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-outline">
					<input type="hidden" name="attr_skill_9_name" value="">
					<div class="box">
						<input type="hidden" name="attr_skill_9_wound" value="0">
						<input type="hidden" name="attr_skill_9_die" value="">
						<input type="hidden" name="attr_skill_9_upgrade" value="0">
						<div class="settings skill">
							<select name="attr_skill_9_name">
								<option value="">Unused</option>
								<option value="Athletics">Athletics</option>
								<option value="Outdoors">Outdoors</option>
								<option value="Close Combat">Close Combat</option>
								<option value="Piloting">Piloting</option>
								<option value="Ranged Combat">Ranged Combat</option>
								<option value="Engagement">Engagement</option>
								<option value="Stealth">Stealth</option>
								<option value="Tactics">Tactics</option>
								<option value="Awareness">Awareness</option>
								<option value="Biotechnology">Biotechnology</option>
								<option value="Electronics">Electronics</option>
								<option value="Engineering">Engineering</option>
								<option value="Medicine">Medicine</option>
								<option value="Acting">Acting</option>
								<option value="Persuasion">Persuasion</option>
							</select>
							<div class="upgrade"></div>
							<div class="skill-die">
								<select class="die-select" name="attr_skill_9_die">
									<option value="">-</option>
									<option value="d4">d4</option>
									<option value="d6">d6</option>
									<option value="d8">d8</option>
									<option value="d10">d10</option>
									<option value="d12">d12</option>
								</select>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="values skill">
							<span class="values" name="attr_skill_9_name"></span>
							<div class="upgrade"></div>
							<div class="skill-die">
								<div class="rolltype-skill rollname-skill_9 d4"></div>
								<div class="rolltype-skill rollname-skill_9 d6"></div>
								<div class="rolltype-skill rollname-skill_9 d8"></div>
								<div class="rolltype-skill rollname-skill_9 d10"></div>
								<div class="rolltype-skill rollname-skill_9 d12"></div>
							</div>
							<div class="downgrade"></div>
						</div>
						<div class="wound">
							<div class="wound-text">Wound</div>
							<div class="wound-box-outline">
								<div class="wound-box"><input type="checkbox" name="attr_skill_9_wound" value="1"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- /********** Gifts **********/ -->
		<div class="gifts pc-only">
			<div class="bar">
				<div class="spacer"></div>
				<div class="tab">Gifts</div>
				<div class="spacer"></div>
			</div>
			<div class="contents">
				<textarea name="attr_gift_1" class="gift"></textarea>
				<textarea name="attr_gift_2" class="gift"></textarea>
				<textarea name="attr_gift_3" class="gift"></textarea>
			</div>
		</div>

		<div class="weapons-powers">
			<!-- /********** Weapons **********/ -->
			<div class="weapons">
				<div class="bar">
					<div class="spacer"></div>
					<div class="tab">Weapons/Powers</div>
					<div class="spacer"></div>
				</div>
				<div class="contents">
					<div class="bar">
						<div class="spacer"></div>
						<div class="tab"><span>Unarmed Additional Wounds Roll = succ: 4 </span><div class="d4"></div><span>+</span><div class="d6"></div><span>+</span><div class="d8"></div></div>
						<div class="spacer"></div>
					</div>
					<div class="weaponlist-outline">
						<div class="weaponlist-box repeating-container">
							<div class="headers">
								<div class="header">Weapon</div>
								<div class="header center">Range</div>
								<div class="header center">Wounds</div>
								<div class="header center">Crits</div>
								<div class="header">Notes</div>
							</div>
							<fieldset class="repeating_weapons">
								<div class="inputs">
									<input type="text" name="attr_name" value="" placeholder="name" />
									<input class="center" type="text" name="attr_range" value="" placeholder="range" />
									<input class="center" type="text" name="attr_wounds" value="" placeholder="wounds" />
									<input class="center" type="text" name="attr_crits" value="" placeholder="crits" />
									<input type="text" name="attr_notes" value="" placeholder="notes" />
								</div>
							</fieldset>
						</div>
					</div>
					<div class="equipment-header">
						<div class="bar">
							<div class="spacer"></div>
							<div class="tab">Equipment</div>
							<div class="spacer"></div>
						</div>
					</div>
					<div class="equipment-outline">
						<div class="equipment-box repeating-container">
							<div class="headers">
								<div class="header">Item</div>
								<div class="header">Notes</div>
							</div>
							<fieldset class="repeating_equipment">
								<div class="inputs">
									<input type="text" name="attr_name" value="" placeholder="name" />
									<input type="text" name="attr_notes" value="" placeholder="notes" />
								</div>
							</fieldset>
						</div>
					</div>
				</div>
			</div>

			<!-- /********** Powers **********/ -->
			<div class="powers pc-only">
				<div class="bar">
					<div class="spacer"></div>
					<div class="tab">Lion Powers</div>
					<div class="spacer"></div>
				</div>
				<div class="contents">
					<div class="bar">
						<div class="spacer"></div>
						<div class="tab"><input name="attr_lion_name" value="Blue Lion (Lance)"></div>
						<div class="spacer"></div>
					</div>
					<div class="lion-stats-outline">
						<div class="lion-stats-box">
							<div class="lion-attributes">
								<div class="lion-attribute">
									<div class="attr-text">Speed</div>
									<div class="attr-box-outline">
										<div class="attr-box">
											<div class="lion-speed-input">
												<input type="text" name="attr_lion_speed" value="">
											</div>
										</div>
									</div>
								</div>
								<div class="lion-attribute">
									<input type="hidden" name="attr_lion_handling_die" value="d10">
									<div class="attr-text">Handling</div>
									<div class="attr-box-outline">
										<div class="attr-box">
											<div class="lion-attr-die">
												<div class="d4"></div>
												<div class="d6"></div>
												<div class="d8"></div>
												<div class="d10"></div>
												<div class="d12"></div>
											</div>
										</div>
									</div>
								</div>
								<div class="lion-attribute">
									<input type="hidden" name="attr_lion_build_die" value="d8">
									<div class="attr-text">Build</div>
									<div class="attr-box-outline">
										<div class="attr-box">
											<div class="lion-attr-die">
												<div class="d4"></div>
												<div class="d6"></div>
												<div class="d8"></div>
												<div class="d10"></div>
												<div class="d12"></div>
											</div>
										</div>
									</div>
								</div>
								<div class="lion-attribute">
									<input type="hidden" name="attr_lion_zoom_die" value="d10">
									<div class="attr-text">Zoom</div>
									<div class="attr-box-outline">
										<div class="attr-box">
											<div class="lion-attr-die">
												<div class="d4"></div>
												<div class="d6"></div>
												<div class="d8"></div>
												<div class="d10"></div>
												<div class="d12"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="lion-weapons repeating-container">
								<div class="headers">
									<div class="header">Weapon</div>
									<div class="header center">Range</div>
									<div class="header center">Wounds</div>
									<div class="header center">Crits</div>
									<div class="header">Notes</div>
								</div>
								<div class="fieldset">
									<fieldset class="repeating_lion-weapons">
										<div class="inputs">
											<input type="text" name="attr_name" value="" placeholder="name" />
											<input class="center" type="text" name="attr_range" value="" placeholder="range" />
											<input class="center" type="text" name="attr_wounds" value="" placeholder="wounds" />
											<input class="center" type="text" name="attr_crits" value="" placeholder="crits" />
											<input type="text" name="attr_notes" value="" placeholder="notes" />
										</div>
									</fieldset>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- /********** Notes (NPC SHEET ONLY) **********/ -->
			<div class="powers npc-only">
				<div class="bar">
					<div class="spacer"></div>
					<div class="tab">Notes</div>
					<div class="spacer"></div>
				</div>
				<div class="contents">
					<div class="lion-stats-outline">
						<div class="lion-stats-box">
							<div class="npc-notes">
							<textarea name="attr_npc_notes" />
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>

		<!-- /********** Wounds **********/ -->
		<div class="wounds">
			<div class="bar">
				<div class="spacer"></div>
				<div class="tab">Wound Track</div>
				<div class="spacer"></div>
			</div>
			<div class="contents">
				<div class="defense">
					<div class="header">Defense</div>
					<div class="defense-box-outline">
						<div class="defense-box">
							<input type="text" name="attr_defense" value="">
							<div class="def-box">
								<input type="hidden" name="attr_armor_wound" value="0">
								<input type="hidden" name="attr_armor" value="">
								<div class="sub-header">Armor</div>
								<div class="defense-die-outline">
									<div class="settings defense-die">
										<select class="die-select" name="attr_armor">
											<option value="">-</option>
											<option value="d4">d4</option>
											<option value="d6">d6</option>
											<option value="d8">d8</option>
											<option value="d10">d10</option>
											<option value="d12">d12</option>
										</select>
									</div>
									<div class="values defense-die">
										<div class="downgrade"></div>
										<div class="rolltype-defense d4"></div>
										<div class="rolltype-defense d6"></div>
										<div class="rolltype-defense d8"></div>
										<div class="rolltype-defense d10"></div>
										<div class="rolltype-defense d12"></div>
									</div>
								</div>
								<input type="checkbox" name="attr_armor_wound" value="1">
								<div class="init-wound">
									<span>Critical</span>
								</div>
							</div>
							<div class="def-box">
								<input type="hidden" name="attr_agility_wound" value="0">
								<input type="hidden" name="attr_agility" value="">
								<div class="sub-header">Agility</div>
								<div class="defense-die-outline">
									<div class="defense-die">
										<div class="downgrade"></div>
										<div class="rolltype-defense d4"></div>
										<div class="rolltype-defense d6"></div>
										<div class="rolltype-defense d8"></div>
										<div class="rolltype-defense d10"></div>
										<div class="rolltype-defense d12"></div>
									</div>
								</div>
								<input type="checkbox" name="attr_agility_wound" value="1">
								<div class="init-wound">
									<span>Critical</span>
								</div>
							</div>
							<div class="def-box">
								<input type="hidden" name="attr_channelling_wound" value="0">
								<input type="hidden" name="attr_channelling" value="">
								<div class="sub-header">Channelling</div>
								<div class="defense-die-outline">
									<div class="defense-die">
										<div class="downgrade"></div>
										<div class="rolltype-defense d4"></div>
										<div class="rolltype-defense d6"></div>
										<div class="rolltype-defense d8"></div>
										<div class="rolltype-defense d10"></div>
										<div class="rolltype-defense d12"></div>
									</div>
								</div>
								<input type="checkbox" name="attr_channelling_wound" value="1">
								<div class="init-wound">
									<span>Critical</span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="fatigue">
					<div class="header">Fatigue<br>Track</div>
					<div class="bubble">
						<input type="checkbox" name="attr_fatigue_1" value="1">
						<span>&nbsp;</span>
					</div>
					<div class="bubble">
						<input type="checkbox" name="attr_fatigue_2" value="1">
						<span>&nbsp;</span>
					</div>
					<div class="bubble">
						<input type="checkbox" name="attr_fatigue_3" value="1">
						<span>&nbsp;</span>
					</div>
				</div>

				<div class="upgrades">
					<div class="header">Upgrades/<br>Downgrades</div>
					<div class="mods-dice-box">
						<div class="upgrades-box">
							<div class="downgrade"></div>
							<div class="upgrade"></div>
						</div>
						<div class="dice-box">
							<div class="d12"></div>
							<div class="d10"></div>
							<div class="d8"></div>
							<div class="d6"></div>
							<div class="d4"></div>
						</div>
					</div>
				</div>

				<div class="wound-track">
					<div class="header">
						<div class="difficulty">Wounds Difficulty Rating for Healing.<br>Skill = 13, Attribute = 16, All Feats = 19</div>
					</div>
					<div class="track">
						<input type="hidden" name="attr_hide_Athletics" value="1">
						<input type="hidden" name="attr_hide_Outdoors" value="1">
						<input type="hidden" name="attr_hide_Close Combat" value="1">
						<input type="hidden" name="attr_hide_Piloting" value="1">
						<input type="hidden" name="attr_hide_Ranged Combat" value="1">
						<input type="hidden" name="attr_hide_Engagement" value="1">
						<input type="hidden" name="attr_hide_Stealth" value="1">
						<input type="hidden" name="attr_hide_Tactics" value="1">
						<input type="hidden" name="attr_hide_Awareness" value="1">
						<input type="hidden" name="attr_hide_Biotechnology" value="1">
						<input type="hidden" name="attr_hide_Electronics" value="1">
						<input type="hidden" name="attr_hide_Engineering" value="1">
						<input type="hidden" name="attr_hide_Medicine" value="1">
						<input type="hidden" name="attr_hide_Acting" value="1">
						<input type="hidden" name="attr_hide_Persuasion" value="1">
						<input type="hidden" name="attr_wound_1" value="">
						<input type="hidden" name="attr_wound_2" value="">
						<input type="hidden" name="attr_wound_3" value="">
						<input type="hidden" name="attr_wound_4" value="">
						<input type="hidden" name="attr_wound_5" value="">
						<input type="hidden" name="attr_wound_6" value="">
						<input type="hidden" name="attr_wound_7" value="">
						<input type="hidden" name="attr_wound_8" value="">
						<input type="hidden" name="attr_wound_9" value="">
						<input type="hidden" name="attr_wound_10" value="">
						<input type="hidden" name="attr_wound_ko" value="">
						<input type="hidden" name="attr_wound_dead" value="">
						<div class="left">
							<div class="step wound-1"><div class="downgrade"></div>
								<select class="step" name="attr_wound_1">
									<option value="">Skill</option>
									<option class="athletics" value="Athletics">Athletics</option>
									<option class="outdoors" value="Outdoors">Outdoors</option>
									<option class="close-combat" value="Close Combat">Close Combat</option>
									<option class="piloting" value="Piloting">Piloting</option>
									<option class="ranged-combat" value="Ranged Combat">Ranged Combat</option>
									<option class="engagement" value="Engagement">Engagement</option>
									<option class="stealth" value="Stealth">Stealth</option>
									<option class="tactics" value="Tactics">Tactics</option>
									<option class="awareness" value="Awareness">Awareness</option>
									<option class="biotechnology" value="Biotechnology">Biotechnology</option>
									<option class="electronics" value="Electronics">Electronics</option>
									<option class="engineering" value="Engineering">Engineering</option>
									<option class="medicine" value="Medicine">Medicine</option>
									<option class="acting" value="Acting">Acting</option>
									<option class="persuasion" value="Persuasion">Persuasion</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-2"><div class="downgrade"></div>
								<select class="step" name="attr_wound_2">
									<option value="">Skill</option>
									<option class="athletics" value="Athletics">Athletics</option>
									<option class="outdoors" value="Outdoors">Outdoors</option>
									<option class="close-combat" value="Close Combat">Close Combat</option>
									<option class="piloting" value="Piloting">Piloting</option>
									<option class="ranged-combat" value="Ranged Combat">Ranged Combat</option>
									<option class="engagement" value="Engagement">Engagement</option>
									<option class="stealth" value="Stealth">Stealth</option>
									<option class="tactics" value="Tactics">Tactics</option>
									<option class="awareness" value="Awareness">Awareness</option>
									<option class="biotechnology" value="Biotechnology">Biotechnology</option>
									<option class="electronics" value="Electronics">Electronics</option>
									<option class="engineering" value="Engineering">Engineering</option>
									<option class="medicine" value="Medicine">Medicine</option>
									<option class="acting" value="Acting">Acting</option>
									<option class="persuasion" value="Persuasion">Persuasion</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-3"><div class="downgrade"></div>
								<select class="step" name="attr_wound_3">
									<option value="">Skill</option>
									<option class="athletics" value="Athletics">Athletics</option>
									<option class="outdoors" value="Outdoors">Outdoors</option>
									<option class="close-combat" value="Close Combat">Close Combat</option>
									<option class="piloting" value="Piloting">Piloting</option>
									<option class="ranged-combat" value="Ranged Combat">Ranged Combat</option>
									<option class="engagement" value="Engagement">Engagement</option>
									<option class="stealth" value="Stealth">Stealth</option>
									<option class="tactics" value="Tactics">Tactics</option>
									<option class="awareness" value="Awareness">Awareness</option>
									<option class="biotechnology" value="Biotechnology">Biotechnology</option>
									<option class="electronics" value="Electronics">Electronics</option>
									<option class="engineering" value="Engineering">Engineering</option>
									<option class="medicine" value="Medicine">Medicine</option>
									<option class="acting" value="Acting">Acting</option>
									<option class="persuasion" value="Persuasion">Persuasion</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-4"><div class="downgrade"></div>
								<select class="step" name="attr_wound_4">
									<option value="">Skill</option>
									<option class="athletics" value="Athletics">Athletics</option>
									<option class="outdoors" value="Outdoors">Outdoors</option>
									<option class="close-combat" value="Close Combat">Close Combat</option>
									<option class="piloting" value="Piloting">Piloting</option>
									<option class="ranged-combat" value="Ranged Combat">Ranged Combat</option>
									<option class="engagement" value="Engagement">Engagement</option>
									<option class="stealth" value="Stealth">Stealth</option>
									<option class="tactics" value="Tactics">Tactics</option>
									<option class="awareness" value="Awareness">Awareness</option>
									<option class="biotechnology" value="Biotechnology">Biotechnology</option>
									<option class="electronics" value="Electronics">Electronics</option>
									<option class="engineering" value="Engineering">Engineering</option>
									<option class="medicine" value="Medicine">Medicine</option>
									<option class="acting" value="Acting">Acting</option>
									<option class="persuasion" value="Persuasion">Persuasion</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-5"><div class="downgrade"></div>
								<select class="step" name="attr_wound_5">
									<option value="">Attribute</option>
									<option class="vitality" value="Vitality">Vitality</option>
									<option class="agility" value="Agility">Agility</option>
									<option class="resolve" value="Resolve">Resolve</option>
									<option class="intellect" value="Intellect">Intellect</option>
									<option class="influence" value="Influence">Influence</option>
									<option class="channelling" value="Channelling">Channelling</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-6"><div class="downgrade"></div>
								<select class="step" name="attr_wound_6">
									<option value="">Attribute</option>
									<option class="vitality" value="Vitality">Vitality</option>
									<option class="agility" value="Agility">Agility</option>
									<option class="resolve" value="Resolve">Resolve</option>
									<option class="intellect" value="Intellect">Intellect</option>
									<option class="influence" value="Influence">Influence</option>
									<option class="channelling" value="Channelling">Channelling</option>
								</select>
							</div>
						</div>
						<div class="middle">
							<img class="middle-arrow" src="https://flowpedia.info/img/voltron/wounds-middle-arrow.png">
						</div>
						<div class="right">
							<div class="step wound-7"><div class="downgrade"></div>
								<select class="step" name="attr_wound_7">
									<option value="">Attribute</option>
									<option class="vitality" value="Vitality">Vitality</option>
									<option class="agility" value="Agility">Agility</option>
									<option class="resolve" value="Resolve">Resolve</option>
									<option class="intellect" value="Intellect">Intellect</option>
									<option class="influence" value="Influence">Influence</option>
									<option class="channelling" value="Channelling">Channelling</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-8"><div class="downgrade"></div>
								<select class="step" name="attr_wound_8">
									<option value="">Attribute</option>
									<option class="vitality" value="Vitality">Vitality</option>
									<option class="agility" value="Agility">Agility</option>
									<option class="resolve" value="Resolve">Resolve</option>
									<option class="intellect" value="Intellect">Intellect</option>
									<option class="influence" value="Influence">Influence</option>
									<option class="channelling" value="Channelling">Channelling</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-9"><div class="downgrade"></div>
								<select class="step" name="attr_wound_9">
									<option value="">Attribute</option>
									<option class="vitality" value="Vitality">Vitality</option>
									<option class="agility" value="Agility">Agility</option>
									<option class="resolve" value="Resolve">Resolve</option>
									<option class="intellect" value="Intellect">Intellect</option>
									<option class="influence" value="Influence">Influence</option>
									<option class="channelling" value="Channelling">Channelling</option>
								</select>
							</div>
							<div id="triangle-down"></div>
							<div class="step wound-10">
								<div class="downgrade"></div>
								<span class="step">All Feats</span>
								<input type="checkbox" name="attr_wound_10" value="1">
							</div>
							<div id="triangle-down"></div>
							<div class="last-step wound-11"><div class="ko"></div><input type="checkbox" name="attr_wound_ko" value="1"></div>
							<div id="triangle-down"></div>
							<div class="last-step wound-12"><div class="skull"></div><input type="checkbox" name="attr_wound_dead" value="1"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- /********** Roller Modal **********/ -->
		<input id="roller-modal" style="position:absolute; z-index: 3;" class="modal-state" name="attr_roller-modal-flag" data-i18n-title="Dice Roller" type="hidden" value="0">
		<div class="modal roller-modal">
			<label class="modal__bg" for="roller-modal"></label>
			<div class="modal__inner">
				<div class="roller-title">
					<span>Dice Roller</span>
				</div>
				<label class="modal__close" for="roller-modal">
				</label>
				<div class="roller-body">
					<div class="roller-feat">
						<input type="hidden" name="attr_feat_base_die" value="">
						<input type="hidden" name="attr_feat_die" value="">
						<input type="hidden" name="attr_feat_upgrades" value="0">
						<input type="hidden" name="attr_feat_downgrades" value="0">
						<input type="hidden" name="attr_feat_bonus" value="0">
						<div class="header">Feat</div>
						<div class="die">
							<div class="upgrades">
								<div class="feat_upgrades_toggle upgrade one"></div>
								<div class="feat_upgrades_toggle upgrade two"></div>
								<div class="feat_upgrades_toggle upgrade three"></div>
								<div class="feat_upgrades_toggle upgrade four"></div>
							</div>
							<div class="d4"></div>
							<div class="d6"></div>
							<div class="d8"></div>
							<div class="d10"></div>
							<div class="d12"></div>
							<div id="feat_downgrades_toggle" class="downgrades">
								<div class="feat_downgrades_toggle downgrade one"></div>
								<div class="feat_downgrades_toggle downgrade two"></div>
								<div class="feat_downgrades_toggle downgrade three"></div>
								<div class="feat_downgrades_toggle downgrade four"></div>
							</div>
						</div>
						<div class="selector">
							<select class="die-select" name="attr_feat_die_selector">
								<option value="d4">No Skill (d4)</option>
								<option value="d6">Complex (d6)</option>
								<option value="d8">Standard (d8)</option>
								<option value="d10">d10</option>
								<option value="d12">d12</option>
							</select>
						</div>
						<div class="base-bonus">
							<span class="base-die">
								<div class="base-die-text header">Base</div>
								<div class="d4"></div>
								<div class="d6"></div>
								<div class="d8"></div>
								<div class="d10"></div>
								<div class="d12"></div>
							</span>
							<span class="bonus">
								<div class="base-die-text header">Bonus</div><div class="bonus"><span name="attr_feat_bonus"></span></div>
							</span>
						</div>
					</div>
					<div class="roller-skill">
						<input type="hidden" name="attr_skill_die" value="">
						<input type="hidden" name="attr_skill_base_die" value="">
						<input type="hidden" name="attr_skill_upgrades" value="0">
						<input type="hidden" name="attr_skill_downgrades" value="0">
						<input type="hidden" name="attr_skill_bonus" value="0">
						<div class="header">Skill</div>
						<div class="die">
							<div class="upgrades">
								<div class="skill_upgrades_toggle upgrade one"></div>
								<div class="skill_upgrades_toggle upgrade two"></div>
								<div class="skill_upgrades_toggle upgrade three"></div>
								<div class="skill_upgrades_toggle upgrade four"></div>
							</div>
							<div class="d4"></div>
							<div class="d6"></div>
							<div class="d8"></div>
							<div class="d10"></div>
							<div class="d12"></div>
							<div class="downgrades">
								<div class="skill_downgrades_toggle downgrade one"></div>
								<div class="skill_downgrades_toggle downgrade two"></div>
								<div class="skill_downgrades_toggle downgrade three"></div>
								<div class="skill_downgrades_toggle downgrade four"></div>
							</div>
						</div>
						<div class="selector">
							<select class="die-select" name="attr_skill_die_selector">
								<option value="__skill__">Skill</option>
								<option class="athletics" value="Athletics">Athletics</option>
								<option class="outdoors" value="Outdoors">Outdoors</option>
								<option class="close-combat" value="Close Combat">Close Combat</option>
								<option class="piloting" value="Piloting">Piloting</option>
								<option class="ranged-combat" value="Ranged Combat">Ranged Combat</option>
								<option class="engagement" value="Engagement">Engagement</option>
								<option class="stealth" value="Stealth">Stealth</option>
								<option class="tactics" value="Tactics">Tactics</option>
								<option class="awareness" value="Awareness">Awareness</option>
								<option class="biotechnology" value="Biotechnology">Biotechnology</option>
								<option class="electronics" value="Electronics">Electronics</option>
								<option class="engineering" value="Engineering">Engineering</option>
								<option class="medicine" value="Medicine">Medicine</option>
								<option class="acting" value="Acting">Acting</option>
								<option class="persuasion" value="Persuasion">Persuasion</option>
								<option class="__custom__" value="Custom d4">Custom d4</option>
								<option class="__custom__" value="Custom d6">Custom d6</option>
								<option class="__custom__" value="Custom d8">Custom d8</option>
								<option class="__custom__" value="Custom d10">Custom d10</option>
								<option class="__custom__" value="Custom d12">Custom d12</option>
							</select>
						</div>
						<div class="base-bonus">
							<span class="base-die">
								<div class="base-die-text header">Base</div>
								<div class="d4"></div>
								<div class="d6"></div>
								<div class="d8"></div>
								<div class="d10"></div>
								<div class="d12"></div>
							</span>
							<span class="bonus">
								<div class="base-die-text header">Bonus</div><div class="bonus"><span name="attr_skill_bonus"></span></div>
							</span>
						</div>
					</div>
					<div class="roller-attribute">
						<input type="hidden" name="attr_attribute_die" value="">
						<input type="hidden" name="attr_attribute_base_die" value="">
						<input type="hidden" name="attr_attribute_upgrades" value="0">
						<input type="hidden" name="attr_attribute_downgrades" value="0">
						<input type="hidden" name="attr_attribute_bonus" value="0">
						<div class="header">Attribute</div>
						<div class="die">
							<div class="upgrades">
								<div class="attribute_upgrades_toggle upgrade one"></div>
								<div class="attribute_upgrades_toggle upgrade two"></div>
								<div class="attribute_upgrades_toggle upgrade three"></div>
								<div class="attribute_upgrades_toggle upgrade four"></div>
							</div>
							<div class="d4"></div>
							<div class="d6"></div>
							<div class="d8"></div>
							<div class="d10"></div>
							<div class="d12"></div>
							<div class="downgrades">
								<div class="attribute_downgrades_toggle downgrade one"></div>
								<div class="attribute_downgrades_toggle downgrade two"></div>
								<div class="attribute_downgrades_toggle downgrade three"></div>
								<div class="attribute_downgrades_toggle downgrade four"></div>
							</div>
						</div>
						<div class="selector">
							<select class="die-select" name="attr_attribute_die_selector">
								<option value="__attribute__">Attribute</option>
								<option class="vitality" value="Vitality">Vitality</option>
								<option class="agility" value="Agility">Agility</option>
								<option class="resolve" value="Resolve">Resolve</option>
								<option class="intellect" value="Intellect">Intellect</option>
								<option class="influence" value="Influence">Influence</option>
								<option class="channelling" value="Channelling">Channelling</option>
								<option class="custom" value="Custom d4">Custom d4</option>
								<option class="custom" value="Custom d6">Custom d6</option>
								<option class="custom" value="Custom d8">Custom d8</option>
								<option class="custom" value="Custom d10">Custom d10</option>
								<option class="custom" value="Custom d12">Custom d12</option>
							</select>
						</div>
						<div class="base-bonus">
							<span class="base-die">
								<div class="base-die-text header">Base</div>
								<div class="d4"></div>
								<div class="d6"></div>
								<div class="d8"></div>
								<div class="d10"></div>
								<div class="d12"></div>
							</span>
							<span class="bonus">
								<div class="base-die-text header">Bonus</div><div class="bonus"><span name="attr_attribute_bonus"></span></div>
							</span>
						</div>
					</div>
					<div class="roller-mods">
						<div class="header">Up/Down</div>
						<div class="die">
							<div class="upgrades">
								<div class="upgrade"></div>
								<div>
									<input type="hidden" name="attr_upgrades_required" value="0">
									<span class="upgrade-input">x <input type="number" min="0" name="attr_dice_roller_upgrades" value="0"></span>
									<span class="upgrades_required">of <span name="attr_upgrades_required"></span></span><br>
								</div>
							</div>
							<div class="downgrades">
								<div class="downgrade"></div>
								<div>
									<input type="hidden" name="attr_downgrades_required" value="0">
									<span class="downgrade-input">x <input type="number" min="0" name="attr_dice_roller_downgrades" value="0"></span>
									<span class="downgrades_required">of <span name="attr_downgrades_required"></span></span><br>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="roller-button">
					<button name="act_roller" type="action" value=''><span>Roll Feat</span></button>
				</div>
			</div>
		</div>


		<!-- /********** Footer **********/ -->
		<div class="footer">
			<div class="bar">
				<div class="tab">
					<span data-i18n="copyrightfooter"></span>
				</div>
				<div class="spacer"></div>
			</div>
		</div>

	</div>
	<div class="right-margin">
		<img src="https://flowpedia.info/img/voltron/right-gradient-sm.png">
	</div>

	<!-- /********** Attributes **************/ -->
	<input type="hidden" name="attr_athletics" value="">
	<input type="hidden" name="attr_outdoors" value="">
	<input type="hidden" name="attr_close-combat" value="">
	<input type="hidden" name="attr_piloting" value="">
	<input type="hidden" name="attr_ranged-combat" value="">
	<input type="hidden" name="attr_engagement" value="">
	<input type="hidden" name="attr_stealth" value="">
	<input type="hidden" name="attr_tactics" value="">
	<input type="hidden" name="attr_awareness" value="">
	<input type="hidden" name="attr_biotechnology" value="">
	<input type="hidden" name="attr_electronics" value="">
	<input type="hidden" name="attr_engineering" value="">
	<input type="hidden" name="attr_medicine" value="">
	<input type="hidden" name="attr_acting" value="">
	<input type="hidden" name="attr_persuasion" value="">


	<!-- /********** Roll Templates **********/ -->
	<div class="rolltemplates">
		<rolltemplate class="sheet-rolltemplate-roller">
			<div class="sheet-header">
				<div class="sheet-feat-die">
					<span class="sheet-title">Feat</span>
					<span class="sheet-name">{{feat_die_name}}</span>
					<div class="sheet-{{feat_die}}"></div>
				</div>
				<span class="sheet-plus">+</span>
				<div class="sheet-skill-die">
					<span class="sheet-title">Skill</span>
					<span class="sheet-name">{{skill_die_name}}</span>
					<div class="sheet-{{skill_die}}"></div>
				</div>
				<span class="sheet-plus">+</span>
				<div class="sheet-attribute-die">
					<span class="sheet-title">Attribute</span>
					<span class="sheet-name">{{attribute_die_name}}</span>
					<div class="sheet-{{attribute_die}}"></div>
				</div>
			</div>
			{{#dice}}<div class="sheet-results">
				{{dice}}
			</div>{{/dice}}
		</rolltemplate>


		<rolltemplate class="sheet-rolltemplate-initiative">
			<div class="sheet-header">
				<div class="sheet-feat-die">
					<span class="sheet-name">Agility</span>
					<div class="sheet-{{feat_die}}"></div>
				</div>
				<span class="sheet-plus">+</span>
				<div class="sheet-skill-die">
					<span class="sheet-name">Intellect</span>
					<div class="sheet-{{skill_die}}"></div>
				</div>
				<span class="sheet-plus">+</span>
				<div class="sheet-attribute-die">
					<span class="sheet-name">Channelling</span>
					<div class="sheet-{{attribute_die}}"></div>
				</div>
			</div>
			{{#dice}}<div class="sheet-results">
				{{dice}}
			</div>{{/dice}}
		</rolltemplate>
	</div>

	<!-- /********** Sheet Attributes **********/ -->

<script type="text/worker">
	const skill_attributes = {
		"athletics": "Vitality",
		"outdoors": "Vitality",
		"close-combat": "Agility",
		"piloting": "Agility",
		"ranged-combat": "Agility",
		"engagement": "Resolve",
		"stealth": "Resolve",
		"tactics": "Resolve",
		"awareness": "Intellect",
		"biotechnology": "Intellect",
		"electronics": "Intellect",
		"engineering": "Intellect",
		"medicine": "Intellect",
		"acting": "Influence",
		"persuasion": "Influence"
	};

	const rollButtons = {
		"roller": "&{template:roller}{{dice=[[1@{feat_die}+@{feat_bonus}+1@{skill_die}+@{skill_bonus}+1@{attribute_die}+@{attribute_bonus}]]}}{{feat_die=@{feat_die}}}{{feat_die_name=@{feat_die}}}{{skill_die=@{skill_die}}}{{skill_die_name=@{skill_die_selector}}}{{attribute_die=@{attribute_die}}}{{attribute_die_name=@{attribute_die_selector}}}",
		"initiative": "&{template:initiative}{{dice=[[1@{agility}+1@{intellect}+1@{channelling}]]}}{{feat_die=@{agility}}}{{skill_die=@{intellect}}}{{attribute_die=@{channelling}}}",
	};

  /*******************/
 /* Roll Processors */
/*******************/
	[
		'roller',
		'initiative',
	].forEach((button) => {
console.log(button);
		on(`clicked:${button}`, (eventInfo) => {

			params = [];
			eventInfo.htmlAttributes.value.split(/\s*,\s*/).forEach((attr_pair) => {
				pair = attr_pair.split(/\s*:\s*/);
				params[pair[0]] = pair[1];
			});

			if(button == "initiative") {
				params['initiative'] = true;
			}

			let rollButton = rollButtons[eventInfo.triggerName.slice(8)];
			rollProcessor(rollButton, params);
		});
	});

/************************************
* Roll Processor
* - This does the heavy lifting
************************************/
var rollProcessor = async (rollButton, params = [], ev = {}, passthrough = {}) => {
console.log("params");
console.log(params);
console.log("ev");
console.log(ev);
console.log("passthrough");
console.log(passthrough);
console.log("rollButton");
console.log(rollButton);

	startRoll(rollButton, (results) => {
console.log(results.results);
		if(! results.results.dice) {
			results.results.dice = {dice: []}
		}

		finishRoll(
			results.rollId, {
				dice: results.results.dice,
			}
		);

		if(params['initiative']) {
			const trackerRoll = startRoll(`![[${results.results.dice.result}&{tracker}]]`, (tracker) => {
				finishRoll(
					tracker.rollId, {}
				);
			});
		}

		setAttrs({
			"roller-modal-flag": "0",
			"feat_die": "d8",
			"feat_upgrades": "0",
			"feat_downgrades": "0",
			"skill_die": "",
			"skill_die_selector": "__skill__",
			"skill_upgrades": "0",
			"skill_downgrades": "0",
			"attribute_die": "",
			"attribute_die_selector": "__attribute__",
			"attribute_upgrades": "0",
			"attribute_downgrades": "0"
		});
	});

};


  /***************/
 /* Dice Roller */
/***************/
	// Open roller window when clicking any die icon
	$20("div.d4, div.d6, div.d8, div.d10, div.d12").on('click', async (e) => {
		toSet = {
			"roller-modal-flag": "1"
		};

		params = [];
		e.htmlAttributes.class.split(/\s+/).forEach((part) => {
			if(part.includes("rolltype") || part.includes("rollname")) {
				c = part.split(/-/);
				params[c[0]] = c[1];
			}
		});

		// Use some "classes" to identify what type of roll it is and maybe pre-select the right skill/attribute/etc
		switch(params.rolltype) {
			case "attribute":
				toSet['attribute_die_selector'] = params['rollname'];
				break;
			case "skill":
				slot = params.rollname + '_name';
				getAttrs([slot], (v) => {
					setAttrs({
						"skill_die_selector": v[slot]
					});
				});
				break;
			case "defense":
				getAttrs(["armor", "agility", "channelling"], (v) => {
					setAttrs({
						"feat_die": v.armor,
						"skill_die_selector": `Custom ${v.agility}`,
						"attribute_die_selector": `Custom ${v.channelling}`
					});
				});
				break;
			case "initiative":
				getAttrs(["agility", "intellect", "channelling"], (v) => {
					setAttrs({
						"feat_die": v.agility,
						"skill_die_selector": `Custom ${v.intellect}`,
						"attribute_die_selector": `Custom ${v.channelling}`
					});
				});
				break;
			default:
				break;
		}

		update_roller_required_mods();

		setAttrs(toSet);
	});

	// Close roller window when clicking the title bar / X or the background
	$20(".modal__close, .modal__bg").on('click', async (e) => {
		setAttrs({
			"roller-modal-flag": "0",
			"feat_upgrades": 0,
			"feat_downgrades": 0,
			"skill_upgrades": 0,
			"skill_downgrades": 0,
			"attribute_upgrades": 0,
			"attribute_downgrades": 0
		});
	});


	/* Update attr_feat_die when feat_die_selector changes */
	on("change:feat_die_selector", function(eventInfo) {
		let die = _normalize(eventInfo.newValue);
		setAttrs({
			feat_die: die,
			feat_base_die: die
		});

		update_roller_required_mods();
	});

	/* Update attr_skill_die when skill_die_selector changes */
	on("change:skill_die_selector", function(eventInfo) {
		let slot = _normalize(eventInfo.newValue);

		// handle the default empty option
		if(slot == "__skill__") {
			setAttrs({
				skill_die: '',
				skill_base_die: '',
				attribute_die_selector: '__attribute__'
			});

			return;
		}

		// handle custom options
		if(slot.includes("custom-")) {
			die = slot.slice(7);

			setAttrs({
				skill_die: die,
				skill_base_die: die
			});
			return;
		}

		getAttrs([`${slot}`], (v) => {
			let die = v[slot] + '_die';
			getAttrs([die], (w) => {
				let sd = 'd4';
				if(w[`${die}`]) {
					sd = w[`${die}`];
				}

				let attribute = '';
				if(skill_attributes[`${slot}`]) {
					attribute = skill_attributes[`${slot}`];
				}

				setAttrs({
					skill_die: sd,
					skill_base_die: sd,
					attribute_die_selector: attribute
				});
			});
		});

		update_roller_required_mods();
	});

	/* Update attr_attribute_die when attribute_die_selector changes */
	on("change:attribute_die_selector", function(eventInfo) {
		let attribute = _normalize(eventInfo.newValue);

		// handle the default empty option
		if(attribute == "__attribute__") {
			setAttrs({
				attribute_die: '',
				attribute_base_die: ''
			});

			return;
		}

		// handle custom options
		if(attribute.includes("custom-")) {
			die = attribute.slice(7);

			setAttrs({
				attribute_die: die,
				attribute_base_die: die
			});

			return;
		}


		getAttrs([`${attribute}`], (v) => {
			let die = v[attribute];

			setAttrs({
				attribute_die: die,
				attribute_base_die: die
			});
		});

		update_roller_required_mods();
	});


	// update the die size based on upgrades/downgrades
	// Feat Die
	on("change:feat_base_die change:feat_upgrades change:feat_downgrades", function(eventInfo) {
		getAttrs(['feat_base_die', 'feat_upgrades', 'feat_downgrades'], (v) => {
			let result = apply_mods(v.feat_base_die, v.feat_upgrades, v.feat_downgrades);

			setAttrs({
				feat_die: result.result_die,
				feat_bonus: result.bonus
			});
		});
	});

	// Skill Die
	on("change:skill_base_die change:skill_upgrades change:skill_downgrades", function(eventInfo) {
		getAttrs(['skill_base_die', 'skill_upgrades', 'skill_downgrades'], (v) => {
			let result = apply_mods(v.skill_base_die, v.skill_upgrades, v.skill_downgrades);

			setAttrs({
				skill_die: result.result_die,
				skill_bonus: result.bonus
			});
		});
	});

	// Attribute Die
	on("change:attribute_base_die change:attribute_upgrades change:attribute_downgrades", function(eventInfo) {
		getAttrs(['attribute_base_die', 'attribute_upgrades', 'attribute_downgrades'], (v) => {
			let result = apply_mods(v.attribute_base_die, v.attribute_upgrades, v.attribute_downgrades);

			setAttrs({
				attribute_die: result.result_die,
				attribute_bonus: result.bonus
			});
		});
	});


	// Apply up/downgrades to the die
	let apply_mods = (base_die, upgrades, downgrades) => {
		let result_die = base_die;
		let bonus = 0;

		modded = {
			base_die: base_die,
			result_die: result_die,
			bonus: bonus
		};

		let diff = upgrades - downgrades;

		if(diff == 0) {
			return modded;
		}

		let dice_steps = ['d4', 'd6', 'd8', 'd10', 'd12'];
		let die_idx = dice_steps.findIndex((die) => {
			return die == base_die;
		});

		let new_die_idx = die_idx + diff;

		if(new_die_idx < 0) {
			modded.result_die = 'd4';
			modded.bonus = new_die_idx * 2;
		} else if(new_die_idx > 4) {
			modded.result_die = 'd12';
			modded.bonus = (new_die_idx - 4) * 2;
		} else {
			modded.result_die = dice_steps[new_die_idx];
		}

		return modded;
	};

	// update which mods and how many are required for a roll
	let update_roller_required_mods = () => {
		getAttrs(['skill_die_selector', 'attribute_die_selector', 'wound_10'], (v) => {
			let skill = _normalize(v.skill_die_selector);
			let attribute = _normalize(v.attribute_die_selector);
			getAttrs([`${attribute}_wound`, `${skill}`], (vv) => {
				if(vv[`${skill}`]) {
					let skill_downgrades = 0;
					let attribute_downgrades = 0;
					let feat_downgrades = 0;
					let downgrades = 0;

					let skill_upgrades = 0;
					let attribute_upgrades = 0;
					let feat_upgrades = 0;
					let upgrades = 0;

					// figure out if the skill has a wound or upgrade
					let skill_wound = vv[`${skill}`] + '_wound';
					let skill_upgrade = vv[`${skill}`] + '_upgrade';
					getAttrs([`${skill_wound}`, `${skill_upgrade}`], (vvv) => {
						if(vvv[`${skill_wound}`] > 0) {
							downgrades++;
							skill_downgrades = 1;
						}

						if(vvv[`${skill_upgrade}`] > 0) {
							upgrades++;
							skill_upgrades = 1;
						}


						// figure out if the attribute has a wound
							if(vv[`${attribute}_wound`] > 0) {
								downgrades++;
								attribute_downgrades = 1;
							}

						// if wound_10 (all feats) is active that's another downgrade
						if(v.wound_10 > 0) {
							downgrades++;
							feat_downgrades = 1;
						}

						setAttrs({
							skill_downgrades: skill_downgrades,
							attribute_downgrades: attribute_downgrades,
							feat_downgrades: feat_downgrades,
							downgrades_required: downgrades,
							skill_upgrades: skill_upgrades,
							upgrades_required: upgrades
						});
					});
				}
			});
		});
	};

  /*****************/
 /* Wound Updater */
/*****************/
	/****************/
	/* Skill Wounds */
	/****************/
	['wound_1', 'wound_2', 'wound_3', 'wound_4'].forEach((wound) => {
		on(`change:${wound}`, function(eventInfo) {
			if(! eventInfo.newValue) {
				skillWoundOff(eventInfo.previousValue);
			} else if(! eventInfo.previousValue) {
				skillWoundOn(eventInfo.newValue);
			} else {
				skillWoundOff(eventInfo.previousValue);
				skillWoundOn(eventInfo.newValue);
			}
		});
	});

	var skillWoundOn = (skill) => {
		let skillN = _normalize(skill);
		getAttrs([skillN], (v) => {
			let skillSlot = v[`${skillN}`];
			setAttrs({
				[`${skillSlot}_wound`]: "1"
			});
		});
	};

	var skillWoundOff = (skill) => {
		let skillN = _normalize(skill);
		getAttrs([skillN], (v) => {
			let skillSlot = v[`${skillN}`];
			setAttrs({
				[`${skillSlot}_wound`]: ""
			});
		});
	};


	/********************/
	/* Attribute Wounds */
	/********************/
	['wound_5', 'wound_6', 'wound_7', 'wound_8', 'wound_9'].forEach((wound) => {
		on(`change:${wound}`, function(eventInfo) {
			if(! eventInfo.newValue) {
				attrWoundOff(eventInfo.previousValue);
			} else if(! eventInfo.previousValue) {
				attrWoundOn(eventInfo.newValue);
			} else {
				attrWoundOff(eventInfo.previousValue);
				attrWoundOn(eventInfo.newValue);
			}
		});
	});

	var attrWoundOn = (attribute) => {
		let attributeN = _normalize(attribute);
		setAttrs({
			[`${attributeN}_wound`]: "1"
		});
	};

	var attrWoundOff = (attribute) => {
		let attributeN = _normalize(attribute);
		setAttrs({
			[`${attributeN}_wound`]: ""
		});
	};



  /*****************/
 /* Skill Locator */
/*****************/
	const skill_attrs = ['skill_1', 'skill_2', 'skill_3', 'skill_4', 'skill_5', 'skill_6', 'skill_7', 'skill_8', 'skill_9'];
	skill_attrs.forEach((skill) => {
		/* Populate a pointer when the skills are changed so we can figure out if for example Athletics is skill_1, skill_2, etc */
		on(`change:${skill}_name`, function(eventInfo) {
			if(eventInfo.newValue) {
				let newattr = _normalize(eventInfo.newValue);

				setAttrs({
					[newattr]: `${skill}`,
					[`hide_${eventInfo.newValue}`]: '0'
				});
			}

			if(eventInfo.previousValue) {
				let oldattr = _normalize(eventInfo.previousValue);

				setAttrs({
					[oldattr]: '',
					[`hide_${eventInfo.previousValue}`]: '1'
				});
			}
		});
	});

  /*********************/
 /* Utility Functions */
/*********************/
	var _normalize = (term) => {
		norm = term.toLowerCase().replace(/\s/g, '-');
		return norm;
	};

	/* Thanks to Oosh on the Roll20 forums for this bit of code, used for passing data through rolls
	Helper - the data passed through in an action button needs these characters escaped
	I have used a mongrel escape sequence to avoid triggering anything internal in Roll20
	This may not be a complete list of characters that need escaping! If you have heavily
	punctuated text, it might break the passthrough!
	*/
	const rollEscape = {
		 chars: {
			  '"': '%quot;',
			  ',': '%comma;',
			  ':': '%colon;',
			  '}': '%rcub;',
			  '{': '%lcub;',
		 },
		 escape(str) {
			  str = (typeof(str) === 'object') ? JSON.stringify(str) : (typeof(str) === 'string') ? str : null;
			  return (str) ? `${str}`.replace(new RegExp(`[${Object.keys(this.chars)}]`, 'g'), (r) => this.chars[r]) : null;
		 },
		 unescape(str) {
			  str = `${str}`.replace(new RegExp(`(${Object.values(this.chars).join('|')})`, 'g'), (r) => Object.entries(this.chars).find(e=>e[1]===r)[0]);
			  return JSON.parse(str);
		 }
	};


  /**********************/
 /* Roll Up/Downgrades */
/**********************/
	["feat_upgrades", "skill_upgrades", "attribute_upgrades"].forEach((upg) => {
		on(`change:${upg}`, function(eventInfo) {
			getAttrs(["feat_upgrades", "skill_upgrades", "attribute_upgrades"], (v) => {
				total = parseInt(v.feat_upgrades) + parseInt(v.skill_upgrades) + parseInt(v.attribute_upgrades);

				setAttrs({
					dice_roller_upgrades: total
				});
			});
		});
	});

	["feat_downgrades", "skill_downgrades", "attribute_downgrades"].forEach((upg) => {
		on(`change:${upg}`, function(eventInfo) {
			getAttrs(["feat_downgrades", "skill_downgrades", "attribute_downgrades"], (v) => {
				total = parseInt(v.feat_downgrades) + parseInt(v.skill_downgrades) + parseInt(v.attribute_downgrades);

				setAttrs({
					dice_roller_downgrades: total
				});
			});
		});
	});


	$20(".feat_upgrades_toggle").on('click', async (e) => {
		getAttrs(["feat_upgrades"], (v) => {
console.log(e);
			newValue = parseInt(v.feat_upgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				feat_upgrades: newValue
			});
		});
	});

	$20(".feat_downgrades_toggle").on('click', async (e) => {
		getAttrs(["feat_downgrades"], (v) => {
			newValue = parseInt(v.feat_downgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				feat_downgrades: newValue
			});
		});
	});


	$20(".skill_upgrades_toggle").on('click', async (e) => {
		getAttrs(["skill_upgrades"], (v) => {
			newValue = parseInt(v.skill_upgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				skill_upgrades: newValue
			});
		});
	});

	$20(".skill_downgrades_toggle").on('click', async (e) => {
		getAttrs(["skill_downgrades"], (v) => {
			newValue = parseInt(v.skill_downgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				skill_downgrades: newValue
			});
		});
	});


	$20(".attribute_upgrades_toggle").on('click', async (e) => {
		getAttrs(["attribute_upgrades"], (v) => {
			newValue = parseInt(v.attribute_upgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				attribute_upgrades: newValue
			});
		});
	});

	$20(".attribute_downgrades_toggle").on('click', async (e) => {
		getAttrs(["attribute_downgrades"], (v) => {
			newValue = parseInt(v.attribute_downgrades);
			if(! e.altKey && ! e.shiftKey && ! e.ctrlKey && newValue >= 4) {
				newValue = 0;
			} else if((e.altKey || e.shiftKey || e.ctrlKey) && newValue > 0) {
				newValue--;
			} else if(! e.altKey && ! e.shiftKey && ! e.ctrlKey) {
				newValue++;
			}

			setAttrs({
				attribute_downgrades: newValue
			});
		});
	});

</script>
</div>

