<!-- Roll20 - Fiche TOMOE / ex-Red Point Genesis V1.0 by Giovanninatale, surfandko -->

<!-- affichage des onglets -->
<input type="radio" class="sheet-tab" name="attr_page" value="worksheet" checked="checked"><span title="Personnage"></span>

<!-- Onglet Fiche de personnage -->
<div class="sheet-tab sheet-tab-worksheet">
	<!-- Paramètres -->
	<input type="hidden" name="attr_Corps" value="Corps">
	<input type="hidden" name="attr_Social" value="Social">
	<input type="hidden" name="attr_Mystik" value="Mystik">
	<!-- avantage AIGLE -->
	<input type="hidden" name="attr_avantage_aigle" value="AIGLE -*Action*- ">
	<input type="hidden" name="attr_avantage_aigle_texte" value="Connaître un Attribut d’une personne">
	<input type="hidden" name="attr_avantage_aigle_cout" value="2 points de fatigue">
	<!-- avantage SINGE : Bonus en Initiative, Coût : aucun -->
	<input type="hidden" name="attr_avantage_singe" value="SINGE -*Initiative*-">
	<input type="hidden" name="attr_avantage_singe_texte" value="Bonus en Initiative">
	<input type="hidden" name="attr_avantage_singe_cout" value="aucun">	
	<!-- avantage GUEPARD : Bonus en action, Coût : 2 points de fatigue -->
	<input type="hidden" name="attr_avantage_guepard" value="GUEPARD -*Initiative*-">
	<input type="hidden" name="attr_avantage_guepard_texte" value="Bonus en action">
	<input type="hidden" name="attr_avantage_guepard_cout" value="2 points de fatigue">
	<!-- avantage PEGAZE : Heat-score, chaque attaque augmente de +2 la résolution suivante, Coût : 2 points de fatigue -->
	<input type="hidden" name="attr_avantage_pegaze" value="PEGAZE -*Initiative*-">
	<input type="hidden" name="attr_avantage_pegaze_texte" value="Heat-score, chaque attaque augmente de +2 la résolution suivante">
	<input type="hidden" name="attr_avantage_pegaze_cout" value="2 points de fatigue">
	<!-- avantage PHENIX : sauvegarde son personnage, Coût : 3 points d'expérience -->
	<input type="hidden" name="attr_avantage_phenix" value="PHENIX -*Initiative*-">
	<input type="hidden" name="attr_avantage_phenix_texte" value="sauvegarde son personnage">
	<input type="hidden" name="attr_avantage_phenix_cout" value="3 points d'expérience">
	<!-- avantage SANGLIER : Résistance au Dégâts de 5 dans l'attribut choisit, Coût : 2 points de fatigue -->
	<input type="hidden" name="attr_avantage_sanglier_corps" value="SANGLIER -*Dégâts*-">
	<input type="hidden" name="attr_avantage_sanglier_corps_texte" value="Résistance au Dégâts de 5 dans l'attribut Corps">
	<input type="hidden" name="attr_avantage_sanglier_corps_cout" value="2 points de fatigue">
	<input type="hidden" name="attr_avantage_sanglier_social" value="SANGLIER -*Dégâts*-">
	<input type="hidden" name="attr_avantage_sanglier_social_texte" value="Résistance au Dégâts de 5 dans l'attribut Social">
	<input type="hidden" name="attr_avantage_sanglier_social_cout" value="2 points de fatigue">
	<input type="hidden" name="attr_avantage_sanglier_mystik" value="SANGLIER -*Dégâts*-">
	<input type="hidden" name="attr_avantage_sanglier_mystik_texte" value="Résistance au Dégâts de 5 dans l'attribut Mystik">
	<input type="hidden" name="attr_avantage_sanglier_mystik_cout" value="2 points de fatigue">
	<!-- avantage DRAGON : +1D10 dans l'attribut choisit, Coût : 2 points de fatigue -->
	<input type="hidden" name="attr_avantage_dragon_corps" value="DRAGON -*Action*-">
	<input type="hidden" name="attr_avantage_dragon_corps_texte" value="+1D10 dans l'attribut Corps">
	<input type="hidden" name="attr_avantage_dragon_corps_cout" value="2 points de fatigue">
	<input type="hidden" name="attr_avantage_dragon_social" value="DRAGON -*Action*-">
	<input type="hidden" name="attr_avantage_dragon_social_texte" value="+1D10 dans l'attribut Social">
	<input type="hidden" name="attr_avantage_dragon_social_cout" value="2 points de fatigue">
	<input type="hidden" name="attr_avantage_dragon_mystik" value="DRAGON -*Action*-">
	<input type="hidden" name="attr_avantage_dragon_mystik_texte" value="+1D10 dans l'attribut Mystik">
	<input type="hidden" name="attr_avantage_dragon_mystik_cout" value="2 points de fatigue">
	<!-- avantage SERPENT : Faire exploser les D10 dans l'attribut choisit, Coût : aucun -->
	<input type="hidden" name="attr_avantage_serpent_corps" value="SERPENT -*Action*-">
	<input type="hidden" name="attr_avantage_serpent_corps_texte" value="Faire exploser les D10 dans l'attribut Corps">
	<input type="hidden" name="attr_avantage_serpent_corps_cout" value="aucun">
	<input type="hidden" name="attr_avantage_serpent_social" value="SERPENT -*Action*-">
	<input type="hidden" name="attr_avantage_serpent_social_texte" value="Faire exploser les D10 dans l'attribut Social">
	<input type="hidden" name="attr_avantage_serpent_social_cout" value="aucun">
	<input type="hidden" name="attr_avantage_serpent_mystik" value="SERPENT -*Action*-">
	<input type="hidden" name="attr_avantage_serpent_mystik_texte" value="Faire exploser les D10 dans l'attribut Mystik">
	<input type="hidden" name="attr_avantage_serpent_mystik_cout" value="aucun">
	<input type="hidden" name="attr_Corps_serpent" value="">
	<!-- serpent actif	<input type="hidden" name="attr_Corps_serpent" value="!"> -->
	<input type="hidden" name="attr_Social_serpent" value="">
	<!--  serpent actif	<input type="hidden" name="attr_Social_serpent" value="!"> -->
	<input type="hidden" name="attr_Mystik_serpent" value="">
	<!--  serpent actif	<input type="hidden" name="attr_Mystik_serpent" value="!"> -->
	<!-- avantage TORTUE : Concentration 1 Tour et double un Atout (son potentiel) pour un tour, Coût : 2 points de fatigue -->
	<input type="hidden" name="attr_avantage_tortue" value="TORTUE *Initiative*">
	<input type="hidden" name="attr_avantage_tortue_texte" value="Concentration 1 Tour et double un Atout (son potentiel) pour un tour">
	<input type="hidden" name="attr_avantage_tortue_cout" value="2 points de fatigue">
	
	<!-- privilege_naratif -->
	<input type="hidden" name="attr_privilege_naratif" value="Privilège narratif">
	<input type="hidden" name="attr_privilege_naratif_texte" value="Description du narrateur qui offre une récompense aux joueurs en fonction de leurs actions et de la situation">
	<input type="hidden" name="attr_privilege_naratif_cout" value="5 points de fatigue">

	<!-- soutenir-entraver -->
	

	<!-- FDP Titre -->
	<div class="fdp"> <!-- Struture globale FDP -->	
		<!-- Bloc nom - univers -->
		<div class="sheet-nom">
			<div>
				<span style="font-size: 16px;"><strong>Nom</strong></span>
			</div>
			<div>
				<input type="text" name="attr_character_name" title="@{character_name}" style="width:100%">
			</div>
			<div>
				<span style="font-size: 16px;"><strong>Univers</strong></span>
			</div>
			<div>
				<input type="text" name="attr_univers" title="@{attr_univers}" style="width:100%">
			</div>
			<div>
				<span style="font-size: 16px;"><strong>Jet : </strong></span>
			</div>
			<div>
				<input type="radio" name="attr_jetGM" value="" checked class="CSSJetPGM" /><span class="CSSJetPGM">Public</span>
				<input type="radio" name="attr_jetGM" value="/w gm" class="CSSJetPGM" /><span class="CSSJetPGM">GM</span>
			</div>
		</div>
		<HR>
		
		<!-- Bloc Santé - Fatigue - Action - Initiative -->
		<div class="sheet-informations">
			<div> <!-- Santé Max -->
				<div class="sheet-hexagon sheet-hexagon-moyen">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_santeMax" title="@{attr_santeMax}" value="[[[[@{Corps_Value}]]+[[@{Corps_Value}]]+[[@{Mystik_Value}]]+[[@{Corps_Value}]]+[[@{Corps_Value}]]+[[@{Mystik_Value}]]]]" style="width:50px" disabled="true">
					</div>
				</div>
			</div> <!-- Santé -->
			<div class="sheet-hexagone-diagonale">
				<div class="sheet-hexagon sheet-hexagon-moyen sheet-hexagon-grey">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_sante" title="@{attr_sante}" style="width:50px">
					</div>
				</div>
			</div>
			<div> <!-- Fatigue Max -->
				<div class="sheet-hexagon sheet-hexagon-moyen">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_fatigueMax" title="@{attr_fatigueMax}" value="[[[[@{Social_Value}]]+[[@{Social_Value}]]+[[@{Mystik_Value}]]+[[@{Social_Value}]]+[[@{Social_Value}]]+[[@{Mystik_Value}]]]]" style="width:50px" disabled="true">
					</div>
				</div>
			</div> <!-- Fatigue -->
			<div class="sheet-hexagone-diagonale">
				<div class="sheet-hexagon sheet-hexagon-moyen sheet-hexagon-grey">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_fatigue" title="@{attr_fatigue}" style="width:50px">
					</div>
				</div>
			</div>
			<div> <!-- Puissance -->
				<div class="sheet-hexagon sheet-hexagon-moyen">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_puissance" title="@{attr_puissance}" value="[[@{totalCorps} + @{totalSocial} + @{totalMystik} + @{totalAtout} + @{Corps_Value} +@{Corps_Value} +@{Social_Value} +@{Social_Value} +@{Mystik_Value} + @{Mystik_Value}]]" style="width:50px" disabled="true">
					</div>
				</div>
			</div>
			<div class="sheet-hexagone-diagonale"> <!-- XP restant -->
				<div class="sheet-hexagon sheet-hexagon-moyen sheet-hexagon-grey">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_xpRestant" title="@{attr_xpRestant}" style="width:50px">
					</div>
				</div>
			</div>
			<div> <!-- Action -->
				<div class="sheet-hexagon sheet-hexagon-moyen">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_action" title="@{attr_action}" style="width:50px" value="1">
					</div>
				</div>
			</div>
			<div class="sheet-hexagone-diagonale"> <!-- Initiative -->
				<div class="sheet-hexagon sheet-hexagon-moyen">
					<div class="sheet-chevauche-hexagon-moyen">
						<input type="number" name="attr_initiative" title="@{attr_initiative}" style="width:50px" value="1">
					</div>
				</div>
			</div>
			<div>
				<div><span><strong>Privilège narratif</strong></span></div>
				<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{privilege_naratif}}} {{texte1=@{privilege_naratif_texte}}} {{texte2=@{privilege_naratif_cout}}}"></button>
			</div>
			<div>
				<H2><span><strong>SANTE</strong></span></H2>
			</div>
			<div class="sheet-hexagone-diagonale">
				<span>Santé actuelle</span>
			</div>
			<div class="sheet-decale-gauche-fatigue">
				<H2><span><strong>FATIGUE</strong></span></H2>
			</div>
			<div class="sheet-hexagone-diagonale">
				<span>Fatigue actuelle</span>
			</div>
			<div class="sheet-decale-gauche">
				<span><strong>PUISSANCE</strong></span>
			</div>
			<div class="sheet-hexagone-diagonale">
				<span>Expérience restante</span>
			</div>
			<div>
				<span><strong>ACTION</strong></span>
			</div>
			<div class="sheet-hexagone-diagonale">
				<span><strong>INITIATIVE</strong></span>
			</div>
		</div>
	</div>
	<BR>
	<BR>	
	<HR>
	
	<!-- Bloc Corps - Social - Mystik -->	
	<!-- Bloc atouts -->
	<div class="sheet-attributs-atouts">
		<div> <!-- caractéritique Corps -->
			<div class="sheet-hexagon sheet-hexagon-moyen-2">
				<div class="sheet-chevauche-hexagon-moyen-2">
					<input type="number" name="attr_Corps_Value" title="@{attr_Corps_Value}" style="width:50px" value="1">
				</div>
				<div class="sheet-chevauche-hexagon-moyen-button">
					<button type="roll" value="@{jetGM} &{template:attribut} {{name=@{character_name}}} {{attribut=@{Corps}}} {{dice=[[1d10+[[@{Corps_Value}]]]]}} {{dice_type=@{Corps}}}"></button>
				</div>
			</div>
			<div style="font-size: 16px">
				<H2><span><strong>CORPS</strong></span></H2>
			</div>
		</div>
		<div> <!-- caractéritique Social -->
			<div class="sheet-hexagon sheet-hexagon-moyen-2">
				<div class="sheet-chevauche-hexagon-moyen-2">
					<input type="number" name="attr_Social_Value" title="@{attr_Social_Value}" style="width:50px" value="1">
				</div>
				<div class="sheet-chevauche-hexagon-moyen-button">
					<button type="roll" value="@{jetGM} &{template:attribut} {{name=@{character_name}}} {{attribut=@{Social}}} {{dice=[[1d10+[[@{Social_Value}]]]]}} {{dice_type=@{Social}}}"></button>
				</div>
			</div>
			<div style="font-size: 16px">
				<H2><span><strong>SOCIAL</strong></span></H2>
			</div>
		</div>
		<div>  <!-- caractéritique Mystik -->
			<div class="sheet-hexagon sheet-hexagon-moyen-2">
				<div class="sheet-chevauche-hexagon-moyen-2">
					<input type="number" name="attr_Mystik_Value" title="@{attr_Mystik_Value}" style="width:50px" value="1">
				</div>
				<div class="sheet-chevauche-hexagon-moyen-button">
					<button type="roll" value="@{jetGM} &{template:attribut} {{name=@{character_name}}} {{attribut=@{Mystik}}} {{dice=[[1d10+[[@{Mystik_Value}]]]]}} {{dice_type=@{Mystik}}}"></button>				
				</div>
			</div>
			<div style="font-size: 16px"> 
				<H2><span><strong>MYSTIK</strong></span></H2>
			</div>
		</div>

		
		<div> <!-- Atouts Corps -->
			<H2><span>Atouts</span></H2>
			<fieldset class="repeating_Corps">
					<input type="text" name="attr_PouvCorps_name" title="@{attr_PouvCorps_name}" style="max-width:139px">
					<input type="number" name="attr_PouvCorps_value" title="@{attr_PouvCorps_value}" style="vertical-align:bottom;max-width:43px">
					<!-- clique soutenir-entraver sur "potentiel complet atout" -->
					<button class="display-potentiel" type="roll" name="roll_SoutenirCorps" value="@{jetGM} &{template:atout-soutenir-entraver} {{name=@{character_name}}} {{attribut=@{Corps}}} {{dice=[[[[@{PouvCorps_Value}]]+[[@{Corps_Value}]]]]}} {{dice_type=@{PouvCorps_name}}} {{atout=[[[[@{Corps_Value}]]+[[@{PouvCorps_Value}]]]]}}">
						<span class="potentiel" > <!-- calcul potentiel complet atout -->
							<input type="number" class="potentiel" name="attr_PotPouvCorps_value_total" title="@{attr_PotPouvCorps_value_total}" value="[[@{PotPouvCorps_value}+@{Corps_value}]]" style="max-width:43px" disabled>
						</span>
					</button>				
					<button type="roll" value="@{jetGM} &{template:atout} {{name=@{character_name}}} {{attribut=@{Corps}}} {{dice=[[1d10+[[@{PouvCorps_Value}]]+[[@{Corps_Value}]]]]}} {{dice_type=@{PouvCorps_name}}} {{atout=[[[[@{Corps_Value}]]+[[@{PouvCorps_Value}]]]]}}"></button>
			</fieldset>
		</div>
		
		<div> <!-- Atouts Social -->
			<H2><span>Atouts</span></H2>
			<fieldset class="repeating_Social">
					<input type="text" name="attr_PouvSocial_name" title="@{attr_PouvSocial_name}" style="max-width:139px">
					<input type="number" name="attr_PouvSocial_value" title="@{attr_PouvSocial_value}" value="0" style="vertical-align:bottom;max-width:43px">
					<button class="display-potentiel" type="roll" name="roll_SoutenirSocial" value="@{jetGM} &{template:atout-soutenir-entraver} {{name=@{character_name}}} {{attribut=@{Social}}} {{dice=[[[[@{PouvSocial_Value}]]+[[@{Social_Value}]]]]}} {{dice_type=@{PouvSocial_name}}} {{atout=[[[[@{Social_Value}]]+[[@{PouvSocial_Value}]]]]}}">
						<span class="potentiel" > <!-- calcul potentiel complet atout -->
							<input type="number" class="potentiel" name="attr_PotPouvSocial_value" title="@{attr_PotPouvSocial_value}" value=" [[@{PotPouvSocial_value}+@{Social_value} ]]" style="max-width:43px" disabled />
						</span>
					</button>
					<button type="roll" value="@{jetGM} &{template:atout} {{name=@{character_name}}} {{attribut=@{Social}}} {{dice=[[1d10+[[@{PouvSocial_Value}]]+[[@{Social_Value}]]]]}} {{dice_type=@{PouvSocial_name}}} {{atout=[[[[@{Social_Value}]]+[[@{PouvSocial_Value}]]]]}}"></button>
			</fieldset>
		</div>
		
		<div>  <!-- Atouts Mystik -->
			<H2><span>Atouts</span></H2>
			<fieldset class="repeating_Mystik">
					<input type="text" name="attr_PouvMystik_name" title="@{attr_PouvMystik_name}" style="max-width:139px">
					<input type="number" name="attr_PouvMystik_Value" title="@{attr_PouvMystik_value}" value="0" style="vertical-align:bottom;max-width:43px">
					<button class="display-potentiel" type="roll" name="roll_SoutenirSocial" value="@{jetGM} &{template:atout-soutenir-entraver} {{name=@{character_name}}} {{attribut=@{Mystik}}} {{dice=[[[[@{PouvMystik_Value}]]+[[@{Mystik_Value}]]]]}} {{dice_type=@{PouvMystik_name}}} {{atout=[[[[@{Mystik_Value}]]+[[@{PouvMystik_Value}]]]]}}">
						<span class="potentiel" > <!-- calcul potentiel complet atout -->
							<input type="number" class="potentiel" name="attr_PotPouvMystik_value" title="@{attr_PotPouvMystik_value}" value=" [[@{PotPouvMystik_value}+@{Mystik_value} ]]" style="max-width:43px" disabled />
						</span>
					</button>
					<button type="roll" value="@{jetGM} &{template:atout} {{name=@{character_name}}} {{attribut=@{Mystik}}} {{dice=[[1d10+[[@{PouvMystik_Value}]]+[[@{Mystik_Value}]]]]}} {{dice_type=@{PouvMystik_name}}} {{atout=[[[[@{Mystik_Value}]]+[[@{PouvMystik_Value}]]]]}}"></button>
			</fieldset>
		</div>
	</div>
	<HR>
	
	<!-- Avantages -->
	<H2><span>AVANTAGES</span></H2>
	<div class="sheet-avantages">
		<div> <!-- AIGLE -->
			<div class="tooltip"><span><strong>AIGLE</strong></span>
				<span class="tooltiptext">AIGLE : Connaître un Attribut d’une personne, Coût : 2 points de fatigue</span>
			</div>
			<input type="checkbox" name="attr_aigle_0" title="@{attr_aigle_0}" value="1">
			<!-- avantage {{avantage}} {{texte1}} {{texte2}} -->
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_aigle}}} {{texte1=@{avantage_aigle_texte}}} {{texte2=@{avantage_aigle_cout}}}"></button>
			<!-- <button type="action" name="act_useaigle" title="@{act_useaigle}" value="utiliser">Utiliser</button> -->
		</div>
		
		<div> <!-- SINGE -->
			<div class="tooltip"><span><strong>SINGE</strong></span>
				<span class="tooltiptext">SINGE : Bonus en Initiative, Coût : aucun</span>
			</div>
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_singe}}} {{texte1=@{avantage_singe_texte}}} {{texte2=@{avantage_singe_cout}}}"></button>
			<div class="sheet-avantage-singe">
				<div>
					<input type="checkbox" name="attr_singe_1_1" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_singe_2_1" value="1"><input type="checkbox" name="attr_singe_2_2" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_singe_3_1" value="1"><input type="checkbox" name="attr_singe_3_2" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_singe_4_1" value="1"><input type="checkbox" name="attr_singe_4_2" value="1">
				</div>
				<div>
				</div>
				<div>
				</div>
				<div>
					<input type="checkbox" name="attr_singe_3_3" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_singe_4_3" value="1"><input type="checkbox" name="attr_singe_4_4" value="1">
				</div>
				<div>
					<span>1</span>
				</div>
				<div>
					<span>2</span>
				</div>
				<div>
					<span>3</span>
				</div>
				<div>
					<span>4</span>
				</div>
			</div>
		</div>
		
		<div> <!-- GUEPARD -->
			<div class="tooltip"><span><strong>GUEPARD</strong></span>
				<span class="tooltiptext">GUEPARD : Bonus en action, Coût : 2 points de fatigue</span>
			</div>
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_guepard}}} {{texte1=@{avantage_guepard_texte}}} {{texte2=@{avantage_guepard_cout}}}"></button>
			<!-- <button type="action" name="act_useguepard" title="@{act_useguepard}" value="utiliser">Utiliser</button> -->
			<div class="sheet-avantage-guepard">
				<div>
					<input type="checkbox" name="attr_GUEPARD_1_1" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_GUEPARD_2_1" value="1"><input type="checkbox" name="attr_GUEPARD_2_2" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_GUEPARD_3_1" value="1"><input type="checkbox" name="attr_GUEPARD_3_2" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_GUEPARD_4_1" value="1"><input type="checkbox" name="attr_GUEPARD_4_2" value="1">
				</div>
				<div>
				</div>
				<div>
				</div>
				<div>
					<input type="checkbox" name="attr_GUEPARD_3_3" value="1">
				</div>
				<div>
					<input type="checkbox" name="attr_GUEPARD_4_3" value="1"><input type="checkbox" name="attr_GUEPARD_4_4" value="1">
				</div>
				<div>
					<span>2 actions</span>
				</div>
				<div>
					<span>3 actions</span>
				</div>
				<div>
					<span>4 actions</span>
				</div>
				<div>
					<span>5 actions</span>
				</div>
			</div>
		</div>
		
		<div> <!-- PEGAZE -->
			<HR>
			<div class="tooltip"><span><strong>PEGAZE</strong></span>
				<span class="tooltiptext">PEGAZE : Heat-score, chaque attaque augmente de +2 la résolution suivante, Coût : 2 points de fatigue</span>
			</div>
			<input type="checkbox" name="attr_PEGAZE_0" title="@{attr_PEGAZE_0}" value="1">
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_pegaze}}} {{texte1=@{avantage_pegaze_texte}}} {{texte2=@{avantage_pegaze_cout}}}"></button>
			<!-- <button type="action" name="act_usepegaze" title="@{act_usepegaze}" value="utiliser">Utiliser</button> -->
		</div>
		
		<div> <!-- PHENIX -->
			<HR>
			<div class="tooltip"><span><strong>PHENIX</strong></span>
				<span class="tooltiptext">PHENIX : sauvegarde son personnage, Coût : 3 points d'expérience</span>
			</div>
			<input type="checkbox" name="attr_PHENIX_0" title="@{attr_PHENIX_0}" value="1">
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_phenix}}} {{texte1=@{avantage_phenix_texte}}} {{texte2=@{avantage_phenix_cout}}}"></button>
			<!-- <button type="action" name="act_useguepard" title="@{act_useguepard}" value="utiliser">Utiliser</button> -->
		</div>
		
		<div> <!-- TORTUE -->
			<HR>
			<div class="tooltip"><span><strong>TORTUE</strong></span>
				<span class="tooltiptext">TORTUE : Concentration 1 Tour et double un Atout (son potentiel) pour un tour, Coût : 2 points de fatigue</span>
            </div>
			<input type="checkbox" name="attr_TORTUE_0" title="@{attr_TORTUE_0}" value="1">
			<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_tortue}}} {{texte1=@{avantage_tortue_texte}}} {{texte2=@{avantage_tortue_cout}}}"></button>
			<!-- <button type="action" name="act_usetortue" title="@{act_usetortue}" value="utiliser">Utiliser</button> -->
		</div>
		
		<div> <!-- SANGLIER -->
			<HR>
			<div class="tooltip"><span><strong>SANGLIER</strong></span>
				<span class="tooltiptext">SANGLIER : Résistance au Dégâts de 5 dans l'attribut choisit, Coût : 2 points de fatigue</span>
			</div>
			<div class="sheet-avantage-sanglier">
				<div>
					<input type="checkbox" name="attr_SANGLIER_Mystik" value="1"><span>Mystik</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_sanglier_mystik}}} {{texte1=@{avantage_sanglier_mystik_texte}}} {{texte2=@{avantage_sanglier_mystik_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_SANGLIER_Social" value="1"><span>Social</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_sanglier_social}}} {{texte1=@{avantage_sanglier_social_texte}}} {{texte2=@{avantage_sanglier_social_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_SANGLIER_Corps" value="1"><span>Corps</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_sanglier_corps}}} {{texte1=@{avantage_sanglier_corps_texte}}} {{texte2=@{avantage_sanglier_corps_cout}}}"></button>
				</div>
			</div>
		</div>

		<div> <!-- DRAGON -->
			<HR>
			<div class="tooltip"><span><strong>DRAGON</strong></span>
				<span class="tooltiptext">DRAGON : +1D10 dans l'attribut choisit, Coût : 2 points de fatigue</span>
			</div>
			<div class="sheet-avantage-dragon">
				<div>
					<input type="checkbox" name="attr_DRAGON_Mystik" value="1"><span>Mystik</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_dragon_mystik}}} {{texte1=@{avantage_dragon_mystik_texte}}} {{texte2=@{avantage_dragon_mystik_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_DRAGON_Social" value="1"><span>Social</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_dragon_social}}} {{texte1=@{avantage_dragon_social_texte}}} {{texte2=@{avantage_dragon_social_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_DRAGON_Corps" value="1"><span>Corps</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_dragon_corps}}} {{texte1=@{avantage_dragon_corps_texte}}} {{texte2=@{avantage_dragon_corps_cout}}}"></button>
				</div>

			</div>
		</div>
		
		<div> <!-- SERPENT -->
			<HR>
			<div class="tooltip"><span><strong>SERPENT</strong></span>
				<span class="tooltiptext">SERPENT : Faire exploser les D10 dans l'attribut choisit, Coût : aucun</span>
			</div>
			<div class="sheet-avantage-serpent">
				<div>
					<input type="checkbox" name="attr_SERPENT_Mystik" value="1"><span>Mystik</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_serpent_mystik}}} {{texte1=@{avantage_serpent_mystik_texte}}} {{texte2=@{avantage_serpent_mystik_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_SERPENT_Social" value="1"><span>Social</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_serpent_social}}} {{texte1=@{avantage_serpent_social_texte}}} {{texte2=@{avantage_serpent_social_cout}}}"></button>
				</div>
				<div>
					<input type="checkbox" name="attr_SERPENT_Corps" value="1"><span>Corps</span>
					<button type="roll" value="&{template:avantage} {{name=@{character_name}}} {{avantage=@{avantage_serpent_corps}}} {{texte1=@{avantage_serpent_corps_texte}}} {{texte2=@{avantage_serpent_corps_cout}}}"></button>
				</div>
			</div>
		</div>
	</div>
	
	<HR>
	<div class="sheet-faiblesse-notes">
		<div>
			<H3><span>Faiblesse</span></H3>
			<fieldset class="repeating_Faiblesse">
				<select class="attribut" name="attr_attributfaiblesse" title="@{attr_attributfaiblesse}" style="font-size:12px; width:62px;margin:1px" >
					<option value="aucun" selected>Aucun</option>
					<option value="corps">Corps</option>
					<option value="social">Social</option>
					<option value="mystik">Mystik</option>
				</select>
				<input type="text" name="attr_Faiblesse_name" title="@{attr_Faiblesse_name}" style="width: 245px;">
				<input type="number" name="attr_Faiblesse_value" title="@{attr_Faiblesse_value}" style="vertical-align:top;" value="0">
				<button type="roll" value="&{template:faiblesse} {{name=@{character_name}}} {{faiblesse=@{Faiblesse_name}}} {{typefaiblesse=@{attributfaiblesse}}} {{effetvalue=@{Faiblesse_value}}} {{effet=[[@{Faiblesse_value}]]}}"></button>
			</fieldset>
		</div>
		<div>
			<H3><span>Note</span></H3>
			<TEXTAREA name="attr_notes" title="@{notes}"style="margin:0px 0px 9px;width:389px;height:133px"></TEXTAREA>
		</div>
	</div>
	
	<!-- FDP Bloc version-->
    <HR>
    <span>V1.0 2020-07-13</span>
</div>

<!-- affichage jet attribut -->
<rolltemplate class="sheet-rolltemplate-attribut">
	<div class="attribut_container">
		<div class="attribut_header"><h3>{{name}}</h3></div>
		<div class="attribut_rowcolor1"><span class="attribut_subheader"/>Jet d'ATTRIBUT</div>
		<div class="attribut_rowcolor2"><span class="attribut_subheader"/>{{dice_type}}</div>
		<div class="attribut_rowcolor1"><span class="attribut_subheader" />Valeur : {{dice}}</div>
	</div>
</rolltemplate>
    
<!-- affichage jet atout -->
<rolltemplate class="sheet-rolltemplate-atout">
	<div class="atout_container">
		<div class="atout_header"><h3>{{name}}</h3></div>
		<div class="atout_rowcolor2"><span class="atout_subheader"/>Jet d'ATOUT</div>
		<div class="atout_rowcolor1"><span class="atout_subheader"/>{{attribut}} - {{dice_type}}</div>
		<div class="atout_rowcolor2"><span class="atout_subheader" />Valeur : {{dice}}</div>
		
	</div>
</rolltemplate>

<!-- affichage faiblesse -->
<rolltemplate class="sheet-rolltemplate-faiblesse">
	<div class="atout_container">
		<div class="atout_header"><h3>{{name}}</h3></div>
		<div class="atout_rowcolor2"><span class="atout_subheader" />Faiblesse de type {{typefaiblesse}}</div>
		<div class="atout_rowcolor1"><span class="atout_subheader" />{{faiblesse}} - {{effetvalue}}</div>
		<div class="atout_rowcolor2"><span class="atout_subheader" />
			Malus : 
				{{#rollLess() effet 6}} -1 {{/rollLess() effet 6}} 
				{{#rollBetween() effet 6 10}}  -2 {{/rollBetween() effet 6 10}}
				{{#rollBetween() effet 11 15}} -3 {{/rollBetween() effet 11 15}}
				{{#rollBetween() effet 16 20}} -4 {{/rollBetween() effet 16 20}}
				{{#rollBetween() effet 21 25}} -5 {{/rollBetween() effet 21 25}}
				{{#rollBetween() effet 26 30}} -6 {{/rollBetween() effet 26 30}}
				{{#rollBetween() effet 31 35}} -7 {{/rollBetween() effet 31 35}}
				{{#rollBetween() effet 36 40}} -8 {{/rollBetween() effet 36 40}}
				{{#rollBetween() effet 41 45}} -9 {{/rollBetween() effet 41 45}}
				{{#rollBetween() effet 46 50}} -10 {{/rollBetween() effet 46 50}}
				{{#rollGreater() effet 50}} faiblesse 50(-10) // faiblesse+5 donne -1 {{/rollGreater() effet 50}}
		</div>
	</div>
</rolltemplate>

<!-- affichage atout soutenir-entraver -->
<rolltemplate class="sheet-rolltemplate-atout-soutenir-entraver">
	<div class="atout_container">
		<div class="atout_header"><h3>{{name}}</h3></div>
		<div class="atout_rowcolor2"><span class="atout_subheader" />Soutenir / Entraver </div>
		<div class="atout_rowcolor1"><span class="atout_subheader" />{{attribut}} - {{dice_type}}</div>
		<div class="atout_rowcolor2"><span class="atout_subheader" />
				{{#rollLess() dice 6}} 0 {{/rollLess() dice 6}} 
				{{#rollBetween() dice 6 10}} +/- 2 {{/rollBetween() dice 6 10}}
				{{#rollBetween() dice 11 15}} +/- 3 {{/rollBetween() dice 11 15}}
				{{#rollBetween() dice 16 20}} +/- 5 {{/rollBetween() dice 16 20}}
				{{#rollBetween() dice 21 25}} +/- 7 {{/rollBetween() dice 21 25}}
				{{#rollBetween() dice 26 30}} +/- 10 {{/rollBetween() dice 26 30}}
				{{#rollBetween() dice 31 40}} +/- 20 {{/rollBetween() dice 31 40}}
				{{#rollBetween() dice 41 50}} +/- 30 {{/rollBetween() dice 41 50}}
				{{#rollBetween() dice 51 60}} +/- 40 {{/rollBetween() dice 51 60}}
				{{#rollBetween() dice 61 80}} +/- 50 {{/rollBetween() dice 61 80}}
				{{#rollGreater() dice 80}} (+/- 50) et Atout>81 // atout+20 donne +10 {{/rollGreater() dice 80}} 
		</div>
	</div>
</rolltemplate>

<!-- affichage avantage -->
<rolltemplate class="sheet-rolltemplate-avantage"> <!-- avantage {{avantage}} {{texte1}} {{texte2}} -->
	<div class="atout_container">
		<div class="atout_header"><h3>{{name}}</h3></div>
		<div class="atout_rowcolor2"><span class="atout_subheader" /> {{avantage}}</div>
		<div class="atout_rowcolor1"><span class="atout_subheader" /> {{texte1}}</div>
		<div class="atout_rowcolor2"><span class="atout_subheader" /> Coût : {{texte2}}</div>
	</div>
</rolltemplate>

<script type="text/worker">
/* ===== PARAMETERS ==========
destination = the name of the attribute that stores the total quantity
section = name of repeating fieldset, without the repeating_
fields = the name of the attribute field to be summed
      can be a single attribute: 'weight'
      or an array of attributes: ['weight','number','equipped']
multiplier (optional) = a multiplier to the entire fieldset total. 
For instance, if summing coins of weight 0.02, might want to multiply the final total by 0.02.
*/

const repeatingSum = (destination, section, fields, valtoupdate, multiplier = 1) => {
    if (!Array.isArray(fields)) fields = [fields];
	if (!Array.isArray(valtoupdate)) valtoupdate = [valtoupdate];
	
	//mise a jour de la valeur potentielle
	getSectionIDs(`repeating_${section}`, idArray => {
		//tableau des atouts
		let attrArray_atout ={};
		 attrArray_atout = idArray.reduce( (m,id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))],[]);
		//tableaux des potentiels
		let attrArray_pot ={};
		attrArray_pot = idArray.reduce( (m,id) => [...m, ...(valtoupdate.map(val => `repeating_${section}_${id}_${val}`))],[]);
		//merge des deux
		let attrArray ={};	
		attrArray = attrArray_atout;
		attrArray_pot.forEach(pot => {
			attrArray.push(pot);
		});
		//mise à jour du potentiel issu de la valeur de la compétence
		getAttrs(attrArray, v => {
			let update = {};
			idArray.forEach(id => {
				update[`repeating_${section}_${id}_${valtoupdate}`] = parseFloat(v[`repeating_${section}_${id}_${fields}`]);   	
				   } );
		   setAttrs(update);
		});   
  
		
    });
	
	//calcul du total pour la puissance
	getSectionIDs(`repeating_${section}`, idArray => {
		const attrArray = idArray.reduce( (m,id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))],[]);
		getAttrs(attrArray, v => {
			//console.log("===== values of v: "+ JSON.stringify(v) +" =====");
			const getValue = (section, id,field) => parseFloat(v[`repeating_${section}_${id}_${field}`], 10) || (v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : 0); 
			const sumTotal = idArray.reduce((total, id) => total + fields.reduce((subtotal,field) => subtotal * getValue(section, id,field),1),0);
			setAttrs({[destination]: sumTotal * multiplier});    
		});
	});
};

//total Corps
on('change:repeating_Corps remove:repeating_Corps sheet:opened', function() {
	repeatingSum("totalCorps","Corps","PouvCorps_value","PotPouvCorps_value");
});

//total Social
on('change:repeating_Social remove:repeating_Social sheet:opened', function() {
	repeatingSum("totalSocial","Social","PouvSocial_value","PotPouvSocial_value");
});

//total Mystik
on('change:repeating_Mystik remove:repeating_Mystik sheet:opened', function() {
	repeatingSum("totalMystik","Mystik","PouvMystik_value","PotPouvMystik_value");
});
// ... etc


//total de la puisssance donné par les atouts
on('change:aigle_0 change:singe_1_1 change:guepard_1_1 change:pegaze_0 change:phenix_0 change:sanglier_corps change:sanglier_social change:sanglier_mystik change:dragon_corps change:dragon_social change:dragon_mystik change:serpent_corps change:serpent_social change:serpent_mystik change:tortue_0 sheet:opened', function () {
    getAttrs(['aigle_0','singe_1_1','GUEPARD_1_1','PEGAZE_0','PHENIX_0','SANGLIER_Corps','SANGLIER_Social','SANGLIER_Mystik','DRAGON_Corps','DRAGON_Social','DRAGON_Mystik','SERPENT_Corps','SERPENT_Social','SERPENT_Mystik','TORTUE_0'], function (values) {

        const aigle = parseInt(values.aigle_0) ||0;
        const singe = parseInt(values.singe_1_1) || 0;
        const guepard = parseInt(values.GUEPARD_1_1) || 0;
        const pegaze = parseInt(values.PEGAZE_0) || 0;
        const phenix = parseInt(values.PHENIX_0) || 0;
        const sanglier = (parseInt(values.SANGLIER_Corps) || 0) ||  (parseInt(values.SANGLIER_Social) || 0)  || (parseInt(values.SANGLIER_Mystik) || 0); 
        const dragon = (parseInt(values.DRAGON_Corps) || 0) ||  (parseInt(values.DRAGON_Social) || 0)  || (parseInt(values.DRAGON_Mystik) || 0); 
        const serpent = (parseInt(values.SERPENT_Corps) || 0) ||  (parseInt(values.SERPENT_Social) || 0)  || (parseInt(values.SERPENT_Mystik) || 0); 
        const tortue = parseInt(values.TORTUE_0) || 0;
        
        const sumTotal = (aigle + singe  +guepard + pegaze + phenix + sanglier + dragon + serpent + tortue) *5;

        setAttrs({
            totalAtout: sumTotal
        });
    });
});

/* en cours de dev */
on('clicked:useaigle', function() { 
	console.log("===== Appel de la fonction recalc_fatigue_actuelle =====");
	recalc_fatigue_actuelle(2,"fatigueact"); 
});

/* en cours de dev */
const recalc_fatigue_actuelle = (cout_fatigue, destination, origine='fatigue') => {
	console.log("===== valeur de cout_fatigue dans la fonction recalc_fatigue_actuelle "+ JSON.stringify(cout_fatigue) +" =====");
	console.log("===== valeur de cout_fatigue dans la fonction recalc_fatigue_actuelle"+ JSON.stringify(origine) +" =====");
	if (!Array.isArray(origine)) origine = [origine];
	getAttrs(origine, values => {
		console.log("===== valeur de values dans la fonction recalc_fatigue_actuelle"+ JSON.stringify(values) +" =====");
		
		const newfatigue = parseInt(values[`${origine}`]) + parseInt(`${cout_fatigue}`);
		console.log("===== valeur de newfatigue dans la fonction recalc_fatigue_actuelle"+ JSON.stringify(newfatigue) +" =====");
		setAttrs({destination: newfatigue});
	});
};
</script>