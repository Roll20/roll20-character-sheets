(()=>{var q=(r,o=0)=>parseInt(r)||o,O=(r,o=0)=>parseFloat(r)||o,g=(r,o="green")=>{let e=`%c ${r}`;console.log(e,`color: ${o}; font-weight:bold`)},d=(r,o=0)=>typeof r<"u"&&r!==o,xe=(r,o)=>{let e=r;return _.each(Object.entries(o),([i,n])=>{e=e.replace(new RegExp(i.replace("{","{"),"gi"),n)}),e},yt=r=>/^[a-zA-Z0-9\s]+$/.test(r)?!0:!/[)|\}]/.test(r),$t=r=>/^[-+]?[0-9]+$/.test(r)?1:0,Ta={},k=()=>{let r=generateRowID();for(;Ta[r]===!0;)g(`generateUniqueRowID: ${r} is not a unique ID, trying again.`),r=generateRowID();return Ta[r]=!0,r};on("change:character_name",r=>{getAttrs(["character_name"],o=>{let e={},i=o[`${r.sourceAttribute}`],n=yt(i);e[`${r.sourceAttribute}_error`]=n,setAttrs(e,{silent:!0})})});on("change:armortype_magic change:armortype2_magic change:armorshield_magic change:armorhelmet_magic change:armorother_magic change:armorother2_magic change:armorother3_magic change:armorother4_magic change:armorother5_magic change:armorother6_magic change:armorshield_mod change:armorother_mod change:armorother2_mod change:armorother3_mod change:armorother4_mod change:armorother5_mod change:armorother6_mod change:repeating_equipment:equipment_armor_mod change:repeating_equipment:equipment_armor_magic, change:hitpoints_1_class, change:hitpoints_2_class, change:hitpoints_3_class",r=>{let o=r.sourceAttribute.split("_")[2];getAttrs(["armortype_magic","armortype2_magic","armorshield_magic","armorhelmet_magic","armorother_magic","armorother2_magic","armorother3_magic","armorother4_magic","armorother5_magic","armorother6_magic","armorshield_mod","armorother_mod","armorother2_mod","armorother3_mod","armorother4_mod","armorother5_mod","armorother6_mod",`repeating_equipment_${o}_equipment_armor_magic`,`repeating_equipment_${o}_equipment_armor_mod`,"hitpoints_1_class","hitpoints_2_class","hitpoints_3_class"],e=>{let i={},n=e[`${r.sourceAttribute}`],a=$t(n);i[`${r.sourceAttribute}_error`]=a,setAttrs(i,{silent:!0})})});var Se,La="",Ba="",ja="",V="",Ke="",Pa="",Ye="",Xe="",Qe="",Me="",Ze="",Je="",ve="",ea="",aa="",ta="",oa="",na="",ra="",_a="",Ua="",Ha="",Wa="",sa="",ia="",pa="",ca="",ma="",la="",ha="",ua="",ga="",y="",Va="",wa="",De=["unarmored_row_id","armortype1_row_id","armortype2_row_id","armorshield_row_id","armorhelmet_row_id","armorother1_row_id","armorother2_row_id","armorother3_row_id","armorother4_row_id","armorother5_row_id","armorother6_row_id"],ba=["unarmored_worn","unarmored","unarmored_ac","unarmored_base","unarmored_bulk","unarmored_carried","unarmored_weight","unarmored_cost","armortype_worn","armortype","armortype_ac","armortype_base","armortype_magic","armortype_bulk","armortype_carried","armor_weight","armor_cost","armortype2_worn","armortype2","armortype2_ac","armortype2_base","armortype2_magic","armortype2_bulk","armortype2_carried","armortype2_weight","armortype2_cost","armorshield_worn","armorshield","armorshield_ac","armorshield_base","armorshield_magic","armorshield_mod","armorshield_bulk","armorshield_carried","armorshield_weight","armorshield_cost","armorhelmet_worn","armorhelmet","armorhelmet_ac","armorhelmet_magic","armorhelmet_bulk","armorhelmet_carried","armorhelmet_weight","armorhelmet_cost","armorother_worn","armorother","armorother_ac","armorother_base","armorother_magic","armorother_mod","armorother2_worn","armorother2","armorother2_ac","armorother2_base","armorother2_magic","armorother2_mod","armorother3_worn","armorother3","armorother3_ac","armorother3_base","armorother3_magic","armorother3_mod","armorother4_worn","armorother4","armorother4_ac","armorother4_base","armorother4_magic","armorother4_mod","armorother5_worn","armorother5","armorother5_ac","armorother5_base","armorother5_magic","armorother5_mod","armorother6_worn","armorother6","armorother6_ac","armorother6_base","armorother6_magic","armorother6_mod"],s=(r,o,e)=>`repeating_${r}_${o}_${e}`,kt=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"DmgBonus")),i.push(s("weapon",n,"macro-text"))}),getAttrs([...i],n=>{let a={},t="&{template:attacks} {{name=@{character_name}}} {{subtag=@{WeaponName}}} {{attack1=[[1d20 + @{ToHitBonus}[BON] + @{MagicBonus}[MAG] + ?{To Hit Modifier?|0}[MOD] ]]}} {{damage1vsSM=[[@{DamageSmallMedium} + @{DmgBonus}[BON] + @{MagicBonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{damage1vsL=[[@{DamageLarge} + @{DmgBonus}[BON] + @{MagicBonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{WeaponNotes=@{WeaponNotes}}} @{whisper_to-hit}";_.each(e,p=>{let c=n[s("weapon",p,"macro-text")]||t;a[s("weapon",p,"macro-text")]=c.replace(/@{DmgBonus}/g,"@{AttackDmgBonus}"),a[s("weapon",p,"AttackDmgBonus")]=+n[s("weapon",p,"DmgBonus")]||0}),a.sheet_version=r,g("VERSION UPDATE: dmgSwap completed"),setAttrs(a,{silent:!0},y(r,o))})})},At=(r,o)=>{getSectionIDs("repeating_ability",e=>{let i=[];_.each(e,n=>{i.push(s("ability",n,"max"))}),getAttrs([...i],n=>{let a={};_.each(e,t=>{a[s("ability",t,"current_max")]=+n[s("ability",t,"max")]||0}),a.sheet_version=r,g("VERSION UPDATE: maxSwap completed"),setAttrs(a,{silent:!0},y(r,o))})})},xt=(r,o)=>{let e={};getSectionIDs("repeating_nonweaponproficiencies",i=>{let n=[];_.each(i,a=>{n.push(s("nonweaponproficiencies",a,"macro-text"))}),getAttrs([...n],a=>{let t={nwp_old:"&{template:general} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{name}}} {{=@{short_description}}}{{Success Amount=[[((@{rAttribute})+(@{rSlots}-1)-1d20)cs>1cf<-1]]}}",nwp_new:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{name}}} {{Proficiency Check=[[ 1d20 + [[@{rmodifier}]][MOD] + [[?{Additional modifier?|0}]][MOD] ]] vs [[ @{rAttribute}[ATTR] ]]}}{{freetext=@{short_description}}}"};_.each(i,p=>{a[s("nonweaponproficiencies",p,"macro-text")]&&(e[s("nonweaponproficiencies",p,"macro-text")]=a[s("nonweaponproficiencies",p,"macro-text")].replace(t.nwp_old,t.nwp_new))}),e.sheet_version=r,g("VERSION UPDATE: nwpMacroUpdate completed"),setAttrs(e,{silent:!0},y(r,o))})})},St=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"roll")),i.push(s("weapon",n,"weaponname")),i.push(s("weapon",n,"tohitbonus")),i.push(s("weapon",n,"magicbonus")),i.push(s("weapon",n,"attackdmgbonus")),i.push(s("weapon",n,"whisper_to-hit")),i.push(s("weapon",n,"macro-text")),i.push(s("weapon",n,"damagesmallmedium")),i.push(s("weapon",n,"damagelarge")),i.push(s("weapon",n,"rateoffire")),i.push(s("weapon",n,"range")),i.push(s("weapon",n,"quantity")),i.push(s("weapon",n,"weight")),i.push(s("weapon",n,"weaponspeed")),i.push(s("weapon",n,"cost")),i.push(s("weapon",n,"weaponnotes"))}),getAttrs([...i],n=>{let a={},t={"@{rateoffire}":"@{weapon_rateoffire}","@{weaponname}":"@{weapon_name}","@{tohitbonus}":"@{weapon_tohitbonus}","@{magicbonus}":"@{weapon_magicbonus}","@{attackdmgbonus}":"@{weapon_attackdmgbonus}","@{whisper_to-hit}":"@{weapon_whisper_to_hit}","@{damagesmallmedium}":"@{weapon_damagesmallmedium}","@{damagelarge}":"@{weapon_damagelarge}","@{range}":"@{weapon_range}","@{quantity}":"@{weapon_quantity}","@{weight}":"@{weapon_weight}","@{weaponspeed}":"@{weapon_speed}","@{cost}":"@{weapon_cost}","@{macro-text}":"@{weapon_macro_text}","@{weaponnotes}":"@{weapon_notes}"},p="&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{WeaponName}}} {{attack1=[[1d20 + @{ToHitBonus}[BON] + @{MagicBonus}[MAG] + ?{To Hit Modifier?|0}[MOD]) ]]}} {{damage1vsSM=[[@{DamageSmallMedium} + @{AttackDmgBonus}[BON] + @{MagicBonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{damage1vsL=[[@{DamageLarge} + @{AttackDmgBonus}[BON] + @{MagicBonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{WeaponNotes=@{WeaponNotes}}} @{whisper_to-hit}";_.each(e,c=>{d(n[s("weapon",c,"rateoffire")])&&(a[s("weapon",c,"weapon_rateoffire")]=q(n[s("weapon",c,"rateoffire")])),d(n[s("weapon",c,"roll")])&&(a[s("weapon",c,"weapon_roll")]=n[s("weapon",c,"roll")]),d(n[s("weapon",c,"weaponname")])&&(a[s("weapon",c,"weapon_name")]=n[s("weapon",c,"weaponname")]),d(n[s("weapon",c,"tohitbonus")])&&(a[s("weapon",c,"weapon_tohitbonus")]=q(n[s("weapon",c,"tohitbonus")])),d(n[s("weapon",c,"magicbonus")])&&(a[s("weapon",c,"weapon_magicbonus")]=q(n[s("weapon",c,"magicbonus")])),d(n[s("weapon",c,"attackdmgbonus")])&&(a[s("weapon",c,"weapon_attackdmgbonus")]=q(n[s("weapon",c,"attackdmgbonus")])),d(n[s("weapon",c,"whisper_to-hit")])&&(a[s("weapon",c,"weapon_whisper_to_hit")]=n[s("weapon",c,"whisper_to-hit")]),d(n[s("weapon",c,"macro-text")],p)&&(a[s("weapon",c,"weapon_macro_text")]=xe(n[s("weapon",c,"macro-text")],t)),d(n[s("weapon",c,"damagesmallmedium")])&&(a[s("weapon",c,"weapon_damagesmallmedium")]=n[s("weapon",c,"damagesmallmedium")]),d(n[s("weapon",c,"damagelarge")])&&(a[s("weapon",c,"weapon_damagelarge")]=n[s("weapon",c,"damagelarge")]),d(n[s("weapon",c,"range")])&&(a[s("weapon",c,"weapon_range")]=n[s("weapon",c,"range")]),d(n[s("weapon",c,"quantity")])&&(a[s("weapon",c,"weapon_quantity")]=O(n[s("weapon",c,"quantity")])),d(n[s("weapon",c,"weight")])&&(a[s("weapon",c,"weapon_weight")]=O(n[s("weapon",c,"weight")])),d(n[s("weapon",c,"weaponspeed")])&&(a[s("weapon",c,"weapon_speed")]=q(n[s("weapon",c,"weaponspeed")])),d(n[s("weapon",c,"cost")])&&(a[s("weapon",c,"weapon_cost")]=O(n[s("weapon",c,"cost")])),d(n[s("weapon",c,"weaponnotes")])&&(a[s("weapon",c,"weapon_notes")]=n[s("weapon",c,"weaponnotes")])}),a.sheet_version=r,g("VERSION UPDATE: weaponNameFix completed"),setAttrs(a,{silent:!0},y(r,o))})})},Mt=(r,o)=>{getSectionIDs("repeating_spells",e=>{let i=[];_.each(e,n=>{i.push(s("spells",n,"roll")),i.push(s("spells",n,"memorized")),i.push(s("spells",n,"level")),i.push(s("spells",n,"name")),i.push(s("spells",n,"school")),i.push(s("spells",n,"range")),i.push(s("spells",n,"duration")),i.push(s("spells",n,"aoe")),i.push(s("spells",n,"components")),i.push(s("spells",n,"ct")),i.push(s("spells",n,"save")),i.push(s("spells",n,"macro-text")),i.push(s("spells",n,"description")),i.push(s("spells",n,"description-show"))}),getAttrs([...i],n=>{let a={},t={"@{memorized}":"@{spell_memorized}","@{level}":"@{spell_level}","@{name}":"@{spell_name}","@{school}":"@{spell_school}","@{range}":"@{spell_range}","@{duration}":"@{spell_duration}","@{aoe}":"@{spell_aoe}","@{components}":"@{spell_components}","@{ct}":"@{spell_ct}","@{save}":"@{spell_save}","@{macro-text}":"@{spell_macro_text}","@{description}":"@{spell_description}"},p="&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Casts: @{name}}} {{Level:=@{level}}} {{Range:=@{range}}} {{Duration:=@{duration}}} {{AOE:=@{aoe}}} {{Comp:=@{components}}} {{CT:=@{ct}}} {{Save:=@{save}}} {{freetext=@{description}}}";_.each(e,c=>{d(n[s("spells",c,"roll")])&&(a[s("spells",c,"spell_roll")]=n[s("spells",c,"roll")]),d(n[s("spells",c,"memorized")])&&(a[s("spells",c,"spell_memorized")]=q(n[s("spells",c,"memorized")])),d(n[s("spells",c,"level")])&&(a[s("spells",c,"spell_level")]=n[s("spells",c,"level")]),d(n[s("spells",c,"name")])&&(a[s("spells",c,"spell_name")]=n[s("spells",c,"name")]),d(n[s("spells",c,"school")])&&(a[s("spells",c,"spell_school")]=n[s("spells",c,"school")]),d(n[s("spells",c,"range")])&&(a[s("spells",c,"spell_range")]=n[s("spells",c,"range")]),d(n[s("spells",c,"duration")])&&(a[s("spells",c,"spell_duration")]=n[s("spells",c,"duration")]),d(n[s("spells",c,"aoe")])&&(a[s("spells",c,"spell_aoe")]=n[s("spells",c,"aoe")]),d(n[s("spells",c,"components")])&&(a[s("spells",c,"spell_components")]=n[s("spells",c,"components")]),d(n[s("spells",c,"ct")])&&(a[s("spells",c,"spell_ct")]=n[s("spells",c,"ct")]),d(n[s("spells",c,"save")])&&(a[s("spells",c,"spell_save")]=n[s("spells",c,"save")]),d(n[s("spells",c,"macro-text")],p)&&(a[s("spells",c,"spell_macro_text")]=xe(n[s("spells",c,"macro-text")],t)),d(n[s("spells",c,"description")])&&(a[s("spells",c,"spell_description")]=n[s("spells",c,"description")]),d(n[s("spells",c,"description-show")])&&(a[s("spells",c,"spell_description_show")]=q(n[s("spells",c,"description-show")]))}),a.sheet_version=r,g("VERSION UPDATE: spellNameFix completed"),setAttrs(a,{silent:!0},y(r,o))})})},Dt=(r,o)=>{getSectionIDs("repeating_equipment",e=>{let i=[];_.each(e,n=>{i.push(s("equipment",n,"item-show")),i.push(s("equipment",n,"item")),i.push(s("equipment",n,"location")),i.push(s("equipment",n,"carried")),i.push(s("equipment",n,"quantity")),i.push(s("equipment",n,"quantity_max")),i.push(s("equipment",n,"weight")),i.push(s("equipment",n,"cos"))}),getAttrs([...i],n=>{let a={};_.each(e,t=>{d(n[s("equipment",t,"item-show")])&&(a[s("equipment",t,"equipment_item_show")]=n[s("equipment",t,"item-show")]),d(n[s("equipment",t,"item")])&&(a[s("equipment",t,"equipment_item")]=n[s("equipment",t,"item")]),d(n[s("equipment",t,"location")])&&(a[s("equipment",t,"equipment_location")]=n[s("equipment",t,"location")]),d(n[s("equipment",t,"carried")])&&(a[s("equipment",t,"equipment_carried")]=n[s("equipment",t,"carried")]),d(n[s("equipment",t,"quantity")])&&(a[s("equipment",t,"equipment_quantity")]=O(n[s("equipment",t,"quantity")])),d(n[s("equipment",t,"quantity_max")])&&(a[s("equipment",t,"equipment_quantity_max")]=O(n[s("equipment",t,"quantity_max")])),d(n[s("equipment",t,"weight")])&&(a[s("equipment",t,"equipment_weight")]=O(n[s("equipment",t,"weight")])),d(n[s("equipment",t,"cost")])&&(a[s("equipment",t,"equipment_cost")]=O(n[s("equipment",t,"cost")]))}),a.sheet_version=r,g("VERSION UPDATE: equipmentNameFix completed"),setAttrs(a,{silent:!0},y(r,o))})})},Et=(r,o)=>{getSectionIDs("repeating_ability",e=>{let i=[];_.each(e,n=>{i.push(s("equipment",n,"roll")),i.push(s("equipment",n,"name")),i.push(s("equipment",n,"short_description")),i.push(s("equipment",n,"current")),i.push(s("equipment",n,"current_max")),i.push(s("equipment",n,"macro-text")),i.push(s("equipment",n,"description")),i.push(s("equipment",n,"description-show"))}),getAttrs([...i],n=>{let a={},t={"@{name}":"@{ability_name}","@{current}":"@{ability_current}","@{current_max}":"@{ability_current_max}","@{short_description}":"@{ability_short_description}","@{macro-text}":"@{ability_macro_text}","@{description}":"@{ability_description}"},p="&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{name}}} {{freetext=@{short_description} @{description}}}";_.each(e,c=>{d(n[s("equipment",c,"roll")])&&(a[s("equipment",c,"ability_roll")]=n[s("equipment",c,"roll")]),d(n[s("equipment",c,"name")])&&(a[s("equipment",c,"ability_name")]=n[s("equipment",c,"name")]),d(n[s("equipment",c,"short_description")])&&(a[s("equipment",c,"ability_short_description")]=n[s("equipment",c,"short_description")]),d(n[s("equipment",c,"current")])&&(a[s("equipment",c,"ability_current")]=q(n[s("equipment",c,"current")])),d(n[s("equipment",c,"current_max")])&&(a[s("equipment",c,"ability_current_max")]=q(n[s("equipment",c,"current_max")])),d(n[s("equipment",c,"macro-text")],p)&&(a[s("equipment",c,"ability_macro_text")]=xe(n[s("equipment",c,"macro-text")],t)),d(n[s("equipment",c,"description")])&&(a[s("equipment",c,"ability_description")]=n[s("equipment",c,"description")]),d(n[s("equipment",c,"description-show")])&&(a[s("equipment",c,"ability_description_show")]=q(n[s("equipment",c,"description-show")]))}),a.sheet_version=r,g("VERSION UPDATE: abilityNameFix completed"),setAttrs(a,{silent:!0},y(r,o))})})},Ct=(r,o)=>{getSectionIDs("repeating_nonweaponproficiencies",e=>{let i=[];_.each(e,n=>{i.push(s("nonweaponproficiencies",n,"roll")),i.push(s("nonweaponproficiencies",n,"name")),i.push(s("nonweaponproficiencies",n,"rAttribute")),i.push(s("nonweaponproficiencies",n,"short_description")),i.push(s("nonweaponproficiencies",n,"rSlots")),i.push(s("nonweaponproficiencies",n,"rModifier")),i.push(s("nonweaponproficiencies",n,"macro-text")),i.push(s("nonweaponproficiencies",n,"description-show")),i.push(s("nonweaponproficiencies",n,"description"))}),getAttrs([...i],n=>{let a={},t={"@{name}":"@{nwp_name}","@{rAttribute}":"@{nwp_attribute}","@{rSlots}":"@{nwp_slots}","@{rModifier}":"@{nwp_modifier}","@{short_description}":"@{nwp_short_description}","@{macro-text}":"@{nwp_macro_text}","@{description}":"@{nwp_description}"},p="&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{name}}} {{Proficiency Check=[[ 1d20 + [[@{rmodifier}]][MOD] + [[?{Additional modifier?|0}]][MOD] ]] vs [[ @{rAttribute}[ATTR] ]]}}{{freetext=@{short_description}}}";_.each(e,c=>{d(n[s("nonweaponproficiencies",c,"roll")])&&(a[s("nonweaponproficiencies",c,"nwp_roll")]=n[s("nonweaponproficiencies",c,"roll")]),d(n[s("nonweaponproficiencies",c,"name")])&&(a[s("nonweaponproficiencies",c,"nwp_name")]=n[s("nonweaponproficiencies",c,"name")]),d(n[s("nonweaponproficiencies",c,"rAttribute")])&&(a[s("nonweaponproficiencies",c,"nwp_attribute")]=n[s("nonweaponproficiencies",c,"rAttribute")].toLowerCase()),d(n[s("nonweaponproficiencies",c,"short_description")])&&(a[s("nonweaponproficiencies",c,"nwp_short_description")]=n[s("nonweaponproficiencies",c,"short_description")]),d(n[s("nonweaponproficiencies",c,"rSlots")])&&(a[s("nonweaponproficiencies",c,"nwp_slots")]=q(n[s("nonweaponproficiencies",c,"rSlots")])),d(n[s("nonweaponproficiencies",c,"rModifier")])&&(a[s("nonweaponproficiencies",c,"nwp_modifier")]=q(n[s("nonweaponproficiencies",c,"rModifier")])),d(n[s("nonweaponproficiencies",c,"macro-text")],p)&&(a[s("nonweaponproficiencies",c,"nwp_macro_text")]=xe(n[s("nonweaponproficiencies",c,"macro-text")],t)),d(n[s("nonweaponproficiencies",c,"description-show")])&&(a[s("nonweaponproficiencies",c,"nwp_description_show")]=q(n[s("nonweaponproficiencies",c,"description-show")])),d(n[s("nonweaponproficiencies",c,"description")])&&(a[s("nonweaponproficiencies",c,"nwp_description")]=n[s("nonweaponproficiencies",c,"description")])}),a.sheet_version=r,g("VERSION UPDATE: nwpNameFix completed"),setAttrs(a,{silent:!0},y(r,o))})})},It=(r,o)=>{let e={};getSectionIDs("repeating_nonweaponproficiencies",i=>{getSectionIDs("repeating_weapon",n=>{getSectionIDs("repeating_ability",a=>{getSectionIDs("repeating_spells",t=>{let p=[],c=[],l=[],u=[];_.each(i,h=>{p.push(s("nonweaponproficiencies",h,"nwp_macro_text"))}),_.each(n,h=>{c.push(s("weapon",h,"weapon_macro_text"))}),_.each(a,h=>{l.push(s("ability",h,"ability_macro_text"))}),_.each(t,h=>{u.push(s("spells",h,"spell_macro_text"))}),getAttrs([...p,...c,...l,...u],h=>{let m={nwp_old:"&{template:general} {{name=@{character_name}}}",nwp_new:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}}",wpn_old:"&{template:attacks} {{name=@{character_name}}}",wpn_new:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}}",abl_old:"&{template:general} {{name=@{character_name}}}",abl_new:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}}",spl_old:"&{template:general} {{name=@{character_name}}}",spl_new:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}}"};_.each(i,w=>{h[s("nonweaponproficiencies",w,"nwp_macro_text")]&&(e[s("nonweaponproficiencies",w,"nwp_macro_text")]=h[s("nonweaponproficiencies",w,"nwp_macro_text")].replace(m.nwp_old,m.nwp_new),g("VERSION UPDATE: colorUpdate completed"))}),_.each(n,w=>{h[s("weapon",w,"weapon_macro_text")]&&(e[s("weapon",w,"weapon_macro_text")]=h[s("weapon",w,"weapon_macro_text")].replace(m.wpn_old,m.wpn_new),g("VERSION UPDATE: colorUpdate completed"))}),_.each(a,w=>{h[s("ability",w,"ability_macro_text")]&&(e[s("ability",w,"ability_macro_text")]=h[s("ability",w,"ability_macro_text")].replace(m.abl_old,m.abl_new),g("VERSION UPDATE: colorUpdate completed"))}),_.each(t,w=>{h[s("spells",w,"spell_macro_text")]&&(e[s("spells",w,"spell_macro_text")]=h[s("spells",w,"spell_macro_text")].replace(m.spl_old,m.spl_new),g("VERSION UPDATE: colorUpdate completed"))}),e.sheet_version=r,setAttrs(e,{silent:!0},y(r,o))})})})})})},Fa=()=>{la(),aa(),wa(),Ze(),Qe(),Ye()};La=(r,o)=>{let e={};Fa(),e.sheet_version=r,g("VERSION UPDATE: autoCalcAbilityRows completed"),setAttrs(e,y(r,o))};Ba=(r,o)=>{let e={};sa(1),ia(1),pa(1),_a(1),ca(1),e.sheet_version=r,g("VERSION UPDATE: autoCalcSaveRows(migrate) completed"),setAttrs(e,{silent:!0},y(r,o))};ja=(r,o)=>{let e={};na(1),oa(1),Je(1),ta(1),ea(1),ve(1),Xe(1),ra(1),ga(),ha(),ua(),e.sheet_version=r,g("VERSION UPDATE: autoCalcThiefRows(migrate) completed"),setAttrs(e,{silent:!0},y(r,o))};var Nt=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"weapon_macro_text"))}),getAttrs([...i],n=>{let a={},t="&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{attack1=[[1d20 + @{weapon_tohitbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{To Hit Modifier?|0}[MOD] ]]}} {{damage1vsSM=[[@{weapon_damagesmallmedium} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{damage1vsL=[[@{weapon_damagelarge} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{WeaponNotes=@{weapon_notes}}} @{weapon_whisper_to_hit}";_.each(e,p=>{let c=n[s("weapon",p,"weapon_macro_text")]||t;a[s("weapon",p,"weapon_macro_text")]=c.replace(/} @{weapon_whisper_to_hit}/g,"}")}),a.sheet_version=r,g("VERSION UPDATE: removeWhisper completed"),setAttrs(a,{silent:!0},y(r,o))})})},Ot=(r,o)=>{getAttrs(["hitpoints_max","hitpoints_1_class","hitpoints_2_class","hitpoints_3_class"],e=>{let i={},n=+e.hitpoints_max||0,a=+e.hitpoints_1_class||0,t=+e.hitpoints_2_class||0,p=+e.hitpoints_3_class||0;q(Math.max(0,a)+Math.max(0,t)+Math.max(0,p))===0&&n>0&&(i.hitpoints_1_class=n),i.sheet_version=r,g("VERSION UPDATE: migrate HP completed"),setAttrs(i,{silent:!0},y(r,o),Ke())})},Tt=(r,o)=>{getAttrs(["armorclass","armortype_ac","armorclass_total","armorbonus","armorshield"],e=>{let i={},a=+e.armorclass||0,t=-Math.abs(e.armorbonus)||0,p=+e.armorclass_total||0,c=+e.armortype_ac||0,l=e.armorshield;g(`armorShield:${l} armorClassTotal:${p} armorBonus:${t} armortypeAC:${c} armorClass:${a}`),l?c===10&&a<10&&(a+=1,i.armortype_ac=a,i.armortype_base=a,i.armortype_worn=1,i.armortype_carried=1,i.armorshield_ac=-1,i.armorshield_base=-1,i.armorshield_worn=1,i.armorshield_carried=1,g("new armor w/shield")):c===10&&a<10?(i.armortype_ac=a,i.armortype_base=a,i.armortype_worn=1,i.armortype_carried=1,g("new armor w/out shield")):g("NEW ARMOR CHECK AND SET FAILED"),i.sheet_version=r,g("VERSION UPDATE: Migrate AC completed"),setAttrs(i,{silent:!0},y(r,o),V(0))})},je=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"weapon_macro_text"))}),getAttrs([...i],n=>{let a={},t={weapon_old:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{attack1=[[1d20 + @{weapon_tohitbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{To Hit Modifier?|0}[MOD] ]]}} {{damage1vsSM=[[@{weapon_damagesmallmedium} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{damage1vsL=[[@{weapon_damagelarge} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{WeaponNotes=@{weapon_notes}}}",weapon_old_v2:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{attack1=[[1d20 + @{weapon_tohitbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{To Hit Modifier?|0}[MOD]) ]]}} {{damage1vsSM=[[@{weapon_damagesmallmedium} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{damage1vsL=[[@{weapon_damagelarge} + @{weapon_attackdmgbonus}[BON] + @{weapon_magicbonus}[MAG] + ?{Damage Modifier?|0}[MOD] ]]}} {{WeaponNotes=@{weapon_notes}}}",weapon_old_v3:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + @{weapon_backstab_bonus}[BACKSTAB] + @{weapon_tohitbonus}[HIT_BON] + @{weapon_prof_pen}[PROF_PEN] + @{weapon_dual_pen}[DUAL_PEN]+ @{weapon_magicbonus}[MAG_BON] + ?{To Hit Modifier?|0}[MISC_MOD] ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} @{weapon_tohitacadj}",weapon_old_v4:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + @{weapon_backstab_bonus}[BACKSTAB] + @{weapon_tohitbonus}[HIT_BON] + @{weapon_prof_pen}[PROF_PEN] + @{weapon_dual_pen}[DUAL_PEN]+ @{weapon_magicbonus}[MAG_BON] + ?{To Hit Modifier?|0}[MISC_MOD] ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{critdamagevsSMchatmenu=@{weapon_critdamagesmallmedium_chat_menu}}} {{critdamagevsLchatmenu=@{weapon_critdamagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} {{crit=@{toggle_critdamage}}} @{weapon_tohitacadj}",weapon_old_v5:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + @{weapon_backstab_bonus}[BACKSTAB] + @{weapon_tohitbonus}[HIT_BON] + @{weapon_prof_pen}[PROF_PEN] + @{weapon_dual_pen}[DUAL_PEN]+ @{weapon_magicbonus}[MAG_BON] + ?{To Hit Modifier?|0}[MISC_MOD] ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{critdamagevsSMchatmenu=@{weapon_critdamagesmallmedium_chat_menu}}} {{critdamagevsLchatmenu=@{weapon_critdamagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} {{ammo=[[ @{weapon_ammo} ]]/[[ @{weapon_ammo|max} ]]}} {{crit=@{toggle_critdamage}}} @{weapon_tohitacadj}",weapon_old_v6:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + @{weapon_backstab_bonus}[BACKSTAB] + @{weapon_tohitbonus}[HIT_BON] + @{weapon_prof_pen}[PROF_PEN] + @{weapon_dual_pen}[DUAL_PEN]+ @{weapon_magicbonus}[MAG_BON] + ?{To Hit Modifier?|0}[MISC_MOD] ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{critdamagevsSMchatmenu=@{weapon_critdamagesmallmedium_chat_menu}}} {{critdamagevsLchatmenu=@{weapon_critdamagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} {{ammo=[[ @{weapon_ammo} ]]/[[ @{weapon_ammo|max} ]]}} {{crit=[[ @{toggle_critdamage} ]]}} @{weapon_tohitacadj}",weapon_current:"&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + ( @{weapon_backstab_bonus}[BACKSTAB] ) + ( @{weapon_tohitbonus}[HIT_BON] ) + ( @{weapon_prof_pen}[PROF_PEN] ) + ( @{weapon_dual_pen}[DUAL_PEN] ) + ( @{weapon_magicbonus}[MAG_BON] ) + ( ?{To Hit Modifier?|0}[MISC_MOD] ) ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{critdamagevsSMchatmenu=@{weapon_critdamagesmallmedium_chat_menu}}} {{critdamagevsLchatmenu=@{weapon_critdamagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} {{ammo=[[ @{weapon_ammo} ]]/[[ @{weapon_ammo|max} ]]}} {{crit=[[ @{toggle_critdamage} ]]}} @{weapon_tohitacadj}"};_.each(e,p=>{n[s("weapon",p,"weapon_macro_text")]===t.weapon_old_v6?a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old_v6,t.weapon_current):n[s("weapon",p,"weapon_macro_text")]===t.weapon_old_v5?a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old_v5,t.weapon_current):n[s("weapon",p,"weapon_macro_text")]===t.weapon_old_v4?a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old_v4,t.weapon_current):n[s("weapon",p,"weapon_macro_text")]===t.weapon_old_v3?a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old_v3,t.weapon_current):n[s("weapon",p,"weapon_macro_text")]===t.weapon_old_v2?a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old_v2,t.weapon_current):n[s("weapon",p,"weapon_macro_text")]===t.weapon_old&&(a[s("weapon",p,"weapon_macro_text")]=n[s("weapon",p,"weapon_macro_text")].replace(t.weapon_old,t.weapon_current))}),a.sheet_version=r,g("VERSION UPDATE: weaponMacroUpdate completed"),setAttrs(a,{silent:!0},y(r,o))})})},Ra=(r,o)=>{getSectionIDs("repeating_ability",e=>{let i=[];_.each(e,n=>{i.push(s("ability",n,"ability_macro_text"))}),getAttrs([...i],n=>{let a={},t={ability_old:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{freetext=@{ability_short_description} @{ability_description}}}",ability_old_v2:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{roll= [[ @{ability_die} + @{ability_mod}[MOD] ]]}} {{freetext=@{ability_short_description} @{ability_description}}} {{uses=@{ability_current}}} {{uses_max=@{ability_current|max}}}",ability_old_v3:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{roll= [[ @{ability_die} + @{ability_mod}[MOD] ]]}} {{freetext=@{ability_short_description} @{ability_description}}} {{uses=@{ability_current}}} {{uses_max=[[ @{ability_current|max} ]]}} {{effect_type=@{ability_effect_type}}} {{spell_level=@{ability_level}}} {{casting_time=@{ability_ct}}} {{range=@{ability_range}}} {{saving_throw=@{ability_save}}} {{area_of_effect=@{ability_aoe}}} {{save_type=@{ability_save_type}}}",ability_old_v4:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{roll= [[ @{ability_die} + @{ability_mod}[MOD] ]]}} {{freetext=@{ability_short_description} @{ability_description}}} {{uses=@{ability_current}}} {{uses_max=[[ @{ability_current|max} ]]}} {{effect_type=@{ability_effect_type}}} {{spell_level=@{ability_level}}} {{casting_time=@{ability_ct}}} {{range=@{ability_range}}} {{duration=@{ability_duration}}} {{saving_throw=@{ability_save}}} {{area_of_effect=@{ability_aoe}}} {{save_type=@{ability_save_type}}}",ability_old_v5:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{roll= [[ @{ability_die} + @{ability_mod}[MOD] ]]}} {{link=@{ability_link}}} {{freetext=@{ability_short_description} @{ability_description}}} {{uses=@{ability_current}}} {{uses_max=[[@{ability_current|max}]]}} {{effect_type=@{ability_effect_type}}} {{spell_level=@{ability_level}}} {{casting_time=@{ability_ct}}} {{range=@{ability_range}}} {{duration=@{ability_duration}}} {{saving_throw=@{ability_save}}} {{area_of_effect=@{ability_aoe}}} {{save_type=@{ability_save_type}}}",ability_current:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Special Ability: @{ability_name}}} {{roll= [[ 0 + @{ability_die} + @{ability_mod}[MOD] ]]}} {{link=@{ability_link}}} {{freetext=@{ability_short_description} @{ability_description}}} {{uses=@{ability_current}}} {{uses_max=[[ 0 + @{ability_current|max} ]]}} {{effect_type=@{ability_effect_type}}} {{spell_level=@{ability_level}}} {{casting_time=@{ability_ct}}} {{range=@{ability_range}}} {{duration=@{ability_duration}}} {{saving_throw=@{ability_save}}} {{area_of_effect=@{ability_aoe}}} {{save_type=@{ability_save_type}}}"};_.each(e,p=>{n[s("ability",p,"ability_macro_text")]===t.ability_old_v5&&(a[s("ability",p,"ability_macro_text")]=n[s("ability",p,"ability_macro_text")].replace(t.ability_old_v5,t.ability_current)),n[s("ability",p,"ability_macro_text")]===t.ability_old_v4&&(a[s("ability",p,"ability_macro_text")]=n[s("ability",p,"ability_macro_text")].replace(t.ability_old_v4,t.ability_current)),n[s("ability",p,"ability_macro_text")]===t.ability_old_v3&&(a[s("ability",p,"ability_macro_text")]=n[s("ability",p,"ability_macro_text")].replace(t.ability_old_v3,t.ability_current)),n[s("ability",p,"ability_macro_text")]===t.ability_old_v2&&(a[s("ability",p,"ability_macro_text")]=n[s("ability",p,"ability_macro_text")].replace(t.ability_old_v2,t.ability_current)),n[s("ability",p,"ability_macro_text")]===t.ability_old&&(a[s("ability",p,"ability_macro_text")]=n[s("ability",p,"ability_macro_text")].replace(t.ability_old,t.ability_current))}),a.sheet_version=r,g("VERSION UPDATE: abilityMacroUpdate completed"),setAttrs(a,{silent:!0},y(r,o))})})},Rt=(r,o)=>{getSectionIDs("repeating_nonweaponproficiencies",e=>{let i=[];_.each(e,n=>{i.push(s("nonweaponproficiencies",n,"nwp_macro_text"))}),getAttrs([...i],n=>{let a={},t={nwp_old:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{nwp_name}}} {{Proficiency Check=[[ 1d20 + [[@{nwp_modifier}]][MOD] + [[?{Additional modifier?|0}]][MOD] ]] vs [[ @{nwp_attribute}[ATTR] ]]}}{{freetext=@{nwp_short_description}}}",nwp_old_v2:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{nwp_name}}} {{roll_low=[[ 1d20 + [[ @{nwp_modifier} ]][MOD] + [[ ?{Modifier?|0} ]][MOD] ]]}} {{roll_target=[[ @{nwp_attribute}[ATTR] ]]}} {{mod_applied=[[ ?{Modifier?|0} ]]}} {{NWP Mod Applied=[[ @{nwp_modifier} ]]}} {{freetext=@{nwp_short_description}}}",nwp_current:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Non Weapon Proficiency: @{nwp_name}}} {{roll_low=[[ 1d20 + [[ @{nwp_modifier} ]][MOD] + [[ ?{Modifier?|0} ]][MOD] ]]}} {{roll_target=[[ @{nwp_attribute}[ATTR] ]]}} {{mod_applied=[[ ?{Modifier?|0} ]]}} {{nwp_mod_applied=[[ @{nwp_modifier} ]]}} {{link=@{nwp_link}}} {{freetext=@{nwp_short_description} @{nwp_description}}}"};_.each(e,p=>{n[s("nonweaponproficiencies",p,"nwp_macro_text")]===t.nwp_old_2&&(a[s("nonweaponproficiencies",p,"nwp_macro_text")]=n[s("nonweaponproficiencies",p,"nwp_macro_text")].replace(t.nwp_old_2,t.nwp_current)),n[s("nonweaponproficiencies",p,"nwp_macro_text")]===t.nwp_old&&(a[s("nonweaponproficiencies",p,"nwp_macro_text")]=n[s("nonweaponproficiencies",p,"nwp_macro_text")].replace(t.nwp_old,t.nwp_current))}),a.sheet_version=r,g("VERSION UPDATE: nwpMacroUpdate2 completed"),setAttrs(a,{silent:!0},y(r,o))})})},Lt=(r,o)=>{getSectionIDs("repeating_spells",e=>{let i=[];_.each(e,n=>{i.push(s("spells",n,"spell_macro_text"))}),getAttrs([...i],n=>{let a={},t={spell_old:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Casts: @{spell_name}}} {{Level:=@{spell_level}}} {{Range:=@{spell_range}}} {{Duration:=@{spell_duration}}} {{AOE:=@{spell_aoe}}} {{Comp:=@{spell_components}}} {{CT:=@{spell_ct}}} {{Save:=@{spell_save}}} {{freetext=@{spell_description}}}",spell_old_v2:"&{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Casts: @{spell_name}}} {{Range:=@{spell_range}}} {{Duration:=@{spell_duration}}} {{AOE:=@{spell_aoe}}} {{Save:=@{spell_save}}}",spell_old_v3:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Casts: @{spell_name}}} {{school=@{spell_school}}} {{spell_level=@{spell_level}}} {{range=@{spell_range}}} {{duration=@{spell_duration}}} {{area_of_effect=@{spell_aoe}}} {{components=@{spell_components}}} {{casting_time=@{spell_ct}}} {{saving_throw=@{spell_save}}} {{freetext=@{spell_description}}}",spell_current:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Casts: @{spell_name}}} {{school=@{spell_school}}} {{spell_level=@{spell_level}}} {{spell_class=@{spell_caster_class_name}}} {{spell_class_level=@{spell_caster_class_level}}} {{range=@{spell_range}}} {{duration=@{spell_duration}}} {{area_of_effect=@{spell_aoe}}} {{components=@{spell_components}}} {{casting_time=@{spell_ct}}} {{saving_throw=@{spell_save}}} {{save_type=@{spell_save_type}}} {{link=@{spell_link}}} {{freetext=@{spell_description}}}"};_.each(e,p=>{n[s("spells",p,"spell_macro_text")]===t.spell_old_v3&&(a[s("spells",p,"spell_macro_text")]=n[s("spells",p,"spell_macro_text")].replace(t.spell_old_v3,t.spell_current)),n[s("spells",p,"spell_macro_text")]===t.spell_old_v2&&(a[s("spells",p,"spell_macro_text")]=n[s("spells",p,"spell_macro_text")].replace(t.spell_old_v2,t.spell_current)),n[s("spells",p,"spell_macro_text")]===t.spell_old&&(a[s("spells",p,"spell_macro_text")]=n[s("spells",p,"spell_macro_text")].replace(t.spell_old,t.spell_current))}),a.sheet_version=r,g("VERSION UPDATE: spellsMacroUpdate completed"),setAttrs(a,{silent:!0},y(r,o))})})},Bt=(r,o)=>{getSectionIDs("repeating_equipment",e=>{let i=[];_.each(e,n=>{i.push(s("equipment",n,"equipment_macro_text"))}),getAttrs([...i],n=>{let a={},t={equipment_old:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Item/Equipment: @{equipment_item}}} {{freetext=@{equipment_description}}} {{quantity= @{equipment_quantity}}} {{quantity_max=@{equipment_quantity|max}}} {{uses=@{equipment_current}}} {{uses_max=[[ @{equipment_current|max} ]]}}",equipment_current:"@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Item/Equipment: @{equipment_item}}} {{link=@{equipment_link}}} {{freetext=@{equipment_description}}} {{quantity=@{equipment_quantity}}} {{quantity_max=@{equipment_quantity|max}}} {{uses=@{equipment_current}}} {{uses_max=[[ @{equipment_current|max} ]]}}"};_.each(e,p=>{n[s("equipment",p,"equipment_macro_text")]===t.equipment_old&&(a[s("equipment",p,"equipment_macro_text")]=n[s("equipment",p,"equipment_macro_text")].replace(t.equipment_old,t.equipment_current))}),a.sheet_version=r,g("VERSION UPDATE: equipmentMacroUpdate completed"),setAttrs(a,{silent:!0},y(r,o))})})},jt=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i={},n=[];_.each(e,a=>{n.push(s("weapon",a,"weapon_range")),n.push(s("weapon",a,"weapon_range_short")),n.push(s("weapon",a,"weapon_range_medium")),n.push(s("weapon",a,"weapon_range_long")),n.push(s("weapon",a,"weapon_attack_type")),n.push(s("weapon",a,"weapon_range_error"))}),getAttrs(n,a=>{_.each(e,t=>{let p=+a[s("weapon",t,"weapon_attack_type")]||0;if(p===0||p===2)return;let c=a[s("weapon",t,"weapon_range")];c=c.replace(/'/g,""),c=c.replace(/"/g,"");let l=c.split("/").join(",").split(" ").join(",").split("-").join(",").split(","),u=Number(l[0]),h=Number(l[1]),m=Number(l[2]);l.length===1&&u>=0&&!h&&!m&&(h=u,m=u),Number.isNaN(u)?(i[s("weapon",t,"weapon_range_short")]=0,i[s("weapon",t,"weapon_range_error")]=c===""?1:0):i[s("weapon",t,"weapon_range_short")]=u,Number.isNaN(h)?(i[s("weapon",t,"weapon_range_medium")]=0,i[s("weapon",t,"weapon_range_error")]=c===""?1:0):i[s("weapon",t,"weapon_range_medium")]=h,Number.isNaN(m)?(i[s("weapon",t,"weapon_range_long")]=0,i[s("weapon",t,"weapon_range_error")]=c===""?1:0):i[s("weapon",t,"weapon_range_long")]=m,!Number.isNaN(u)&&!Number.isNaN(h)&&!Number.isNaN(m)&&(i[s("weapon",t,"weapon_range_error")]=1)}),i.sheet_version=r,g("VERSION UPDATE: updateRange completed"),setAttrs(i,{silent:!0},y(r,o))})})},Pt=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"weapon_macro_text"))}),getAttrs([...i],n=>{let a={},t="&{template:attacks} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=@{weapon_name}}} {{dual=@{weapon_dual}}} {{attack1=[[ 1d20 + @{weapon_backstab_bonus}[BACKSTAB] + @{weapon_tohitbonus}[HIT_BON] + @{weapon_prof_pen}[PROF_PEN] + @{weapon_dual_pen}[DUAL_PEN]+ @{weapon_magicbonus}[MAG_BON] + ?{To Hit Modifier?|0}[MISC_MOD] ]]}} {{damagevsSMchatmenu=@{weapon_damagesmallmedium_chat_menu}}} {{damagevsLchatmenu=@{weapon_damagelarge_chat_menu}}} {{WeaponNotes=@{weapon_notes}}} {{backstab=[[ @{weapon_backstab_mult} ]]}} {{damagetype=@{weapon_attackdmgtype}}} {{rate=@{weapon_rateoffire}}} {{range=@{weapon_range}}} {{length=@{weapon_length}}} {{space=@{weapon_space}}} {{speed=@{weapon_speed}}} @{weapon_tohitacadj}";_.each(e,p=>{let c=n[s("weapon",p,"weapon_macro_text")]||t;a[s("weapon",p,"weapon_macro_text")]=c.replace(/@{weapon_attack_type_pen}/g,"@{weapon_dual_pen}"),a[s("weapon",p,"weapon_macro_text")]=c.replace(/{{attacktype=@{weapon_attack_type}}} /g,"")}),a.sheet_version=r,g("VERSION UPDATE: updateAttackTypeMacro completed"),setAttrs(a,{silent:!0},y(r,o))})})},Ut=(r,o)=>{getAttrs(["hitdice","monsterHD"],e=>{let i={},n=e.monsterHD,a=e.hitdice;n===""&&(i.monsterHD=a),i.monsterHD=n,i.sheet_version=r,g("VERSION UPDATE: monsterHD completed"),setAttrs(i,{silent:!0},y(r,o))})},Ht=(r,o)=>{let e={};e.armorother_cost=0,e.armorother2_cost=0,e.armorother3_cost=0,e.armorother4_cost=0,e.armorother5_cost=0,e.armorother6_cost=0,e.armorother_weight=0,e.armorother2_weight=0,e.armorother3_weight=0,e.armorother4_weight=0,e.armorother5_weight=0,e.armorother6_weight=0,e.armorother_carried=0,e.armorother2_carried=0,e.armorother3_carried=0,e.armorother4_carried=0,e.armorother5_carried=0,e.armorother6_carried=0,e.armorother_bulk=0,e.armorother2_bulk=0,e.armorother3_bulk=0,e.armorother4_bulk=0,e.armorother5_bulk=0,e.armorother6_bulk=0,g("VERSION UPDATE: clearArmorOther completed"),setAttrs(e,{silent:!0},y(r,o))},Wt=ba.concat(De);function da(r,o,e,i){getAttrs(Wt,n=>{let a={},t="",p=r;p=p!==null?r.toLowerCase():p;let c=n.unarmored_row_id.toString(),l=n.armortype1_row_id.toString(),u=n.armortype2_row_id.toString(),h=n.armorshield_row_id.toString(),m=n.armorhelmet_row_id.toString(),w=n.armorother1_row_id.toString(),S=n.armorother2_row_id.toString(),b=n.armorother3_row_id.toString(),M=n.armorother4_row_id.toString(),f=n.armorother5_row_id.toString(),T=n.armorother6_row_id.toString(),$=[c,l,u,h,m,w,S,b,M,f,T].map(G=>G?G.toString().toLowerCase():"0"),L=["unarmored_worn","unarmored","unarmored_ac","unarmored_base","unarmored_bulk","unarmored_carried","unarmored_weight","unarmored_cost"],U=["armortype_worn","armortype","armortype_ac","armortype_base","armortype_magic","armortype_bulk","armortype_carried","armor_weight","armor_cost"],oe=["armortype2_worn","armortype2","armortype2_ac","armortype2_base","armortype2_magic","armortype2_bulk","armortype2_carried","armortype2_weight","armortype2_cost"],K=["armorshield_worn","armorshield","armorshield_ac","armorshield_base","armorshield_magic","armorshield_mod","armorshield_bulk","armorshield_carried","armorshield_weight","armorshield_cost"],me=["armorhelmet_worn","armorhelmet","armorhelmet_ac","armorhelmet_magic","armorhelmet_bulk","armorhelmet_carried","armorhelmet_weight","armorhelmet_cost"],ne=["armorother_worn","armorother","armorother_ac","armorother_base","armorother_magic","armorother_mod"],re=["armorother2_worn","armorother2","armorother2_ac","armorother2_base","armorother2_magic","armorother2_mod"],Y=["armorother3_worn","armorother3","armorother3_ac","armorother3_base","armorother3_magic","armorother3_mod"],Ee=["armorother4_worn","armorother4","armorother4_ac","armorother4_base","armorother4_magic","armorother4_mod"],X=["armorother5_worn","armorother5","armorother5_ac","armorother5_base","armorother5_magic","armorother5_mod"],Q=["armorother6_worn","armorother6","armorother6_ac","armorother6_base","armorother6_magic","armorother6_mod"];function Z(G){let se=Object.entries({unarmoredAttrs:L,armor1Attrs:U,armor2Attrs:oe,shieldAttrs:K,helmetAttrs:me,other1Attrs:ne,other2Attrs:re,other3Attrs:Y,other4Attrs:Ee,other5Attrs:X,other6Attrs:Q}).find(([Ne,fe])=>fe.includes(G));return se?se[0]:null}let x=Z(o),J=n.unarmored,Ce=n.armortype,le=n.armortype2,R=n.armorshield,he=n.armorhelmet,ue=n.armorother,ge=n.armorother2,we=n.armorother3,be=n.armorother4,de=n.armorother5,qe=n.armorother6;(x==="unarmoredAttrs"||p===$[0]||i)&&(x==="unarmoredAttrs"||i?J?c.length===20?(t=c.toLowerCase(),a.unarmored_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=0,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.unarmored_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.unarmored,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.unarmored_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.unarmored_base||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.unarmored_bulk||0,+n.unarmored_worn==1&&+n.unarmored_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.unarmored_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.unarmored_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.unarmored_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.unarmored_cost||0):(t=k(),a.unarmored_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=0,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.unarmored_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.unarmored,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.unarmored_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.unarmored_base||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.unarmored_bulk||0,+n.unarmored_worn==1&&+n.unarmored_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.unarmored_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.unarmored_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.unarmored_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.unarmored_cost||0):c===$[0]&&(a.unarmored_row_id=0,a.unarmored_worn=+n.unarmored_worn||0,a.unarmored="",a.unarmored_ac=+n.unarmored_ac||0,a.unarmored_base=+n.unarmored_base||0,a.unarmored_bulk=+n.unarmored_bulk||0,a.unarmored_weight=+n.unarmored_weight||0,a.unarmored_cost=+n.unarmored_cost||0,+n.unarmored_worn==1&&+n.unarmored_carried==0?a.unarmored_carried=1:a.unarmored_carried=+n.unarmored_carried||0):(a.unarmored_row_id=0,a.unarmored_worn=1,a.unarmored="",a.unarmored_ac=10,a.unarmored_base=10,a.unarmored_bulk=0,a.unarmored_weight=0,a.unarmored_cost=0,a.unarmored_carried=1)),(x==="armor1Attrs"||p===$[1]||i)&&(x==="armor1Attrs"||i?Ce?l.length===20?(t=l.toLowerCase(),a.armortype1_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=1,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armortype_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armortype,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armortype_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armortype_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armortype_magic||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armortype_bulk||0,+n.armortype_worn==1&&+n.armortype_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.armortype_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armortype_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armor_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armor_cost||0):(t=k(),a.armortype1_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=1,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armortype_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armortype,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armortype_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armortype_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armortype_magic||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armortype_bulk||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armortype_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armor_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armor_cost||0):l===$[1]&&(a.armortype1_row_id=0,a.armortype_worn=0,a.armortype="",a.armortype_ac=10,a.armortype_base=10,a.armortype_magic=0,a.armortype_bulk=0,a.armortype_weight=0,a.armortype_cost=0,a.armortype_carried=1):(a.armortype1_row_id=0,a.armortype_worn=0,a.armortype="",a.armortype_ac=10,a.armortype_base=10,a.armortype_magic=0,a.armortype_bulk=0,a.armortype_weight=0,a.armortype_cost=0,a.armortype_carried=1)),(x==="armor2Attrs"||p===$[2]||i)&&(x==="armor2Attrs"||i?le?u.length===20?(t=u.toLowerCase(),a.armortype2_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=2,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armortype2_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armortype2,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armortype2_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armortype2_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armortype2_magic||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armortype2_bulk||0,+n.armortype2_worn==1&&+n.armortype2_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.armortype2_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armortype2_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armortype2_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armortype2_cost||0):(t=k(),a.armortype2_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=2,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armortype2_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armortype2,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armortype2_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armortype2_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armortype2_magic||0,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armortype2_bulk||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armortype2_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armortype2_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armortype2_cost||0):u===$[2]&&(a.armortype2_row_id=0,a.armortype2_worn=0,a.armortype2="",a.armortype2_ac=10,a.armortype2_base=10,a.armortype2_magic=0,a.armortype2_bulk=0,a.armortype2_weight=0,a.armortype2_cost=0,a.armortype2_carried=1):(a.armortype2_row_id=0,a.armortype2_worn=0,a.armortype2="",a.armortype2_ac=10,a.armortype2_base=10,a.armortype2_magic=0,a.armortype2_bulk=0,a.armortype2_weight=0,a.armortype2_cost=0,a.armortype2_carried=1)),(x==="shieldAttrs"||p===$[3]||i)&&(x==="shieldAttrs"||i?R?h.length===20?(t=h.toLowerCase(),a.armorshield_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=3,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorshield_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorshield,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorshield_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorshield_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=n.armorshield_magic,a[`repeating_equipment_${t}_equipment_armor_mod`]=n.armorshield_mod,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armorshield_bulk||0,+n.armorshield_worn==1&&+n.armorshield_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.armorshield_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorshield_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armorshield_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armorshield_cost||0):(t=k(),a.armorshield_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=3,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorshield_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorshield,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorshield_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorshield_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=n.armorshield_magic,a[`repeating_equipment_${t}_equipment_armor_mod`]=n.armorshield_mod,a[`repeating_equipment_${t}_equipment_armor_bulk`]=+n.armorshield_bulk||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorshield_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armorshield_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armorshield_cost||0):h===$[3]&&(a.armorshield_row_id=0,a.armorshield_worn=0,a.armorshield="",a.armorshield_ac=0,a.armorshield_base=0,a.armorshield_magic=0,a.armorshield_mod=0,a.armorshield_bulk=0,a.armorshield_weight=0,a.armorshield_cost=0,a.armorshield_carried=1):(a.armorshield_row_id=0,a.armorshield_worn=0,a.armorshield="",a.armorshield_ac=0,a.armorshield_base=0,a.armorshield_magic=0,a.armorshield_mod=0,a.armorshield_bulk=0,a.armorshield_weight=0,a.armorshield_cost=0,a.armorshield_carried=1)),(x==="helmetAttrs"||p===$[4]||i)&&(x==="helmetAttrs"||i?he?m.length===20?(t=m.toLowerCase(),a.armorhelmet_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=4,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorhelmet_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorhelmet,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorhelmet_ac||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=n.armorhelmet_magic,+n.armorhelmet_worn==1&&+n.armorhelmet_carried==0?(a[`repeating_equipment_${t}_equipment_carried_select`]=1,a.armorhelmet_carried=1):a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorhelmet_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armorhelmet_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armorhelmet_cost||0):(t=k(),a.armorhelmet_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=4,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorhelmet_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorhelmet,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorhelmet_ac||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=n.armorhelmet_magic,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorhelmet_carried||0,a[`repeating_equipment_${t}_equipment_weight`]=+n.armorhelmet_weight||0,a[`repeating_equipment_${t}_equipment_cost`]=+n.armorhelmet_cost||0):m===$[4]&&(a.armorhelmet_row_id=0,a.armorhelmet_worn=0,a.armorhelmet="",a.armorhelmet_ac=10,a.armorhelmet_base=10,a.armorhelmet_magic=0,a.armorhelmet_bulk=0,a.armorhelmet_weight=0,a.armorhelmet_cost=0,a.armorhelmet_carried=1):(a.armorhelmet_row_id=0,a.armorhelmet_worn=0,a.armorhelmet="",a.armorhelmet_ac=10,a.armorhelmet_base=10,a.armorhelmet_magic=0,a.armorhelmet_bulk=0,a.armorhelmet_weight=0,a.armorhelmet_cost=0,a.armorhelmet_carried=1)),(x==="other1Attrs"||p===$[5]||i)&&(x==="other1Attrs"||i?ue?w.length===20?(t=w.toLowerCase(),a.armorother1_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=5,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother_worn==1?1:0):(t=k(),a.armorother1_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=5,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother_mod||0):w===$[5]&&(a.armorother1_row_id=0,a.armorother_worn=0,a.armorother="",a.armorother_ac=10,a.armorother_base=10,a.armorother_magic=0,a.armorother_mod=0,a.armorother_bulk=0):(a.armorother1_row_id=0,a.armorother_worn=0,a.armorother="",a.armorother_ac=10,a.armorother_base=10,a.armorother_magic=0,a.armorother_mod=0,a.armorother_bulk=0)),(x==="other2Attrs"||p===$[6]||i)&&(x==="other2Attrs"||i?ge?S.length===20?(t=S.toLowerCase(),a.armorother2_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=6,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother2_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother2,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother2_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother2_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother2_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother2_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother2_worn==1?1:0):(t=k(),a.armorother2_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=6,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother2_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother2,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother2_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother2_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother2_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother2_mod||0):S===$[6]&&(a.armorother2_row_id=0,a.armorother2_worn=0,a.armorother2="",a.armorother2_ac=0,a.armorother2_base=0,a.armorother2_magic=0,a.armorother2_mod=0,a.armorother2_bulk=0):(a.armorother2_row_id=0,a.armorother2_worn=0,a.armorother2="",a.armorother2_ac=0,a.armorother2_base=0,a.armorother2_magic=0,a.armorother2_mod=0,a.armorother2_bulk=0)),(x==="other3Attrs"||p===$[7]||i)&&(x==="other3Attrs"||i?we?b.length===20?(t=b.toLowerCase(),a.armorother3_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=7,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother3_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother3,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother3_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother3_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother3_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother3_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother3_worn==1?1:0):(t=k(),a.armorother3_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=7,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother3_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother3,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother3_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother3_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother3_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother3_mod||0):b===$[7]&&(a.armorother3_row_id=0,a.armorother3_worn=0,a.armorother3="",a.armorother3_ac=0,a.armorother3_base=0,a.armorother3_magic=0,a.armorother3_mod=0,a.armorother3_bulk=0):(a.armorother3_row_id=0,a.armorother3_worn=0,a.armorother3="",a.armorother3_ac=0,a.armorother3_base=0,a.armorother3_magic=0,a.armorother3_mod=0,a.armorother3_bulk=0)),(x==="other4Attrs"||p===$[8]||i)&&(x==="other4Attrs"||i?be?M.length===20?(t=M.toLowerCase(),a.armorother4_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=8,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother4_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother4,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother4_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother4_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother4_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother4_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother4_worn==1?1:0):(t=k(),a.armorother4_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=8,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother4_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother4,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother4_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother4_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother4_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother4_mod||0):M===$[8]&&(a.armorother4_row_id=0,a.armorother4_worn=0,a.armorother4="",a.armorother4_ac=0,a.armorother4_base=0,a.armorother4_magic=0,a.armorother4_mod=0,a.armorother4_bulk=0):(a.armorother4_row_id=0,a.armorother4_worn=0,a.armorother4="",a.armorother4_ac=0,a.armorother4_base=0,a.armorother4_magic=0,a.armorother4_mod=0,a.armorother4_bulk=0)),(x==="other5Attrs"||p===$[9]||i)&&(x==="other5Attrs"||i?de?f.length===20?(t=f.toLowerCase(),a.armorother5_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=9,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother5_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother5,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother5_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother5_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother5_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother5_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother5_worn==1?1:0):(t=k(),a.armorother5_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=9,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother5_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother5,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother5_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother5_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother5_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother5_mod||0):f===$[9]&&(a.armorother5_row_id=0,a.armorother5_worn=0,a.armorother5="",a.armorother5_ac=0,a.armorother5_base=0,a.armorother5_magic=0,a.armorother5_mod=0,a.armorother5_bulk=0):(a.armorother5_row_id=0,a.armorother5_worn=0,a.armorother5="",a.armorother5_ac=0,a.armorother5_base=0,a.armorother5_magic=0,a.armorother5_mod=0,a.armorother5_bulk=0)),(x==="other6Attrs"||p===$[10]||i)&&(x==="other6Attrs"||i?qe?T.length===20?(t=T.toLowerCase(),a.armorother6_row_id=t,a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=10,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother6_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother6,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother6_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother6_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother6_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother6_mod||0,a[`repeating_equipment_${t}_equipment_carried_select`]=+n.armorother6_worn==1?1:0):(t=k(),a.armorother6_row_id=t.toLowerCase(),a[`repeating_equipment_${t}_equipment_type`]=2,a[`repeating_equipment_${t}_equipment_armor_type`]=10,a[`repeating_equipment_${t}_equipment_armor_worn`]=+n.armorother6_worn||0,a[`repeating_equipment_${t}_equipment_item`]=n.armorother6,a[`repeating_equipment_${t}_equipment_armor_ac`]=+n.armorother6_ac||0,a[`repeating_equipment_${t}_equipment_armor_base`]=+n.armorother6_base||0,a[`repeating_equipment_${t}_equipment_armor_magic`]=+n.armorother6_magic||0,a[`repeating_equipment_${t}_equipment_armor_mod`]=+n.armorother6_mod||0):T===$[10]&&(a.armorother6_row_id=0,a.armorother6_worn=0,a.armorother6="",a.armorother6_ac=0,a.armorother6_base=0,a.armorother6_magic=0,a.armorother6_mod=0,a.armorother6_bulk=0):(a.armorother6_row_id=0,a.armorother6_worn=0,a.armorother6="",a.armorother6_ac=0,a.armorother6_base=0,a.armorother6_magic=0,a.armorother6_mod=0,a.armorother6_bulk=0)),setAttrs(a,Se(),V())})}var Vt=(r,o)=>{let e={};da(null,null,0,1),e.sheet_version=r,g("VERSION UPDATE: migrateArmorDetails completed"),setAttrs(e,{silent:!0},y(r,o))},Ft=(r,o)=>{getSectionIDs("repeating_equipment",e=>{let i={},n=[];_.each(e,a=>{n.push(s("equipment",a,"equipment_type")),n.push(s("equipment",a,"equipment_current")),n.push(s("equipment",a,"equipment_current_max")),n.push(s("equipment",a,"equipment_carried_select")),n.push(s("equipment",a,"equipment_carried")),n.push(s("equipment",a,"equipment_quantity")),n.push(s("equipment",a,"equipment_quantity_max")),n.push(s("equipment",a,"equipment_weight")),n.push(s("equipment",a,"equipment_cost")),n.push(s("equipment",a,"equipment_armor_type")),n.push(s("equipment",a,"equipment_armor_worn")),n.push(s("equipment",a,"equipment_armor_ac")),n.push(s("equipment",a,"equipment_armor_base")),n.push(s("equipment",a,"equipment_armor_magic")),n.push(s("equipment",a,"equipment_armor_mod")),n.push(s("equipment",a,"equipment_armor_bulk")),n.push(s("equipment",a,"equipment_macro_text"))}),getAttrs(n,a=>{_.each(e,t=>{i[s("equipment",t,"equipment_type")]=+a[s("equipment",t,"equipment_type")]||0,i[s("equipment",t,"equipment_current")]=+a[s("equipment",t,"equipment_current")]||0,i[s("equipment",t,"equipment_current_max")]=+a[s("equipment",t,"equipment_current_max")]||0,i[s("equipment",t,"equipment_carried_select")]=+a[s("equipment",t,"equipment_carried")]||0,i[s("equipment",t,"equipment_carried")]=+a[s("equipment",t,"equipment_carried")]||0,i[s("equipment",t,"equipment_quantity")]=+a[s("equipment",t,"equipment_quantity")]||0,i[s("equipment",t,"equipment_quantity_max")]=+a[s("equipment",t,"equipment_quantity_max")]||0,i[s("equipment",t,"equipment_weight")]=+a[s("equipment",t,"equipment_weight")]||0,i[s("equipment",t,"equipment_cost")]=+a[s("equipment",t,"equipment_cost")]||0,i[s("equipment",t,"equipment_armor_type")]=+a[s("equipment",t,"equipment_armor_type")]||0,i[s("equipment",t,"equipment_armor_worn")]=+a[s("equipment",t,"equipment_armor_worn")]||0,i[s("equipment",t,"equipment_armor_ac")]=+a[s("equipment",t,"equipment_armor_ac")]||0,i[s("equipment",t,"equipment_armor_base")]=+a[s("equipment",t,"equipment_armor_base")]||0,i[s("equipment",t,"equipment_armor_magic")]=+a[s("equipment",t,"equipment_armor_magic")]||0,i[s("equipment",t,"equipment_armor_mod")]=+a[s("equipment",t,"equipment_armor_mod")]||0,i[s("equipment",t,"equipment_armor_bulk")]=+a[s("equipment",t,"equipment_armor_bulk")]||0,i[s("equipment",t,"equipment_macro_text")]=a[s("equipment",t,"equipment_macro_text")]}),i.sheet_version=r,g("VERSION UPDATE: setEquipmentUpdate completed"),setAttrs(i,{silent:!0},y(r,o))})})},Gt=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i={},n=[];_.each(e,a=>{n.push(s("weapon",a,"weapon_attack_type")),n.push(s("weapon",a,"weapon_dual")),n.push(s("weapon",a,"weapon_whisper_to_hit")),n.push(s("weapon",a,"weapon_whisper_to_hit_select")),n.push(s("weapon",a,"weapon_dual_pen")),n.push(s("weapon",a,"weapon_backstab_var")),n.push(s("weapon",a,"weapon_tohitbonus")),n.push(s("weapon",a,"weapon_magicbonus")),n.push(s("weapon",a,"weapon_prof")),n.push(s("weapon",a,"weapon_backstab")),n.push(s("weapon",a,"weapon_backstab_bonus")),n.push(s("weapon",a,"weapon_backstab_mult")),n.push(s("weapon",a,"weapon_attackdmgbonus")),n.push(s("weapon",a,"weapon_num_attacks")),n.push(s("weapon",a,"weapon_quantity")),n.push(s("weapon",a,"weapon_ammo")),n.push(s("weapon",a,"weapon_ammo_max")),n.push(s("weapon",a,"weapon_weight")),n.push(s("weapon",a,"weapon_cost")),n.push(s("weapon",a,"weapon_range_short")),n.push(s("weapon",a,"weapon_range_medium")),n.push(s("weapon",a,"weapon_range_long")),n.push(s("weapon",a,"weapon_length")),n.push(s("weapon",a,"weapon_space")),n.push(s("weapon",a,"weapon_speed")),n.push(s("weapon",a,"weapon_misc")),n.push(s("weapon",a,"weapon_thac_adj0")),n.push(s("weapon",a,"weapon_thac_adj1")),n.push(s("weapon",a,"weapon_thac_adj2")),n.push(s("weapon",a,"weapon_thac_adj3")),n.push(s("weapon",a,"weapon_thac_adj4")),n.push(s("weapon",a,"weapon_thac_adj5")),n.push(s("weapon",a,"weapon_thac_adj6")),n.push(s("weapon",a,"weapon_thac_adj7")),n.push(s("weapon",a,"weapon_thac_adj8")),n.push(s("weapon",a,"weapon_thac_adj9")),n.push(s("weapon",a,"weapon_thac_adj10")),n.push(s("weapon",a,"weapon_macro_text")),n.push(s("weapon",a,"weapon_damagesmallmedium_chat_menu")),n.push(s("weapon",a,"weapon_damagelarge_chat_menu")),n.push(s("weapon",a,"weapon_damagesmallmedium_npc_chat_menu")),n.push(s("weapon",a,"weapon_damagelarge_npc_chat_menu")),n.push(s("weapon",a,"weapon_critdamagesmallmedium_chat_menu")),n.push(s("weapon",a,"weapon_critdamagelarge_chat_menu")),n.push(s("weapon",a,"weapon_critdamagesmallmedium_npc_chat_menu")),n.push(s("weapon",a,"weapon_critdamagelarge_npc_chat_menu")),n.push(s("weapon",a,"weapon_damage_chat_menu_npc"))}),getAttrs(n,a=>{_.each(e,t=>{i[`repeating_weapon_${t}_weapon_attack_type`]=+a[s("weapon",t,"weapon_attack_type")]||0,i[`repeating_weapon_${t}_weapon_dual`]=a[s("weapon",t,"weapon_dual")],i[`repeating_weapon_${t}_weapon_whisper_to_hit`]=a[s("weapon",t,"weapon_whisper_to_hit")],i[`repeating_weapon_${t}_weapon_whisper_to_hit_select`]=+a[s("weapon",t,"weapon_whisper_to_hit_select")]||0,i[`repeating_weapon_${t}_weapon_dual_pen`]=+a[s("weapon",t,"weapon_dual_pen")]||0,i[`repeating_weapon_${t}_weapon_backstab_var`]=+a[s("weapon",t,"weapon_backstab_var")]||0,i[`repeating_weapon_${t}_weapon_tohitbonus`]=+a[s("weapon",t,"weapon_tohitbonus")]||0,i[`repeating_weapon_${t}_weapon_magicbonus`]=+a[s("weapon",t,"weapon_magicbonus")]||0,i[`repeating_weapon_${t}_weapon_prof`]=+a[s("weapon",t,"weapon_prof")]||0,i[`repeating_weapon_${t}_weapon_backstab`]=+a[s("weapon",t,"weapon_backstab")]||0,i[`repeating_weapon_${t}_weapon_backstab_bonus`]=+a[s("weapon",t,"weapon_backstab_bonus")]||0,i[`repeating_weapon_${t}_weapon_backstab_mult`]=+a[s("weapon",t,"weapon_backstab_mult")]||0,i[`repeating_weapon_${t}_weapon_attackdmgbonus`]=+a[s("weapon",t,"weapon_attackdmgbonus")]||0,i[`repeating_weapon_${t}_weapon_num_attacks`]=+a[s("weapon",t,"weapon_num_attacks")]||0,i[`repeating_weapon_${t}_weapon_quantity`]=+a[s("weapon",t,"weapon_quantity")]||0,i[`repeating_weapon_${t}_weapon_ammo`]=+a[s("weapon",t,"weapon_ammo")]||0,i[`repeating_weapon_${t}_weapon_ammo_max`]=+a[s("weapon",t,"weapon_ammo_max")]||0,i[`repeating_weapon_${t}_weapon_weight`]=+a[s("weapon",t,"weapon_weight")]||0,i[`repeating_weapon_${t}_weapon_cost`]=+a[s("weapon",t,"weapon_cost")]||0,i[`repeating_weapon_${t}_weapon_range_short`]=+a[s("weapon",t,"weapon_range_short")]||0,i[`repeating_weapon_${t}_weapon_range_medium`]=+a[s("weapon",t,"weapon_range_medium")]||0,i[`repeating_weapon_${t}_weapon_range_long`]=+a[s("weapon",t,"weapon_range_long")]||0,i[`repeating_weapon_${t}_weapon_length`]=a[s("weapon",t,"weapon_length")],i[`repeating_weapon_${t}_weapon_space`]=a[s("weapon",t,"weapon_space")],i[`repeating_weapon_${t}_weapon_speed`]=a[s("weapon",t,"weapon_speed")],i[`repeating_weapon_${t}_weapon_misc`]=a[s("weapon",t,"weapon_misc")],i[`repeating_weapon_${t}_weapon_thac_adj0`]=+a[s("weapon",t,"weapon_thac_adj0")]||0,i[`repeating_weapon_${t}_weapon_thac_adj1`]=+a[s("weapon",t,"weapon_thac_adj1")]||0,i[`repeating_weapon_${t}_weapon_thac_adj2`]=+a[s("weapon",t,"weapon_thac_adj2")]||0,i[`repeating_weapon_${t}_weapon_thac_adj3`]=+a[s("weapon",t,"weapon_thac_adj3")]||0,i[`repeating_weapon_${t}_weapon_thac_adj4`]=+a[s("weapon",t,"weapon_thac_adj4")]||0,i[`repeating_weapon_${t}_weapon_thac_adj5`]=+a[s("weapon",t,"weapon_thac_adj5")]||0,i[`repeating_weapon_${t}_weapon_thac_adj6`]=+a[s("weapon",t,"weapon_thac_adj6")]||0,i[`repeating_weapon_${t}_weapon_thac_adj7`]=+a[s("weapon",t,"weapon_thac_adj7")]||0,i[`repeating_weapon_${t}_weapon_thac_adj8`]=+a[s("weapon",t,"weapon_thac_adj8")]||0,i[`repeating_weapon_${t}_weapon_thac_adj9`]=+a[s("weapon",t,"weapon_thac_adj9")]||0,i[`repeating_weapon_${t}_weapon_thac_adj10`]=+a[s("weapon",t,"weapon_thac_adj10")]||0,i[`repeating_weapon_${t}_weapon_macro_text`]=a[s("weapon",t,"weapon_macro_text")],i[`repeating_weapon_${t}_weapon_damagesmallmedium_chat_menu`]=a[s("weapon",t,"weapon_damagesmallmedium_chat_menu")],i[`repeating_weapon_${t}_weapon_damagelarge_chat_menu`]=a[s("weapon",t,"weapon_damagelarge_chat_menu")],i[`repeating_weapon_${t}_weapon_damagesmallmedium_npc_chat_menu`]=a[s("weapon",t,"weapon_damagesmallmedium_npc_chat_menu")],i[`repeating_weapon_${t}_weapon_damagelarge_npc_chat_menu`]=a[s("weapon",t,"weapon_damagelarge_npc_chat_menu")],i[`repeating_weapon_${t}_weapon_critdamagesmallmedium_chat_menu`]=a[s("weapon",t,"weapon_critdamagesmallmedium_chat_menu")],i[`repeating_weapon_${t}_weapon_critdamagelarge_chat_menu`]=a[s("weapon",t,"weapon_critdamagelarge_chat_menu")],i[`repeating_weapon_${t}_weapon_critdamagesmallmedium_npc_chat_menu`]=a[s("weapon",t,"weapon_critdamagesmallmedium_npc_chat_menu")],i[`repeating_weapon_${t}_weapon_critdamagelarge_npc_chat_menu`]=a[s("weapon",t,"weapon_critdamagelarge_npc_chat_menu")],i[`repeating_weapon_${t}_weapon_damage_chat_menu_npc`]=a[s("weapon",t,"weapon_damage_chat_menu_npc")]}),i.sheet_version=r,g("VERSION UPDATE: setWeaponsUpdate completed"),setAttrs(i,{silent:!0},y(r,o))})})},zt=(r,o)=>{getSectionIDs("nonweaponproficiencies",e=>{let i={},n=[];_.each(e,a=>{n.push(s("nonweaponproficiencies",a,"nwp_attribute")),n.push(s("nonweaponproficiencies",a,"nwp_slots")),n.push(s("nonweaponproficiencies",a,"nwp_modifier")),n.push(s("nonweaponproficiencies",a,"nwp_macro_text"))}),getAttrs(n,a=>{_.each(e,t=>{i[`repeating_nonweaponproficiencies_${t}_attribute`]=+a[s("nonweaponproficiencies",t,"nwp_attribute")]||0,i[`repeating_nonweaponproficiencies_${t}_slots`]=+a[s("nonweaponproficiencies",t,"nwp_slots")]||0,i[`repeating_nonweaponproficiencies_${t}_modifier`]=+a[s("nonweaponproficiencies",t,"nwp_modifier")]||0,i[`repeating_nonweaponproficiencies_${t}_macro_text`]=a[s("nonweaponproficiencies",t,"nwp_macro_text")]||0}),i.sheet_version=r,g("VERSION UPDATE: setNWPUpdate completed"),setAttrs(i,{silent:!0},y(r,o))})})},Kt=()=>{getSectionIDs("repeating_weapon",r=>{let o={},e=[];_.each(r,i=>{e.push(s("weapon",i,"weapon_quantity")),e.push(s("weapon",i,"weapon_weight")),e.push(s("weapon",i,"weapon_cost"))}),getAttrs(e,i=>{_.each(r,n=>{o[s("weapon",n,"weapon_quantity")]=+i[s("weapon",n,"weapon_quantity")]||0,o[s("weapon",n,"weapon_weight")]=0,o[s("weapon",n,"weapon_cost")]=0}),setAttrs(o)})})},Yt=()=>{getSectionIDs("repeating_weapon",r=>{getSectionIDs("repeating_equipment",o=>{let e={},i=[],n=[],a=[...i,...n];_.each(r,t=>{a.push(s("weapon",t,"weapon_name")),a.push(s("weapon",t,"weapon_quantity")),a.push(s("weapon",t,"weapon_weight")),a.push(s("weapon",t,"weapon_cost"))}),_.each(o,t=>{a.push(s("equipment",t,"equipment_item")),a.push(s("equipment",t,"equipment_quantity")),a.push(s("equipment",t,"equipment_weight")),a.push(s("equipment",t,"equipment_cost"))}),getAttrs(a,t=>{let p=[],c=[],l=[],u=[],h="";_.each(r,m=>{let w=t[s("weapon",m,"weapon_name")],S=t[s("weapon",m,"weapon_quantity")],b=t[s("weapon",m,"weapon_weight")],M=t[s("weapon",m,"weapon_cost")];if(_.each(o,f=>{let T=f;u.push(T);let $=t[s("equipment",f,"equipment_item")];p.push($);let L=t[s("equipment",f,"equipment_weight")];c.push(L);let U=t[s("equipment",f,"equipment_cost")];l.push(U)}),b!==0||M!==0){g(`weaponName:${w} weaponWeight:${b} weaponCost:${M}`);let f=p.indexOf(w);f===-1?(g("NO MATCH || COPY TO NEW ROW ||"),h=k(),e[`repeating_equipment_${h}_equipment_type`]=1,e[`repeating_equipment_${h}_equipment_item`]=w,e[`repeating_equipment_${h}_equipment_quantity`]=S,e[`repeating_equipment_${h}_equipment_quantity_max`]=S,e[`repeating_equipment_${h}_equipment_weight`]=b,e[`repeating_equipment_${h}_equipment_cost`]=M):c[f]==="0"&&l[f]==="0"?(g(`MATCH w/weight & cost tracked on weapons. || UPDATE ROW || name:${w} weight:${c[f]} cost:${l[f]} at index:${f} id:${u[f]}`),h=u[f],e[`repeating_equipment_${h}_equipment_type`]=1,e[`repeating_equipment_${h}_equipment_quantity`]=S,e[`repeating_equipment_${h}_equipment_quantity_max`]=S,e[`repeating_equipment_${h}_equipment_weight`]=b,e[`repeating_equipment_${h}_equipment_cost`]=M):c[f]!=="0"&&l[f]==="0"?(g(`MATCH w/weight tracked on equipment. || UPDATE ROW || name:${w} weight:${c[f]} cost:${l[f]} at index:${f} id:${u[f]}`),h=u[f],e[`repeating_equipment_${h}_equipment_type`]=1,e[`repeating_equipment_${h}_equipment_cost`]=M):c[f]==="0"&&l[f]!=="0"?(g(`MATCH w/cost tracked on equipment. || UPDATE ROW || name:${w} weight:${c[f]} cost:${l[f]} at index:${f} id:${u[f]}`),h=u[f],e[`repeating_equipment_${h}_equipment_type`]=1,e[`repeating_equipment_${h}_equipment_weight`]=b):c[f]!=="0"&&l[f]!=="0"?g(`100% MATCH weight & cost tracked on equipment. || IGNORE ROW || name:${w} weight: ${c[f]} cost:${l[f]} at index:${f}`):g("No attribute data to migrate. || IGNORE ROW ||")}}),setAttrs(e,{silent:!0},Kt())})})})},Xt=(r,o)=>{let e={};Yt(),e.sheet_version=r,g("VERSION UPDATE: migrateWeaponWtCost completed"),setAttrs(e,{silent:!0},y(r,o))},Qt=(r,o)=>{getSectionIDs("repeating_equipment",e=>{let i={},n=[];_.each(e,a=>{n.push(s("equipment",a,"equipment_type"))}),getAttrs(n,a=>{_.each(e,t=>{let p=+a[s("equipment",t,"equipment_type")]||0;p>=0||(i[s("equipment",t,"equipment_type")]=0,g(`equipType -1:${p} reset to Gear`))}),i.sheet_version=r,g("VERSION UPDATE: setEquipmentType completed"),setAttrs(i,{silent:!0},y(r,o))})})},Zt=(r,o)=>{let e={};ma(),e.sheet_version=r,g("VERSION UPDATE: migrateSetSpellsCasterClass completed"),setAttrs(e,{silent:!0},y(r,o))},Jt=(r,o)=>{let e={};V(0),e.sheet_version=r,g("VERSION UPDATE: recalcAC completed"),setAttrs(e,{silent:!0},y(r,o))},vt=(r,o)=>{let e={};e.init_macro_text="",e.sheet_version=r,g("VERSION UPDATE: recalcAC completed"),setAttrs(e,{silent:!0},y(r,o))},eo=(r,o)=>{getSectionIDs("repeating_weapon",e=>{let i=[];_.each(e,n=>{i.push(s("weapon",n,"weapon_critdamagesmallmedium")),i.push(s("weapon",n,"weapon_critdamagelarge"))}),getAttrs([...i],n=>{let a={},t="(@{weapon_damagesmallmedium})*2",p="(@{weapon_damagelarge})*2";_.each(e,c=>{let l=n[s("weapon",c,"weapon_critdamagesmallmedium")]||t,u=n[s("weapon",c,"weapon_critdamagelarge")]||p;a[s("weapon",c,"weapon_critdamagesmallmedium")]=l.replace(/@{weapon_damagesmallmedium}*2/g,"(@{weapon_damagesmallmedium})*2"),a[s("weapon",c,"weapon_critdamagelarge")]=u.replace(/@{weapon_damagelarge}*2/g,"(@{weapon_damagelarge})*2")}),a.sheet_version=r,g("VERSION UPDATE: updateCriticalDamageMacro completed"),setAttrs(a,{silent:!0},y(r,o))})})},ao=()=>{getAttrs(["hitdice","armorclass","strength","intelligence","wisdom","dexterity","constitution","charisma","old_character"],r=>{let o={};if((+r.old_character||0)===1)return;let i=+r.hitdice,n=+r.armorclass||0,a=+r.strength||0,t=+r.intelligence||0,p=+r.wisdom||0,c=+r.dexterity||0,l=+r.constitution||0,u=+r.charisma||0,h=a+t+p+c+l+u;i===0&&n===10&&h===60?(o.strength=a===10?8:a,o.intelligence=t===10?8:t,o.wisdom=p===10?8:p,o.dexterity=c===10?8:c,o.constitution=l===10?8:l,o.charisma=u===10?8:u,o.old_character=1,Fa()):o.old_character=1,setAttrs(o,{silent:!0})})};y=(r,o)=>{r<.1?kt(.1,o):r<1.2?At(1.2,o):r<1.5?xt(1.5,o):r<1.52?St(1.52,o):r<1.53?Mt(1.53,o):r<1.54?Dt(1.54,o):r<1.55?Et(1.55,o):r<1.56?Ct(1.56,o):r<1.57?It(1.57,o):r<1.591?La(1.591,o):r<1.592?Ba(1.592,o):r<1.593?ja(1.593,o):r<1.594?Nt(1.594,o):r<1.595?je(1.595,o):r<1.596?Ra(1.596,o):r<1.597?Rt(1.597,o):r<1.598?Lt(1.598,o):r<1.61?jt(1.61,o):r<1.62?Pt(1.62,o):r<1.634?je(1.634,o):r<1.635?Ot(1.635,o):r<1.636?Tt(1.636,o):r<1.637?je(1.637,o):r<1.638?Ut(1.638,o):r<1.639?Ht(1.639,o):r<1.64?Vt(1.641,o):r<1.642?Bt(1.643,o):r<1.644?Ft(1.644,o):r<1.645?Gt(1.645,o):r<1.646?Xt(1.646,o):r<1.648?Qt(1.648,o):r<1.65?Zt(1.65,o):r<1.652?Ra(1.652,o):r<1.654?Jt(1.654,o):r<1.656?vt(1.656,o):r<1.658?eo(1.658,o):r<1.659?zt(1.66,o):r<o?setAttrs({sheet_version:o}):r===o&&ao()};on("sheet:opened",()=>{getAttrs(["sheet_version","old_character"],o=>{let e={},i=O(o.sheet_version);+o.old_character==0&&i===0&&(i=1.66,e.sheet_version=1.66,setAttrs(e,{silent:!0})),g(`Current sheet data version:${i}, Sheet code version:${1.66}`),y(i,1.66)})});on("change:abilities_info_show change:toggle_exceptional change:intelligence change:wisdom change:dexterity change:constitution change:charisma change:comeliness",r=>{getAttrs(["intelligence","wisdom","dexterity","constitution","charisma","comeliness","toggle_exceptional"],o=>{let e={};(+o.toggle_exceptional||0)!==1&&(e.exceptional_intelligence_flag=1,e.exceptional_wisdom_flag=1,e.exceptional_dexterity_flag=1,e.exceptional_constitution_flag=1,e.exceptional_charisma_flag=1,e.exceptional_comeliness_flag=1,setAttrs(e,{silent:!0}))})});on("change:abilities_info_show change:toggle_exceptional change:strength",r=>{getAttrs(["strength"],o=>{let e={};e.exceptional_strength_flag=1,setAttrs(e,{silent:!0})})});on("change:is_npc",r=>{getAttrs(["is_npc","toggle_npc"],o=>{let e={},i=+o.is_npc,n=+o.toggle_npc;n=i===0?0:1,e.toggle_npc=n,setAttrs(e,{silent:!0})})});var to=()=>{getSectionIDs("repeating_equipment",r=>{let o={},e=[];_.each(r,i=>{e.push(s("equipment",i,"equipment_quantity")),e.push(s("equipment",i,"equipment_cost"))}),getAttrs(e,i=>{let n=[];_.each(r,t=>{let p=+i[s("equipment",t,"equipment_quantity")]||0,c=+i[s("equipment",t,"equipment_cost")]||0;c=p>0?c*p:0,n.push(c)});let a=n.reduce((t,p)=>t+p,0);o.total_equipment_cost=a.toFixed(2),o.total_cost=a.toFixed(2),setAttrs(o,{silent:!0})})})},oo=()=>{getSectionIDs("repeating_equipment",r=>{let o={},e=[];_.each(r,i=>{e.push(s("equipment",i,"equipment_type")),e.push(s("equipment",i,"equipment_armor_type")),e.push(s("equipment",i,"equipment_location")),e.push(s("equipment",i,"equipment_weight")),e.push(s("equipment",i,"equipment_quantity")),e.push(s("equipment",i,"equipment_carried")),e.push(s("equipment",i,"equipment_carried_select"))}),getAttrs(["total_coin_weight",...e],i=>{let n=[],a=[],t=[];_.each(r,m=>{let w=+i[s("equipment",m,"equipment_type")]||0,S=+i[s("equipment",m,"equipment_armor_type")]||0,b=0,M=+i[s("equipment",m,"equipment_carried_select")]||0;o[s("equipment",m,"equipment_carried")]=M===1?1:0,b=M===1?1:0;let f=+i[s("equipment",m,"equipment_quantity")]||0,T=+i[s("equipment",m,"equipment_weight")]||0,$=0,L=0;T=T*f*b,w===1&&($=T),w===2&&(L=T),n.push($),a.push(L),t.push(T)});let p=n.reduce((m,w)=>m+w,0),c=a.reduce((m,w)=>m+w,0),l=t.reduce((m,w)=>m+w,0),u=l-c-p,h=Math.round(O(i.total_coin_weight)+O(l));o.total_weapon_weight=p.toFixed(2),o.total_armor_weight=c.toFixed(2),o.total_equipment_weight=l.toFixed(2),o.total_equipment_weight_adjusted=u.toFixed(2),o.total_weight=h,setAttrs(o,{silent:!0})})})};on("change:repeating_equipment:equipment_quantity change:repeating_equipment:equipment_cost remove:repeating_equipment",r=>{to()});on("change:repeating_equipment:equipment_weight change:repeating_equipment:equipment_quantity change:repeating_equipment:equipment_carried change:repeating_equipment:equipment_carried_select change:repeating_equipment:equipment_armor_worn change:total_coin_weight remove:repeating_equipment change:toggle_lbs",r=>{oo()});on("change:pp change:gp change:ep change:sp change:cp change:toggle_lbs",r=>{getAttrs(["pp","gp","ep","sp","cp","toggle_lbs"],o=>{let e=+(o.toggle_lbs||0)?10:1;setAttrs({total_coin_weight:(Math.round((O(o.pp)+O(o.gp)+O(o.ep)+O(o.sp)+O(o.cp))/1)/e).toFixed(2)})})});function no(){getAttrs(["normal_load_adjusted","heavy_load","very_heavy_load","total_weight","autocalc_movement_flag","current_bulk","current_encumbrance_move"],r=>{let o={},e=+r.autocalc_movement_flag||0,i=+r.normal_load_adjusted||0,n=+r.heavy_load||0,a=+r.very_heavy_load||0,t=+r.total_weight||0,p=+r.current_bulk||0,c=0;t<=i?(o.current_encumbrance_label="Unencumbered",c=0,o.current_encumbrance=c,o.current_encumbrance_move=e===1?Math.max(c,p):r.current_encumbrance_move):t>i&&t<=n?(o.current_encumbrance_label="Heavy",c=1,o.current_encumbrance=c,o.current_encumbrance_move=e===1?Math.max(c,p):r.current_encumbrance_move):t>n&&t<=a?(o.current_encumbrance_label="Very Heavy",c=2,o.current_encumbrance=c,o.current_encumbrance_move=e===1?Math.max(c,p):r.current_encumbrance_move):(o.current_encumbrance_label="Encumbered",c=3,o.current_encumbrance=c,o.current_encumbrance_move=e===1?Math.max(c,p):r.current_encumbrance_move),setAttrs(o)})}on("sheet:opened change:encumbrancebonus change:normal_load change:total_weight change:autocalc_movement_flag change:current_bulk change:encumbrancebonus_lbs change:toggle_lbs",r=>{getAttrs(["encumbrancebonus","toggle_lbs"],o=>{let e={},i=+(o.toggle_lbs||0),n=i?.1:1,a=350*n,t=+o.encumbrancebonus||0,p=O(t*n),l=a+(i?p:t),u=l+a,h=u+a,m=h;e.encumbrancebonus_lbs=p,e.normal_load=a,e.normal_load_adjusted=l,e.heavy_load=u,e.very_heavy_load=h,e.max_load=m+1,setAttrs(e,{silent:!0},no())})});function ro(){getAttrs(["current_encumbrance_move","movement"],r=>{let o={},e=+r.movement.toString().replace(/[^0-9]/g,""),i=+r.current_encumbrance_move||0,n=0;i===0?n=e:i===1?n=q(e-3):i===2?n=q(e-6):n=q(e-9),o.movement_normal=n,o.movement_known=n*5,o.movement_run=n*10,setAttrs(o,{silent:!0})})}on("change:movement change:current_encumbrance change:current_encumbrance_move change:autocalc_movement_flag",r=>{getAttrs(["movement"],o=>{let e={},n=+o.movement.toString().replace(/[^0-9]/g,"");e.movement_heavy=Math.max(n-3,0),e.movement_load=Math.max(n-6,0),e.movement_max=Math.max(n-9,0),setAttrs(e,{silent:!0},ro(),V(0))})});function _o(){getAttrs(["unarmored_bulk","armortype_bulk","armortype2_bulk","armorshield_bulk","unarmored_worn","armortype_worn","armortype2_worn","armorshield_worn","armorshield_carried"],r=>{let o={},{unarmored_worn:e}=r,{armortype_worn:i}=r,{armortype2_worn:n}=r,{armorshield_worn:a}=r,{armorshield_carried:t}=r,p=Math.max(a,t),c=r.unarmored_bulk*e,l=r.armortype_bulk*i,u=r.armortype2_bulk*n,h=r.armorshield_bulk*p;switch(Math.max(c,l,u,h)){case 0:o.current_bulk_label="Not Bulky",o.current_bulk=0;break;case 1:o.current_bulk_label="Not Bulky/Light",o.current_bulk=0;break;case 2:o.current_bulk_label="Fairly/Moderate",o.current_bulk=1;break;case 3:o.current_bulk_label="Bulky/Heavy",o.current_bulk=2;break;default:g(">> failure in bulk calculation <<")}setAttrs(o)})}on("change:unarmored_bulk change:armortype_bulk change:armortype2_bulk change:armorshield_bulk change:armorhelmet_bulk change:unarmored_worn change:armortype_worn change:armortype2_worn change:armorshield_worn change:armorhelmet_worn change:armorshield_carried remove:repeating_equipment",r=>{_o()});on("change:repeating_equipment:equipment_carried_select change:repeating_equipment:equipment_type change:repeating_equipment:equipment_carried_select",r=>{let o=r.sourceAttribute.split("_")[2],e=`${r.sourceAttribute}`,n=/equipment_type/.test(e),a=[s("equipment",o,"equipment_type"),s("equipment",o,"equipment_carried_select")];getAttrs(["equipment_tabs_type","equipment_tabs_carry",...a],t=>{let p={},c=+t.equipment_tabs_carry||0,l=+t.equipment_tabs_type||0,u=+t[s("equipment",o,"equipment_type")]||0,h=+t[s("equipment",o,"equipment_carried_select")]||0;p[s("equipment",o,"equipment_carried")]=h===1?1:0,p.equipment_tabs_type=l!==-1&&n?u:l,p.equipment_tabs_carry=c===-1||c===h?-1:h,setAttrs(p)})});on("change:equipment_tabs_type change:equipment_tabs_carry change:repeating_equipment:equipment_magical",r=>{getSectionIDs("repeating_equipment",o=>{let e=[];_.each(o,i=>{e.push(s("equipment",i,"equipment_type")),e.push(s("equipment",i,"equipment_carried_select")),e.push(s("equipment",i,"equipment_magical"))}),getAttrs(["equipment_tabs_type","equipment_tabs_carry","equipment_magical",...e],i=>{let n={},a=+i.equipment_tabs_type||0,t=+i.equipment_tabs_carry||0;_.each(o,p=>{let c=+i[s("equipment",p,"equipment_magical")]||0,l=+i[s("equipment",p,"equipment_type")]||0,u=+i[s("equipment",p,"equipment_carried_select")]||0;if(a===-1||a===l||a===3&&c)return n[s("equipment",p,"equipment_show_type")]=1;n[s("equipment",p,"equipment_show_type")]=0,n[s("equipment",p,"equipment_show_carry")]=t===-1||t===u?1:0}),setAttrs(n)})})});var so=()=>{getSectionIDs("repeating_equipment",r=>{let o=r.reduce((e,i)=>[...e,`repeating_equipment_${i}_equipment_armor_type`],[]);getAttrs(["armordetails_array",...De,...o],e=>{let i={},n=e.unarmored_row_id.toString(),a=e.armortype1_row_id.toString(),t=e.armortype2_row_id.toString(),p=e.armorshield_row_id.toString(),c=e.armorhelmet_row_id.toString(),l=e.armorother1_row_id.toString(),u=e.armorother2_row_id.toString(),h=e.armorother3_row_id.toString(),m=e.armorother4_row_id.toString(),w=e.armorother5_row_id.toString(),S=e.armorother6_row_id.toString(),b=[n,a,t,p,c,l,u,h,m,w,S].map(M=>M?M.toString().toLowerCase():"0");_.each(r,M=>{let f=+e[`repeating_equipment_${M}_equipment_armor_type`];if(f===99)return;let T=b.map(($,L)=>$===M?`${Math.floor(L)+1}`:null).filter($=>$!==null);if(T.length>1){let U=T.join(",").split(",").filter(K=>K!==String(f));switch(U.length>0?U[0]:null){case"1":i.unarmored="",g(">> DELETE/RESET ROW 0 - Unarmored <<");break;case"2":i.armortype="",g(">> DELETE/RESET ROW 1 - Armor 1 <<");break;case"3":i.armortype2="",g(">> DELETE/RESET ROW 2 - Armor 2 <<");break;case"4":i.armorshield="",g(">> DELETE/RESET ROW 3 - Shield <<");break;case"5":i.armorhelmet="",g(">> DELETE/RESET ROW 4 - Helmet <<");break;case"6":i.armorother="",g(">> DELETE/RESET ROW 5 - Other <<");break;case"7":i.armorother2="",g(">> DELETE/RESET ROW 6 - Other 2 <<");break;case"8":i.armorother3="",g(">> DELETE/RESET ROW 7 - Other 3 <<");break;case"9":i.armorother4="",g(">> DELETE/RESET ROW 8 - Other 4 <<");break;case"10":i.armorother5="",g(">> DELETE/RESET ROW 9 - Other 5 <<");break;case"11":i.armorother6="",g(">> DELETE/RESET ROW 10 - Other 6 <<");break;default:g(">> NOTHING TO DELETE/RESET <<")}}}),setAttrs(i)})})},io=`${ba.map(r=>`change:${r}`).join(" ")}`;on(io,r=>{if(r.sourceType==="sheetworker")return;let o=r.sourceAttribute,e=r.previousValue,i=r.newValue,n=0;getAttrs(ba,a=>{let t={},p="";o==="unarmored"&&e===void 0&&(p=k(),t.unarmored_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=0,t[`repeating_equipment_${p}_equipment_armor_worn`]=1,t[`repeating_equipment_${p}_equipment_item`]=a.unarmored,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.unarmored_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.unarmored_base||0,t[`repeating_equipment_${p}_equipment_carried_select`]=1,g(`repeating armor does not exist. Creating unarmored: ${p}`)),o==="armortype"&&e===void 0&&(p=k(),t.armortype1_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=1,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armortype_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armortype,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armortype_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armortype_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armortype_magic||0,t[`repeating_equipment_${p}_equipment_armor_bulk`]=+a.armortype_bulk||0,t[`repeating_equipment_${p}_equipment_carried_select`]=+a.armortype_carried||0,t[`repeating_equipment_${p}_equipment_weight`]=+a.armor_weight||0,t[`repeating_equipment_${p}_equipment_cost`]=+a.armor_cost||0),o==="armortype2"&&e===void 0&&(p=k(),t.armortype2_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=2,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armortype2_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armortype2,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armortype2_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armortype2_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armortype2_magic||0,t[`repeating_equipment_${p}_equipment_armor_bulk`]=+a.armortype2_bulk||0,t[`repeating_equipment_${p}_equipment_carried_select`]=+a.armortype2_carried||0,t[`repeating_equipment_${p}_equipment_weight`]=+a.armortype2_weight||0,t[`repeating_equipment_${p}_equipment_cost`]=+a.armortype2_cost||0),o==="armorshield"&&e===void 0&&(p=k(),t.armorshield_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=3,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorshield_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorshield,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorshield_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorshield_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorshield_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorshield_mod||0,t[`repeating_equipment_${p}_equipment_armor_bulk`]=+a.armorshield_bulk||0,t[`repeating_equipment_${p}_equipment_carried_select`]=+a.armorshield_carried||0,t[`repeating_equipment_${p}_equipment_weight`]=+a.armorshield_weight||0,t[`repeating_equipment_${p}_equipment_cost`]=+a.armorshield_cost||0),o==="armorhelmet"&&e===void 0&&(p=k(),t.armorhelmet_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=4,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorhelmet_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorhelmet,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorhelmet_ac||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorhelmet_magic||0,t[`repeating_equipment_${p}_equipment_carried_select`]=+a.armorhelmet_carried||0,t[`repeating_equipment_${p}_equipment_weight`]=+a.armorhelmet_weight||0,t[`repeating_equipment_${p}_equipment_cost`]=+a.armorhelmet_cost||0),o==="armorother"&&e===void 0&&(p=k(),t.armorother1_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=5,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother_mod||0),o==="armorother2"&&e===void 0&&(p=k(),t.armorother2_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=6,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother2_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother2,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother2_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother2_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother2_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother2_mod||0),o==="armorother3"&&e===void 0&&(p=k(),t.armorother3_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=7,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother3_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother3,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother3_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother3_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother3_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother3_mod||0),o==="armorother4"&&e===void 0&&(p=k(),t.armorother4_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=8,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother4_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother4,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother4_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother4_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother4_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother4_mod||0),o==="armorother5"&&e===void 0&&(p=k(),t.armorother5_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=9,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother5_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother5,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother5_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother5_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother5_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother5_mod||0),o==="armorother6"&&e===void 0&&(p=k(),t.armorother6_row_id=p.toLowerCase(),t[`repeating_equipment_${p}_equipment_type`]=2,t[`repeating_equipment_${p}_equipment_armor_type`]=10,t[`repeating_equipment_${p}_equipment_armor_worn`]=+a.armorother6_worn||0,t[`repeating_equipment_${p}_equipment_item`]=a.armorother6,t[`repeating_equipment_${p}_equipment_armor_ac`]=+a.armorother6_ac||0,t[`repeating_equipment_${p}_equipment_armor_base`]=+a.armorother6_base||0,t[`repeating_equipment_${p}_equipment_armor_magic`]=+a.armorother6_magic||0,t[`repeating_equipment_${p}_equipment_armor_mod`]=+a.armorother6_mod||0),setAttrs(t,{silent:!0},Se()),da(null,o,n)})});function Ga(r,o){getAttrs([`repeating_equipment_${r}_equipment_armor_type`,`repeating_equipment_${r}_equipment_item`,`repeating_equipment_${r}_equipment_armor_worn`,`repeating_equipment_${r}_equipment_armor_ac`,`repeating_equipment_${r}_equipment_armor_base`,`repeating_equipment_${r}_equipment_armor_magic`,`repeating_equipment_${r}_equipment_armor_mod`,`repeating_equipment_${r}_equipment_armor_bulk`,`repeating_equipment_${r}_equipment_carried_select`,`repeating_equipment_${r}_equipment_carried`,`repeating_equipment_${r}_equipment_weight`,`repeating_equipment_${r}_equipment_cost`],e=>{let i={},a=+e[`repeating_equipment_${r}_equipment_armor_type`]||0,t=e[`repeating_equipment_${r}_equipment_item`],p=+e[`repeating_equipment_${r}_equipment_armor_worn`]||0,c=+e[`repeating_equipment_${r}_equipment_armor_ac`]||0,l=+e[`repeating_equipment_${r}_equipment_armor_base`]||0,u=+e[`repeating_equipment_${r}_equipment_armor_magic`]||0,h=+e[`repeating_equipment_${r}_equipment_armor_mod`]||0,m=+e[`repeating_equipment_${r}_equipment_armor_bulk`]||0,w=+e[`repeating_equipment_${r}_equipment_carried_select`]||0,S=+e[`repeating_equipment_${r}_equipment_weight`]||0,b=+e[`repeating_equipment_${r}_equipment_cost`]||0;p===1?(w=1,i[`repeating_equipment_${r}_equipment_carried_select`]=1):p===0&&(w===0||w===2)&&(i[`repeating_equipment_${r}_equipment_carried_select`]=w);let M=[`ID:${r} ITEM:${t} TYPE:${a} WORN:${p} AC:${c} BASE:${l} MAGIC:${u} MOD:${h} BULK:${m} CARRIED:${w} WEIGHT:${S} COST:${b} UPDATED:`];switch(a){case 99:g("Choose an armor row.");break;case 0:i.unarmored_worn=p,i.unarmored=t,i.unarmored_ac=c,i.unarmored_base=l,i.unarmored_bulk=m,i.unarmored_carried=w,i.unarmored_row_id=r;break;case 1:i.armortype_worn=p,i.armortype=t,i.armortype_ac=c,i.armortype_base=l,i.armortype_magic=u,i.armortype_bulk=m,i.armortype_carried=w,i.armor_weight=S,i.armor_cost=b,i.armortype1_row_id=r;break;case 2:i.armortype2_worn=p,i.armortype2=t,i.armortype2_ac=c,i.armortype2_base=l,i.armortype2_magic=u,i.armortype2_bulk=m,i.armortype2_carried=w,i.armortype2_weight=S,i.armortype2_cost=b,i.armortype2_row_id=r;break;case 3:i.armorshield_worn=p,i.armorshield=t,i.armorshield_ac=c>=0?0:-Math.abs(c),i.armorshield_base=l>=0?0:-Math.abs(l),i.armorshield_magic=u,i.armorshield_mod=h,i.armorshield_bulk=m,i.armorshield_carried=w,i.armorshield_weight=S,i.armorshield_cost=b,i.armorshield_row_id=r;break;case 4:i.armorhelmet_worn=p,i.armorhelmet=t,i.armorhelmet_base=l,i.armorhelmet_magic=u,i.armorhelmet_carried=w,i.armorhelmet_weight=S,i.armorhelmet_cost=b,i.armorhelmet_row_id=r;break;case 5:i.armorother_worn=p,i.armorother=t,i.armorother_ac=c,i.armorother_base=l,i.armorother_magic=u,i.armorother_mod=h,i.armorother1_row_id=r;break;case 6:i.armorother2_worn=p,i.armorother2=t,i.armorother2_ac=c>=0?0:-Math.abs(c),i.armorother2_base=l>=0?0:-Math.abs(l),i.armorother2_magic=u,i.armorother2_mod=h,i.armorother2_row_id=r;break;case 7:i.armorother3_worn=p,i.armorother3=t,i.armorother3_ac=c>=0?0:-Math.abs(c),i.armorother3_base=l>=0?0:-Math.abs(l),i.armorother3_magic=u,i.armorother3_mod=h,i.armorother3_row_id=r;break;case 8:i.armorother4_worn=p,i.armorother4=t,i.armorother4_ac=c>=0?0:-Math.abs(c),i.armorother4_base=l>=0?0:-Math.abs(l),i.armorother4_magic=u,i.armorother4_mod=h,i.armorother4_row_id=r;break;case 9:i.armorother5_worn=p,i.armorother5=t,i.armorother5_ac=c>=0?0:-Math.abs(c),i.armorother5_base=l>=0?0:-Math.abs(l),i.armorother5_magic=u,i.armorother5_mod=h,i.armorother5_row_id=r;break;case 10:i.armorother6_worn=p,i.armorother6=t,i.armorother6_ac=c>=0?0:-Math.abs(c),i.armorother6_base=l>=0?0:-Math.abs(l),i.armorother6_magic=u,i.armorother6_mod=h,i.armorother6_row_id=r;break;default:g("Armor row is out of range.")}o&&o(),setAttrs(i,V(0))})}function po(r){let o={};getAttrs([`repeating_equipment_${r}_equipment_item`,`repeating_equipment_${r}_equipment_weapon_type`,`repeating_equipment_${r}_equipment_weapon_speed`,`repeating_equipment_${r}_equipment_weapon_length`,`repeating_equipment_${r}_equipment_weapon_space`,`repeating_equipment_${r}_equipment_weapon_misc`,`repeating_equipment_${r}_equipment_weapon_damagesmallmedium`,`repeating_equipment_${r}_equipment_weapon_damagelarge`,`repeating_equipment_${r}_equipment_weapon_attackdmgtype`,`repeating_equipment_${r}_equipment_weapon_rateoffire`,`repeating_equipment_${r}_equipment_weapon_range`,`repeating_equipment_${r}_equipment_quantity`,`repeating_equipment_${r}_equipment_description`],e=>{let i=k();o[`repeating_weapon_${i}_weapon_name`]=e[`repeating_equipment_${r}_equipment_item`],o[`repeating_weapon_${i}_weapon_type`]=+e[`repeating_equipment_${r}_equipment_weapon_type`]||0,o[`repeating_weapon_${i}_weapon_speed`]=e[`repeating_equipment_${r}_equipment_weapon_speed`],o[`repeating_weapon_${i}_weapon_length`]=e[`repeating_equipment_${r}_equipment_weapon_length`],o[`repeating_weapon_${i}_weapon_space`]=e[`repeating_equipment_${r}_equipment_weapon_space`],o[`repeating_weapon_${i}_weapon_misc`]=e[`repeating_equipment_${r}_equipment_weapon_misc`],o[`repeating_weapon_${i}_weapon_damagesmallmedium`]=e[`repeating_equipment_${r}_equipment_weapon_damagesmallmedium`],o[`repeating_weapon_${i}_weapon_damagelarge`]=e[`repeating_equipment_${r}_equipment_weapon_damagelarge`],o[`repeating_weapon_${i}_weapon_attackdmgtype`]=e[`repeating_equipment_${r}_equipment_weapon_attackdmgtype`],o[`repeating_weapon_${i}_weapon_rateoffire`]=e[`repeating_equipment_${r}_equipment_weapon_rateoffire`],o[`repeating_weapon_${i}_weapon_range`]=e[`repeating_equipment_${r}_equipment_weapon_range`],o[`repeating_weapon_${i}_weapon_quantity`]=+e[`repeating_equipment_${r}_equipment_quantity`]||0,o[`repeating_weapon_${i}_weapon_notes`]=e[`repeating_equipment_${r}_equipment_description`],setAttrs(o,{silent:!0}),Me(i)})}function qa(r,o){getAttrs(De,e=>{let i=e.unarmored_row_id.toString(),n=e.armortype1_row_id.toString(),a=e.armortype2_row_id.toString(),t=e.armorshield_row_id.toString(),p=e.armorhelmet_row_id.toString(),c=e.armorother1_row_id.toString(),l=e.armorother2_row_id.toString(),u=e.armorother3_row_id.toString(),h=e.armorother4_row_id.toString(),m=e.armorother5_row_id.toString(),w=e.armorother6_row_id.toString(),S=[i,n,a,t,p,c,l,u,h,m,w].map(M=>M?M.toString().toLowerCase():"0"),b="";b=S.includes(r)?1:0,typeof o=="function"&&o(b,S)})}Se=r=>{let o={};qa(r,(e,i)=>{o.armordetails_array=[`${i}`],setAttrs(o,{silent:!0})})};var co=`${De.map(r=>`change:${r}`).join(" ")}`;on(co,r=>{let o=r.sourceAttribute;r.sourceType!=="sheetworker"&&getAttrs(o,e=>{let i=e[`${r.sourceAttribute}`];g("Updating armordetails_array..."),Se(i)})});on("change:repeating_equipment:equipment_item change:repeating_equipment:equipment_armor_worn change:repeating_equipment:equipment_armor_ac change:repeating_equipment:equipment_armor_base change:repeating_equipment:equipment_armor_magic change:repeating_equipment:equipment_armor_mod change:repeating_equipment:equipment_armor_bulk change:repeating_equipment:equipment_carried_select change:repeating_equipment:equipment_weight change:repeating_equipment:equipment_cost",r=>{let o=r.sourceAttribute.split("_")[2].toLowerCase();r.sourceType!=="sheetworker"&&qa(o,e=>{e&&Ga(o)})});on("clicked:repeating_equipment:addarmor",r=>{let o=r.sourceAttribute.split("_")[2].toLowerCase();Ga(o,()=>{so()})});on("clicked:repeating_equipment:addattack",r=>{let o=r.sourceAttribute.split("_")[2];po(o)});on("clicked:addturnundead",r=>{let o={},e=k();o[`repeating_ability_${e}_ability_name`]="Turn Undead by Type",o[`repeating_ability_${e}_ability_short_description`]="[Turn Undead by Type](~selected|turn_undead_roll)",setAttrs(o,{silent:!0})});on("clicked:addturnundead2",r=>{let o={},e=k();o[`repeating_ability_${e}_ability_name`]="Turn Undead by HD",o[`repeating_ability_${e}_ability_short_description`]="[Turn Undead by HD](~selected|turn_undead2_roll)",setAttrs(o,{silent:!0})});on("remove:repeating_equipment",r=>{let o=r.sourceAttribute.split("_")[2].toLowerCase(),e=1;qa(o,(i,n)=>{i&&da(o,null,e)})});on("change:spell_tabs change:toggle_show_memorized change:spell_caster_tabs change:toggle_caster2",r=>{getSectionIDs("repeating_spells",o=>{let e=[];_.each(o,i=>{e.push(s("spells",i,"spell_memorized")),e.push(s("spells",i,"spell_show_all")),e.push(s("spells",i,"spell_level")),e.push(s("spells",i,"spell_caster_class"))}),getAttrs(["spell_tabs","toggle_show_memorized","spell_caster_tabs","toggle_caster2",...e],i=>{let n={},a=+i.toggle_show_memorized||0,t=+i.spell_caster_tabs||0,p=+i.toggle_caster2||0,c=+i.spell_tabs||0;_.each(o,l=>{let u=+i[s("spells",l,"spell_memorized")]||0,h=+i[s("spells",l,"spell_caster_class")]||0,m=+i[s("spells",l,"spell_level")]||0;n[s("spells",l,"spell_show_memorized")]=a===1&&u>0?1:0,n[s("spells",l,"spell_show_all")]=a===1?0:1,c===-1||c===m?p===1?n[s("spells",l,"spell_show")]=1:p===0&&(t===-1||h===0||t===0&&h===1||t===1&&h===2?n[s("spells",l,"spell_show")]=1:n[s("spells",l,"spell_show")]=0):n[s("spells",l,"spell_show")]=0}),setAttrs(n)})})});on("change:repeating_spells:spell_level change:repeating_spells:spell_caster_class",r=>{r.sourceType==="player"&&getAttrs(["repeating_spells_spell_level","repeating_spells_spell_caster_class","spell_caster_tabs","spell_tabs"],o=>{let e={},i=+o.spell_caster_tabs||0,n=+o.repeating_spells_spell_caster_class||0,a=+o.spell_tabs||0,t=o.repeating_spells_spell_level;e.spell_tabs=t>=0&&a!==t?t:a,e.spell_caster_tabs=i!==-1&&n<=1?0:1,setAttrs(e)})});ma=()=>{getSectionIDs("repeating_spells",r=>{let o={},e=["caster_class1_name","caster_class2_name","caster_class1_level","caster_class2_level"],i=[];_.each(r,a=>{i.push(s("spells",a,"spell_caster_class"))});let n=[...e,...i];getAttrs(n,a=>{_.each(r,t=>{let p=+a[s("spells",t,"spell_caster_class")]||0;p===0?(o[s("spells",t,"spell_caster_class_name")]="",o[s("spells",t,"spell_caster_class")]=p):p===1?(o[s("spells",t,"spell_caster_class_name")]=a.caster_class1_name,o[s("spells",t,"spell_caster_class_level")]=+a.caster_class1_level||0,o[s("spells",t,"spell_caster_class")]=p):p===2&&(o[s("spells",t,"spell_caster_class_name")]=a.caster_class2_name,o[s("spells",t,"spell_caster_class_level")]=+a.caster_class2_level||0,o[s("spells",t,"spell_caster_class")]=p)}),setAttrs(o,{silent:!0})})})};on("change:caster_class1_name change:caster_class2_name change:caster_class1_level change:caster_class2_level",r=>{ma()});on("change:repeating_spells:spell_name change:repeating_spells:spell_caster_class",r=>{let o=r.sourceAttribute.split("_")[2];getAttrs([`repeating_spells_${o}_spell_caster_class`,"caster_class1_name","caster_class1_level","caster_class2_name","caster_class2_level"],e=>{let i={},n=+e[s("spells",o,"spell_caster_class")]||0;n===0?(i[s("spells",o,"spell_caster_class_name")]="",i[s("spells",o,"spell_caster_class")]=n):n===1?(i[s("spells",o,"spell_caster_class_name")]=e.caster_class1_name,i[s("spells",o,"spell_caster_class_level")]=+e.caster_class1_level||0,i[s("spells",o,"spell_caster_class")]=n):n===2&&(i[s("spells",o,"spell_caster_class_name")]=e.caster_class2_name,i[s("spells",o,"spell_caster_class_level")]=+e.caster_class2_level||0,i[s("spells",o,"spell_caster_class")]=n),setAttrs(i,{silent:!0})})});on("change:repeating_weapon:weapon_tohitacadj_flag change:repeating_weapon:weapon_thac_adj0 change:repeating_weapon:weapon_thac_adj1 change:repeating_weapon:weapon_thac_adj2 change:repeating_weapon:weapon_thac_adj3 change:repeating_weapon:weapon_thac_adj4 change:repeating_weapon:weapon_thac_adj5 change:repeating_weapon:weapon_thac_adj6 change:repeating_weapon:weapon_thac_adj7 change:repeating_weapon:weapon_thac_adj8 change:repeating_weapon:weapon_thac_adj9 change:repeating_weapon:weapon_thac_adj10",r=>{getAttrs(["repeating_weapon_weapon_ToHitACadj_flag","repeating_weapon_weapon_ToHitACadj"],o=>{let e={},i=+o.repeating_weapon_weapon_ToHitACadj_flag||0;e.repeating_weapon_weapon_ToHitACadj=i===1?"{{ToHitACadj2to10=HitAdj:[[ @{weapon_thac_adj0} ]]|[[ @{weapon_thac_adj1} ]]|[[ @{weapon_thac_adj2} ]]|[[ @{weapon_thac_adj3} ]]|[[ @{weapon_thac_adj4} ]]|[[ @{weapon_thac_adj5} ]]|[[ @{weapon_thac_adj6} ]]|[[ @{weapon_thac_adj7} ]]|[[ @{weapon_thac_adj8} ]]|[[ @{weapon_thac_adj9} ]]|[[ @{weapon_thac_adj10} ]] }}":"{{ToHitACadj2to10}}",setAttrs(e,{silent:!0})})});on("change:toggle_to_hit_table change:repeating_weapon:weapon_name change:repeating_weapon:weapon_whisper_to_hit_select",r=>{getSectionIDs("repeating_weapon",o=>{let e=[];_.each(o,i=>{e.push(`repeating_weapon_${i}_weapon_whisper_to_hit_select`),e.push(`repeating_weapon_${i}_weapon_whisper_to_hit`)}),getAttrs(["toggle_to_hit_table",...e],i=>{let n={},a=+i.toggle_to_hit_table||0;_.each(o,t=>{let p=+i[`repeating_weapon_${t}_weapon_whisper_to_hit_select`]||0,c=i[`repeating_weapon_${t}_weapon_whisper_to_hit`],l="&nbsp;",u="%NEWLINE%/w gm &{template:attacks-table} {{color=@{color_option}}} {{ToHitAC-10to0=ToHit:[[ @{thac-10} ]]|[[ @{thac-9} ]]|[[ @{thac-8} ]]|[[ @{thac-7} ]]|[[ @{thac-6} ]]|[[ @{thac-5} ]]|[[ @{thac-4} ]]|[[ @{thac-3} ]]|[[ @{thac-2} ]]|[[ @{thac-1} ]]|[[ @{thac0} ]]}} {{ToHitAC1to10=ToHit:[[ @{thac0} ]]|[[ @{thac1} ]]|[[ @{thac2} ]]|[[ @{thac3} ]]|[[ @{thac4} ]]|[[ @{thac5} ]]|[[ @{thac6} ]]|[[ @{thac7} ]]|[[ @{thac8} ]]|[[ @{thac9} ]]|[[ @{thac10} ]] }}",h="%NEWLINE%/w gm &{template:attacks-table} {{color=@{color_option}}} {{ToHitAC-10to0=ToHit:[[ @{thac0-10} ]]|[[ @{thac0-9} ]]|[[ @{thac0-8} ]]|[[ @{thac0-7} ]]|[[ @{thac0-6} ]]|[[ @{thac0-5} ]]|[[ @{thac0-4} ]]|[[ @{thac0-3} ]]|[[ @{thac0-2} ]]|[[ @{thac0-1} ]]|[[ @{thac00} ]]}} {{ToHitAC1to10=ToHit:[[ @{thac00} ]]|[[ @{thac01} ]]|[[ @{thac02} ]]|[[ @{thac03} ]]|[[ @{thac04} ]]|[[ @{thac05} ]]|[[ @{thac06} ]]|[[ @{thac07} ]]|[[ @{thac08} ]]|[[ @{thac09} ]]|[[ @{thac010} ]] }}";p===2?(c=l,p=2):(p===0||p===1)&&(a===0?(c=u,p=0):a===1&&(c=h,p=1)),n[`repeating_weapon_${t}_weapon_whisper_to_hit`]=c,n[`repeating_weapon_${t}_weapon_whisper_to_hit_select`]=p}),setAttrs(n,{silent:!0})})})});on("change:repeating_weapon:weapon_prof_flag change:weapon_proficiency_initial change:weapon_proficiency_added_per_level change:weapon_proficiency_penalty",r=>{getSectionIDs("repeating_weapon",o=>{let e=[];_.each(o,i=>{e.push(`repeating_weapon_${i}_weapon_prof_flag`)}),getAttrs(["weapon_proficiency_penalty",...e],i=>{let n={};_.each(o,a=>{let t=+i[`repeating_weapon_${a}_weapon_prof_flag`]||0,p=+i.weapon_proficiency_penalty||0;n[`repeating_weapon_${a}_weapon_prof`]=p,n[`repeating_weapon_${a}_weapon_prof_pen`]=t===0?"0":p}),setAttrs(n,{silent:!0})})})});on("change:repeating_weapon:weapon_backstab_flag change:backstab change:backstab_bonus change:toggle_thief_skills",r=>{getSectionIDs("repeating_weapon",o=>{let e=[];_.each(o,i=>{e.push(`repeating_weapon_${i}_weapon_backstab_flag`)}),getAttrs(["backstab","backstab_bonus","toggle_thief_skills",...e],i=>{let n={},a=+i.toggle_thief_skills,t=+i.backstab||1,p=+i.backstab_bonus||0;_.each(o,c=>{let l=+i[`repeating_weapon_${c}_weapon_backstab_flag`];a===0&&(n[`repeating_weapon_${c}_weapon_backstab_var`]=l===0?0:`+${p}`,n[`repeating_weapon_${c}_weapon_backstab_bonus`]=l===0?0:p,n[`repeating_weapon_${c}_weapon_backstab`]=l===0?1:`x${t}`,n[`repeating_weapon_${c}_weapon_backstab_mult`]=l===0?1:t),a===1&&(n[`repeating_weapon_${c}_weapon_backstab_var`]=0,n[`repeating_weapon_${c}_weapon_backstab_bonus`]=0,n[`repeating_weapon_${c}_weapon_backstab`]=1,n[`repeating_weapon_${c}_weapon_backstab_mult`]=1)}),setAttrs(n,{silent:!0})})})});function mo(){getSectionIDs("repeating_weapon",r=>{let o={},e=[];_.each(r,i=>{e.push(s("weapon",i,"weapon_dual"))}),getAttrs(["dual_pen_primary","dual_pen_secondary",...e],i=>{let n=+i.dual_pen_primary||0,a=+i.dual_pen_secondary||0;_.each(r,t=>{let p=i[s("weapon",t,"weapon_dual")],c=0;p==="Normal"?c=0:p==="Primary"?c=n:p==="Secondary"&&(c=a);let l=Math.min(0,c);o[s("weapon",t,"weapon_dual_pen")]=l}),setAttrs(o,{silent:!0})})})}on("change:repeating_weapon:weapon_dual",r=>{let o={};getAttrs(["dual_pen_primary","dual_pen_secondary","repeating_weapon_weapon_dual"],e=>{let i=+e.dual_pen_primary||0,n=+e.dual_pen_secondary||0,a=e.repeating_weapon_weapon_dual,t=0;a==="Normal"?t=0:a==="Primary"?t=i:a==="Secondary"&&(t=n);let p=Math.min(0,t);o.repeating_weapon_weapon_dual_pen=p,setAttrs(o,{silent:!0})})});on("change:dual_pen_primary change:dual_pen_secondary change:dexterity",r=>{getAttrs(["dexterity"],o=>{let e={},i=+o.dexterity||0,n=0;i<6?n=Math.max(-3,i-6):i>=18?n=Math.min(5,Math.floor(i/3)-3):i>15&&(n=i-15);let a=Math.min(0,n-2),t=Math.min(0,n-4);e.dual_pen_primary=a,e.dual_pen_secondary=t,setAttrs(e,{silent:!0},mo())})});Pa=r=>{let o={},e=[s("weapon",r,"weapon_range"),s("weapon",r,"weapon_range_short"),s("weapon",r,"weapon_range_medium"),s("weapon",r,"weapon_range_long"),s("weapon",r,"weapon_attack_type"),s("weapon",r,"weapon_range_error")];getAttrs(e,i=>{let n=+i[s("weapon",r,"weapon_attack_type")]||0;if(n===0||n===2)return;let a=i[s("weapon",r,"weapon_range")];a=a.replace(/'/g,""),a=a.replace(/"/g,"");let t=a.split("/").join(",").split(" ").join(",").split("-").join(",").split(","),p=Number(t[0]),c=Number(t[1]),l=Number(t[2]);t.length===1&&p>=0&&!c&&!l&&(c=p,l=p),Number.isNaN(p)?(o[s("weapon",r,"weapon_range_short")]=0,o[s("weapon",r,"weapon_range_error")]=a===""?1:0):o[s("weapon",r,"weapon_range_short")]=p,Number.isNaN(c)?(o[s("weapon",r,"weapon_range_medium")]=0,o[s("weapon",r,"weapon_range_error")]=a===""?1:0):o[s("weapon",r,"weapon_range_medium")]=c,Number.isNaN(l)?(o[s("weapon",r,"weapon_range_long")]=0,o[s("weapon",r,"weapon_range_error")]=a===""?1:0):o[s("weapon",r,"weapon_range_long")]=l,!Number.isNaN(p)&&!Number.isNaN(c)&&!Number.isNaN(l)&&(o[s("weapon",r,"weapon_range_error")]=1),setAttrs(o,{silent:!0})})};on("change:repeating_weapon:weapon_range change:repeating_weapon:weapon_attack_type",r=>{let o=r.sourceAttribute.split("_")[2];Pa(o)});on("change:repeating_weapon:weapon_attack_type",r=>{getAttrs(["repeating_weapon_weapon_attack_type","repeating_weapon_weapon_attack_type_flag"],o=>{let e={},i=+o.repeating_weapon_weapon_attack_type||0,n=+o.repeating_weapon_weapon_attack_type_flag||0;i!==n&&(e.repeating_weapon_weapon_attack_type_flag=i),setAttrs(e,{silent:!0})})});Ke=()=>{getAttrs(["hitpoints","hitpoints_max","sync_hp_flag","hitpoints_1_class","hitpoints_2_class","hitpoints_3_class"],r=>{let o={},e=+r.sync_hp_flag||0,i=+r.hitpoints_max||0,n=Math.max(0,+r.hitpoints_1_class||0),a=Math.max(0,+r.hitpoints_2_class||0),t=Math.max(0,+r.hitpoints_3_class||0),p=n!==0?1:0,c=a!==0?1:0,l=t!==0?1:0,u=p+c+l,h=q(n+a+t),m=O(h/u).toFixed(2);o.hitpoints_class_total=h,o.hp_quotient=u,o.hitpoints_total=m,o.hitpoints_max=e===1?q(m):i,setAttrs(o,{silent:!0})})};on("change:sync_hp_flag change:hitpoints change:hitpoints_max change:hitpoints_1_class change:hitpoints_2_class change:hitpoints_3_class",r=>{Ke()});V=r=>{getAttrs(["armorclass","armorclass_mod","armorclass_magic","armorbonus","armorbonus_toggle","armorbonus_inverted","unarmored_worn","armortype_worn","armortype2_worn","armorshield_worn","armorhelmet_worn","armorother_worn","armorother2_worn","armorother3_worn","armorother4_worn","armorother5_worn","armorother6_worn","unarmored_base","armortype_base","armortype2_base","armorshield_base","armorother_base","armorother2_base","armorother3_base","armorother4_base","armorother5_base","armorother6_base","unarmored_ac","armortype_ac","armortype2_ac","armorshield_ac","armorhelmet_ac","armorother_ac","armorother2_ac","armorother3_ac","armorother4_ac","armorother5_ac","armorother6_ac","armortype_magic","armortype2_magic","armorshield_magic","armorhelmet_magic","armorother_magic","armorother2_magic","armorother3_magic","armorother4_magic","armorother5_magic","armorother6_magic","armorshield_mod","armorother_mod","armorother2_mod","armorother3_mod","armorother4_mod","armorother5_mod","armorother6_mod","autocalc_ac","armor_rating_flag","current_encumbrance_move","sync_ac_flag"],o=>{if((+o.autocalc_ac||0)+r===0)return;let i={},n=+o.armorclass||0,a=+o.sync_ac_flag||0,t=+o.armor_rating_flag||0,p=+o.armorshield_mod*-1||0,c=+o.armorother_mod*-1||0,l=+o.armorother2_mod*-1||0,u=+o.armorother3_mod*-1||0,h=+o.armorother4_mod*-1||0,m=+o.armorother5_mod*-1||0,w=+o.armorother6_mod*-1||0,S=+o.armortype_magic*-1||0,b=+o.armortype2_magic*-1||0,M=+o.armorshield_magic*-1||0,f=+o.armorhelmet_magic*-1||0,T=+o.armorother_magic*-1||0,$=+o.armorother2_magic*-1||0,L=+o.armorother3_magic*-1||0,U=+o.armorother4_magic*-1||0,oe=+o.armorother5_magic*-1||0,K=+o.armorother6_magic*-1||0,me=+o.unarmored_worn||0,ne=+o.armortype_worn||0,re=+o.armortype2_worn||0,Y=+o.armorshield_worn||0,Ee=+o.armorhelmet_worn||0,X=+o.armorother_worn||0,Q=+o.armorother2_worn||0,Z=+o.armorother3_worn||0,_e=+o.armorother4_worn||0,x=+o.armorother5_worn||0,J=+o.armorother6_worn||0,Ce=+o.current_encumbrance_move||0,le=+o.armorbonus_toggle||0,R=+o.armorbonus||0,he=0;Ce===3&&R<0?(le=0,R=0,he=1):R<0?R=+o.armorbonus*le||0:R=+o.armorbonus||0,i.encumbrance_flag=he;let ue=+o.unarmored_base||0,ge=+o.armortype_base||0,we=+o.armortype2_base||0,be=+o.armorshield_base||0,de=+o.armorother_base||0,qe=o.armorother2_base>=0?0:-Math.abs(o.armorother2_base)||0,G=o.armorother3_base>=0?0:-Math.abs(o.armorother3_base)||0,Ie=o.armorother4_base>=0?0:-Math.abs(o.armorother4_base)||0,se=o.armorother5_base>=0?0:-Math.abs(o.armorother5_base)||0,Ne=o.armorother6_base>=0?0:-Math.abs(o.armorother6_base)||0,fe=+o.unarmored_ac||0,fa=+o.armortype_ac||0,ya=+o.armortype2_ac||0,$a=+o.armorshield_ac||0,ka=+o.armorother_ac||0,Aa=o.armorother2_ac>=0?0:-Math.abs(o.armorother2_ac)||0,xa=o.armorother3_ac>=0?0:-Math.abs(o.armorother3_ac)||0,Sa=o.armorother4_ac>=0?0:-Math.abs(o.armorother4_ac)||0,Ma=o.armorother5_ac>=0?0:-Math.abs(o.armorother5_ac)||0,Da=o.armorother6_ac>=0?0:-Math.abs(o.armorother6_ac)||0,Ka=ne?ge:10,Ya=re?we:10,Xa=Y?be:0,Qa=X?de:10,Za=Q?qe:0,Ja=Z?G:0,va=_e?Ie:0,et=x?se:0,at=J?Ne:0,tt=me?ue:10,ot=ne?fa:10,nt=re?ya:10,Ea=Y?$a:0,rt=X?ka:10,_t=Q?Aa:0,st=Z?xa:0,it=_e?Sa:0,pt=x?Ma:0,ct=J?Da:0,mt=me?fe:10,ye=Y?p:0,$e=Y?M:0,lt=q(Math.min(ge,we,de,ue)+be+qe+G+Ie+se+Ne),ht=q(Math.min(fa,ya,ka,fe)+($a+Aa+xa+Sa+Ma+Da)),Ca=q(Math.min(Ka,Ya,Qa,tt)+(Xa+Za+Ja+va+et+at)),Oe=q(Math.min(ot,nt,rt,mt)+(_t+st+it+pt+ct)),Ia=q(S+b+f+T+$+L+U+oe+K+M),ie=q(ne*S+re*b+Ee*f+X*T+Q*$+Z*L+_e*U+x*oe+J*K),Na=q(c+l+u+h+m+w+p)||0,pe=q(X*c+Q*l+Z*u+_e*h+x*m+J*w),Te=q(pe+ie),Re=q(Oe+pe+ie),Oa=1;R>0&&Re>=10&&(Oa=0);let Le=q(Re+R*Oa),v=q(Ea+ye+$e),Be=q(Le+v);R>0&&v>=10&&(Be=q(Le+R+v));let ut=(-1*(ie+$e)<=0?"":"+")+-1*(ie+$e),gt=(-1*Ia<=0?"":"+")+-1*Ia,wt=(-1*(pe+ye)<=0?"":"+")+-1*(pe+ye),bt=(-1*Na<=0?"":"+")+-1*Na,dt=(-1*R<=0?"":"+")+-1*R,qt=(-1*Te<=0?"":"+")+-1*Te,ft=(-1*v<=0?"":"+")+-1*v;i.armorclass_rating_used=Ca,i.armorclass_rating=t===1?"-":Ca,i.armorclass_rating_best=lt,i.armorclass_base_used=Oe+Ea,i.armorclass_base=Oe,i.armorclass_base_best=ht,i.armorclass_magic=ie,i.armorclass_magic_with_shield=ut,i.armorclass_magic_total=gt,i.armorclass_mod=pe,i.armorclass_mod_with_shield=wt,i.armorclass_mod_total=bt,i.armorclass_combined_mod_magic=Te,i.armorclass_combined_mod_magic_inverted=qt,i.armorclass_rear=Re,i.armorbonus_inverted=dt,i.armorclass_shieldless=Le,i.armorclass_shield_magic=$e,i.armorclass_shield_mod=ye,i.armorclass_combined_shield_mod_magic=v,i.armorclass_combined_shield_mod_magic_inverted=ft,i.armorclass_total=Be,i.armorclass=a?Be:n,setAttrs(i,{silent:!0})})};on("change:armor_details_show change:armor_rating_flag change:sync_ac_flag change:autocalc_ac change:unarmored change:armortype change:armortype2 change:armorshield change:armorhelmet change:armorother change:armorother2 change:armorother3 change:armorother4 change:armorother5 change:armorother6 change:armorclass_mod change:armorclass_magic change:armorbonus change:armorbonus_toggle change:unarmored_worn change:armortype_worn change:armortype2_worn change:armorshield_worn change:armorhelmet_worn change:armorother_worn change:armorother2_worn change:armorother3_worn change:armorother4_worn change:armorother5_worn change:armorother6_worn change:armortype_base change:armortype2_base change:armorshield_base change:armorother_base change:armorother2_base change:armorother3_base change:armorother4_base change:armorother5_base change:armorother6_base change:unarmored_base change:armortype_ac change:armortype2_ac change:armorshield_ac change:armorhelmet_ac change:armorother_ac change:armorother2_ac change:armorother3_ac change:armorother4_ac change:armorother5_ac change:armorother6_ac change:unarmored_ac change:armorshield_mod change:armorother_mod change:armorother2_mod change:armorother3_mod change:armorother4_mod change:armorother5_mod change:armorother6_mod change:armortype_magic change:armortype2_magic change:armorshield_magic change:armorhelmet_magic change:armorother_magic change:armorother2_magic change:armorother3_magic change:armorother4_magic change:armorother5_magic change:armorother6_magic",r=>{V(0)});on("clicked:calcac",r=>{V(1)});Me=r=>{getAttrs(["toggle_auto_damage"],o=>{let e={},i=+o.toggle_auto_damage,n=`Damage vs S/M [[ (@{repeating_weapon_${r}_weapon_damagesmallmedium}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,a=` vs LG [[ (@{repeating_weapon_${r}_weapon_damagelarge}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,t=`Damage vs S/M [[ (@{repeating_weapon_${r}_weapon_damagesmallmedium}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,p=` vs LG [[ (@{repeating_weapon_${r}_weapon_damagelarge}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,c=`Damage vs S/M [[ (@{repeating_weapon_${r}_weapon_critdamagesmallmedium}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,l=` vs LG [[ (@{repeating_weapon_${r}_weapon_critdamagelarge}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`,u=`Damage vs S/M [[ (@{repeating_weapon_${r}_weapon_critdamagesmallmedium}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]}}`,h=` vs LG [[ (@{repeating_weapon_${r}_weapon_critdamagelarge}) * @{repeating_weapon_${r}_weapon_backstab_mult}[MULT] + ( @{repeating_weapon_${r}_weapon_attackdmgbonus}[DMG_BON] ) + ( @{repeating_weapon_${r}_weapon_magicbonus}[MAG_BON] ) + ( ?{Damage Modifier?|0}[MISC_MOD] ) ]]`;i===0?(e[`repeating_weapon_${r}_weapon_damagesmallmedium_chat_menu`]=`[Roll Damage](~@{character_id}|repeating_weapon_${r}_weapon_damagesmallmedium_roll)`,e[`repeating_weapon_${r}_weapon_damagelarge_chat_menu`]=`[Roll Damage vs LG](~@{character_id}|repeating_weapon_${r}_weapon_damagelarge_roll)`,e[`repeating_weapon_${r}_weapon_damagesmallmedium_npc_chat_menu`]=`[Damage](~@{character_id}|repeating_weapon_${r}_weapon_damagesmallmedium_npc_roll)`,e[`repeating_weapon_${r}_weapon_damagelarge_npc_chat_menu`]=`[Damage vs LG](~@{character_id}|repeating_weapon_${r}_weapon_damagelarge_npc_roll)`,e[`repeating_weapon_${r}_weapon_critdamagesmallmedium_chat_menu`]=`[Roll Damage](~@{character_id}|repeating_weapon_${r}_weapon_critdamagesmallmedium_roll)`,e[`repeating_weapon_${r}_weapon_critdamagelarge_chat_menu`]=`[Roll Damage vs LG](~@{character_id}|repeating_weapon_${r}_weapon_critdamagelarge_roll)`,e[`repeating_weapon_${r}_weapon_critdamagesmallmedium_npc_chat_menu`]=`[Damage](~@{character_id}|repeating_weapon_${r}_weapon_critdamagesmallmedium_npc_roll)`,e[`repeating_weapon_${r}_weapon_critdamagelarge_npc_chat_menu`]=`[Damage vs LG](~@{character_id}|repeating_weapon_${r}_weapon_critdamagelarge_npc_roll)`):(e[`repeating_weapon_${r}_weapon_damagesmallmedium_chat_menu`]=n,e[`repeating_weapon_${r}_weapon_damagelarge_chat_menu`]=a,e[`repeating_weapon_${r}_weapon_damagesmallmedium_npc_chat_menu`]=t,e[`repeating_weapon_${r}_weapon_damagelarge_npc_chat_menu`]=p,e[`repeating_weapon_${r}_weapon_critdamagesmallmedium_chat_menu`]=c,e[`repeating_weapon_${r}_weapon_critdamagelarge_chat_menu`]=l,e[`repeating_weapon_${r}_weapon_critdamagesmallmedium_npc_chat_menu`]=u,e[`repeating_weapon_${r}_weapon_critdamagelarge_npc_chat_menu`]=h),setAttrs(e,{silent:!0})})};on("change:repeating_weapon:weapon_name change:repeating_weapon:weapon_damagesmallmedium change:repeating_weapon:weapon_damagelarge change:repeating_weapon:weapon_critdamagesmallmedium change:repeating_weapon:weapon_critdamagelarge change:repeating_weapon:weapon_attackdmgbonus change:repeating_weapon:weapon_critdamage_flag",r=>{let o=r.sourceAttribute.split("_")[2];Me(o)});on("change:toggle_critdamage",r=>{getSectionIDs("repeating_weapon",o=>{let e={},i=[];_.each(o,n=>{i.push(s("weapon",n,"weapon_critdamage_flag"))}),getAttrs(i,n=>{o.forEach(a=>{let t=+n[s("weapon",a,"weapon_critdamage_flag")];e[s("weapon",a,"weapon_critdamage_flag")]=1-t}),setAttrs(e)})})});on("change:toggle_auto_damage change:toggle_critdamage",r=>{g(`Change Detected:${r.sourceAttribute}`),getSectionIDs("repeating_weapon",o=>{let e=[];getAttrs(e,i=>{o.forEach(n=>{Me(n)})})})});function lo(r){let o={},e=[s("weapon",r,"weapon_use"),s("weapon",r,"weapon_attack_type"),s("weapon",r,"weapon_attack_type_flag"),s("weapon",r,"weapon_critdamage_flag"),s("weapon",r,"weapon_prof_pen"),s("weapon",r,"weapon_range_error"),s("weapon",r,"weapon_tohitacadj"),s("weapon",r,"weapon_dual"),s("weapon",r,"weapon_whisper_to_hit"),s("weapon",r,"weapon_whisper_to_hit_select"),s("weapon",r,"weapon_dual_pen"),s("weapon",r,"weapon_backstab_var"),s("weapon",r,"weapon_tohitbonus"),s("weapon",r,"weapon_magicbonus"),s("weapon",r,"weapon_prof"),s("weapon",r,"weapon_backstab"),s("weapon",r,"weapon_backstab_bonus"),s("weapon",r,"weapon_backstab_mult"),s("weapon",r,"weapon_attackdmgbonus"),s("weapon",r,"weapon_num_attacks"),s("weapon",r,"weapon_quantity"),s("weapon",r,"weapon_ammo"),s("weapon",r,"weapon_ammo_max"),s("weapon",r,"weapon_weight"),s("weapon",r,"weapon_cost"),s("weapon",r,"weapon_range_short"),s("weapon",r,"weapon_range_medium"),s("weapon",r,"weapon_range_long"),s("weapon",r,"weapon_length"),s("weapon",r,"weapon_space"),s("weapon",r,"weapon_speed"),s("weapon",r,"weapon_misc"),s("weapon",r,"weapon_thac_adj0"),s("weapon",r,"weapon_thac_adj1"),s("weapon",r,"weapon_thac_adj2"),s("weapon",r,"weapon_thac_adj3"),s("weapon",r,"weapon_thac_adj4"),s("weapon",r,"weapon_thac_adj5"),s("weapon",r,"weapon_thac_adj6"),s("weapon",r,"weapon_thac_adj7"),s("weapon",r,"weapon_thac_adj8"),s("weapon",r,"weapon_thac_adj9"),s("weapon",r,"weapon_thac_adj10"),s("weapon",r,"weapon_macro_text"),s("weapon",r,"weapon_damagesmallmedium_chat_menu"),s("weapon",r,"weapon_damagelarge_chat_menu"),s("weapon",r,"weapon_damagesmallmedium_npc_chat_menu"),s("weapon",r,"weapon_damagelarge_npc_chat_menu"),s("weapon",r,"weapon_critdamagesmallmedium_chat_menu"),s("weapon",r,"weapon_critdamagelarge_chat_menu"),s("weapon",r,"weapon_critdamagesmallmedium_npc_chat_menu"),s("weapon",r,"weapon_critdamagelarge_npc_chat_menu"),s("weapon",r,"weapon_damage_chat_menu_npc")];getAttrs(e,i=>{o.repeating_weapon_weapon_use=+i[s("weapon",r,"weapon_use")]||0,o.repeating_weapon_weapon_attack_type_flag=+i[s("weapon",r,"weapon_attack_type_flag")]||0,o.repeating_weapon_weapon_critdamage_flag=+i[s("weapon",r,"weapon_critdamage_flag")]||1,o.repeating_weapon_weapon_prof_pen=+i[s("weapon",r,"weapon_prof_pen")]||0,o.repeating_weapon_weapon_range_error=+i[s("weapon",r,"weapon_range_error")]||1,o.repeating_weapon_weapon_tohitacadj=+i[s("weapon",r,"weapon_tohitacadj")]||1,o.repeating_weapon_weapon_attack_type=+i[s("weapon",r,"weapon_attack_type")]||0,o.repeating_weapon_weapon_dual=i[s("weapon",r,"weapon_dual")],o.repeating_weapon_weapon_whisper_to_hit=i[s("weapon",r,"weapon_whisper_to_hit")],o.repeating_weapon_weapon_whisper_to_hit_select=+i[s("weapon",r,"weapon_whisper_to_hit_select")]||0,o.repeating_weapon_weapon_dual_pen=+i[s("weapon",r,"weapon_dual_pen")]||0,o.repeating_weapon_weapon_backstab_var=+i[s("weapon",r,"weapon_backstab_var")]||0,o.repeating_weapon_weapon_tohitbonus=+i[s("weapon",r,"weapon_tohitbonus")]||0,o.repeating_weapon_weapon_magicbonus=+i[s("weapon",r,"weapon_magicbonus")]||0,o.repeating_weapon_weapon_prof=+i[s("weapon",r,"weapon_prof")]||0,o.repeating_weapon_weapon_backstab=+i[s("weapon",r,"weapon_backstab")]||0,o.repeating_weapon_weapon_backstab_bonus=+i[s("weapon",r,"weapon_backstab_bonus")]||0,o.repeating_weapon_weapon_backstab_mult=+i[s("weapon",r,"weapon_backstab_mult")]||0,o.repeating_weapon_weapon_attackdmgbonus=+i[s("weapon",r,"weapon_attackdmgbonus")]||0,o.repeating_weapon_weapon_num_attacks=+i[s("weapon",r,"weapon_num_attacks")]||0,o.repeating_weapon_weapon_quantity=+i[s("weapon",r,"weapon_quantity")]||0,o.repeating_weapon_weapon_ammo=+i[s("weapon",r,"weapon_ammo")]||0,o.repeating_weapon_weapon_ammo_max=+i[s("weapon",r,"weapon_ammo_max")]||0,o.repeating_weapon_weapon_weight=+i[s("weapon",r,"weapon_weight")]||0,o.repeating_weapon_weapon_cost=+i[s("weapon",r,"weapon_cost")]||0,o.repeating_weapon_weapon_range_short=+i[s("weapon",r,"weapon_range_short")]||0,o.repeating_weapon_weapon_range_medium=+i[s("weapon",r,"weapon_range_medium")]||0,o.repeating_weapon_weapon_range_long=+i[s("weapon",r,"weapon_range_long")]||0,o.repeating_weapon_weapon_length=i[s("weapon",r,"weapon_length")],o.repeating_weapon_weapon_space=i[s("weapon",r,"weapon_space")],o.repeating_weapon_weapon_speed=i[s("weapon",r,"weapon_speed")],o.repeating_weapon_weapon_misc=i[s("weapon",r,"weapon_misc")],o.repeating_weapon_weapon_thac_adj0=+i[s("weapon",r,"weapon_thac_adj0")]||0,o.repeating_weapon_weapon_thac_adj1=+i[s("weapon",r,"weapon_thac_adj1")]||0,o.repeating_weapon_weapon_thac_adj2=+i[s("weapon",r,"weapon_thac_adj2")]||0,o.repeating_weapon_weapon_thac_adj3=+i[s("weapon",r,"weapon_thac_adj3")]||0,o.repeating_weapon_weapon_thac_adj4=+i[s("weapon",r,"weapon_thac_adj4")]||0,o.repeating_weapon_weapon_thac_adj5=+i[s("weapon",r,"weapon_thac_adj5")]||0,o.repeating_weapon_weapon_thac_adj6=+i[s("weapon",r,"weapon_thac_adj6")]||0,o.repeating_weapon_weapon_thac_adj7=+i[s("weapon",r,"weapon_thac_adj7")]||0,o.repeating_weapon_weapon_thac_adj8=+i[s("weapon",r,"weapon_thac_adj8")]||0,o.repeating_weapon_weapon_thac_adj9=+i[s("weapon",r,"weapon_thac_adj9")]||0,o.repeating_weapon_weapon_thac_adj10=+i[s("weapon",r,"weapon_thac_adj10")]||0,o.repeating_weapon_weapon_macro_text=i[s("weapon",r,"weapon_macro_text")],o.repeating_weapon_weapon_damagesmallmedium_chat_menu=i[s("weapon",r,"weapon_damagesmallmedium_chat_menu")],o.repeating_weapon_weapon_damagelarge_chat_menu=i[s("weapon",r,"weapon_damagelarge_chat_menu")],o.repeating_weapon_weapon_damagesmallmedium_npc_chat_menu=i[s("weapon",r,"weapon_damagesmallmedium_npc_chat_menu")],o.repeating_weapon_weapon_damagelarge_npc_chat_menu=i[s("weapon",r,"weapon_damagelarge_npc_chat_menu")],o.repeating_weapon_weapon_critdamagesmallmedium_chat_menu=i[s("weapon",r,"weapon_critdamagesmallmedium_chat_menu")],o.repeating_weapon_weapon_critdamagelarge_chat_menu=i[s("weapon",r,"weapon_critdamagelarge_chat_menu")],o.repeating_weapon_weapon_critdamagesmallmedium_npc_chat_menu=i[s("weapon",r,"weapon_critdamagesmallmedium_npc_chat_menu")],o.repeating_weapon_weapon_critdamagelarge_npc_chat_menu=i[s("weapon",r,"weapon_critdamagelarge_npc_chat_menu")],o.repeating_weapon_weapon_damage_chat_menu_npc=i[s("weapon",r,"weapon_damage_chat_menu_npc")],setAttrs(o,{silent:!0})})}function ho(r){let o={},e=["equipment_tabs_type","equipment_tabs_carry"],i=[s("equipment",r,"equipment_type"),s("equipment",r,"equipment_magical"),s("equipment",r,"equipment_show_type"),s("equipment",r,"equipment_show_carry"),s("equipment",r,"equipment_current"),s("equipment",r,"equipment_current_max"),s("equipment",r,"equipment_carried_select"),s("equipment",r,"equipment_carried"),s("equipment",r,"equipment_quantity"),s("equipment",r,"equipment_quantity_max"),s("equipment",r,"equipment_weight"),s("equipment",r,"equipment_cost"),s("equipment",r,"equipment_armor_type"),s("equipment",r,"equipment_armor_worn"),s("equipment",r,"equipment_armor_ac"),s("equipment",r,"equipment_armor_base"),s("equipment",r,"equipment_armor_magic"),s("equipment",r,"equipment_armor_mod"),s("equipment",r,"equipment_armor_bulk"),s("equipment",r,"equipment_macro_text"),s("equipment",r,"equipment_weapon_type"),s("equipment",r,"equipment_weapon_speed"),s("equipment",r,"equipment_weapon_misc"),s("equipment",r,"equipment_weapon_length"),s("equipment",r,"equipment_weapon_space"),s("equipment",r,"equipment_weapon_damagesmallmedium"),s("equipment",r,"equipment_weapon_damagelarge"),s("equipment",r,"equipment_weapon_attackdmgtype"),s("equipment",r,"equipment_weapon_rateoffire"),s("equipment",r,"equipment_weapon_range")],n=[...e,...i];getAttrs(n,a=>{let t=+a.equipment_tabs_type||0,p=+a[s("equipment",r,"equipment_type")]||0;o.repeating_equipment_equipment_type=p<=0||t===-1?0:p,o.repeating_equipment_equipment_magical=+a[s("equipment",r,"equipment_magical")]||0,o.repeating_equipment_equipment_show_type=+a[s("equipment",r,"equipment_show_type")]||0,o.repeating_equipment_equipment_current=+a[s("equipment",r,"equipment_current")]||0,o.repeating_equipment_equipment_current_max=+a[s("equipment",r,"equipment_current_max")]||0,o.repeating_equipment_equipment_carried_select=+a[s("equipment",r,"equipment_carried_select")]||1,o.repeating_equipment_equipment_carried=+a[s("equipment",r,"equipment_carried")]||1,o.repeating_equipment_equipment_quantity=+a[s("equipment",r,"equipment_quantity")]||1,o.repeating_equipment_equipment_quantity_max=+a[s("equipment",r,"equipment_quantity_max")]||1,o.repeating_equipment_equipment_weight=+a[s("equipment",r,"equipment_weight")]||0,o.repeating_equipment_equipment_cost=+a[s("equipment",r,"equipment_cost")]||0,o.repeating_equipment_equipment_armor_type=+a[s("equipment",r,"equipment_armor_type")]||0,o.repeating_equipment_equipment_armor_worn=+a[s("equipment",r,"equipment_armor_worn")]||0,o.repeating_equipment_equipment_armor_ac=+a[s("equipment",r,"equipment_armor_ac")]||0,o.repeating_equipment_equipment_armor_base=+a[s("equipment",r,"equipment_armor_base")]||0,o.repeating_equipment_equipment_armor_magic=+a[s("equipment",r,"equipment_armor_magic")]||0,o.repeating_equipment_equipment_armor_mod=+a[s("equipment",r,"equipment_armor_mod")]||0,o.repeating_equipment_equipment_armor_bulk=+a[s("equipment",r,"equipment_armor_bulk")]||0,o.repeating_equipment_equipment_macro_text=a[s("equipment",r,"equipment_macro_text")],o.repeating_equipment_equipment_weapon_type=+a[s("equipment",r,"equipment_weapon_type")]||0,o.repeating_equipment_equipment_weapon_speed=a[s("equipment",r,"equipment_weapon_speed")],o.repeating_equipment_equipment_weapon_misc=a[s("equipment",r,"equipment_weapon_misc")],o.repeating_equipment_equipment_weapon_length=a[s("equipment",r,"equipment_weapon_length")],o.repeating_equipment_equipment_weapon_space=a[s("equipment",r,"equipment_weapon_space")],o.repeating_equipment_equipment_weapon_damagesmallmedium=a[s("equipment",r,"equipment_weapon_damagesmallmedium")],o.repeating_equipment_equipment_weapon_damagelarge=a[s("equipment",r,"equipment_weapon_damagelarge")],o.repeating_equipment_equipment_weapon_attackdmgtype=a[s("equipment",r,"equipment_weapon_attackdmgtype")],o.repeating_equipment_equipment_weapon_rateoffire=a[s("equipment",r,"equipment_weapon_rateoffire")],o.repeating_equipment_equipment_weapon_range=a[s("equipment",r,"equipment_weapon_range")],setAttrs(o,{silent:!0})})}function uo(r){let o={},e=[s("nonweaponproficiencies",r,"nwp_attribute"),s("nonweaponproficiencies",r,"nwp_slots"),s("nonweaponproficiencies",r,"nwp_modifier"),s("nonweaponproficiencies",r,"nwp_macro_text")];getAttrs(e,i=>{o.repeating_nonweaponproficiencies_attribute=+i[s("nonweaponproficiencies",r,"nwp_attribute")]||0,o.repeating_nonweaponproficiencies_slots=+i[s("nonweaponproficiencies",r,"nwp_slots")]||0,o.repeating_nonweaponproficiencies_modifier=+i[s("nonweaponproficiencies",r,"nwp_modifier")]||0,o.repeating_nonweaponproficiencies_macro_text=i[s("nonweaponproficiencies",r,"nwp_macro_text")]||0,setAttrs(o,{silent:!0})})}on("change:repeating_weapon:weapon_name change:repeating_equipment:equipment_item change:repeating_nonweaponproficiencies:nwp_name",r=>{let o=r.sourceAttribute.split("_")[2];r.sourceType==="player"&&r.previousValue===void 0&&(r.sourceAttribute.includes("equipment_item")&&ho(o),r.sourceAttribute.includes("weapon_name")&&lo(o),r.sourceAttribute.includes("nwp_name")&&uo(o))});on("sheet:opened",r=>{getSectionIDs("repeating_weapon",o=>{getSectionIDs("repeating_ability",e=>{getSectionIDs("repeating_nonweaponproficiencies",i=>{getSectionIDs("repeating_equipment",n=>{getSectionIDs("repeating_spells",a=>{let t={},p=o.length,c=e.length,l=i.length,u=n.length,h=a.length;if(p===0){let m=k();t[`repeating_weapon_${m}_weapon_value`]=1}if(c===0){let m=k();t[`repeating_ability_${m}_ability_value`]=1}if(l===0){let m=k();t[`repeating_nonweaponproficiencies_${m}_nwp_value`]=1}if(u===0){let m=k();t[`repeating_equipment_${m}_equipment_value`]=1}if(h===0){let m=k();t[`repeating_spells_${m}_spell_value`]=1}else return;setAttrs(t,{silent:!0})})})})})})});on("clicked:resetallmacros clicked:resetequipmentmacros clicked:resetweaponsmacros clicked:resetabilitiesmacros clicked:resetnwpsmacros clicked:resetspellsmacros",r=>{let e=r.triggerName.match(/clicked:(\w+)/),i=e?e[1]:null;getSectionIDs("repeating_equipment",n=>{getSectionIDs("repeating_weapon",a=>{getSectionIDs("repeating_ability",t=>{getSectionIDs("repeating_nonweaponproficiencies",p=>{getSectionIDs("repeating_spells",c=>{let l={},u=[],h=[],m=[],w=[],S=[];_.each(n,b=>{u.push(`repeating_equipment_${b}_equipment_macro_text`)}),_.each(a,b=>{h.push(`repeating_weapon_${b}_weapon_macro_text`)}),_.each(t,b=>{m.push(`repeating_ability_${b}_ability_macro_text`)}),_.each(p,b=>{w.push(`repeating_nonweaponproficiencies_${b}_nwp_macro_text`)}),_.each(c,b=>{S.push(`repeating_spells_${b}_spell_macro_text`)}),i==="resetallmacros"&&(l.surprise_macro_text="",l.surprise_others_macro_text="",l.init_macro_text="",_.each(n,b=>{l[`repeating_equipment_${b}_equipment_macro_text`]=""}),_.each(a,b=>{l[`repeating_weapon_${b}_weapon_macro_text`]=""}),_.each(t,b=>{l[`repeating_ability_${b}_ability_macro_text`]=""}),_.each(p,b=>{l[`repeating_nonweaponproficiencies_${b}_nwp_macro_text`]=""}),_.each(c,b=>{l[`repeating_spells_${b}_spell_macro_text`]=""})),i==="resetequipmentmacros"&&_.each(n,b=>{l[`repeating_equipment_${b}_equipment_macro_text`]=""}),i==="resetweaponsmacros"&&_.each(a,b=>{l[`repeating_weapon_${b}_weapon_macro_text`]=""}),i==="resetabilitiesmacros"&&_.each(t,b=>{l[`repeating_ability_${b}_ability_macro_text`]=""}),i==="resetnwpsmacros"&&_.each(p,b=>{l[`repeating_nonweaponproficiencies_${b}_nwp_macro_text`]=""}),i==="resetspellsmacros"&&_.each(c,b=>{l[`repeating_spells_${b}_spell_macro_text`]=""}),setAttrs(l,{silent:!0})})})})})})});na=r=>{getAttrs(["pickpockets","pickpockets_base","pickpockets_racial_mod","pickpockets_ability_mod","pickpockets_magic"],o=>{let e={},i=+o.pickpockets_base||0,n=+o.pickpockets_racial_mod||0,a=+o.pickpockets_ability_mod||0,t=+o.pickpockets_magic||0,p=+o.pickpockets||0,c=Math.max(0,q(i+n+a+t));r===1&&p>=0&&c===0?e.pickpockets_base=p:e.pickpockets=c,setAttrs(e,{silent:!0})})};oa=r=>{getAttrs(["openlocks","openlocks_base","openlocks_racial_mod","openlocks_ability_mod","openlocks_magic"],o=>{let e={},i=+o.openlocks_base||0,n=+o.openlocks_racial_mod||0,a=+o.openlocks_ability_mod||0,t=+o.openlocks_magic||0,p=+o.openlocks||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.openlocks_base=p:e.openlocks=c,setAttrs(e,{silent:!0})})};Je=r=>{getAttrs(["findtraps","findtraps_base","findtraps_racial_mod","findtraps_ability_mod","findtraps_magic"],o=>{let e={},i=+o.findtraps_base||0,n=+o.findtraps_racial_mod||0,a=+o.findtraps_ability_mod||0,t=+o.findtraps_magic||0,p=+o.findtraps||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.findtraps_base=p:e.findtraps=c,setAttrs(e,{silent:!0})})};ta=r=>{getAttrs(["movequietly","movequietly_base","movequietly_racial_mod","movequietly_ability_mod","movequietly_magic"],o=>{let e={},i=+o.movequietly_base||0,n=+o.movequietly_racial_mod||0,a=+o.movequietly_ability_mod||0,t=+o.movequietly_magic||0,p=+o.movequietly||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.movequietly_base=p:e.movequietly=c,setAttrs(e,{silent:!0})})};ea=r=>{getAttrs(["hideinshadows","hideinshadows_base","hideinshadows_racial_mod","hideinshadows_ability_mod","hideinshadows_magic"],o=>{let e={},i=+o.hideinshadows_base||0,n=+o.hideinshadows_racial_mod||0,a=+o.hideinshadows_ability_mod||0,t=+o.hideinshadows_magic||0,p=+o.hideinshadows||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.hideinshadows_base=p:e.hideinshadows=c,setAttrs(e,{silent:!0})})};ve=r=>{getAttrs(["hearnoise","hearnoise_base","hearnoise_racial_mod","hearnoise_ability_mod","hearnoise_magic"],o=>{let e={},i=+o.hearnoise_base||0,n=+o.hearnoise_racial_mod||0,a=+o.hearnoise_ability_mod||0,t=+o.hearnoise_magic||0,p=+o.hearnoise||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.hearnoise_base=p:e.hearnoise=c,setAttrs(e,{silent:!0})})};Xe=r=>{getAttrs(["climbwalls","climbwalls_base","climbwalls_racial_mod","climbwalls_ability_mod","climbwalls_magic"],o=>{let e={},i=+o.climbwalls_base||0;i=i>=99.1?i.toFixed(1):Math.floor(i);let n=+o.climbwalls_racial_mod||0,a=+o.climbwalls_ability_mod||0,t=+o.climbwalls_magic||0,p=+o.climbwalls||0,c=Math.max(0,Math.min(100,i+q(n+a+t))),l="@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Climb Walls}} {{roll_low=[[ 1d100 ]]%}} {{roll_target=[[ @{climbwalls} ]]%}}",u="@{whisper_pc} &{template:general} {{color=@{color_option}}} {{name=@{character_name}}} {{subtag=Climb Walls}} {{roll_low=[[ 1d100 + [[1d10/10]] ]]%}} {{roll_target=[[ @{climbwalls} ]]%}}";r===1?p>=0&&c===0?e.climbwalls_base=p:e.climbwalls=c:(e.climbwalls=c,e.climbwalls_macro_text=c>=99.1?u:l),setAttrs(e,{silent:!0})})};ra=r=>{getAttrs(["readlanguages","readlanguages_base","readlanguages_racial_mod","readlanguages_ability_mod","readlanguages_magic"],o=>{let e={},i=+o.readlanguages_base||0,n=+o.readlanguages_racial_mod||0,a=+o.readlanguages_ability_mod||0,t=+o.readlanguages_magic||0,p=+o.readlanguages||0,c=Math.max(0,Math.min(100,q(i+n+a+t)));r===1&&p>=0&&c===0?e.readlanguages_base=p:e.readlanguages=c,setAttrs(e,{silent:!0})})};ga=()=>{getAttrs(["thiefmisc","thiefmisc_base","thiefmisc_racial_mod","thiefmisc_ability_mod","thiefmisc_magic"],r=>{let o={},e=+r.thiefmisc_base||0,i=+r.thiefmisc_racial_mod||0,n=+r.thiefmisc_ability_mod||0,a=+r.thiefmisc_magic||0,t=Math.max(0,Math.min(100,q(e+i+n+a)));o.thiefmisc=t,setAttrs(o,{silent:!0})})};ha=()=>{getAttrs(["thiefmisc1","thiefmisc1_base","thiefmisc1_racial_mod","thiefmisc1_ability_mod","thiefmisc1_magic"],r=>{let o={},e=+r.thiefmisc1_base||0,i=+r.thiefmisc1_racial_mod||0,n=+r.thiefmisc1_ability_mod||0,a=+r.thiefmisc1_magic||0,t=Math.max(0,Math.min(100,q(e+i+n+a)));o.thiefmisc1=t,setAttrs(o,{silent:!0})})};ua=()=>{getAttrs(["thiefmisc2","thiefmisc2_base","thiefmisc2_racial_mod","thiefmisc2_ability_mod","thiefmisc2_magic"],r=>{let o={},e=+r.thiefmisc2_base||0,i=+r.thiefmisc2_racial_mod||0,n=+r.thiefmisc2_ability_mod||0,a=+r.thiefmisc2_magic||0,t=Math.max(0,Math.min(100,q(e+i+n+a)));o.thiefmisc2=t,setAttrs(o,{silent:!0})})};on("change:pickpockets_base change:pickpockets_racial_mod change:pickpockets_ability_mod change:pickpockets_magic",r=>{na()});on("change:openlocks_base change:openlocks_racial_mod change:openlocks_ability_mod change:openlocks_magic",r=>{oa()});on("change:findtraps_base change:findtraps_racial_mod change:findtraps_ability_mod change:findtraps_magic",r=>{Je()});on("change:movequietly_base change:movequietly_racial_mod change:movequietly_ability_mod change:movequietly_magic",r=>{ta()});on("change:hideinshadows_base change:hideinshadows_racial_mod change:hideinshadows_ability_mod change:hideinshadows_magic",r=>{ea()});on("change:hearnoise_base change:hearnoise_racial_mod change:hearnoise_ability_mod change:hearnoise_magic",r=>{ve()});on("change:climbwalls_base change:climbwalls_racial_mod change:climbwalls_ability_mod change:climbwalls_magic",r=>{Xe()});on("change:readlanguages_base change:readlanguages_racial_mod change:readlanguages_ability_mod change:readlanguages_magic",r=>{ra()});on("change:thiefmisc_base change:thiefmisc_racial_mod change:thiefmisc_ability_mod change:thiefmisc_magic",r=>{ga()});on("change:thiefmisc1_base change:thiefmisc1_racial_mod change:thiefmisc1_ability_mod change:thiefmisc1_magic",r=>{ha()});on("change:thiefmisc2_base change:thiefmisc2_racial_mod change:thiefmisc2_ability_mod change:thiefmisc2_magic",r=>{ua()});on("change:thief_level change:autofill_thief change:sync_thief_class change:thief_class_selected change:class change:secondclass change:thirdclass change:level change:level_2 change:level_3",r=>{g(`Thief Autofill Change Detected:${r.sourceAttribute}`),getAttrs(["thief_level","autofill_thief","sync_thief_class","thief_class_selected","class","secondclass","thirdclass","level","level_2","level_3"],o=>{let e={},i=+o.autofill_thief||0,n=+o.sync_thief_class||0;if(!i)return;let a=+o.thief_class_selected||1,t=+o.thief_level||0,p=o.class||"",c=o.secondclass||"",l=o.thirdclass||"";n===1&&(a===1&&(classSelected=te(p),t=+o.level,e.thief_level=t),a===2&&(classSelected=te(c),t=+o.level_2,e.thief_level=t),a===3&&(classSelected=te(l),t=+o.level_3,e.thief_level=t)),t!==0&&(t===1&&(e.pickpockets_base=30,e.openlocks_base=25,e.findtraps_base=20,e.movequietly_base=15,e.hideinshadows_base=10,e.hearnoise_base=10,e.climbwalls_base=85,e.readlanguages_base=0),t===2&&(e.pickpockets_base=35,e.openlocks_base=29,e.findtraps_base=25,e.movequietly_base=21,e.hideinshadows_base=15,e.hearnoise_base=10,e.climbwalls_base=86,e.readlanguages_base=0),t===3&&(e.pickpockets_base=40,e.openlocks_base=33,e.findtraps_base=30,e.movequietly_base=27,e.hideinshadows_base=20,e.hearnoise_base=15,e.climbwalls_base=87,e.readlanguages_base=0),t===4&&(e.pickpockets_base=45,e.openlocks_base=37,e.findtraps_base=35,e.movequietly_base=33,e.hideinshadows_base=25,e.hearnoise_base=15,e.climbwalls_base=88,e.readlanguages_base=20),t===5&&(e.pickpockets_base=50,e.openlocks_base=42,e.findtraps_base=40,e.movequietly_base=40,e.hideinshadows_base=31,e.hearnoise_base=20,e.climbwalls_base=90,e.readlanguages_base=25),t===6&&(e.pickpockets_base=55,e.openlocks_base=47,e.findtraps_base=45,e.movequietly_base=47,e.hideinshadows_base=37,e.hearnoise_base=20,e.climbwalls_base=92,e.readlanguages_base=30),t===7&&(e.pickpockets_base=60,e.openlocks_base=52,e.findtraps_base=50,e.movequietly_base=55,e.hideinshadows_base=43,e.hearnoise_base=25,e.climbwalls_base=94,e.readlanguages_base=35),t===8&&(e.pickpockets_base=65,e.openlocks_base=57,e.findtraps_base=55,e.movequietly_base=62,e.hideinshadows_base=49,e.hearnoise_base=25,e.climbwalls_base=96,e.readlanguages_base=40),t===9&&(e.pickpockets_base=70,e.openlocks_base=62,e.findtraps_base=60,e.movequietly_base=70,e.hideinshadows_base=56,e.hearnoise_base=30,e.climbwalls_base=98,e.readlanguages_base=45),t===10&&(e.pickpockets_base=80,e.openlocks_base=67,e.findtraps_base=65,e.movequietly_base=78,e.hideinshadows_base=63,e.hearnoise_base=30,e.climbwalls_base=99,e.readlanguages_base=50),t===11&&(e.pickpockets_base=90,e.openlocks_base=72,e.findtraps_base=70,e.movequietly_base=86,e.hideinshadows_base=70,e.hearnoise_base=35,e.climbwalls_base=99.1,e.readlanguages_base=55),t===12&&(e.pickpockets_base=100,e.openlocks_base=77,e.findtraps_base=75,e.movequietly_base=94,e.hideinshadows_base=77,e.hearnoise_base=35,e.climbwalls_base=99.2,e.readlanguages_base=60),t===13&&(e.pickpockets_base=105,e.openlocks_base=82,e.findtraps_base=80,e.movequietly_base=99,e.hideinshadows_base=85,e.hearnoise_base=40,e.climbwalls_base=99.3,e.readlanguages_base=65),t===14&&(e.pickpockets_base=110,e.openlocks_base=87,e.findtraps_base=85,e.movequietly_base=99,e.hideinshadows_base=93,e.hearnoise_base=40,e.climbwalls_base=99.4,e.readlanguages_base=70),t===15&&(e.pickpockets_base=115,e.openlocks_base=92,e.findtraps_base=90,e.movequietly_base=99,e.hideinshadows_base=99,e.hearnoise_base=50,e.climbwalls_base=99.5,e.readlanguages_base=75),t===16&&(e.pickpockets_base=125,e.openlocks_base=97,e.findtraps_base=95,e.movequietly_base=99,e.hideinshadows_base=99,e.hearnoise_base=50,e.climbwalls_base=99.6,e.readlanguages_base=80),t===17&&(e.pickpockets_base=125,e.openlocks_base=99,e.findtraps_base=99,e.movequietly_base=99,e.hideinshadows_base=99,e.hearnoise_base=55,e.climbwalls_base=99.7,e.readlanguages_base=80),t>17&&(e.pickpockets_base=125,e.openlocks_base=99,e.findtraps_base=99,e.movequietly_base=99,e.hideinshadows_base=99,e.hearnoise_base=55,e.climbwalls_base=99.7,e.readlanguages_base=80),setAttrs(e))})});sa=r=>{getAttrs(["saveparalysispoisondeath","saveparalysispoisondeath_base","saveparalysispoisondeath_racial_mod","saveparalysispoisondeath_ability_mod","saveparalysispoisondeath_misc_mod","saveparalysispoisondeath_temp_mod"],o=>{let e={},i=+o.saveparalysispoisondeath_base||0,n=+o.saveparalysispoisondeath_racial_mod||0,a=+o.saveparalysispoisondeath_ability_mod||0,t=+o.saveparalysispoisondeath_misc_mod||0,p=+o.saveparalysispoisondeath_temp_mod||0,c=+o.saveparalysispoisondeath||0,l=q(i+n+a+t+p);r===1&&c<=20&&l===20?e.saveparalysispoisondeath_base=c:e.saveparalysispoisondeath=l,setAttrs(e,{silent:!0})})};ia=r=>{getAttrs(["savepetrificationpolymorph","savepetrificationpolymorph_base","savepetrificationpolymorph_racial_mod","savepetrificationpolymorph_ability_mod","savepetrificationpolymorph_misc_mod","savepetrificationpolymorph_temp_mod"],o=>{let e={},i=+o.savepetrificationpolymorph_base||0,n=+o.savepetrificationpolymorph_racial_mod||0,a=+o.savepetrificationpolymorph_ability_mod||0,t=+o.savepetrificationpolymorph_misc_mod||0,p=+o.savepetrificationpolymorph_temp_mod||0,c=+o.savepetrificationpolymorph||0,l=q(i+n+a+t+p);r===1&&c<=20&&l===20?e.savepetrificationpolymorph_base=c:e.savepetrificationpolymorph=l,setAttrs(e,{silent:!0})})};pa=r=>{getAttrs(["saverodsstaveswands","saverodsstaveswands_base","saverodsstaveswands_racial_mod","saverodsstaveswands_ability_mod","saverodsstaveswands_misc_mod","saverodsstaveswands_temp_mod"],o=>{let e={},i=+o.saverodsstaveswands_base||0,n=+o.saverodsstaveswands_racial_mod||0,a=+o.saverodsstaveswands_ability_mod||0,t=+o.saverodsstaveswands_misc_mod||0,p=+o.saverodsstaveswands_temp_mod||0,c=+o.saverodsstaveswands||0,l=q(i+n+a+t+p);r===1&&c<=20&&l===20?e.saverodsstaveswands_base=c:e.saverodsstaveswands=l,setAttrs(e,{silent:!0})})};_a=r=>{getAttrs(["savebreathweapons","savebreathweapons_base","savebreathweapons_racial_mod","savebreathweapons_ability_mod","savebreathweapons_misc_mod","savebreathweapons_temp_mod"],o=>{let e={},i=+o.savebreathweapons_base||0,n=+o.savebreathweapons_racial_mod||0,a=+o.savebreathweapons_ability_mod||0,t=+o.savebreathweapons_misc_mod||0,p=+o.savebreathweapons_temp_mod||0,c=+o.savebreathweapons||0,l=q(i+n+a+t+p);r===1&&c<=20&&l===20?e.savebreathweapons_base=c:e.savebreathweapons=l,setAttrs(e,{silent:!0})})};ca=r=>{getAttrs(["savespells","savespells_base","savespells_racial_mod","savespells_ability_mod","savespells_misc_mod","savespells_temp_mod"],o=>{let e={},i=+o.savespells_base||0,n=+o.savespells_racial_mod||0,a=+o.savespells_ability_mod||0,t=+o.savespells_misc_mod||0,p=+o.savespells_temp_mod||0,c=+o.savespells||0,l=q(i+n+a+t+p);r===1&&c<=20&&l===20?e.savespells_base=c:e.savespells=l,setAttrs(e,{silent:!0})})};Wa=()=>{getAttrs(["savemisc","savemisc_base","savemisc_racial_mod","savemisc_ability_mod","savemisc_misc_mod","savemisc_temp_mod"],r=>{let o={},e=+r.savemisc_base||0,i=+r.savemisc_racial_mod||0,n=+r.savemisc_ability_mod||0,a=+r.savemisc_misc_mod||0,t=+r.savemisc_temp_mod||0,p=q(e+i+n+a+t);o.savemisc=p,setAttrs(o,{silent:!0})})};Ua=()=>{getAttrs(["savemisc1","savemisc1_base","savemisc1_racial_mod","savemisc1_ability_mod","savemisc1_misc_mod","savemisc1_temp_mod"],r=>{let o={},e=+r.savemisc1_base||0,i=+r.savemisc1_racial_mod||0,n=+r.savemisc1_ability_mod||0,a=+r.savemisc1_misc_mod||0,t=+r.savemisc1_temp_mod||0,p=q(e+i+n+a+t);o.savemisc1=p,setAttrs(o,{silent:!0})})};Ha=()=>{getAttrs(["savemisc2","savemisc2_base","savemisc2_racial_mod","savemisc2_ability_mod","savemisc2_misc_mod","savemisc2_temp_mod"],r=>{let o={},e=+r.savemisc2_base||0,i=+r.savemisc2_racial_mod||0,n=+r.savemisc2_ability_mod||0,a=+r.savemisc2_misc_mod||0,t=+r.savemisc2_temp_mod||0,p=q(e+i+n+a+t);o.savemisc2=p,setAttrs(o,{silent:!0})})};on("change:saveparalysispoisondeath_base change:saveparalysispoisondeath_racial_mod change:saveparalysispoisondeath_ability_mod change:saveparalysispoisondeath_misc_mod change:saveparalysispoisondeath_temp_mod",r=>{sa()});on("change:savepetrificationpolymorph_base change:savepetrificationpolymorph_racial_mod change:savepetrificationpolymorph_ability_mod change:savepetrificationpolymorph_misc_mod change:savepetrificationpolymorph_temp_mod",r=>{ia()});on("change:saverodsstaveswands_base change:saverodsstaveswands_racial_mod change:saverodsstaveswands_ability_mod change:saverodsstaveswands_misc_mod change:saverodsstaveswands_temp_mod",r=>{pa()});on("change:savebreathweapons_base change:savebreathweapons_racial_mod change:savebreathweapons_ability_mod change:savebreathweapons_misc_mod change:savebreathweapons_temp_mod",r=>{_a()});on("change:savespells_base change:savespells_racial_mod change:savespells_ability_mod change:savespells_misc_mod change:savespells_temp_mod",r=>{ca()});on("change:savemisc_base change:savemisc_racial_mod change:savemisc_ability_mod change:savemisc_misc_mod change:savemisc_temp_mod",r=>{Wa()});on("change:savemisc1_base change:savemisc1_racial_mod change:savemisc1_ability_mod change:savemisc1_misc_mod change:savemisc1_temp_mod",r=>{Ua()});on("change:savemisc2_base change:savemisc2_racial_mod change:savemisc2_ability_mod change:savemisc2_misc_mod change:savemisc2_temp_mod",r=>{Ha()});on("change:saves_class change:saves_level change:autofill_saves",r=>{g(`Saves Autofill Change Detected:${r.sourceAttribute}`),getAttrs(["saves_class","saves_level","autofill_saves"],o=>{let e={};if(!(+o.autofill_saves||0))return;let n=+o.saves_class||0,a=+o.saves_level||0;g(`Class:${n} Level:${a}`),n!==0&&(n===1&&(a===0||(a<4?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=13,e.saverodsstaveswands_base=14,e.savebreathweapons_base=16,e.savespells_base=15):a<7?(e.saveparalysispoisondeath_base=9,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=13,e.savebreathweapons_base=15,e.savespells_base=14):a<10?(e.saveparalysispoisondeath_base=7,e.savepetrificationpolymorph_base=10,e.saverodsstaveswands_base=11,e.savebreathweapons_base=13,e.savespells_base=12):a<13?(e.saveparalysispoisondeath_base=6,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=10,e.savebreathweapons_base=12,e.savespells_base=11):a<16?(e.saveparalysispoisondeath_base=5,e.savepetrificationpolymorph_base=8,e.saverodsstaveswands_base=9,e.savebreathweapons_base=11,e.savespells_base=10):a<19?(e.saveparalysispoisondeath_base=4,e.savepetrificationpolymorph_base=7,e.saverodsstaveswands_base=8,e.savebreathweapons_base=10,e.savespells_base=9):a>=19&&(e.saveparalysispoisondeath_base=2,e.savepetrificationpolymorph_base=5,e.saverodsstaveswands_base=6,e.savebreathweapons_base=8,e.savespells_base=7))),n===2&&(a===0||(a<4?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=13,e.saverodsstaveswands_base=14,e.savebreathweapons_base=16,e.savespells_base=15):a<7?(e.saveparalysispoisondeath_base=9,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=13,e.savebreathweapons_base=15,e.savespells_base=14):a<10?(e.saveparalysispoisondeath_base=7,e.savepetrificationpolymorph_base=10,e.saverodsstaveswands_base=11,e.savebreathweapons_base=13,e.savespells_base=12):a<13?(e.saveparalysispoisondeath_base=6,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=10,e.savebreathweapons_base=12,e.savespells_base=11):(a<16||a>=16)&&(e.saveparalysispoisondeath_base=5,e.savepetrificationpolymorph_base=8,e.saverodsstaveswands_base=9,e.savebreathweapons_base=11,e.savespells_base=10))),(n===3||n===8)&&(a===0?(e.saveparalysispoisondeath_base=16,e.savepetrificationpolymorph_base=17,e.saverodsstaveswands_base=18,e.savebreathweapons_base=20,e.savespells_base=19):a<3?(e.saveparalysispoisondeath_base=14,e.savepetrificationpolymorph_base=15,e.saverodsstaveswands_base=16,e.savebreathweapons_base=17,e.savespells_base=17):a<5?(e.saveparalysispoisondeath_base=13,e.savepetrificationpolymorph_base=14,e.saverodsstaveswands_base=15,e.savebreathweapons_base=16,e.savespells_base=16):a<7?(e.saveparalysispoisondeath_base=11,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=13,e.savebreathweapons_base=13,e.savespells_base=14):a<9?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=11,e.saverodsstaveswands_base=12,e.savebreathweapons_base=12,e.savespells_base=13):a<11?(e.saveparalysispoisondeath_base=8,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=10,e.savebreathweapons_base=9,e.savespells_base=11):a<13?(e.saveparalysispoisondeath_base=7,e.savepetrificationpolymorph_base=8,e.saverodsstaveswands_base=9,e.savebreathweapons_base=8,e.savespells_base=10):a<15?(e.saveparalysispoisondeath_base=5,e.savepetrificationpolymorph_base=6,e.saverodsstaveswands_base=7,e.savebreathweapons_base=5,e.savespells_base=8):a<17?(e.saveparalysispoisondeath_base=4,e.savepetrificationpolymorph_base=5,e.saverodsstaveswands_base=6,e.savebreathweapons_base=4,e.savespells_base=7):a>=17&&(e.saveparalysispoisondeath_base=3,e.savepetrificationpolymorph_base=4,e.saverodsstaveswands_base=5,e.savebreathweapons_base=4,e.savespells_base=6)),n===4&&(a===0||(a<6?(e.saveparalysispoisondeath_base=14,e.savepetrificationpolymorph_base=13,e.saverodsstaveswands_base=11,e.savebreathweapons_base=15,e.savespells_base=12):a<11?(e.saveparalysispoisondeath_base=13,e.savepetrificationpolymorph_base=11,e.saverodsstaveswands_base=9,e.savebreathweapons_base=13,e.savespells_base=10):a<16?(e.saveparalysispoisondeath_base=11,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=7,e.savebreathweapons_base=11,e.savespells_base=8):a<21?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=7,e.saverodsstaveswands_base=5,e.savebreathweapons_base=9,e.savespells_base=6):a>=21&&(e.saveparalysispoisondeath_base=8,e.savepetrificationpolymorph_base=5,e.saverodsstaveswands_base=3,e.savebreathweapons_base=7,e.savespells_base=4))),n===5&&(a===0||(a<5?(e.saveparalysispoisondeath_base=13,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=14,e.savebreathweapons_base=16,e.savespells_base=15):a<9?(e.saveparalysispoisondeath_base=12,e.savepetrificationpolymorph_base=11,e.saverodsstaveswands_base=12,e.savebreathweapons_base=15,e.savespells_base=13):a<13?(e.saveparalysispoisondeath_base=11,e.savepetrificationpolymorph_base=10,e.saverodsstaveswands_base=10,e.savebreathweapons_base=14,e.savespells_base=11):a<17?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=8,e.savebreathweapons_base=13,e.savespells_base=9):a<21?(e.saveparalysispoisondeath_base=9,e.savepetrificationpolymorph_base=8,e.saverodsstaveswands_base=6,e.savebreathweapons_base=12,e.savespells_base=7):a>=21&&(e.saveparalysispoisondeath_base=8,e.savepetrificationpolymorph_base=7,e.saverodsstaveswands_base=4,e.savebreathweapons_base=11,e.savespells_base=5))),n===6&&(a===0||(a<5?(e.saveparalysispoisondeath_base=13,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=14,e.savebreathweapons_base=16,e.savespells_base=15):a<9?(e.saveparalysispoisondeath_base=12,e.savepetrificationpolymorph_base=11,e.saverodsstaveswands_base=12,e.savebreathweapons_base=15,e.savespells_base=13):a<13?(e.saveparalysispoisondeath_base=11,e.savepetrificationpolymorph_base=10,e.saverodsstaveswands_base=10,e.savebreathweapons_base=14,e.savespells_base=11):a<17?(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=8,e.savebreathweapons_base=13,e.savespells_base=9):a>=17&&(e.saveparalysispoisondeath_base=9,e.savepetrificationpolymorph_base=8,e.saverodsstaveswands_base=6,e.savebreathweapons_base=12,e.savespells_base=7))),n===7&&(a===0||(a<5?(e.saveparalysispoisondeath_base=13,e.savepetrificationpolymorph_base=12,e.saverodsstaveswands_base=14,e.savebreathweapons_base=16,e.savespells_base=15):a<9?(e.saveparalysispoisondeath_base=12,e.savepetrificationpolymorph_base=11,e.saverodsstaveswands_base=12,e.savebreathweapons_base=15,e.savespells_base=13):a<13?(e.saveparalysispoisondeath_base=11,e.savepetrificationpolymorph_base=10,e.saverodsstaveswands_base=10,e.savebreathweapons_base=14,e.savespells_base=11):(a<16||a>=16)&&(e.saveparalysispoisondeath_base=10,e.savepetrificationpolymorph_base=9,e.saverodsstaveswands_base=8,e.savebreathweapons_base=13,e.savespells_base=9))),setAttrs(e))})});on("change:matrix_class",r=>{getAttrs(["matrix_class"],o=>{let e={},i=+o.matrix_class||0;e.toggle_matrixhd=i===5?1:0,setAttrs(e,{silent:!0})})});function te(r){let o=r.toLowerCase();return/cleric|druid|monk/.test(o)?1:/fighter|paladin|ranger|bard|cavalier|barbarian/.test(o)?2:/magic-user|illusionist|magic|mage/.test(o)?3:/thief|assassin|rogue|thief-acrobat|acrobat/.test(o)?4:99}function za(){getAttrs(["thac00","autofill_matrix"],r=>{let o={};if(!(+r.autofill_matrix||0))return;let i=+r.thac00||20;o["thac0-10"]=i+10,o["thac0-9"]=i+9,o["thac0-8"]=i+8,o["thac0-7"]=i+7,o["thac0-6"]=i+6,o["thac0-5"]=i+5,o["thac0-4"]=i+4,o["thac0-3"]=i+3,o["thac0-2"]=i+2,o["thac0-1"]=i+1,o.thac01=i-1,o.thac02=i-2,o.thac03=i-3,o.thac04=i-4,o.thac05=i-5,o.thac06=i-6,o.thac07=i-7,o.thac08=i-8,o.thac09=i-9,o.thac010=i-10,setAttrs(o,{silent:!0})})}on("change:matrix_class change:matrix_level change:matrix_hitdice change:autofill_matrix change:sync_matrix_class change:toggle_fighter5 change:class_selected change:class change:secondclass change:thirdclass change:level change:level_2 change:level_3",r=>{getAttrs(["matrix_class","matrix_level","matrix_hitdice","autofill_matrix","toggle_fighter5","sync_matrix_class","class_selected","class","secondclass","thirdclass","level","level_2","level_3"],o=>{let e={},i=+o.autofill_matrix||0,n=+o.sync_matrix_class||0;if(!i)return;let a=+o.class_selected||1,t=+o.matrix_level||0,p=+o.matrix_class||0,c=o.class||"",l=o.secondclass||"",u=o.thirdclass||"",h=+o.matrix_hitdice||0,m=+o.toggle_fighter5||0;n===1&&(a===1&&(p=te(c),t=+o.level,e.matrix_level=t,e.matrix_class=p),a===2&&(p=te(l),t=+o.level_2,e.matrix_level=t,e.matrix_class=p),a===3&&(p=te(u),t=+o.level_3,e.matrix_level=t,e.matrix_class=p)),p!==0&&(p===1&&(t===0||(t<4?(e["thac-10"]=25,e["thac-9"]=24,e["thac-8"]=23,e["thac-7"]=22,e["thac-6"]=21,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=19,e.thac2=18,e.thac3=17,e.thac4=16,e.thac5=15,e.thac6=14,e.thac7=13,e.thac8=12,e.thac9=11,e.thac10=10):t<7?(e["thac-10"]=23,e["thac-9"]=22,e["thac-8"]=21,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=19,e.thac00=18,e.thac0=18,e.thac1=17,e.thac2=16,e.thac3=15,e.thac4=14,e.thac5=13,e.thac6=12,e.thac7=11,e.thac8=10,e.thac9=9,e.thac10=8):t<10?(e["thac-10"]=21,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=19,e["thac-2"]=18,e["thac-1"]=17,e.thac00=16,e.thac0=16,e.thac1=15,e.thac2=14,e.thac3=13,e.thac4=12,e.thac5=11,e.thac6=10,e.thac7=9,e.thac8=8,e.thac9=7,e.thac10=6):t<13?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=19,e["thac-4"]=18,e["thac-3"]=17,e["thac-2"]=16,e["thac-1"]=15,e.thac00=14,e.thac0=14,e.thac1=13,e.thac2=12,e.thac3=11,e.thac4=10,e.thac5=9,e.thac6=8,e.thac7=7,e.thac8=6,e.thac9=5,e.thac10=4):t<16?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=19,e["thac-6"]=18,e["thac-5"]=17,e["thac-4"]=16,e["thac-3"]=15,e["thac-2"]=14,e["thac-1"]=13,e.thac00=12,e.thac0=12,e.thac1=11,e.thac2=10,e.thac3=9,e.thac4=8,e.thac5=7,e.thac6=6,e.thac7=5,e.thac8=4,e.thac9=3,e.thac10=2):t<19?(e["thac-10"]=20,e["thac-9"]=19,e["thac-8"]=18,e["thac-7"]=17,e["thac-6"]=16,e["thac-5"]=15,e["thac-4"]=14,e["thac-3"]=13,e["thac-2"]=12,e["thac-1"]=11,e.thac00=10,e.thac0=10,e.thac1=9,e.thac2=8,e.thac3=7,e.thac4=6,e.thac5=5,e.thac6=4,e.thac7=3,e.thac8=2,e.thac9=1,e.thac10=0):t>=19&&(e["thac-10"]=19,e["thac-9"]=18,e["thac-8"]=17,e["thac-7"]=16,e["thac-6"]=15,e["thac-5"]=14,e["thac-4"]=13,e["thac-3"]=12,e["thac-2"]=11,e["thac-1"]=10,e.thac00=9,e.thac0=9,e.thac1=8,e.thac2=7,e.thac3=6,e.thac4=5,e.thac5=4,e.thac6=3,e.thac7=2,e.thac8=1,e.thac9=0,e.thac10=-1)),e.attack_matrix_flag=0),(p===2||p===6)&&(t===0?(e["thac-10"]=26,e["thac-9"]=25,e["thac-8"]=24,e["thac-7"]=23,e["thac-6"]=22,e["thac-5"]=21,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=20,e.thac2=19,e.thac3=18,e.thac4=17,e.thac5=16,e.thac6=15,e.thac7=14,e.thac8=13,e.thac9=12,e.thac10=11):t<3?(e["thac-10"]=25-m,e["thac-9"]=24-m,e["thac-8"]=23-m,e["thac-7"]=22-m,e["thac-6"]=21-m,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20-m,e.thac0=20-m,e.thac1=19-m,e.thac2=18-m,e.thac3=17-m,e.thac4=16-m,e.thac5=15-m,e.thac6=14-m,e.thac7=13-m,e.thac8=12-m,e.thac9=11-m,e.thac10=10-m):t<5?(e["thac-10"]=23-m,e["thac-9"]=22-m,e["thac-8"]=21-m,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20-m,e["thac-1"]=19-m,e.thac00=18-m,e.thac0=18-m,e.thac1=17-m,e.thac2=16-m,e.thac3=15-m,e.thac4=14-m,e.thac5=13-m,e.thac6=12-m,e.thac7=11-m,e.thac8=10-m,e.thac9=9-m,e.thac10=8-m):t<7?(e["thac-10"]=21-m,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20-m,e["thac-3"]=19-m,e["thac-2"]=18-m,e["thac-1"]=17-m,e.thac00=16-m,e.thac0=16-m,e.thac1=15-m,e.thac2=14-m,e.thac3=13-m,e.thac4=12-m,e.thac5=11-m,e.thac6=10-m,e.thac7=9-m,e.thac8=8-m,e.thac9=7-m,e.thac10=6-m):t<9?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20-m,e["thac-5"]=19-m,e["thac-4"]=18-m,e["thac-3"]=17-m,e["thac-2"]=16-m,e["thac-1"]=15-m,e.thac00=14-m,e.thac0=14-m,e.thac1=13-m,e.thac2=12-m,e.thac3=11-m,e.thac4=10-m,e.thac5=9-m,e.thac6=8-m,e.thac7=7-m,e.thac8=6-m,e.thac9=5-m,e.thac10=4-m):t<11?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20-m,e["thac-7"]=19-m,e["thac-6"]=18-m,e["thac-5"]=17-m,e["thac-4"]=16-m,e["thac-3"]=15-m,e["thac-2"]=14-m,e["thac-1"]=13-m,e.thac00=12-m,e.thac0=12-m,e.thac1=11-m,e.thac2=10-m,e.thac3=9-m,e.thac4=8-m,e.thac5=7-m,e.thac6=6-m,e.thac7=5-m,e.thac8=4-m,e.thac9=3-m,e.thac10=2-m):t<13?(e["thac-10"]=20-m,e["thac-9"]=19-m,e["thac-8"]=18-m,e["thac-7"]=17-m,e["thac-6"]=16-m,e["thac-5"]=15-m,e["thac-4"]=14-m,e["thac-3"]=13-m,e["thac-2"]=12-m,e["thac-1"]=11-m,e.thac00=10-m,e.thac0=10-m,e.thac1=9-m,e.thac2=8-m,e.thac3=7-m,e.thac4=6-m,e.thac5=5-m,e.thac6=4-m,e.thac7=3-m,e.thac8=2-m,e.thac9=1-m,e.thac10=0-m):t<15?(e["thac-10"]=18-m,e["thac-9"]=17-m,e["thac-8"]=16-m,e["thac-7"]=15-m,e["thac-6"]=14-m,e["thac-5"]=13-m,e["thac-4"]=12-m,e["thac-3"]=11-m,e["thac-2"]=10-m,e["thac-1"]=9-m,e.thac00=8-m,e.thac0=8-m,e.thac1=7-m,e.thac2=6-m,e.thac3=5-m,e.thac4=4-m,e.thac5=3-m,e.thac6=2-m,e.thac7=1-m,e.thac8=0-m,e.thac9=-1-m,e.thac10=-2-m):t<17?(e["thac-10"]=16-m,e["thac-9"]=15-m,e["thac-8"]=14-m,e["thac-7"]=13-m,e["thac-6"]=12-m,e["thac-5"]=11-m,e["thac-4"]=10-m,e["thac-3"]=9-m,e["thac-2"]=8-m,e["thac-1"]=7-m,e.thac00=6-m,e.thac0=6-m,e.thac1=5-m,e.thac2=4-m,e.thac3=3-m,e.thac4=2-m,e.thac5=1-m,e.thac6=0-m,e.thac7=-1-m,e.thac8=-2-m,e.thac9=-3-m,e.thac10=-4-m):t>=17&&(e["thac-10"]=14-m,e["thac-9"]=13-m,e["thac-8"]=12-m,e["thac-7"]=11-m,e["thac-6"]=10-m,e["thac-5"]=9-m,e["thac-4"]=8-m,e["thac-3"]=7-m,e["thac-2"]=6-m,e["thac-1"]=5-m,e.thac00=4-m,e.thac0=4-m,e.thac1=3-m,e.thac2=2-m,e.thac3=1-m,e.thac4=0-m,e.thac5=-1-m,e.thac6=-2-m,e.thac7=-3-m,e.thac8=-4-m,e.thac9=-5-m,e.thac10=-6-m),e.attack_matrix_flag=0),p===3&&(t===0||(t<6?(e["thac-10"]=26,e["thac-9"]=25,e["thac-8"]=24,e["thac-7"]=23,e["thac-6"]=22,e["thac-5"]=21,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=20,e.thac2=19,e.thac3=18,e.thac4=17,e.thac5=16,e.thac6=15,e.thac7=14,e.thac8=13,e.thac9=12,e.thac10=11):t<11?(e["thac-10"]=24,e["thac-9"]=23,e["thac-8"]=22,e["thac-7"]=21,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=19,e.thac0=19,e.thac1=18,e.thac2=17,e.thac3=16,e.thac4=15,e.thac5=14,e.thac6=13,e.thac7=12,e.thac8=11,e.thac9=10,e.thac10=9):t<16?(e["thac-10"]=21,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=19,e["thac-2"]=18,e["thac-1"]=17,e.thac00=16,e.thac0=16,e.thac1=15,e.thac2=14,e.thac3=13,e.thac4=12,e.thac5=11,e.thac6=10,e.thac7=9,e.thac8=8,e.thac9=7,e.thac10=6):t<21?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=19,e["thac-5"]=18,e["thac-4"]=17,e["thac-3"]=16,e["thac-2"]=15,e["thac-1"]=14,e.thac00=13,e.thac0=13,e.thac1=12,e.thac2=11,e.thac3=10,e.thac4=9,e.thac5=8,e.thac6=7,e.thac7=6,e.thac8=5,e.thac9=4,e.thac10=3):t>=21&&(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=19,e["thac-7"]=18,e["thac-6"]=17,e["thac-5"]=16,e["thac-4"]=15,e["thac-3"]=14,e["thac-2"]=13,e["thac-1"]=12,e.thac00=11,e.thac0=11,e.thac1=10,e.thac2=9,e.thac3=8,e.thac4=7,e.thac5=6,e.thac6=5,e.thac7=4,e.thac8=3,e.thac9=2,e.thac10=1)),e.attack_matrix_flag=0),p===4&&(t===0||(t<5?(e["thac-10"]=26,e["thac-9"]=25,e["thac-8"]=24,e["thac-7"]=23,e["thac-6"]=22,e["thac-5"]=21,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=20,e.thac2=19,e.thac3=18,e.thac4=17,e.thac5=16,e.thac6=15,e.thac7=14,e.thac8=13,e.thac9=12,e.thac10=11):t<9?(e["thac-10"]=24,e["thac-9"]=23,e["thac-8"]=22,e["thac-7"]=21,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=19,e.thac0=19,e.thac1=18,e.thac2=17,e.thac3=16,e.thac4=15,e.thac5=14,e.thac6=13,e.thac7=12,e.thac8=11,e.thac9=10,e.thac10=9):t<13?(e["thac-10"]=21,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=19,e["thac-2"]=18,e["thac-1"]=17,e.thac00=16,e.thac0=16,e.thac1=15,e.thac2=14,e.thac3=13,e.thac4=12,e.thac5=11,e.thac6=10,e.thac7=9,e.thac8=8,e.thac9=7,e.thac10=6):t<17?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=19,e["thac-4"]=18,e["thac-3"]=17,e["thac-2"]=16,e["thac-1"]=15,e.thac00=14,e.thac0=14,e.thac1=13,e.thac2=12,e.thac3=11,e.thac4=10,e.thac5=9,e.thac6=8,e.thac7=7,e.thac8=6,e.thac9=5,e.thac10=4):t<21?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=19,e["thac-6"]=18,e["thac-5"]=17,e["thac-4"]=16,e["thac-3"]=15,e["thac-2"]=14,e["thac-1"]=13,e.thac00=12,e.thac0=12,e.thac1=11,e.thac2=10,e.thac3=9,e.thac4=8,e.thac5=7,e.thac6=6,e.thac7=5,e.thac8=4,e.thac9=3,e.thac10=2):t>=21&&(e["thac-10"]=20,e["thac-9"]=19,e["thac-8"]=18,e["thac-7"]=17,e["thac-6"]=16,e["thac-5"]=15,e["thac-4"]=14,e["thac-3"]=13,e["thac-2"]=12,e["thac-1"]=11,e.thac00=10,e.thac0=10,e.thac1=9,e.thac2=8,e.thac3=7,e.thac4=6,e.thac5=5,e.thac6=4,e.thac7=3,e.thac8=2,e.thac9=1,e.thac10=0)),e.attack_matrix_flag=0),p===5&&(h===0||(h===1?(e["thac-10"]=26,e["thac-9"]=25,e["thac-8"]=24,e["thac-7"]=23,e["thac-6"]=22,e["thac-5"]=21,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=20,e.thac2=19,e.thac3=18,e.thac4=17,e.thac5=16,e.thac6=15,e.thac7=14,e.thac8=13,e.thac9=12,e.thac10=11):h===2?(e["thac-10"]=25,e["thac-9"]=24,e["thac-8"]=23,e["thac-7"]=22,e["thac-6"]=21,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=19,e.thac2=18,e.thac3=17,e.thac4=16,e.thac5=15,e.thac6=14,e.thac7=13,e.thac8=12,e.thac9=11,e.thac10=10):h===3?(e["thac-10"]=24,e["thac-9"]=23,e["thac-8"]=22,e["thac-7"]=21,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=19,e.thac0=19,e.thac1=18,e.thac2=17,e.thac3=16,e.thac4=15,e.thac5=14,e.thac6=13,e.thac7=12,e.thac8=11,e.thac9=10,e.thac10=9):h===4?(e["thac-10"]=23,e["thac-9"]=22,e["thac-8"]=21,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=19,e.thac00=18,e.thac0=18,e.thac1=17,e.thac2=16,e.thac3=15,e.thac4=14,e.thac5=13,e.thac6=12,e.thac7=11,e.thac8=10,e.thac9=9,e.thac10=8):h===5?(e["thac-10"]=21,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=19,e["thac-2"]=18,e["thac-1"]=17,e.thac00=16,e.thac0=16,e.thac1=15,e.thac2=14,e.thac3=13,e.thac4=12,e.thac5=11,e.thac6=10,e.thac7=9,e.thac8=8,e.thac9=7,e.thac10=6):h===6?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=19,e["thac-3"]=18,e["thac-2"]=17,e["thac-1"]=16,e.thac00=15,e.thac0=15,e.thac1=14,e.thac2=13,e.thac3=12,e.thac4=11,e.thac5=10,e.thac6=9,e.thac7=8,e.thac8=7,e.thac9=6,e.thac10=5):h===7?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=19,e["thac-5"]=18,e["thac-4"]=17,e["thac-3"]=16,e["thac-2"]=15,e["thac-1"]=14,e.thac00=13,e.thac0=13,e.thac1=12,e.thac2=11,e.thac3=10,e.thac4=9,e.thac5=8,e.thac6=7,e.thac7=6,e.thac8=5,e.thac9=4,e.thac10=3):h===8?(e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=19,e["thac-6"]=18,e["thac-5"]=17,e["thac-4"]=16,e["thac-3"]=15,e["thac-2"]=14,e["thac-1"]=13,e.thac00=12,e.thac0=12,e.thac1=11,e.thac2=10,e.thac3=9,e.thac4=8,e.thac5=7,e.thac6=6,e.thac7=5,e.thac8=4,e.thac9=3,e.thac10=2):h===9?(e["thac-10"]=20,e["thac-9"]=19,e["thac-8"]=18,e["thac-7"]=17,e["thac-6"]=16,e["thac-5"]=15,e["thac-4"]=14,e["thac-3"]=13,e["thac-2"]=12,e["thac-1"]=11,e.thac00=10,e.thac0=10,e.thac1=9,e.thac2=8,e.thac3=7,e.thac4=6,e.thac5=5,e.thac6=4,e.thac7=3,e.thac8=2,e.thac9=1,e.thac10=0):h===10?(e["thac-10"]=19,e["thac-9"]=18,e["thac-8"]=17,e["thac-7"]=16,e["thac-6"]=15,e["thac-5"]=14,e["thac-4"]=13,e["thac-3"]=12,e["thac-2"]=11,e["thac-1"]=10,e.thac00=9,e.thac0=9,e.thac1=8,e.thac2=7,e.thac3=6,e.thac4=5,e.thac5=4,e.thac6=3,e.thac7=2,e.thac8=1,e.thac9=0,e.thac10=-1):h===11?(e["thac-10"]=18,e["thac-9"]=17,e["thac-8"]=16,e["thac-7"]=15,e["thac-6"]=14,e["thac-5"]=13,e["thac-4"]=12,e["thac-3"]=11,e["thac-2"]=10,e["thac-1"]=9,e.thac00=8,e.thac0=8,e.thac1=7,e.thac2=6,e.thac3=5,e.thac4=4,e.thac5=3,e.thac6=2,e.thac7=1,e.thac8=0,e.thac9=-1,e.thac10=-2):h===12&&(e["thac-10"]=17,e["thac-9"]=16,e["thac-8"]=15,e["thac-7"]=14,e["thac-6"]=13,e["thac-5"]=12,e["thac-4"]=11,e["thac-3"]=10,e["thac-2"]=9,e["thac-1"]=8,e.thac00=7,e.thac0=7,e.thac1=6,e.thac2=5,e.thac3=4,e.thac4=3,e.thac5=2,e.thac6=1,e.thac7=0,e.thac8=-1,e.thac9=-2,e.thac10=-3)),e.attack_matrix_flag=0),p===99&&(g("Error: Class not recognized or class name is empty."),e["thac-10"]=20,e["thac-9"]=20,e["thac-8"]=20,e["thac-7"]=20,e["thac-6"]=20,e["thac-5"]=20,e["thac-4"]=20,e["thac-3"]=20,e["thac-2"]=20,e["thac-1"]=20,e.thac00=20,e.thac0=20,e.thac1=20,e.thac2=20,e.thac3=20,e.thac4=20,e.thac5=20,e.thac6=20,e.thac7=20,e.thac8=20,e.thac9=20,e.thac10=20,e.attack_matrix_flag=0),setAttrs(e,{silent:!0}),za())})});on("sheet:opened change:thac0 change:thac00 change:autofill_matrix",r=>{getAttrs(["attack_matrix_flag","matrix_class","thac0","thac1","thac2","thac00","thac01","thac02","autofill_matrix"],o=>{let e={};if(!(+o.autofill_matrix||0))return;let n=+o.attack_matrix_flag||0,a=+o.matrix_class||0;if(n===0||a>0)e.attack_matrix_flag=0;else{let t=+o.thac0||20,p=+o.thac1||20,c=+o.thac2||20,l=+o.thac00||20,u=+o.thac01||20,h=+o.thac02||20,m=t+p+c,w=l+u+h;e.attack_matrix_flag=m===60&&w===60?1:0}setAttrs(e,{silent:!0})})});on("change:thac00",r=>{za()});function F(r,o,e,i){return r<e?(console.log(`Error: ${o} value is not a number or out of range. [${r}].\\nDefaulting to ${e}.`),e):r>i?(console.log(`Error: ${o} value is out of range. [${r}].\\nDefaulting to ${i}.`),i):Math.min(Math.max(r,e),i)}var A=class{constructor(o,e,i,n,a,t){this.meleebonus=o,this.dmgbonus=e,this.majorstrengthfeat=t,this.minorstrengthfeat=n,this.minorstrengthfeat_locked=a,this.encumbrancebonus=i}getMeleeAttackBonus(){return this.meleebonus}getMeleeDamageBonus(){return this.dmgbonus}getMajorStrengthCheck(){return this.majorstrengthfeat}getMinorStrengthCheck(o=!1){return o?this.minorstrengthfeat_locked:this.minorstrengthfeat}getEncumbranceBonus(){return this.encumbrancebonus}},Pe=class{constructor(){this.strength_dict={3:new A(-3,-1,-350,1,0,0),4:new A(-2,-1,-250,1,0,0),5:new A(-2,-1,-250,1,0,0),6:new A(-1,0,-150,1,0,0),7:new A(-1,0,-150,1,0,0),8:new A(0,0,0,2,0,1),9:new A(0,0,0,2,0,1),10:new A(0,0,0,2,0,2),11:new A(0,0,0,2,0,2),12:new A(0,0,100,2,0,4),13:new A(0,0,100,2,0,4),14:new A(0,0,200,2,0,7),15:new A(0,0,200,2,0,7),16:new A(0,1,350,3,0,10),17:new A(1,1,500,3,0,13),18:{None:new A(1,2,750,3,0,16),"01-50":new A(1,3,1e3,3,0,20),"51-75":new A(2,3,1250,4,0,25),"76-90":new A(2,4,1500,4,0,30),"91-99":new A(2,5,2e3,4,1,35),"00":new A(3,6,3e3,5,2,40)},19:new A(3,7,4500,7,3,50),20:new A(3,8,5e3,7,3,60),21:new A(4,9,6e3,9,4,70),22:new A(4,10,7500,11,4,80),23:new A(5,11,9e3,11,5,90),24:new A(6,12,12e3,19,7,100),25:new A(7,14,15e3,23,9,100)}}getEntry(o,e){let i=F(o,"strength",3,25);return i!==18?this.strength_dict[i]:e<=0?this.strength_dict[i].None:e<=50?this.strength_dict[i]["01-50"]:e<=75?this.strength_dict[i]["51-75"]:e<=90?this.strength_dict[i]["76-90"]:e<=99?this.strength_dict[i]["91-99"]:this.strength_dict[i]["00"]}getStrengthValue(o,e,i=0,n=!1){switch(o){case"Attack":return this.getEntry(e,i).getMeleeAttackBonus();case"Damage":return this.getEntry(e,i).getMeleeDamageBonus();case"Major":return this.getEntry(e,i).getMajorStrengthCheck();case"Minor":return this.getEntry(e,i).getMinorStrengthCheck(n);case"Encumbrance":return this.getEntry(e,i).getEncumbranceBonus();default:return"Invalid Test"}}},N=class{constructor(o,e,i,n){this.bonuslanguages=o,this.knowspell=e,this.minspells=i,this.maxspells=n}getBonusLanguages(){return this.bonuslanguages}getKnowSpell(){return this.knowspell}getMinSpells(){return this.minspells}getMaxSpells(){return this.maxspells}},Ue=class{constructor(){this.intelligence_dict={8:new N(1,0,0,0),9:new N(1,35,4,6),10:new N(2,45,5,7),11:new N(2,45,5,7),12:new N(3,45,5,7),13:new N(3,55,6,9),14:new N(4,55,6,9),15:new N(4,65,7,11),16:new N(5,65,7,11),17:new N(6,75,8,14),18:new N(7,85,9,18),19:new N(8,95,10,99),20:new N(9,96,11,99),21:new N(10,97,12,99),22:new N(11,98,13,99),23:new N(12,99,14,99),24:new N(13,100,15,99),25:new N(14,100,16,99)}}getEntry(o){return this.intelligence_dict[F(o,"intelligence",8,25)]}},D=class{constructor(o,e,i){this.mentalsavebonus=o,this.spellbonus=e,this.spellfailure=i}getMentalSaveBonus(){return this.mentalsavebonus}getSpellBonus(){return this.spellbonus}getSpellFailure(){return this.spellfailure}},He=class{constructor(){this.wisdom_dict={3:new D("-3","None",20),4:new D("-2","None",20),5:new D("-1","None",20),6:new D("-1","None",20),7:new D("-1","None",20),8:new D("0","None",20),9:new D("0","None",20),10:new D("0","None",15),11:new D("0","None",10),12:new D("0","None",5),13:new D("0","1/0/0/0/0/0/0",0),14:new D("0","2/0/0/0/0/0/0",0),15:new D("1","2/1/0/0/0/0/0",0),16:new D("2","2/2/0/0/0/0/0",0),17:new D("3","2/2/1/0/0/0/0",0),18:new D("4","2/2/1/1/0/0/0",0),19:new D("4","3/2/1/2/0/0/0",0),20:new D("4","3/3/1/3/0/0/0",0),21:new D("4","3/3/2/3/1/0/0",0),22:new D("4","3/3/2/4/2/0/0",0),23:new D("4","3/3/2/4/4/0/0",0),24:new D("4","3/3/2/4/4/2/1",0),25:new D("4","3/3/2/4/4/3/1",0)}}getEntry(o){return this.wisdom_dict[F(o,"wisdom",3,25)]}},E=class{constructor(o,e,i){this.surprisebonus=o,this.rangedbonus=e,this.armorbonus=i}getSurpriseBonus(){return this.surprisebonus}getRangedBonus(){return this.rangedbonus}getArmorBonus(){return this.armorbonus}},We=class{constructor(){this.dexterity_dict={3:new E(3,-3,4),4:new E(2,-2,3),5:new E(1,-1,2),6:new E(0,0,1),7:new E(0,0,0),8:new E(0,0,0),9:new E(0,0,0),10:new E(0,0,0),11:new E(0,0,0),12:new E(0,0,0),13:new E(0,0,0),14:new E(0,0,0),15:new E(0,0,-1),16:new E(-1,1,-2),17:new E(-2,2,-3),18:new E(-3,3,-4),19:new E(-3,3,-4),20:new E(-3,3,-4),21:new E(-4,4,-5),22:new E(-4,4,-5),23:new E(-4,4,-5),24:new E(-5,5,-6),25:new E(-5,5,-6)}}getEntry(o){return this.dexterity_dict[F(o,"dexterity",3,25)]}},C=class{constructor(o,e,i){this.hitpointbonus=o,this.systemshock=e,this.resurrectionsurvival=i}getHitpointBonus(){return this.hitpointbonus}getSystemShock(){return this.systemshock}getResurrectionSurvival(){return this.resurrectionsurvival}},Ve=class{constructor(){this.constitution_dict={3:new C("-2",35,40),4:new C("-1",40,45),5:new C("-1",45,50),6:new C("0",50,55),7:new C("0",55,60),8:new C("0",60,65),9:new C("0",65,70),10:new C("0",70,75),11:new C("0",75,80),12:new C("0",80,85),13:new C("0",85,90),14:new C("0",88,92),15:new C("1",91,94),16:new C("2",95,96),17:new C("3",97,98),18:new C("4",99,100),19:new C("5",99,100),20:new C("5",99,100),21:new C("6",99,100),22:new C("6",99,100),23:new C("6",99,100),24:new C("7",99,100),25:new C("7",99,100)}}getEntry(o){return this.constitution_dict[F(o,"constitution",3,25)]}},I=class{constructor(o,e,i,n){this.maximumhenchmen=o,this.loyaltybonus=e,this.reactionbonus=i,this.comeliness=n}MaximumHenchmen(){return this.maximumhenchmen}getLoyaltyBonus(){return this.loyaltybonus}getReactionBonus(){return this.reactionbonus}getComeliness(){return this.comeliness}},Fe=class{constructor(){this.charisma_dict={3:new I(1,-30,-25,-5),4:new I(1,-25,-20,-3),5:new I(2,-20,-15,-3),6:new I(2,-15,-10,-1),7:new I(3,-10,-5,-1),8:new I(3,-5,0,-1),9:new I(4,0,0,0),10:new I(4,0,0,0),11:new I(4,0,0,0),12:new I(5,0,0,0),13:new I(5,0,5,1),14:new I(6,5,10,1),15:new I(7,15,15,1),16:new I(8,20,25,2),17:new I(10,30,30,2),18:new I(15,40,35,3),19:new I(20,50,40,5),20:new I(25,60,45,5),21:new I(30,70,50,5),22:new I(35,80,55,5),23:new I(40,90,60,5),24:new I(45,100,65,5),25:new I(50,100,70,5)}}getEntry(o){return this.charisma_dict[F(o,"charisma",3,25)]}},B=class{constructor(o,e,i,n,a){this.pickPockets=o,this.openLocks=e,this.findRemoveTraps=i,this.moveSilently=n,this.hideInShadows=a}getPickPockets(){return this.pickPockets}getOpenLocks(){return this.openLocks}getFindRemoveTraps(){return this.findRemoveTraps}getMoveSilently(){return this.moveSilently}getHideInShadows(){return this.hideInShadows}},Ge=class{constructor(){this.dexterity_dict={9:new B(-15,-10,-10,-20,-10),10:new B(-10,-5,-10,-15,-5),11:new B(-5,0,-5,-10,0),12:new B(0,0,0,-5,0),13:new B(0,0,0,0,0),14:new B(0,0,0,0,0),15:new B(0,0,0,0,0),16:new B(0,5,0,0,0),17:new B(5,10,0,5,5),18:new B(10,15,5,10,10)}}getEntry(o){return this.dexterity_dict[F(o,"dexterity",9,18)]}},P=class{constructor(o,e,i,n,a,t,p,c){this.pickPockets=o,this.openLocks=e,this.findRemoveTraps=i,this.moveSilently=n,this.hideInShadows=a,this.hearNoise=t,this.climbWalls=p,this.readLanguages=c}getPickPockets(){return this.pickPockets}getOpenLocks(){return this.openLocks}getFindRemoveTraps(){return this.findRemoveTraps}getMoveSilently(){return this.moveSilently}getHideInShadows(){return this.hideInShadows}getHearNoise(){return this.hearNoise}getClimbWalls(){return this.climbWalls}getReadLanguages(){return this.readLanguages}},ze=class{constructor(){this.dexterity_dict={0:new P(0,0,0,0,0,0,0,0),1:new P(0,0,0,0,0,0,0,0),2:new P(0,10,15,0,0,0,-10,-5),3:new P(5,-5,0,5,10,5,0,0),4:new P(0,5,10,5,5,10,-15,0),5:new P(10,0,0,0,5,0,0,0),6:new P(5,5,5,10,15,5,-15,-5),7:new P(-5,5,5,0,0,5,5,-10)}}getEntry(o){return this.dexterity_dict[F(o,"thief_race_selected",0,7)]}},H=new Pe,ke=new Ue,Ae=new He,ee=new We,ae=new Ve,z=new Fe,ce=new Ge,W=new ze,j=(r,o,e="int")=>e==="int"?parseInt(r[o])||0:e==="float"?parseFloat(r[o])||0:e==="str"?r[o]:null;la=()=>{getAttrs(["strength","exceptionalstrength"],r=>{let o={},e=j(r,"strength","int"),i=j(r,"exceptionalstrength");j(r,"exceptionalstrength","str")==="00"&&(i=100),o.exceptionalstrength=i,o.meleebonus=(H.getStrengthValue("Attack",e,i)<=0?"":"+")+H.getStrengthValue("Attack",e,i),o.dmgbonus=(H.getStrengthValue("Damage",e,i)<=0?"":"+")+H.getStrengthValue("Damage",e,i),o.majorstrengthfeat=H.getStrengthValue("Major",e,i),o.minorstrengthfeat=H.getStrengthValue("Minor",e,i),o.minorstrengthfeat_locked=H.getStrengthValue("Minor",e,i,!0),o.encumbrancebonus=(H.getStrengthValue("Encumbrance",e,i)<=0?"":"+")+H.getStrengthValue("Encumbrance",e,i),setAttrs(o)})};aa=()=>{getAttrs(["intelligence","bonuslanguages","race"],r=>{let o={},e=j(r,"intelligence","int"),i=j(r,"race","str"),n=+ke.getEntry(e).getBonusLanguages();/human/gi.test(i)?o.bonuslanguages=n:/dwarf/gi.test(i)||/gnome/gi.test(i)||/orc/gi.test(i)?o.bonuslanguages=Math.min(n,2):/half-elf/gi.test(i)||/halfling/gi.test(i)||/hobbit/gi.test(i)?(n<=5?n=0:n===6?n=1:n===7?n=2:n===8?n=3:n===9?n=4:n===10?n=5:n===11?n=6:n===12?n=7:n===13?n=8:n>=14&&(n=9),o.bonuslanguages=n):/elf/gi.test(i)?(n<=4?n=0:n===5?n=1:n==6?n=2:n===7?n=3:n===8?n=4:n===9?n=5:n===10?n=6:n===11?n=7:n===12?n=8:n===13?n=9:n>=14&&(n=10),o.bonuslanguages=n):o.bonuslanguages=0,o.knowspell=ke.getEntry(e).getKnowSpell(),o.minspells=ke.getEntry(e).getMinSpells(),o.maxspells=ke.getEntry(e).getMaxSpells(),setAttrs(o,{silent:!0})})};wa=()=>{getAttrs(["wisdom"],r=>{let o={},e=j(r,"wisdom","int");o.mentalsavebonus=(Ae.getEntry(e).getMentalSaveBonus()<=0?"":"+")+Ae.getEntry(e).getMentalSaveBonus(),o.spellbonus=Ae.getEntry(e).getSpellBonus(),o.spellfailure=Ae.getEntry(e).getSpellFailure(),setAttrs(o,{silent:!0})})};Ze=()=>{getAttrs(["dexterity"],r=>{let o={},e=j(r,"dexterity","int"),i=ee.getEntry(e).getSurpriseBonus(),n=(-1*i<=0?"":"+")+-1*i;o.surprisebonus=ee.getEntry(e).getSurpriseBonus(),o.surprisebonus_inverted=n,o.rangedbonus=(ee.getEntry(e).getRangedBonus()<=0?"":"+")+ee.getEntry(e).getRangedBonus(),o.armorbonus=(ee.getEntry(e).getArmorBonus()<=0?"":"+")+ee.getEntry(e).getArmorBonus(),setAttrs(o)})};Qe=()=>{getAttrs(["constitution","class","secondclass","thirdclass"],r=>{let o={},e=j(r,"constitution","int"),i=[r.class,r.secondclass,r.thirdclass];/fighter/gi.test(i)||/paladin/gi.test(i)||/ranger/gi.test(i)?o.hitpointbonus=(ae.getEntry(e).getHitpointBonus()<=0?"":"+")+ae.getEntry(e).getHitpointBonus():o.hitpointbonus=(Math.min(ae.getEntry(e).getHitpointBonus(),2)<=0?"":"+")+Math.min(ae.getEntry(e).getHitpointBonus(),2),o.systemshock=ae.getEntry(e).getSystemShock(),o.resurrectionsurvival=ae.getEntry(e).getResurrectionSurvival(),setAttrs(o)})};Ye=()=>{getAttrs(["charisma"],r=>{let o={},e=j(r,"charisma","int");o.maximumhenchmen=z.getEntry(e).MaximumHenchmen(),o.loyaltybonus=(z.getEntry(e).getLoyaltyBonus()<=0?"":"+")+z.getEntry(e).getLoyaltyBonus(),o.reactionbonus=(z.getEntry(e).getReactionBonus()<=0?"":"+")+z.getEntry(e).getReactionBonus(),o.comeliness_cha_adj=(z.getEntry(e).getComeliness()<=0?"":"+")+z.getEntry(e).getComeliness(),setAttrs(o,{silent:!0})})};thiefSkillsDexCalcs=()=>{getAttrs(["dexterity"],r=>{let o={},e=j(r,"dexterity","int"),i=ce.getEntry(e).getPickPockets(),n=ce.getEntry(e).getOpenLocks(),a=ce.getEntry(e).getFindRemoveTraps(),t=ce.getEntry(e).getMoveSilently(),p=ce.getEntry(e).getHideInShadows();o.pickpockets_ability_mod=i,o.openlocks_ability_mod=n,o.findtraps_ability_mod=a,o.movequietly_ability_mod=t,o.hideinshadows_ability_mod=p,setAttrs(o)})};thiefSkillsRacialCalcs=()=>{getAttrs(["thief_race_selected"],r=>{let o={},e=j(r,"thief_race_selected","int"),i=W.getEntry(e).getPickPockets(),n=W.getEntry(e).getOpenLocks(),a=W.getEntry(e).getFindRemoveTraps(),t=W.getEntry(e).getMoveSilently(),p=W.getEntry(e).getHideInShadows(),c=W.getEntry(e).getHearNoise(),l=W.getEntry(e).getClimbWalls(),u=W.getEntry(e).getReadLanguages();o.pickpockets_racial_mod=i,o.openlocks_racial_mod=n,o.findtraps_racial_mod=a,o.movequietly_racial_mod=t,o.hideinshadows_racial_mod=p,o.hearnoise_racial_mod=c,o.climbwalls_racial_mod=l,o.readlanguages_racial_mod=u,setAttrs(o)})};on("change:autofill_thief_dex change:dexterity",r=>{getAttrs(["autofill_thief_dex"],o=>{+o.autofill_thief_dex!==0&&thiefSkillsDexCalcs()})});function go(r){let o=r.toLowerCase();return/human/.test(o)?1:/dwarf/.test(o)?2:/half-elf/.test(o)?5:/elf/.test(o)?3:/gnome/.test(o)?4:/halfling|hobbit/.test(o)?6:/half-orc/.test(o)?7:0}on("change:race change:autofill_thief_race change:thief_race_selected",r=>{let o=r.sourceAttribute;getAttrs(["race","autofill_thief_race"],e=>{let i={};if(+e.autofill_thief_race===0)return;let a=e.race||"human";(o==="autofill_thief_race"||o==="race")&&(i.thief_race_selected=go(a)),setAttrs(i,{silent:!0}),thiefSkillsRacialCalcs()})});on("change:strength change:exceptionalstrength",r=>{la()});on("change:intelligence change:race",r=>{aa()});on("change:wisdom",r=>{wa()});on("change:dexterity",r=>{Ze()});on("change:constitution change:class change:secondclass change:thirdclass",r=>{Qe()});on("change:charisma change:comeliness",r=>{Ye()});portraitUrlCalc=()=>{getAttrs(["character_avatar","sheet_image","sheet_image_url"],r=>{let o={},e=+r.sheet_image,i=function(t){let p=/(\.png|\.jpg|\.gif)/i,c=t.match(p);return c?t.slice(0,c.index+c[0].length):t}(r.character_avatar),n=r.sheet_image_url||i;e===0&&(o.sheet_image_src=n),e===1&&(o.sheet_image_src=i),e===2&&(o.sheet_image_src=""),setAttrs(o,{silent:!0})})};on("change:character_avatar change:sheet_image change:sheet_image_url",r=>{portraitUrlCalc()});on("clicked:postimage",r=>{portraitUrlCalc(),startRoll("?{Display the portrait image?|YES,@{sheet_image_src}|NO,&nbsp;}",e=>{finishRoll(e.rollId)})});on("change:psionic_ability_strength_max change:psionic_attack change:psionic_defense",r=>{getAttrs(["psionic_ability_strength_max"],o=>{let e={},i=o.psionic_ability_strength_max;e.psionic_attack_max=O(i/2).toFixed(1),e.psionic_defense_max=O(i/2).toFixed(1),setAttrs(e,{silent:!0})})});Va=()=>{getSectionIDs("repeating_weapon",r=>{let o={},e=[],i=[];r.forEach(n=>{e.push(s("weapon",n,"weapon_name")),e.push(s("weapon",n,"weapon_use")),e.push(s("weapon",n,"weapon_speed")),e.push(s("weapon",n,"weapon_misc"))}),getAttrs(e,n=>{if(r.forEach(a=>{let t=+n[s("weapon",a,"weapon_use")]||0;if(t===0)return;let p=n[s("weapon",a,"weapon_name")],c=n[s("weapon",a,"weapon_speed")]||"0",l=parseInt(c.match(/\d+/)?.[0])||0,u=n[s("weapon",a,"weapon_misc")];i.push({rowID:a,name:p,inUse:t,speed:l,misc:u})}),i.length>0){let a=i[0];i.forEach(l=>{l.speed<a.speed&&(a=l)});let{name:t,speed:p,misc:c}=a;o.weapon_in_use=t,o.weapon_in_use_speed=p,o.weapon_in_use_misc=c}else o.weapon_in_use="",o.weapon_in_use_speed="",o.weapon_in_use_misc="";setAttrs(o,{silent:!0})})})};on("change:repeating_weapon:weapon_name change:repeating_weapon:weapon_use change:repeating_weapon:weapon_speed change:repeating_weapon:weapon_misc",r=>{Va()});})();
