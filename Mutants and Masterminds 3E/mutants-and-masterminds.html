<script type="text/worker">
    function clearLog() {
        setAttrs({"output-message": "", "hide-output": "1"}, {silent: true});
    }
    
    function log(value) {
        setAttrs({"output-message": value, "hide-output": "0"}, {silent: true});
        console.log(value);
    };
    
    function pluralize(count, thing, singular, plural) {
        if(!singular) {
            singular = "";
        }
        if(!plural) {
            plural = "s";
        }
        
        return count + " " + thing
            + (count == 1 ? singular : plural);
    }
    
    try {
        var equipmentRowID = null;
        
        /**
         * @param repeatingName - The word that comes after "repeating_" in the
         * attribute name. For instance, if you want to find
         * "repeating_equipment_$0_name", then this should be "equipment".
         * 
         * @param suffixes - An array of words identifying which parts of the
         * repeating attribute you want. For instance, if you want
         * "repeating_equipment_$0_name" and "repeating_equipment_$0_description",
         * then this should be ["name", "description"].
         * 
         * @param callback - A function that takes an array of objects. This
         * will be called once the attributes have been found. Each object in
         * the array will contain a property for each string in suffixes, mapped
         * to the value of that attribute. The objects won't be in order, but
         * they will include the repeating section id. If you passed the values
         * mentioned above, then this might return the following array:
         * [
         *     {id:"ABC", name:"Sword", description:""},
         *     {id:"DEF", name:"Shield", description:"A simple wooden buckler."}
         * ]
         */
        function getRepeatingAttributes(repeatingName, suffixes, callback) {
            getSectionIDs("repeating_" + repeatingName, function(idArray) {
                var attributeNames = [];
                for(var suffix of suffixes) {
                    for(var id of idArray) {
                        attributeNames.push("repeating_" + repeatingName
                            + "_" + id + "_" + suffix);
                    }
                }
                
                getAttrs(attributeNames, function(attributes) {
                    var result = [];
                    for(var id of idArray) {
                        var attributeSection = {id:id};
                        result.push(attributeSection);
                        
                        for(var suffix of suffixes) {
                            attributeSection[suffix] = attributes["repeating_"
                                + repeatingName + "_" + id + "_" + suffix];
                        }
                    }
                    
                    callback(result);
                });
            });
        }
        /**
         * Like getRepeatingAttributes, but puts the array in order.
         */
        function getRepeatingAttributesOrdered(repeatingName, suffixes, callback) {
            getRepeatingAttributes(repeatingName, suffixes, function(attributes) {
                getSectionIDsOrdered(repeatingName, function(idsOrdered) {
                    var result = [];
                    
                    for(var id of idsOrdered) {
                        for(var attribute of attributes) {
                            if(attribute.id === id) {
                                result.push(attribute);
                                break;
                            }
                        }
                    }
                    
                    callback(result);
                });
            }, true);
        }
        
        function recountAll() {
            console.log("Recounting everything:");
            recountPowers(true);
            recountAdvantages(recountEquipment);
        }
        
        /**
         * @param calculateCost - Set this to true if all powers should be
         * calculated, or to a row ID if you only want to recalculate one. Make
         * sure to convert the row ID to lowercase if it isn't already (this
         * will happen automatically if you extract it from eventInfo).
         */
        function recountPowers(calculateCost, doneCallback) {
            var suffixes;
            if(calculateCost) {
                suffixes = ["ranks", "points-per-rank", "misc-points", "total-cost",
                    "alternate-effect"];
            } else {
                suffixes = ["total-cost"];
            }
            
            getRepeatingAttributesOrdered("power", suffixes, function(powers) {
                var total = 0;
                for(var power of powers) {
                    if(calculateCost === true || calculateCost === power.id.toLowerCase()) {
                        power["total-cost"] = calculatePowerCost(powers, power);
                    }
                    total += parseInt(power["total-cost"]);
                }
                setAttrs({"power-points": total}, {silent: true});
                console.log("Spent " + pluralize(total, "point") + " on powers.");
                
                if(doneCallback) {
                    doneCallback();
                }
            });
        }
        
        /**
         * Given a complete array of ordered powers and one entry out of that
         * array, calculates the total cost of that power. This updates the
         * attribute (asynchronously), and also updates the power object
         * in-place.
         */
        function calculatePowerCost(orderedPowers, power) {
            var total = parseInt(power.ranks) * parseFloat(power["points-per-rank"])
                + parseInt(power["misc-points"]);
            
            //If this is an alternate effect, find the effect it's based
            //on and make sure this is cheaper (or the same price).
            if(power["alternate-effect"] === "1" || power["alternate-effect"] === "2") {
                var index = orderedPowers.indexOf(power);
                if(index < 0) {
                    return parseInt(power["total-cost"]);
                } else if(index == 0) {
                    log("Your first power can't be an alternate effect. Try rearranging your powers.");
                    let values = {};
                    values["repeating_power_" + power.id + "_alternate-effect"] = "0";
                    setAttrs(values, {silent: true});
                    return parseInt(power["total-cost"]);
                }
                
                for(var i = index - 1; i >= 0; i--) {
                    let effectStatus = orderedPowers[i]["alternate-effect"];
                    if(effectStatus !== "1" && effectStatus !== "2") {
                        //Check the cost.
                        if(total > parseInt(orderedPowers[i]["total-cost"])) {
                            log("An alternate effect can't cost more than the primary effect. (Current cost: "
                                + total + ", maximum allowed cost: " + orderedPowers[i]["total-cost"] + ".)");
                            break;
                        } else {
                            //Success!
                            let values = {};
                            values["repeating_power_" + power.id + "_total-cost"] =
                                power["total-cost"] = power["alternate-effect"];
                            setAttrs(values, {silent: true});
                            return parseInt(power["total-cost"]);
                        }
                    } else if(i == 0) {
                        log("Your first power can't be an alternate effect. Try rearranging your powers.");
                    }
                }
                
                //If none was found or if the cost was wrong,
                //then this isn't a valid alternate effect.
                let values = {};
                values["repeating_power_" + power.id + "_alternate-effect"] = "0";
                setAttrs(values, {silent: true});
            }
            
            let values = {};
            values["repeating_power_" + power.id + "_total-cost"] = "" + Math.ceil(total);
            setAttrs(values, {silent: true});
            
            console.log("Power " + orderedPowers.indexOf(power) + " costs " + Math.ceil(total));
            
            return Math.ceil(total);
        }
        
        function recountAdvantages(doneCallback) {
            getAttrs(["Wealth"], function(dict) {
                var wealth = 8;
                if(dict["Wealth"]) {
                    wealth = parseInt(dict["Wealth"]);
                }
                if(!wealth || wealth < 0) {
                    wealth = 0;
                    setAttrs({Wealth:0});
                }
                
                getRepeatingAttributes("advantage", ["name", "ranks"], function(advantages) {
                    var total = Math.ceil(wealth / 4) - 2;
                    equipmentRowID = null;
                    
                    for(var advantage of advantages) {
                        total += parseInt(advantage.ranks);
                        
                        if(advantage.name && advantage.name.toLowerCase() === "equipment") {
                            equipmentRowID = advantage.id;
                            
                            var ranks = parseInt(advantage.ranks);
                            if(ranks) {
                                setAttrs({"equipment-points":ranks * 5}, {silent: true});
                            } else {
                                setAttrs({"equipment-points":5}, {silent: true});
                            }
                        }
                    }
                    
                    setAttrs({"advantage-points": total}, {silent: true});
                    
                    console.log("Spent " + pluralize(total, "point") + " on advantages.");
                    
                    if(doneCallback) {
                        doneCallback();
                    }
                });
            });
        }
        
        function recountEquipment(doneCallback) {
            getRepeatingAttributes("equipment", ["cost"], function(equipment) {
                var total = 0;
                
                for(var e of equipment) {
                    total += parseInt(e.cost);
                }
                
                getAttrs(["equipment-points"], function(attr) {
                    var maximum = 0;
                    if(attr["equipment-points"]) {
                        maximum = parseInt(attr["equipment-points"]);
                    }
                    
                    if(total > maximum) {
                        var ranks = Math.ceil(total / 5);
                        log("Buying " + pluralize(total, "point") + " of equipment requires "
                            + pluralize(ranks, "rank") + " of the Equipment advantage.");
                    } else {
                        getAttrs(["output-message"], function(dict) {
                            if(dict["output-message"].endsWith(" of the Equipment advantage.")) {
                                clearLog();
                            }
                        });
                    }
                    
                    if(doneCallback) {
                        doneCallback();
                    }
                });
            });
        }
        
        on("sheet:opened", function() {
            clearLog();
            
            getAttrs(["equipment-points"], function(attr) {
                if(!attr["equipment-points"]) {
                    recountAll();
                } else {
                    getRepeatingAttributes("advantage", ["name"], function(advantages) {
                        for(var advantage of advantages) {
                            if(advantage.name.toLowerCase() === "equipment") {
                                equipmentRowID = advantage.id;
                                break;
                            }
                        }
                    });
                }
            });
        });
        
        function getSectionIDsOrdered(sectionName, callback) {
            'use strict';
            getAttrs([`_reporder_repeating_${sectionName}`], function(v) {
                getSectionIDs(sectionName, function(idArray) {
                    let reporderArray = v[`_reporder_repeating_${sectionName}`]
                        ? v[`_reporder_repeating_${sectionName}`].toLowerCase().split(',') : [],
                    ids = [...new Set(reporderArray.filter(x => idArray.includes(x)).concat(idArray))];
                    callback(ids);
                });
            });
        }
        
        on("change:repeating_power:name", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker"
                //These values are only ever equal when the attribute is first set.
                && eventInfo.newValue == eventInfo.previousValue) {
                var rowID = eventInfo.sourceAttribute.substr("repeating_power_".length, 20);
                recountPowers(rowID);
            }
        });
        on("change:repeating_power:ranks change:repeating_power:points-per-rank "
                + "change:repeating_power:misc-points change:repeating_power:alternate-effect", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                var rowID = eventInfo.sourceAttribute.substr("repeating_power_".length, 20);
                recountPowers(rowID);
            }
        });
        on("change:repeating_power:total-cost remove:repeating_power", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                recountPowers();
            }
        });
        
        on("change:repeating_advantage:ranks", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                if(eventInfo.sourceAttribute.toLowerCase().indexOf(equipmentRowID) >= 0) {
                    recountAdvantages(recountEquipment);
                } else {
                    recountAdvantages();
                }
            }
        });
        on("change:repeating_advantage:name", function(eventInfo) {
            if(eventInfo.previousValue.toLowerCase() === "equipment") {
                setAttrs({"equipment-points":0}, function() {
                    recountAdvantages(recountEquipment);
                });
            } else if(eventInfo.newValue.toLowerCase() === "equipment"
                || eventInfo.sourceType !== "sheetworker"
                && eventInfo.newValue == eventInfo.previousValue) {
                recountAdvantages(recountEquipment);
            }
        });
        on("remove:repeating_advantage", function(eventInfo) {
            if(eventInfo.sourceAttribute.toLowerCase().indexOf(equipmentRowID) >= 0) {
                setAttrs({"equipment-points":0}, function() {
                    recountAdvantages(recountEquipment);
                });
            } else {
                recountAdvantages();
            }
        });
        
        on("change:Wealth", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                if(eventInfo.newValue !== undefined) {
                    onGotNewValue({Wealth:eventInfo.newValue});
                } else {
                    getAttrs(["Wealth"], onGotNewValue);
                }
                
                function onGotNewValue(data) {
                    var wealth = parseInt(data["Wealth"]);
                    
                    var description;
                    if(wealth <= 0) {
                        description = "Impoverished";
                    } else if(wealth <= 4) {
                        description = "Struggling";
                    } else if(wealth <= 10) {
                        description = "Middle Class";
                    } else if(wealth <= 15) {
                        description = "Affluent";
                    } else if(wealth <= 20) {
                        description = "Wealthy";
                    } else if(wealth <= 30) {
                        description = "Rich";
                    } else {
                        description = "Filthy Rich";
                    }
                    
                    setAttrs({"wealth-description": description}, {silent: true});
                    
                    recountAll();
                }
            }
        });
        
        
        on("change:repeating_equipment:name", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker"
                && eventInfo.newValue == eventInfo.previousValue) {
                recountEquipment();
            }
        });
        on("change:repeating_equipment:cost remove:repeating_equipment", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                recountEquipment();
            }
        });
        
        on("change:output-message", function(eventInfo) {
            if(eventInfo.sourceType !== "sheetworker") {
                clearLog();
            }
        });
    } catch(e) {
        log("Encountered an error: " + e);
    }
</script>

<input class="sheet-hide-output" type="checkbox" name="attr_hide-output" value="1" checked="true" /><span></span>
<input class="sheet-output-message" type="text" name="attr_output-message" title="output-message" />

<div class="sheet-row" style="text-align:center;">
    <img src="http://i.imgur.com/LGn0z0t.jpg" style="max-height: 100px;" title="Mutants and Masterminds Character Sheet"/>
    <br>
    <div class="sheet-section-details" style="border-style:solid;border-width:2px;">
		<div class="sheet-table">
			<div class="sheet-table-row">
				<span class="sheet-table-data"><b>Hero:</b></span>
				<span class="sheet-table-data"><input type="text" name="attr_character_name" title="character_name"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Identity:</b></span>
				<span class="sheet-table-data"><input type="text" name="attr_identity-name" title="identity-name"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><input type="radio" name="attr_identity-status" title="identity-status" value="0"/><b> Secret</b></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><input type="radio" name="attr_identity-status" title="identity-status" value="1"/><b> Public</b></span>
			</div>
		</div>
		<div class="sheet-table">
			<div class="sheet-table-row">
				<span class="sheet-table-data"><b>Gender:</b></span>
				<span class="sheet-table-data"><input style="width:75px" type="text" name="attr_gender" title="gender" value="none"/></span>
				<span class="sheet-table-data"><b>Age:</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_age" title="age" value="0"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Height:</b></span>
				<span class="sheet-table-data"><input style="width:50px;" type="text" name="attr_height" title="height"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Weight:</b></span>
				<span class="sheet-table-data"><input style="width:50px;" type="text" name="attr_weight" title="weight"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Eyes:</b></span>
				<span class="sheet-table-data"><input style="width:100px;" type="text" name="attr_eyes" title="eyes"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Hair:</b></span>
				<span class="sheet-table-data"><input style="width:100px;" type="text" name="attr_hair" title="hair"/></span>
			</div>
		</div>
		<div class="sheet-table">
			<div class="sheet-table-row">
				<span class="sheet-table-data"><b>Group Affiliation:</b></span>
				<span class="sheet-table-data"><input type="text" name="attr_group" title="group"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Base of Operations:</b></span>
				<span class="sheet-table-data"><input type="text" name="attr_base" title="base"/></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Power Level:</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_power-level" title="power-level" value="0"/></span>
			</div>
		</div>
		<div class="sheet-table">
			<div class="sheet-table-row">
				<span class="sheet-table-data"><b>Power Point Totals:</b></span>
				<span class="sheet-table-data">&nbsp;</span>
				<span class="sheet-table-data"><b>Abilities</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_ability-points" title="ability-points" value="(@{total-ability-score} * 2)" disabled/></span>
				<span class="sheet-table-data"><b>+</b></span>
				<span class="sheet-table-data"><b>Powers</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_power-points" title="power-points" value="0"/></span>
				<span class="sheet-table-data"><b>+</b></span>
				<span class="sheet-table-data"><b>Advantages</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_advantage-points" title="advantage-points" value="0"/></span>
				<span class="sheet-table-data"><b>+</b></span>
				<span class="sheet-table-data"><b>Skills</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_skill-points" title="skill-points" value="(@{total-skill-ranks} / 2)" disabled/></span>
				<span class="sheet-table-data"><b>+</b></span>
				<span class="sheet-table-data"><b>Defenses</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_defense-points" title="defense-points" value="@{total-defense-points}" disabled/></span>
				<span class="sheet-table-data"><b>=</b></span>
				<span class="sheet-table-data"><input type="number" name="attr_total-power-points" title="attr_total-power-points" value="(@{ability-points} + @{power-points} + @{advantage-points} + @{skill-points} + @{defense-points})" disabled/></span>
                <span class="sheet-table-data"><b>/</b></span>
                <span class="sheet-table-data"><input type="number" name="attr_max-power-points" title="attr_max-power-points" value="(@{starting-power-points} + @{power-points-earned})" disabled/><b> *</b></span>
			</div>
		</div>
	</div>
</div>
<span class="sheet-table-data" style="width: 100%; font-size: 10px; font-family: courier;"><b>* Total Power Points Earned = Starting Power Points + Power Points Earned</b></span>
<br>

<input type="radio" name="attr_tab" class="sheet-tab sheet-tab1" value="1" title="Stats & Skills" checked="checked"/>
    <span class="sheet-tab sheet-tab1">Stats &amp; Skills</span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab2" value="2" title="Powers, Advantages & Equipment"/>
    <span class="sheet-tab sheet-tab2">Powers, Advantages &amp; Equipment</span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab3" value="3" title="Import Data"/>
    <span class="sheet-tab sheet-tab3">Import Data</span>

<div class="sheet-tab-content sheet-tab1">
    <div class="sheet-2colrow">
    	<div class="sheet-col">
    		<div class="sheet-table">
    			<div class="sheet-table-row">
    				<div class="sheet-table-data">
    					<div class="sheet-section-abilities" style="border-style:solid;border-width:2px;">
    						<div class="sheet-table">
    							<div class="sheet-table-row">
    								<span class="sheet-table-header" style="font-size:10px;">Name</span>
    								<span class="sheet-table-header" style="font-size:10px;">Total</span>
    								<span class="sheet-table-header" style="font-size:10px;">Base</span>
    								<span class="sheet-table-header" style="font-size:10px;">Misc</span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_strength-roll" title="%{strength-roll}" value="@{who-stat} Strength Result: [[@{die_type}+(@{strength-total})]]">Strength</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_strength-total" title="strength-total" value="(@{strength} + @{strength-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_strength" title="strength" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_strength-misc" title="strength-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_agility-roll" title="%{agility-roll}" value="@{who-stat} Agility Result: [[@{die_type}+(@{agility-total})]]">Agility</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_agility-total" title="agility-total" value="(@{agility} + @{agility-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_agility" title="agility" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_agility-misc" title="agility-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_fighting-roll" title="%{fighting-roll}" value="@{who-stat} Fighting Result: [[@{die_type}+(@{fighting-total})]]">Fighting</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_fighting-total" title="fighting-total" value="(@{fighting} + @{fighting-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_fighting" title="fighting" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_fighting-misc" title="fighting-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_awareness-roll" title="%{awareness-roll}" value="@{who-stat} Awareness Result: [[@{die_type}+(@{awareness-total})]]">Awareness</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_awareness-total" title="awareness-total" value="(@{awareness} + @{awareness-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_awareness" title="awareness" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_awareness-misc" title="awareness-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_stamina-roll" title="%{stamina-roll}" value="@{who-stat} Stamina Result: [[@{die_type}+(@{stamina-total})]]">Stamina</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_stamina-total" title="stamina-total" value="(@{stamina} + @{stamina-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_stamina" title="stamina" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_stamina-misc" title="stamina-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_dexterity-roll" title="%{dexterity-roll}" value="@{who-stat} Dexterity Result: [[@{die_type}+(@{dexterity-total})]]">Dexterity</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_dexterity-total" title="dexterity-total" value="(@{dexterity} + @{dexterity-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_dexterity" title="dexterity" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_dexterity-misc" title="dexterity-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_intellect-roll" title="%{intellect-roll}" value="@{who-stat} Intellect Result: [[@{die_type}+(@{intellect-total})]]">Intellect</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_intellect-total" title="intellect-total" value="(@{intellect} + @{intellect-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_intellect" title="intellect" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_intellect-misc" title="intellect-misc" value="0"/></span>
    							</div>
    							<div class="sheet-table-row">
    								<span class="sheet-table-data"><button type="roll" name="roll_presence-roll" title="%{presence-roll}" value="@{who-stat} Presence Result: [[@{die_type}+(@{presence-total})]]">Presence</button></span>
    								<span class="sheet-table-data"><input type="number" name="attr_presence-total" title="presence-total" value="(@{presence} + @{presence-misc})" disabled/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_presence" title="presence" value="0"/></span>
    								<span class="sheet-table-data"><input type="number" name="attr_presence-misc" title="presence-misc" value="0"/></span>
    							</div>
    							<input type="hidden" name="attr_total-ability-score" value="(@{strength} + @{agility} + @{fighting} + @{awareness} + @{stamina} + @{dexterity} + @{intellect} + @{presence})" disabled/>
    						</div>
    					</div>
    				</div>
    			</div>
    			<br>
    			<div class="sheet-table-row">
    				<div class="sheet-table-data">
    					<div class="sheet-section-points" style="border-style:solid;border-width:2px;">
    						<div class="sheet-table">
        						<div class="sheet-table-row">
                                    <span class="sheet-table-header" style="font-size:9px; width:25%;">Starting Power Points</span>
            						<span class="sheet-table-header" style="font-size:9px; width:25%;">Power Points Earned</span>
                                    <span class="sheet-table-header" style="border-left:solid #000; border-width:2px;"></span>
        							<span class="sheet-table-header" style="font-size:10px; width:25%;">Hero Points</span>
        							<span class="sheet-table-header" style="font-size:10px; width:25%;">Injuries</span>
        						</div>
        						<div class="sheet-table-row">
                                    <span class="sheet-table-data"><input type="number" name="attr_starting-power-points" title="starting-power-points" value="0"/></span>
            						<span class="sheet-table-data"><input type="number" name="attr_power-points-earned" title="power-points-earned" value="0"/></span>
                                    <span class="sheet-table-header" style="border-left:solid #000; border-width:2px;"></span>
        							<span class="sheet-table-data"><input type="number" name="attr_hero-points" title="hero-points" value="0"/></span>
        							<span class="sheet-table-data"><input type="number" name="attr_injuries" title="injuries" value="0"/></span>
        						</div>
    						</div>
    					</div>
    				</div>
    			</div>
    		</div>
    		<br>
            <div class="sheet-section-defenses" style="border-style:solid;border-width:2px;">
				<span class="sheet-table-data"><b>Defense - Dodge DC <input type="number" name="attr_dodge" title="dodge" value="(@{dodge} + 10)" disabled/> Parry DC <input type="number" name="attr_parry" title="parry" value="(@{parry} + 10)" disabled/></b></span>
    			<div class="sheet-table">
    				<div class="sheet-table-row">
    					<span class="sheet-table-header"></span>
    					<span class="sheet-table-header" style="font-size:10px;">Name</span>
    					<span class="sheet-table-header">&nbsp;</span>
    					<span class="sheet-table-header" style="font-size:10px;">Ability Name</span>
    					<span class="sheet-table-header">&nbsp;</span>
    					<span class="sheet-table-header" style="font-size:10px;">Total</span>
    					<span class="sheet-table-header">=</span>
    					<span class="sheet-table-header" style="font-size:10px;">Points</span>
    					<span class="sheet-table-header">+</span>
    					<span class="sheet-table-header" style="font-size:10px;">Ability</span>
    					<span class="sheet-table-header">+</span>
    					<span class="sheet-table-header" style="font-size:10px;">Misc</span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data"><button type="roll" name="roll_Dodge" title="Dodge" value="&{template:default} {{name=@{character_name}}} {{Dodge=[[1d20 + @{dodge}]]}}"></button></span>
    					<span class="sheet-table-data"><b>Dodge</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><b>AGL</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><input type="number" name="attr_dodge" title="dodge" value="(@{dodge-points} + @{agility-total} + @{dodge-misc} + @{Total_Defenses_Mod})" disabled/></span>
    					<span class="sheet-table-data"><b>=</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_dodge-points" title="dodge-points" value="0"/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_dodge-ability" title="agility" value="@{agility-total}" disabled/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_dodge-misc" title="dodge-misc" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data"><button type="roll" name="roll_Parry" title="Parry" value="&{template:default} {{name=@{character_name}}} {{Parry=[[1d20 + @{parry}]]}}"></button></span>
    					<span class="sheet-table-data"><b>Parry</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><b>FGT</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><input type="number" name="attr_parry" title="parry" value="(@{parry-points} + @{fighting-total} + @{parry-misc} + @{Total_Defenses_Mod})" disabled/></span>
    					<span class="sheet-table-data"><b>=</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_parry-points" title="parry-points" value="0"/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_parry-ability" title="fighting" value="@{fighting-total}" disabled/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_parry-misc" title="parry-misc" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data"><button type="roll" name="roll_Fortitude" title="Fortitude" value="@{who-combat} Fortitude result: [[@{die_type} + @{fortitude}]]"></button></span>
    					<span class="sheet-table-data"><b>Fortitude</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><b>STA</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><input type="number" name="attr_fortitude" title="fortitude" value="(@{fortitude-points} + @{stamina-total} + @{fortitude-misc})" disabled/></span>
    					<span class="sheet-table-data"><b>=</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_fortitude-points" title="fortitude-points" value="0"/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_fortitude-ability" title="stamina" value="@{stamina-total}" disabled/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_fortitude-misc" title="fortitude-misc" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data"><button type="roll" name="roll_Toughness" title="Toughness" value="@{who-combat} Toughness result: [[@{die_type} + @{toughness}]]"></button></span>
    					<span class="sheet-table-data"><b>Toughness</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><b>STA</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><input type="number" name="attr_toughness" title="toughness" value="(@{toughness-points} + @{stamina-total} + @{toughness-misc} + (-1 * abs(@{injuries})))" disabled/></span>
    					<span class="sheet-table-data"><b>=</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_toughness-points" title="toughness-points" value="0"/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_toughness-ability" title="stamina" value="@{stamina-total}" disabled/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_toughness-misc" title="toughness-misc" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data"><button type="roll" name="roll_Will" title="Will" value="@{who-combat} Will result: [[@{die_type} + @{will}]]"></button></span>
    					<span class="sheet-table-data"><b>Will</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><b>AWE</b></span>
    					<span class="sheet-table-data">&nbsp;</span>
    					<span class="sheet-table-data"><input type="number" name="attr_will" title="will" value="(@{will-points} + @{awareness-total} + @{will-misc})" disabled/></span>
    					<span class="sheet-table-data"><b>=</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_will-points" title="will-points" value="0"/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_will-ability" title="awareness" value="@{awareness-total}" disabled/></span>
    					<span class="sheet-table-data"><b>+</b></span>
    					<span class="sheet-table-data"><input type="number" name="attr_will-misc" title="will-misc" value="0"/></span>
    				</div>
    				<input type="hidden" name="attr_total-defense-points" value="(@{dodge-points} + @{parry-points} + @{fortitude-points} + @{toughness-points} + @{will-points})" disabled/>
    			</div>
    		</div>
            <br>
            <div class="sheet-section-offense" style="border-style:solid;border-width:2px;">
            	<span class="sheet-table-data"><b>Offense</b></span>
    			<br>
    			<span class="sheet-table-data"><button type="roll" name="roll_Initiative" title="Initiative" value="@{who-initiative} &{template:default} {{name= @{character_name}'s Initiative}} {{Result: [[@{die_type} + @{initiative} &amp;{tracker}]]}}"></button></span>
    			<span class="sheet-table-data"><b>Initiative:</b></span>
    			<span class="sheet-table-data"><input type="number" name="attr_initiative" title="initiative" value="(@{initiative-misc} + @{agility-total})" disabled/></span>
    			<span class="sheet-table-data"><b>=</b></span>
    			<span class="sheet-table-data"><input type="number" name="attr_initiative-misc" title="initiative-misc" value="0"/></span>
    			<span class="sheet-table-data"><b>+</b></span>
    			<span class="sheet-table-data"><input type="number" name="attr_initiative-ability" title="agility" value="@{agility-total}" disabled/></span>
    			<br>
    			<fieldset class="repeating_attacks">
    				<span class="sheet-table-data"><button type="roll" name="roll_attack-roll" title="repeating_attack_X_attack-roll (NOT USABLE IN MACROS)" value="@{macro-text}"></button></span>
    				<span class="sheet-table-data"><input type="text" name="attr_name" title="Attack Name" value="Name"/></span>
    				<span class="sheet-table-data"><input type="number" name="attr_bonus" title="Attack Bonus" value="0"/></span>
					<span class="sheet-table-data"><input type="number" name="attr_crit_rate" title="Crit Target" value="20"/></span>
					<span class="sheet-table-data"><input type="number" name="attr_effect_ranks" title="Effect Ranks" value="0"/></span>
					<span class="sheet-table-data">
						<select name="attr_save_base" title="Save Type">
							<option value="10">Dodge</option>
							<option value="10">Parry</option>
							<option value="15" selected>Toughness</option>
							<option value="10">Fortitude</option>
							<option value="10">Will</option></span>
    				<span class="sheet-table-data"><input type="text" name="attr_effect" title="Effect Names" value="Effect notes go here"/></span>
    				<span style="font-size:10px;"><b>Show Macro Text?&nbsp;&nbsp;</b></span>
    				<input type="checkbox" class="sheet-macro-show" title="repeating_attacks_X_macro-text-show" name="attr_macro-text-show" value="1" style="opacity:0;width: 16px;height: 16px;position: relative;top: 5px;left: 6px;margin: -10px;cursor: pointer;z-index: 1;"/><span></span>
    				<textarea class="sheet-macro" title="repeating_attacks_X_macro-text" name="attr_macro-text">@{who-combat} &{template:default} {{name= @{name}}} {{Result=[[@{die_type}cs>@{crit_rate} + @{bonus} + @{Total_Attack_Mod}]] }} {{Effect= DC [[@{save_base} + @{effect_ranks} + @{Total_Effect_Mod}]]}} {{Notes= @{effect}}}</textarea>
    			</fieldset>
    		</div>
            <br>
				<div class="sheet-section-modifiers" style="border-style:solid;border-width:2px;">
					<div class="sheet-table">
    					<div class="sheet-table-row">
    						<span class="sheet-table-header" style="width:40%; font-size:10px;">Name</span>
							<span class="sheet-table-header" style="width:20%; font-size:10px;">Attack</span>
    						<span class="sheet-table-header" style="width:20%; font-size:10px;">Defense</span>
    						<span class="sheet-table-header" style="width:20%; font-size:10px;">Effect</span>
    					</div>
   						<div class="sheet-table-row">
    							<!-- <span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Insight-Check" title="Insight-Check" value="@{who-skill} Insight check: [[@{die_type} + @{Insight}]]"></button></span> -->
    							<span class="sheet-table-data" style="width:85%;"><b>Accurate Attack</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AccAtk_Attack" title="Accurate-Attack Attack Bonus" value="0"/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AccAtk_Defenses" title="Accurate-Attack Defense Bonus" value="0" disabled/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AccAtk_Effect" title="Accurate Attack Effect Penalty" value="(-1)*@{AccAtk_Attack}" disabled/></span>
   						</div>
   						<div class="sheet-table-row">
    							<span class="sheet-table-data" style="width:85%;"><b>All-out Attack</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AOAtk_Attack" title="All-out Attack Attack Bonus" value="0"/></span>
    							<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AOAtk_Defenses" title="All0out Attack Defense Penalty" value="(-1)*@{AOAtk_Attack}" disabled/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_AOAtk_Effect" title="All-out Attack Effect Bonus" value="0" disabled/></span>
   						</div>
						<div class="sheet-table-row">
    							<span class="sheet-table-data" style="width:85%;"><b>Defensive Attack</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_DefAtk_Attack" title="Defensive Attack Attack Penalty" value="(-1)*@{DefAtk_Defenses}" disabled/></span>
    							<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_DefAtk_Defenses" title="Defensive Attack Defense Bonus" value="0" /></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_DefAtk_Effect" title="Defensive Attack Effect Penalty" value="0"disabled/></span>
   						</div>
						<div class="sheet-table-row">
    							<span class="sheet-table-data" style="width:85%;"><b>Power Attack</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_PwrAtk_Attack" title="Power Attack-Attack Penalty" value="0"/></span>
    							<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_PwrAtk_Defenses" title="Power Attack Defense Bonus" value="0" disabled/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_PwrAtk_Effect" title="Power Attack Effect Bonus" value="(-1)*@{PwrAtk_Attack}" disabled/></span>
   						</div>
						<div class="sheet-table-row">
    							<span class="sheet-table-data" style="width:85%;"><b>Conditions</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Cnd_Attack" title="Condition Attack Modifier" value="0"/></span>
    							<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Cnd_Defenses" title="Condition Defense Modifier" value="0" disabled/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Cnd_Effect" title="Condition Effect Modifier" value="0" /></span>
   						</div>
						<div class="sheet-table-row">
    							<span class="sheet-table-data" style="width:85%;"><b>Totals</b></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Total_Attack_Mod" title="Combined Attack Modifier" value="(@{AccAtk_Attack} + @{AOAtk_Attack} + @{DefAtk_Attack} + @{PwrAtk_Attack} + @{Cnd_Attack})" disabled/></span>
    							<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Total_Defenses_Mod" title="Combined Defense Modifier" value="(@{AccAtk_Defenses} + @{AOAtk_Defenses} + @{DefAtk_Defenses} + @{PwrAtk_Defenses} + @{Cnd_Defenses})" disabled/></span>
								<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Total_Effect_Mod" title="Combined Effect Modifier" value="(@{AccAtk_Effect} + @{AOAtk_Effect} + @{DefAtk_Effect} + @{PwrAtk_Effect} + @{Cnd_Effect})" disabled/></span>
   						</div>
					</div>
				</div>
    		</div>
        <div class="sheet-col">
            <div class="sheet-section-skills" style="border-style:solid;border-width:2px;">
        		<div class="sheet-table">
    				<div class="sheet-table-row">
    					<span class="sheet-table-header" style="width:5%;"></span>
    					<span class="sheet-table-header" style="width:75%; font-size:10px;">Name</span>
                        <span class="sheet-table-header" style="width:5%; font-size:10px;">Ability</span>
    					<span class="sheet-table-header" style="width:5%; font-size:10px;">Total</span>
    					<span class="sheet-table-header" style="width:5%; font-size:10px;">Ability</span>
    					<span class="sheet-table-header" style="width:5%; font-size:10px;">Ranks</span>
    					<span class="sheet-table-header" style="width:5%; font-size:10px;">Other</span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Acrobatics-Check" title="Acrobatics-Check" value="@{who-skill} Acrobatics check: [[@{die_type} + @{Acrobatics}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Acrobatics</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>AGI</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Acrobatics" title="Acrobatics" value="(@{Acrobatics-ability} + @{Acrobatics-ranks} + @{Acrobatics-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Acrobatics-ability" title="Acrobatics-ability" value="@{agility-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Acrobatics-ranks" title="Acrobatics-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Acrobatics-other" title="Acrobatics-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Athletics-Check" title="Athletics-Check" value="@{who-skill} Athletics check: [[@{die_type} + @{Athletics}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Athletics</b></span>
    					<span class="sheet-table-data" style="width:5%;"><b>STR</b></span>
                        <span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Athletics" title="Athletics" value="(@{Athletics-ability} + @{Athletics-ranks} + @{Athletics-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Athletics-ability" title="Athletics-ability" value="@{strength-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Athletics-ranks" title="Athletics-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Athletics-other" title="Athletics-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Close Combat</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>FGT</b></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Close-Combat-1-Check" title="Close-Combat-1-Check" value="@{who-skill} @{Close-Combat-1-name} check: [[@{die_type} + @{Close-Combat-1}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Close-Combat-1-name" title="Close-Combat-1-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-1" title="Close-Combat-1" value="(@{Close-Combat-1-ability} + @{Close-Combat-1-ranks} + @{Close-Combat-1-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-1-ability" title="Close-Combat-1-ability" value="@{fighting-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-1-ranks" title="Close-Combat-1-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-1-other" title="Close-Combat-1-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Close-Combat-2-Check" title="Close-Combat-2-Check" value="@{who-skill} @{Close-Combat-2-name} check: [[@{die_type} + @{Close-Combat-2}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Close-Combat-2-name" title="Close-Combat-2-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-2" title="Close-Combat-2" value="(@{Close-Combat-2-ability} + @{Close-Combat-2-ranks} + @{Close-Combat-2-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-2-ability" title="Close-Combat-2-ability" value="@{fighting-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-2-ranks" title="Close-Combat-2-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-2-other" title="Close-Combat-2-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Close-Combat-3-Check" title="Close-Combat-3-Check" value="@{who-skill} @{Close-Combat-3-name} check: [[@{die_type} + @{Close-Combat-3}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Close-Combat-3-name" title="Close-Combat-3-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-3" title="Close-Combat-3" value="(@{Close-Combat-3-ability} + @{Close-Combat-3-ranks} + @{Close-Combat-3-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-3-ability" title="Close-Combat-3-ability" value="@{fighting-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-3-ranks" title="Close-Combat-3-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Close-Combat-3-other" title="Close-Combat-3-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Deception-Check" title="Deception-Check" value="@{who-skill} Deception check: [[@{die_type} + @{Deception}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Deception</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>PRS</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Deception" title="Deception" value="(@{Deception-ability} + @{Deception-ranks} + @{Deception-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Deception-ability" title="Deception-ability" value="@{presence-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Deception-ranks" title="Deception-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Deception-other" title="Deception-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Expertise</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>INT</b></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Expertise-1-Check" title="Expertise-1-Check" value="@{who-skill} @{Expertise-1-name} check: [[@{die_type} + @{Expertise-1}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Expertise-1-name" title="Expertise-1-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-1" title="Expertise-1" value="(@{Expertise-1-ability} + @{Expertise-1-ranks} + @{Expertise-1-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-1-ability" title="Expertise-1-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-1-ranks" title="Expertise-1-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-1-other" title="Expertise-1-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Expertise-2-Check" title="Expertise-2-Check" value="@{who-skill} @{Expertise-2-name} check: [[@{die_type} + @{Expertise-2}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Expertise-2-name" title="Expertise-2-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-2" title="Expertise-2" value="(@{Expertise-2-ability} + @{Expertise-2-ranks} + @{Expertise-2-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-2-ability" title="Expertise-2-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-2-ranks" title="Expertise-2-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-2-other" title="Expertise-2-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Expertise-3-Check" title="Expertise-3-Check" value="@{who-skill} @{Expertise-3-name} check: [[@{die_type} + @{Expertise-3}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Expertise-3-name" title="Expertise-3-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-3" title="Expertise-3" value="(@{Expertise-3-ability} + @{Expertise-3-ranks} + @{Expertise-3-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-3-ability" title="Expertise-3-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-3-ranks" title="Expertise-3-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-3-other" title="Expertise-3-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Expertise-4-Check" title="Expertise-4-Check" value="@{who-skill} @{Expertise-4-name} check: [[@{die_type} + @{Expertise-4}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Expertise-4-name" title="Expertise-4-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-4" title="Expertise-4" value="(@{Expertise-4-ability} + @{Expertise-4-ranks} + @{Expertise-4-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-4-ability" title="Expertise-4-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-4-ranks" title="Expertise-4-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Expertise-4-other" title="Expertise-4-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Insight-Check" title="Insight-Check" value="@{who-skill} Insight check: [[@{die_type} + @{Insight}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Insight</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>AWE</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Insight" title="Insight" value="(@{Insight-ability} + @{Insight-ranks} + @{Insight-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Insight-ability" title="Insight-ability" value="@{awareness-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Insight-ranks" title="Insight-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Insight-other" title="Insight-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Intimidation-Check" title="Intimidation-Check" value="@{who-skill} Intimidation check: [[@{die_type} + @{Intimidation}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Intimidation</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>PRS</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Intimidation" title="Intimidation" value="(@{Intimidation-ability} + @{Intimidation-ranks} + @{Intimidation-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Intimidation-ability" title="Intimidation-ability" value="@{presence-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Intimidation-ranks" title="Intimidation-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Intimidation-other" title="Intimidation-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Investigation-Check" title="Investigation-Check" value="@{who-skill} Investigation check: [[@{die_type} + @{Investigation}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Investigation</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>INT</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Investigation" title="Investigation" value="(@{Investigation-ability} + @{Investigation-ranks} + @{Investigation-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Investigation-ability" title="Investigation-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Investigation-ranks" title="Investigation-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Investigation-other" title="Investigation-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Perception-Check" title="Perception-Check" value="@{who-skill} Perception check: [[@{die_type} + @{Perception}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Perception</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>AWE</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Perception" title="Perception" value="(@{Perception-ability} + @{Perception-ranks} + @{Perception-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Perception-ability" title="Perception-ability" value="@{awareness-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Perception-ranks" title="Perception-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Perception-other" title="Perception-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Persuasion-Check" title="Persuasion-Check" value="@{who-skill} Persuasion check: [[@{die_type} + @{Persuasion}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Persuasion</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>PRS</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Persuasion" title="Persuasion" value="(@{Persuasion-ability} + @{Persuasion-ranks} + @{Persuasion-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Persuasion-ability" title="Persuasion-ability" value="@{presence-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Persuasion-ranks" title="Persuasion-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Persuasion-other" title="Persuasion-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Ranged Combat</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>DEX</b></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Ranged-Combat-1-Check" title="Ranged-Combat-1-Check" value="@{who-skill} @{Ranged-Combat-1-name} check: [[@{die_type} + @{Ranged-Combat-1}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Ranged-Combat-1-name" title="Ranged-Combat-1-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-1" title="Ranged-Combat-1" value="(@{Ranged-Combat-1-ability} + @{Ranged-Combat-1-ranks} + @{Ranged-Combat-1-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-1-ability" title="Ranged-Combat-1-ability" value="@{dexterity-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-1-ranks" title="Ranged-Combat-1-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-1-other" title="Ranged-Combat-1-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Ranged-Combat-2-Check" title="Ranged-Combat-2-Check" value="@{who-skill} @{Ranged-Combat-2-name} check: [[@{die_type} + @{Ranged-Combat-2}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Ranged-Combat-2-name" title="Ranged-Combat-2-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-2" title="Ranged-Combat-2" value="(@{Ranged-Combat-2-ability} + @{Ranged-Combat-2-ranks} + @{Ranged-Combat-2-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-2-ability" title="Ranged-Combat-2-ability" value="@{dexterity-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-2-ranks" title="Ranged-Combat-2-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-2-other" title="Ranged-Combat-2-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Ranged-Combat-3-Check" title="Ranged-Combat-3-Check" value="@{who-skill} @{Ranged-Combat-3-name} check: [[@{die_type} + @{Ranged-Combat-3}]]"></button></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="text" name="attr_Ranged-Combat-3-name" title="Ranged-Combat-3-name"/></span>
                        <span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-3" title="Ranged-Combat-3" value="(@{Ranged-Combat-3-ability} + @{Ranged-Combat-3-ranks} + @{Ranged-Combat-3-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-3-ability" title="Ranged-Combat-3-ability" value="@{dexterity-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-3-ranks" title="Ranged-Combat-3-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Ranged-Combat-3-other" title="Ranged-Combat-3-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Sleight-of-hand-Check" title="Sleight-of-hand-Check" value="@{who-skill} Sleight of Hand check: [[@{die_type} + @{Sleight-of-hand}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Sleight of Hand</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>DEX</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Sleight-of-hand" title="Sleight-of-hand" value="(@{Sleight-of-hand-ability} + @{Sleight-of-hand-ranks} + @{Sleight-of-hand-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Sleight-of-hand-ability" title="Sleight-of-hand-ability" value="@{dexterity-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Sleight-of-hand-ranks" title="Sleight-of-hand-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Sleight-of-hand-other" title="Sleight-of-hand-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Stealth-Check" title="Stealth-Check" value="@{who-skill} Stealth check: [[@{die_type} + @{Stealth}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Stealth</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>AGI</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Stealth" title="Stealth" value="(@{Stealth-ability} + @{Stealth-ranks} + @{Stealth-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Stealth-ability" title="Stealth-ability" value="@{agility-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Stealth-ranks" title="Stealth-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Stealth-other" title="Stealth-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Technology-Check" title="Technology-Check" value="@{who-skill} Technology check: [[@{die_type} + @{Technology}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Technology</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>INT</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Technology" title="Technology" value="(@{Technology-ability} + @{Technology-ranks} + @{Technology-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Technology-ability" title="Technology-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Technology-ranks" title="Technology-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Technology-other" title="Technology-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Treatment-Check" title="Treatment-Check" value="@{who-skill} Treatment check: [[@{die_type} + @{Treatment}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Treatment</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>INT</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Treatment" title="Treatment" value="(@{Treatment-ability} + @{Treatment-ranks} + @{Treatment-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Treatment-ability" title="Treatment-ability" value="@{intellect-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Treatment-ranks" title="Treatment-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Treatment-other" title="Treatment-other" value="0"/></span>
    				</div>
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"><button type="roll" name="roll_Vehicles-Check" title="Vehicles-Check" value="@{who-skill} Vehicles check: [[@{die_type} + @{Vehicles}]]"></button></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Vehicles</b></span>
                        <span class="sheet-table-data" style="width:5%;"><b>DEX</b></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Vehicles" title="Vehicles" value="(@{Vehicles-ability} + @{Vehicles-ranks} + @{Vehicles-other})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Vehicles-ability" title="Vehicles-ability" value="@{dexterity-total}" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Vehicles-ranks" title="Vehicles-ranks" value="0"/></span>
    					<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_Vehicles-other" title="Vehicles-other" value="0"/></span>
    				</div>			
    				<div class="sheet-table-row">
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data" style="width:75%;"><b>Total Ranks</b></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    					<span class="sheet-table-data"><input type="number" name="attr_total-skill-ranks" title="total-skill-ranks" value="(@{Acrobatics-ranks} + @{Athletics-ranks} + @{Close-Combat-1-ranks}+ @{Close-Combat-2-ranks} + @{Close-Combat-3-ranks} + @{Deception-ranks} + @{Expertise-1-ranks} + @{Expertise-2-ranks} + @{Expertise-3-ranks} + @{Expertise-4-ranks} + @{Insight-ranks} + @{Intimidation-ranks} + @{Investigation-ranks} + @{Perception-ranks} + @{Persuasion-ranks} + @{Ranged-Combat-1-ranks} + @{Ranged-Combat-2-ranks} + @{Ranged-Combat-3-ranks} + @{Sleight-of-hand-ranks} + @{Stealth-ranks} + @{Technology-ranks} + @{Treatment-ranks} + @{Vehicles-ranks})" disabled/></span>
    					<span class="sheet-table-data" style="width:5%;"></span>
    				</div></div>
            <div class="sheet-section-notes" style="border-style:solid;border-width:2px;">
            	<span class="sheet-table-data"><b>Notes & Conditions</b></span>
    			<br>
    			<textarea style="height:100px" name="attr_notes" title="notes"></textarea><br>
    		</div>
    		</div>
		</div>
        </div>
    <br>
    <div class="sheet-section-complications" style="border-style:solid;border-width:2px;">
    	<span class="sheet-table-data"><b>Motivations & Complications</b></span>
		<br>
		<fieldset class="repeating_complication">
			<span class="sheet-table-data"><input type="text" name="attr_name" title="repeating_complication_X_name" value="Name"/></span>
			<textarea name="attr_description" title="repeating_complication_X_description" style="height:90px;">Description</textarea>
		</fieldset>
	</div>
	</div>
</div>

<div class="sheet-tab-content sheet-tab2">
    <input type="radio" name="attr_subtab" class="sheet-tab sheet-tab11" value="1" title="Powers & Devices"/>
        <span class="sheet-tab sheet-tab11">Powers & Devices</span>
    <input type="radio" name="attr_subtab" class="sheet-tab sheet-tab12" value="2" title="Advantages"/>
        <span class="sheet-tab sheet-tab12">Advantages</span>
    <input type="radio" name="attr_subtab" class="sheet-tab sheet-tab13" value="3" title="Equipment"/>
        <span class="sheet-tab sheet-tab13">Equipment</span>
    <input type="radio" name="attr_subtab" class="sheet-tab sheet-tab99" value="99" title="All" checked/>
        <span class="sheet-tab sheet-tab99">All</span>
        
    <div class="sheet-tab-content sheet-tab11 sheet-tab99">
        <div class="sheet-section-powers" style="border-style:solid;border-width:2px;">
        	<span class="sheet-table-data"><b>Powers & Devices</b></span>
    			<span class="sheet-table-header" style="width:60%;"></span>
    			<span class="sheet-table-header" style="width:6%; font-size:10px;">Ranks</span>
    			<span class="sheet-table-header" style="width:6%; font-size:10px;">Points Per Rank</span>
    			<span class="sheet-table-header" style="width:6%; font-size:10px;">Misc</span>
    			<span class="sheet-table-header" style="width:6%; font-size:10px;">Total</span>
    		<fieldset class="repeating_power">
    		    <span class="sheet-table-data"><button type="roll" name="attr_adv" title="adv" value="@{who-effects} &amp;{template:default} {{name=@{character_name} - @{name}}} {{@{description}}}" class="btn ui-draggable"></button></span>
    			<span class="sheet-table-data" style="width:100%"><input type="text" name="attr_name" title="repeating_power_X_name" value="Name"/></span>
    			<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_ranks" title="repeating_power_X_ranks" value="1"/></span>
    			<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_points-per-rank" title="repeating_power_X_points-per-rank" value="1"/></span>
    			<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_misc-points" title="repeating_power_X_misc-points" value="0"/></span>
    			<span class="sheet-table-data" style="width:5%;"><input type="number" name="attr_total-cost" title="repeating_power_X_total-cost" value="1" /></span>
    			<span style="font-size:10px;"><b>&nbsp;Options&nbsp;&nbsp;</b></span>
        		<input type="checkbox" class="sheet-macro-show" title="repeating_attacks_X_macro-text-show" name="attr_macro-text-show" value="1" style="opacity:0;width: 16px;height: 16px;position: relative;top: 5px;left: 6px;margin: -10px;cursor: pointer;z-index: 1;"/><span></span>
    			<div class="sheet-macro">
        			<label class="sheet-table-checkbox"><input type="radio" name="attr_alternate-effect" title="repeating_power_X_alternate-effect" value="0" checked="true" /><span>Normal power</span></label>
        			<label class="sheet-table-checkbox"><input type="radio" name="attr_alternate-effect" title="repeating_power_X_alternate-effect" value="1" /><span>Alternate effect</span></label>
        			<label class="sheet-table-checkbox"><input type="radio" name="attr_alternate-effect" title="repeating_power_X_dynamic-alternate-effect" value="2" /><span>Dynamic alternate effect</span></label>
        		</div>
    			<textarea name="attr_description" title="repeating_power_X_description" style="height:90px;">Description</textarea>
    			<hr>
    		</fieldset>
    	</div>
        <br>
    </div>
    <div class="sheet-tab-content sheet-tab12 sheet-tab99">
        <div class="sheet-section-advantages" style="border-style:solid;border-width:2px;">
            <span class="sheet-table-data" style="height:36px;"><b>&nbsp;Advantages</b></span>
            <fieldset class="repeating_advantage">
                <span class="sheet-table-data"><button type="roll" name="attr_adv" title="adv" value="@{who-effects} &amp;{template:default} {{name=@{character_name} - @{name}}} {{@{description}}}" class="btn ui-draggable"></button></span>
                <span class="sheet-table-data"><input type="number" name="attr_ranks" title="repeating_advantage_X_ranks" value="1"/></span>
                <span class="sheet-table-data"><input type="text" name="attr_name" title="repeating_advantage_X_name" value="Name"/></span>
                <textarea name="attr_description" title="repeating_advantage_X_description" style="height:90px;">Description</textarea>
                <hr>
            </fieldset>
        </div>
        <br>
        <input type="checkbox" class="sheet-secret-macro-show" name="attr_use-wealth-rules" value="1"/><span></span>
        <div class="sheet-macro">
            <div class="sheet-section-wealth" style="border-style:solid;border-width:2px;">
            	<span class="sheet-table-data" style="height:36px;"><b>&nbsp;Wealth</b></span>
    			<br>
    			<span class="sheet-table-data"><button type="roll" name="roll_Wealth" title="Wealth-Check" value="@{who-skill} Wealth check: [[@{die_type} + @{Wealth}]]"></button></span>
    			<span class="sheet-table-data"><input type="number" name="attr_Wealth" title="Wealth" value="8"/></span>
    			<span class="sheet-table-data"><input class="sheet-no-border" type="text" name="attr_wealth-description" value="Middle Class" /></span>
    		</div>
    	</div>
        <br>
    </div>
    <div class="sheet-tab-content sheet-tab13 sheet-tab99">
    	<div class="sheet-section-equipment" style="border-style:solid;border-width:2px;">
    		<span class="sheet-table-data" style="height:36px;"><b>&nbsp;Equipment, Vehicles, and Headquarters</b></span>
    		<fieldset class="repeating_equipment">
    		    <span class="sheet-table-data"><button type="roll" name="attr_adv" title="adv" value="@{who-effects} &amp;{template:default} {{name=@{character_name} - @{name}}} {{@{description}}}" class="btn ui-draggable"></button></span>
    			<span class="sheet-table-data"><input type="number" name="attr_cost" title="repeating_equipment_X_cost" value="1"/></span>
    			<span class="sheet-table-data"><input type="text" name="attr_name" title="repeating_equipment_X_name" value="Name"/></span>
    			<textarea name="attr_description" title="repeating_equipment_X_description" style="height:90px;">Description</textarea>
    			<hr>
    		</fieldset>
        </div>
	</div>
</div>
	<div class="sheet-tab-content sheet-tab3">
		<!-- <div class="sheet-col"> -->
			<div class="sheet-section-import" style="border-style:solid;border-width:2px;">
    			<span class="sheet-table-data"><b>Import and Options</b></span>
    			<br>
    			<textarea style="height:10em" name="attr_import_xml" title="import_xml">Coming Soom!</textarea><br>
			</div>
			<div class="sheet-section-options" style="border-style:solid;border-width:2px;">
    			<div class="sheet-table-row">
					<span class="sheet-table-data"><b>Roll Target - Stats: </b></span>
					<span class="sheet-table-data">
					<label class="sheet-small-label1">
						<select name="attr_who-stat" title="@{who-stat}">
							<option value="@{character_name}'s">Public</option>
							<option value="/em 's" selected>Public Emote</option>
							<option value="/w gm @{character_name}'s">Whisper GM</option>
							<option value="/w @{character_name}">Whisper Self</option>
						</select>
					</label>
					</span>
				</div>
				<div class="sheet-table-row">
					<span class="sheet-table-data"><b>Roll Target - Combat: </b></span>
					<span class="sheet-table-data">
						<label class="sheet-small-label1">
							<select name="attr_who-combat" title="@{who-combat}">
							<option value="@{character_name}'s">Public</option>
							<option value="/em 's" selected>Public Emote</option>
							<option value="/w gm @{character_name}'s">Whisper GM</option>
							<option value="/w @{character_name}">Whisper Self</option>
							</select>
						</label>
					</span>
				</div>
				<div class="sheet-table-row">
					<span class="sheet-table-data"><b>Roll Target - Initiative: </b></span>
					<span class="sheet-table-data">
						<label class="sheet-small-label1">
							<select name="attr_who-initiative" title="@{who-initiative}">
							<option value=" ">Public</option>
							<option value="/w gm " selected>Whisper GM</option>
							<option value="/w @{character_name}">Whisper Self</option>
							</select>
						</label>
					</span>
				</div>
				<div class="sheet-table-row">
					<span class="sheet-table-data"><b>Roll Target - Skill: </b></span>
					<span class="sheet-table-data">
						<label class="sheet-small-label1">
							<select name="attr_who-skill" title="@{who-skill}">
							<option value="@{character_name}'s">Public</option>
							<option value="/em 's" selected>Public Emote</option>
							<option value="/w gm @{character_name}'s">Whisper GM</option>
							<option value="/w @{character_name}">Whisper Self</option>
							</select>
						</label>
					</span>
				</div>
				<div class="sheet-table-row">
					<span class="sheet-table-data"><b>Roll Target - Effects: </b></span>
					<span class="sheet-table-data">
						<label class="sheet-small-label1">
							<select name="attr_who-effects" title="@{who-effects}">
							<option value="@{character_name}'s">Public</option>
							<option value="/em 's" selected>Public Emote</option>
							<option value="/w gm @{character_name}'s">Whisper GM</option>
							<option value="/w @{character_name}">Whisper Self</option>
							</select>
						</label>
					</span>
				</div>
				<div style="border-style:solid;border-width:2px;">
    				<div class="sheet-table-row">
						<span class="sheet-table-data"><b>Dice Roll Type: </b></span>
						<span class="sheet-table-data">
							<label class="sheet-small-label1">
								<select name="attr_die_type" title="@{die_type}">
								<option value="1d20" selected>Standard 1d20</option>
								<option value="3d20k2dh1">3d20 Gamematers Guide</option>
								<option value="3d6cs>16">Sum 3d6</option>
								</select>
							</label>
						</span>
					</div>
				</div>
			</div>
			</div>
<div class="sheet-mnm-footer">
	<img src="http://fyndhal.woobsha.com/SPMM_logo_.png" class="sheet-mnm-logo">
</div>