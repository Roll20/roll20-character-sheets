<script type="text/worker">
    var log = function(value) {
        console.log(value);
    };
    
    try {
        //Maps attribute names onto attribute names. The keys represent hidden
        //checkboxes that control visibility. The values represent attributes
        //that become visible when the checkbox is checked.
        //If you call getAttrs() on the values and the results contain text,
        //the checkbox should be checked, because that feature is in use.
        
        //There are two types of values: arrays and strings. The arrays should
        //be used verbatim, whereas the strings represent repeating sections.
        //Parse the string with repeatingMatcher and then pass the results to
        //getRepeatingAttributes().
        var features = {
            //This is no longer toggleable, but I'm leaving it for reference.
            //ThirdStressActive: "repeating_Stress_Name",
            FantasticActive: ["Fan1", "Fan2", "Fan3", "Fan4", "Fan5", "Fan6", "Fan7", "Fan8"]
        };
        
        var repeatingMatcher = /repeating_(\w+)_(\w+)/;
        
        //A cache of lots of different values.
        var cache = {};
        
        //Fate's ladder, except only the values that have associated attributes.
        var ladder = [null, "Avg", "Fair", "Good", "Great", "Sup", "Fan", "Epic", "Leg"];
        
        //All attributes in the skill pyramid.
        var skillAttributes = [];
        for(var rung of ladder) {
            if(rung) {
                for(var i = 1; i <= 8; i++) {
                    skillAttributes.push(rung + i);
                }
            }
        }
        
        //A complete list of consequennce attributes.
        var consequences = [
            "MildConsequence",
            "MildPhyConsequence",
            "MildMenConsequence",
            "MildThirdConsequence",
            "ModerateConsequence",
            "SevereConsequence"
        ];
        
        /**
         * @param repeatingName - The word that comes after "repeating_" in the
         * attribute name. For instance, if you want to find
         * "repeating_aspects_$0_aspect", then this should be "aspects".
         * 
         * @param suffixes - An array of words identifying which parts of the
         * repeating attribute you want. For instance, if you want
         * "repeating_aspects_$0_aspect" (which is, in fact, the only part),
         * then this should be ["aspect"].
         * 
         * @param callback - A function that takes an array of objects. This
         * will be called once the attributes have been found. Each object in
         * the array will contain a property for each string in suffixes, mapped
         * to the value of that attribute. The objects won't be in order, but
         * they will include the repeating section id.
         */
        function getRepeatingAttributes(repeatingName, suffixes, callback) {
            getSectionIDs("repeating_" + repeatingName, function(idArray) {
                var attributeNames = [];
                for(var suffix of suffixes) {
                    for(var id of idArray) {
                        attributeNames.push("repeating_" + repeatingName
                            + "_" + id + "_" + suffix);
                    }
                }
                
                getAttrs(attributeNames, function(attributes) {
                    var result = [];
                    for(var id of idArray) {
                        var attributeSection = {id:id};
                        result.push(attributeSection);
                        
                        for(var suffix of suffixes) {
                            attributeSection[suffix] = attributes["repeating_"
                                + repeatingName + "_" + id + "_" + suffix];
                        }
                    }
                    callback(result);
                });
            });
        }
        /**
         * Like getRepeatingAttributes, but puts the array in order.
         */
        function getRepeatingAttributesOrdered(repeatingName, suffixes, callback) {
            getRepeatingAttributes(repeatingName, suffixes, function(attributes) {
                getSectionIDsOrdered(repeatingName, function(idsOrdered) {
                    var result = [];
                    
                    for(var id of idsOrdered) {
                        for(var attribute of attributes) {
                            if(attribute.id === id) {
                                result.push(attribute);
                                break;
                            }
                        }
                    }
                    
                    callback(result);
                });
            }, true);
        }
        /**
         * Adds a repeating row of the given type, populating it with the given
         * attributes. Sample usage:
         * addRepeatingRow("Advantages", {Advantages:"High Ground", Adv1:"on"});
         */
        function addRepeatingRow(repeatingName, localAttrs) {
            var newRowID = generateRowID();
            var attrs = {};
            for(var attr in localAttrs) {
                attrs["repeating_" + repeatingName + "_" + newRowID + "_" + attr] = localAttrs[attr];
            }
            setAttrs(attrs);
        }
        
        function getRung(locationInPyramid) {
            if(locationInPyramid) {
                for(var rung of ladder) {
                    if(locationInPyramid.startsWith(rung)) {
                        return ladder.indexOf(rung);
                    }
                }
            }
            
            return 0;
        }
        
        function updateSkills() {
            //The locations of various important skills in the skill pyramid. For
            //instance, physiqueLocation could be "Good2", and if you called
            //getAttrs([physiqueLocation]), you'd get {Good2:"Physique"}.
            var physiqueLocation;
            var willLocation;
            var thirdLocation;
            
            for(var attribute of skillAttributes) {
                var skill = cache[attribute].toLowerCase();
                if(skill === "physique") {
                    physiqueLocation = attribute;
                } else if(skill === "will") {
                    willLocation = attribute;
                }
            }
            
            var physiqueRung = getRung(physiqueLocation);
            var willRung = getRung(willLocation);
            
            var attrs = {};
            
            attrs["Phy3Active"] = physiqueRung >= 1 ? "on" : 0;
            attrs["Phy4Active"] = physiqueRung >= 3 ? "on" : 0;
            attrs["PhyConActive"] = physiqueRung >= 5 ? "on" : 0;
            
            attrs["Men3Active"] = willRung >= 1 ? "on" : 0;
            attrs["Men4Active"] = willRung >= 3 ? "on" : 0;
            attrs["MenConActive"] = willRung >= 5 ? "on" : 0;
            
            var changeMade = false;
            for(var attr in attrs) {
                if(attrs[attr] === cache[attr]) {
                    delete attrs[attr];
                } else {
                    changeMade = true;
                }
            }
            
            if(changeMade) {
                setAttrs(attrs);
            }
        }
        
        function setAllFeatures(state) {
            var attrs = {};
            for(var feature in features) {
                attrs[feature] = state ? "on" : "";
            }
            setAttrs(attrs);
        }
        
        function displayNecessaryFeatures() {
            for(var feature in features) {
                if(Array.isArray(features[feature])) {
                    checkFeatureNecessary(feature, features[feature]);
                } else {
                    //I don't always use let, but when I do, it's because
                    //otherwise the value would get updated on a later iteration
                    //of the loop.
                    let closureFeature = feature;
                    let repeatingMatch = repeatingMatcher.exec(features[feature]);
                    if(repeatingMatch) {
                        getRepeatingAttributes(repeatingMatch[1], repeatingMatch[2],
                            function(attributes) {
                                attributes = attributes.map(function(attribute) {
                                    return "repeating_" + repeatingMatch[1] + "_" + attribute.id + "_" + repeatingMatch[2];
                                });
                                checkFeatureNecessary(closureFeature, attributes);
                            });
                    }
                }
            }
        }
        
        function checkFeatureNecessary(activeAttribute, features) {
            getAttrs(features, function(attrs) {
                for(var attr of features) {
                    if(attrs[attr]) {
                        var newAttrs = {};
                        newAttrs[activeAttribute] = "on";
                        setAttrs(newAttrs);
                        break;
                    }
                }
            });
        }
        
        function listenForChanges(attributeArray, listener) {
            on("change:" + attributeArray.map(
                function(attribute) {
                    return attribute.toLowerCase();
                }).join(" change:"),
                listener);
        }
        
        on("change:AdvancedMode", function(eventInfo) {
            if(eventInfo.newValue === "on") {
                setAllFeatures(true);
            } else {
                setAllFeatures(false);
                displayNecessaryFeatures();
            }
        });
        
        on("sheet:opened", function() {
            //Figure out what needs to be cached.
            var cachedAttributes = [
                "Phy3Active",
                "Phy4Active",
                "PhyConActive",
                "Men3Active",
                "Men4Active",
                "MenConActive"
            ];
            cachedAttributes = cachedAttributes.concat(skillAttributes);
            
            //Cache it!
            getAttrs(cachedAttributes, function(attributes) {
                cache = attributes;
                updateSkills();
            });
            listenForChanges(cachedAttributes, function(eventInfo) {
                for(var attribute of cachedAttributes) {
                    if(eventInfo.sourceAttribute === attribute.toLowerCase()) {
                        //Update the cache.
                        if(eventInfo.newValue) {
                            cache[attribute] = eventInfo.newValue;
                        } else {
                            cache[attribute] = "";
                        }
                        
                        //Call a function to process the change.
                        if(skillAttributes.indexOf(attribute) >= 0) {
                            updateSkills();
                        }
                        break;
                    }
                }
            });
            
			//Backwards compatibility time!
			var oldStressAttributes = ["ThirdStressSkill", "OpenStress1", "OpenStress2", "OpenStress3"];
			getAttrs([
    			    "ID", "character_name", "Description"
			    ].concat(oldStressAttributes),
    			function(attributes) {
    			    var changeMade = false;
    			    
    			    //Move ID into the description.
    				if(attributes.ID) {
    					if(!attributes.character_name || attributes.ID.toLowerCase() !== attributes.character_name.toLowerCase()) {
    					    var aka = "aka " + attributes.ID;
    					    if(attributes.Description) {
        						attributes.Description += " (" + aka + ")";
    					    } else {
    					        attributes.Description = aka;
    					    }
    					}
    					
    					attributes.ID = "";
    					changeMade = true;
    				}
    				
    				//Move extra stress into repeating rows.
    				for(var oldStressAttribute of oldStressAttributes) {
        				if(attributes[oldStressAttribute]) {
        				    addRepeatingRow("Stress", {Name:attributes[oldStressAttribute]});
        				    
        				    attributes[oldStressAttribute] = "";
        				    changeMade = true;
        				}
    				}
    				
    				if(changeMade) {
        				setAttrs(attributes);
    				}
    			});
			
            displayNecessaryFeatures();
        });
    } catch(e) {
        log("Encountered an error: " + e);
    }
</script>

<div class="sheet-section-basic sheet-section">
	<img class="sheet-logo" src="http://www.faterpg.com/wp-content/uploads/2013/06/Powered-by-Fate-Final-Light-BG.png" alt="FATE CORE" />
	<table>
		<tr>
			<td>
				<label>Name</label>
				<input class="sheet-descriptions" type="text" name="attr_character_name" />
			</td>
			<td>
				<label>Refresh</label>
				<input type="number" name="attr_Refresh" value="3" />
			</td>
		</tr>
		<tr>
			<td>
				<label>Description</label>
				<input class="sheet-descriptions" type="text" name="attr_Description" />
			</td>
			<td>
				<label>Fate Points</label>
				<input type="number" name="attr_Fate" value="3" />
			</td>

		</tr>
	</table>
</div> <!-- .section-basic -->

<div class="sheet-break"></div>

<div class="sheet-section-skills sheet-section">
	<div class="sheet-header"
	    title="Fate's default skills: Athletics, Burglary, Contacts, Crafts, Deceive, Drive, Empathy, Fight, Investigate, Lore, Notice, Physique, Provoke, Rapport, Resources, Shoot, Stealth, Will">
	    <a href="https://fate-srd.com/fate-core/default-skill-list">Skills</a></div>
	
	<input class="sheet-active-toggle" type="checkbox" name="attr_FantasticActive" />
	<table>
	    <tr>
			<td>Legendary (+8)</td>
			<td><input class="sheet-skill-off" type="text" name="attr_Leg1" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg2" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Leg8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+8+@{RollModifiers}]] @{Leg8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Epic (+7)</td>
			<td><input class="sheet-skill-off" type="text" name="attr_Epic1" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Epic2" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Epic8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+7+@{RollModifiers}]] @{Epic8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Fantastic (+6)</td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fan1" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fan2" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fan3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fan4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fan5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fan6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fan7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fan8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+6+@{RollModifiers}]] @{Fan8}" tabindex="-1"></button></td>
        </tr>
	</table>
	<table>
		<tr>
			<td>Superb (+5)</td>
			<td><input class="sheet-skill-off" type="text" name="attr_Sup1" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Sup2" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Sup3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Sup4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Sup5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Sup6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Sup7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Sup8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+5+@{RollModifiers}]] @{Sup8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Great (+4)</td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Great1" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Great2" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Great3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Great4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Great5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Great6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Great7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Great8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+4+@{RollModifiers}]] @{Great8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Good (+3)</td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Good1" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Good2" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Good3" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Good4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Good5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Good6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Good7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Good8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+3+@{RollModifiers}]] @{Good8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Fair (+2)</td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Fair1" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Fair2" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Fair3" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fair4" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fair5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fair6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Fair7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-invisible" type="text" name="attr_Fair8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+2+@{RollModifiers}]] @{Fair8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>Average (+1)</td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Avg1" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg1}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Avg2" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg2}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Avg3" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg3}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-on"  type="text" name="attr_Avg4" />
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg4}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Avg5" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg5}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Avg6" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg6}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Avg7" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg7}" tabindex="-1"></button></td>
			<td><input class="sheet-skill-off" type="text" name="attr_Avg8" placeholder=" "/>
			    <button class="sheet-hidden-roll" type="roll" value="/me rolls [[4dF+1+@{RollModifiers}]] @{Avg8}" tabindex="-1"></button></td>
		</tr>
		<tr>
			<td>&nbsp;&nbsp;Mediocre (+0)</td>
			<td><button type='roll' name='roll_Mediocre' value='/me rolls [[{4dF}}]]'></button>
        </tr>
	</table>
</div> <!-- .section-skills -->

<div class="sheet-break"></div>

<div class="sheet-section-aspects sheet-section sheet-half">
	<div class="sheet-header"
	    title="Aspects are phrases that describe something unique or noteworthy about you. You may invoke them by spending fate points.">
	    <a href="https://fate-srd.com/fate-core/types-aspects">Aspects</a></div>
	<div class="sheet-repitem sheet-flex-row">
		<textarea class="sheet-flex-1" name="attr_HighConcept" placeholder="High Concept Aspect" rows="1"></textarea>
		<div class="sheet-flex-column">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_HiCon1" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_HiCon2" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_HiCon3" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_HiCon4" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_HiCon5" title="Free invoke" style="">
		</div>
	</div>
	<div class="sheet-repitem sheet-flex-row">
		<textarea class="sheet-flex-1" name="attr_Trouble" placeholder="Trouble Aspect" rows="1"></textarea>
		<div class="sheet-flex-column">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Trouble1" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Trouble2" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Trouble3" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Trouble4" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Trouble5" title="Free invoke" style="">
		</div>
	</div>
	<fieldset class="repeating_Aspects">
    	<div class="sheet-repitem sheet-flex-row">
    		<textarea class="sheet-flex-1" name="attr_Aspect" rows="1"></textarea>
    		<div class="sheet-flex-column">
    		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Asp1" title="Free invoke" style="">
    		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Asp2" title="Free invoke" style="">
    		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Asp3" title="Free invoke" style="">
    		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Asp4" title="Free invoke" style="">
    		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Asp5" title="Free invoke" style="">
    		</div>
    	</div>
	</fieldset>
</div> <!-- .section-aspects -->

<div class="sheet-section-aspects sheet-section sheet-half">
	<div class="sheet-header"
	    title="Situation aspects are phrases that describe the current scene. Boosts are similar, but go away after one invocation. Invoking a boost is always free.">
	    Boosts and situation aspects</div>
	<fieldset class="repeating_Advantages">
    	<div class="sheet-repitem sheet-flex-row">
    		<textarea class="sheet-flex-1" name="attr_Advantages" rows="1"></textarea>
    		<div class="sheet-flex-column">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Adv1" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Adv2" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Adv3" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Adv4" title="Free invoke" style="">
		    <input class="sheet-repeating-checkbox" type="checkbox" name="attr_Adv5" title="Free invoke" style="">
    	</div>
	</fieldset>
</div> <!-- .section-stunts -->

<div class="sheet-break"></div>

<div class="sheet-section-stunts sheet-section sheet-half">
	<div class="sheet-header"
	    title="A stunt allows you to do something extra in a specific situation. Unless the stunt specifically says otherwise, it doesn't require a fate point.">
	    <a href="https://fate-srd.com/fate-core/skills-stunts">Stunts</a></div>
    <textarea name="attr_Stunts" rows="2"></textarea>
	<fieldset class="repeating_Stunts">
		<textarea name="attr_Stunt" rows="2"></textarea>
	</fieldset>
</div> <!-- .section-stunts -->

<div class="sheet-section-extras sheet-section sheet-half">
	<div class="sheet-header"
	    title="An extra can be anything thatâ€™s technically part of a character or controlled by a character but gets special treatment in the rules, such as magic abilities or a privately-owned business. Consult your GM.">
	    <a href="https://fate-srd.com/fate-core/creating-extra">Extras</a></div>
    <textarea name="attr_Extras" rows="2"></textarea>
	<fieldset class="repeating_Extras">
		<textarea name="attr_Extra" rows="2"></textarea>
	</fieldset>
</div> <!-- .section-extras -->

<div class="sheet-break"></div>

<div class="sheet-section-stress sheet-section sheet-half">
	<div class="sheet-header"
	    title="When you would take damage, you may check AT MOST ONE stress checkbox to reduce the damage by the number next to that box. Stress goes away at the end of the scene.">
	    <a href="https://fate-srd.com/fate-core/conflicts">Stress</a></div>
	<div class="sheet-table">
		<div class="sheet-large-text sheet-stress-left-column">Physical&nbsp;</div>
		<div><label>1<input type="checkbox" name="attr_Phy1" /></label></div>
		<div><label>2<input type="checkbox" name="attr_Phy2" /></label></div>
		<input class="sheet-active-toggle" type="checkbox" name="attr_Phy3Active" />
		<div><label>3<input type="checkbox" name="attr_Phy3" /></label></div>
		<input class="sheet-active-toggle" type="checkbox" name="attr_Phy4Active" />
		<div><label>4<input type="checkbox" name="attr_Phy4" /></label></div>
	</div>
	<div class="sheet-table">&nbsp;</div>
	<div class="sheet-table">
		<div class="sheet-large-text sheet-stress-left-column">Mental&nbsp;</div>
		<div><label>1<input type="checkbox" name="attr_Men1" /></label></div>
		<div><label>2<input type="checkbox" name="attr_Men2" /></label></div>
		<input class="sheet-active-toggle" type="checkbox" name="attr_Men3Active" />
		<div><label>3<input type="checkbox" name="attr_Men3" /></label></div>
		<input class="sheet-active-toggle" type="checkbox" name="attr_Men4Active" />
		<div><label>4<input type="checkbox" name="attr_Men4" /></label></div>
	</div>
	<div class="sheet-table">&nbsp;</div>
	<fieldset class="repeating_Stress">
    	<div class="sheet-table">
    		<input class="sheet-dynamic-name sheet-stress-left-column" type="text" name="attr_Name" placeholder="(Name)" />&nbsp;
    		<div><label>1<input type="checkbox" name="attr_Stress1" /></label></div>
    		<div><label>2<input type="checkbox" name="attr_Stress2" /></label></div>
    		<div><label>3<input type="checkbox" name="attr_Stress3" /></label></div>
    		<div><label>4<input type="checkbox" name="attr_Stress4" /></label></div>
    	</div>
        <div class="sheet-table">&nbsp;</div>
    </fieldset>
</div> <!-- .section-stress -->

<div class="sheet-section-consequences sheet-section sheet-half">
	<div class="sheet-header"
	    title="Consequences are aspects representing physical or emotional damage. When you take a consequence, your enemies get one free invocation.">
	    <a href="https://fate-srd.com/fate-core/conflicts">Consequences</a></div>
	<div class="sheet-left-label">
		<div>Mild</div>
		<div><input type="text" name="attr_MildConsequence" /></div>
    	<div><input type="checkbox" name="attr_MildInvoke" title="Free invoke" /></div>
	</div>
	<input class="sheet-active-toggle" type="checkbox" name="attr_PhyConActive" />
	<div class="sheet-left-label">
		<div>Mild</div>
		<div><input type="text" name="attr_MildPhyConsequence" placeholder="Physical Consequence" /></div>
    	<div><input type="checkbox" name="attr_MildPhyInvoke" title="Free invoke" /></div>
	</div>
	<input class="sheet-active-toggle" type="checkbox" name="attr_MenConActive" />
	<div class="sheet-left-label">
		<div>Mild</div>
		<div><input type="text" name="attr_MildMenConsequence" placeholder="Mental Consequence" /></div>
    	<div><input type="checkbox" name="attr_MildMenInvoke" title="Free invoke" /></div>
	</div>
	<div class="sheet-left-label">
		<div>Moderate</div>
		<div><input type="text" name="attr_ModerateConsequence" /></div>
    	<div><input type="checkbox" name="attr_ModerateInvoke" title="Free invoke" /></div>
	</div>
	<div class="sheet-left-label">
		<div>Severe</div>
		<div><input type="text" name="attr_SevereConsequence" /></div>
    	<div><input type="checkbox" name="attr_SevereInvoke" title="Free invoke" /></div>
	</div>
	<input class="sheet-active-toggle" type="checkbox" name="attr_RepConActive" />
	<div>
    	<fieldset class="repeating_Cons">
    	    <div class="sheet-left-label">
                <select name="attr_conType">                
                    <option>Mild</option>
                    <option>Moderate</option>
                    <option>Severe</option>
                </select>
        	    <div><input type="text" name="attr_Consequence" style=""></div>
    	        <div><input type="checkbox" name="attr_Invoke" title="Free invoke" /></div>
            </div>
        </fieldset>
    </div>
</div> <!-- .section-consequences -->

<div class="sheet-break"></div>

<div class="sheet-section-notes sheet-section">
	<div class="sheet-header">Notes</div>
	<textarea name="attr_Notes" rows="7"></textarea>
</div> <!-- .section-notes -->

<hr>

<div class="sheet-flex-row">
    <label class="sheet-small-text">
        <input class="sheet-small-checkbox" type="checkbox" name="attr_AdvancedMode" />
        high-level skills
    </label>
    
    <label class="sheet-small-text">
        <input class="sheet-small-checkbox" type="checkbox" name="attr_RollModifiers" value="?{Modifier|0}" checked="true" />
        roll modifiers
    </label>
</div>
