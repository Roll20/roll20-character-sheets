<!---------->
<!--HEARTS-->
<!---------->
<div class="sheet-heartbox-group">
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox1" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox2" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox3" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox4" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox5" value="1">
        <span></span>
    </label>
	<label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox6" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox7" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox8" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox9" value="1">
        <span></span>
    </label>
    <label class="sheet-checkbox-heart">
        <input type="checkbox" name="attr_heartbox10" value="1">
        <span></span>
    </label>
	
	<input type="hidden" name="attr_hp">
	<input type="hidden" name="attr_hp_max">
</div>

<!---------------->
<!-- NAME & AGE -->
<!---------------->
<div class="sheet-name_age-container">
	<input type="text" id="sheet-adventurerName" name="attr_charactername" placeholder="Harry Boo" spellcheck="false">
	
	<input type="text" id="sheet-adventurerAge" name="attr_characterage" pattern="\d{1,3}" placeholder="0" spellcheck="false">
	<input type="hidden" name="attr_characterage_max" value="2500">
</div>

<!---------------------------------->
<!-- OCCUPATION, GOLD & CONDITION -->
<!---------------------------------->
<div class="sheet-occupation_gold_condition-container">
	<input type="text" id="sheet-adventurerOccupation" name="attr_characteroccupation" placeholder="Adventurer" spellcheck="false">
	
	<input type="text" id="sheet-adventurerGold" name="attr_charactergold" pattern="\d{1,3}" placeholder="0" spellcheck="false">
	<input type="hidden" name="attr_charactergold_max" value="50000">
	
	<input type="text" id="sheet-adventurerCondition" name="attr_charactercondition" placeholder="None" spellcheck="false">
</div>

<!------------------------------>
<!-- WEAPON & INSTRUMENT NAME -->
<!------------------------------>
<div class="sheet-weapon_instrument-name">
		
	<input type="text" class="sheet-weapon_name-input" name="attr_weaponname" placeholder="Staff" spellcheck="false">
	
	<input type="text" class="sheet-instrument_name-input" name="attr_instrumentname" placeholder="Flute" spellcheck="false">
	
</div>

<!------------------------------------------------->
<!-- WEAPON & INSTRUMENT EXPERIENCE & INITIATIVE -->
<!------------------------------------------------->
<div class="sheet-weapon_instrument-exp-initiative_actions">
	<!--WEAPON-->
	<div class="sheet-weapon_instrument-expbox-group">
			<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_weapontierbox1" value="1">
			<span></span>
		</label>
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_weapontierbox2" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_weapon_tier">
	</div>
	
	<button type="action" class="sheet-initiativeButton" name="act_rollInitiative"></button>
	<button type="action" class="sheet-weaponAttackButton" name="act_rollWeapon"></button>
	
	<!--INSTRUMENT-->
	<div class="sheet-weapon_instrument-expbox-group">
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_instrumenttierbox1" value="1">
			<span></span>
		</label>
		<label class="sheet-weapon_instrument-expbox">
			<input type="checkbox" name="attr_instrumenttierbox2" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_instrument_tier">
	</div>
	<button type="action" class="sheet-instrumentPlayNoteButton" name="act_rollInstrument"></button>
</div>

<!------------>
<!-- SKILLS -->
<!------------>
<div class="sheet-skills-container">
	<!--------------------------->
	<!-- STRENGTH & PERCEPTION -->
	<!--------------------------->
	<div class="sheet-skills-pair-container">
		<!-- STRENGTH -->
		<div class="sheet-skill" id="skill-1"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_strength-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_strength">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollStrength"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollStrengthTool"></button>
		</div>
	
		<!-- PERCEPTION -->
		<div class="sheet-skill" id="skill-6"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_perception-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_perception">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollPerception"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollPerceptionTool"></button>
		</div>
	</div>
	
	<!----------------------------------->
	<!-- DEXTERITY & MECHANICS (MECH.) -->
	<!----------------------------------->
	<div class="sheet-skills-pair-container">
		<!-- DEXTERITY -->
		<div class="sheet-skill" id="skill-2"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_dexterity-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_dexterity">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollDexterity"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollDexterityTool"></button>
		</div>
	
		<!-- MECHANICS (MECH.) -->
		<div class="sheet-skill" id="skill-7"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_mechanics-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_mechanics">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollMechanics"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollMechanicsTool"></button>
		</div>
	</div>
	
	<!------------------------------------>
	<!-- ACROBATICS (ACROB.) & SURVIVAL -->
	<!------------------------------------>
	<div class="sheet-skills-pair-container">
		<!-- ACROBATICS (ACROB.) -->
		<div class="sheet-skill" id="skill-3"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_acrobatics-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_acrobatics">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollAcrobatics"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollAcrobaticsTool"></button>
		</div>
	
		<!-- SURVIVAL -->
		<div class="sheet-skill" id="skill-8"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_survival-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_survival">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollSurvival"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollSurvivalTool"></button>
		</div>
	</div>
	
	<!------------------------------------------>
	<!-- REFLEX & ARCANE/ALCHEMY (ARC./ALCH.) -->
	<!------------------------------------------>
	<div class="sheet-skills-pair-container">
		<!-- REFLEX -->
		<div class="sheet-skill" id="skill-4"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_reflex-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_reflex">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollReflex"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollReflexTool"></button>
		</div>
	
		<!-- ARCANE/ALCHEMY (ARC./ALCH.) -->
		<div class="sheet-skill" id="skill-9"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_arcane/alchemy-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_arcane/alchemy">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollArcane/Alchemy"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollArcane/AlchemyTool"></button>
		</div>
	</div>
	
	<!--------------------->
	<!-- DEFENSE & MUSIC -->
	<!--------------------->
	<div class="sheet-skills-pair-container">
		<!-- DEFENSE -->
		<div class="sheet-skill" id="skill-5"> 
			<div class="sheet-skill-expbox-group-left">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_defense-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_defense">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollDefense"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollDefenseTool"></button>
		</div>
	
		<!-- MUSIC -->
		<div class="sheet-skill" id="skill-10"> 
			<div class="sheet-skill-expbox-group-right">
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox1" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox2" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox3" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox4" value="1">
					<span></span>
				</label>
				
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox5" value="1">
					<span></span>
				</label>
				<label class="sheet-skill-expbox">
					<input type="checkbox" name="attr_music-expbox6" value="1">
					<span></span>
				</label>
				
				<input type="hidden" name="attr_music">
			</div>
			
			<button type="action" class="sheet-skillActionButton" name="act_rollMusic"></button>
			<button type="action" class="sheet-skillToolButton" name="act_rollMusicTool"></button>
		</div>
	</div>
</div>

<!------------------------->
<!--EXPERIENCE & REROLLD6-->
<!------------------------->
<div class="sheet-experience-rerolld6">
	<div class="sheet-experiencebox-group">
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox1" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox2" value="1">
			<span></span>
		</label>
		
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox3" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox4" value="1">
			<span></span>
		</label>
		
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox5" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox6" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox7" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox8" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox9" value="1">
			<span></span>
		</label>
		<label class="sheet-experiencebox">
			<input type="checkbox" name="attr_experiencebox10" value="1">
			<span></span>
		</label>
		
		<input type="hidden" name="attr_experience">
		<input type="hidden" name="attr_experience_max" value="10">
	</div>
	
	<button type="action" class="sheet-rerolld6Button" name="act_reroll1D6"></button>
</div>

<!--------->
<!--ITEMS-->
<!--------->
<div class="sheet-items-container">
	<!--ITEM 1 & ITEM 2-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item1name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item2name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 3 & ITEM 4-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item3name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item4name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 5 & ITEM 6-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item5name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item6name" placeholder="Item" spellcheck="false">
		</div>
	</div>
	
	<!--ITEM 7 & ITEM 8-->
	<div class="sheet-items-pair-container">
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item7name" placeholder="Item" spellcheck="false">
		</div>
		
		<div class="sheet-item">
			<input type="text" class="sheet-itemname-input" name="attr_item8name" placeholder="Item" spellcheck="false">
		</div>
	</div>
</div>

<!--------->
<!--NOTES-->
<!--------->
<div class="sheet-notes-container">
    <textarea class="sheet-notes-textarea" name="attr_characternotes" maxlength="320" placeholder="Enter your notes here..." spellcheck="false"></textarea>
</div>

<!-------------------------------->
<!-- ROLLTEMPLATE: HIDDEN ROLLS -->
<!-------------------------------->
<rolltemplate class="sheet-rolltemplate-hidden-singleroll">
	{{#roll1}}
	<div style="display: none;">
		{{roll1}}
	</div>
	{{/roll1}}
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-hidden-doubleroll">
	{{#roll1}}
	<div style="display: none;">
		{{roll1}}
	</div>
	{{/roll1}}
	
	{{#roll2}}
	<div style="display: none;">
		{{roll2}}
	</div>
	{{/roll2}}
</rolltemplate>

<!----------------------------------->
<!-- ROLLTEMPLATE: SEWER SANCTUARY -->
<!----------------------------------->
<rolltemplate class="sheet-rolltemplate-sewersanctuary">	
	{{#titleColorSuccess}}
		<div class="sheet-sewersanctuary-title" style="background-color: #4BA22E;">
			<div class="sheet-sewersanctuary-title-text">
				{{title}}
			</div>
		</div>
	{{/titleColorSuccess}}
	
	{{#titleColorFailure}}
		<div class="sheet-sewersanctuary-title" style="background-color: #A5A29E;">
			<div class="sheet-sewersanctuary-title-text">
				{{title}}
			</div>
		</div>
	{{/titleColorFailure}}
	
	{{#titleColorDark}}
		<div class="sheet-sewersanctuary-title" style="background-color: #1D1B1A;">
			<div class="sheet-sewersanctuary-title-text">
				{{title}}
			</div>
		</div>
	{{/titleColorDark}}
	
	<!-- Initiative, Attack, Instrument, Skill & Reroll Container -->
	<div class="sheet-sewersanctuary-container">
		<div class="sheet-sewersanctuary-body">
			<!-- Initiative, Attack, Instrument, Skill & Reroll 1 -->
			{{#roll1}}
				{{#roll1Success}}
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll1}}
					</div>
				{{/roll1Success}}
				
				{{#roll1Failure}}
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll1}}
					</div>
				{{/roll1Failure}}
				
				{{#roll1Dark}}
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll1}}
					</div>
				{{/roll1Dark}}
			{{/roll1}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 2 -->
			{{#roll2}}
				{{#roll2Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll2}}
					</div>
				{{/roll2Success}}
				
				{{#roll2Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll2}}
					</div>
				{{/roll2Failure}}
				
				{{#roll2Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll2}}
					</div>
				{{/roll2Dark}}
			{{/roll2}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 3 -->
			{{#roll3}}
				{{#roll3Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll3}}
					</div>
				{{/roll3Success}}
				
				{{#roll3Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll3}}
					</div>
				{{/roll3Failure}}
				
				{{#roll3Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll3}}
					</div>
				{{/roll3Dark}}
			{{/roll3}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 4 -->
			{{#roll4}}
				{{#roll4Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll4}}
					</div>
				{{/roll4Success}}
				
				{{#roll4Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll4}}
					</div>
				{{/roll4Failure}}
				
				{{#roll4Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll4}}
					</div>
				{{/roll4Dark}}
			{{/roll4}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 5 -->
			{{#roll5}}
				{{#roll5Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll5}}
					</div>
				{{/roll5Success}}
				
				{{#roll5Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll5}}
					</div>
				{{/roll5Failure}}
				
				{{#roll5Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll5}}
					</div>
				{{/roll5Dark}}
			{{/roll5}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 6 -->
			{{#roll6}}
				{{#roll6Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll6}}
					</div>
				{{/roll6Success}}
				
				{{#roll6Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll6}}
					</div>
				{{/roll6Failure}}
				
				{{#roll6Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll6}}
					</div>
				{{/roll6Dark}}
			{{/roll6}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 7 -->
			{{#roll7}}
				{{#roll7Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll7}}
					</div>
				{{/roll7Success}}
				
				{{#roll7Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll7}}
					</div>
				{{/roll7Failure}}
				
				{{#roll7Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll7}}
					</div>
				{{/roll7Dark}}
			{{/roll7}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 8 -->
			{{#roll8}}
				{{#roll8Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll8}}
					</div>
				{{/roll8Success}}
				
				{{#roll8Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll8}}
					</div>
				{{/roll8Failure}}
				
				{{#roll8Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll8}}
					</div>
				{{/roll8Dark}}
			{{/roll8}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 9 -->
			{{#roll9}}
				{{#roll9Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll9}}
					</div>
				{{/roll9Success}}
				
				{{#roll9Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll9}}
					</div>
				{{/roll9Failure}}
				
				{{#roll9Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll9}}
					</div>
				{{/roll9Dark}}
			{{/roll9}}
			
			<!-- Initiative, Attack, Instrument, Skill & Reroll 10 -->
			{{#roll10}}
				{{#roll10Success}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
						{{roll10}}
					</div>
				{{/roll10Success}}
				
				{{#roll10Failure}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
						{{roll10}}
					</div>
				{{/roll10Failure}}
				
				{{#roll10Dark}}
					<div class="sheet-sewersanctuary-plus">+</div>
					<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
						{{roll10}}
					</div>
				{{/roll10Dark}}
			{{/roll10}}			
		</div>
    </div>
	
	<!-- Initiative Total Result -->
	{{#initiativetotalResult}}
		{{#initiativetotalResultSuccess}}
			<div class="sheet-sewersanctuary-total" style="background-color: #4BA22E;">
				<div class="sheet-sewersanctuary-total-title">
					Total
				</div>
				<div class="sheet-sewersanctuary-total-result">
					{{initiativetotalResult}}
				</div>
			</div>
		{{/initiativetotalResultSuccess}}
		
		{{#initiativetotalResultFailure}}
			<div class="sheet-sewersanctuary-total" style="background-color: #A5A29E;">
				<div class="sheet-sewersanctuary-total-title">
					Total
				</div>
				<div class="sheet-sewersanctuary-total-result">
					{{initiativetotalResult}}
				</div>
			</div>
		{{/initiativetotalResultFailure}}
		
		{{#initiativetotalResultDark}}
			<div class="sheet-sewersanctuary-total" style="background-color: #1D1B1A;">
				<div class="sheet-sewersanctuary-total-title">
					Total
				</div>
				<div class="sheet-sewersanctuary-total-result">
					{{initiativetotalResult}}
				</div>
			</div>
		{{/initiativetotalResultDark}}
	{{/initiativetotalResult}}
	
	<!-- Attack Description Text -->
	{{#attackDescriptionText}}
		{{#attackDescriptionTextSuccess}}
			<div class="sheet-sewersanctuary-description" style="background-color: #4BA22E;">
				<div class="sheet-sewersanctuary-description-text">
					{{attackDescriptionText}}
				</div>
			</div>
		{{/attackDescriptionTextSuccess}}
		
		{{#attackDescriptionTextFailure}}
			<div class="sheet-sewersanctuary-description" style="background-color: #A5A29E;">
				<div class="sheet-sewersanctuary-description-text">
					{{attackDescriptionText}}
				</div>
			</div>
		{{/attackDescriptionTextFailure}}
		
		{{#attackDescriptionTextDark}}
			<div class="sheet-sewersanctuary-description" style="background-color: #1D1B1A;">
				<div class="sheet-sewersanctuary-description-text">
					{{attackDescriptionText}}
				</div>
			</div>
		{{/attackDescriptionTextDark}}
	{{/attackDescriptionText}}
	
	<!-- Skill Description Text -->
	{{#skillDescriptionText}}
		{{#skillDescriptionTextSuccess}}
			<div class="sheet-sewersanctuary-description" style="background-color: #4BA22E;">
				<div class="sheet-sewersanctuary-description-text">
					{{skillDescriptionText}}
				</div>
			</div>
		{{/skillDescriptionTextSuccess}}
		
		{{#skillDescriptionTextFailure}}
			<div class="sheet-sewersanctuary-description" style="background-color: #A5A29E;">
				<div class="sheet-sewersanctuary-description-text">
					{{skillDescriptionText}}
				</div>
			</div>
		{{/skillDescriptionTextFailure}}
		
		{{#skillDescriptionTextDark}}
			<div class="sheet-sewersanctuary-description" style="background-color: #1D1B1A;">
				<div class="sheet-sewersanctuary-description-text">
					{{skillDescriptionText}}
				</div>
			</div>
		{{/skillDescriptionTextDark}}
	{{/skillDescriptionText}}
	
	<!-- Damage Roll Container -->
	{{#damageRoll1}}
		<div class="sheet-sewersanctuary-container">
			<div class="sheet-sewersanctuary-body">
				<!-- Damage Roll 1 -->
				{{#damageRoll1}}
					{{#damageRoll1Success}}
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll1}}
						</div>
					{{/damageRoll1Success}}
					
					{{#damageRoll1Failure}}
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll1}}
						</div>
					{{/damageRoll1Failure}}
					
					{{#damageRoll1Dark}}
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll1}}
						</div>
					{{/damageRoll1Dark}}
				{{/damageRoll1}}
				
				<!-- Damage Roll 2 -->
				{{#damageRoll2}}
					{{#damageRoll2Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll2}}
						</div>
					{{/damageRoll2Success}}
					
					{{#damageRoll2Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll2}}
						</div>
					{{/damageRoll2Failure}}
					
					{{#damageRoll2Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll2}}
						</div>
					{{/damageRoll2Dark}}
				{{/damageRoll2}}
				
				<!-- Damage Roll 3 -->
				{{#damageRoll3}}
					{{#damageRoll3Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll3}}
						</div>
					{{/damageRoll3Success}}
					
					{{#damageRoll3Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll3}}
						</div>
					{{/damageRoll3Failure}}
					
					{{#damageRoll3Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll3}}
						</div>
					{{/damageRoll3Dark}}
				{{/damageRoll3}}
				
				<!-- Damage Roll 4 -->
				{{#damageRoll4}}
					{{#damageRoll4Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll4}}
						</div>
					{{/damageRoll4Success}}
					
					{{#damageRoll4Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll4}}
						</div>
					{{/damageRoll4Failure}}
					
					{{#damageRoll4Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll4}}
						</div>
					{{/damageRoll4Dark}}
				{{/damageRoll4}}
				
				<!-- Damage Roll 5 -->
				{{#damageRoll5}}
					{{#damageRoll5Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll5}}
						</div>
					{{/damageRoll5Success}}
					
					{{#damageRoll5Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll5}}
						</div>
					{{/damageRoll5Failure}}
					
					{{#damageRoll5Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll5}}
						</div>
					{{/damageRoll5Dark}}
				{{/damageRoll5}}
				
				<!-- Damage Roll 6 -->
				{{#damageRoll6}}
					{{#damageRoll6Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll6}}
						</div>
					{{/damageRoll6Success}}
					
					{{#damageRoll6Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll6}}
						</div>
					{{/damageRoll6Failure}}
					
					{{#damageRoll6Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll6}}
						</div>
					{{/damageRoll6Dark}}
				{{/damageRoll6}}
				
				<!-- Damage Roll 7 -->
				{{#damageRoll7}}
					{{#damageRoll7Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll7}}
						</div>
					{{/damageRoll7Success}}
					
					{{#damageRoll7Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll7}}
						</div>
					{{/damageRoll7Failure}}
					
					{{#damageRoll7Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll7}}
						</div>
					{{/damageRoll7Dark}}
				{{/damageRoll7}}
				
				<!-- Damage Roll 8 -->
				{{#damageRoll8}}
					{{#damageRoll8Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll8}}
						</div>
					{{/damageRoll8Success}}
					
					{{#damageRoll8Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll8}}
						</div>
					{{/damageRoll8Failure}}
					
					{{#damageRoll8Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll8}}
						</div>
					{{/damageRoll8Dark}}
				{{/damageRoll8}}
				
				<!-- Damage Roll 9 -->
				{{#damageRoll9}}
					{{#damageRoll9Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll9}}
						</div>
					{{/damageRoll9Success}}
					
					{{#damageRoll9Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll9}}
						</div>
					{{/damageRoll9Failure}}
					
					{{#damageRoll9Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll9}}
						</div>
					{{/damageRoll9Dark}}
				{{/damageRoll9}}
				
				<!-- Damage Roll 10 -->
				{{#damageRoll10}}
					{{#damageRoll10Success}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #4BA22E;">
							{{damageRoll10}}
						</div>
					{{/damageRoll10Success}}
					
					{{#damageRoll10Failure}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #A5A29E;">
							{{damageRoll10}}
						</div>
					{{/damageRoll10Failure}}
					
					{{#damageRoll10Dark}}
						<div class="sheet-sewersanctuary-plus">+</div>
						<div class="sheet-sewersanctuary-dicebox" style="background-color: #1D1B1A;">
							{{damageRoll10}}
						</div>
					{{/damageRoll10Dark}}
				{{/damageRoll10}}
				
			</div>
		</div>

		<!-- Damage Description Text -->
		{{#damageDescriptionText}}
			{{#damageDescriptionTextSuccess}}
				<div class="sheet-sewersanctuary-description" style="background-color: #4BA22E;">
					<div class="sheet-sewersanctuary-description-text">
						{{damageDescriptionText}}
					</div>
				</div>
			{{/damageDescriptionTextSuccess}}
			
			{{#damageDescriptionTextFailure}}
				<div class="sheet-sewersanctuary-description" style="background-color: #A5A29E;">
					<div class="sheet-sewersanctuary-description-text">
						{{damageDescriptionText}}
					</div>
				</div>
			{{/damageDescriptionTextFailure}}
			
			{{#damageDescriptionTextDark}}
				<div class="sheet-sewersanctuary-description" style="background-color: #1D1B1A;">
					<div class="sheet-sewersanctuary-description-text">
						{{damageDescriptionText}}
					</div>
				</div>
			{{/damageDescriptionTextDark}}
		{{/damageDescriptionText}}
	{{/damageRoll1}}
</rolltemplate>

<script type="text/worker">
/****************************/
/*** SHEET INITIALIZATION ***/
/****************************/
on("sheet:opened", function() {
    // Check if the 'firstInitialization' attribute exists and is false
    getAttrs(["firstInitialization"], function(values) {
        if (!values.firstInitialization || values.firstInitialization === "false") {
			// Ensure attribute is put at the top of the attribute list
			setAttrs({ "firstInitialization": "false" });
			
			// Call the function to initialize some string attributes to ensure they are on top in the "Attribute & Abilities" tab
			initializeStringAttributes();
			
            // Call the function to initialize the checkboxes
            initializeCheckboxFields();

            // After initializing, set 'firstInitialization' to true
            setAttrs({ "firstInitialization": "true" });
        }
    });
});

function initializeStringAttributes() {
	const attributesToInitialize = [
    "hp", "hp_max", "charactername", "characterage", "characteroccupation", "charactergold", "charactercondition",
    "weaponname", "instrumentname", "weapon_tier", "instrument_tier", "strength", "perception", "dexterity",
    "mechanics", "acrobatics", "survival", "reflex", "arcane/alchemy", "defense", "music", "experience", "experience_max",
    "item1Name", "item2Name", "item3Name", "item4Name", "item5Name", "item6Name", "item7Name", "item8Name",
    "characterNotes"
	];

    let initializeAttrs = {};
    attributesToInitialize.forEach(attr => {
		if ([attr] == "hp_max" || [attr] == "experience_max") {
			initializeAttrs[attr] = "10";
		} else {
			initializeAttrs[attr] = "";
		}
    });
    setAttrs(initializeAttrs);
}

// Function to initialize checkboxes (skills and hearts)
function initializeCheckboxFields() {
    const skills = [
        "strength", "perception", "dexterity", "mechanics",
        "acrobatics", "survival", "reflex", "arcane/alchemy",
        "defense", "music"
    ];

    let attributesToCheck = [];
    skills.forEach(skill => {
        for (let i = 1; i <= 6; i++) {
            attributesToCheck.push(`${skill}-expbox${i}`);
        }
    });

    // Heart checkboxes (1-10)
    for (let i = 1; i <= 10; i++) {
        attributesToCheck.push(`heartbox${i}`);
    }
	
	// Weapon tier checkboxes (1-2)
    for (let i = 1; i <= 2; i++) {
        attributesToCheck.push(`weapontierbox${i}`);
    }
	
	// Instrument tier checkboxes (1-2)
    for (let i = 1; i <= 2; i++) {
        attributesToCheck.push(`instrumenttierbox${i}`);
    }
	
	// experience checkboxes (1-10)
    for (let i = 1; i <= 10; i++) {
        attributesToCheck.push(`experiencebox${i}`);
    }
	

    // Get all necessary values at once
    getAttrs(attributesToCheck, function(values) {
        let updates = {};

        // Initialize the first three skill checkboxes to "1" and the last three to "0"
        skills.forEach(skill => {
            for (let i = 1; i <= 6; i++) {
                let attrName = `${skill}-expbox${i}`;
                let currentValue = values[attrName];
				
				if (i <= 3) {
					// Set to "1" if the checkbox is still at its initial state (i.e., "0")
					if (currentValue === "0") {
						updates[attrName] = "1";
					}
				} else {
					updates[attrName] = "0";
				}
                
            }
        });

        // Update heart checkboxes only if they are set to "0"
        for (let i = 1; i <= 10; i++) {
            let heartBox = `heartbox${i}`;
            let currentValue = values[heartBox];

            // Set to "1" if the heart checkbox is still at its initial state (i.e., "0")
            if (currentValue === "0") {
                updates[heartBox] = "1";
            }
        }
		
		// Initialize weapon tier checkboxes as zero
        for (let i = 1; i <= 2; i++) {
            let weapontierbox = `weapontierbox${i}`;
			updates[weapontierbox] = "0";
        }
		
		// Initialize instrument tier checkboxes as zero
        for (let i = 1; i <= 2; i++) {
            let instrumenttierbox = `instrumenttierbox${i}`;
			updates[instrumenttierbox] = "0";
        }
		
        // Initialize general experience checkboxes as zero
        for (let i = 1; i <= 10; i++) {
            let experiencebox = `experiencebox${i}`;
			updates[experiencebox] = "0";
        }

        // Apply the changes if necessary
        if (Object.keys(updates).length > 0) {
            setAttrs(updates);
        }
    });
}

/********************************/
/***GENERIC FUNCTIONS & TABLES***/
/********************************/
function getSuccessfulRolls(rolls) {
    // Filter the array to include only rolls 4, 5, and 6
    return rolls.filter(roll => roll >= 4);
}

function determineRollOutcome(successfulRolls) {
    return successfulRolls.length > 0 ? "SUCCESS" : "FAILURE";
}

function chooseRollTemplateTitleDescriptionSection(result, type) {
    let strRollTemplatePart = "";
	
	let strResult = titleDescriptionResultTable[result.toString()];
	
	if (type == "title") {
		strRollTemplatePart = `{{titleColor${strResult}=${"true"}}}`;
	} else if (type == "initiative") {
		strRollTemplatePart = `{{initiativetotalResult${strResult}=${"true"}}}`;
	} else if (type == "attack") {
		strRollTemplatePart = `{{attackDescriptionText${strResult}=${"true"}}}`;
	} else if (type == "damage") {
		strRollTemplatePart = `{{damageDescriptionText${strResult}=${"true"}}}`;
	} else if (type == "skill") {
		strRollTemplatePart = `{{skillDescriptionText${strResult}=${"true"}}}`;
	} else {
		console.log("Choice N/A for chooseRollTemplateTitleDescriptionSection");
	}

    return strRollTemplatePart.trim();
}
	
// Function to generate RollTemplate part string
function buildRollTemplateDiceSection(diceArray, action) {
    let strRollTemplatePart = ""; // Initialize the result string
	let strAction = action.toString();

    // Iterate over the dice array
    for (let i = 0; i < diceArray.length; i++) {		
		const diceVal = diceArray[i]; // Current dice value
		const strDiceRollResult = (strAction == "initiative" || strAction == "instrument" || strAction == "reroll") ? diceResultTable["N/A"] : diceResultTable[diceVal.toString()];

		// Generate the strings for this dice roll
		let strRoll = (action !== "damage") ? `{{roll${i+1}=${diceVal}}}` : `{{damageRoll${i+1}=${diceVal}}}`;
		let strResult = (action !== "damage") ? `{{roll${i+1}${strDiceRollResult}=${"true"}}}` : `{{damageRoll${i+1}${strDiceRollResult}=${"true"}}}`;
		
		// Append to the main string with a space in between
        strRollTemplatePart += `${strRoll} ${strResult} `;
    }

    // Return the final constructed string
    return strRollTemplatePart.trim(); // Trim to remove any trailing spaces
}

const titleDescriptionResultTable = {
	"SUCCESS": 	"Success",
    "FAILURE":	"Failure",
	"N/A":		"Dark",
};

const diceResultTable = {
    "6": 	"Success",
    "5":	"Success",
	"4": 	"Success",
	"3":	"Failure",	
	"2":	"Failure",
	"1":	"Failure",
	"N/A":	"Dark",
};

/*******************/
/*** HEART BOXES ***/
/*******************/
// Listener for heart checkboxes (1-10)
on("change:heartbox1 change:heartbox2 change:heartbox3 change:heartbox4 change:heartbox5 change:heartbox6 change:heartbox7 change:heartbox8 change:heartbox9 change:heartbox10", function(event) {
    // List of heart checkboxes (heartbox1 to heartbox10)
    const heartboxes = [];
    for (let i = 1; i <= 10; i++) {
        heartboxes.push(`heartbox${i}`);
    }

    // Retrieve the current values of all heart checkboxes
    getAttrs(heartboxes, function(values) {
        let updatedAttrs = {};
        let heartSum = 0;

        // Convert checkbox values to integers (default to 0 if unchecked)
        let checkboxValues = heartboxes.map((checkbox, index) => {
            return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
        });

        // Sum the checked boxes (value = 1 means checked)
        checkboxValues.forEach(item => {
            if (item.value === 1) {
                heartSum++;
            }
        });

        // Auto-uncheck later checkboxes if one in the middle is unchecked
        checkboxValues.forEach(item => {
            let isChecked = parseInt(event.newValue) === 1;
            let source = event.sourceAttribute;
            let checkboxNum = item.index;

            // If a checkbox is unchecked, clear later checkboxes
            if (!isChecked) {
                if (source === `heartbox${checkboxNum}`) {
                    for (let i = checkboxNum + 1; i <= 10; i++) {
                        updatedAttrs[`heartbox${i}`] = 0;
                    }
                }
            }

            // Auto-check earlier checkboxes if a later one is checked
            if (isChecked) {
                if (source === `heartbox${checkboxNum}`) {
                    for (let i = checkboxNum - 1; i >= 1; i--) {
                        if (parseInt(values[`heartbox${i}`]) !== 1) {
                            updatedAttrs[`heartbox${i}`] = 1;
                        }
                    }
                }
            }
        });

        // Update the HP attribute with the calculated sum
        updatedAttrs["hp"] = heartSum;

        // Apply the changes if necessary
        if (Object.keys(updatedAttrs).length > 0) {
            setAttrs(updatedAttrs);
        }
    });
});

/***********************************/
/*** CHARACTER STRING ATTRIBUTES ***/
/*** NAME, OCCUPATION, WEAPON ******/
/*** INSTRUMENT, ITEMS AND NOTES ***/
/***********************************/
const charNameXPAttr = ['charactername', 'characteroccupation', 'charactercondition', 'weaponname', 'instrumentname', 'item1name', 'item2name', 'item3name', 'item4name', 'item5name', 'item6name', 'item7name', 'item8name','characternotes'];
charNameXPAttr.forEach(attr => {
    on(`change:${attr}`, () => {	
        getAttrs([attr], values => {			
            let attrNew = values[attr];

            setAttrs({
                [`${attr}`]: attrNew 
            });
        });
    });
});

/**********************************/
/*** CHARACTER DIGIT ATTRIBUTES ***/
/*** AGE & GOLD *******************/
/**********************************/
const charAgeGoldAttr = ['characterAge', 'characterGold'];
charAgeGoldAttr.forEach(attr => {
    on(`change:${attr}`, () => {
		// Determine the corresponding max attribute name
		const maxAttr = `${attr}_max`;
		
        getAttrs([attr, maxAttr], values => {			
            let attrNew = values[attr];
			const attrMax = values[maxAttr];
			
			// Remove any non-numeric characters
			attrNew = attrNew.replace(/\D/g, '');

			// Remove leading zeroes, allowing only a single leading zero
			attrNew = attrNew.replace(/^0+(?=\d)/, '');
			
			// Convert the attribute and max value to integers for comparison
            const currentValue = parseInt(attrNew, 10) || 0;
            const maxValue = parseInt(attrMax, 10) || 0;

            // Validate that the current value doesn't exceed the max value
            if (currentValue > maxValue) {
                attrNew = maxValue.toString();
            }

            setAttrs({
                [`${attr}`]: attrNew 
            });
        });
    });
});

/*************************************/
/*** WEAPON & INSTRUMENT EXPERIENCE***/
/*************************************/
// Listens for changes to the checkboxes of the weapon and instrument experience (tierbox1 to tierbox2)
const weaponinstrumentTypes = ["weapon", "instrument"];

weaponinstrumentTypes.forEach(type => {
    on(`change:${type}tierbox1 change:${type}tierbox2`, function(event) {
        let checkboxes = [];
        for (let i = 1; i <= 2; i++) {
            checkboxes.push(`${type}tierbox${i}`);
        }

        getAttrs(checkboxes, function(values) {
            let updatedAttrs = {};
            let sum = 0;

            let checkboxValues = checkboxes.map((checkbox, index) => {
                return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
            });

            checkboxValues.forEach(item => {
                if (item.value === 1) {
                    sum++;
                }
            });

            checkboxValues.forEach(item => {
                let isChecked = parseInt(event.newValue) === 1;
                let source = event.sourceAttribute;
                let checkboxNum = item.index;

                if (!isChecked) {
                    if (source === `${type}tierbox${checkboxNum}`) {
                        for (let i = checkboxNum + 1; i <= 2; i++) {
                            updatedAttrs[`${type}tierbox${i}`] = 0;
                        }
                    }
                }

                if (isChecked) {
                    if (source === `${type}tierbox${checkboxNum}`) {
                        for (let i = checkboxNum - 1; i >= 1; i--) {
                            let earlierBox = `${type}tierbox${i}`;
                            let earlierValue = parseInt(values[earlierBox]) || 0;
                            if (earlierValue !== 1) {
                                updatedAttrs[earlierBox] = 1;
                            }
                        }
                    }
                }
            });

            updatedAttrs[`${type}_tier`] = sum;

            if (Object.keys(updatedAttrs).length > 0) {
                setAttrs(updatedAttrs);
            }
        });
    });
});

/******************/
/*** INITIATIVE ***/
/******************/
on('clicked:rollInitiative', (info) => {
	getAttrs(["reflex"], function (values) {
		let reflexXP = values.reflex;
		
		let initiativeDiceRoll = `&{template:hidden-singleroll} {{InitiativeRoll=[[${reflexXP}d6 &{tracker}]]}}`;
        
		startRoll(initiativeDiceRoll, (results) => {
			// TITLE HANDLING
			let TitleColorResult = chooseRollTemplateTitleDescriptionSection("N/A", "title");
			let InitiativeTitle = "Initiative";
			
			// INITIATIVE HANDLING
			let InitiativeRollTemplate = buildRollTemplateDiceSection(results.results.InitiativeRoll.dice, "initiative");
			
			let TotalResultColor = chooseRollTemplateTitleDescriptionSection("SUCCESS", "initiative");
			let InitiativeTotalResult = results.results.InitiativeRoll.result;
			
			InitiativeRollTemplate += ` ${TotalResultColor} {{initiativetotalResult=${InitiativeTotalResult}}}`;

			let rollSummary = `&{template:sewersanctuary} ${TitleColorResult} {{title=${InitiativeTitle}}} ${InitiativeRollTemplate}`;
			startRoll(rollSummary, (summaryResults) => {
				finishRoll(summaryResults.rollId, {});
			});

			finishRoll(results.rollId, {});
		});
	});
});

/***********************/
/*** WEAPON - ATTACK ***/
/***********************/
on('clicked:rollWeapon', (info) => {
    getAttrs(["weaponname", "weapon_tier", "strength", "dexterity"], function (values) {
		let weaponName = values.weaponname;
		let weaponTier = values.weapon_tier;
        let strengthXP = values.strength;
		let dexterityXP = values.dexterity;
        
        let diceRoll = `&{template:hidden-doubleroll} {{AttackRoll=[[${weaponTier}d6 + ${dexterityXP}d6]]}} {{DamageRoll=[[${weaponTier}d6 + ${strengthXP}d6]]}}`;
        
        startRoll(diceRoll, (results) => {
			// TITLE HANDLING
			let TitleColorResult = chooseRollTemplateTitleDescriptionSection("N/A", "title");
			let AttackTitle = (weaponName !== "") ? "Attack, " + weaponName :"Attack, Unarmed";
			
			// ATTACKROLL HANDLING
			let AttackRollTemplate = buildRollTemplateDiceSection(results.results.AttackRoll.dice, "attack");
			let AttackRollSuccesses = getSuccessfulRolls(results.results.AttackRoll.dice);
			let attackDescriptionColor = chooseRollTemplateTitleDescriptionSection(determineRollOutcome(AttackRollSuccesses), "attack");
			let attackDescriptionText = AttackRollSuccesses.length + " successes";
			
			AttackRollTemplate += ` ${attackDescriptionColor} {{attackDescriptionText=${attackDescriptionText}}}`;
			
			// DAMAGEROLL HANDLING
			let DamageRollTemplate = buildRollTemplateDiceSection(results.results.DamageRoll.dice, "damage");
			let DamageRollSuccesses = getSuccessfulRolls(results.results.DamageRoll.dice);
			let damageDescriptionColor = chooseRollTemplateTitleDescriptionSection(determineRollOutcome(DamageRollSuccesses), "damage");
			let damageDescriptionText = DamageRollSuccesses.length + " damage";
			
			DamageRollTemplate += ` ${damageDescriptionColor} {{damageDescriptionText=${damageDescriptionText}}}`;
		
			let rollSummary = `&{template:sewersanctuary} ${TitleColorResult} {{title=${AttackTitle}}} ${AttackRollTemplate} ${DamageRollTemplate}`;
			startRoll(rollSummary, (summaryResults) => {
				finishRoll(summaryResults.rollId, {});
			});

			finishRoll(results.rollId, {});
        });
    });
});

/********************************/
/*** INSTRUMENT - Play Melody ***/
/********************************/
on('clicked:rollInstrument', (info) => {
    getAttrs(["instrumentname", "instrument_tier", "music"], function (values) {
		let instrumentName = values.instrumentname;
		let instrumentTier = values.instrument_tier;
		let musicXP = values.music;
        
		let instrumentDiceRoll = `&{template:hidden-singleroll} {{InstrumentRoll=[[${instrumentTier}d6 + ${musicXP}d6]]}}`;
        
        startRoll(instrumentDiceRoll, (results) => {
			// TITLE HANDLING
			let TitleColorResult = chooseRollTemplateTitleDescriptionSection("N/A", "title");
			console.log(instrumentName);
			let InstrumentTitle = (instrumentName !== "") ? "Play music, " + instrumentName : "Play music, Whistling";
			
			// INSTRUMENTROLL HANDLING
			let InstrumentRollTemplate = buildRollTemplateDiceSection(results.results.InstrumentRoll.dice, "instrument");
		
			let rollSummary = `&{template:sewersanctuary} ${TitleColorResult} {{title=${InstrumentTitle}}} ${InstrumentRollTemplate}`;
            startRoll(rollSummary, (summaryResults) => {
                finishRoll(summaryResults.rollId, {});
            });
			
			finishRoll(results.rollId, {});
        });
    });    
});

/**************/
/*** SKILLS ***/
/**************/
// Listens for changes to the checkboxes of the skills (expbox1 to expbox6 for each skill) with the following skills to monitor
const skills = [
	"strength", "perception", "dexterity", "mechanics",
	"acrobatics", "survival", "reflex", "arcane/alchemy",
	"defense", "music"
];

// Create a listener for each skill to update the corresponding exp attribute
skills.forEach(skill => {
    on(`change:${skill}-expbox1 change:${skill}-expbox2 change:${skill}-expbox3 change:${skill}-expbox4 change:${skill}-expbox5 change:${skill}-expbox6`, function(event) {
        // Get the checkboxes for the current skill (expbox1 to expbox6)
        let checkboxes = [];
        for (let i = 1; i <= 6; i++) {
            checkboxes.push(`${skill}-expbox${i}`);
        }

        // Retrieve the current values of all checkboxes
        getAttrs(checkboxes, function(values) {
            let updatedAttrs = {};
            let sum = 0;

            // Convert checkbox values to integers (default to 0 if unchecked)
            let checkboxValues = checkboxes.map((checkbox, index) => {
                return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
            });

            // Sum the checked boxes (value = 1 means checked)
            checkboxValues.forEach(item => {
                if (item.value === 1) {
                    sum++;
                }
            });

            // Auto-uncheck later checkboxes if one in the middle is unchecked
            checkboxValues.forEach(item => {
                let isChecked = parseInt(event.newValue) === 1;
                let source = event.sourceAttribute;
                let checkboxNum = item.index;

                // If a checkbox is unchecked, clear later checkboxes
                if (!isChecked) {
                    if (source === `${skill}-expbox${checkboxNum}`) {
                        for (let i = checkboxNum + 1; i <= 6; i++) {
                            updatedAttrs[`${skill}-expbox${i}`] = 0;
                        }
                    }
                }

                // Auto-check earlier checkboxes if a later one is checked
                if (isChecked) {
                    if (source === `${skill}-expbox${checkboxNum}`) {
                        for (let i = checkboxNum - 1; i >= 1; i--) {
                            if (parseInt(values[`${skill}-expbox${i}`]) !== 1) {
                                updatedAttrs[`${skill}-expbox${i}`] = 1;
                            }
                        }
                    }
                }
            });

            // Update the corresponding <skill>_exp attribute with the sum of checked boxes
            updatedAttrs[`${skill}`] = sum;

            // Apply the changes if necessary
            if (Object.keys(updatedAttrs).length > 0) {
                setAttrs(updatedAttrs);
            }
        });
    });
	
	// Generic function to handle both button variants
    const handleSkillRoll = (skillType) => {
        getAttrs([skill], values => {
            let skillpoints = parseInt(values[skill]);
			
			if (skillType === "Tool") {
				skillpoints += 1;
			}
            
            let diceRoll = `&{template:hidden-singleroll} {{SkillRoll=[[${skillpoints}d6]]}}`;
            startRoll(diceRoll, (results) => {
                
                // TITLE HANDLING
				let TitleColorResult = chooseRollTemplateTitleDescriptionSection("N/A", "title");
                let SkillTitle = skillTranslationTable[skill] + (skillType === "Tool" ? " with tool" : ""); // Add "(Tool)" to title for tool rolls
                
                // SKILLROLL HANDLING
                let SkillRollTemplate = buildRollTemplateDiceSection(results.results.SkillRoll.dice, "skill");
                let SkillRollSuccesses = getSuccessfulRolls(results.results.SkillRoll.dice);
                let skillDescriptionColor = chooseRollTemplateTitleDescriptionSection(determineRollOutcome(SkillRollSuccesses), "skill");
                let skillDescriptionText = SkillRollSuccesses.length + " successes";
                
                SkillRollTemplate += ` ${skillDescriptionColor} {{skillDescriptionText=${skillDescriptionText}}}`;
                
                let rollSummary = `&{template:sewersanctuary} ${TitleColorResult} {{title=${SkillTitle}}} ${SkillRollTemplate}`;
                startRoll(rollSummary, (summaryResults) => {
                    finishRoll(summaryResults.rollId, {});
                });

                finishRoll(results.rollId, {});
            });
        });    
    };

    // Attach event handlers for both skill and skill tool rolls
    on(`clicked:roll${skill}`, () => handleSkillRoll(""));
    on(`clicked:roll${skill}Tool`, () => handleSkillRoll("Tool"));
});

const skillTranslationTable = {
    "strength": 		"Strength",
    "perception":		"Perception",
	"dexterity": 		"Dexterity",
	"mechanics":		"Mechanics",
	"acrobatics":		"Acrobatics",
	"survival":			"Survival",
	"reflex":			"Reflex",
	"arcane/alchemy":	"Arcane/Alchemy",
	"defense":			"Defense",
	"music":			"Music",
};

/*****************************/
/*** EXPERIENCE & REROLLD6 ***/
/*****************************/
// Listener for experience checkboxes (1-10) experiencebox
on("change:experiencebox1 change:experiencebox2 change:experiencebox3 change:experiencebox4 change:experiencebox5 change:experiencebox6 change:experiencebox7 change:experiencebox8 change:experiencebox9 change:experiencebox10", function(event) {
    const experienceboxes = [];
    for (let i = 1; i <= 10; i++) {
        experienceboxes.push(`experiencebox${i}`);
    }

    // Retrieve the current values of all experience checkboxes
    getAttrs(experienceboxes, function(values) {
        let updatedAttrs = {};
        let expSum = 0;

        // Convert checkbox values to integers (default to 0 if unchecked)
        let checkboxValues = experienceboxes.map((checkbox, index) => {
            return { checkbox, value: parseInt(values[checkbox]) || 0, index: index + 1 };
        });

        // Sum the checked boxes (value = 1 means checked)
        checkboxValues.forEach(item => {
            if (item.value === 1) {
                expSum++;
            }
        });

        // Auto-uncheck later checkboxes if one in the middle is unchecked
        checkboxValues.forEach(item => {
            let isChecked = parseInt(event.newValue) === 1;
            let source = event.sourceAttribute;
            let checkboxNum = item.index;

            // If a checkbox is unchecked, clear later checkboxes
            if (!isChecked) {
                if (source === `experiencebox${checkboxNum}`) {
                    for (let i = checkboxNum + 1; i <= 10; i++) {
                        updatedAttrs[`experiencebox${i}`] = 0;
                    }
                }
            }

            // Auto-check earlier checkboxes if a later one is checked
            if (isChecked) {
                if (source === `experiencebox${checkboxNum}`) {
                    for (let i = checkboxNum - 1; i >= 1; i--) {
                        if (parseInt(values[`experiencebox${i}`]) !== 1) {
                            updatedAttrs[`experiencebox${i}`] = 1;
                        }
                    }
                }
            }
        });

        // Update the experience attribute with the calculated sum
        updatedAttrs["experience"] = expSum;

        // Apply the changes if necessary
        if (Object.keys(updatedAttrs).length > 0) {
            setAttrs(updatedAttrs);
        }
    });
});

on('clicked:reroll1D6', (info) => {
	let diceRoll = `&{template:hidden-singleroll} {{Reroll=[[1d6]]}}`;
	startRoll(diceRoll, (results) => {
		let TitleColorResult = chooseRollTemplateTitleDescriptionSection("N/A", "title");
		let RerollTitle = "Re-roll Dice";
		
		let ReRollTemplate = buildRollTemplateDiceSection(results.results.Reroll.dice, "reroll");
		
		let rollSummary = `&{template:sewersanctuary} ${TitleColorResult} {{title=${RerollTitle}}} ${ReRollTemplate}`;
		startRoll(rollSummary, (summaryResults) => {
			finishRoll(summaryResults.rollId, {});
		});

		finishRoll(results.rollId, {});
	});
});
</script>