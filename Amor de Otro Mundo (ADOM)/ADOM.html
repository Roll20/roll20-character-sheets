<!-- ======================================================= -->
<!-- ========== SISTEMA DE TABS COMPATIBLE ROLL20 ========== -->
<!-- ======================================================= -->

<!-- TAB 1 -->
<input type="radio" name="tab" class="sheet-tab sheet-tab1" value="1" checked="checked">
<span title="PERSONAJE"></span>

<!-- TAB 2 -->
<input type="radio" name="tab" class="sheet-tab sheet-tab2" value="2">
<span title="ÉXTASIS"></span>

<!-- ======================================================= -->
<!-- ======================= TAB 1 ========================== -->
<!-- ======================================================= -->

<div class="sheet-tab-content sheet-humano">

    <!-- CABECERA -->
    <div class="cabecera-ficha">

        <!-- LOGO – CAMBIA A TAB 2 -->
        <label class="logo-area logo-boton">
            <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,fit=crop,q=95/m2W87kW3v1HVjlMj/logo-adom-letras-negras-AVL7EBK9NnuKPlVv.png" class="logo-imagen">
        </label>
        
        <!-- BLOQUE CENTRAL -->
        <div class="bloque-central">
            <div class="fila">
                <label>Nombre</label>
                <input type="text" name="attr_character_name" style="width: 250px;">
            </div>

            <div class="fila">
                <label>Concepto</label>
                <input type="text" name="attr_Concepto" style="width: 350px;">
            </div>
        </div>

        <!-- BLOQUE DERECHO -->
        <div class="bloque-derecho">
            <div class="fila">
                <label>Drama</label>
                <input class="num-grande" type="number" name="attr_Drama_ACTUAL"> /
                <input class="num-grande" type="number" name="attr_Drama">
            </div>

            <div class="fila">
                <label>Experiencia</label>
                <input class="num-grande" type="number" name="attr_Experiencia">
            </div>
        </div>

    </div> <!-- FIN CABECERA -->

    <!-- HITOS Y COMPLICACIONES -->
    <div class="sheet-section-aspects sheet-section">
        <div class="sheet-header">HITOS Y COMPLICACIONES</div>

        <div class="hitos-comp-grid">
            <!-- Hitos 1-4 -->
                <div class="hito-block">
                    <input name="attr_Aspect1" type="text" placeholder="Hito">
                    <input name="attr_Aspect2" type="text" placeholder="Hito">
                    <input name="attr_Aspect3" type="text" placeholder="Hito">
                </div>
                
                <div class="hito-block">
                    <input name="attr_Aspect4" type="text" placeholder="Hito">
                    <input name="attr_Aspect5" type="text" placeholder="Hito">
                    <input name="attr_Aspect6" type="text" placeholder="Hito">
                </div>

            <!-- Complicaciones 1-4 -->
                <div class="comp-block">
                        <input name="attr_Comp1" type="text" placeholder="Complicacion">
                        <input name="attr_Comp2" type="text" placeholder="Complicacion">
                        <input name="attr_Comp3" type="text" placeholder="Complicacion">
                </div>
                
                <div class="comp-block">
                        <input name="attr_Comp4" type="text" placeholder="Complicacion">
                        <input name="attr_Comp5" type="text" placeholder="Complicacion">
                        <input name="attr_Comp6" type="text" placeholder="Complicacion">
                </div>
        </div>
    </div>


    <!-- SALUD + COMBATE -->
    <div class="dos-columnas">

        <!-- SALUD -->
        <div class="columna">
            <div class="sheet-header">SALUD</div>

    <!-- UMBRAL+ RESISTENCIA--> 
    
                    <div class="stat-item">
                        <strong>UMBRAL DE HERIDA</strong>
                        <input disabled name="attr_aguante" type="number" value="floor(@{VOLUNTAD}/2)+@{FORTALEZA}">
                        <strong>RESISTENCIA</strong>
                        <input disabled name="attr_RESISTENCIA_max" type="number" value="@{aguante}+@{aguante}+@{aguante}" >
                        <input name="attr_RESISTENCIA" type="number">
                    </div>

            <!-- Heridas -->
                <div class="heridas-grid">
                    
                        <label>Leve</label><input type="checkbox" name="attr_Herida_Leve">
                        <label>Grave</label><input type="checkbox" name="attr_Herida_Grave">

                        <label>Leve</label><input type="checkbox" name="attr_Herida_Leve2">
                        <label>Grave</label><input type="checkbox" name="attr_Herida_Grave2">
                </div>

            <!-- Secuelas / Distorsión / Éxtasis -->
             <div class="secuelas-container">
                
                <div class="secuelas-box">
                    <div class="sheet-header"><strong>SECUELAS Y TRASTORNOS</strong></div>
                    <input name="attr_Secuela1" type="text" class="secuelas input">
                    <input name="attr_Secuela2" type="text" class="secuelas input">
                </div>

                <div class="distorsion-box">
                  <div class="sheet-header">DISTORSIÓN</div>
                
                  <div class="stat-item">
                    <strong>Distorsión</strong>
                    <input type="number" name="attr_Distorsion">
                  </div>
                
                  <div class="stat-item">
                    <strong>Salida de Éxtasis</strong>
                    <input type="number" name="attr_salida_extasis" value="@{Distorsion}+10" disabled>
                  </div>
                </div>


                <div class="extasis-box">
                    <div class="sheet-header"><strong>ÉXTASIS</strong></div>
                    
                    <div class="degeneration-track">
                        <label><input type="checkbox" name="attr_EXT1"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT2"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT3"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT4"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT5"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT6"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT7"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT8"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT9"><span></span></label>
                        <label><input type="checkbox" name="attr_EXT10"><span></span></label>
                    </div>
                </div>
            </div>
        </div>                
                
             <!-- FIN SALUD -->

        <!-- COMBATE -->
        <div class="columna">
            <div class="sheet-header">COMBATE</div>

                    <div class="combate-grid">
                        
                        <div class="stat-item">
                        <label><strong>INICIATIVA</strong></label>
                        <button type="roll"
                            value="/r {3d10dh1}kh1 + floor(@{INTELECTO}/2) + @{REFLEJOS}"></button>
                        <input name=attr_Iniciativa value="floor(@{INTELECTO}/2) + @{REFLEJOS}" type="number" disabled>

                        </div>
                        
                        <div>
                        <label><strong>ATAQUE</strong></label>
                        <button type="roll" value="/r {3d10dh1}kh1 + @{REFLEJOS} + @{COMBATE}"></button>
                        </div>

                        <div class="stat-item">
                            
                        <label><strong>DAÑO CaC</strong></label>
                        <input name="attr_DAÑOCaC" type="number" value="floor((@{Fortaleza} + @{Combate})/4)" disabled>
                        </div>

                        <div class="stat-item">
                        <label><strong>DAÑO DIS</strong></label>
                        <input name="attr_DAÑODIS" type="number" value="floor(@{Combate}/4)" disabled>
                        </div>
                    </div>

            <!-- Armas -->
            <div class="tabla-combate-grid">
                <div class="tabla-combate-head">
                        <div>ARMA</div>
                        <div>DAÑO</div>
                        <div>PROTECCIÓN</div>
                        <div>RD</div>
                    </div>
                
                <div class="tabla-combate-row">
                        <div><input name="attr_arma1" type="text"></div>
                        <div><input name="attr_daño1" type="text"></div>
                        <div><input name="attr_prot1" type="text"></div>
                        <div><input name="attr_rd1" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma2" type="text"></div>
                        <div><input name="attr_daño2" type="text"></div>
                        <div><input name="attr_prot2" type="text"></div>
                        <div><input name="attr_rd2" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma3" type="text"></div>
                        <div><input name="attr_daño3" type="text"></div>
                        <div><input name="attr_prot3" type="text"></div>
                        <div><input name="attr_rd3" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma4" type="text"></div>
                        <div><input name="attr_daño4" type="text"></div>
                        <div><input name="attr_prot4" type="text"></div>
                        <div><input name="attr_rd4" type="text"></div>
                </div>
                 <div class="tabla-combate-row">
                        <div><input name="attr_arma5" type="text"></div>
                        <div><input name="attr_daño5" type="text"></div>
                        <div><input name="attr_prot5" type="text"></div>
                        <div><input name="attr_rd5" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma6" type="text"></div>
                        <div><input name="attr_daño6" type="text"></div>
                        <div><input name="attr_prot6" type="text"></div>
                        <div><input name="attr_rd6" type="text"></div>
                </div>

            </div>

        </div> <!-- FIN COMBATE -->
    </div> <!-- FIN DOS COLUMNAS -->

    <!-- CARACTERÍSTICAS -->
    <div class="sheet-section-aspects sheet-section">
        <div class="sheet-header">CARACTERÍSTICAS</div>
    
    <div class="caracteristicas-grid">
    
            <!-- FORTALEZA / VOLUNTAD -->
            <div class="carac-box">
                <label><strong>FORTALEZA</strong></label>
                    <button type="roll"
                    value="/r {3d10dh1}kh1 + (@{Fortaleza})"></button>
                    <input type="number" name="attr_FORTALEZA" value="0" >
                    <input  name="attr_FORTALEZA_hito" type="text">
            </div>

            <div class="carac-box">
                <label><strong>VOLUNTAD</strong></label>
                   <button type="roll"
                    value="/r {3d10dh1}kh1 + (@{Voluntad})"></button>
                    <input type="number" name="attr_VOLUNTAD" value="0">
                    <input name="attr_VOLUNTAD_hito" type="text">
            </div>

            <!-- REFLEJOS / INTELECTO -->
            <div class="carac-box">
                <label><strong>REFLEJOS</strong></label>
                <button type="roll"
                    value="/r {3d10dh1}kh1 + (@{Reflejos})"></button>
                    <input type="number" name="attr_REFLEJOS" value="0">
                    <input name="attr_REFLEJOS_hito" type="text">
            </div>    

            <div class="carac-box">
                <label><strong>INTELECTO</strong></label>
                    <button type="roll"
                    value="/r {3d10dh1}kh1 + (@{Intelecto})"></button>
                    <input type="number" name="attr_INTELECTO" value="0">
                    <input name="attr_INTELECTO_hito" type="text">
            </div>
        </div>
    </div>

    <!-- HABILIDADES -->
    <div class="sheet-section">
        <div class="sheet-header">HABILIDADES</div>
        
        <div class="habilidades-grid">

    <!-- etiquetas invisibles -->
    <span style="display:none" name="attr_EligeCaracterística">Elige Caracteristica</span>
    <span style="display:none" name="attr_Fortaleza">Fortaleza</span>
    <span style="display:none" name="attr_Voluntad">Voluntad</span>
    <span style="display:none" name="attr_Reflejos">Reflejos</span>
    <span style="display:none" name="attr_Intelecto">Intelecto</span>

        <!-- Fila 1 -->
            <div class="hab-box">
            <label><strong>FORMA FÍSICA</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{FORMA_FÍSICA} + ?{Modificador|0}"></button>


            <input type="number" name="attr_FORMA_FÍSICA" value="0" >
            <input type="text" name="attr_FORMA_FÍSICA_hito1">
            <input type="text" name="attr_FORMA_FÍSICA_hito2">
            </div>


            <div class="hab-box">
            <label><strong>PERCEPCIÓN</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{PERCEPCIÓN} + ?{Modificador|0}"></button>
            
                <input name="attr_PERCEPCIÓN" value="0" type="number" >
                <input name="attr_PERCEPCIÓN_hito1" type="text">
                <input name="attr_PERCEPCIÓN_hito2" type="text">
            </div>
        

        <!-- Fila 2 -->
            <div class="hab-box">
            <label><strong>COMBATE</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{COMBATE} + ?{Modificador|0}"></button>

                <input name="attr_COMBATE" type="number" value="0" >
                <input name="attr_COMBATE_hito1" type="text">
                <input name="attr_COMBATE_hito2" type="text">
            </div>

            <div class="hab-box">
            <label><strong>SUBTERFUGIO</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{SUBTERFUGIO} + ?{Modificador|0}"></button>

                <input name="attr_SUBTERFUGIO" type="number" value="0" >
                <input name="attr_SUBTERFUGIO_hito1" type="text">
                <input name="attr_SUBTERFUGIO_hito2" type="text">
            </div>

        <!-- Fila 3 -->
            <div class="hab-box">
            <label><strong>COMUNICACIÓN</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{COMUNICACIÓN} + ?{Modificador|0}"></button>

                <input name="attr_COMUNICACIÓN" type="number" value="0" >
                <input name="attr_COMUNICACIÓN_hito1" type="text">
                <input name="attr_COMUNICACIÓN_hito2" type="text">
            </div>

            <div class="hab-box">
            <label><strong>CULTURA</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{CULTURA} + ?{Modificador|0}"></button>

                <input name="attr_CULTURA" type="number" value="0" >
                <input name="attr_CULTURA_hito1" type="text">
                <input name="attr_CULTURA_hito2" type="text">
            </div>

        <!-- Fila 4 -->
            <div class="hab-box">
            <label><strong>G. EMOCIONAL</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{GESTION_EMOCIONAL} + ?{Modificador|0}"></button>
            
                <input name="attr_GESTION_EMOCIONAL" type="number" value="0" >
                <input name="attr_GESTION_EMOCIONAL_hito1" type="text">
                <input name="attr_GESTION_EMOCIONAL_hito2" type="text">
            </div>
            <div class="hab-box">
            <label><strong>OCULTISMO</strong></label>
            <button type="roll"
                value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA}| Voluntad,@{VOLUNTAD}| Reflejos,@{REFLEJOS}|
            Intelecto,@{INTELECTO}}+ @{OCULTISMO} + ?{Modificador|0}"></button>
            
                <input name="attr_OCULTISMO" type="number" value="0" >
                <input name="attr_OCULTISMO_hito1" type="text">
                <input name="attr_OCULTISMO_hito2" type="text">
            </div>
        </div>
    </div>

    <!-- LAZOS + NOTAS -->
    <div class="contenedor-lazos-notas">
        <!-- Bloque Lazos -->
        <div class="arcana-section">
            <div class="sheet-header">LAZOS</div>

            <!-- LAZOS -->
            <div class="lazos-grid">
            
              <div class="lazos-head">
                <div>NOMBRE</div>
                <div>LAZO</div>
                <div>MEDIO</div>
                <div>MAYOR</div>
                <div>CRÍTICO</div>
                <div>⚓</div>
              </div>
            
              <!-- 1 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre1"></div>
                <div><input type="number" name="attr_lazo_base1" value="0"></div>
                <div><input type="number" name="attr_lazo_medio1" value="round(@{lazo_base1}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor1" value="@{lazo_base1}" disabled></div>
                <div><input type="number" name="attr_lazo_critico1" value="(@{lazo_base1}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla1"></div>
              </div>
            
              <!-- 2 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre2"></div>
                <div><input type="number" name="attr_lazo_base2" value="0"></div>
                <div><input type="number" name="attr_lazo_medio2" value="round(@{lazo_base2}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor2" value="@{lazo_base2}" disabled></div>
                <div><input type="number" name="attr_lazo_critico2" value="(@{lazo_base2}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla2"></div>
              </div>
            
              <!-- 3 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre3"></div>
                <div><input type="number" name="attr_lazo_base3" value="0"></div>
                <div><input type="number" name="attr_lazo_medio3" value="round(@{lazo_base3}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor3" value="@{lazo_base3}" disabled></div>
                <div><input type="number" name="attr_lazo_critico3" value="(@{lazo_base3}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla3"></div>
              </div>
            
              <!-- 4 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre4"></div>
                <div><input type="number" name="attr_lazo_base4" value="0"></div>
                <div><input type="number" name="attr_lazo_medio4" value="round(@{lazo_base4}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor4" value="@{lazo_base4}" disabled></div>
                <div><input type="number" name="attr_lazo_critico4" value="(@{lazo_base4}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla4"></div>
              </div>
            
              <!-- 5 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre5"></div>
                <div><input type="number" name="attr_lazo_base5" value="0"></div>
                <div><input type="number" name="attr_lazo_medio5" value="round(@{lazo_base5}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor5" value="@{lazo_base5}" disabled></div>
                <div><input type="number" name="attr_lazo_critico5" value="(@{lazo_base5}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla5"></div>
              </div>
            
              <!-- 6 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre6"></div>
                <div><input type="number" name="attr_lazo_base6" value="0"></div>
                <div><input type="number" name="attr_lazo_medio6" value="round(@{lazo_base6}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor6" value="@{lazo_base6}" disabled></div>
                <div><input type="number" name="attr_lazo_critico6" value="(@{lazo_base6}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla6"></div>
              </div>
            
              <!-- 7 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre7"></div>
                <div><input type="number" name="attr_lazo_base7" value="0"></div>
                <div><input type="number" name="attr_lazo_medio7" value="round(@{lazo_base7}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor7" value="@{lazo_base7}" disabled></div>
                <div><input type="number" name="attr_lazo_critico7" value="(@{lazo_base7}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla7"></div>
              </div>
            
              <!-- 8 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre8"></div>
                <div><input type="number" name="attr_lazo_base8" value="0"></div>
                <div><input type="number" name="attr_lazo_medio8" value="round(@{lazo_base8}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor8" value="@{lazo_base8}" disabled></div>
                <div><input type="number" name="attr_lazo_critico8" value="(@{lazo_base8}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla8"></div>
              </div>
            
              <!-- 9 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre9"></div>
                <div><input type="number" name="attr_lazo_base9" value="0"></div>
                <div><input type="number" name="attr_lazo_medio9" value="round(@{lazo_base9}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor9" value="@{lazo_base9}" disabled></div>
                <div><input type="number" name="attr_lazo_critico9" value="(@{lazo_base9}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla9"></div>
              </div>
            
              <!-- 10 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_nombre10"></div>
                <div><input type="number" name="attr_lazo_base10" value="0"></div>
                <div><input type="number" name="attr_lazo_medio10" value="round(@{lazo_base10}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_mayor10" value="@{lazo_base10}" disabled></div>
                <div><input type="number" name="attr_lazo_critico10" value="(@{lazo_base10}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla10"></div>
              </div>
            
            </div>

        </div>

        <!-- Bloque Notas -->
        <div class="bloque-notas">
            <div class="sheet-header">NOTAS</div>
            <textarea name="attr_notas"></textarea>
        </div>
    </div> <!-- FIN contenedor lazos + notas -->
</div> <!-- FIN TAB 1 -->




<!-- ======================================================= -->
<!-- ======================== TAB 2 ========================= -->
<!-- ======================================================= -->

<div class="sheet-tab-content tab-extaisi">

    <!-- CABECERA -->
    <div class="cabecera-ficha">

        <!-- LOGO – CAMBIA A TAB 1 -->
        <label class="logo-area logo-boton">
            <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,fit=crop,q=95/m2W87kW3v1HVjlMj/logo-adom-letras-negras-AVL7EBK9NnuKPlVv.png" class="logo-imagen">
        </label>
        <!-- BLOQUE CENTRAL -->
        <div class="bloque-central">
            <div class="fila">
                <label>Nombre</label>
                <input type="text" name="attr_character_name" style="width: 250px;">
            </div>

            <div class="fila">
                <label>Concepto</label>
                <input type="text" name="attr_Concepto" style="width: 350px;">
            </div>
        </div>

        <!-- BLOQUE DERECHO -->
        <div class="bloque-derecho">
            <div class="fila">
                <label>Drama</label>
                <input class="num-grande" type="number" name="attr_Drama_ACTUAL"> /
                <input class="num-grande" type="number" name="attr_Drama">
            </div>

            <div class="fila">
                <label>Experiencia</label>
                <input class="num-grande" type="number" name="attr_Experiencia">
            </div>
        </div>
    </div> <!-- FIN CABECERA -->

    <!-- HITOS Y COMPLICACIONES -->
     <div class="sheet-section-aspects sheet-section">
        <div class="sheet-header">HITOS Y COMPLICACIONES</div>

        <div class="hitos-comp-grid">
            <!-- Hitos 1-4 -->
                <div class="hito-block">
                    <input name="attr_Aspect1" type="text" placeholder="Hito">
                    <input name="attr_Aspect2" type="text" placeholder="Hito">
                    <input name="attr_Aspect3" type="text" placeholder="Hito">
                </div>
                
                <div class="hito-block">
                    <input name="attr_Aspect4" type="text" placeholder="Hito">
                    <input name="attr_Aspect5" type="text" placeholder="Hito">
                    <input name="attr_Aspect6" type="text" placeholder="Hito">
                </div>

            <!-- Complicaciones 1-4 -->
                <div class="comp-block">
                        <input name="attr_Comp1" type="text" placeholder="Complicacion">
                        <input name="attr_Comp2" type="text" placeholder="Complicacion">
                        <input name="attr_Comp3" type="text" placeholder="Complicacion">
                </div>
                
                <div class="comp-block">
                        <input name="attr_Comp4" type="text" placeholder="Complicacion">
                        <input name="attr_Comp5" type="text" placeholder="Complicacion">
                        <input name="attr_Comp6" type="text" placeholder="Complicacion">
                </div>
        </div>
    </div>

    <!-- SALUD + COMBATE (ÉXTASIS) -->
    <div class="dos-columnas">

        <!-- SALUD -->
        <div class="columna">
            <div class="sheet-header">SALUD</div>

    <!-- UMBRAL+ RESISTENCIA--> 
    
                <div class="stat-item">
                    <strong>UMBRAL DE HERIDA</strong>
                    <input disabled name="attr_aguante_EXT" type="number" 
                    value="floor((@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS})/2+@{Fortaleza}+@{FORTALEZA_EXT_BONUS})">

                    <strong>RESISTENCIA</strong>
                    <input style="width: 40px;" disabled name="attr_RESISTENCIA_EXT_max" value="@{aguante_EXT}+@{aguante_EXT}+@{aguante_EXT}" >
                        <input style="width: 40px;" name="attr_RESISTENCIA_EXT">
                </div>

            <!-- Heridas -->
        <div class="heridas-grid">    
    
                <label>Leve</label><input type="checkbox" name="attr_Herida_Leve_EXT1">
                <label>Grave</label><input type="checkbox" name="attr_Herida_Grave_EXT1">
                
            
                <label>Leve</label><input type="checkbox" name="attr_Herida_Leve_EXT2">
                <label>Grave</label><input type="checkbox" name="attr_Herida_Grave_EXT2">
        </div>
            

    <!-- SECUELAS / DISTORSIÓN / ÉXTASIS -->
    <div class="secuelas-extasis-container">

        <div class="secuelas-box">
            <div class="sheet-header">SECUELAS Y TRASTORNOS</div>
            <input type="text" name="attr_Secuela1">
            <input type="text" name="attr_Secuela2">
        </div>

        <div class="distorsion-box">
          <div class="sheet-header">DISTORSIÓN</div>
        
          <div class="stat-item">
            <strong>Distorsión</strong>
            <input type="number" name="attr_Distorsion">
          </div>
        
          <div class="stat-item">
            <strong>Salida de Éxtasis</strong>
            <input type="number" name="attr_salida_extasis" value="@{Distorsion}+10" disabled>
          </div>
        </div>


        <div class="extasis-box">
            <div class="sheet-header">ÉXTASIS</div>

            <div class="degeneration-track">
                <label><input type="checkbox" name="attr_EXT1"><span></span></label>
                <label><input type="checkbox" name="attr_EXT2"><span></span></label>
                <label><input type="checkbox" name="attr_EXT3"><span></span></label>
                <label><input type="checkbox" name="attr_EXT4"><span></span></label>
                <label><input type="checkbox" name="attr_EXT5"><span></span></label>
                <label><input type="checkbox" name="attr_EXT6"><span></span></label>
                <label><input type="checkbox" name="attr_EXT7"><span></span></label>
                <label><input type="checkbox" name="attr_EXT8"><span></span></label>
                <label><input type="checkbox" name="attr_EXT9"><span></span></label>
                <label><input type="checkbox" name="attr_EXT10"><span></span></label>
            </div>
        </div>

    </div>
</div>
 <!-- FIN SALUD EXT -->

        <!-- COMBATE EXT -->
        
     <div class="columna">
        <div class="sheet-header">COMBATE</div>

        <div class="combate-grid">
                        
            <div class="stat-item">
                <label><strong>INICIATIVA</strong></label>
                    <button type="roll" value="/r {3d10dh1}kh1 + floor((@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS})/2) + @{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}"></button>
                    <input name=attr_INICIATIVA_EXT value="floor((@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS})/2) + @{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}" type="number" disabled >
                    
            </div>
                        
            <div class="stat-item">
                <label><strong>ATAQUE</strong></label>
                <button style="width:40px;" type="roll"
                        value="/r {3d10dh1}kh1 + @{REFLEJOS_EXT} + @{COMBATE_EXT}"></button>

            </div>
                        
            <div class="stat-item">
            <label><strong>DAÑO CaC</strong></label>
            <input name="attr_DAÑOCaC_EXT" type="number" value="floor((@{Fortaleza_EXT}+@{Fortaleza_EXT_BONUS} + @{Combate_EXT}+@{Combate_EXT_BONUS})/4)" disabled>
            </div>
                        
            <div class="stat-item">
            <label><strong>DAÑO DIS</strong></label>
            <input name="attr_DAÑODIS_EXT" type="number" value="floor((@{Combate_EXT}+@{Combate_EXT_BONUS})/4)" disabled>
            </div>
        </div>
                    
            <!-- Armas -->
            <div class="tabla-combate-grid">
                <div class="tabla-combate-head">
                        <div>ARMA</div>
                        <div>DAÑO</div>
                        <div>PROTECCIÓN</div>
                        <div>RD</div>
                    </div>
                
                <div class="tabla-combate-row">
                        <div><input name="attr_arma1" type="text"></div>
                        <div><input name="attr_daño1" type="text"></div>
                        <div><input name="attr_prot1" type="text"></div>
                        <div><input name="attr_rd1" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma2" type="text"></div>
                        <div><input name="attr_daño2" type="text"></div>
                        <div><input name="attr_prot2" type="text"></div>
                        <div><input name="attr_rd2" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma3" type="text"></div>
                        <div><input name="attr_daño3" type="text"></div>
                        <div><input name="attr_prot3" type="text"></div>
                        <div><input name="attr_rd3" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma4" type="text"></div>
                        <div><input name="attr_daño4" type="text"></div>
                        <div><input name="attr_prot4" type="text"></div>
                        <div><input name="attr_rd4" type="text"></div>
                </div>
               <div class="tabla-combate-row">
                        <div><input name="attr_arma5" type="text"></div>
                        <div><input name="attr_daño5" type="text"></div>
                        <div><input name="attr_prot5" type="text"></div>
                        <div><input name="attr_rd5" type="text"></div>
                </div>
                <div class="tabla-combate-row">
                        <div><input name="attr_arma6" type="text"></div>
                        <div><input name="attr_daño6" type="text"></div>
                        <div><input name="attr_prot6" type="text"></div>
                        <div><input name="attr_rd6" type="text"></div>
                </div>

            </div>
        </div> <!-- FIN COMBATE EXT -->
    </div>
 <!-- FIN dos columnas -->

    <!-- CARACTERÍSTICAS (ÉXTASIS) -->
    <div class="sheet-section-aspects sheet-section">
        <div class="sheet-header">CARACTERÍSTICAS</div>
    
            <div class="caracteristicas-grid">

            <!-- FORTALEZA / VOLUNTAD EXT -->
                <div class="carac-box-ext">
                <label><strong>FORTALEZA</strong></label>

                    <button type="roll"
                        value="/r {3d10dh1}kh1 + @{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}"></button>
                    <input type="number" name="attr_FORTALEZA_EXT" value="(@{FORTALEZA}+@{FORTALEZA_EXT_BONUS})" disabled >
                    <input type="number" name="attr_FORTALEZA_EXT_BONUS" value="0" >
                    <input name="attr_FORTALEZA_hito_EXT" type="text">
                </div>

                <div class="carac-box-ext">
                <label><strong>VOLUNTAD</strong></label>
                    <button type="roll"
                        value="/r {3d10dh1}kh1 + @{Voluntad_EXT}+@{VOLUNTAD_EXT_BONUS}"></button>
                    <input type="number" name="attr_VOLUNTAD_EXT" value="(@{VOLUNTAD}+@{VOLUNTAD_EXT_BONUS})" disabled>
                    <input type="number" name="attr_VOLUNTAD_EXT_BONUS" value="0">
                    <input name="attr_VOLUNTAD_hito_EXT" type="text">
                </div>

            <!-- REFLEJOS / INTELECTO EXT -->
                <div class="carac-box-ext">
                <label><strong>REFLEJOS</strong></label>
                    <button type="roll"
                        value="/r {3d10dh1}kh1 + @{Reflejos_EXT}+@{REFLEJOS_EXT_BONUS}"></button>
                    <input type="number" name="attr_REFLEJOS_EXT" value="(@{REFLEJOS}+@{REFLEJOS_EXT_BONUS})" disabled>
                    <input type="number" name="attr_REFLEJOS_EXT_BONUS" value="0">
                    <input name="attr_REFLEJOS_hito_EXT" type="text">
                </div>

                <div class="carac-box-ext">
                <label><strong>INTELECTO</strong></label>
                    <button type="roll"
                        value="/r {3d10dh1}kh1 + @{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}"></button>
                    <input type="number" name="attr_INTELECTO_EXT" value="(@{INTELECTO}+@{INTELECTO_EXT_BONUS})" disabled>
                    <input type="number" name="attr_INTELECTO_EXT_BONUS" value="0">
                    <input name="attr_INTELECTO_hito_EXT" type="text">
                </div>
        </div>
    </div>

    <!-- HABILIDADES (ÉXTASIS) -->
    <div class="sheet-section-aspects sheet-section">
        <div class="sheet-header">HABILIDADES (ÉXTASIS)</div>
        <div class="habilidades-grid">

        <!-- Fila 1 -->
            <div class="hab-box-ext">
            <label><strong>FORMA FÍSICA</strong></label>
            <button type="roll" 
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{FORMA_FÍSICA}+@{FORMA_FÍSICA_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_FORMA_FÍSICA_EXT" type=number value=" @{FORMA_FÍSICA}+@{FORMA_FÍSICA_EXT_BONUS}" disabled>
                <input name="attr_FORMA_FÍSICA_EXT_BONUS" type="number" value="0">
                <input name="attr_FORMA_FÍSICA_hito1_EXT" type="text">
                <input name="attr_FORMA_FÍSICA_hito2_EXT" type="text">
            </div>

            <div class="hab-box-ext">
            <label><strong>PERCEPCIÓN</strong></label>
            <button type="roll" 
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{PERCEPCIÓN}+@{PERCEPCIÓN_EXT_BONUS} + ?{Modificador|0}"></button>


                <input name="attr_PERCEPCIÓN_EXT" type=number value=" @{PERCEPCIÓN}+@{PERCEPCIÓN_EXT_BONUS}"  disabled>
                <input name="attr_PERCEPCIÓN_EXT_BONUS" type="number" value="0">
                <input  name="attr_PERCEPCIÓN_hito1_EXT" type="text">
                <input  name="attr_PERCEPCIÓN_hito2_EXT" type="text">
            </div>

        <!-- Fila 2 -->
            <div class="hab-box-ext">
            <label><strong>COMBATE</strong></label>
            <button type="roll"
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{COMBATE}+@{COMBATE_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_COMBATE_EXT" type=number value=" @{COMBATE}+@{COMBATE_EXT_BONUS}"  disabled>
                <input name="attr_COMBATE_EXT_BONUS" type="number" value="0">
                <input  name="attr_COMBATE_hito1_EXT" type="text">
                <input  name="attr_COMBATE_hito2_EXT" type="text">
            </div>

            <div class="hab-box-ext">
            <label><strong>SUBTERFUGIO</strong></label>
            <button type="roll" 
             value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{SUBTERFUGIO}+@{SUBTERFUGIO_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_SUBTERFUGIO_EXT" type=number value=" @{SUBTERFUGIO}+@{SUBTERFUGIO_EXT_BONUS}"  disabled>
                <input name="attr_SUBTERFUGIO_EXT_BONUS" type="number" value="0">
                <input name="attr_SUBTERFUGIO_hito1_EXT" type="text">
                <input name="attr_SUBTERFUGIO_hito2_EXT" type="text">
            </div>

        <!-- Fila 3 -->
            <div class="hab-box-ext">
            <label><strong>COMUNICACIÓN</strong></label>
            <button type="roll" 
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{COMUNICACIÓN}+@{COMUNICACIÓN_EXT_BONUS} + ?{Modificador|0}"></button>
            
                <input name="attr_COMUNICACIÓN_EXT" type=number value=" @{COMUNICACIÓN}+@{COMUNICACIÓN_EXT_BONUS}"  disabled>
                <input name="attr_COMUNICACIÓN_EXT_BONUS" type="number" value="0">
                <input  name="attr_COMUNICACIÓN_hito1_EXT" type="text">
                <input  name="attr_COMUNICACIÓN_hito2_EXT" type="text">
            </div>

            <div class="hab-box-ext">
            <label><strong>CULTURA</strong></label>
            <button type="roll" 
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{CULTURA}+@{CULTURA_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_CULTURA_EXT" type=number value=" @{CULTURA}+@{CULTURA_EXT_BONUS}"  disabled>
                <input name="attr_CULTURA_EXT_BONUS"  type="number" value="0">
                <input  name="attr_CULTURA_hito1_EXT" type="text">
                <input  name="attr_CULTURA_hito2_EXT" type="text">
            </div>

        <!-- Fila 4 -->
            <div class="hab-box-ext">
            <label><strong>G. EMOCIONAL</strong></label>
            <button type="roll"   
            value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{GESTION_EMOCIONAL}+@{GESTION_EMOCIONAL_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_GESTION_EMOCIONAL_EXT" type=number value=" @{GESTION_EMOCIONAL}+@{GESTION_EMOCIONAL_EXT_BONUS}"  disabled>
                <input name="attr_GESTION_EMOCIONAL_EXT_BONUS" type="number" value="0">
                <input  name="attr_GESTION_EMOCIONAL_hito1_EXT" type="text">
                <input  name="attr_GESTION_EMOCIONAL_hito2_EXT" type="text">
            </div>

            <div class="hab-box-ext">
            <label><strong>OCULTISMO</strong></label>
            <button type="roll"   value="/r {3d10dh1}kh1 + ?{Elige característica| Fortaleza,@{FORTALEZA_EXT}+@{FORTALEZA_EXT_BONUS}| Voluntad,@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS}| Reflejos,@{REFLEJOS_EXT}+@{REFLEJOS_EXT_BONUS}| 
            Intelecto,@{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}}+ @{OCULTISMO}+@{OCULTISMO_EXT_BONUS} + ?{Modificador|0}"></button>

                <input name="attr_OCULTISMO_EXT" type=number value=" @{OCULTISMO}+@{OCULTISMO_EXT_BONUS}"  disabled>
                <input name="attr_OCULTISMO_EXT_BONUS" type="number" value="0">
                <input  name="attr_OCULTISMO_hito1_EXT" type="text">
                <input  name="attr_OCULTISMO_hito2_EXT" type="text">
            </div>
        </div>
</div>

    <!-- LAZOS + DIFICULTAD + ARCANO -->
    <div class="contenedor-lazos-notas">

        <!-- Columna 1 — Lazos -->
        <div class="arcana-section">
            <div class="sheet-header">LAZOS (ÉXTASIS)</div>
            
            <div class="lazos-grid">
            
              <div class="lazos-head">
                <div>NOMBRE</div>
                <div>LAZO</div>
                <div>MEDIO</div>
                <div>MAYOR</div>
                <div>CRÍTICO</div>
                <div>⚓</div>
              </div>
            
              <!-- 1 -->
              <div class="lazos-row">
                <div><input type="text" name="attr_lazo_extasis"></div>
                <div><input type="number" name="attr_lazo_extasis1"></div>
                <div><input type="number" name="attr_lazo_extasis2" value="round(@{lazo_extasis1}/2)" disabled></div>
                <div><input type="number" name="attr_lazo_extasis3" value="@{lazo_extasis1}" disabled></div>
                <div><input type="number" name="attr_lazo_extasis4" value="(@{lazo_extasis1}*2)" disabled></div>
                <div class="ancla"><input type="checkbox" name="attr_lazo_ancla_extasis"></div>
              </div>
            </div>


            <!-- DIFICULTADES -->
            <div class="tabla-dificultad-extasis">
                <div class="sheet-header" style="text-align:center; margin-bottom:6px;">
                    DIFICULTADES
                </div>

                <!-- DIFICULTADES -->
                <div class="dificultad-grid">
                
                  <div class="dificultad-head">
                    <div>Dificultad</div>
                    <div>Valor</div>
                  </div>
                
                  <div class="dificultad-row">
                    <div>Fácil</div>
                    <div class="num">10</div>
                  </div>
                
                  <div class="dificultad-row">
                    <div>Media</div>
                    <div class="num">15</div>
                  </div>
                
                  <div class="dificultad-row">
                    <div>Difícil</div>
                    <div class="num">20</div>
                  </div>
                
                  <div class="dificultad-row">
                    <div>Casi imposible</div>
                    <div class="num">30</div>
                  </div>
                  
                    <div class="dificultad-row">
                    <div>Sobre Natural</div>
                    <div class="num">35</div>
                  </div>

                </div>

            </div>
        </div> <!-- FIN Columna 1 -->

        <!-- Columna 2 — Arcano -->
        <div class="arcana-section">
            <div class="sheet-header">HABILIDADES ARCANAS</div>

<div class="arcana-grid">

    <!-- INNATA -->
                <div class="arcana-section">
                    <h4 class="arcana-title">INNATA</h4>
            
                    <div class="arcana-row">
                        <div>
                            <input type="text" name="attr_arcana_innata_1" placeholder="Habilidad Innata">
                        </div>
                        <div class="roll">
                            <button type="roll"
                                value="/r {3d10dh1}kh1 + (@{VOLUNTAD_EXT}+@{VOLUNTAD_EXT_BONUS})+ @{arcana_innata} + ?{Modificador|0}">
                            </button>
                        </div>
                        <div>
                            <input type="number" name="attr_arcana_innata" value="0">
                        </div>
                    </div>
                </div>
            
                <!-- APRENDIDA -->
                <div class="arcana-section">
                    <h4 class="arcana-title">APRENDIDA</h4>
            
                    <div class="arcana-row">
                        <div>
                            <input type="text" name="attr_arcana_aprendida_1" placeholder="Habilidad Aprendida">
                        </div>
                        <div class="roll">
                            <button type="roll"
                                value="/r {3d10dh1}kh1 + @{INTELECTO_EXT} + @{INTELECTO_EXT_BONUS}+ @{arcana_aprendida_valor_1} + ?{Modificador|0}">
                            </button>
                        </div>
                        <div>
                            <input type="number" name="attr_arcana_aprendida_valor_1" value="0">
                        </div>
                    </div>
            
                    <div class="arcana-row">
                        <div><input type="text" name="attr_arcana_aprendida_2"></div>
                        <div class="roll">
                            <button type="roll"
                                value="/r {3d10dh1}kh1 + @{INTELECTO_EXT} + @{INTELECTO_EXT_BONUS} + @{arcana_aprendida_valor_2} + ?{Modificador|0}">
                            </button>
                        </div>
                        <div><input type="number" name="attr_arcana_aprendida_valor_2" value="0"></div>
                    </div>
            
                    <div class="arcana-row">
                        <div><input type="text" name="attr_arcana_aprendida_3"></div>
                        <div class="roll">
                            <button type="roll"
                                value="/r {3d10dh1}kh1 + @{INTELECTO_EXT} + @{INTELECTO_EXT_BONUS} + @{arcana_aprendida_valor_3} + ?{Modificador|0}">
                            </button>
                        </div>
                        <div><input type="number" name="attr_arcana_aprendida_valor_3" value="0"></div>
                    </div>
            
                    <div class="arcana-row">
                        <div><input type="text" name="attr_arcana_aprendida_4"></div>
                        <div class="roll">
                            <button type="roll"
                                value="/r {3d10dh1}kh1 + @{INTELECTO_EXT}+@{INTELECTO_EXT_BONUS}+ @{arcana_aprendida_valor_4} + ?{Modificador|0}">
                            </button>
                        </div>
                        <div><input type="number" name="attr_arcana_aprendida_valor_4" value="0"></div>
                    </div>
                </div>
            
            </div>

        </div> <!-- FIN Columna 2 -->
    </div> <!-- FIN TAB 2 -->
</div>

<script type="text/worker">
/* ===== util ===== */
const toInt = v => parseInt(v,10) || 0;

/* ===== sincronizar atributos básicos HUMANO -> ÉXTASIS ===== */
on("change:FORTALEZA change:VOLUNTAD change:REFLEJOS change:INTELECTO", () => {
    getAttrs(["FORTALEZA","VOLUNTAD","REFLEJOS","INTELECTO"], v => {
        setAttrs({
            FORTALEZA_EXT: toInt(v.FORTALEZA),
            VOLUNTAD_EXT : toInt(v.VOLUNTAD),
            REFLEJOS_EXT : toInt(v.REFLEJOS),
            INTELECTO_EXT: toInt(v.INTELECTO)
        });
    });
});

/* ===== sincronizar habilidades HUMANO -> ÉXTASIS ===== */
[
 "FORMA_FISICA","PERCEPCION","COMBATE","SUBTERFUGIO",
 "COMUNICACION","CULTURA","GESTION_EMOCIONAL","OCULTISMO"
].forEach(hab => {
    on(`change:${hab}`, () => {
        getAttrs([hab], v => {
            setAttrs({ [`${hab}_EXT`]: toInt(v[hab]) });
        });
    });
});



/* ===== Umbral de Herida y Resistencia ===== */
const calcUmbral = (vol, fort) => Math.floor(toInt(vol)/2) + toInt(fort);
const calcRes    = agu => toInt(agu) * 3;

[
 ["VOLUNTAD","FORTALEZA","aguante"],
 ["VOLUNTAD_EXT","FORTALEZA_EXT","aguante_EXT"]
].forEach(([vol, fort, out]) => {
    on(`change:${vol} change:${fort}`, () => {
        getAttrs([vol,fort], v => {
            setAttrs({ [out]: calcUmbral(v[vol], v[fort]) });
        });
    });
});

[
 ["aguante","RESISTENCIA_max"],
 ["aguante_EXT","RESISTENCIA_EXT_max"]
].forEach(([src, out]) => {
    on(`change:${src}`, () => {
        getAttrs([src], v => {
            setAttrs({ [out]: calcRes(v[src]) });
        });
    });
});

/* ===== Daños CaC y a Distancia ===== */
const calcDanioCaC  = (fort, comb) => Math.floor((toInt(fort)+toInt(comb))/4);
const calcDanioDist = comb           => Math.floor(toInt(comb)/4);

[
 ["FORTALEZA","COMBATE","DAÑOCaC"],
 ["FORTALEZA_EXT","COMBATE_EXT","DAÑOCaC_EXT"]
].forEach(([fort, comb, out]) => {
    on(`change:${fort} change:${comb}`, () => {
        getAttrs([fort,comb], v => {
            setAttrs({ [out]: calcDanioCaC(v[fort], v[comb]) });
        });
    });
});

[
 ["COMBATE","DAÑODIS"],
 ["COMBATE_EXT","DAÑODIS_EXT"]
].forEach(([comb, out]) => {
    on(`change:${comb}`, () => {
        getAttrs([comb], v => {
            setAttrs({ [out]: calcDanioDist(v[comb]) });
        });
    });
});


/* ===== AUTOFILL LAZOS (ÉXTASIS) DESDE EL LAZO ANCLADO ===== */

const lazoFields = [
    1,2,3,4,5,6,7,8,9,10
];

// Escuchar cambios en cualquiera de los checkboxes attr_lazo_anclaN
lazoFields.forEach(num => {
    on(`change:lazo_ancla${num} change:lazo_base${num} change:lazo_medio${num} change:lazo_mayor${num} change:lazo_critico${num} change:lazo_nombre${num}`, () => {

        // Buscar cuál está marcado
        getAttrs([
            ...lazoFields.map(n => `lazo_ancla${n}`),
            ...lazoFields.map(n => `lazo_nombre${n}`),
            ...lazoFields.map(n => `lazo_base${n}`),
            ...lazoFields.map(n => `lazo_medio${n}`),
            ...lazoFields.map(n => `lazo_mayor${n}`),
            ...lazoFields.map(n => `lazo_critico${n}`)
        ], values => {

            // Encontrar el número que tiene el checkbox a "on"
            let activo = null;
            lazoFields.forEach(n => {
                if (values[`lazo_ancla${n}`] === "on") activo = n;
            });

            if (activo) {
                // Copiar valores del lazo activo hacia la sección de Éxtasis
                setAttrs({
                    lazo_extasis:   values[`lazo_nombre${activo}`],
                    lazo_extasis1:  values[`lazo_base${activo}`],
                    lazo_extasis2:  values[`lazo_medio${activo}`],
                    lazo_extasis3:  values[`lazo_mayor${activo}`],
                    lazo_extasis4:  values[`lazo_critico${activo}`]
                });
            } else {
                // Si no hay ninguno marcado → limpiar la sección de Éxtasis
                setAttrs({
                    lazo_extasis:   "",
                    lazo_extasis1:  "",
                    lazo_extasis2:  "",
                    lazo_extasis3:  "",
                    lazo_extasis4:  ""
                });
            }
        });
    });
});

</script>

