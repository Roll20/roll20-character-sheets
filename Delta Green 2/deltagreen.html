
<input name="attr_version" type="hidden" value="1.99"/>
<!--mixin multiCheckbox(attr, num)
- let i = 0;
while i < num
	label.styled-checkbox(data-i18n-title=attr + ' ' + ++i title=attr + ' ' + i)
		input(name='attr_' + attr + '_' + i title='@{' + attr + '_'+i+'}' type='checkbox' value='on')
input(type='hidden' name='attr_' + attr + '_adapted' value=0)


-->
<input name="attr_initial_san" type="hidden" value="1"/>
<input name="attr_initial_con" type="hidden" value="1"/>
<input name="attr_initial_str" type="hidden" value="1"/>
<input name="attr_initial_hp" type="hidden" value="1"/>
<input name="attr_sanity_points_old" type="hidden" value="0"/>
<input name="attr_breaking_point_old" type="hidden" value="0"/>
<!--TABS & LOGO-->
<!-- =============================-->
<div class="datahide">
  <input data-i18n-value="accounting" name="attr_accounting_name" value="accounting"/>
  <input data-i18n-value="alertness" name="attr_alertness_name" value="alertness"/>
  <input data-i18n-value="anthropology" name="attr_anthropology_name" value="anthropology"/>
  <input data-i18n-value="archeology" name="attr_archeology_name" value="archeology"/>
  <input data-i18n-value="art" name="attr_art_name" value="art"/>
  <input data-i18n-value="artillery" name="attr_artillery_name" value="artillery"/>
  <input data-i18n-value="athletics" name="attr_athletics_name" value="athletics"/>
  <input data-i18n-value="bureaucracy" name="attr_bureaucracy_name" value="bureaucracy"/>
  <input data-i18n-value="computer science" name="attr_computer_science_name" value="computer science"/>
  <input data-i18n-value="craft" name="attr_craft_name" value="craft"/>
  <input data-i18n-value="criminology" name="attr_criminology_name" value="criminology"/>
  <input data-i18n-value="demolitions" name="attr_demolitions_name" value="demolitions"/>
  <input data-i18n-value="disguise" name="attr_disguise_name" value="disguise"/>
  <input data-i18n-value="dodge" name="attr_dodge_name" value="dodge"/>
  <input data-i18n-value="drive" name="attr_drive_name" value="drive"/>
  <input data-i18n-value="firearms" name="attr_firearms_name" value="firearms"/>
  <input data-i18n-value="first aid" name="attr_first_aid_name" value="first aid"/>
  <input data-i18n-value="forensics" name="attr_forensics_name" value="forensics"/>
  <input data-i18n-value="heavy machinery" name="attr_heavy_machinery_name" value="heavy machinery"/>
  <input data-i18n-value="heavy weapons" name="attr_heavy_weapons_name" value="heavy weapons"/>
  <input data-i18n-value="history" name="attr_history_name" value="history"/>
  <input data-i18n-value="humint" name="attr_humint_name" value="humint"/>
  <input data-i18n-value="law" name="attr_law_name" value="law"/>
  <input data-i18n-value="medicine" name="attr_medicine_name" value="medicine"/>
  <input data-i18n-value="melee weapons" name="attr_melee_weapons_name" value="melee weapons"/>
  <input data-i18n-value="military science" name="attr_military_science_name" value="military science"/>
  <input data-i18n-value="navigate" name="attr_navigate_name" value="navigate"/>
  <input data-i18n-value="occult" name="attr_occult_name" value="occult"/>
  <input data-i18n-value="persuade" name="attr_persuade_name" value="persuade"/>
  <input data-i18n-value="pharmacy" name="attr_pharmacy_name" value="pharmacy"/>
  <input data-i18n-value="pilot" name="attr_pilot_name" value="pilot"/>
  <input data-i18n-value="psychotherapy" name="attr_psychotherapy_name" value="psychotherapy"/>
  <input data-i18n-value="ride" name="attr_ride_name" value="ride"/>
  <input data-i18n-value="science" name="attr_science_name" value="science"/>
  <input data-i18n-value="search" name="attr_search_name" value="search"/>
  <input data-i18n-value="sigint" name="attr_sigint_name" value="sigint"/>
  <input data-i18n-value="stealth" name="attr_stealth_name" value="stealth"/>
  <input data-i18n-value="surgery" name="attr_surgery_name" value="surgery"/>
  <input data-i18n-value="survival" name="attr_survival_name" value="survival"/>
  <input data-i18n-value="swim" name="attr_swim_name" value="swim"/>
  <input data-i18n-value="unarmed combat" name="attr_unarmed_combat_name" value="unarmed combat"/>
</div>
<datalist id="weaponskills">
  <option value="@{athletics}">athletics</option>
  <option value="@{demolitions}">demolitions</option>
  <option value="@{firearms}">firearms</option>
  <option value="@{heavy_weapons}">heavy weapons</option>
  <option value="@{melee_weapons}">melee weapons</option>
  <option value="@{unarmed_combat}">unarmed combat</option>
  <option value="@{drive}">drive</option>
  <option value="@{heavy_machinery}">heavy machinery</option>
  <option value="@{strength}">strength</option>
  <option value="@{dexterity}">dexterity</option>
</datalist>
<datalist id="allskills">
  <option value="@{accounting}">accounting</option>
  <option value="@{alertness}">alertness</option>
  <option value="@{anthropology}">anthropology</option>
  <option value="@{archeology}">archeology</option>
  <option value="@{artillery}">artillery</option>
  <option value="@{athletics}">athletics</option>
  <option value="@{bureaucracy}">bureaucracy</option>
  <option value="@{computer_science}">computer science</option>
  <option value="@{criminology}">criminology</option>
  <option value="@{demolitions}">demolitions</option>
  <option value="@{disguise}">disguise</option>
  <option value="@{dodge}">dodge</option>
  <option value="@{drive}">drive</option>
  <option value="@{firearms}">firearms</option>
  <option value="@{first_aid}">first aid</option>
  <option value="@{forensics}">forensics</option>
  <option value="@{heavy_machinery}">heavy machinery</option>
  <option value="@{heavy_weapons}">heavy weapons</option>
  <option value="@{history}">history</option>
  <option value="@{humint}">HUMINT</option>
  <option value="@{law}">law</option>
  <option value="@{medicine}">medicine</option>
  <option value="@{melee_weapons}">melee weapons</option>
  <option value="@{navigate}">navigate</option>
  <option value="@{occult}">occult</option>
  <option value="@{persuade}">persuade</option>
  <option value="@{pharmacy}">pharmacy</option>
  <option value="@{psychotherapy}">psychotherapy</option>
  <option value="@{ride}">ride</option>
  <option value="@{search}">search</option>
  <option value="@{sigint}">SIGINT</option>
  <option value="@{stealth}">stealth</option>
  <option value="@{surgery}">surgery</option>
  <option value="@{survival}">survival</option>
  <option value="@{swim}">swim</option>
  <option value="@{unarmed_combat}">unarmed combat</option>
  <option value="@{unnatural}">unnatural</option>
  <option value="@{strength}">strength</option>
  <option value="@{constitution}">constitution</option>
  <option value="@{dexterity}">dexterity</option>
  <option value="@{intelligence}">intelligence</option>
  <option value="@{power}">power</option>
  <option value="@{charisma}">charisma</option>
</datalist>
<datalist id="defensive-qualities">
  <option value="@{trascendent}">trascendent</option>
  <option value="@{out_of_phase}">out_of_phase</option>
  <option value="@{uncanny_matter}">uncanny_matter</option>
  <option value="@{persistent}">persistent</option>
  <option value="@{resilient}">resilient</option>
  <option value="@{huge}">huge</option>
  <option value="@{unnatural_biology}">unnatural_biology</option>
  <option value="@{armor}">armor</option>
</datalist>
<div class="compendium-drop-target">
  <!-- TABS-->
  <!-- =============================-->
  <div class="tabs grid">
    <!-- Buttons to toggle on GM whisper-->
    <div class="first"><span data-i18n-title="GM Whisper">GM Whisper</span>
      <label class="switch" data-i18-titlen="whisper rolls to gm" title="whisper rolls to gm">
        <input class="whisper-toggle" name="attr_gm_toggle" type="checkbox" value="/w gm"/><span class="slider"></span>
      </label>
    </div>
    <!-- LOGO--><img alt="Delta Green" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Delta%20Green%202/img/deltagreenlogo.jpg"/>
    <div class="last">
      <input class="settinggear" name="attr_mysettings" type="checkbox" value="settings"/><span></span>
    </div>
    <input class="setting_gear" type="hidden" name="attr_mysettings"/>
    <div class="grid navmenu"> 
      <input class="type" name="attr_sheet_type" type="hidden"/><a class="pc" href="#personal-data-pc" data-i18n="personal data">Personal Data </a><a class="pc" href="#statistical-data-pc" data-i18n="statistical data">Statistical Data</a><a class="pc" href="#psychological-data-pc" data-i18n="psychological data">Psychological Data</a><a class="pc" href="#applicable-skills-pc" data-i18n="applicable skill sets">Applicable Skill sets</a><a class="pc" href="#injuries-pc" data-i18n="injuries">Injuries</a><a class="pc" href="#equipment-pc" data-i18n="equipment">Equipment</a><a class="pc" href="#remarks-pc" data-i18n="remarks">Remarks</a><a class="npc" href="#personal-data-npc" data-i18n="personal data">Personal Data </a><a class="npc" href="#statistical-data-npc" data-i18n="statistical data">Statistical Data</a><a class="npc" href="#applicable-skills-npc" data-i18n="applicable skill sets">Applicable Skill sets</a><a class="npc" href="#equipment-npc" data-i18n="equipment">Equipment</a><a class="npc" href="#remarks-npc" data-i18n="remarks">Remarks</a>
    </div>
    <div class="grid empty"></div>
  </div>
  <!-- COMPENDIUM DATA-->
  <input name="attr_drop_name" type="hidden" accept="Name"/>
  <input name="attr_drop_data" type="hidden" accept="data"/>
  <!-- SETTINGS-->
  <input class="setting_gear" type="hidden" name="attr_mysettings"/>
  <div class="settings">
    <!-- SETTINGS-->
    <!-- =============================-->
    <div class="section-main border">
      <div class="section-title">General Settings</div>
      <div class="section-content threecolumns"> 
        <div class="section-item"> 
          <div class="radio">
            <label class="settingradio">Sheet Type</label><span>
              <input name="attr_sheet_type" type="radio" value="pc" checked="checked"/><span data-i18n-value="agent">agent</span></span><span>
              <input name="attr_sheet_type" type="radio" value="npc"/><span data-i18n-value="npc">NPC</span></span>
          </div>
        </div>
      </div>
      <div class="section-title">Modifiers</div>
      <div class="section-content threecolumns"> 
        <div class="section-item"> 
          <div class="radio">
            <label class="settingradio">Will Power Modifiers</label><span>
              <input name="attr_mod_will_power_check" type="radio" value="none" checked="checked"/><span data-i18n-value="none">none</span></span><span>
              <input name="attr_mod_will_power_check" type="radio" value="lowonly"/><span data-i18n-value="low will power" for="low_will_power">low will power</span></span><span>
              <input name="attr_mod_will_power_check" type="radio" value="all"/><span data-i18n-value="zero_will_power" for="zero_will_power">zero will power</span></span>
          </div>
          <input type="hidden" name="attr_zero_will_power" value="0"/>
          <input type="hidden" name="attr_low_will_power" value="0"/>
        </div>
        <div class="section-item">
          <div class="radio">
            <label class="settingradio">Combat Modifiers</label><span class="workinprogress">
              <input class="styled-checkbox" name="attr_aim_button" type="checkbox" value="active" id="aim_button" disabled="disabled"/><span data-i18n-value="aim" for="aim_button">Aim</span></span>
          </div>
        </div>
        <div class="section-item">
          <div class="radio">
            <label class="settingradio">Status Modifiers</label><span></span>
          </div>
        </div>
      </div>
      <div class="section-title">Automations </div>
      <div class="section-content threecolumns">
        <div class="section-item workinprogress"> 
          <input class="styled-checkbox" name="attr_allow_reaction" type="checkbox" value="active" id="allow_reaction" disabled="disabled"/><span data-i18n-value="allow reaction" for="allow_reaction">Allow Reaction</span>
        </div>
        <div class="section-item">
          <input class="styled-checkbox" name="attr_track_bullets" type="checkbox" value="active" id="track_bullets"/><span data-i18n-value="track bullets" for="track_bullets">Track Bullets</span>
        </div>
        <div class="section-item workinprogress">
          <input class="styled-checkbox" name="attr_track_disorder_triggers" type="checkbox" value="active" id="track_disorder_triggers" disabled="disabled"/><span data-i18n-value="track disorder triggers" for="track_disorder_triggers">Track Disorder Triggers</span>
        </div>
        <div class="section-item"> 
          <input class="styled-checkbox" name="attr_track_breaking_points" type="checkbox" value="active" id="track_breaking_points"/><span data-i18n-value="track breaking points" for="track_breaking_points">Track Breaking Points</span>
        </div>
      </div>
      <div class="section-title">Experimental </div>
      <div class="section-content threecolumns">
        <div class="section-item workinprogress">
          <input class="styled-checkbox" name="attr_use_new_motivation" type="checkbox" value="active" id="use_new_motivation" disabled="disabled"/><span data-i18n-value="use new motivation" for="use_new_motivation">Use New Motivation</span>
        </div>
        <div class="section-item">
          <input class="styled-checkbox" name="attr_advanced_weapons" type="checkbox" value="active" id="use_advanced_weapons"/><span data-i18n-value="use advanced weapons" for="use_advanced_weapons">Use Advanced Weapons</span>
        </div>
      </div>
    </div>
  </div>
  <div class="mainsheet">
    <input class="type" name="attr_sheet_type" type="hidden" value="pc"/>
    <input class="display_string" name="attr_toggles" type="hidden" value=""/>
    <!-- CHARACTER SHEETS-->
    <!-- NPC SHEET-->
    <!-- =============================-->
    <div class="npc">
      <div class="grid_npc div name-and-description border">
        <div class="header">
          <h1 class="grid__item_last" data-i18n="name and description">name and description</h1>
        </div>
        <div class="inner-grid inner-main">
          <div class="grid__item_last colheader">
            <h2 data-i18n="name:">name:</h2>
          </div>
          <div class="grid__item_last">
            <input data-i18n-placeholder="character name" name="attr_character_name" placeholder="Character name" title="@{name}" type="text"/>
          </div>
          <div class="grid__item_last colheader align_top">
            <h2 data-i18n="description:">description:</h2>
          </div>
          <div class="grid__item_last align_top"> 
            <textarea name="attr_npc_description" placeholder="description" title="@{npc_description}"></textarea>
          </div>
        </div>
      </div>
      <div class="grid_npc sources-of-information border">
        <div class="header"> 
          <h1 class="grid__item_last" data-i18n="sources of information">sources of information</h1>
        </div>
        <div class="right-grid">
          <textarea class="area" style="height:15rem;" name="attr_npc_sources" data-i18n-placeholder="sources of information" placeholder="sources of information"></textarea>
        </div>
      </div>
      <div class="grid_npc stat-data border">
        <div class="header stat-grid"> 
          <button class="link roll" type="action" name="attr_strength_r">
            <h1 class="grid__item">STR </h1>
          </button>
          <button class="link roll" type="action" name="attr_constitution_r">
            <h1 class="grid__item">CON </h1>
          </button>
          <button class="link roll" type="action" name="attr_dexterity_r">
            <h1 class="grid__item">DEX </h1>
          </button>
          <button class="link roll" type="action" name="attr_intelligence_r">
            <h1 class="grid__item">INT </h1>
          </button>
          <button class="link roll" type="action" name="attr_power_r">
            <h1 class="grid__item">POW </h1>
          </button>
          <button class="link roll" type="action" name="attr_charisma_r">
            <h1 class="grid__item">CHA </h1>
          </button>
          <h1 class="grid__item">HP </h1>
          <h1 class="grid__item_last">WP</h1>
          <button class="link roll" type="action" name="attr_sanity_points_r">
            <h1 class="grid__item">SAN </h1>
          </button>
          <h1 class="grid__item">BP </h1>
        </div>
        <div class="inner-main stat-grid">
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_strength_score" placeholder="-" title="@{STR}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_constitution_score" placeholder="-" title="@{CON}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_dexterity_score" placeholder="-" title="@{DEX}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_intelligence_score" placeholder="-" title="@{INT}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_power_score" placeholder="-" title="@{POW}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_charisma_score" placeholder="-" title="@{CHA}" type="text"/>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_hit_points" placeholder="-" title="@{HP}" type="text"/><span>/</span><span style="width:40%" name="attr_hit_points_max"></span>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_willpower_points" placeholder="-" title="@{WP}" type="text"/><span>/</span><span style="width:40%" name="attr_willpower_points_max"></span>
          </div>
          <div class="grid__item">
            <input data-i18n-placeholder="0" name="attr_sanity_points" placeholder="-" title="@{WP}" type="text"/><span>/</span><span style="width:40%" name="attr_sanity_points_max"></span>
          </div>
          <div class="grid__item_last">
            <input data-i18n-placeholder="0" name="attr_breaking_point" placeholder="-" title="@{WP}" type="text"/><span>/</span><span style="width:40%" name="attr_breaking_point_max"></span>
          </div>
        </div>
      </div>
      <div class="grid_npc armor-skills-abilities-other border">
        <div class="header">
          <h1 data-i18n="armor, skills,abilities, and other notes">"armor, skills,abilities, and other notes</h1>
        </div>
        <div class="inner-main">
          <h2 class="colon" data-i18n="skills">skills</h2>
          <h3 class="formatted" data-i18n="general">general</h3>
          <div class="skill-summary-container"> 
            <input class="visible" name="attr_accounting_visible" title="@{accounting_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_accounting_r" value="@{accounting_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="accounting">accounting</h3></span><span class="para" name="attr_accounting"></span></button>
                </div>
            <input class="visible" name="attr_alertness_visible" title="@{alertness_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_alertness_r" value="@{alertness_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="alertness">alertness</h3></span><span class="para" name="attr_alertness"></span></button>
                </div>
            <input class="visible" name="attr_anthropology_visible" title="@{anthropology_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_anthropology_r" value="@{anthropology_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="anthropology">anthropology</h3></span><span class="para" name="attr_anthropology"></span></button>
                </div>
            <input class="visible" name="attr_archeology_visible" title="@{archeology_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_archeology_r" value="@{archeology_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="archeology">archeology</h3></span><span class="para" name="attr_archeology"></span></button>
                </div>
            <input class="visible" name="attr_art_1_visible" title="@{art_1_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_art_1_r" value="@{art_1_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="art">art<span class="nbsp">:</span><span name="attr_art_1_name"></span></h3></span><span class="para" name="attr_art_1"></span></button>
                </div>
            <input class="visible" name="attr_art_2_visible" title="@{art_2_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_art_2_r" value="@{art_2_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="art">art<span class="nbsp">:</span><span name="attr_art_2_name"></span></h3></span><span class="para" name="attr_art_2"></span></button>
                </div>
            <input class="visible" name="attr_artillery_visible" title="@{artillery_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_artillery_r" value="@{artillery_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="artillery">artillery</h3></span><span class="para" name="attr_artillery"></span></button>
                </div>
            <input class="visible" name="attr_athletics_visible" title="@{athletics_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_athletics_r" value="@{athletics_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="athletics">athletics</h3></span><span class="para" name="attr_athletics"></span></button>
                </div>
            <input class="visible" name="attr_bureaucracy_visible" title="@{bureaucracy_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_bureaucracy_r" value="@{bureaucracy_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="bureaucracy">bureaucracy</h3></span><span class="para" name="attr_bureaucracy"></span></button>
                </div>
            <input class="visible" name="attr_computer_science_visible" title="@{computer_science_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_computer_science_r" value="@{computer_science_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="computer science">computer science</h3></span><span class="para" name="attr_computer_science"></span></button>
                </div>
            <input class="visible" name="attr_craft_1_visible" title="@{craft_1_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_craft_1_r" value="@{craft_1_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="craft">craft<span class="nbsp">:</span><span name="attr_craft_1_name"></span></h3></span><span class="para" name="attr_craft_1"></span></button>
                </div>
            <input class="visible" name="attr_craft_2_visible" title="@{craft_2_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_craft_2_r" value="@{craft_2_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="craft">craft<span class="nbsp">:</span><span name="attr_craft_2_name"></span></h3></span><span class="para" name="attr_craft_2"></span></button>
                </div>
            <input class="visible" name="attr_criminology_visible" title="@{criminology_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_criminology_r" value="@{criminology_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="criminology">criminology</h3></span><span class="para" name="attr_criminology"></span></button>
                </div>
            <input class="visible" name="attr_demolitions_visible" title="@{demolitions_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_demolitions_r" value="@{demolitions_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="demolitions">demolitions</h3></span><span class="para" name="attr_demolitions"></span></button>
                </div>
            <input class="visible" name="attr_disguise_visible" title="@{disguise_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_disguise_r" value="@{disguise_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="disguise">disguise</h3></span><span class="para" name="attr_disguise"></span></button>
                </div>
            <input class="visible" name="attr_dodge_visible" title="@{dodge_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_dodge_r" value="@{dodge_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="dodge">dodge</h3></span><span class="para" name="attr_dodge"></span></button>
                </div>
            <input class="visible" name="attr_drive_visible" title="@{drive_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_drive_r" value="@{drive_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="drive">drive</h3></span><span class="para" name="attr_drive"></span></button>
                </div>
            <input class="visible" name="attr_firearms_visible" title="@{firearms_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_firearms_r" value="@{firearms_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="firearms">firearms</h3></span><span class="para" name="attr_firearms"></span></button>
                </div>
            <input class="visible" name="attr_first_aid_visible" title="@{first_aid_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_first_aid_r" value="@{first_aid_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="first aid">first aid</h3></span><span class="para" name="attr_first_aid"></span></button>
                </div>
            <input class="visible" name="attr_forensics_visible" title="@{forensics_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_forensics_r" value="@{forensics_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="forensics">forensics</h3></span><span class="para" name="attr_forensics"></span></button>
                </div>
            <input class="visible" name="attr_heavy_machinery_visible" title="@{heavy_machinery_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_heavy_machinery_r" value="@{heavy_machinery_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="heavy machinery">heavy machinery</h3></span><span class="para" name="attr_heavy_machinery"></span></button>
                </div>
            <input class="visible" name="attr_heavy_weapons_visible" title="@{heavy_weapons_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_heavy_weapons_r" value="@{heavy_weapons_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="heavy weapons">heavy weapons</h3></span><span class="para" name="attr_heavy_weapons"></span></button>
                </div>
            <input class="visible" name="attr_history_visible" title="@{history_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_history_r" value="@{history_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="history">history</h3></span><span class="para" name="attr_history"></span></button>
                </div>
            <input class="visible" name="attr_humint_visible" title="@{humint_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_humint_r" value="@{humint_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="HUMINT">HUMINT</h3></span><span class="para" name="attr_humint"></span></button>
                </div>
            <input class="visible" name="attr_law_visible" title="@{law_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_law_r" value="@{law_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="law">law</h3></span><span class="para" name="attr_law"></span></button>
                </div>
            <input class="visible" name="attr_medicine_visible" title="@{medicine_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_medicine_r" value="@{medicine_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="medicine">medicine</h3></span><span class="para" name="attr_medicine"></span></button>
                </div>
            <input class="visible" name="attr_melee_weapons_visible" title="@{melee_weapons_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_melee_weapons_r" value="@{melee_weapons_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="melee weapons">melee weapons</h3></span><span class="para" name="attr_melee_weapons"></span></button>
                </div>
            <input class="visible" name="attr_military_science_1_visible" title="@{military_science_1_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_military_science_1_r" value="@{military_science_1_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="military science">military science<span class="nbsp">:</span><span name="attr_military_science_1_name"></span></h3></span><span class="para" name="attr_military_science_1"></span></button>
                </div>
            <input class="visible" name="attr_military_science_2_visible" title="@{military_science_2_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_military_science_2_r" value="@{military_science_2_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="military science">military science<span class="nbsp">:</span><span name="attr_military_science_2_name"></span></h3></span><span class="para" name="attr_military_science_2"></span></button>
                </div>
            <input class="visible" name="attr_navigate_visible" title="@{navigate_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_navigate_r" value="@{navigate_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="navigate">navigate</h3></span><span class="para" name="attr_navigate"></span></button>
                </div>
            <input class="visible" name="attr_occult_visible" title="@{occult_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_occult_r" value="@{occult_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="occult">occult</h3></span><span class="para" name="attr_occult"></span></button>
                </div>
            <input class="visible" name="attr_persuade_visible" title="@{persuade_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_persuade_r" value="@{persuade_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="persuade">persuade</h3></span><span class="para" name="attr_persuade"></span></button>
                </div>
            <input class="visible" name="attr_pharmacy_visible" title="@{pharmacy_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_pharmacy_r" value="@{pharmacy_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="pharmacy">pharmacy</h3></span><span class="para" name="attr_pharmacy"></span></button>
                </div>
            <input class="visible" name="attr_pilot_1_visible" title="@{pilot_1_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_pilot_1_r" value="@{pilot_1_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="pilot">pilot<span class="nbsp">:</span><span name="attr_pilot_1_name"></span></h3></span><span class="para" name="attr_pilot_1"></span></button>
                </div>
            <input class="visible" name="attr_pilot_2_visible" title="@{pilot_2_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_pilot_2_r" value="@{pilot_2_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="pilot">pilot<span class="nbsp">:</span><span name="attr_pilot_2_name"></span></h3></span><span class="para" name="attr_pilot_2"></span></button>
                </div>
            <input class="visible" name="attr_psychotherapy_visible" title="@{psychotherapy_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_psychotherapy_r" value="@{psychotherapy_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="psychotherapy">psychotherapy</h3></span><span class="para" name="attr_psychotherapy"></span></button>
                </div>
            <input class="visible" name="attr_ride_visible" title="@{ride_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_ride_r" value="@{ride_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="ride">ride</h3></span><span class="para" name="attr_ride"></span></button>
                </div>
            <input class="visible" name="attr_science_1_visible" title="@{science_1_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_science_1_r" value="@{science_1_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="science">science<span class="nbsp">:</span><span name="attr_science_1_name"></span></h3></span><span class="para" name="attr_science_1"></span></button>
                </div>
            <input class="visible" name="attr_science_2_visible" title="@{science_2_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_science_2_r" value="@{science_2_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="science">science<span class="nbsp">:</span><span name="attr_science_2_name"></span></h3></span><span class="para" name="attr_science_2"></span></button>
                </div>
            <input class="visible" name="attr_search_visible" title="@{search_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_search_r" value="@{search_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="search">search</h3></span><span class="para" name="attr_search"></span></button>
                </div>
            <input class="visible" name="attr_sigint_visible" title="@{sigint_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_sigint_r" value="@{sigint_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="SIGINT">SIGINT</h3></span><span class="para" name="attr_sigint"></span></button>
                </div>
            <input class="visible" name="attr_stealth_visible" title="@{stealth_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_stealth_r" value="@{stealth_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="stealth">stealth</h3></span><span class="para" name="attr_stealth"></span></button>
                </div>
            <input class="visible" name="attr_surgery_visible" title="@{surgery_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_surgery_r" value="@{surgery_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="surgery">surgery</h3></span><span class="para" name="attr_surgery"></span></button>
                </div>
            <input class="visible" name="attr_survival_visible" title="@{survival_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_survival_r" value="@{survival_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="survival">survival</h3></span><span class="para" name="attr_survival"></span></button>
                </div>
            <input class="visible" name="attr_swim_visible" title="@{swim_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_swim_r" value="@{swim_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="swim">swim</h3></span><span class="para" name="attr_swim"></span></button>
                </div>
            <input class="visible" name="attr_unarmed_combat_visible" title="@{unarmed_combat_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_unarmed_combat_r" value="@{unarmed_combat_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="unarmed combat">unarmed combat</h3></span><span class="para" name="attr_unarmed_combat"></span></button>
                </div>
            <input class="visible" name="attr_unnatural_visible" title="@{unnatural_visible}" type="hidden"/>
                <div class="buttonwrapper">
                  <button class="roll two inSkills" type="action" name="attr_unnatural_r" value="@{unnatural_action}">	<span class="title">
                      <h3 class="aligned-left" data-i18n-title="unnatural">unnatural</h3></span><span class="para" name="attr_unnatural"></span></button>
                </div>
          </div>
          <h3 class="formatted" data-i18n="extra">extra</h3>
          <div class="skill-summary-repeat">
            <fieldset class="repeating_skills">
              <div class="buttonwrapper_rep">
                    <div class="buttonwrapper"> 
                      <button class="repeating_roll two inSkills" type="action" name="attr_skill_r" value="@{skill_action}"><span class="title">
                          <h3 class="aligned-left"><span name="attr_name"></span></h3></span><span class="para" name="attr_rank"></span></button>
                    </div>
              </div>
            </fieldset>
          </div>
          <details class="arrow">
            <summary class="allskills" data-i18n="all skills">all skills </summary>
            <div class="skill-container">
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="accounting fail checkbox" title="accounting fail checkbox">
                    <input class="isvisible" name="attr_accounting_visible" title="@{accounting_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_accounting_r" value="@{accounting_action}">	
                      <h3 class="aligned-left" data-i18n-title="accounting">accounting</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_accounting" value="@{accounting_action}">	</button>
                    <button class="none" type="action" name="act_accounting-action"> </button>
                    <input type="hidden" name="attr_accounting_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="accounting rank" title="accounting rank">
                  <input data-i18n-placeholder="0" name="attr_accounting" title="@{accounting}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="alertness fail checkbox" title="alertness fail checkbox">
                    <input class="isvisible" name="attr_alertness_visible" title="@{alertness_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_alertness_r" value="@{alertness_action}">	
                      <h3 class="aligned-left" data-i18n-title="alertness">alertness</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_alertness" value="@{alertness_action}">	</button>
                    <button class="none" type="action" name="act_alertness-action"> </button>
                    <input type="hidden" name="attr_alertness_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="alertness rank" title="alertness rank">
                  <input data-i18n-placeholder="0" name="attr_alertness" title="@{alertness}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="anthropology fail checkbox" title="anthropology fail checkbox">
                    <input class="isvisible" name="attr_anthropology_visible" title="@{anthropology_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_anthropology_r" value="@{anthropology_action}">	
                      <h3 class="aligned-left" data-i18n-title="anthropology">anthropology</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_anthropology" value="@{anthropology_action}">	</button>
                    <button class="none" type="action" name="act_anthropology-action"> </button>
                    <input type="hidden" name="attr_anthropology_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="anthropology rank" title="anthropology rank">
                  <input data-i18n-placeholder="0" name="attr_anthropology" title="@{anthropology}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="archeology fail checkbox" title="archeology fail checkbox">
                    <input class="isvisible" name="attr_archeology_visible" title="@{archeology_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_archeology_r" value="@{archeology_action}">	
                      <h3 class="aligned-left" data-i18n-title="archeology">archeology</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_archeology" value="@{archeology_action}">	</button>
                    <button class="none" type="action" name="act_archeology-action"> </button>
                    <input type="hidden" name="attr_archeology_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="archeology rank" title="archeology rank">
                  <input data-i18n-placeholder="0" name="attr_archeology" title="@{archeology}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="art fail checkbox" title="art fail checkbox">
                    <input class="isvisible" name="attr_art_1_visible" title="@{art_1_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_art_1_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="art" title="art">art</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_art_1_name" title="@{art_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_art_1_r" value="@{art_1_action}">	
                            <h3 class="aligned-left"><span title="art">art</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_art_1_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_art_1" value="@{art_1_action}">	</button>
                          <button class="none" type="action" name="act_art_1-action"> </button>
                          <input type="hidden" name="attr_art_1_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_art_1_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="art rank" title="art rank">
                  <input data-i18n-placeholder="0" name="attr_art_1" title="@{art_1}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="art fail checkbox" title="art fail checkbox">
                    <input class="isvisible" name="attr_art_2_visible" title="@{art_2_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_art_2_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="art" title="art">art</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_art_2_name" title="@{art_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_art_2_r" value="@{art_2_action}">	
                            <h3 class="aligned-left"><span title="art">art</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_art_2_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_art_2" value="@{art_2_action}">	</button>
                          <button class="none" type="action" name="act_art_2-action"> </button>
                          <input type="hidden" name="attr_art_2_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_art_2_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="art rank" title="art rank">
                  <input data-i18n-placeholder="0" name="attr_art_2" title="@{art_2}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="artillery fail checkbox" title="artillery fail checkbox">
                    <input class="isvisible" name="attr_artillery_visible" title="@{artillery_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_artillery_r" value="@{artillery_action}">	
                      <h3 class="aligned-left" data-i18n-title="artillery">artillery</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_artillery" value="@{artillery_action}">	</button>
                    <button class="none" type="action" name="act_artillery-action"> </button>
                    <input type="hidden" name="attr_artillery_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="artillery rank" title="artillery rank">
                  <input data-i18n-placeholder="0" name="attr_artillery" title="@{artillery}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="athletics fail checkbox" title="athletics fail checkbox">
                    <input class="isvisible" name="attr_athletics_visible" title="@{athletics_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_athletics_r" value="@{athletics_action}">	
                      <h3 class="aligned-left" data-i18n-title="athletics">athletics</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_athletics" value="@{athletics_action}">	</button>
                    <button class="none" type="action" name="act_athletics-action"> </button>
                    <input type="hidden" name="attr_athletics_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="athletics rank" title="athletics rank">
                  <input data-i18n-placeholder="0" name="attr_athletics" title="@{athletics}" placeholder="0" type="text" value="30"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="bureaucracy fail checkbox" title="bureaucracy fail checkbox">
                    <input class="isvisible" name="attr_bureaucracy_visible" title="@{bureaucracy_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_bureaucracy_r" value="@{bureaucracy_action}">	
                      <h3 class="aligned-left" data-i18n-title="bureaucracy">bureaucracy</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_bureaucracy" value="@{bureaucracy_action}">	</button>
                    <button class="none" type="action" name="act_bureaucracy-action"> </button>
                    <input type="hidden" name="attr_bureaucracy_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="bureaucracy rank" title="bureaucracy rank">
                  <input data-i18n-placeholder="0" name="attr_bureaucracy" title="@{bureaucracy}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="computer science fail checkbox" title="computer science fail checkbox">
                    <input class="isvisible" name="attr_computer_science_visible" title="@{computer_science_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_computer_science_r" value="@{computer_science_action}">	
                      <h3 class="aligned-left" data-i18n-title="computer science">computer science</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_computer_science" value="@{computer_science_action}">	</button>
                    <button class="none" type="action" name="act_computer_science-action"> </button>
                    <input type="hidden" name="attr_computer_science_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="computer science rank" title="computer science rank">
                  <input data-i18n-placeholder="0" name="attr_computer_science" title="@{computer_science}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="craft fail checkbox" title="craft fail checkbox">
                    <input class="isvisible" name="attr_craft_1_visible" title="@{craft_1_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_craft_1_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="craft" title="craft">craft</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_craft_1_name" title="@{craft_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_craft_1_r" value="@{craft_1_action}">	
                            <h3 class="aligned-left"><span title="craft">craft</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_craft_1_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_craft_1" value="@{craft_1_action}">	</button>
                          <button class="none" type="action" name="act_craft_1-action"> </button>
                          <input type="hidden" name="attr_craft_1_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_craft_1_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="craft rank" title="craft rank">
                  <input data-i18n-placeholder="0" name="attr_craft_1" title="@{craft_1}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="craft fail checkbox" title="craft fail checkbox">
                    <input class="isvisible" name="attr_craft_2_visible" title="@{craft_2_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_craft_2_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="craft" title="craft">craft</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_craft_2_name" title="@{craft_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_craft_2_r" value="@{craft_2_action}">	
                            <h3 class="aligned-left"><span title="craft">craft</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_craft_2_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_craft_2" value="@{craft_2_action}">	</button>
                          <button class="none" type="action" name="act_craft_2-action"> </button>
                          <input type="hidden" name="attr_craft_2_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_craft_2_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="craft rank" title="craft rank">
                  <input data-i18n-placeholder="0" name="attr_craft_2" title="@{craft_2}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="criminology fail checkbox" title="criminology fail checkbox">
                    <input class="isvisible" name="attr_criminology_visible" title="@{criminology_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_criminology_r" value="@{criminology_action}">	
                      <h3 class="aligned-left" data-i18n-title="criminology">criminology</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_criminology" value="@{criminology_action}">	</button>
                    <button class="none" type="action" name="act_criminology-action"> </button>
                    <input type="hidden" name="attr_criminology_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="criminology rank" title="criminology rank">
                  <input data-i18n-placeholder="0" name="attr_criminology" title="@{criminology}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="demolitions fail checkbox" title="demolitions fail checkbox">
                    <input class="isvisible" name="attr_demolitions_visible" title="@{demolitions_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_demolitions_r" value="@{demolitions_action}">	
                      <h3 class="aligned-left" data-i18n-title="demolitions">demolitions</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_demolitions" value="@{demolitions_action}">	</button>
                    <button class="none" type="action" name="act_demolitions-action"> </button>
                    <input type="hidden" name="attr_demolitions_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="demolitions rank" title="demolitions rank">
                  <input data-i18n-placeholder="0" name="attr_demolitions" title="@{demolitions}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="disguise fail checkbox" title="disguise fail checkbox">
                    <input class="isvisible" name="attr_disguise_visible" title="@{disguise_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_disguise_r" value="@{disguise_action}">	
                      <h3 class="aligned-left" data-i18n-title="disguise">disguise</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_disguise" value="@{disguise_action}">	</button>
                    <button class="none" type="action" name="act_disguise-action"> </button>
                    <input type="hidden" name="attr_disguise_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="disguise rank" title="disguise rank">
                  <input data-i18n-placeholder="0" name="attr_disguise" title="@{disguise}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="dodge fail checkbox" title="dodge fail checkbox">
                    <input class="isvisible" name="attr_dodge_visible" title="@{dodge_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_dodge_r" value="@{dodge_action}">	
                      <h3 class="aligned-left" data-i18n-title="dodge">dodge</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_dodge" value="@{dodge_action}">	</button>
                    <button class="none" type="action" name="act_dodge-action"> </button>
                    <input type="hidden" name="attr_dodge_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="dodge rank" title="dodge rank">
                  <input data-i18n-placeholder="0" name="attr_dodge" title="@{dodge}" placeholder="0" type="text" value="30"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="drive fail checkbox" title="drive fail checkbox">
                    <input class="isvisible" name="attr_drive_visible" title="@{drive_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_drive_r" value="@{drive_action}">	
                      <h3 class="aligned-left" data-i18n-title="drive">drive</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_drive" value="@{drive_action}">	</button>
                    <button class="none" type="action" name="act_drive-action"> </button>
                    <input type="hidden" name="attr_drive_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="drive rank" title="drive rank">
                  <input data-i18n-placeholder="0" name="attr_drive" title="@{drive}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="firearms fail checkbox" title="firearms fail checkbox">
                    <input class="isvisible" name="attr_firearms_visible" title="@{firearms_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_firearms_r" value="@{firearms_action}">	
                      <h3 class="aligned-left" data-i18n-title="firearms">firearms</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_firearms" value="@{firearms_action}">	</button>
                    <button class="none" type="action" name="act_firearms-action"> </button>
                    <input type="hidden" name="attr_firearms_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="firearms rank" title="firearms rank">
                  <input data-i18n-placeholder="0" name="attr_firearms" title="@{firearms}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="first aid fail checkbox" title="first aid fail checkbox">
                    <input class="isvisible" name="attr_first_aid_visible" title="@{first_aid_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_first_aid_r" value="@{first_aid_action}">	
                      <h3 class="aligned-left" data-i18n-title="first aid">first aid</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_first_aid" value="@{first_aid_action}">	</button>
                    <button class="none" type="action" name="act_first_aid-action"> </button>
                    <input type="hidden" name="attr_first_aid_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="first aid rank" title="first aid rank">
                  <input data-i18n-placeholder="0" name="attr_first_aid" title="@{first_aid}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="forensics fail checkbox" title="forensics fail checkbox">
                    <input class="isvisible" name="attr_forensics_visible" title="@{forensics_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_forensics_r" value="@{forensics_action}">	
                      <h3 class="aligned-left" data-i18n-title="forensics">forensics</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_forensics" value="@{forensics_action}">	</button>
                    <button class="none" type="action" name="act_forensics-action"> </button>
                    <input type="hidden" name="attr_forensics_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="forensics rank" title="forensics rank">
                  <input data-i18n-placeholder="0" name="attr_forensics" title="@{forensics}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="heavy machinery fail checkbox" title="heavy machinery fail checkbox">
                    <input class="isvisible" name="attr_heavy_machinery_visible" title="@{heavy_machinery_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_heavy_machinery_r" value="@{heavy_machinery_action}">	
                      <h3 class="aligned-left" data-i18n-title="heavy machinery">heavy machinery</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_heavy_machinery" value="@{heavy_machinery_action}">	</button>
                    <button class="none" type="action" name="act_heavy_machinery-action"> </button>
                    <input type="hidden" name="attr_heavy_machinery_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="heavy machinery rank" title="heavy machinery rank">
                  <input data-i18n-placeholder="0" name="attr_heavy_machinery" title="@{heavy_machinery}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="heavy weapons fail checkbox" title="heavy weapons fail checkbox">
                    <input class="isvisible" name="attr_heavy_weapons_visible" title="@{heavy_weapons_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_heavy_weapons_r" value="@{heavy_weapons_action}">	
                      <h3 class="aligned-left" data-i18n-title="heavy weapons">heavy weapons</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_heavy_weapons" value="@{heavy_weapons_action}">	</button>
                    <button class="none" type="action" name="act_heavy_weapons-action"> </button>
                    <input type="hidden" name="attr_heavy_weapons_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="heavy weapons rank" title="heavy weapons rank">
                  <input data-i18n-placeholder="0" name="attr_heavy_weapons" title="@{heavy_weapons}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="history fail checkbox" title="history fail checkbox">
                    <input class="isvisible" name="attr_history_visible" title="@{history_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_history_r" value="@{history_action}">	
                      <h3 class="aligned-left" data-i18n-title="history">history</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_history" value="@{history_action}">	</button>
                    <button class="none" type="action" name="act_history-action"> </button>
                    <input type="hidden" name="attr_history_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="history rank" title="history rank">
                  <input data-i18n-placeholder="0" name="attr_history" title="@{history}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="HUMINT fail checkbox" title="HUMINT fail checkbox">
                    <input class="isvisible" name="attr_humint_visible" title="@{humint_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_humint_r" value="@{humint_action}">	
                      <h3 class="aligned-left" data-i18n-title="HUMINT">HUMINT</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_humint" value="@{humint_action}">	</button>
                    <button class="none" type="action" name="act_humint-action"> </button>
                    <input type="hidden" name="attr_humint_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="HUMINT rank" title="HUMINT rank">
                  <input data-i18n-placeholder="0" name="attr_humint" title="@{humint}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="law fail checkbox" title="law fail checkbox">
                    <input class="isvisible" name="attr_law_visible" title="@{law_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_law_r" value="@{law_action}">	
                      <h3 class="aligned-left" data-i18n-title="law">law</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_law" value="@{law_action}">	</button>
                    <button class="none" type="action" name="act_law-action"> </button>
                    <input type="hidden" name="attr_law_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="law rank" title="law rank">
                  <input data-i18n-placeholder="0" name="attr_law" title="@{law}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="medicine fail checkbox" title="medicine fail checkbox">
                    <input class="isvisible" name="attr_medicine_visible" title="@{medicine_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_medicine_r" value="@{medicine_action}">	
                      <h3 class="aligned-left" data-i18n-title="medicine">medicine</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_medicine" value="@{medicine_action}">	</button>
                    <button class="none" type="action" name="act_medicine-action"> </button>
                    <input type="hidden" name="attr_medicine_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="medicine rank" title="medicine rank">
                  <input data-i18n-placeholder="0" name="attr_medicine" title="@{medicine}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="melee weapons fail checkbox" title="melee weapons fail checkbox">
                    <input class="isvisible" name="attr_melee_weapons_visible" title="@{melee_weapons_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_melee_weapons_r" value="@{melee_weapons_action}">	
                      <h3 class="aligned-left" data-i18n-title="melee weapons">melee weapons</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_melee_weapons" value="@{melee_weapons_action}">	</button>
                    <button class="none" type="action" name="act_melee_weapons-action"> </button>
                    <input type="hidden" name="attr_melee_weapons_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="melee weapons rank" title="melee weapons rank">
                  <input data-i18n-placeholder="0" name="attr_melee_weapons" title="@{melee_weapons}" placeholder="0" type="text" value="30"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="military science fail checkbox" title="military science fail checkbox">
                    <input class="isvisible" name="attr_military_science_1_visible" title="@{military_science_1_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_military_science_1_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="military science" title="military science">military science</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_military_science_1_name" title="@{military_science_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_military_science_1_r" value="@{military_science_1_action}">	
                            <h3 class="aligned-left"><span title="military science">military science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_military_science_1_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_military_science_1" value="@{military_science_1_action}">	</button>
                          <button class="none" type="action" name="act_military_science_1-action"> </button>
                          <input type="hidden" name="attr_military_science_1_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_military_science_1_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="military science rank" title="military science rank">
                  <input data-i18n-placeholder="0" name="attr_military_science_1" title="@{military_science_1}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="military science fail checkbox" title="military science fail checkbox">
                    <input class="isvisible" name="attr_military_science_2_visible" title="@{military_science_2_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_military_science_2_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="military science" title="military science">military science</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_military_science_2_name" title="@{military_science_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_military_science_2_r" value="@{military_science_2_action}">	
                            <h3 class="aligned-left"><span title="military science">military science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_military_science_2_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_military_science_2" value="@{military_science_2_action}">	</button>
                          <button class="none" type="action" name="act_military_science_2-action"> </button>
                          <input type="hidden" name="attr_military_science_2_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_military_science_2_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="military science rank" title="military science rank">
                  <input data-i18n-placeholder="0" name="attr_military_science_2" title="@{military_science_2}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="navigate fail checkbox" title="navigate fail checkbox">
                    <input class="isvisible" name="attr_navigate_visible" title="@{navigate_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_navigate_r" value="@{navigate_action}">	
                      <h3 class="aligned-left" data-i18n-title="navigate">navigate</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_navigate" value="@{navigate_action}">	</button>
                    <button class="none" type="action" name="act_navigate-action"> </button>
                    <input type="hidden" name="attr_navigate_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="navigate rank" title="navigate rank">
                  <input data-i18n-placeholder="0" name="attr_navigate" title="@{navigate}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="occult fail checkbox" title="occult fail checkbox">
                    <input class="isvisible" name="attr_occult_visible" title="@{occult_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_occult_r" value="@{occult_action}">	
                      <h3 class="aligned-left" data-i18n-title="occult">occult</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_occult" value="@{occult_action}">	</button>
                    <button class="none" type="action" name="act_occult-action"> </button>
                    <input type="hidden" name="attr_occult_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="occult rank" title="occult rank">
                  <input data-i18n-placeholder="0" name="attr_occult" title="@{occult}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="persuade fail checkbox" title="persuade fail checkbox">
                    <input class="isvisible" name="attr_persuade_visible" title="@{persuade_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_persuade_r" value="@{persuade_action}">	
                      <h3 class="aligned-left" data-i18n-title="persuade">persuade</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_persuade" value="@{persuade_action}">	</button>
                    <button class="none" type="action" name="act_persuade-action"> </button>
                    <input type="hidden" name="attr_persuade_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="persuade rank" title="persuade rank">
                  <input data-i18n-placeholder="0" name="attr_persuade" title="@{persuade}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="pharmacy fail checkbox" title="pharmacy fail checkbox">
                    <input class="isvisible" name="attr_pharmacy_visible" title="@{pharmacy_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_pharmacy_r" value="@{pharmacy_action}">	
                      <h3 class="aligned-left" data-i18n-title="pharmacy">pharmacy</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_pharmacy" value="@{pharmacy_action}">	</button>
                    <button class="none" type="action" name="act_pharmacy-action"> </button>
                    <input type="hidden" name="attr_pharmacy_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="pharmacy rank" title="pharmacy rank">
                  <input data-i18n-placeholder="0" name="attr_pharmacy" title="@{pharmacy}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="pilot fail checkbox" title="pilot fail checkbox">
                    <input class="isvisible" name="attr_pilot_1_visible" title="@{pilot_1_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_pilot_1_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="pilot" title="pilot">pilot</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_pilot_1_name" title="@{pilot_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_pilot_1_r" value="@{pilot_1_action}">	
                            <h3 class="aligned-left"><span title="pilot">pilot</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_pilot_1_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_pilot_1" value="@{pilot_1_action}">	</button>
                          <button class="none" type="action" name="act_pilot_1-action"> </button>
                          <input type="hidden" name="attr_pilot_1_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_pilot_1_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="pilot rank" title="pilot rank">
                  <input data-i18n-placeholder="0" name="attr_pilot_1" title="@{pilot_1}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="pilot fail checkbox" title="pilot fail checkbox">
                    <input class="isvisible" name="attr_pilot_2_visible" title="@{pilot_2_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_pilot_2_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="pilot" title="pilot">pilot</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_pilot_2_name" title="@{pilot_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_pilot_2_r" value="@{pilot_2_action}">	
                            <h3 class="aligned-left"><span title="pilot">pilot</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_pilot_2_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_pilot_2" value="@{pilot_2_action}">	</button>
                          <button class="none" type="action" name="act_pilot_2-action"> </button>
                          <input type="hidden" name="attr_pilot_2_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_pilot_2_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="pilot rank" title="pilot rank">
                  <input data-i18n-placeholder="0" name="attr_pilot_2" title="@{pilot_2}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="psychotherapy fail checkbox" title="psychotherapy fail checkbox">
                    <input class="isvisible" name="attr_psychotherapy_visible" title="@{psychotherapy_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_psychotherapy_r" value="@{psychotherapy_action}">	
                      <h3 class="aligned-left" data-i18n-title="psychotherapy">psychotherapy</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_psychotherapy" value="@{psychotherapy_action}">	</button>
                    <button class="none" type="action" name="act_psychotherapy-action"> </button>
                    <input type="hidden" name="attr_psychotherapy_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="psychotherapy rank" title="psychotherapy rank">
                  <input data-i18n-placeholder="0" name="attr_psychotherapy" title="@{psychotherapy}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="ride fail checkbox" title="ride fail checkbox">
                    <input class="isvisible" name="attr_ride_visible" title="@{ride_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_ride_r" value="@{ride_action}">	
                      <h3 class="aligned-left" data-i18n-title="ride">ride</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_ride" value="@{ride_action}">	</button>
                    <button class="none" type="action" name="act_ride-action"> </button>
                    <input type="hidden" name="attr_ride_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="ride rank" title="ride rank">
                  <input data-i18n-placeholder="0" name="attr_ride" title="@{ride}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="science fail checkbox" title="science fail checkbox">
                    <input class="isvisible" name="attr_science_1_visible" title="@{science_1_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_science_1_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="science" title="science">science</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_science_1_name" title="@{science_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_science_1_r" value="@{science_1_action}">	
                            <h3 class="aligned-left"><span title="science">science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_science_1_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_science_1" value="@{science_1_action}">	</button>
                          <button class="none" type="action" name="act_science_1-action"> </button>
                          <input type="hidden" name="attr_science_1_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_science_1_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="science rank" title="science rank">
                  <input data-i18n-placeholder="0" name="attr_science_1" title="@{science_1}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="science fail checkbox" title="science fail checkbox">
                    <input class="isvisible" name="attr_science_2_visible" title="@{science_2_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="form-skill-group"> 
                    <label class="skill-button">
                      <input class="edit_test" type="hidden" name="attr_science_2_test"/><span class="edit_text">
                        <div class="special_div">
                          <h3><span data-i18n="science" title="science">science</span><span>:</span></h3>
                        </div>
                        <input style="width:100%;" name="attr_science_2_name" title="@{science_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="roll two pressable special_div undefined" type="roll" name="attr_science_2_r" value="@{science_2_action}">	
                            <h3 class="aligned-left"><span title="science">science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_science_2_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                          <button class="none two" type="roll" name="roll_science_2" value="@{science_2_action}">	</button>
                          <button class="none" type="action" name="act_science_2-action"> </button>
                          <input type="hidden" name="attr_science_2_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_science_2_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label class="rank" data-i18n-title="science rank" title="science rank">
                  <input data-i18n-placeholder="0" name="attr_science_2" title="@{science_2}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="search fail checkbox" title="search fail checkbox">
                    <input class="isvisible" name="attr_search_visible" title="@{search_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_search_r" value="@{search_action}">	
                      <h3 class="aligned-left" data-i18n-title="search">search</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_search" value="@{search_action}">	</button>
                    <button class="none" type="action" name="act_search-action"> </button>
                    <input type="hidden" name="attr_search_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="search rank" title="search rank">
                  <input data-i18n-placeholder="0" name="attr_search" title="@{search}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="SIGINT fail checkbox" title="SIGINT fail checkbox">
                    <input class="isvisible" name="attr_sigint_visible" title="@{sigint_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_sigint_r" value="@{sigint_action}">	
                      <h3 class="aligned-left" data-i18n-title="SIGINT">SIGINT</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_sigint" value="@{sigint_action}">	</button>
                    <button class="none" type="action" name="act_sigint-action"> </button>
                    <input type="hidden" name="attr_sigint_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="SIGINT rank" title="SIGINT rank">
                  <input data-i18n-placeholder="0" name="attr_sigint" title="@{sigint}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="stealth fail checkbox" title="stealth fail checkbox">
                    <input class="isvisible" name="attr_stealth_visible" title="@{stealth_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_stealth_r" value="@{stealth_action}">	
                      <h3 class="aligned-left" data-i18n-title="stealth">stealth</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_stealth" value="@{stealth_action}">	</button>
                    <button class="none" type="action" name="act_stealth-action"> </button>
                    <input type="hidden" name="attr_stealth_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="stealth rank" title="stealth rank">
                  <input data-i18n-placeholder="0" name="attr_stealth" title="@{stealth}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="surgery fail checkbox" title="surgery fail checkbox">
                    <input class="isvisible" name="attr_surgery_visible" title="@{surgery_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_surgery_r" value="@{surgery_action}">	
                      <h3 class="aligned-left" data-i18n-title="surgery">surgery</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_surgery" value="@{surgery_action}">	</button>
                    <button class="none" type="action" name="act_surgery-action"> </button>
                    <input type="hidden" name="attr_surgery_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="surgery rank" title="surgery rank">
                  <input data-i18n-placeholder="0" name="attr_surgery" title="@{surgery}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="survival fail checkbox" title="survival fail checkbox">
                    <input class="isvisible" name="attr_survival_visible" title="@{survival_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_survival_r" value="@{survival_action}">	
                      <h3 class="aligned-left" data-i18n-title="survival">survival</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_survival" value="@{survival_action}">	</button>
                    <button class="none" type="action" name="act_survival-action"> </button>
                    <input type="hidden" name="attr_survival_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="survival rank" title="survival rank">
                  <input data-i18n-placeholder="0" name="attr_survival" title="@{survival}" placeholder="0" type="text" value="10"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="swim fail checkbox" title="swim fail checkbox">
                    <input class="isvisible" name="attr_swim_visible" title="@{swim_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_swim_r" value="@{swim_action}">	
                      <h3 class="aligned-left" data-i18n-title="swim">swim</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_swim" value="@{swim_action}">	</button>
                    <button class="none" type="action" name="act_swim-action"> </button>
                    <input type="hidden" name="attr_swim_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="swim rank" title="swim rank">
                  <input data-i18n-placeholder="0" name="attr_swim" title="@{swim}" placeholder="0" type="text" value="20"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="unarmed combat fail checkbox" title="unarmed combat fail checkbox">
                    <input class="isvisible" name="attr_unarmed_combat_visible" title="@{unarmed_combat_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_unarmed_combat_r" value="@{unarmed_combat_action}">	
                      <h3 class="aligned-left" data-i18n-title="unarmed combat">unarmed combat</h3><span data-i18n="(40%)" title="(40%)">(40%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_unarmed_combat" value="@{unarmed_combat_action}">	</button>
                    <button class="none" type="action" name="act_unarmed_combat-action"> </button>
                    <input type="hidden" name="attr_unarmed_combat_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="unarmed combat rank" title="unarmed combat rank">
                  <input data-i18n-placeholder="0" name="attr_unarmed_combat" title="@{unarmed_combat}" placeholder="0" type="text" value="40"/>
                </label>
              </div>
              <div class="section-skill-col">
                <div class="box">
                  <label class="styled-checkbox center-items" data-i18n-title="unnatural fail checkbox" title="unnatural fail checkbox">
                    <input class="isvisible" name="attr_unnatural_visible" title="@{unnatural_visible}" type="checkbox" value="visible"/><span></span>
                  </label>
                  <div class="buttonwrapper">
                    <button class="roll two normal_div inSkills" type="action" name="attr_unnatural_r" value="@{unnatural_action}">	
                      <h3 class="aligned-left" data-i18n-title="unnatural">unnatural</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                    </button>
                    <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                    <button class="none two" type="roll" name="roll_unnatural" value="@{unnatural_action}">	</button>
                    <button class="none" type="action" name="act_unnatural-action"> </button>
                    <input type="hidden" name="attr_unnatural_action" value=""/>
                  </div>
                </div>
                <label class="rank" data-i18n-title="unnatural rank" title="unnatural rank">
                  <input data-i18n-placeholder="0" name="attr_unnatural" title="@{unnatural}" placeholder="0" type="text" value="0"/>
                </label>
              </div>
              <div class="section-repeating-container">
                <div class="section-title border-bottom">
                  <h3 class="margin-left" data-i18n="foriegn languages and other skills:" data-i18n-title="foriegn languages and other skills:">foriegn languages and other skills:	</h3>
                </div>
                <div class="section-body">
                  <fieldset class="repeating_skills">
                    <div class="section-skill-col">
                      <div class="form-skill-group"> 
                        <label class="skill-button">
                          <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                            <input style="width:100%;" name="attr_name" title="@{repeating_skills_${x}__name}" type="text" value="skill"/></span><span class="unedit_text">
                            <div class="buttonwrapper">
                              <button class="repeating_roll two pressable additional_div undefined" type="action" name="attr_skill_r" value="@{skill_action}">	
                                <h3 class="aligned-left"><span name="attr_name"></span>
                                </h3>
                                <!--if (spanButton != '')
                                span.para(data-i18n=spanButton title=spanButton)= spanButton
                                
                                
                                -->
                              </button>
                              <button class="two none pressable additional_div undefined" type="roll" name="roll_skill" value="@{skill_action}">	</button>
                              <button class="none" type="action" name="act_skill-action"> </button>
                              <input type="hidden" name="attr_skill_action" value=""/>
                            </div></span>
                        </label>
                        <label class="switch-edit">
                          <input type="checkbox" name="attr_test" value="editable"/><span class="vslider"></span>
                        </label>
                      </div>
                      <label class="rank" data-i18n-title="skill rank" title="skill rank">
                        <input data-i18n-placeholder="0" name="attr_rank" title="@{repeating_skills_${x}_rank}" placeholder="0" type="text" value=""/>
                      </label>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </details>
          <!--
          input.switchblock.none( name='attr_whatsanroll'  title='@{target_san_loss}' type='checkbox' value='target') 
          span.switch-a
          	- const statRollValue = `@{gm_toggle} &{template:sanloss} {{type=^{@{san_type}}}} {{success=@{san_success}}}  {{failure=@{san_failure}}} {{roll1=[[@{san_success}]]}} {{roll2=[[@{san_failure}]]}}  {{hasminsan=[[@{has_san_success}]]}} {{hasmaxsan=[[@{has_san_failure}]]}}`;
          	button(name='san loss roll' data-i18n-title='san loss roll' title='san loss roll' type='roll' value!=statRollValue)
          		h1(data-i18n='SAN LOSS') SAN LOSS
          span.switch-b
          	//without modifiers - const statRollValue2 = `@{gm_toggle} &{template:sanloss1} {{minloss=@{minsanloss}}} {{maxloss=@{maxsanloss}}} {{name=@{target|name} }} {{dice=[[1d100]]}} {{subheader=@{target|sanity_points}}} {{rating=[[@{target|sanity_points}]]}} {{type=^{@{san_type}}}} {{success=@{san_success}}}  {{failure=@{san_failure}}} {{rsuccess=[@{san_success}](~rsuccess)}} {{rfailure=[@{san_failure}](~rfailure)}}  {{hasminsan=[[@{has_san_success}]]}} {{hasmaxsan=[[@{has_san_failure}]]}}`;
          	- const statRollValue2 = `@{gm_toggle} &{template:sanloss1} {{minloss=@{minsanloss}}} {{maxloss=@{maxsanloss}}} {{name=@{target|name} }} {{dice=[[1d100]]}} {{subheader=@{target|sanity_points}}}  {{modifier=[[?{Modifier|,0|+20%,20|+40%,40|-20%,-20|-40%,-40|custom (%),?{custom (%)}}]]}}  {{rating=[[@{target|sanity_points}+?{Modifier|,0|+20%,20|+40%,40|-20%,-20|-40%,-40|custom (%),?{custom (%)}}]]}} {{type=^{@{san_type}}}} {{success=@{san_success}}}  {{failure=@{san_failure}}} {{rsuccess=[@{san_success}](~rsuccess)}} {{rfailure=[@{san_failure}](~rfailure)}}  {{hasminsan=[[@{has_san_success}]]}} {{hasmaxsan=[[@{has_san_failure}]]}}`;
          	button(name='san loss roll' data-i18n-title='san loss roll' title='san loss roll' type='roll' value!=statRollValue2)
          		h1(data-i18n='SAN LOSS') SAN LOSS
          	button.none(name='roll_rsuccess' type='roll' value='@{gm_toggle} &{template:damage} {{header=Success}} {{subheader=@{san_success}}} {{damage=[[@{san_success}+0]]}} ')
          	button.none(name='roll_rfailure' type='roll' value='@{gm_toggle} &{template:damage} {{header=Failure}} {{subheader=@{san_failure}}} {{damage=[[@{san_failure}+0]]}} ')
          input.text-align-left(data-i18n-placeholder='0' name='attr_san_success' placeholder='0' title='@{san_success}' type='text' value='0') 
          input.text-align-left(name='attr_has_san_success'  type='hidden' value='1') 
          span.slash /
          input.text-align-left(data-i18n-placeholder='1' name='attr_san_failure' placeholder='1' title='@{san_failure}' type='text' value='1')
          input.text-align-left(name='attr_has_san_failure'  type='hidden' value='1') 
          input(name='attr_minsanloss' type='hidden' value='0')
          input(name='attr_maxsanloss' type='hidden' value='1')
          select(name='attr_san_type')
          	optgroup(label='Sanity Type')
          		option(data-i18n='unnatural' value='unnatural') unnatural
          		option(data-i18n='violence' value='violence') violence
          		option(data-i18n='helplessness' value='helplessness') helplessness
          input.center( name='attr_whatsanroll'  title='@{target_san_loss}' type='checkbox' value='target') 
          span.slash Target the selected token
          -->
          <h1 data-i18n="armor">ARMOR</h1>
          <label data-i18n-title="enter armor text" title="enter armor text">
            <input data-i18n-placeholder="8 points of thick hide" name="attr_armor" placeholder="8 points of thick hide" title="@{armor}" type="text" value=""/>
          </label>
          <h1 data-i18n="other notes">other notes</h1>
          <div class="repeating-container notes">
            <div class="grid section-header">
              <h2 data-i18n="name">name</h2>
              <h2 data-i18n="notes">notes</h2>
            </div>
            <fieldset class="repeating_other">
              <div class="grid section border-bottom">
                <label data-i18n-title="other notes name" title="other notes name">
                  <input data-i18n-placeholder="name" name="attr_name" placeholder="name" title="@{repeating_other_${x}_name}" type="text" value=""/>
                </label>
                <label data-i18n-title="other notes" title="other notes">
                  <input data-i18n-placeholder="notes" name="attr_notes" placeholder="notes" title="@{repeating_other_${x}_notes}" type="text" value=""/>
                </label>
              </div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>
    <!-- PC SHEET-->
    <!-- =============================-->
    <div class="pc">
      <!--PERSONAL DATA-->
      <div class="grid header-body personal-data border" id="personal-data-pc">
        <div class="section-header">
          <h1 data-i18n="personal data" data-i18-title="personal data" title="personal data">personal data</h1>
        </div>
        <div class="section-body">
          <div class="grid section border-bottom">
            <h2 class="aligned-left" data-i18n="1. last name, first name (and alias or code name if applicable)" data-i18-title="1. last name, first name (and alias or code name if applicable)" title="1. last name, first name (and alias or code name if applicable)">1. last name, first name (and alias or code name if applicable)</h2>
            <label data-i18-title="1. last name, first name (and alias or code name if applicable)" title="1. last name, first name (and alias or code name if applicable)">
              <input data-i18n-placeholder="1. last name, first name (and alias or code name if applicable)" name="attr_character_name" placeholder="1. last name, first name (and alias or code name if applicable)" title="@{name}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
            <h2 class="aligned-left" data-i18n="2. profession (rank if applicable)" data-i18-title="2. profession (rank if applicable)" title="2. profession (rank if applicable)">2. profession (rank if applicable)</h2>
            <label data-i18-title="2. profession (rank if applicable)" title="2. profession (rank if applicable)">
              <input data-i18n-placeholder="2. profession (rank if applicable)" name="attr_profession" placeholder="2. profession (rank if applicable)" title="@{profession}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
          </div>
          <div class="grid section border-bottom">
            <h2 class="aligned-left" data-i18n="3. employer" data-i18-title="3. employer" title="3. employer">3. employer</h2>
            <label data-i18-title="3. employer" title="3. employer">
              <input data-i18n-placeholder="3. employer" name="attr_employer" placeholder="3. employer" title="@{employer}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
            <h2 class="aligned-left" data-i18n="4. nationality and residence" data-i18-title="4. nationality and residence" title="4. nationality and residence">4. nationality and residence</h2>
            <label data-i18-title="4. nationality and residence" title="4. nationality and residence">
              <input data-i18n-placeholder="4. nationality and residence" name="attr_nationality and residence" placeholder="4. nationality and residence" title="@{nationality and residence}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
          </div>
          <div class="grid section border-bottom">
            <h2 class="aligned-left" data-i18n="5. sex" data-i18-title="5. sex" title="5. sex">5. sex</h2>
            <label data-i18-title="5. sex" title="5. sex">
              <input data-i18n-placeholder="5. sex" name="attr_sex" placeholder="5. sex" title="@{sex}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
            <h2 class="aligned-left" data-i18n="6. age and d.o.b." data-i18-title="6. age and d.o.b." title="6. age and d.o.b.">6. age and d.o.b.</h2>
            <label data-i18-title="6. age and d.o.b." title="6. age and d.o.b.">
              <input data-i18n-placeholder="6. age and d.o.b." name="attr_age" placeholder="6. age and d.o.b." title="@{age}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
            <h2 class="aligned-left" data-i18n="7. education and occupational history" data-i18-title="7. education and occupational history" title="7. education and occupational history">7. education and occupational history</h2>
            <label data-i18-title="7. education and occupational history" title="7. education and occupational history">
              <input data-i18n-placeholder="7. education and occupational history" name="attr_education" placeholder="7. education and occupational history" title="@{education}" type="text" value=""/>
            </label>
            <div class="vert-line"></div>
          </div>
        </div>
      </div>
      <!--STATISTICAL DATA-->
      <div class="grid header-body statistical-data border" id="statistical-data-pc">
        <div class="section-header">
          <h1 data-i18n="statistical data" data-i18n-title="statistical data" title="statistical data">statistical data</h1>
        </div>
        <!--STATISTICS-->
        <div class="grid section-body">
          <div class="grid section-stats">
            <h2 class="aligned-left" data-i18n="8. statistics" data-i18n-title="8. statistics" title="8. statistics">8. statistics</h2>
            <h2 class="center" data-i18n="score" data-i18n-title="score">score</h2>
            <h2 class="center" data-i18n="5" data-i18n-title="5">5</h2>
            <h2 class="aligned-left" data-i18n="distinguishing features" data-i18n-title="">distinguishing features</h2>
          </div>
          <div class="grid section-stats body">
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_strength_r" value="@{strength_action}">	
                <h3 class="aligned-left" data-i18n-title="strength">strength</h3>
                <div><span class="para" data-i18n="STR" title="STR">STR</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_strength" value="@{strength_action}">	</button>
              <button class="none" type="action" name="act_strength-action"> </button>
              <input type="hidden" name="attr_strength_action" value=""/>
            </div>
            <label data-i18n-title="strength score" title="strength score">
              <input min="0" name="attr_strength_score" placeholder="-" title="@{strength_score}" type="text" value=" "/>
            </label><span class="center" name="attr_strength" title="@{strength}"></span>
            <label data-i18n-title="strength distinguishing features" title="strength distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_strength_features" placeholder="distinguishing features" title="@{strength_features}" type="text"/>
            </label>
            <input name="attr_strength" type="hidden" value="0"/>
            <input name="attr_strength_hidden" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_constitution_r" value="@{constitution_action}">	
                <h3 class="aligned-left" data-i18n-title="constitution">constitution</h3>
                <div><span class="para" data-i18n="CON" title="CON">CON</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_constitution" value="@{constitution_action}">	</button>
              <button class="none" type="action" name="act_constitution-action"> </button>
              <input type="hidden" name="attr_constitution_action" value=""/>
            </div>
            <label data-i18n-title="constitution score" title="constitution score">
              <input min="0" name="attr_constitution_score" placeholder="-" title="@{constitution_score}" type="text" value=" "/>
            </label><span class="center" name="attr_constitution" title="@{constitution}"></span>
            <label data-i18n-title="constitution distinguishing features" title="constitution distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_constitution_features" placeholder="distinguishing features" title="@{constitution_features}" type="text"/>
            </label>
            <input name="attr_constitution" type="hidden" value="0"/>
            <input name="attr_constitution_hidden" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_dexterity_r" value="@{dexterity_action}">	
                <h3 class="aligned-left" data-i18n-title="dexterity">dexterity</h3>
                <div><span class="para" data-i18n="DEX" title="DEX">DEX</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_dexterity" value="@{dexterity_action}">	</button>
              <button class="none" type="action" name="act_dexterity-action"> </button>
              <input type="hidden" name="attr_dexterity_action" value=""/>
            </div>
            <label data-i18n-title="dexterity score" title="dexterity score">
              <input data-i18n-placeholder="-" min="0" name="attr_dexterity_score" placeholder="-" title="@{dexterity_score}" type="text" value=" "/>
            </label><span class="center" name="attr_dexterity" title="@{dexterity}"></span>
            <label data-i18n-title="dexterity distinguishing features" title="dexterity distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_dexterity_features" placeholder="distinguishing features" title="@{dexterity_features}" type="text"/>
            </label>
            <input name="attr_dexterity" type="hidden" value="0"/>
            <input name="attr_dexterity_hidden" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_intelligence_r" value="@{intelligence_action}">	
                <h3 class="aligned-left" data-i18n-title="intelligence">intelligence</h3>
                <div><span class="para" data-i18n="INT" title="INT">INT</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_intelligence" value="@{intelligence_action}">	</button>
              <button class="none" type="action" name="act_intelligence-action"> </button>
              <input type="hidden" name="attr_intelligence_action" value=""/>
            </div>
            <label data-i18n-title="intelligence score" title="intelligence score">
              <input data-i18n-placeholder="-" min="0" name="attr_intelligence_score" placeholder="-" title="@{intelligence_score}" type="text" value=" "/>
            </label><span class="center" name="attr_intelligence" title="@{intelligence}"></span>
            <label data-i18n-title="intelligence distinguishing features" title="intelligence distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_intelligence_features" placeholder="distinguishing features" title="@{intelligence_features}" type="text"/>
            </label>
            <input name="attr_intelligence" type="hidden" value="0"/>
            <input name="attr_intelligence_hidden" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_power_r" value="@{power_action}">	
                <h3 class="aligned-left" data-i18n-title="power">power</h3>
                <div><span class="para" data-i18n="POW" title="POW">POW</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_power" value="@{power_action}">	</button>
              <button class="none" type="action" name="act_power-action"> </button>
              <input type="hidden" name="attr_power_action" value=""/>
            </div>
            <label data-i18n-title="power score" title="power score">
              <input min="0" name="attr_power_score" placeholder="-" title="@{power_score}" type="text" value=" "/>
            </label><span class="center" name="attr_power" title="@{power}"></span>
            <label data-i18n-title="power distinguishing features" title="power distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_power_features" placeholder="distinguishing features" title="@{power_features}" type="text"/>
            </label>
            <input name="attr_power" type="hidden" value="0"/>
            <input name="attr_power_hidden" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_charisma_r" value="@{charisma_action}">	
                <h3 class="aligned-left" data-i18n-title="charisma">charisma</h3>
                <div><span class="para" data-i18n="CHA" title="CHA">CHA</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_charisma" value="@{charisma_action}">	</button>
              <button class="none" type="action" name="act_charisma-action"> </button>
              <input type="hidden" name="attr_charisma_action" value=""/>
            </div>
            <label data-i18n-title="charisma score" title="charisma score">
              <input data-i18n-placeholder="-" min="0" name="attr_charisma_score" placeholder="-" title="@{charisma_score}" type="text" value=" "/>
            </label><span class="center" name="attr_charisma" title="@{charisma}"></span>
            <label data-i18n-title="charisma distinguishing features" title="charisma distinguishing features">
              <input data-i18n-placeholder="distinguishing features" name="attr_charisma_features" placeholder="distinguishing features" title="@{charisma_features}" type="text"/>
            </label>
            <input name="attr_charisma" type="hidden" value="0"/>
            <input name="attr_charisma_hidden" type="hidden" value="0"/>
          </div>
          <!--DERIVED ATTRIBUTES-->
          <div class="grid section-derived">
            <h2 class="aligned-left">9. derived attributes</h2>
            <h2 class="center">maximum</h2>
            <h2 class="center">current</h2>
          </div>
          <div class="grid section-derived body">
            <div class="explainer">
              <div class="derived-attr nbsp">
                <h3 class="aligned-left" data-i18n="hit points" data-i18n-title="hit points">hit points</h3><span class="para" data-i18n="HP">HP</span>
              </div>
              <div class="tooltip-container"><span class="questionmark">?</span><span class="tooltip-text">
                  <p> <span class="zero_val">Dead (0HP):</span>An Agent at 0 HP is dead.
                    Sometimes its possible to resuscitate a dead character. 
                    If the Handler says resuscitation is possible, someone must make a First Aid test. 
                  </p>
                  <p><span class="low_val"> Unconscious (1HP-2HP):</span>An Agent whose HP hits 1 or 2 falls unconscious. An unconscious Agent is helpless and can be killed with a single attack without having to roll. 
                    At 3 HP or more (or after an hour passes), the Agent regains consciousness.
                  </p>
                  <p>  Any time your Agent is reduced to 2 or fewer HP, make a CON5 test. Failure indicates permanent injury.</p>
                  <p> <span class="normal_val">Normal (3HP-MaxHP)</span></p>
                  <p><span class="extra_val">Extra Point (> MaxHP):</span>An Agent can more than the maximum HP through unnatural means.</p></span></div>
            </div><span class="center" name="attr_hit_points_max" title="@{hit_points_max}"></span>
            <label data-i18n-title="hit points" title="hit points">
              <input name="attr_hit_modifier" type="hidden" value="0"/>
              <input class="normal_color" name="attr_color_hit" type="radio" value="normal" checked="checked"/>
              <input class="vitality-colored" name="attr_hit_points" placeholder="-" title="@{hit_points}" type="text" style="width:100%;" value=" "/>
              <input class="low_color" name="attr_color_hit" type="radio" value="low" checked="checked"/>
              <input class="vitality-colored" name="attr_hit_points" placeholder="-" title="@{hit_points}" type="text" style="width:100%;" value=" "/>
              <input class="extra_color" name="attr_color_hit" type="radio" value="extra" checked="checked"/>
              <input class="vitality-colored" name="attr_hit_points" placeholder="-" title="@{hit_points}" type="text" style="width:100%;" value=" "/>
              <input class="zero_color" name="attr_color_hit" type="radio" value="zero" checked="checked"/>
              <input class="vitality-colored" name="attr_hit_points" placeholder="-" title="@{hit_points}" type="text" style="width:100%;" value=" "/>
            </label>
            <input name="attr_hit_points_max" type="hidden" value="0"/>
            <div class="explainer">
              <div class="derived-attr nbsp">
                <h3 class="aligned-left" data-i18n="willpower points" data-i18n-title="willpower points">willpower points</h3><span class="para" data-i18n="WP">WP</span>
              </div>
              <div class="tooltip-container"><span class="questionmark">?</span><span class="tooltip-text">
                  <p> <span class="zero_val">Lose Control (0 WP):</span>An Agent at 0 WP cannot succeed at any tests, including SAN tests. 
                    Sooner or later the Agent falls asleep, regardless of any 
                    disorders or stimulants, long enough to regain WP.
                  </p>
                  <p><span class="low_val"> Emotional Breakdown (1WP-2WP):</span>An Agent whose WP hits 1 or 2 has an emotional breakdown. 
                    The Agent suffers a 20% penalty to all actions until WP rises above 2.
                  </p>
                  <p> <span class="normal_val">Normal (3WP-MaxWP)	</span></p>
                  <p><span class="extra_val">Extra Point (> MaxWP):</span>An Agent can get more than the maximum WP through unnatural means.</p></span></div>
            </div><span class="center" name="attr_willpower_points_max" title="@{willpower_points_max}"></span>
            <label data-i18n-title="willpower points" title="willpower points">
              <input name="attr_willpower_modifier" type="hidden" value="0"/>
              <input class="normal_color" name="attr_color_willpower" type="radio" value="normal" checked="checked"/>
              <input class="vitality-colored" name="attr_willpower_points" placeholder="-" title="@{willpower_points}" type="text" style="width:100%;" value=" "/>
              <input class="low_color" name="attr_color_willpower" type="radio" value="low" checked="checked"/>
              <input class="vitality-colored" name="attr_willpower_points" placeholder="-" title="@{willpower_points}" type="text" style="width:100%;" value=" "/>
              <input class="extra_color" name="attr_color_willpower" type="radio" value="extra" checked="checked"/>
              <input class="vitality-colored" name="attr_willpower_points" placeholder="-" title="@{willpower_points}" type="text" style="width:100%;" value=" "/>
              <input class="zero_color" name="attr_color_willpower" type="radio" value="zero" checked="checked"/>
              <input class="vitality-colored" name="attr_willpower_points" placeholder="-" title="@{willpower_points}" type="text" style="width:100%;" value=" "/>
            </label>
            <input name="attr_willpower_points_max" type="hidden" value="0"/>
            <input name="attr_past_sanity" type="hidden" value=" "/>
            <div class="buttonwrapper">
              <button class="roll two  inPersonal" type="action" name="attr_sanity_points_r" value="@{sanity_points_action}">	
                <h3 class="aligned-left" data-i18n-title="sanity points">sanity points</h3>
                <div><span class="para" data-i18n="SAN" title="SAN">SAN</span></div>
              </button>
              <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
              <button class="none two" type="roll" name="roll_sanity_points" value="@{sanity_points_action}">	</button>
              <button class="none" type="action" name="act_sanity_points-action"> </button>
              <input type="hidden" name="attr_sanity_points_action" value=""/>
            </div><span class="center" name="attr_sanity_points_max" title="@{sanity_points_max}"></span>
            <label data-i18n-title="sanity points" title="sanity points">
              <input name="attr_sanity_points" placeholder="-" title="@{sanity_points}" type="text" style="width:100%;" value=" "/>
            </label>
            <input name="attr_sanity_points_max" type="hidden" value="0"/>
            <div class="derived-attr nbsp">
              <h3 class="aligned-left" data-i18n="breaking point" data-i18n-title="breaking point">breaking point</h3><span class="para" data-i18n="BP">BP</span>
            </div><span class="center" name="attr_breaking_point_max" title="@{breaking_point_max}"></span>
            <label data-i18n-title="breaking point" title="breaking point">
              <input name="attr_breaking_point" placeholder="-" title="@{breaking_point}" type="text" style="width:100%;" value=" "/>
            </label>
            <input name="attr_breaking_point_max" type="hidden" value="0"/>
            <div class="buttonwrapper">
              <button class="roll one" type="action" name="attr_luck_r" value="@{luck_action}"> 
                <h3 class="aligned-left" data-i18n-title="luck">luck</h3>
              </button>
              <!--button.one(type='roll' class=classButton name='roll_'+rollName value='@{'+rollName+'_action}') -->
              <button class="none one" type="roll" name="roll_luck" value="@{luck_action}"> </button>
              <button class="none" type="action" name="act_luck-action"> </button>
              <input type="hidden" name="attr_luck_action" value=""/>
            </div><span class="center" name="attr_luck_max" title="@{luck_max}"></span><span class="center" name="attr_luck_max" title="@{luck_max}">
              <input name="attr_luck" placeholder="10" title="@{luck}" type="hidden" value="50"/><span class="percent">%</span></span>
            <input name="attr_luck_max" type="hidden" value="50"/>
          </div>
          <!--PHYSICAL DESCRIPTION-->
          <div class="grid section-physical">
            <h2 class="aligned-left">9. physical description</h2>
            <textarea name="attr_physical_description" placeholder="physical description" title="@{physical_description}"></textarea>
          </div>
        </div>
      </div>
      <!--PSYCHOLOGICAL DATA-->
      <div class="grid header-body pyschological-data border" id="psychological-data-pc">
        <div class="section-header">
          <h1 data-i18n="psychological data" data-i18n-title="psychological data ">psychological data </h1>
        </div>
        <div class="grid section-body">
          <div class="grid section-bond-col">
            <div class="box1">
              <h2 class="aligned-left" data-i18n="11. bonds" data-i18n-title="11. bonds">11. bonds			</h2>
            </div>
            <h2 class="center" data-i18n="score" data-i18n-title="score">score</h2>
          </div>
          <div class="section-repeating-container border-bottom">
            <fieldset class="repeating_bonds">
              <div class="grid section-bond-col"> 
                <div class="box"> 
                  <label class="styled_checkbox">
                    <input name="attr_bond_hurt" title="@{attr_bond_hurt}" type="checkbox"/>
                  </label>
                  <div class="form-group">
                    <input name="attr_flag" title="@{repeating_bonds_${x}_flag}" type="hidden" value="0"/>
                    <input name="attr_wp_points" title="@{repeating_bonds_${x}_willpower_points}" type="hidden" value="0"/>
                    <input name="attr_san_points" title="@{repeating_bonds_${x}_sanity_points}" type="hidden" value="0"/>
                    <label class="bond_button"> 
                      <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                        <input style="width:100%; padding: 0px 0px; margin: 0px 0;box-sizing: border-box;" type="text" name="attr_name" value="bond"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="repeating_roll one pressable special_div" type="action" name="attr_bond_r" value="@{bond_action}"> 
                            <h3 class="aligned-left"><span name="attr_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <button class="none one pressable special_div" type="action" name="attr_bond_r" value="@{bond_action}">	</button>
                          <button class="none" type="action" name="act_bond-action"> </button>
                          <input type="hidden" name="attr_bond_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                </div>
                <label data-i18n-title="bond score" title="bond score">
                  <input style="width: 100%;" data-i18n-placeholder="-" name="attr_score" placeholder="-" title="@{repeating_bonds_${x}_score}" type="number"/>
                </label>
              </div>
            </fieldset>
          </div>
          <div class="grid section-bond-notes border-bottom">
            <div class="aligned-left" data-i18n="Check a damaged Bonds box until the next Home scene ends." data-i18n-title="Check a damaged Bonds box until the next Home scene ends." style="margin-left: 1rem;">Check a damaged Bonds box until the next Home scene ends.</div>
          </div>
          <div class="grid section-motivations">
            <div class="grid section border-bottom">
              <h2 class="aligned-left" data-i18n="12. motivations and mental disorders" data-i18n-title="12. motivations and mental disorders">12. motivations and mental disorders</h2>
              <textarea data-i18n-placeholder="motivations" name="attr_motivations" placeholder="motivations"></textarea>
            </div>
          </div>
          <div class="grid section-incidents">
            <div class="grid section border-bottom">
              <h2 class="aligned-left" data-i18n="13. incidents of san loss without going insane" data-i18n-title="13. incidents of san loss without going insane">13. incidents of san loss without going insane</h2>
            </div>
            <div class="grid section incidents-body">
              <h3 class="center" data-i18n="violence" data-i18n-title="violence">violence</h3>
              <div class="radiocontainer"> 
                <input class="radiobox reset" type="radio" name="attr_violence" value="0"/>
                <input class="radiobox" type="radio" name="attr_violence" value="0"/>
                <input class="radiobox" type="radio" name="attr_violence" value="1"/>
                <input class="radiobox" type="radio" name="attr_violence" value="2"/>
              </div>
              <input type="hidden" name="attr_violence_adapted" value="0"/><span class="italic" data-i18n="adapted">adapted</span>
              <h3 class="center" data-i18n="helplessness" data-i18n-title="helplessness">helplessness</h3>
              <div class="radiocontainer"> 
                <input class="radiobox reset" type="radio" name="attr_helplessness" value="0"/>
                <input class="radiobox" type="radio" name="attr_helplessness" value="0"/>
                <input class="radiobox" type="radio" name="attr_helplessness" value="1"/>
                <input class="radiobox" type="radio" name="attr_helplessness" value="2"/>
              </div>
              <input type="hidden" name="attr_helplessness_adapted" value="0"/><span class="italic" data-i18n="adapted">adapted</span>
            </div>
          </div>
        </div>
      </div>
      <!--APPLICABLE SKILL SETS-->
      <div class="grid header-body applicable-skill-sets border" id="applicable-skills-pc">
        <div class="section-header">
          <h1 data-i18n="applicable skill sets" data-i18n-title="applicable skill sets">applicable skill sets</h1>
        </div>
        <div class="grid section-body border">
          <div class="skill-container border-bottom">
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="accounting fail checkbox" title="accounting fail checkbox">
                  <input name="attr_accounting_fail" title="@{accounting_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_accounting_r" value="@{accounting_action}">	
                    <h3 class="aligned-left" data-i18n-title="accounting">accounting</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_accounting" value="@{accounting_action}">	</button>
                  <button class="none" type="action" name="act_accounting-action"> </button>
                  <input type="hidden" name="attr_accounting_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="accounting rank" title="accounting rank">
                <input data-i18n-placeholder="0" name="attr_accounting" title="@{accounting}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="alertness fail checkbox" title="alertness fail checkbox">
                  <input name="attr_alertness_fail" title="@{alertness_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_alertness_r" value="@{alertness_action}">	
                    <h3 class="aligned-left" data-i18n-title="alertness">alertness</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_alertness" value="@{alertness_action}">	</button>
                  <button class="none" type="action" name="act_alertness-action"> </button>
                  <input type="hidden" name="attr_alertness_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="alertness rank" title="alertness rank">
                <input data-i18n-placeholder="0" name="attr_alertness" title="@{alertness}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="anthropology fail checkbox" title="anthropology fail checkbox">
                  <input name="attr_anthropology_fail" title="@{anthropology_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_anthropology_r" value="@{anthropology_action}">	
                    <h3 class="aligned-left" data-i18n-title="anthropology">anthropology</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_anthropology" value="@{anthropology_action}">	</button>
                  <button class="none" type="action" name="act_anthropology-action"> </button>
                  <input type="hidden" name="attr_anthropology_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="anthropology rank" title="anthropology rank">
                <input data-i18n-placeholder="0" name="attr_anthropology" title="@{anthropology}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="archeology fail checkbox" title="archeology fail checkbox">
                  <input name="attr_archeology_fail" title="@{archeology_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_archeology_r" value="@{archeology_action}">	
                    <h3 class="aligned-left" data-i18n-title="archeology">archeology</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_archeology" value="@{archeology_action}">	</button>
                  <button class="none" type="action" name="act_archeology-action"> </button>
                  <input type="hidden" name="attr_archeology_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="archeology rank" title="archeology rank">
                <input data-i18n-placeholder="0" name="attr_archeology" title="@{archeology}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="art fail checkbox" title="art fail checkbox">
                  <input name="attr_art_1_fail" title="@{art_1_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_art_1_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="art" title="art">art</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_art_1_name" title="@{art_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_art_1_r" value="@{art_1_action}">	
                          <h3 class="aligned-left"><span title="art">art</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_art_1_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_art_1" value="@{art_1_action}">	</button>
                        <button class="none" type="action" name="act_art_1-action"> </button>
                        <input type="hidden" name="attr_art_1_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_art_1_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="art rank" title="art rank">
                <input data-i18n-placeholder="0" name="attr_art_1" title="@{art_1}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="art fail checkbox" title="art fail checkbox">
                  <input name="attr_art_2_fail" title="@{art_2_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_art_2_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="art" title="art">art</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_art_2_name" title="@{art_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_art_2_r" value="@{art_2_action}">	
                          <h3 class="aligned-left"><span title="art">art</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_art_2_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_art_2" value="@{art_2_action}">	</button>
                        <button class="none" type="action" name="act_art_2-action"> </button>
                        <input type="hidden" name="attr_art_2_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_art_2_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="art rank" title="art rank">
                <input data-i18n-placeholder="0" name="attr_art_2" title="@{art_2}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="artillery fail checkbox" title="artillery fail checkbox">
                  <input name="attr_artillery_fail" title="@{artillery_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_artillery_r" value="@{artillery_action}">	
                    <h3 class="aligned-left" data-i18n-title="artillery">artillery</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_artillery" value="@{artillery_action}">	</button>
                  <button class="none" type="action" name="act_artillery-action"> </button>
                  <input type="hidden" name="attr_artillery_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="artillery rank" title="artillery rank">
                <input data-i18n-placeholder="0" name="attr_artillery" title="@{artillery}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="athletics fail checkbox" title="athletics fail checkbox">
                  <input name="attr_athletics_fail" title="@{athletics_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_athletics_r" value="@{athletics_action}">	
                    <h3 class="aligned-left" data-i18n-title="athletics">athletics</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_athletics" value="@{athletics_action}">	</button>
                  <button class="none" type="action" name="act_athletics-action"> </button>
                  <input type="hidden" name="attr_athletics_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="athletics rank" title="athletics rank">
                <input data-i18n-placeholder="0" name="attr_athletics" title="@{athletics}" placeholder="0" type="text" value="30"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="bureaucracy fail checkbox" title="bureaucracy fail checkbox">
                  <input name="attr_bureaucracy_fail" title="@{bureaucracy_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_bureaucracy_r" value="@{bureaucracy_action}">	
                    <h3 class="aligned-left" data-i18n-title="bureaucracy">bureaucracy</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_bureaucracy" value="@{bureaucracy_action}">	</button>
                  <button class="none" type="action" name="act_bureaucracy-action"> </button>
                  <input type="hidden" name="attr_bureaucracy_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="bureaucracy rank" title="bureaucracy rank">
                <input data-i18n-placeholder="0" name="attr_bureaucracy" title="@{bureaucracy}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="computer science fail checkbox" title="computer science fail checkbox">
                  <input name="attr_computer_science_fail" title="@{computer_science_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_computer_science_r" value="@{computer_science_action}">	
                    <h3 class="aligned-left" data-i18n-title="computer science">computer science</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_computer_science" value="@{computer_science_action}">	</button>
                  <button class="none" type="action" name="act_computer_science-action"> </button>
                  <input type="hidden" name="attr_computer_science_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="computer science rank" title="computer science rank">
                <input data-i18n-placeholder="0" name="attr_computer_science" title="@{computer_science}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="craft fail checkbox" title="craft fail checkbox">
                  <input name="attr_craft_1_fail" title="@{craft_1_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_craft_1_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="craft" title="craft">craft</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_craft_1_name" title="@{craft_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_craft_1_r" value="@{craft_1_action}">	
                          <h3 class="aligned-left"><span title="craft">craft</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_craft_1_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_craft_1" value="@{craft_1_action}">	</button>
                        <button class="none" type="action" name="act_craft_1-action"> </button>
                        <input type="hidden" name="attr_craft_1_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_craft_1_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="craft rank" title="craft rank">
                <input data-i18n-placeholder="0" name="attr_craft_1" title="@{craft_1}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="craft fail checkbox" title="craft fail checkbox">
                  <input name="attr_craft_2_fail" title="@{craft_2_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_craft_2_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="craft" title="craft">craft</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_craft_2_name" title="@{craft_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_craft_2_r" value="@{craft_2_action}">	
                          <h3 class="aligned-left"><span title="craft">craft</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_craft_2_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_craft_2" value="@{craft_2_action}">	</button>
                        <button class="none" type="action" name="act_craft_2-action"> </button>
                        <input type="hidden" name="attr_craft_2_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_craft_2_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="craft rank" title="craft rank">
                <input data-i18n-placeholder="0" name="attr_craft_2" title="@{craft_2}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="criminology fail checkbox" title="criminology fail checkbox">
                  <input name="attr_criminology_fail" title="@{criminology_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_criminology_r" value="@{criminology_action}">	
                    <h3 class="aligned-left" data-i18n-title="criminology">criminology</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_criminology" value="@{criminology_action}">	</button>
                  <button class="none" type="action" name="act_criminology-action"> </button>
                  <input type="hidden" name="attr_criminology_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="criminology rank" title="criminology rank">
                <input data-i18n-placeholder="0" name="attr_criminology" title="@{criminology}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="demolitions fail checkbox" title="demolitions fail checkbox">
                  <input name="attr_demolitions_fail" title="@{demolitions_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_demolitions_r" value="@{demolitions_action}">	
                    <h3 class="aligned-left" data-i18n-title="demolitions">demolitions</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_demolitions" value="@{demolitions_action}">	</button>
                  <button class="none" type="action" name="act_demolitions-action"> </button>
                  <input type="hidden" name="attr_demolitions_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="demolitions rank" title="demolitions rank">
                <input data-i18n-placeholder="0" name="attr_demolitions" title="@{demolitions}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="disguise fail checkbox" title="disguise fail checkbox">
                  <input name="attr_disguise_fail" title="@{disguise_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_disguise_r" value="@{disguise_action}">	
                    <h3 class="aligned-left" data-i18n-title="disguise">disguise</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_disguise" value="@{disguise_action}">	</button>
                  <button class="none" type="action" name="act_disguise-action"> </button>
                  <input type="hidden" name="attr_disguise_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="disguise rank" title="disguise rank">
                <input data-i18n-placeholder="0" name="attr_disguise" title="@{disguise}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="dodge fail checkbox" title="dodge fail checkbox">
                  <input name="attr_dodge_fail" title="@{dodge_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_dodge_r" value="@{dodge_action}">	
                    <h3 class="aligned-left" data-i18n-title="dodge">dodge</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_dodge" value="@{dodge_action}">	</button>
                  <button class="none" type="action" name="act_dodge-action"> </button>
                  <input type="hidden" name="attr_dodge_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="dodge rank" title="dodge rank">
                <input data-i18n-placeholder="0" name="attr_dodge" title="@{dodge}" placeholder="0" type="text" value="30"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="drive fail checkbox" title="drive fail checkbox">
                  <input name="attr_drive_fail" title="@{drive_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_drive_r" value="@{drive_action}">	
                    <h3 class="aligned-left" data-i18n-title="drive">drive</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_drive" value="@{drive_action}">	</button>
                  <button class="none" type="action" name="act_drive-action"> </button>
                  <input type="hidden" name="attr_drive_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="drive rank" title="drive rank">
                <input data-i18n-placeholder="0" name="attr_drive" title="@{drive}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="firearms fail checkbox" title="firearms fail checkbox">
                  <input name="attr_firearms_fail" title="@{firearms_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_firearms_r" value="@{firearms_action}">	
                    <h3 class="aligned-left" data-i18n-title="firearms">firearms</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_firearms" value="@{firearms_action}">	</button>
                  <button class="none" type="action" name="act_firearms-action"> </button>
                  <input type="hidden" name="attr_firearms_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="firearms rank" title="firearms rank">
                <input data-i18n-placeholder="0" name="attr_firearms" title="@{firearms}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="first aid fail checkbox" title="first aid fail checkbox">
                  <input name="attr_first_aid_fail" title="@{first_aid_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_first_aid_r" value="@{first_aid_action}">	
                    <h3 class="aligned-left" data-i18n-title="first aid">first aid</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_first_aid" value="@{first_aid_action}">	</button>
                  <button class="none" type="action" name="act_first_aid-action"> </button>
                  <input type="hidden" name="attr_first_aid_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="first aid rank" title="first aid rank">
                <input data-i18n-placeholder="0" name="attr_first_aid" title="@{first_aid}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="forensics fail checkbox" title="forensics fail checkbox">
                  <input name="attr_forensics_fail" title="@{forensics_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_forensics_r" value="@{forensics_action}">	
                    <h3 class="aligned-left" data-i18n-title="forensics">forensics</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_forensics" value="@{forensics_action}">	</button>
                  <button class="none" type="action" name="act_forensics-action"> </button>
                  <input type="hidden" name="attr_forensics_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="forensics rank" title="forensics rank">
                <input data-i18n-placeholder="0" name="attr_forensics" title="@{forensics}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="heavy machinery fail checkbox" title="heavy machinery fail checkbox">
                  <input name="attr_heavy_machinery_fail" title="@{heavy_machinery_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_heavy_machinery_r" value="@{heavy_machinery_action}">	
                    <h3 class="aligned-left" data-i18n-title="heavy machinery">heavy machinery</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_heavy_machinery" value="@{heavy_machinery_action}">	</button>
                  <button class="none" type="action" name="act_heavy_machinery-action"> </button>
                  <input type="hidden" name="attr_heavy_machinery_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="heavy machinery rank" title="heavy machinery rank">
                <input data-i18n-placeholder="0" name="attr_heavy_machinery" title="@{heavy_machinery}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="heavy weapons fail checkbox" title="heavy weapons fail checkbox">
                  <input name="attr_heavy_weapons_fail" title="@{heavy_weapons_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_heavy_weapons_r" value="@{heavy_weapons_action}">	
                    <h3 class="aligned-left" data-i18n-title="heavy weapons">heavy weapons</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_heavy_weapons" value="@{heavy_weapons_action}">	</button>
                  <button class="none" type="action" name="act_heavy_weapons-action"> </button>
                  <input type="hidden" name="attr_heavy_weapons_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="heavy weapons rank" title="heavy weapons rank">
                <input data-i18n-placeholder="0" name="attr_heavy_weapons" title="@{heavy_weapons}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="history fail checkbox" title="history fail checkbox">
                  <input name="attr_history_fail" title="@{history_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_history_r" value="@{history_action}">	
                    <h3 class="aligned-left" data-i18n-title="history">history</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_history" value="@{history_action}">	</button>
                  <button class="none" type="action" name="act_history-action"> </button>
                  <input type="hidden" name="attr_history_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="history rank" title="history rank">
                <input data-i18n-placeholder="0" name="attr_history" title="@{history}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="HUMINT fail checkbox" title="HUMINT fail checkbox">
                  <input name="attr_humint_fail" title="@{humint_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_humint_r" value="@{humint_action}">	
                    <h3 class="aligned-left" data-i18n-title="HUMINT">HUMINT</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_humint" value="@{humint_action}">	</button>
                  <button class="none" type="action" name="act_humint-action"> </button>
                  <input type="hidden" name="attr_humint_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="HUMINT rank" title="HUMINT rank">
                <input data-i18n-placeholder="0" name="attr_humint" title="@{humint}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="law fail checkbox" title="law fail checkbox">
                  <input name="attr_law_fail" title="@{law_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_law_r" value="@{law_action}">	
                    <h3 class="aligned-left" data-i18n-title="law">law</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_law" value="@{law_action}">	</button>
                  <button class="none" type="action" name="act_law-action"> </button>
                  <input type="hidden" name="attr_law_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="law rank" title="law rank">
                <input data-i18n-placeholder="0" name="attr_law" title="@{law}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="medicine fail checkbox" title="medicine fail checkbox">
                  <input name="attr_medicine_fail" title="@{medicine_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_medicine_r" value="@{medicine_action}">	
                    <h3 class="aligned-left" data-i18n-title="medicine">medicine</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_medicine" value="@{medicine_action}">	</button>
                  <button class="none" type="action" name="act_medicine-action"> </button>
                  <input type="hidden" name="attr_medicine_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="medicine rank" title="medicine rank">
                <input data-i18n-placeholder="0" name="attr_medicine" title="@{medicine}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="melee weapons fail checkbox" title="melee weapons fail checkbox">
                  <input name="attr_melee_weapons_fail" title="@{melee_weapons_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_melee_weapons_r" value="@{melee_weapons_action}">	
                    <h3 class="aligned-left" data-i18n-title="melee weapons">melee weapons</h3><span data-i18n="(30%)" title="(30%)">(30%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_melee_weapons" value="@{melee_weapons_action}">	</button>
                  <button class="none" type="action" name="act_melee_weapons-action"> </button>
                  <input type="hidden" name="attr_melee_weapons_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="melee weapons rank" title="melee weapons rank">
                <input data-i18n-placeholder="0" name="attr_melee_weapons" title="@{melee_weapons}" placeholder="0" type="text" value="30"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="military science fail checkbox" title="military science fail checkbox">
                  <input name="attr_military_science_1_fail" title="@{military_science_1_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_military_science_1_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="military science" title="military science">military science</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_military_science_1_name" title="@{military_science_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_military_science_1_r" value="@{military_science_1_action}">	
                          <h3 class="aligned-left"><span title="military science">military science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_military_science_1_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_military_science_1" value="@{military_science_1_action}">	</button>
                        <button class="none" type="action" name="act_military_science_1-action"> </button>
                        <input type="hidden" name="attr_military_science_1_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_military_science_1_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="military science rank" title="military science rank">
                <input data-i18n-placeholder="0" name="attr_military_science_1" title="@{military_science_1}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="military science fail checkbox" title="military science fail checkbox">
                  <input name="attr_military_science_2_fail" title="@{military_science_2_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_military_science_2_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="military science" title="military science">military science</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_military_science_2_name" title="@{military_science_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_military_science_2_r" value="@{military_science_2_action}">	
                          <h3 class="aligned-left"><span title="military science">military science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_military_science_2_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_military_science_2" value="@{military_science_2_action}">	</button>
                        <button class="none" type="action" name="act_military_science_2-action"> </button>
                        <input type="hidden" name="attr_military_science_2_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_military_science_2_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="military science rank" title="military science rank">
                <input data-i18n-placeholder="0" name="attr_military_science_2" title="@{military_science_2}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="navigate fail checkbox" title="navigate fail checkbox">
                  <input name="attr_navigate_fail" title="@{navigate_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_navigate_r" value="@{navigate_action}">	
                    <h3 class="aligned-left" data-i18n-title="navigate">navigate</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_navigate" value="@{navigate_action}">	</button>
                  <button class="none" type="action" name="act_navigate-action"> </button>
                  <input type="hidden" name="attr_navigate_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="navigate rank" title="navigate rank">
                <input data-i18n-placeholder="0" name="attr_navigate" title="@{navigate}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="occult fail checkbox" title="occult fail checkbox">
                  <input name="attr_occult_fail" title="@{occult_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_occult_r" value="@{occult_action}">	
                    <h3 class="aligned-left" data-i18n-title="occult">occult</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_occult" value="@{occult_action}">	</button>
                  <button class="none" type="action" name="act_occult-action"> </button>
                  <input type="hidden" name="attr_occult_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="occult rank" title="occult rank">
                <input data-i18n-placeholder="0" name="attr_occult" title="@{occult}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="persuade fail checkbox" title="persuade fail checkbox">
                  <input name="attr_persuade_fail" title="@{persuade_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_persuade_r" value="@{persuade_action}">	
                    <h3 class="aligned-left" data-i18n-title="persuade">persuade</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_persuade" value="@{persuade_action}">	</button>
                  <button class="none" type="action" name="act_persuade-action"> </button>
                  <input type="hidden" name="attr_persuade_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="persuade rank" title="persuade rank">
                <input data-i18n-placeholder="0" name="attr_persuade" title="@{persuade}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="pharmacy fail checkbox" title="pharmacy fail checkbox">
                  <input name="attr_pharmacy_fail" title="@{pharmacy_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_pharmacy_r" value="@{pharmacy_action}">	
                    <h3 class="aligned-left" data-i18n-title="pharmacy">pharmacy</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_pharmacy" value="@{pharmacy_action}">	</button>
                  <button class="none" type="action" name="act_pharmacy-action"> </button>
                  <input type="hidden" name="attr_pharmacy_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="pharmacy rank" title="pharmacy rank">
                <input data-i18n-placeholder="0" name="attr_pharmacy" title="@{pharmacy}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="pilot fail checkbox" title="pilot fail checkbox">
                  <input name="attr_pilot_1_fail" title="@{pilot_1_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_pilot_1_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="pilot" title="pilot">pilot</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_pilot_1_name" title="@{pilot_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_pilot_1_r" value="@{pilot_1_action}">	
                          <h3 class="aligned-left"><span title="pilot">pilot</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_pilot_1_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_pilot_1" value="@{pilot_1_action}">	</button>
                        <button class="none" type="action" name="act_pilot_1-action"> </button>
                        <input type="hidden" name="attr_pilot_1_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_pilot_1_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="pilot rank" title="pilot rank">
                <input data-i18n-placeholder="0" name="attr_pilot_1" title="@{pilot_1}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="pilot fail checkbox" title="pilot fail checkbox">
                  <input name="attr_pilot_2_fail" title="@{pilot_2_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_pilot_2_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="pilot" title="pilot">pilot</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_pilot_2_name" title="@{pilot_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_pilot_2_r" value="@{pilot_2_action}">	
                          <h3 class="aligned-left"><span title="pilot">pilot</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_pilot_2_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_pilot_2" value="@{pilot_2_action}">	</button>
                        <button class="none" type="action" name="act_pilot_2-action"> </button>
                        <input type="hidden" name="attr_pilot_2_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_pilot_2_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="pilot rank" title="pilot rank">
                <input data-i18n-placeholder="0" name="attr_pilot_2" title="@{pilot_2}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="psychotherapy fail checkbox" title="psychotherapy fail checkbox">
                  <input name="attr_psychotherapy_fail" title="@{psychotherapy_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_psychotherapy_r" value="@{psychotherapy_action}">	
                    <h3 class="aligned-left" data-i18n-title="psychotherapy">psychotherapy</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_psychotherapy" value="@{psychotherapy_action}">	</button>
                  <button class="none" type="action" name="act_psychotherapy-action"> </button>
                  <input type="hidden" name="attr_psychotherapy_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="psychotherapy rank" title="psychotherapy rank">
                <input data-i18n-placeholder="0" name="attr_psychotherapy" title="@{psychotherapy}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="ride fail checkbox" title="ride fail checkbox">
                  <input name="attr_ride_fail" title="@{ride_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_ride_r" value="@{ride_action}">	
                    <h3 class="aligned-left" data-i18n-title="ride">ride</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_ride" value="@{ride_action}">	</button>
                  <button class="none" type="action" name="act_ride-action"> </button>
                  <input type="hidden" name="attr_ride_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="ride rank" title="ride rank">
                <input data-i18n-placeholder="0" name="attr_ride" title="@{ride}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="science fail checkbox" title="science fail checkbox">
                  <input name="attr_science_1_fail" title="@{science_1_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_science_1_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="science" title="science">science</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_science_1_name" title="@{science_1_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_science_1_r" value="@{science_1_action}">	
                          <h3 class="aligned-left"><span title="science">science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_science_1_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_science_1" value="@{science_1_action}">	</button>
                        <button class="none" type="action" name="act_science_1-action"> </button>
                        <input type="hidden" name="attr_science_1_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_science_1_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="science rank" title="science rank">
                <input data-i18n-placeholder="0" name="attr_science_1" title="@{science_1}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="science fail checkbox" title="science fail checkbox">
                  <input name="attr_science_2_fail" title="@{science_2_fail}" type="checkbox"/>
                </label>
                <div class="form-skill-group"> 
                  <label class="skill-button">
                    <input class="edit_test" type="hidden" name="attr_science_2_test"/><span class="edit_text">
                      <div class="special_div">
                        <h3><span data-i18n="science" title="science">science</span><span>:						</span></h3>
                      </div>
                      <input style="width:100%;" name="attr_science_2_name" title="@{science_2_name}" type="text" data-i18n-placeholder="choose one" placeholder="choose one"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="roll two pressable special_div undefined" type="roll" name="attr_science_2_r" value="@{science_2_action}">	
                          <h3 class="aligned-left"><span title="science">science</span><span class="postspace">:</span><span class="postspace"> </span><span name="attr_science_2_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                        <button class="none two" type="roll" name="roll_science_2" value="@{science_2_action}">	</button>
                        <button class="none" type="action" name="act_science_2-action"> </button>
                        <input type="hidden" name="attr_science_2_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_science_2_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
              </div>
              <label class="rank" data-i18n-title="science rank" title="science rank">
                <input data-i18n-placeholder="0" name="attr_science_2" title="@{science_2}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="search fail checkbox" title="search fail checkbox">
                  <input name="attr_search_fail" title="@{search_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_search_r" value="@{search_action}">	
                    <h3 class="aligned-left" data-i18n-title="search">search</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_search" value="@{search_action}">	</button>
                  <button class="none" type="action" name="act_search-action"> </button>
                  <input type="hidden" name="attr_search_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="search rank" title="search rank">
                <input data-i18n-placeholder="0" name="attr_search" title="@{search}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="SIGINT fail checkbox" title="SIGINT fail checkbox">
                  <input name="attr_sigint_fail" title="@{sigint_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_sigint_r" value="@{sigint_action}">	
                    <h3 class="aligned-left" data-i18n-title="SIGINT">SIGINT</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_sigint" value="@{sigint_action}">	</button>
                  <button class="none" type="action" name="act_sigint-action"> </button>
                  <input type="hidden" name="attr_sigint_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="SIGINT rank" title="SIGINT rank">
                <input data-i18n-placeholder="0" name="attr_sigint" title="@{sigint}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="stealth fail checkbox" title="stealth fail checkbox">
                  <input name="attr_stealth_fail" title="@{stealth_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_stealth_r" value="@{stealth_action}">	
                    <h3 class="aligned-left" data-i18n-title="stealth">stealth</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_stealth" value="@{stealth_action}">	</button>
                  <button class="none" type="action" name="act_stealth-action"> </button>
                  <input type="hidden" name="attr_stealth_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="stealth rank" title="stealth rank">
                <input data-i18n-placeholder="0" name="attr_stealth" title="@{stealth}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="surgery fail checkbox" title="surgery fail checkbox">
                  <input name="attr_surgery_fail" title="@{surgery_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_surgery_r" value="@{surgery_action}">	
                    <h3 class="aligned-left" data-i18n-title="surgery">surgery</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_surgery" value="@{surgery_action}">	</button>
                  <button class="none" type="action" name="act_surgery-action"> </button>
                  <input type="hidden" name="attr_surgery_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="surgery rank" title="surgery rank">
                <input data-i18n-placeholder="0" name="attr_surgery" title="@{surgery}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="survival fail checkbox" title="survival fail checkbox">
                  <input name="attr_survival_fail" title="@{survival_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_survival_r" value="@{survival_action}">	
                    <h3 class="aligned-left" data-i18n-title="survival">survival</h3><span data-i18n="(10%)" title="(10%)">(10%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_survival" value="@{survival_action}">	</button>
                  <button class="none" type="action" name="act_survival-action"> </button>
                  <input type="hidden" name="attr_survival_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="survival rank" title="survival rank">
                <input data-i18n-placeholder="0" name="attr_survival" title="@{survival}" placeholder="0" type="text" value="10"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="swim fail checkbox" title="swim fail checkbox">
                  <input name="attr_swim_fail" title="@{swim_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_swim_r" value="@{swim_action}">	
                    <h3 class="aligned-left" data-i18n-title="swim">swim</h3><span data-i18n="(20%)" title="(20%)">(20%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_swim" value="@{swim_action}">	</button>
                  <button class="none" type="action" name="act_swim-action"> </button>
                  <input type="hidden" name="attr_swim_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="swim rank" title="swim rank">
                <input data-i18n-placeholder="0" name="attr_swim" title="@{swim}" placeholder="0" type="text" value="20"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="unarmed combat fail checkbox" title="unarmed combat fail checkbox">
                  <input name="attr_unarmed_combat_fail" title="@{unarmed_combat_fail}" type="checkbox"/>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_unarmed_combat_r" value="@{unarmed_combat_action}">	
                    <h3 class="aligned-left" data-i18n-title="unarmed combat">unarmed combat</h3><span data-i18n="(40%)" title="(40%)">(40%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_unarmed_combat" value="@{unarmed_combat_action}">	</button>
                  <button class="none" type="action" name="act_unarmed_combat-action"> </button>
                  <input type="hidden" name="attr_unarmed_combat_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="unarmed combat rank" title="unarmed combat rank">
                <input data-i18n-placeholder="0" name="attr_unarmed_combat" title="@{unarmed_combat}" placeholder="0" type="text" value="40"/>
              </label>
            </div>
            <div class="section-skill-col">
              <div class="box">
                <label class="styled-checkbox center-items" data-i18n-title="unnatural fail checkbox" title="unnatural fail checkbox"><span class="nbsp"></span>
                </label>
                <div class="buttonwrapper">
                  <button class="roll two normal_div inSkills" type="action" name="attr_unnatural_r" value="@{unnatural_action}">	
                    <h3 class="aligned-left" data-i18n-title="unnatural">unnatural</h3><span data-i18n="(0%)" title="(0%)">(0%)</span>
                  </button>
                  <!--button.two(type='roll' class=classes name='roll_'+rollName value='@{'+rollName+'_action}') 	-->
                  <button class="none two" type="roll" name="roll_unnatural" value="@{unnatural_action}">	</button>
                  <button class="none" type="action" name="act_unnatural-action"> </button>
                  <input type="hidden" name="attr_unnatural_action" value=""/>
                </div>
              </div>
              <label class="rank" data-i18n-title="unnatural rank" title="unnatural rank">
                <input data-i18n-placeholder="0" name="attr_unnatural" title="@{unnatural}" placeholder="0" type="text" value="0"/>
              </label>
            </div>
            <div class="section-repeating-container">
              <div class="section-title border-bottom">
                <h3 class="margin-left" data-i18n="foriegn languages and other skills:" data-i18n-title="foriegn languages and other skills:">foriegn languages and other skills:	</h3>
              </div>
              <div class="section-body">
                <fieldset class="repeating_skills">
                  <div class="section-skill-col">
                    <div class="box">
                      <label class="styled-checkbox center-items" data-i18n-title="undefined fail checkbox" title="undefined fail checkbox">
                        <input name="attr_fail" title="@{undefined_fail}" type="checkbox"/>
                      </label>
                      <div class="form-skill-group"> 
                        <label class="skill-button">
                          <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                            <input style="width:100%;" name="attr_name" title="@{repeating_skills_${x}__name}" type="text" value="skill"/></span><span class="unedit_text">
                            <div class="buttonwrapper">
                              <button class="repeating_roll two pressable additional_div undefined" type="action" name="attr_skill_r" value="@{skill_action}">	
                                <h3 class="aligned-left"><span name="attr_name"></span>
                                </h3>
                                <!--if (spanButton != '')
                                span.para(data-i18n=spanButton title=spanButton)= spanButton
                                
                                
                                -->
                              </button>
                              <button class="two none pressable additional_div undefined" type="roll" name="roll_skill" value="@{skill_action}">	</button>
                              <button class="none" type="action" name="act_skill-action"> </button>
                              <input type="hidden" name="attr_skill_action" value=""/>
                            </div></span>
                        </label>
                        <label class="switch-edit">
                          <input type="checkbox" name="attr_test" value="editable"/><span class="vslider"></span>
                        </label>
                      </div>
                    </div>
                    <label class="rank" data-i18n-title="skill rank" title="skill rank">
                      <input data-i18n-placeholder="0" name="attr_rank" title="@{repeating_skills_${x}_rank}" placeholder="0" type="text" value=""/>
                    </label>
                  </div>
                </fieldset>
              </div>
            </div>
          </div>
          <div class="section-directions center updateinfo"> 
            <div class="subgrid"><span data-i18n="Check a box when you attempt to use a skill and fail. After the session, add 1d4 to each checked skill and erase all checks.">Check a box when you attempt to use a skill and fail. After the session, add 1d4 to each checked skill and erase all checks.</span>
              <button class="lvl" name="act_levelup" type="action">
                <h3 class="lvlup">Q</h3>
              </button>
            </div>
            <div class="othergrid">
              <input type="checkbox"/><span></span>
              <div class="summary">
                <fieldset class="repeating_summary">
                  <div class="section-summary"><span class="item1" name="attr_skillname"></span><span class="item2" style="color:red;" name="attr_oldval"></span><span class="item3 slash"></span><span class="item4" style="color:green;" name="attr_newval"></span></div>
                </fieldset>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--INJURIES-->
      <div class="grid header-body injuries border" id="injuries-pc">
        <div class="section-header">
          <h1 data-i18n="injuries" data-i18n-title="injuries">injuries</h1>
        </div>
        <div class="grid section-body border">
          <h2 class="aligned-left" data-i18n="14. wounds and ailments" data-i18n-title="14. wounds and ailments">14. wounds and ailments</h2>
          <div class="border-bottom">
            <textarea data-i18n-placeholder="injuries" name="attr_injuries" placeholder="injuries" title="@{injuries}"></textarea>
          </div>
          <div class="section-directions center"><span data-i18n="Has First Aid been attempted since the last injury?">Has First Aid been attempted since the last injury?</span>
            <label class="styled-checkbox" data-i18n-title="checkbox for first aid" title="checkbox for first aid">
              <input name="attr_injuries_first_aid" type="checkbox"/>
            </label><span data-i18n="yes: only Medicine, Surgery, or long-term rest can help further.">yes: only Medicine, Surgery, or long-term rest can help further.</span>
          </div>
        </div>
      </div>
      <!--EQUIPMENT-->
      <div class="grid header-body equipment border" id="equipment-pc">
        <div class="section-header">
          <h1 data-i18n="equipment" data-i18n-title="equipment">equipment</h1>
        </div>
        <div class="grid section-body border">
          <h2 class="aligned-left" data-i18n="15. armor and gear" data-i18n-title="15. armor and gear">15. armor and gear</h2>
          <div class="border-bottom">
            <textarea data-i18n-placeholder="armor and gear" name="attr_armor_and_gear" placeholder="armor and gear" title="@{armor_and_gear}"></textarea>
          </div>
          <div class="section-directions center border-bottom"><span data-i18n="Body armor reduces the damage of all attacks except Called Shots and successful Lethality rolls.">Body armor reduces the damage of all attacks except Called Shots and successful Lethality rolls.</span></div>
          <div class="grid section-weapons border-bottom">
            <h2 data-i18n="16. weapons" data-i18n-title="16. weapons" title="16. weapons">16. weapons</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="skill %" data-i18n-title="skill %" title="skill %">skill %</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="base range" data-i18n-title="base range" title="base range">base range</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="damage" data-i18n-title="damage" title="damage">damage</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="armor piercing" data-i18n-title="armor piercing" title="armor piercing">armor piercing</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="lethality %" data-i18n-title="lethality %" title="lethality %">lethality %</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="kill radius" data-i18n-title="kill radius" title="kill radius">kill radius</h2>
            <div class="vert-line"></div>
            <h2 data-i18n="ammo" data-i18n-title="ammo" title="ammo">ammo</h2>
          </div>
          <div class="repeating-container border-bottom">
            <fieldset class="repeating_weapons">
              <div class="grid section-weapons border-bottom repeating-section-weapons">
                <input type="hidden" name="attr_weapons"/>
                <input name="attr_haslethality" type="hidden" value="0"/>
                <input name="attr_hasdamage" type="hidden" value="0"/>
                <input name="attr_hasammo" type="hidden" value="0"/>
                <button class="none two" type="roll" name="roll_damage" value="@{damage_action}">							</button>
                <button class="none" type="action" name="act_damage-action"> </button>
                <input type="hidden" name="attr_damage_action" value=""/>
                <button class="none two" type="roll" name="roll_damageCritical" value="@{damageCritical_action}">							</button>
                <button class="none" type="action" name="act_damageCritical-action"> </button>
                <input type="hidden" name="attr_damageCritical_action" value=""/>
                <button class="none two" type="roll" name="roll_lethality" value="@{lethality_action}">							</button>
                <button class="none" type="action" name="act_lethality-action"> </button>
                <input type="hidden" name="attr_lethality_action" value=""/>
                <button class="none two" type="roll" name="roll_lethalityCritical" value="@{lethalityCritical_action}">							</button>
                <button class="none" type="action" name="act_lethalityCritical-action"> </button>
                <input type="hidden" name="attr_lethalityCritical_action" value=""/>
                <button class="none two" type="roll" name="roll_double_damage" value="@{double_damage_action}">							</button>
                <button class="none" type="action" name="act_double_damage-action"> </button>
                <input type="hidden" name="attr_double_damage_action" value=""/>
                <button class="none two" type="roll" name="roll_double_damageCritical" value="@{double_damageCritical_action}">							</button>
                <button class="none" type="action" name="act_double_damageCritical-action"> </button>
                <input type="hidden" name="attr_double_damageCritical_action" value=""/>
                <button class="none two" type="roll" name="roll_selective_fire" value="@{selective_fire_action}">							</button>
                <button class="none" type="action" name="act_selective_fire-action"> </button>
                <input type="hidden" name="attr_selective_fire_action" value=""/>
                <button class="none two" type="roll" name="roll_selective_fireCritical" value="@{selective_fireCritical_action}">							</button>
                <button class="none" type="action" name="act_selective_fireCritical-action"> </button>
                <input type="hidden" name="attr_selective_fireCritical_action" value=""/>
                <div class="form-normal-group">
                  <label class="weapon_button">
                    <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                      <input style="width:100%; padding: 0px 0px; margin: 0px 0;box-sizing: border-box;" type="text" name="attr_name" value="weapon" title="@{repeating_weapons_${x}_weapons}"/></span><span class="unedit_text">
                      <div class="buttonwrapper">
                        <button class="repeating_roll one pressable special_div" type="action" name="attr_weapons_r" value="@{weapons_action}"> 
                          <h3 class="aligned-left"><span name="attr_name"></span>
                          </h3>
                          <!--if (spanButton != '')
                          span.para(data-i18n=spanButton title=spanButton)= spanButton
                          
                          
                          -->
                        </button>
                        <button class="none one pressable special_div" type="action" name="attr_weapons_r" value="@{weapons_action}">	</button>
                        <button class="none" type="action" name="act_weapons-action"> </button>
                        <input type="hidden" name="attr_weapons_action" value=""/>
                      </div></span>
                  </label>
                  <label class="switch-edit">
                    <input type="checkbox" name="attr_test" value="editable"/><span class="vslider"></span>
                  </label>
                </div>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="skill % input" title="skill % input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input data-i18n-placeholder="skill %" name="attr_skill_percent" list="weaponskills" placeholder="skill %" title="@{repeating_weapons_${x}_skill_percent}" type="text" value=""/></span><span class="unedit_text"><span name="attr_skill_span"></span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="base range input" title="base range input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input data-i18n-placeholder="base range" name="attr_base_range" placeholder="base range" title="@{repeating_weapons_${x}_base_range}" type="text" value=""/></span><span class="unedit_text"><span name="attr_base_range"></span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="damage input" title="damage input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input class="blast" name="attr_blast_radius" type="checkbox" value="active"/><span class="wblast"><span>- </span></span><span class="noblast">
                      <input class="shotgun" name="attr_double_damage" type="checkbox" value="active"/><span class="noshotgun">
                        <input data-i18n-placeholder="damage" name="attr_damage" placeholder="damage" title="@{repeating_weapons_${x}_damage}" type="text" value=""/></span><span class="wshotgun">
                        <input data-i18n-placeholder="damage" name="attr_damage" placeholder="damage" title="@{repeating_weapons_${x}_damage}" type="text" value=""/><span>/</span>
                        <input data-i18n-placeholder="damage" name="attr_damage_2" placeholder="damage" title="@{repeating_weapons_${x}_damage}" type="text" value=""/></span></span></span><span class="unedit_text">
                    <input class="blast" name="attr_blast_radius" type="checkbox" value="active"/><span class="wblast"><span>- </span></span><span class="noblast">
                      <input class="shotgun" name="attr_double_damage" type="checkbox" value="active"/><span class="noshotgun"><span data-i18n-placeholder="damage" name="attr_damage"></span></span><span class="wshotgun"><span data-i18n-placeholder="damage" name="attr_damage"></span><span>/</span><span data-i18n-placeholder="damage" name="attr_damage_2"></span></span></span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="armor piercing input" title="armor piercing input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input data-i18n-placeholder="armor piercing" name="attr_armor_piercing" placeholder="armor piercing" title="@{repeating_weapons_${x}_armor_piercing}" type="text" value=""/></span><span class="unedit_text"><span name="attr_armor_piercing"></span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="lethality % input" title="lethality % input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input class="shotgun" name="attr_shotgun" type="checkbox" value="active"/>
                    <input class="noshotgun" data-i18n-placeholder="lethality %" name="attr_lethality_percent" placeholder="lethality %" title="@{repeating_weapons_${x}_lethality_percent}" type="number" value=""/><span class="wshotgun">-</span></span><span class="unedit_text">
                    <input class="shotgun" name="attr_shotgun" type="checkbox" value="active"/><span class="noshotgun" data-i18n-placeholder="lethality %" name="attr_lethality_percent"></span><span class="wshotgun">-</span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="kill radius input" title="kill radius input">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                    <input data-i18n-placeholder="kill radius" name="attr_kill_radius" placeholder="kill radius" title="@{repeating_weapons_${x}_kill_radius}" type="text" value=""/></span><span class="unedit_text"><span name="attr_kill_radius"></span></span>
                </label>
                <div class="vert-line"></div>
                <label class="weapon_label" data-i18n-title="ammo input" title="ammo input" style="display: grid; position:relative;">
                  <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text allowpopup">
                    <input data-i18n-placeholder="ammo" name="attr_ammo_max" placeholder="ammo" title="@{repeating_weapons_${x}_ammo_max}" type="number" value=""/>
                    <div class="othergrid advancedinfo">
                      <input class="advanced" type="checkbox"/><span></span>
                      <div class="modifiers"> 
                        <!--.modifiers-body -->
                        <h2 class="title" data-i18n="advanced features">advanced features</h2>
                        <div class="item-shotgun">
                          <input class="fix-check" name="attr_shotgun" type="checkbox" value="active"/><span><span data-i18n="shotgun">shotgun</span> <span class="para">+20%</span></span><span class="double_damage">
                            <input class="fix-check" name="attr_double_damage" type="checkbox" value="active"/><span data-i18n="double damage">double damage</span></span>
                        </div>
                        <div class="item-check">
                          <input class="fix-check" name="attr_blast_radius" type="checkbox" value="active"/><span><span data-i18n="blast radius">blast radius</span> <span class="para">+20%</span></span>
                        </div>
                        <div class="item-acc"> 
                          <input class="fix-check" name="attr_accessories" type="checkbox" value="active"/><span data-i18n="accessories">accessories</span>
                          <input class="small-select" data-i18n-placeholder="Holographic sight Standard" type="text" name="attr_accessoriesName" title="@{repeating_weapons_${x}_accessoriesName}" placeholder="Holographic sight" value=""/><span style="display:inline;justify-self:end;"><span data-i18n="modifier">modifier</span>
                            <input type="text" list="common_modifiers" name="attr_accessoriesMod" title="@{repeating_weapons_${x}_accessoriesMod}" value="0" maxlength="2" size="3" style="width: 3rem;"/><span class="perc">%</span></span>
                        </div>
                        <div class="item-sel">
                          <input class="fix-check" name="attr_selfire" type="checkbox" value="active"/><span data-i18n-value="selective fire">selective fire</span>
                          <input type="hidden" name="attr_selfireType" value="short burst"/>
                          <select class="small-select" name_="attr_selfireType">
                            <option value="short burst"><span class="selfire"> <span class="first" data-i18n="short burst">short burst</span> <span>(</span><span data-i18n="3 ammo">3 ammo</span><span>)</span></span></option>
                            <option value="long burst"><span class="selfire"> <span class="first" data-i18n="long burst"> long burst</span> <span>(</span><span class="para" data-i18n="5 ammo">5 ammo</span><span>)</span></span></option>
                            <option value="short spray"><span class="selfire"> <span class="first" data-i18n="short spray">short spray</span> <span>(</span><span class="para" data-i18n="10 ammo">10 ammo</span><span>)</span></span></option>
                            <option value="long spray"> long spray<span class="selfire"> <span class="first" data-i18n="long spray"> long spray</span> <span>(</span><span class="para" data-i18n="20 ammo">20 ammo</span><span>)</span></span></option>
                          </select><span style="display:inline;justify-self:end;"><span data-i18n="lethality">lethality</span>
                            <input type="text" name="attr_selfireLethality" title="@{repeating_weapons_${x}_selfireLethality}" value="10" maxlength="2" size="3" style="width: 3rem;"/><span>%</span></span>
                        </div>
                      </div>
                    </div></span><span class="unedit_text">
                    <input class="hasammo" type="hidden" name="attr_hasammo" value="0"/><span class="wammo">
                      <input data-i18n-placeholder="ammo" name="attr_ammo" placeholder="ammo" title="@{repeating_weapons_${x}_ammo}" value="0"/><span>/</span><span data-i18n-placeholder="ammo" name="attr_ammo_max"></span></span><span class="noammo"><span>-</span></span></span>
                </label>
              </div>
            </fieldset>
          </div>
        </div>
      </div>
      <!--REMARKS-->
      <div class="grid header-body remarks border" id="remarks-pc">
        <div class="section-header">
          <h1 data-i18n="remarks" data-i18n-title="remarks">remarks</h1>
        </div>
        <div class="grid section-body border">
          <div class="section border-bottom">
            <h2 class="aligned-left" data-i18n="17. personal details and notes" data-i18n-title="17. personal details and notes">17. personal details and notes</h2>
            <textarea name="attr_personal_details_and_notes" placeholder="personal details and notes" title="@{personal_details_and_notes}"></textarea>
          </div>
          <div class="vert-line"></div>
          <div class="section border-bottom">
            <div class="section border-bottom">
              <h2 class="aligned-left" data-i18n="18. developments which affect home and family" data-i18n-title="18. developments which affect home and family">18. developments which affect home and family</h2>
              <textarea class="resizable resizable" data-i18n-placeholder="developments which affect home and family" name="attr_developments_which_affect_home_and_family" placeholder="developments which affect home and family" title="@{developments_which_affect_home_and_family}"></textarea>
            </div>
            <div class="grid section-special-training border-bottom">
              <h2 class="aligned-left" data-i18n="19. special training" data-i18n-title="19. special training">19. special training				</h2>
              <h2 class="aligned-left" data-i18n="skill or stat used" data-i18n-title="skill or stat used">skill or stat used</h2>
            </div>
            <div class="repeating-container border-bottom">
              <fieldset class="repeating_special">
                <div class="grid body section-special-training border-bottom">
                  <input name="attr_name" type="hidden"/>
                  <div class="form-group">
                    <label>
                      <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                        <input style="width:100%;" name="attr_name" title="@{repeating_special_${x}__name}" type="text" value="skill"/></span><span class="unedit_text">
                        <div class="buttonwrapper">
                          <button class="repeating_roll two pressable additional_div undefined" type="action" name="attr_special_r" value="@{special_action}">	
                            <h3 class="aligned-left"><span name="attr_name"></span>
                            </h3>
                            <!--if (spanButton != '')
                            span.para(data-i18n=spanButton title=spanButton)= spanButton
                            
                            
                            -->
                          </button>
                          <button class="two none pressable additional_div undefined" type="roll" name="roll_special" value="@{special_action}">	</button>
                          <button class="none" type="action" name="act_special-action"> </button>
                          <input type="hidden" name="attr_special_action" value=""/>
                        </div></span>
                    </label>
                    <label class="switch-edit">
                      <input type="checkbox" name="attr_test" value="editable"/><span class="vslider"></span>
                    </label>
                  </div>
                  <label class="special_label" data-i18n-title="skill or stat used" title="skill or stat used">
                    <input class="edit_test" type="hidden" name="attr_test"/><span class="edit_text">
                      <input data-i18n-placeholder="skill or stat used" name="attr_skill_or_stat_used" placeholder="skill or stat used" list="allskills" title="@{repeating_special_${x}_skill_or_stat_used}" type="text" value=""/></span><span class="unedit_text"><span name="attr_skill_span"></span></span>
                  </label>
                </div>
              </fieldset>
            </div>
          </div>
          <div class="section-directions center"><span data-i18n="Please indicate why this agent was recruited and why the agent agreed to be recruited.">Please indicate why this agent was recruited and why the agent agreed to be recruited.</span></div>
        </div>
      </div>
      <!--AUTHORIZING OFFICER-->
      <div class="grid authorizing-officer border">
        <div class="section">
          <h2 class="margin-left" data-i18n="20. authorizing officer" data-i18n-title="20. authorizing officer">20. authorizing officer</h2>
          <label data-i18n-title="authorizing officer" title="authorizing officer">
            <input data-i18n-placeholder="authorizing officer" name="attr_authorizing_officer" placeholder="authorizing officer" title="authorizing officer" type="text" value=""/>
          </label>
        </div>
        <div class="vert-line"></div>
        <div class="section">
          <h2 class="margin-left" data-i18n="21. agent signature" data-i18n-title="21. agent signature">21. agent signature</h2>
          <label data-i18n-title="agent signature" title="agent signature">
            <input data-i18n-placeholder="agent signature" name="attr_agent_signature" placeholder="agent signature" title="agent signature" type="text" value=""/>
          </label>
        </div>
      </div>
      <!--BOTTOM DECORATION-->
      <div class="grid section-bottom-decor"><span class="uppercase" data-i18n="DD">DD</span><span class="uppercase" data-i18n="united states form">united states form</span><span data-i18n="315">315</span><span></span><span class="uppercase" data-i18n="top secret//orcon//special access required delta green agent documenation sheet">top secret//orcon//special access required delta green agent documenation sheet <span name="attr_version"></span></span><span data-i18n="112382">112382</span></div>
    </div>
  </div>
  <!-- ROLL TEMPLATE-->
  <!-- =============================-->
  <!-- - LETHALITY DAMAGE-->
  <div class="rolltemplates"> 
    <rolltemplate class="sheet-rolltemplate-fancy-bonds">
      <div class="sheet-template-container">{{#name}}
          <div class="sheet-template-superheader">
            <h2>{{name}}</h2>
          </div>{{/name}}
          {{#header}}
          <div class="sheet-template-header">
            <h1> {{header}} </h1>
            <h2>{{#subheader}}({{subheader}}){{/subheader}}</h2>
          </div>{{/header}}   
        <div class="sheet-template-body">
          <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-rolltitle">Bond: </span><span><span class="sheet-rollbefore aligned-left">{{score}}</span><span class="sheet-rolltext aligned-left"> </span><span class="sheet-rollafter aligned-left">{{computed::score}}</span></span></div>
          <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-rolltitle">WP: </span><span><span class="sheet-rollbefore aligned-left">{{local_wp}}</span><span class="sheet-rolltext aligned-left"> </span><span class="sheet-rollafter aligned-left">{{computed::local_wp}}</span></span></div>{{#rollTotal() computed::zerowp 1}}
          <div class="sheet-template-row sheet-template-onerows"> <span class="inlinerollresult" data-i18n="projection fails at 0 willpower.">projection fails at 0 willpower.</span></div>{{/rollTotal() computed::zerowp 1}}
          {{#rollTotal() computed::zerowp 1}}
          <div class="sheet-template-row sheet-template-onerows"> <span class="inlinerollresult" data-i18n="repression fails at 0 willpower.">repression automatically fail at 0 willpower. </span></div>{{/rollTotal() computed::zerowp 1}}
          {{#^rollTotal() computed::zerowp 1}}
          {{#projection}}
          <div class="sheet-template-row sheet-template-onerow"> <span class="inlinerollresult">{{dice}} SAN</span></div>{{/projection}}
          {{/^rollTotal() computed::zerowp 1}}
        </div>
      </div>{{#^rollTotal() computed::zerowp 1}}
      {{#repression}}
      <div class="sheet-template-reaction"> 
        <div class="sheet-template-button">{{repress}}</div>
      </div>{{/repression}}
      {{/^rollTotal() computed::zerowp 1}}
    </rolltemplate>
  </div>
  <rolltemplate class="sheet-rolltemplate-fancy-rituals"></rolltemplate>
  <rolltemplate class="sheet-rolltemplate-fancy-damages"> 
    <div class="sheet-template-container">
       {{#damage}}{{#name}}
        <div class="sheet-template-superheader">
          <h2>{{name}}</h2>
        </div>{{/name}}
        {{#header}}
        <div class="sheet-template-header">
          <h1> {{header}} </h1>
          <h2>{{#subheader}}({{subheader}}){{/subheader}}</h2>
        </div>{{/header}}   {{/damage}}
      {{#lethality}}{{#name}}
        <div class="sheet-template-superheader">
          <h2>{{name}}</h2>
        </div>{{/name}}
        {{#header}}
        <div class="sheet-template-header">
          <h1> {{header}} </h1>
          <h2>{{#subheader}}({{subheader}}%){{/subheader}}</h2>
        </div>{{/header}}   {{/lethality}}
      <div class="sheet-template-body">
        <div class="sheet-template-row sheet-template-tworows"> </div>{{#damage}}
        <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="damage">damage</span><span class="sheet-template-computed"><span>{{damage}}</span></span></div>{{/damage}}
        {{#lethality}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-computed"><span class="sheet-template-percent">{{roll}}</span></span></div>
        <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="lethality">lethality</span><span class="sheet-template-computed"><span>{{computed::lethality}}</span></span></div>
        <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="outcome">outcome</span>{{#^rollGreater() roll computed::lethality}}<span class="sheet-template-outcome" data-i18n="kill">kill </span>{{/^rollGreater() roll computed::lethality}} 
          {{#rollGreater() roll computed::lethality}}<span class="sheet-template-outcome" data-i18n="failure">failure</span>{{/rollGreater() roll computed::lethality}}
        </div>
        <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="damage">damage</span><span class="sheet-template-computed"><span>{{computed::roll}}</span></span></div>{{/lethality}}
        {{#rollTotal() trackbullets 1}}
        <div class="sheet-template-row sheet-template-tworows"> <span><span class="sheet-rollbefore aligned-left">{{current_ammo}}</span><span class="sheet-rolltext aligned-left"> </span><span class="sheet-rollafter aligned-left">{{computed::current_ammo}}</span></span></div>{{/rollTotal() trackbullets 1}}
      </div>
    </div>
  </rolltemplate>
  <rolltemplate class="sheet-rolltemplate-fancy-rolls">
    <div class="sheet-template-container">{{#name}}
        <div class="sheet-template-superheader">
          <h2>{{name}}</h2>
        </div>{{/name}}
        {{#header}}
        <div class="sheet-template-header">
          <h1> {{header}} </h1>
          <h2>{{#subheader}}({{subheader}}%){{/subheader}}</h2>
        </div>{{/header}}   {{#rollTotal() computed::zero_will_power 1}}
      <div class="sheet-template-overlay-zero-wp">
        <div class="sheet-template-overlay-zero-wp90">
          <div class="sheet-template-body">
            <div class="sheet-template-row sheet-template-onerow"> <span class="inlinerollresult" data-i18n="Actions automatically fail at 0 willpower.">Actions automatically fail at 0 willpower.</span></div>
            <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="failure">failure     </span></div>
          </div>
        </div>
      </div>{{/rollTotal() computed::zero_will_power 1}}    
      {{#rollTotal() computed::low_will_power 1}}
      <div class="sheet-template-overlay-low-wp">
        <div class="sheet-template-overlay-low-wp90">
          <div class="sheet-template-body">{{#^rollTotal() computed::modifier 0}}{{#rollTotal() computed::blast_radius 1}}
              <div class="sheet-template-row sheet-template-tworows"><span class="sheet-after-colons sheet-rolltitle" data-i18n="blast radius">blast radius:</span><span class="sheet-template-computed"> <span>+20%</span></span></div>{{/rollTotal() computed::blast_radius 1}}
              {{#rollTotal() computed::isShotgun 1}}
              <div class="sheet-template-row sheet-template-tworows"><span class="sheet-after-colons sheet-rolltitle" data-i18n="shotgun">shotgun</span><span class="sheet-template-computed"> <span>+20%</span></span></div>{{/rollTotal() computed::isShotgun 1}}
              {{#rollTotal() computed::hasaccessories 1}}
              <div class="sheet-template-row sheet-template-tworows"><span class="sheet-rolltitle">{{accessoriesName}}:</span><span class="sheet-template-computed">{{#rollGreater() computed::accessoriesMod 0}} <span class="sheet-template-plus sheet-template-percent">{{accessoriesMod}}</span>{{/rollGreater() computed::accessoriesMod 0}}
                  {{#rollLess() computed::accessoriesMod 0}}<span class="sheet-template-percent">{{accessoriesMod}}</span>{{/rollLess() computed::accessoriesMod 0}}</span></div>{{/rollTotal() computed::hasaccessories 1}}
              <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="modifier">modifier</span><span class="sheet-template-computed">{{#rollGreater() computed::modifier 0}}<span class="sheet-template-plus sheet-template-percent">{{computed::modifier}}</span>{{/rollGreater() computed::modifier 0}}
                  {{#rollLess() computed::modifier 0}}<span class="sheet-template-percent">{{computed::modifier}}</span>{{/rollLess() computed::modifier 0}}</span></div>{{/^rollTotal() computed::modifier 0}}
            <div class="sheet-template-row sheet-template-onerow"> <span class="inlinerollresult">{{dice}}</span>
              <!-- SUCCESS-->
            </div>{{#rollTotal() computed::isSuccess 1}}
            {{#rollTotal() computed::isCritical 1}}
            <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="critical">critical</span></div>{{/rollTotal() computed::isCritical 1}}
            {{/rollTotal() computed::isSuccess 1}}
            {{#rollTotal() computed::isSuccess 1}}
            {{#rollTotal() computed::isCritical 0}}
            <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="success">success</span></div>{{/rollTotal() computed::isCritical 0}}
            {{/rollTotal() computed::isSuccess 1}}
            {{#rollTotal() computed::isSuccess 0}}
            {{#rollTotal() computed::isCritical 1}}
            <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="fumble">fumble</span></div>{{/rollTotal() computed::isCritical 1}}
            {{/rollTotal() computed::isSuccess 0}}
            {{#rollTotal() computed::isSuccess 0}}
            {{#rollTotal() computed::isCritical 0}}
            <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="failure">failure</span></div>{{/rollTotal() computed::isCritical 0}}
            {{/rollTotal() computed::isSuccess 0}}
            {{#rollTotal() computed::isSuccess 1}}{{#damage}}
              <div class="sheet-template-row sheet-template-onerow"> 
                <div class="sheet-template-attack-buttons">
                   {{#rollTotal() computed::isCritical 0}}
                  <div class="sheet-template-button">{{damage}}</div>{{/rollTotal() computed::isCritical 0}}
                  {{#rollTotal() computed::isCritical 1}}
                  <div class="sheet-template-button">{{damageCritical}}</div>{{/rollTotal() computed::isCritical 1}}
                </div>
              </div>{{#double_damage}}
              <div class="sheet-template-row sheet-template-onerow"> 
                <div class="sheet-template-attack-buttons">
                   {{#rollTotal() computed::isCritical 0}}
                  <div class="sheet-template-button">{{double_damage}}</div>{{/rollTotal() computed::isCritical 0}}
                  {{#rollTotal() computed::isCritical 1}}
                  <div class="sheet-template-button">{{double_damageCritical}}</div>{{/rollTotal() computed::isCritical 1}}
                </div>
              </div>{{/double_damage}}
              {{/damage}}
              {{#lethality}}
              <div class="sheet-template-row sheet-template-onerow">
                <div class="sheet-template-attack-buttons">{{#rollTotal() computed::isCritical 0}}
                  <div class="sheet-template-button">{{lethality}}</div>{{/rollTotal() computed::isCritical 0}}
                  {{#rollTotal() computed::isCritical 1}}
                  <div class="sheet-template-button">{{lethalityCritical}}</div>{{/rollTotal() computed::isCritical 1}}
                </div>
              </div>{{/lethality}}
              {{#selective_fire}}
              <div class="sheet-template-row sheet-template-onerow">
                <div class="sheet-template-attack-buttons">{{#rollTotal() computed::isCritical 0}}
                  <div class="sheet-template-button">{{selective_fire}}</div>{{/rollTotal() computed::isCritical 0}}
                  {{#rollTotal() computed::isCritical 1}}
                  <div class="sheet-template-button">{{selective_fireCritical}}</div>{{/rollTotal() computed::isCritical 1}}
                </div>
              </div>{{/selective_fire}}{{/rollTotal() computed::isSuccess 1}}
          </div>
        </div>
      </div>{{/rollTotal() computed::low_will_power 1}}
      {{#rollTotal() computed::low_will_power 0}}
      {{#rollTotal() computed::zero_will_power 0}}
      <div class="sheet-template-body">{{#^rollTotal() computed::modifier 0}}{{#rollTotal() computed::blast_radius 1}}
          <div class="sheet-template-row sheet-template-tworows"><span class="sheet-after-colons sheet-rolltitle" data-i18n="blast radius">blast radius:</span><span class="sheet-template-computed"> <span>+20%</span></span></div>{{/rollTotal() computed::blast_radius 1}}
          {{#rollTotal() computed::isShotgun 1}}
          <div class="sheet-template-row sheet-template-tworows"><span class="sheet-after-colons sheet-rolltitle" data-i18n="shotgun">shotgun</span><span class="sheet-template-computed"> <span>+20%</span></span></div>{{/rollTotal() computed::isShotgun 1}}
          {{#rollTotal() computed::hasaccessories 1}}
          <div class="sheet-template-row sheet-template-tworows"><span class="sheet-rolltitle">{{accessoriesName}}:</span><span class="sheet-template-computed">{{#rollGreater() computed::accessoriesMod 0}} <span class="sheet-template-plus sheet-template-percent">{{accessoriesMod}}</span>{{/rollGreater() computed::accessoriesMod 0}}
              {{#rollLess() computed::accessoriesMod 0}}<span class="sheet-template-percent">{{accessoriesMod}}</span>{{/rollLess() computed::accessoriesMod 0}}</span></div>{{/rollTotal() computed::hasaccessories 1}}
          <div class="sheet-template-row sheet-template-tworows"> <span class="sheet-after-colons sheet-rolltitle" data-i18n="modifier">modifier</span><span class="sheet-template-computed">{{#rollGreater() computed::modifier 0}}<span class="sheet-template-plus sheet-template-percent">{{computed::modifier}}</span>{{/rollGreater() computed::modifier 0}}
              {{#rollLess() computed::modifier 0}}<span class="sheet-template-percent">{{computed::modifier}}</span>{{/rollLess() computed::modifier 0}}</span></div>{{/^rollTotal() computed::modifier 0}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="inlinerollresult">{{dice}}</span>
          <!-- SUCCESS-->
        </div>{{#rollTotal() computed::isSuccess 1}}
        {{#rollTotal() computed::isCritical 1}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="critical">critical</span></div>{{/rollTotal() computed::isCritical 1}}
        {{/rollTotal() computed::isSuccess 1}}
        {{#rollTotal() computed::isSuccess 1}}
        {{#rollTotal() computed::isCritical 0}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="success">success</span></div>{{/rollTotal() computed::isCritical 0}}
        {{/rollTotal() computed::isSuccess 1}}
        {{#rollTotal() computed::isSuccess 0}}
        {{#rollTotal() computed::isCritical 1}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="fumble">fumble</span></div>{{/rollTotal() computed::isCritical 1}}
        {{/rollTotal() computed::isSuccess 0}}
        {{#rollTotal() computed::isSuccess 0}}
        {{#rollTotal() computed::isCritical 0}}
        <div class="sheet-template-row sheet-template-onerow"> <span class="sheet-template-outcome" data-i18n="failure">failure</span></div>{{/rollTotal() computed::isCritical 0}}
        {{/rollTotal() computed::isSuccess 0}}
        {{#rollTotal() computed::isSuccess 1}}{{#damage}}
          <div class="sheet-template-row sheet-template-onerow"> 
            <div class="sheet-template-attack-buttons">
               {{#rollTotal() computed::isCritical 0}}
              <div class="sheet-template-button">{{damage}}</div>{{/rollTotal() computed::isCritical 0}}
              {{#rollTotal() computed::isCritical 1}}
              <div class="sheet-template-button">{{damageCritical}}</div>{{/rollTotal() computed::isCritical 1}}
            </div>
          </div>{{#double_damage}}
          <div class="sheet-template-row sheet-template-onerow"> 
            <div class="sheet-template-attack-buttons">
               {{#rollTotal() computed::isCritical 0}}
              <div class="sheet-template-button">{{double_damage}}</div>{{/rollTotal() computed::isCritical 0}}
              {{#rollTotal() computed::isCritical 1}}
              <div class="sheet-template-button">{{double_damageCritical}}</div>{{/rollTotal() computed::isCritical 1}}
            </div>
          </div>{{/double_damage}}
          {{/damage}}
          {{#lethality}}
          <div class="sheet-template-row sheet-template-onerow">
            <div class="sheet-template-attack-buttons">{{#rollTotal() computed::isCritical 0}}
              <div class="sheet-template-button">{{lethality}}</div>{{/rollTotal() computed::isCritical 0}}
              {{#rollTotal() computed::isCritical 1}}
              <div class="sheet-template-button">{{lethalityCritical}}</div>{{/rollTotal() computed::isCritical 1}}
            </div>
          </div>{{/lethality}}
          {{#selective_fire}}
          <div class="sheet-template-row sheet-template-onerow">
            <div class="sheet-template-attack-buttons">{{#rollTotal() computed::isCritical 0}}
              <div class="sheet-template-button">{{selective_fire}}</div>{{/rollTotal() computed::isCritical 0}}
              {{#rollTotal() computed::isCritical 1}}
              <div class="sheet-template-button">{{selective_fireCritical}}</div>{{/rollTotal() computed::isCritical 1}}
            </div>
          </div>{{/selective_fire}}{{/rollTotal() computed::isSuccess 1}}
      </div>{{/rollTotal() computed::zero_will_power 0}}
      {{/rollTotal() computed::low_will_power 0}}
    </div>{{#ritual}}
    {{/ritual}}
  </rolltemplate>
</div>
<!--SHEETWORKERS-->
<!-- =============================-->
<script type="text/worker">
  

let isInitialized = false;

const setAttributes = (update, silent) => { 
	(silent === true) ? setAttrs(update, {silent:true}) : setAttrs(update); 
};

// === ATTRIBUTE ARRAYS
	// note: I had the underscore in front of the arrays key to distinguish it from the name of the attribute
const arrays = {
		_stats: ['strength', 'constitution', 'dexterity', 'intelligence', 'power', 'charisma'],
		_hit_points: ['strength_score', 'constitution_score'],
		_sanity_points: ['power_score'], //ALSO USED FOR BREAKING POINTS
		_willpower_points: ['power_score'],
		_toggles: ['settings'],
		_sanity_loss: ['san_success', 'san_failure'],
		_skills:['accounting', 'alertness', 'anthropology', 'archeology', 'art_1', 'art_2', 'artillery', 'athletics', 'bureaucracy', 'computer_science', 'craft_1', 'craft_2', 'criminology', 'demolitions', 'disguise', 'dodge', 'drive', 'firearms','first_aid', 'forensics', 'heavy_machinery', 'heavy_weapons', 'history', 'humint', 'law', 'medicine', 'melee_weapons', 'military_science_1', 'military_science_2', 'navigate', 'occult', 'persuade', 'pharmacy', 'pilot_1','pilot_2', 'psychotherapy','ride', 'science_1','science_2', 'search' , 'sigint' , 'stealth' , 'surgery' , 'survival', 'swim', 'unarmed_combat'],
		_colored_derivative:['willpower','hit'],
		_derived_rolls:['sanity_points','luck'],
		_disorder_related:['sanity_points','breaking_point'],
		_bonds_local:['willpower_points','sanity_points'],
		_derived_modifiers:['willpower_points','low_will_power','zero_will_power'],
		_settings_wp:[`mod_will_power_check`],	
		_adaptation:['violence','helplessness'],
		_editable_skills:['art_1','art_2','craft_1','craft_2','military_science_1','military_science_2','pilot_1','pilot_2','science_1','science_2'],
		_weapon :["name", "skill_percent", "base_range", "damage", "armor_piercing", "lethality_percent", "ammo"],
		
};

const _repeating_sections={
	'skill':'skills',
	'bond':'bonds',
	'special':'special',
	'weapons':'weapons'};

const _repeating_damages = [
	'damage',
	'damageCritical',
	'lethality',
	'lethalityCritical',
	'damage_2',
	'damage_2Critical',
	'selective_fire',
	'selective_fireCritical',
]

const _rd100 = `[[1d100]]`;
const _rd4   = `[[1d4]]`;
const _rd6   = `[[1d6]]`;
const _rd8   = `[[1d8]]`;
const _rd10  = `[[1d10]]`;
const _rd12  = `[[1d12]]`;
const _rd20  = `[[1d20]]`;
const _queryModifier = `?{Modifier|0|+20%,20|+40%,40|-20%,-20|-40%,-40|custom (%),?{custom (%)}}`;
const prefix_skill_roll = `@{gm_toggle} &{template:fancy-rolls} {{name=@{character_name}}} {{dice=[[${_rd100}]]}}`; 
const prefix_damage_roll = `@{gm_toggle} &{template:fancy-damages} {{name=@{character_name}}}`;
const prefix_bond_roll = `@{gm_toggle} &{template:fancy-bonds} {{character_id=@{character_id}}}{{name=@{character_name}}} {{dice=[[${_rd4}]]}}`; 

 // check skill value for weapons and special training
 const isSkillNumber = (str) => {
    let num=Number(str);
    return !isNaN(num) && num>=0 && num<=99
};


// check if linking skill in in linking form
const isStringInForm=(str)=> {
    var regex = /^@\{[\w\s]+\}$/;
    return regex.test(str);
};

// used for linking skills
const cleanedSkill= (str) =>{return String(str).toLowerCase().replace(' ','_').replace('@{','').replace('}','')};

// When the trigger comes from another call
const isMinorityReport = (eventInfo) => !(eventInfo.hasOwnProperty('newValue'));


// check if the format is the one of a linking skill
const isValidSkill=(str)=> {
    console.info('input string:',str);
    const compar=cleanedSkill(String(str));
    console.info('output str:',compar);
    return arrays['_skills'].concat(arrays['_stats']).includes(compar);
};

on(`remove:repeating_skills`, (eventInfo) => {
	console.info('repeating remove skills removed',eventInfo);
});


const isEmpty = (obj) => Object.keys(obj).length === 0 && obj.constructor === Object;

const getSections = function(sectionDetails,callback){
	let queueClone = _.clone(sectionDetails);
	const worker = (queue,repeatAttrs=[],sections={})=>{
	  let detail = queue.shift();
	  console.log('in getSections',detail.section);
	  getSectionIDs(detail.section,(IDs)=>{
		sections[detail.section] = IDs;
		IDs.forEach((id)=>{
		  detail.fields.forEach((f)=>{
			repeatAttrs.push(`${detail.section}_${id}_${f}`);
		  });
		});
		repeatAttrs.push(`_reporder_${detail.section}`);
		if(queue.length){
		  worker(queue,repeatAttrs,sections);
		}else{
		  callback(repeatAttrs,sections);
		}
	  });
	};
	if(!queueClone[0]){
	  callback([],{});
	}else{
	  worker(queueClone);
	}
  };

// Update span on change
const updateSkillSpanOnChange=(skill,value,update,isWhat) =>{
    console.info('skill',skill);
    console.info('value',value);
	
	const rep_and_field={'weapons':'skill_percent','special':'skill_or_stat_used'};
	const sectionDetails = [{section:'repeating_special', fields:['skill_or_stat_used']},
		{section:'repeating_weapons',fields:['skill_percent']}]
	

	getSections(sectionDetails,(attr)=>{
		console.log(attr);
		const allskills1=attr.filter(el => el.startsWith(sectionDetails[0][`section`]) && el.endsWith(sectionDetails[0][`fields`][0]));
		const allskills2=attr.filter(el => el.startsWith(sectionDetails[1][`section`]) && el.endsWith(sectionDetails[1][`fields`][0]));
		const allids1= allskills1.map(el => el.replace(`_${sectionDetails[0][`fields`][0]}`,''));
		const allids2= allskills2.map(el => el.replace(`_${sectionDetails[1][`fields`][0]}`,''));
		const len1=allids1.length;
		const len2=allids2.length;
		console.info(`allids1:`,allids1);
		console.info(`allids2:`,allids2);
		console.info(`allskills1:`,allskills1);
		console.info(`allskills2:`,allskills2);
		getAttrs(allskills1.concat(allskills2),(v)=>{
				
			for (i=0;i<len1; i++){
				if (cleanedSkill(v[allskills1[i]])===skill){
					update[`${allids1[i]}_skill_span`]=value;
				}
				
			}

			for (i=0;i<len2; i++){
			if (cleanedSkill(v[allskills2[i]])===skill){
					update[`${allids2[i]}_skill_span`]=value;
				}
			}

			setAttrs(update,{silent:true},()=>{
				console.log(`update ${isWhat} on change`);
				console.log(`update ${skill}  on change`);
				console.info(`update:`,update);
			});
		});

	});

    
}


const saneffects=(snew,sold,smax,bnew,bmax,bold,pow,trackbp) => {
    const san = value_current(snew,sold,smax);            
    const diffsan=san-sold;

    const flag_2san = (diffsan>=2) ? 1 : 0;
    const flag_temp = (diffsan>=5) ? 1 : 0;
    const flag_bp   = (san<=bnew && trackbp==1)  ? 1 : 0;    
    return {san2:flag_2san,temp:flag_temp,bp:flag_bp};
};




const definesanroll=(san,sold,bnew,bold,sanflags,character_name,San2_disorder={},Temp_disorder={}) => {
    const diffsan=san-sold;
    const flag_2san=(sanflags.san2 && !(isEmpty(San2_disorder)));
    const flag_temp=sanflags.temp;
    const flag_bp=sanflags.bp;

    var rollString=`&{template:fancy-rolls} {{name=${character_name}}} {{header=^{sanity_loss}}} `;
    rollString= `${rollString} {{sanity_loss=[[${diffsan}]]}} {{sanity_new=[[${san}]]}}`;
    rollString= `${rollString} {{sanity_old=[[${sold}]]}} {{bp_old=[[${bold}]]}} {{bp_new=[[${bnew}]]}}`;
    
    if (flag_bp == 1){
        rollString= `${rollString} {{flag_bp=1}} `;
    }
    if (flag_temp==1){
        rollString=`${rollString} {{flag_temp=1}}`;
        if (!(isEmpty(Temp_disorder))){
            Object.entries(Temp_disorder).forEach(([key,val],index)=>{
                rollString= `${rollString} {{tdis_name${index}=${key}}} {{tdis_desc${index}=${val}}} `;
            });
        }
    }    

    if (flag_2san==1){
        rollString=`${rollString} {{flag_2san=1}}`;
        if (!(isEmpty(Temp_disorder))){
            Object.entries(Temp_disorder).forEach(([key,val],index)=>{
                rollString= `${rollString} {{tdis_name${index}=${key}}} {{tdis_desc${index}=${val}}} `;
            });
        }
    }   
    

    var update={};    
    update['sanity_points']=san;
    update['sanity_points_old']=sold;
    if (flag_bp==='on'){
        update['breaking_point']=Math.max(0,san-pow);
        update['breaking_point_max']=bold;
        update['breaking_point_old']==Math.max(0,san-pow);
    }

    
    setAttrs(update, {silent:true},()=>{
        console.info('Sanity loss roll finished',update);
    });

    startRoll(`${rollValue} {{isSkill=[[${_isSkill}]]}}`, (results)=> {
        const sanity_old=results.results.sanity_old.result;
        const sanity_new=results.results.sanity_new.result;
        const sanity_loss=results.results.sanity_loss.result;
        const bp_old=results.results.bp_old.result;
        const bp_new=results.results.bp_new.result;

        
        
		finishRoll(results.rollId,{});

    });
 
}


const value_current = (current,old,max) => {
	
    if (current>=max) {
        return (current<=old) ? current : old;
    }
    return Math.max(current,0);
}
   
var addskills=[];	//name of the array
const update_additionalskills= ()=>{
    addskills=[];
	var update={};
    getSectionIDs('skills', (idarray) => {
      addskills=idarray.map(id =>`repeating_skills_${id}`) ; 
      console.log(addskills);  //log of debugging to be sure
	  idarray.forEach(id=>{
		update[`repeating_skills_${id}_${element}_action`] = `%{${character_id}|repeating_skills_${id}_${element}-action}`;			
		update[`repeating_skills_${id}_skill_r`]=id;
	  });
	  setAttrs(update,{silent:true},()=>{
		console.info('Repeating Skills updated',update);
	  });
    });
};	


const setMinMax = (skill, min, max) => {
	const Iskill=parseInt(skill)||0;
	return (Iskill < min) ? min : (Iskill > max) ? max : Iskill;
};



on(`change:repeating_weapons:shotgun change:repeating_weapons:blast_radius`, (eventInfo)=> {
	const possibilities=['shotgun','blast_radius'];
	const choice = eventInfo.newValue==='active' ? 1 : 0;
	const whichone= eventInfo.triggerName.split('_')[3];
	const isMinority=isMinorityReport(eventInfo);
	if (!isMinority){
		const other= possibilities.filter(el => el != whichone);
		var update={};
		if (((choice ==0) && (whichone===`shotgun`)) || ((choice ==1) && (other===`shotgun`))){update[`repeating_weapons_double_damage`]=0;}
		if (choice==1 && whichone ==='shotgun'){update[`repeating_weapons_double_damage`]='active';}
		if (choice==1){update[`repeating_weapongs_${other}`]=0;}
		
		setAttrs(update,{silent:true},()=>{
			console.info(`update shotgun/blast_radius`,update);
		});

	}
});

const setBondsLocalVariables = () => {
	getAttrs(["willpower_points","sanity_points"],function(value){
		let update={};
		getSectionIDs("bonds",function(idarray){
			idarray.forEach(id=>{
				update["repeating_bonds_"+id+"_wp_points"]=value["willpower_points"];
				update["repeating_bonds_"+id+"_san_points"]=value["sanity_points"];
			});
			console.log('inside repeating section');
			console.info('update bonds',update);
			setAttrs(update,{silent:true},()=>{
				console.log('Bonds updated on open');
			});	
		});
	});
};




arrays['_adaptation'].forEach(adaptation => {
	const adaptation_indexed = [`${adaptation}_1`, `${adaptation}_2`, `${adaptation}_3`];
	on(`change:${adaptation}_1 change:${adaptation}_2 change:${adaptation}_3`, (eventInfo) => {
		const adaptation_idx = parseInt(eventInfo.sourceAttribute.split('_')[1]);
		const adaptation_value = eventInfo.newValue === 'on' ? 1 : 0;
		const adaptation_type = eventInfo.sourceAttribute.split('_')[0];
		console.log(`adaptation changed: ${adaptation_type} with index ${adaptation_idx} and value ${adaptation_value}`);
		var update = {};
		update[`${adaptation}_adapted`] = 0;
		if (adaptation_idx == 1 && adaptation_value === 0){
			update[`${adaptation_indexed[1]}`] = 0;
			update[`${adaptation_indexed[2]}`] = 0;
		}
		if (adaptation_idx == 2 && adaptation_value ===0){
			update[`${adaptation_indexed[2]}`] = 0;
		}
		if (adaptation_idx == 2 && adaptation_value === 1){
			update[`${adaptation_indexed[0]}`] = 'on';
		}
		if (adaptation_idx == 3 && adaptation_value === 1){
			update[`${adaptation_indexed[0]}`] = 'on';
			update[`${adaptation_indexed[1]}`] = 'on';
			update[`${adaptation}_adapted`] = 1;
		}
		console.info(update);
		setAttrs(update, {silent:true}, () => {
			console.log('Adaptation updated');
		});
		
	});
});

arrays['_settings_wp'].forEach(wp_setting => {
	on(`change:${wp_setting}`, (eventInfo) => {
		console.log('wp_setting changed:'+eventInfo.triggerName);
		getAttrs(arrays['_settings_wp'].concat(arrays['_derived_modifiers']), (values) => {
			var update = {};
			if (values['mod_will_power_check'] === 'none'){
				update[`low_will_power`] = 0;
				update[`zero_will_power`] = 0;
			}
			if (values['mod_will_power_check'] === 'lowonly'){
				update[`zero_will_power`] = 0;
				update[`low_will_power`] = 1;
			}
			if (values['mod_will_power_check'] === 'all'){
				update[`low_will_power`] = 1;
				update[`zero_will_power`] = 1;
			}
			console.info(update);
			setAttrs(update, {silent:true}, () => {
				console.log('Willpower Settings updated');
			});
		});
	});
});

on(`change:repeating_skills:rank`, (eventInfo) => {
	const newValue = setMinMax(parseInt(eventInfo.newValue) || 0, 0, 99);
	update={};
	update[eventInfo.sourceAttribute]=newValue;
	console.info(update);
	setAttrs(update,{silent:true},()=>{
		console.log('Repeating Skills updated on change');
	});
});
	
Object.entries(_repeating_sections).forEach(([element,section]) => {
	on(`change:repeating_${section}`, (eventInfo) => {
		const id = eventInfo.sourceAttribute.split('_')[2];
		changeRepeatingRolls(section,element,id);
	});

});
	


// new function to compute san point max
on("change:unnatural", function(eventInfo) {
		const newvalue = setMinMax(parseInt(eventInfo.newValue) || 0,0,99);
		update={sanity_points_max: 99-newvalue, unnatural: newvalue};
		console.info(update);
		setAttrs(update,{silent:true},()=>{
			console.log('Sanity points updated');
		});
});


// === debug note: need to change repeating_special_training and repeating_weapons for visulization purposes
// === Update stats on change
arrays['_stats'].forEach(stat => {
		const stat_score = `${stat}_score`;
		const stat_hidden = `${stat}_hidden`;
		const _san_array=['sanity_points', 'breaking_point','initial_san'];
		const _initial_hp=['initial_str','initial_con','initial_hp'];
		on(`change:${stat_score}`, (eventInfo) => {
			const value = parseInt(eventInfo.newValue) || 0;
			var update = {};
			getAttrs(arrays['_stats'].concat(_san_array,_initial_hp,['unnatural'],arrays['_stats'].map(el=> `${el}_score`)), function(v) {
				
				update[stat]=value*5;
				update[stat_score]=value;
				if (stat==='power'){
					const sanmax=99-parseInt(v['unnatural']||0);
					update[`willpower_points_max`]=value;
					update['sanity_point_max']=sanmax;
					const flag_initial_san=v.initial_san;
					if (flag_initial_san==1){
						const InitialSanity = value*5;
						const InitialBreakingPoint = value*4;
						const InitialWillPower = value; 
						
						update['sanity_points']= InitialSanity;
						update['sanity_points_old']= InitialSanity;
						update['breaking_point']= InitialBreakingPoint;
						update['breaking_point_max']= InitialBreakingPoint;
						update['willpower_points']=InitialWillPower;
						update['initial_san']=0;
					}

				}

				if (stat==='strength' || stat==='constitution'){
					// no matter what the flag will be trigger, I save the check for the initial hp
					
					const flag_initial_str=v.initial_str;
					const flag_initial_con=v.initial_con;
					const flag_initial_hp=v.initial_hp;
					const con=parseInt(v[`constitution_score`] ||0);
					const str=parseInt(v[`strength_score`] ||0);
					var new_flag_initial_hp=1;
					if (stat==='strength') {
						update[`initial_str`]=0;
						if (flag_initial_con ===0) {
							new_flag_initial_hp=0;
						}
					}else{
						update[`initial_con`]=0;
						if (flag_initial_str ===0) {
							new_flag_initial_hp=0;
						}
					}
					if (flag_initial_hp === 0 || new_flag_initial_hp === 0){
						update[`hit_points_max`]=Math.ceil((con+str)/2);	
					}
					if (new_flag_initial_hp === 0){
						update[`hit_points`]=update[`hit_points_max`];
						update[`initial_hp`]=0;
					}
				}
				updateSkillSpanOnChange(stat,value*5,update,'Stats')
				//console.info('update on change stats:',update);
				//setAttrs(update, {silent:true},()=>{
				//	console.log('Stats updated on change');
				//});
			});
		});
});
	
// === Update skills on change
arrays['_skills'].forEach(skill => {
		on(`change:${skill}`, (eventInfo) => {
			const tmpvalue=Math.abs(parseInt(eventInfo.newValue) || 0);
			const value= tmpvalue<=99 ? tmpvalue : 99;
			var update={};
			update[skill]=value;
			updateSkillSpanOnChange(skill,value,update,'Skills')
			
				
		});
});
	// === Update repeating skills on change
on("change:repeating_skills:rank", function(eventInfo) {
		const value = parseInt(eventInfo.newValue) || 0;
		if (value < 0) {
			setAttributes({[eventInfo.sourceAttribute]: 0}, false);
		}
		if (value > 99) {
			setAttributes({[eventInfo.sourceAttribute]: 99}, false);
		}
});

// UPDATE THE VALUE OF THE BOND IN THE REPEATING SECTION WHEN CREATED
on("change:repeating_bonds",function(){
		getAttrs(["repeating_bonds_flag","charisma_score"],function(value){
			if (value["repeating_bonds_flag"]==0){
				let update={
							repeating_bond_score:value["charisma_score"],
							repeating_bond_flag:1
							};
				setAttributes(update,true);
			}
		});
});


// UPDATE THE WP INSIDE EACH BOND
 arrays['_bonds_local'].forEach(attr => {
	on(`change:${attr}`, (eventInfo) => {
		var update={};
		const newvalue = parseInt(eventInfo.newValue) || 0;
		const wporsan = eventInfo.triggerName;
		const _prefix = (wporsan === "willpower_points") ? "wp" : "san";
		console.log('prefix: ' + _prefix);
		const isMinority=isMinorityReport(eventInfo);
		const target=eventInfo.triggerName;
		


		getSectionIDs("bonds",function(idarray){
			idarray.forEach(id=>{
				update["repeating_bonds_"+id+"_"+_prefix+"_points"]=newvalue;
			});
			console.info(update);
			getAttrs([`sanity_points`,`sanity_points_old`,`sanity_points_max`],v=>{
				const sold=parseInt(v[`sanity_points_old`])||0;
				const smax=parseInt(v[`sanity_points_max`])||0;
				const san=value_current(parseInt(v[`sanity_points`]) || 0,sold,smax);
				update[`sanity_points`]=san;
				update[`sanity_points_old`]=san;
		
				setAttrs(update,{silent:true},()=>{
					console.log('Bonds updated on change');
				});
			});
		});
	});
});


// CHECK IF DAMAGE OR LETHALITY EXISTS
on("change:repeating_weapons",function(){
		getAttrs(['repeating_weapons_damage','repeating_weapons_lethality_percent'],function(value){
			let update={};
			if (value['repeating_weapons_damage']===""){
				update['repeating_weapons_hasdamage']=0;
			}else{
				update['repeating_weapons_hasdamage']=1;
			}
			
			if (value['repeating_weapons_lethality_percent']>0){
				update['repeating_weapons_haslethality']=1;
			}else{
				update['repeating_weapons_haslethality']=0;
			}
			setAttributes(update,true);
		});
});
	
// Find max and min of a function
// === SAN LOSS Button
arrays['_sanity_loss'].forEach(attr => {
	on(`change:${attr}`, (eventInfo) => {
		const value = eventInfo.newValue;
		if (value ===""){
			setAttributes({[`has_${attr}`]: 0}, true);
		} else {
			setAttributes({[`has_${attr}`]: 1}, true);
		}
	});
});

on("sheet:opened change:san_success change:san_failure",function(){
	   getAttrs(['san_success', 'san_failure'], function(v) {
			let maxsan=v.san_failure;
			let minsan=v.san_success;
			let update={};
			maxsan="("+maxsan+")";
			minsan="("+minsan+")";
			var m1 = minsan.toLowerCase().replace(/[\\+\\-\\*\\/]/gi,"$&").replace(/[dD](\s?\d+[.,]?\d*)/gi,'').replace(/[\\+\\-\\*\\/]/gi,")$&(");
			var m2 = maxsan.toLowerCase().replace(/[\\+\\-\\*\\/]/gi,")$&(").replace(/[dD]/gi,'*');
			update['maxsanloss']=Function('"use strict";return (' + m2 + ')')();
			update['minsanloss']=Function('"use strict";return (' + m1 + ')')();
			console.log(m1);
			console.log(m2);
			setAttributes(update,true);
		});
});
// Create array with list of repeating skills
const elementid_off= (element) =>{
	var element=document.getElementById(element);
	element.style.display="none";
};
// Create array with list of repeating skills
const elementid_on= (element) =>{
	var element=document.getElementById(element);
	element.style.display="block";
};

on(`change:testjsid`,(eventInfo)=>{
	const value=eventInfo.newValue;
	if (value == 'on') {
		elementid_off("personal_data");
	}else{
		elementid_on("personal_data");
	}
});const versioning = (version) => {
    console.log(`%c Versioning, ${version}`, 'color: green; font-weight:bold');
    if (version < 1.05) {
       version_0_105();
    } 
    if (version <1.5) {
        version_105_150();
    }
    if (version<1.7) {
        version_150_170();
    }
    if (version<2.0) {
        version_170_200();
    }
    if (version<2.01) {
        version_200_201();
    }
};

// UPDATE TO VERSION 1.05
const version_0_105= () => {
    getAttrs(['version'], function(v) {
        let codeversion=1.05;
        let update={version: codeversion,
                     initial_san: 0,
                     initial_hp:  0,
                     initial_str: 0,
                     initial_con: 0
        };
        setAttrs(update, //Update attributes
            {silent:true},  // will not trigger sheet workers
            versioning(codeversion)); // call versioning again
    });
};
// UPDATE TO VERSION 1.5
const version_105_150 = () => {
    
    let codeversion=1.5;
    let update={};
    
    getSectionIDs("weapons",function(idarray){
   console.log(`%c idarray`, 'color: green; font-weight:bold');
   console.info(idarray);
        let fieldnames=['sheet_type','version'];
        console.log(`%c did I found weapons?`, 'color: green; font-weight:bold');
        idarray.forEach(id => {
                console.log(`%c ${id}`, 'color: green; font-weight:bold');
                fieldnames.push(`repeating_weapons_${id}_damage`,`repeating_weapons_${id}_lethality_percent`,`repeating_weapons_${id}_attack`);
        });
           getAttrs(fieldnames,function(v) {
           console.log(`%c v`, 'color: green; font-weight:bold');
           console.info(v);
           update['version']=codeversion;
           console.info(update);
            idarray.forEach(id=>{
                console.log(`%c ${id}`, 'color: green; font-weight:bold');
                if (v[`repeating_weapons_${id}_damage`]===""){
                    update["repeating_weapons_"+id+"_hasdamage"]="0";
           console.info(update);
                } else{
                    update["repeating_weapons_"+id+"_hasdamage"]="1";
           console.info(update);
                }
                    
                if (v[`repeating_weapons_${id}_lethality_percent`]>0){
                    update["repeating_weapons_"+id+"_haslethality"]="1";
           console.info(update);
                } else {
                    update["repeating_weapons_"+id+"_haslethality"]="0";
           console.info(update);
                }
                if (v['sheet_type']==='npc'){
                    update["repeating_weapons_"+id+"_weapons"]=v[`repeating_weapons_${id}_attack`];
                }
            });
            
           console.log(`%c update`, 'color: green; font-weight:bold');
           console.info(update);
            setAttrs(update, //Update attributes
                    {silent:true},  // will not trigger sheet workers
                    versioning(codeversion)); // call versioning again
            
        });
    });
};

// UPDATE TO VERSION 1.7
const version_150_170 = () => {
    let codeversion=1.7;
    let update={};
    update['version']=codeversion;
    update['luck']=50;
    update['luck_max']=50;
    console.log(`%c update`, 'color: green; font-weight:bold');
    console.info(update);
    setAttrs(update, //Update attributes
            {silent:true},  // will not trigger sheet workers
            versioning(codeversion)); // call versioning again
};

// UPDATE TO VERSION 2.0
const version_170_200 = () => {
    let codeversion=2.0;
    let update={};
    update['version']=codeversion;
    getAttrs(["motivations","character_name","name","sanity_points","violence_3","helplessness_3","violence_2","helplessness_2",
    "sanity_points_old","sanity_points","breaking_point_old","breaking_point_old"],function(v){
        let motivations=v["motivations"];
        if (v["name"]!==""){
            _name=v["name"];
        }else{
            _name=v["character_name"];
        }	
        update["character_name"]=_name;
        update["old_motivations"]=motivations.replace(/<br>/g,"\n");
        const _violence_adapted     = v["violence_2"]==='on';
        const _helplessness_adapted = v["helplessness_2"]==='on';
        if (v["violence_2"]==='on'){
            update["violence_1"]='on';
        }
        if (v["helplessness_2"]==='on'){
            update["helplessness_1"]='on';
        }

        if (_violence_adapted){
            update["violence_adapted"]=1;
            update["violence_2"]='on';
            update["violence_1"]='on';
        }
        if (_helplessness_adapted){
            update["helplessness_adapted"]=1;
            update["helplessness_2"]='on';
            update["helplessness_1"]='on';
        }


        
        update['sanity_points_old']=v['sanity_points'];
        update['breaking_point_old']=v['breaking_point'];

        console.log(`%c update`, 'color: green; font-weight:bold');
        console.info('versioning',update);
        setAttrs(update, //Update attributes
                {silent:true},  // will not trigger sheet workers
                versioning(codeversion)); // call versioning again
    });

};
// UPDATE TO VERSION 2.0
const version_200_201 = () => {
    let codeversion=2.01;
    let update1={};
    update1['version']=codeversion;
    
        // UPDATE NAMES FOR SPECIAL TRAINING AND WEAPONS AND TRIGGER TEST
    const sectionDetails = [
        {section:'repeating_special', fields: ['name','special_training','skill_or_stat_used','skill_span']},
        {section:'repeating_weapons', fields: ['name','weapons','skill_percent','skill_span','ammo','hasammo','ammo_max']}];
    
    getSectionIDs(sectionDetails, (v)=>{
            const repspecial= v.filter(el => el.startsWith(`repeating_special`));
            const repweapons= v.filter(el => el.startsWith(`repeating_weapons`));
            console.log('in getSectionIDs section',section);
           // const fullarray=[].concat(repspecial,repweapons);
            //console.info('fullarray',fullarray);
            getAttrs(v,(values) => {
                console.info('fullarray',values);
                            
                const repweapons_oldname=repweapons.filter(el => el.endsWith('_weapons'));
                const repspecial_oldname=repspecial.filter(el => el.endsWith('_special_training'));
                const repweapons_name=repweapons.filter(el => el.endsWith('_name'));
                const repspecial_name=repspecial.filter(el => el.endsWith('_name'));
                const repspecial_span=repweapons.filter(el => el.endsWith('_skill_span'));
                const repspecial_skill=repspecial.filter(el => el.endsWith('_skill_or_stat_used'));
                const repweapons_span=repweapons.filter(el => el.endsWith('_skill_span'));
                const repweapons_skill=repspecial.filter(el => el.endsWith('_skill_percent'));
                const repweapons_ammo=repweapons.filter(el => el.endsWith('_ammo'));
                const repweapons_hasammo=repweapons.filter(el => el.endsWith('_hasammo'));
                const repweapons_ammo_max=repweapons.filter(el => el.endsWith('_ammo_max'));

                console.log(`%c repweapons_oldname`, 'color: green; font-weight:bold');
                console.info(repweapons_oldname);
                console.log(`%c repspecial_oldname`, 'color: green; font-weight:bold');
                console.info(repspecial_oldname);
                console.log(`%c repweapons_name`, 'color: green; font-weight:bold');
                console.info(repweapons_name);
                console.log(`%c repspecial_name`, 'color: green; font-weight:bold');
                console.info(repspecial_name);
                console.log(`%c repspecial_span`, 'color: green; font-weight:bold');
                console.info(repspecial_span);
                console.log(`%c repspecial_skill`, 'color: green; font-weight:bold');
                console.info(repspecial_skill);
                console.log(`%c repweapons_span`, 'color: green; font-weight:bold');
                console.info(repweapons_span);
                console.log(`%c repweapons_skill`, 'color: green; font-weight:bold');
                console.info(repweapons_skill);
                console.log(`%c repweapons_ammo`, 'color: green; font-weight:bold');
                console.info(repweapons_ammo);
                console.log(`%c repweapons_hasammo`, 'color: green; font-weight:bold');
                console.info(repweapons_hasammo);
                console.log(`%c repweapons_ammo_max`, 'color: green; font-weight:bold');
                console.info(repweapons_ammo_max);


                for (i=0; i<repweapons_name ;i++){
                    if (values[repweapons_oldname[i]]!='') {
                        update1[repweapons_name[i]]=values[repweapons_oldname[i]];
                        values[repweapons_oldname[i]]='';
                        update1[repweapons_span[i]]=values[repweapons_skill[i]];
                    }
                    
                }
                
                for (i=0; i<repspecial_name ;i++){
                    if (values[repspecial_oldname[i]]!='') {
                        update1[repspecial_name[i]]=values[repspecial_oldname[i]];
                        update1[repspecial_oldname[i]]='';
                        update1[repspecial_span[i]]=values[repspecial_skill[i]];
                    }
                }

                for (i=0; i<repweapons_ammo ;i++){
                    if (values[repweapons_ammo[i]]!='') {
                        update1[repweapons_ammo_max[i]]=values[repweapons_ammo[i]];
                        update1[repweapons_hasammo[i]]=values[repweapons_ammo[i]]>0 ? '1' : '0';
                    }
                }

                console.log(`%c update`, 'color: green; font-weight:bold');
                console.info('versioning',update1);
                setAttrs(update1, //Update attributes
                        {silent:true},  // will not trigger sheet workers
                        versioning(codeversion)); // call versioning again
            });

    

    });
};
  
arrays['_colored_derivative'].forEach(vitality => {
    on(`change:${vitality}_points`, (eventInfo) => {
        console.log('changed '+vitality+'_points');
        console.log(eventInfo);
        console.log(eventInfo.newValue);
 
        var value = parseInt(eventInfo.newValue) || 0;
        value = (value < 0) ? 0 : value;
        const maxval=`${vitality}_points_max`;
        getAttrs([maxval], function(v) {
            console.log('maxval:'+v[maxval]);
            const max_val = parseInt(v[maxval]) || 0;	
            const low_val=2;
            var update={};
 
            console.log('maxval:'+v[maxval]+' value:'+value+' low_val:'+low_val);
            update[`color_${vitality}`]='normal';
            update[`${vitality}_modifier`]=0;
 
            if (value > max_val) {
                update[`color_${vitality}`]='extra';
            }
            if (value <= low_val) {
                update[`color_${vitality}`]='low';
                update[`${vitality}_modifier`]=1;
             }
            if (value == 0) {
                update[`color_${vitality}`]='zero';
                update[`${vitality}_modifier`]=2;
            }
            update[`${vitality}_points`]=value;
            console.log('maxval:'+v[maxval]+' value:'+value+' low_val:'+low_val);
            console.info(update);
            setAttrs(update, {silent:false}, ()=>{
                console.log('Vitality color updated');	
            });
        });
    });
 });
 

on(`change:repeating_weapons:skill_percent change:repeating_special:skill_or_stat_used`,(eventInfo)=>{
    console.log(eventInfo);
    
    const newValue=eventInfo.newValue;
    const field=eventInfo.triggerName;
    const id= field.split('_')[2];
    const skillspan=`repeating_${field.split('_')[1]}_${id}_skill_span`;
    const isMinority=isMinorityReport(eventInfo);
    const isValid=(isStringInForm(newValue) && isValidSkill(newValue)) && !isMinority;
    const isNumber=isSkillNumber(newValue);
    console.info('field:',field);
    console.info('newValue:',newValue);
    console.info('id:',id);
    console.info('isMinorityReport?',isMinority);
    console.info('isNumber?',isNumber);
    console.info('isStringForm?',isStringInForm(newValue));
    console.info('isValidSkill?', isValidSkill(newValue));
    
    var update={};
    if (isNumber){
        const number=parseInt(newValue) || 0;
        update[field]=number;
        update[skillspan]=number;
        setAttrs(update,{silent:true},()=>{
            console.info('update number:', number);
        });
    } else if (isValid) {
        const skill=cleanedSkill(newValue);
        console.info('skill:',skill);
        getAttrs([`${skill}`], (v) =>{
            update[skillspan]=v[`${skill}`];
            setAttrs(update,{silent:true},()=>{
                console.info('updated skill:',skill);
            });
        })
    } else if (isMinority) {
        console.log("Right now the Precogs can't see a thing." );
    } else {
        update[field]=0;
        update[skillspan]=0;
        setAttrs(update,{silent:true},()=>{
            console.info('unrecognized value:', newValue);
        })
    }
});

  
const updateRepeatingSection = (section, element, id, character_id) => {
    const update = {};
    const attrPrefix = `repeating_${section}_${id}`;
	const attrName = `${attrPrefix}_${element}`;
    update[`${attrName}_action`] = `%{${character_id}|${attrName}-action}`;
    update[`${attrName}_r`] = id;

	console.log(' in update repeating section',section);
	if (section === 'weapons') {
		update[`${attrPrefix}_damage_action`] = `%{${character_id}|${attrPrefix}_damage-action}`;
		update[`${attrPrefix}_damageCritical_action`] = `%{${character_id}|${attrPrefix}_damageCritical-action}`;
		update[`${attrPrefix}_lethality_action`] = `%{${character_id}|${attrPrefix}_lethality-action}`;
		update[`${attrPrefix}_lethalityCritical_action`] = `%{${character_id}|${attrPrefix}_lethalityCritical-action}`;
		update[`${attrPrefix}_selective_fire_action`] = `%{${character_id}|${attrPrefix}_selective_fire-action}`;
		update[`${attrPrefix}_selective_fireCritical_action`] = `%{${character_id}|${attrPrefix}_selective_fireCritical-action}`;
		update[`${attrPrefix}_double_damage_action`] = `%{${character_id}|${attrPrefix}_double_damage-action}`;
		update[`${attrPrefix}_double_damageCritical_action`] = `%{${character_id}|${attrPrefix}_double_damageCritical-action}`;
	}
    return update;
};
const updateRepeatingRollsonOpen = () => {
	
	getAttrs(['character_id'], (values) => {
		
		const character_id=values.character_id;
		console.info('Repeating Sections',_repeating_sections);
		Object.entries(_repeating_sections).forEach(([element,section])=> {
			console.log(' in update repeating rolls on open',section);
			getSectionIDs(section, function(idarray) {
				var update={};
				console.log('section: '+section+' element: '+element+' idarray: '+idarray);
				idarray.forEach(id => {
					Object.assign(update, updateRepeatingSection(section, element, id, character_id));
				});				
				console.info('Value of update inside repeating rollUpdate',update);
				setAttrs(update, {silent:true}, () => {
					console.log('Repeating Rolls updated');
					console.info('update',update);
				});
				
			});
		});
		Object.entries(_repeating_damages).forEach((element)=> {
			getSectionIDs('weapons', function(idarray) {
				var update={};
				console.log('section: weapons element: '+element+' idarray: '+idarray);
				idarray.forEach(id => {
					update[`repeating_weapons_${id}_${element}`] = `%{${character_id}|repeating_weapons_${id}_${element}`;
				});				
				console.info('Value for weapons damage',update);
				setAttrs(update, {silent:true}, () => {
					console.log('Repeating weapon damage updated');
					console.info('update',update);
				});
			});
		})
	});
};


const updateRollsOnOpen= () => {
	console.log('===update rolls===');
	const fullrolls = _allrolls;
	console.info(`all rolls`,_allrolls);
	getAttrs(['character_id'], (values) => {
		var update={};
		const character_id=values.character_id;
		console.log('character id: '+character_id);
		fullrolls.forEach(roll => {
			update[`${roll}_action`] = `%{${character_id}|${roll}-action}`;
		});
		console.info('Value of update inside rollUpdate',update);
		setAttrs(update, {silent:false}, () => {
			console.log('Rolls updated');
			console.log('update:',update);
		});
	});
};

const changeRepeatingRolls = (section,element,id) => {
	console.log(' in change repeating rolls',section);
	const attrName = `repeating_${section}_${id}_${element}`;
	getAttrs(['character_id'], (values) => {
		const character_id = values.character_id;
		const update = updateRepeatingSection(section, element, id, character_id);
		console.info(update);
		setAttrs(update, {silent:true}, () => {
			console.log(`Update repeating ${element} rolls`);
		});
	});
	
};

const rollwithmodifiers = (rollString,rollName,queryModifier) => {
	initializeRolls();		// Initialize the rolls if flag is not set
	getAttrs(arrays['_derived_modifiers'], (values) => {
		console.log('wp: '+values['willpower_points']);
		console.log('low wp: '+values['low_will_power']);
		console.log('zero wp: '+values['zero_will_power']);

		///////////////////////////////////////////////////////////
		const wp_modifiers=check_for_wp_modifiers(values,rollName);

		const _zero_will_power = wp_modifiers.zero_will_power;
		const _low_will_power = wp_modifiers.low_will_power;
		
		var rollValue = `${rollString} {{rating=[[@{${rollName}}]]}}`;
		rollValue= `${rollValue} {{zero_will_power=${_zero_will_power}}}`;
		rollValue= `${rollValue} {{low_will_power=${_low_will_power}}}} `;
		rollValue= `${rollValue} {{modifier=[[${queryModifier}]]}}`;
		rollValue= `${rollValue} {{isCritical=[[0]]}} {{isSuccess=[[0]]}}`;		

		if(_zero_will_power!='[[1]]') {
			rollValue = `${rollValue}`; 			
		}

		console.log(rollValue);
		const isSkill=arrays[`_skills`].includes(rollName) ? 1 : 0;
		const isStat=arrays[`_stats`].includes(rollName) ? 1 : 0;

		console.log(`isSkill: ${isSkill}`);
		console.log(`isStat: ${isStat}`);

		var rollType=0;
		if (isSkill==1){
			rollType=1;
		} else if (isStat==1){
			rollType=2;
		}
		rollFail=`${rollName}_fail`;
		rollSkillAndStats(rollValue,rollName,rollFail,rollType);

	});

};


const check_for_wp_modifiers = (values,roll) => {
	console.log('wp: '+values['willpower_points']);
	console.log('low wp: '+values['low_will_power']);
	console.log('zero wp: '+values['zero_will_power']);
	
	const _willpower_points = parseInt(values[`willpower_points`]) || 0;
	const _zero_will_power = (values[`zero_will_power`]== 1 && _willpower_points== 0 && roll !== 'luck') ? '[[1]]' : '[[0]]';
	const _low_will_power  = (values[`low_will_power`] == 1 && _willpower_points <= 2 && _willpower_points>0 && roll !== 'luck' && roll !== 'sanity_points') ? '[[1]]' : '[[0]]';
	
	console.log(`zero will power: ${_zero_will_power}`);
	console.log(`low will power: ${_low_will_power}`);
	return {zero_will_power: _zero_will_power, low_will_power: _low_will_power};
};


const check_success= (dice,rollName,rollFail,rating,typeRoll=0) => {
	// typeRoll=2 for stats -> can go above 100
	// typeRoll=1 for skill -> have to check for failure
	// typeRoll=0 for attacks and special
	var isSuccess=0;
	var isCritical=0;
	const criticals=[1,11,22,33,44,55,66,77,88,99,100];
	if (typeRoll<2 || rating<100){ // only stats can go above 100 
		isSuccess= dice<=rating ? 1 : 0;
		isCritical=criticals.includes(dice) ? 1 : 0;
	}else{
		const score=Math.round(rating/5);
		isSuccess= dice !=99 ? 1 : 0;
		isCritical= (criticals.includes(dice) || dice<=score) ? 1 : 0;
	}	

	if (typeRoll==1 && isSuccess==0){ // you need to check for failure when it's a skill
		var failure={};
		failure[`${rollFail}`]='on';
		console.info(`Skill ${rollName} failed`);
		console.info(`failure`,failure);
		setAttrs(failure, () => {
			console.info(`Skill ${rollName} failed`);
		});
	}
	return [isSuccess,isCritical];
};

const rollAttacks = (rollValue,rollName,options) => {
	startRoll(`${rollValue}`, (results) => {
		console.info(results.results);
		console.info(results.results.advanced_weapons.result);
		const dice=results.results.dice.result;
		const rating=results.results.rating.result;
		const modifier=results.results.modifier.result;
		const zero_will_power=results.results.zero_will_power.result;
		const low_will_power=results.results.low_will_power.result;
		const basemodifier= (modifier - (20*low_will_power));

		const advanced_weapons=results.results.advanced_weapons.result;

		
		if (options.hasBlastRadius==1){
			const blast_radius=results.results.blast_radius.result;
		}
		
		var full_modifier=basemodifier;
		if (options.advanced_weapons==1){
			if (options.isShotgun==1){
				full_modifier+=20;
			}
			
			else if (options.hasBlastRadius==1){
				full_modifier+=20;
			}
			
			if (options.hasAccessories==1){
				const accessoriesMod=parseInt(results.results.accessoriesMod.result)||0;
				console.log('accessoriesMod: ',accessoriesMod);
				full_modifier+=accessoriesMod;
			}
		}

		full_modifier= full_modifier>40 ? 40 : full_modifier;
		const rating_check=(rating+full_modifier)<0 ? 0 : (rating+full_modifier)>99 ? 99 : (rating+full_modifier);	
		console.log('rating: ',rating);
		console.log('rating_check: ',rating_check);
		console.log('dice: ',dice);
		console.log('dice<rating:',dice<rating_check);
		console.log('dice<rating_check:',dice<rating_check);
		const [isSuccess,isCritical]=check_success(dice,rollName,'',rating_check,0)	
		
		console.log('isSuccess:',isSuccess);
		console.log('isCritical:',isCritical);

		newroll={
			rating: rating_check,
			dice: dice,
			modifier: full_modifier,
			isSuccess: isSuccess,
			isCritical: isCritical,
			zero_will_power: zero_will_power,
			low_will_power: low_will_power
		};

		if (options.isLethality==1){
			newroll['lethality']=parseInt(results.results.lethality.result)||0;
		}
		console.log(newroll);
		finishRoll(results.rollId,newroll);
	});
};	


const rollSkillAndStats=(rollValue,rollName,rollFail,typeRoll) => {
	
	startRoll(rollValue, (results)=> {
		console.log(results);
		const modifier=results.results.modifier.result;
		const zero_will_power=results.results.zero_will_power.result;
		const low_will_power=results.results.low_will_power.result;
		const rating=results.results.rating.result;
		const full_modifier= (modifier - (20*low_will_power))>40 ? 40 : (modifier - (20*low_will_power));
		const dice=results.results.dice.result;
		const rating_check=(rating+full_modifier)<0 ? 0 : (rating+full_modifier)>99 ? 99 : (rating+full_modifier);
		var newroll={a: 15,b:-2};
		console.log(`full modifier: ${full_modifier}`);
		console.log(`rating: ${rating}`);
		console.log(`rating check: ${rating_check}`);
		console.log(`dice: ${dice}`);
		console.log(`typeRoll: ${typeRoll}`);
		const [isSuccess,isCritical]=check_success(dice,rollName,rollFail,rating_check,typeRoll);
		newroll={
			rating: rating_check,
			dice: dice,
			modifier: full_modifier,
			isSuccess: isSuccess,
			isCritical: isCritical,
			zero_will_power: zero_will_power,
			low_will_power: low_will_power
		};

		console.log(newroll);

		finishRoll(results.rollId,newroll);
	});
};

const rollBonds=(rollValue,_value,_names,_parameters) => {
	
	startRoll(`${rollValue}`, (results)=> {
		console.log(results);

		
		///////////////////////////////////////////////////////////
		const dice=results.results.dice.result;
		const local_wp=Math.max(0,parseInt(results.results.local_wp.result)-dice);
		const score=Math.max(0,parseInt(results.results.score.result)-dice);

		const zerowp=local_wp==0 ? 1 : 0;
		console.log(`local_wp: ${local_wp}`);
		console.log(`score: ${score}`);
		console.log(`dice: ${dice}`);
		console.log(`zerowp: ${zerowp}`);
		var update={};
		console.info('parameters',_parameters);
		console.info('names',_names);
		update[_names['local_wp_points']]=local_wp;
		update[`willpower_points`]=local_wp;
		update[_names[`score`]]=score;
		
		newroll={
			dice: dice,
			local_wp: local_wp,
			score: score,
			zerowp: zerowp
		};

		finishRoll(results.rollId,newroll);
		setAttrs(update,{silent:false}, () => {
			console.info(`Bonds updated`,update);
		});
	});
};

['damage','damageCritical','double_damage','double_damageCritical','lethality','lethalityCritical','selective_fire','selective_fireCritical'].forEach((element) => {
	console.log('element: '+element);
	console.log(`clicked:repeating_weapons:${element}-action`);
	on(`clicked:repeating_weapons:${element}-action`, (eventInfo) => {
		console.log(eventInfo);
		const id = eventInfo.sourceAttribute.split('_')[2];
		var _input_names = {};
		var _parameters =[];
		setDamageParametersAndInputNames(id,element, _parameters, _input_names)
		clicked_repeating_damages(_parameters,_input_names);
	});
});

const setDamageParametersAndInputNames=(id,element, _parameters, _input_names) => {
	_input_names[`name`] = `repeating_weapons_${id}_name`;
	_input_names[`repsecid`] = `repeating_weapons_${id}`;
	_parameters.push(_input_names[`name`]);
	
	
	_input_names[`hasammo`] = `repeating_weapons_${id}_hasammo`;
	_parameters.push(_input_names[`hasammo`]);
	var flagCritical=false;	
	flagCritical= flagCritical || (element==='damageCritical');
	flagCritical= flagCritical || (element==='double_damageCritical');
	flagCritical= flagCritical || (element==='lethalityCritical');
	flagCritical= flagCritical || (element==='selective_fireCritical');
	
	_input_names[`isCritical`] = (flagCritical==true) ? 1 :  0;
	const isCritical=_input_names[`isCritical`];	

	console.log('isCritical: '+isCritical);
	
	
	if (element==='damage' || element==='damageCritical') {
		console.log('damage');
		if (isCritical==1){
			_input_names[`header`] = `damage (2)`;
		}else{
			_input_names[`header`] = `damage`;
		}
		_input_names[`damage`] = `repeating_weapons_${id}_damage`;
		_parameters.push(_input_names[`damage`]);
		_input_names[`damage_type`]='damage';
	}else if (element==='double_damage' || element==='double_damageCritical') {
		console.log('double damage');
		_input_names[`damage_type`]='damage';
		
		if (isCritical==1){
			_input_names[`header`] = `lethality (2)`;	
		}else{
			_input_names[`header`] = `lethality`;
		}

		_input_names[`damage`] = `repeating_weapons_${id}_damage_2`;
		_parameters.push(_input_names[`damage`]);
	}else if (element==='lethality' || element==='lethalityCritical') {
		console.log('lethality');
		_input_names[`damage_type`]='lethality';
		if (isCritical==1){
			_input_names[`header`] = `lethality (2)`;
		}else{
			_input_names[`header`] = `lethality`;
		}
		_input_names[`damage`] = `repeating_weapons_${id}_lethality_percent`;
		_parameters.push(_input_names[`damage`]);
	}else if (element==='selective_fire' || element==='selective_fireCritical') {

		if (isCritical==1){
			_input_names[`header`] = `lethality (2)`;
		}else{
			_input_names[`header`] = `lethality`;
		}
		
		_input_names[`damage_type`]='lethality';
		_input_names[`header`] = `selective fire`;
		_input_names[`damage`] = `repeating_weapons_${id}_selfireLethality`;
		_parameters.push(_input_names[`damage`]);
		_input_names[`selfireType`] = `repeating_weapons_${id}_selfireType`;
		_parameters.push(_input_names[`selfireType`]);
	}


	_input_names[`ammo`] = `repeating_weapons_${id}_ammo`;
	_parameters.push(`repeating_weapons_${id}_ammo`);
	_input_names[`track_bullets`] = `repeating_weapons_${id}_track_bullets`;
	_parameters.push(`repeating_weapons_${id}_track_bullets`);
};

const check_track_ammo=(rollString,trackAmmo,currentAmmo,used_ammo=1) => {
	if (trackAmmo==1) {
		rollString = `${rollString} {{trackbullets=[[1]]}} {{used_ammo=[[${used_ammo}]]}}`;
		rollString = `${rollString} {{current_ammo=[[${currentAmmo}]]}}`;
	} else {
		rollString = `${rollString} {{trackbullets=[[0]]}}`;
	}
	return rollString;
};

const getUsedAmmo=(selfireType='') => {
	if (selfireType==='short burst'){return 3} ;
	if (selfireType==='long burst'){return 5} ;
	if (selfireType==='short spray'){return 10} ;
	if (selfireType==='long spray'){return 20} ;
	return 1;
}

const clicked_repeating_damages = (parameters,names) => {
	getAttrs(parameters, (values) => {
		const isCritical=names['isCritical'];
		const trackAmmo =((values[names['track_bullets']]==='active') && (values[names['hasammo']]===1)) ? 1 : 0;
		const currentAmmo=Math.max(0,parseInt(values[names['ammo']]) || 0);
		const selfireType=(values[names['selfireType']]) || '';
		const usedAmmo=getUsedAmmo(selfireType);
		console.log('trackAmmo: '+trackAmmo);
		console.log('currentAmmo: '+currentAmmo);
		console.log('selfireType: '+selfireType);
		console.log('usedAmmo: '+usedAmmo);
		const damage_type=names['damage_type'];
		var damage=values[names['damage']];

		const header=names['header'];
		
		var rollString=`${prefix_damage_roll} {{header=^{${header}}}}`;

		
		var damageString='';

		if (damage_type === 'damage') {
			if (isCritical==1){
				damageString=`{{damage=[[2*${damage}]]}}`;
			}else{
				damageString=`{{damage=[[${damage}]]}}`;
			}
			
			rollString = `${rollString}  ${damageString}`;
			
			rollString = check_track_ammo(rollString,trackAmmo,currentAmmo,usedAmmo)
		}else if (damage_type === 'lethality') {
			if (isCritical==1){
				damage=2*damage;
			}
			damageString=`{{lethality=[[${damage}]]}}`;
			
			rollString = `${rollString} ${damageString}`;
			rollString = `${rollString} {{roll=[[1d100]]}}`;
			
			rollString = check_track_ammo(rollString,trackAmmo,currentAmmo,usedAmmo)
		}
		rollString = `${rollString} {{isCritical=[[${isCritical}]]}}`;
		
		console.info(rollString);
		
		startRoll(rollString, (results) => {
			
			const newroll = getRollDamage(results,trackAmmo,damage_type,isCritical);
			
			newroll['isCritical']=isCritical;
			newroll['trackbullets']=trackAmmo;
			finishRoll(results.rollId,newroll);
			if (trackAmmo==1){
				const update={};
				update[names['ammo']]=newroll['current_ammo'];
				setAttrs(update, () => {
					console.log('Ammo updated',update);
				});
			}
		});
	});
};


const getRollDamage= (results,trackammo,damage_type,critical) =>{
	const newroll={};
	if (trackammo==1){
		const trackbullets=[[1]];
		newroll['trackbullets']=trackbullets;
		const used_ammo=results.results.used_ammo.result;
		const current_ammo=results.results.current_ammo.result;
		const expended_ammo= current_ammo - used_ammo;

		newroll['current_ammo']= expended_ammo;
	}
	if (damage_type==='damage'){
		const damage=results.results.damage.result;
		newroll['damage']=damage;
	}
	if (damage_type==='lethality'){
		const lethality=results.results.lethality.result;
		const roll=results.results.roll.result;
		const quotient=roll/10;
		const remainder=Math.round((roll%10) * 10);
		var computed_lethality=lethality;
		var computed_roll= quotient+ (remainder>0 ? remainder : 10);

		if (critical==1) {
			computed_lethality=lethality*2;
			computed_roll= computed_roll*2;
		}
		
		newroll['roll']=computed_roll;
		newroll['lethality']=computed_lethality;
	}
	return newroll;
};












const clicked_repeating_weapons= (parameters,names,queryModifier) => {
	getAttrs(parameters, (values) => {
		const character_id=values['character_id'];
		const repsecid= names['repsecid'];
		const skillname=values[names['name']];
		const skillrank=parseInt(values[names['rank']]) || 0;
		const hasammo=values[names['hasammo']];
		const track_bullets=values[names['track_bullets']] === 'active' ? 1 : 0;
		const track_and_hasammo=(hasammo+track_bullets)===2 ? 1 : 0;	
		const advanced_weapons=values[names['advanced_weapons']] === 'active' ? 1 : 0;
		
		const isShotgun = values[names['shotgun']] === 'active' ? 1 : 0;
		const hasdouble_damage = values[names['double_damage']] === 'active' ? 1 : 0;
		const hasSelectiveFire = values[names['selfire']] === 'active' ? 1 : 0;
		const hasAccessories = values[names['accessories']] === 'active' ? 1 : 0;
		const hasBlastRadius = values[names['blast_radius']] === 'active' ? 1 : 0;
		/************************************************
		console.log(`isShotgun: ${isShotgun}`);	
		console.log(`hasdouble_damage: ${hasdouble_damage}`);
		console.log(`hasSelectiveFire: ${hasSelectiveFire}`);
		console.log(`hasAccessories: ${hasAccessories}`);
		console.log(`hasBlastRadius: ${hasBlastRadius}`);
		************************************************/
		const full_damage= values[names['damage']];
		const full_lethality=values[names['lethality']];

		const rollString=`${prefix_skill_roll} {{header=${skillname}}} {{subheader=${skillrank}}}`;

		const wp_modifiers=check_for_wp_modifiers(values);

		const _zero_will_power = wp_modifiers.zero_will_power;
		const _low_will_power = wp_modifiers.low_will_power;
		
		var rollValue = `${rollString} {{rating=[[${skillrank}]]}}  {{zero_will_power=${_zero_will_power}}} {{low_will_power=${_low_will_power}}}}  {{modifier=[[${queryModifier}]]}} {{isCritical=[[0]]}} {{isSuccess=[[0]]}}`;		
		rollValue = `${rollValue} {{advanced_weapons=[[${advanced_weapons}]]}}`;
		
		if (full_damage != "") {
			
			rollValue = rollValue + '{{damage= ['+full_damage+'](~'+ character_id +'|'+repsecid+'_damage)}}';
			rollValue = rollValue + '{{damageCritical= [('+full_damage+')2](~'+ character_id +'|'+repsecid+'_damageCritical)}}';
		}
		if (full_lethality >0) {
			const critical_lethality=full_lethality*2;
			rollValue = rollValue + '{{lethality= ['+full_lethality+'](~'+ character_id +'|'+repsecid+'_lethality)}}';
			rollValue = rollValue + '{{lethalityCritical= ['+critical_lethality+'](~'+ character_id +'|'+repsecid+'_lethalityCritical)}}';
		}

		if (track_and_hasammo===1) {
			rollValue = rollValue + '{{trackbullets=1}}';
			rollValue = rollValue + '{{current_ammo=' + values['ammo'] + '}}';
		}
		if (advanced_weapons===1) {
			if (isShotgun===1) {
				rollValue = rollValue + '{{shotgun=[[1]]}}';
				if (hasdouble_damage===1) {
					const full_damage_2=values[names['damage_2']];
					if (full_damage_2 != "") {
						rollValue = rollValue + '{{double_damage=['+full_damage_2+'](~'+ character_id +'|'+repsecid+'_double_damage)}}';
						rollValue = rollValue + '{{double_damageCritical=[('+full_damage_2+')2](~'+ character_id +'|'+repsecid+'_double_damageCritical)}}';
					}
				}
			}
			//*********************
			if (hasSelectiveFire===1) {
				const full_sellethality=Math.max(0,parseInt(values[names['selfireLethality']])|| 0);
				
				const selfireType=values[names['selfireType']];

				console.log('full_sellethality: '+full_sellethality);
				console.log('selfire type: '+selfireType);	
				if (full_sellethality>0) {
					const critical_sellethality=full_sellethality*2;
					console.log('selfire type: '+selfireType);
					console.info('values',values);
					rollValue = rollValue + '{{selective_fire=[' + selfireType;
					rollValue = rollValue + '(' + full_sellethality + ')]';
					rollValue = rollValue + '(~' + character_id + '|'+repsecid+'_selective_fire)}}';
					rollValue = rollValue + '{{selective_fireCritical=[' + selfireType;
					rollValue = rollValue + '(' + critical_sellethality + ')]';
					rollValue = rollValue + '(~' + character_id + '|'+repsecid+'_selective_fireCritical)}}';
				}
			}
			if (hasAccessories===1) {
				rollValue = rollValue + '{{accessories=[[1]]}}';
				var accessoriesName=values[names['accessoriesName']];
				accessoriesName=(accessoriesName==='') ? '^[accessory]' : accessoriesName;
				rollValue = rollValue + '{{accessoriesName=' + values[names['accessoriesName']] + '}}';
				rollValue = rollValue + '{{accessoriesMod=[[' + (parseInt(values[names['accessoriesMod']])||0) + ']]}}';
			}
			if (hasBlastRadius===1) {
				rollValue = rollValue + '{{blast_radius=[[1]]}}';
			}
		}	


		const options= {
			isLethality: full_lethality>0 ? 1 : 0,
			isShotgun: isShotgun,
			hasdouble_damage: hasdouble_damage,
			hasSelectiveFire: hasSelectiveFire,
			hasAccessories: hasAccessories,
			hasBlastRadius: hasBlastRadius,
			track_and_hasammo: track_and_hasammo,
			advanced_weapons: advanced_weapons
		};
		console.log(rollValue);
		rollAttacks(rollValue,skillname,options);


	});
};

const clicked_repeating_actions = (type,parameters,names,queryModifier) => {
	
	initializeRolls();		// Initialize the rolls if flag is not set
	if (type==='weapons'){
		clicked_repeating_weapons(parameters,names,queryModifier);
	}
	if (type==='bonds'){
		clicked_repeating_bonds(parameters,names,queryModifier);
	}
	if (type==='special'){
		clicked_repeating_skills(parameters,names,queryModifier,0);
	}
	if (type==='skills'){
		clicked_repeating_skills(parameters,names,queryModifier,1);
	}
}

const clicked_repeating_skills = (parameters,names,queryModifier,rollType) => {
	getAttrs(parameters, (values) => {
		const skillname=values[names['name']];
		const skillfail=names['fail'];
		const skillrank=parseInt(values[names['rank']]) || 0;
		console.log(`skillname: ${skillname} name: ${names['name']}`);
		console.log(`skillrank: ${skillrank} rank: ${names['rank']}`);
		console.info('values',values);


		const rollString=`${prefix_skill_roll} {{header=${skillname}}} {{subheader=${skillrank}}} `;
		///////////////////////////////////////////////////////////
		const wp_modifiers=check_for_wp_modifiers(values);

		const _zero_will_power = wp_modifiers.zero_will_power;
		const _low_will_power = wp_modifiers.low_will_power;
		const rating=parseInt(values[parameters[names['rank']]]) || 0;
		var rollValue = `${rollString} {{rating=[[${skillrank}]]}}  {{zero_will_power=${_zero_will_power}}} {{low_will_power=${_low_will_power}}}}  {{modifier=[[${queryModifier}]]}} {{isCritical=[[0]]}} {{isSuccess=[[0]]}}`;		


		if(_zero_will_power!='[[1]]') {
			rollValue = `${rollValue}`; 			
		}

		console.log(rollValue);
		rollSkillAndStats(rollValue,skillname,skillfail,rollType);


	});

};



const clicked_repeating_bonds = (parameters,names) => {
	getAttrs(parameters, (values) => {
		const bondname=values[names['name']];
		const bondscore=parseInt(values[names['score']]) || 0;
        const local_wp_points=parseInt(values[names['local_wp_points']]) || 0;
		const local_san_points=parseInt(values[names['local_san_points']]) || 0;
		const character_id=values['character_id'];
		console.log(`bondname: ${bondname} name: ${names['name']}`);
		console.log(`bondscore: ${bondscore} score: ${names['score']}`);
		console.log(`local_wp_points: ${local_wp_points} wp_points: ${parameters[`willpower_points`]}`);
		console.log(`local_san_points: ${local_san_points} san_points: ${parameters[`sanity_points`]}`);
		console.info('values',values);


		const rollString=`${prefix_bond_roll} {{header=${bondname}}} {{subheader=${bondscore}}} `;
		///////////////////////////////////////////////////////////
		
		var rollValue = `${rollString} {{zerowp=[[0]]}} {{score=[[${bondscore}]]}} {{local_wp=[[${local_wp_points}]]}} {{local_sanity=[[${local_san_points}}]]}} {{repress= [^{repress}](~${character_id}|sanity_points)}}`;
		rollValue=`${rollValue} {{projection=1}} {{repression=1}}`;
		console.info('rollValue',rollValue);

		console.log(rollValue);
		rollBonds(rollValue,values,names,parameters);


	});

};
// Important functions
const _allrolls=arrays['_derived_rolls'].concat(arrays[`_stats`],arrays[`_skills`],['unnatural']);
_allrolls.forEach(roll => {
		const _roll = (roll === 'sanity_points') ? 'sanity' : roll;
		
		const queryModifier=_queryModifier;
		on(`clicked:${roll}-action`, (eventInfo) => {
			console.log(eventInfo);
			var _header = ``;
			
			if (arrays[`_editable_skills`].includes(_roll)){
				console.log('editable skill');
				const prefix_skill=_roll.slice(0,-2);
				console.log(`prefix: ${prefix_skill}`);
				getAttrs([`${_roll}_name`], (values) => {
					_header = `{{header=^{${prefix_skill.replace('_',' ')}} (${values[`${_roll}_name`]})}}`;
				
					console.log(`header: ${_header}`);
					const rollString=`${prefix_skill_roll} ${_header} {{subheader=@{${roll}}}} `;
					rollwithmodifiers(rollString,roll,queryModifier);
				});
			}else{
				const caps = (_roll === 'humint' || _roll === 'sigint') ? _roll.toUpperCase() : _roll.replace('_',' ')
				_header = `{{header=^{${caps.replace('_',' ')}}}}`;
				const rollString=`${prefix_skill_roll} ${_header} {{subheader=@{${roll}}}} `;
				
				rollwithmodifiers(rollString,roll,queryModifier);

			
			}
	
		});
});

const setCommonParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`name`] = `${repsecid}_name`;
	_input_names[`repsecid`] = `${repsecid}`;
	_parameters.push(_input_names[`name`]);
    _parameters.push(`willpower_points`);
    _parameters.push(`sanity_points`);
    _parameters.push(`low_will_power`);
    _parameters.push(`zero_will_power`);
    _parameters.push(`character_id`);
	
}

const setSkillsParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`rank`] = `${repsecid}_rank`;    
	_input_names[`fail`] = `${repsecid}_fail`;
	_parameters.push(_input_names[`rank`]);
	_parameters.push(_input_names[`fail`]);
}

const setBondsParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`local_wp_points`] = `${repsecid}_wp_points`;
	_input_names[`local_san_points`] = `${repsecid}_san_points`;
	_input_names[`score`] = `${repsecid}_score`;
	_parameters.push(_input_names[`local_wp_points`]);
	_parameters.push(_input_names[`local_san_points`]);
	_parameters.push(_input_names[`score`]);
};

const setSpecialParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`rank`] = `${repsecid}_skill_span`;   
	_parameters.push(_input_names[`rank`]);
};

const setGeneralWeaponParametersAndInputNames=(repsecid, _parameters, _input_names)=>{
	_input_names[`rank`] = `${repsecid}_skill_span`;
	_parameters.push(_input_names[`rank`]);
	_input_names[`range`] = `${repsecid}_base_range`;
	_parameters.push(_input_names[`range`]);
	_input_names[`damage`] = `${repsecid}_damage`;
	// write the push in function of the input name
	_parameters.push(_input_names[`damage`]);
	_input_names[`armor_piercing`] = `${repsecid}_armor_piercing`;
	_parameters.push(_input_names[`armor_piercing`]);
	_input_names[`ammo`] = `${repsecid}_ammo`;
	_parameters.push(_input_names[`ammo`]);
	_input_names[`hasAmmo`] = `${repsecid}_hasammo`;
	_parameters.push(_input_names[`hasAmmo`]);
		
	_input_names[`lethality`]=`${repsecid}_lethality_percent`;
	_parameters.push(_input_names[`lethality`]);
	_input_names[`kill_radius`]=`${repsecid}_kill_radius`;
	_parameters.push(_input_names[`kill_radius`]);
};

const setShotgunParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`shotgun`] = `${repsecid}_shotgun`;
	_parameters.push(_input_names[`shotgun`]);
	_input_names[`double_damage`] = `${repsecid}_double_damage`;	
	_parameters.push(_input_names[`double_damage`]);
	_input_names[`damage_2`] = `${repsecid}_damage_2`;
	_parameters.push(_input_names[`damage_2`]);
};

const setAccessoriesParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`accessories`]=`${repsecid}_accessories`;	
	_parameters.push(_input_names[`accessories`]);
	_input_names[`accessoriesName`]=`${repsecid}_accessoriesName`;
	_parameters.push(_input_names[`accessoriesName`]);
	_input_names[`accessoriesMod`]=`${repsecid}_accessoriesMod`;
	_parameters.push(_input_names[`accessoriesMod`]);
};

const setBlastRadiusParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`blast_radius`]=`${repsecid}_blast_radius`;
	_parameters.push(_input_names[`blast_radius`]);
};

const setSelectiveFireParametersAndInputNames=(repsecid, _parameters, _input_names) => {
	_input_names[`selfire`]=`${repsecid}_selfire`;
	_parameters.push(_input_names[`selfire`]);	
	_input_names[`selfireLethality`]=`${repsecid}_selfireLethality`;
	_parameters.push(_input_names[`selfireLethality`]);
	_input_names[`selfireType`]=`${repsecid}_selfireType`;
	_parameters.push(_input_names[`selfireType`]);
};

const setAdvancedWeaponParametersAndInputNames=(repsecid, _parameters, _input_names) => {

	_input_names[`advanced_weapons`]=`advanced_weapons`;
	_parameters.push(_input_names[`advanced_weapons`]);

	setShotgunParametersAndInputNames(repsecid, _parameters, _input_names);
	setAccessoriesParametersAndInputNames(repsecid, _parameters, _input_names);
	setBlastRadiusParametersAndInputNames(repsecid, _parameters, _input_names);
	setSelectiveFireParametersAndInputNames(repsecid, _parameters, _input_names);	

}

const setRepeatingParametersAndInputNames=(section, id, _parameters, _input_names) => {
	const repsecid = `repeating_${section}_${id}`;
	_input_names[`section`] = section;
	_input_names[`id`] = id;
	setCommonParametersAndInputNames(repsecid, _parameters, _input_names);
    if (section === 'skills') {
        setSkillsParametersAndInputNames(repsecid, _parameters, _input_names);
    } else if (section === 'bonds') {
		setBondsParametersAndInputNames(repsecid, _parameters, _input_names);
    } else if (section === 'special') {
		setSpecialParametersAndInputNames(repsecid, _parameters, _input_names);
    } else if (section==='weapons') {

		setGeneralWeaponParametersAndInputNames(repsecid, _parameters, _input_names);

		setAdvancedWeaponParametersAndInputNames(repsecid, _parameters, _input_names);

		_input_names[`track_bullets`]=`track_bullets`;	
		_parameters.push(_input_names[`track_bullets`]);

	} else {
        console.error(`Section ${section} not found`);
    }
}

Object.entries(_repeating_sections).forEach(([element,section]) => {
	on(`clicked:repeating_${section}:${element}-action`, (eventInfo) => {
		console.log('in repeating action section',section);
		console.log(eventInfo);
		const id = eventInfo.sourceAttribute.split('_')[2];
		const queryModifier=_queryModifier;
		var _input_names = {};
		var _parameters =[];
		setRepeatingParametersAndInputNames(section, id, _parameters, _input_names)

		console.info(`parameters: ${_parameters}`);
		console.info(`input names: ${_input_names}`);

		
		clicked_repeating_actions(section, _parameters, _input_names, queryModifier);

	});
});



//levelup character
on("clicked:levelup", () =>{
    let update={};
    let copyarray=arrays['_skills'];  // copy of the array containing all skills ranks
    let len=copyarray.length;         // length of the original copyarray
    let getarray=[];                  // used only to update the values
    let summary={};                   // information in the log for the users
    let var_rnd=0;                    // random variable of 1d4
    let block_to_insert ;
    let container_block ;
    let newrowid;
    let newrowattrs = {};
    let oldval=0;
    let newval=0;
    let name;  

	var addskill=[];
	
	getSectionIDs('skills', (idarray) => {
		addskills=idarray.map(id =>`repeating_skills_${id}`) ; 
		console.log(addskills);  //log of debugging to be sure
	
		copyarray=copyarray.concat(addskills);           // concatenate skill array with repeating skill array
		console.dir(copyarray);              
		getSectionIDs("summary", function(idarray) {
		for(var i=0; i < idarray.length; i++) {
			removeRepeatingRow("repeating_summary_" + idarray[i]);
		}
		});
		
		
		copyarray.forEach((sk,idx)=>{
			//console.log(idx);
			if (idx<len){                                // if the idx<len it means I an in the skill array part
				getAttrs([`${sk}`,`${sk}_name`,`${sk}_fail`],(val)=>{
					getarray.push(`${sk}`);
					//console.log(val[`${sk}_fail`]);
					//    console.log(`${sk}`);
					if (val[`${sk}_fail`]=='on'){                    //if the checkbox is checked
						var_rnd=Math.ceil(Math.random() * 4);     // generate a random number for each checked value (less number generated)
						//console.log(`${idx}`);
						oldval=(parseInt(val[`${sk}`])||0);
						newval=oldval+var_rnd;
						name=val[`${sk}_name`];
						summary[`${sk}`]=var_rnd;                    // how much the skill has changed 0-3
						update[`${sk}`]=newval;  // new value of the skill
						update[`${sk}_fail`]='off';                           // uncheck checkbox
						
						//block_to_insert = document.createElement( 'div' );
						//block_to_insert.innerHTML = 'This demo DIV block was inserted into the page using JavaScript.' ;
						
						//container_block = document.getElementById( 'summary' );
						//container_block.appendChild( block_to_insert );
						newrowid = generateRowID();
						newrowattrs['repeating_summary_' + newrowid + '_skillname'] = name;
						newrowattrs['repeating_summary_' + newrowid + '_oldval'] = oldval;
						newrowattrs['repeating_summary_' + newrowid + '_newval'] = newval;
						
					}
				});
			} else { // if the idx>=len it means I an in the  repeating skill array part
				getAttrs([`${sk}_name`,`${sk}_rank`,`${sk}_fail`],(val)=>{
					getarray.push(`${sk}_rank`);
					//console.log(val[`${sk}_fail`]);
					//    console.log(`${sk}`);
					if (val[`${sk}_fail`]=='on'){
						var_rnd=Math.ceil(Math.random() * 4);       // generate a random number for each checked value (less number generated)
						//console.log(`${idx}`);
						summary[`${idx-len}_rank`]=var_rnd;           // since the repeating skill don't have a name, they are identified by number 0-N
						//
						oldval=(parseInt(val[`${sk}_rank`])||0);
						newval=oldval+var_rnd;
						name=val[`${sk}_name`];
						//
						update[`${sk}_rank`]=(parseInt(val[`${sk}_rank`])||0)+var_rnd;
						update[`${sk}_fail`]='off';
						newrowid = generateRowID();
						newrowattrs['repeating_summary_' + newrowid + '_skillname'] = name;
						newrowattrs['repeating_summary_' + newrowid + '_oldval'] = oldval;
						newrowattrs['repeating_summary_' + newrowid + '_newval'] = newval;
					}
				});
			}
		});
		//console.log(getarray);
		console.log(newrowattrs);             // summary in console for the user
		//setAttrs(newrowattrs);
		console.log(summary);             // summary in console for the user
		getAttrs(getarray,()=>{             // update fields
			setAttributes(update,false);
			setAttributes(newrowattrs,false);
		});
		//console.dir(update);
	});
});

const initializeRolls = () => {
    if (!isInitialized) {
        // Perform the necessary setup for rolls
        console.info('Initializing rolls...');
        
        // Example setup code
        updateRollsOnOpen();
        updateRepeatingRollsonOpen();
        console.log('Rolls initialized');
        // Set the flag to true after initialization
        isInitialized = true;
    }
};
const selector='button.roll';
    
$20(selector).on('click', e => {
        var _header = ``;
        console.log(e);
        const roll = e.htmlAttributes.name.match(/^attr_(.*)_r$/)[1];
        const _roll = (roll === 'sanity_points') ? 'sanity' : roll;

        const hasmodifiers = (e.shiftKey) ? true : false;
        console.info(`hasmodifiers:`, hasmodifiers);
        const queryModifier = (hasmodifiers) ? _queryModifier : '0';
        
        console.info(`roll: ${roll} _roll: ${_roll}`);
        if (arrays[`_editable_skills`].includes(_roll)){
            console.log('editable skill');
            const prefix_skill=_roll.slice(0,-2);
            console.log(`prefix: ${prefix_skill}`);
            getAttrs([`${_roll}_name`], (values) => {
                _header = `{{header=^{${prefix_skill.replace('_',' ')}} (${values[`${_roll}_name`]})}}`;
            
                console.log(`header: ${_header}`);
                const rollString=`${prefix_skill_roll} ${_header} {{subheader=@{${roll}}}} `;
                rollwithmodifiers(rollString,roll,queryModifier);
            });
        }else{
            const caps = (_roll === 'humint' || _roll === 'sigint') ? _roll.toUpperCase() : _roll.replace('_',' ')
            _header = `{{header=^{${caps.replace('_',' ')}}}}`;
            const rollString=`${prefix_skill_roll} ${_header} {{subheader=@{${roll}}}} `;

             rollwithmodifiers(rollString,roll,queryModifier);
        
        }
        

});


$20('button.repeating_roll').on('click', e => {
    console.log(e);
    const id = e.htmlAttributes.value;
    const section = _repeating_sections[e.htmlAttributes.name.split('_')[1]];
    console.log(`in button rep rolls section: ${section})`);
    const hasmodifiers = (e.shiftKey) ? true : false;
    console.info(`hasmodifiers:`, hasmodifiers);
    const queryModifier = (hasmodifiers) ? _queryModifier : '0';

    var _input_names = {};
    var _parameters = [];
    setRepeatingParametersAndInputNames(section, id, _parameters, _input_names)

    console.info(`parameters: ${_parameters}`);
    console.info(`input names: ${_input_names}`);

    clicked_repeating_actions(section, _parameters, _input_names, queryModifier);
});

  

on('change:repeating_skills remove:repeating_skills', () => {
  update_additionalskills();
});

on('change:repeating_weapons:ammo_max remove:repeating_weapons', (values) => {
	const ammo_max = Math.max(0,parseInt(values.newValue)||0);
	const update = {};
	update[`repeating_weapons_ammo_max`] = ammo_max;
	update[`repeating_weapons_ammo`] = ammo_max;
	update[`repeating_weapons_hasammo`] = ammo_max > 0 ? '1' : '0';
	setAttrs(update, {silent:true}, () => {
		console.log('Ammo updated',update);
	});
});

on('change:repeating_weapons:ammo', (values) => {
	const ammo = Math.max(0,parseInt(values.newValue)||0);
	const update = {};
	update[`repeating_weapons_ammo`] = ammo;
	setAttrs(update, {silent:true}, () => {
		console.log('Ammo updated',update);
	});
});


    //= force the stats to be positive and the skills to be between 0 and 99
on(`sheet:opened`, (eventInfo) => {
		
		// === Versioning
	getAttrs(['version'], values => { versioning(parseFloat(values.version) || 1); });

	initializeRolls();			
		
});

  
const isJSONString = (string) => {
	let json= {};
	try {
		json = JSON.parse(string);
	} catch (e) {
		console.info('it is not a JSON');
		return false;
	}
	console.info(`string`,json)
	return json;
}
const arrays_drop={
	fields : [
		"employer","profession",
		"accounting","alertness","anthropology","archeology","art_1","art_1_name","art_2","art_2_name","artillery","athletics","bureaucracy",
		"computer_science","craft_1","craft_1_name","craft_2","craft_2_name","criminology","demolitions","disguise","dodge","drive","firearms",
		"first_aid","forensics","heavy_machinery","heavy_weapons","history","humint","law","medicine","melee_weapons","military_science_1",
		"military_science_1_name","military_science_2","military_science_2_name","navigate","occult","persuade","pharmacy","pilot_1","pilot_1_name",
		"pilot_2","pilot_","psychotherapy","ride","science_1","science_1_name","science_1","science_2_name","search","sigint",	"stealth","surgery",
		"survival",	"swim","unarmed_combat","unnatural",
		"armor_and_gear","personal_details_and_notes","motivations","bond_number"],
	visible: ["accounting","alertness","anthropology","archeology","art_1","art_1_name","art_2","art_2_name","artillery","athletics","bureaucracy",
		"computer_science","craft_1","craft_1_name","craft_2","craft_2_name","criminology","demolitions","disguise","dodge","drive","firearms",
		"first_aid","forensics","heavy_machinery","heavy_weapons","history","humint","law","medicine","melee_weapons","military_science_1",
		"military_science_1_name","military_science_2","military_science_2_name","navigate","occult","persuade","pharmacy","pilot_1","pilot_1_name",
		"pilot_2","pilot_","psychotherapy","ride","science_1","science_1_name","science_1","science_2_name","search","sigint",	"stealth","surgery",
		"survival",	"swim","unarmed_combat","unnatural"],
	bond: ["name","bond_score"],
	skill: ["name","rank"],
	special_training:["name","skill_or_stat_used"],
	weapon :["name", "skill_percent", "base_range", "damage", "armor_piercing", "lethality_percent", "ammo"],
	rep: {bond: "repeating_bonds_",special: "repeating_special_",skill:"repeating_skills_",ritual:"repeating_rituals_",weapon:"repeating_weapons_"},
}


const dropAgent = (data) => {
	const updateAttrs = {};
	updateAttrs[`sheet_type`] = "pc";
	
	// bonds
	const special_trainings = isJSONString(data.repeated_special_trainings);
	const rituals= isJSONString(data.repeating_rituals);
	const weapons= isJSONString(data.repeating_weapons);
	const repSkills= isJSONString(data.repeating_skills);
	const dropfields= arrays_drop[`fields`];
	const visible=arrays_drop['visible'];
	console.log(`special_trainings: ${special_trainings}`);
	console.log(`rituals: ${rituals}`);
	console.log(`weapons: ${weapons}`);
	console.log(`repSkills: ${repSkills}`);

	if (repSkills){
		for (const skill of repSkills){
			let dRepSkills=dropRepSkills(skill);
			Object.keys(dRepSkills).forEach(key => updateAttrs[key] = dRepSkills[key]);
		}
	}

	if (special_trainings){
		for (const special_training of special_trainings){
			let dSpecialTraining=dropSpecialTraining(special_training);
			Object.keys(dSpecialTraining).forEach(key => updateAttrs[key] = dSpecialTraining[key]);
		}
	}
/*	
	if (rituals){
		for (const ritual of rituals){
			let dRitual=dropRitual(ritual);
			Object.keys(dRitual).forEach(key => updateAttrs[key] = dRitual[key]);
		}
	}
*/
	if (weapons){
		for (const weapon of weapons){
			let dWeapons=dropWeapon(weapon);
			Object.keys(dWeapons).forEach(key => updateAttrs[key] = dWeapons[key]);
		}
	}

	console.info('drop fields:',dropfields);
	for (const field of dropfields){
		console.log(field);
		console.log(data[field]);
		if (data[field]){
			if (field === "bond_number") {	
				for (i=0; i<data[field]; i++){	
					let UIDD = generateRowID();
					let prefix=`${arrays_drop[`rep`][`bond`]}${UIDD}`;
					updateAttrs[`${prefix}_name`] = `bond_${i}`;
					updateAttrs[`${prefix}_test`] = `editable`;
				}
			}else{
			updateAttrs[field] = data[field];
			}
			if (visible.includes(field)){
				updateAttrs[`${field}_visible`]=`visible`;
			}
		}
	}

	console.info(`Agent:`,updateAttrs);
	return updateAttrs;
}

const dropRepSkills = (data) => {
	const updateAttrs = {};
	let UIDD = generateRowID();
	let prefix=`${arrays_drop[`rep`][`skill`]}${UIDD}`;
	const dropskillfields=arrays_drop[`skill`];
	dropskillfields.forEach(field =>{
		updateAttrs[`${prefix}_${field}`] = data[field];
	});
	updateAttrs[`${prefix}_test`] = `editable`;
	console.info(`repeating skills:`,updateAttrs);
	return updateAttrs;
}

const dropSpecialTraining = (data) => {
	const updateAttrs = {};
	let UIDD = generateRowID();
	var prefix=`${arrays_drop[`rep`][`special`]}${UIDD}`;
	const dropspecialtrainingfields=arrays_drop[`special_training`];
	dropspecialtrainingfields.forEach(field =>{
		if (data[field]){ 
			if (field === "skill_or_stat_used"){		
				let skillname=data[`skill_or_stat_used`].toLowerCase().replace(/ /g, "_");
				updateAttrs[`${prefix}_skill_or_stat_used`] = `@{${skillname}}`;
			}else{
				updateAttrs[`${prefix}_${field}`] = data[field];
			}
		}
	});
	updateAttrs[`${prefix}_test`] = `editable`;
	console.info(`special training:`, updateAttrs);
	return updateAttrs;
}

/*
const dropRitual = (data) => {
	const updateAttrs = {};
	const UIDD = generateRowID();
	const prefix=`repeating_rituals_${UIDD}`;
	// to be updated when the format is decided

	console.log(updateAttrs);
	return updateAttrs;
}

const dropMonster = (data) => {
	const updateAttrs = {};
	updateAttrs[`sheet_type`] = "npc";
	// to be updated when the format is decided
	console.log(updateAttrs);
	return updateAttrs;
}
*/
const dropWeapon = (data) => {
	const updateAttrs = {};
	let UIDD = generateRowID();
	var prefix=`${arrays_drop[`rep`][`weapon`]}${UIDD}`;
	const weaponfields=arrays_drop[`weapon`];
	for (const field of weaponfields){
		if (data[field]){
			if (field === "skill_percent"){
				let skillname=cleanedSkill(data[field]);
				console.info(skillname);
				if (isSkillNumber(skillname)){
					updateAttrs[`${prefix}_skill_percent`] = skillname;
				}else if (isValidSkill(skillname)){
					updateAttrs[`${prefix}_skill_percent`] = `@{${skillname}}`;
				}else{
					console.error(`skill not found: ${skillname}`);
				}
			}else{
				updateAttrs[`${prefix}_${field}`] = data[field];
			}
		}
	}
	console.log(`weapon:`, updateAttrs);
	return updateAttrs;
}

/*
const dropWeaponWrapper = (data) => {
	const updateAttrs = {};
	const weapon = isJSONString(data.repeating_weapons);
	let dWeapons=dropWeapon(weapon);
	Object.keys(dWeapons).forEach(key => updateAttrs[key] = dWeapons[key]);
	console.log("here the new weapon");
	console.log(updateAttrs);
	return updateAttrs;

}
*/
const getDropType = data => data.Category || false;

const handleDragandDrop = () => {
	getAttrs(["drop_name","drop_data"], (v) => {
		const {drop_name, drop_data} = v;
		if (drop_name==="" || drop_data===""){return;}
		const dropDataParsed =JSON.parse(drop_data);
		const dropType =  getDropType(dropDataParsed);
		console.info(`drop type:`, dropType);
		console.info('data:',dropDataParsed);
		
		var updateAttrs = false;
		if (dropType === "Agents"){     
			console.log("It's an Agent");
		   updateAttrs=  dropAgent(dropDataParsed);
		}
		
		if (dropType === "Bonds"){     
			console.log("It's a Bond");
            updateAttrs= dropBond(dropDataParsed);
		}
		if (dropType === "SpecialTrainings"){     
			console.log("It's an Special Training");
			updateAttrs= dropSpecialTraining(dropDataParsed);
		}
		if (dropType === "Weapons"){
	        console.log("It's a Weapon");

			updateAttrs= dropWeapon(dropDataParsed);
		}
		if (updateAttrs === false) {
			updateAttrs = {...{drop_name:"", drop_data:"",drop_category:""}};
			setAttrs(updateAttrs);
			return	console.warn("Drag and drop could not identify the type of drop");
		}
		if (typeof updateAttrs !== "object") {
			updateAttrs = {...{drop_name:"", drop_data:"",drop_category:""}};
			setAttrs(updateAttrs);
			return console.warn("Drag and drop returned  broken value");
		}
		const updateAttrsTot = {...updateAttrs, ...{drop_name:"", drop_data:"",drop_category:""}};
		console.log(updateAttrsTot);
		setAttrs(updateAttrsTot);

	});
}

on("change:drop_data", (eventInfo) => {
	const jsonData = JSON.parse(eventInfo.newValue);
	console.log(jsonData);
	handleDragandDrop();
	// do something with data
});


   // handle WP
</script>