<div class="center-of-character-sheet">
  <div class="scrollable-content">
    <!-- Deprecated Attributes -->
    <input type="hidden" name="attr_thresholdModifierEnabled" value="enabled" />

    <!-- Hidden Inputs -->
    <input type="hidden" name="attr_strMod" value="0" />
    <input type="hidden" name="attr_dexMod" value="0" />
    <input type="hidden" name="attr_ArmorWeightTotal" value="0" />
    <input type="hidden" name="attr_ItemWeightTotal" value="0" />
    <input type="hidden" name="attr_WeaponWeightTotal" value="0" />
    <input type="hidden" name="attr_sheetTab" value="character" />
    <input type="hidden" name="attr_turnUndead" value="false" />
    <input type="hidden" name="attr_spells" value="[]" />
    <input type="hidden" name="attr_knacks" value="false" />
    <input type="hidden" name="attr_glamours" value="false" />
    <input type="hidden" name="attr_runes" value="false" />
    <input type="hidden" name="attr_kindred" value="--" />
    <input type="hidden" name="attr_class" value="--"/>

    <!-- Sheet Selector -->
    <div class="sheet-button-select">
      <button class="tab" type="action" name="act_character" data-i18n="character">Character</button>
      <button class="tab" type="action" name="act_spells" data-i18n="magic">Magic</button>
      <button class="tab" type="action" name="act_retainers" data-i18n="retainers">Retainers</button>
      <button class="tab" type="action" name="act_monster" data-i18n="monster">Monster</button>
      <button class="tab" type="action" name="act_notes" data-i18n="notes">Notes</button>
      <button class="tab" type="action" name="act_settings" data-i18n="settings">Settings</button>
    </div>

    <!-- Character Sheet -->
    <div class="sheet-character">
      <div class="info-grid">
        <div class="infos">
          <div class="flex">
            <label class="inline-flex space-between">
              <span data-i18n="name">Name:</span>
              <input type="text" name="attr_character_name"/>
              <span data-i18n="title">Title</span>
              <input type="text" name="attr_title"/>
            </label>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="kindred">Kindred:</span>
              <select name="attr_kindred" class="sheet-kindred">
                <option value="" selected="selected">--</option>
                <option value="breggle" data-i18n="breggle">Breggle</option>
                <option value="cobbin" data-i18n="cobbin">Cobbin</option>
                <option value="elf" data-i18n="elf">Elf</option>
                <option value="grimalkin" data-i18n="grimalkin">Grimalkin</option>
                <option value="human" data-i18n="human">Human</option>
                <option value="mossling" data-i18n="mossling">Mossling</option>
                <option value="woodgrue" data-i18n="woodgrue">Woodgrue</option>
                <option value="custom" data-i18n="custom">Custom</option>
              </select>
              <span data-i18n="class">Class:</span>
              <select name="attr_class" class="class">
                <option>--</option>
                <option value="Bard" data-i18n="bard">Bard</option>
                <option value="Cleric" data-i18n="cleric">Cleric</option>
                <option value="Enchanter" data-i18n="enchanter">Enchanter</option>
                <option value="Fighter" data-i18n="fighter">Fighter</option>
                <option value="Friar" data-i18n="friar">Friar</option>
                <option value="Hunter" data-i18n="hunter">Hunter</option>
                <option value="Knight" data-i18n="knight">Knight</option>
                <option value="Magician" data-i18n="magician">Magician</option>
                <option value="Thief" data-i18n="thief">Thief</option>
                <option value="Everyday Mortal" data-i18n="everyday-mortal">Everyday Mortal</option>
                <option value="Custom" data-i18n="custom">Custom</option>
                <optgroup label="Kindred-class" data-i18n="kindred-classes">
                  <option value="Breggle" data-i18n="breggle">Breggle</option>
                  <option value="Cobbin" data-i18n="cobbin">Cobbin</option>
                  <option value="Elf" data-i18n="elf">Elf</option>
                  <option value="Grimalkin" data-i18n="grimalkin">Grimalkin</option>
                  <option value="Mossling" data-i18n="mossling">Mossling</option>
                  <option value="Woodgrue" data-i18n="woodgrue">Woodgrue</option>
                  <option value="Monster" data-i18n="monster">Monster</option>
                  <option value="Custom Kindred-class" data-i18n="custom-kindred-class">Custom Kindred-class</option>
                </optgroup>
              </select>
            </label>
          </div>
          <div>
            <div class="flex xp">
              <span data-i18n="level">Level</span>
              <input type="number" min="0" name="attr_level" value="1" />
              <button type="roll" name="hitpointsRoll" data-i18n="hit-dice-abbr" title="Hit Dice" data-i18n-title="hit-dice"
                value="&{template:simple} {{roll=HP for @{character_name}}} {{result=[[@{hitdice}+[[@{conMod}*{@{level}, 9}kl1]]]]}}">
                HD
              </button>
              <input type="text" name="attr_hitdice" value="0"/>
              <span data-i18n="experience-abbr">XP</span>
              <input type="number" min="0" name="attr_XP" value="0" />
              <span data-i18n="next">Next</span>
              <input type="number" min="0" name="attr_Next" data-i18n-title="experience-next"
                title="Experience to Next Level" value="0" />
              <span>+%:</span>
              <input type="number" name="attr_ExpPercentage" value="0" />
            </div>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="alignment">Alignment:</span>
              <input type="text" name="attr_alignment" />
              <span data-i18n="affiliation">Affiliation:</span>
              <input type="text" name="attr_affiliation" />
            </label>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="background">Background</span>
              <input type="text" name="attr_background"/>
            </label>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="languages">Languages:</span>
              <input type="text" name="attr_languages" />
            </label>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="description-goals-beliefs">Description/Goals/Beliefs:</span>
              <textarea name="attr_descGoalBel" rows="2"></textarea>
            </label>
          </div>
          <div class="flex">
            <label class="inline-flex">
              <span data-i18n="moon-sign">Moon Sign:</span>
              <input type="text" name="attr_moonsign" />
            </label>
          </div>
        </div>
      </div>

<!-- Attributes -->

      <div>
        <div class="divider"></div>
        <h1 data-i18n="ability-scores">Ability Scores</h1>
        <div class="scores roll flex">
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollSTR"
              value="&{template:greater} {{roll=@{character_name} rolls ^{strength}}} {{result=[[ ([[1d6]]+[[@{strMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="strength">
              Strength
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_str" value="10" />
              <input type="number" readonly id="ability-strength-modifier" name="attr_strMod" value="0" />
            </div>
          </label>
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollINT"
              value="&{template:greater} {{roll=@{character_name} rolls ^{intelligence}}} {{result=[[ ([[1d6]]+[[@{intMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="intelligence">
              Inelegance
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_int" value="10" />
              <input type="number" readonly id="ability-intelligence-modifier" name="attr_intMod" value="0" />
            </div>
          </label>
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollWIS"
              value="&{template:greater} {{roll=@{character_name} rolls ^{wisdom}}} {{result=[[ ([[1d6]]+[[@{wisMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="wisdom">
              Wisdom
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_wis" value="10" />
              <input type="number" readonly id="ability-wisdom-modifier" name="attr_wisMod" value="0" />
            </div>
          </label>
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollDEX"
              value="&{template:greater} {{roll=@{character_name} rolls ^{dexterity}}} {{result=[[ ([[1d6]]+[[@{dexMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="dexterity">
              Dexterity
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_dex" value="10" />
              <input type="number" readonly id="ability-dexterity-modifier" name="attr_dexMod" value="0" />
            </div>
          </label>
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollCON"
              value="&{template:greater} {{roll=@{character_name} rolls ^{constitution}}} {{result=[[ ([[1d6]]+[[@{conMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="constitution">
              Constitution
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_con" value="10" />
              <input type="number" readonly id="ability-constitution-modifier" name="attr_conMod" value="0" />
            </div>
          </label>
          <label class="attribute">
            <button type="roll" class="attribute-roll-btn" name="attr_rollCHA"
              value="&{template:greater} {{roll=@{character_name} rolls ^{charisma}}} {{result=[[ ([[1d6]]+[[@{chaMod}]]+[[@{optionalModQuery}]])>=4 ]]}} {{check=[[4-@{optionalModQuery}]]}}"
              data-i18n="charisma">
              Charisma
            </button>
            <div class="attribute-scores">
              <input type="number" name="attr_cha" value="10" />
              <input type="number" readonly id="ability-charisma-modifier" name="attr_chaMod" value="0" />
            </div>
          </label>
        </div>
      </div>

      <div class="divider"></div>
      
<!-- Combat Info -->

      <div class="combat-info">
        <div class="flex hp">
          <label class="max-hp">
            <input type="number" name="attr_HP_max" value="0" />
            <span data-i18n="max-hp">Max HP</span>
          </label>
          <label class="current-hp">
            <input type="number" name="attr_HP" value="0" />
            <span data-i18n="hit-points-abbr">HP</span>
          </label>
        </div>
        <div class="center">
          <div class="sheet-saves">
            <span data-i18n="save-targets">Save Targets</span>
            <div class="saving roll flex">
              <label class="save-group">
                <button type="roll" name="attr_rollSaveD"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{doom}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveD} ]]}} {{check=[[@{saveD}]]}}"
                  data-i18n="doom">
                  Doom
                </button>
                <input type="number" name="attr_saveD" value="0" />
              </label>
              <label class="save-group bottom">
                <input type="number" name="attr_saveW" value="0" />
                <button type="roll" name="attr_rollSaveW"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{ray}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveW} ]]}} {{check=[[@{saveW}]]}}"
                  data-i18n="ray">
                  Ray
                </button>
              </label>
              <label class="save-group">
                <button type="roll" name="attr_rollSaveP"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{hold}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveP} ]]}} {{check=[[@{saveP}]]}}"
                  data-i18n="hold">
                  Hold
                </button>
                <input type="number" name="attr_saveP" value="0" />
              </label>
              <label class="save-group bottom">
                <input type="number" name="attr_saveB" value="0" />
                <button type="roll" name="attr_rollSaveB"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{blast}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveB} ]]}} {{check=[[@{saveB}]]}}"
                  data-i18n="blast">
                  Blast
                </button>
              </label>
              <label class="save-group">
                <button type="roll" name="attr_rollSaveS"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{spell}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveS} ]]}} {{check=[[@{saveS}]]}}"
                  data-i18n="spell">
                  Spell
                </button>
                <input type="number" name="attr_saveS" value="0" />
              </label>
              <label class="save-group magic-resistance">
                <span data-i18n="magic-resistance-1">Magic</span>
                <input type="number" name="attr_magicResistance" value="0" />
                <span data-i18n="magic-resistance-2">Resistance</span>
              </label>
            </div>
          </div>
          <div class="sheet-col movement">
            <table>
              <caption data-i18n="movement">
                Movement
              </caption>
              <tbody>
                <tr>
                  <td>
                    <span data-i18n="movement-sp">Speed</span>
                    <input type="number" min="0" name="attr_movementSpeed" data-i18n-title="movement-speed"
                    title="Movement - Speed" value="40" />
                  </td>
                  <td>
                    <span data-i18n="movement-ex">Exploration</span>
                    <input readonly type="number" name="attr_movementExploration" data-i18n-title="movement-exploration"
                    title="Movement - Exploration" value="" />
                  </td>
                  <td>
                    <span data-i18n="movement-ov">Overland</span>
                    <input readonly type="number" name="attr_movementOverland" data-i18n-title="movement-overland"
                    title="Movement - Overland" value="" />
                  </td>
                </tr>
                <tr>
                  <td>
                    <span data-i18n="feet-per-round">Feet / Round</span>
                  </td>
                  <td>
                    <span data-i18n="feet-per-turn">Feet / Turn</span>
                  </td>
                  <td>
                    <span data-i18n="travel-points-per-day">Travel Points / Day</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="ac-attack">
          <label class="ac">
            <span data-i18n="armor-class-abbr" title="Armor Class" data-i18n-title="armor-class">AC</span>
            <input readonly type="number" name="attr_aacAc" value="0" />
          </label>
          <label class="attack">
            <input type="number" name="attr_bab" value="0" />
            <span data-i18n="attack-bonus-abbr" title="Attack"
              data-i18n-title="attack-bonus">Attack</span>
          </label>
        </div>
      </div>

      <div class="divider"></div>
      <div class="sheet-weapons sheet-repeat">
        <h1 data-i18n="weapons">Weapons</h1>
        <div class="weapons-grid">
          <span></span>
          <span data-i18n="name">Name</span>
          <span data-i18n="type">Type</span>
          <span data-i18n="attack-modifier">+Attack</span>
          <span data-i18n="damage-die">Damage Die</span>
          <span data-i18n="damage-modifier">+Damage</span>
        </div>
        <fieldset class="repeating_weapons">
          <input type="hidden" name="attr_weaponAttributeBonus" value="@{strMod}" />
          <input type="hidden" name="attr_weaponAttributeBonusDamage" value="@{strMod}" />
          <div class="weapons-grid">
            <div>
              <!-- AAC Attack -->
              <button type="roll" name="aacAttackRoll" class="attack-roll attack-roll-aac"
                value="&{template:simple} {{roll=@{character_name} attacks with @{weaponName}}} {{attack=[[1d20+@{weaponAttributeBonus}+@{weaponAttackBonus}+@{bab}+@{optionalModQuery}]]}} {{damage=[[@{weaponDamageDie}+@{weaponDamageBonus}+@{weaponAttributeBonusDamage}]]}} {{description=@{weaponDescription}}}">Roll</button>
            </div>
            <input type="text" name="attr_weaponName" placeholder="Weapon Name" />
            <select name="attr_attackType">
              <option value="melee" data-i18n="melee">Melee</option>
              <option value="ranged" data-i18n="ranged">Ranged</option>
            </select>
            <input type="number" name="attr_weaponAttackBonus" value="0" />
            <input type="text" name="attr_weaponDamageDie" value="1d6" class="input-as-number" class="input-as-number" />
            <input type="number" name="attr_weaponDamageBonus" value="0" />
          </div>
          <input type="text" name="attr_weaponDescription" class="weapon-description" value="" placeholder="Description"
            data-i18n-placeholder="description" />
        </fieldset>
      </div>

      <div class="divider"></div>
      <h1 data-i18n="armor">Armor</h1>
      <div class="armor-grid">
        <span data-i18n="name">Name</span>
        <span data-i18n="armor-class-abbr">AC</span>
        <span data-i18n="worn-question">Worn?</span>
      </div>
      <div class="sheet-armor sheet-repeat">
        <fieldset class="repeating_armor">
          <input type="hidden" name="attr_armorBenefit" />
          <div class="armor-grid">
            <input type="text" name="attr_armorName" placeholder="Armor Name"
              data-i18n-placeholder="armor-name-placeholder" />
            <input type="number" name="attr_armorValue" value="0" />
            <div class="checkbox">
              <input type="checkbox" name="attr_armorWorn" checked />
            </div>
          </div>
          <input type="text" name="attr_armorDescription" class="armor-description" value="" placeholder="Description"
            data-i18n-placeholder="description" />
        </fieldset>
      </div>

      <div class="divider"></div>
      <h1 data-i18n="class-and-kindred-traits">Class & Kindred Traits</h1>
      <div class="kindred-traits">
        <label data-i18n="kindred-traits">Kindred Traits:</label>
        <textarea name="attr_kindredTraits"></textarea>
      </div>
      <div class="class-traits">
        <label data-i18n="class-traits">Class Traits:</label>
        <textarea name="attr_classTraits"></textarea>
        <div class="sheet-turn-undead" >
          <h1 data-i18n="turn-undead">Turn Undead</h1>
          <div>
            <span data-i18n="number-bonus">Number Bonus:</span>
            <input type="number" name="attr_turnNumberBonus" value="0"/>
            <span data-i18n="effect-bonus">Effect Bonus:</span>
            <input type="number" name="attr_turnEffectBonus" value="0"/>
            <button
              type="roll" 
              name="turnUndeadRoll"
              data-i18n="roll"
              value="&{template:turn-undead} {{roll=@{character_name} rolls Turn Undead}} {{effect=[[2d6+@{turnEffectBonus}]]}} {{number=[[2d4+@{turnNumberBonus}]]}} {{level=[[@{level}]]}}"
            >
              Roll
            </button>
          </div>
        </div>
      </div>

      <div class="divider"></div>
      <div>
        <div class="sheet-abilities sheet-repeat">
          <h1 data-i18n="skills">Skills</h1>
          <div class="abilities-grid-title">
            <span></span>
            <span data-i18n="name">Name</span>
            <span data-i18n="target">Target</span>
            <span data-i18n="description">Description</span>
            <span data-i18n="gm-only">To GM Only</span>
          </div>
          <div class="abilities-grid">
            <button 
              type="roll" 
              name="listenRoll"
              data-i18n="roll"
              value="/w gm &{template:greater} {{roll=@{character_name} rolls Listen}} {{result=[[ [[1d6+@{optionalModQuery}]]<=@{listenThreshold} ]]}} {{check=[[@{listenThreshold}+@{optionalModQuery}]]}} {{description=@{listenDescription}}}">
              Roll
            </button>
            <input type="text" name="attr_listenName" readonly value="Listen"/>
            <input type="number" name="attr_listenThreshold" value="6" />
            <input type="text" name="attr_listenDescription" readonly value="DPB p. 151" />
            <input type="checkbox" name="attr_toGmOnly" value="/w gm " checked disabled />
          </div>
          <div class="abilities-grid">
            <button 
              type="roll" 
              name="searchRoll"
              data-i18n="roll"
              value="/w gm &{template:greater} {{roll=@{character_name} rolls Search}} {{result=[[ [[1d6+@{optionalModQuery}]]<=@{searchThreshold} ]]}} {{check=[[@{searchThreshold}+@{optionalModQuery}]]}} {{description=@{searchDescription}}}">
              Roll
            </button>
            <input type="text" name="attr_searchName" value="Search" readonly/>
            <input type="number" name="attr_searchThreshold" value="6" />
            <input type="text" name="attr_searchDescription" readonly value="DPB p. 152" />
            <input type="checkbox" name="attr_toGmOnly" value="/w gm " checked disabled/>
          </div>
          <div class="abilities-grid">
            <button 
              type="roll" 
              name="survivalRoll"
              data-i18n="roll"
              value="/w gm &{template:greater} {{roll=@{character_name} rolls @{survivalName}}} {{result=[[ [[1d6+@{optionalModQuery}]]<=@{survivalThreshold} ]]}} {{check=[[@{survivalThreshold}+@{optionalModQuery}]]}} {{description=@{survivalDescription}}}">
              Roll
            </button>
            <input type="text" name="attr_survivalName" value="Survival" readonly/>
            <input type="number" name="attr_survivalThreshold" value="6" />
            <input type="text" name="attr_survivalDescription" readonly value="DPB p. 152" />
            <input type="checkbox" name="attr_toGmOnly" value="/w gm " checked disabled/>
          </div>
          <div class="abilities-grid">
            <button 
              type="roll" 
              name="lightFireRoll"
              data-i18n="roll"
              value="@{fireToGmOnly}&{template:greater} {{roll=@{character_name} rolls @{lightFireName}}} {{result=[[ [[1d6+@{optionalModQuery}]]<=@{lightFireThreshold} ]]}} {{check=[[@{lightFireThreshold}+@{optionalModQuery}]]}} {{description=@{lightFireDescription}}}">
              Roll
            </button>
            <input type="text" name="attr_lightFireName" value="Light Fire under Stress" readonly/>
            <input type="number" name="attr_lightFireThreshold" value="5" />
            <input type="text" name="attr_lightFireDescription" value="per round" />
            <input type="checkbox" name="attr_fireToGmOnly" value="/w gm "/>
          </div>
          <fieldset class="repeating_abilities">
            <div class="abilities-grid">
              <button 
                type="roll" 
                name="abilityRoll"
                data-i18n="roll"
                value="@{toGmOnly}&{template:greater} {{roll=@{character_name} rolls @{abilityName}}} {{result=[[ [[1d6+@{optionalModQuery}]]<=@{abilityThreshold} ]]}} {{check=[[@{abilityThreshold}+@{optionalModQuery}]]}} {{description=@{abilityDescription}}}">
                Roll
              </button>
              <input type="text" name="attr_abilityName" placeholder="Name" data-i18n-placeholder="name-non-head" />
              <input type="number" name="attr_abilityThreshold" value="6" />
              <input type="text" name="attr_abilityDescription" data-i18n-placeholder="description"
              placeholder="Description" />
              <input type="checkbox" name="attr_toGmOnly" value="/w gm " />
            </div>
          </fieldset>
        </div>

        <div class="divider"></div>
      </div>

      <h1 data-i18n="items-equipment">Items & Equipment</h1>
      <div class="inventory">
        <fieldset class="encumbrance">
          <legend data-i18n="encumbrance-method">Encumbrance Method:</legend>
          <div>
            <input type="radio" id="weight" name="attr_encumbranceType" value="weight" />
            <label for="weight" data-i18n="weight">Weight</label>
          </div>
          <div>
            <input type="radio" id="slots" name="attr_encumbranceType" value="slots" checked />
            <label for="slots" data-i18n="slots">Slots</label>
          </div>
        </fieldset>
        <div class="items">
          <div class="left">
            <span data-i18n="tiny-items">Tiny Items:</span>
            <textarea name="attr_tinyItems"></textarea>
            <span data-i18n="equipped-items">Equipped Items:</span>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE1"/>
              <input type="number" min="0" name="attr_ItemWeightE1" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE2"/>
              <input type="number" min="0" name="attr_ItemWeightE2" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE3"/>
              <input type="number" min="0" name="attr_ItemWeightE3" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE4"/>
              <input type="number" min="0" name="attr_ItemWeightE4" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE5"/>
              <input type="number" min="0" name="attr_ItemWeightE5" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE6"/>
              <input type="number" min="0" name="attr_ItemWeightE6" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE7"/>
              <input type="number" min="0" name="attr_ItemWeightE7" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE8"/>
              <input type="number" min="0" name="attr_ItemWeightE8" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE9"/>
              <input type="number" min="0" name="attr_ItemWeightE9" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameE10"/>
              <input type="number" min="0" name="attr_ItemWeightE10" value="0" />
            </div>
          </div>
          <div class="right">
            <span class="stowed" data-i18n="stowed-items">Stowed Items:</span>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS1"/>
              <input type="number" min="0" name="attr_ItemWeightS1" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS2"/>
              <input type="number" min="0" name="attr_ItemWeightS2" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS3"/>
              <input type="number" min="0" name="attr_ItemWeightS3" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS4"/>
              <input type="number" min="0" name="attr_ItemWeightS4" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS5"/>
              <input type="number" min="0" name="attr_ItemWeightS5" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS6"/>
              <input type="number" min="0" name="attr_ItemWeightS6" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS7"/>
              <input type="number" min="0" name="attr_ItemWeightS7" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS8"/>
              <input type="number" min="0" name="attr_ItemWeightS8" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS9"/>
              <input type="number" min="0" name="attr_ItemWeightS9" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS10"/>
              <input type="number" min="0" name="attr_ItemWeightS10" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS11"/>
              <input type="number" min="0" name="attr_ItemWeightS11" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS12"/>
              <input type="number" min="0" name="attr_ItemWeightS12" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS13"/>
              <input type="number" min="0" name="attr_ItemWeightS13" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS14"/>
              <input type="number" min="0" name="attr_ItemWeightS14" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS15"/>
              <input type="number" min="0" name="attr_ItemWeightS15" value="0" />
            </div>
            <div class="item-row">
              <input type="text" name="attr_ItemNameS16"/>
              <input type="number" min="0" name="attr_ItemWeightS16" value="0" />
            </div>
            <div class="total-weight">
              <span data-i18n="total-weight">Total Weight:</span>
              <input type="number" min="0" name="attr_totalWeight" value="0" readonly/>
            </div>
          </div>
        </div>
        <input type="hidden" name="attr_coinsOverloaded" value="0"/>
        <div class="notes-and-coins">
          <div class="item-notes">
            <span data-i18n="item-notes">Item Notes:</span>
            <textarea name="attr_itemNotes"></textarea>
          </div>
          <div class="sheet-coins">
            <span data-i18n="coins">Coins</span>
            <input type="number" min="0" name="attr_PP" value="0" />
            <span data-i18n="pellucidium-piece">Pellucidium</span>
            <input type="number" min="0" name="attr_GP" value="0" />
            <span data-i18n="gold-piece">Gold</span>
            <input type="number" min="0" name="attr_SP" value="0" />
            <span data-i18n="silver-piece">Silver</span>
            <input type="number" min="0" name="attr_CP" value="0" />
            <span data-i18n="copper-piece">Copper</span>
          </div>
        </div>
        <span class="sheet-pouch-full">
          <span data-i18n="coin-pouch-full-1">Coin pouch full: Max</span>
          <input name="attr_coinPouchMaxLoad" readonly /> 
          <span data-i18n="coin-pouch-full-2">Coins.</span>
        </span>
      </div>
    </div>

    <div class="sheet-spells sheet-repeat">
      <div class="sheet-custom-spells">
        <h1 data-i18n="custom-spell-selector">Custom Kindred/Class Spell Selector</h1>
        <div class="custom-spell-selector">
          <label class="checkbox">Glamours:<input type="checkbox" name="attr_customGlamours" /></label>
          <label class="checkbox">Runes:<input type="checkbox" name="attr_customRunes" /></label>
          <label class="checkbox">Knacks:<input type="checkbox" name="attr_customKnacks" /></label>
          <label class="checkbox">Spells:<input type="checkbox" name="attr_customSpells" /></label>
        </div>
        <div class="divider"></div>
      </div>
      <div class="sheet-glamours-sub">
        <h1 data-i18n="glamours">Glamours</h1>
        <div class="glamour-grid">
          <span></span>
          <span data-i18n="name-non-head">Name</span>
          <span data-i18n="duration" >Duration</span>
          <span data-i18n="range">Range</span>
          <span data-i18n="effect-roll">Effect Roll</span>
        </div>
        <fieldset class="repeating_glamours">
          <div class="glamour-grid">
            <div>
              <button type="roll" name="glamourCast" class="roll"
                value="&{template:simple} {{roll=@{character_name} casts @{glamourName}}} {{duration=@{glamourDuration}}} {{range=@{glamourRange}}} {{description=@{glamourDescription}}} {{effect=[[@{glamourEffect}]]}}">Roll</button>
            </div>
            <input type="text" name="attr_glamourName" placeholder="Glamour Name" data-i18n-placeholder="glamour-name"/>
            <input type="text" name="attr_glamourDuration" placeholder="Duration" data-i18n-placeholder="duration" />
            <input type="text" name="attr_glamourRange" placeholder="Range" data-i18n-placeholder="range"/>
            <input type="text" class="half-input" name="attr_glamourEffect" value="0"/>
          </div>
          <textarea type="text" name="attr_glamourDescription" placeholder="Description" data-i18n-placeholder="description"></textarea>
        </fieldset>
        <div class="divider"></div>
      </div>
      <div class="sheet-runes-sub">
        <h1 data-i18n="runes">Runes</h1>
        <div class="rune-grid">
          <span></span>
          <span data-i18n="name-non-head">Name</span>
          <span data-i18n="usage-frequency">Usage Frequency</span>
          <span data-i18n="duration">Duration</span>
          <span data-i18n="range">Range</span>
          <span data-i18n="effect-roll">Effect Roll</span>
        </div>
        <fieldset class="repeating_runes">
          <div class="rune-grid">
            <div>
              <button type="roll" name="runeCast" class="roll"
                value="&{template:simple} {{roll=@{character_name} casts @{runeName}}} {{duration=@{runeDuration}}} {{range=@{runeRange}}} {{description=@{runeDescription}}} {{effect=[[@{runeEffect}]]}}">Roll</button>
            </div>
            <input type="text" name="attr_runeName" placeholder="Rune Name" data-i18n-placeholder="rune-name"/>
            <input type="text" name="attr_runeFrequency" placeholder="Once per Day" data-i18n-placeholder="once-per-day"/>
            <input type="text" name="attr_runeDuration" placeholder="Duration" data-i18n-placeholder="duration" />
            <input type="text" name="attr_runeRange" placeholder="Range" data-i18n-placeholder="range"/>
            <input type="text" class="half-input" name="attr_runeEffect" value="0"/>
          </div>
          <textarea type="text" name="attr_runeDescription" placeholder="Description" data-i18n-placeholder="description"></textarea>
        </fieldset>
        <div class="divider"></div>
      </div>
      <div class="sheet-knacks-sub">
        <h1 data-i18n="knacks">Knacks</h1>
        <div class="knack-grid">
          <span></span>
          <span data-i18n="name-non-head">Name</span>
          <span data-i18n="duration">Duration</span>
          <span data-i18n="range">Range</span>
          <span data-i18n="effect-roll">Effect Roll</span>
        </div>
        <fieldset class="repeating_knacks">
          <div class="knack-grid">
            <div>
              <button type="roll" name="knackCast" class="roll"
                value="&{template:simple} {{roll=@{character_name} casts @{knackName}}} {{duration=@{knackDuration}}} {{range=@{knackRange}}} {{description=@{knackDescription}}} {{effect=[[@{knackEffect}]]}}">Roll</button>
            </div>
            <input type="text" name="attr_knackName" placeholder="Knack Name" data-i18n-placeholder="knack-name"/>
            <input type="text" name="attr_knackDuration" placeholder="Duration" data-i18n-placeholder="duration" />
            <input type="text" name="attr_knackRange" placeholder="Range" data-i18n-placeholder="range" />
            <input type="text" class="half-input" name="attr_knackEffect" value="0"/>
          </div>
          <textarea type="text" name="attr_knackDescription" placeholder="Description" data-i18n-placeholder="description"></textarea>
        </fieldset>
        <div class="divider"></div>
      </div>
      <div class="sheet-spells-sub">
        <h1>Spells</h1>
        <div class="flex grid-spacing spells-per-level">
          <span>1:</span>
          <input type="number" min="0" name="attr_spellsLevel1Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-1-total">/</label>
          <input type="number" min="0" id="spells-level-1-total" name="attr_spellsLevel1Total" title="Spells Total"
          data-i18n-title="spells-total" value="0" />

          <span>2:</span>
          <input type="number" min="0" name="attr_spellsLevel2Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-2-total">/</label>
          <input type="number" min="0" id="spells-level-2-total" name="attr_spellsLevel2Total" title="Spells Total"
            data-i18n-title="spells-total" value="0" />

          <span>3:</span>
          <input type="number" min="0" name="attr_spellsLevel3Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-3-total">/</label>
          <input type="number" min="0" id="spells-level-3-total" name="attr_spellsLevel3Total" title="Spells Total"
            data-i18n-title="spells-total" value="0" />

          <span>4:</span>
          <input type="number" min="0" name="attr_spellsLevel4Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-4-total">/</label>
          <input type="number" min="0" id="spells-level-4-total" name="attr_spellsLevel4Total" title="Spells Total"
            data-i18n-title="spells-total" value="0" />

          <span>5:</span>
          <input type="number" min="0" name="attr_spellsLevel5Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-5-total">/</label>
          <input type="number" min="0" id="spells-level-5-total" name="attr_spellsLevel5Total" title="Spells Total"
            data-i18n-title="spells-total" value="0" />
          
            <span>6:</span>
          <input type="number" min="0" name="attr_spellsLevel6Available" title="Spells Available"
            data-i18n-title="spells-available" value="0" />
          <label for="spells-level-6-total">/</label>
          <input type="number" min="0" id="spells-level-6-total" name="attr_spellsLevel6Total" title="Spells Total"
            data-i18n-title="spells-total" value="0" />
        </div>
        <div class="spells-grid">
          <span></span>
          <span class="memorized" data-i18n="memorized">Memorized</span>
          <span data-i18n="name-non-head">Name</span>
          <span data-i18n="level-abbr">LVL</span>
          <span data-i18n="duration">Duration</span>
          <span data-i18n="range">Range</span>
          <span data-i18n="effect-roll">Effect Roll</span>
        </div>
        <fieldset class="repeating_spells">
          <div class="spells-grid">
            <button type="roll" name="spellCast" class="roll"
              value="&{template:simple} {{roll=@{character_name} casts @{spellName}}} {{duration=@{spellDuration}}} {{range=@{spellRange}}} {{description=@{spellDescription}}} {{effect=[[@{spellEffect}]]}}">Roll</button>
            <input type="number" min="0" name="attr_spellMemorized" checked data-i18n-title="memorized" title="Memorized"
              value="0" />
            <input type="text" name="attr_spellName" placeholder="Spell Name"
              data-i18n-placeholder="spell-name-placeholder" />
            <input type="number" min="1" name="attr_spellLevel" value="1" />
            <input type="text" name="attr_spellDuration" placeholder="Duration" data-i18n-placeholder="duration"/>
            <input type="text" name="attr_spellRange" placeholder="Range" data-i18n-placeholder="range"/>
            <input type="text" class="half-input" name="attr_spellEffect" value="0" />
          </div>
          <textarea type="text" name="attr_spellDescription" placeholder="Description" data-i18n-placeholder="description" ></textarea>
        </fieldset>
      </div>
      <div class="sheet-cannot-cast-message">
        <span data-i18n="no-spells">You cannot cast spells with your current kindred or class selection.</span>
      </div>

    </div>

    <div class="sheet-retainers">
      <div>
        <h1 data-i18n="retainer-modifiers">Retainer Modifiers</h1>
        <div class="flex roll">
          <label class="inline-flex inline-flex-wide-label">
            <button type="roll" name="attr_rollNPCReaction"
              value="&{template:simple} {{roll=@{character_name} rolls for NPC Reaction}} {{result=[[2d6+@{chaMod}]]}}"
              data-i18n="npc-reaction">NPC
              Reaction</button>
            <input type="number" readOnly name="attr_chaMod" value="0" />
          </label>
          <label class="inline-flex inline-flex-wide-label">
            <span data-i18n="max-retainers">Max Retainers</span>
            <input type="number" readOnly name="attr_retainersMax" value="0" />
          </label>
          <label class="inline-flex inline-flex-wide-label">
            <span data-i18n="loyalty">Loyalty</span>
            <input type="number" readOnly name="attr_retainersLoyalty" value="0" />
          </label>
          <span data-i18n="retainer-notes">Retainer Notes:</span>
          <textarea name="attr_retainerNotes"></textarea>
        </div>
      </div>
    </div>

    <!-- Monster Sheet -->
    <div class="sheet-monster">
      <div class="monster-row">
        <span data-i18n="name">Name:</span>
        <input type="text" name="attr_character_name" />
        <span class="double" data-i18n="description">Description</span>
        <input type="text" name="attr_monsterDescription" />
      </div>
      <div class="monster-row">
        <span data-i18n="alignment">Alignment</span>
        <input type="text" name="attr_alignment" />
        <span>Level:</span>
        <input type="number" min="0" name="attr_monsterHitDice" value="1" />
        <span data-i18n="armor-class-abbr" title="Armor Class" data-i18n-title="armor-class">AC</span>
        <input type="number" name="attr_monsterAc" value="0" />
        <span data-i18n="base-attack-bonus-abbr" title="Base Attack Bonus"
          data-i18n-title="base-attack-bonus">BAB</span>
        <input type="number" name="attr_bab" value="0" />
      </div>
      <div class="monster-row">
        <button type="roll" name="monsterHpRoll" data-i18n="hit-dice-number-abbr" title="Hit Dice"
          data-i18n-title="hit-dice-number"
          value="/w gm &{template:simple} {{roll=HP for @{character_name}}} {{result=[[@{hitdice}]]}}">
          # HD:
        </button>
        <input type="text" min="0" name="attr_hitdice" value="1d8" />
        <button type="action" name="act_setAverageHP" data-i18n="hit-points-average">
          Average HP
        </button>
        <input readonly type="number" name="attr_averageHP" value="" />
        <span data-i18n="hit-points-abbr">HP:</span>
        <input type="number" name="attr_HP" value="0" />
        <span data-i18n="hit-points-max-abbr">Max:</span>
        <input type="number" min="0" name="attr_HP_max" value="0" />
      </div>
      <div class="divider"></div>
      <input type="hidden" name="attr_savesAs" value="character" />
      <div class="sheet-saves">
        <h1 data-i18n="saving-throws">Saving Throws</h1>
        <div class="monster-row">
          <span class="double" data-i18n="saves-as">Saves As</span>
          <select name="attr_class">
            <option>--</option>
            <option value="Monster" data-i18n="monster">Monster</option>
            <option value="Everyday Mortal" data-i18n="everyday-mortal">Everyday Mortal</option>
            <option value="Bard" data-i18n="bard">Bard</option>
            <option value="Cleric" data-i18n="cleric">Cleric</option>
            <option value="Enchanter" data-i18n="enchanter">Enchanter</option>
            <option value="Fighter" data-i18n="fighter">Fighter</option>
            <option value="Friar" data-i18n="friar">Friar</option>
            <option value="Hunter" data-i18n="hunter">Hunter</option>
            <option value="Knight" data-i18n="knight">Knight</option>
            <option value="Magician" data-i18n="magician">Magician</option>
            <option value="Thief" data-i18n="thief">Thief</option>
            <option value="Custom" data-i18n="custom">Custom</option>
            <optgroup label="Kindred-class" data-i18n="kindred-classes">
              <option value="Breggle" data-i18n="breggle">Breggle</option>
              <option value="Cobbin" data-i18n="cobbin">Cobbin</option>
              <option value="Elf" data-i18n="elf">Elf</option>
              <option value="Grimalkin" data-i18n="grimalkin">Grimalkin</option>
              <option value="Mossling" data-i18n="mossling">Mossling</option>
              <option value="Woodgrue" data-i18n="woodgrue">Woodgrue</option>
              <option value="Custom Kindred-class" data-i18n="custom-kindred-class">Custom Kindred-class</option>
            </optgroup>
          </select>
          <div class="sheet-saves">
            <div class="saving roll flex">
              <label class="save-group">
                <button type="roll" name="attr_rollSaveD"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{doom}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveD} ]]}} {{check=[[@{saveD}]]}}"
                  data-i18n="doom">
                  Doom
                </button>
                <input type="number" name="attr_saveD" value="0" />
              </label>
              <label class="save-group bottom">
                <input type="number" name="attr_saveW" value="0" />
                <button type="roll" name="attr_rollSaveW"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{ray}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveW} ]]}} {{check=[[@{saveW}]]}}"
                  data-i18n="ray">
                  Ray
                </button>
              </label>
              <label class="save-group">
                <button type="roll" name="attr_rollSaveP"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{hold}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveP} ]]}} {{check=[[@{saveP}]]}}"
                  data-i18n="hold">
                  Hold
                </button>
                <input type="number" name="attr_saveP" value="0" />
              </label>
              <label class="save-group bottom">
                <input type="number" name="attr_saveB" value="0" />
                <button type="roll" name="attr_rollSaveB"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{blast}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveB} ]]}} {{check=[[@{saveB}]]}}"
                  data-i18n="blast">
                  Blast
                </button>
              </label>
              <label class="save-group">
                <button type="roll" name="attr_rollSaveS"
                  value="&{template:greater} {{roll=@{character_name} rolls save against ^{spell}}} {{result=[[ [[1d20]]+@{modQuery}>@{saveS} ]]}} {{check=[[@{saveS}]]}}"
                  data-i18n="spell">
                  Spell
                </button>
                <input type="number" name="attr_saveS" value="0" />
              </label>
            </div>
          </div>
        </div>
      </div>  

      <div class="divider"></div>
      <div class="monster-row">
        <div class="sheet-weapons sheet-repeat">
          <h1 data-i18n="attacks">Attacks</h1>
          <div class="weapons-grid-monster">
            <span></span>
            <span data-i18n="name">Name</span>
            <span data-i18n="number-of-att"># of Attacks</span>
            <span data-i18n="type">Type</span>
            <span data-i18n="attack-modifier">+Attack</span>
            <span data-i18n="damage-die">Damage Die</span>
            <span data-i18n="damage-modifier">+Damage</span>
          </div>
          <fieldset class="repeating_weapons">
            <input type="hidden" name="attr_weaponAttributeBonus" value="@{strMod}" />
            <input type="hidden" name="attr_weaponAttributeBonusDamage" value="@{strMod}" />
            <div class="weapons-grid-monster">
              <div>
                <button type="roll" name="aacAttackRoll" class="attack-roll attack-roll-aac"
                  value="&{template:simple} {{roll=@{character_name} attacks with @{weaponName}}} {{attack=[[1d20+@{weaponAttributeBonus}+@{weaponAttackBonus}+@{bab}+@{optionalModQuery}]]}} {{damage=[[@{weaponDamageDie}+@{weaponDamageBonus}+@{weaponAttributeBonusDamage}]]}} {{description=@{weaponDescription}}}">Roll</button>
              </div>
              <input type="text" name="attr_weaponName" placeholder="Weapon Name" />
              <input type="number" name="attr_weaponAttacks" value="1" />
              <select name="attr_attackType">
                <option value="melee" data-i18n="melee">Melee</option>
                <option value="ranged" data-i18n="ranged">Ranged</option>
              </select>
              <input type="number" name="attr_weaponAttackBonus" value="0" />
              <input type="text" name="attr_weaponDamageDie" value="1d6" class="input-as-number" class="input-as-number" />
              <input type="number" name="attr_weaponDamageBonus" value="0" />
            </div>
            <input type="text" name="attr_weaponDescription" class="weapon-description" value="" placeholder="Description"
              data-i18n-placeholder="description" />
          </fieldset>
        </div>
      </div>
      
      <div class="divider"></div>
      <div class="monster-row">
        <span data-i18n="movement-sp">
          Speed:
        </span>
        <input type="number" name="attr_movementEncounter" value="0" />
        <span data-i18n="movement-fly">
          Fly:
        </span>
        <input type="number" name="attr_movementFly" value="0" />
        <span data-i18n="movement-swim">
          Swim:
        </span>
        <input type="number" name="attr_movementSwim" value="0" />
        <button type="roll" name="monsterMoraleRoll"
          value="/w gm &{template:simple} {{roll=Morale of @{character_name}}} {{morale=[[{2d6+0, 0d0+13}<@{monsterMorale}]]}}"
          title="Morale" data-i18n-title="morale" data-i18n="morale-abbr">
          ML
        </button>
        <input type="number" min="2" max="12" name="attr_monsterMorale" value="7" />
        <span data-i18n="special-abilities">Special Abilities:</span>
        <input type="number" name="attr_monsterSpecialAbilities" value="0" min="0" />
        <span data-i18n="experience-abbr">XP:</span>
        <input type="number" name="attr_monsterXPValue" value="0" min="0"/>
      </div>

      <div class="divider"></div>

      <div class="moster-row">
        <button 
          type="roll" 
          name="numberAppearingRoll"
          data-i18n="encounters"
          value="/w gm &{template:simple} {{roll=Number of @{character_name} appearing}} {{Dungeon-Wandering=[[@{numberAppearing}]]}} {{Wilderness-Lair=[[@{numberAppearing}*5]]}} {{In-Lair=[[1d100]]}} {{Chance-In-Lair=@{chanceInLair}}}">
          Encounters
        </button>
        <input type="text" name="attr_numberAppearing" value="0" placeholder="1d4" />
        <span data-i18n="chance-in-lair">% in lair</span>
        <input type="number" name="attr_chanceInLair" value="0" placeholder="2d4+2" />
        <button type="roll" name="monsterReactionRoll"
          value="/w gm &{template:simple} {{roll=Reaction of @{character_name}}} {{result=[[2d6+@{reactionQuery}]]}} {{reaction=0}}"
          data-i18n="reaction" class="double">
          Reaction
        </button>
      </div>

      <div class="moster-row">
        <span data-i18n="behavior">Behavior:</span>
        <input type="text" name="monsterBehavior" value="" />
        <span data-i18n="speech">Speech:</span>
        <input type="text" name="monsterSpeech" value="" />
      </div>
      <div class="moster-row">
        <span data-i18n="possessions">Possessions:</span>
        <input type="text" name="monsterPossessions" value="" />
        <span data-i18n="hoard">Hoard:</span>
        <input type="text" name="monsterHoard" value="" />
      </div>

      <div class="divider"></div>
      <div class="sheet-notes-section">
        <h1 data-i18n="notes">Notes</h1>
        <textarea name="attr_monsterNotes"></textarea>
      </div>
    </div>

    <!-- Notes Sheet -->
    <div class="sheet-notes">
      <div class="sheet-notes-section">
        <h1 data-i18n="notes">Notes</h1>
        <textarea name="attr_generalNotes"></textarea>
      </div>
    </div>

    <!-- Settings Sheet -->
    <div class="sheet-settings">
      <h1 data-i18n="settings">Settings</h1>
      <label class="setting">
        <span data-i18n="situational-bonus-enabled">Situational Bonus Enabled?</span>
        <select name="attr_situationalBonusEnabled">
          <option value="enabled" selected data-i18n="enabled">Enabled</option>
          <option value="disabled" data-i18n="disabled">Disabled</option>
        </select>
        <span data-i18n="coin-pouch-settings">Coin Pouch Max Load: Set to 0 to ignore.</span>
        <input type="number" name="attr_coinPouchMaxLoad" value="0" min="0"/>
      </label>

      <h1 data-i18n="about">About</h1>
      <p data-i18n="about-description">
        If you have any suggestions or problems with the character sheet, please
        reach out.
      </p>
      <ul>
        <li>
          <span data-i18n="submit-issue">Submit a feature request or bug</span>:
          https://github.com/wesbaker/roll20-character-sheets/issues/new
        </li>
        <li>
          <span>Contact us in the Necrotic Gnome discord with comments or questions and ping arun_ondo</span>:
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Attack roll translation -->
<span style="display: none;" data-i18n="type">Type</span>
<span style="display: none;" data-i18n="modifier">Situational Bonus</span>
<span style="display: none;" data-i18n="modifier-mod">Modif</span>
<span style="display: none;" data-i18n="attack">Attack</span>
<span style="display: none;" data-i18n="attack">Damage</span>

<!-- Other translation -->
<span style="display: none;" data-i18n="strength">Strength</span>
<span style="display: none;" data-i18n="intelligence">Intelligence</span>
<span style="display: none;" data-i18n="wisdom">Wisdom</span>
<span style="display: none;" data-i18n="dexterity">Dexterity</span>
<span style="display: none;" data-i18n="constitution">Constitution</span>
<span style="display: none;" data-i18n="charisma">Charisma</span>
<span style="display: none;" data-i18n="morale">Morale</span>

<rolltemplate class="sheet-rolltemplate-simple">
  <div>
    <h3>{{roll}}</h3>
    {{#result}}
    <span class="sheet-template-result-only">{{result}}</span>
    {{/result}}
    {{#allprops() roll result description morale reaction attackMatrix9 attackMatrix8 attackMatrix7 attackMatrix6 attackMatrix5 attackMatrix4 attackMatrix3 attackMatrix2 attackMatrix1 attackMatrix0}}
    <div class="sheet-template-row">
      <span class="sheet-template-term">{{key}}:</span>
      <span class="sheet-template-result">{{value}}</span>
    </div>
    {{/allprops() roll result description morale reaction attackMatrix9 attackMatrix8 attackMatrix7 attackMatrix6 attackMatrix5 attackMatrix4 attackMatrix3 attackMatrix2 attackMatrix1 attackMatrix0}}
    {{#description}}
    <div class="sheet-template-description">{{description}}</div>
    {{/description}}

    <!-- Attack Specific -->
    {{#attack}}
    {{#rollWasCrit() attack}}
    <span class="sheet-template-result-only fullcrit" data-i18n="natural-20">Natural 20!</span>
    {{/rollWasCrit() attack}}
    {{#rollWasFumble() attack}}
    <span class="sheet-template-result-only fullfail" data-i18n="natural-1">Natural 1!</span>
    {{/rollWasFumble() attack}}
    {{/attack}}


    <!-- Morale Specific -->
    {{#rollGreater() morale 0}}
    <span class="sheet-template-result-only fullcrit" data-i18n="morale-continue-fighting">Continue Fighting!</span>
    {{/rollGreater() morale 0}}
    {{#rollLess() morale 1}}
    <span class="sheet-template-result-only fullfail" data-i18n="morale-surrender-or-flee">Surrender or Flee!</span>
    {{/rollLess() morale 1}}

    <!-- Reaction Specific -->
    {{#reaction}}
    <div class="sheet-template-description">
      {{#rollLess() result 3}}
      <p data-i18n="reaction-hostile">Hostile, attacks</p>
      {{/rollLess() result 3}}
      {{#rollBetween() result 3 5}}
      <p data-i18n="reaction-unfriendly">Unfriendly, may attack</p>
      {{/rollBetween() result 3 5}}
      {{#rollBetween() result 6 8}}
      <p data-i18n="reaction-neutral">Neutral, uncertain</p>
      {{/rollBetween() result 6 8}}
      {{#rollBetween() result 9 11}}
      <p data-i18n="reaction-indifferent">Indifferent, uninterested</p>
      {{/rollBetween() result 9 11}}
      {{#rollGreater() result 11}}
      <p data-i18n="reaction-friendly">Friendly, helpful</p>
      {{/rollGreater() result 11}}
    </div>
    {{/reaction}}
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-greater">
  <div>
    <h3>{{roll}}</h3>
    <span style="background: white; display: none;">{{check}}</span>
    <span style="background: white;">{{result}}</span>
    {{#rollLess() result check}}
    <span class="rollresult rollfail" data-i18n="fail">Fail</span>
    {{/rollLess() result check}}
    {{#rollGreater() result check}}
    <span class="rollresult rollsuccess" data-i18n="success">Success</span>
    {{/rollGreater() result check}}
    {{#rollTotal() result check}}
    <span class="rollresult rollsuccess" data-i18n="success">Success</span>
    {{/rollTotal() result check}}
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-turn-undead">
  <div>
    <h3>{{roll}}</h3>
    <span>Number Affected: {{number}}</span>
    <span>Effect Roll: {{effect}}</span>   
  </div>
</rolltemplate>

<script type="text/worker">
  /* ===== PARAMETERS ==========
  destination = the name of the attribute that stores the total quantity
  section = name of repeating fieldset, without the repeating_
  fields = the name of the attribute field to be summed
      can be a single attribute: 'weight'
      or an array of attributes: ['weight','number','equipped']
  multiplier (optional) = a multiplier to the entire fieldset total. For instance, if summing coins of weight 0.02, might want to multiply the final total by 0.02.
  */ 

  on("sheet:opened", function () {
    // Populate new attributes from existing attributes
    const changedAttributes = [
      "thresholdModifierEnabled",
      "situationalBonusEnabled",
    ];
    getAttrs(changedAttributes, function (values) {
      if (!values.situationalBonusEnabled) {
        setAttrs({
          situationalBonusEnabled: values.thresholdModifierEnabled,
        });
      }
    });

    // Set attackType based on heuristics of the bonus damage (0 for ranged, otherwise STR bonus)
    updateWeaponBonuses();

    // Set armorValue per armorBenefit if >= 2
    getSectionIDs("repeating_armor", function (idArray) {
      idArray.forEach(function (id) {
        const attributes = ["armorBenefit", "armorValue"]
          .map((attr) => `repeating_armor_${id}_${attr}`);
        getAttrs(attributes, function (values) {
          const armorValue = values[`repeating_armor_${id}_armorValue`];
          const armorBenefit = values[`repeating_armor_${id}_armorBenefit`];
          if (armorValue && armorBenefit >= 2) {
            setAttrs({
              [`repeating_armor_${id}_armorValue`]:
                10 + armorBenefit,
              [`repeating_armor_${id}_armorBenefit`]: "",
            });
          }
        });
      });
    });

    // Set roll buttons for spells depending on effect having a value
    getSectionIDs("repeating_spells", function (idArray) {
      idArray.forEach(function (id) {
        getAttrs([`repeating_spells_${id}_spellEffect`], function (values) {
          if (values[`repeating_spells_${id}_spellEffect`] !== "") {
            setAttrs({ [`repeating_spells_${id}_spellRollType`]: "roll" });
          } else {
            setAttrs({ [`repeating_spells_${id}_spellRollType`]: "describe" });
          }
        });
      });
    });
  });

  on("sheet:opened change:situationalBonusEnabled", function (eventInfo) {
    // Check for threshold modifier enabled
    getAttrs(["situationalBonusEnabled"], function (values) {
      if (values.situationalBonusEnabled.toLowerCase() === "disabled") {
        setAttrs({ optionalModQuery: "0" });
      } else {
        setAttrs({
          optionalModQuery:
            "?{" +
            getTranslationByKey("modifier") +
            "|0}[" +
            getTranslationByKey("modifier-mod") +
            "]",
        });
      }
    });

    setAttrs({
      modQuery:
        "?{" +
        getTranslationByKey("modifier") +
        "|0}[" +
        getTranslationByKey("modifier-mod") +
        "]",
      reactionQuery:
        "?{" +
        getTranslationByKey("charisma-modifier") +
        "|0}[" +
        getTranslationByKey("charisma-abbr") +
        "]"
    });
  });

  // Tabs
  const buttonlist = ["character", "spells", "retainers", "monster", "notes", "settings"];
  buttonlist.forEach((button) => {
    on(`clicked:${button}`, function (event) {
      setAttrs({ sheetTab: button });
    });
  });

  // Attribute Changes
  on("sheet:opened change:dex", function () {
    updateWeaponBonuses();

    getAttrs(["dex"], function (values) {
      setAttrs({ dexMod: getModifiers(values.dex) });
    });
  });
  on("sheet:opened change:str", function () {
    updateWeaponBonuses();

    getAttrs(["str"], function (values) {
      setAttrs({ strMod: getModifiers(values.str) });
    });
  });
  on("sheet:opened change:con", function () {
    getAttrs(["conMod", "con"], function (values) {
      setAttrs({ conMod: getModifiers(values.con) });
    });
  });
  on("sheet:opened change:int", function () {
    getAttrs(["int"], function (values) {
      setAttrs({ intMod: getModifiers(values.int) });
    });
  });
  on("sheet:opened change:wis", function () {
    getAttrs(["wis"], function (values) {
      setAttrs({ wisMod: getModifiers(values.wis) });
    });
  });
  on("sheet:opened change:cha change:kindred", function () {
    getAttrs(["cha", "kindred"], function (values) {
      const [chaMod, retainersMax, retainersLoyalty] = getModifiers(values.cha, [
        [-3, 1, 4],
        [-2, 2, 5],
        [-1, 3, 6],
        [0, 4, 7],
        [1, 5, 8],
        [2, 6, 9],
        [3, 7, 10]
      ]);
      setAttrs({ chaMod, retainersMax, retainersLoyalty: values.kindred.toLowerCase() === "human" ? retainersLoyalty + 1 : retainersLoyalty })
    })
  })

  /**
   * Given a value and set of modifiers, return the correct modifiers
   * @param {number} value The value to get modifiers for
   * @param {Array} modifiers Array of arrays or numbers representing modifiers
   * @returns {number|Array} The modifier(s) associated with the value
   */
  function getModifiers(value, modifiers = [-3, -2, -1, 0, 1, 2, 3]) {
    if (value <= 3) {
      return modifiers[0];
    } else if (value >= 4 && value <= 5) {
      return modifiers[1];
    } else if (value >= 6 && value <= 8) {
      return modifiers[2];
    } else if (value >= 9 && value <= 12) {
      return modifiers[3];
    } else if (value >= 13 && value <= 15) {
      return modifiers[4];
    } else if (value >= 16 && value <= 17) {
      return modifiers[5];
    } else {
      return modifiers[6];
    }
  }

  function updateWeaponBonuses() {
    getSectionIDs("repeating_weapons", function (idArray) {
      idArray.forEach(function (id) {
        const attributes = ["attackType", "weaponAttributeBonusDamage"]
          .map((name) => `repeating_weapons_${id}_${name}`)
          .concat(["strMod", "dexMod"]);
        getAttrs(attributes, function (values) {
          const attackType = values[`repeating_weapons_${id}_attackType`];
          if (!attackType) {
            if (
              values.strMod !== 0 &&
              values[`repeating_weapons_${id}_weaponAttributeBonusDamage`] === 0
            ) {
              setAttrs({
                [`repeating_weapons_${id}_attackType`]: "Ranged",
                [`repeating_weapons_${id}_weaponAttributeBonus`]: values.dexMod,
                [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: "0",
              });
            } else {
              setAttrs({
                [`repeating_weapons_${id}_attackType`]: "Melee",
                [`repeating_weapons_${id}_weaponAttributeBonus`]: values.strMod,
                [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: values.strMod,
              });
            }
          } else if (attackType.toLowerCase() === 'melee') {
            setAttrs({
              [`repeating_weapons_${id}_weaponAttributeBonus`]: values.strMod,
              [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: values.strMod,
            });
          } else if (attackType.toLowerCase() === 'ranged') {
            setAttrs({
              [`repeating_weapons_${id}_weaponAttributeBonus`]: values.dexMod,
              [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: "0",
            });
          }
        });
      });
    });
  }

  // Set speeds based on base Speed
  on("sheet:opened change:movementSpeed", function () {
    getAttrs(["movementSpeed"], function (values) {
      const speed = values.movementSpeed;
      setAttrs({
        movementExploration: Math.floor(speed * 3),
        movementOverland: Math.floor(speed / 5),
      });
    });
  });

  
  // Armor Calculation
  on("sheet:opened change:dex change:repeating_armor remove:repeating_armor",
    function () {
      const repeatingSum = (
        destination,
        section,
        fields,
        { multiplier = 1, callback = Function.prototype }
      ) => {
        if (!Array.isArray(fields)) fields = [fields];
        getSectionIDs(`repeating_${section}`, (idArray) => {
          const attrArray = idArray.reduce(
            (m, id) => [
              ...m,
              ...fields.map((field) => `repeating_${section}_${id}_${field}`),
            ],
            []
          );
          getAttrs(attrArray, (v) => {
            console.log("===== values of v: " + JSON.stringify(v) + " =====");
            // getValue: if not a number, returns 1 if it is 'on' (checkbox), otherwise returns 0..
            const getValue = (section, id, field) =>
              parseFloat(v[`repeating_${section}_${id}_${field}`]) ||
              (v[`repeating_${section}_${id}_${field}`] === "on" ? 1 : 0);
            const sumTotal = idArray.reduce(
              (total, id) =>
                total +
                fields.reduce(
                  (subtotal, field) => subtotal * getValue(section, id, field),
                  1
                ),
              0
            );
            setAttrs({ [destination]: sumTotal * multiplier }, callback);
          });
        });
      };

      repeatingSum("ArmorWorn", "armor", "armorWorn", {
        callback: () => {
          repeatingSum("ArmorTotal", "armor", ["armorValue", "armorWorn"], {
            callback: () => {
              getAttrs(["ArmorWorn", "ArmorTotal", "dexMod", "aacAcUnarmored", "dacAcUnarmored"], function (values) {
                const aacAc = values.ArmorWorn > 0 ? parseInt(values.ArmorTotal) + parseInt(values.dexMod) : values.aacAcUnarmored;
                setAttrs({ aacAc });
              })
            }
          });
        }
      });
    }
  );

  // Recalculate encumbrance
  on(
    [
      "sheet:opened",
      "change:ItemNameE1",
      "change:ItemWeightE1",
      "change:ItemNameE2",
      "change:ItemWeightE2",
      "change:ItemNameE3",
      "change:ItemWeightE3",
      "change:ItemNameE4",
      "change:ItemWeightE4",
      "change:ItemNameE5",
      "change:ItemWeightE5",
      "change:ItemNameE6",
      "change:ItemWeightE6",
      "change:ItemNameE7",
      "change:ItemWeightE7",
      "change:ItemNameE8",
      "change:ItemWeightE8",
      "change:ItemNameE9",
      "change:ItemWeightE9",
      "change:ItemNameE10",
      "change:ItemWeightE10",
      "change:ItemNameS1",
      "change:ItemWeightS1",
      "change:ItemNameS2",
      "change:ItemWeightS2",
      "change:ItemNameS3",
      "change:ItemWeightS3",
      "change:ItemNameS4",
      "change:ItemWeightS4",
      "change:ItemNameS5",
      "change:ItemWeightS5",
      "change:ItemNameS6",
      "change:ItemWeightS6",
      "change:ItemNameS7",
      "change:ItemWeightS7",
      "change:ItemNameS8",
      "change:ItemWeightS8",
      "change:ItemNameS9",
      "change:ItemWeightS9",
      "change:ItemNameS10",
      "change:ItemWeightS10",
      "change:ItemNameS11",
      "change:ItemWeightS11",
      "change:ItemNameS12",
      "change:ItemWeightS12",
      "change:ItemNameS13",
      "change:ItemWeightS13",
      "change:ItemNameS14",
      "change:ItemWeightS14",
      "change:ItemNameS15",
      "change:ItemWeightS15",
      "change:ItemNameS16",
      "change:ItemWeightS16",
      "change:PP",
      "change:EP",
      "change:GP",
      "change:SP",
      "change:CP",
      "change:encumbranceType"
    ].join(" "),
    function () {
      getAttrs([
        "ItemNameE1",
        "ItemWeightE1",
        "ItemNameE2",
        "ItemWeightE2",
        "ItemNameE3",
        "ItemWeightE3",
        "ItemNameE4",
        "ItemWeightE4",
        "ItemNameE5",
        "ItemWeightE5",
        "ItemNameE6",
        "ItemWeightE6",
        "ItemNameE7",
        "ItemWeightE7",
        "ItemNameE8",
        "ItemWeightE8",
        "ItemNameE9",
        "ItemWeightE9",
        "ItemNameE10",
        "ItemWeightE10",
        "ItemNameS1",
        "ItemWeightS1",
        "ItemNameS2",
        "ItemWeightS2",
        "ItemNameS3",
        "ItemWeightS3",
        "ItemNameS4",
        "ItemWeightS4",
        "ItemNameS5",
        "ItemWeightS5",
        "ItemNameS6",
        "ItemWeightS6",
        "ItemNameS7",
        "ItemWeightS7",
        "ItemNameS8",
        "ItemWeightS8",
        "ItemNameS9",
        "ItemWeightS9",
        "ItemNameS10",
        "ItemWeightS10",
        "ItemNameS11",
        "ItemWeightS11",
        "ItemNameS12",
        "ItemWeightS12",
        "ItemNameS13",
        "ItemWeightS13",
        "ItemNameS14",
        "ItemWeightS14",
        "ItemNameS15",
        "ItemWeightS15",
        "ItemNameS16",
        "ItemWeightS16",
        "PP",
        "EP",
        "GP",
        "SP",
        "CP",
        "encumbranceType"
      ], function(values) {
        let totalWeight = 0;
        let movementSpeed;

        for (const key in values) {
          if (values.hasOwnProperty(key) && key.includes("ItemWeight")) {
            totalWeight += parseInt(values[key], 10);
          }
        }
        
        totalWeight += (parseInt(values.PP, 10) + parseInt(values.GP, 10) + parseInt(values.SP, 10) + parseInt(values.CP, 10));

        if(values.encumbranceType === "slots") {
          if (values.ItemNameE8 !== "" || values.ItemNameS15 !== "") {
            movementSpeed = 10;
          } else if (values.ItemNameE6 !== "" || values.ItemNameS13 !== "") {
            movementSpeed = 20;
          } else if (values.ItemNameE4 !== "" || values.ItemNameS11 !== "") {
            movementSpeed = 30;
          } else {
            movementSpeed = 40;
          }
        } else {
          if (totalWeight > 1600) {
            movementSpeed = 0;
          } else if (totalWeight > 800) {
            movementSpeed = 10;
          } else if (totalWeight > 600) {
            movementSpeed = 20;
          } else if (totalWeight > 400) {
            movementSpeed = 30;
          } else {
            movementSpeed = 40;
          }
        }

        setAttrs({ movementSpeed, totalWeight });
      });
    }
  );

  // Update weaponAttributeBonus and weaponAttributeBonusDamage when STR or DEX changes
  on("change:repeating_weapons:attackType change:str change:dex", function () {
    getSectionIDs("repeating_weapons", function (idArray) {
      idArray.forEach(function (id) {
        const attributes = ["attackType"]
          .map((name) => `repeating_weapons_${id}_${name}`)
          .concat(["strMod", "dexMod"]);
        getAttrs(attributes, function (values) {
          if (values[`repeating_weapons_${id}_attackType`] === "ranged") {
            setAttrs({
              [`repeating_weapons_${id}_weaponAttributeBonus`]: values.dexMod,
              [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: "0",
            });
          } else {
            setAttrs({
              [`repeating_weapons_${id}_weaponAttributeBonus`]: values.strMod,
              [`repeating_weapons_${id}_weaponAttributeBonusDamage`]: values.strMod,
            });
          }
        });
      });
    });
  });
  
  // Set saving throws, BAB, HD, Next Level Experience
  on(
    "change:level change:class change:wis change:monsterHitDice change:monsterSpecialAbilities change:kindred change:customGlamours change:customRunes change:customKnacks change:customSpells",
    function () {
      
      const classData = {
        bard: [
          { xp: 0, hd: "1d6", bab: 0, saves: [13, 14, 13, 15, 15] },
          { xp: 1750, hd: "2d6", bab: 0, saves: [13, 14, 13, 15, 15] },
          { xp: 3500, hd: "3d6", bab: 1, saves: [12, 13, 12, 14, 14] },
          { xp: 7000, hd: "4d6", bab: 1, saves: [12, 13, 12, 14, 14] },
          { xp: 14000, hd: "5d6", bab: 2, saves: [11, 12, 11, 13, 13] },
          { xp: 28000, hd: "6d6", bab: 2, saves: [11, 12, 11, 13, 13] },
          { xp: 56000, hd: "7d6", bab: 3, saves: [10, 11, 10, 12, 12] },
          { xp: 112000, hd: "8d6", bab: 3, saves: [10, 11, 10, 12, 12] },
          { xp: 220000, hd: "9d6", bab: 4, saves: [9, 10, 9, 11, 11], },
          { xp: 340000, hd: "10d6", bab: 4, saves: [9, 10, 9, 11, 11], },
          { xp: 460000, hd: "10d6+1", bab: 5, saves: [8, 9, 8, 10, 10], },
          { xp: 580000, hd: "10d6+2", bab: 5, saves: [8, 9, 8, 10, 10], },
          { xp: 700000, hd: "10d6+3", bab: 6, saves: [7, 8, 7, 9, 9], },
          { xp: 820000, hd: "10d6+4", bab: 6, saves: [7, 8, 7, 9, 9], },
          { xp: 940000, hd: "10d6+5", bab: 7, saves: [6, 7, 6, 8, 8], },
        ],

        cleric: [
          { xp: 0, hd: "1d6", bab: 0, saves: [11, 12, 13, 16, 14], spells: [0, 0, 0, 0, 0, 0], turnUndead: true },
          { xp: 1500, hd: "2d6", bab: 0, saves: [11, 12, 13, 16, 14], spells: [1, 0, 0, 0, 0, 0], turnUndead: true },
          { xp: 3000, hd: "3d6", bab: 1, saves: [10, 11, 12, 15, 13], spells: [2, 0, 0, 0, 0, 0], turnUndead: true },
          { xp: 6000, hd: "4d6", bab: 1, saves: [10, 11, 12, 15, 13], spells: [2, 1, 0, 0, 0, 0], turnUndead: true },
          { xp: 12000, hd: "5d6", bab: 2, saves: [9, 10, 11, 14, 12], spells: [2, 2, 0, 0, 0, 0], turnUndead: true },
          { xp: 24000, hd: "6d6", bab: 2, saves: [9, 10, 11, 14, 12], spells: [2, 2, 1, 0, 0, 0], turnUndead: true },
          { xp: 48000, hd: "7d6", bab: 3, saves: [8, 9, 10, 13, 11], spells: [3, 2, 2, 0, 0, 0], turnUndead: true },
          { xp: 96000, hd: "8d6", bab: 3, saves: [8, 9, 10, 13, 11], spells: [3, 2, 2, 0, 0, 0], turnUndead: true },
          { xp: 190000, hd: "9d6", bab: 4, saves: [7, 8, 9, 12, 10], spells: [3, 3, 2, 1, 0, 0], turnUndead: true },
          { xp: 290000, hd: "10d6", bab: 4, saves: [7, 8, 9, 12, 10], spells: [3, 3, 2, 2, 0, 0], turnUndead: true },
          { xp: 390000, hd: "10d6+1", bab: 5, saves: [6, 7, 8, 11, 9], spells: [4, 3, 3, 2, 0, 0], turnUndead: true },
          { xp: 490000, hd: "10d6+2", bab: 5, saves: [6, 7, 8, 11, 9], spells: [4, 3, 3, 2, 1, 0], turnUndead: true },
          { xp: 590000, hd: "10d6+3", bab: 6, saves: [5, 6, 7, 10, 8], spells: [4, 4, 3, 2, 2, 0], turnUndead: true },
          { xp: 690000, hd: "10d6+4", bab: 6, saves: [5, 6, 7, 10, 8], spells: [4, 5, 3, 3, 2, 0], turnUndead: true },
          { xp: 790000, hd: "10d6+5", bab: 7, saves: [4, 5, 6, 9, 7], spells: [5, 4, 4, 3, 3, 0], turnUndead: true },
        ],

        enchanter: [
          { xp: 0, hd: "1d6", bab: 0, saves: [11, 12, 13, 16, 14], glamours: true, runes: true },
          { xp: 1750, hd: "2d6", bab: 0, saves: [11, 12, 13, 16, 14], glamours: true, runes: true },
          { xp: 3500, hd: "3d6", bab: 1, saves: [10, 11, 12, 15, 13], glamours: true, runes: true },
          { xp: 7000, hd: "4d6", bab: 1, saves: [10, 11, 12, 15, 13], glamours: true, runes: true },
          { xp: 14000, hd: "5d6", bab: 2, saves: [9, 10, 11, 14, 12], glamours: true, runes: true },
          { xp: 28000, hd: "6d6", bab: 2, saves: [9, 10, 11, 14, 12], glamours: true, runes: true },
          { xp: 56000, hd: "7d6", bab: 3, saves: [8, 9, 10, 13, 11], glamours: true, runes: true },
          { xp: 112000, hd: "8d6", bab: 3, saves: [8, 9, 10, 13, 11], glamours: true, runes: true },
          { xp: 220000, hd: "9d6", bab: 4, saves: [7, 8, 9, 12, 10], glamours: true, runes: true },
          { xp: 340000, hd: "10d6", bab: 4, saves: [7, 8, 9, 12, 10], glamours: true, runes: true },
          { xp: 460000, hd: "10d6+1", bab: 5, saves: [6, 7, 8, 11, 9], glamours: true, runes: true },
          { xp: 580000, hd: "10d6+2", bab: 5, saves: [6, 7, 8, 11, 9], glamours: true, runes: true },
          { xp: 700000, hd: "10d6+3", bab: 6, saves: [5, 6, 7, 10, 8], glamours: true, runes: true },
          { xp: 820000, hd: "10d6+4", bab: 6, saves: [5, 6, 7, 10, 8], glamours: true, runes: true },
          { xp: 940000, hd: "10d6+5", bab: 7, saves: [4, 5, 6, 9, 7], glamours: true, runes: true },
        ],
        
        fighter: [
          { xp: 0, hd: "1d8", bab: 1, saves: [12, 13, 14, 15, 16] },
          { xp: 2000, hd: "2d8", bab: 1, saves: [12, 13, 14, 15, 16] },
          { xp: 4000, hd: "3d8", bab: 2, saves: [11, 12, 13, 14, 15] },
          { xp: 8000, hd: "4d8", bab: 3, saves: [10, 11, 12, 13, 14] },
          { xp: 16000, hd: "5d8", bab: 3, saves: [10, 11, 12, 13, 14] },
          { xp: 32000, hd: "6d8", bab: 4, saves: [9, 10, 11, 12, 13] },
          { xp: 64000, hd: "7d8", bab: 5, saves: [8, 9, 10, 11, 12] },
          { xp: 128000, hd: "8d8", bab: 5, saves: [8, 9, 10, 11, 12] },
          { xp: 260000, hd: "9d8", bab: 6, saves: [7, 8, 9, 10, 11] },
          { xp: 380000, hd: "10d8", bab: 7, saves: [6, 7, 8, 9, 10] },
          { xp: 500000, hd: "10d8+2", bab: 7, saves: [6, 7, 8, 9, 10] },
          { xp: 620000, hd: "10d8+4", bab: 8, saves: [5, 6, 7, 8, 9] },
          { xp: 740000, hd: "10d8+6", bab: 9, saves: [4, 5, 6, 7, 8] },
          { xp: 860000, hd: "10d8+8", bab: 9, saves: [4, 5, 6, 7, 8] },
          { xp: 980000, hd: "10d8+10", bab: 10, saves: [3, 4, 5, 6, 7] },
        ],

        friar: [
          { xp: 0, hd: "1d4", bab: 0, acBonus: 2, saves: [11, 12, 13, 16, 14], spells: [1, 0, 0, 0, 0, 0], turnUndead: true },
          { xp: 2000, hd: "2d4", bab: 0, acBonus: 2, saves: [11, 12, 13, 16, 14], spells: [2, 0, 0, 0, 0, 0], turnUndead: true },
          { xp: 4000, hd: "3d4", bab: 0, acBonus: 2, saves: [11, 12, 13, 16, 14], spells: [2, 1, 0, 0, 0, 0], turnUndead: true },
          { xp: 8000, hd: "4d4", bab: 1, acBonus: 3, saves: [10, 11, 12, 15, 13], spells: [2, 2, 0, 0, 0, 0], turnUndead: true },
          { xp: 16000, hd: "5d4", bab: 1, acBonus: 3, saves: [10, 11, 12, 15, 13], spells: [3, 2, 1, 0, 0, 0], turnUndead: true },
          { xp: 32000, hd: "6d4", bab: 1, acBonus: 3, saves: [10, 11, 12, 15, 13], spells: [3, 2, 2, 0, 0, 0], turnUndead: true },
          { xp: 64000, hd: "7d4", bab: 2, acBonus: 4, saves: [9, 10, 11, 14, 12], spells: [3, 3, 2, 1, 0, 0], turnUndead: true },
          { xp: 120000, hd: "8d4", bab: 2, acBonus: 4, saves: [9, 10, 11, 14, 12], spells: [4, 3, 2, 2, 0, 0], turnUndead: true },
          { xp: 120000, hd: "9d4", bab: 2, acBonus: 4, saves: [9, 10, 11, 14, 12], spells: [4, 3, 3, 2, 1, 0], turnUndead: true },
          { xp: 120000, hd: "10d4", bab: 3, acBonus: 4, saves: [8, 9, 10, 13, 11], spells: [4, 4, 3, 2, 2, 0], turnUndead: true },
          { xp: 120000, hd: "10d4+1", bab: 3, acBonus: 5, saves: [8, 9, 10, 13, 11], spells: [5, 4, 3, 3, 2, 0], turnUndead: true },
          { xp: 120000, hd: "10d4+2", bab: 3, acBonus: 5, saves: [8, 9, 10, 13, 11], spells: [5, 4, 4, 3, 2, 0], turnUndead: true },
          { xp: 120000, hd: "10d4+3", bab: 4, acBonus: 5, saves: [7, 8, 9, 12, 10], spells: [5, 5, 4, 3, 3, 0], turnUndead: true },
          { xp: 120000, hd: "10d4+4", bab: 4, acBonus: 5, saves: [7, 8, 9, 12, 10], spells: [6, 5, 4, 4, 3, 0], turnUndead: true },
          { xp: 120000, hd: "10d4+5", bab: 4, acBonus: 5, saves: [7, 8, 9, 12, 10], spells: [6, 5, 5, 4, 3, 0], turnUndead: true },
        ],

        hunter: [
          { xp: 0, hd: "1d8", bab: 1, rangeBonus: 1, saves: [12, 13, 14, 15, 16] },
          { xp: 2250, hd: "2d8", bab: 1, rangeBonus: 1, saves: [12, 13, 14, 15, 16] },
          { xp: 4500, hd: "3d8", bab: 2, rangeBonus: 1, saves: [11, 12, 13, 14, 15] },
          { xp: 9000, hd: "4d8", bab: 3, rangeBonus: 1, saves: [10, 11, 12, 13, 14] },
          { xp: 18000, hd: "5d8", bab: 3, rangeBonus: 1, saves: [10, 11, 12, 13, 14] },
          { xp: 36000, hd: "6d8", bab: 4, rangeBonus: 1, saves: [9, 10, 11, 12, 13] },
          { xp: 72000, hd: "7d8", bab: 5, rangeBonus: 1, saves: [8, 9, 10, 11, 12] },
          { xp: 144000, hd: "8d8", bab: 5, rangeBonus: 1, saves: [8, 9, 10, 11, 12] },
          { xp: 290000, hd: "9d8", bab: 6, rangeBonus: 1, saves: [7, 8, 9, 10, 11], },
          { xp: 420000, hd: "10d8", bab: 7, rangeBonus: 1, saves: [6, 7, 8, 9, 10], },
          { xp: 550000, hd: "10d8+2", bab: 7, rangeBonus: 1, saves: [6, 7, 8, 9, 10], },
          { xp: 680000, hd: "10d8+4", bab: 8, rangeBonus: 1, saves: [5, 6, 7, 8, 9], },
          { xp: 810000, hd: "10d8+6", bab: 9, rangeBonus: 1, saves: [4, 5, 6, 7, 8], },
          { xp: 940000, hd: "10d8+8", bab: 9, rangeBonus: 1, saves: [4, 5, 6, 7, 8], },
          { xp: 1070000, hd: "10d8+10", bab: 10, rangeBonus: 1, saves: [3, 4, 5, 6, 7], },
        ],

        knight: [
          { xp: 0, hd: "1d8", bab: 1, magicResistBonus: 2, saves: [12, 13, 12, 15, 15] },
          { xp: 2250, hd: "2d8", bab: 1, magicResistBonus: 2, saves: [12, 13, 12, 15, 15] },
          { xp: 4500, hd: "3d8", bab: 2, magicResistBonus: 2, saves: [11, 12, 11, 14, 14] },
          { xp: 9000, hd: "4d8", bab: 3, magicResistBonus: 2, saves: [10, 11, 10, 13, 13] },
          { xp: 18000, hd: "5d8", bab: 3, magicResistBonus: 2, saves: [10, 11, 10, 13, 13] },
          { xp: 36000, hd: "6d8", bab: 4, magicResistBonus: 2, saves: [9, 10, 9, 12, 12] },
          { xp: 72000, hd: "7d8", bab: 5, magicResistBonus: 2, saves: [8, 9, 8, 11, 11] },
          { xp: 144000, hd: "8d8", bab: 5, magicResistBonus: 2, saves: [8, 9, 8, 11, 11] },
          { xp: 290000, hd: "9d8", bab: 6, magicResistBonus: 2, saves: [7, 8, 7, 10, 10] },
          { xp: 420000, hd: "10d8", bab: 7, magicResistBonus: 2, saves: [6, 7, 6, 9, 9] },
          { xp: 550000, hd: "10d8+2", bab: 7, magicResistBonus: 2, saves: [6, 7, 6, 9, 9] },
          { xp: 680000, hd: "10d8+4", bab: 8, magicResistBonus: 2, saves: [5, 6, 5, 8, 8] },
          { xp: 810000, hd: "10d8+6", bab: 9, magicResistBonus: 2, saves: [4, 5, 4, 7, 7] },
          { xp: 940000, hd: "10d8+8", bab: 9, magicResistBonus: 2, saves: [4, 5, 4, 7, 7] },
          { xp: 1070000, hd: "10d8+10", bab: 10, magicResistBonus: 2, saves: [3, 4, 3, 6, 6] },
        ],

        magician: [
          { xp: 0, hd: "1d4", bab: 0, saves: [14, 14, 13, 16, 14], spells: [1, 0, 0, 0, 0, 0] },
          { xp: 2500, hd: "2d4", bab: 0, saves: [14, 14, 13, 16, 14], spells: [2, 0, 0, 0, 0, 0] },
          { xp: 5000, hd: "3d4", bab: 0, saves: [14, 14, 13, 16, 14], spells: [2, 1, 0, 0, 0, 0] },
          { xp: 10000, hd: "4d4", bab: 1, saves: [13, 13, 12, 15, 13], spells: [2, 2, 0, 0, 0, 0] },
          { xp: 20000, hd: "5d4", bab: 1, saves: [13, 13, 12, 15, 13], spells: [2, 2, 1, 0, 0, 0] },
          { xp: 40000, hd: "6d4", bab: 1, saves: [13, 13, 12, 15, 13], spells: [3, 2, 2, 0, 0, 0] },
          { xp: 80000, hd: "7d4", bab: 2, saves: [12, 12, 11, 14, 12], spells: [3, 2, 2, 1, 0, 0] },
          { xp: 160000, hd: "8d4", bab: 2, saves: [12, 12, 11, 14, 12], spells: [3, 3, 2, 2, 0, 0] },
          { xp: 320000, hd: "9d4", bab: 2, saves: [12, 12, 11, 14, 12], spells: [3, 3, 2, 2, 1, 0] },
          { xp: 470000, hd: "10d4", bab: 3, saves: [11, 11, 10, 13, 11], spells: [4, 3, 3, 2, 2, 0] },
          { xp: 620000, hd: "10d4+1", bab: 3, saves: [11, 11, 10, 13, 11], spells: [4, 3, 3, 2, 2, 1] },
          { xp: 770000, hd: "10d4+2", bab: 3, saves: [11, 11, 10, 13, 11], spells: [4, 4, 3, 3, 2, 2] },
          { xp: 920000, hd: "10d4+3", bab: 4, saves: [10, 10, 9, 12, 10], spells: [4, 4, 3, 3, 3, 2] },
          { xp: 1070000, hd: "10d4+4", bab: 4, saves: [10, 10, 9, 12, 10], spells: [5, 4, 4, 3, 3, 2] },
          { xp: 1220000, hd: "10d4+5", bab: 4, saves: [10, 10, 9, 12, 10], spells: [5, 4, 4, 3, 3, 3] },
        ],

        thief: [
          { xp: 0, hd: "1d4", bab: 0, saves: [13, 14, 13, 15, 15] },
          { xp: 1200, hd: "2d4", bab: 0, saves: [13, 14, 13, 15, 15] },
          { xp: 2400, hd: "3d4", bab: 1, saves: [12, 13, 12, 14, 14] },
          { xp: 4800, hd: "4d4", bab: 1, saves: [12, 13, 12, 14, 14], },
          { xp: 9600, hd: "5d4", bab: 2, saves: [11, 12, 11, 13, 13], },
          { xp: 19200, hd: "6d4", bab: 2, saves: [11, 12, 11, 13, 13], },
          { xp: 38400, hd: "7d4", bab: 3, saves: [10, 11, 10, 12, 12], },
          { xp: 76800, hd: "8d4", bab: 3, saves: [10, 11, 10, 12, 12], },
          { xp: 150000, hd: "9d4", bab: 4, saves: [9, 10, 9, 11, 11], },
          { xp: 270000, hd: "10d4", bab: 4, saves: [9, 10, 9, 11, 11], },
          { xp: 390000, hd: "10d4+1", bab: 5, saves: [8, 9, 8, 10, 10], },
          { xp: 510000, hd: "10d4+2", bab: 5, saves: [8, 9, 8, 10, 10], },
          { xp: 630000, hd: "10d4+3", bab: 6, saves: [7, 8, 7, 9, 9], },
          { xp: 750000, hd: "10d4+4", bab: 6, saves: [7, 8, 7, 9, 9], },
          { xp: 870000, hd: "10d4+5", bab: 7, saves: [6, 7, 6, 8, 8], },
        ],

        breggle: [
          { xp: 0, hd: "1d6", bab: 1, saves: [12, 13, 14, 15, 16], },
          { xp: 2000, hd: "2d6", bab: 1, saves: [12, 13, 14, 15, 16], },
          { xp: 4000, hd: "3d6", bab: 2, saves: [11, 12, 13, 14, 15], },
          { xp: 8000, hd: "4d6", bab: 3, saves: [10, 11, 12, 13, 14], },
          { xp: 16000, hd: "5d6", bab: 3, saves: [10, 11, 12, 13, 14], },
          { xp: 32000, hd: "6d6", bab: 4, saves: [9, 10, 11, 12, 13], },
          { xp: 64000, hd: "7d6", bab: 5, saves: [8, 9, 10, 11, 12], },
          { xp: 128000, hd: "8d6", bab: 5, saves: [8, 9, 10, 11, 12], },
          { xp: 260000, hd: "9d6", bab: 6, saves: [7, 8, 9, 10, 11], },
          { xp: 380000, hd: "10d6", bab: 7, saves: [6, 7, 8, 9, 10], },
          { xp: 500000, hd: "10d6+2", bab: 7, saves: [6, 7, 8, 9, 10], },
          { xp: 620000, hd: "10d6+4", bab: 8, saves: [5, 6, 7, 8, 9], },
          { xp: 740000, hd: "10d6+6", bab: 9, saves: [4, 5, 6, 7, 8], },
          { xp: 860000, hd: "10d6+8", bab: 9, saves: [4, 5, 6, 7, 8], },
          { xp: 980000, hd: "10d6+10", bab: 10, saves: [3, 4, 5, 6, 7], },
        ],

        cobbin: [
          { xp: 0, hd: "1d6", bab: 0, saves: [8, 9, 10, 13, 12] },
          { xp: 2000, hd: "2d6", bab: 0, saves: [8, 9, 10, 13, 12] },
          { xp: 4000, hd: "3d6", bab: 1, saves: [7, 8, 9, 12, 11] },
          { xp: 8000, hd: "4d6", bab: 1, saves: [7, 8, 9, 12, 11] },
          { xp: 16000, hd: "5d6", bab: 2, saves: [6, 7, 8, 11, 10] },
          { xp: 32000, hd: "6d6", bab: 2, saves: [6, 7, 8, 11, 10] },
          { xp: 64000, hd: "7d6", bab: 3, saves: [5, 6, 7, 10, 9] },
          { xp: 128000, hd: "8d6", bab: 3, saves: [5, 6, 7, 10, 9] },
          { xp: 260000, hd: "9d6", bab: 4, saves: [4, 5, 6, 9, 8] },
          { xp: 380000, hd: "10d6", bab: 4, saves: [4, 5, 6, 9, 8] },
          { xp: 500000, hd: "10d6+1", bab: 5, saves: [3, 4, 5, 8, 7] },
          { xp: 620000, hd: "10d6+2", bab: 5, saves: [3, 4, 5, 8, 7] },
          { xp: 740000, hd: "10d6+3", bab: 6, saves: [2, 3, 4, 7, 6] },
          { xp: 860000, hd: "10d6+4", bab: 6, saves: [2, 3, 4, 7, 6] },
          { xp: 980000, hd: "10d6+5", bab: 7, saves: [2, 2, 3, 6, 5] },
        ],

        elf: [
          { xp: 0, hd: "1d6", bab: 1, saves: [11, 12, 13, 16, 14], glamours: true, runes: true },
          { xp: 3550, hd: "2d6", bab: 1, saves: [11, 12, 13, 16, 14], glamours: true, runes: true },
          { xp: 7000, hd: "3d6", bab: 2, saves: [10, 11, 12, 15, 13], glamours: true, runes: true },
          { xp: 1400, hd: "4d6", bab: 3, saves: [9, 10, 11, 14, 12], glamours: true, runes: true },
          { xp: 28000, hd: "5d6", bab: 3, saves: [9, 10, 11, 14, 12], glamours: true, runes: true },
          { xp: 56000, hd: "6d6", bab: 4, saves: [8, 9, 10, 13, 11], glamours: true, runes: true },
          { xp: 112000, hd: "7d6", bab: 5, saves: [7, 8, 9, 12, 10], glamours: true, runes: true },
          { xp: 224000, hd: "8d6", bab: 5, saves: [7, 8, 9, 12, 10], glamours: true, runes: true },
          { xp: 450000, hd: "9d6", bab: 6, saves: [6, 7, 8, 11, 9], glamours: true, runes: true },
          { xp: 620000, hd: "10d6", bab: 7, saves: [5, 6, 7, 10, 8], glamours: true, runes: true },
          { xp: 790000, hd: "10d6+1", bab: 7, saves: [5, 6, 7, 10, 8], glamours: true, runes: true },
          { xp: 960000, hd: "10d6+2", bab: 8, saves: [4, 5, 6, 9, 7], glamours: true, runes: true },
          { xp: 1130000, hd: "10d6+3", bab: 9, saves: [3, 4, 5, 8, 6], glamours: true, runes: true },
          { xp: 1300000, hd: "10d6+4", bab: 9, saves: [3, 4, 5, 8, 6], glamours: true, runes: true },
          { xp: 1470000, hd: "10d6+5", bab: 10, saves: [2, 3, 4, 7, 5], glamours: true, runes: true },
        ],
        
        grimalkin: [
          { xp: 0, hd: "1d6", bab: 0, saves: [11, 11, 13, 15, 14], glamours: true, },
          { xp: 2500, hd: "2d6", bab: 0, saves: [11, 11, 13, 15, 14], glamours: true, },
          { xp: 5000, hd: "3d6", bab: 1, saves: [10, 10, 12, 14, 13], glamours: true, },
          { xp: 10000, hd: "4d6", bab: 1, saves: [10, 10, 12, 14, 13], glamours: true, },
          { xp: 20000, hd: "5d6", bab: 2, saves: [9, 9, 11, 13, 12], glamours: true, },
          { xp: 40000, hd: "6d6", bab: 2, saves: [9, 9, 11, 13, 12], glamours: true, },
          { xp: 80000, hd: "7d6", bab: 3, saves: [8, 8, 10, 12, 11], glamours: true, },
          { xp: 160000, hd: "8d6", bab: 3, saves: [8, 8, 10, 12, 11], glamours: true, },
          { xp: 320000, hd: "9d6", bab: 4, saves: [7, 7, 9, 11, 10], glamours: true, },
          { xp: 450000, hd: "10d6", bab: 4, saves: [7, 7, 9, 11, 10], glamours: true, },
          { xp: 580000, hd: "10d6+1", bab: 5, saves: [6, 6, 8, 10, 9], glamours: true, },
          { xp: 710000, hd: "10d6+2", bab: 5, saves: [6, 6, 8, 10, 9], glamours: true, },
          { xp: 840000, hd: "10d6+3", bab: 6, saves: [5, 5, 7, 9, 8], glamours: true, },
          { xp: 970000, hd: "10d6+4", bab: 6, saves: [5, 5, 7, 9, 8], glamours: true, },
          { xp: 1100000, hd: "10d6+5", bab: 7, saves: [4, 4, 6, 8, 7], glamours: true, },
        ],
        
        mossling: [
          { xp: 0, hd: "1d6", bab: 0, saves: [8, 9, 10, 13, 12], knacks: true },
          { xp: 2200, hd: "2d6", bab: 0, saves: [8, 9, 10, 13, 12], knacks: true },
          { xp: 4400, hd: "3d6", bab: 1, saves: [7, 8, 9, 12, 11], knacks: true },
          { xp: 8800, hd: "4d6", bab: 1, saves: [7, 8, 9, 12, 11], knacks: true },
          { xp: 17600, hd: "5d6", bab: 2, saves: [6, 7, 8, 11, 10], knacks: true },
          { xp: 35200, hd: "6d6", bab: 2, saves: [6, 7, 8, 11, 10], knacks: true },
          { xp: 70400, hd: "7d6", bab: 3, saves: [5, 6, 7, 10, 9], knacks: true },
          { xp: 140800, hd: "8d6", bab: 3, saves: [5, 6, 7, 10, 9], knacks: true },
          { xp: 280000, hd: "9d6", bab: 4, saves: [4, 5, 6, 9, 8], knacks: true },
          { xp: 400000, hd: "10d6", bab: 4, saves: [4, 5, 6, 9, 8], knacks: true },
          { xp: 520000, hd: "10d6+2", bab: 5, saves: [3, 4, 5, 8, 7], knacks: true },
          { xp: 640000, hd: "10d6+4", bab: 5, saves: [3, 4, 5, 8, 7], knacks: true },
          { xp: 760000, hd: "10d6+6", bab: 6, saves: [2, 3, 4, 7, 6], knacks: true },
          { xp: 880000, hd: "10d6+8", bab: 6, saves: [2, 3, 4, 7, 6], knacks: true },
          { xp: 1000000, hd: "10d6+10", bab: 7, saves: [2, 2, 3, 6, 5], knacks: true },
        ],

        woodgrue: [
          { xp: 0, hd: "1d6", bab: 0, saves: [13, 12, 14, 16, 14] },
          { xp: 2000, hd: "2d6", bab: 0, saves: [13, 12, 14, 16, 14] },
          { xp: 4000, hd: "3d6", bab: 1, saves: [12, 11, 13, 15, 13] },
          { xp: 8000, hd: "4d6", bab: 1, saves: [12, 11, 13, 15, 13] },
          { xp: 16000, hd: "5d6", bab: 2, saves: [11, 10, 12, 14, 12] },
          { xp: 32000, hd: "6d6", bab: 2, saves: [11, 10, 12, 14, 12] },
          { xp: 64000, hd: "7d6", bab: 3, saves: [10, 9, 11, 13, 11] },
          { xp: 128000, hd: "8d6", bab: 3, saves: [10, 9, 11, 13, 11] },
          { xp: 260000, hd: "9d6", bab: 4, saves: [9, 8, 10, 12, 10] },
          { xp: 380000, hd: "10d6", bab: 4, saves: [9, 8, 10, 12, 10] },
          { xp: 500000, hd: "10d6+1", bab: 5, saves: [8, 7, 9, 11, 9] },
          { xp: 620000, hd: "10d6+2", bab: 5, saves: [8, 7, 9, 11, 9] },
          { xp: 740000, hd: "10d6+3", bab: 6, saves: [7, 6, 8, 10, 8] },
          { xp: 860000, hd: "10d6+4", bab: 6, saves: [7, 6, 8, 10, 8] },
          { xp: 980000, hd: "10d6+5", bab: 7, saves: [6, 5, 7, 9, 7] },
        ],

        "everyday mortal": [
          { xp: 0, hd: "1d4", bab: -1, saves: [14, 15, 16, 17, 18] },
        ],
        
        monster: [
          { bab: 0, saves: [12, 13, 14, 15, 16], xp: [10, 5], hd: "1d8", }, // 1
          { bab: 1, saves: [12, 13, 14, 15, 16], xp: [20, 15], hd: "2d8", }, // 2
          { bab: 2, saves: [11, 12, 13, 14, 15], xp: [40, 25], hd: "3d8", }, // 3
          { bab: 3, saves: [10, 11, 12, 13, 14], xp: [80, 50], hd: "4d8", }, // 4
          { bab: 4, saves: [10, 11, 12, 13, 14], xp: [160, 100], hd: "5d8", }, // 5
          { bab: 5, saves: [9, 10, 11, 12, 13], xp: [320, 200], hd: "6d8", }, // 6
          { bab: 6, saves: [8, 9, 10, 11, 12], xp: [480, 300], hd: "7d8", }, // 7
          { bab: 7, saves: [8, 9, 10, 11, 12], xp: [640, 400], hd: "8d8", }, // 8
          { bab: 7, saves: [7, 8, 9, 10, 11], xp: [800, 550], hd: "9d8", }, // 9
          { bab: 8, saves: [6, 7, 8, 9, 10], xp: [950, 650], hd: "10d8", }, // 10
          { bab: 8, saves: [6, 7, 8, 9, 10], xp: [1100, 750], hd: "11d8", }, // 11
          { bab: 9, saves: [5, 6, 7, 8, 9], xp: [1250, 850], hd: "12d8", }, // 12
          { bab: 9, saves: [4, 5, 6, 7, 8], xp: [1400, 900], hd: "13d8", }, // 13
          { bab: 10, saves: [4, 5, 6, 7, 8], xp: [1550, 1000], hd: "14d8", }, // 14
          { bab: 10, saves: [3, 4, 5, 6, 7], xp: [1700, 1100], hd: "15d8", }, // 15
          { bab: 11, saves: [2, 3, 4, 5, 6], xp: [1850, 1200], hd: "16d8", }, // 16
          { bab: 11, saves: [2, 3, 4, 5, 6], xp: [2000, 1300], hd: "17d8", }, // 17
          { bab: 12, saves: [2, 2, 3, 4, 5], xp: [2150, 1400], hd: "18d8", }, // 18
          { bab: 12, saves: [2, 2, 2, 3, 4], xp: [2300, 1500], hd: "19d8", }, // 19
          { bab: 13, saves: [2, 2, 2, 3, 4], xp: [2450, 1600], hd: "20d8", }, // 20
          { bab: 13, saves: [2, 2, 2, 2, 3], xp: [2600, 1700], hd: "21d8", }, // 21
          { bab: 14, saves: [2, 2, 2, 2, 2], xp: [150, 100], hd: "", }, // 22+
        ],
      };

      getAttrs(
        ["level", "class", "kindred", "wisMod", "monsterHitDice", "monsterSpecialAbilities", "Next", "hitdice", "bab", "saveD", "saveW", "saveP", "saveB", "saveS", "customGlamours", "customRunes", "customKnacks", "customSpells" ],
        function (values) {
          const charClass = values.class.toLowerCase();
          const charKindred = values.kindred.toLowerCase();
          const level = parseInt(values.level, 10);
          const monsterHitDice = Math.ceil(values.monsterHitDice);

          const kindredData = {
            breggle: {},
            cobbin: {},
            elf: { glamours: true, magicResistBonus: 2 },
            grimalkin: { glamours: true, magicResistBonus: 2 },
            human: {},
            mossling: { knacks: true, doomSaveBonus: 2, saveBonus: 2 },
            woodgrue: {},
            custom: {
              glamours: values.customGlamours != 0,
              runes: values.customRunes != 0,
              spells: values.customSpells == 0 ? [] : [0,0,0,0,0,0],
              knacks: values.customKnacks != 0,
            },
          }

          let newAttributes = {
            Next: values.Next,
            hitdice: values.hitdice,
            bab: values.bab,
            saveD: parseInt(values.saveD, 10),
            saveW: parseInt(values.saveW, 10),
            saveP: parseInt(values.saveP, 10),
            saveB: parseInt(values.saveB, 10),
            saveS: parseInt(values.saveS, 10),
            magicResistance: values.wisMod
          }

          if (charClass === "monster" && Number.isInteger(monsterHitDice)) {
            
            let monsterData = {
              xp: [0, 0],
              hd: "1d4",
              saves: [20,20,20,20,20],
              bab: -1,
            };
            
            if (monsterHitDice < 22 ) {
              monsterData = classData["monster"][monsterHitDice - 1];
            } else {
              monsterData = {
                xp: [monsterData[21].xp[0] * monsterHitDice, monsterData[21].xp[1] * monsterHitDice],
                hd: `${monsterHitDice}d8`,
                saves: monsterData[21].saves,
                bab: monsterData[21].bab,
              }
            }

            newAttributes = {
              Next: 0,
              bab: monsterData.bab,
              hitdice: monsterData.hd,
              saveD: monsterData.saves[0],
              saveW: monsterData.saves[1],
              saveP: monsterData.saves[2],
              saveB: monsterData.saves[3],
              saveS: monsterData.saves[4],
              monsterXPValue: monsterData.xp[0] + (values.monsterSpecialAbilities * monsterData.xp[1]),
              glamours: false,
              runes: false,
              spells: [],
              turnUndead: false,
              acBonus: 0,
              rangeBonus: 0,
              magicResistance: values.wisMod,
              knacks: false,
            };
          } else if (charClass === "everyday mortal") {
            const { hd, bab, saves } = classData["everyday mortal"][0];
            newAttributes = {
              Next: 0,
              hitdice: hd,
              bab: bab,
              saveD: saves[0],
              saveW: saves[1],
              saveP: saves[2],
              saveB: saves[3],
              saveS: saves[4],
              monsterXPValue: 10,
              glamours: false,
              runes: false,
              spells: [],
              turnUndead: false,
              acBonus: 0,
              rangeBonus: 0,
              knacks: false,
              magicResistance: values.wisMod
            };
          } else if (charClass !== "custom" && charClass !== "--" && charClass !== "custom kindred-class") {
            const nextXp = classData[charClass][level] ? classData[charClass][level].xp : "";
            const { hd, bab, saves, glamours, runes, spells, turnUndead, acBonus, rangeBonus, magicResistBonus, knacks } = classData[charClass][level - 1];
            newAttributes = {
              Next: nextXp,
              hitdice: hd,
              bab: bab,
              saveD: saves[0],
              saveW: saves[1],
              saveP: saves[2],
              saveB: saves[3],
              saveS: saves[4],
              monsterXPValue: classData["monster"][level - 1].xp[1],
              glamours: glamours || false,
              runes: runes || false,
              spells: spells || [],
              turnUndead: turnUndead || false,
              acBonus: acBonus || 0,
              rangeBonus: rangeBonus || 0,
              magicResistance: parseInt(values.wisMod, 10) + (magicResistBonus || 0),
              knacks: knacks || false
            };
          } else if (charClass === "custom" || charClass === "custom kindred-class") {
            newAttributes = {
              ...newAttributes,
              glamours: values.customGlamours != 0,
              runes: values.customRunes != 0,
              spells: values.customSpells == 0 ? [] : [0,0,0,0,0,0],
              knacks: values.customKnacks != 0,
            }
          }
          
          if (charKindred !== "--" 
          && charClass !== "custom kindred-class" 
          && charClass !== "breggle"
          && charClass !== "cobbin"
          && charClass !== "elf"
          && charClass !== "grimalkin"
          && charClass !== "mossling"
          && charClass !== "woodgrue"
          && charClass !== "monster") {
            
            newAttributes = {
              ...newAttributes,
              glamours: newAttributes.glamours || kindredData[charKindred].glamours || false,
              runes: newAttributes.runes || kindredData[charKindred].runes || false,
              spells: newAttributes.spells.length > 0 ? newAttributes.spells : (values.customSpells == 0 ? [] : [0,0,0,0,0,0]),
              magicResistance: parseInt(newAttributes.magicResistance, 10) + (kindredData[charKindred].magicResistBonus || 0),
              knacks: kindredData[charKindred].knacks || kindredData[charKindred].knacks || false,
              saveD: newAttributes.saveD - (kindredData[charKindred].doomSaveBonus || 0) - (kindredData[charKindred].saveBonus || 0),
              saveW: newAttributes.saveW - (kindredData[charKindred].saveBonus || 0),
              saveP: newAttributes.saveP - (kindredData[charKindred].saveBonus || 0),
              saveB: newAttributes.saveB - (kindredData[charKindred].saveBonus || 0),
              saveS: newAttributes.saveS - (kindredData[charKindred].saveBonus || 0),
            }  
          } else {
            setAttrs({ kindred: "--"});
          }
          
          if (newAttributes.spells.length > 0) {
            newAttributes = {
              ...newAttributes,
              spellsLevel1Total: newAttributes.spells[0],
              spellsLevel2Total: newAttributes.spells[1],
              spellsLevel3Total: newAttributes.spells[2],
              spellsLevel4Total: newAttributes.spells[3],
              spellsLevel5Total: newAttributes.spells[4],
              spellsLevel6Total: newAttributes.spells[5],
            }
          }
          
          setAttrs(newAttributes);
        }
      );
    }
  );

  // Set averageHP for monsters automatically
  on(
    "sheet:opened change:monsterHitDice change:hitdice",
    function () {
      getAttrs(["hitdice"], function (values) {
        const [diceNumber, diceSize] = values.hitdice.split("d");
        setAttrs({
          averageHP:
            Math.floor(parseInt(diceNumber, 10) * ((parseInt(diceSize, 10) / 2 ) + 0.5)),
        });
      });
    }
  );

  // Monster Average HP Button
  on("clicked:setAverageHP", function () {
    getAttrs(["averageHP"], function (values) {
      setAttrs({
        HP: values.averageHP,
        HP_max: values.averageHP,
      });
    });
  });

  on("sheet:opened change:encumbranceType change:PP change:GP change:SP change:CP change:coinPouchMaxLoad", function () {
    getAttrs(["encumbranceType", "PP", "GP", "SP", "CP", "coinPouchMaxLoad"], function (values) {
      const type = values.encumbranceType;
      const pp = parseInt(values.PP, 10) || 0;
      const gp = parseInt(values.GP, 10) || 0;
      const sp = parseInt(values.SP, 10) || 0;
      const cp = parseInt(values.CP, 10) || 0;
      const maxLoad = parseInt(values.coinPouchMaxLoad, 10) || 0;
  
      const total = pp + gp + sp + cp;
  
      const isOverloaded = (type === "slots" && total > maxLoad && maxLoad !== 0) ? "1" : "0";
  
      setAttrs({ coinsOverloaded: isOverloaded });
    });
  });
</script>