<!-- TABS
   ============================= -->
<input class="type" name="attr_sheet_type" type="hidden" value="character">
<input class="display_string" name="attr_character_settings" type="hidden" value="">

<!-- TABS & LOGO
   ============================= -->
<div class="tabs">
	<!-- PUT LOGO HERE. UPDATE ALT TEXT -->
	<img alt="Emerald Productions logo" src="https://raw.githubusercontent.com/clevett/SheetTemplate/master/images/EProd_Title_Gloss.png">
	<div class="grid grid-tab-inputs">
		<!-- INFO INPUTS -->
		<!-- data-i18n is for translating to multiple languages -->
		<span data-i18n="character">character</span>
		<label data-i18n-title="" title="character name">
			<input data-i18n-placeholder="character-name" name="attr_character_name" placeholder="character name" title="@{character_name}" type="text" value="" />
		</label>
		<span data-i18n="player">player</span>
		<label data-i18n-title="player-name" title="player name">
			<input data-i18n-placeholder="" name="attr_player_name" placeholder="player name" title="@{player_name}" type="text" value="" />
		</label>
		<span data-i18n="notes">notes</span>
		<label data-i18n-title="" title="character notes">
			<input data-i18n-placeholder="character-notes" name="attr_character_notes" placeholder="character notes" title="@{character_notes}" type="text" value="" />
		</label>
	</div>
	<div class="grid grid-tab-buttons">
		<!-- Buttons to toggle on GM whisper -->
		<input class="whisper-toggle" name="attr_gm_toggle" type="hidden"  value=" " />
		<button name="act_whisper" data-i18n-title="gm-whisper" title="gm whisper" type="action">q</button>
		<!-- CHARACTER SHEETS -->
	    <button data-i18n="pc" data-i18n-title="" name="act_toggle_character" title="player character button" type="action">pc</button>
	    <button data-i18n="notes" data-i18n-title="" name="act_toggle_notes" title="notes button" type="action">notes</button>
	    <button data-i18n="npc" data-i18n-title="" name="act_toggle_npc" title="non player character" type="action">npc</button>
	</div>
</div>

<!-- NPC SHEET
   ============================= -->
<div class="npc">
	<div class="box npc-flex">
		<p>NPC STUFF</p>
	</div>
	<div class="box npc-flex">
		<p>MORE NPC STUFF </p>
	</div>
</div>

<!-- PC SHEET
   ============================= -->
<div class="pc">
	<div class="grid grid-header">
		<button class="pictos" data-i18n-title="" name="act_toggle_attributes" title="player character attributes" type="action">y</button>
		<h1 data-i18n="attributes" data-i18-title="attributes" title="attributes">attributes</h1>
	</div>
	<div class="grid grid-pc-attributes">
		<!-- STRENGHT -->
		<button name="roll_strength" type="roll" value="@{gm_toggle} &{template:rolls}{{header=^{strength}}}{{base=^{attributes}}}{{dice=[[(@{strength}+(@{attribute_roll})+@{wound_toggle}+@{modifier_toggle}+@{edge_toggle})d6>5@{explode_toggle}]]}}{{mod=[[@{modifier_toggle}]]}}{{wound=[[@{wound_toggle}]]}}{{edge=[[@{edge_toggle}]]}}">
			<h2 data-i18n="strength">strength</h2>
		</button>
		<label data-i18n-title="strenght-input" title="strength input">
			<input data-i18n-placeholder="" name="attr_strength" placeholder="10" title="@{strength}" type="number" value="" />
		</label>
	</div>
	<h1 data-i18n="h1" data-i18-title="h1" title="header 1">Header 1</h1>
	<h2 data-i18n="h2" data-i18-title="h2" title="header 2">Header 2</h2>
	<h3 data-i18n="h3" data-i18-title="h3" title="header 3">Header 3</h3>
</div>

<!-- NOTES SHEET
   ============================= -->
<div class="notes">
</div>

<!-- OPTIONS SHEET
   ============================= -->
<div class="options">
</div>

<!-- FOOTER
   ============================= -->
<footer>
	<span>Version </span><span name="attr_version"></span>
</footer>

<!-- HIDDEN ATTRIBUTES
   ============================= -->
	<input name="attr_version" type="hidden" value="1" />

<!-- ROLL TEMPLATE
   ============================= -->
	<div class="rolltemplates">
		<rolltemplate class="sheet-rolltemplate-rolls">
		 	<!--- Display a header on the template --->
    		<div class="sheet-template-header">
    			{{#header}}{{header}}{{/header}}
    		</div>
    		<!--- Display the dice roll in the template --->
	    	<div class="sheet-template-body">
	    		{{#dice}}
	    			<div class="sheet-template-row">{{dice}}</div>
	    		{{/dice}}
	    		<!--- Display a description. This is great for text included with a roll --->
		    	{{#desc}}
		    		<div class="sheet-template-row">
		    			<span class="sheet-template-desc">
		    			</span>
		    		</div>
	    		{{/desc}}
	    	</div>
		</rolltemplate>
	</div>

<!-- SCRIPTS
   ============================= -->
<script type="text/worker">

const setAttributes = (update, silent) => { 
	(silent === true) ? setAttrs(update, {silent:true}) : setAttrs(update); 
};

// === ATTRIBUTE ARRAYS
	const arrays = {
		attributes: ["agility", "body", "charisma", "edge", "intuition", "logic", "strength", "willpower" ], //EXAMPLE
		repeating_settings: [],
		sheets: ["character", "npc", "notes"], //EXAMPLE. ADD MOTE SHEET TYPES here
		toggles: ["attributes"]
	};

// === SWITCH BETWEEN SHEET TYPES
    arrays["sheets"].forEach(attr => {
        on(`clicked:toggle_${attr}`, (eventinfo) => {
        	setAttributes({sheet_type: `${attr}`}, true);
        });
    });

// === TOGGLE INPUT SETTINGS
    arrays["toggles"].forEach(attr => {
        on(`clicked:toggle_${attr}`, () => {
        	getAttrs(["toggles"], (v) => {
 				let string = toggleBuilder(attr, v["toggles"]);
                setAttributes({toggles: string}, true);
        	});
        });
    });

// === UPDATE TOGGLE STRING
	const toggleBuilder = (attr, oldString) => {
        let newString = (oldString.includes(`${attr}`)) ? oldString.replace(`${attr},`, "") : `${oldString}${attr},`;
        return newString
	};

// === GM WHISPER TOGGLES
	on("clicked:whisper", (eventinfo) => {
		getAttrs(["gm_toggle"], (v) => {
			setAttributes({gm_toggle: (v.gm_toggle.includes("gm")) ?  " " : "/w gm"}, true);
		});
	});


// === SHEET VERSIONING
	on("sheet:opened", () => {
		getAttrs(["version"], (v) => { versioning(parseFloat(v.version) || 1); });
	});			

	const versioning = (version) => {
	   console.log(`%c Versioning, ${version}`, "color: blue; font-weight:bold");
	   if (version >= 1) {
			console.log(`%c Version is update to date`, "color: maroon; font-weight:bold");
	    } else {
			setAttrs({version: 1}, () => {versioning(1)});
		};
	};


</script>