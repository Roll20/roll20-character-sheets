<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main_char" />
<div style="width: 800px;">
  <button type="action" class="tab_button" id="act_main_char" name="act_main_char" data-i18n="tabs.main">
    Main
  </button>
  <button type="action" class="tab_button" id="act_equipment" name="act_equipment" data-i18n="tabs.equipment">
    Equipment/Talents
  </button>
  <button type="action" class="tab_button" id="act_spells" name="act_spells" data-i18n="tabs.spells">
    Spells
  </button>
  <button type="action" class="tab_button" id="act_vehicle" name="act_vehicle"data-i18n="tabs.vehicle">
    Vehicle
  </button>
  <button type="action" class="tab_button settings_button" id="act_settings" name="act_settings" data-i18n="tabs.settings">
    settings
  </button>

  <!-- The visible and draggable button for the macro bar -->
  <button type="roll" name="roll_genericDamage" value="@{genericDamage_action}" class="helper_button" data-i18n="buttons.damage_dice">Damage Dice</button>
  <!-- The invisible button allowing the use of custom roll parsing -->
  <button type="action" name="act_genericDamage-action" class="hidden"></button>
  <!-- The invisible field for the attribute which contains the ability call -->
  <input type="hidden" name="attr_genericDamage_action" value="">

  <!-- The visible and draggable button for the macro bar -->
  <button type="roll" name="roll_genericSkill" value="@{genericSkill_action}" class="helper_button" data-i18n="buttons.skill_check">Skill Check</button>
  <!-- The invisible button allowing the use of custom roll parsing -->
  <button type="action" name="act_genericSkill-action" class="hidden"></button>
  <!-- The invisible field for the attribute which contains the ability call -->
  <input type="hidden" name="attr_genericSkill_action" value="">
</div>

<div class="sheet-main_char">
  <section class="mc_header f-row f-center">
    <h1 data-i18n="header.title">Achtung! Cthulhu</h1>
    <span data-i18n="header.character_record_sheet">Character Record Sheet</span>
    <span data-i18n="header.system_name">2d20</span>
  </section>

  <section class="common f-row wrap">
    <div>
      <label data-i18n="character_name">Name</label>
      <input name="attr_character_name" type="text" style="width: 350px" />
    </div>
    <div>
      <label data-i18n="nationality">Nationality</label>
      <input name="attr_nationality" type="text" style="width: 200px" />
    </div>
    <div>
      <label data-i18n="rank">Rank</label>
      <input name="attr_rank" type="text" style="width: 200px" />
    </div>
    <div>
      <label data-i18n="archetype">Archetype</label>
      <input name="attr_archetype" type="text" style="width: 250px" />
    </div>
    <div>
      <label data-i18n="background">Background</label>
      <input name="attr_background" type="text" style="width: 250px" />
    </div>
    <div>
      <label data-i18n="characteristic">Characteristic</label>
      <input name="attr_characteristic" type="text" style="width: 250px" />
    </div>
    <div>
      <label data-i18n="personal_truths_scars">Personal Truths & Scars</label>
      <div class="f-row nowrap truth_text">
        <textarea name="attr_truth_1"></textarea>
        <textarea name="attr_truth_2"></textarea>
        <textarea name="attr_truth_3"></textarea>
        <textarea name="attr_truth_4"></textarea>
        <textarea name="attr_truth_5"></textarea>
      </div>
    </div>
  </section>

  <section class="stress">
    <div>
      <div class="nowrap">
        <label data-i18n="stress">Stress</label>
      </div>
      <div class="f-row nowrap">
        <span class="f1 stress_sublabel" data-i18n="stress.attributes">Attributes</span>
        <span class="f1 stress_sublabel" data-i18n="stress.bonus">Bonus</span>
        <span class="f1 stress_sublabel" data-i18n="stress.fatigue">Fatigue</span>
        <span class="f1 stress_sublabel" data-i18n="stress.total">Total</span>
      </div>
      <div class="f-row nowrap">
        <div class="f1">
          <input type="number" id="attr_stress_attributes" name="attr_stress_attributes" value="0" />+
        </div>
        <div class="f1">
          <input type="number" id="attr_stress_bonus" name="attr_stress_bonus" value="0" />-
        </div>
        <div class="f1">
          <input type="number" id="attr_stress_fatigue" name="attr_stress_fatigue" value="0" />=
        </div>
        <div class="f1">
          <input type="number" id="attr_stress_total" name="attr_stress_total" value="0" />
        </div>
      </div>
      <div class="stress_box_row">
        <input name="attr_stress_1" id="attr_stress_1" type="checkbox" />
        <input name="attr_stress_2" id="attr_stress_2" type="checkbox" />
        <input name="attr_stress_3" id="attr_stress_3" type="checkbox" />
        <input name="attr_stress_4" id="attr_stress_4" type="checkbox" />
        <input name="attr_stress_5" id="attr_stress_5" type="checkbox" />
        <input name="attr_stress_6" id="attr_stress_6" type="checkbox" />
        <input name="attr_stress_7" id="attr_stress_7" type="checkbox" />
        <input name="attr_stress_8" id="attr_stress_8" type="checkbox" />
        <input name="attr_stress_9" id="attr_stress_9" type="checkbox" />
        <input name="attr_stress_10" id="attr_stress_10" type="checkbox" />
      </div>
      <div class="stress_box_row">
        <input name="attr_stress_11" id="attr_stress_11" type="checkbox" />
        <input name="attr_stress_12" id="attr_stress_12" type="checkbox" />
        <input name="attr_stress_13" id="attr_stress_13" type="checkbox" />
        <input name="attr_stress_14" id="attr_stress_14" type="checkbox" />
        <input name="attr_stress_15" id="attr_stress_15" type="checkbox" />
        <input name="attr_stress_16" id="attr_stress_16" type="checkbox" />
        <input name="attr_stress_17" id="attr_stress_17" type="checkbox" />
        <input name="attr_stress_18" id="attr_stress_18" type="checkbox" />
        <input name="attr_stress_19" id="attr_stress_19" type="checkbox" />
        <input name="attr_stress_20" id="attr_stress_20" type="checkbox" />
      </div>
    </div>
    <div>
      <label data-i18n="languages">Languages</label>
      <textarea style="margin-top: 3px;" name="attr_languages"></textarea>
    </div>
  </section>

  <section class="soak f-col nowrap">
    <div style="display: inline-flex">
      <div>
        <label data-i18n="fortune">Fortune</label>
        <input type="number" name="attr_fortune" value="3" />
      </div>
      <div>
        <label data-i18n="exp">Exp</label>
        <input type="number" name="attr_exp" value="0" />
      </div>
    </div>
    <div style="display: inline-flex">
      <div>
        <label data-i18n="courage">Courage</label>
        <input type="number" name="attr_courage" value="0" />
      </div>
      <div>
        <label data-i18n="armour">Armour</label>
        <input type="number" name="attr_armour" value="0" />
      </div>
    </div>
  </section>

  <section class="injuries">
    <label data-i18n="injuries">Injuries</label>
    <div class="f-row nowrap">
      <textarea name="attr_injury_1"></textarea>
      <textarea name="attr_injury_2"></textarea>
      <textarea name="attr_injury_3"></textarea>
    </div>
  </section>

  <section class="attr f-row nowrap">
    <div class="f-col">
      <h3 data-i18n="attributes">Attributes</h3>
      <label data-i18n="rating">Rating</label>
      <label data-i18n="bonus_damage">Bonus Damage</label>
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="agility">Agility</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_agility" value="@{agility_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_agility-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_agility_action" value="">
      </span>
      <input type="number" id="attr_agility" name="attr_agility" value="6" min="0" max="20" />
      <input type="number" name="attr_agility_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="brawn">Brawn</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_brawn" value="@{brawn_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_brawn-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_brawn_action" value="">
      </span>
      <input type="number" id="attr_brawn" name="attr_brawn" value="6" min="0" max="20" />
      <input type="number" name="attr_brawn_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="coordination">Coordination</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_coordination" value="@{coordination_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_coordination-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_coordination_action" value="">
      </span>
      <input type="number" id="attr_coordination" name="attr_coordination" value="6" min="0" max="20" />
      <input type="number" name="attr_coordination_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="insight">Insight</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_insight" value="@{insight_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_insight-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_insight_action" value="">
      </span>
      <input type="number" id="attr_insight" name="attr_insight" value="6" min="0" max="20" />
      <input type="number" name="attr_insight_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="reason">Reason</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_reason" value="@{reason_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_reason-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_reason_action" value="">
      </span>
      <input type="number" id="attr_reason" name="attr_reason" value="6" min="0" max="20" />
      <input type="number" name="attr_reason_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label data-i18n="will">Will</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_will" value="@{will_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_will-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_will_action" value="">
      </span>
      <input type="number" id="attr_will" name="attr_will" value="6" min="0" max="20" />
      <input type="number" name="attr_will_bonus_dmg" value="0" />
    </div>
  </section>

  <section class="skills f-col">
    <div class="f-row">
      <h3 class="f2" data-i18n="skills">Skills</h3>
      <label class="f1" data-i18n="ranks">Ranks</label>
      <label class="f8" data-i18n="focuses">Focuses</label>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="academia">Academia</label>
      <input class="f1" type="number" id="attr_skill_academia" name="attr_skill_academia" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div><input name="attr_foc_art" type="checkbox" /><span data-i18n="art">Art</span></div>
        <div>
          <input name="attr_foc_cryptography" type="checkbox" /><span data-i18n="cryptography">Cryptography</span>
        </div>
        <div>
          <input name="attr_foc_finance" type="checkbox" /><span data-i18n="finance">Finance</span>
        </div>
        <div>
          <input name="attr_foc_history" type="checkbox" /><span data-i18n="history">History</span>
        </div>
        <div>
          <input name="attr_foc_linguistics" type="checkbox" /><span data-i18n="linguistics">Linguistics</span>
        </div>
        <div>
          <input name="attr_foc_occultism" type="checkbox" /><span data-i18n="occultism">Occultism</span>
        </div>
        <div>
          <input name="attr_foc_science" type="checkbox" /><span data-i18n="science">Science</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="athletics">Athletics</label>
      <input class="f1" type="number" id="attr_skill_athletics" name="attr_skill_athletics" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_climbing" type="checkbox" /><span data-i18n="climbing">Climbing</span>
        </div>
        <div>
          <input name="attr_foc_lifting" type="checkbox" /><span data-i18n="lifting">Lifting</span>
        </div>
        <div>
          <input name="attr_foc_phsyical_training" type="checkbox" /><span data-i18n="phsyical_training">Phsyical Training</span>
        </div>
        <div>
          <input name="attr_foc_running" type="checkbox" /><span data-i18n="running">Running</span>
        </div>
        <div>
          <input name="attr_foc_swimming" type="checkbox" /><span data-i18n="swimming">Swimming</span>
        </div>
        <div>
          <input name="attr_foc_throwing" type="checkbox" /><span data-i18n="throwing">Throwing</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="engineering">Engineering</label>
      <input class="f1" type="number" id="attr_skill_engineering" name="attr_skill_engineering" value="0" min="0"
        max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_architecture" type="checkbox" /><span data-i18n="architecture">Architecture</span>
        </div>
        <div>
          <input name="attr_foc_combat_engineering" type="checkbox" /><span data-i18n="combat_engineering">Combat Engineering</span>
        </div>
        <div>
          <input name="attr_foc_electronics" type="checkbox" /><span data-i18n="electronics">Electronics</span>
        </div>
        <div>
          <input name="attr_foc_explosives" type="checkbox" /><span data-i18n="explosives">Explosives</span>
        </div>
        <div>
          <input name="attr_foc_mechanical_engineering" type="checkbox" /><span data-i18n="mechanical_engineering">Mechanical Engineering</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="fighting">Fighting</label>
      <input class="f1" type="number" id="attr_skill_fighting" name="attr_skill_fighting" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_close_quarters" type="checkbox" /><span data-i18n="close_quarters">Close Quarters</span>
        </div>
        <div>
          <input name="attr_foc_handguns" type="checkbox" /><span data-i18n="handguns">Handguns</span>
        </div>
        <div>
          <input name="attr_foc_hand_to_hand" type="checkbox" /><span data-i18n="hand-to-hand">Hand-to-Hand</span>
        </div>
        <div>
          <input name="attr_foc_heavy_weapons" type="checkbox" /><span data-i18n="heavy_weapons">Heavy Weapons</span>
        </div>
        <div>
          <input name="attr_foc_melee_weapons" type="checkbox" /><span data-i18n="melee_weapons">Melee Weapons</span>
        </div>
        <div>
          <input name="attr_foc_rifles" type="checkbox" /><span data-i18n="rifles">Rifles</span>
        </div>
        <div>
          <input name="attr_foc_threat_awareness" type="checkbox" /><span data-i18n="threat_awareness">Threat Awareness</span>
        </div>
        <div>
          <input name="attr_foc_exotic" type="checkbox" /><span data-i18n="exotic">Exotic</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="medicine">Medicine</label>
      <input class="f1" type="number" id="attr_skill_medicine" name="attr_skill_medicine" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_close_first_aid" type="checkbox" /><span data-i18n="first_aid">First Aid</span>
        </div>
        <div>
          <input name="attr_foc_infectious_diseases" type="checkbox" /><span data-i18n="infectious_diseases">Infectious Diseases</span>
        </div>
        <div>
          <input name="attr_foc_pharmacology" type="checkbox" /><span data-i18n="pharmacology">Pharmacology</span>
        </div>
        <div>
          <input name="attr_foc_psychiarty" type="checkbox" /><span data-i18n="psychiarty">Psychiarty</span>
        </div>
        <div>
          <input name="attr_foc_surgey" type="checkbox" /><span data-i18n="surgey">Surgey</span>
        </div>
        <div>
          <input name="attr_foc_toxicology" type="checkbox" /><span data-i18n="toxicology">Toxicology</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="observation">Observation</label>
      <input class="f1" type="number" id="attr_skill_observation" name="attr_skill_observation" value="0" min="0"
        max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_hearing" type="checkbox" /><span data-i18n="hearing">Hearing</span>
        </div>
        <div>
          <input name="attr_foc_instincts" type="checkbox" /><span data-i18n="instincts">Instincts</span>
        </div>
        <div>
          <input name="attr_foc_sight" type="checkbox" /><span data-i18n="sight">Sight</span>
        </div>
        <div>
          <input name="attr_foc_smell_and_taste" type="checkbox" /><span data-i18n="smell_and_taste">Smell and Taste</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="persuasion">Persuasion</label>
      <input class="f1" type="number" id="attr_skill_persuasion" name="attr_skill_persuasion" value="0" min="0"
        max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_charm" type="checkbox" /><span data-i18n="charm">Charm</span>
        </div>
        <div>
          <input name="attr_foc_inneuendo" type="checkbox" /><span data-i18n="inneuendo">Inneuendo</span>
        </div>
        <div>
          <input name="attr_foc_intimidation" type="checkbox" /><span data-i18n="intimidation">Intimidation</span>
        </div>
        <div>
          <input name="attr_foc_negotiation" type="checkbox" /><span data-i18n="negotiation">Negotiation</span>
        </div>
        <div>
          <input name="attr_foc_rhetoric" type="checkbox" /><span data-i18n="rhetoric">Rhetoric</span>
        </div>
        <div>
          <input name="attr_foc_deceive" type="checkbox" /><span data-i18n="deceive">Deceive</span>
        </div>
        <div>
          <input name="attr_foc_invocation" type="checkbox" /><span data-i18n="invocation">Invocation</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="resilience">Resilience</label>
      <input class="f1" type="number" id="attr_skill_resilience" name="attr_skill_resilience" value="0" min="0"
        max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_fortitude" type="checkbox" /><span data-i18n="fortitude">Fortitude</span>
        </div>
        <div>
          <input name="attr_foc_discipline" type="checkbox" /><span data-i18n="discipline">Discipline</span>
        </div>
        <div>
          <input name="attr_foc_immunity" type="checkbox" /><span data-i18n="immunity">Immunity</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="stealth">Stealth</label>
      <input class="f1" type="number" id="attr_skill_stealth" name="attr_skill_stealth" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_camouflage" type="checkbox" /><span data-i18n="camouflage">Camouflage</span>
        </div>
        <div>
          <input name="attr_foc_disguise" type="checkbox" /><span data-i18n="disguise">Disguise</span>
        </div>
        <div>
          <input name="attr_foc_rural_stealth" type="checkbox" /><span data-i18n="rural_stealth">Rural Stealth</span>
        </div>
        <div>
          <input name="attr_foc_urban_stealth" type="checkbox" /><span data-i18n="urban_stealth">Urban Stealth</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="survival">Survival</label>
      <input class="f1" type="number" id="attr_skill_survival" name="attr_skill_survival" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_animal_handling" type="checkbox" /><span data-i18n="animal_handling">Animal Handling</span>
        </div>
        <div>
          <input name="attr_foc_foraging" type="checkbox" /><span data-i18n="foraging">Foraging</span>
        </div>
        <div>
          <input name="attr_foc_hunting" type="checkbox" /><span data-i18n="hunting">Hunting</span>
        </div>
        <div>
          <input name="attr_foc_mysticism" type="checkbox" /><span data-i18n="mysticism">Mysticism</span>
        </div>
        <div>
          <input name="attr_foc_orienteering" type="checkbox" /><span data-i18n="orienteering">Orienteering</span>
        </div>
        <div>
          <input name="attr_foc_tracking" type="checkbox" /><span data-i18n="tracking">Tracking</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="tactics">Tactics</label>
      <input class="f1" type="number" id="attr_skill_tactics" name="attr_skill_tactics" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_air_force" type="checkbox" /><span data-i18n="air_force">Air Force</span>
        </div>
        <div>
          <input name="attr_foc_army" type="checkbox" /><span data-i18n="army">Army</span>
        </div>
        <div>
          <input name="attr_foc_covert_operations" type="checkbox" /><span data-i18n="covert_operations">Covert Operations</span>
        </div>
        <div>
          <input name="attr_foc_leadership" type="checkbox" /><span data-i18n="leadership">Leadership</span>
        </div>
        <div>
          <input name="attr_foc_navy" type="checkbox" /><span data-i18n="navy">Navy</span>
        </div>
        <div>
          <input name="attr_foc_technical_projects" type="checkbox" /><span data-i18n="technical_projects">Technical Projects</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2" data-i18n="vehicles">Vehicles</label>
      <input class="f1" type="number" id="attr_skill_vehicles" name="attr_skill_vehicles" value="0" min="0" max="10" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_cars" type="checkbox" /><span data-i18n="cars">Cars</span>
        </div>
        <div>
          <input name="attr_foc_motorcycles" type="checkbox" /><span data-i18n="motorcycles">Motorcycles</span>
        </div>
        <div>
          <input name="attr_foc_heavy_vehicles" type="checkbox" /><span data-i18n="heavy_vehicles">Heavy Vehicles</span>
        </div>
        <div>
          <input name="attr_foc_tanks" type="checkbox" /><span data-i18n="tanks">Tanks</span>
        </div>
        <div>
          <input name="attr_foc_aircraft" type="checkbox" /><span data-i18n="aircraft">Aircraft</span>
        </div>
        <div>
          <input name="attr_foc_technical_watercraft" type="checkbox" /><span data-i18n="watercraft">Watercraft</span>
        </div>
      </div>
    </div>
  </section>
</div>

<div class="sheet-equipment">
  <section class="e_header f-row f-center">
    <h1 data-i18n="header.title">Achtung! Cthulhu</h1>
    <span data-i18n="header.character_record_sheet">Character Record Sheet</span>
    <span data-i18n="header.system_name">2d20</span>
  </section>

  <section class="equip f-col">
    <div class="f-row">
      <h3 data-i18n="equipment_of_note">Equipment of Note</h3>
    </div>
    <hr>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_1"></textarea>
      <textarea class="f1" name="attr_equip_desc_2"></textarea>
      <textarea class="f1" name="attr_equip_desc_3"></textarea>
      <textarea class="f1" name="attr_equip_desc_4"></textarea>
    </div>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_5"></textarea>
      <textarea class="f1" name="attr_equip_desc_6"></textarea>
      <textarea class="f1" name="attr_equip_desc_7"></textarea>
      <textarea class="f1" name="attr_equip_desc_8"></textarea>
    </div>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_9"></textarea>
      <textarea class="f1" name="attr_equip_desc_10"></textarea>
      <textarea class="f1" name="attr_equip_desc_11"></textarea>
      <textarea class="f1" name="attr_equip_desc_12"></textarea>
    </div>
  </section>

  <section class="weapons f-col">
    <div class="f-row">
      <h3 data-i18n="weapons">Weapons</h3>
    </div>
    <hr>

    <fieldset class="repeating_weapons">
      <div class="f-row weapons_row1">
        <div class="f1 weapons-chat">
          <button type="roll" name="roll_weapon" class="chat_button"
            value="@{whisper}&{template:weapon} {{title=@{character_name}}} {{name=@{weapons_name}}} {{type=@{weapons_type}}} {{focus=@{weapons_focus}}} {{range=@{weapons_range}}} {{damage=@{weapons_damage}}} {{ammo=@{weapons_ammo}}} {{salvo=@{weapons_salvo}}} {{size=@{weapons_size}}} {{qualities=@{weapons_qualities}}} {{stressDice=@{stress_dice}}}"></button>
          <!-- The visible and draggable button for the macro bar -->
          <button type="roll" name="roll_attack" value="@{attack_action}"></button>
          <!-- The invisible button allowing the use of custom roll parsing -->
          <button type="action" name="act_attack-action" class="hidden"></button>
          <!-- The invisible field for the attribute which contains the ability call -->
          <input type="hidden" name="attr_attack_action" value="">
        </div>
        <div class="f4">
          <label data-i18n="weapons.name">Name</label>
          <input name="attr_weapons_name" type="text" />
        </div>
        <div class="f3">
          <label data-i18n="weapons.type">Type</label>
          <select name="attr_weapons_type">
            <option value="None" selected></option>
            <option value="Melee" data-i18n="weapons.type.melee">Melee</option>
            <option value="Ranged" data-i18n="weapons.type.ranged">Ranged</option>
            <option value="Mental" data-i18n="weapons.type.mental">Mental</option>
          </select>
        </div>
        <div class="f3">
          <label data-i18n="weapons.focus">Focus</label>
          <select name="attr_weapons_focus">
            <option value="None" selected></option>
            <option value="Hand to Hand" data-i18n="hand-to-hand">Hand-to-Hand</option>
            <option value="Close Quarters" data-i18n="close_quarters">Close Quarters</option>
            <option value="Melee Weapons" data-i18n="melee_weapons">Melee Weapons</option>
            <option value="Handguns" data-i18n="handguns">Handguns</option>
            <option value="Rifles" data-i18n="rifles">Rifles</option>
            <option value="Heavy Weapons" data-i18n="heavy_weapons">Heavy Weapons</option>
            <option value="Exotic" data-i18n="exotic">Exotic</option>
            <option value="Throwing" data-i18n="throwing">Throwing</option>
            <option value="Occultism" data-i18n="occultism">Occultism</option>
          </select>
        </div>
        <div class="f1" style="text-align: right;">
          <span style="width:25px; height:29px;display: inline-block;">&nbsp;</span>
          <!-- The visible and draggable button for the macro bar -->
          <button type="roll" name="roll_damage" value="@{damage_action}"></button>
          <!-- The invisible button allowing the use of custom roll parsing -->
          <button type="action" name="act_damage-action" class="hidden"></button>
          <!-- The invisible field for the attribute which contains the ability call -->
          <input type="hidden" name="attr_damage_action" value="">
        </div>
        <div class="f2">
          <label data-i18n="weapons.stress">Stress</label>
          <input type="number" id="attr_stress_dice" name="attr_stress_dice" value="0" min="0" />
        </div>
        <div class="f3 stress_effects">
          <label data-i18n="weapons.stress_effects">Stress Effects</label>
          <textarea name="attr_weapons_damage"></textarea>
        </div>
      </div>
      <div class="f-row weapons_row2">
        <div class="f1">
          <label data-i18n="weapons.ammo">Ammo</label>
          <textarea name="attr_weapons_ammo"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="weapons.salvo_effects">Salvo Effects</label>
          <textarea name="attr_weapons_salvo"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="weapons.range">Range</label>
          <textarea name="attr_weapons_range"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="weapons.size">Size</label>
          <textarea name="attr_weapons_size"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="weapons.qualities">Qualities</label>
          <textarea name="attr_weapons_qualities"></textarea>
        </div>
      </div>
      <hr>
    </fieldset>
  </section>

  <section class="talents f-col">
    <div class="f-row">
      <h3 data-i18n="talents">Talents</h3>
    </div>
    <hr>

    <div class="f-row">
      <span class="f1">&nbsp;</span>
      <label class="f3" data-i18n="talents.name">Name</label>
      <label class="f3" data-i18n="talents.keywords">Keywords</label>
      <label class="f12" data-i18n="talents.effects">Effect</label>
    </div>

    <fieldset class="repeating_talents">
      <div class="f-row talent_row">
        <div class="f1 talents-chat">
          <button type="roll" name="roll_talent" class="chat_button"
            value="@{whisper}&{template:talent} {{title=@{character_name}}} {{name=@{talents_name}}} {{keywords=@{talents_keywords}}} {{effect=@{talents_effect}}}"></button>
        </div>
        <textarea class="f3" name="attr_talents_name"></textarea>
        <textarea class="f3" name="attr_talents_keywords"></textarea>
        <textarea class="f12" name="attr_talents_effect"></textarea>
      </div>
    </fieldset>
  </section>
</div>

<div class="sheet-spells">
  <section class="s_header f-row f-center">
    <h1 data-i18n="header.title">Achtung! Cthulhu</h1>
    <span data-i18n="header.character_record_sheet">Character Record Sheet</span>
    <span data-i18n="header.system_name">2d20</span>
  </section>

  <section class="magic f-col">
    <div class="f-row">
      <div class="f3">
        <label data-i18n="spellcaster_type">Spellcaster Type</label>
        <select name="attr_spell_skill">
          <option value="None" selected></option>
          <option value="Traditional" data-i18n="spellcaster_type.traditional">Traditional</option>
          <option value="Researcher" data-i18n="spellcaster_type.researcher">Researcher</option>
          <option value="Dabbler" data-i18n="spellcaster_type.dabbler">Dabbler</option>
        </select>
      </div>
      <span id="NoTradition" name="NoTradition" class="f4">&nbsp;</span>
      <div id="YesTradition" name="YesTradition" class="f4 hide_element">
        <label data-i18n="tradition">Tradition</label>
        <input name="attr_spell_tradition" type="text" style="width: 150px" />
      </div>
      <div class="f4">

        <div class="nowrap">
          <label data-i18n="power">Power</label>
        </div>
        <div class="f-row nowrap">
          <span class="f1 spells_sublabel" data-i18n="power.attributes">Attributes</span>
          <span class="f1 spells_sublabel" data-i18n="power.bonus">Bonus</span>
          <span class="f2 spells_sublabel" data-i18n="power.total">Total</span>
        </div>
        <div class="f-row nowrap">
          <div class="f1">
            <input type="number" id="attr_spells_power_attributes" name="attr_spells_power_attributes" value="0" />+
          </div>
          <div class="f1">
            <input type="number" id="attr_spells_power_bonus" name="attr_spells_power_bonus" value="0" />=
          </div>
          <div class="f2">
            <input type="number" id="attr_spells_power_total" name="attr_spells_power_total" value="0" />
            <!-- The visible and draggable button for the macro bar -->
            <button type="roll" name="roll_spell_power" value="@{spell_power_action}"></button>
            <!-- The invisible button allowing the use of custom roll parsing -->
            <button type="action" name="act_spell_power-action" class="hidden"></button>
            <!-- The invisible field for the attribute which contains the ability call -->
            <input type="hidden" name="attr_spell_power_action" value="">
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="spells f-col">
    <div class="f-row">
      <h3 data-i18n="spells">Spells</h3>
    </div>
    <hr>
    <fieldset class="repeating_spells">
      <div class="f-row spell_row1">
        <div class="f1 spells-chat">
          <button type="roll" name="roll_spell" class="chat_button"
            value="@{whisper}&{template:spell} {{title=@{character_name}}} {{name=@{spell_name}}} {{skill=@{spell_skill}}} {{difficulty=@{spell_difficulty}}} {{cost=@{spell_cost}}} {{duration=@{spell_duration}}} {{effect=@{spell_effect}}} {{momentum=@{spell_momentum}}}"></button>
          <!-- The visible and draggable button for the macro bar -->
          <button type="roll" name="roll_spell" value="@{spell_action}"></button>
          <!-- The invisible button allowing the use of custom roll parsing -->
          <button type="action" name="act_spell-action" class="hidden"></button>
          <!-- The invisible field for the attribute which contains the ability call -->
          <input type="hidden" name="attr_spell_action" value="">
        </div>
        <div class="f5">
          <label data-i18n="spells.name">Name</label>
          <input name="attr_spell_name" type="text" style="width: 150px" />
        </div>
        <div class="f4">
          <label data-i18n="spells.skill">Skill</label>
          <select name="attr_spell_skill">
            <option value="None" selected></option>
            <option value="Academia" data-i18n="academia">Academia</option>
            <option value="Athletics" data-i18n="athletics">Athletics</option>
            <option value="Engineering" data-i18n="engineering">Engineering</option>
            <option value="Fighting" data-i18n="fighting">Fighting</option>
            <option value="Medicine" data-i18n="medicine">Medicine</option>
            <option value="Observation" data-i18n="observation">Observation</option>
            <option value="Persuasion" data-i18n="persuasion">Persuasion</option>
            <option value="Resilience" data-i18n="resilience">Resilience</option>
            <option value="Stealth" data-i18n="stealth">Stealth</option>
            <option value="Survival" data-i18n="survival">Survival</option>
            <option value="Tactics" data-i18n="tactics">Tactics</option>
            <option value="Vehicles" data-i18n="vehicles">Vehicles</option>
          </select>
        </div>
        <div class="f3">
          <label data-i18n="spells.difficulty">Difficulty</label>
          <input type="number" name="attr_spell_difficulty" value="0" />
        </div>
        <div class="f2">
          <label data-i18n="spells.cost">Cost</label>
          <input type="number" name="attr_spell_cost_dice" value="0" />
        </div>
        <div class="f4">
          <label data-i18n="spells.cost_effects">Cost Effects</label>
          <input name="attr_spell_cost" type="text" style="width: 100px" />
        </div>
        <div class="f3">
          <label data-i18n="spells.duration">Duration</label>
          <input name="attr_spell_duration" type="text" style="width: 100px" />
        </div>
      </div>
      <div class="f-row spell_row2">
        <div class="f1">
          <label data-i18n="spells.effect">Effect</label>
          <textarea name="attr_spell_effect"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="spells.momentum">Momentum</label>
          <textarea name="attr_spell_momentum"></textarea>
        </div>
      </div>
      <hr>
    </fieldset>
  </section>
</div>

<div class="sheet-vehicle">
  <section class="v_header f-row f-center">
    <h1 data-i18n="header.title">Achtung! Cthulhu</h1>
    <span data-i18n="header.character_record_sheet">Character Record Sheet</span>
    <span data-i18n="header.system_name">2d20</span>
  </section>

  <section class="v_main f-row wrap">
    <div class="f-row wrap" style="width: 360px;">
      <div>
        <label data-i18n="vehicle.name">Name</label>
        <input name="attr_vehicle_name" type="text" style="width: 350px" />
      </div>
      <div>
        <label data-i18n="vehicle.scale">Scale</label>
        <input type="number" id="attr_vehicle_scale" name="attr_vehicle_scale" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.speed">Speed</label>
        <input type="number" id="attr_vehicle_speed" name="attr_vehicle_speed" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.passengers">Passengers</label>
        <input type="number" id="attr_vehicle_passengers" name="attr_vehicle_passengers" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.cover">Cover</label>
        <select name="attr_vehicle_cover" style="min-width: auto;">
          <option value="Covered">Covered</option>
          <option value="0" selected>0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <div>
      <label data-i18n="vehicle.description">Description</label>
      <textarea name="attr_vehicle_description" style="width: 400px; height: 100px;margin-top: 5px"></textarea>
    </div>
  </section>

  <section class="v_stress">
    <div>
      <div class="f-row nowrap">
        <div class="nowrap">
          <label data-i18n="vehicle.stress">Stress</label>
        </div>
        <div class="f1">
          <input type="number" id="attr_vehicle_stress" name="attr_vehicle_stress" value="0"  min="0" max="40" />
        </div>
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_stress_1" id="attr_vehicle_stress_1" type="checkbox" />
        <input name="attr_vehicle_stress_2" id="attr_vehicle_stress_2" type="checkbox" />
        <input name="attr_vehicle_stress_3" id="attr_vehicle_stress_3" type="checkbox" />
        <input name="attr_vehicle_stress_4" id="attr_vehicle_stress_4" type="checkbox" />
        <input name="attr_vehicle_stress_5" id="attr_vehicle_stress_5" type="checkbox" />
        <input name="attr_vehicle_stress_6" id="attr_vehicle_stress_6" type="checkbox" />
        <input name="attr_vehicle_stress_7" id="attr_vehicle_stress_7" type="checkbox" />
        <input name="attr_vehicle_stress_8" id="attr_vehicle_stress_8" type="checkbox" />
        <input name="attr_vehicle_stress_9" id="attr_vehicle_stress_9" type="checkbox" />
        <input name="attr_vehicle_stress_10" id="attr_vehicle_stress_10" type="checkbox" />
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_stress_11" id="attr_vehicle_stress_11" type="checkbox" />
        <input name="attr_vehicle_stress_12" id="attr_vehicle_stress_12" type="checkbox" />
        <input name="attr_vehicle_stress_13" id="attr_vehicle_stress_13" type="checkbox" />
        <input name="attr_vehicle_stress_14" id="attr_vehicle_stress_14" type="checkbox" />
        <input name="attr_vehicle_stress_15" id="attr_vehicle_stress_15" type="checkbox" />
        <input name="attr_vehicle_stress_16" id="attr_vehicle_stress_16" type="checkbox" />
        <input name="attr_vehicle_stress_17" id="attr_vehicle_stress_17" type="checkbox" />
        <input name="attr_vehicle_stress_18" id="attr_vehicle_stress_18" type="checkbox" />
        <input name="attr_vehicle_stress_19" id="attr_vehicle_stress_19" type="checkbox" />
        <input name="attr_vehicle_stress_20" id="attr_vehicle_stress_20" type="checkbox" />
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_stress_21" id="attr_vehicle_stress_21" type="checkbox" />
        <input name="attr_vehicle_stress_22" id="attr_vehicle_stress_22" type="checkbox" />
        <input name="attr_vehicle_stress_23" id="attr_vehicle_stress_23" type="checkbox" />
        <input name="attr_vehicle_stress_24" id="attr_vehicle_stress_24" type="checkbox" />
        <input name="attr_vehicle_stress_25" id="attr_vehicle_stress_25" type="checkbox" />
        <input name="attr_vehicle_stress_26" id="attr_vehicle_stress_26" type="checkbox" />
        <input name="attr_vehicle_stress_27" id="attr_vehicle_stress_27" type="checkbox" />
        <input name="attr_vehicle_stress_28" id="attr_vehicle_stress_28" type="checkbox" />
        <input name="attr_vehicle_stress_29" id="attr_vehicle_stress_29" type="checkbox" />
        <input name="attr_vehicle_stress_30" id="attr_vehicle_stress_30" type="checkbox" />
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_stress_31" id="attr_vehicle_stress_31" type="checkbox" />
        <input name="attr_vehicle_stress_32" id="attr_vehicle_stress_32" type="checkbox" />
        <input name="attr_vehicle_stress_33" id="attr_vehicle_stress_33" type="checkbox" />
        <input name="attr_vehicle_stress_34" id="attr_vehicle_stress_34" type="checkbox" />
        <input name="attr_vehicle_stress_35" id="attr_vehicle_stress_35" type="checkbox" />
        <input name="attr_vehicle_stress_36" id="attr_vehicle_stress_36" type="checkbox" />
        <input name="attr_vehicle_stress_37" id="attr_vehicle_stress_37" type="checkbox" />
        <input name="attr_vehicle_stress_38" id="attr_vehicle_stress_38" type="checkbox" />
        <input name="attr_vehicle_stress_39" id="attr_vehicle_stress_39" type="checkbox" />
        <input name="attr_vehicle_stress_40" id="attr_vehicle_stress_40" type="checkbox" />
      </div>
    </div>
  </section>

  <section class="v_injuries">
    <div>
      <div class="f-row nowrap">
        <div class="nowrap">
          <label style="padding-bottom: 5px;" data-i18n="vehicle.injuries">Injuries</label>
        </div>
        <div class="f1">
          <input type="number" id="attr_vehicle_injuries" name="attr_vehicle_injuries" value="0"  min="0" max="8" />
        </div>
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_injury_1" id="attr_vehicle_injury_1" type="checkbox" />
        <input name="attr_vehicle_injury_2" id="attr_vehicle_injury_2" type="checkbox" />
        <input name="attr_vehicle_injury_3" id="attr_vehicle_injury_3" type="checkbox" />
        <input name="attr_vehicle_injury_4" id="attr_vehicle_injury_4" type="checkbox" />
      </div>
      <div class="stress_box_row">
        <input name="attr_vehicle_injury_5" id="attr_vehicle_injury_5" type="checkbox" />
        <input name="attr_vehicle_injury_6" id="attr_vehicle_injury_6" type="checkbox" />
        <input name="attr_vehicle_injury_7" id="attr_vehicle_injury_7" type="checkbox" />
        <input name="attr_vehicle_injury_8" id="attr_vehicle_injury_8" type="checkbox" />
      </div>
      <div>
        <label data-i18n="vehicle.damage">Damage</label>
        <textarea name="attr_vehicle_damage" style="width: 115px; height: 75px;margin-top: 5px;"></textarea>
      </div>
  </div>
  </section>

  <section class="v_rolls">
    <div>
      <div>
        <label data-i18n="vehicle.armor">Armor</label>
        <input type="number" id="attr_vehicle_Armor" name="attr_vehicle_Armor" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.brawn">Brawn</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_vehiclebrawn" value="@{vehiclebrawn_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_vehiclebrawn-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_vehiclebrawn_action" value="">
        <input type="number" id="attr_vehicle_brawn" name="attr_vehicle_brawn" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.brawn_bonus">Brawn Bonus</label>
        <input type="number" id="attr_vehicle_brawn_bonus" name="attr_vehicle_brawn_bonus" value="0" min="0" max="99" />
      </div>
      <div>
        <label data-i18n="vehicle.impact">Impact</label>
        <!-- The visible and draggable button for the macro bar -->
        <button type="roll" name="roll_impact" value="@{impact_action}"></button>
        <!-- The invisible button allowing the use of custom roll parsing -->
        <button type="action" name="act_impact-action" class="hidden"></button>
        <!-- The invisible field for the attribute which contains the ability call -->
        <input type="hidden" name="attr_impact_action" value="">
        <input type="number" id="attr_vehicle_impact" name="attr_vehicle_impact" value="0" min="0" max="99" />
      </div>
    </div>
  </section>

  <section class="v_truths">
    <div>
      <div class="f-col">
        <div>
          <label data-i18n="vehicle.truths">Truths</label>
          <textarea name="attr_vehicle_truths" style="width: 150px; height: 55px;;margin-top: 5px"></textarea>
        </div>
        <div>
          <label data-i18n="vehicle.qualities">Qualities</label>
          <textarea name="attr_vehicle_qualities" style="width: 150px; height: 55px;;margin-top: 5px"></textarea>
        </div>
      </div>
    </div>
  </section>

  <section class="v_weapons f-col">
    <div class="f-row">
      <h3 data-i18n="vehicle.weapons">Weapons</h3>
    </div>
    <hr>

    <fieldset class="repeating_vehweapons">
      <div class="f-row vehicle_weapons_row1">
        <div class="f1 vehicle_weapons-chat">
          <span style="width:25px; height:29px;display: inline-block;">&nbsp;</span>
          <button type="roll" name="roll_vehicle_weapon" class="chat_button"
            value="@{whisper}&{template:weapon} {{title=@{character_name}}} {{name=@{vehicle_weapons_name}}} {{type=@{vehicle_weapons_type}}} {{focus=@{vehicle_weapons_focus}}} {{range=@{vehicle_weapons_range}}} {{damage=@{vehicle_weapons_damage}}} {{ammo=@{vehicle_weapons_ammo}}} {{salvo=@{vehicle_weapons_salvo}}} {{size=@{vehicle_weapons_size}}} {{qualities=@{vehicle_weapons_qualities}}} {{stressDice=@{vehicle_stress_dice}}}"></button>
        </div>
        <div class="f4">
          <label data-i18n="vehicle.weapons.name">Name</label>
          <input name="attr_vehicle_weapons_name" type="text" />
        </div>
        <div class="f3">
          <label data-i18n="vehicle.weapons.type">Type</label>
          <select name="attr_vehicle_weapons_type">
            <option value="Ranged" selected data-i18n="vehicle.weapons.type.ranged">Ranged</option>
          </select>
        </div>
        <div class="f3">
          <label data-i18n="vehicle.weapons.focus">Focus</label>
          <select name="attr_vehicle_weapons_focus">
            <option value="None" selected></option>
            <option value="Heavy Weapons" data-i18n="heavy_weapons">Heavy Weapons</option>
            <option value="Vehicle Weapons" data-i18n="vehicle_weapons">Vehicle Weapons</option>
          </select>
        </div>
        <div class="f1" style="text-align: right;">
          <span style="width:25px; height:29px;display: inline-block;">&nbsp;</span>
          <!-- The visible and draggable button for the macro bar -->
          <button type="roll" name="roll_vdamage" value="@{vdamage_action}"></button>
          <!-- The invisible button allowing the use of custom roll parsing -->
          <button type="action" name="act_vdamage-action" class="hidden"></button>
          <!-- The invisible field for the attribute which contains the ability call -->
          <input type="hidden" name="attr_vdamage_action" value="">
        </div>
        <div class="f2">
          <label data-i18n="vehicle.weapons.stress">Stress</label>
          <input type="number" id="attr_vehicle_stress_dice" name="attr_vehicle_stress_dice" value="0" min="0" />
        </div>
        <div class="f3 stress_effects">
          <label data-i18n="vehicle.weapons.stress_effects">Stress Effects</label>
          <textarea name="attr_vehicle_weapons_damage"></textarea>
        </div>
      </div>
      <div class="f-row vehicle_weapons_row2">
        <div class="f1">
          <label data-i18n="vehicle.weapons.ammo">Ammo</label>
          <textarea name="attr_vehicle_weapons_ammo"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="vehicle.weapons.salvo_effects">Salvo Effects</label>
          <textarea name="attr_vehicle_weapons_salvo"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="vehicle.weapons.range">Range</label>
          <textarea name="attr_vehicle_weapons_range"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="vehicle.weapons.size">Size</label>
          <textarea name="attr_vehicle_weapons_size"></textarea>
        </div>
        <div class="f1">
          <label data-i18n="vehicle.weapons.qualities">Qualities</label>
          <textarea name="attr_vehicle_weapons_qualities"></textarea>
        </div>
      </div>
      <hr>
    </fieldset>
  </section>

</div>

<div class="sheet-settings">
  <section class="st_header f-row f-center">
    <h1 data-i18n="header.title">Achtung! Cthulhu</h1>
    <span data-i18n="header.character_record_sheet">Character Record Sheet</span>
    <span data-i18n="header.system_name">2d20</span>
  </section>

  <section class="settings_left f-col">
    <div>
      <label data-i18n="type_of_sheet">Type of Sheet?</label>
      <select name="attr_sheetType">
        <option value="character" selected data-i18n="type_of_sheet.character">Character</option>
        <option value="vehicle" data-i18n="type_of_sheet.vehicle">Vehicle</option>
      </select>
    </div>
    <div>
      <label data-i18n="whisper_roles_to_GM">Whisper roles to GM?</label>
      <select name="attr_whisper">
        <option value="" selected data-i18n="whisper_roles_to_GM.never">Never</option>
        <option value="/w gm " data-i18n="whisper_roles_to_GM.always">Always</option>
      </select>
    </div>
  </section>

  <section class="settings_right f-col">
    <div>
      <label data-i18n="use_optional_increased_complication">Use optional increased complication range based on difficulty (page 22)?</label>
      <select name="attr_increasedComplication">
        <option value="Y" selected data-i18n="use_optional_increased_complication.yes">Yes</option>
        <option value="N" data-i18n="use_optional_increased_complication.no">No</option>
      </select>
    </div>
  </section>
</div>


<span style="display: none" data-i18n="roll.ask-dice">Dice</span>
<span style="display: none" data-i18n="roll.ask-relevant_skill">Relevant Skill</span>
<span style="display: none" data-i18n="roll.ask-does_focus_apply">Does A Focus Apply</span>
<span style="display: none" data-i18n="roll.ask-difficulty">Difficulty</span>
<span style="display: none" data-i18n="roll.ask-weapon_type">Weapon Type</span>
<span style="display: none" data-i18n="roll.ask-spellcaster_type">Spellcaster Type</span>
<span style="display: none" data-i18n="roll.ask-relevant_attribute">Relevant Attribute</span>
<span style="display: none" data-i18n="roll.ask-driver_skill">Relevant skill value from Driver</span>

<!-- roll templates -->
<rolltemplate class="sheet-rolltemplate-skill">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
      {{#description}}
      <div class="sheet-description">{{description}}</div>
      {{/description}}
    </div>
    <div class="sheet-result">
      {{#rollTotal() computed::outcome 1}}
      <div class="sheet-success" data-i18n="skill.roll.sucess">Success!</div>
      {{/rollTotal() computed::outcome 1}}
      {{#rollTotal() computed::outcome 0}}
      <div class="sheet-failure" data-i18n="skill.roll.failure">Failure!</div>
      {{/rollTotal() computed::outcome 0}}
    </div>
    <div class="sheet-content">
      <span data-i18n="skill.roll.dice_rolled">Dice rolled:</span>
      <span class="sheet-roll-bold-highlight">{{computed::roll1}}</span>
      <span data-i18n="skill.roll.number_of_suecesses">Number of successes:</span>
      <span class="sheet-roll-bold">{{computed::successes}}</span>
      <span data-i18n="skill.roll.bonus_momentum">Bonus momentum:</span>
      <span class="sheet-roll-bold">{{computed::bonus_momentum}}</span>
      <span data-i18n="skill.roll.number_of_complications">Number of complications:</span>
      <span class="sheet-roll-bold">{{computed::complications}}</span>
    </div>
    <div class="sheet-show-details" data-i18n="skill.roll.show_details">
      Show Details
    </div>
    <div class="sheet-details-wrapper">
      <div class="sheet-details">
        <span class="sheet-roll-normal-nopad"><x>{{computed::attribute_text}}</x><x data-i18n="skill.roll.attribute_value_is"> value is:</x></span>
        <span class="sheet-roll-normal">{{computed::target_attribute}}</span>
        <span class="sheet-roll-normal-nopad"><x>{{computed::skill_text}}</x><x data-i18n="skill.roll.skill_value_is"> value is:</x></span>
        <span class="sheet-roll-normal">{{computed::target_skill}}</span>
        <span data-i18n="skill.roll.target_number_is">Target number is:</span>
        <span class="sheet-roll-normal">{{computed::target_number}}</span>
        {{#rollTotal() computed::focus_apply 0}}
        <span data-i18n="skill.roll.does_focus_apply">Does a focus apply:</span>
        <span class="sheet-roll-normal" data-i18n="skill.roll.does_focus_apply_no">No</span>
        {{/rollTotal() computed::focus_apply 0}}
        {{#rollTotal() computed::focus_apply 1}}
        <span data-i18n="skill.roll.does_focus_apply">Does a focus apply:</span>
        <span class="sheet-roll-normal" data-i18n="skill.roll.does_focus_apply_yes">Yes</span>
        {{/rollTotal() computed::focus_apply 1}}
        <span data-i18n="skill.roll.difficulty_is">Difficulty is:</span>
        <span class="sheet-roll-normal">{{computed::difficulty}}</span>
        <span data-i18n="skill.roll.crit_range_is">Crit range is:</span>
        <span class="sheet-roll-normal">{{computed::crit_range}}</span>
        <span data-i18n="skill.roll.normal_success_is">Normal success is:</span>
        <span class="sheet-roll-normal">{{computed::success_range}}</span>
        <span data-i18n="skill.roll.complication_range">Complication range is:</span>
        <span class="sheet-roll-normal">{{computed::complication_range}}</span>
        {{#show_auto_success}}
        <span data-i18n="skill.roll.automatic_successes">Automatic successes:</span>
        <span class="sheet-roll-normal">{{computed::auto_success}}</span>
        {{/show_auto_success}}
        <span data-i18n="skill.roll.dice_rolled">Dice rolled:</span>
        <span class="sheet-roll-normal">{{computed::dice_text}}</span>
      </div>
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
      {{#description}}
      <div class="sheet-description">{{description}}</div>
      {{/description}}
    </div>
    <div class="sheet-content">
      <span data-i18n="damage.roll.dice_rolled">Dice rolled:</span>
      <span class="sheet-roll-bold-highlight">{{computed::roll1}}</span>
      <span data-i18n="damage.number_of_stress">Number of stress:</span>
      <span class="sheet-roll-bold">{{computed::total_stress}}</span>
      <span data-i18n="damage.number_of_effects">Number of effects:</span>
      <span class="sheet-roll-bold">{{computed::total_effects}}</span>
      {{#stress_effects}}
      <span data-i18n="damage.roll.stress_effects">Stress effects:</span>
      <span>{{stress_effects}}</span>
      {{/stress_effects}}
      {{#salvo_effects}}
      <span data-i18n="damage.roll.salvo_effects">Salvo effects:</span>
      <span>{{salvo_effects}}</span>
      {{/salvo_effects}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-talent">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#keywords}}
      <div class="sheet-keywords">{{keywords}}</div>
      {{/keywords}}
    </div>
    <div class="sheet-content">
      <div>{{effect}}</div>
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-spell">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
    </div>
    <div class="sheet-content">
      {{#skill}}
      <span data-i18n="spell.share.skill">Skill:</span>
      <span>{{skill}}</span>
      {{/skill}}
      {{#difficulty}}
      <span data-i18n="spell.share.difficulty">Difficulty:</span>
      <span>{{difficulty}}</span>
      {{/difficulty}}
      {{#cost}}
      <span data-i18n="spell.share.cost">Cost:</span>
      <span>{{cost}}</span>
      {{/cost}}
      {{#duration}}
      <span data-i18n="spell.share.duration">Duration:</span>
      <span>{{duration}}</span>
      {{/duration}}
    </div>
    <div class="sheet-content2">
      {{#effect}}
      <span data-i18n="spell.share.effect">Effect:</span>
      <span>{{effect}}</span>
      {{/effect}}
      {{#momentum}}
      <span data-i18n="spell.share.momentum">Momentum:</span>
      <span>{{momentum}}</span>
      {{/momentum}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-weapon">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#type}}
      <div class="sheet-name">{{type}}</div>
      {{/type}}
      {{#focus}}
      <div class="sheet-name">{{focus}}</div>
      {{/focus}}
    </div>
    <div class="sheet-content">
      {{#stressDice}}
      <span data-i18n="weapon.share.stress_dice">Stress Dice:</span>
      <span>{{stressDice}}</span>
      {{/stressDice}}
      {{#damage}}
      <span data-i18n="weapon.share.stress_effects">Stress Effects:</span>
      <span>{{damage}}</span>
      {{/damage}}
      {{#ammo}}
      <span data-i18n="weapon.share.ammo">Ammo:</span>
      <span>{{ammo}}</span>
      {{/ammo}}
      {{#salvo}}
      <span data-i18n="weapon.share.salvo_effects">Salvo Effects:</span>
      <span>{{salvo}}</span>
      {{/salvo}}
      {{#range}}
      <span data-i18n="weapon.share.range">Range:</span>
      <span>{{range}}</span>
      {{/range}}
      {{#size}}
      <span data-i18n="weapon.share.size">Size:</span>
      <span>{{size}}</span>
      {{/size}}
      {{#qualities}}
      <span data-i18n="weapon.share.qualities">Qualities:</span>
      <span>{{qualities}}</span>
      {{/qualities}}
    </div>
  </div>
</rolltemplate>

<!-- scripts -->

<script type="text/worker">

  const stats = ["agility", "brawn", "coordination", "insight", "reason", "will"];
  const skills = ["skill_academia", "skill_athletics", "skill_engineering", "skill_fighting", "skill_medicine", "skill_observation", "skill_persuasion", "skill_resilience", "skill_stealth", "skill_survival", "skill_tactics", "skill_vehicles"];
  const int = score => parseInt(score, 10) || 0;

  const hideShowSpellTradition = () => {
    getAttrs(["spell_skill"], function(values) {
      $20("#NoTradition").removeClass("show_element").addClass("hide_element");
      $20("#YesTradition").removeClass("show_element").addClass("hide_element");;

      if (values.spell_skill == "Traditional")
        $20("#YesTradition").removeClass("hide_element").addClass("show_element");
      else
        $20("#NoTradition").removeClass("hide_element").addClass("show_element");
  
    });
  };

  const calcualteStressValues = () => {
    getAttrs(["brawn","will","skill_resilience","stress_bonus","stress_fatigue"], function(values) {
      let brawn = int(values.brawn);
      let will = int(values.will);
      let resilience = int(values.skill_resilience);
      let bonus = int(values.stress_bonus);
      let fatigue = int(values.stress_fatigue);
      let stress_brawn = brawn + resilience;
      let stress_will = will + resilience;
      let stress_attributes = stress_brawn >= stress_will ? stress_brawn: stress_will;
      let stress_total = stress_attributes + bonus - fatigue;
      setAttrs({                            
        "stress_attributes": stress_attributes,
        "stress_total": stress_total
      });

      for (let i = 1; i < 21; i++) {
        $20("#attr_stress_" + i).removeClass("disableStressBox");
        if (i > stress_total)
          $20("#attr_stress_" + i).addClass("disableStressBox");
      }
    });
  };
  
  const calcualteSpellPower = () => {
    getAttrs(["reason_bonus_dmg","will_bonus_dmg","insight_bonus_dmg","spell_skill", "spells_power_bonus"], function(values) {

      let spellSkill = values.spell_skill || '';
      let spellBonus = int(values.spells_power_bonus);
      let reasonBonus = int(values.reason_bonus_dmg);
      let willBonus = int(values.will_bonus_dmg);
      let insightBonus = int(values.insight_bonus_dmg);
      let attributePower = 0;
      let totalPower = 0;

      switch(spellSkill) {
        case "Traditional":
          attributePower = 2 + insightBonus;
          break;
        case "Researcher":
          attributePower = 2 + reasonBonus;
          break;
        case "Dabbler":
          attributePower = 1 + willBonus;
          break;
        default:
          attributePower += 0;
          break;
      }
      totalPower = attributePower + spellBonus;

      setAttrs({                            
        "spells_power_attributes": attributePower,
        "spells_power_total": totalPower
      });
    });
  };

  const setAttributesBounds = (attributeValue,attribute) => {
    $20(`#attr_${attribute}`).removeClass('attributeOutOfBounds');
    if ((attributeValue > 12) || (attributeValue < 6))
      $20(`#attr_${attribute}`).addClass('attributeOutOfBounds');
  };

  const checkAttributesBounds = () => {
    stats.forEach(stat => {
      getAttrs([stat], values => {
        let attributeValue = int(values[stat]);
        setAttributesBounds(attributeValue,stat);
      });
    });
  };

  const setSkillsBounds = (skillValue,skill) => {
    $20(`#attr_${skill}`).removeClass('attributeOutOfBounds');
    if (skillValue > 5)
      $20(`#attr_${skill}`).addClass('attributeOutOfBounds');
  };

  const checkSkillsBounds = () => {
    skills.forEach(skill => {
      getAttrs([skill], values => {
        let skillValue = int(values[skill]);
        setSkillsBounds(skillValue,skill);
      });
    });
  };

  const changeCharacterName = () => {
    getAttrs(["character_name"], function(values) {
      const newName = values.character_name;
      setAttrs({
        vehicle_name: newName
      });
    });
  };
  
  const changeVehicleName = () => {
    getAttrs(["vehicle_name"], function(values) {
      const newName = values.vehicle_name;
      setAttrs({
        character_name: newName
      });
    });
  };
  
  const updateVehicleStressBoxes = () => {
    getAttrs(["vehicle_stress",], function(values) {
      let vehStress = int(values.vehicle_stress);

      for (let i = 1; i < 41; i++) {
        $20("#attr_vehicle_stress_" + i).removeClass("disableStressBox");
        if (i > vehStress)
        {
          $20("#attr_vehicle_stress_" + i).addClass("disableStressBox");
        }
      }
    });
  };

  const updateVehicleInjuryBoxes = () => {
    getAttrs(["vehicle_injuries",], function(values) {
      let vehStress = int(values.vehicle_injuries);

      for (let i = 1; i < 9; i++) {
        $20("#attr_vehicle_injury_" + i).removeClass("disableStressBox");
        if (i > vehStress)
        {
          $20("#attr_vehicle_injury_" + i).addClass("disableStressBox");
        }
      }
    });
  };


  <!-- Add on change or onclick events -->

  on("change:spell_skill", function() {  
    hideShowSpellTradition();
  });

  const buttonlist = ["main_char","equipment","spells","vehicle","settings"];
  buttonlist.forEach(button => {
      on(`clicked:${button}`, function() {
      $20(".tab_button_selected").removeClass('tab_button_selected');
      $20("#act_" + button).addClass('tab_button_selected');
      setAttrs({
        sheetTab: button
      });
    });
  });

  stats.forEach(stat => {
    on(`change:${stat}`, () => {
      getAttrs([stat], values => {
        const stat_base = int(values[stat]);
        let stat_mod = 0;
        if (stat_base >= 16) stat_mod = 5;
        else if (stat_base >= 14) stat_mod = 4;
        else if (stat_base >= 12) stat_mod = 3;
        else if (stat_base >= 10) stat_mod = 2;
        else if (stat_base >= 9) stat_mod = 1;
        
        setAttrs({
            [`${stat}_bonus_dmg`]: stat_mod
        });

        setAttributesBounds(stat_base,stat);
      });
    });
  });

  skills.forEach(skill => {
    on(`change:${skill}`, () => {
      getAttrs([skill], values => {
        const stat_base = int(values[skill]);
        setSkillsBounds(stat_base,skill);
      });
    });
  });

  on("change:brawn change:will change:skill_resilience change:stress_bonus change:stress_fatigue", function() {  
    calcualteStressValues();
  });

  on("change:reason_bonus_dmg change:insight_bonus_dmg change:will_bonus_dmg change:spell_skill change:spells_power_bonus", function() {  
    calcualteSpellPower();
  });

  on('change:vehicle_name',changeVehicleName);

  on('change:character_name',changeCharacterName);

  on('change:vehicle_stress',updateVehicleStressBoxes);

  on('change:vehicle_injuries',updateVehicleInjuryBoxes);


  <!-- Custom Roll Parsing -->

// abilities
  stats.forEach(button => {
    on(`clicked:${button}-action`, () => {
      getAttrs([...skills,'increasedComplication'], async function(values) {

        const academiaText = getTranslationByKey("academia") || "Academia";
        const athleticsText = getTranslationByKey("athletics") || "Athletics";
        const engineeringText = getTranslationByKey("engineering") || "Engineering";
        const fightingText = getTranslationByKey("fighting") || "Fighting";
        const medicineText = getTranslationByKey("medicine") || "Medicine";
        const observationText = getTranslationByKey("observation") || "Observation";
        const persuasionText = getTranslationByKey("persuasion") || "Persuasion";
        const resilienceText = getTranslationByKey("resilience") || "Resilience";
        const stealthText = getTranslationByKey("stealth") || "Stealth";
        const survivalText = getTranslationByKey("survival") || "Survival";
        const tacticsText = getTranslationByKey("tactics") || "Tactics";
        const vehiclesText = getTranslationByKey("vehicles") || "Vehicles";

        const agilityText = getTranslationByKey("agility") || "Agility";
        const brawnText = getTranslationByKey("brawn") || "Brawn";
        const coordinationText = getTranslationByKey("coordination") || "Coordination";
        const insightText = getTranslationByKey("insight") || "Insight";
        const reasonText = getTranslationByKey("reason") || "Reason";
        const willText = getTranslationByKey("will") || "Will";

        let target_attribute_text = `${button}`;

        switch(target_attribute_text) {
          case "agility":
            target_attribute_text = agilityText;
            break;
          case "brawn":
            target_attribute_text = brawnText;
            break;
          case "coordination":
            target_attribute_text = coordinationText;
            break;
          case "insight":
            target_attribute_text = insightText;
            break;
          case "reason":
            target_attribute_text = reasonText;
            break;
          case "will":
            target_attribute_text = willText;
            break;
          default:
            target_attribute_text = `${button}`;
            break;
        }

        const results = await startRoll(`@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${target_attribute_text}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{target_skill=[[?{@{skillMacro}|None,0|${academiaText},1|${athleticsText},2|${engineeringText},3|${fightingText},4|${medicineText},5|${observationText},6|${persuasionText},7|${resilienceText},8|${stealthText},9|${survivalText},10|${tacticsText},11|${vehiclesText},12}]]}} {{focus_apply=[[?{@{focusMacro}|No,0|Yes,1}]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[@{${button}}]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`);

        const target_skill = results.results.target_skill.result; //int select value 
        let target_skill_text = ""; //string of skill
        let skill_value = 0; //numeric skill value
    
        switch(target_skill) {
          case 1:
            skill_value = int(values.skill_academia);
            target_skill_text = academiaText;
            break;
          case 2:
            skill_value = int(values.skill_athletics);
            target_skill_text = athleticsText;
            break;
          case 3:
            skill_value = int(values.skill_engineering);
            target_skill_text = engineeringText;
            break;
          case 4:
            skill_value = int(values.skill_fighting);
            target_skill_text = fightingText;
            break;
          case 5:
            skill_value = int(values.skill_medicine);
            target_skill_text = medicineText;
            break;
          case 6:
            skill_value = int(values.skill_observation);
            target_skill_text = observationText;
            break;
          case 7:
            skill_value = int(values.skill_persuasion);
            target_skill_text = persuasionText;
            break;
          case 8:
            skill_value = int(values.skill_resilience);
            target_skill_text = resilienceText;
            break;
          case 9:
            skill_value = int(values.skill_stealth);
            target_skill_text = stealthText;
            break;
          case 10:
            skill_value = int(values.skill_survival);
            target_skill_text = survivalText;
            break;
          case 11:
            skill_value = int(values.skill_tactics);
            target_skill_text = tacticsText;
            break;
          case 12:
            skill_value = int(values.skill_vehicles);
            target_skill_text = vehiclesText;
            break;
          default:
            skill_value = 0;
            target_skill_text = "None";
            break;
        }

        const number_dice = results.results.num_dice.result;
        const difficulty = results.results.difficulty.result;
        const target_attribute = results.results.target_attribute.result;
        const focus_apply = results.results.focus_apply.result;
        const focus_target = focus_apply == 1 ? skill_value : 1;
  
        let target_number = target_attribute + skill_value;

        let optionalComplication = values.increasedComplication === 'N' ? 'N' : 'Y';
        let complication_range = 21 - difficulty;
        if (optionalComplication === 'N') {
          complication_range = 20;
        }
        const complication_range_text = `${complication_range} - 20`;
  
        const dice = results.results.roll1.dice;
        let successCount = dice.filter(d => d <= target_number).length;
        successCount += dice.filter(d => d <= focus_target).length;
        let complicationCount = dice.filter(d => d >= complication_range).length;

        const success_range_text = `${focus_target + 1} - ${target_number}`;
        const crit_range_text = `1 - ${focus_target}`;

        let bonus_momentum = successCount - difficulty;
        bonus_momentum = bonus_momentum < 0 ? 0 : bonus_momentum;
        let outcome = successCount >= difficulty ? 1 : 0;

        const dice_text = results.results.roll1.dice.toString();
  
        finishRoll(
          results.rollId,
          {
            roll1: number_dice,
            successes: successCount,
            complications: complicationCount,
            target_number: target_number,
            target_attribute: target_attribute,
            target_skill: skill_value,
            skill_text: target_skill_text,
            attribute_text: target_attribute_text,
            difficulty: difficulty,
            complication_range: complication_range_text,
            success_range: success_range_text,
            crit_range: crit_range_text,
            bonus_momentum: bonus_momentum,
            outcome: outcome,
            dice_text: dice_text,
            focus_apply: focus_apply
          }
        );      
      });
    });
  });

// attacks
  const attackSkills = ["repeating_weapons_weapons_type", "repeating_weapons_weapons_focus", "repeating_weapons_weapons_name", "agility", "coordination", "will", "skill_fighting", "skill_academia", "foc_close_quarters", "foc_handguns", "foc_hand_to_hand", "foc_heavy_weapons", "foc_melee_weapons", "foc_rifles", "foc_exotic", "foc_throwing", "foc_occultism","increasedComplication"];
  on("clicked:repeating_weapons:attack-action", function () {
    getAttrs(attackSkills, async function(values) {
      let weaponType = values.repeating_weapons_weapons_type || "";
      let weaponFocus = values.repeating_weapons_weapons_focus || "";
      const subTitle = ((weaponType == "None" || weaponType == "") ? 'Attack' : `${weaponType} - Attack`);
      const description = values.repeating_weapons_weapons_name || "";

      const meleeText = getTranslationByKey("weapons.type.melee") || "Melee";
      const rangedText = getTranslationByKey("weapons.type.ranged") || "Ranged";
      const mentalText = getTranslationByKey("weapons.type.mental") || "Mental";

      const academiaText = getTranslationByKey("academia") || "Academia";
      const fightingText = getTranslationByKey("fighting") || "Fighting";

      const agilityText = getTranslationByKey("agility") || "Agility";
      const brawnText = getTranslationByKey("brawn") || "Brawn";
      const coordinationText = getTranslationByKey("coordination") || "Coordination";
      const insightText = getTranslationByKey("insight") || "Insight";
      const reasonText = getTranslationByKey("reason") || "Reason";
      const willText = getTranslationByKey("will") || "Will";

      let rollString = "";
      if ((weaponType == "None" || weaponType == "") && (weaponFocus == "None" || weaponFocus == "")) {
        //neither selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{weapon_type=[[?{@{weaponTypeMacro}|${meleeText},0|${rangedText},1|${mentalText},2}]]}} {{target_skill=[[0]]}} {{focus_apply=[[?{@{focusMacro}|No,0|Yes,1}]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else if (weaponType == "None" || weaponType == "") {
        //type not selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{weapon_type=[[?{@{weaponTypeMacro}|${meleeText},0|${rangedText},1|${mentalText},2}]]}} {{target_skill=[[0]]}} {{focus_apply=[[0]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else if (weaponFocus == "None" || weaponFocus == "") {
        // focus not selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{weapon_type=[[0}]]}} {{target_skill=[[0]]}} {{focus_apply=[[?{@{focusMacro}|No,0|Yes,1}]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else {
        //both selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{weapon_type=[[0}]]}} {{target_skill=[[0]]}} {{focus_apply=[[0]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      }

      const results = await startRoll(rollString);

      weaponType = ((weaponType == "None" || weaponType == "") ? results.results.weapon_type.result : weaponType);
      let target_attribute_text = "";
      let attribute_value = 0;
      let target_skill_text = ""; //string of skill
      let skill_value = 0; //numeric skill value

      switch(weaponType) {
        case "Melee":
        case 0:
          attribute_value = int(values.agility);
          target_attribute_text = agilityText;
          target_skill_text = fightingText; //string of skill
          skill_value = int(values.skill_fighting); //numeric skill value
          break;
        case "Ranged":
        case 1:
          attribute_value = int(values.coordination);
          target_attribute_text = coordinationText;
          target_skill_text = fightingText; //string of skill
          skill_value = int(values.skill_fighting); //numeric skill value
              break;
        case "Mental":
        case 2:
          attribute_value = int(values.will);
          target_attribute_text = willText;
          target_skill_text = academiaText; //string of skill
          skill_value = int(values.skill_academia); //numeric skill value
              break;
        default:
          attribute_value = int(values.agility);
          target_attribute_text = agilityText;
          target_skill_text = fightingText; //string of skill
          skill_value = int(values.skill_fighting); //numeric skill value
          break;
      }

      const number_dice = results.results.num_dice.result;
      const difficulty = results.results.difficulty.result;
      let focus_apply = results.results.focus_apply.result;

      if ((weaponFocus != "None" && weaponFocus != "")) {

        switch(weaponFocus) {
          case "Hand to Hand":
            focus_apply = (values.foc_hand_to_hand == "on" ? 1 : 0);
            break;
          case "Close Quarters":
            focus_apply = (values.foc_close_quarters == "on" ? 1 : 0);
            break;
          case "Melee Weapons":
            focus_apply = (values.foc_melee_weapons == "on" ? 1 : 0);
            break;
          case "Handguns":
            focus_apply = (values.foc_handguns == "on" ? 1 : 0);
            break;
          case "Rifles":
            focus_apply = (values.foc_rifles == "on" ? 1 : 0);
            break;
          case "Heavy Weapons":
            focus_apply = (values.foc_heavy_weapons == "on" ? 1 : 0);
            break;
          case "Exotic":
            focus_apply = (values.foc_exotic == "on" ? 1 : 0);
            break;
          case "Throwing":
            focus_apply = (values.foc_throwing == "on" ? 1 : 0);
            break;
          case "Occultism":
            focus_apply = (values.foc_occultism == "on" ? 1 : 0);
            break;
          default:
            focus_apply = (values.foc_hand_to_hand == "on" ? 1 : 0);
            break;
        }
      }

      const focus_target = focus_apply == 1 ? skill_value : 1;

      let target_number = attribute_value + skill_value;

      let optionalComplication = values.increasedComplication === 'N' ? 'N' : 'Y';
      let complication_range = 21 - difficulty;
      if (optionalComplication === 'N') {
        complication_range = 20;
      }
      const complication_range_text = `${complication_range} - 20`;

      const dice = results.results.roll1.dice;
      let successCount = dice.filter(d => d <= target_number).length;
      successCount += dice.filter(d => d <= focus_target).length;
      let complicationCount = dice.filter(d => d >= complication_range).length;

      const success_range_text = `${focus_target + 1} - ${target_number}`;
      const crit_range_text = `1 - ${focus_target}`;

      target_attribute_text = target_attribute_text[0].toUpperCase() + target_attribute_text.slice(1);

      let bonus_momentum = successCount - difficulty;
      bonus_momentum = bonus_momentum < 0 ? 0 : bonus_momentum;
      let outcome = successCount >= difficulty ? 1 : 0;

      const dice_text = results.results.roll1.dice.toString();

      finishRoll(
        results.rollId,
        {
          roll1: number_dice,
          successes: successCount,
          complications: complicationCount,
          target_number: target_number,
          target_attribute: attribute_value,
          target_skill: skill_value,
          skill_text: target_skill_text,
          attribute_text: target_attribute_text,
          difficulty: difficulty,
          complication_range: complication_range_text,
          success_range: success_range_text,
          crit_range: crit_range_text,
          bonus_momentum: bonus_momentum,
          outcome: outcome,
          dice_text: dice_text,
          focus_apply: focus_apply
        }
      );      
    });
  });

  // cast spell
  const spellSkills = ["spell_skill", "repeating_spells_spell_name", "repeating_spells_spell_skill", "repeating_spells_spell_difficulty", "reason", "insight", "will", "foc_occultism", "foc_instincts", "foc_invocation", "foc_discipline", "foc_mysticism"];
  on("clicked:repeating_spells:spell-action", function () {
    getAttrs([...skills,...spellSkills], async function(values) {

      let casterType = values.spell_skill || "";
      let spellSkill = values.repeating_spells_spell_skill || "";
      const subTitle = 'Spell Cast';
      const description = values.repeating_spells_spell_name || "";
      const defaultDifficulty = int(values.repeating_spells_spell_difficulty);

      const academiaText = getTranslationByKey("academia") || "Academia";
      const athleticsText = getTranslationByKey("athletics") || "Athletics";
      const engineeringText = getTranslationByKey("engineering") || "Engineering";
      const fightingText = getTranslationByKey("fighting") || "Fighting";
      const medicineText = getTranslationByKey("medicine") || "Medicine";
      const observationText = getTranslationByKey("observation") || "Observation";
      const persuasionText = getTranslationByKey("persuasion") || "Persuasion";
      const resilienceText = getTranslationByKey("resilience") || "Resilience";
      const stealthText = getTranslationByKey("stealth") || "Stealth";
      const survivalText = getTranslationByKey("survival") || "Survival";
      const tacticsText = getTranslationByKey("tactics") || "Tactics";
      const vehiclesText = getTranslationByKey("vehicles") || "Vehicles";

      const agilityText = getTranslationByKey("agility") || "Agility";
      const brawnText = getTranslationByKey("brawn") || "Brawn";
      const coordinationText = getTranslationByKey("coordination") || "Coordination";
      const insightText = getTranslationByKey("insight") || "Insight";
      const reasonText = getTranslationByKey("reason") || "Reason";
      const willText = getTranslationByKey("will") || "Will";

      const traditionalText = getTranslationByKey("spellcaster_type.traditional") || "Traditional";
      const researcherText = getTranslationByKey("spellcaster_type.researcher") || "Researcher";
      const dabblerText = getTranslationByKey("spellcaster_type.dabbler") || "Dabbler";

      const focusText = getTranslationByKey("roll.ask-does_focus_apply") || "Does A Focus Apply";

      let focus_apply = 0;
      let focusString = '[[?{' + focusText + '|No,0|Yes,1}]]'

      switch(spellSkill) {
        case "Academia":
          focus_apply = (values.foc_occultism == "on" ? 1 : 0);
          break;
        case "Observation":
          focus_apply = (values.foc_instincts == "on" ? 1 : 0);
          break;
        case "Persuasion":
          focus_apply = (values.foc_invocation == "on" ? 1 : 0);
          break;
        case "Resilience":
          focus_apply = (values.foc_discipline == "on" ? 1 : 0);
          break;
        case "Survival":
          focus_apply = (values.foc_mysticism == "on" ? 1 : 0);
          break;
        default:
          focus_apply = 0;
          break;
      }

      if (focus_apply == 1) {
        focusString = '[[?{' + focusText + '|Yes,1|No,0}]]'
      }

      let rollString = "";

      if ((spellSkill == "None" || spellSkill == "") && (casterType == "None" || casterType == "")) {
        //neither selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{spellcaster_type=[[?{@{casterTypeMacro}|${traditionalText},0|${researcherText},1|${dabblerText},2}]]}} {{target_skill=[[?{@{skillMacro}|None,0|${academiaText},1|${athleticsText},2|${engineeringText},3|${fightingText},4|${medicineText},5|${observationText},6|${persuasionText},7|${resilienceText},8|${stealthText},9|${survivalText},10|${tacticsText},11|${vehiclesText},12}]]}} {{focus_apply=${focusString}}} {{difficulty=[[?{@{difficultyMacro}|${defaultDifficulty}}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else if (casterType == "None" || casterType == "") {
        //caster type not selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{spellcaster_type=[[?{@{casterTypeMacro}|${traditionalText},0|${researcherText},1|${dabblerText},2}]]}} {{target_skill=[[0]]}} {{focus_apply=${focusString}}} {{difficulty=[[?{@{difficultyMacro}|${defaultDifficulty}}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else if (spellSkill == "None" || spellSkill == "") {
        // spell skill not selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{spellcaster_type=[[0}]]}} {{target_skill=[[?{@{skillMacro}|None,0|${academiaText},1|${athleticsText},2|${engineeringText},3|${fightingText},4|${medicineText},5|${observationText},6|${persuasionText},7|${resilienceText},8|${stealthText},9|${survivalText},10|${tacticsText},11|${vehiclesText},12}]]}} {{focus_apply=${focusString}}} {{difficulty=[[?{@{difficultyMacro}|${defaultDifficulty}}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      } else {
        //both selected
        rollString = `@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{spellcaster_type=[[0}]]}} {{target_skill=[[0]]}} {{focus_apply=${focusString}}} {{difficulty=[[?{@{difficultyMacro}|${defaultDifficulty}}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`;
      }

      const results = await startRoll(rollString);

      casterType = ((casterType == "None" || casterType == "") ? results.results.spellcaster_type.result : casterType);
      let target_attribute_text = "";
      let attribute_value = 0;
      let target_skill_text = ""; //string of skill
      let skill_value = 0; //numeric skill value

      switch(casterType) {
        case "Traditional":
        case 0:
          attribute_value = int(values.insight);
          target_attribute_text = insightText;
          break;
        case "Researcher":
        case 1:
          attribute_value = int(values.reason);
          target_attribute_text = reasonText;
          break;
        case "Dabbler":
        case 2:
          attribute_value = int(values.will);
          target_attribute_text = willText;
          break;
        default:
          attribute_value = int(values.reason);
          target_attribute_text = reasonText;
        break;
      }

      spellSkill = ((spellSkill == "None" || spellSkill == "") ? results.results.target_skill.result : spellSkill);
      switch(spellSkill) {
        case "None":
        case 0:
          target_skill_text = "None"; //string of skill
          skill_value = 0; //numeric skill value
          break;
        case "Academia":
        case 1:
          target_skill_text = academiaText; //string of skill
          skill_value = int(values.skill_academia); //numeric skill value
          break;
        case "Athletics":
        case 2:
          target_skill_text = athleticsText; //string of skill
          skill_value = int(values.skill_athletics); //numeric skill value
          break;
        case "Engineering":
        case 3:
          target_skill_text = engineeringText; //string of skill
          skill_value = int(values.skill_engineering); //numeric skill value
          break;
        case "Fighting":
        case 4:
          target_skill_text = fightingText; //string of skill
          skill_value = int(values.skill_fighting); //numeric skill value
          break;
        case "Medicine":
        case 5:
          target_skill_text = medicineText; //string of skill
          skill_value = int(values.skill_medicine); //numeric skill value
          break;
        case "Observation":
        case 6:
          target_skill_text = observationText; //string of skill
          skill_value = int(values.skill_observation); //numeric skill value
          break;
        case "Persuasion":
        case 7:
          target_skill_text = persuasionText; //string of skill
          skill_value = int(values.skill_persuasion); //numeric skill value
          break;
        case "Resilience":
        case 8:
          target_skill_text = resilienceText; //string of skill
          skill_value = int(values.skill_resilience); //numeric skill value
          break;
        case "Stealth":
        case 9:
          target_skill_text = stealthText; //string of skill
          skill_value = int(values.skill_stealth); //numeric skill value
          break;
        case "Survival":
        case 10:
          target_skill_text = survivalText; //string of skill
          skill_value = int(values.skill_survival); //numeric skill value
          break;
        case "Tactics":
        case 11:
          target_skill_text = tacticsText; //string of skill
          skill_value = int(values.skill_tactics); //numeric skill value
          break;
        case "Vehicles":
        case 12:
          target_skill_text = vehiclesText; //string of skill
          skill_value = int(values.skill_vehicles); //numeric skill value
          break;
        default:
          target_skill_text = "None"; //string of skill
          skill_value = 0; //numeric skill value
          break;
      }

      const number_dice = results.results.num_dice.result;
      const difficulty = results.results.difficulty.result;
      focus_apply = results.results.focus_apply.result;

      const focus_target = focus_apply == 1 ? skill_value : 1;

      let target_number = attribute_value + skill_value;

      //spell casting always uses increased complications, page 141
      //let optionalComplication = values.increasedComplication === 'N' ? 'N' : 'Y';
      let complication_range = 21 - difficulty;
      //if (optionalComplication === 'N') {
        //complication_range = 20;
      //}
      const complication_range_text = `${complication_range} - 20`;

      const dice = results.results.roll1.dice;
      let successCount = dice.filter(d => d <= target_number).length;
      successCount += dice.filter(d => d <= focus_target).length;
      let complicationCount = dice.filter(d => d >= complication_range).length;

      const success_range_text = `${focus_target + 1} - ${target_number}`;
      const crit_range_text = `1 - ${focus_target}`;

      target_attribute_text = target_attribute_text[0].toUpperCase() + target_attribute_text.slice(1);

      let bonus_momentum = successCount - difficulty;
      bonus_momentum = bonus_momentum < 0 ? 0 : bonus_momentum;
      let outcome = successCount >= difficulty ? 1 : 0;

      const dice_text = results.results.roll1.dice.toString();

      finishRoll(
        results.rollId,
        {
          roll1: number_dice,
          successes: successCount,
          complications: complicationCount,
          target_number: target_number,
          target_attribute: attribute_value,
          target_skill: skill_value,
          skill_text: target_skill_text,
          attribute_text: target_attribute_text,
          difficulty: difficulty,
          complication_range: complication_range_text,
          success_range: success_range_text,
          crit_range: crit_range_text,
          bonus_momentum: bonus_momentum,
          outcome: outcome,
          dice_text: dice_text,
          focus_apply: focus_apply
        }
      );      
    });
  });

// generic skill check
on(`clicked:genericSkill-action`, () => {
  getAttrs([...skills,...stats], async function(values) {

    const academiaText = getTranslationByKey("academia") || "Academia";
    const athleticsText = getTranslationByKey("athletics") || "Athletics";
    const engineeringText = getTranslationByKey("engineering") || "Engineering";
    const fightingText = getTranslationByKey("fighting") || "Fighting";
    const medicineText = getTranslationByKey("medicine") || "Medicine";
    const observationText = getTranslationByKey("observation") || "Observation";
    const persuasionText = getTranslationByKey("persuasion") || "Persuasion";
    const resilienceText = getTranslationByKey("resilience") || "Resilience";
    const stealthText = getTranslationByKey("stealth") || "Stealth";
    const survivalText = getTranslationByKey("survival") || "Survival";
    const tacticsText = getTranslationByKey("tactics") || "Tactics";
    const vehiclesText = getTranslationByKey("vehicles") || "Vehicles";

    const agilityText = getTranslationByKey("agility") || "Agility";
    const brawnText = getTranslationByKey("brawn") || "Brawn";
    const coordinationText = getTranslationByKey("coordination") || "Coordination";
    const insightText = getTranslationByKey("insight") || "Insight";
    const reasonText = getTranslationByKey("reason") || "Reason";
    const willText = getTranslationByKey("will") || "Will";

    const subTitle = getTranslationByKey("buttons.skill_check") || 'Skill Check';
    const results = await startRoll(`@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=${subTitle}}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{relevant_attribute=[[?{@{attributeMacro}|${agilityText},1|${brawnText},2|${coordinationText},3|${insightText},4|${reasonText},5|${willText},6}]]}} {{target_skill=[[?{@{skillMacro}|None,0|${academiaText},1|${athleticsText},2|${engineeringText},3|${fightingText},4|${medicineText},5|${observationText},6|${persuasionText},7|${resilienceText},8|${stealthText},9|${survivalText},10|${tacticsText},11|${vehiclesText},12}]]}} {{focus_apply=[[?{@{focusMacro}|No,0|Yes,1}]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[0]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} }`);

    const target_skill = results.results.target_skill.result; //int select value 
    let target_skill_text = ""; //string of skill
    let skill_value = 0; //numeric skill value

    switch(target_skill) {
      case 1:
        skill_value = int(values.skill_academia);
        target_skill_text = academiaText;
        break;
      case 2:
        skill_value = int(values.skill_athletics);
        target_skill_text = athleticsText;
        break;
      case 3:
        skill_value = int(values.skill_engineering);
        target_skill_text = engineeringText;
        break;
      case 4:
        skill_value = int(values.skill_fighting);
        target_skill_text = fightingText;
        break;
      case 5:
        skill_value = int(values.skill_medicine);
        target_skill_text = medicineText;
        break;
      case 6:
        skill_value = int(values.skill_observation);
        target_skill_text = observationText;
        break;
      case 7:
        skill_value = int(values.skill_persuasion);
        target_skill_text = persuasionText;
        break;
      case 8:
        skill_value = int(values.skill_resilience);
        target_skill_text = resilienceText;
        break;
      case 9:
        skill_value = int(values.skill_stealth);
        target_skill_text = stealthText;
        break;
      case 10:
        skill_value = int(values.skill_survival);
        target_skill_text = survivalText;
        break;
      case 11:
        skill_value = int(values.skill_tactics);
        target_skill_text = tacticsText;
        break;
      case 12:
        skill_value = int(values.skill_vehicles);
        target_skill_text = vehiclesText;
        break;
      default:
        skill_value = 0;
        target_skill_text = "None";
        break;
    }

    const relevant_attribute = results.results.relevant_attribute.result;
    let target_attribute = 0;
    let target_attribute_text = "";

    switch(relevant_attribute) {
      case 1:
        target_attribute = int(values.agility);
        target_attribute_text = agilityText;
        break;
      break;
      case 2:
        target_attribute = int(values.brawn);
        target_attribute_text = brawnText;
        break;
      case 3:
        target_attribute = int(values.coordination);
        target_attribute_text = coordinationText;
        break;
      case 4:
        target_attribute = int(values.insight);
        target_attribute_text = insightText;
        break;
      case 5:
        target_attribute = int(values.reason);
        target_attribute_text = reasonText;
        break;
      case 6:
        target_attribute = int(values.will);
        target_attribute_text = willText;
        break;
      default:
        target_attribute = 0;
        target_attribute_text = "None";
        break;
    }

    const number_dice = results.results.num_dice.result;
    const difficulty = results.results.difficulty.result;
    const focus_apply = results.results.focus_apply.result;
    const focus_target = focus_apply == 1 ? skill_value : 1;

    let target_number = target_attribute + skill_value;

    let optionalComplication = values.increasedComplication === 'N' ? 'N' : 'Y';
    let complication_range = 21 - difficulty;
    if (optionalComplication === 'N') {
      complication_range = 20;
    }
    const complication_range_text = `${complication_range} - 20`;

    const dice = results.results.roll1.dice;
    let successCount = dice.filter(d => d <= target_number).length;
    successCount += dice.filter(d => d <= focus_target).length;
    let complicationCount = dice.filter(d => d >= complication_range).length;

    const success_range_text = `${focus_target + 1} - ${target_number}`;
    const crit_range_text = `1 - ${focus_target}`;

    let bonus_momentum = successCount - difficulty;
    bonus_momentum = bonus_momentum < 0 ? 0 : bonus_momentum;
    let outcome = successCount >= difficulty ? 1 : 0;

    const dice_text = results.results.roll1.dice.toString();

    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        successes: successCount,
        complications: complicationCount,
        target_number: target_number,
        target_attribute: target_attribute,
        target_skill: skill_value,
        skill_text: target_skill_text,
        attribute_text: target_attribute_text,
        difficulty: difficulty,
        complication_range: complication_range_text,
        success_range: success_range_text,
        crit_range: crit_range_text,
        bonus_momentum: bonus_momentum,
        outcome: outcome,
        dice_text: dice_text,
        focus_apply: focus_apply
      }
    );      
  });
});

// weapons damage
const damageSkills = ["repeating_weapons_weapons_type", "repeating_weapons_stress_dice", "repeating_weapons_weapons_name", "repeating_weapons_weapons_damage", "repeating_weapons_weapons_salvo", "brawn_bonus_dmg", "insight_bonus_dmg", "will_bonus_dmg"];
on("clicked:repeating_weapons:damage-action", function () {
  getAttrs(damageSkills, async function(values) {

    let numDice = 0;
    let stressDice = int(values.repeating_weapons_stress_dice);
    let bonusdice = 0;

    const weaponType = values.repeating_weapons_weapons_type || "";
    switch(weaponType) {
      case "Melee":
        bonusdice = int(values.brawn_bonus_dmg);
        break;
      case "Ranged":
        bonusdice = int(values.insight_bonus_dmg);
        break;
      case "Mental":
        bonusdice = int(values.brawn_bonus_dmg);
        break;
      default:
        bonusdice = 0;
        break;
    }

    numDice = stressDice + bonusdice;

    const description = values.repeating_weapons_weapons_name || "";
    const stressEffects = values.repeating_weapons_weapons_damage || "";
    const salvoEffects = values.repeating_weapons_weapons_salvo || "";
    const damageRoll = getTranslationByKey("damage_roll") || "Damage Roll";
    const rollString = `@{whisper}&{template:damage} {{title=@{character_name}}} {{subtitle=${damageRoll}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|${numDice}}]]}} {{roll1=[[?{@{diceMacro}}d6cs<0cf>21]]}} {{total_stress=[[0]]}} {{total_effects=[[0]]}} {{stress_effects=${stressEffects}}} {{salvo_effects=${salvoEffects}}} }`;
    const results = await startRoll(rollString);

    const number_dice = results.results.num_dice.result;
    const dice = results.results.roll1.dice;
    let nmbrStress = 0;
    let nmbrEffects = 0;
    
    dice.forEach(die => {
      switch(die) {
        case 1:
          nmbrStress += 1;
          break;
        case 2:
          nmbrStress += 2;
          break;
        case 3:
          break;
        case 4:
          break;
        case 5:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
        case 6:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
      }
    });

    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        total_stress: nmbrStress,
        total_effects: nmbrEffects
      }
    );      
  });
});

// spell damage
const spellDamageSkills = ["spells_power_total"];
on("clicked:spell_power-action", function () {
  getAttrs(spellDamageSkills, async function(values) {

    let numDice = int(values.spells_power_total);

    const description = getTranslationByKey("spell_damage") || "Spell Damage";
    const stressEffects = "";
    const salvoEffects = "";
    const damageRoll = getTranslationByKey("damage_roll") || "Damage Roll";
    const rollString = `@{whisper}&{template:damage} {{title=@{character_name}}} {{subtitle=${damageRoll}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|${numDice}}]]}} {{roll1=[[?{@{diceMacro}}d6cs<0cf>21]]}} {{total_stress=[[0]]}} {{total_effects=[[0]]}} {{stress_effects=${stressEffects}}} {{salvo_effects=${salvoEffects}}} }`;
    const results = await startRoll(rollString);

    const number_dice = results.results.num_dice.result;
    const dice = results.results.roll1.dice;
    let nmbrStress = 0;
    let nmbrEffects = 0;
    
    dice.forEach(die => {
      switch(die) {
        case 1:
          nmbrStress += 1;
          break;
        case 2:
          nmbrStress += 2;
          break;
        case 3:
          break;
        case 4:
          break;
        case 5:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
        case 6:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
      }
    });

    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        total_stress: nmbrStress,
        total_effects: nmbrEffects
      }
    );      
  });
});

// Vehicle Brawn
on(`clicked:vehiclebrawn-action`, () => {
  getAttrs(['increasedComplication', 'vehicle_brawn_bonus'], async function(values) {
    const results = await startRoll(`@{whisper}&{template:skill} {{title=@{character_name}}} {{subtitle=Vehicle Brawn}} {{num_dice=[[?{@{diceMacro}|2}]]}} {{target_skill=[[?{@{vehicleSkillMacro}|0}]]}} {{focus_apply=[[?{@{focusMacro}|No,0|Yes,1}]]}} {{difficulty=[[?{@{difficultyMacro}|1}]]}} {{target_attribute=[[@{vehicle_brawn}]]}} {{roll1=[[?{@{diceMacro}}d20cs<0cf>21]]}} {{skill_text=[[0]]}} {{attribute_text=[[0]]}} {{target_number=[[0]]}} {{successes=[[0]]}} {{complications=[[0]]}} {{complication_range=[[0]]}} {{success_range=[[0]]}} {{crit_range=[[0]]}} {{bonus_momentum=[[0]]}} {{outcome=[[0]]}} {{dice_text=[[0]]}} {{auto_success=[[0]]}} {{show_auto_success=Yes}} }`);

      const target_skill_text = "Driver Skill"; //string of skill
    const skill_value = results.results.target_skill.result; //numeric skill value

    const number_dice = results.results.num_dice.result;
    const difficulty = results.results.difficulty.result;
    const target_attribute = results.results.target_attribute.result;
    const focus_apply = results.results.focus_apply.result;
    const focus_target = focus_apply == 1 ? skill_value : 1;

    const auto_success = int(values.vehicle_brawn_bonus);

    let target_number = target_attribute + skill_value;

    let optionalComplication = values.increasedComplication === 'N' ? 'N' : 'Y';
    let complication_range = 21 - difficulty;
    if (optionalComplication === 'N') {
      complication_range = 20;
    }
    const complication_range_text = `${complication_range} - 20`;

    const dice = results.results.roll1.dice;
    let successCount = dice.filter(d => d <= target_number).length;
    successCount += dice.filter(d => d <= focus_target).length;
    successCount += auto_success;

    let complicationCount = dice.filter(d => d >= complication_range).length;

    const success_range_text = `${focus_target + 1} - ${target_number}`;
    const crit_range_text = `1 - ${focus_target}`;

    let target_attribute_text = 'Vehicle Brawn';
    target_attribute_text = target_attribute_text[0].toUpperCase() + target_attribute_text.slice(1);

    let bonus_momentum = successCount - difficulty;
    bonus_momentum = bonus_momentum < 0 ? 0 : bonus_momentum;
    let outcome = successCount >= difficulty ? 1 : 0;

    const dice_text = results.results.roll1.dice.toString();
    
    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        successes: successCount,
        complications: complicationCount,
        target_number: target_number,
        target_attribute: target_attribute,
        target_skill: skill_value,
        skill_text: target_skill_text,
        attribute_text: target_attribute_text,
        difficulty: difficulty,
        complication_range: complication_range_text,
        success_range: success_range_text,
        crit_range: crit_range_text,
        bonus_momentum: bonus_momentum,
        outcome: outcome,
        dice_text: dice_text,
        focus_apply: focus_apply,
        auto_success: auto_success
      }
    );      
  });
});


// impact damage
const vehicleImpactSkills = ["vehicle_impact"];
on("clicked:impact-action", function () {
  getAttrs(vehicleImpactSkills, async function(values) {

    let numDice = int(values.vehicle_impact);

    const description = "Vehicle Impact";
    const stressEffects = "";
    const salvoEffects = "";
    const damageRoll = getTranslationByKey("damage_roll") || "Damage Roll";
    const rollString = `@{whisper}&{template:damage} {{title=@{character_name}}} {{subtitle=${damageRoll}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|${numDice}}]]}} {{roll1=[[?{@{diceMacro}}d6cs<0cf>21]]}} {{total_stress=[[0]]}} {{total_effects=[[0]]}} {{stress_effects=${stressEffects}}} {{salvo_effects=${salvoEffects}}} }`;
    const results = await startRoll(rollString);

    const number_dice = results.results.num_dice.result;
    const dice = results.results.roll1.dice;
    let nmbrStress = 0;
    let nmbrEffects = 0;
    
    dice.forEach(die => {
      switch(die) {
        case 1:
          nmbrStress += 1;
          break;
        case 2:
          nmbrStress += 2;
          break;
        case 3:
          break;
        case 4:
          break;
        case 5:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
        case 6:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
      }
    });

    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        total_stress: nmbrStress,
        total_effects: nmbrEffects
      }
    );      
  });
});


// vehicle weapons damage
const vehicleDamageSkills = ["repeating_vehweapons_vehicle_weapons_type", "repeating_vehweapons_vehicle_stress_dice", "repeating_vehweapons_vehicle_weapons_name", "repeating_vehweapons_vehicle_weapons_damage", "repeating_vehweapons_vehicle_weapons_salvo"];
on("clicked:repeating_vehweapons:vdamage-action", function () {
  getAttrs(vehicleDamageSkills, async function(values) {

    let numDice = 0;
    let stressDice = int(values.repeating_vehweapons_vehicle_stress_dice);

    const weaponType = values.repeating_vehweapons_vehicle_weapons_type || "";

    numDice = stressDice;

    const description = values.repeating_vehweapons_vehicle_weapons_name || "";
    const stressEffects = values.repeating_vehweapons_vehicle_weapons_damage || "";
    const salvoEffects = values.repeating_vehweapons_vehicle_weapons_salvo || "";
    const damageRoll = getTranslationByKey("damage_roll") || "Damage Roll";    
    const rollString = `@{whisper}&{template:damage} {{title=@{character_name}}} {{subtitle=${damageRoll}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|${numDice}}]]}} {{roll1=[[?{@{diceMacro}}d6cs<0cf>21]]}} {{total_stress=[[0]]}} {{total_effects=[[0]]}} {{stress_effects=${stressEffects}}} {{salvo_effects=${salvoEffects}}} }`;
    const results = await startRoll(rollString);

    const number_dice = results.results.num_dice.result;
    const dice = results.results.roll1.dice;
    let nmbrStress = 0;
    let nmbrEffects = 0;
    
    dice.forEach(die => {
      switch(die) {
        case 1:
          nmbrStress += 1;
          break;
        case 2:
          nmbrStress += 2;
          break;
        case 3:
          break;
        case 4:
          break;
        case 5:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
        case 6:
          nmbrStress += 1;
          nmbrEffects += 1;
          break;
      }
    });

    finishRoll(
      results.rollId,
      {
        roll1: number_dice,
        total_stress: nmbrStress,
        total_effects: nmbrEffects
      }
    );      
  });
});

// generic damage
on("clicked:genericDamage-action", async function () {
  let numDice = 1;

  const description = getTranslationByKey("generic_damage") || "Generic Damage";
  const stressEffects = "";
  const salvoEffects = "";
  const damageRoll = getTranslationByKey("damage_roll") || "Damage Roll";
  const rollString = `@{whisper}&{template:damage} {{title=@{character_name}}} {{subtitle=${damageRoll}}} {{description=${description}}} {{num_dice=[[?{@{diceMacro}|${numDice}}]]}} {{roll1=[[?{@{diceMacro}}d6cs<0cf>21]]}} {{total_stress=[[0]]}} {{total_effects=[[0]]}} {{stress_effects=${stressEffects}}} {{salvo_effects=${salvoEffects}}} }`;
  const results = await startRoll(rollString);

  const number_dice = results.results.num_dice.result;
  const dice = results.results.roll1.dice;
  let nmbrStress = 0;
  let nmbrEffects = 0;
  
  dice.forEach(die => {
    switch(die) {
      case 1:
        nmbrStress += 1;
        break;
      case 2:
        nmbrStress += 2;
        break;
      case 3:
        break;
      case 4:
        break;
      case 5:
        nmbrStress += 1;
        nmbrEffects += 1;
        break;
      case 6:
        nmbrStress += 1;
        nmbrEffects += 1;
        break;
    }
  });

  finishRoll(
    results.rollId,
    {
      roll1: number_dice,
      total_stress: nmbrStress,
      total_effects: nmbrEffects
    }
  );      
});


const changeSheetType = () => {
  changeCharacterType(false);
}

const changeCharacterType = (setSheetTab) => {
  setSheetTab = setSheetTab || false;
  getAttrs(["sheetType"], function(values) {
    if (values.sheetType === "vehicle"){
      $20("#act_main_char").removeClass("show_element_inline").addClass("hide_element");
      $20("#act_equipment").removeClass("show_element_inline").addClass("hide_element");;
      $20("#act_spells").removeClass("show_element_inline").addClass("hide_element");;
      $20("#act_vehicle").removeClass("hide_element").addClass("show_element_inline");;
      if (setSheetTab) {
        $20("#act_vehicle").addClass('tab_button_selected');
        setAttrs({
          sheetTab: "vehicle"
        });
      }
    } else {
      $20("#act_main_char").removeClass("hide_element").addClass("show_element_inline");
      $20("#act_equipment").removeClass("hide_element").addClass("show_element_inline");;
      $20("#act_spells").removeClass("hide_element").addClass("show_element_inline");;
      $20("#act_vehicle").removeClass("show_element_inline").addClass("hide_element");;
      if (setSheetTab) {
        $20("#act_main_char").addClass('tab_button_selected');
        setAttrs({
          sheetTab: "main_char"
        });
      }
    }
  });
};

const setRollMacroText = () => {
  setAttrs({
    diceMacro: getTranslationByKey("roll.ask-dice") || "Dice",
    skillMacro: getTranslationByKey("roll.ask-relevant_skill") || "Relevant Skill",
    focusMacro: getTranslationByKey("roll.ask-does_focus_apply") || "Does A Focus Apply",
    difficultyMacro: getTranslationByKey("roll.ask-difficulty") || "Difficulty",
    weaponTypeMacro: getTranslationByKey("roll.ask-weapon_type") || "Weapon Type",
    casterTypeMacro: getTranslationByKey("roll.ask-spellcaster_type") || "Spellcaster Type",
    attributeMacro: getTranslationByKey("roll.ask-relevant_attribute") || "Relevant Attribute",
    vehicleSkillMacro: getTranslationByKey("roll.ask-driver_skill") || "Relevant skill value from Driver"
  });
};

on('change:sheetType',changeSheetType);

<!-- Some stuff to run everytime the sheet opens -->
on('sheet:opened',function(){
  changeCharacterType(true);
  hideShowSpellTradition();
  calcualteStressValues();
  calcualteSpellPower();
  checkAttributesBounds();
  checkSkillsBounds();
  updateVehicleStressBoxes();
  updateVehicleInjuryBoxes();
  setRollMacroText();
});

<!-- set the attributes and buttons correct so roll buttons trigger action buttons -->

  //A function to combine getting repeating and non repeating attributes.
const getAllAttrs = function(props,sectionDetails,callback){
  getSections(sectionDetails,(repeats,sections)=>{
    getAttrs([...props,...repeats],(attributes)=>{
      callback(attributes,sections);
    })
  });
};

//Iterates over the provided repeating sections and assembles an array of attributes to get from those sections for each row.
const getSections = function(section_details,callback){
  let queueClone = _.clone(section_details);
  const worker = (queue,repeatAttrs=[],sections={})=>{
    let detail = queue.shift();
    getSectionIDs(detail.section,(IDs)=>{
      sections[detail.section] = IDs;
      IDs.forEach((id)=>{
        detail.fields.forEach((f)=>{
          repeatAttrs.push(`${detail.section}_${id}_${f}`);
        });
      });
      repeatAttrs.push(`_reporder_${detail.section}`);
      if(queue.length){
        worker(queue,repeatAttrs,sections);
      }else{
        callback(repeatAttrs,sections);
      }
    });
  };
  if(!queueClone[0]){
    callback([],{});
  }
  worker(queueClone);
};


const repeatingSections = [{section:'repeating_weapons',fields:['attack_action', 'damage_action']},{section:'repeating_spells',fields:['spell_action']},{section:'repeating_vehweapons',fields:['vdamage_action']},];//Replace these with your sheet's repeating sections
const actionRefs = ['character_name', 'agility_action', 'brawn_action', 'coordination_action', 'insight_action', 'reason_action', 'will_action', 'spell_power_action','genericDamage_action', 'genericSkill_action', 'vehiclebrawn_action', 'impact_action'];//Replace these with the non repeating attributes for your sheet.
const actionCallUpdate = function(){
  getAllAttrs(['character_name',...actionRefs],repeatingSections,(attributes,sections)=>{
    let actions = Object.keys(attributes).filter((key)=>key!=='character_name');
    const setObj = actions.reduce((accumulator,actionName)=>{
      accumulator[actionName] = `%{${attributes.character_name}|${actionName.replace(/_([^_]*)$/,'-' + '$1')}}`;//Update the action call
      return accumulator;//The memo (accumulator in this case) must always be returned when using a reduce function
    },{});
    setAttrs(setObj,{silent:true});//Apply the changes
  });
};

on('sheet:opened change:character_name change:repeating_weapons:weapons_type change:repeating_weapons:stress_dice change:repeating_vehweapons:vehicle_stress_dice',actionCallUpdate);

</script>




