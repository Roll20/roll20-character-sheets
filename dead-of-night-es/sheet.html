<!-- Dead of Night -->
<div class="sheet-don-ficha">
  <div class="sheet-columnas">

    <!-- COLUMNA IZQUIERDA -->
    <div class="sheet-col-izq">

      <!-- Nombre Pj -->
      <div class="sheet-linea-doble">
        <label>Nombre de la víctima:</label>
        <input type="text" name="attr_character_name" class="sheet-nombre-personaje" />
      </div>

      <!-- Atributos (dos subcolumnas) -->
      <div class="sheet-atributos">
        <div class="attrs-2cols">

          <!-- LADO IZQUIERDO -->
          <div class="attrs-left">

            <!-- Identificar -->
            <div class="attr-item">
              <button type="roll" name="roll_identificar" class="attr-label"
                value="&{template:default} {{name=Identificar — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{identificar}]] + [[?{Modificador|0}]] ]]}}">
                Identificar
              </button>
              <input type="number" name="attr_identificar" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_identificar_spec" placeholder="Esp. Identificar" autocomplete="off" />
              <input type="number" name="attr_identificar_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_identificar_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Identificar"
                value="&{template:default} {{name=@{identificar_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{identificar_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Persuadir -->
            <div class="attr-item">
              <button type="roll" name="roll_persuadir" class="attr-label"
                value="&{template:default} {{name=Persuadir — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{persuadir}]] + [[?{Modificador|0}]] ]]}}">
                Persuadir
              </button>
              <input type="number" name="attr_persuadir" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_persuadir_spec" placeholder="Esp. Persuadir" autocomplete="off" />
              <input type="number" name="attr_persuadir_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_persuadir_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Persuadir"
                value="&{template:default} {{name=@{persuadir_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{persuadir_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Perseguir -->
            <div class="attr-item">
              <button type="roll" name="roll_perseguir" class="attr-label"
                value="&{template:default} {{name=Perseguir — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{perseguir}]] + [[?{Modificador|0}]] ]]}}">
                Perseguir
              </button>
              <input type="number" name="attr_perseguir" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_perseguir_spec" placeholder="Esp. Perseguir" autocomplete="off" />
              <input type="number" name="attr_perseguir_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_perseguir_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Perseguir"
                value="&{template:default} {{name=@{perseguir_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{perseguir_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Atacar -->
            <div class="attr-item">
              <button type="roll" name="roll_atacar" class="attr-label"
                value="&{template:default} {{name=Atacar — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{atacar}]] + [[?{Modificador|0}]] ]]}}">
                Atacar
              </button>
              <input type="number" name="attr_atacar" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_atacar_spec" placeholder="Esp. Atacar" autocomplete="off" />
              <input type="number" name="attr_atacar_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_atacar_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Atacar"
                value="&{template:default} {{name=@{atacar_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{atacar_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

          </div><!-- /attrs-left -->

          <!-- LADO DERECHO -->
          <div class="attrs-right">

            <!-- Ocultar -->
            <div class="attr-item">
              <button type="roll" name="roll_ocultar" class="attr-label"
                value="&{template:default} {{name=Ocultar — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{ocultar}]] + [[?{Modificador|0}]] ]]}}">
                Ocultar
              </button>
              <input type="number" name="attr_ocultar" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_ocultar_spec" placeholder="Esp. Ocultar" autocomplete="off" />
              <input type="number" name="attr_ocultar_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_ocultar_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Ocultar"
                value="&{template:default} {{name=@{ocultar_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{ocultar_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Disuadir -->
            <div class="attr-item">
              <button type="roll" name="roll_disuadir" class="attr-label"
                value="&{template:default} {{name=Disuadir — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{disuadir}]] + [[?{Modificador|0}]] ]]}}">
                Disuadir
              </button>
              <input type="number" name="attr_disuadir" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_disuadir_spec" placeholder="Esp. Disuadir" autocomplete="off" />
              <input type="number" name="attr_disuadir_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_disuadir_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Disuadir"
                value="&{template:default} {{name=@{disuadir_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{disuadir_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Escapar -->
            <div class="attr-item">
              <button type="roll" name="roll_escapar" class="attr-label"
                value="&{template:default} {{name=Escapar — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{escapar}]] + [[?{Modificador|0}]] ]]}}">
                Escapar
              </button>
              <input type="number" name="attr_escapar" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_escapar_spec" placeholder="Esp. Escapar" autocomplete="off" />
              <input type="number" name="attr_escapar_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_escapar_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Escapar"
                value="&{template:default} {{name=@{escapar_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{escapar_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

            <!-- Proteger -->
            <div class="attr-item">
              <button type="roll" name="roll_proteger" class="attr-label"
                value="&{template:default} {{name=Proteger — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{proteger}]] + [[?{Modificador|0}]] ]]}}">
                Proteger
              </button>
              <input type="number" name="attr_proteger" min="0" max="99" step="1" value="5" />
            </div>
            <div class="spec-inline">
              <input type="text" name="attr_proteger_spec" placeholder="Esp. Proteger" autocomplete="off" />
              <input type="number" name="attr_proteger_spec_val" value="0" min="-99" max="99" step="1" autocomplete="off" />
              <button type="roll" name="roll_proteger_spec" class="specbtn"
                title="Tirar especialización" aria-label="Tirar especialización: Proteger"
                value="&{template:default} {{name=@{proteger_spec} — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{proteger_spec_val}]] + [[?{Modificador|0}]] ]]}}">
              </button>
            </div>

          </div><!-- /attrs-right -->

        </div><!-- /attrs-2cols -->
      </div><!-- /sheet-atributos -->

      <!-- Tirada Genérica -->
      <div class="box box-generic">
        <div class="legend">Tirada genérica
          <input type="number" name="attr_roll_base" value="0" min="-99" max="999" step="1" title="Bonificador base" />
          <button type="roll" name="roll_generica" class="genericbtn" title="Tirar" aria-label="Tirar tirada genérica"
            value="&{template:default} {{name=Tirada genérica — @{character_name}}} {{Dificultad Objetivo=[[?{Dificultad|15}]]}} {{Modificador=[[?{Modificador|0}]]}} {{Resultado de la Tirada=[[ 2d10 + [[@{roll_base}]] + [[?{Modificador|0}]] ]]}}">
          </button>
        </div>
      </div>

      <!-- Puntos de Supervivencia -->
      <div class="box box-ps">
        <div class="legend">Puntos de Supervivencia</div>
        <div class="ps-row">
          <button type="action" name="act_ps_minus" class="psbtn" title="−1">−</button>
          <input type="number" name="attr_ps" value="5" min="0" step="1" />
          <button type="action" name="act_ps_plus" class="psbtn" title="+1">+</button>
        </div>
      </div>

    </div><!-- /sheet-col-izq -->

    <!-- COLUMNA DERECHA -->
    <div class="sheet-col-der">

      <!-- LOGO (local) -->
      <div class="box box-logo">
        <img class="don-logo"
             src="logo_don.png"
             alt="Dead of Night" />
      </div>

      <!-- Notas -->
      <div class="box box-notas">
        <div class="legend">Notas</div>
        <textarea name="attr_notas" placeholder="Notas de la aventura, pistas, heridas…"></textarea>
      </div>

      <!-- Malos hábitos -->
      <div class="box box-maloshabitos">
        <div class="legend">Malos hábitos</div>
        <fieldset class="repeating_maloshabitos">
          <input type="text" name="attr_malohabito" placeholder="Añade un mal hábito…" />
        </fieldset>
      </div>

    </div><!-- /sheet-col-der -->

  </div><!-- /sheet-columnas -->
    <div class="sheet-credito">
      Ficha del juego "Dead of Night" adaptada a Roll20 por <a href="https://app.roll20.net/users/33210/jj" target="_blank">Dantés Jr</a> (33210)
    </div>
</div><!-- /sheet-don-ficha -->

<!-- SHEETWORKERS (solo PS; atributos libres) -->
<script type="text/worker">
  // Botones de PS +/- (incremento/decremento)
  on('clicked:ps_plus clicked:ps_minus', (e)=>{
    getAttrs(['ps'], v=>{
      let ps = parseInt(v.ps)||0;
      ps += (e.htmlAttributes.name==='act_ps_plus') ? 1 : -1;
      if(ps<0) ps=0;
      setAttrs({ps});
    });
  });
</script>
