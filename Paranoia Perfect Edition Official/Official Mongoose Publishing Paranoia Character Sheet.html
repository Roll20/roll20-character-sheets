<div class="sheet-grid-section">
    <div class='compendium-drop-target npcs'>
        <input name="attr_drop_name" accept="Name" value="" type="hidden" title="@{drop_name}" />
        <input name="attr_drop_data" accept="data" value="" type="hidden" title="@{drop_data}" />
        <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="public" />
        <input type="hidden" name="attr_sheetselection" value="no" />
        <div class="tabs">
            <input type="checkbox" style="float:right;" class="sheet-toggle-checkbox" id="attr_sheetselection"
                name="attr_sheetselection">
            <button type="action" class="tablinks" data-i18n="public-side" id="act_public" name="act_public">Public
                Side</button>
            <button type="action" class="tablinks" data-i18n="naughty-side" id="act_naughty" name="act_naughty"
                style="background-color: black;">Naughty Side</button>
            <button type="action" class="tablinks" data-i18n="npc-sheet" id="act_npc" name="act_npc"
                style="background-color: white; border:1px black solid; float:right; color: black; height: 16px;">NPC</button>
        </div>

        <!-- NPC Sheet -->
        <div class="sheet-npc">
            <div>
                <div class="sheet-header">
                    <img style="margin-top: 10px;"
                        src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Paranoia%20Perfect%20Edition%20Official/npc-avatar-header.jpg" />

                    <img class="npc-sheet-avatar-image" name="attr_character_avatar">
                </div>
                <div class="sheet-npc-grid-main-container">
                    <div class="sheet-npc-grid-container">
                        <div class="sheet-npc-grid-item">
                            <label for="attr_character_name" data-i18n="name">Name:</label>
                            <input type="text" name="attr_character_name" />
                        </div>
                        <div class="sheet-npc-grid-item">
                            <label for="attr_public-name" data-i18n="public-name">Public Name:</label>
                            <input type="text" name="attr_public-name" />
                        </div>
                        <div class="sheet-npc-grid-item sheet-thirds">
                            <label for="attr_clearance" data-i18n="clearance">Clearance:</label>
                            <select id="colorSelector" style="width: 90px; height: 25px; margin-bottom: 0px;"
                                name="attr_clearance-dropdown" accept="Clearance">
                                <option value="infrared" data-i18n="clearance-infrared">Infrared</option>
                                <option value="red" data-i18n="clearance-red">Red</option>
                                <option value="orange" data-i18n="clearance-orange">Orange</option>
                                <option value="yellow" data-i18n="clearance-yellow">Yellow</option>
                                <option value="green" data-i18n="clearance-green">Green</option>
                                <option value="blue" data-i18n="clearance-blue">Blue</option>
                                <option value="indigo" data-i18n="clearance-indigo">Indigo</option>
                                <option value="violet" data-i18n="clearance-violet">Violet</option>
                                <option value="ultraviolet" data-i18n="clearance-ultraviolet">Ultraviolet</option>
                            </select>
                        </div>
                        <div class="sheet-npc-grid-item sheet-thirds">
                            <label for="attr_sector" data-i18n="sector">Sector:</label>
                            <input type="text" style="width: 50px; height: 25px;" name="attr_sector" accept="Sector" />
                        </div>
                        <div class="sheet-npc-grid-item sheet-thirds">
                            <label for="attr_clone" data-i18n="clone">Clone:</label>
                            <input type="number" style="width: 30px; height: 25px;" name="attr_clone" />
                        </div>
                        <div class="sheet-npc-grid-item sheet-full-width">
                            <label for="attr_npc-quote" data-i18n="quote">Quote:</label>
                            <textarea spellcheck="false" rows="4" name="attr_npc-quote" accept="Tagline"></textarea>
                        </div>
                    </div>
                    <div class="sheet-npc-wounds-area">
                        <div class="sheet-npc-wounds">
                            <div class="sheet-wellnessheader">
                                <label class="sheet-wellnessheader" data-i18n="wounds">WOUNDS</label>
                            </div>
                            <div class="sheet-wounds-fine">
                                <label class="skills" data-i18n="fine" style="margin-top: 0px;" checked>Fine</label>
                            </div>
                            <div class="sheet-wounds-fine-value">
                                <input type="checkbox" class="sheet-npc-wounds-value" style="margin-top: -3px;"
                                    name="attr_wounds-fine-value" value="1">
                            </div>
                            <div class="sheet-wounds-hurt">
                                <label class="skills" style="margin-top: 0px;" data-i18n="hurt">Hurt</label>
                            </div>
                            <div class="sheet-wounds-hurt-value">
                                <input type="checkbox" class="sheet-npc-wounds-value" style="margin-top: 0px;"
                                    name="attr_wounds-hurt-value" value="1">
                            </div>
                            <div class="sheet-wounds-injured">
                                <label class="skills" style="margin-top: 2px;" data-i18n="injured">Injured</label>
                            </div>
                            <div class="sheet-wounds-injured-value">
                                <input type="checkbox" class="sheet-npc-wounds-value" style="margin-top: 3px;"
                                    name="attr_wounds-injured-value" value="1">
                            </div>
                            <div class="sheet-wounds-maimed">
                                <label class="skills" style="margin-top: 2px;" data-i18n="maimed">Maimed</label>
                            </div>
                            <div class="sheet-wounds-maimed-value">
                                <input type="checkbox" class="sheet-npc-wounds-value" style="margin-top: 3px;"
                                    name="attr_wounds-maimed-value" value="1">
                            </div>
                            <div class="sheet-wounds-dead">
                                <label class="skills" style="margin-top: 2px; margin-bottom: 12px;"
                                    data-i18n="dead">Dead</label>
                            </div>
                            <div class="sheet-wounds-dead-value">
                                <input type="checkbox" class="sheet-npc-wounds-value" style="margin-top: 3px;"
                                    name="attr_wounds-dead-value" value="1">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-node sheet-block" style="margin-top: 10px; padding-top: 10px; padding-bottom: 10px;">
                    <div class="sheet-input-container">
                        <label for="attr_NODE" style="margin-top: 10px !important; " data-i18n="NODE">NODE</label>
                        <div class="sheet-input-grid">
                            <input value="0" type="number" name="attr_NODE" class="sheet-input-number" />
                            <button class="sheet-input-button" type='roll'
                                value='&{template:ppe_NODE} {{character_name=@{character_name}}}{{NODE_roll=[[@{NODE}]]}} {{diceroll-1=[[@{NODE}d6cs>7cf<0>5 ]]}} {{diceroll-3=[[[[(abs(@{NODE}))]]d6cs>7cf<0>5f<4 + 1d6cs>6cf<0>5 ]]}} '
                                name='roll_weapon-skill-check' />
                            <input type="text" name="attr_wounds-warning" class="sheet-wounds-warning" readonly />
                        </div>
                    </div>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <label for="attr_npc-basics" data-i18n="basics">Basics:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_npc-basics"
                        accept="Basics"></textarea>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <label for="attr_npc-looks" data-i18n="looks">Looks:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_npc-looks"
                        accept="Looks"></textarea>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <label for="attr_npc-quirks" data-i18n="quirks">Quirks:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_npc-quirks"
                        accept="Quirks"></textarea>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <label for="attr_npc-plans" data-i18n="plans">Plans:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_npc-plans"
                        accept="Plans"></textarea>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <label for="attr_npc-gear" data-i18n="gear">Gear:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_npc-gear"
                        accept="Gear"></textarea>
                </div>
                <div class="sheet-textarea-npc sheet-block">
                    <textarea class="sheet-naughty-textarea" rows="8" spellcheck="false"
                        name="attr_npc-description"></textarea>
                </div>
            </div>
        </div>

        <!-- Naughty Side -->
        <div class="sheet-naughty">
            <div class="sheet-naughty-section">
                <div class="sheet-header">
                    <img style="margin-top: 10px;"
                        src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Paranoia%20Perfect%20Edition%20Official/character-sheet-naughty-header.jpg" />
                </div>
                <div class="sheet-naughty-namebox sheet-naughty-block">
                    <div class="sheet-naughty-name">
                        <label for="attr_character_name" data-i18n="name">Name:</label>
                        <input type="text" name="attr_character_name" />
                    </div>
                    <div class="sheet-secret-society">
                        <label for="attr_secret-society" data-i18n="secret-society">Secret Society:</label>
                        <input type="text" name="attr_secret-society" />
                    </div>
                    <div class="sheet-secret-objective">
                        <label for="attr_secret-objective" data-i18n="secret-objectice">Secret Objective:</label>
                    </div>
                    <div style="margin-right: 30px">
                        <textarea spellcheck="false" rows="6" name="attr_secret-objective"></textarea>
                    </div>
                    <div class="sheet-mutant-power">
                        <label for="attr_mutant-power" data-i18n="mutant-power">Mutant Power:</label>
                    </div>
                    <div style="margin-right: 30px">
                        <textarea spellcheck="false" rows="4" name="attr_mutant-power"></textarea>
                    </div>
                </div>
                <div class="sheet-favours">
                    <div class="sheet-service-group-favours sheet-block">
                        <div class="sheet-favoursheader">
                            <label class="sheet-favoursheader" data-i18n="service-group-favours">Service Group
                                Favours</label>
                        </div>
                        <div class="sheet-favours-box">
                            <textarea class="sheet-naughty-textarea" name="attr_service-group-favours"></textarea>
                        </div>
                    </div>
                    <div class="sheet-secret-society-favours sheet-block" style="padding: 0px;">
                        <div class="sheet-favoursheader">
                            <label class="sheet-favoursheader" data-i18n="secret-society-favours">Secret Society
                                Favours</label>
                        </div>
                        <div class="sheet-favours-box">
                            <textarea class="sheet-naughty-textarea" spellcheck="false"
                                name="attr_secert-society-favours"></textarea>
                        </div>
                    </div>
                </div>
                <div class="sheet-treasonous-gear sheet-block">
                    <label for="attr_treasonous-gear" spellcheck="false" class="sheet-naughty-label"
                        data-i18n="treasonous-gear">Treasonous
                        Gear (DO NOT USE OPENLY!):</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_treasonous-gear"></textarea>
                </div>
                <div class="sheet-evidence sheet-block">
                    <label for="attr_evidence" class="sheet-naughty-label" data-i18n="evidence">Evidence (For blackmail
                        and
                        accusations):</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_evidence"></textarea>
                </div>
                <div class="sheet-notes sheet-block">
                    <label for="attr_notes" class="sheet-naughty-label" data-i18n="do-not-forget-these-notes">DO NOT
                        FORGET
                        THESE NOTES:</label>
                    <textarea class="sheet-naughty-textarea" spellcheck="false" name="attr_notes"></textarea>
                </div>
            </div>
        </div>
        <!-- Public Side -->
        <div class="sheet-public">
            <div class="sheet-public-section">
                <div class="sheet-header">
                    <img
                        src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Paranoia%20Perfect%20Edition%20Official/character-sheet-header.jpg" />
                    <img class="sheet-avatar-image" name="attr_character_avatar">
                </div>
                <div class="sheet-part-1-title">
                    <h3 style="text-align: center; margin-bottom: 0px; padding-bottom: 0px; padding-top: 10px;"
                        data-i18n="part-1-title">Part 1
                        Title
                    </h3>
                </div>
                <div class="sheet-namelvl sheet-block">
                    <div class="sheet-name">
                        <label for="attr_character_name" data-i18n="name">Name:</label>
                        <input type="text" name="attr_character_name" />
                    </div>
                    <div class="sheet-team-name">
                        <label for="attr_team-name" data-i18n="team-name">Team Name: </label>
                        <input type="text" name="attr_team-name" />
                    </div>
                    <div class="sheet-mbd">
                        <label for="attr_mbd" data-i18n="mandatory-bonus-duty">MBD:</label>
                        <textarea name="attr_mbd" spellcheck="false"></textarea>
                    </div>
                    <div class="sheet-service-group">
                        <label for="attr_service-group" data-i18n="service-group">Service Group:</label>
                        <textarea name="attr_service-group" spellcheck="false"></textarea>
                    </div>
                    <div class="sheet-treason-button">
                        <label for="attr_treason-button" data-i18n="treason-button">Treason Button:</label>
                        <textarea name="attr_treason-button" spellcheck="false"></textarea>
                    </div>
                    <div class="sheet-violence-button">
                        <label for="attr_violence-button" data-i18n="violence-button">Violence Button:</label>
                        <textarea name="attr_violence-button" spellcheck="false"></textarea>
                    </div>
                </div>
                <div class="sheet-part-2-title">
                    <h3 style="text-align: center; margin-bottom: 0px; padding-bottom: 0px; padding-top: 10px;"
                        data-i18n="part-2-title">
                        Part 2 Title
                    </h3>
                </div>
                <div class="sheet-node sheet-block">
                    <div class="sheet-input-container">
                        <label for="attr_NODE" data-i18n="NODE">NODE</label>
                        <div class="sheet-input-grid">
                            <input value="0" type="number" name="attr_NODE" class="sheet-input-number" />

                            <button class="sheet-input-button" type='roll'
                                value='&{template:ppe_NODE} {{character_name=@{character_name}}}{{NODE_roll=[[@{NODE}]]}} {{diceroll-1=[[@{NODE}d6cs>7cf<0>5 + 1d6cs>@{node-flags}cf<0>5 ]]}} {{diceroll-3=[[[[(abs(@{NODE}))]]d6cs>7cf<0>5f<4 + 1d6cs>6cf<0>5 ]]}} '
                                name='roll_weapon-skill-check' />
                            <input type="text" name="attr_wounds-warning" class="sheet-wounds-warning" readonly />
                        </div>
                    </div>
                </div>
                <div class="sheet-skills">
                    <div class="sheet-brains">
                        <div class="sheet-skillsheader">
                            <label class="sheet-skillsheader" data-i18n="brains">BRAINS</label>
                        </div>
                        <div class="sheet-skillsheadervalue">
                            <input type="number" value="0" style="width:60px;" name="attr_brains" />
                        </div>
                        <div class="sheet-alpha-complex">
                            <label class="skills" data-i18n="skill-alpha-complex">Alpha Complex</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_alpha-complex" />
                        </div>
                        <div class="sheet-bureaucracy">
                            <label class="skills" data-i18n="skill-bureaucracy">Bureaucracy</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_bureaucracy" />
                        </div>
                        <div class="sheet-psychology">
                            <label class="skills" data-i18n="skill-psychology">Psychology</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_psychology" />
                        </div>
                        <div class="sheet-science">
                            <label class="skills" data-i18n="skill-science">Science</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_science" />
                        </div>
                    </div>
                    <div class="sheet-chutzpah">
                        <div class="sheet-skillsheader">
                            <label class="sheet-skillsheader" data-i18n="chutzpah">CHUTZPAH</label>
                        </div>
                        <div class="sheet-skillsheadervalue">
                            <input type="number" value="0" style="width:60px;" name="attr_chutzpah" />
                        </div>
                        <div class="sheet-bluff">
                            <label class="skills" data-i18n="skill-bluff">Bluff</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_bluff" />
                        </div>
                        <div class="sheet-charm">
                            <label class="skills" data-i18n="skill-charm">Charm</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_charm" />
                        </div>
                        <div class="sheet-intimidate">
                            <label class="skills" data-i18n="skill-intimidate">Intimidate</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_intimidate" />
                        </div>
                        <div class="sheet-stealth">
                            <label class="skills" data-i18n="skill-stealth">Stealth</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_stealth" />
                        </div>
                    </div>
                    <div class="sheet-mechanics">
                        <div class="sheet-skillsheader">
                            <label class="sheet-skillsheader" data-i18n="mechanics">MECHANICS</label>
                        </div>
                        <div class="sheet-skillsheadervalue">
                            <input type="number" value="0" style="width:60px;" name="attr_mechanics" />
                        </div>
                        <div class="sheet-demolitions">
                            <label class="skills" data-i18n="skill-demolitions">Demolitions</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_demolitions" />
                        </div>
                        <div class="sheet-engineer">
                            <label class="skills" data-i18n="skill-engineer">Engineer</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_engineer" />
                        </div>
                        <div class="sheet-operate">
                            <label class="skills" data-i18n="skill-operate">Operate</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_operate" />
                        </div>
                        <div class="sheet-program">
                            <label class="skills" data-i18n="skill-program">Program</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_program" />
                        </div>
                    </div>
                    <div class="sheet-violence">
                        <div class="sheet-skillsheader">
                            <label class="sheet-skillsheader" data-i18n="violence">VIOLENCE</label>
                        </div>
                        <div class="sheet-skillsheadervalue">
                            <input type="number" value="0" style="width:60px;" name="attr_violence" />
                        </div>
                        <div class="sheet-athletics">
                            <label class="skills" data-i18n="skill-athletics">Athletics</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_athletics" />
                        </div>
                        <div class="sheet-guns">
                            <label class="skills" data-i18n="skill-guns">Guns</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_guns" />
                        </div>
                        <div class="sheet-melee">
                            <label class="skills" data-i18n="skill-melee">Melee</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_melee" />
                        </div>
                        <div class="sheet-throw">
                            <label class="skills" data-i18n="skill-throw">Throw</label>
                        </div>
                        <div class="sheet-skillvalue">
                            <input class="sheet-skillvalue" type="number" style="width:60px;" value="0"
                                name="attr_throw" />
                        </div>
                    </div>
                </div>
                <div class="sheet-part-3-title">
                    <h3 style="text-align: center; margin-bottom: 0px; padding-bottom: 0px; padding-top: 10px;"
                        data-i18n="part-3-title">
                        Part 3 Title
                    </h3>
                </div>
                <div class="sheet-wellness">
                    <div class="sheet-wounds sheet-block">
                        <div class="sheet-wellnessheader">
                            <label class="sheet-wellnessheader" data-i18n="wounds">WOUNDS</label>
                        </div>
                        <div class="sheet-wounds-fine">
                            <label class="skills" data-i18n="fine" style="margin-top: 10px;" checked>Fine</label>
                        </div>
                        <div class=" sheet-wounds-fine-value">
                            <input type="checkbox" class="sheet-wounds-value" style="margin-top: 12px;"
                                name="attr_wounds-fine-value" value="1">
                        </div>
                        <div class="sheet-wounds-hurt">
                            <label class="skills" data-i18n="hurt">Hurt</label>
                        </div>
                        <div class="sheet-wounds-hurt-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_wounds-hurt-value" value="1">
                        </div>
                        <div class="sheet-wounds-injured">
                            <label class="skills" data-i18n="injured">Injured</label>
                        </div>
                        <div class="sheet-wounds-injured-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_wounds-injured-value"
                                value="1">
                        </div>
                        <div class="sheet-wounds-maimed">
                            <label class="skills" data-i18n="maimed">Maimed</label>
                        </div>
                        <div class="sheet-wounds-maimed-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_wounds-maimed-value" value="1">
                        </div>
                        <div class="sheet-wounds-dead">
                            <label class="skills" data-i18n="dead">Dead</label>
                        </div>
                        <div class="sheet-wounds-dead-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_wounds-dead-value" value="1">
                        </div>
                    </div>
                    <div class="sheet-flags sheet-block">
                        <div class="sheet-wellnessheader">
                            <label class="sheet-wellnessheader" data-i18n="flags">FLAGS</label>
                        </div>
                        <div class="sheet-flags-loyal">
                            <label class="skills" data-i18n="loyal" style="margin-top: 10px;" checked>Loyal</label>
                        </div>
                        <div class="sheet-flags-loyal-value">
                            <input type="checkbox" class="sheet-wounds-value" style="margin-top: 12px;"
                                name="attr_flags-loyal-value" value="1">
                        </div>
                        <div class="sheet-flags-greylisted">
                            <label class="skills" data-i18n="greylisted">Greylisted</label>
                        </div>
                        <div class="sheet-flags-greylisted-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_flags-greylisted-value"
                                value="1">
                        </div>
                        <div class="sheet-flags-restricted">
                            <label class="skills" data-i18n="restricted">Restricted</label>
                        </div>
                        <div class="sheet-flags-restricted-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_flags-restricted-value"
                                value="1">
                        </div>
                        <div class="sheet-flags-citizen-of-interest">
                            <label class="skills" data-i18n="citizen-of-interest">Citizen of interest</label>
                        </div>
                        <div class="sheet-flags-citizen-of-interest-value">
                            <input type="checkbox" class="sheet-wounds-value"
                                name="attr_flags-citizen-of-interest-value" value="1">
                        </div>
                        <div class="sheet-flags-wanted">
                            <label class="skills" data-i18n="wanted">Wanted</label>
                        </div>
                        <div class="sheet-flags-wanted-value">
                            <input type="checkbox" class="sheet-wounds-value" name="attr_flags-wanted-value" value="1">
                        </div>
                    </div>
                    <div class="sheet-xp sheet-block">
                        <div class="sheet-wellnessheader">
                            <label class="sheet-wellnessheader" data-i18n="xp-points">XP POINTS</label>
                        </div>
                        <div class="sheet-xp-box">
                            <input class="sheet-xp-moxie-values" type="number" value="0" name="attr_xp-points" />
                        </div>
                    </div>
                    <div class="sheet-moxie sheet-block">
                        <div class="sheet-wellnessheader">
                            <label class="sheet-wellnessheader" data-i18n="moxie">MOXIE</label>
                        </div>
                        <div class="sheet-moxie-box">
                            <input class="sheet-xp-moxie-values" type="number" value="0" min="0" max="8"
                                name="attr_moxie" />
                        </div>
                    </div>
                    <div class="sheet-eye-image">
                        <img
                            src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Paranoia%20Perfect%20Edition%20Official/character-sheet-eye.jpg" />
                    </div>
                </div>
                <div class="sheet-part-4-title">
                    <h3 style="text-align: center; margin-bottom: 0px; padding-bottom: 0px;" data-i18n="part-4-title">
                        Part 4 Title
                    </h3>
                </div>
                <div class="sheet-mission sheet-block">
                    <label class="part4" data-i18n="mission-objectives">MISSION OBJECTIVE(S)</label>
                    <div class="sheet-mission-objectives-textarea">
                        <textarea name="attr_mission-objectives" spellcheck="false"></textarea>
                    </div>
                </div>
                <div class="sheet-gear sheet-block">
                    <label class="part4" data-i18n="assigned-gear">ASSIGNED GEAR</label>
                    <div class="sheet-gear-textarea">
                        <textarea name="attr_assigned-gear" spellcheck="false"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- The Roll Template -->
<rolltemplate class="sheet-rolltemplate-ppe_NODE">
    <div style="width: 100%; border: 1px solid #a11d2c;">
        <div class="sheet-roll-title">
            {{character_name}} <!-- CHARACTER ROLLING -->
        </div>
        {{#^rollLess() NODE_roll 0}} <!-- NODE IS A POSITIVE NUMBER -->
        {{#rollWasCrit() diceroll-1}} <!-- ROLL INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE -->
        <div class="sheet-crit">
            {{diceroll-1}}
        </div>
        {{/rollWasCrit() diceroll-1}} <!-- ROLL INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE END -->
        {{#^rollWasCrit() diceroll-1}} <!-- ROLL DOES NOT INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE -->
        <div class="sheet-result">
            {{diceroll-1}}
        </div>
        {{/^rollWasCrit() diceroll-1}} <!-- ROLL DOES NOT INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE END -->
        {{/^rollLess() NODE_roll 0}} <!-- NODE IS A POSITIVE NUMBER END -->

        {{#rollLess() NODE_roll 0}} <!-- NODE IS A NEGATIVE NUMBER -->
        {{#rollWasCrit() diceroll-3}} <!-- ROLL INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE -->
        <div class="sheet-crit">
            {{diceroll-3}}
        </div>
        {{/rollWasCrit() diceroll-3}} <!-- ROLL INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE END -->

        {{#^rollWasCrit() diceroll-3}} <!-- ROLL DOES NOT INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE -->
        <div class="sheet-result">
            {{diceroll-3}}
        </div>
        {{/^rollWasCrit() diceroll-3}} <!-- ROLL DOES NOT INCLUDES A COMPUTER SYMBOL ON THE COMPUTER DIE END -->
        {{/rollLess() NODE_roll 0}} <!-- NODE IS A NEGATIVE NUMBER END -->
    </div>
</rolltemplate>

<script type="text/worker">
    // Set the Tabs
    const buttonlist = ["public","naughty","npc","pc"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

    // Update the 'node-flags' attribute when the 'flags-wanted-value' attribute changes
    on("change:flags-wanted-value change:flags-citizen-of-interest-value change:flags-restricted-value change:flags-greylisted-value change:flags-loyal-value sheet:opened", function(eventInfo) {
        getAttrs(["flags-wanted-value", "flags-citizen-of-interest-value", "flags-restricted-value", "flags-greylisted-value"], function(values) {
    
            var wanted = values["flags-wanted-value"];
            var citizen = values["flags-citizen-of-interest-value"];
            var restricted = values["flags-restricted-value"];
            var greylisted = values["flags-greylisted-value"];

            var nodeFlags = 6;
    
            // Set value of 'nodeFlags' based on what's ticked
            // This sets the Computer Dice critical failure threshold
            if (greylisted === "1") {
                nodeFlags = 5; 
            }
            if (restricted === "1") {
                nodeFlags = 4; 
            }
            if (citizen === "1") {
                nodeFlags = 3; 
            }
            if (wanted === "1") {
                nodeFlags = 2; 
            }

            if (nodeFlags === 6) {
                setAttrs({ "flags-loyal-value": "1" });
            } else if (nodeFlags === 5) {
                setAttrs({ "flags-loyal-value": "1" });
            } else if (nodeFlags === 4) {
                setAttrs({ "flags-loyal-value": "1" });
                setAttrs({ "flags-greylisted-value": "1" });
            } else if (nodeFlags === 3) {
                setAttrs({ "flags-loyal-value": "1" });
                setAttrs({ "flags-greylisted-value": "1" });
                setAttrs({ "flags-restricted-value": "1" });
            } else if (nodeFlags === 2) {
                setAttrs({ "flags-loyal-value": "1" });
                setAttrs({ "flags-greylisted-value": "1" });
                setAttrs({ "flags-restricted-value": "1" });
                setAttrs({ "flags-citizen-of-interest-value": "1" });
            }
    
            // log("Value of node-flags: " + nodeFlags);
    
            // Store 'nodeFlags' value in the attribute 'node-flags'
            setAttrs({ "node-flags": nodeFlags });
        });
    });

    // Update the 'wounds-warning' attribute when the 'wounds-hurt-value' attribute changes
    on("change:wounds-hurt-value change:wounds-injured-value change:wounds-maimed-value change:wounds-dead-value change:wounds-fine-value sheet:opened", function(eventInfo) {
        getAttrs(["wounds-hurt-value", "wounds-injured-value", "wounds-maimed-value", "wounds-dead-value"], function(values) {
    
            var hurt = values["wounds-hurt-value"];
            var injured = values["wounds-injured-value"];
            var maimed = values["wounds-maimed-value"];
            var dead = values["wounds-dead-value"];

            var woundEffect = 0;
            var woundWarning = "";
    
            // Add conditions to modify 'woundEffect' based on what's ticked
            if (hurt === "1") {
                woundEffect = 1; 
            }
            if (injured === "1") {
                woundEffect = 2; 
            }
            if (maimed === "1") {
                woundEffect = 3; 
            }
            if (dead === "1") {
                woundEffect = 0;
                woundWarning = 'You are DEAD. Time for a new clone!';
            }
            if (hurt === '0' && injured === '0' && maimed === '0' && dead === '0') {
                woundEffect = 0;
                woundWarning = '';
                setAttrs({ "wounds-fine-value": "1" });
            } else {
                if (dead === '1') {
                    setAttrs({ "wounds-fine-value": "1" });
                    setAttrs({ "wounds-hurt-value": "1" });
                    setAttrs({ "wounds-injured-value": "1" });
                    setAttrs({ "wounds-maimed-value": "1" });
                } else if (maimed === '1') {
                    setAttrs({ "wounds-fine-value": "1" });
                    setAttrs({ "wounds-hurt-value": "1" });
                    setAttrs({ "wounds-injured-value": "1" });
                } else if (injured === '1') {
                    setAttrs({ "wounds-fine-value": "1" });
                    setAttrs({ "wounds-hurt-value": "1" });
                } else if (hurt === '1') {
                    setAttrs({ "wounds-fine-value": "1" });
                }
            };

            // Get the text to display based on the 'woundEffect' value
            if (woundEffect > 0) {
                woundWarning = 'Due to your WOUNDS, you must apply -' + woundEffect + ' to the NODE total';
            }
    
            // log("Value of wounds-warning: " + woundEffect);
    
            // Store 'woundWarning' in the attribute 'wounds-warning'
            setAttrs({ "wounds-warning": woundWarning });
        });
    });

    // drag and dropped data from the Compendium
    on('change:drop_data',(event) => {
      // don't do handling if this was changed by api or sheetworker
      if(event.sourceType !== 'player') return;
  
      getAttrs(['drop_data', 'drop_name'],(attributes) => {
        try{
          const data = JSON.parse(attributes.drop_data);
          if(data.Category === 'NPCs'){
            // npc dropped, so show NPC sheet and hide header
            setAttrs({ "sheetTab": "npc" });
            setAttrs({ "sheetselection": "on" });
          } else if(data.Category === 'Secret Societies'){
            setAttrs({ "secret-society": attributes.drop_name });
          } else if(data.Category === 'Mutant Powers'){
            setAttrs({ "mutant-power": attributes.drop_name + " - " + data["data-description"] });
          } else if(data.Category === 'Service Groups'){
            setAttrs({ "service-group": attributes.drop_name });
          } else {
            // other category, so log it
            log("Unknown " + data.Category);
          }
        }catch(err){
          // handling for if the data isn't correct
          log(err);
        }
      })
    })

  </script>




