<div class="main-container">

  <!-- Header -->
  <div class="header">

    <div class="mundos-colidem-outer flex-column">
      <div class="mundos-colidem-inner">
        <div class="mundos-colidem-logo"></div>
        <span>Comics</span>
      </div>
      <div class="mundos-colidem-bottom">
        <span class="logo-number"># 001</span>
        <span>Julho 2019</span>
      </div>
    </div>

    <div class="logo main-font">
      <div class="heroes-of" data-i18n="heroesof">Heróis de</div>
      <div class="electrum" data-i18n="electrum">Electrum</div>
      <div class="subtitle" data-i18n="game-subtitle">Com grandes poderes, vêm grandes responsabilidades</div>
    </div>

  </div>


  <!-- Middle -->
  <div class="middle">

    <!-- Middle column 1-->
    <div class="middle-column">

      <div class="box chardefinitions">
        <span class="main-font" data-i18n="name">Nome</span>
        <input name="attr_character_name" type="text" title="{@character_name}" />

        <span class="main-font" data-i18n="codename">Codinome</span>
        <input name="attr_codename" type="text" title="{@codename}" />

        <span class="main-font" data-i18n="origin">Origem</span>
        <input name="attr_origin" type="text" title="{@origin}" />

        <span class="main-font" data-i18n="objective">Objetivo</span>
        <input name="attr_objective" type="text" title="{@objective}" />

        <span class="main-font" data-i18n="weakness">Fraqueza</span>
        <input name="attr_weakness" type="text" title="{@weakness}" />

      </div>

    </div>

    <!-- Middle column 2 -->
    <div class="middle-column">

      <div class="box flex-column">

        <span class="box-title main-font" data-i18n="attributes">Atributos</span>

        <div class="attributes-grid">
          <span class="label secondary-font" data-i18n="power">Potência</span>
          <input name="attr_charpower" type="number" title="{@charpower}" />
          <button type="roll" class="roll-button" name="roll_power_check" title="{@power_check}"
            value="&{template:main} {{charname=@{character_name}}} {{check=@{power}}} {{target=[[9]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 2d6 | @{advantage}, 3d6kh2 | @{disadvantage}, 3d6kl2 } + @{charpower} ]]}}"></button>


          <span class="label secondary-font" data-i18n="influence">Influência</span>
          <input name="attr_charinfluence" type="number" title="{@charinfluence}" />
          <button type="roll" class="roll-button" name="roll_influence_check" title="{@influence_check}"
            value="&{template:main} {{charname=@{character_name}}} {{check=@{influence}}} {{target=[[9]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 2d6 | @{advantage}, 3d6kh2 | @{disadvantage}, 3d6kl2 } + @{charinfluence} ]]}}"></button>

          <span class="label secondary-font" data-i18n="accuracy">Precisão</span>
          <input name="attr_characcuracy" type="number" title="{@characcuracy}" />
          <button type="roll" class="roll-button" name="roll_accuracy_check" title="{@accuracy_check}"
            value="&{template:main} {{charname=@{character_name}}} {{check=@{accuracy}}} {{target=[[9]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 2d6 | @{advantage}, 3d6kh2 | @{disadvantage}, 3d6kl2 } + @{characcuracy} ]]}}"></button>

          <span class="label secondary-font" data-i18n="defense">Defesa</span>
          <input name="attr_chardefense" type="number" title="{@chardefense}" />
          <button type="roll" class="roll-button" name="roll_defense_check" title="{@defense_check}"
            value="&{template:main} {{charname=@{character_name}}} {{check=@{defense}}} {{target=[[9]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 2d6 | @{advantage}, 3d6kh2 | @{disadvantage}, 3d6kl2 } + @{chardefense} ]]}}"></button>

          <span class="label secondary-font" data-i18n="reason">Razão</span>
          <input name="attr_charreason" type="number" title="{@charreason}" />
          <button type="roll" class="roll-button" name="roll_reason_check" title="{@reason_check}"
            value="&{template:main} {{charname=@{character_name}}} {{check=@{reason}}} {{target=[[9]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 2d6 | @{advantage}, 3d6kh2 | @{disadvantage}, 3d6kl2 } + @{charreason} ]]}}"></button>

        </div>

      </div>

    </div>

  </div>

  <!-- Conditions -->
  <div class="flex-column box">

    <span class="main-font box-title" data-i18n="conditions">Condições</span>

    <div class="conditions-row">

      <div class="condition-box">

        <input class="condition-checkbox" type="checkbox" name="attr_stunned" title="{@stunned}" />

        <span class="label secondary-font" data-i18n="stunned">Atordoado</span>
      </div>

      <div class="condition-box">

        <input class="condition-checkbox" type="checkbox" name="attr_shaken" title="{@shaken}" />

        <span class="label secondary-font" data-i18n="shaken">Abalado</span>
      </div>

      <div class="condition-box">

        <input class="condition-checkbox" type="checkbox" name="attr_hurt" title="{@hurt}" />

        <span class="label secondary-font" data-i18n="hurt">Machucado</span>
      </div>



      <div class="condition-box">

        <input class="condition-checkbox" type="checkbox" name="attr_injured" title="{@injured}" />

        <span class="label secondary-font" data-i18n="injured">Ferido</span>
      </div>

      <div class="condition-box">

        <input class="condition-checkbox" type="checkbox" name="attr_defeated" title="{@defeated}" />

        <span class="label secondary-font" data-i18n="defeated">Derrotado</span>
      </div>
    </div>
  </div>

  <div class="box flex-column">

    <span class="box-title main-font" data-i18n="powers">Poderes</span>

    <fieldset class="repeating_powers">

      <div class="repeatable-item">
        <div class="repeatable-row">
          <input name="attr_power" type="text" data-i18n-placeholder="power" placeholder="Poder" />
        </div>

      </div>

    </fieldset>

  </div>

  <div class="box notes">

    <span class="box-title main-font" data-i18n="notes">Anotações</span>
    <textarea name="attr_notes" title="{@notes}"></textarea>

  </div>



  <!-- Footer -->
  <div class="footer secondary-font">
    <span data-i18n="copyright">Heróis de Electrum é um jogo escrito por Gilberto “Joka” Olimpio no selo Mundos
      Colidem.</span>
  </div>

</div>

<!-- end of sheet -->

<!-- Roll Templates -->
<rolltemplate class="sheet-rolltemplate-main">
  <div class="template-container">
    <div class="template-row template-header template-label secondary-font">
      {{charname}}
    </div>

    {{#action}}
    <div class="template-row">
      <span class="template-label secondary-font">{{action}}</span>
      {{#text}}
      <p>{{text}}</p>
      {{/text}}

    </div>
    {{/action}}

    {{#check}}
    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="check">Teste</span>
      {{check}}
    </div>
    {{/check}}

    {{#result}}

    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="result">Resultado</span>
      {{result}}
    </div>

    {{#^rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-success" data-i18n="success">Sucesso!</span>
    </div>
    {{/^rollLess() result target}}

    {{#rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-fail" data-i18n="fail">Falha!</span>
    </div>
    {{/rollLess() result target}}

    {{/result}}

  </div>

</rolltemplate>

<!-- Strings translations for Roll Queries-->
<div style="display: none;">
  <span data-i18n="advantagedisadvantage">Possui vantagem ou desvantagem?</span>
  <span data-i18n="no">Não</span>
  <span data-i18n="advantage">Vantagem</span>
  <span data-i18n="disadvantage">Desvantagem</span>
  <span data-i18n="result">Resultado</span>
  <span data-i18n="success">Sucesso!</span>
  <span data-i18n="fail">Falha!</span>
  <span data-i18n="critic">Sucesso Crítico!</span>
  <span data-i18n="fumble">Falha Crítica!</span>
  <span data-i18n="check">Teste</span>
</div>

<!--Sheet Workers -->
<script type="text/worker">

  /*config Roll Queries translations */
  on("sheet:opened", function(eventInfo){
      
      setAttrs({
          advantagedisadvantage: getTranslationByKey("advantagedisadvantage"),
          no: getTranslationByKey("no"),
          advantage: getTranslationByKey("advantage"),
          disadvantage: getTranslationByKey("disadvantage"),
          result: getTranslationByKey("result"),
          check: getTranslationByKey("check"),
          power: getTranslationByKey("power"),
          influence: getTranslationByKey("influence"),
          accuracy: getTranslationByKey("accuracy"),
          defense: getTranslationByKey("defense"),
          reason: getTranslationByKey("reason")
      });     
      
  });

  /*keep attributes values at 13 max*/
  on("change:charbody change:charmind change:charcharisma change:charcuriosity change:charsurvival", function(eventInfo) {  
    const maxValue = 13;
    let oldValue = parseInt(eventInfo.previousValue)||0;
    let newValue = parseInt(eventInfo.newValue)||0;
    let attribute = eventInfo.sourceAttribute;
    let changedAttributes = new Object();
    
    changedAttributes[attribute] = maxValue;
    
    if (newValue > maxValue) {
  
      changedAttributes[attribute] = maxValue;
      setAttrs(changedAttributes);
    }
     
  });

  /*controls roll buttons when char has a condition checked*/
  on("change:wounded change:shaken change:ashamed", function(eventInfo) {  
    const disadvantage = "disadvantage";
    const normal = "normal";
    const sourceAttribute = eventInfo.sourceAttribute;
    const newValue = eventInfo.newValue;
    let changedAttributes = new Object();
    let controlToUpdate = sourceAttribute + "control";
    
    changedAttributes[controlToUpdate] = normal;

    switch(newValue) {
      case "on":
        changedAttributes[controlToUpdate] = disadvantage;
        break;
      default:
        changedAttributes[controlToUpdate] = normal;
    }
    
    setAttrs(changedAttributes);
     
  });
  
  
</script>