<div class="sheet-container">
	<div class="sheet-float sheet-head">
		<div class="sheet-float sheet-head-logo">
			<img class="sheet-logo" src="https://img.anzahcraft.de/logo-roll20.png" alt="AnzahCraft" />
			<div class="sheet-gmroll">
				<select name="attr_gmroll">
					<option value="nogm" selected="selected">Für alle sichtbar w&uuml;rfeln</option>
					<option value="gm">Für GM w&uuml;rfeln</option>
				</select>
				<input type="hidden" name="attr_abilityroll" />
			</div>
		</div>


		<div class="sheet-float sheet-head-info">
			<div class="sheet-header">
				<span>Allgemeines</span>
			</div>
			<div class="sheet-float sheet-head-info-boxes">
				<div class="sheet-formular">
					<label for="attr_character_name">Charaktername</label>
					<input class="sheet-bottomspace" type="text" name="attr_character_name" />
				</div>
				<div class="sheet-formular">
					<label for="attr_character_description">Beschreibung</label>
					<textarea name="attr_character_description" style="height: 102px;"></textarea>
				</div>
			</div>
			<div class="sheet-float sheet-head-info-sideboxes">
				<div class="sheet-formular">
					<button type="roll" class="sheet-small-button" name="roll_schicksalRoll"
						value="Die Gruppe hat jetzt noch [[@{schicksal} ?{Modifier?|+/-}]] Schicksalspunkte">Schicksal</button>
					<input type="number" name="attr_schicksal" value="4" class="sheet-number-20" />
				</div>
				<div class="sheet-formular">
					<label for="attr_exp">EXP</label>
					<input type="number" name="attr_exp" value="0" class="sheet-number-20" />
				</div>
				<div class="sheet-formular">
					<button type="roll" class="sheet-small-button" name="roll_schicksalRoll"
						value="/w gm @{character_name} stellt sich dem Karma: [[1d10cf<@{karma}]]">Karma</button>
					<input type="number" name="attr_karma" value="0" class="sheet-number-20" />
				</div>
			</div>
			<div class="sheet-head-stats">
				<div class="sheet-formular">
					<label for="attr_leben">Leben</label>
					<div class="sheet-head-stats-health">
						<input type="number" class="sheet-number-20" name="attr_leben" placeholder="Aktuell" /> / <input
							type="number" class="sheet-number-20" name="attr_leben_max" readonly />
					</div>
				</div>
				<div class="sheet-formular">
					<label for="attr_verteidigung">Verteidigung</label>
					<input type="number" id="attr_verteidigung" name="attr_verteidigung" class="sheet-number-20"
						readonly />
				</div>
				<div class="sheet-formular">
					<label for="attr_bewegung">Mana</label>
					<div class="sheet-head-stats-mana">
						<input type="number" class="sheet-number-20" name="attr_mana" placeholder="Aktuell" /> / <input
							type="number" class="sheet-number-20" name="attr_mana_max" readonly />
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-break"></div>

	<div class="sheet-float sheet-half sheet-attribut">
		<div class="sheet-header">
			<span>Attribute</span>
		</div>
		<div class="sheet-float sheet-attribut-stats">
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_NaRoll"
					value="@{abilityroll} versucht sich in Nahkampf [[@{Na}d10 + ?{Modifier?|0}]]">Nahkampf</button>
				<input type="number" name="attr_Na" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_FeRoll"
					value="@{abilityroll} versucht sich in Fernkampf [[@{Fe}d10 + ?{Modifier?|0}]]">Fernkampf</button>
				<input type="number" name="attr_Fe" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_GeRoll"
					value="@{abilityroll} versucht sich in Geschick [[@{Ge}d10 + ?{Modifier?|0}]]">Geschick</button>
				<input type="number" name="attr_Ge" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_WaRoll"
					value="@{abilityroll} versucht sich in Wahrnehmung [[@{Wa}d10 + ?{Modifier?|0}]]">Wahrnehmung</button>
				<input type="number" name="attr_Wa" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_KoRoll"
					value="@{abilityroll} versucht sich in Konstitution [[@{Ko}d10 + ?{Modifier?|0}]]">Konstitution</button>
				<input type="number" name="attr_Ko" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_InRoll"
					value="@{abilityroll} versucht sich in Intelligenz [[@{In}d10 + ?{Modifier?|0}]]">Intelligenz</button>
				<input type="number" name="attr_In" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_WiRoll"
					value="@{abilityroll} versucht sich in Wissen [[@{Wi}d10 + ?{Modifier?|0}]]">Wissen</button>
				<input type="number" name="attr_Wi" value="1" min="1" class="sheet-number-20" />
			</div>
			<div class="sheet-float sheet-formular">
				<button type="roll" class="sheet-small-button" name="roll_CaRoll"
					value="@{abilityroll} versucht sich in Charisma [[@{Ca}d10 + ?{Modifier?|0}]]">Charisma</button>
				<input type="number" name="attr_Ca" value="1" min="1" class="sheet-number-20" />
			</div>
		</div>
	</div>

	<div class="sheet-float sheet-half sheet-aspects">
		<div class="sheet-header">
			<span>Aspekte</span>
		</div>
		<input type="text" name="attr_aspekt1" />
		<input type="text" name="attr_aspekt2" />
		<input type="text" name="attr_aspekt3" />
		<input type="text" name="attr_aspekt4" />
		<fieldset class="repeating_aspekte">
			<input type="text" name="attr_aspekt" />
		</fieldset>
	</div>

	<div class="sheet-break"></div>

	<div class="sheet-float sheet-full sheet-skills">
		<div class="sheet-header">
			<span>Fertigkeiten</span>
		</div>
		<div class="sheet-grid">
			<div>Fertigkeit</div>
			<div>Attr.</div>
			<div>Wert</div>
			<div>MOD</div>
			<div>PP</div>
			<div>Roll</div>
		</div>
		<div class="sheet-gridplace">

			<div class="repcontainer" data-groupname="repeating_basicskills">
				<div class="repitem" data-reprowid="-LqmJZp6DZSuTu37ytv5">
					<div><input class="sheet-textcenter" type="text" name="attr_statikskillname1" value="Ansehen" />
					</div>
					<div>-</div>
					<div><input type="number" name="attr_statikskill1" value="0"></div>
					<div><input type="number" name="attr_statikskill1_mod" value="0"></div>
					<div>-</div>
					<div><button type="roll" name="roll_statikskill1"
							value="@{abilityroll} würfelt auf @{statikskillname1} mit dem Ergebnis [[{1d10! + @{statikskill1} + @{statikskill1_mod} + ?{Modifier?|0},{(@{statikskill1} + 1) * 10}}kl1]]"
							class="btn ui-draggable"></button></div>
				</div>
			</div>

			<div class="repcontainer" data-groupname="repeating_basicskills">
				<div class="repitem" data-reprowid="-LqmJZp6DZSuTu37ytv5">
					<div><input class="sheet-textcenter" type="text" name="attr_statikskillname2" value="Vermögen" />
					</div>
					<div>-</div>
					<div><input type="number" name="attr_statikskill2" value="0"></div>
					<div><input type="number" name="attr_statikskill2_mod" value="0"></div>
					<div>-</div>
					<div><button type="roll" name="roll_statikskill2"
							value="@{abilityroll} würfelt auf @{statikskillname2} mit dem Ergebnis [[{1d10! + @{statikskill2} + @{statikskill2_mod} + ?{Modifier?|0},{(@{statikskill2} + 1) * 10}}kl1]]"
							class="btn ui-draggable"></button></div>
				</div>
			</div>

			<fieldset class="repeating_basicskills">
				<div><input class="sheet-textcenter" type="text" name="attr_skillname" /></div>
				<div>
					<select name="attr_attribut">
						<option value="@{Na}">Nahkampf</option>
						<option value="@{Fe}">Fernkampf</option>
						<option value="@{Ge}">Geschick</option>
						<option value="@{Wa}">Wahrnehmung</option>
						<option value="@{Ko}">Konstitution</option>
						<option value="@{in}">Intelligenz</option>
						<option value="@{Wi}">Wissen</option>
						<option value="@{Ca}">Charisma</option>
					</select>
				</div>
				<div><input type="number" name="attr_skill" value="0" /></div>
				<div><input type="number" name="attr_skill_mod" value="0" /></div>
				<div><input type="number" name="attr_pp" value="0" /></div>
				<div><button type="roll" name="roll_skill"
						value="@{abilityroll} würfelt auf @{skillname} mit dem Ergebnis [[{@{attribut}d10! + @{skill} + @{skill_mod} + ?{Modifier?|0},{(@{skill} + 1) * 10}}kl1]]"></button>
				</div>
			</fieldset>
		</div>
	</div>

	<div class="sheet-break"></div>

	<div class="sheet-float sheet-full sheet-skills">
		<div class="sheet-header">
			<span>Waffen</span>
		</div>
		<div class="sheet-grid">
			<div>Waffe</div>
			<div>Attr.</div>
			<div>Wert</div>
			<div>MOD</div>
			<div>Dmg</div>
			<div>Roll</div>
		</div>
		<div class="sheet-gridplace">
			<fieldset class="repeating_waponskills">
				<div><input class="sheet-textcenter" type="text" name="attr_weaponname"></div>
				<div>
					<select name="attr_attribut">
						<option value="@{Na}">Nahkampf</option>
						<option value="@{Fe}">Fernkampf</option>
					</select>
				</div>
				<div><input type="number" name="attr_weaponskill" value="0"></div>
				<div><input type="number" name="attr_weaponskill_mod" value="0"></div>
				<div><input type="number" name="attr_weapondmg" value="0"></div>
				<div><button type="roll" name="roll_skill"
						value="@{abilityroll} benutzt @{weaponname} mit dem Ergebnis [[{@{attribut}d10! + @{weaponskill} + @{weaponskill_mod} + ?{Modifier?|0},{(@{weaponskill} + 1) * 10}}kl1]] und einem Waffenschaden von [[@{weapondmg}]]"
						class="btn ui-draggable"></button>
				</div>
			</fieldset>
		</div>
	</div>

	<div class="sheet-break"></div>

	<div class="sheet-float sheet-half sheet-stunts">
		<div class="sheet-header">
			<span>Stunts</span>
		</div>
		<fieldset class="repeating_stunts">
			<div>
				<input type="text" name="attr_stunt" placeholder="Name" />
				<textarea name="attr_description" placeholder="Beschriebung"></textarea>
			</div>
		</fieldset>
	</div>

	<div class="sheet-float sheet-half sheet-inventar">
		<div class="sheet-header">
			<span>Inventar</span>
		</div>
		<div class="sheet-ruestung">
			<input type="text" name="attr_ruestungName" placeholder="Rüstungsart" />
			<input type="number" name="attr_ruestungGeschick" placeholder="Max. Geschickbonus" />
			<input type="number" name="attr_ruestung" placeholder="Rüstungsbonus" />
		</div>
		<fieldset class="repeating_extras">
			<div class="sheet-options sheet-extras-row">
				<input type="text" name="attr_name" placeholder="Gegenstand" />
				<input type="text" name="attr_wight" placeholder="Gewicht" />
				<input type="text" name="attr_costs" placeholder="Anzahl" />
				<textarea name="attr_description" placeholder="Beschreibung"></textarea>
			</div>
		</fieldset>
	</div>

	<div class="sheet-break"></div>

	<div class="sheet-float sheet-fill sheet-notes">
		<div class="sheet-header">
			<span>Notizen</span>
		</div>
		<fieldset class="repeating_notes">
			<div class="sheet-options sheet-notes-row">
				<input type="text" name="attr_title" placeholder="Titel" />
				<textarea name="attr_body" placeholder="Inhalt"></textarea>
			</div>

		</fieldset>
	</div>
</div>


<!-- worker scripts -->
<script type="text/worker">
//https://wiki.roll20.net/Sheet_Worker_Scripts#change:.3Cattribute_name.3E
on("change:gmroll", function(f) {
	getAttrs(["gmroll"], function(v) {
		let rollstring = "/me";
		if (v.gmroll == "nogm")  {
			rollstring = "/me";
		} else if (v.gmroll == "gm") {
			rollstring = "/w GM **@{character_name}**";
		}
		setAttrs({
			abilityroll: rollstring
		});
	});
});

on("change:ko", function() {
	getAttrs(["ko"], function(values) {
		setAttrs({
			leben: Math.floor(10 + parseInt(values.ko) * 5)
		});
		setAttrs({
			leben_max: Math.floor(10 + parseInt(values.ko) * 5)
		});
	});
});

on("change:in", function() {
	getAttrs(["in"], function(values) {
		setAttrs({
			mana: Math.floor(10 + parseInt(values.in) * 10)
		});
		setAttrs({
			mana_max: Math.floor(10 + parseInt(values.in) * 10)
		});
	});
});

on("change:ge change:ruestung change:ruestungGeschick", function() {
	getAttrs(["ge", "ruestung", "ruestungGeschick"], function(values) {
		if (values.ge < values.ruestungGeschick) {
			setAttrs({
				verteidigung: Math.floor(parseInt(values.ge) * 3 + parseInt(values.ruestung))
			});
		} else {
			setAttrs({
				verteidigung: Math.floor(parseInt(values.ruestungGeschick) * 3 + parseInt(values.ruestung))
			});
		}
	});
});
</script>