<!-- ====== SHEET TABS ====== -->
  <div class="sheet-tabs">
  <!-- Radio buttons for tab control -->
  <input type="radio" id="tab-main" name="sheet-tab" checked />
  <input type="radio" id="tab-unique" name="sheet-tab" />
  <input type="radio" id="tab-battle" name="sheet-tab" />

  <!-- Labels for tabs -->
  <div class="tab-labels">
    <label for="tab-main">Main</label>
    <label for="tab-unique">Unique Powers</label>
    <label for="tab-battle">Battle Tracker</label>
  </div>
  <!-- Tab content wrapper ensures reliable sibling selection -->
  <div class="tab-views">

  <!-- ===== Main Tab Content ===== -->
  <div class="sheet-tab-content sheet-main" id="panel-main">

    <!-- ===== Overview Block ===== -->
    <div class="block overview-block">
      <div class="overview-columns">

        <!-- Left Column -->
<div class="overview-column left-column">
  
  <label>Superhero Name:</label>
  <input type="text" name="attr_character_name" />
  
  <label>Alter Ego:</label>
  <input type="text" name="attr_alterego_name" />
  
  <!-- Energy Reserve -->
  <label>Energy Reserve:</label>
  <div class="energy-reserve-row" style="display:flex; align-items:center; gap:6px; margin-top:4px;">
    <input type="number" name="attr_energy_reserve" readonly style="width:40px;" />
    <span>/</span>
    <input type="number" name="attr_energy_reserve_max" readonly style="width:40px;" />
  </div>
</div>

        <!-- Right Column -->
<div class="overview-column right-column">
  <label>Player Name:</label>
  <input type="text" name="attr_player_name" />

  <label>Hero Level:</label>
  <input type="number" name="attr_hero_level" />

  <label>HP:</label>
  <div class="hp-row" style="display: flex; align-items: center; gap: 4px;">
    <input type="number" name="attr_current_hp" style="width: 50px;" /> /
    <input type="number" name="attr_max_hp" style="width: 50px;" />
  </div>

  <!-- Total Energy -->
<div class="total-energy-row" style="margin-top: 4px;">
  <label>Total Energy:</label>
  <div style="display: flex; align-items: center; gap: 4px; margin-top: 2px;">
    <input type="number" name="attr_total_energy" readonly style="width: 50px;" /> /
    <input type="number" name="attr_total_energy_max" readonly style="width: 50px;" />
  </div>
</div>

      </div>
    </div>

    <!-- ===== Skills Block ===== -->
    <div class="sheet-block skills-block">
      <h2>Skills</h2>
      <div class="skills-column">
        <!-- Coax -->
        <div class="skill">
          <button type="roll" name="roll_coax" value="&{template:default} {{name=Coax}} {{Roll=[[1@{coax_die}]]}}">Coax</button>
          <select name="attr_coax_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Glory -->
        <div class="skill">
          <button type="roll" name="roll_glory" value="&{template:default} {{name=Glory}} {{Roll=[[1@{glory_die}]]}}">Glory</button>
          <select name="attr_glory_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Guts -->
        <div class="skill">
          <button type="roll" name="roll_guts" value="&{template:default} {{name=Guts}} {{Roll=[[1@{guts_die}]]}}">Guts</button>
          <select name="attr_guts_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Knowledge -->
        <div class="skill">
          <button type="roll" name="roll_knowledge" value="&{template:default} {{name=Knowledge}} {{Roll=[[1@{knowledge_die}]]}}">Knowledge</button>
          <select name="attr_knowledge_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Lie -->
        <div class="skill">
          <button type="roll" name="roll_lie" value="&{template:default} {{name=Lie}} {{Roll=[[1@{lie_die}]]}}">Lie</button>
          <select name="attr_lie_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Might -->
        <div class="skill">
          <button type="roll" name="roll_might" value="&{template:default} {{name=Might}} {{Roll=[[1@{might_die}]]}}">Might</button>
          <select name="attr_might_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Ready -->
        <div class="skill">
          <button type="roll" name="roll_ready" value="&{template:default} {{name=Ready}} {{Roll=[[1@{ready_die}]]}}">Ready</button>
          <select name="attr_ready_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Spirit -->
        <div class="skill">
          <button type="roll" name="roll_spirit" value="&{template:default} {{name=Spirit}} {{Roll=[[1@{spirit_die}]]}}">Spirit</button>
          <select name="attr_spirit_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Vision -->
        <div class="skill">
          <button type="roll" name="roll_vision" value="&{template:default} {{name=Vision}} {{Roll=[[1@{vision_die}]]}}">Vision</button>
          <select name="attr_vision_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Swift -->
        <div class="skill">
          <button type="roll" name="roll_swift" value="&{template:default} {{name=Swift}} {{Roll=[[1@{swift_die}]]}}">Swift</button>
          <select name="attr_swift_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Investigate -->
        <div class="skill">
          <button type="roll" name="roll_investigate" value="&{template:default} {{name=Investigate}} {{Roll=[[1@{investigate_die}]]}}">Investigate</button>
          <select name="attr_investigate_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Street Smarts -->
        <div class="skill">
          <button type="roll" name="roll_street_smarts" value="&{template:default} {{name=Street Smarts}} {{Roll=[[1@{street_smarts_die}]]}}">Street Smarts</button>
          <select name="attr_street_smarts_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
        <!-- Sneak -->
        <div class="skill">
          <button type="roll" name="roll_sneak" value="&{template:default} {{name=Sneak}} {{Roll=[[1@{sneak_die}]]}}">Sneak</button>
          <select name="attr_sneak_die">
            <option value="d-">d-</option><option value="d4">d4</option><option value="d6">d6</option>
            <option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option>
            <option value="d16">d16</option><option value="d20">d20</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ===== Personal Block ===== -->
    <div class="personal-block">
      <div class="personal-left">
        <label for="appearance">Appearance</label>
        <textarea name="attr_appearance"></textarea>

        <label for="inventory">Inventory</label>
        <textarea name="attr_inventory"></textarea>
      </div>

      <div class="personal-right">
        <label for="source">Source</label>
        <select name="attr_source">
          <option value="Perk Description.">Choose One</option>
          <option value="Superior: Add one EP to all inherent powers">Alien</option>
          <option value="Divine Spark: Once between every recovery rest, during combat, you may activate your divine spark. During the next two rounds, PAs cost no energy.">Divine</option>
          <option value="Next Step: For branching powers you only have to succeed on one godly check to adopt new abilities.">Evolution</option>
          <option value="Swirling Tides: You may change your Unique Powers EPs once per day in preparation for a battle. It takes an hour.">Magic</option>
          <option value="Help From Home: Three times in the rest of the current campaign, you may call a “d4 ally” to aid you, or once during the rest of your campaign you may build and call a “level 3 hero” to your aid.A recharge of this ability as well as the level of the ally or hero may be negotiated with GD.">Mentor/ Organization</option>
          <option value="Nature’s Aid: Gain the companionship of a natural companion. An animal or spirit that has 4 EPs. It fills one of your unique power slots, and it gains one function. Whether or not this companion can be killed, dispatched or leave, is up to the discretion of you and your GD. Do not include this companion as a power when calculating your number of powers for choosing perks on the Hero’s Path at levels 1 and 3.">Nature</option>
          <option value="Enhanced Modification: On your skill list one of your d12s becomes a d20, and one of your d10s becomes a d12.">Science</option>
          <option value="Bootstraps: When calculating death points multiply the EPs you have assigned to resilience by three instead of two.">Self</option>
          <option value="Safe House: You gain a safe house. The safe house has full plot armor. It cannot be found or infiltrated by enemies unless they are invited or brought to it by you or your fellow heroes.">Wealth</option>
        </select>

        <label for="source_perk">Source Perk</label>
        <textarea name="attr_source" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{attr_source}"
                  placeholder="Description will appear here"></textarea>
                  
        <label for="source_well">Source Well</label>
        <input type="text" name="attr_source_well" />


        <div class="downtime-tracker">
          <h3>Downtime Tracker</h3>
          <label>Follow Threads</label><input type="number" name="attr_follow_threads" />
          <label>Patrol</label><input type="number" name="attr_patrol" />
          <label>Rest</label><input type="number" name="attr_rest" />
          <label>Train</label><input type="number" name="attr_train" />
          <label>Unmasked</label><input type="number" name="attr_unmasked" />
        </div>

        <div class="quick-guide">
          <h2>Hero's Quick Guide</h2>
          <div class="quick-columns">
            <div class="quick-column">
              <strong>Power Functions</strong>
              <p>A = Attack</p>
              <p>D = Defense</p>
              <p>M = Movement</p>
              <p>S = Support</p>
            </div>
            <div class="quick-column">
              <strong>Power Die</strong>
              <p>1-3 EPs: d4</p>
              <p>4-6 EPs: d6</p>
              <p>7-9 EPs: d8</p>
              <p>10-12 EPs: d10</p>
              <p>13-15 EPs: d12</p>
              <p>16-19 EPs: d16</p>
              <p>Over 20 EPs: d20</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== Inherent Powers ===== -->
<div class="inherent-powers">
  <h2>Inherent Powers</h2>
  <label style="display: inline-block; vertical-align: middle;">
    <input type="checkbox" name="attr_precision" value="1">
    Precision
  </label>
  <div class="power-cards">
    <!-- Strength Power Block -->
    <div class="inherent-power strength">
      <h3>Strength</h3>
      <div class="power-functions">
        <label><input type="checkbox" name="attr_strength_attack" /> A</label>
        <label><input type="checkbox" name="attr_strength_defend" /> D</label>
        <label><input type="checkbox" name="attr_strength_movement" /> M</label>
      </div>
      <div class="energy-points">
        <label>Energy Points:</label>
        <input type="number" name="attr_strength_current_ep" style="width: 40px;" /> /
        <input type="number" name="attr_strength_max_ep" style="width: 40px;" />
      </div>
      <div class="power-die">
        <label>Power Die:</label>
        <select name="attr_strength_die">
          <option value="">-</option>
          <option value="1d4">d4</option>
          <option value="1d6">d6</option>
          <option value="1d8">d8</option>
          <option value="1d10">d10</option>
          <option value="1d12">d12</option>
          <option value="1d16">d16</option>
          <option value="1d20">d20</option>
        </select>
      </div>
      <button type="roll" value="!strength-roll --charid @{character_id} --precision @{precision}">Roll Strength</button>
      <div class="permanent-bonus">
        <label>Permanent Bonus:</label>
        <span>+</span><input type="number" name="attr_strength_bonus" style="width: 40px;" />
      </div>
      <div class="range-type">
        <label><input type="checkbox" name="attr_strength_range_type" value="Ranged" /> Ranged</label>
        <label><input type="checkbox" name="attr_strength_range_type" value="Close Up" /> Close Up</label>
      </div>
      <div class="range-movement">
        <label>Range (Ls):</label><input type="number" name="attr_strength_range" />
        <label>Movement (Ls):</label><input type="number" name="attr_strength_movement_ls" />
      </div>
      <div class="notes-attributes">
        <label>Notes & Attributes:</label>
        <textarea name="attr_strength_notes" rows="3"></textarea>
      </div>
    </div>

    <!-- Speed Power Block -->
    <div class="inherent-power speed">
      <h3>Speed</h3>
      <div class="power-functions">
        <label><input type="checkbox" name="attr_speed_attack" /> A</label>
        <label><input type="checkbox" name="attr_speed_movement" /> M</label>
      </div>
      <div class="energy-points">
        <label>Energy Points:</label>
        <input type="number" name="attr_speed_current_ep" style="width: 40px;" /> /
        <input type="number" name="attr_speed_max_ep" style="width: 40px;" />
      </div>
      <div class="power-die">
        <label>Power Die:</label>
        <select name="attr_speed_die">
          <option value="">-</option>
          <option value="1d4">d4</option>
          <option value="1d6">d6</option>
          <option value="1d8">d8</option>
          <option value="1d10">d10</option>
          <option value="1d12">d12</option>
          <option value="1d16">d16</option>
          <option value="1d20">d20</option>
        </select>
      </div>
      <button type="roll" value="!speed-roll --charid @{character_id} --precision @{precision}">Roll Speed</button>
      <div class="permanent-bonus">
        <label>Permanent Bonus:</label>
        <span>+</span><input type="number" name="attr_speed_bonus" style="width: 40px;" />
      </div>
      <div class="range-type">
        <label><input type="checkbox" name="attr_speed_range_type" value="Ranged" /> Ranged</label>
        <label><input type="checkbox" name="attr_speed_range_type" value="Close Up" /> Close Up</label>
      </div>
      <div class="range-movement">
        <label>Range (Ls):</label><input type="number" name="attr_speed_range" />
        <label>Movement (Ls):</label><input type="number" name="attr_speed_movement_ls" />
      </div>
      <div class="notes-attributes">
        <label>Notes & Attributes:</label>
        <textarea name="attr_speed_notes" rows="3"></textarea>
      </div>
    </div>

    <!-- Resilience Power Block -->
    <div class="inherent-power resilience">
      <h3>Resilience</h3>
      <div class="energy-points">
        <label>Energy Points:</label>
        <input type="number" name="attr_resilience_current_ep" style="width: 40px;" /> /
        <input type="number" name="attr_resilience_max_ep" style="width: 40px;" />
      </div>
      <div class="power-die">
        <label>Power Die:</label>
        <select name="attr_resilience_die">
          <option value="">-</option>
          <option value="1d4">d4</option>
          <option value="1d6">d6</option>
          <option value="1d8">d8</option>
          <option value="1d10">d10</option>
          <option value="1d12">d12</option>
          <option value="1d16">d16</option>
          <option value="1d20">d20</option>
        </select>
      </div>
      <button type="roll" name="roll_resilience"
        value='!resilience-roll --charid @{character_id}'>Roll Resilience</button>
      <div class="permanent-bonus">
        <label>Permanent Bonus:</label>
        <span>+</span><input type="number" name="attr_resilience_bonus" style="width: 40px;" />
      </div>
      <div class="death-points">
        <label>Death Points:</label>
        <input type="number" name="attr_resilience_current_dp" style="width: 40px;" /> /
        <input type="number" name="attr_resilience_max_dp" style="width: 40px;" />
      </div>
    </div>
  </div>
</div>

</div> <!-- end Main Tab -->
<!-- close the panel-main container properly so following tabs are siblings -->
</div>

<!-- ===== Unique Powers Tab ===== -->
<div class="sheet-tab-content sheet-unique" id="panel-unique">

<!-- Unique Powers Container -->
<div class="unique-powers-container">
  <h3 style="display: inline-block; margin-right: 10px;">Unique Powers</h3>
  <label style="display: inline-block; vertical-align: middle;">
    <input type="checkbox" name="attr_precision" value="1">
    Precision
  </label>
</div>

    <div class="power-cards">

      <!-- Unique Power 1 -->
      <div class="inherent-power unique-power">
        <h3><input type="text" name="attr_unique_power_1_name" value="Unique Power 1" style="width: 120px;" /></h3>

        <div class="power-functions">
          <label><input type="checkbox" name="attr_unique_power_1_attack" /> A</label>
          <label><input type="checkbox" name="attr_unique_power_1_defend" /> D</label>
          <label><input type="checkbox" name="attr_unique_power_1_movement" /> M</label>
          <label><input type="checkbox" name="attr_unique_power_1_support" /> S</label>
        </div>

        <div class="energy-points">
          <label>Energy Points:</label>
          <input type="number" name="attr_unique_power_1_current_ep" style="width: 40px;" /> /
          <input type="number" name="attr_unique_power_1_max_ep" style="width: 40px;" />
        </div>

        <div class="power-die">
          <label>Power Die:</label>
          <select name="attr_unique_power_1_die">
            <option value="">-</option>
            <option value="1d4">d4</option>
            <option value="1d6">d6</option>
            <option value="1d8">d8</option>
            <option value="1d10">d10</option>
            <option value="1d12">d12</option>
            <option value="1d16">d16</option>
            <option value="1d20">d20</option>
          </select>
        </div>

        <div class="permanent-bonus">
          <label>Permanent Bonus:</label>
          <span>+</span><input type="number" name="attr_unique_power_1_bonus" style="width: 40px;" />
        </div>
        <button type="roll" value="!unique1-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

        <div class="range-type">
          <label><input type="checkbox" name="attr_unique_power_1_range_type" value="Ranged" /> Ranged</label>
          <label><input type="checkbox" name="attr_unique_power_1_range_type" value="Close Up" /> Close Up</label>
        </div>

        <div class="range-movement">
          <label>Range (Ls):</label><input type="number" name="attr_unique_power_1_range" />
          <label>Movement (Ls):</label><input type="number" name="attr_unique_power_1_movement_ls" />
         <div class="support-pool">
  <label>Support Pool:</label>
  <input type="number" name="attr_unique_power_1_support_pool_current" /> /
  <input type="number" name="attr_unique_power_1_support_pool_max" />
</div>

        </div>

        <div class="notes-attributes">
          <label>Notes & Attributes:</label>
          <textarea name="attr_unique_power_1_notes" rows="3"></textarea>
        </div>
      </div>

      <!-- Unique Power 2 -->
      <div class="inherent-power unique-power">
        <h3><input type="text" name="attr_unique_power_2_name" value="Unique Power 2" style="width: 120px;" /></h3>

        <div class="power-functions">
          <label><input type="checkbox" name="attr_unique_power_2_attack" /> A</label>
          <label><input type="checkbox" name="attr_unique_power_2_defend" /> D</label>
          <label><input type="checkbox" name="attr_unique_power_2_movement" /> M</label>
          <label><input type="checkbox" name="attr_unique_power_2_support" /> S</label>
        </div>

        <div class="energy-points">
          <label>Energy Points:</label>
          <input type="number" name="attr_unique_power_2_current_ep" style="width: 40px;" /> /
          <input type="number" name="attr_unique_power_2_max_ep" style="width: 40px;" />
        </div>

        <div class="power-die">
          <label>Power Die:</label>
          <select name="attr_unique_power_2_die">
            <option value="">-</option>
            <option value="1d4">d4</option>
            <option value="1d6">d6</option>
            <option value="1d8">d8</option>
            <option value="1d10">d10</option>
            <option value="1d12">d12</option>
            <option value="1d16">d16</option>
            <option value="1d20">d20</option>
          </select>
        </div>

        <div class="permanent-bonus">
          <label>Permanent Bonus:</label>
          <span>+</span><input type="number" name="attr_unique_power_2_bonus" style="width: 40px;" />
        </div>
        <button type="roll" value="!unique-power-2-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

        <div class="range-type">
          <label><input type="checkbox" name="attr_unique_power_2_range_type" value="Ranged" /> Ranged</label>
          <label><input type="checkbox" name="attr_unique_power_2_range_type" value="Close Up" /> Close Up</label>
        </div>

        <div class="range-movement">
          <label>Range (Ls):</label><input type="number" name="attr_unique_power_2_range" />
          <label>Movement (Ls):</label><input type="number" name="attr_unique_power_2_movement_ls" />
          <div class="support-pool">
  <label>Support Pool:</label>
  <input type="number" name="attr_unique_power_2_support_pool_current" /> /
  <input type="number" name="attr_unique_power_2_support_pool_max" />
</div>

        </div>

        <div class="notes-attributes">
          <label>Notes & Attributes:</label>
          <textarea name="attr_unique_power_2_notes" rows="3"></textarea>
        </div>
      </div>

      <!-- Unique Power 3 -->
      <div class="inherent-power unique-power">
        <h3><input type="text" name="attr_unique_power_3_name" value="Unique Power 3" style="width: 120px;" /></h3>

        <div class="power-functions">
          <label><input type="checkbox" name="attr_unique_power_3_attack" /> A</label>
          <label><input type="checkbox" name="attr_unique_power_3_defend" /> D</label>
          <label><input type="checkbox" name="attr_unique_power_3_movement" /> M</label>
          <label><input type="checkbox" name="attr_unique_power_3_support" /> S</label>
        </div>

        <div class="energy-points">
          <label>Energy Points:</label>
          <input type="number" name="attr_unique_power_3_current_ep" style="width: 40px;" /> /
          <input type="number" name="attr_unique_power_3_max_ep" style="width: 40px;" />
        </div>

        <div class="power-die">
          <label>Power Die:</label>
          <select name="attr_unique_power_3_die">
            <option value="">-</option>
            <option value="1d4">d4</option>
            <option value="1d6">d6</option>
            <option value="1d8">d8</option>
            <option value="1d10">d10</option>
            <option value="1d12">d12</option>
            <option value="1d16">d16</option>
            <option value="1d20">d20</option>
          </select>
        </div>

        <div class="permanent-bonus">
          <label>Permanent Bonus:</label>
          <span>+</span><input type="number" name="attr_unique_power_3_bonus" style="width: 40px;" />
        </div>
        <button type="roll" value="!unique-power-3-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

        <div class="range-type">
          <label><input type="checkbox" name="attr_unique_power_3_range_type" value="Ranged" /> Ranged</label>
          <label><input type="checkbox" name="attr_unique_power_3_range_type" value="Close Up" /> Close Up</label>
        </div>

        <div class="range-movement">
          <label>Range (Ls):</label><input type="number" name="attr_unique_power_3_range" />
          <label>Movement (Ls):</label><input type="number" name="attr_unique_power_3_movement_ls" />
          <div class="support-pool">
  <label>Support Pool:</label>
  <input type="number" name="attr_unique_power_3_support_pool_current" /> /
  <input type="number" name="attr_unique_power_3_support_pool_max" />
</div>

        </div>

        <div class="notes-attributes">
          <label>Notes & Attributes:</label>
          <textarea name="attr_unique_power_3_notes" rows="3"></textarea>
        </div>
      </div>

      <!-- Unique Power 4 -->
      <div class="inherent-power unique-power">
        <h3><input type="text" name="attr_unique_power_4_name" value="Unique Power 4" style="width: 120px;" /></h3>

        <div class="power-functions">
          <label><input type="checkbox" name="attr_unique_power_4_attack" /> A</label>
          <label><input type="checkbox" name="attr_unique_power_4_defend" /> D</label>
          <label><input type="checkbox" name="attr_unique_power_4_movement" /> M</label>
          <label><input type="checkbox" name="attr_unique_power_4_support" /> S</label>
        </div>

        <div class="energy-points">
          <label>Energy Points:</label>
          <input type="number" name="attr_unique_power_4_current_ep" style="width: 40px;" /> /
          <input type="number" name="attr_unique_power_4_max_ep" style="width: 40px;" />
        </div>

        <div class="power-die">
          <label>Power Die:</label>
          <select name="attr_unique_power_4_die">
            <option value="">-</option>
            <option value="1d4">d4</option>
            <option value="1d6">d6</option>
            <option value="1d8">d8</option>
            <option value="1d10">d10</option>
            <option value="1d12">d12</option>
            <option value="1d16">d16</option>
            <option value="1d20">d20</option>
          </select>
        </div>

        <div class="permanent-bonus">
          <label>Permanent Bonus:</label>
          <span>+</span><input type="number" name="attr_unique_power_4_bonus" style="width: 40px;" />
        </div>
        <button type="roll" value="!unique-power-4-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

        <div class="range-type">
          <label><input type="checkbox" name="attr_unique_power_4_range_type" value="Ranged" /> Ranged</label>
          <label><input type="checkbox" name="attr_unique_power_4_range_type" value="Close Up" /> Close Up</label>
        </div>

        <div class="range-movement">
          <label>Range (Ls):</label><input type="number" name="attr_unique_power_4_range" />
          <label>Movement (Ls):</label><input type="number" name="attr_unique_power_4_movement_ls" />
          <div class="support-pool">
  <label>Support Pool:</label>
  <input type="number" name="attr_unique_power_4_support_pool_current" /> /
  <input type="number" name="attr_unique_power_4_support_pool_max" />
</div>

        </div>

        <div class="notes-attributes">
          <label>Notes & Attributes:</label>
          <textarea name="attr_unique_power_4_notes" rows="3"></textarea>
        </div>
      </div>

      <!-- Unique Power 5 -->
      <div class="inherent-power unique-power">
        <h3><input type="text" name="attr_unique_power_5_name" value="Unique Power 5" style="width: 120px;" /></h3>

        <div class="power-functions">
          <label><input type="checkbox" name="attr_unique_power_5_attack" /> A</label>
          <label><input type="checkbox" name="attr_unique_power_5_defend" /> D</label>
          <label><input type="checkbox" name="attr_unique_power_5_movement" /> M</label>
          <label><input type="checkbox" name="attr_unique_power_5_support" /> S</label>
        </div>

        <div class="energy-points">
          <label>Energy Points:</label>
          <input type="number" name="attr_unique_power_5_current_ep" style="width: 40px;" /> /
          <input type="number" name="attr_unique_power_5_max_ep" style="width: 40px;" />
        </div>

        <div class="power-die">
          <label>Power Die:</label>
          <select name="attr_unique_power_5_die">
            <option value="">-</option>
            <option value="1d4">d4</option>
            <option value="1d6">d6</option>
            <option value="1d8">d8</option>
            <option value="1d10">d10</option>
            <option value="1d12">d12</option>
            <option value="1d16">d16</option>
            <option value="1d20">d20</option>
          </select>
        </div>

        <div class="permanent-bonus">
          <label>Permanent Bonus:</label>
          <span>+</span><input type="number" name="attr_unique_power_5_bonus" style="width: 40px;" />
        </div>
        <button type="roll" value="!unique-power-5-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

        <div class="range-type">
          <label><input type="checkbox" name="attr_unique_power_5_range_type" value="Ranged" /> Ranged</label>
          <label><input type="checkbox" name="attr_unique_power_5_range_type" value="Close Up" /> Close Up</label>
        </div>

        <div class="range-movement">
          <label>Range (Ls):</label><input type="number" name="attr_unique_power_5_range" />
          <label>Movement (Ls):</label><input type="number" name="attr_unique_power_5_movement_ls" />
          <div class="support-pool">
  <label>Support Pool:</label>
  <input type="number" name="attr_unique_power_5_support_pool_current" /> /
  <input type="number" name="attr_unique_power_5_support_pool_max" />
</div>

        </div>

        <div class="notes-attributes">
          <label>Notes & Attributes:</label>
          <textarea name="attr_unique_power_5_notes" rows="3"></textarea>
        </div>
      </div>

      <!-- Unique Power 6 -->
<div class="inherent-power unique-power">
  <h3><input type="text" name="attr_unique_power_6_name" value="Unique Power 6" style="width: 120px;" /></h3>

  <div class="power-functions">
    <label><input type="checkbox" name="attr_unique_power_6_attack" /> A</label>
    <label><input type="checkbox" name="attr_unique_power_6_defend" /> D</label>
    <label><input type="checkbox" name="attr_unique_power_6_movement" /> M</label>
    <label><input type="checkbox" name="attr_unique_power_6_support" /> S</label>
  </div>

  <div class="energy-points">
    <label>Energy Points:</label>
    <input type="number" name="attr_unique_power_6_current_ep" style="width: 40px;" /> /
    <input type="number" name="attr_unique_power_6_max_ep" style="width: 40px;" />
  </div>

  <div class="power-die">
    <label>Power Die:</label>
    <select name="attr_unique_power_6_die">
      <option value="">-</option>
      <option value="1d4">d4</option>
      <option value="1d6">d6</option>
      <option value="1d8">d8</option>
      <option value="1d10">d10</option>
      <option value="1d12">d12</option>
      <option value="1d16">d16</option>
      <option value="1d20">d20</option>
    </select>
  </div>

  <div class="permanent-bonus">
    <label>Permanent Bonus:</label>
    <span>+</span><input type="number" name="attr_unique_power_6_bonus" style="width: 40px;" />
  </div>
  <button type="roll" value="!unique-power-6-roll --charid @{character_id} --precision @{precision}">Roll Power Die</button>

  <div class="range-type">
    <label><input type="checkbox" name="attr_unique_power_6_range_type" value="Ranged" /> Ranged</label>
    <label><input type="checkbox" name="attr_unique_power_6_range_type" value="Close Up" /> Close Up</label>
  </div>

  <div class="range-movement">
    <label>Range (Ls):</label><input type="number" name="attr_unique_power_6_range" />
    <label>Movement (Ls):</label><input type="number" name="attr_unique_power_6_movement_ls" />
    <div class="support-pool">
      <label>Support Pool:</label>
      <input type="number" name="attr_unique_power_6_support_pool_current" /> /
      <input type="number" name="attr_unique_power_6_support_pool_max" />
    </div>
  </div>

  <div class="notes-attributes">
    <label>Notes & Attributes:</label>
    <textarea name="attr_unique_power_6_notes" rows="3"></textarea>
  </div> <!-- end Notes & Attributes -->

</div> <!-- end power card 6 -->

</div> <!-- end power-cards -->
</div> <!-- end unique-powers-container -->

</div> <!-- end sheet-tab-content sheet-unique -->


<!-- ===== Battle Tracker Tab ===== -->
<div class="sheet-tab-content sheet-battle" id="panel-battle">

  <!-- Battle Tracker -->
  <div class="battle-tracker">
    <h2>Battle Tracker</h2>

    <!-- Free Action and Round -->
<div class="battle-action-round">
  <label>
    <input type="checkbox" name="attr_free_action" value="1" /> Free Action
  </label>
  <label style="margin-left: 15px;">
    Round: <input type="number" name="attr_combat_round" value="1" style="width: 50px;" />
  </label>
  <button type="roll" name="reset_phases" value="!reset-phases --charid @{character_id}">
  New Round
</button>
</div>

    <div class="battle-columns">
      <!-- Phase 1 -->
      <div class="battle-phase">
        <h3>Phase 1</h3>
        <label><input type="checkbox" name="attr_phase1_action" value="Attack" /> Attack</label>
        <label><input type="checkbox" name="attr_phase1_action" value="Movement" /> Movement</label>
        <label><input type="checkbox" name="attr_phase1_action" value="Utility" /> Utility</label>
      </div>

      <!-- Phase 2 -->
      <div class="battle-phase">
        <h3>Phase 2</h3>
        <label><input type="checkbox" name="attr_phase2_action" value="Attack" /> Attack</label>
        <label><input type="checkbox" name="attr_phase2_action" value="Movement" /> Movement</label>
        <label><input type="checkbox" name="attr_phase2_action" value="Utility" /> Utility</label>
      </div>

      <!-- Phase 3 -->
      <div class="battle-phase">
        <h3>Phase 3</h3>
        <label><input type="checkbox" name="attr_phase3_action" value="Attack" /> Attack</label>
        <label><input type="checkbox" name="attr_phase3_action" value="Movement" /> Movement</label>
        <label><input type="checkbox" name="attr_phase3_action" value="Utility" /> Utility</label>
        <label><input type="checkbox" name="attr_phase3_action" value="Reaction" /> Reaction</label>
      </div>
    </div>
     
      <!-- Condition Tracker -->
<div class="condition-tracker">
  <h3>Condition Tracker</h3>

  <!-- Row 1 (always visible) -->
  <div id="condition-row-1" class="condition-detail-row" style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <div style="display: flex; flex-direction: column; gap: 5px;">
      <select name="attr_condition_1" style="min-width: 180px;">
        <option value="" selected>Select Condition</option>
        <option value="Can’t use reactions and all damage for attacks is rolled low.">Blinded</option>
        <option value="Damage for attacks against the frightening target is rolled low and a frightened creature can’t move toward the frightening target.">Frightened</option>
        <option value="Stunned creatures cannot use the movement actions.">Stunned</option>
        <option value="Restrained creatures can’t take actions.">Restrained</option>
        <option value="A weakened creature can not use their resilience die when hit with an attack.">Weakened</option>
        <option value="A slowed creature’s movement is halved. Also during a round they are limited to two actions instead of three.">Slowed</option>
        <option value="When a prone creature is attacked, the attacker rolls high. They must use 1L of their movement to get up before resuming the rest of their movement.">Prone</option>
        <option value="Your actions are controlled by the creature that has lulled you.">Lulled</option>
        <option value="The curser chooses if your attack rolls, defense rolls, movement or empowered check rolls will be subject to a subtraction. The subtraction equals half of the level of the curser.">Cursed</option>
        <option value="Take one damage every phase at the beginning of your phase until the marred condition ends.">Marred</option>
        <option value="One inherent or unique power is rendered inert and unusable while power is blocked.">Power Blocked</option>
      </select>
    </div>
    <div style="display: flex; flex-direction: column; gap: 5px; flex: 1;">
      <textarea name="attr_condition_1" readonly
                style="width: 100%; min-width: 400px; height: 4em; resize: none;"
                placeholder="Condition Effect"></textarea>
      <div style="display: flex; align-items: center; gap: 10px;">
        <label>
          Duration (Phases):
          <input type="number" name="attr_condition_1_duration" value="1" style="width: 50px;" />
        </label>
      </div>
    </div>
  </div>

  <!-- Row 2 controls -->
  <input type="radio" id="show-condition-2" name="condition2-toggle" style="display:none;">
  <input type="radio" id="hide-condition-2" name="condition2-toggle" style="display:none;" checked>
  <div class="condition2-controls" style="margin-bottom:5px;">
    <label for="show-condition-2" class="condition-toggle-label">Add Condition</label>
    <label for="hide-condition-2" class="condition-toggle-label">Remove Condition</label>
  </div>

  <!-- Row 2 (hidden by default) -->
  <div id="condition-row-2" class="condition-detail-row condition-hidden" style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <div style="display: flex; flex-direction: column; gap: 5px;">
      <select name="attr_condition_2" style="min-width: 180px;">
        <option value="" selected>Select Condition</option>
        <option value="Can’t use reactions and all damage for attacks is rolled low.">Blinded</option>
        <option value="Damage for attacks against the frightening target is rolled low and a frightened creature can’t move toward the frightening target.">Frightened</option>
        <option value="Stunned creatures cannot use the movement actions.">Stunned</option>
        <option value="Restrained creatures can’t take actions.">Restrained</option>
        <option value="A weakened creature can not use their resilience die when hit with an attack.">Weakened</option>
        <option value="A slowed creature’s movement is halved. Also during a round they are limited to two actions instead of three.">Slowed</option>
        <option value="When a prone creature is attacked, the attacker rolls high. They must use 1L of their movement to get up before resuming the rest of their movement.">Prone</option>
        <option value="Your actions are controlled by the creature that has lulled you.">Lulled</option>
        <option value="The curser chooses if your attack rolls, defense rolls, movement or empowered check rolls will be subject to a subtraction. The subtraction equals half of the level of the curser.">Cursed</option>
        <option value="Take one damage every phase at the beginning of your phase until the marred condition ends.">Marred</option>
        <option value="One inherent or unique power is rendered inert and unusable while power is blocked.">Power Blocked</option>
      </select>
    </div>
    <div style="display: flex; flex-direction: column; gap: 5px; flex: 1;">
      <textarea name="attr_condition_2" readonly
                style="width: 100%; min-width: 400px; height: 4em; resize: none;"
                placeholder="Condition Effect"></textarea>
      <div style="display: flex; align-items: center; gap: 10px;">
        <label>
          Duration (Phases):
          <input type="number" name="attr_condition_2_duration" value="1" style="width: 50px;" />
        </label>
      </div>
    </div>
  </div>

  <!-- Row 3 controls (shown only if Row 2 is visible) -->
  <input type="radio" id="show-condition-3" name="condition3-toggle" style="display:none;">
  <input type="radio" id="hide-condition-3" name="condition3-toggle" style="display:none;" checked>
  <div class="condition3-controls" style="margin-bottom:5px;">
    <label for="show-condition-3" class="condition-toggle-label">Add Condition</label>
    <label for="hide-condition-3" class="condition-toggle-label">Remove Condition</label>
  </div>

  <!-- Row 3 (hidden by default) -->
  <div id="condition-row-3" class="condition-detail-row condition-hidden" style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <div style="display: flex; flex-direction: column; gap: 5px;">
      <select name="attr_condition_3" style="min-width: 180px;">
        <option value="" selected>Select Condition</option>
        <option value="Can’t use reactions and all damage for attacks is rolled low.">Blinded</option>
        <option value="Damage for attacks against the frightening target is rolled low and a frightened creature can’t move toward the frightening target.">Frightened</option>
        <option value="Stunned creatures cannot use the movement actions.">Stunned</option>
        <option value="Restrained creatures can’t take actions.">Restrained</option>
        <option value="A weakened creature can not use their resilience die when hit with an attack.">Weakened</option>
        <option value="A slowed creature’s movement is halved. Also during a round they are limited to two actions instead of three.">Slowed</option>
        <option value="When a prone creature is attacked, the attacker rolls high. They must use 1L of their movement to get up before resuming the rest of their movement.">Prone</option>
        <option value="Your actions are controlled by the creature that has lulled you.">Lulled</option>
        <option value="The curser chooses if your attack rolls, defense rolls, movement or empowered check rolls will be subject to a subtraction. The subtraction equals half of the level of the curser.">Cursed</option>
        <option value="Take one damage every phase at the beginning of your phase until the marred condition ends.">Marred</option>
        <option value="One inherent or unique power is rendered inert and unusable while power is blocked.">Power Blocked</option>
      </select>
    </div>
    <div style="display: flex; flex-direction: column; gap: 5px; flex: 1;">
      <textarea name="attr_condition_3" readonly
                style="width: 100%; min-width: 400px; height: 4em; resize: none;"
                placeholder="Condition Effect"></textarea>
      <div style="display: flex; align-items: center; gap: 10px;">
        <label>
          Duration (Phases):
          <input type="number" name="attr_condition_3_duration" value="1" style="width: 50px;" />
        </label>
      </div>
    </div>
  </div>
</div>
</div>

  <!-- Hero's Notes -->
  <div class="notes">
    <h2>Hero's Notes</h2>
    <textarea name="attr_notes"></textarea>
  </div>

  <!-- Hero's Path -->
<div class="progression">
  <h2>Hero's Path</h2>

  <!-- Level 1 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 1</label><br>
        <!-- Level 1 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl1_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="When you roll your resilience power die to regain HP and your strength power die to gain energy after a recovery rest, you may roll them twice and take the total result. If you are rolling with the aid of medical professionals you may roll them four times.">Swift Recovery</option>
        <option value="You may roll get up checks as empowered skill checks with a unique power that suits the scenario or your resilience.">I’m Still Here</option>
        <option value="You have no defensive penalty to your roll when defending allies within 1 L of you.">Get Behind Me</option>
        <option value="You may roll high rather than low when rolling damage for pursuit attacks.">Avenger I</option>
        <option value="You get a bonus to your powers’ range. Rather than halving your EPs when calculating the range of your powers, the range of those powers’ attacks is triple the assigned EPs.">Farsight</option>
        <option value="All of your support pools are doubled.">Well of Life</option>
        <option value="If you are within 1L of any number of enemies and attempt to leave, you may do so without incurring a pursuit attack or a trap.">Unseen Escape</option>
        <option value="Your speed inherent power is tripled. For every EP assigned to speed, you gain 3 Ls. You may use the power die of the inherent power speed for damage rolls if you attack with speed.">Speedster</option>
        <option value="When calculating your HP, multiply the number of EPs in resilience by 5 instead of 4.">Tank I</option>
        <option value="Choose one of your powers (inherent or unique) to gain a +1 permanent bonus. The +1 bonus impacts powers with different functions as follows: Attack: add one to all attack rolls with the power; Defense: add one to all defensive rolls with the power; Movement: add one to the number of Ls you can move with the power; Support: add one to the support pool of the power; Resilience: add one to your max HP. If your power has two functions the permanent bonus affects both functions.">Permanent Bonus I</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl1_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl1_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

 <!-- Level 2 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 2</label><br>
        <!-- Level 2 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl2_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="Choose one of the skills to which you have assigned a d4. Increase that skill’s skill die to a d6. ">Skill Upgrade I</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power. ">Extra Power Attribute</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl2_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl2_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 3 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 3</label><br>
        <!-- Level 3 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl3_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="If you are incapacitated and making get-up checks, once per round, you may make a get-up check to use a reaction.If you succeed this get-up check, you lose energy points and death points as normal. You lose your third phase as normal if you used a reaction to make a get-up check.">Not Today</option>
        <option value="You may use power pips from your support pools to aid in the skill and empowered checks of an ally as long as the check aligns with your power and passes the GD’s discretion. You may do this during combat using a utility action or a reaction action.">Always Helpful</option>
        <option value="Once per round as a utility action,  you may move your place in the order to be able to enact a combo with an ally or a team-up with multiple allies.">Battlesense</option>
        <option value="When you use your reaction to defend, you may roll your defensive power die twice and take the higher of the two rolls.">Aegis</option>
        <option value="You may use your reaction to take full damage from an attack for an ally who was the target. If your body can get in between the attack and your target ally, all of the damage is done to you and then is subject to your resilience. You may move during this reaction to get to that space. The distance you can move during a “Selfless” reaction is equal to half of the EPs assigned to any of your movement powers.">Selfless I</option>
        <option value="As a utility action you may move a number of energy points from a creature within the range of your unique power with the most energy points to a different creature within that range including yourself. This Perk upgrades as you level up. The number of energy points is a D4 at lvl 3, a D6 at lvl 6, and D8 at lvl 10.Specify the power of your target you are taking the energy from. The creature you give the energy to may choose where the energy will go, but it must be to only one power, inherent or unique. This may allow EPs in that power to go above that power’s max EPs.">Flow I</option>
        <option value="If you use your reaction action to dodge an incoming enemy attack, you may add your swift skill die to your defensive roll.">We Can’t Hit ‘Em</option>
        <option value="It costs no energy to attack twice in one round. If you were to attack using your third phase it would still cost two energy.">Toe to Toe</option>
        <option value="When you use utility action to save non-combatants, you may save up to two non-combatants in that one phase.">Speedster II</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Choose one of the skills to which you have assigned a d6. Increase that skill’s skill die to a d8.">Skill Upgrade II</option>
        <option value="When you roll your resilience power die to regain HP and your strength power die to gain energy after a recovery rest, you may roll them twice and take the total result. If you are rolling with the aid of medical professionals you may roll them four times.">Swift Recovery (Lvl 1)</option>
        <option value="You may roll get up checks as empowered skill checks with a unique power that suits the scenario or your resilience.">I’m Still Here (Lvl 1)</option>
        <option value="You have no defensive penalty to your roll when defending allies within 1 L of you.">Get Behind Me (Lvl 1)</option>
        <option value="You may roll high rather than low when rolling damage for pursuit attacks.">Avenger I (Lvl 1)</option>
        <option value="You get a bonus to your powers’ range. Rather than halving your EPs when calculating the range of your powers, the range of those powers’ attacks is triple the assigned EPs.">Farsight (Lvl 1)</option>
        <option value="All of your support pools are doubled.">Well of Life (Lvl 1)</option>
        <option value="If you are within 1L of any number of enemies and attempt to leave, you may do so without incurring a pursuit attack or a trap.">Unseen Escape (Lvl 1)</option>
        <option value="Your speed inherent power is tripled. For every EP assigned to speed, you gain 3 Ls. You may use the power die of the inherent power speed for damage rolls if you attack with speed.">Speedster (Lvl 1)</option>
        <option value="When calculating your HP, multiply the number of EPs in resilience by 5 instead of 4.">Tank I (Lvl 1)</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl3_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl3_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

   <!-- Level 4 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 4</label><br>
        <!-- Level 4 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl4_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Choose one of the skills to which you have assigned a d8. Increase that skill’s skill die to a d10.">Skill Upgrade III</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl4_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl4_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 5 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 5</label><br>
        <!-- Level 5 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl5_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="If you use an attack action to bring an enemy to zero HP, you may use your reaction and a power with the attack function to make another attack to an enemy within range without spending EPs.As normal, using your reaction, you lose the action of the last phase.">Fish in a Barrel</option>
        <option value="You may use your reaction to buff or heal an ally with power pips from a support pool.">Last Ditch</option>
        <option value="If you take damage for an ally, you may add half the damage taken (rounded up) to the damage you do on your next attack. If you take damage from another attack before your turn, half of that damage overwrites the amount previously stored.">Selfless II</option>
        <option value="You may use a utility action to command an ally you can see to take a movement or attack action.The commanded action costs the ally no energy unless the attack action uses a power attribute. Then it uses the energy of the power attribute.">Captain</option>
        <option value="PAs cost one less energy point than they normally do.">Enhanced PAs I</option>
        <option value="At the beginning of combat, roll your resilience die. Add the number rolled to your HP as temporary hit points. If you still have the temporary HP when combat ends, lose them.">Tank II</option>
        <option value="Roll attack rolls high against any enemy that has done damage to you or your teammates.">Avenger II</option>
        <option value="If you have an open unique power slot, you may create a new power to fill that slot. You may give it EPs from the EPs you gain during the level up. If it is assigned the attack function you may gain a single PA for that power.">New Power</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Choose one of the skills to which you have assigned a d10. Increase that skill’s skill die to a d12.">Skill Upgrade IV</option>
        <option value="If you are incapacitated and making get-up checks, once per round, you may make a get-up check to use a reaction.If you succeed this get-up check, you lose energy points and death points as normal. You lose your third phase as normal if you used a reaction to make a get-up check.">Not Today (Lvl 3)</option>
        <option value="You may use power pips from your support pools to aid in the skill and empowered checks of an ally as long as the check aligns with your power and passes the GD’s discretion. You may do this during combat using a utility action or a reaction action.">Always Helpful (Lvl 3)</option>
        <option value="Once per round as a utility action,  you may move your place in the order to be able to enact a combo with an ally or a team-up with multiple allies.">Battlesense (Lvl 3)</option>
        <option value="When you use your reaction to defend, you may roll your defensive power die twice and take the higher of the two rolls.">Aegis (Lvl 3)</option>
        <option value="You may use your reaction to take full damage from an attack for an ally who was the target. If your body can get in between the attack and your target ally, all of the damage is done to you and then is subject to your resilience. You may move during this reaction to get to that space. The distance you can move during a “Selfless” reaction is equal to half of the EPs assigned to any of your movement powers.">Selfless I (Lvl 3)</option>
        <option value="As a utility action you may move a number of energy points from a creature within the range of your unique power with the most energy points to a different creature within that range including yourself. This Perk upgrades as you level up. The number of energy points is a D4 at lvl 3, a D6 at lvl 6, and D8 at lvl 10.Specify the power of your target you are taking the energy from. The creature you give the energy to may choose where the energy will go, but it must be to only one power, inherent or unique. This may allow EPs in that power to go above that power’s max EPs.">Flow I (Lvl 3)</option>
        <option value="If you use your reaction action to dodge an incoming enemy attack, you may add your swift skill die to your defensive roll.">We Can’t Hit ‘Em (Lvl 3)</option>
        <option value="It costs no energy to attack twice in one round. If you were to attack using your third phase it would still cost two energy.">Toe to Toe (Lvl 3)</option>
        <option value="When you use utility action to save non-combatants, you may save up to two non-combatants in that one phase.">Speedster II (Lvl 3)</option>
        <option value="When you roll your resilience power die to regain HP and your strength power die to gain energy after a recovery rest, you may roll them twice and take the total result. If you are rolling with the aid of medical professionals you may roll them four times.">Swift Recovery (Lvl 1)</option>
        <option value="You may roll get up checks as empowered skill checks with a unique power that suits the scenario or your resilience.">I’m Still Here (Lvl 1)</option>
        <option value="You have no defensive penalty to your roll when defending allies within 1 L of you.">Get Behind Me (Lvl 1)</option>
        <option value="You may roll high rather than low when rolling damage for pursuit attacks.">Avenger I (Lvl 1)</option>
        <option value="You get a bonus to your powers’ range. Rather than halving your EPs when calculating the range of your powers, the range of those powers’ attacks is triple the assigned EPs.">Farsight (Lvl 1)</option>
        <option value="All of your support pools are doubled.">Well of Life (Lvl 1)</option>
        <option value="If you are within 1L of any number of enemies and attempt to leave, you may do so without incurring a pursuit attack or a trap.">Unseen Escape (Lvl 1)</option>
        <option value="Your speed inherent power is tripled. For every EP assigned to speed, you gain 3 Ls. You may use the power die of the inherent power speed for damage rolls if you attack with speed.">Speedster (Lvl 1)</option>
        <option value="When calculating your HP, multiply the number of EPs in resilience by 5 instead of 4.">Tank I (Lvl 1)</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl5_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl5_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 6 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 6</label><br>
        <!-- Level 6 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl6_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Choose one of the skills to which you have assigned a d12. Increase that skill’s skill die to a d16.">Skill Upgrade V</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl6_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl6_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 7 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 7</label><br>
        <!-- Level 7 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl7_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="On your attack action phase you may move up to half of any movement power to close the distance between you and an enemy target. If you do, you may add power pips equal to the Ls you moved to that attack.">Beast Charge</option>
        <option value="You may redirect enemy attacks as your reaction. When an enemy attacks within the range of one of your defensive powers, defend and to perform a power clash as normal. You may then redirect the damage amount defended towards a target within the range of your defensive power. If there is damage over your defense you still take that difference in damage.">Redirection</option>
        <option value="When you are rolling defensive dice for a power clash and you roll greater than the attacker, you do the difference to the attacker as damage.">Counter Strike</option>
        <option value="When you defend against an attack, after you roll your defensive power die, you may store energy from that attack to use as power pips for future attack and defensive rolls. Store the amount of damage you defended as power pips tied to that power. You may then use those power pips as buffs to attack or defensive rolls with that power. If you choose to contain energy in this way, you must store the entire amount of damage you blocked as power pips. Add any amount of these stored power pips to a future attack or defensive roll with this power. However, if the energy you store gets too high it will begin to hurt you. If the number of stored power pips reaches five, you begin to take a single damage every one of your phases at the beginning of the phase until the power pips are discharged. If the number of stored power pips reaches ten, you begin to take two damage every one of your phases at the beginning of the phase until the power pips are discharged. If you take stored power pips that are not discharged out of combat, you take that amount of damage after a minute of in-game time.">Contain and Discharge</option>
        <option value="If you start your attack phase hidden you may add a number of bonus power pips to the damage of your current attack. The number of Power Pips equals your current level.">Unseen Strike</option>
        <option value="You may now stack up to two PAs in one attack.Add the damage thresholds of both of the PAs. If you meet the threshold both effects are triggered. If you don’t meet the threshold, then choose one of the PAs to trigger. The energy cost of the PAs is the cost of the PA with a higher energy cost.">Enhanced PAs II</option>
        <option value="If you are brought to below 4 HP because you’ve taken damage for an ally, roll your resilience power die and add your roll  back to your current HP. If you would’ve been incapacitated due to reaching zero because of this attack, you are instead not incapacitated and gain the HP rolled on your resilience power die.">Selfless III</option>
        <option value="Every time you take energy points from an enemy they lose an equal amount of HP. This damage is not subject to their resilience.Every time you give energy points to an ally they gain an equal amount of HP. ">Flow II</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Choose one of the skills to which you have assigned a d16. Increase that skill’s skill die to a d20.">Skill Upgrade VI</option>
        <option value="If you use an attack action to bring an enemy to zero HP, you may use your reaction and a power with the attack function to make another attack to an enemy within range without spending EPs.As normal, using your reaction, you lose the action of the last phase.">Fish in a Barrel (Lvl 5)</option>
        <option value="You may use your reaction to buff or heal an ally with power pips from a support pool.">Last Ditch (Lvl 5)</option>
        <option value="If you take damage for an ally, you may add half the damage taken (rounded up) to the damage you do on your next attack. If you take damage from another attack before your turn, half of that damage overwrites the amount previously stored.">Selfless II (Lvl 5)</option>
        <option value="You may use a utility action to command an ally you can see to take a movement or attack action.The commanded action costs the ally no energy unless the attack action uses a power attribute. Then it uses the energy of the power attribute.">Captain (Lvl 5)</option>
        <option value="PAs cost one less energy point than they normally do.">Enhanced PAs I (Lvl 5)</option>
        <option value="At the beginning of combat, roll your resilience die. Add the number rolled to your HP as temporary hit points. If you still have the temporary HP when combat ends, lose them.">Tank II (Lvl 5)</option>
        <option value="Roll attack rolls high against any enemy that has done damage to you or your teammates.">Avenger II (Lvl 5)</option>
        <option value="If you have an open unique power slot, you may create a new power to fill that slot. You may give it EPs from the EPs you gain during the level up. If it is assigned the attack function you may gain a single PA for that power.">New Power (Lvl 5)</option>
        <option value="If you are incapacitated and making get-up checks, once per round, you may make a get-up check to use a reaction.If you succeed this get-up check, you lose energy points and death points as normal. You lose your third phase as normal if you used a reaction to make a get-up check.">Not Today (Lvl 3)</option>
        <option value="You may use power pips from your support pools to aid in the skill and empowered checks of an ally as long as the check aligns with your power and passes the GD’s discretion. You may do this during combat using a utility action or a reaction action.">Always Helpful (Lvl 3)</option>
        <option value="Once per round as a utility action,  you may move your place in the order to be able to enact a combo with an ally or a team-up with multiple allies.">Battlesense (Lvl 3)</option>
        <option value="When you use your reaction to defend, you may roll your defensive power die twice and take the higher of the two rolls.">Aegis (Lvl 3)</option>
        <option value="You may use your reaction to take full damage from an attack for an ally who was the target. If your body can get in between the attack and your target ally, all of the damage is done to you and then is subject to your resilience. You may move during this reaction to get to that space. The distance you can move during a “Selfless” reaction is equal to half of the EPs assigned to any of your movement powers.">Selfless I (Lvl 3)</option>
        <option value="As a utility action you may move a number of energy points from a creature within the range of your unique power with the most energy points to a different creature within that range including yourself. This Perk upgrades as you level up. The number of energy points is a D4 at lvl 3, a D6 at lvl 6, and D8 at lvl 10.Specify the power of your target you are taking the energy from. The creature you give the energy to may choose where the energy will go, but it must be to only one power, inherent or unique. This may allow EPs in that power to go above that power’s max EPs.">Flow I (Lvl 3)</option>
        <option value="If you use your reaction action to dodge an incoming enemy attack, you may add your swift skill die to your defensive roll.">We Can’t Hit ‘Em (Lvl 3)</option>
        <option value="It costs no energy to attack twice in one round. If you were to attack using your third phase it would still cost two energy.">Toe to Toe (Lvl 3)</option>
        <option value="When you use utility action to save non-combatants, you may save up to two non-combatants in that one phase.">Speedster II (Lvl 3)</option>
        <option value="When you roll your resilience power die to regain HP and your strength power die to gain energy after a recovery rest, you may roll them twice and take the total result. If you are rolling with the aid of medical professionals you may roll them four times.">Swift Recovery (Lvl 1)</option>
        <option value="You may roll get up checks as empowered skill checks with a unique power that suits the scenario or your resilience.">I’m Still Here (Lvl 1)</option>
        <option value="You have no defensive penalty to your roll when defending allies within 1 L of you.">Get Behind Me (Lvl 1)</option>
        <option value="You may roll high rather than low when rolling damage for pursuit attacks.">Avenger I (Lvl 1)</option>
        <option value="You get a bonus to your powers’ range. Rather than halving your EPs when calculating the range of your powers, the range of those powers’ attacks is triple the assigned EPs.">Farsight (Lvl 1)</option>
        <option value="All of your support pools are doubled.">Well of Life (Lvl 1)</option>
        <option value="If you are within 1L of any number of enemies and attempt to leave, you may do so without incurring a pursuit attack or a trap.">Unseen Escape (Lvl 1)</option>
        <option value="Your speed inherent power is tripled. For every EP assigned to speed, you gain 3 Ls. You may use the power die of the inherent power speed for damage rolls if you attack with speed.">Speedster (Lvl 1)</option>
        <option value="When calculating your HP, multiply the number of EPs in resilience by 5 instead of 4.">Tank I (Lvl 1)</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl7_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl7_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 8 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 8</label><br>
        <!-- Level 8 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl8_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Take the next level of Skill Upgrade.">Skill Upgrade VII</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl8_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl8_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 9 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 9</label><br>
        <!-- Level 9 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl9_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="Increase a current permanent bonus by one OR take Permanent Bonus I.">Permanent Bonus</option>
        <option value="Gain a power attribute of your choosing and assign it to a single power.">Extra Power Attribute</option>
        <option value="If you have noted a branching power attempt, you may now act as though that power has been successfully branched.">Branching Power Fulfilled</option>
        <option value="Take the next level of Skill Upgrade.">Skill Upgrade VIII</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl9_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl9_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

  <!-- Level 10 Perk Selector with Description Box -->
<div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
    <!-- Dropdown -->
    <div style="flex-shrink: 0;">
        <label>Level 10</label><br>
        <!-- Level 10 Perk Selection and Description -->
<div style="display: flex; align-items: flex-start; gap: 10px;">
    <select name="attr_lvl10_perk" style="width: 200px;">
        <option value="">Choose One</option>
        <option value="You do not halve your resilience power die when rolling resilience after taking damage.">Tank III</option>
        <option value="When you take damage you may add one power pip to the damage roll of a power of your choosing and maintain it until the current combat ends. These power pips may stack.">Rage Monster</option>
        <option value="If you forgo using an action in your first phase of a given combat round and use your second phase to perform an attack action, you may add bonus power pips to that attack. The number of power pips is equal to the maximum number rollable of the power die in use. This can stack with your Ultimate.">Deep Breath</option>
        <option value="In the course of a round you gain the use of a second reaction if the second reaction is used to defend an ally. If you do, add power pips equal to half your level to the defensive roll.">Savior</option>
        <option value="You always get to use an action during the third phase even if you used your reaction in the first two phases.">Make the Hard Call</option>
        <option value="When you take energy points from an enemy’s power using Flow I, their max EP in that power is also reduced. This will change the power’s stats depending on its functions. The power die will go down, the movement and range will go down, etc…The maximum amount you are able to take away from a power’s max EP is 8. The power’s max EP does not recover until a recovery rest. ">Flow III</option>
        <option value="You may use two reactions during a single round.">Unseen Action</option>
        <option value="If you reduce an enemy to below 4 HP with your attack action, you may take a second attack immediately without an EP cost. For the second attack, you must use the same power with which you made the initial attack.">Killing Blow</option>
        <option value="Within one round, you may split up your movement to happen with your other actions. Example: If you’ve assigned 10EPs to movement, you have a movement of 30Ls. You now can split up those 30Ls between your actionsBefore your attack action you can move 5Ls.Before your utility actions you can move 5Ls. This means you have 20Ls left for your movement action. In the phase you choose to use your movement action it can only be movement. You may even move before a reaction action. Once you use your entire movement you are exhausted and can’t move until the next round.">Speedster III</option>
        <option value="If an enemy has brought you or any of your teammates down to 0 HP you may double your damage rolls against that enemy.">Avenger III</option>
        <option value="If you have an open unique power slot, you may create a new power to fill that slot. You may give it EPs from the EPs you gain during the level up. If it is assigned the attack function you may gain a single PA for that power.">New Power</option>
        <option value="Take the next level of Skill Upgrade.">Skill Upgrade IX</option>
        <option value="On your attack action phase you may move up to half of any movement power to close the distance between you and an enemy target. If you do, you may add power pips equal to the Ls you moved to that attack.">Beast Charge (Lvl 7)</option>
        <option value="You may redirect enemy attacks as your reaction. When an enemy attacks within the range of one of your defensive powers, defend and to perform a power clash as normal. You may then redirect the damage amount defended towards a target within the range of your defensive power. If there is damage over your defense you still take that difference in damage.">Redirection (Lvl 7)</option>
        <option value="When you are rolling defensive dice for a power clash and you roll greater than the attacker, you do the difference to the attacker as damage.">Counter Strike (Lvl 7)</option>
        <option value="When you defend against an attack, after you roll your defensive power die, you may store energy from that attack to use as power pips for future attack and defensive rolls. Store the amount of damage you defended as power pips tied to that power. You may then use those power pips as buffs to attack or defensive rolls with that power. If you choose to contain energy in this way, you must store the entire amount of damage you blocked as power pips. Add any amount of these stored power pips to a future attack or defensive roll with this power. However, if the energy you store gets too high it will begin to hurt you. If the number of stored power pips reaches five, you begin to take a single damage every one of your phases at the beginning of the phase until the power pips are discharged. If the number of stored power pips reaches ten, you begin to take two damage every one of your phases at the beginning of the phase until the power pips are discharged. If you take stored power pips that are not discharged out of combat, you take that amount of damage after a minute of in-game time.">Contain and Discharge (Lvl 7)</option>
        <option value="If you start your attack phase hidden you may add a number of bonus power pips to the damage of your current attack. The number of Power Pips equals your current level.">Unseen Strike (Lvl 7)</option>
        <option value="You may now stack up to two PAs in one attack.Add the damage thresholds of both of the PAs. If you meet the threshold both effects are triggered. If you don’t meet the threshold, then choose one of the PAs to trigger. The energy cost of the PAs is the cost of the PA with a higher energy cost.">Enhanced PAs II (Lvl 7)</option>
        <option value="If you are brought to below 4 HP because you’ve taken damage for an ally, roll your resilience power die and add your roll  back to your current HP. If you would’ve been incapacitated due to reaching zero because of this attack, you are instead not incapacitated and gain the HP rolled on your resilience power die.">Selfless III (Lvl 7)</option>
        <option value="Every time you take energy points from an enemy they lose an equal amount of HP. This damage is not subject to their resilience.Every time you give energy points to an ally they gain an equal amount of HP. ">Flow II (Lvl 7)</option>
        <option value="If you use an attack action to bring an enemy to zero HP, you may use your reaction and a power with the attack function to make another attack to an enemy within range without spending EPs.As normal, using your reaction, you lose the action of the last phase.">Fish in a Barrel (Lvl 5)</option>
        <option value="You may use your reaction to buff or heal an ally with power pips from a support pool.">Last Ditch (Lvl 5)</option>
        <option value="If you take damage for an ally, you may add half the damage taken (rounded up) to the damage you do on your next attack. If you take damage from another attack before your turn, half of that damage overwrites the amount previously stored.">Selfless II (Lvl 5)</option>
        <option value="You may use a utility action to command an ally you can see to take a movement or attack action.The commanded action costs the ally no energy unless the attack action uses a power attribute. Then it uses the energy of the power attribute.">Captain (Lvl 5)</option>
        <option value="PAs cost one less energy point than they normally do.">Enhanced PAs I (Lvl 5)</option>
        <option value="At the beginning of combat, roll your resilience die. Add the number rolled to your HP as temporary hit points. If you still have the temporary HP when combat ends, lose them.">Tank II (Lvl 5)</option>
        <option value="Roll attack rolls high against any enemy that has done damage to you or your teammates.">Avenger II (Lvl 5)</option>
        <option value="If you have an open unique power slot, you may create a new power to fill that slot. You may give it EPs from the EPs you gain during the level up. If it is assigned the attack function you may gain a single PA for that power.">New Power (Lvl 5)</option>
        <option value="If you are incapacitated and making get-up checks, once per round, you may make a get-up check to use a reaction.If you succeed this get-up check, you lose energy points and death points as normal. You lose your third phase as normal if you used a reaction to make a get-up check.">Not Today (Lvl 3)</option>
        <option value="You may use power pips from your support pools to aid in the skill and empowered checks of an ally as long as the check aligns with your power and passes the GD’s discretion. You may do this during combat using a utility action or a reaction action.">Always Helpful (Lvl 3)</option>
        <option value="Once per round as a utility action,  you may move your place in the order to be able to enact a combo with an ally or a team-up with multiple allies.">Battlesense (Lvl 3)</option>
        <option value="When you use your reaction to defend, you may roll your defensive power die twice and take the higher of the two rolls.">Aegis (Lvl 3)</option>
        <option value="You may use your reaction to take full damage from an attack for an ally who was the target. If your body can get in between the attack and your target ally, all of the damage is done to you and then is subject to your resilience. You may move during this reaction to get to that space. The distance you can move during a “Selfless” reaction is equal to half of the EPs assigned to any of your movement powers.">Selfless I (Lvl 3)</option>
        <option value="As a utility action you may move a number of energy points from a creature within the range of your unique power with the most energy points to a different creature within that range including yourself. This Perk upgrades as you level up. The number of energy points is a D4 at lvl 3, a D6 at lvl 6, and D8 at lvl 10.Specify the power of your target you are taking the energy from. The creature you give the energy to may choose where the energy will go, but it must be to only one power, inherent or unique. This may allow EPs in that power to go above that power’s max EPs.">Flow I (Lvl 3)</option>
        <option value="If you use your reaction action to dodge an incoming enemy attack, you may add your swift skill die to your defensive roll.">We Can’t Hit ‘Em (Lvl 3)</option>
        <option value="It costs no energy to attack twice in one round. If you were to attack using your third phase it would still cost two energy.">Toe to Toe (Lvl 3)</option>
        <option value="When you use utility action to save non-combatants, you may save up to two non-combatants in that one phase.">Speedster II (Lvl 3)</option>
        <option value="When you roll your resilience power die to regain HP and your strength power die to gain energy after a recovery rest, you may roll them twice and take the total result. If you are rolling with the aid of medical professionals you may roll them four times.">Swift Recovery (Lvl 1)</option>
        <option value="You may roll get up checks as empowered skill checks with a unique power that suits the scenario or your resilience.">I’m Still Here (Lvl 1)</option>
        <option value="You have no defensive penalty to your roll when defending allies within 1 L of you.">Get Behind Me (Lvl 1)</option>
        <option value="You may roll high rather than low when rolling damage for pursuit attacks.">Avenger I (Lvl 1)</option>
        <option value="You get a bonus to your powers’ range. Rather than halving your EPs when calculating the range of your powers, the range of those powers’ attacks is triple the assigned EPs.">Farsight (Lvl 1)</option>
        <option value="All of your support pools are doubled.">Well of Life (Lvl 1)</option>
        <option value="If you are within 1L of any number of enemies and attempt to leave, you may do so without incurring a pursuit attack or a trap.">Unseen Escape (Lvl 1)</option>
        <option value="Your speed inherent power is tripled. For every EP assigned to speed, you gain 3 Ls. You may use the power die of the inherent power speed for damage rolls if you attack with speed.">Speedster (Lvl 1)</option>
        <option value="When calculating your HP, multiply the number of EPs in resilience by 5 instead of 4.">Tank I (Lvl 1)</option>
    </select>

    <!-- Description Box -->
    <div style="flex-grow: 1;">
        <textarea name="attr_lvl10_perk" readonly
                  style="width: 100%; height: 4em; resize: none;"
                  value="@{lvl10_perk|max}"
                  placeholder="Description will appear here"></textarea>
    </div>
</div>

</div> <!-- end progression -->

</div> <!-- end sheet-tab-content sheet-battle -->

    <!-- removed stray extra closing div that kept panel-main open across tabs -->
  </div> <!-- end .tab-views -->
  </div> <!-- end .sheet-tabs -->


  <!-- Local preview tab toggling with verbose console logs (ignored by Roll20 on import) -->
  <script>
  (function() {
    try {
      var DEBUG = true;
      var dlog = function(){ try { if (DEBUG && window.console) console.log.apply(console, ['[tabs]'].concat([].slice.call(arguments))); } catch(e){} };
      var radios = document.querySelectorAll('.sheet-tabs input[type="radio"][name="sheet-tab"]');
      var labels = document.querySelectorAll('.sheet-tabs .tab-labels label[for]');
      function show(which) {
        dlog('show()', 'which=', which);
        document.querySelectorAll('.sheet-tab-content').forEach(function(el){
          el.classList.remove('is-visible');
          try { el.style.setProperty('display','none','important'); } catch(_) { el.style.display='none'; }
        });
        var byId = document.getElementById('panel-' + which);
        var el = byId || document.querySelector('.sheet-tab-content.sheet-' + which);
        if (!el) { dlog('show()', 'panel not found for', which); return; }
        el.classList.add('is-visible');
        try { el.style.setProperty('display','block','important'); } catch(_) { el.style.display='block'; }
        try {
          var cs = getComputedStyle(el).display;
          var rect = el.getBoundingClientRect();
          dlog('show()', 'computed display', cs, 'rect', {x:rect.x,y:rect.y,w:rect.width,h:rect.height});
          // Walk ancestors to find any hidden container
          var a = el, chain=[];
          while (a) {
            var tag = a.tagName ? a.tagName.toLowerCase() : 'doc';
            var id  = a.id ? ('#'+a.id) : '';
            var cl  = a.className ? ('.'+String(a.className).replace(/\s+/g,'.')) : '';
            var cst;
            try { cst = getComputedStyle(a).display; } catch(_) { cst = 'n/a'; }
            chain.push(tag+id+cl+' => '+cst);
            if (a.classList && a.classList.contains('sheet-tabs')) break;
            a = a.parentNode;
          }
          dlog('ancestors', chain);
        } catch(e) { dlog('show()', 'computedStyle error', e); }
      }
      function idToName(id){ return (id||'').replace(/^tab-/, ''); }
      // Expose for manual console testing
      try { window.__show = show; } catch(e){}

      // Wire label clicks
      labels.forEach(function(lab){
        lab.addEventListener('click', function(ev){
          var forId = lab.getAttribute('for');
          dlog('label.click', 'for=', forId);
          var input = document.getElementById(forId);
          // let native label->radio behavior run first
          setTimeout(function(){
            if (input) { input.checked = true; dlog('label.click -> checked', input.id); }
            var which = idToName(forId);
            show(which);
            dlog('after label.click, state=', Array.prototype.map.call(radios, function(r){return r.id+':'+r.checked;}));
          }, 0);
        });
      });
      // Extra delegation to catch clicks anywhere inside labels container
      var labelsContainer = document.querySelector('.sheet-tabs .tab-labels');
      if (labelsContainer) {
        labelsContainer.addEventListener('click', function(e){
          var target = e.target && e.target.closest('label[for]');
          if (!target) return;
          var forId = target.getAttribute('for');
          dlog('container.click', 'for=', forId);
        });
      }

      // Wire radio changes
      radios.forEach(function(inp){
        dlog('radio.init', inp.id, 'checked=', inp.checked);
        inp.addEventListener('change', function(){
          var which = idToName(inp.id);
          dlog('radio.change', inp.id, '->', which, 'checked=', inp.checked);
          show(which);
        });
      });

      // Initial render
      var checked = document.querySelector('.sheet-tabs input[type="radio"][name="sheet-tab"]:checked');
      var initial = idToName(checked && checked.id || 'tab-main');
      dlog('init', 'radios=', radios.length, 'labels=', labels.length, 'initial=', initial);
      show(initial);

      // One-time dump after paint
      setTimeout(function(){
        try {
          var states = Array.prototype.map.call(document.querySelectorAll('.sheet-tab-content'), function(el){
            return {cls: el.className, inline: el.style.display, computed: getComputedStyle(el).display};
          });
          var rads = Array.prototype.map.call(radios, function(r){ return {id: r.id, checked: r.checked}; });
          dlog('post-init state', {panels: states, radios: rads});
        } catch(e) { dlog('dump error', e); }
      }, 50);
    } catch(e) { try { console.error('[tabs] init error', e); } catch(_){} }
  })();
  </script>

<script type="text/worker">
(function() {
    'use strict';

    // --- Energy Reserve & Total Energy ---
    function updateEnergyValues() {
        getAttrs([
            // Base powers
            "strength_current_ep","strength_max_ep",
            "speed_current_ep","speed_max_ep",
            "resilience_current_ep","resilience_max_ep",
            // Unique powers
            "unique_power_1_current_ep","unique_power_1_max_ep",
            "unique_power_2_current_ep","unique_power_2_max_ep",
            "unique_power_3_current_ep","unique_power_3_max_ep",
            "unique_power_4_current_ep","unique_power_4_max_ep",
            "unique_power_5_current_ep","unique_power_5_max_ep",
            "unique_power_6_current_ep","unique_power_6_max_ep"
        ], function(values) {
            // --- Energy Reserve (unchanged) ---
            var energyReserveCur = (parseInt(values.strength_current_ep,10) || 0)
                                 + (parseInt(values.speed_current_ep,10) || 0)
                                 + (parseInt(values.resilience_current_ep,10) || 0);

            var energyReserveMax = (parseInt(values.strength_max_ep,10) || 0)
                                 + (parseInt(values.speed_max_ep,10) || 0)
                                 + (parseInt(values.resilience_max_ep,10) || 0);

            // --- Total Energy (includes Unique Powers) ---
            var totalCur = energyReserveCur
                         + (parseInt(values.unique_power_1_current_ep,10) || 0)
                         + (parseInt(values.unique_power_2_current_ep,10) || 0)
                         + (parseInt(values.unique_power_3_current_ep,10) || 0)
                         + (parseInt(values.unique_power_4_current_ep,10) || 0)
                         + (parseInt(values.unique_power_5_current_ep,10) || 0)
                         + (parseInt(values.unique_power_6_current_ep,10) || 0);

            var totalMax = energyReserveMax
                         + (parseInt(values.unique_power_1_max_ep,10) || 0)
                         + (parseInt(values.unique_power_2_max_ep,10) || 0)
                         + (parseInt(values.unique_power_3_max_ep,10) || 0)
                         + (parseInt(values.unique_power_4_max_ep,10) || 0)
                         + (parseInt(values.unique_power_5_max_ep,10) || 0)
                         + (parseInt(values.unique_power_6_max_ep,10) || 0);

            // Update attributes
            setAttrs({
                energy_reserve: energyReserveCur,
                energy_reserve_max: energyReserveMax,
                total_energy: totalCur,
                total_energy_max: totalMax
            });
        });
    }

    // --- Triggers ---
    on("sheet:opened change:strength_current_ep change:strength_max_ep change:speed_current_ep change:speed_max_ep change:resilience_current_ep change:resilience_max_ep change:unique_power_1_current_ep change:unique_power_1_max_ep change:unique_power_2_current_ep change:unique_power_2_max_ep change:unique_power_3_current_ep change:unique_power_3_max_ep change:unique_power_4_current_ep change:unique_power_4_max_ep change:unique_power_5_current_ep change:unique_power_5_max_ep change:unique_power_6_current_ep change:unique_power_6_max_ep", updateEnergyValues);

})();
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Show next row when "Add / Modify" checkbox is toggled
  document.querySelectorAll('input.show-next').forEach(cb => {
    cb.addEventListener('change', () => {
      const n = parseInt(cb.dataset.row); // which row triggers the next row
      const nextRow = document.getElementById(`condition-row-${n + 1}`);
      if (nextRow) nextRow.style.display = cb.checked ? 'flex' : 'none';
    });
  });

  // Delete row button functionality
  document.querySelectorAll('button.hide-row').forEach(btn => {
    btn.addEventListener('click', () => {
      const n = parseInt(btn.dataset.row); // row to delete
      const row = document.getElementById(`condition-row-${n}`);
      if (row) {
        const select = row.querySelector('select');
        const textarea = row.querySelector('textarea');
        if (select) select.value = '';
        if (textarea) textarea.value = '';
        row.style.display = 'none';

        // Uncheck previous row checkbox if applicable
        const prevCb = document.querySelector(`input.show-next[data-row="${n - 1}"]`);
        if (prevCb) prevCb.checked = false;
      }
    });
  });
});
</script>
