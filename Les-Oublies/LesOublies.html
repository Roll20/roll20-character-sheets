<!--            Character sheet for Les Oubliés RPG (FR)
                RPG Publisher: Les 12 Singes
                Sheet Author: Kapirklaa
                Sheet version: 1.0
-->


<!-- ----------------------------------------------------------------------- -->
<!-- --------------------- SCRIPT PATCH FOR ATTRIBUTES --------------------- -->
<!-- ----------------------------------------------------------------------- -->

<script type="text/worker">
	const fillCompRow = (sectionName, data) => {
		let id = generateRowID();
		let attr = {};
		for(let key in data) {
			attr[`repeating_${sectionName}_${id}_${key}`] = data[key];
		}
		setAttrs(attr);
	};

	const replaceRepeatingComp = (compName) => {
		for (let i = 1; i <= 3; ++i) {
			getAttrs([`${compName}${i}`, `${compName}${i}_nom`, `${compName}${i}_bonus_dice`], function(values) {
				if (values[`${compName}${i}_nom`]) {
					let data = {};
					data[`${compName}`] = values[`${compName}${i}`];
					data[`${compName}_nom`] = values[`${compName}${i}_nom`];
					data[`${compName}_bonus_dice`] = values[`${compName}${i}_bonus_dice`];
					fillCompRow(compName, data);
					values[`${compName}${i}`] = "";
					values[`${compName}${i}_nom`] = "";
					values[`${compName}${i}_bonus_dice`] = "";
					setAttrs(values);
				}
			});
		}
	};

	on("sheet:opened", function() {
		// amure_penalite --> armure_penalite (type mistake)
		getAttrs(['amure_penalite', 'armure_penalite'], function(values) {
			if((values.amure_penalite) && !(values.armure_penalite)) {
				setAttrs({armure_penalite: values.amure_penalite});
			}
		});

		// add repeating section for [art], [artisanat], [erudition] and [langues]
		replaceRepeatingComp("art");
		replaceRepeatingComp("artisanat");
		replaceRepeatingComp("erudition");
		replaceRepeatingComp("langues");

		// strategie1/2/3 --> strategie
		getAttrs(["strategie1"], function(values) {
			setAttrs({
				strategie: values.strategie1
			})
		});
	});
</script>

<div class="outline"> 

<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------------- TITRE -------------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="center-content">
		<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Les-Oublies/images/title.png">   
	</div>

<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------------- TABS --------------------------------- -->
<!-- ----------------------------------------------------------------------- -->
	
	<div class="navigation-div">
        <input type='hidden' class='sheet-tabstoggleforbtn' name='attr_sheetTabForBtn'  value='combat'  />
        <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Les-Oublies/images/shadow.png">
        <button type="action" name="act_character" >Personnage</button>
        <button type="action" name="act_skills" >Compétences</button>
        <button type="action" name="act_combat" >Combat</button>
        <button type="action" name="act_equipment_and_spells" >Equipement & Sortilèges</button>
        <button type="action" name="act_journal" >Journal</button>
        <button type="action" name="act_fullsheet" >Fiche complète</button>
    </div>
    <input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab'  value='combat'  />

    <script type="text/worker">
        const buttonlist = ["character", "skills", "combat", "equipment_and_spells", "journal", "fullsheet"];
        buttonlist.forEach(button => {
            on(`clicked:${button}`, function() {
                setAttrs({
                    sheetTab: button
                });
                setAttrs({
                    sheetTabForBtn: button
                });
            });
        });
    </script>

<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------------- OUBLIE -------------------------------- -->
<!-- ----------------------------------------------------------------------- -->
     
<div class="sheet-character">
    
	<div class="sheet-2colrow">  <!-- Section 1 -->

		<div class="sheet-col small-outline section-oublie">  <!-- Column 1 -->
		
			<h1 class="title">Oublié</h1>
			
			<table>
				<tr>
					<td>
						Nom
					</td> 
					<td> 
						<input type="text" name="attr_character_name"/>
					</td>
				</tr>
				
				<tr>
					<td>
						Race
					</td> 
					<td> 
						<input type="text" name="attr_race"/>
					</td>
				</tr>
				
				<tr>
					<td>
						Tribu
					</td> 
					<td> 
						<input type="text" name="attr_tribe"/>
					</td>
				</tr>
				
				<tr>
					<td>
						Métier
					</td> 
					<td> 
						<input type="text" name="attr_metier"/>
					</td>
				</tr>
				
				<tr>
					<td class="center-content">
						Taille
					</td> 
					<td class="center-content"> 
						Points de vie
					</td>
				</tr>
				
				<tr>
					<td class="center-content">
						<input type="number" min="0" value="0" name="attr_taille"/>
					</td> 
					<td class="center-content">
						<input type="number" min="0" value="0" class="number-with-max" name="attr_pdv"/> /
						<input type="number" min="0" value="0" class="number-with-max" name="attr_pdv_max"/>
					</td>
				</tr>
				
			</table>
		</div>  <!-- END Column 1 -->
		
		
<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------- SONGES ET CAUCHEMAR  ------------------------ -->
<!-- ----------------------------------------------------------------------- -->


		<div class="sheet-col small-outline section-songes-cauchemar" >  <!-- Column 2 -->
		
			<h1 class="title">Songes & Cauchemar</h1>
			
			<table class="center-content">
				<colgroup>
					<col style="width: 50%;">
					<col style="width: 50%;">
				</colgroup>
				
				<tr>
					<td>
						Songes
					</td>
					<td>
						Cauchemar
					</td>
				</tr>
				
				<tr>
					<td>
						<input type="number" value="0" min="0" name="attr_songes"/>
					</td>
					<td>
						<input type="number" value="0" min="0" name="attr_cauchemar"/>
					</td>
				</tr>
				
				<tr>
					<td>
						Points de songes
					</td>
					<td>
						Points de cauchemar
					</td>
				</tr>
				
				<tr>
					<td>
						<input type="number" value="0" min="0" class="number-with-max" name="attr_pds"/> /
						<input type="number" value="0" min="0" class="number-with-max" name="attr_pds_max"/>
					</td>
					<td>
						<input type="number" value="0" min="0" class="number-with-max" name="attr_pdc"/> /
						<input type="number" value="0" min="0" class="number-with-max" name="attr_pdc_max"/>
					</td>
				</tr>
				
				<tr>
					<td>
						Dettes de songes
					</td>
					<td>
						Dettes de cauchemar
					</td>
				</tr>
				
				<tr>
					<td>
						<input type="number" value="0" min="0" name="attr_dds"/>
					</td>
					<td>
						<input type="number" value="0" min="0" name="attr_ddc"/>
					</td>
				</tr>
				
			</table>
			
		 </div>  <!-- END Column 1 -->
	</div>  <!-- END Section 1 -->

<!-- ----------------------------------------------------------------------- -->
<!-- ----------------------------- COMPAGNIE ------------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-row small-outline">  <!-- Section Compagnie -->
	
	    <div class="sheet-col section-compagnie">
	        <table>
	            <td>
        		    <h1 class="title"><span class="company-name-label"/>Compagnie :</span><input type="text" class="title-input company-name" name="attr_company_name"/></h1>
        		    <span class="company-power-label">Pouvoir :</span><input type="text" class="company-power" name="attr_company_power"/>
	            </td>
	            <td>
    		        <img style="text-align:right;" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Les-Oublies/images/banner.png">
	            </td>
	        </table>
    	</div>
	
	</div> <!-- END Section Compagnie -->
	
</div>

<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------ PROFILS ET COMPETENCES  ---------------------- -->
<!-- ----------------------------------------------------------------------- -->


<div class="sheet-skills">

	<table class="center-content pds-et-pdc">
		<colgroup>
			<col style="width: 50%;">
			<col style="width: 50%;">
		</colgroup>
		
		<tr>
			<td>
				Points de songes
			</td>
			<td>
				Points de cauchemar
			</td>
		</tr>
		
		<tr>
			<td>
				<input type="number" value="0" min="0" class="number-with-max" name="attr_pds"/> /
				<input type="number" value="0" min="0" class="number-with-max" name="attr_pds_max"/>
			</td>
			<td>
				<input type="number" value="0" min="0" class="number-with-max" name="attr_pdc"/> /
				<input type="number" value="0" min="0" class="number-with-max" name="attr_pdc_max"/>
			</td>
		</tr>
	</table>
    
	<div class="sheet-2colrow small-outline section-competences">  <!-- Section Profils et Competences -->
		
		<h1 class="title">Profil & Compétences</h1>

		<div class="sheet-col" >  <!-- Column 1 -->
			
			<table>
			
				<tr>
					<td class="title">Artiste</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_artiste"/>
					</td>
				</tr>
				<tr>
					<td colspan="5">
						Art
						<fieldset class="repeating_art">
							<input type="text" name="attr_art_nom"/>
							<input type="number" value="0" min="0" name="attr_art"/>
							<button type="roll"  name="art_test"
									value="&{template:classic-roll} {{name=Art: @{art_nom}}} {{whiteroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{art}[@{art_nom}]]]}} {{blackroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{art}[@{art_nom}]]]}} {{bonusdice=[[@{art_bonus_dice}d12 + @{domaine_artiste}[Dom. Artiste] + @{art}[@{art_nom}]]]}} {{bonusused=[[@{art_bonus_dice}]]}}">
							</button>
							<input type="checkbox" value="1" name="attr_art_bonus_dice"/>
							+1D12
						</fieldset>
					</td>
				</tr>
				<tr>
					<td>Empathie</td>
					<td>
						<input type="number" value="0" min="0" name="attr_empathie"/>
					</td>
					<td>
						<button type="roll"  name="empathie_test"
								value="&{template:classic-roll} {{name=Empathie}} {{whiteroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{empathie}[Empathie]]]}} {{blackroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{empathie}[Empathie]]]}} {{bonusdice=[[@{empathie_bonus_dice}d12 + @{domaine_artiste}[Dom. Artiste] + @{empathie}[Empathie]]]}} {{bonusused=[[@{empathie_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_empathie_bonus_dice"/>     
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Séduction</td>
					<td>
						<input type="number" value="0" min="0" name="attr_seduction"/>
					</td>
					<td>
						<button type="roll"  name="seduction_test"
								value="&{template:classic-roll} {{name=Séduction}} {{whiteroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{seduction}[Seduction]]]}} {{blackroll=[[1d12 + @{domaine_artiste}[Dom. Artiste] + @{seduction}[Seduction]]]}} {{bonusdice=[[@{seduction_bonus_dice}d12 + @{domaine_artiste}[Dom. Artiste] + @{seduction}[Seduction]]]}} {{bonusused=[[@{seduction_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_seduction_bonus_dice"/>    
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Athlète</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_athlete"/>
					</td>
				</tr>
				<tr>
					<td>Athlétisme</td>
					<td>
						<input type="number" value="0" min="0" name="attr_athletisme"/>
					</td>
					<td>
						<button type="roll"  name="athletisme_test"
								value="&{template:classic-roll} {{name=Athlétisme}} {{whiteroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{athletisme}[Athletisme]]]}} {{blackroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{athletisme}[Athletisme]]]}} {{bonusdice=[[@{athletisme_bonus_dice}d12 + @{domaine_athlete}[Dom. Athlete] + @{athletisme}[Athletisme]]]}} {{bonusused=[[@{athletisme_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_athletisme_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Rapidité</td>
					<td>
						<input type="number" value="0" min="0" name="attr_rapidite"/>
					</td>
					<td>
						<button type="roll"  name="rapidite_test"
								value="&{template:classic-roll} {{name=Rapidité}} {{whiteroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{rapidite}[Rapidite]]]}} {{blackroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{rapidite}[Rapidite]]]}} {{bonusdice=[[@{rapidite_bonus_dice}d12 + @{domaine_athlete}[Dom. Athlete] + @{rapidite}[Rapidite]]]}} {{bonusused=[[@{rapidite_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_rapidite_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Volonté</td>
					<td>
						<input type="number" value="0" min="0" name="attr_volonte"/>
					</td>
					<td>
						<button type="roll"  name="volonte_test"
								value="&{template:classic-roll} {{name=Volonté}} {{whiteroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{volonte}[Volonte]]]}} {{blackroll=[[1d12 + @{domaine_athlete}[Dom. Athlete] + @{volonte}[Volonte]]]}} {{bonusdice=[[@{volonte_bonus_dice}d12 + @{domaine_athlete}[Dom. Athlete] + @{volonte}[Volonte]]]}} {{bonusused=[[@{volonte_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_volonte_bonus_dice"/>        
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Chasseur</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_chasseur"/>
					</td>
				</tr>
				<tr>
					<td>Sens</td>
					<td>
						<input type="number" value="0" min="0" name="attr_sens"/>
					</td>
					<td>
						<button type="roll"  name="sens_test"
								value="&{template:classic-roll} {{name=Sens}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{sens}[Sens]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{sens}[Sens]]]}} {{bonusdice=[[@{sens_bonus_dice}d12 + @{domaine_chasseur}[Dom. Chasseur] + @{sens}[Sens]]]}} {{bonusused=[[@{sens_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_sens_bonus_dice"/>    
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Survie</td>
					<td>
						<input type="number" value="0" min="0" name="attr_survie"/>
					</td>
					<td>
						<button type="roll"  name="survie_test"
								value="&{template:classic-roll} {{name=Survie}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{survie}[Survie]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{survie}[Survie]]]}} {{bonusdice=[[@{survie_bonus_dice}d12 + @{domaine_chasseur}[Dom. Chasseur] + @{survie}[Survie]]]}} {{bonusused=[[@{survie_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_survie_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Tir</td>
					<td>
						<input type="number" value="0" min="0" name="attr_tir"/>
					</td>
					<td>
						<button type="roll"  name="tir_test"
								value="&{template:classic-roll} {{name=Tir}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{tir}[Tir]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Dom. Chasseur] + @{tir}[Tir]]]}} {{bonusdice=[[@{tir_bonus_dice}d12 + @{domaine_chasseur}[Dom. Chasseur] + @{tir}[Tir]]]}} {{bonusused=[[@{tir_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_tir_bonus_dice"/>  
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Faiseur</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_faiseur"/>
					</td>
				</tr>
				<tr>
					<td colspan="5">
						Artisanat
						<fieldset class="repeating_artisanat">
							<input type="text" name="attr_artisanat_nom"/>
							<input type="number" value="0" min="0" name="attr_artisanat"/>
							<button type="roll"  name="artisanat_test"
									value="&{template:classic-roll} {{name=Artisanat : @{artisanat_nom}}} {{whiteroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{artisanat}[@{artisanat_nom}]]]}} {{blackroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{artisanat}[@{artisanat_nom}]]]}} {{bonusdice=[[@{artisanat_bonus_dice}d12 + @{domaine_faiseur}[Dom. Faiseur] + @{artisanat}[@{artisanat_nom}]]]}} {{bonusused=[[@{artisanat_bonus_dice}]]}}">
							</button>
							<input type="checkbox" value="1" name="attr_artisanat_bonus_dice"/>
							+1D12
						</fieldset>
					</td>
				</tr>
				<tr>
					<td>Intellect</td>
					<td>
						<input type="number" value="0" min="0" name="attr_intellect"/>
					</td>
					<td>
						<button type="roll"  name="intellect_test"
								value="&{template:classic-roll} {{name=Intellect}} {{whiteroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{intellect}[Intellect]]]}} {{blackroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{intellect}[Intellect]]]}} {{bonusdice=[[@{intellect_bonus_dice}d12 + @{domaine_faiseur}[Dom. Faiseur] + @{intellect}[Intellect]]]}} {{bonusused=[[@{intellect_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_intellect_bonus_dice"/>
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Soins</td>
					<td>
						<input type="number" value="0" min="0" name="attr_soins"/>
					</td>
					<td>
						<button type="roll"  name="soins_test"
								value="&{template:classic-roll} {{name=Soins}} {{whiteroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{soins}[Soins]]]}} {{blackroll=[[1d12 + @{domaine_faiseur}[Dom. Faiseur] + @{soins}[Soins]]]}} {{bonusdice=[[@{soins_bonus_dice}d12 + @{domaine_faiseur}[Dom. Faiseur] + @{soins}[Soins]]]}} {{bonusused=[[@{soins_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_soins_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Force de la nature</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_force_de_la_nature"/>
					</td>
				</tr>
				<tr>
					<td>Commandement</td>
					<td>
						<input type="number" value="0" min="0" name="attr_commandement"/>
					</td>
					<td>
						<button type="roll"  name="commandement_test"
								value="&{template:classic-roll} {{name=Commandement}} {{whiteroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{commandement}[Commandement]]]}}  {{blackroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{commandement}[Commandement]]]}} {{bonusdice=[[@{commandement_bonus_dice}d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{commandement}[Commandement]]]}} {{bonusused=[[@{commandement_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_commandement_bonus_dice"/>     
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Endurance</td>
					<td>
						<input type="number" value="0" min="0" name="attr_endurance"/>
					</td>
					<td>
						<button type="roll"  name="endurance_test"
								value="&{template:classic-roll} {{name=Endurance}} {{whiteroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{endurance}[Endurance]]]}} {{blackroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{endurance}[Endurance]]]}} {{bonusdice=[[@{endurance_bonus_dice}d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{endurance}[Endurance]]]}} {{bonusused=[[@{endurance_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_endurance_bonus_dice"/>  
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Force</td>
					<td>
						<input type="number" value="0" min="0" name="attr_force"/>
					</td>
					<td>
						<button type="roll"  name="force_test"
								value="&{template:classic-roll} {{name=Force}} {{whiteroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{force}[Force]]]}} {{blackroll=[[1d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{force}[Force]]]}} {{bonusdice=[[@{force_bonus_dice}d12 + @{domaine_force_de_la_nature}[Dom. Force de la nature] + @{force}[Force]]]}} {{bonusused=[[@{force_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_force_bonus_dice"/>       
					</td>
					<td>
					    +1D12
					</td>
				</tr>
			</table>
		</div> <!-- END column 1 -->
		
		<div class="sheet-col" >  <!-- Column 2 -->
			
			<table>
			
				<tr>
					<td class="title">Guerrier</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_guerrier"/>
					</td>
				</tr>
				<tr>
					<td>Corps à corps</td>
					<td>
						<input type="number" value="0" min="0" name="attr_cac"/>
					</td>
					<td>
						<button type="roll"  name="cac_test"
								value="&{template:classic-roll} {{name=Corps à corps}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{cac}[CaC]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{cac}[CaC]]]}} {{bonusdice=[[@{cac_bonus_dice}d12 + @{domaine_guerrier}[Dom. Guerrier] + @{cac}[CaC]]]}} {{bonusused=[[@{cac_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_cac_bonus_dice"/>     
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Mêlée</td>
					<td>
						<input type="number" value="0" min="0" name="attr_melee"/>
					</td>
					<td>
						<button type="roll"  name="melee_test"
								value="&{template:classic-roll} {{name=Mêlée}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{melee}[Melee]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{melee}[Melee]]]}} {{bonusdice=[[@{melee_bonus_dice}d12 + @{domaine_guerrier}[Dom. Guerrier] + @{melee}[Melee]]]}} {{bonusused=[[@{melee_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_melee_bonus_dice"/>     
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Montures</td>
					<td>
						<input type="number" value="0" min="0" name="attr_montures"/>
					</td>
					<td>
						<button type="roll"  name="montures_test"
								value="&{template:classic-roll} {{name=Montures}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{montures}[Montures]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Dom. Guerrier] + @{montures}[Montures]]]}} {{bonusdice=[[@{montures_bonus_dice}d12 + @{domaine_guerrier}[Dom. Guerrier] + @{montures}[Montures]]]}} {{bonusused=[[@{montures_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_montures_bonus_dice"/>    
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Mystique</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_mystique"/>
					</td>
				</tr>
				<tr>
					<td>Chimérisme</td>
					<td>
						<input type="number" value="0" min="0" name="attr_chimerisme"/>
					</td>
					<td>
						<button type="roll"  name="chimerisme_test"
								value="&{template:classic-roll} {{name=Chimérisme}} {{whiteroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{chimerisme}[Chimerisme]]]}} {{blackroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{chimerisme}[Chimerisme]]]}} {{bonusdice=[[@{chimerisme_bonus_dice}d12 + @{domaine_mystique}[Dom. Mystique] + @{chimerisme}[Chimerisme]]]}} {{bonusused=[[@{chimerisme_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_chimerisme_bonus_dice"/>     
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Magie</td>
					<td>
						<input type="number" value="0" min="0" name="attr_magie"/>
					</td>
					<td>
						<button type="roll"  name="magie_test"
								value="&{template:classic-roll} {{name=Magie}} {{whiteroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{magie}[Magie]]]}} {{blackroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{magie}[Magie]]]}} {{bonusdice=[[@{magie_bonus_dice}d12 + @{domaine_mystique}[Dom. Mystique] + @{magie}[Magie]]]}} {{bonusused=[[@{magie_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_magie_bonus_dice"/>    
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Onirologie</td>
					<td>
						<input type="number" value="0" min="0" name="attr_onirologie"/>
					</td>
					<td>
						<button type="roll"  name="onirologie_test"
								value="&{template:classic-roll} {{name=Onirologie}} {{whiteroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{onirologie}[Onirologie]]]}} {{blackroll=[[1d12 + @{domaine_mystique}[Dom. Mystique] + @{onirologie}[Onirologie]]]}} {{bonusdice=[[@{onirologie_bonus_dice}d12 + @{domaine_mystique}[Dom. Mystique] + @{onirologie}[Onirologie]]]}} {{bonusused=[[@{onirologie_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_onirologie_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Ombre</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_ombre"/>
					</td>
				</tr>
				<tr>
					<td>Discrétion</td>
					<td>
						<input type="number" value="0" min="0" name="attr_discretion"/>
					</td>
					<td>
						<button type="roll"  name="discretion_test"
								value="&{template:classic-roll} {{name=Discrétion}} {{whiteroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{discretion}[Discretion]]]}} {{blackroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{discretion}[Discretion]]]}} {{bonusdice=[[@{discretion_bonus_dice}d12 + @{domaine_ombre}[Dom. Ombre] + @{discretion}[Discretion]]]}} {{bonusused=[[@{discretion_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_discretion_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Esquive</td>
					<td>
						<input type="number" value="0" min="0" name="attr_esquive"/>
					</td>
					<td>
						<button type="roll"  name="esquive_test"
								value="&{template:classic-roll} {{name=Esquive}} {{whiteroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{esquive}[Esquive]]]}} {{blackroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{esquive}[Esquive]]]}} {{bonusdice=[[@{esquive_bonus_dice}d12 + @{domaine_ombre}[Dom. Ombre] + @{esquive}[Esquive]]]}} {{bonusused=[[@{esquive_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_esquive_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				<tr>
					<td>Subterfuge</td>
					<td>
						<input type="number" value="0" min="0" name="attr_subterfuge"/>
					</td>
					<td>
						<button type="roll"  name="subterfuge_test"
								value="&{template:classic-roll} {{name=Subterfuge}} {{whiteroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{subterfuge}[Subterfuge]]]}} {{blackroll=[[1d12 + @{domaine_ombre}[Dom. Ombre] + @{subterfuge}[Subterfuge]]]}} {{bonusdice=[[@{subterfuge_bonus_dice}d12 + @{domaine_ombre}[Dom. Ombre] + @{subterfuge}[Subterfuge]]]}} {{bonusused=[[@{subterfuge_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_subterfuge_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
				
				<tr><td colspan="5"><hr/></td></tr>
				
				<tr>
					<td class="title">Savant</td>
					<td colspan="4">
						<input type="number" value="0" min="0" class="input-important" name="attr_domaine_savant"/>
					</td>
				</tr>
				<tr>
					<td colspan="5">
						Erudition
						<fieldset class="repeating_erudition">
							<input type="text" name="attr_erudition_nom"/>
							<input type="number" value="0" min="0" name="attr_erudition"/>
							<button type="roll"  name="erudition_test"
									value="&{template:classic-roll} {{name=erudition : @{erudition_nom}}} {{whiteroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{erudition}[@{erudition_nom}]]]}} {{blackroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{erudition}[@{erudition_nom}]]]}} {{bonusdice=[[@{erudition_bonus_dice}d12 + @{domaine_savant}[Dom. Savant] + @{erudition}[@{erudition_nom}]]]}} {{bonusused=[[@{erudition_bonus_dice}]]}}">
							</button>
							<input type="checkbox" value="1" name="attr_erudition_bonus_dice"/>
							+1D12
						</fieldset>
					</td>
				</tr>
				<tr>
					<td colspan="5">
						Langues
						<fieldset class="repeating_langues">
							<input type="text" name="attr_langues_nom"/>
							<input type="number" value="0" min="0" name="attr_langues"/>
							<button type="roll"  name="langues_test"
									value="&{template:classic-roll} {{name=langues : @{langues_nom}}} {{whiteroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{langues}[@{langues_nom}]]]}} {{blackroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{langues}[@{langues_nom}]]]}} {{bonusdice=[[@{langues_bonus_dice}d12 + @{domaine_savant}[Dom. Savant] + @{langues}[@{langues_nom}]]]}} {{bonusused=[[@{langues_bonus_dice}]]}}">
							</button>
							<input type="checkbox" value="1" name="attr_langues_bonus_dice"/>
							+1D12
						</fieldset>
					</td>
				</tr>
				<tr>
					<td>Stratégie</td>
					<td>
						<input type="number" value="0" min="0" name="attr_strategie"/>
					</td>
					<td>
						<button type="roll"  name="strategie_test"
								value="&{template:classic-roll} {{name=Stratégie}} {{whiteroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{strategie}[@{strategie_nom}]]]}} {{blackroll=[[1d12 + @{domaine_savant}[Dom. Savant] + @{strategie}[@{strategie_nom}]]]}} {{bonusdice=[[@{strategie_bonus_dice}d12 + @{domaine_savant}[Dom. Savant] + @{strategie}[@{strategie_nom}]]]}} {{bonusused=[[@{strategie_bonus_dice}]]}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_strategie_bonus_dice"/> 
					</td>
					<td>
					    +1D12
					</td>
				</tr>
			</table>
		</div> <!-- End column 2 -->

	</div>  <!-- END Section 2 Profils et competences -->
	
</div>

<div class="sheet-combat">
	
<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------------ INITIATIVE ----------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-row init-fullsheet"> <!-- Initiative -->
		<div class="sheet-col section-initiative">
			<button type="roll" class="init-roll" name="initiative"
					value="&{template:initiative-roll} {{roll=[[ceil((@{domaine_athlete}[Athlete] + @{rapidite}[Rapidite] + 1d12) / 2) + @{armure_penalite}[Penalite armure] &{tracker}]]}} {{prime=@{prime_init}}} {{penalite=@{penalite_init}}}">
				<span class="small-text">Initiative</span>
			</button>
		</div>
	</div>
	<div class="sheet-2colrow init-combatsheet"> <!-- Initiative -->
		<div class="sheet-col" style="text-align: center; vertical-align: middle;">
			Points de vie : 
			<input type="number" min="0" value="0" class="number-with-max" name="attr_pdv"/> /
			<input type="number" min="0" value="0" class="number-with-max" name="attr_pdv_max"/>
		</div>
		<div class="sheet-col section-initiative" style="vertical-align: middle;">
			<button type="roll" class="init-roll" name="initiative"
					value="&{template:initiative-roll} {{roll=[[ceil((@{domaine_athlete}[Athlete] + @{rapidite}[Rapidite] + 1d12) / 2) + @{armure_penalite}[Penalite armure] &{tracker}]]}} {{prime=@{prime_init}}} {{penalite=@{penalite_init}}}">
				<span class="small-text">Initiative</span>
			</button>
		</div>
	</div>	<!-- END Section Initiative -->
	
<!-- ----------------------------------------------------------------------- -->
<!-- --------------------------------- ARMES ------------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-row">  <!-- Section Armes -->

		<div class="sheet-col small-outline section-armes">
			<h1 class="title">Armes</h1>
			
			<span class="label-name">Nom</span>
			<span class="label-number">Taille</span>
			<span class="label-number">Dégâts</span>
			<span class="label-particularites">Particularités</span>
			<span class="label-roll">Attaques</span>
			
			<fieldset class="repeating_armes">
			    <div class="repeating-section">
    				<input type="text" class="input-name" name="attr_arme_nom"/>
    				<input type="number" class="input-number" value="0" name="attr_arme_taille"/>
    				<input type="number" class="input-number" value="0" name="attr_arme_degats"/>
    				<input type="text" class="input-particularites" name="attr_arme_particularites"/>
    				<button type="roll" class="input-roll" name="attaque_melee"
    						value="&{template:attack-roll} {{name=Attaque @{arme_nom} (mêlée)}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{arme_bonus_dice}d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusused=[[@{arme_bonus_dice}]]}} {{degats=[[ceil((@{arme_taille} + @{arme_degats}) * @{facteur_prime_degats} * @{facteur_penalite_degats})]]}} {{particularites=@{arme_particularites}}} {{threshold=[[12+?{Modificateur|0}]]}} {{prime=@{prime}}} {{prime_descr=@{prime_short_descr}}} {{penalite=@{penalite}}} {{penalite_descr=@{penalite_short_descr}}}">
    				    <span class="small-text">Mêlée</span>
    				</button>
    				<button type="roll" class="input-roll" name="attaque_tir"
    						value="&{template:attack-roll} {{name=Attaque @{arme_nom} (tir)}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{arme_bonus_dice}d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusused=[[@{arme_bonus_dice}]]}} {{degats=[[ceil((@{arme_taille} + @{arme_degats}) * @{facteur_prime_degats} * @{facteur_penalite_degats})]]}} {{particularites=@{arme_particularites}}} {{prime=@{prime}}} {{prime_descr=@{prime_short_descr}}} {{penalite=@{penalite}}} {{penalite_descr=@{penalite_short_descr}}}">
    				    <span class="small-text">Tir</span>
    				</button>
					<input type="checkbox" value="1" name="attr_arme_bonus_dice"/>
					+1D12
    			</div>
			</fieldset>
		</div>
		
	</div> <!-- END Section Armes -->
	
<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------- PRIMES ET PENALITES ------------------------ -->
<!-- ----------------------------------------------------------------------- -->
	   
	<div class="sheet-row">  <!-- Section Primes et Penalites -->
	
		<div class="small-outline section-primes-penalites">
			<h1 class="title">Primes & Pénalités</h1>
			
		    <table>
		        <tr>
		            <th><h3>Prime</h3></th>
		            <th><h3>Pénalité</h3></th>
		        </tr>
		        <tr>
		            <td>
		                <select name="attr_prime">
            			    <option value="">Aucune</option>
            			    <option value="Accélération">Accélération</option>
            			    <option value="Attaques multiples">Attaques multiples</option>
            			    <option value="Blessure grave">Blessure grave</option>
            			    <option value="Blessure non létale">Blessure non létale</option>
            			    <option value="Blessure précise">Blessure précise</option>
            			    <option value="Efficacité">Efficacité</option>
            			    <option value="Débordement">Débordement</option>
            			    <option value="Prudence">Prudence</option>
            			</select>
		            </td>
		            <td>
		                <select name="attr_penalite">
            			    <option value="">Aucune</option>
            			    <option value="Abandon de position avantageuse">Abandon de position avantageuse</option>
            			    <option value="Blessure légère">Blessure légère</option>
            			    <option value="Danger">Danger</option>
            			    <option value="Difficulté">Difficulté</option>
            			    <option value="Facilité">Facilité</option>
            			    <option value="Ralentissement">Ralentissement</option>
            			    <option value="Risque">Risque</option>
            			</select>
		            </td>
		        </tr>
		        <tr>
		            <td>
		                <textarea name="attr_prime_descr"></textarea>
		            </td>
		            <td>
		                <textarea name="attr_penalite_descr"></textarea>
		            </td>
		        </tr>
		    </table>
		    
		    
		    <input type="hidden" name="attr_bonus_init" value="0"/>
		    <input type="hidden" name="attr_prime_init" value=""/>
		    <input type="hidden" name="attr_bonus_action" value="0"/>
		    <input type="hidden" name="attr_prime_action" value=""/>
		    <input type="hidden" name="attr_bonus_reaction" value="0"/>
		    <input type="hidden" name="attr_prime_reaction" value=""/>
		    <input type="hidden" name="attr_facteur_prime_degats" value="1"/>
		    <input type="hidden" name="attr_prime_degats" value=""/>
		    
		    <input type="hidden" name="attr_malus_init" value="0"/>
		    <input type="hidden" name="attr_penalite_init" value=""/>
		    <input type="hidden" name="attr_malus_action" value="0"/>
		    <input type="hidden" name="attr_penalite_action" value=""/>
		    <input type="hidden" name="attr_malus_reaction" value="0"/>
		    <input type="hidden" name="attr_penalite_reaction" value=""/>
		    <input type="hidden" name="attr_facteur_penalite_degats" value="1"/>
		    <input type="hidden" name="attr_penalite_degats" value=""/>
		    
		    <script type="text/worker">
                on("sheet:opened change:prime", function() {
                    getAttrs(["prime"], function(values) {
            			var prime = values["prime"];
            			var descr = "";
            			var shortDescr = "";
            			setAttrs({
            				"bonus_init": 0,
            				"prime_init": "",
            				"bonus_action": 0,
            				"prime_action": "",
            				"bonus_reaction": 0,
            				"prime_reaction": "",
            				"facteur_prime_degats": 1,
            				"prime_degats": ""
            			});
            			if(prime == "Accélération") {
            			    descr = "Le personnage est plus rapide. Son score d'initiative est augmenté de +3.";
            			    shortDescr = "Initiative à +3";
                			setAttrs({
                				"bonus_init": 3,
            				    "prime_init": "Accélération"
                			});
            			} else if(prime == "Attaques multiples") {
            			    descr = "L'attaque vise plusieurs cibles à la fois. Lors d'une attaque de mêlée, leur nombre est limité au nombre d'adversaires engagés par le personnage. Lors d'un tir, leur nombre est limité au nombre de munition dans le chargeur. Un seul jet est effectué, et le résultat des dégâts est divisé par 2 (arrondi au supérieur).";
            			    shortDescr = "Dégâts /2";
                			setAttrs({
                				"facteur_prime_degats": 0.5,
            				    "prime_degats": "Attaques multiples"
                			});
            			} else if(prime == "Blessure grave") {
            			    descr = "Les dégâts de l'arme sont augmentés de 50%.";
            			    shortDescr = "Dégâts +50%";
                			setAttrs({
                				"facteur_prime_degats": 1.5,
            				    "prime_degats": "Blessure grave"
                			});
            			} else if(prime == "Blessure non létale") {
            			    descr = "L'adversaire ne peut pas mourir suite au coup donné. Si l'attaque réussit, l'adversaire tombe inconscient.";
            			    shortDescr = "Mort impossible.";
            			} else if(prime == "Blessure précise") {
            			    descr = "Le personnage place une attaque qui exploite les défauts de l'armure de l'adversaire. La protection de cette dernière est divisée par 2 (arrondi au supérieur).";
            			    shortDescr = "Protection /2";
            			} else if(prime == "Efficacité") {
            			    descr = "L'action en cours bénéficie d'un bonus de +3.";
            			    shortDescr = "Résultat final +3";
            			    setAttrs({
            			        "bonus_action": 3,
            			        "prime_action": "Efficacité"
            			    })
            			} else if(prime == "Débordement") {
            			    descr = "La prochaine réaction de l'adversaire sera accompagnée d'un malus de -3.";
            			    shortDescr = "Réaction de l'adversaire -3";
            			} else if(prime == "Prudence") {
            			    descr = "La prochaine réaction du personnage bénéficie d'un bonus de +3. Plusieurs Prudences augmentent le nombre de réactions successives bénéficiant du bonus.";
            			    shortDescr = "Réaction +3";
            			    setAttrs({
            			        "bonus_reaction": 3,
            			        "prime_reaction": "Prudence"
            			    })
            			}
            			setAttrs({
            				"prime_descr": descr,
            				"prime_short_descr": shortDescr
            			});
                    });
                });
                on("sheet:opened change:penalite", function() {
                    getAttrs(["penalite"], function(values) {
            			var penalite = values["penalite"];
            			var descr = "";
            			var shortDescr = "";
            			setAttrs({
            				"malus_init": 0,
            				"penalite_init": "",
            				"malus_action": 0,
            				"penalite_action": "",
            				"malus_reaction": 0,
            				"penalite_reaction": "",
            				"facteur_penalite_degats": 1,
            				"penalite_degats": ""
            			});
            			if(penalite == "Abandon de position avantageuse") {
            			    descr = "Pour pouvoir choisir cette pénalité, le personnage doit être dans une position avantageuse (à couvert, caché, etc.) dont il perd les avantages.";
            			    shortDescr = "Perte des avantages de sa position.";
            			} else if(penalite == "Blessure légère") {
            			    descr = "Les dégâts sont divisés par 2 (arrondi au supérieur).";
            			    shortDescr = "Dégâts /2";
                			setAttrs({
                				"facteur_penalite_degats": 0.5,
            				    "penalite_degats": "Blessure légère"
                			});
            			} else if(penalite == "Danger") {
            			    descr = "La prochaine réaction du personnage subit un malus de -3. D'autres Dangers augmentent le nombre de défenses successives subissant ce malus.";
            			    shortDescr = "Réaction -3";
                			setAttrs({
                				"malus_reaction": -3,
                				"penalite_reaction": "Danger"
                			});
            			} else if(penalite == "Difficulté") {
            			    descr = "L'action en cours du personnage subit un malus de -3.";
            			    shortDescr = "Résultat final -3";
                			setAttrs({
                				"malus_action": -3,
                				"penalite_action": "Difficulté"
                			});
            			} else if(penalite == "Facilité") {
            			    descr = "La prochaine réaction de l'adversaire bénéficie d'un bonus de +3";
            			    shortDescr = "Réaction de l'adversaire +3";
            			} else if(penalite == "Ralentissement") {
            			    descr = "Le personnage est plus lent. Son initiative est diminuée de -3.";
            			    shortDescr = "Initiative -3";
                			setAttrs({
                				"malus_init": -3,
                				"penalite_init": "Ralentissement"
                			});
            			} else if(penalite == "Risque") {
            			    descr = "Si l'action en cours échoue, un incident, déterminé par le MJ, survient. Par exemple, l'arme est coincé ou détruite, le personnage glisse et tombe au sol, il lâche un objet, un de ses vêtements s'accroche quelque part et lui fait perdre sa prochaine action, l'attaque touche un allié, ...";
            			    shortDescr = "Incident en cas d'échec";
            			}
            			setAttrs({
            				"penalite_descr": descr,
            				"penalite_short_descr": shortDescr
            			});
                    });
                });
            </script>
			
		</div>

	</div>  <!-- END Section Primes et Penalites -->
	
<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------- COMPETENCES COMBAT ------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-row"> <!-- Competences combat -->
		<div class="sheet-col small-outline section-competences-combat">
			<h1 class="title">Compétences</h1>
			<table>
				<tr>
					<th></th>
					<th></th>
					<th>Rang</th>
					<th>Action</th>
					<th>Réaction</th>
					<th>Dé bonus</th>
				</tr>
				<tr>
					<td>(Force de la nature)</td>
					<td>Force</td>
					<td>
						<input type="number" value="0" min="0" name="attr_force" readonly/>
					</td>
					<td>
						<button type="roll"  name="force_test_action" class="action_roll"
								value="&{template:classic-roll} {{name=Force}} {{whiteroll=[[1d12 + @{domaine_force_de_la_nature}[Force de la nature] + @{force}[Force] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_force_de_la_nature}[Force de la nature] + @{force}[Force] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{force_bonus_dice}d12]]}} {{bonusused=[[@{force_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<button type="roll"  name="force_test_reaction" class="reaction_roll"
								value="&{template:classic-roll} {{name=Force}} {{whiteroll=[[1d12 + @{domaine_force_de_la_nature}[Force de la nature] + @{force}[Force] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_force_de_la_nature}[Force de la nature] + @{force}[Force] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{bonusdice=[[@{force_bonus_dice}d12]]}} {{bonusused=[[@{force_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_force_bonus_dice"/> +1D12
					</td>
				</tr>
				<tr>
					<td>(Guerrier)</td>
					<td>Corps à corps</td>
					<td>
						<input type="number" value="0" min="0" name="attr_cac" readonly/>
					</td>
					<td>
						<button type="roll"  name="cac_test_action" class="action_roll"
								value="&{template:classic-roll} {{name=Corps à corps}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{cac}[CaC] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{cac}[CaC] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{cac_bonus_dice}d12]]}} {{bonusused=[[@{cac_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<button type="roll"  name="cac_test_reaction" class="reaction_roll"
								value="&{template:classic-roll} {{name=Corps à corps}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{cac}[CaC] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{cac}[CaC] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{bonusdice=[[@{cac_bonus_dice}d12]]}} {{bonusused=[[@{cac_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_cac_bonus_dice"/> +1D12
					</td>
				</tr>
				<tr>
					<td>(Guerrier)</td>
					<td>Mêlée</td>
					<td>
						<input type="number" value="0" min="0" name="attr_melee" readonly/>
					</td>
					<td>
						<button type="roll"  name="melee_test_action" class="action_roll"
								value="&{template:classic-roll} {{name=Mêlée}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{melee_bonus_dice}d12]]}} {{bonusused=[[@{melee_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<button type="roll"  name="melee_test_reaction" class="reaction_roll"
								value="&{template:classic-roll} {{name=Mêlée}} {{whiteroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_guerrier}[Guerrier] + @{melee}[Melee] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{bonusdice=[[@{melee_bonus_dice}d12]]}} {{bonusused=[[@{melee_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_melee_bonus_dice"/> +1D12
					</td>
				</tr>
				<tr>
					<td>(Chasseur)</td>
					<td>Tir</td>
					<td>
						<input type="number" value="0" min="0" name="attr_tir" readonly/>
					</td>
					<td>
						<button type="roll"  name="tir_test_action" class="action_roll"
								value="&{template:classic-roll} {{name=Tir}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_action}[Prime] + @{malus_action}[Penalite]]]}} {{bonusdice=[[@{tir_bonus_dice}d12]]}} {{bonusused=[[@{tir_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<button type="roll"  name="tir_test_reaction" class="reaction_roll"
								value="&{template:classic-roll} {{name=Tir}} {{whiteroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_chasseur}[Chasseur] + @{tir}[Tir] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{bonusdice=[[@{tir_bonus_dice}d12]]}} {{bonusused=[[@{tir_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_tir_bonus_dice"/> +1D12
					</td>
				</tr>
				<tr>
					<td>(Ombre)</td>
					<td>Esquive</td>
					<td>
						<input type="number" value="0" min="0" name="attr_esquive" readonly/>
					</td>
					<td>
					</td>
					<td>
						<button type="roll"  name="esquive_test_reaction" class="reaction_roll"
								value="&{template:classic-roll} {{name=Esquive}} {{whiteroll=[[1d12 + @{domaine_ombre}[Ombre] + @{esquive}[Esquive] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{blackroll=[[1d12 + @{domaine_ombre}[Ombre] + @{esquive}[Esquive] + @{bonus_reaction}[Prime] + @{malus_reaction}[Penalite]]]}} {{bonusdice=[[@{esquive_bonus_dice}d12]]}} {{bonusused=[[@{esquive_bonus_dice}]]}} {{prime=@{prime}}} {{penalite=@{penalite}}}">
						</button>
					</td>
					<td>
						<input type="checkbox" value="1" name="attr_esquive_bonus_dice"/> +1D12
					</td>
				</tr>
			</table>
		</div>
	</div> <!-- END Competences combat -->

</div>

<div class="sheet-equipment_and_spells">
<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------------- MONTURES  ----------------------------- -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-2colrow">  <!-- Section 3 -->

		<div class="sheet-col small-outline section-montures">  <!-- Column 1 -->
			<h1 class="title">Montures</h1>
			
			<fieldset class="repeating_montures">
			    <div class="repeating-section">         
				    <input type="text" name="attr_monture" />
    			</div>
			</fieldset>
		</div>  <!-- END Column 1 Montures -->
		
<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------------ EQUIPEMENT  ---------------------------- -->
<!-- ----------------------------------------------------------------------- -->
	   
		<div class="sheet-col small-outline section-equipement">  <!-- Column 1 -->
			<h1 class="title">Equipement</h1>
			
			<fieldset class="repeating_equipements">
			    <div class="repeating-section">         
				    <input type="text" name="attr_equipement" />
    			</div>
			</fieldset>
		</div>  <!-- END Column 2 Equipement -->

	</div>  <!-- END Section 2 -->
	
<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------------- ARMURES ------------------------------ -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-row">  <!-- Section Armures -->

		<div class="sheet-col small-outline section-armures">
			<h1 class="title">Armures</h1>
			
			<span class="label-type">Type</span>
			<span class="label-number">Protection</span>
			<span class="label-number">Init</span>
			
			<fieldset class="repeating_armures">
			    <div class="repeating-section">
    				<input type="text" class="input-type" name="attr_armure_type"/>
    				<input type="number" class="input-number" name="attr_armure_protec"/>
    				<input type="number" class="input-number" name="attr_armure_init"/>
    				<input type="checkbox" value="1" name="attr_armure_equip" checked/>
    			</div>
			</fieldset>
			
			<div class="armure-penalite">
			    Pénalité totale de l'armure : <input type="number" class="input-type" name="attr_armure_penalite" readonly>
			</div>
		</div>
		
	</div> <!-- END Section Armures -->
	
	<script type="text/worker">
        on("ready change:repeating_armures:armure_init change:repeating_armures:armure_equip remove:repeating_armures", function() {
        	getSectionIDs("repeating_armures", function(IDArray) {
                var fieldNames = [];
                for (var i=0; i < IDArray.length; i++) {
        			fieldNames.push("repeating_armures_" + IDArray[i] + "_armure_init");
        			fieldNames.push("repeating_armures_" + IDArray[i] + "_armure_equip");
        		}
        		
                var total = 0;
                getAttrs(fieldNames, function(values) {
        			for (var i=0; i < IDArray.length; i++) {
        			    if(parseInt(values["repeating_armures_" + IDArray[i] + "_armure_equip"]) == 1) {
        				    total += parseInt(values["repeating_armures_" + IDArray[i] + "_armure_init"])||0;
        			    }
        			}
        			setAttrs({
        				"armure_penalite": total
        			});
                });
        	});
        });
    </script>
		
<!-- ----------------------------------------------------------------------- -->
<!-- ------------------------------ SORTILEGES  ---------------------------- -->
<!-- ----------------------------------------------------------------------- -->
	   
	<div class="sheet-row">  <!-- Section Sortileges -->
	
		<div class="sheet-col small-outline section-sortileges">
			<h1 class="title">Sortilèges</h1>
			
			<span class="label-songe">Songes</span>
			<span class="label-preparation">Prépa.</span>
			<span class="label-duration">Durée</span>
			<span class="label-range">Portée</span>
			<span class="label-aoe">AoE</span>
			<span class="label-cumul">Cumul</span>
			
			<fieldset class="repeating_sortileges">
			    <div class="repeating-section">
    				<input type="text" class="input-songe" name="attr_sort_songe"/>
    				<input type="text" class="input-preparation" name="attr_sort_preparation"/>
    				<input type="text" class="input-duration" name="attr_sort_duration"/>
    				<input type="text" class="input-range" name="attr_sort_range"/>
    				<input type="text" class="input-aoe" name="attr_sort_aoe"/>
    				<input type="text" class="input-cumul" name="attr_sort_cumul"/>
    				<textarea rows="1" class="input-descr" name="attr_sort_descr"></textarea>
    				<hr/>
    			</div>
			</fieldset>
		</div>

	</div>  <!-- END Section Sortileges -->

</div>

<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------------- NOTES  ------------------------------- -->
<!-- ----------------------------------------------------------------------- -->

<div class="sheet-journal">

	<div class="sheet-row small-outline">  <!-- Section Compagnie -->
	    <div class="sheet-col section-notes">
    		<h1 class="title">Notes</h1>
    		<textarea name="attr_notes"></textarea>
    	</div>
	</div> <!-- END Section Compagnie -->

</div>
		
<!-- ----------------------------------------------------------------------- -->
<!-- -------------------------------- FOOTER  ------------------------------ -->
<!-- ----------------------------------------------------------------------- -->

	<div class="sheet-footer">
	    <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Les-Oublies/images/footer.png">
	    <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Les-Oublies/images/tree.png" class="bottom-img">
	</div>

</div> <!-- END Outline -->


<!-- ----------------------------------------------------------------------- -->
<!-- --------------------------- ROLL TEMPLATES ---------------------------- -->
<!-- ----------------------------------------------------------------------- -->

<rolltemplate class="sheet-rolltemplate-classic-roll">
    <div class="sheet-template-container">
		<div class="sheet-template-header">
			{{name}}
		</div>
		<table>
			<tr class="sheet-template-white">
				<td class="sheet-template-first-col">
					<span class="sheet-template-strong">Résultat (Songes) :</span>
				</td>
				<td>{{whiteroll}}</td>
			</tr>
			<tr class="sheet-template-black">
				<td class="sheet-template-first-col">
					<span class="sheet-template-strong">Résultat (Cauchemar) :</span>
				</td>
				<td>{{blackroll}}</td>
			</tr>
			{{#rollGreater() bonusused 0}}
			<tr class="sheet-template-bonus">
				<td class="sheet-template-first-col">
					<span class="sheet-template-weak">Dé bonus :</span>
				</td>
				<td>{{bonusdice}}</td>
			</tr>
			{{/rollGreater() bonusused 0}}
			
			{{#prime}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="4">Prime : {{prime}}</td>
			</tr>
			{{/prime}}
			
			{{#penalite}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="4">Pénalité : {{penalite}}</td>
			</tr>
			{{/penalite}}
		</table>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-attack-roll">
    <div class="sheet-template-container">
		<div class="sheet-template-header">
			{{name}}
		</div>
		<table>
			<tr>
				<th class="sheet-template-white">Songes</th>
				<th class="sheet-template-black">Cauch.</th>
				{{#rollGreater() bonusused 0}}
				<th class="sheet-template-bonus">Bonus</th>
				{{/rollGreater() bonusused 0}}
				<th class="sheet-template-difficulte">Seuil</th>
			</tr>
			
			<tr class="sheet-template-row-rolls">
				<td class="sheet-template-white">{{whiteroll}}</td>
				<td class="sheet-template-black">{{blackroll}}</td>
				{{#rollGreater() bonusused 0}}
				<td class="sheet-template-bonus">{{bonusdice}}</td>
				{{/rollGreater() bonusused 0}}
				<td class="sheet-template-difficulte">{{threshold}}</td>
			</tr>
			
			{{^particularites}}
			<tr>
				<td colspan="4" class="sheet-template-degats">Dégâts : {{degats}}</td>
			</tr>
			{{/particularites}}
			
			{{#particularites}}
			<tr>
				<td colspan="2" class="sheet-template-degats">Dégâts : {{degats}}</td>
				<td colspan="2" class="sheet-template-particularites">{{particularites}}</td>
			</tr>
			{{/particularites}}
			
			{{#prime}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="1">{{prime}} :</td>
				<td colspan="3">{{prime_descr}}</td>
			</tr>
			{{/prime}}
			
			{{#penalite}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="1">{{penalite}} :</td>
				<td colspan="3">{{penalite_descr}}</td>
			</tr>
			{{/penalite}}
		</table>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-initiative-roll">
    <div class="sheet-template-container">
		<table>
			<tr>
				<td class="sheet-template-first-col">
					<span class="sheet-template-strong">Initiative :</span>
				</td>
				<td>{{roll}}</td>
			</tr>
			
			{{#prime}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="4">Prime : {{prime}}</td>
			</tr>
			{{/prime}}
			
			{{#penalite}}
			<tr class="sheet-template-primes-penalites sheet-template-weak">
			    <td colspan="4">Pénalité : {{penalite}}</td>
			</tr>
			{{/penalite}}
		</table>
	</div>
</rolltemplate>




