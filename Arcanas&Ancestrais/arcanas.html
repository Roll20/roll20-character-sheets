<div class="sheet-main">
	
	<div class="tab">
		<button class="botao-selecao" type="action" name="act_abafrente">Frente</button>
		<button class="botao-selecao" type="action" name="act_abaverso">Verso</button>
	</div>
	<input type='hidden' class='typetoggle' name='attr_typetoggle' value='abafrente' />
	
	<div class="abafrente">
		<div class="dados-frente">
			<div class="header">
				<div class="row">
					<div class="col">
						<label>Nome</label>
					</div>
					<div class="col">
						<input type="text" name="attr_character_name"/>
					</div>
					<div class="col">
						<label>Ancestralidade</label>
					</div>
					<div class="col">
						<input class="size-123" type="text" name="attr_raca"/>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<label>Classe</label>
					</div>
					<div class="col">
						<input type="text" name="attr_classe"/>
					</div>
					<div class="col size-70">
						<label>Especialização</label>
					</div>
					<div class="col left-30">
						<input type="text" name="attr_especializacao"/>
					</div>
				</div>
			</div>

			<div class="stats">
				<div class="stats-content">
					<div class="stats-for">
						<label>For</label>
					</div>
					<div class="stats-for-value">
						<input type="number" name='attr_for' value="10" class='stats-atributo'>
					</div>
					<div class="stats-for-mod">
						<input type="text" name="attr_for_mod_fake" value="@{for_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-for-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Força}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{for_mod}+?{Bônus|0}]]}}"></button>
					</div>

					<div class="stats-des">
						<label>Des</label>
					</div>
					<div class="stats-desc-value">
						<input type="number" name='attr_des' value="10" class='stats-atributo'>
					</div>
					<div class="stats-des-mod">
						<input type="text" name="attr_des_mod_fake" value="@{des_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-des-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Destreza}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{des_mod}+?{Bônus|0}]]}}"></button>
					</div>

					<div class="stats-con">
						<label>Con</label>
					</div>
					<div class="stats-con-value">
						<input type="number" name='attr_con' value="10" class='stats-atributo'>
					</div>
					<div class="stats-con-mod">
						<input type="text" name="attr_con_mod_fake" value="@{con_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-con-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Constituição}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{con_mod}+?{Bônus|0}]]}}"></button>
					</div>

					<div class="stats-int">
						<label>Int</label>
					</div>
					<div class="stats-int-value">
						<input type="number" name='attr_int' value="10" class='stats-atributo'>
					</div>
					<div class="stats-int-mod">
						<input type="text" name="attr_int_mod_fake" value="@{int_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-int-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Inteligência}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{int_mod}+?{Bônus|0}]]}}"></button>
					</div>

					<div class="stats-sab">
						<label>Sab</label>
					</div>
					<div class="stats-sab-value">
						<input type="number" name='attr_sab' value="10" class='stats-atributo'>
					</div>
					<div class="stats-sab-mod">
						<input type="text" name="attr_sab_mod_fake" value="@{sab_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-sab-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Sabedoria}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{sab_mod}+?{Bônus|0}]]}}"></button>
					</div>

					<div class="stats-car">
						<label>Car</label>
					</div>
					<div class="stats-car-value">
						<input type="number" name='attr_car' value="10" class='stats-atributo'>
					</div>
					<div class="stats-car-mod">
						<input type="text" name="attr_car_mod_fake" value="@{car_mod}" disabled="true" class='stats-mod'>
					</div>
					<div class="stats-car-roll">
						<button type="roll" align="right" value="&{template:atributo} {{nome=@{character_name}}} {{atributo=Carisma}} {{desempenho=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{car_mod}+?{Bônus|0}]]}}"></button>
					</div>
                    
                    <div class="row">
						<a href="https://imgur.com/kTGnSqo"><img src="https://i.imgur.com/kTGnSqo.png" title="source: imgur.com" /></a>
					</div>
				</div>
			</div>

			<div class="combat">
				<div class="row">
					<label class="ca-label">CA</label>
				</div>
				<div class="row left-22">
					<div class="col">
						<input type="number" name='attr_catotal' value="10+@{ca1}+@{ca2}+@{ca3}" disabled="true" class='sheet-short sheet-atributos ca-total'>
					</div>
					<div class="col">
						<input type="number" name='attr_ca1' value="0" class='sheet-short size-30'>
					</div>
					<div class="col">
						<label class="top-6">+</label>
					</div>
					<div class="col">
						<input type="number" name='attr_ca2' value="0" class='sheet-short size-30'>
					</div>
					<div class="col">
						<label class="top-6">+</label>
					</div>
					<div class="col">
						<input type="number" name='attr_ca3' value="0" class='sheet-short size-30'>
					</div>
				</div>
				<div class="row left-22">
					<div class="col">
						<label>Prof</label>
					</div>
					<div class="col left-5">
						<label>PV</label>
					</div>
					<div class="col left-80">
						<label>DV</label>
					</div>
				</div>
				<div class="row left-22">
					<div class="col">
						<input type="number" name='attr_prof' value="0" class='sheet-short sheet-atributos dv'>
					</div>
					<div class="col left-12">
						<input type="number" name='attr_pv_atual' value="0" class='sheet-short sheet-atributos pv'>
					</div>
					<div class="col">
						<input type="number" name='attr_pv' value="0" class='sheet-short sheet-atributos pv'>
					</div>
					<div class="col left-10">
						<input type="number" name='attr_dv_atual' value="0" class='sheet-short sheet-atributos dv'>
					</div>
					<div class="col">
						<input type="number" name='attr_dv' value="0" class='sheet-short sheet-atributos dv'>
					</div>
				</div>
				<div class="row top-5 left-22 size-205">
					<label>Jogadas de Morte</label>
				</div>
				<div class="row jogada-morte left-22 size-205">
					<img src="https://i.imgur.com/xJ9MfmW.png" title="source: imgur.com" />
					<input type="checkbox" name="attr_morte_a1" title="@{morte_a1}" /> 
					<input type="checkbox" name="attr_morte_a2" title="@{morte_a2}" />
					<input type="checkbox" name="attr_morte_a3" title="@{morte_a3}" />
					<br>
					<img src="https://i.imgur.com/rkY35lq.png" title="source: imgur.com" />
					<input type="checkbox" name="attr_morte_b1" title="@{caminho_morte_b1}" /> 
					<input type="checkbox" name="attr_morte_b2" title="@{caminho_morte_b2}" />
					<input type="checkbox" name="attr_morte_b3" title="@{caminho_morte_b3}" />
					<br> <br>
				</div>
				<div class="row left-22 size-205">
					<label>Consequências</label>
				</div>
				<div class="row left-22 size-205">
					<textarea class="height-18" name="attr_consequencias"></textarea>
				</div>
				<div class="row left-22 size-205">
					<label>Exaustão</label>
				</div>
				<div class="row left-22 size-205">
					<textarea class="height-18" name="attr_exaustao"></textarea>
				</div>
				<div class="row left-22 size-205">
					<label>Condições</label>
				</div>
				<div class="row left-22 size-205">
					<textarea class="height-17" name="attr_condicoes"></textarea>
				</div>
				<div class="row left-22 size-205">
					<label>Habilidades de Classe</label>
				</div>
				<div class="row left-22 size-205">
					<textarea class="height-15" name="attr_habilidades_classe"></textarea>
				</div>
			</div>

			<div class="backstory">
				<div class="row">
					<label>Histórico e Carta na Manga</label>
				</div>
				<div class="row">
					<textarea name="attr_historico"></textarea>
				</div>
				<div class="backstory-content">
					<div class="backstory-familia">
						<label>Família</label>
					</div>
					<div class="backstory-familia=input">
						<input type="text" name="attr_familia" />
					</div>
				
					<div class="backstory-obsessao">
						<label>Obsessão</label>
					</div>
					<div class="backstory-obsessao-input">
						<input type="text" name="attr_obsessao"/>
					</div>

					<div class="backstory-amigo">
						<label>Amigo</label>
					</div>
					<div class="col-amigo-input">
						<input type="text" name="attr_amigo" />
					</div>

					<div class="backstory-inimigo">
						<label>Inimigo</label>
					</div>
					<div class="backstory-inimigo-input">
						<input type="text" name="attr_inimigo" />
					</div>
				</div>
			</div>
			
			<div class="proficiencies">
				<div class="row">
					<label>Proficiências</label>
				</div>
				<div class="row">
					<textarea name="attr_proficiencia"></textarea>
				</div>
			</div>

			<div class="abilities">
				<div class="row">
					<label>Habilidades</label>
				</div>
				<div class="abilities-content">
					<div class="habilidade1-label">
						<label>1.</label>
					</div>
					<div class="habilidade1-value">
						<input type="text" name="attr_habilidade1" />
					</div>
					<div class="habilidade2-label">
						<label>2.</label>
					</div>
					<div class="habilidade2-value">
						<input type="text" name="attr_habilidade2" />
					</div>
					<div class="habilidade3-label">
						<label>3.</label>
					</div>
					<div class="habilidade3-value">
						<input type="text" name="attr_habilidade3"/>
					</div>
					<div class="habilidade4-label">
						<label>4.</label>
					</div>
					<div class="habilidade4-value">
						<label class="up_atributo"> +1 em
							<select name="attr_atributo_habilidade4">
								<option value="" selected=""></option>
								<option value="for">Força</option>
								<option value="des">Destreza</option>
								<option value="con">Constituição</option>
								<option value="int">Inteligência</option>
								<option value="sab">Sabedoria</option>
								<option value="car">Carisma</option>
							</select>
						</label>
					</div>
					<div class="habilidade5-label">
						<label>5.</label>
					</div>
					<div class="habilidade5-value">
						<input type="text" name="attr_habilidade5" />
					</div>
					<div class="habilidade6-label">
						<label>6.</label>
					</div>
					<div class="habilidade6-value">
						<input type="text" name="attr_habilidade6" />
					</div>
					<div class="habilidade7-label">
						<label>7.</label>
					</div>
					<div class="habilidade7-value">
						<label class="up_atributo"> +1 em
							<select name="attr_atributo_habilidade7">
								<option value="" selected=""></option>
								<option value="for">Força</option>
								<option value="des">Destreza</option>
								<option value="con">Constituição</option>
								<option value="int">Inteligência</option>
								<option value="sab">Sabedoria</option>
								<option value="car">Carisma</option>
							</select>
						</label>
					</div>
					<div class="habilidade8-label">
						<label>8.</label>
					</div>
					<div class="habilidade8-value">
						<input type="text" name="attr_habilidade8" />
					</div>
					<div class="habilidade9-label">
						<label>9.</label>
					</div>
					<div class="habilidade9-value">
						<input type="text" name="attr_habilidade9" />
					</div>
					<div class="habilidade10-label">
						<label>10.</label>
					</div>
					<div class="habilidade1--value">
						<input type="text" name="attr_habilidade10" />
					</div>
				</div>
			</div>

			<div class="weapons">
				<div class="row font-normal">
					<div class="col size-150">
						<label>Nome</label>
					</div>
					<div class="col left-105">
						<label>Tipo</label>
					</div>
					<div class="col left-35">
						<label>Dano</label>
					</div>
					<div class="col left-48">
						<label>Dado</label>
					</div>
				</div>
				<fieldset class="repeating_skills">
					<div class="row">
						<div class="col size-150">
							<input  class="size-150" type="text" name="attr_nome_arma" />
						</div>
						<div class="col size-80">
							<select class="size-80 font-menor" name="attr_atributoataque">
								<option value="@{for_mod}" selected="">Corporal</option>
								<option value="@{des_mod}">Distância</option>
							</select>
						</div>
						<div class="col size-60">
							<input class="size-50" type="text" name="attr_dano_arma" />
						</div>
						<div class="col">
							<button type="roll" align="right" value="&{template:ataque} {{nome=@{character_name} atacou com @{nome_arma}!}} {{ataque=[[?{Situação|Normal, 1d20|Vantagem, 2d20kh1|Desvantagem, 2d20kl1}+@{atributoataque}]]}} {{dano=[[@{dano_arma}+@{atributoataque}}]]}} {{uso=[[@{dado}}]]}}"></button>
						</div>
						<div class="col size-50">
							<select class="size-50" name="attr_dado">
								<option value="0" selected=""></option>
								<option value="1d4">d4</option>
								<option value="1d6">d6</option>
								<option value="1d8">d8</option>
								<option value="1d10">d10</option>
								<option value="1d12">d12</option>
							</select>
						</div>
						<div class="col">
							<button type="roll" align="right" value="&{template:dado-uso} {{nome=@{character_name} rolou o dado de uso de @{nome_arma}!}} {{ataque=[[@{dado}}]]}}"></button>
						</div>
					</div>
				</fieldset>
			</div>
		</div>
	</div>
	<div class="abaverso">
		<div class="dados-verso">
			<div class="rewards">
				<div class="row">
					<div class="col">
						<label>Nível
							<input class="nivel" type="number" name="attr_nivel">
						</label>
					</div>
					<div class="col">
						<label>XP
							<input type="number" name="attr_xp">
						</label>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<label>PC
							<input type="number" name="attr_pc">
						</label>
					</div>
					<div class="col">
						<label>PP
							<input type="number" name="attr_pp">
						</label>
					</div>
					<div class="col">
						<label>PO
							<input type="number" name="attr_po">
						</label>
					</div>
				</div>
			</div>
			<div class="equipaments">
				<label>Equipamentos</label>
				<div class="row font-normal">
					<div class="col size-150">
						<label>Item</label>
					</div>
					<div class="col left-105">
						<label>Propriedades</label>
					</div>
					<div class="col left-50">
						<label>Carga</label>
					</div>
					<div class="col left-5">
						<label>Dado</label>
					</div>
				</div>
				<fieldset class="repeating_skills">
					<div class="row">
						<div class="col size-150">
							<input class="size-150" type="text" name="attr_item" />
						</div>
						<div class="col size-150">
							<input class="size-150" type="text" name="attr_propriedades" />
						</div>
						<div class="col size-60">
							<input class="size-53" type="number" name="attr_carga" />
						</div>
						<div class="col size-50">
							<select name="attr_item_dado" class="size-50">
								<option value="0" selected=""></option>
								<option value="1d4">d4</option>
								<option value="1d6">d6</option>
								<option value="1d8">d8</option>
								<option value="1d10">d10</option>
								<option value="1d12">d12</option>
							</select>
						</div>
						<div class="col">
							<button type="roll" align="right" value="&{template:dado-uso} {{nome=@{character_name} rolou o dado de uso de @{item}!}} {{ataque=[[@{item_dado}}]]}}"></button>
						</div>
					</div>
				</fieldset>
			</div>
			<div class="notes">
				<label>Anotações</label>
				<div class="row">
					<textarea class="anotacoes" name="attr_notes"></textarea>
				</div>
			</div>
		</div>
	</div>
	
	<rolltemplate class="sheet-rolltemplate-atributo">
		<div class="sheet-rollbox-container">
		   <div class="header">
				<span class="left">Teste de {{atributo}}</span>
			</div>
			<br>
			<div class="rollbox">
				<div>
					<div class="roll">
						{{nome}} rolou
					</div>
				</div>
			</div>
			<div class="rollbox-desempenho">
				<div>
					<div class="roll">
						{{desempenho}}
					</div>
				</div>
			</div>
		</div>
	</rolltemplate>

	<rolltemplate class="sheet-rolltemplate-ataque">
		<div class="sheet-rollbox-container">
		   <div class="header">
				<span class="left">{{nome}}</span>
			</div>
			<br>
			<div class="rollbox-ataque">
				<div>
					<div class="roll">
						{{ataque}}
					</div>
					<div class="roll-label">
						Ataque
					</div>
				</div>
			</div>
			<br>
			<div class="rollbox">
				<div>
					<div class="roll">
						{{dano}}
					</div>
					<div class="roll-label">
						Dano
					</div>
				</div>
				<div class="divisor"><span></span></div>
				<div>
					<div class="roll">
						{{uso}}
					</div>
					<div class="roll-label">
						Uso
					</div>
				</div>
			</div>
		</div>
	</rolltemplate>

	<rolltemplate class="sheet-rolltemplate-dado-uso">
		<div class="sheet-rollbox-container">
		   <div class="header">
				<span class="left">{{nome}}</span>
			</div>
			<br>
			<div class="rollbox">
				<div>
					<div class="roll">
						{{ataque}}
					</div>
				</div>
			</div>
		</div>
	</rolltemplate>
</div>

<script type="text/worker">
    var calc_mod = function (valor){
        if(isNaN(valor)){
            return 0;
        }
        return Math.floor((valor - 10) / 2);
    };
    
    ['for', 'des', 'con', 'int', 'sab', 'car'].forEach(stat => {
        on(`sheet:opened change:${stat}`, function(){
            getAttrs([stat], function(v){
                let mod = calc_mod(v[stat] ||10);
                setAttrs({
                    [`${stat}_mod`]: mod 
                });
            }); 
        });
    });
	
    /*Controle de abas*/
    const outerTabsButtons = ["abafrente", "abaverso"];
    outerTabsButtons.forEach(button => {
        on(`clicked:${button}`, function() {
			setAttrs({
				typetoggle: button
			});
        });
    });
</script>


