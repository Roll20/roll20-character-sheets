
<!-- main sheet code-->
<input class="gamesys" type="hidden" name="attr_gametype" value=""/>
<div class="tab-buttons spaced center">
  <input class="tabstoggle" type="hidden" name="attr_sheetTab" value="character"/>
  <input class="gametoggle" type="hidden" name="attr_gametype" value="godsend"/>
  <h1 class="godsend" title="GODSEND Agenda"></h1>
  <h2 class="talislanta" title="Talislanta"></h2>
  <h1 class="hellas" title="Hellas"></h1>
  <h1 class="atlantis" title="Atlantis Second Age"></h1>
  <div><span>Page selection</span>
    <button type="action" name="act_character">character</button>
    <button type="action" name="act_notes">notes</button>
    <button type="action" name="act_settings">settings</button>
  </div>
  <div class="version"><span>Sheet Version: </span><span name="attr_version"></span></div>
</div>
<input class="tabstoggle" type="hidden" name="attr_sheetTab" value="character"/>
<main class="character">
  <section class="common spaced">
    <div class="columnflex nowrap">
      <label>Name</label>
      <input class="name" name="attr_character_name" title="@{character_name}" type="text"/>
    </div>
    <div class="columnflex nowrap">
      <label>Species</label>
      <input name="attr_species" title="@{species}" list="speciesgodsend" type="text"/>
    </div>
    <div class="columnflex nowrap">
      <label>Archetype</label>
      <input name="attr_archetype_name" title="@{archetype_name}" list="archetypesgodsend" type="text"/>
    </div>
    <div class="columnflex nowrap">
      <label>Renown</label>
      <input name="attr_renown" title="@{renown}" type="number"/>
    </div>
  </section>
  <section class="points rowflex nowrap spaced">
    <div class="rowflex nowrap"><span class="cap">body Points</span>
      <input class="txtfield" name="attr_body_points" type="number" value=""/><span>/</span>
      <input class="txtfield" name="attr_body_points_max" type="number" value=""/>
    </div>
    <div class="rowflex nowrap"><span class="cap">mind Points</span>
      <input class="txtfield" name="attr_mind_points" type="number" value=""/><span>/</span>
      <input class="txtfield" name="attr_mind_points_max" type="number" value=""/>
    </div>
    <div class="rowflex nowrap"><span class="cap">hero Points</span>
      <input class="txtfield" name="attr_hero_points" type="number" value=""/><span>/</span>
      <input class="txtfield" name="attr_hero_points_max" type="number" value=""/>
    </div>
    <div class="rowflex nowrap"><span>Wealth Rating</span>
      <input class="txtfield" name="attr_wealth" title="@{wealth}" type="number" value=""/>
    </div>
    <div class="rowflex nowrap"><span title="Ability Level @{al}">AL</span>
      <input class="txtfield" name="attr_al" title="Ability Level @{xp_al}" type="number" value=""/><span title="Physical Defence @{xp_pd}">PD</span>
      <input class="txtfield" name="attr_xp_pd" title="Physical Defence @{xp_pd}" type="number" value=""/><span title="Mental Defence @{md}">MD</span>
      <input class="txtfield" name="attr_xp_md" title="Mental Defence @{xp_md}" type="number" value=""/>
    </div>
  </section>
  <section class="attrs columnflex nowrap">
    <h2>Attributes</h2>
    <div class="rowflex nowrap middle spaced">
      <div class="rowflex nowrap">
        <button name="roll_con" value="@{whisper}&{template:rolls} {{title=con }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{con}[con] @{modquery}]]}}" type="roll">con</button>
        <input name="attr_con" type="number" title="@{con}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_dex" value="@{whisper}&{template:rolls} {{title=dex }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{dex}[dex] @{modquery}]]}}" type="roll">dex</button>
        <input name="attr_dex" type="number" title="@{dex}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_spd" value="@{whisper}&{template:rolls} {{title=spd }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{spd}[spd] @{modquery}]]}}" type="roll">spd</button>
        <input name="attr_spd" type="number" title="@{spd}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_str" value="@{whisper}&{template:rolls} {{title=str }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{str}[str] @{modquery}]]}}" type="roll">str</button>
        <input name="attr_str" type="number" title="@{str}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_cr" value="@{whisper}&{template:rolls} {{title=cr }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{cr}[cr] @{modquery}]]}}" type="roll">cr</button>
        <input name="attr_cr" type="number" title="@{cr}" value=""/>
      </div>
    </div>
    <div class="rowflex nowrap middle spaced">
      <div class="rowflex nowrap">
        <button name="roll_cha" value="@{whisper}&{template:rolls} {{title=cha }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{cha}[cha] @{modquery}]]}}" type="roll">cha</button>
        <input name="attr_cha" type="number" title="@{cha}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_int" value="@{whisper}&{template:rolls} {{title=int }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{int}[int] @{modquery}]]}}" type="roll">int</button>
        <input name="attr_int" type="number" title="@{int}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_per" value="@{whisper}&{template:rolls} {{title=per }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{per}[per] @{modquery}]]}}" type="roll">per</button>
        <input name="attr_per" type="number" title="@{per}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_wil" value="@{whisper}&{template:rolls} {{title=wil }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{wil}[wil] @{modquery}]]}}" type="roll">wil</button>
        <input name="attr_wil" type="number" title="@{wil}" value=""/>
      </div>
      <div class="rowflex nowrap">
        <button name="roll_mr" value="@{whisper}&{template:rolls} {{title=mr }} {{subtitle=@{character_name} }}  {{roll= [[@{dice}[dice]+@{mr}[mr] @{modquery}]]}}" type="roll">mr</button>
        <input name="attr_mr" type="number" title="@{mr}" value=""/>
      </div>
    </div>
  </section>
  <section class="skills columnflex nowrap">
    <h2>Skills</h2>
    <div class="desc-row"><span>name</span><span>level</span><span class="attr">attr</span><span class="desc">notes</span></div>
    <fieldset class="repeating_skills">
      <button name="roll_skill" value="@{whisper}&{template:rolls} {{title=@{name} }} @{showname} {{roll= [[@{dice}[dice]+@{level}[@{name} level]+@{attribute}[attribute] @{modquery}]]}}" type="roll"></button>
      <input class="name" name="attr_name" title="@{name}" list="skillsgodsend" type="text"/>
      <input class="level" name="attr_level" title="@{level}" type="number"/>
      <select name="attr_attribute">
        <option class="cap" value="[[@{con}]]">con</option>
        <option class="cap" value="[[@{dex}]]">dex</option>
        <option class="cap" value="[[@{spd}]]">spd</option>
        <option class="cap" value="[[@{str}]]">str</option>
        <option class="cap" value="[[@{cr}]]">cr</option>
        <option class="cap" value="[[@{cha}]]">cha</option>
        <option class="cap" value="[[@{int}]]">int</option>
        <option class="cap" value="[[@{per}]]">per</option>
        <option class="cap" value="[[@{wil}]]">wil</option>
        <option class="cap" value="[[@{mr}]]">mr</option>
        <option class="cap" value="[[@{none}]]">none</option>
      </select>
      <input class="desc" name="attr_notes" title="@{notes}" type="text"/>
      <input name="attr_attrname" type="hidden"/>
    </fieldset>
    <h2>powers</h2>
    <div class="desc-row"><span class="powers">name</span><span>rank</span><span>base cost</span><span>rank cost</span><span>cost total</span><span>desc</span></div>
    <fieldset class="repeating_powers">
      <button class="sendtext" name="roll_power" value="@{whisper}&{template:rolls} {{title=@{name} }} @{showname} {{rank= [[@{rank}]] }} {{desc=@{desc} }}" type="roll"></button>
      <input class="name" name="attr_name" title="@{name}" type="text"/>
      <input class="txtfield" name="attr_rank" title="@{rank}" type="number"/>
      <input class="txtfield" name="attr_cost_base" type="number"/>
      <input class="txtfield" name="attr_cost_rank" type="number"/>
      <input class="txtfield" name="attr_cost_total" type="number"/>
      <input class="name" name="attr_desc" title="@{desc}" type="text"/>
    </fieldset>
    <h2>Weapons</h2>
    <div class="desc-row"><span class="weapons">name</span><span>acc</span><span>dr</span><span>RoF</span><span>Ammo</span><span>rng</span><span>R#</span><span>attr</span><span>skill lvl</span></div>
    <fieldset class="repeating_weapons">
      <button name="roll_weapon" value="@{whisper}&{template:rolls} {{title=@{name} }} @{showname} {{roll= [[@{dice}[Dice]+@{acc}[accuracy]+@{skill}[skill level]+@{attribute}[attribute] @{modquery}]]}} {{Damage= [[@{dr}]]}}" type="roll"></button>
      <input class="name" name="attr_name" title="@{name}" type="text"/>
      <input class="txtfield" name="attr_acc" type="number"/>
      <input class="txtfield" name="attr_dr" type="number"/>
      <input class="txtfield" name="attr_rof" type="number"/>
      <input name="attr_ammo" type="text"/>
      <input name="attr_rng" type="text"/>
      <input name="attr_rsharp" type="text"/>
      <select name="attr_attribute">
        <option class="cap" value="[[@{con}]]">con</option>
        <option class="cap" value="[[@{dex}]]">dex</option>
        <option class="cap" value="[[@{spd}]]">spd</option>
        <option class="cap" value="[[@{str}]]">str</option>
        <option class="cap" value="[[@{cr}]]">cr</option>
        <option class="cap" value="[[@{cha}]]">cha</option>
        <option class="cap" value="[[@{int}]]">int</option>
        <option class="cap" value="[[@{per}]]">per</option>
        <option class="cap" value="[[@{wil}]]">wil</option>
        <option class="cap" value="[[@{mr}]]">mr</option>
        <option class="cap" value="[[@{none}]]">none</option>
      </select>
      <input name="attr_skill" type="text"/>
    </fieldset>
    <h2>Armor</h2>
    <div class="desc-row"><span class="armor">name</span><span>pr</span><span>enc</span><span>R#</span></div>
    <fieldset class="repeating_armor">
      <input class="name" name="attr_name" title="@{name}" type="text"/>
      <input class="txtfield" name="attr_pr" type="number"/>
      <input class="txtfield" name="attr_enc" type="number"/>
      <input name="attr_rsharp" type="text"/>
    </fieldset>
  </section>
  <section class="notes columnflex nowrap">
    <h2>Disadvantages</h2>
    <div class="rowflex middle"><span><span>personal</span>
        <input name="attr_personal" title="@{personal}" type="text"/></span></div>
    <div class="rowflex middle"><span><span>internal</span>
        <input name="attr_internal" title="@{internal}" type="text"/></span></div>
    <div class="rowflex middle"><span><span>external</span>
        <input name="attr_external" title="@{external}" type="text"/></span></div>
    <h2>archetype</h2>
    <textarea name="attr_archetype"></textarea>
    <h2>species_notes</h2>
    <textarea name="attr_species_notes"></textarea>
    <h2>equipment</h2>
    <textarea name="attr_equipment"></textarea>
  </section>
  <section class="footer"></section>
</main>
<main class="notes">
  <h2>Notes</h2>
  <section class="columnflex">
    <h3>archetype</h3>
    <textarea name="attr_archetype"></textarea>
  </section>
  <section class="columnflex">
    <h3>species_notes</h3>
    <textarea name="attr_species_notes"></textarea>
  </section>
  <section class="columnflex">
    <h3>weapons</h3>
    <textarea name="attr_weapons"></textarea>
  </section>
  <section class="columnflex">
    <h3>powers</h3>
    <textarea name="attr_powers"></textarea>
  </section>
  <section class="columnflex">
    <h3>equipment</h3>
    <textarea name="attr_equipment"></textarea>
  </section>
  <section class="columnflex">
    <h3>notes</h3>
    <textarea name="attr_notes"></textarea>
  </section>
</main>
<main class="settings">
  <h2>Settings</h2>
  <div class="section rowflex nowrap"><span>Ask for Roll Modifiers?</span>
    <select class="short" name="attr_modquery" title="@{modquery}">
      <option value="+(?{Roll Modifier|0}[Modifiers])">Yes</option>
      <option value=" ">No</option>
    </select>
  </div>
  <div class="section rowflex nowrap"><span>Show Character Name in rolls?</span>
    <select class="short" name="attr_showname" title="@{showname}">
      <option value="{{subtitle=@{character_name} }}">Yes</option>
      <option value=" ">No</option>
    </select>
  </div>
  <div class="section rowflex nowrap gap"><span title="@{whisper}">Whisper rolls to GM?</span>
    <input name="attr_whisper" title="@{whisper}" type="checkbox" value="/w gm"/>
  </div>
  <div class="section rowflex nowrap gap"><span>Dice type</span>
    <select name="attr_dice" title="@{dice}">
      <option value="2d10cf0cs0" selected="selected">2d10 (GODSEND Agenda)</option>
      <option value="1d20">d20 (Talislanta, Hellas, Atlantis)</option>
      <option value="2d10" selected="selected">2d10 (1s &amp; 10s higlighted)</option>
    </select>
  </div>
  <div class="section rowflex nowrap gap"><span>Game System (Header &amp; layout)</span>
    <select name="attr_gametype">
      <option value="godsend" selected="selected">GODSEND Agenda</option>
      <option value="talislanta">Talislanta</option>
      <option value="hellas">Hellas</option>
      <option value="atlantis">Atlantis: Second Age</option>
    </select>
  </div>
</main>
<!--hidden inputs & datalists-->
<!--sheet version-->
<input type="hidden" name="attr_version" value="1.3.0"/>
<input type="hidden" name="attr_dice" value="2d10cf0cs0"/>
<input type="hidden" name="attr_none" value="0"/>
<datalist id="archetypesgodsend">
  <option value="Adventurer"></option>
  <option value="Anarchist"></option>
  <option value="Avenger"></option>
  <option value="Bravo"></option>
  <option value="Icon"></option>
  <option value="Outsider"></option>
  <option value="Protector"></option>
  <option value="Rogue"></option>
  <option value="Scholar"></option>
  <option value="Warrior"></option>
  <option value="Crony"></option>
  <option value="Megalomaniac"></option>
  <option value="Nihilist"></option>
</datalist>
<datalist id="speciesgodsend">
  <option value="Angelos"></option>
  <option value="Atlantean"></option>
  <option value="Black October"></option>
  <option value="Chimerans"></option>
  <option value="Elohim"></option>
  <option value="U.S.E.R. Agent"></option>
</datalist>
<datalist id="skillsgodsend">
  <option value="Athletics"></option>
  <option value="Evade"></option>
  <option value="Fighting"></option>
  <option value="Influence"></option>
  <option value="Intuition"></option>
  <option value="Investigation"></option>
  <option value="Movement"></option>
  <option value="Perform"></option>
  <option value="Piloting"></option>
  <option value="Ranged Fighting"></option>
  <option value="Resistance"></option>
  <option value="Scholar"></option>
  <option value="Stealth"></option>
  <option value="Technical"></option>
  <option value="Thievery"></option>
</datalist>
<!--roll templates-->
<rolltemplate class="sheet-rolltemplate-rolls">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">{{#title}}
      <div class="sheet-title">{{title}}</div>{{/title}}
            {{#name}}
      <div class="sheet-name">{{name}}</div>{{/name}}
            {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
    </div>
    <div class="sheet-content">{{#allprops() title subtitle name desc color}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>      {{/allprops() title subtitle name desc color}}
            {{#roll}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>      {{/roll}}
            {{#rollLess() roll 0}}
      <div class="sheet-fail">Critical Fumble!</div>      {{/rollLess() roll 0}}
            {{#rollBetween() roll 1 5}}
      <div class="sheet-fail">Failure</div>      {{/rollBetween() roll 1 5}}
            {{#rollBetween() roll 6 10}}
      <div class="sheet-crit">Partial Success</div>      {{/rollBetween() roll 6 10}}
            {{#rollBetween() roll 11 19}}
      <div class="sheet-crit">Success</div>      {{/rollBetween() roll 11 19}}
            {{#rollGreater() roll 19}}
      <div class="sheet-crit">Critical Success!</div>      {{/rollGreater() roll 19}}
            {{#desc}}
      <div class="sheet-desc">{{desc}}</div>{{/desc}}
    </div>
  </div>
</rolltemplate>
<!--sheetworkers-->
<script type="text/worker">
//current sheet version
const currentversion = "1.3.0";

const int = score => parseInt(score, 10) || 0;

// tabs

const buttonlist = ["character", "notes", "settings"];

buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
      console.log(button + " was pressed");
      setAttrs({
          sheetTab: button
      });
    });
});


// game system

/*
on("change:gametype", function(game) {

  getAttrs("gametype", values => {

    let gametype = values["gametype"];
    console.log("Game System set to: " + gametype);

    let gamedice = "2d10cf0cs0";

    if (gametype === "godsend"){
      gamedice = "2d10cf0cs0";
    }
    else if (gametype === "hellas") {
      gamedice = "1d20";
    }
    else if (gametype === "atlantis") {
      gamedice = "1d20";
    }
    else if (gametype === "talislanta") {
      gamedice = "1d20";
    }
    setAttrs({
        dice: gamedice
    });
  });
}); */


</script>