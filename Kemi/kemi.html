<div id="content">

    <button id="show_params_button" type="action" name="act_show_params">y</button>
    <input type="hidden" name="attr_show_params" value="0">
    <input type="hidden" name="attr_param_use_heka">

    <div id="params">
        <h2>Paramètres</h2>
        <button id="close_params_button" type="action" name="act_close_params">&times;</button>
        <div>
            <input type="checkbox" name="attr_param_use_heka" value="true"><span>Utilisation de la magie (Héka)</span>
        </div>
    </div>

    <div id="title">
        <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Kemi/images/Kemi-title.png">
    </div>

    <div id="main">
        <div class="col">
            <div id="identite">
                <div id="nom_xp">
                    <div>
                        <h2>Nom</h2>
                        <input type="text" name="attr_nom">
                    </div>
                    <div>
                        <h2>XP</h2>
                        <input type="number" name="attr_xp" value="0">
                    </div>
                </div>
                <div>
                    <h2>Carrière</h2>
                    <input type="text" name="attr_carriere">
                </div>
                <div>
                    <h2>Description</h2>
                    <textarea name="attr_description"></textarea>
                </div>
                <div>
                    <h2>Histoire personnelle</h2>
                    <textarea name="attr_histoire_personnelle"></textarea>
                </div>
            </div>

            <div id="inventaire">
                <div id="equipements">
                    <h2>Equipement</h2>
                    <fieldset class="repeating_equipements">
                        <input type="text" name="attr_equipement" value="">
                    </fieldset>
                </div>
                <div id="armes">
                    <h2>Armes</h2>
                    <fieldset class="repeating_armes">
                        <input type="text" name="attr_arme_nom" value="" placeholder="Nom">
                        <input type="text" name="attr_arme_degats" value="" placeholder="dégâts">
                    </fieldset>
                </div>
                <div id="armures">
                    <h2>Armures</h2>
                    <fieldset class="repeating_armes">
                        <input type="text" name="attr_armure_nom" value="" placeholder="Nom">
                        <input type="text" name="attr_armure_protection" value="" placeholder="PR">
                    </fieldset>
                </div>
                <div id="sorts" class="heka_component">
                    <h2>Sorts</h2>
                    <fieldset class="repeating_sorts">
                        <select name="attr_sort_type">
                            <option value="Image">Image</option>
                            <option value="Verbe">Verbe</option>
                            <option value="Ecrit">Ecrit</option>
                            <option value="Création ">Création </option>
                            <option value="Alchimie">Alchimie</option>
                        </select>
                        <input type="text" name="attr_sort_descr" value="">
                        <input type="number" name="attr_sort_cost" value="0">
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="col">
            <div id="attributs">
                <h1>Attributs</h1>

                <div>
                    <div>
                        <button type="roll" name="roll_physique" value="&{template:roll} {{name=Physique}} {{result=[[@{dices}d6 + @{physique}]]}} {{dices=@{dices}}} {{attribute=@{physique}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_physique" value="0">
                        <h3>Physique</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_agilite" value="&{template:roll} {{name=Agilité}} {{result=[[@{dices}d6 + @{agilite}]]}} {{dices=@{dices}}} {{attribute=@{agilite}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_agilite" value="0">
                        <h3>Agilité</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_perception" value="&{template:roll} {{name=Perception}} {{result=[[@{dices}d6 + @{perception}]]}} {{dices=@{dices}}} {{attribute=@{perception}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_perception" value="0">
                        <h3>Perception</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_charisme" value="&{template:roll} {{name=Charisme}} {{result=[[@{dices}d6 + @{charisme}]]}} {{dices=@{dices}}} {{attribute=@{charisme}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_charisme" value="0">
                        <h3>Charisme</h3>
                    </div>

                    <div class="v-space"></div>

                    <div>
                        <button type="roll" name="roll_artisanat" value="&{template:roll} {{name=Artisanat}} {{result=[[@{dices}d6 + @{artisanat}]]}} {{dices=@{dices}}} {{attribute=@{artisanat}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_artisanat" value="0">
                        <h3>Artisanat</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_bureaucratie" value="&{template:roll} {{name=Bureaucratie}} {{result=[[@{dices}d6 + @{bureaucratie}]]}} {{dices=@{dices}}} {{attribute=@{bureaucratie}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_bureaucratie" value="0">
                        <h3>Bureaucratie</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_combat" value="&{template:roll} {{name=Combat}} {{result=[[@{dices}d6 + @{combat}]]}} {{dices=@{dices}}} {{attribute=@{combat}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_combat" value="0">
                        <h3>Combat</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_connaissance" value="&{template:roll} {{name=Connaissance du monde}} {{result=[[@{dices}d6 + @{connaissance}]]}} {{dices=@{dices}}} {{attribute=@{connaissance}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_connaissance" value="0">
                        <h3>Connaissance du monde</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_culture" value="&{template:roll} {{name=Culture égyptienne}} {{result=[[@{dices}d6 + @{culture}]]}} {{dices=@{dices}}} {{attribute=@{culture}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_culture" value="0">
                        <h3>Culture égyptienne</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_erudition" value="&{template:roll} {{name=Erudition}} {{result=[[@{dices}d6 + @{erudition}]]}} {{dices=@{dices}}} {{attribute=@{erudition}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_erudition" value="0">
                        <h3>Erudition</h3>
                    </div>
                    <div class="heka_component">
                        <button type="roll" name="roll_heka" value="&{template:roll} {{name=Heka}} {{result=[[@{dices}d6 + @{heka}]]}} {{dices=@{dices}}} {{attribute=@{heka}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_heka" value="0">
                        <h3>Héka</h3>
                        <div id="heka_dieux">
                            <select name="attr_dieu_1">
                                <option value="Amon">Amon</option>
                                <option value="Anubis">Anubis</option>
                                <option value="Atoum">Atoum</option>
                                <option value="Djéhouty">Djéhouty</option>
                                <option value="Hathor">Hathor</option>
                                <option value="Horus">Horus</option>
                                <option value="Iset">Iset</option>
                                <option value="Khnoum">Khnoum</option>
                                <option value="Khonsou">Khonsou</option>
                                <option value="Mout">Mout</option>
                                <option value="Nebet Het">Nebet Het</option>
                                <option value="Ousir">Ousir</option>
                                <option value="Ptah">Ptah</option>
                                <option value="Rê">Rê</option>
                                <option value="Sekhmet">Sekhmet</option>
                                <option value="Sutekh">Sutekh</option>
                            </select>
                            <fieldset class="repeating_dieux">
                                <select name="attr_dieu_2">
                                    <option value="Amon">Amon</option>
                                    <option value="Anubis">Anubis</option>
                                    <option value="Atoum">Atoum</option>
                                    <option value="Djéhouty">Djéhouty</option>
                                    <option value="Hathor">Hathor</option>
                                    <option value="Horus">Horus</option>
                                    <option value="Iset">Iset</option>
                                    <option value="Khnoum">Khnoum</option>
                                    <option value="Khonsou">Khonsou</option>
                                    <option value="Mout">Mout</option>
                                    <option value="Nebet Het">Nebet Het</option>
                                    <option value="Ousir">Ousir</option>
                                    <option value="Ptah">Ptah</option>
                                    <option value="Rê">Rê</option>
                                    <option value="Sekhmet">Sekhmet</option>
                                    <option value="Sutekh">Sutekh</option>
                                </select>
                            </fieldset>
                        </div>
                    </div>
                    <div>
                        <button type="roll" name="roll_medecine" value="&{template:roll} {{name=Médecine}} {{result=[[@{dices}d6 + @{medecine}]]}} {{dices=@{dices}}} {{attribute=@{medecine}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_medecine" value="0">
                        <h3>Médecine</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_tir" value="&{template:roll} {{name=Tir}} {{result=[[@{dices}d6 + @{tir}]]}} {{dices=@{dices}}} {{attribute=@{tir}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_tir" value="0">
                        <h3>Tir</h3>
                    </div>
                    <div>
                        <button type="roll" name="roll_voyage" value="&{template:roll} {{name=Voyage}} {{result=[[@{dices}d6 + @{voyage}]]}} {{dices=@{dices}}} {{attribute=@{voyage}}} {{maat=[[@{use_maat}]]}}"></button>
                        <input type="number" name="attr_voyage" value="0">
                        <h3>Voyage</h3>
                    </div>
                </div>
            </div>

            <div id="points">
                <div id="points_vie">
                    <h2>Ka</h2>
                    <input type="number" class="no-spinners" name="attr_pv" value="0">
                    <span>Max : <input type="number" name="attr_pv_max" value="0"></span>
                </div>
                <div id="points_heka" class="heka_component">
                    <h2>Héka</h2>
                    <input type="number" class="no-spinners" name="attr_ph" value="0">
                    <span>Max : <input type="number" name="attr_ph_max" value="0"></span>
                </div>
                <div id="points_maat">
                    <h2>Maât</h2>
                    <input type="number" class="no-spinners" name="attr_pm" value="0">
                    <input type="checkbox" name="attr_use_maat" value="1">
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden inputs -->
    <input type="hidden" name="attr_dices" value="1">

</div>


<rolltemplate class="sheet-rolltemplate-roll">
    <div class="sheet-template-container">
	    <div class="sheet-template-header">
            {{name}}
        </div>
        <div class="sheet-template-result">
            <span>{{result}}</span> ({{dices}}d6 + {{attribute}})
        </div>
        {{#rollGreater() maat 0}}
        <div class="sheet-template-maat">
            avec l'aide des Dieux
        </div>
        {{/rollGreater() maat 0}}
        <div class="sheet-template-footer">
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Kemi/images/Kemi-ailes.png">
        </div>
    </div>
</rolltemplate>




<script type="text/worker">

on("change:use_maat", function() {
    getAttrs(["use_maat"], function(values) {
        if (Number(values.use_maat) == 1) {
            setAttrs({
                "dices": 2
            });
        }
        else {
            setAttrs({
                "dices": 1
            });
        }
    });
});

on("change:physique", function() {
    getAttrs(["physique"], function(values) {
        setAttrs({                            
            "pv_max": 10 + Number(values.physique),
        });
    });
});

on("change:heka", function() {
    getAttrs(["heka"], function(values) {
        setAttrs({                            
            "ph_max": 10 + Number(values.heka),
        });
    });
});

on("clicked:show_params", function() {
    console.log("Show params");
    setAttrs({                            
        "show_params": 1,
    });
});
on("clicked:close_params", function() {
    setAttrs({                            
        "show_params": 0,
    });
});

</script>

