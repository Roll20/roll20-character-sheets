<!---Mutants n Masterminds 3E Official Sheet by Green Ronin, sheet authors Richard Tran and Scott Casey
  v1.02 -- Initial release
  ---> 
<input type="hidden" name="attr_op_animation" value="on">
<input type="hidden" name="attr_op_bleach" value="0">
<input type="hidden" name="attr_op_npc" value="0">

<div class="option_menu">
  <label class="chk_toggle"><input type="checkbox" name="attr_op_gmRoll" value="/w gm"><span data-i18n="gm_roll">GM Roll</span></label>
  <label class="chk_toggle"><input type="checkbox" name="attr_op_animation" value="off"><span data-i18n="reduced_animations">Reduced Animations</span></label>
  <label class="chk_toggle"><input type="checkbox" name="attr_op_bleach" value="on"><span data-i18n="sun_bleached">Sun Bleached</span></label>
  <label class="chk_toggle"><input type="checkbox" name="attr_tut_powers" value="0"><span data-i18n="reset_tutorials">Reset Tutorials</span></label>
  <label class="chk_toggle"><input type="checkbox" name="attr_op_npc" value="on"><span data-i18n="npc_sheet">NPC Sheet</span></label>
  <button type="roll" class="btn_importer" value="&{template:roll} {{name=Mutants & Masterminds 3E}} {{link=[Link to the sheet wiki, 
    (Opens in same window)](https://wiki.roll20.net/Mutants_%26_Masterminds_3E_Official)}}"><span data-i18n="instructions">Instructions</span></button>
  <a class="btn_importer" href="#importer">Hero Lab Importer</a>
</div>

<div class="sheet">
  
  <input type="hidden" name="attr_penalty_general" value="0">
  <datalist id="damage-types">
    <option value="Bludgeoning" data-i18n="bludgeoning">Bludgeoning</option>
    <option value="Slashing" data-i18n="slashing">Slashing</option>
    <option value="Piercing" data-i18n="piercing">Piercing</option>
    <option value="Chemical" data-i18n="chemical">Chemical</option>
    <option value="Electrical" data-i18n="electrical">Electrical</option>
  </datalist>
  <datalist id="defense-types">
    <option value="Dodge" data-i18n="dodge">Dodge</option>
    <option value="Parry" data-i18n="parry">Parry</option>
    <option value="Fortitude" data-i18n="fortitude">Fortitude</option>
    <option value="Toughness" data-i18n="toughness">Toughness</option>
    <option value="Will" data-i18n="will">Will</option>
  </datalist>
  <datalist id="attribute-types">
    <option value="strength" data-i18n="strength">Strength</option>
    <option value="stamina" data-i18n="stamina">Stamina</option>
    <option value="agility" data-i18n="agility">Agility</option>
    <option value="dexterity" data-i18n="dexterity">Dexterity</option>
    <option value="fighting" data-i18n="fighting">Fighting</option>
    <option value="intellect" data-i18n="intellect">Intellect</option>
    <option value="awareness" data-i18n="awareness">Awareness</option>
    <option value="presence" data-i18n="presence">Presence</option>
  </datalist>

<link rel="stylesheet" href="mutants-and-masterminds3e.css">
<img src="https://i.imgur.com/0aRNO0Z.png" title="Mustants and Masterminds 3E Character" class="logo">
<!-- Herolab Importer -->
<div id="importer" class="overlay">
  <a class="btn_exit" href="#">&times;</a>
  <div class="wrapper importer">
    <h1>Hero Lab Importer</h1>
    <textarea name='attr_statblock' placeholder="Paste JSON text here..."></textarea>
    <span class="warning">The importer will overwrite information on the sheet. Please use the instructions found on the sheet wiki.<br>
      https://wiki.roll20.net/Mutants_%26_Masterminds_3E_Official </a>
      <br><br>[2021-Sept-17] This feature is experimental; power formatting may not be perfect.  </span>
    <button type='action' name='act_import'>Import</button>
  </div>
</div>
<!-- End Importer -->
<!-- NPC Sheet -->
<div class="wrapper npcSheet">
  <div class="npcDetails">
    <input type="text" name="attr_character_name">
    <span>PL</span>
    <input type="number" name="attr_powerlevel">
  </div>
  <div class="npcAttributes">
    <button name="roll_strength" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Strength}} {{result=[[1d20 + @{strength} + (@{penalty_general} [Conditions])]]}}"><h2>STR</h2><span name="attr_strength">0</span></button>
    <button name="roll_stamina" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Stamina}} {{result=[[1d20 + @{stamina} + (@{penalty_general} [Conditions])]]}}"><h2>STA</h2><span name="attr_stamina">0</span></button>
    <button name="roll_agility" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Agility}} {{result=[[1d20 + @{agility} + (@{penalty_general} [Conditions])]]}}"><h2>AGL</h2><span name="attr_agility">0</span></button>
    <button name="roll_dexterity" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=dexterity}} {{result=[[1d20 + @{dexterity} + (@{penalty_general} [Conditions])]]}}"><h2>DEX</h2><span name="attr_dexterity">0</span></button>
    <button name="roll_fighting" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=fighting}} {{result=[[1d20 + @{fighting} + (@{penalty_general} [Conditions])]]}}"><h2>FGT</h2><span name="attr_fighting">0</span></button>
    <button name="roll_intellect" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=intellect}} {{result=[[1d20 + @{intellect} + (@{penalty_general} [Conditions])]]}}"><h2>INT</h2><span name="attr_intellect">0</span></button>
    <button name="roll_awareness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=awareness}} {{result=[[1d20 + @{awareness} + (@{penalty_general} [Conditions])]]}}"><h2>AWE</h2><span name="attr_awareness">0</span></button>
    <button name="roll_presence" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=presence}} {{result=[[1d20 + @{presence} + (@{penalty_general} [Conditions])]]}}"><h2>PRE</h2><span name="attr_presence">0</span></button>
  </div>
  <div class="npcPowers">
    <h2 data-i18n="powers">Powers</h2>
    <fieldset class="repeating_powers npcPowers">
      <input class="controller" type="hidden" name="attr_element_type">
      <input type="hidden" name="attr_label">
      <span name="attr_label"></span>
      <input type="hidden" name="attr_rank_total">
      <button name="roll_powerRank" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20 + @{rank_total} + (@{penalty_general} [Conditions])]]}}">
        <span name="attr_rank_total"></span>
      </button>
      <input type="hidden" name="attr_afflictions_1">
      <input type="hidden" name="attr_afflictions_2">
      <input type="hidden" name="attr_afflictions_3">
      <div class="npcAfflictions">
        <span data-i18n="afflictions">Afflictions</span>
        [ <span data-i18n="resisted_by"> Resisted by</span>
        <span name="attr_afflictions_type"></span>:
        <span name="attr_afflictions_1"></span>
        <span name="attr_afflictions_2"></span>
        <span name="attr_afflictions_3"></span>
        ]
      </div>
    </fieldset>
    <fieldset class="repeating_equipment hideCheck"></fieldset>
    <div class="hideable">
      <h2 data-i18n="equipment">Equipment</h2>
      <fieldset class="repeating_equipment npcPowers">
        <input class="controller" type="hidden" name="attr_element_type">
        <input type="hidden" name="attr_label">
        <span name="attr_label"></span>
        <input type="hidden" name="attr_rank_total">
        <button name="roll_power" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20 + @{rank_total} + (@{penalty_general} [Conditions])]]}}">
          <span name="attr_rank_total"></span>
        </button>
        <input type="hidden" name="attr_afflictions_1">
        <input type="hidden" name="attr_afflictions_2">
        <input type="hidden" name="attr_afflictions_3">
        <div class="npcAfflictions">
          <span data-i18n="afflictions">Afflictions</span>
          [ <span data-i18n="resisted_by"> Resisted by</span>
          <span name="attr_afflictions_type"></span>:
          <span name="attr_afflictions_1"></span>
          <span name="attr_afflictions_2"></span>
          <span name="attr_afflictions_3"></span>
          ]
        </div>
      </fieldset>
    </div>

  </div>
  
  <div class="npcAdvantages">
    <h2 data-i18n="advantages">Advantages</h2>
    <fieldset class="repeating_advantages npcAdvantages">
      <span name="attr_name"></span>
    </fieldset>
  </div>
  
  <div class="npcSkills">
    <h2 data-i18n="skills">Skills</h2>
    <input type="hidden" name="attr_acrobatics_rank"/>
    <button name="roll_acrobatics" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=acrobatics}} {{result=[[1d20 + @{acrobatics} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="acrobatics">acrobatics</span><input type="hidden" class="plusControl" name="attr_acrobatics"><span name="attr_acrobatics"></span></button>
    <input type="hidden" name="attr_athletics_rank"/>
    <button name="roll_athletics" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=athletics}} {{result=[[1d20 + @{athletics} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="athletics">athletics</span><input type="hidden" class="plusControl" name="attr_athletics"><span name="attr_athletics"></span></button>
    
    <fieldset class="repeating_closecombat">
      <input type="hidden" name="attr_specialty">
      <button name="roll_closecombat" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=@{specialty}}} {{result=[[1d20 + @{specialty_total} + (@{penalty_general} [Conditions])]]}}"><span name="attr_specialty"></span>+<input disabled type="number" value="@{specialty_rank} + @{specialty_mod} + @{fighting}" name="attr_specialty_total"></span></button>
    </fieldset>
    
    <input type="hidden" name="attr_deception_rank"/>
    <button name="roll_deception" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=deception}} {{result=[[1d20 + @{deception} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="deception">deception</span><input type="hidden" class="plusControl" name="attr_deception"><span name="attr_deception"></span></button>
    <input type="hidden" name="attr_expertise_rank"/>
    <button name="roll_expertise" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=expertise}} {{result=[[1d20 + @{expertise} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="expertise">expertise</span><input type="hidden" class="plusControl" name="attr_expertise"><span name="attr_expertise"></span></button>
    <input type="hidden" name="attr_insight_rank"/>
    <button name="roll_insight" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=insight}} {{result=[[1d20 + @{insight} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="insight">insight</span><input type="hidden" class="plusControl" name="attr_insight"><span name="attr_insight"></span></button>
    <input type="hidden" name="attr_intimidation_rank"/>
    <button name="roll_intimidation" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=intimidation}} {{result=[[1d20 + @{intimidation} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="intimidation">intimidation</span><input type="hidden" class="plusControl" name="attr_intimidation"><span name="attr_intimidation"></span></button>
    <input type="hidden" name="attr_investigation_rank"/>
    <button name="roll_investigation" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=investigation}} {{result=[[1d20 + @{investigation} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="investigation">investigation</span><input type="hidden" class="plusControl" name="attr_investigation"><span name="attr_investigation"></span></button>
    <input type="hidden" name="attr_perception_rank"/>
    <button name="roll_perception" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=perception}} {{result=[[1d20 + @{perception} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="perception">perception</span><input type="hidden" class="plusControl" name="attr_perception"><span name="attr_perception"></span></button>
    <input type="hidden" name="attr_persuasion_rank"/>
    <button name="roll_persuasion" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=persuasion}} {{result=[[1d20 + @{persuasion} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="persuasion">persuasion</span><input type="hidden" class="plusControl" name="attr_persuasion"><span name="attr_persuasion"></span></button>
    <fieldset class="repeating_rangedcombat">
      <input type="hidden" name="attr_specialty">
      <button name="roll_rangedcombat" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=@{specialty}}} {{result=[[1d20 + @{specialty_total} + (@{penalty_general} [Conditions])]]}}"><span name="attr_specialty"></span>+<input disabled type="number" value="@{specialty_rank} + @{specialty_mod} + @{fighting}" name="attr_specialty_total"></span></button>
    </fieldset>
    <input type="hidden" name="attr_sleightofhand_rank"/>
    <button name="roll_sleightofhand" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=sleightofhand}} {{result=[[1d20 + @{sleightofhand} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="sleightofhand">sleightofhand</span><input type="hidden" class="plusControl" name="attr_sleightofhand"><span name="attr_sleightofhand"></span></button>
    <input type="hidden" name="attr_stealth_rank"/>
    <button name="roll_stealth" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=stealth}} {{result=[[1d20 + @{stealth} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="stealth">stealth</span><input type="hidden" class="plusControl" name="attr_stealth"><span name="attr_stealth"></span></button>
    <input type="hidden" name="attr_technology_rank"/>
    <button name="roll_technology" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=technology}} {{result=[[1d20 + @{technology} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="technology">technology</span><input type="hidden" class="plusControl" name="attr_technology"><span name="attr_technology"></span></button>
    <input type="hidden" name="attr_treatment_rank"/>
    <button name="roll_treatment" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=treatment}} {{result=[[1d20 + @{treatment} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="treatment">treatment</span><input type="hidden" class="plusControl" name="attr_treatment"><span name="attr_treatment"></span></button>
    <input type="hidden" name="attr_vehicles_rank"/>
    <button name="roll_vehicles" type="roll" value="@{op_gmRoll} &amp;{template:roll} {{name=@{character_name}}} {{trait=vehicles}} {{result=[[1d20 + @{vehicles} + (@{penalty_general} [Conditions])]]}}"><span data-i18n="vehicles">vehicles</span><input type="hidden" class="plusControl" name="attr_vehicles"><span name="attr_vehicles"></span></button>
  </div>
  <div class="npcAttacks">
    <h2 data-i18n="offenses">Offenses</h2>
    <button class="npcInitiative"name="roll_attack" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Initiative}} {{result=[[1d20 + @{initiative} + (@{penalty_general} [Conditions])]]}}">
      <span data-i18n="initative">Initiative</span>
      <span name="attr_initiative"></span>
    </button>
    <fieldset class="repeating_attacks npcAttacks">
      <input type="hidden" name="attr_label">
      <input type="hidden" name="attr_descriptor">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_attack_name">
      <input type="hidden" name="attr_dc">
      <input type="hidden" name="attr_attack">
      <input type="hidden" name="attr_attack_rank">
      <input type="hidden" name="attr_attack_mod" value="0">
      <input type="hidden" name="attr_attack_crit" value="20">
      <input type="hidden" name="attr_action">
      <input type="hidden" name="attr_range">
      <input type="hidden" name="attr_aoe">
      <input type="hidden" name="attr_afflictions_type">
      <input type="hidden" name="attr_aff1_DC">
      <input type="hidden" name="attr_aff2_DC">
      <input type="hidden" name="attr_aff3_DC">
      <button name="roll_attack" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{damage=[[@{dc}]]}} {{trait=@{attack_name}}} {{result=[[1d20cs>@{attack_crit} + @{attack} + (@{penalty_general} [Conditions])]]}}">
        <span name="attr_attack_name"></span>
        <input type="hidden" class="plusControl" name="attr_attack">
        <span name="attr_attack"></span>
        (
        <span name="attr_action"></span>
        <span name="attr_range"></span>
        <span name="attr_duration"></span>
        <span name="attr_aoe"></span>
        <span data-i18n="rank">Rank</span>
        <span name="attr_rank_total"></span>
        <input type="hidden" name="attr_afflictions_1">
        <input type="hidden" name="attr_afflictions_2">
        <input type="hidden" name="attr_afflictions_3">
        <div class="npcAfflictions">
          <span data-i18n="afflictions">Afflictions</span>
          [
          <span name="attr_afflictions_1"></span>
          <span name="attr_afflictions_2"></span>
          <span name="attr_afflictions_3"></span>
          ]
        </div>
        )
      </button>
    </fieldset>
    <fieldset class="repeating_powers npcAttacks">
      <input class="controller" type="hidden" name="attr_element_type" value="menu">
      <input type="hidden" name="attr_label">
      <input type="hidden" name="attr_descriptor">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_attack">
      <input type="hidden" name="attr_dc">
      <input type="hidden" name="attr_rank_total">
      <input type="hidden" name="attr_attack_mod" value="0">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_action">
      <input type="hidden" name="attr_range">
      <input type="hidden" name="attr_aoe">
      <input type="hidden" name="attr_afflictions_type">
      <input type="hidden" name="attr_aff1_DC">
      <input type="hidden" name="attr_aff2_DC">
      <input type="hidden" name="attr_aff3_DC">
      <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{dc}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
        <span name="attr_label"></span>
        <input type="hidden" class="plusControl" name="attr_attack">
        <span name="attr_attack"></span>
        (
        <span name="attr_action"></span>
        <span name="attr_range"></span>
        <span name="attr_duration"></span>
        <span name="attr_aoe"></span>
        <span data-i18n="rank">Rank</span>
        <span name="attr_rank_total"></span>
        <input type="hidden" name="attr_afflictions_1">
        <input type="hidden" name="attr_afflictions_2">
        <input type="hidden" name="attr_afflictions_3">

        <div class="npcAfflictions">
          <span data-i18n="afflictions">Affliction</span>
        </div>
        )
      </button>
    </fieldset>
    <fieldset class="repeating_equipment hideCheck"></fieldset>
    <div class="hideable">
      <h2 data-i18n="equipment">Equipment</h2>
      <fieldset class="repeating_equipment npcAttacks">
        <input class="controller" type="hidden" name="attr_element_type" value="menu">
        <input type="hidden" name="attr_label">
        <input type="hidden" name="attr_descriptor">
        <input type="hidden" name="attr_crit" value="20">
        <input type="hidden" name="attr_crit" value="20">
        <input type="hidden" name="attr_attack">
        <input type="hidden" name="attr_dc">
        <input type="hidden" name="attr_rank_total">
        <input type="hidden" name="attr_attack_mod" value="0">
        <input type="hidden" name="attr_crit" value="20">
        <input type="hidden" name="attr_action">
        <input type="hidden" name="attr_range">
        <input type="hidden" name="attr_aoe">
        <input type="hidden" name="attr_afflictions_type">
        <input type="hidden" name="attr_aff1_DC">
        <input type="hidden" name="attr_aff2_DC">
        <input type="hidden" name="attr_aff3_DC">
        <button name="roll_equipmentAttack" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{dc}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
          <span name="attr_label"></span>
          <input type="hidden" class="plusControl" name="attr_attack">
          <span name="attr_attack"></span>
          (
          <span name="attr_action"></span>
          <span name="attr_range"></span>
          <span name="attr_duration"></span>
          <span name="attr_aoe"></span>
          <span data-i18n="rank">Rank</span>
          <span name="attr_rank_total"></span>
          <input type="hidden" name="attr_afflictions_1">
          <input type="hidden" name="attr_afflictions_2">
          <input type="hidden" name="attr_afflictions_3">

          <div class="npcAfflictions">
            <span data-i18n="afflictions">Affliction</span>
          </div>
          )
        </button>
      </fieldset>
    </div>
    
  </div>
  
  <div class="npcDefenses">
    <button name="roll_dodge" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=dodge}} {{result=[[1d20 + @{dodge} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="dodge">dodge</h2><span name="attr_dodge">0</span></button>
    <button name="roll_parry" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=parry}} {{result=[[1d20 + @{parry} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="parry">parry</h2><span name="attr_parry">0</span></button>
    <button name="roll_fortitude" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=fortitude}} {{result=[[1d20 + @{fortitude} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="fortitude">fortitude</h2><span name="attr_fortitude">0</span></button>
    <button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=toughness}} {{result=[[1d20 + @{toughness} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="toughness">toughness</h2><span name="attr_toughness">0</span></button>
    <button name="roll_will" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=will}} {{result=[[1d20 + @{will} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="will">will</h2><span name="attr_will">0</span></button>
  </div>
<fieldset class="repeating_vehicles hideCheck"></fieldset>
  <div class="hideable npcVehicles">
    <fieldset class="repeating_vehicles npcPowers">
      <input class="controller" type="hidden" name="attr_element_type">
      <input type="hidden" name="attr_label">
      <span name="attr_label"></span>
      <span class="vehicleHide" name="attr_size" style="font-weight: bold"></span>
      <input type="hidden" name="attr_rank_total">
      <button name="roll_vehiclePower" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20 + @{rank_total} + (@{penalty_general} [Conditions])]]}}">
        <span name="attr_rank_total"></span>
      </button>
      <input type="hidden" name="attr_afflictions_1">
      <input type="hidden" name="attr_afflictions_2">
      <input type="hidden" name="attr_afflictions_3">
      <div class="npcAfflictions">
        <span data-i18n="afflictions">Afflictions</span>
        [ <span data-i18n="resisted_by"> Resisted by</span>
        <span name="attr_afflictions_type"></span>
        <span name="attr_afflictions_1"></span>
        <span name="attr_afflictions_2"></span>
        <span name="attr_afflictions_3"></span>
        ]
      </div>
    </fieldset>
    <div class="npcDefenses">
      <button name="roll_dodge" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=strength}} {{result=[[1d20 + @{strength} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="strength">strength</h2><span name="attr_strength">0</span></button>
      <button name="roll_parry" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=speed}} {{result=[[1d20 + @{speed} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="speed">speed</h2><span name="attr_speed">0</span></button>
      <button name="roll_fortitude" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=defense}} {{result=[[1d20 + @{defense} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="defense">defense</h2><span name="attr_defense">0</span></button>
      <button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=toughness}} {{result=[[1d20 + @{toughness} + (@{penalty_general} [Conditions])]]}}"><h2 data-i18n="toughness">toughness</h2><span name="attr_toughness">0</span></button>
    </div>
    <fieldset class="repeating_vehicles npcAttacks">
      <input class="controller" type="hidden" name="attr_element_type" value="menu">
      <input type="hidden" name="attr_label">
      <input type="hidden" name="attr_descriptor">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_attack">
      <input type="hidden" name="attr_dc">
      <input type="hidden" name="attr_rank_total">
      <input type="hidden" name="attr_attack_mod" value="0">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_action">
      <input type="hidden" name="attr_range">
      <input type="hidden" name="attr_aoe">
      <input type="hidden" name="attr_afflictions_type">
      <input type="hidden" name="attr_aff1_DC">
      <input type="hidden" name="attr_aff2_DC">
      <input type="hidden" name="attr_aff3_DC">
      <button name="roll_vehicleAttack" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{dc}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
        <span name="attr_label"></span>
        <input type="hidden" class="plusControl" style="font-weight: bold" name="attr_attack">
        <span name="attr_attack"></span>
        (
        <span name="attr_action"></span>
        <span name="attr_range"></span>
        <span name="attr_duration"></span>
        <span name="attr_aoe"></span>
        <span data-i18n="rank">Rank</span>
        <span name="attr_rank_total"></span>
        <input type="hidden" name="attr_afflictions_1">
        <input type="hidden" name="attr_afflictions_2">
        <input type="hidden" name="attr_afflictions_3">

        <div class="npcAfflictions">
          <span data-i18n="afflictions">Affliction</span>
        </div>
        )
      </button>
    </fieldset>
    <div class="npcDefenses">

    </div>
  </div>
<fieldset class="repeating_headquarters hideCheck"></fieldset>
  <div class="hideable npcHeadquarters">
    <fieldset class="repeating_headquarters npcPowers">
      <input class="controller" type="hidden" name="attr_element_type">
      <input type="hidden" name="attr_label">
      <span name="attr_label"></span>
      <span class="vehicleHide" name="attr_size" style="font-weight: bold"></span>
      <input type="hidden" class="plusControl" name="attr_rank_total">
      <input type="hidden" name="attr_rank_total">
      <button name="roll_vehicleRank" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20 + @{rank_total} + (@{penalty_general} [Conditions])]]}}">
        <span name="attr_rank_total"></span>
      </button>
      <input type="hidden" name="attr_afflictions_1">
      <input type="hidden" name="attr_afflictions_2">
      <input type="hidden" name="attr_afflictions_3">
      <div class="npcAfflictions">
        <span data-i18n="afflictions">Afflictions</span>
        [ <span data-i18n="resisted_by"> Resisted by</span>
        <span name="attr_afflictions_type"></span>
        <span name="attr_afflictions_1"></span>
        <span name="attr_afflictions_2"></span>
        <span name="attr_afflictions_3"></span>
        ]
      </div>
    </fieldset>
    <div class="npcDefenses">
      <button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=toughness}} {{result=[[1d20 + @{toughness}]]}}"><h2>toughness</h2><span name="attr_toughness">0</span></button>
    </div>
    <fieldset class="repeating_headquarters npcAttacks">
      <input class="controller" type="hidden" name="attr_element_type" value="menu">
      <input type="hidden" name="attr_label">
      <input type="hidden" name="attr_descriptor">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_attack">
      <input type="hidden" name="attr_dc">
      <input type="hidden" name="attr_rank_total">
      <input type="hidden" name="attr_attack_mod" value="0">
      <input type="hidden" name="attr_crit" value="20">
      <input type="hidden" name="attr_action">
      <input type="hidden" name="attr_range">
      <input type="hidden" name="attr_aoe">
      <input type="hidden" name="attr_afflictions_type">
      <input type="hidden" name="attr_aff1_DC">
      <input type="hidden" name="attr_aff2_DC">
      <input type="hidden" name="attr_aff3_DC">
      <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{dc}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
        <span name="attr_label"></span>
        <input type="hidden" class="plusControl" name="attr_attack">
        <span name="attr_attack"></span>
        (
        <span name="attr_action"></span>
        <span name="attr_range"></span>
        <span name="attr_duration"></span>
        <span name="attr_aoe"></span>
        <span data-i18n="rank">Rank</span>
        <span name="attr_rank_total"></span>
        <input type="hidden" name="attr_afflictions_1">
        <input type="hidden" name="attr_afflictions_2">
        <input type="hidden" name="attr_afflictions_3">

        <div class="npcAfflictions">
          <span data-i18n="afflictions">Affliction</span>
        </div>
        )
      </button>
    </fieldset>
  </div>
</div>
<!-- End NPC Sheet -->

<div class="wrapper main">
  <input type="hidden" class="anim_reduced" name="attr_op_animation" value="on">

  <div id="calculator" class="overlay">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper calculator">
      <h1>Rank Calculator</h1>
      <div class="calc_carousel">
        <label><input type="radio" name="attr_calcRank" value="-5"><input type="hidden" name="attr_shadowRank"><span>-5</span></label>
        <label><input type="radio" name="attr_calcRank" value="-4"><input type="hidden" name="attr_shadowRank"><span>-4</span></label>
        <label><input type="radio" name="attr_calcRank" value="-3"><input type="hidden" name="attr_shadowRank"><span>-3</span></label>
        <label><input type="radio" name="attr_calcRank" value="-2"><input type="hidden" name="attr_shadowRank"><span>-2</span></label>
        <label><input type="radio" name="attr_calcRank" value="-1"><input type="hidden" name="attr_shadowRank"><span>-1</span></label>
        <label><input type="radio" name="attr_calcRank" value="0" checked/><input type="hidden" name="attr_shadowRank"><span>0</span></label>
        <label><input type="radio" name="attr_calcRank" value="1"/><input type="hidden" name="attr_shadowRank"><span>1</span></label>
        <label><input type="radio" name="attr_calcRank" value="2"/><input type="hidden" name="attr_shadowRank"><span>2</span></label>
        <label><input type="radio" name="attr_calcRank" value="3"/><input type="hidden" name="attr_shadowRank"><span>3</span></label>
        <label><input type="radio" name="attr_calcRank" value="4"/><input type="hidden" name="attr_shadowRank"><span>4</span></label>
        <label><input type="radio" name="attr_calcRank" value="5"/><input type="hidden" name="attr_shadowRank"><span>5</span></label>
        <label><input type="radio" name="attr_calcRank" value="6"/><input type="hidden" name="attr_shadowRank"><span>6</span></label>
        <label><input type="radio" name="attr_calcRank" value="7"/><input type="hidden" name="attr_shadowRank"><span>7</span></label>
        <label><input type="radio" name="attr_calcRank" value="8"/><input type="hidden" name="attr_shadowRank"><span>8</span></label>
        <label><input type="radio" name="attr_calcRank" value="9"/><input type="hidden" name="attr_shadowRank"><span>9</span></label>
        <label><input type="radio" name="attr_calcRank" value="10"/><input type="hidden" name="attr_shadowRank"><span>10</span></label>
        <label><input type="radio" name="attr_calcRank" value="11"/><input type="hidden" name="attr_shadowRank"><span>11</span></label>
        <label><input type="radio" name="attr_calcRank" value="12"/><input type="hidden" name="attr_shadowRank"><span>12</span></label>
        <label><input type="radio" name="attr_calcRank" value="13"/><input type="hidden" name="attr_shadowRank"><span>13</span></label>
        <label><input type="radio" name="attr_calcRank" value="14"/><input type="hidden" name="attr_shadowRank"><span>14</span></label>
        <label><input type="radio" name="attr_calcRank" value="15"/><input type="hidden" name="attr_shadowRank"><span>15</span></label>
        <label><input type="radio" name="attr_calcRank" value="16"/><input type="hidden" name="attr_shadowRank"><span>16</span></label>
        <label><input type="radio" name="attr_calcRank" value="17"/><input type="hidden" name="attr_shadowRank"><span>17</span></label>
        <label><input type="radio" name="attr_calcRank" value="18"/><input type="hidden" name="attr_shadowRank"><span>18</span></label>
        <label><input type="radio" name="attr_calcRank" value="19"/><input type="hidden" name="attr_shadowRank"><span>19</span></label>
        <label><input type="radio" name="attr_calcRank" value="20"/><input type="hidden" name="attr_shadowRank"><span>20</span></label>
        <label><input type="radio" name="attr_calcRank" value="21"/><input type="hidden" name="attr_shadowRank"><span>21</span></label>
        <label><input type="radio" name="attr_calcRank" value="22"/><input type="hidden" name="attr_shadowRank"><span>22</span></label>
        <label><input type="radio" name="attr_calcRank" value="23"/><input type="hidden" name="attr_shadowRank"><span>23</span></label>
        <label><input type="radio" name="attr_calcRank" value="24"/><input type="hidden" name="attr_shadowRank"><span>24</span></label>
        <label><input type="radio" name="attr_calcRank" value="25"/><input type="hidden" name="attr_shadowRank"><span>25</span></label>
        <label><input type="radio" name="attr_calcRank" value="26"/><input type="hidden" name="attr_shadowRank"><span>26</span></label>
        <label><input type="radio" name="attr_calcRank" value="27"/><input type="hidden" name="attr_shadowRank"><span>27</span></label>
        <label><input type="radio" name="attr_calcRank" value="28"/><input type="hidden" name="attr_shadowRank"><span>28</span></label>
        <label><input type="radio" name="attr_calcRank" value="29"/><input type="hidden" name="attr_shadowRank"><span>29</span></label>
        <label><input type="radio" name="attr_calcRank" value="30"/><input type="hidden" name="attr_shadowRank"><span>30</span></label>
      </div>
      <div class="rankResults">
        <div>
          <h2>Mass</h2>
          <span name="attr_rank_mass"></span>
        </div>
        <div>
          <h2>Time</h2>
          <span name="attr_rank_time"></span>
        </div>
        <div>
          <h2>Distance</h2>
          <span name="attr_rank_distance"></span>
        </div>
        <div>
          <h2>Volume</h2>
          <span name="attr_rank_volume"></span>
        </div>
      </div>
    </div>
  </div>

  <div id="edit_complications" class="overlay">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit_complications">
      <h1 data-i18n="complications">Complications</h1>
      <fieldset class="repeating_complication">
          <input type="text" name="attr_complication-name" placeholder="Complication Name">
          <textarea name="attr_description" placeholder="Complication description"></textarea>
      </fieldset>
    </div>
  </div>

  <div id="edit_conditions" class="overlay">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit_conditions">
      <h1 data-i18n="conditions">Conditions</h1>
      <div class="con_damage">
        <label class="tooltip" data-i18n-tooltip="May only take a single standard action" ><span data-i18n="dazed">Dazed</span><input type="checkbox" name="attr_dazed"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Dazed and Hindered"><span data-i18n="staggered">Staggered</span><input type="checkbox" name="attr_staggered"><span></span>  </label>
        <label class="tooltip" data-i18n-tooltip="Defenseless, stunned, and unaware. Usually prone."><span data-i18n="incapacitated">incapacitated</span><input type="checkbox" name="attr_incapacitated"><span></span>  </label>
        <label class="tooltip" data-i18n-tooltip="Hindered, recover after 1 hour of rest."><span data-i18n="fatigued">Fatigued</span><input type="checkbox" name="attr_fatigued"><span></span>  </label>
        <label class="tooltip" data-i18n-tooltip="Impaired and hindered, recover after 1 hour of rest."><span data-i18n="exhausted">Exhausted</span><input type="checkbox" name="attr_exhausted"><span></span>  </label>
      </div>
      <div class="con_penalty">
        <label class="tooltip" data-i18n-tooltip="Single standard action determined by another."><span data-i18n="compelled">compelled</span><input type="checkbox" name="attr_compelled"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Another character determines actions."><span data-i18n="controlled">controlled</span><input type="checkbox" name="attr_controlled"><span></span> </label>
        <label class="tooltip penalty" class="tooltip" data-i18n-tooltip="One or more abilities at -5."><span data-i18n="debilitated">debilitated</span><input type="checkbox" name="attr_debilitated"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Active defenses equal 0, often prone. Supersedes Vulnerable."><span data-i18n="defenseless">defenseless</span><input type="checkbox" name="attr_defenseless"><span></span> </label>
        <label class="tooltip penalty" data-i18n-tooltip="-5 penalty on checks. Supersedes impaired."><span data-i18n="disabled">disabled</span><input type="checkbox" name="attr_disabled"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Move at -1 speed rank."><span data-i18n="hindered">hindered</span><input type="checkbox" name="attr_hindered"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Have no movement speed, cannot move, but can actions. Supersedes Hindered."><span data-i18n="immobile">immobile</span><input type="checkbox" name="attr_immobile"><span></span> </label>
        <label class="tooltip penalty" data-i18n-tooltip="-2 penalty on checks."><span data-i18n="impaired">impaired</span><input type="checkbox" name="attr_impaired"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Cannot take actions."><span data-i18n="stunned">stunned</span><input type="checkbox" name="attr_stunned"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Traits altered by an outside agent. Depends on effect."><span data-i18n="transformed">transformed</span><input type="checkbox" name="attr_transformed"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Unable to make interactions or Perception checks or perform actiosn based on them."><span data-i18n="unaware">unaware</span><input type="checkbox" name="attr_unaware"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Active defenses are halved (round up)."><span data-i18n="vulnerable">vulnerable</span><input type="checkbox" name="attr_vulnerable"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Temporarily lose power points in a trait. Depends on effect."><span data-i18n="weakened">weakened</span><input type="checkbox" name="attr_weakened"><span></span> </label>
      </div>
      <div class="con_combined">
        <label class="tooltip" data-i18n-tooltip="Defenseless, stunned, and unaware."><span data-i18n="asleep">asleep</span><input type="checkbox" name="attr_asleep"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Hindered, visually unaware, vulnerable, may be impaired or disabled for visual tasks."><span data-i18n="blind">blind</span><input type="checkbox" name="attr_blind"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Defenseless, immobile, and impaired."><span data-i18n="bound">bound</span><input type="checkbox" name="attr_bound"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Auditory unaware."><span data-i18n="deaf">deaf</span><input type="checkbox" name="attr_deaf"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Stunned, but may only pay to entrancement effect. Breaks free if threatened or from allies interaction skill check (DC 10+effect rank)."><span data-i18n="entranced">entranced</span><input type="checkbox" name="attr_entranced"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Defenseless, immobile, and physically stunned; may be able to take mental actions."><span data-i18n="paralyzed">paralyzed</span><input type="checkbox" name="attr_paralyzed"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Hindered, -5 penalty on close attack checks, +5 bonus to attacker's close attack checks, but -5 penalty to attacker's ranged attack checks. Move action to stand."><span data-i18n="prone">prone</span><input type="checkbox" name="attr_prone"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Hindered and vulnerable, immobile if restraints are anchored."><span data-i18n="restrained">restrained</span><input type="checkbox" name="attr_restrained"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Dazed and hindered."><span data-i18n="staggered">staggered</span><input type="checkbox" name="attr_staggered"><span></span> </label>
        <label class="tooltip" data-i18n-tooltip="Stunned and vulnerable."><span data-i18n="surprised">surprised</span><input type="checkbox" name="attr_surprised"><span></span> </label>
      </div>
    </div>
  </div>

  <div class="overlay" id="edit_powers">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit-powers">
      <fieldset class="repeating_powers">
        <input class="controller" type="hidden" name="attr_element_type" value="menu">
        <div class="element-menu">
          <input type="checkbox"  name="attr_element_type" value="power"><label><input type="radio" name="attr_element_type" value="power"><span data-i18n="header">Header</span></label>
          <input type="checkbox"  name="attr_element_type" value="gen_power"><label><input type="radio" name="attr_element_type" value="gen_power"><span data-i18n="title">Title</span></label>
          <input type="checkbox"  name="attr_element_type" value="general_fx"><label><input type="radio" name="attr_element_type" value="general_fx"><span data-i18n="effect">Effect</span></label>
          <input type="checkbox"  name="attr_element_type" value="attack_fx"><label><input type="radio" name="attr_element_type" value="attack_fx"><span data-i18n="attack">Attack</span></label>
          <input type="checkbox"  name="attr_element_type" value="text"><label><input type="radio" name="attr_element_type" value="text"><span data-i18n="notes">Notes</span></label>
        </div>
        <div class="element-power">
          <span data-i18n="header">Header</span>
          <label><span data-i18n="header_label">Header Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_cost">Power Cost</span> <input type="number" name="attr_cost"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-gen_power">
          <span data-i18n="general">General</span>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-alt_power">
          <span data-i18n="alternative">Alternative</span>
          <label><span data-i18n="title_label">Title Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternative" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-dyn_power">
          <span data-i18n="dynamic">Dynamic</span>
          <label>Title Label <input type="text" name="attr_label"></label>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label data-i18n="power_points">Power Points<input type="number" name="attr_dynPool"></label>
          <label data-i18n="collapsing_description">Collapsing Description <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-general_fx">
          <span data-i18n="power_effect">Power Effect</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-attack_fx">
          <span data-i18n="attack">Attack</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="power_type">Power Type </span>
            <select name="attr_attack_type">
              <option value="general" data-i18n="general">General</option>
              <option value="dynamic" data-i18n="dynamic">Dynamic</option>
              <option value="alternative" data-i18n="alternative">Alternative</option>
            </select>
          </label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor" placeholder="Ex. Fire, Psychic, Magical"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="aoe">AoE</span> <input type="checkbox" name="attr_aoe" value="AOE"><span></span></label>
          <label><span data-i18n="critical">Critical</span> <input type="number" name="attr_crit" value="20"></label>
          <label><span data-i18n="defense_type">Defense Type</span> <input type="text" list="defense-types" name="attr_defense"></label>
          <details class="edit_afflictions">
            <summary><span data-i18n="afflictions">Afflictions</span></summary>
            <label><span data-i18n="resistance_type">Resistance Type</span> <input type="text" list="defense-types" name="attr_afflictions_type"></label>
            <label><span data-i18n="first_degree">First Degree</span> <input type="text" name="attr_afflictions_1"></label>
            <label><span data-i18n="second_degree">Second Degree</span> <input type="text" name="attr_afflictions_2"></label>
            <label><span data-i18n="third_degree">Third Degree</span> <input type="text" name="attr_afflictions_3"></label>
          </details>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-movement_fx">
          <span data-i18n="movement">Movement</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-sensory_fx">
          <span data-i18n="sensory">Sensory</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-text">
          <span data-i18n="text">Text</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label" placeholder="Power Name"></label>
          <label>
            <span data-i18n="description">Description</span>
            <textarea name="attr_description"></textarea>
          </label>
        </div>
      </fieldset>
    </div>
    <input type="hidden" name="attr_tut_powers" value="0">
    <label class="tutorial __powers __step0">
      <span data-i18n="power_tutorial_1_3">Power Tutorial [1/3]</span>
      <span data-i18n="power_tutorial_1_3a">Click on these messages to move on and clear them!</span>
      <span data-i18n="power_tutorial_1_3b">Powers are put together by different elements! Think of them as bricks you put together to build your powers. </span>
      <span data-i18n="power_tutorial_1_3c">Your Power effects and Power attacks contain your most important information.</span>
      <span data-i18n="power_tutorial_1_3d">But complex powers might be helped by using Headers and Titles to organize them.</span>
      <input type="checkbox" name="attr_tut_powers" value="1">
    </label>
    <input type="hidden" name="attr_tut_powers">
    <label class="tutorial __powers __step1">
      <span data-i18n="power_tutorial_2_3">Power Tutorial [2/3]</span>
      <span data-i18n="power_tutorial_2_3a">Here is an example of some powers using Headers, Titles, and Notes to help organize power effects. </span>
      <span><img src="https://i.imgur.com/tNiaFOG.png"/></span>
      <input type="checkbox" name="attr_tut_powers" value="2">
    </label>
    <input type="hidden" name="attr_tut_powers">
    <label class="tutorial __powers __step2">
      <span data-i18n="power_tutorial_3_3">Power Tutorial [3/3]</span>
      <span data-i18n="power_tutorial_3_3a">Hover over to the left and click the "Add" button to add a new Power element. The right side will give you a preview of how it will be displayed on the character sheet!</span>
      <span data-i18n="power_tutorial_3_3b">Tip: Its easier to modify the ordering of the elements on the right side.</span>
      <span data-i18n="power_tutorial_3_3c">Tip #2: Most elements have collapsible descriptions for extra information or descriptions that you don't need visible all the time. Clicking on them in the Display Window opens or closes it. </span>
      <span data-i18n="power_tutorial_3_3d">One bit of oddness is that reorganizing elements won't update the other list until you add a new element (which you can remove afterwards).</span>
      <input type="checkbox" name="attr_tut_powers" value="3">
    </label>

  </div>
  <div class="overlay" id="edit_equipment">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit-powers">
      <fieldset class="repeating_equipment">
        <input class="controller" type="hidden" name="attr_element_type" value="menu">
        <div class="element-menu">
          <input type="checkbox"  name="attr_element_type" value="power"><label><input type="radio" name="attr_element_type" value="power"><span data-i18n="header">Header</span></label>
          <input type="checkbox"  name="attr_element_type" value="gen_power"><label><input type="radio" name="attr_element_type" value="gen_power"><span data-i18n="title">Title</span></label>
          <input type="checkbox"  name="attr_element_type" value="general_fx"><label><input type="radio" name="attr_element_type" value="general_fx"><span data-i18n="effect">Effect</span></label>
          <input type="checkbox"  name="attr_element_type" value="attack_fx"><label><input type="radio" name="attr_element_type" value="attack_fx"><span data-i18n="attack">Attack</span></label>
          <input type="checkbox"  name="attr_element_type" value="text"><label><input type="radio" name="attr_element_type" value="text"><span data-i18n="notes">Notes</span></label>
        </div>
        <div class="element-power">
          <span data-i18n="header">Header</span>
          <label><span data-i18n="header_label">Header Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_cost">Power Cost</span> <input type="number" name="attr_cost"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-gen_power">
          <span data-i18n="general">General</span>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-alt_power">
          <span data-i18n="alternative">Alternative</span>
          <label><span data-i18n="title_label">Title Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternative" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-dyn_power">
          <span data-i18n="dynamic">Dynamic</span>
          <label>Title Label <input type="text" name="attr_label"></label>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label data-i18n="power_points">Power Points<input type="number" name="attr_dynPool"></label>
          <label data-i18n="collapsing_description">Collapsing Description <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-general_fx">
          <span data-i18n="power_effect">Power Effect</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-attack_fx">
          <span data-i18n="attack">Attack</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="power_type">Power Type </span>
            <select name="attr_attack_type">
              <option value="general" data-i18n="general">General</option>
              <option value="dynamic" data-i18n="dynamic">Dynamic</option>
              <option value="alternative" data-i18n="alternative">Alternative</option>
            </select>
          </label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor" placeholder="Ex. Fire, Psychic, Magical"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="aoe">AoE</span> <input type="checkbox" name="attr_aoe" value="AOE"><span></span></label>
          <label><span data-i18n="critical">Critical</span> <input type="number" name="attr_crit" value="20"></label>
          <label><span data-i18n="defense_type">Defense Type</span> <input type="text" list="defense-types" name="attr_defense"></label>
          <details class="edit_afflictions">
            <summary><span data-i18n="afflictions">Afflictions</span></summary>
            <label><span data-i18n="resistance_type">Resistance Type</span> <input type="text" list="defense-types" name="attr_afflictions_type"></label>
            <label><span data-i18n="first_degree">First Degree</span> <input type="text" name="attr_afflictions_1"></label>
            <label><span data-i18n="second_degree">Second Degree</span> <input type="text" name="attr_afflictions_2"></label>
            <label><span data-i18n="third_degree">Third Degree</span> <input type="text" name="attr_afflictions_3"></label>
          </details>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-movement_fx">
          <span data-i18n="movement">Movement</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-sensory_fx">
          <span data-i18n="sensory">Sensory</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-text">
          <span data-i18n="text">Text</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label" placeholder="Power Name"></label>
          <label>
            <span data-i18n="description">Description</span>
            <textarea name="attr_description"></textarea>
          </label>
        </div>
      </fieldset>
    </div>
  </div>
  <div class="overlay" id="edit_vehicles">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit-powers">
      <fieldset class="repeating_vehicles">
        <input class="controller" type="hidden" name="attr_element_type" value="menu">
        <div class="element-menu">
          <input type="checkbox"  name="attr_element_type" value="vehicle"><label><input type="radio" name="attr_element_type" value="vehicle"><span data-i18n="vehicle">Vehicle</span></label>
          <input type="checkbox"  name="attr_element_type" value="power"><label><input type="radio" name="attr_element_type" value="power"><span data-i18n="header">Header</span></label>
          <input type="checkbox"  name="attr_element_type" value="gen_power"><label><input type="radio" name="attr_element_type" value="gen_power"><span data-i18n="title">Title</span></label>
          <input type="checkbox"  name="attr_element_type" value="general_fx"><label><input type="radio" name="attr_element_type" value="general_fx"><span data-i18n="effect">Effect</span></label>
          <input type="checkbox"  name="attr_element_type" value="attack_fx"><label><input type="radio" name="attr_element_type" value="attack_fx"><span data-i18n="attack">Attack</span></label>
          <input type="checkbox"  name="attr_element_type" value="text"><label><input type="radio" name="attr_element_type" value="text"><span data-i18n="notes">Notes</span></label>
        </div>
        <div class="element-vehicle">
          <span data-i18n="vehicle">Vehicle</span>
          <label><span data-i18n="vehicle_label">Vehicle Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="size">Size</span>
            <select name="attr_size">
              <option value="awesome" data-i18n="awesome">Awesome</option>
              <option value="colossal" data-i18n="colossal">Colossal</option>
              <option value="gargantuan" data-i18n="gargantuan">Gargantuan</option>
              <option value="huge" data-i18n="huge">Huge</option>
              <option value="large" data-i18n="large">Large</option>
              <option value="medium" selected="selected" data-i18n="medium">Medium</option>
            </select>
          </label>
          <label><span data-i18n="strength">Strength</span><input type="number" name="attr_strength"></label>
          <label><span data-i18n="toughness">Toughness</span><input type="number" name="attr_toughness"></label>
          <label><span data-i18n="defense">Defense</span><input type="number" name="attr_defense"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-power">
          <span data-i18n="header">Header</span>
          <label><span data-i18n="header_label">Header Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_cost">Power Cost</span> <input type="number" name="attr_cost"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-gen_power">
          <span data-i18n="general">General</span>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-alt_power">
          <span data-i18n="alternative">Alternative</span>
          <label><span data-i18n="title_label">Title Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternative" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-dyn_power">
          <span data-i18n="dynamic">Dynamic</span>
          <label>Title Label <input type="text" name="attr_label"></label>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label data-i18n="power_points">Power Points<input type="number" name="attr_dynPool"></label>
          <label data-i18n="collapsing_description">Collapsing Description <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-general_fx">
          <span data-i18n="power_effect">Power Effect</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-attack_fx">
          <span data-i18n="attack">Attack</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="power_type">Power Type </span>
            <select name="attr_attack_type">
              <option value="general" data-i18n="general">General</option>
              <option value="dynamic" data-i18n="dynamic">Dynamic</option>
              <option value="alternative" data-i18n="alternative">Alternative</option>
            </select>
          </label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor" placeholder="Ex. Fire, Psychic, Magical"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="aoe">AoE</span> <input type="checkbox" name="attr_aoe" value="AOE"><span></span></label>
          <label><span data-i18n="critical">Critical</span> <input type="number" name="attr_crit" value="20"></label>
          <label><span data-i18n="defense_type">Defense Type</span> <input type="text" list="defense-types" name="attr_defense"></label>
          <details class="edit_afflictions">
            <summary><span data-i18n="afflictions">Afflictions</span></summary>
            <label><span data-i18n="resistance_type">Resistance Type</span> <input type="text" list="defense-types" name="attr_afflictions_type"></label>
            <label><span data-i18n="first_degree">First Degree</span> <input type="text" name="attr_afflictions_1"></label>
            <label><span data-i18n="second_degree">Second Degree</span> <input type="text" name="attr_afflictions_2"></label>
            <label><span data-i18n="third_degree">Third Degree</span> <input type="text" name="attr_afflictions_3"></label>
          </details>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-movement_fx">
          <span data-i18n="movement">Movement</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-sensory_fx">
          <span data-i18n="sensory">Sensory</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-text">
          <span data-i18n="text">Text</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label" placeholder="Power Name"></label>
          <label>
            <span data-i18n="description">Description</span>
            <textarea name="attr_description"></textarea>
          </label>
        </div>
      </fieldset>
    </div>
  </div>
  <div class="overlay" id="edit_headquarters">
    <a class="btn_exit" href="#">&times;</a>
    <div class="wrapper edit-powers">
      <fieldset class="repeating_headquarters">
        <input class="controller" type="hidden" name="attr_element_type" value="menu">
        <div class="element-menu">
          <input type="checkbox"  name="attr_element_type" value="vehicle"><label><input type="radio" name="attr_element_type" value="vehicle"><span data-i18n="headquarters">Headquarters</span></label>
          <input type="checkbox"  name="attr_element_type" value="power"><label><input type="radio" name="attr_element_type" value="power"><span data-i18n="header">Header</span></label>
          <input type="checkbox"  name="attr_element_type" value="gen_power"><label><input type="radio" name="attr_element_type" value="gen_power"><span data-i18n="title">Title</span></label>
          <input type="checkbox"  name="attr_element_type" value="general_fx"><label><input type="radio" name="attr_element_type" value="general_fx"><span data-i18n="effect">Effect</span></label>
          <input type="checkbox"  name="attr_element_type" value="attack_fx"><label><input type="radio" name="attr_element_type" value="attack_fx"><span data-i18n="attack">Attack</span></label>
          <input type="checkbox"  name="attr_element_type" value="text"><label><input type="radio" name="attr_element_type" value="text"><span data-i18n="notes">Notes</span></label>
        </div>
        <div class="element-vehicle">
          <span data-i18n="headquarters">Headquarters</span>
          <label><span data-i18n="headquarter_label">Headquarter Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="size">Size</span>
            <select name="attr_size">
              <option value="awesome" data-i18n="awesome">Awesome</option>
              <option value="colossal" data-i18n="colossal">Colossal</option>
              <option value="gargantuan" data-i18n="gargantuan">Gargantuan</option>
              <option value="huge" data-i18n="huge">Huge</option>
              <option value="large" data-i18n="large">Large</option>
              <option value="medium" selected="selected" data-i18n="medium">Medium</option>
              <option value="small" data-i18n="small">small</option>
              <option value="tiny" data-i18n="tiny">tiny</option>
              <option value="diminuitive" data-i18n="diminuitive">diminuitive</option>
              <option value="fine" data-i18n="fine">fine</option>
              <option value="miniscule" data-i18n="miniscule">miniscule</option>
            </select>
          </label>
          <label><span data-i18n="strength">Strength</span><input type="number" name="attr_strength"></label>
          <label><span data-i18n="toughness">Toughness</span><input type="number" name="attr_toughness"></label>
          <label><span data-i18n="defense">Defense</span><input type="number" name="attr_defense"></label>
        </div>
        <div class="element-power">
          <span data-i18n="header">Header</span>
          <label><span data-i18n="header_label">Header Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_cost">Power Cost</span> <input type="number" name="attr_cost"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-gen_power">
          <span data-i18n="general">General</span>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-alt_power">
          <span data-i18n="alternative">Alternative</span>
          <label><span data-i18n="title_label">Title Label</span><input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternative" value="alt_power">Alternate</option>
            </select>
          </label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span><textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-dyn_power">
          <span data-i18n="dynamic">Dynamic</span>
          <label>Title Label <input type="text" name="attr_label"></label>
          <label><span data-i18n="title_label">Title Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor"  placeholder="Descriptor"></label>
          <label><span data-i18n="power_type">Power Type</span>
            <select name="attr_element_type">
              <option data-i18n="general" value="gen_power">General</option>
              <option data-i18n="dynamic" value="dyn_power">Dynamic</option>
              <option data-i18n="alternate" value="alt_power">Alternate</option>
            </select>
          </label>
          <label data-i18n="power_points">Power Points<input type="number" name="attr_dynPool"></label>
          <label data-i18n="collapsing_description">Collapsing Description <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-general_fx">
          <span data-i18n="power_effect">Power Effect</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>
        </div>
        <div class="element-attack_fx">
          <span data-i18n="attack">Attack</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label"></label>
          <label>
            <span data-i18n="power_type">Power Type </span>
            <select name="attr_attack_type">
              <option value="general" data-i18n="general">General</option>
              <option value="dynamic" data-i18n="dynamic">Dynamic</option>
              <option value="alternative" data-i18n="alternative">Alternative</option>
            </select>
          </label>
          <label><span data-i18n="rank">Rank</span> <input type="number" name="attr_rank"></label>
          <label><span data-i18n="bonus_rank">Bonus Rank</span> <input type="number" name="attr_rankBonus"></label>
          <label><span data-i18n="cost_per_rank">Cost Per Rank</span> <input type="number" name="attr_rankCost"></label>
          <label><span data-i18n="descriptor">Descriptor</span> <input type="text" name="attr_descriptor" placeholder="Ex. Fire, Psychic, Magical"></label>
          <label><span data-i18n="action">Action</span> <input type="text" name="attr_action" placeholder="Standard"></label>
          <label><span data-i18n="range">Range</span> <input type="text" name="attr_range" placeholder="Personal"></label>
          <label><span data-i18n="duration">Duration</span> <input type="text" name="attr_duration" placeholder="Sustained"></label>
          <label><span data-i18n="aoe">AoE</span> <input type="checkbox" name="attr_aoe" value="AOE"><span></span></label>
          <label><span data-i18n="critical">Critical</span> <input type="number" name="attr_crit" value="20"></label>
          <label><span data-i18n="defense_type">Defense Type</span> <input type="text" list="defense-types" name="attr_defense"></label>
          <details class="edit_afflictions">
            <summary><span data-i18n="afflictions">Afflictions</span></summary>
            <label><span data-i18n="resistance_type">Resistance Type</span> <input type="text" list="defense-types" name="attr_afflictions_type"></label>
            <label><span data-i18n="first_degree">First Degree</span> <input type="text" name="attr_afflictions_1"></label>
            <label><span data-i18n="second_degree">Second Degree</span> <input type="text" name="attr_afflictions_2"></label>
            <label><span data-i18n="third_degree">Third Degree</span> <input type="text" name="attr_afflictions_3"></label>
          </details>
          <label><span data-i18n="collapsing_description">Collapsing Description</span> <textarea name="attr_description"></textarea></label>

        </div>
        <div class="element-movement_fx">
          <span data-i18n="movement">Movement</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-sensory_fx">
          <span data-i18n="sensory">Sensory</span>
          <input type="text" name="attr_label" placeholder="Power Name">
          <input type="text" name="attr_descriptor" placeholder="Descriptor">
        </div>
        <div class="element-text">
          <span data-i18n="text">Text</span>
          <label><span data-i18n="label">Label</span> <input type="text" name="attr_label" placeholder="Power Name"></label>
          <label>
            <span data-i18n="description">Description</span>
            <textarea name="attr_description"></textarea>
          </label>
        </div>
      </fieldset>
    </div>
  </div>

    <div class="card header"></div>
    <div class="container-section section-details">
        <input class="identity-name" type="text" name="attr_identity_name" placeholder="Real Identity">
        <input class="alias-name" type="text" name="attr_character_name" placeholder="Alias">
        <!-- <div class="section-biography">
          <input class="hero-concept" type="text" name="attr_hero-concept" placeholder="Hero Concept">
          <input class="hero-origin" type="text" name="attr_hero-origin" placeholder="Origin">
          <input type="text" name="attr_hero-appearance" placeholder="Appearance">
        </div> -->
        <div class="powerLevel">
          <input type="number" name="attr_powerlevel" title="Power Level" value="10">
          <span>¢</span>
        </div>
        <div class="heropoints">
          <span data-i18n="hero">Hero</span>
          <input type="number" name="attr_heropoints" title="Hero Points" min="0">
          <span data-i18n="points">Points</span>
        </div>
        <label class="section-powerPoints">
            <span data-i18n="ability">Ability</span> <span name="attr_powerPoints_ability"></span> +
            <span data-i18n="defense">Defense</span> <span name="attr_powerPoints_defense"></span> +
            <span data-i18n="skill">Skill</span> <span name="attr_powerPoints_skill"></span> + 
            <span data-i18n="advantage">Advantage</span> <span name="attr_powerPoints_advantage"></span> +
            <span data-i18n="powers">Powers</span> <span name="attr_powerPoints_power"></span> + 
            <span data-i18n="equipment">Equipment</span> <span name="attr_powerPoints_equipment"></span> +
            <span data-i18n="misc">Miscellaneous</span> <input type="number" value="0" style="font-family: var(--font-comic) !important; padding: 0;" name="attr_powerPoints_miscellaneous"> =
            <span name="attr_powerPoints_total"></span>
        </label>
    </div>

    <div class="container-section panel-borders section-complications edit-icon">
        <div class="content">
            <a href="#edit_complications">
              <h1 data-i18n="complications">Complications</h1>
            </a>
            <fieldset class="repeating_complication">
              <input type="hidden" name="attr_description">
              <button name="roll_complication" type="roll" value="&{template:roll} {{name=@{character_name}}} {{trait=@{complication-name}}} {{extras=@{description}}}">
                <div class="autoExpand">
                    <input readonly type="text" name="attr_complication-name">
                    <span name="attr_complication-name"></span>
                  <!-- <label class="btn_show">w<input type="checkbox" name="attr_show"></label> -->
                </div>
              </button>
            </fieldset>
        </div>
        <!-- <div class="complication_window">
          <fieldset class="repeating_complication">
            <div class="autoExpand">
              <textarea readonly class=" autoExpand" name="attr_description" placeholder="Its complicated"></textarea>
              <span name="attr_description"></span>
            </div>
          </fieldset>
        </div> -->
    </div>
  <div class="lowerHeader">
    <div class="container-section edit-icon section-conditions">
      <div class="content">
        <a href="#edit_conditions">
          <h1><span data-i18n="conditions">Conditions</span>
            <div class="general_penalty" title="Condition Penalty applied to all rolls" data-i18n-title="condition_penalty">
              <input type="hidden" name="attr_penalty_general" value="0">
              <span name="attr_penalty_general">Some more stuff</span>
            </div>
          </h1>
        </a>
        <input type="checkbox" hidden name="attr_compelled"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Single standard action determined by another.">
          <span data-i18n="compelled">compelled</span>
          <input type="checkbox" name="attr_compelled" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_controlled"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Another character determines actions."><span data-i18n="controlled">controlled</span>
          <input type="checkbox" name="attr_controlled" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_dazed"/>
        <label class="display_condition delete-icon damage tooltip" data-i18n-tooltip="May only take a single standard action"><span data-i18n="dazed">dazed</span>
          <input type="checkbox" name="attr_dazed" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_debilitated"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="One or more abilities at -5."><span data-i18n="debilitated">debilitated</span>
          <input type="checkbox" name="attr_debilitated" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_defenseless"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Active defenses equal 0, often prone. Supersedes Vulnerable."><span data-i18n="defenseless">defenseless</span>
          <input type="checkbox" name="attr_defenseless" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_disabled"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="-5 penalty on checks. Supersedes impaired."><span data-i18n="disabled">disabled</span>
          <input type="checkbox" name="attr_disabled" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_fatigued"/>
        <label class="display_condition delete-icon damage" data-i18n-tooltip="Hindered, recover after 1 hour of rest."><span data-i18n="fatigued">fatigued</span>
          <input type="checkbox" name="attr_fatigued" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_hindered"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Move at -1 speed rank."><span data-i18n="hindered">hindered</span>
          <input type="checkbox" name="attr_hindered" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_immobile"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Have no movement speed, cannot move, but can actions. Supersedes Hindered."><span data-i18n="immobile">immobile</span>
          <input type="checkbox" name="attr_immobile" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_impaired"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="-2 penalty on checks."><span data-i18n="impaired">impaired</span>
          <input type="checkbox" name="attr_impaired" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_stunned"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Cannot take actions."><span data-i18n="stunned">stunned</span>
          <input type="checkbox" name="attr_stunned" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_transformed"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Traits altered by an outside agent. Depends on effect."><span data-i18n="transformed">transformed</span>
          <input type="checkbox" name="attr_transformed" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_unaware"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Unable to make interactions or Perception checks or perform actiosn based on them."><span data-i18n="unaware">unaware</span>
          <input type="checkbox" name="attr_unaware" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_vulnerable"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Active defenses are halved (round up)."><span data-i18n="vulnerable">vulnerable</span>
          <input type="checkbox" name="attr_vulnerable" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_weakened"/>
        <label class="display_condition delete-icon penalty" data-i18n-tooltip="Temporarily lose power points in a trait. Depends on effect."><span data-i18n="weakened">weakened</span>
          <input type="checkbox" name="attr_weakened" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_asleep"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Defenseless, stunned, and unaware."><span data-i18n="asleep">asleep</span>
          <input type="checkbox" name="attr_asleep" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_blind"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Hindered, visually unaware, vulnerable, may be impaired or disabled for visual tasks."><span data-i18n="blind">blind</span>
          <input type="checkbox" name="attr_blind" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_bound"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Defenseless, immobile, and impaired."><span data-i18n="bound"><span data-i18n="bound">bound</span>
          <input type="checkbox" name="attr_bound" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_deaf"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Auditory unaware."><span data-i18n="deaf">deaf</span>
          <input type="checkbox" name="attr_deaf" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_dying"/>
        <label class="display_condition delete-icon combined"><span data-i18n="dying">dying</span>
          <input type="checkbox" name="attr_dying" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_entranced"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Stunned, but may only pay to entrancement effect. Breaks free if threatened or from allies interaction skill check (DC 10+effect rank)."><span data-i18n="entranced">entranced</span>
          <input type="checkbox" name="attr_entranced" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_exhausted"/>
        <label class="display_condition delete-icon damage" data-i18n-tooltip="Impaired and hindered, recover after 1 hour of rest."><span data-i18n="exhausted">exhausted</span>
          <input type="checkbox" name="attr_exhausted" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_incapacitated"/>
        <label class="display_condition delete-icon damage" data-i18n-tooltip="Defenseless, stunned, and unaware. Usually prone."><span data-i18n="incapacitated">incapacitated</span>
          <input type="checkbox" name="attr_incapacitated" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_paralyzed"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Defenseless, immobile, and physically stunned; may be able to take mental actions."><span data-i18n="paralyzed">paralyzed</span>
          <input type="checkbox" name="attr_paralyzed" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_prone"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Hindered, -5 penalty on close attack checks, +5 bonus to attacker's close attack checks, but -5 penalty to attacker's ranged attack checks. Move action to stand."><span data-i18n="prone">prone</span>
          <input type="checkbox" name="attr_prone" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_restrained"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Hindered and vulnerable, immobile if restraints are anchored."><span data-i18n="restrained">restrained</span>
          <input type="checkbox" name="attr_restrained" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_staggered"/>
        <label class="display_condition delete-icon damage" data-i18n-tooltip="Dazed and Hindered"><span data-i18n="staggered">staggered</span>
          <input type="checkbox" name="attr_staggered" value="0"/>
        </label>
        <input type="checkbox" hidden name="attr_surprised"/>
        <label class="display_condition delete-icon combined" data-i18n-tooltip="Stunned and vulnerable."><span data-i18n="surprised">surprised</span>
          <input type="checkbox" name="attr_surprised" value="0"/>
        </label>
      </div>
    </div>
    <div class="container-section section-movement calculator-icon">
      <a href="#calculator">
        <h1><span data-i18n="movement">Movement</span></h1>
      </a>
      <fieldset class="repeating_movement">
        <div class="speedHeader">
          <select name="attr_speedType">
            <option value="ground" selected>Ground</option>
            <option value="flying">Flying</option>
            <option value="leaping">Leaping</option>
            <option value="burrowing">Burrowing</option>
            <option value="swimming">Swimming</option>
            <option value="teleportation">Teleportation</option>
          </select>
          <input name="attr_speedRank" type="number" value="0">
        </div>
        <div class="speedExample">
          <input type="hidden" name="attr_speedType">
          <span name="attr_speedHour"></span><span>/hour</span>
          <span name="attr_speedRound"></span><span>/round</span>
        </div>
      </fieldset>
    </div>
</div>
    <div class="container-section section-abilities">
        <div class="content">
            <div class="button_row">
              <button name="roll_strength" type="roll" class="btn_roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Strength}} {{result=[[1d20 + @{strength} + (@{penalty_general} [Conditions])]]}}" data-i18n="strength">strength</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_strength" value="0"></label>
              <label data-i18n-title="rank-strength" title="Strength Rank"><input type="number" name="attr_strength_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-strength" title="Strength Modifier"><input type="number" name="attr_strength_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-strength" title="Strength Miscellaneous"><input type="number" name="attr_strength_misc" value="0"></label>
            </div>
            <div class="button_row">
              <button name="roll_stamina" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Stamina}} {{result=[[1d20 + @{stamina} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="stamina">stamina</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_stamina" value="0"></label>
              <label data-i18n-title="rank-stamina" title="Stamina Rank"><input type="number" name="attr_stamina_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-stamina" title="Stamina Rank"><input type="number" name="attr_stamina_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-stamina" title="Stamina Miscellaneous"><input type="number" name="attr_stamina_misc" value="0"></label>

            </div>
            <div class="button_row">
              <button name="roll_agility" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=agility}} {{result=[[1d20 + @{agility} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="agility">agility</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_agility" value="0"></label>
              <label data-i18n-title="rank-agility" title="Agility Rank"><input type="number" name="attr_agility_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-agility" title="Agility Modifier"><input type="number" name="attr_agility_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-agility" title="Agility Miscellaneous"><input type="number" name="attr_agility_misc" value="0"></label>

            </div>
            <div class="label">
              <div class="ability_labels">
                <div></div>
                <div><span>Total</span></div>
                <div><span>Ranks</span></div>
                <div><span>Modifier</span></div>
                <div><span>Misc</span></div>
              </div>
              <div class="button_row">
                <button name="roll_dexterity" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=dexterity}} {{result=[[1d20 + @{dexterity} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="dexterity">dexterity</button>
                <label class="label_enhanced"><input type="number" readonly name="attr_dexterity" value="0"></label>
                <label data-i18n-title="rank-dexterity" title="Dexterity Rank"><input type="number" name="attr_dexterity_rank" value="0"></label>
                <label class="label_mod" data-i18n-title="mod-dexterity" title="Dexterity Modifier"><input type="number" name="attr_dexterity_mod" value="0"></label>
                <label class="label_misc" data-i18n-title="misc-dexterity" title="Dexterity Miscellaneous"><input type="number" name="attr_dexterity_misc" value="0"></label>
              </div>
            </div>
            
            <div class="button_row">
              <button name="roll_fighting" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=fighting}} {{result=[[1d20 + @{fighting} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="fighting">fighting</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_fighting" value="0"></label>
              <label data-i18n-title="rank-fighting" title="Fighting Rank"><input type="number" name="attr_fighting_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-fighting" title="Fighting Modifier"><input type="number" name="attr_fighting_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-fighting" title="Fighting Miscellaneous"><input type="number" name="attr_fighting_misc" value="0"></label>

            </div>
            <div class="button_row">
              <button name="roll_intellect" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=intellect}} {{result=[[1d20 + @{intellect} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="intellect">intellect</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_intellect" value="0"></label>
              <label data-i18n-title="rank-intellect" title="Intellect Rank"><input type="number" name="attr_intellect_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-intellect" title="Intellect Modifier"><input type="number" name="attr_intellect_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-intellect" title="Intellect Miscellaneous"><input type="number" name="attr_intellect_misc" value="0"></label>

            </div>
            <div class="button_row">
              <button name="roll_awareness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=awareness}} {{result=[[1d20 + @{awareness} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="awareness">awareness</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_awareness" value="0"></label>
              <label data-i18n-title="rank-awareness" title="Awareness Rank"><input type="number" name="attr_awareness_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-awareness" title="Awareness Modifier"><input type="number" name="attr_awareness_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-awareness" title="Awareness Miscellaneous"><input type="number" name="attr_awareness_misc" value="0"></label>

            </div>
            <div class="button_row">
              <button name="roll_presence" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=presence}} {{result=[[1d20 + @{presence} + (@{penalty_general} [Conditions])]]}}" class="btn_roll" data-i18n="presence">presence</button>
              <label class="label_enhanced"><input type="number" readonly name="attr_presence" value="0"></label>
              <label data-i18n-title="rank-presence" title="Presence Rank"><input type="number" name="attr_presence_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-presence" title="Presence Modifier"><input type="number" name="attr_presence_mod" value="0"></label>
              <label class="label_misc" data-i18n-title="misc-presence" title="Presence Miscellaneous"><input type="number" name="attr_presence_misc" value="0"></label>

            </div>
        </div>
    </div>

    <div class="container-section panel-borders section-skills">
      <div class="content">
        <h1>Skills</h1>
        <div class="skill_labels">
          <div><span>Total</span></div>
          <div></div>
          <div><span>Attribute</span></div>
          <div><span>Ranks</span></div>
          <div><span>Modifier</span></div>
        </div>
      <div class="skill-row trained-req">
        <button name="roll_acrobatics" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=acrobatics}} {{result=[[1d20 + @{acrobatics} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_acrobatics"></span></button>
        <h2 data-i18n="acrobatics">acrobatics</h2>
        <input class="label_mod" readonly type="number" name="attr_agility" title="agility" data-i18n-title="agility" value="0"/>
        <input type="number" name="attr_acrobatics_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_acrobatics_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_athletics" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=athletics}} {{result=[[1d20 + @{athletics} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_athletics"></span></button>
        <h2 data-i18n="athletics">athletics</h2>
        <input class="label_mod" readonly type="number" name="attr_strength" title="strength" data-i18n-title="strength"  value="0"/>
        <input type="number" name="attr_athletics_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_athletics_misc" value="0"/>
      </div>
      <div class="skill-group">
        <h2 data-i18n="closecombat">close combat</h2>
      
      <fieldset class="repeating_closecombat">
        <div class="skill-row">
          <button name="roll_closecombat" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{specialty}}} {{result=[[1d20 + @{specialty_total} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><input disabled name="attr_specialty_total" value="@{specialty_rank} + @{specialty_mod} + @{fighting}"></button>
          <h2><input type="text" name="attr_specialty"></h2>
          <input class="label_mod" disabled type="number" name="attr_fighting" title="fighting" data-i18n-title="fighting"  value="@{fighting}"/>
          <input type="number" name="attr_specialty_rank" value="0"/>
          <input class="label_mod" type="number" name="attr_specialty_mod" value="0"/>
        </div>
      </fieldset>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_deception" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=deception}} {{result=[[1d20 + @{deception} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_deception"></span></button>
        <h2 data-i18n="deception">deception</h2>
        <input class="label_mod" readonly type="number" name="attr_presence" title="presence" data-i18n-title="presence"  value="0"/>
        <input type="number" name="attr_deception_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_deception_misc" value="0"/>
      </div>
      <div class="skill-group">
        <h2 data-i18n="expertise">expertise</h2>
      
        <fieldset class="repeating_expertise skill-group">
          <div class="skill-row">
            <input type="hidden" name="attr_expertise">
            <button name="roll_expertise" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{expertise_name}}} {{result=[[1d20 + @{expertise} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_expertise"></span></button>
            <h2><input type="text" name="attr_expertise_name"></h2>
            <select name="attr_attribute">
              <option value="@{strength}">STR</option>
              <option value="@{stamina}">STA</option>
              <option value="@{agility}">AGI</option>
              <option value="@{dexterity}">DEX</option>
              <option value="@{fighting}">FGT</option>
              <option value="@{intellect}" selected>INT</option>
              <option value="@{awareness}">AWE</option>
              <option value="@{presence}">PRE</option>
            </select>
            <input type="number" name="attr_expertise_rank" value="0"/>
            <input class="label_mod" type="number" name="attr_expertise_misc" value="0"/>
          </div>
        </fieldset>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_insight" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=insight}} {{result=[[1d20 + @{insight} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_insight"></span></button>
        <h2 data-i18n="insight">insight</h2>
        <input class="label_mod" readonly type="number" name="attr_awareness" title="awareness" data-i18n-title="awareness"  value="0"/>
        <input type="number" name="attr_insight_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_insight_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_intimidation" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=intimidation}} {{result=[[1d20 + @{intimidation} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_intimidation"></span></button>
        <h2 data-i18n="intimidation">intimidation</h2>
        <input class="label_mod" readonly type="number" name="attr_presence" title="presence" data-i18n-title="presence"  value="0"/>
        <input type="number" name="attr_intimidation_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_intimidation_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_investigation" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=investigation}} {{result=[[1d20 + @{investigation} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_investigation"></span></button>
        <h2 data-i18n="investigation">investigation</h2>
        <input class="label_mod" readonly type="number" name="attr_intellect" title="intellect" data-i18n-title="intellect"  value="0"/>
        <input type="number" name="attr_investigation_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_investigation_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_perception" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=perception}} {{result=[[1d20 + @{perception} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_perception"></span></button>
        <h2 data-i18n="perception">perception</h2>
        <input class="label_mod" readonly type="number" name="attr_awareness" title="awareness" data-i18n-title="awareness"  value="0"/>
        <input type="number" name="attr_perception_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_perception_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_persuasion" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=persuasion}} {{result=[[1d20 + @{persuasion} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_persuasion"></span></button>
        <h2 data-i18n="persuasion">persuasion</h2>
        <input class="label_mod" readonly type="number" name="attr_presence" title="presence" data-i18n-title="presence"  value="0"/>
        <input type="number" name="attr_persuasion_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_persuasion_misc" value="0"/>
      </div>
      <div class="trained-req skill-group">
        <h2 data-i18n="rangedcombat">ranged combat</h2>
      
      <fieldset class="repeating_rangedcombat">
        <div class="skill-row">
          <button name="roll_closecombat" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{specialty}}} {{result=[[1d20 + @{specialty_total} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><input disabled name="attr_specialty_total" value="@{specialty_rank} + @{specialty_mod} + @{dexterity}"></button>
          <h2><input type="text" name="attr_specialty"></h2>
          <input class="label_mod" disabled type="number" name="attr_attribute" title="dexterity" data-i18n-title="dexterity"  value="@{dexterity}"/>
          <input type="number" name="attr_specialty_rank" value="0"/>
          <input class="label_mod" type="number" name="attr_specialty_mod" value="0"/>
        </div>
      </fieldset>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_sleight_of_hand" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=sleight of hand}} {{result=[[1d20 + @{sleightofhand} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_sleightofhand"></span></button>
        <h2 data-i18n="sleightofhand">sleight of hand</h2>
        <input class="label_mod" readonly type="number" name="attr_dexterity" title="dexterity" data-i18n-title="dexterity"  value="0"/>
        <input type="number" name="attr_sleightofhand_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_sleightofhand_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_stealth" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=stealth}} {{result=[[1d20 + @{stealth} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_stealth"></span></button>
        <h2 data-i18n="stealth">stealth</h2>
        <input class="label_mod" readonly type="number" name="attr_agility" title="agility" data-i18n-title="agility"  value="0"/>
        <input type="number" name="attr_stealth_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_stealth_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_technology" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=technology}} {{result=[[1d20 + @{technology} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_technology"></span></button>
        <h2 data-i18n="technology">technology</h2>
        <input class="label_mod" readonly type="number" name="attr_intellect" title="intellect" data-i18n-title="intellect"  value="0"/>
        <input type="number" name="attr_technology_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_technology_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_treatment" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=treatment}} {{result=[[1d20 + @{treatment} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_treatment"></span></button>
        <h2 data-i18n="treatment">treatment</h2>
        <input class="label_mod" readonly type="number" name="attr_intellect" title="intellect" data-i18n-title="intellect"  value="0"/>
        <input type="number" name="attr_treatment_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_treatment_misc" value="0"/>
      </div>
      <div class="skill-row trained-req">
        <button name="roll_vehicles" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=vehicles}} {{result=[[1d20 + @{vehicles} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span name="attr_vehicles"></span></button>
        <h2 data-i18n="vehicles">vehicles</h2>
        <input class="label_mod" readonly type="number" name="attr_dexterity" title="dexterity" data-i18n-title="dexterity"  value="0"/>
        <input type="number" name="attr_vehicles_rank" value="0"/>
        <input class="label_mod" type="number" name="attr_vehicles_misc" value="0"/>
      </div>
      </div>
      
    </div>

    <div class="hover-section upper">
      <div class="container-section section-defenses">
        <div class="content">
            <h1 data-i18n="defenses">Defenses</h1>
            <div class="defense_labels">
              <div></div>
              <div><span>Total</span></div>
              <div><span>Ranks</span></div>
              <div><span>Modifier</span></div>
              <div><span>Misc</span></div>
            </div>
            <div class="button_row"><button name="roll_dodge" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=dodge}} {{result=[[1d20 + @{dodge} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span data-i18n="dodge">Dodge</span><h3 data-i18n="agl_p">(AGL)</h3></button>
              <label class="label_enhanced"><input type="number" readonly name="attr_dodge" value="0"></label>
              <label data-i18n-title="rank-dodge" title="Dodge Rank"><input type="number" name="attr_dodge_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-dodge" title="Dodge Modifier"><input type="number" name="attr_dodge_mod" value="0"></label>
              <label class="label_mod" data-i18n-title="misc-dodge" title="Dodge Miscellaneous"><input type="number" name="attr_dodge_misc" value="0"></label></div>
            <div class="button_row"><button name="roll_parry" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=parry}} {{result=[[1d20 + @{parry} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span data-i18n="parry">Parry</span><h3 data-i18n="fgt_p">(FGT)</h3></button>
              <label class="label_enhanced"><input type="number" readonly name="attr_parry" value="0"></label>
              <label data-i18n-title="rank-parry" title="Parry Rank"><input type="number" name="attr_parry_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-parry" title="Parry Modifier"><input type="number" name="attr_parry_mod" value="0"></label>
              <label class="label_mod" data-i18n-title="misc-parry" title="Parry Miscellaneous"><input type="number" name="attr_parry_misc" value="0"></label></div>
            <div class="button_row"><button name="roll_fortitude" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=fortitude}} {{result=[[1d20 + @{fortitude} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span data-i18n="fortitude">Fortitude</span><h3 data-i18n="sta_p">(STA)</h3></button>
              <label class="label_enhanced"><input type="number" readonly name="attr_fortitude" value="0"></label>
              <label data-i18n-title="rank-fortitude" title="Fortitude Rank"><input type="number" name="attr_fortitude_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-fortitude" title="Fortitude Modifier"><input type="number" name="attr_fortitude_mod" value="0"></label>
              <label class="label_mod" data-i18n-title="misc-fortitude" title="Fortitude Miscellaneous"><input type="number" name="attr_fortitude_misc" value="0"></label></div>
            <div class="button_row"><button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=toughness}} {{result=[[1d20 + @{toughness} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span data-i18n="toughness">Toughness</span><h3 data-i18n="sta_p">(STA)</h3></button>
              <label class="label_enhanced"><input type="number" readonly name="attr_toughness" value="0"></label>
              <label data-i18n-title="rank-toughness" title="Toughness Rank"><input type="number" name="attr_toughness_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-toughness" title="Toughness Modifier"><input type="number" name="attr_toughness_mod" value="0"></label>
              <label class="label_mod" data-i18n-title="misc-toughness" title="Toughness Miscellaneous"><input type="number" name="attr_toughness_misc" value="0"></label></div>
            <div class="button_row"><button name="roll_will" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=will}} {{result=[[1d20 + @{will} + (@{penalty_general} [Conditions])]]}}" class="btn_roll"><span data-i18n="will">Will</span><h3 data-i18n="awe-p">(AWE)</h3></button>
              <label class="label_enhanced"><input type="number" readonly name="attr_will" value="0"></label>
              <label data-i18n-title="rank-will" title="Will Rank"><input type="number" name="attr_will_rank" value="0"></label>
              <label class="label_mod" data-i18n-title="mod-will" title="Will Modifier"><input type="number" name="attr_will_mod" value="0"></label>
              <label class="label_mod" data-i18n-title="misc-will" title="Will Miscellaneous"><input type="number" name="attr_will_misc" value="0"></label></div>
        </div>
        <div class="section-damage">
          <h2 data-i18n="hits">Hits</h2>
          <label class="label_enhanced hit-marker"><input type="number" name="attr_injuries" value="0"></label>
        </div>
    </div>

    <div class="container-section panel-borders section-offenses dice-icon">
      <div class="content">
        <input type="hidden" name="attr_initiative" value="0">
        <h1><span data-i18n="attacks">Attacks</span> <input class="bigNumber" type="number" name="attr_initiative" placeholder="init"><button type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=Initiative}} {{result=[[1d20 + @{initiative} + (@{penalty_general} [Conditions]) &{tracker}]]}}"><span data-i18n="initiative">Initiative</span></button></h1>
        <div class="attack-row">
          <label data-i18n="attack_name">Attack Name</label>
          <label data-i18n="combat_skill">Combat Skill</label>
          <label data-i18n="mod">Mod</label>
          <label data-i18n="attack">Attack</label>
          <label data-i18n="rank">Rank</label>
          <label data-i18n="descriptor">Descriptor</label>
          <label data-i18n="dc">DC</label>
          <label data-i18n="crit">Crit</label>
        </div>
        <fieldset class="repeating_attacks">
          <input type="hidden" name="attr_dc">
          <div class="attack-row">
            <details>
              <summary>
                <span class="edit-icon">p</span>

                <button name="roll_attack" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{descriptor=@{attack_damage_type}}} {{damage=[[@{dc}]]}} {{trait=@{attack_name}}} {{result=[[1d20cs>@{attack_crit} + @{attack} + (@{penalty_general} [Conditions])]]}}">
                  <span name="attr_attack_name">Attack Name</span>
                </button>
              </summary>
              <input type="text" name="attr_attack_name" value="Attack Name">
              <label class="chk_toggle">
                <input type="checkbox" name="attr_aoe" value="AOE">
                <span>AOE</span>
              </label>
            </details>
            <input type="text" name="attr_attack_combat" placeholder="Skill Name">
            <input class="label_mod" type="number" name="attr_attack_mod" value="0">
            <input type="number" name="attr_attack" readonly value="0">
            <input type="number" name="attr_rank_total" value="0">
            <input type="text" list="damage-types" name="attr_attack_damage_type" placeholder="damage type">
            <input class="in_DC" type="number" readonly name="attr_dc" value="+15">
            <input class="in_Crit" type="number" name="attr_attack_crit" value="20">
          </div>
          
        </fieldset>
        <div class="attack-powers">
          <div class="attack-row">
            <label data-i18n="attack_name">Attack Name</label>
            <label data-i18n="combat_skill">Combat Skill</label>
            <label data-i18n="mod">Mod</label>
            <label data-i18n="attack">Attack</label>
            <label data-i18n="rank">Rank</label>
            <label data-i18n="descriptor">Descriptor</label>
            <label data-i18n="dc">DC</label>
            <label data-i18n="crit">Crit</label>
          </div>
          <fieldset class="repeating_powers">
            <input class="controller" type="hidden" name="attr_element_type" value="menu">
            <input type="hidden" name="attr_label">
            <input type="hidden" name="attr_descriptor">
            <input type="hidden" name="attr_crit" value="20">
            <input type="hidden" name="attr_crit" value="20">
            <input type="hidden" name="attr_damage" value="0">
            <input type="hidden" name="attr_afflictions_type">
            <input type="hidden" name="attr_afflictions_1">
            <input type="hidden" name="attr_afflictions_2">
            <input type="hidden" name="attr_afflictions_3">
            <input type="hidden" name="attr_aff1_DC">
            <input type="hidden" name="attr_aff2_DC">
            <input type="hidden" name="attr_aff3_DC">

            <div class="element-attack_fx attack-row">
              <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{descriptor=@{descriptor}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{dc}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
                <span name="attr_label"></span>
              </button>
              <input type="text" name="attr_combat" placeholder="Skill Name">
              <input class="label_mod" type="number" name="attr_attack_mod" value="0">
              <input type="number" name="attr_attack" readonly placeholder="0">
              <input type="number" name="attr_rank_total" readonly value="0">
              <span name="attr_descriptor"></span>
              <input type="hidden" name="attr_dc">
              <span class="in_DC" name="attr_dc"></span>
              <span class="in_Crit" name="attr_crit"></span>
              <input type="hidden" name="attr_afflictions_1">
              <div class="display_afflictions">
                <span class="">Afflictions</span>
                <span class="redlabel" name="attr_afflictions_type"></span>
                <span class="redlabel __dc" name="attr_dc"></span>
                <div class="afflictions">
                  <span class="affliction" name="attr_afflictions_1"></span>
                  <span class="affliction" name="attr_afflictions_2"></span>
                  <span class="affliction" name="attr_afflictions_3"></span>
                </div>
              </div>
            </div>
          </fieldset>

          <fieldset class="repeating_equipment">
            <input class="controller" type="hidden" name="attr_element_type" value="menu">
            <input type="hidden" name="attr_label">
            <input type="hidden" name="attr_descriptor">
            <input type="hidden" name="attr_crit" value="20">
            <input type="hidden" name="attr_damage" value="0">
            <input type="hidden" name="attr_afflictions_type">
            <input type="hidden" name="attr_afflictions_1">
            <input type="hidden" name="attr_afflictions_2">
            <input type="hidden" name="attr_afflictions_3">

            <div class="element-attack_fx attack-row">
              <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{descriptor=@{descriptor}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{damage}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc}]]}} {{afflictions2_check=[[@{dc} - 5]]}} {{afflictions3_check=[[@{dc} - 10]]}}">
                <span name="attr_label"></span>
              </button>
              <input type="text" name="attr_combat" placeholder="Skill Name">
              <input class="label_mod" type="number" name="attr_attack_mod" value="0">
              <input type="number" name="attr_attack" readonly placeholder="0">
              <input type="number" name="attr_rank_total" readonly value="0">
              <span name="attr_descriptor"></span>
              <input type="hidden" name="attr_dc">
              <span class="in_DC" name="attr_dc"></span>
              <span class="in_Crit" name="attr_crit"></span>
              <input type="hidden" name="attr_afflictions_1">
              <div class="display_afflictions">
                <span class="">Afflictions</span>
                <span class="redlabel" name="attr_afflictions_type"></span>
                <span class="redlabel __dc" name="attr_dc"></span>

                <div class="afflictions">
                  <span class="affliction" name="attr_afflictions_1"></span>
                  <span class="affliction" name="attr_afflictions_2"></span>
                  <span class="affliction" name="attr_afflictions_3"></span>
                </div>
              </div>
            </div>
          </fieldset>

          <fieldset class="repeating_vehicles">
            <input class="controller" type="hidden" name="attr_element_type" value="menu">
            <input type="hidden" name="attr_label">
            <input type="hidden" name="attr_descriptor">
            <input type="hidden" name="attr_crit" value="20">
            <input type="hidden" name="attr_damage" value="0">
            <input type="hidden" name="attr_afflictions_type">
            <input type="hidden" name="attr_afflictions_1">
            <input type="hidden" name="attr_afflictions_2">
            <input type="hidden" name="attr_afflictions_3">
            
            <div class="element-attack_fx attack-row">
              <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{descriptor=@{descriptor}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{damage}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc} - 5]]}} {{afflictions2_check=[[@{dc} - 10]]}} {{afflictions3_check=[[@{dc} - 15]]}}">
                <span name="attr_label"></span>
              </button>
              <input type="text" name="attr_combat" placeholder="Skill Name">
              <input class="label_mod" type="number" name="attr_attack_mod" value="0">
              <input type="number" name="attr_attack" readonly placeholder="0">
              <input type="number" name="attr_rank_total" readonly value="0">
              <span name="attr_descriptor"></span>
              <input type="hidden" name="attr_dc">
              <span class="in_DC" name="attr_dc"></span>
              <span class="in_Crit" name="attr_crit"></span>
              <input type="hidden" name="attr_afflictions_1">
              <div class="display_afflictions">
                <span class="">Afflictions</span>
                <span class="redlabel" name="attr_afflictions_type"></span>
                <span class="redlabel __dc" name="attr_dc"></span>

                <div class="afflictions">
                  <span class="affliction" name="attr_afflictions_1"></span>
                  <span class="affliction" name="attr_afflictions_2"></span>
                  <span class="affliction" name="attr_afflictions_3"></span>
                </div>
              </div>
            </div>
          </fieldset>
          <fieldset class="repeating_headquarters">
            <input class="controller" type="hidden" name="attr_element_type" value="menu">
            <input type="hidden" name="attr_label">
            <input type="hidden" name="attr_descriptor">
            <input type="hidden" name="attr_crit" value="20">
            <input type="hidden" name="attr_damage" value="0">
            <input type="hidden" name="attr_afflictions_type">
            <input type="hidden" name="attr_afflictions_1">
            <input type="hidden" name="attr_afflictions_2">
            <input type="hidden" name="attr_afflictions_3">
            
            <div class="element-attack_fx attack-row">
              <button name="roll_attack" type="roll" name="btn_power-attack" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{descriptor=@{descriptor}}} {{result=[[1d20cs>@{crit} + @{attack} + (@{penalty_general} [Conditions])]]}} {{damage=[[@{damage}]]}} {{affliction_type=@{afflictions_type}}} {{affliction_check=@{dc}}} {{affliction1=@{afflictions_1}}} {{affliction2=@{afflictions_2}}} {{affliction3=@{afflictions_3}}} {{afflictions1_check=[[@{dc} - 5]]}} {{afflictions2_check=[[@{dc} - 10]]}} {{afflictions3_check=[[@{dc} - 15]]}}">
                <span name="attr_label"></span>
              </button>
              <input type="text" name="attr_combat" placeholder="Skill Name">
              <input class="label_mod" type="number" name="attr_attack_mod" value="0">
              <input type="number" name="attr_attack" readonly placeholder="0">
              <input type="number" name="attr_rank_total" readonly value="0">
              <span name="attr_descriptor"></span>
              <input type="hidden" name="attr_dc">
              <span class="in_DC" name="attr_dc"></span>
              <span class="in_Crit" name="attr_crit"></span>
              <input type="hidden" name="attr_afflictions_1">
              <div class="display_afflictions">
                <span class="">Afflictions</span>
                <span class="redlabel" name="attr_afflictions_type"></span>
                <span class="redlabel __dc" name="attr_dc"></span>

                <div class="afflictions">
                  <span class="affliction" name="attr_afflictions_1"></span>
                  <span class="affliction" name="attr_afflictions_2"></span>
                  <span class="affliction" name="attr_afflictions_3"></span>
                </div>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  </div>
<div class="section-center">
  <input type="hidden" name="attr_center_menu" value="powers">
  <div class="center-menu">
    <label><input type="radio" name="attr_center_menu" value="powers" checked="checked"><span data-i18n="powers">powers</span> </label>
    <label><input type="radio" name="attr_center_menu" value="equipment"><span data-i18n="equipment">equipment</span></label>
    <label><input type="radio" name="attr_center_menu" value="vehicles"><span data-i18n="vehicles">vehicles</span></label>
    <label><input type="radio" name="attr_center_menu" value="headquarters"><span data-i18n="headquarters">headquarters</span></label>
  </div>
  <div class="container-section section-powers edit-icon tab-powers">
    <div class="content">
      <a href="#edit_powers"><h1 data-i18n="powers">Powers</h1></a>
      <div class="display-powers">
        <fieldset class="repeating_powers">
          <input class="controller" type="hidden" name="attr_element_type" value="menu">
      <div class="element-menu">
        <h1>New Element</h1>
      </div>
      <div class="element-power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <h2><span name="attr_descriptor"></span></h2>
            <input type="number" name="attr_cost" title="Power Cost">
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <div class="element-gen_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <h2><span name="attr_descriptor"></span></h2>
          </summary>
          
          <textarea name="attr_description"></textarea>
        </details>
      </div>
      <div class="element-alt_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <label><input type="checkbox" name="attr_activated"  data-i18n-title="Activated" title="Activated"><span></span></label>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>

      </div>
      <div class="element-dyn_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <input type="number" name="attr_dynPool">
          </summary>
          <textarea name="attr_description"></textarea>
        </details>

      </div>
     <div class="element-general_fx">
      <input type="hidden" name="attr_rank_total">
        <details>
          <input type="hidden" name="attr_label" value="Power">
          <input type="hidden" name="attr_rank">
          <summary>
            <button class="rank_display" type="roll" name="roll_powerRank" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label}}} {{result=[[1d20 + @{rank} + (@{penalty_general} [Conditions])]]}}>">
              <span name="attr_rank_total"></span>
            </button>
            <span name="attr_label"></span>
            <span class="tag" name="attr_action"></span>
            <span class="tag" name="attr_range"></span>
            <span class="tag" name="attr_duration"></span>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <input type="hidden" name="attr_attack_type" value="general">
      <div class="element-attack_fx">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <span class="tag" name="attr_action"></span>
            <span class="tag" name="attr_range"></span>
            <span class="tag" name="attr_duration"></span>
            <input type="hidden" name="attr_aoe">
            <span class="tag" name="attr_aoe"></span>
            <span class="tag" name="attr_defense"></span>
            <input type="hidden" name="attr_dc">
            <span class="tag __dc" name="attr_dc"></span>
            <input type="hidden" name="attr_afflictions_1">
            <div class="section-Affliction">
              <div>
                <h2>Afflictions</h2>
                <span class="tag" name="attr_afflictions_type"></span>
                <span class="tag __dc" name="attr_dc"></span>
              </div>
              <div>
                <h3 class="tag rule">First Degree <span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff1_DC" value="(@{dc})"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_1"></span></label>
                <h3 class="tag rule">Second Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff2_DC" value="(@{dc} - 5)"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_2"></span></label>
                <h3 class="tag rule">Third Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff3_DC" value="(@{dc} - 10)"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_3"></span></label>
              </div>
            </div>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <div class="element-text">
        <input type="hidden" name="attr_description">
        <h1><label><span name="attr_label"></span><input type="checkbox" name="attr_text_open"></label></h1>
        <input type="hidden" name="attr_text_open">
        <span name="attr_description">
      </div>
        </fieldset>
      </div>
    </div>
  </div>
  <div class="container-section section-powers edit-icon tab-equipment ">
    <div class="content">
      <a href="#edit_equipment"><h1 data-i18n="equipment">Equipment</h1></a>
      <div class="display-powers">
        <fieldset class="repeating_equipment">
          <input class="controller" type="hidden" name="attr_element_type" value="menu">
      <div class="element-menu">
        <h1>New Element</h1>
      </div>
      <div class="element-power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <h2><span name="attr_descriptor"></span></h2>
            <input type="number" name="attr_cost" title="Power Cost">
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <div class="element-gen_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <h2><span name="attr_descriptor"></span></h2>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
      </div>
      <div class="element-alt_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <label><input type="checkbox" name="attr_activated"  data-i18n-title="Activated" title="Activated"><span></span></label>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>

      </div>
      <div class="element-dyn_power">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <input type="number" name="attr_dynPool">
          </summary>
          <textarea name="attr_description"></textarea>
        </details>

      </div>
      <div class="element-general_fx">
        <input type="hidden" name="attr_rank_total">
        <details>
          <summary>
            <span class="rank_display" name="attr_rank_total"></span>
            <span name="attr_label"></span>
            <span class="tag" name="attr_action"></span>
            <span class="tag" name="attr_range"></span>
            <span class="tag" name="attr_duration"></span>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <input type="hidden" name="attr_attack_type" value="general">
      <div class="element-attack_fx">
        <details>
          <summary>
            <h1><span name="attr_label"></span></h1>
            <span class="tag" name="attr_action"></span>
            <span class="tag" name="attr_range"></span>
            <span class="tag" name="attr_duration"></span>
            <input type="hidden" name="attr_aoe">
            <span class="tag" name="attr_aoe"></span>
            <span class="tag" name="attr_defense"></span>
            <input type="hidden" name="attr_dc">
            <span class="tag __dc" name="attr_dc"></span>
            <input type="hidden" name="attr_afflictions_1">
            <div class="section-Affliction">
              <div>
                <h2>Afflictions</h2>
                <span class="tag" name="attr_afflictions_type"></span>
                <span class="tag __dc" name="attr_dc"></span>
              </div>
              <div>
                <h3 class="tag rule">First Degree <span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff1_DC" value="(@{dc})"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_1"></span></label>
                <h3 class="tag rule">Second Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff2_DC" value="(@{dc} - 5)"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_2"></span></label>
                <h3 class="tag rule">Third Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff3_DC" value="(@{dc} - 10)"></span></h3>
                <label class="display_condition"><span name="attr_afflictions_3"></span></label>
              </div>
            </div>
          </summary>
          <textarea name="attr_description"></textarea>
        </details>
        
      </div>
      <div class="element-text">
        <input type="hidden" name="attr_description">
        <h1><label><span name="attr_label"></span><input type="checkbox" name="attr_text_open"></label></h1>
        <input type="hidden" name="attr_text_open">
        <span name="attr_description">
      </div>
        </fieldset>
      </div>
    </div>
  </div>
  <div class="container-section section-powers edit-icon tab-vehicles ">
    <div class="content">
      <a href="#edit_vehicles"><h1 data-i18n="vehicles">Vehicles</h1></a>
      <div class="display-powers">
        <fieldset class="repeating_vehicles">
          <input class="controller" type="hidden" name="attr_element_type" value="menu">
          <div class="element-menu">
            <h1>New Element</h1>
          </div>
          <div class="element-vehicle">
            <input type="hidden" name="attr_label" placeholder="Name">
            <input type="hidden" name="attr_strength" value="0">
            <input type="hidden" name="attr_toughness" value="0">
            <input type="hidden" name="attr_defense" value="0">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <div>
                  <label><span>Size</span><span name="attr_size"></span></label>
                  <input type="number" name="attr_cost" title="Power Cost">
                </div>
                <button name="roll_strength" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Strength}} {{result=[[1d20 + @{strength} + (@{penalty_general} [Conditions])]]}}"><span>Strength</span><span name="attr_strength"></span></button>
                <button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Toughness}} {{result=[[1d20 + @{toughness} + (@{penalty_general} [Conditions])]]}}"><span>Toughness</span><span name="attr_toughness"></span></button>
                <button name="roll_defense" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Defense}} {{result=[[1d20 + @{defense} + (@{penalty_general} [Conditions])]]}}"><span>Defense</span><span name="attr_defense"></span></button>  
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
            
          </div>
          <div class="element-power">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <h2><span name="attr_descriptor"></span></h2>
                <input type="number" name="attr_cost" title="Power Cost">
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
            
          </div>
          <div class="element-gen_power">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <h2><span name="attr_descriptor"></span></h2>
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
          </div>
          <div class="element-alt_power">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <label><input type="checkbox" name="attr_activated"  data-i18n-title="Activated" title="Activated"><span></span></label>
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
    
          </div>
          <div class="element-dyn_power">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <input type="number" name="attr_dynPool">
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
    
          </div>
          <div class="element-general_fx">
            <input type="hidden" name="attr_rank_total">
            <details>
              <summary>
                <span class="rank_display" name="attr_rank_total"></span>
                <span name="attr_label"></span>
                <span class="tag" name="attr_action"></span>
                <span class="tag" name="attr_range"></span>
                <span class="tag" name="attr_duration"></span>
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
            
          </div>
          <input type="hidden" name="attr_attack_type" value="general">
          <div class="element-attack_fx">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <span class="tag" name="attr_action"></span>
                <span class="tag" name="attr_range"></span>
                <span class="tag" name="attr_duration"></span>
                <input type="hidden" name="attr_aoe">
                <span class="tag" name="attr_aoe"></span>
                <span class="tag" name="attr_defense"></span>
                <input type="hidden" name="attr_dc">
                <span class="tag __dc" name="attr_dc"></span>
                <input type="hidden" name="attr_afflictions_1">
                <div class="section-Affliction">
                  <div>
                    <h2>Afflictions</h2>
                    <span class="tag" name="attr_afflictions_type"></span>
                    <span class="tag __dc" name="attr_dc"></span>
                  </div>
                  <div>
                    <h3 class="tag rule">First Degree <span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff1_DC" value="(@{dc})"></span></h3>
                    <label class="display_condition"><span name="attr_afflictions_1"></span></label>
                    <h3 class="tag rule">Second Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff2_DC" value="(@{dc} - 5)"></span></h3>
                    <label class="display_condition"><span name="attr_afflictions_2"></span></label>
                    <h3 class="tag rule">Third Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff3_DC" value="(@{dc} - 10)"></span></h3>
                    <label class="display_condition"><span name="attr_afflictions_3"></span></label>
                  </div>
                </div>
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
          </div>
          <div class="element-text">
            <input type="hidden" name="attr_description">
            <h1><label><span name="attr_label"></span><input type="checkbox" name="attr_text_open"></label></h1>
            <input type="hidden" name="attr_text_open">
            <span name="attr_description">
          </div>
        </fieldset>
      </div>
    </div>
    
  </div>
  <div class="container-section section-powers edit-icon tab-headquarters ">
    <div class="content">
      <a href="#edit_headquarters"><h1 data-i18n="headquarters">headquarters</h1></a>
      <div class="display-powers">
        <fieldset class="repeating_headquarters">
          <input class="controller" type="hidden" name="attr_element_type" value="menu">
          <div class="element-menu">
            <h1>New Element</h1>
          </div>
          <div class="element-vehicle">
            <input type="hidden" name="attr_label" placeholder="Title">
            <input type="hidden" name="attr_strength" value="0">
            <input type="hidden" name="attr_toughness" value="0">
            <input type="hidden" name="attr_defense" value="0">
            <details>
              <summary>
                <h1><span name="attr_label"></span></h1>
                <div>
                  <label><span>Size</span><span name="attr_size"></span></label>
                  <input type="number" name="attr_cost" title="Power Cost">
                </div>
                <button name="roll_strength" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Strength}} {{result=[[1d20 + @{strength} + (@{penalty_general} [Conditions])]]}}"><span>Strength</span><span name="attr_strength"></span></button>
                <button name="roll_toughness" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Toughness}} {{result=[[1d20 + @{toughness} + (@{penalty_general} [Conditions])]]}}"><span>Toughness</span><span name="attr_toughness"></span></button>
                <button name="roll_defense" type="roll" value="@{op_gmRoll} &{template:roll} {{name=@{character_name}}} {{trait=@{label} Defense}} {{result=[[1d20 + @{defense} + (@{penalty_general} [Conditions])]]}}"><span>Defense</span><span name="attr_defense"></span></button>
              </summary>
              <textarea name="attr_description"></textarea>
            </details>
             </div>
             <div class="element-power">
              <details>
                <summary>
                  <h1><span name="attr_label"></span></h1>
                  <h2><span name="attr_descriptor"></span></h2>
                  <input type="number" name="attr_cost" title="Power Cost">
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
              
            </div>
            <div class="element-gen_power">
              <details>
                <summary>
                  <h1><span name="attr_label"></span></h1>
                  <h2><span name="attr_descriptor"></span></h2>
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
            </div>
            <div class="element-alt_power">
              <details>
                <summary>
                  <h1><span name="attr_label"></span></h1>
                  <label><input type="checkbox" name="attr_activated"  data-i18n-title="Activated" title="Activated"><span></span></label>
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
      
            </div>
            <div class="element-dyn_power">
              <details>
                <summary>
                  <h1><span name="attr_label"></span></h1>
                  <input type="number" name="attr_dynPool">
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
      
            </div>
            <div class="element-general_fx">
              <input type="hidden" name="attr_rank_total">
              <details>
                <summary>
                  <span class="rank_display" name="attr_rank_total"></span>
                  <span name="attr_label"></span>
                  <span class="tag" name="attr_action"></span>
                  <span class="tag" name="attr_range"></span>
                  <span class="tag" name="attr_duration"></span>
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
              
            </div>
            <input type="hidden" name="attr_attack_type" value="general">
            <div class="element-attack_fx">
              <details>
                <summary>
                  <h1><span name="attr_label"></span></h1>
                  <span class="tag" name="attr_action"></span>
                  <span class="tag" name="attr_range"></span>
                  <span class="tag" name="attr_duration"></span>
                  <input type="hidden" name="attr_aoe">
                  <span class="tag" name="attr_aoe"></span>
                  <span class="tag" name="attr_defense"></span>
                  <input type="hidden" name="attr_dc">
                  <span class="tag __dc" name="attr_dc"></span>
                  <input type="hidden" name="attr_afflictions_1">
                  <div class="section-Affliction">
                    <div>
                      <h2>Afflictions</h2>
                      <span class="tag" name="attr_afflictions_type"></span>
                      <span class="tag __dc" name="attr_dc"></span>
                    </div>
                    <div>
                      <h3 class="tag rule">First Degree <span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff1_DC" value="(@{dc})"></span></h3>
                      <label class="display_condition"><span name="attr_afflictions_1"></span></label>
                      <h3 class="tag rule">Second Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff2_DC" value="(@{dc} - 5)"></span></h3>
                      <label class="display_condition"><span name="attr_afflictions_2"></span></label>
                      <h3 class="tag rule">Third Degree<span class="tag __dc"><input type="number" disabled class="tag " name="attr_aff3_DC" value="(@{dc} - 10)"></span></h3>
                      <label class="display_condition"><span name="attr_afflictions_3"></span></label>
                    </div>
                  </div>
                </summary>
                <textarea name="attr_description"></textarea>
              </details>
            </div>
            <div class="element-text">
              <input type="hidden" name="attr_description">
              <h1><label><span name="attr_label"></span><input type="checkbox" name="attr_text_open"></label></h1>
              <input type="hidden" name="attr_text_open">
              <span name="attr_description">
            </div>
        </fieldset>
      </div>
    </div>
  </div>
  

</div>
    <div class="container-section panel-borders section-advantages">
      <div class="content">
        <h1 data-i18n="advantages">Advantages</h1>
        <fieldset class="repeating_advantages">
          <details class="advantage_row">
            <summary>
              <input type="text" name="attr_name">
              <input type="number" name="attr_rank" value="1">
            </summary>
            <textarea name="attr_desc"></textarea>
          </details>
          <button name="roll_advantage" type="roll" class="btn_show" value="&{template:roll} {{name=@{character_name}}} {{trait=@{name}}} {{extras=@{desc}}}">q</button>
        </fieldset>
      </div>
    </div>
</div>
</div>

<rolltemplate class="sheet-rolltemplate-roll">
  <div class="name">{{name}}</div>
  <div class="trait">{{trait}}</div>
  {{#descriptor}}
  <div class="descriptor">{{descriptor}}</div>
  {{/descriptor}}
{{#result}}
  <div data-i18n-title="Result" title="Result" class="result">{{result}}</div>
{{/result}}
{{#rollGreater() damage 0}}
  <div data-i18n-title="damage" title="Damage"  class="result __damage">{{damage}}</div>
{{/rollGreater() damage 0}}
{{#affliction1}}
  <div class="afflictions_panel">
    <h1>Afflictions</h1>
    <div class="info">{{affliction_type}}</div>
    <div><span class="dc">{{afflictions1_check}}</span>{{affliction1}}</div>
    {{#affliction2}}<div><span class="dc">{{afflictions2_check}}</span>{{affliction2}}</div>{{/affliction2}}
    {{#affliction3}}<div><span class="dc">{{afflictions3_check}}</span>{{affliction3}}</div>{{/affliction3}}
  </div>
{{/affliction1}}
{{#extras}}
  <div class="extras">
    {{extras}}
  </div>
{{/extras}}
{{#link}}
  <div class="extras link">
    {{link}}
  </div>
{{/link}}
</rolltemplate>

<script type="text/worker">
  // Rank Arrays
  const rankMass = ["1.5 lbs.","3 lbs.","6 lbs.","12 lbs.","25 lbs.","50 lbs.","100 lbs.","200 lbs.","400 lbs.","800 lbs.","1,600 lbs.","3,200 lbs.","3 tons","6 tons","12 tons","25 tons","50 tons","100 tons","200 tons","400 tons","800 tons","1,600 tons","3.2 ktons","6 ktons","12 ktons","25 ktons","50 ktons","100 ktons","200 ktons","400 ktons","800 ktons","1,600 ktons","3,200 ktons","6,400 ktons","12,500 ktons","25,000 ktons"];
  const rankTime = ["1/8 second","1/4 second","1/2 second","1 second","3 seconds","6 seconds","12 seconds","30 seconds","1 minute","2 minutes","4 minutes","8 minutes","15 minutes","30 minutes","1 hour","2 hours","4 hours","8 hours","16 hours","1 day","2 days","4 days","1 week","2 weeks","1 month","2 months","4 months","8 months","1.5 years","3 years","6 years","12 years","25 years","50 years","100 years","200 years"];
  const rankDistance = ["6 inches", "1 foot","3 feet","6 feet","15 feet","30 feet","60 feet","120 feet","250 feet","500 feet","900 feet","1,800 feet","1/2 mile","1 mile","2 miles","4 miles","8 miles","16 miles","30 miles","60 miles","120 miles","250 miles", "500 miles","1,000 miles","2,000 miles","4,000 miles","8,000 miles","16,000 miles","32,000 miles","64,000 miles","125,000 miles","250,000 miles","500,000 miles","1 million miles","2 million miles","4 million miles"];
  const rankVolume = ["1/32 cft.","1/16 cft.","1/8 cft","1/4 cft.","1/2 cft.","1 cubic ft.(cft.)","2 cft.","4 cft.", "8 cft.","15 cft.","30 cft.","60 cft.","125 cft.","250 cft.","500 cft.","1,000 cft.","2,000 cft.","4,000 cft.","8,000 cft.","15,000 cft.","32,000 cft.","65,000 cft.","125,000 cft.","250,000 cft.","500,000 cft","1 million cft.","2 million cft.","4 million cft.","8 million cft.","15 million cft.","32 million cft.","65 million cft.","125 million cft", "250 million cft.","500 million cft.","1 billion cft."];

  // CHECKLIST FOR NEW Functions
  // If its in a repeating section, make sure its in repeating_section_details. 
  // Make sure its in the cascade
  //# Script Variables #
  const version = 1.02;
  //Object that defines how the attributes affect each other
  const abilities = ['strength','stamina','agility','dexterity','fighting','intellect','awareness','presence'];
  const defenses = ['dodge','parry','fortitude','toughness','will'];
  const skills = ['acrobatics','athletics','deception','expertise','insight','intimidation','investigation','perception','persuasion','sleightofhand','stealth','technology','treatment','vehicles','repeating_closecombat','repeating_rangedcombat','repeating_expertise'];
  
  //# Roll20Async functions #
  //These together allow the use of promises and await/async to allow us to escape callback hell
  const setActiveCharacterId = function(charId){
    var oldAcid=getActiveCharacterId();
    var ev = new CustomEvent("message");
    ev.data={"id":"0", "type":"setActiveCharacter", "data":charId};
    self.dispatchEvent(ev); 
    return oldAcid;
  };
  const _getAttrs = function (props){
    var acid=getActiveCharacterId();//save the current activeCharacterID in case it has changed when the promise runs 
    var prevAcid=null;              //local variable defined here, because it needs to be shared across the promise callbacks defined below
    return new Promise((resolve,reject)=>{
      prevAcid=setActiveCharacterId(acid);  //in case the activeCharacterId has changed, restore it to what we were expecting and save the current value to restore later
      try{
          getAttrs(props,(values)=>{  resolve(values); }); 
      }catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); //restore activeCharcterId to what it was when the promise first ran
    });
  };
  //use the same pattern for each of the following...
  const _setAttrs = function (propObj, options){
    var acid=getActiveCharacterId(); 
    var prevAcid=null;               
    return new Promise((resolve,reject)=>{
      prevAcid=setActiveCharacterId(acid);  
      try{
          setAttrs(propObj,options,(values)=>{ resolve(values); });
      }
      catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); 
    });
  };
  const _getSectionIDs = function(sectionName){
    var acid=getActiveCharacterId(); 
    var prevAcid=null;               
    return new Promise((resolve,reject)=>{
      prevAcid=setActiveCharacterId(acid);  
      try{
          getSectionIDs(sectionName,(values)=>{ resolve(values); });
      }
      catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); 
    });
  };
  
  //# Utility Functions #
  const log = function(msg){
    const sheetName = 'Mutants and Masterminds 3e';
    if(typeof msg === 'string'){
      console.log(`%c${sheetName} log| ${msg}`,"background-color:#159ccf");
    }else if(typeof msg === 'object'){
      Object.keys(msg).forEach((m)=>{
        if(typeof msg[m] === 'string'){
          console.log(`%c${sheetName} log| ${m}: ${msg[m]}`,"background-color:#159ccf");
        }else{
          console.log(`%c${sheetName} log| ${typeof msg[m]} ${m}`,"background-color:#159ccf");
          console.table(msg[m]);
        }
      });
    }
  };
  const debug = function(msg){
    const sheetName = 'Mutants and Masterminds 3e';
    if(typeof msg === 'string'){
      console.log(`%c${sheetName} DEBUG| ${msg}`,"background-color:tan;color:red;");
    }else if(typeof msg === 'object'){
      Object.keys(msg).forEach((m)=>{
        if(typeof msg[m] === 'string'){
          console.log(`%c${sheetName} DEBUG| ${m}: ${msg[m]}`,"background-color:tan;color:red;");
        }else{
          console.log(`%c${sheetName} DEBUG| ${typeof msg[m]} ${m}`,"background-color:tan;color:red;font-weight:bold;");
          if(Object.keys(msg[m]).length <= 30){
            console.table(msg[m]);
          }else{
            console.log(msg[m]);
          }
        }
      });
    }
  };
  const updateSheet = async function(){
    let attributes = await _getAttrs(['sheet_version',...baseGet]);
    const setObj = {
      sheet_version:version
    };
    if(!attributes.sheet_version || attributes.sheet_version < 0.2){
      initialSetup(setObj,attributes)
    }
    log(`Sheet Update applied. Current Sheet Version ${version}`);
    set(setObj);
  };
  //Upate Functions
  const initialSetup = function(setObj,attributes){
    skills.forEach((skill)=>{
      if(!/repeating/.test(skill) && !attributes[skill] && attributes[skill]!==0){
        setObj[skill] = derivativeStatCalc({name:skill},attributes);
        attributes[skill] = setObj[skill];
      }
    })
  };
  const _getSections = function(section_details){
    let queue = _.clone(section_details);
    const worker = async (repeatAttrs=[],sections={})=>{
      let detail = queue.shift();
      let IDs = await _getSectionIDs(detail.section);
      sections[detail.section] = IDs;
      let attrs = IDs.forEach((i)=>{
        detail.fields.forEach((f)=>{
          repeatAttrs.push(`${detail.section}_${i}_${f}`);
        });
      });
      if(queue.length){
        return worker(repeatAttrs,sections);
      }else{
        return [repeatAttrs,sections];
      }
    };
    return worker();
  };
  // Sets the attributes while always calling with {silent:true}
  // Can be awaited to get the values returned from _setAttrs
  const set = function(obj){
    let setObj = verifyObj(obj);
    return _setAttrs(setObj,{silent:true});
  };
  //verifies that the property/keys of the setObj are valid
  const verifyObj = function(obj){
    return Object.keys(obj).reduce((m,p)=>{
      if(obj[p]===undefined || obj[p]===null || obj[p] === NaN){
        debug(`WARNING: setObj[${p}] = ${obj[p]}`);
      }else{
        m[p]=obj[p];
      }
      return m;
    },{})
  };
  //Expands the repeating section templates in cascades to reflect the rows actually available
  const expandCascade = function(cascade,sections,attributes){
    return _.keys(cascade).reduce((memo,key)=>{//iterate through cascades and replace references to repeating attributes with correct row ids.
      if(/^repeating/.test(key)){//If the attribute is a repeating attribute, do special logic
        expandRepeating(memo,key,cascade,sections,attributes);
      }else{//for non repeating attributes do this logic
        expandNormal(memo,key,cascade,sections);
      }
      return memo;
    },{});
  };
  
  const expandRepeating = function(memo,key,cascade,sections,attributes){
    key.replace(/(repeating_[^_]+)_[^_]+?_(.+)/,(match,section,field)=>{
      (sections[section]||[]).forEach((id)=>{
        memo[`${section}_${id}_${field}`]=_.clone(cascade[key]);//clone the details so that each row's attributes have correct ids
        memo[`${section}_${id}_${field}`].name = `${section}_${id}_${field}`;
        memo[`${section}_${id}_${field}`].affects = memo[`${section}_${id}_${field}`].affects.reduce((m,affected)=>{
          if(affected.startsWith(section)){//if the affected attribute is in the same section, simply set the affected attribute to have the same row id.
            m.push(applyID(affected,id));
          }else if(/repeating/.test(affected)){//If the affected attribute isn't in the same repeating section but is still a repeating attribute, add all the rows of that section
            addAllRows(affected,m,sections);
          }else{//otherwise the affected attribute is a non repeating attribute. Simply add it to the computed affected array
            m.push(affected);
          }
          return m;
        },[]);
      });
    });
  };
  
  const applyID = function(affected,id){
    return affected.replace(/(repeating_[^_]+_)[^_]+(.+)/,`$1${id}$2`);
  };
  /*
  const expandComplex = function(section,id,field,affected,memo,sections,attributes){
    const master = attributes[`${section}_${id}_master_row`];
    if(!master){//If there is no master row, it is a master row and should affect the rest of the sheet
      if(affected.startsWith(section)){//It won't affect things in its own row
        return;
      }else if(/repeating/.test(affected)){//or other sections
        addAllRows(affected,memo,sections);
      }else{//or non repeating sections on the sheet
        memo.push(affected);
      }
    }else{//Set the affected based on the master row
      if(affected.startsWith(section)){//It will affect attributes in the master row
        let newName = applyID(affected,master);
        memo.push(newName);
      }else{//it won't affect anything elsewhere on the sheet
        return;
      }
    }
  };
  */
  const expandNormal = function(memo,key,cascade,sections){
    memo[key] = _.clone(cascade[key]);
    memo[key].affects = memo[key].affects.reduce((m,a)=>{
      if(/^repeating/.test(a)){
        addAllRows(a,m,sections);
      }else{
        m.push(a);
      }
      return m;
    },[]);
  };
  
  const addAllRows = function(affected,memo,sections){
    affected.replace(/(repeating_[^_]+?)_[^_]+?_(.+)/,(match,section,field)=>{
      sections[section].forEach(id=>memo.push(`${section}_${id}_${field}`));
    });
  };
  
  //assigns the masterRow for the power
  const updateMasterRow = function(name,setObj,sections,attributes){
    let orderedRows = [attributes._reporder_repeating_powers]
    name.replace(/(repeating_[^_]+?_([^_]+?))_(.+)/,(match,row,id,field)=>{
      if(attributes[`${row}_element_type`]!=='power'){
        let index = sections.repeating_powers.indexOf(id);
        for(;index >= 0;index--){
          if(attributes[`repeating_powers_${sections.repeating_powers[index]}_element_type`]==='power'){
            setObj[`${row}_master_row`] = sections.repeating_powers[index];
            attributes[`${row}_master_row`] = setObj[`${row}_master_row`];
            break;
          }
        }
      }
    });
  };
  //# Calculation Functions #
  //converts a value to a number, it's default value, or 0
  const value = function(val,def){
    return (+val||def||0);
  };
  /*
  //calculates the total ranks spent in a power - Not Used
  const powerRanks = function(statObj,attributes,sections,buffs){
    let retVal = 0;
    let masterID;
    statObj.name.replace(/(repeating_[^_]+?_([^_]+))_([^_]+)/,(match,section,id,field)=>{
      masterID = id;
    });
    return sections.repeating_powers.filter((id)=>{
        return attributes[`repeating_powers_${id}_master_row`]===masterID;
      })
      .reduce((total,id)=>{
        return total+=value(attributes[`repeating_powers_${id}_rank`]);
      },0);
  };
  //calculates the total cost of a power - Not used
  const powerCost = function(statObj,attributes,sections,buffs){
    let retVal = 0;
    let masterID;
    statObj.name.replace(/(repeating_[^_]+?_([^_]+))_([^_]+)/,(match,section,id,field)=>{
      masterID = id;
    });
    return sections.repeating_powers.filter((id)=>{
        return attributes[`repeating_powers_${id}_master_row`]===masterID;
      })
      .reduce((total,id)=>{
        return total+=(value(attributes[`repeating_powers_${id}_rank`]))*value(attributes[`repeating_powers_${id}_rankcost`]);
      },0);
  };*/
  //calculates how many points have been spent on ability increases (e.g. strength)
  const abilityPoints = function(statObj,attributes){
    return abilities.reduce((memo,a)=>{
      return memo += (value(attributes[`${a}_rank`])*2);
    },0);
  };
  //calculates how many points have been spent on defense increases (e.g. dodge)
  const defensePoints = function(statObj,attributes){
    return defenses.reduce((memo,a)=>{
      return memo += (value(attributes[`${a}_rank`]));
    },0);
  };
  //calculates how many points have been spent on skill increases (e.g. acrobatics)
  const skillPoints = function(statObj,attributes){
    const repeatConvert = {
      repeating_expertise:'expertise_rank',
      repeating_closecombat:'specialty_rank',
      repeating_rangedcombat:'specialty_rank'
    };
    const repeatSwitch = Object.keys(attributes).reduce((memo,a)=>{
      a.replace(/((repeating_[^_]+?)_[^_]+?_[^_]+?)_(.+)/,(match,row,section,field)=>{
        if(memo[section] && match.endsWith(repeatConvert[section])){
          memo[section].push(row);
        }
      });
      return memo;
    },{
      repeating_expertise:[],
      repeating_closecombat:[],
      repeating_rangedcombat:[]
    });
    const fullSkills = skills.reduce((memo,s)=>{
      if(/repeating/.test(s)){
        memo = [...memo,...repeatSwitch[s]];
      }else{
        memo.push(s);
      }
      return memo;
    },[]);
    return fullSkills.reduce((memo,a)=>{
      return memo += (value(attributes[`${a}_rank`])/2);
    },0);
  };
  //calculates how many points have been spent on advantage increases
  const advantagePoints = function(statObj,attributes){
    return Object.keys(attributes).reduce((memo,a)=>{
      if(/repeating_advantages_[^_]+?_rank/.test(a)){
        memo+=value(attributes[a]);
      }
      return memo;
    },0);
  };
  //calculates how many points have been spent on power increases
  const powerPoints = function(statObj,attributes,sections){
    return sections.repeating_powers.reduce((memo,id)=>{
      if(attributes[`repeating_powers_${id}_element_type`]==='power'){
        memo+=value(attributes[`repeating_powers_${id}_cost`]);
      }
      return memo;
    },0);
  };
  //calculates how many points have been spent on equipment, vehicles, and headquarters
  const equipmentPoints = function(statObj,attributes,sections){
    return ['equipment','vehicles','headquarters'].reduce((total,sect)=>{
      sections[`repeating_${sect}`].forEach((id)=>{
        if(attributes[`repeating_${sect}_${id}_element_type`]==='power'){
          total += value(attributes[`repeating_${sect}_${id}_cost`])/5;
        }
      });
      return total;
    },0);
  };
  //calculates the total cost of all points spent
  const powerPointTotal = function(statObj,attributes,sections){
    let pointTypes = ['ability','defense','skill','advantage','power','equipment', 'miscellaneous'];
    return pointTypes.reduce((m,key)=>{
      m+=value(attributes[`powerpoints_${key}`]);
      return m;
    },0);
  };
  //Calculates a base stat's value (e.g. strength)
  const baseStatCalc = function(statObj,attributes,sections,buffs){
    return value(attributes[`${statObj.name}_rank`])+value(attributes[`${statObj.name}_mod`])+value(attributes[`${statObj.name}_misc`]);
  };
  //Calculates the value of a stat derived from one of the base stats (e.g. will)
  const derivativeStatCalc = function(statObj,attributes,sections,buffs){
    const derivativeStats = {
      dodge:'agility',
      parry:'fighting',
      fortitude:'stamina',
      toughness:'stamina',
      will:'awareness',
      acrobatics:'agility',
      athletics:'strength',
      deception:'presence',
      insight:'awareness',
      intimidation:'presence',
      investigation:'intellect',
      perception:'awareness',
      persuasion:'presence',
      sleightofhand:'dexterity',
      stealth:'agility',
      technology:'intellect',
      treatment:'intellect',
      vehicles:'dexterity'
    };
    let penalty = 0;
    if(/toughness/.test(statObj.name)){
      penalty = value(attributes.injuries)*-1;
    }
    let ability = /^repeating_expertise/.test(statObj.name) ? getAbilityFromSelect(statObj.name,attributes) : value(attributes[derivativeStats[statObj.name]]);
    return value(attributes[`${statObj.name}_rank`])+value(attributes[`${statObj.name}_mod`])+value(attributes[`${statObj.name}_misc`])+ ability + penalty;
  };
  //extracts the ability score from a select based on the base attribute of the area. Eg. acrobatics instead of acrobatics_rank, and repeating_expertise_$id_expertise instead of repeating_expertise_$id_expertise_rank
  const getAbilityFromSelect = function(baseAttr,attributes){
    let selectName = attributes[`${baseAttr.replace(/^(repeating_[^_]+?_[^_]+?)_.+/,'$1')}_attribute`].replace(/[^a-z]/gi,'');
    return value(attributes[selectName]);
  };
  //Extracts and displays attributes for skill repeating sections
  const displayAttribute = function(statObj,attributes){
    let ability = /^repeating_closecombat/.test(statObj.name) ? value(attributes.fighting) : value(attributes.dexterity);
    let checkFighting = value(attributes.fighting);
    console.log(statObj);
    console.log('Returning fighting: ' + checkFighting);
    console.log('Repeating attribute: ' + ability);
    return ability;
  }
  //assigns the appropriate skill rank for the attack based on the skill name entered in the combat skill field
  const attackRank = function(statObj,attributes,sections,buffs){
    let total;
    statObj.name.replace(/(repeating_[^_]+?_([^_]+?))_(.+)/,(match,row,id,field)=>{
      let skillName = row.startsWith('repeating_attacks') ? attributes[`${row}_attack_combat`] : attributes[`${row}_combat`];
      if(skillName){
        let skillRow = findSkill(skillName,sections,attributes);
        if(skillRow){
          let ability = 0;
          if(skillRow.startsWith('repeating_ranged')){
            ability = value(attributes.dexterity);
          }else if(skillRow.startsWith('repeating_close')){
            ability = value(attributes.fighting);
          }
          total = value(attributes[`${skillRow}_specialty_rank`]) + value(attributes[`${skillRow}_specialty_mod`]) + value(attributes[`${skillRow}_specialty_misc`]) + ability;
        }else{
          total = 0;
        }
      }else{
        total = 0;
      }
    });
    return total;
  };
  //sanitizes text for use as a regex
  sanitizeForRegex = function(text){
    return text.replace(/\.|\||\(|\)|\[|\]|\-|\+|\?|\/|\{|\}|\^|\$|\*/g,'\\$&');
  };
  //Finds the closecombat or rangedcombat skill that matches the name
  //Returns the row of the item (e.g. repeating_closecombat_-ID)
  const findSkill = function(skill,sections,attributes){
    let rangedRows = sections.repeating_rangedcombat.map(id=>`repeating_rangedcombat_${id}`);
    let closeRows = sections.repeating_closecombat.map(id=>`repeating_closecombat_${id}`);
    let rows = [...rangedRows,...closeRows];
    let foundRow;
    let skillRegex = new RegExp(sanitizeForRegex(skill),'i');
    while(rows.length){
      let row = rows.shift();
      let name = attributes[`${row}_specialty`];
      if(skill.toLowerCase() === name.toLowerCase()){
        foundRow = row;
        break;
      }else if(skillRegex.test(name)){
        foundRow = row;
      }
    }
    return foundRow;
  };
  //All the Calculator 
  var displayRank;
  const calcShadow = function(statObj,attributes){
    let shadowRank = displayRank||0;
    displayRank = value(attributes.calcrank);
    console.log(shadowRank);
    console.log(displayRank);
    return shadowRank;
  };

  const calcMass = function(statObj,attributes){
    console.log("Rank Calculator");
    let rank = value(attributes.calcrank) + 5;
    let result = rankMass[rank];
    console.log("Rank is " + rank);
    console.log("Mass is " + result);
    return result;
  };
  const calcTime = function(statObj,attributes){
    let rank = value(attributes.calcrank) + 5;
    let result = rankTime[rank];
    console.log("Rank is " + rank);
    console.log("Time is " + result);
    return result;
  };
  const calcDistance = function(statObj,attributes){
    let rank = value(attributes.calcrank) + 5;
    let result = rankDistance[rank];
    console.log("Rank is " + rank);
    console.log("Distance is " + result);
    return result;
  };
  const calcVolume = function(statObj,attributes){
    let rank = value(attributes.calcrank) + 5;
    let result = rankVolume[rank];
    console.log("Rank is " + rank);
    console.log("Volume is " + result);
    return result;
  };

  //calculates character movements based on hour and round
  const speedType = {ground:0,flying:0,leaping:-2,burrowing:-5,swimming:-2};

  const movementcalcHour = function(statObj,attributes,sections){
    console.log("Calc Hourly");
    let type;
    let rank;
    statObj.name.replace(/(repeating_[^_]+?_[^_]+?)_(.+)/,(match,rowID,field)=>{
      type = attributes[`${rowID}_speedtype`];
      rank = value(attributes[`${rowID}_speedrank`]) + 14 + value(speedType[type]);
      console.log("Rank is " + rank);
      console.log("Type is " + type);
    });
    let total = rankDistance[rank];
    console.log(speedType);
    console.log(total);
    return total;
  };

  const movementcalcRound = function(statObj,attributes,sections){
    console.log("Calc Round");
    let rank;
    statObj.name.replace(/(repeating_[^_]+?_[^_]+?)_(.+)/,(match,rowID,field)=>{
      type = attributes[`${rowID}_speedtype`];
      rank = value(attributes[`${rowID}_speedrank`]) + 5 + value(speedType[type]);
    });
    let total = rankDistance[rank] ;
    return total;
  };

  //calculates the total attack value
  const attackTotal = function(statObj,attributes,sections,buffs){
    let total;
    statObj.name.replace(/(repeating_[^_]+?_[^_]+?)_(.+)/,(match,rowID,field)=>{
      let skillName = rowID.startsWith('repeating_attacks') ? attributes[`${rowID}_attack_combat`] : attributes[`${rowID}_combat`];
      total = value(attributes[`${rowID}_attack_rank`])+value(attributes[`${rowID}_attack_mod`]);
    });
    console.log(total);
    return total;
  };
  //calculates a power's rank_total from rank and rank_bonus
  const rankcalc = function(statObj,attributes,sections){
    let total;
    statObj.name.replace(/(repeating_[^_]+?_[^_]+?)_(.+)/,(match,rowID,field)=>{
      total = value(attributes[`${rowID}_rank`]) + value(attributes[`${rowID}_rankBonus`]);
    });
    return total;
  }
  //calculates the Damage DC based on the Power's Rank
  const dcDamage = function(statObj,attributes,sections,buffs){
    let total;
    let damage;
    statObj.name.replace(/(repeating_[^_]+?_[^_]+?)_(.+)/,(match,rowID,field)=>{
      if(attributes[`${rowID}_aoe`] === 'AOE' || attributes[`${rowID}_afflictions_1`]){
        damage = 10;
      }else {damage = 15}
      total = damage + value(attributes[`${rowID}_rank_total`]);
    });
    console.log(damage);
    console.log("Damage DC is now" + total);
    return total;
  }
  //calculates the total general penalty
  const totalPenalty = function(statObj,attributes,sections,buffs){
    const conditionSwitch = {
      debilitated:-5,
      disabled:-5,
      impaired:-2
    };
    if(attributes.disabled === 'on'){
      delete conditionSwitch.impaired;
    }
    return Object.keys(conditionSwitch).reduce((total,condition)=>{
      if(attributes[condition]==='on'){
        total+=conditionSwitch[condition];
      }
      return total;
    },0);
  };

  //accesses the sheet and iterates through all changes necessary before calling setAttrs
  const accessSheet = async function(event){
    const [repeats,sections] = await _getSections(repeating_section_details);
    const attributes = await _getAttrs([...baseGet,...repeats]);
    const setObj = {};
    if(/repeating_powers/.test(event.sourceAttribute)){
      updateMasterRow(event.sourceAttribute,setObj,sections,attributes);
    }
    const casc = expandCascade(cascades,sections,attributes);
    let trigger = casc[event.sourceAttribute];
    let queue = trigger ? [...trigger.affects] : [];
    while(queue.length){
      let name = queue.shift();
      let obj = casc[name];
      setObj[name] = obj.calculation(obj,attributes,sections);
      attributes[name] = setObj[name];
      queue = [...queue,...obj.affects];
    }
    set(setObj);
  };
  const repeating_section_details = [
    /*TEMPLATE
    {
      section:'string',
      fields:['string','string']
    },
    */
    {
      section:'repeating_powers',
      fields:['label','descriptor','cost','activated','dynpool','rank_total','rank','rankBonus','rankCost','action','range','duration','action','damage','aoe','defense','check','description','element_type','master_row','attack_fx','combat','attack_rank','attack_mod','damage','check','crit', 'afflictions_1']
    },
    {
      section:'repeating_movement',
      fields:['speedtype','speedrank', 'speedhour', 'speedround']
    },
    {
      section:'repeating_equipment',
      fields:['label','descriptor','cost','activated','dynpool','rank_total','rank','rankBonus','rankCost','action','range','duration','action','damage','aoe','defense','check','description','element_type','master_row','attack_fx','combat','attack_rank','attack_mod','damage','check','crit', 'afflictions_1']
    },
    {
      section:'repeating_vehicles',
      fields:['label','descriptor','cost','activated','dynpool','rank_total','rank','rankBonus','rankCost','action','range','duration','action','damage','aoe','defense','check','description','element_type','master_row','attack_fx','combat','attack_rank','attack_mod','damage','check','crit', 'afflictions_1']
    },
    {
      section:'repeating_headquarters',
      fields:['label','descriptor','cost','activated','dynpool','rank_total','rank','rankBonus','rankCost','action','range','duration','action','damage','aoe','defense','check','description','element_type','master_row','attack_fx','combat','attack_rank','attack_mod','damage','check','crit', 'afflictions_1']
    },
    {
      section:'repeating_closecombat',
      fields:['specialty','specialty_rank','specialty_mod']
    },
    {
      section:'repeating_expertise',
      fields:['expertise_name','expertise', 'attribute', 'expertise_rank','expertise_mod','expertise_misc']
    },
    {
      section:'repeating_rangedcombat',
      fields:['specialty','specialty_rank','specialty_mod']
    },
    {
      section:'repeating_attacks',
      fields:['attack_name','attack_combat','attack_rank','attack_mod','attack-damage_type','attack_damage','attack_crit', 'dc', 'aoe', 'afflictions_1', 'range', 'rank_total']
    },
    {
      section:'repeating_advantages',
      fields:['rank']
    }
  ];
  const cascades = {
    /*template
    attribute_name:{
      name:'attribute_name',
      defaultValue:'string or number',
      type:'number or text',
      affects:['array','of','attributes','affected']
      calculation:(sattributes)=>;//Calculation for this attribute; optional property
    }
  
    */
    //Point Totals
    powerpoints_ability:{name:'powerpoints_ability',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:abilityPoints},
    powerpoints_defense:{name:'powerpoints_defense',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:defensePoints},
    powerpoints_skill:{name:'powerpoints_skill',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:skillPoints},
    powerpoints_advantage:{name:'powerpoints_advantage',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:advantagePoints},
    powerpoints_power:{name:'powerpoints_power',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:powerPoints},
    powerpoints_equipment:{name:'powerpoints_equipment',defaultValue:0,type:'number',affects:['powerpoints_total'],calculation:equipmentPoints},
    powerpoints_miscellaneous:{name:'powerpoints_miscellaneous',defaultValue:0,type:'number',affects:['powerpoints_total']},
    powerpoints_total:{name:'powerpoints_total',defaultValue:0,type:'number',affects:[],calculation:powerPointTotal},
    
    //Base Stats
    strength:{name:'strength',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','athletics'],calculation:baseStatCalc},
    stamina:{name:'stamina',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','toughness','fortitude'],calculation:baseStatCalc},
    agility:{name:'agility',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','dodge','acrobatics','stealth'],calculation:baseStatCalc},
    dexterity:{name:'dexterity',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','repeating_rangedcombat_$X_attribute','sleightofhand','repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank','repeating_equipment_$X_attack_rank','repeating_vehicles_$X_attack_rank','repeating_headquarters_$X_attack_rank'],calculation:baseStatCalc},
    fighting:{name:'fighting',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','repeating_closecombat_$X_attribute','parry','repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank','repeating_equipment_$X_attack_rank','repeating_vehicles_$X_attack_rank','repeating_headquarters_$X_attack_rank'],calculation:baseStatCalc},
    intellect:{name:'intellect',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','investigation','technology','treatment'],calculation:baseStatCalc},
    awareness:{name:'awareness',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','will','insight','perception'],calculation:baseStatCalc},
    presence:{name:'presence',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','deception','intimidation','persuasion'],calculation:baseStatCalc},
    
    //Base stat rank,mod,and misc
    strength_rank:{name:'strength_rank',defaultValue:0,type:'number',affects:['strength','powerpoints_ability']},
    strength_mod:{name:'strength_mod',defaultValue:0,type:'number',affects:['strength']},
    strength_misc:{name:'strength_misc',defaultValue:0,type:'number',affects:['strength']},
    stamina_rank:{name:'stamina_rank',defaultValue:0,type:'number',affects:['stamina','powerpoints_ability']},
    stamina_mod:{name:'stamina_mod',defaultValue:0,type:'number',affects:['stamina']},
    stamina_misc:{name:'stamina_misc',defaultValue:0,type:'number',affects:['stamina']},
    agility_rank:{name:'agility_rank',defaultValue:0,type:'number',affects:['agility','powerpoints_ability']},
    agility_mod:{name:'agility_mod',defaultValue:0,type:'number',affects:['agility']},
    agility_misc:{name:'agility_misc',defaultValue:0,type:'number',affects:['agility']},
    dexterity_rank:{name:'dexterity_rank',defaultValue:0,type:'number',affects:['dexterity','powerpoints_ability']},
    dexterity_mod:{name:'dexterity_mod',defaultValue:0,type:'number',affects:['dexterity']},
    dexterity_misc:{name:'dexterity_misc',defaultValue:0,type:'number',affects:['dexterity']},
    fighting_rank:{name:'fighting_rank',defaultValue:0,type:'number',affects:['fighting','powerpoints_ability']},
    fighting_mod:{name:'fighting_mod',defaultValue:0,type:'number',affects:['fighting']},
    fighting_misc:{name:'fighting_misc',defaultValue:0,type:'number',affects:['fighting']},
    intellect_rank:{name:'intellect_rank',defaultValue:0,type:'number',affects:['intellect','powerpoints_ability']},
    intellect_mod:{name:'intellect_mod',defaultValue:0,type:'number',affects:['intellect']},
    intellect_misc:{name:'intellect_misc',defaultValue:0,type:'number',affects:['intellect']},
    awareness_rank:{name:'awareness_rank',defaultValue:0,type:'number',affects:['awareness','powerpoints_ability']},
    awareness_mod:{name:'awareness_mod',defaultValue:0,type:'number',affects:['awareness']},
    awareness_misc:{name:'awareness_misc',defaultValue:0,type:'number',affects:['awareness']},
    presence_rank:{name:'presence_rank',defaultValue:0,type:'number',affects:['presence','powerpoints_ability']},
    presence_mod:{name:'presence_mod',defaultValue:0,type:'number',affects:['presence']},
    presence_misc:{name:'presence_misc',defaultValue:0,type:'number',affects:['presence']},

    //Movement Ranks 
    repeating_movement_$X_speedrank:{name:'repeating_movement_$X_speedrank',defaultValue:0,type:'number',affects:['repeating_movement_$X_speedhour','repeating_movement_$X_speedround']},
    repeating_movement_$X_speedtype:{name:'repeating_movement_$X_speedtype',defaultValue:0,type:'number',affects:['repeating_movement_$X_speedhour','repeating_movement_$X_speedround']},
    repeating_movement_$X_speedhour:{name:'repeating_movement_$X_speedhour',defaultValue:0,type:'number',affects:[],calculation:movementcalcHour},
    repeating_movement_$X_speedround:{name:'repeating_movement_$X_speedround',defaultValue:0,type:'number',affects:[],calculation:movementcalcRound},

    //Rank Calculator
    calcrank:{name:'calcrank',defaultValue:0,type:'number',affects:['rank_mass','rank_time','rank_distance','rank_volume','shadowrank']},
    rank_mass:{name:'rank_mass',defaultValue:0,type:'text',affects:[],calculation:calcMass},
    rank_time:{name:'rank_time',defaultValue:0,type:'text',affects:[],calculation:calcTime},
    rank_distance:{name:'rank_distance',defaultValue:0,type:'text',affects:[],calculation:calcDistance},
    rank_volume:{name:'rank_volume',defaultValue:0,type:'text',affects:[],calculation:calcVolume},
    shadowrank:{name:'shadowrank',defaultValue:0,type:'number',affects:[],calculation:calcShadow},
    
    //defenses
    dodge:{name:'dodge',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    parry:{name:'parry',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    fortitude:{name:'fortitude',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    toughness:{name:'toughness',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    will:{name:'will',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    injuries:{name:'will',defaultValue:0,type:'number',affects:['dodge','parry','fortitude','toughness','will']},
    
    //defenses ranks and mod
    dodge_rank:{name:'dodge_rank',defaultValue:0,type:'number',affects:['dodge','powerpoints_defense']},
    dodge_mod:{name:'dodge_mod',defaultValue:0,type:'number',affects:['dodge']},
    dodge_misc:{name:'dodge_misc',defaultValue:0,type:'number',affects:['dodge']},
    parry_rank:{name:'parry_rank',defaultValue:0,type:'number',affects:['parry','powerpoints_defense']},
    parry_mod:{name:'parry_mod',defaultValue:0,type:'number',affects:['parry']},
    parry_misc:{name:'parry_misc',defaultValue:0,type:'number',affects:['parry']},
    fortitude_rank:{name:'fortitude_rank',defaultValue:0,type:'number',affects:['fortitude','powerpoints_defense']},
    fortitude_mod:{name:'fortitude_mod',defaultValue:0,type:'number',affects:['fortitude']},
    fortitude_misc:{name:'fortitude_misc',defaultValue:0,type:'number',affects:['fortitude']},
    toughness_rank:{name:'toughness_rank',defaultValue:0,type:'number',affects:['toughness','powerpoints_defense']},
    toughness_mod:{name:'toughness_mod',defaultValue:0,type:'number',affects:['toughness']},
    toughness_misc:{name:'toughness_misc',defaultValue:0,type:'number',affects:['toughness']},
    will_rank:{name:'will_rank',defaultValue:0,type:'number',affects:['will','powerpoints_defense']},
    will_mod:{name:'will_mod',defaultValue:0,type:'number',affects:['will']},
    will_misc:{name:'will_misc',defaultValue:0,type:'number',affects:['will']},
    
    //Skills
    acrobatics:{name:'acrobatics',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    athletics:{name:'athletics',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    deception:{name:'deception',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    insight:{name:'insight',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    intimidation:{name:'intimidation',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    investigation:{name:'investigation',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    perception:{name:'perception',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    persuasion:{name:'persuasion',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    sleightofhand:{name:'sleightofhand',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    stealth:{name:'stealth',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    technology:{name:'technology',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    treatment:{name:'treatment',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    vehicles:{name:'vehicles',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    
    //skill ranks
    acrobatics_rank:{name:'acrobatics_rank',defaultValue:0,type:'number',affects:['acrobatics','powerpoints_skill']},
    athletics_rank:{name:'athletics_rank',defaultValue:0,type:'number',affects:['athletics','powerpoints_skill']},
    deception_rank:{name:'deception_rank',defaultValue:0,type:'number',affects:['deception','powerpoints_skill']},
    insight_rank:{name:'insight_rank',defaultValue:0,type:'number',affects:['insight','powerpoints_skill']},
    intimidation_rank:{name:'intimidation_rank',defaultValue:0,type:'number',affects:['intimidation','powerpoints_skill']},
    investigation_rank:{name:'investigation_rank',defaultValue:0,type:'number',affects:['investigation','powerpoints_skill']},
    perception_rank:{name:'perception_rank',defaultValue:0,type:'number',affects:['perception','powerpoints_skill']},
    persuasion_rank:{name:'persuasion_rank',defaultValue:0,type:'number',affects:['persuasion','powerpoints_skill']},
    sleightofhand_rank:{name:'sleightofhand_rank',defaultValue:0,type:'number',affects:['sleightofhand','powerpoints_skill']},
    stealth_rank:{name:'stealth_rank',defaultValue:0,type:'number',affects:['stealth','powerpoints_skill']},
    technology_rank:{name:'technology_rank',defaultValue:0,type:'number',affects:['technology','powerpoints_skill']},
    treatment_rank:{name:'treatment_rank',defaultValue:0,type:'number',affects:['treatment','powerpoints_skill']},
    vehicles_rank:{name:'vehicles_rank',defaultValue:0,type:'number',affects:['vehicles','powerpoints_skill']},
    
    //skill mod
    acrobatics_mod:{name:'acrobatics_mod',defaultValue:0,type:'number',affects:['acrobatics']},
    athletics_mod:{name:'athletics_mod',defaultValue:0,type:'number',affects:['athletics']},
    deception_mod:{name:'deception_mod',defaultValue:0,type:'number',affects:['deception']},
    insight_mod:{name:'insight_mod',defaultValue:0,type:'number',affects:['insight']},
    intimidation_mod:{name:'intimidation_mod',defaultValue:0,type:'number',affects:['intimidation']},
    investigation_mod:{name:'investigation_mod',defaultValue:0,type:'number',affects:['investigation']},
    perception_mod:{name:'perception_mod',defaultValue:0,type:'number',affects:['perception']},
    persuasion_mod:{name:'persuasion_mod',defaultValue:0,type:'number',affects:['persuasion']},
    sleightofhand_mod:{name:'sleightofhand_mod',defaultValue:0,type:'number',affects:['sleightofhand']},
    stealth_mod:{name:'stealth_mod',defaultValue:0,type:'number',affects:['stealth']},
    technology_mod:{name:'technology_mod',defaultValue:0,type:'number',affects:['technology']},
    treatment_mod:{name:'treatment_mod',defaultValue:0,type:'number',affects:['treatment']},
    vehicles_mod:{name:'vehicles_mod',defaultValue:0,type:'number',affects:['vehicles']},

    //skill misc
    acrobatics_misc:{name:'acrobatics_misc',defaultValue:0,type:'number',affects:['acrobatics']},
    athletics_misc:{name:'athletics_misc',defaultValue:0,type:'number',affects:['athletics']},
    deception_misc:{name:'deception_misc',defaultValue:0,type:'number',affects:['deception']},
    insight_misc:{name:'insight_misc',defaultValue:0,type:'number',affects:['insight']},
    intimidation_misc:{name:'intimidation_misc',defaultValue:0,type:'number',affects:['intimidation']},
    investigation_misc:{name:'investigation_misc',defaultValue:0,type:'number',affects:['investigation']},
    perception_misc:{name:'perception_misc',defaultValue:0,type:'number',affects:['perception']},
    persuasion_misc:{name:'persuasion_misc',defaultValue:0,type:'number',affects:['persuasion']},
    sleightofhand_misc:{name:'sleightofhand_misc',defaultValue:0,type:'number',affects:['sleightofhand']},
    stealth_misc:{name:'stealth_misc',defaultValue:0,type:'number',affects:['stealth']},
    technology_misc:{name:'technology_misc',defaultValue:0,type:'number',affects:['technology']},
    treatment_misc:{name:'treatment_misc',defaultValue:0,type:'number',affects:['treatment']},
    vehicles_misc:{name:'vehicles_misc',defaultValue:0,type:'number',affects:['vehicles']},
  
    //Conditions
    penalty_general:{name:'penalty_general',defaultValue:0,type:'number',affects:[],calculation:totalPenalty},
    disabled:{name:'disabled',defaultValue:0,type:'check',affects:['penalty_general']},
    debilitated:{name:'debilitated',defaultValue:0,type:'check',affects:['penalty_general']},
    impaired:{name:'impaired',defaultValue:0,type:'check',affects:['penalty_general']},
    
    //expertise
    repeating_expertise_$X_expertise:{name:'repeating_expertise_$X_expertise',defaultValue:0,type:'number',affects:[],calculation:derivativeStatCalc},
    repeating_expertise_$X_attribute:{name:'repeating_expertise_$X_expertise_attribute',defaultValue:'@{intellect}',type:'text',affects:['repeating_expertise_$X_expertise']},
    repeating_expertise_$X_expertise_rank:{name:'repeating_expertise_$X_expertise_rank',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise','powerpoints_skill']},
    repeating_expertise_$X_expertise_mod:{name:'repeating_expertise_$X_expertise_mod',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise']},
    repeating_expertise_$X_expertise_misc:{name:'repeating_expertise_$X_expertise_misc',defaultValue:0,type:'number',affects:['repeating_expertise_$X_expertise']},
    
    //closecombat
    repeating_closecombat_$X_specialty_rank:{name:'repeating_closecombat_$X_specialty_rank',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank','powerpoints_skill']},
    repeating_closecombat_$X_specialty_mod:{name:'repeating_closecombat_$X_specialty_mod',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank']},
    repeating_closecombat_$X_specialty_misc:{name:'repeating_closecombat_$X_specialty_misc',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank']},
    repeating_closecombat_$X_attribute:{name:'repeating_closecombat_$X_attribute',defaultValue:0,type:'number',affects:[],calculation:displayAttribute},

    //rangedcombat
    repeating_rangedcombat_$X_specialty_rank:{name:'repeating_rangedcombat_$X_specialty_rank',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank','powerpoints_skill']},
    repeating_rangedcombat_$X_specialty_mod:{name:'repeating_rangedcombat_$X_specialty_mod',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank']},
    repeating_rangedcombat_$X_specialty_misc:{name:'repeating_rangedcombat_$X_specialty_misc',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank','repeating_powers_$X_attack_rank']},
    repeating_rangedcombat_$X_attribute:{name:'repeating_rangedcombat_$X_attribute',defaultValue:0,type:'number',affects:[],calculation:displayAttribute},

    //Advantages
    repeating_advantages_$X_name:{name:'repeating_advantages_$X_name',defaultValue:0,type:'text',affects:['powerpoints_advantage']},
    repeating_advantages_$X_rank:{name:'repeating_advantages_$X_rank',defaultValue:0,type:'number',affects:['powerpoints_advantage']},
  
    //Attacks
    repeating_attacks_$X_attack:{name:'repeating_attacks_$X_attack',defaultValue:0,type:'number',affects:[],calculation:attackTotal},
    repeating_attacks_$X_attack_rank:{name:'repeating_attacks_$X_attack_rank',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack'],calculation:attackRank},
    repeating_attacks_$X_rank_total:{name:'repeating_attacks_$X_rank_total',defaultValue:0,type:'number',affects:['repeating_attacks_$X_dc'],calculation:dcDamage},
    repeating_attacks_$X_attack_mod:{name:'repeating_attacks_$X_attack_mod',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack']},
    repeating_attacks_$X_attack_combat:{name:'repeating_attacks_$X_attack_combat',defaultValue:0,type:'number',affects:['repeating_attacks_$X_attack_rank']},
    repeating_attacks_$X_dc:{name:'repeating_attacks_$X_dc',defaultValue:0,type:'number',affects:[],calculation:dcDamage},
    repeating_attacks_$X_aoe:{name:'repeating_attacks_$X_aoe',defaultValue:0,type:'text',affects:['repeating_attacks_$X_dc']},
    repeating_attacks_$X_afflictions_1:{name:'repeating_attacks_$X_afflictions_1',defaultValue:0,type:'text',affects:['repeating_attacks_$X_dc']},

    //Powers
  /*
    repeating_powers_$X_rankcost:{name:'repeating_powers_$X_rankcost',defaultValue:0,type:'number',affects:['repeating_powers_$X_cost']},
  */
    repeating_powers_$X_rank_total:{name:'repeating_powers_$X_rank_total',defaultValue:0,type:'number',affects:['repeating_powers_$X_dc'],calculation:rankcalc},
    repeating_powers_$X_rank:{name:'repeating_powers_$X_rank',defaultValue:0,type:'number',affects:['repeating_powers_$X_rank_total']},
    repeating_powers_$X_rankbonus:{name:'repeating_powers_$X_rankbonus',defaultValue:0,type:'number',affects:['repeating_powers_$$X_rank_total']},
    repeating_powers_$X_attack_rank:{name:'repeating_powers_$X_attack_rank',defaultValue:0,type:'number',affects:['repeating_powers_$X_attack'],calculation:attackRank},
    repeating_powers_$X_attack_mod:{name:'repeating_powers_$X_attack_mod',defaultValue:0,type:'number',affects:['repeating_powers_$X_attack', 'repeating_powers_$X_attack_rank']},
    repeating_powers_$X_combat:{name:'repeating_powers_$X_combat',defaultValue:0,type:'number',affects:['repeating_powers_$X_attack_rank']},
    repeating_powers_$X_attack:{name:'repeating_powers_$X_attack',defaultValue:0,type:'number',affects:[],calculation:attackTotal},
    repeating_powers_$X_dc:{name:'repeating_powers_$X_dc',defaultValue:0,type:'number',affects:[],calculation:dcDamage},
    repeating_powers_$X_cost:{name:'repeating_powers_$X_cost',defaultValue:0,type:'number',affects:['powerpoints_power']/*,calculation:powerCost*/},
    repeating_powers_$X_aoe:{name:'repeating_powers_$X_aoe',defaultValue:0,type:'text',affects:['repeating_powers_$X_dc']},
    repeating_powers_$X_afflictions_1:{name:'repeating_powers_$X_afflictions_1',defaultValue:0,type:'text',affects:['repeating_powers_$X_dc']},

    //Equipment
    repeating_equipment_$X_rank_total:{name:'repeating_equipment_$X_rank_total',defaultValue:0,type:'number',affects:['repeating_equipment_$X_dc'],calculation:rankcalc},
    repeating_equipment_$X_rank:{name:'repeating_equipment_$X_rank',defaultValue:0,type:'number',affects:['repeating_equipment_$X_rank_total']},
    repeating_equipment_$X_rankbonus:{name:'repeating_equipment_$X_rankbonus',defaultValue:0,type:'number',affects:['repeating_equipment_$$X_rank_total']},
    repeating_equipment_$X_attack_rank:{name:'repeating_equipment_$X_attack_rank',defaultValue:0,type:'number',affects:['repeating_equipment_$X_attack'],calculation:attackRank},
    repeating_equipment_$X_attack_mod:{name:'repeating_equipment_$X_attack_mod',defaultValue:0,type:'number',affects:['repeating_equipment_$X_attack', 'repeating_equipment_$X_attack_rank']},
    repeating_equipment_$X_combat:{name:'repeating_equipment_$X_combat',defaultValue:0,type:'number',affects:['repeating_equipment_$X_attack_rank']},
    repeating_equipment_$X_attack:{name:'repeating_equipment_$X_attack',defaultValue:0,type:'number',affects:[],calculation:attackTotal},
    repeating_equipment_$X_dc:{name:'repeating_equipment_$X_dc',defaultValue:0,type:'number',affects:[],calculation:dcDamage},
    repeating_equipment_$X_cost:{name:'repeating_equipment_$X_cost',defaultValue:0,type:'number',affects:['powerpoints_equipment']/*,calculation:powerCost*/},
    repeating_equipment_$X_aoe:{name:'repeating_equipment_$X_aoe',defaultValue:0,type:'text',affects:['repeating_equipment_$X_dc']},
    repeating_equipment_$X_afflictions_1:{name:'repeating_equipment_$X_afflictions_1',defaultValue:0,type:'text',affects:['repeating_equipment_$X_dc']},
  
    //Vehicles
    repeating_vehicles_$X_rank_total:{name:'repeating_vehicles_$X_rank_total',defaultValue:0,type:'number',affects:['repeating_vehicles_$X_dc'],calculation:rankcalc},
    repeating_vehicles_$X_rank:{name:'repeating_vehicles_$X_rank',defaultValue:0,type:'number',affects:['repeating_vehicles_$X_rank_total']},
    repeating_vehicles_$X_rankbonus:{name:'repeating_vehicles_$X_rankbonus',defaultValue:0,type:'number',affects:['repeating_vehicles_$$X_rank_total']},
    repeating_vehicles_$X_attack_rank:{name:'repeating_vehicles_$X_attack_rank',defaultValue:0,type:'number',affects:['repeating_vehicles_$X_attack'],calculation:attackRank},
    repeating_vehicles_$X_attack_mod:{name:'repeating_vehicles_$X_attack_mod',defaultValue:0,type:'number',affects:['repeating_vehicles_$X_attack', 'repeating_vehicles_$X_attack_rank']},
    repeating_vehicles_$X_combat:{name:'repeating_vehicles_$X_combat',defaultValue:0,type:'number',affects:['repeating_vehicles_$X_attack_rank']},
    repeating_vehicles_$X_attack:{name:'repeating_vehicles_$X_attack',defaultValue:0,type:'number',affects:[],calculation:attackTotal},
    repeating_vehicles_$X_dc:{name:'repeating_vehicles_$X_dc',defaultValue:0,type:'number',affects:[],calculation:dcDamage},
    repeating_vehicles_$X_cost:{name:'repeating_vehicles_$X_cost',defaultValue:0,type:'number',affects:['powerpoints_equipment']/*,calculation:powerCost*/},
    repeating_vehicles_$X_aoe:{name:'repeating_vehicles_$X_aoe',defaultValue:0,type:'text',affects:['repeating_vehicles_$X_dc']},
    repeating_vehicles_$X_afflictions_1:{name:'repeating_vehicles_$X_afflictions_1',defaultValue:0,type:'text',affects:['repeating_vehicles_$X_dc']},
  
    //Headquarters
    repeating_headquarters_$X_rank_total:{name:'repeating_headquarters_$X_rank_total',defaultValue:0,type:'number',affects:['repeating_headquarters_$X_dc'],calculation:rankcalc},
    repeating_headquarters_$X_rank:{name:'repeating_headquarters_$X_rank',defaultValue:0,type:'number',affects:['repeating_headquarters_$X_rank_total']},
    repeating_headquarters_$X_rankbonus:{name:'repeating_headquarters_$X_rankbonus',defaultValue:0,type:'number',affects:['repeating_headquarters_$$X_rank_total']},
    repeating_headquarters_$X_attack_rank:{name:'repeating_headquarters_$X_attack_rank',defaultValue:0,type:'number',affects:['repeating_headquarters_$X_attack'],calculation:attackRank},
    repeating_headquarters_$X_attack_mod:{name:'repeating_headquarters_$X_attack_mod',defaultValue:0,type:'number',affects:['repeating_headquarters_$X_attack', 'repeating_headquarters_$X_attack_rank']},
    repeating_headquarters_$X_combat:{name:'repeating_headquarters_$X_combat',defaultValue:0,type:'number',affects:['repeating_headquarters_$X_attack_rank']},
    repeating_headquarters_$X_attack:{name:'repeating_headquarters_$X_attack',defaultValue:0,type:'number',affects:[],calculation:attackTotal},
    repeating_headquarters_$X_dc:{name:'repeating_headquarters_$X_dc',defaultValue:0,type:'number',affects:[],calculation:dcDamage},
    repeating_headquarters_$X_cost:{name:'repeating_headquarters_$X_cost',defaultValue:0,type:'number',affects:['powerpoints_equipment']/*,calculation:powerCost*/},
    repeating_headquarters_$X_aoe:{name:'repeating_headquarters_$X_aoe',defaultValue:0,type:'text',affects:['repeating_headquarters_$X_dc']},
    repeating_headquarters_$X_afflictions_1:{name:'repeating_headquarters_$X_afflictions_1',defaultValue:0,type:'text',affects:['repeating_headquarters_$X_dc']},
  };
  const toMonitor = Object.keys(cascades).reduce((m,k)=>{
    if(!/repeating/.test(k)){
      m.push(k);
    }
    return m;
  },[]);
  const baseGet = [...toMonitor,'sheet_version'];
  repeating_section_details.forEach((obj)=>toMonitor.push(obj.section));
  const abbrvTranslator = {
    str:'strength',
    sta:'stamina',
    agi:'agility',
    dex:'dexterity',
    fgt:'fighting',
    int:'intellect',
    awe:'awareness',
    pre:'presence',
    strength:'str',
    stamina:'sta',
    agility:'agi',
    dexterity:'dex',
    fighting:'fgt',
    intellect:'int',
    awareness:'awe',
    presence:'pre',
  };
  const importHeroLab = async function(event){
    const attributes = await _getAttrs(['statblock']);
    const setObj = {};
    const powerNames = [];
    //try{
      let statblock = JSON.parse(attributes.statblock).document.public.character;
      if(Array.isArray(statblock)){
        statblock = statblock[0];
      }
      await clearSections();
      if(statblock.minions){
        let minions = !Array.isArray(statblock.minions.character) ? [{...statblock.minions.character}] : [...statblock.minions.character];
        parseMinions(minions,setObj,powerNames);
      }
      initialParse(statblock,setObj);
      Object.keys(parsers).forEach((parser)=>{
        if(statblock[parser]){
          let arrRef = Object.keys(statblock[parser])[0];
          if(statblock[parser][arrRef]){
            if(!Array.isArray(statblock[parser][arrRef])){
              statblock[parser][arrRef] = [statblock[parser][arrRef]];
            }
            parsers[parser](statblock[parser][arrRef],setObj,powerNames);
          }
        }
      });
      set(setObj);
    /*}catch(err){
      //Maybe add chat output to this effect as well.
      debug({'Invalid Statblock':err});
    }*/
  };

  //Clears the sheet to prepare it for the imported character
  //When first invoked, queue is defaulted to a clone of repeating_section_details.
  const clearSections = async function(queue=[{section:'repeating_complication'},...repeating_section_details]){
    let sectionDetails = queue.shift();
    let IDs = await _getSectionIDs(sectionDetails.section);
    IDs.forEach((id)=>removeRepeatingRow(`${sectionDetails.section}_${id}`));
    if(queue.length){
      return clearSections(queue);
    }else{
      return;
    }
  };
  /*
    Individual Parser Functions
  */
  const initialParse = function(statblock,setObj){
    setObj.character_name = statblock._name;
    setObj.powerlevel = statblock.powerlevel._value;
    setObj.powerpoints_total = statblock.powerpoints._value;
    setObj.initiative = value(statblock.initiative._total.replace(/[^\d\-]/g,''));
    if(statblock._role!=='pc'){
      setObj.op_npc = 'on';
      setObj.op_gmroll = '/w gm';
    }
    let powerpointSwitch = {
      Abilities:'ability',
      Powers:'power',
      Advantages:'advantage',
      Skills:'skill',
      Defenses:'defense',
    }
    statblock.resources.resource.forEach((obj)=>{
      setObj[`powerpoints_${powerpointSwitch[obj._name]}`] = obj._spent;
    });
  };
  const parseAttributes = function(statArr,setObj){
    statArr.forEach((obj)=>{
      let name = obj._name.toLowerCase();
      setObj[`${name}_rank`] = value(obj._base);
      setObj[`${name}_mod`] = value(obj._modified) - value(obj._base);
      setObj[name]=value(obj._modified);
    });
  };
  const parseDefenses = function(statArr,setObj){
    statArr.forEach((obj)=>{
      let name = obj._name.toLowerCase();
      setObj[`${name}_rank`] = value(obj.cost._value);
      setObj[`${name}_mod`] = value(obj._modified) - value(obj._base);
      setObj[name]=value(obj._modified);
    });
  };
  const parseSkills = function(statArr,setObj){
    statArr.forEach((obj)=>{
      let name = obj._name;
      if(/(?:close|ranged) combat/i.test(name)){
        parseCombatSkill(name,obj,setObj);
      }else if(/expertise/i.test(name)){
        parseExpertise(name,obj,setObj)
      }else{
        setObj[`${name}_rank`] = value(obj.cost._value)*2;
        setObj[`${name}_misc`] = value(obj._value) - (value(obj._base) + value(obj._attrbonus));
        setObj[name]=value(obj._value.replace(/[^\d\-]/g,''));
      }
    });
  };
  const parseCombatSkill = function(name,obj,setObj){
    name = name.replace(/((?:close|ranged) combat):\s*(.+)/i,(match,section,specific)=>{
      let rowID = generateRowID();
      section = section.replace(/\s+/,'').toLowerCase();
      name = `repeating_${section}_${rowID}_specialty`;
      setObj[name] = specific;
      setObj[`${name}_rank`] = value(obj.cost._value)*2;
      setObj[`${name}_mod`] = value(obj._value) - (value(obj._base) + value(obj._attrbonus));
      setObj[`${name}_total`]=value(obj._value.replace(/[^\d\-]/g,''));
    });
  };
  const parseExpertise = function(name,obj,setObj){
    name = name.replace(/expertise\s*(?:\((.+?)\))?:\s*(.+)/i,(match,attr,specific)=>{
      let rowID = generateRowID();
      name = `repeating_expertise_${rowID}_expertise`;
      setObj[`repeating_expertise_${rowID}_attribute`] = attr ? `@{${abbrvTranslator[attr.toLowerCase()]}}` : '@{intellect}';
      setObj[`${name}_name`]=specific;
      setObj[`${name}_rank`] = value(obj.cost._value)*2;
      setObj[`${name}_misc`] = value(obj._value) - (value(obj._base) + value(obj._attrbonus));
      setObj[name]=value(obj._value.replace(/[^\d\-]/g,''));
    });
  };
  const parseComplications = function(statArr,setObj){
    statArr.forEach((obj)=>{
      let rowID = generateRowID();
      setObj[`repeating_complication_${rowID}_complication-name`] = stripOrderInfo(obj._name);
      setObj[`repeating_complication_${rowID}_description`] = obj.description;
    });
  };
  const parseAdvantages = function(statArr,setObj){
    statArr.forEach((obj)=>{
      let row = `repeating_advantages_${generateRowID()}`;
      setObj[`${row}_desc`] = obj.description;
      setObj[`${row}_name`] = obj._name;
      setObj[`${row}_rank`] = obj.cost._value;
    });
  };
  //
  const parsePowers = function(statArr,setObj,powerNames){
    statArr.forEach((obj)=>{
      parsePower('powers',obj,setObj,powerNames);
    });
  };
  const parsePower = function(type,obj,setObj,powerNames){
    let rowID = generateRowID();
    let row = `repeating_${type}_${rowID}`;
    parseBasicPowerInfo(row,obj,setObj);
    setObj[`${row}_element_type`] = 'power';
    addExtras(rowID,type,obj,setObj);
    if(obj.otherpowers && obj.otherpowers.power.length){
      parseGeneralPowers(rowID,'gen_power',type,obj.otherpowers.power,setObj,powerNames);
    }
    if(obj.alternatepowers && obj.alternatepowers.power.length){
      parseGeneralPowers(rowID,'alt_power',type,obj.alternatepowers.power,setObj,powerNames);
    }
  };
  const parseGeneralPowers = function(masterID,powerType,type,queue,setObj,powerNames){
    queue.forEach((obj)=>parseGeneralPower(masterID,powerType,type,obj,setObj,powerNames));
  };
  const parseGeneralPower = function(masterID,powerType,type,obj,setObj,powerNames){
    let rowID = generateRowID();
    let row = `repeating_${type}_${rowID}`;
    parseBasicPowerInfo(row,obj,setObj);
    if(/DC\s*\d+/.test(obj._summary)){
      parseAttackPower(row,powerType,type,obj,setObj,powerNames);
    }else{
      setObj[`${row}_element_type`] = powerType;
    }
    setObj[`${row}_master_row`] = masterID;
    addExtras(masterID,type,obj,setObj);
    if(obj.otherpowers && obj.otherpowers.power.length){
      parseEffects(masterID,type,obj.otherpowers.power,setObj);
    }
    if(obj.alternatepowers && obj.alternatepowers.power.length){
      parseGeneralPowers(masterID,'alt_power',type,obj.alternatepowers.power,setObj,powerNames);
    }
  };
  const isAOE = string => /[^\s]Area[\s$]/.test(string) ? 'AOE' : 0;
  const isAffliction = string => /Affliction\s+\d+/.test(string);
  const parseAttackPower = function(row,powerType,type,obj,setObj,powerNames){
    switch(powerType){
      case 'alt_power':
        setObj[`${row}_attack_type`] = 'alternative';
        break;
      case 'dyn_power':
        setObj[`${row}_attack_type`] = 'dynamic';
        break;
      default:
        setObj[`${row}_attack_type`] = 'general';
        break;
    }
    setObj[`${row}_element_type`] = 'attack_fx';
    setObj[`${row}_rankcost`] = value(obj.cost._value)/value(obj._ranks);
    setObj[`${row}_rank_total`] = obj._ranks;
    setObj[`${row}_descriptor`] = obj.descriptors;
    setObj[`${row}_range`] = obj._range;
    setObj[`${row}_aoe`] = isAOE(obj._summary);
    powerNames.push({name:setObj[`${row}_label`],row});
    if(isAffliction(obj._name)){
      parseAffliction(row,type,obj,setObj);
    }else{
      obj._summary.replace(/resisted by: (dodge|parry|fortitude|toughness|will)/,(match,type)=>{
        setObj[`${row}_defense`] = type;
      });
    }
  };
  const parseAffliction = function(row,type,obj,setObj){
    if(!obj.elements || !obj.elements.element) return;
    let usedDegrees = [];
    affects = false;
    obj.elements.element.forEach((element)=>{
      element._name.replace(/(?:([1-3])(?:st|rd|nd)\sdegree|(Resisted) by|(Affects)): (.+)/,(match,degree,resist,affect,effect)=>{
        let suffix = degree ? degree : resist ? 'type' : undefined;
        if(degree){
          suffix = degree;
          usedDegrees.push(suffix);
        }else if(resist){
          suffix = 'type';
        }else{
          affects = element;
        }
        if(suffix){
          setObj[`${row}_afflictions_${suffix}`] = effect;
        }
      });
    });
    if(affects){
      let special = [1,2,3].find(n=>usedDegrees.every(u=>value(u)!==n));
      if(special){
        setObj[`${row}_afflictions_${special}`] = getTranslationByKey('see description');
      }
    }
  };
  const parseEffects = function(masterID,type,queue,setObj){
    queue.forEach((obj)=>{
      let rowID = generateRowID();
      let row = `repeating_${type}_${rowID}`;
      setObj[`${row}_label`] = stripExcessHLInfo(obj._name);
      setObj[`${row}_rankcost`] = value(obj.cost._value)/value(obj._ranks);
      setObj[`${row}_rank_total`] = obj._ranks;
      setObj[`${row}_descriptor`] = obj.descriptors;
      setObj[`${row}_element_type`] =  'general_fx';
      setObj[`${row}_master_row`] = masterID;
      setObj[`${row}_range`] = obj._range;
      addExtras(masterID,type,obj,setObj);
    });
  };
  const addExtras = function(masterID,type,obj,setObj){
    let extraTypes = ['extra','option','flaw'];
    if(!isAffliction(obj._name)){
      extraTypes.push('element');
    }
    if(extraTypes.some(type=>obj[`${type}s`])){
      let queue = [];
      extraTypes.forEach((type)=>{
        if(obj[`${type}s`]){
          let typeArr = !Array.isArray(obj[`${type}s`][type]) ? [obj[`${type}s`][type]] : obj[`${type}s`][type];
          queue = [...queue,...typeArr];
        }
      });
      queue.forEach((extraObj)=>{
        let rowID = generateRowID();
        let row = `repeating_${type}_${rowID}`;
        setObj[`${row}_master_row`] = masterID;
        setObj[`${row}_element_type`] = 'text';
        setObj[`${row}_label`] = stripExcessHLInfo(extraObj._name);
        setObj[`${row}_description`] = extraObj._info || extraObj.description || '';
      });
    }else{
      setObj[`repeating_${type}_${masterID}_description`] = obj._summary;
    }
  };
  const parseBasicPowerInfo = function(row,obj,setObj){
    let name = stripExcessHLInfo(obj._name);
    setObj[`${row}_label`] = name;
    setObj[`${row}_cost`] = obj.cost._text !== 'free!' ? obj.cost._value : 0;
    setObj[`${row}_descriptor`] = obj.descriptors;
  };
  const parseGear = function(statArr,setObj,powerNames){
    statArr.forEach((obj)=>{
      if(!/^dropped to ground|grab|throw|unarmed/i.test(obj._name) && !/^this item allows you to add a/i.test(obj.description)){
        parsePower('equipment',obj,setObj,powerNames);
      }
    });
  };
  const parseAttacks = function(statArr,setObj,powerNames){
    statArr.forEach((obj)=>{
      let attackName = stripExcessHLInfo(obj._name);
      let type = 'attacks';
      let row = (powerNames.find((arr)=>{
        if(arr.name === attackName){
          type='powers';
          return true;
        }else return false;
      })||{row:`repeating_attacks_${generateRowID()}`}).row;
      parseAttack(type,row,obj,setObj);
    });
  };
  const parseAttack = function(type,row,obj,setObj){
    if(type==='attacks'){
      setObj[`${row}_attack_name`] = stripExcessHLInfo(obj._name);
      setObj[`${row}_attack_damage_type`] = obj._descriptor || '';
      setObj[`${row}_attack_crit`] = obj._crit;
    }else{
      setObj[`${row}_crit`] = obj._crit;
    }
    setObj[`${row}_dc`] = obj._dc||10;
  }
  const parseMinions = function(statArr,setObj,powerNames){
    statArr.forEach((obj)=>{
      let type;
      if(/headquarter/.test(obj._nature)){
        parseMinion('headquarters',obj,setObj,powerNames);
      }else if(/vehicle/.test(obj._nature)){
        parseMinion('vehicles',obj,setObj,powerNames);
      }
    });
  };
  const parseMinion = function(type,obj,setObj,powerNames){
    let rowID = generateRowID();
    let row = `repeating_${type}_${rowID}`;
    setObj[`${row}_label`] = obj._name;
    setObj[`${row}_element_type`] = 'vehicle';
    setObj[`${row}_size`] = (obj.size._name||'').toLowerCase();
    setObj[`${row}_cost`] = obj.powerpoints._value||'';
    if(obj.powers){
      if(obj.powers.power){
        if(!Array.isArray(obj.powers.power)){
          obj.powers.power = [obj.powers.power];
        }
        obj.powers.power.forEach((obj)=>parseGeneralPower(rowID,'gen_power',type,obj,setObj,powerNames));
      }
    }
  };
  const stripOrderInfo = function(string){
    return string.replace(/^[\dA-z]+\.\s*/,'');
  };
  const stripExcessHLInfo = function(string){
     return stripOrderInfo(string).replace(/:[^:]+$/,'');
  };
  //Stores the parsing function references to be iterated through by importHeroLab
  const parsers = {
    attributes:(statArray,obj)=>parseAttributes(statArray,obj),
    defenses:(statArray,obj)=>parseDefenses(statArray,obj),
    skills:(statArray,obj)=>parseSkills(statArray,obj),
    complications:(statArray,obj)=>parseComplications(statArray,obj),
    advantages:(statArray,obj)=>parseAdvantages(statArray,obj),
    powers:(statArray,obj,powerNames)=>parsePowers(statArray,obj,powerNames),
    gear:(statArray,obj,powerNames)=>parseGear(statArray,obj,powerNames),
    attacks:(statArray,obj,powerNames)=>parseAttacks(statArray,obj,powerNames)
  };
  //Stores all the event listeners
  const registerEventHandlers = function(){
    on('sheet:opened',updateSheet);
    toMonitor.forEach((m)=>{
      on(`change:${m}`,accessSheet);
    });
    on('clicked:import',importHeroLab);
  };
  registerEventHandlers();
  log(`Sheet Loaded`);
  
</script>




