<!-- 1.1 -->
<input type="radio" name="attr_sheet_page" value="1" class="sheet-tab sheet-tab1" checked>
<span class="sheet-tab sheet-tab1">Info</span>
<input type="radio" name="attr_sheet_page" value="2" class="sheet-tab sheet-tab2">
<span class="sheet-tab sheet-tab2">Doti & Maestrie</span>
<input type="radio" name="attr_sheet_page" value="3" class="sheet-tab sheet-tab3">
<span class="sheet-tab sheet-tab3">Combattimento armatura & Lesioni</span>
<input type="radio" name="attr_sheet_page" value="4" class="sheet-tab sheet-tab4">
<span class="sheet-tab sheet-tab4">Inventario</span>
<input type="radio" name="attr_sheet_page" value="5" class="sheet-tab sheet-tab5">
<span class="sheet-tab sheet-tab5">Mutazioni & Impianti</span>
<!-- Pagina 1 -->
<div class="sheet-page1">
  <main>
    <main class="main-page1">
      <section class="header f-center">
        <h1>Nameless Land</h1>
        <span>Scheda del sopravvisuto</span>
      </section>

      <section class="common f-col">
        <label>Nome: <input name="attr_character_name" type="text"></label>
        <label>Origine: <input name="attr_origine_class" list="origine" type="text"></label>
        <div class="f-row">
        <label>Ordine: <input name="attr_ordine" list="ordine" type="text"> </label>
        <label>Religione: <input name="attr_religione" list="religione" type="text"></label>
        </div>
        <div class="f-row">
        <label>Debolezza: <input name="attr_debolezza" list="debolezza" type="text"></label>
        <label>Razza: <input name="attr_race" type="text"></label>
        </div>
        <label>Strategia <input name="attr_pro_x3" name="attr_cac" readonly></span></label>
        <button type="roll" name="roll_strat"
          value="&{template:rolls} {{title=Strategia}} {{subtitle=@{character_name} }} {{roll= [[d10 + @{pro_x3} &{tracker}]]}}">
          Strategia </button>
        <div class="f-row nowrap" style="margin: 5px 0; gap: 10px;">
            <label style="width: auto;">Movimento: 
                <input type="number" name="attr_movement" value="4" readonly style="width: 50px; background-color: #e6e6e6; border: 1px solid #999;">
            </label>
            <label style="width: auto;">Bonus: 
                <input type="number" name="attr_movement_bonus" value="0" style="width: 50px; border: 1px solid #ccc;">
            </label>
        </div>
        <div class="encumbrance-box">
          <input type="hidden" name="attr_encumbrance_state" value="0">
          <input type="text" name="attr_encumbrance_text" value="Imposta Max" class="encumbrance-indicator"  readonly>
        </div>
        <div class="f-row wrap" style="background: rgba(255,255,255,0.5); padding: 5px; border-radius: 4px;">
          <label>HP: <input type="number" name="attr_hp" value="20"> / <input type="number" name="attr_hp_max"
            value="-1"></label>
        <label>PS: <input type="number" name="attr_ps" value="20"> / <input type="number" name="attr_ps_max"
            value="-1"></label>
        <label>Punti Crescita: <input type="number" name="attr_pc" value="0"> / <input type="number" name="attr_cp_max"
            value="-1"></label>
        <label>Gruppo Sanguigno: <input name="attr_sangue" type="text"></label>
        <label>Livello: <input name="attr_level" type="number"></label>
        <label>Mod CaC: <input type="number" name="attr_cac" readonly></label>
        <label>Mod CM: <input type="number" name="attr_cm" readonly></label>
</div></section>
        <div class="survival-section">
          <h3>Sopravvivenza</h3>

          <!-- Prima riga - Fame e Sete -->
          <div class="survival-row">
            <div class="survival-group">
              <label>Fame
                <input type="number" name="attr_hunger" value="0" min="0" max="100">
              </label>
            </div>

            <div class="survival-group">
              <label>Sete
                <input type="number" name="attr_thirst" value="0" min="0" max="100">
              </label>
            </div>

            <div class="survival-group">
              <label>Sonno
                <input type="number" name="attr_sleep" value="0" min="0" max="100">
              </label>
            </div>

            <div class="survival-group">
              <label>Recupero PS
                <input type="text" name="attr_survival_recovery" value="6" readonly>
              </label>
            </div>
          </div>

          <!-- Seconda riga - Radiazioni -->
          <div class="survival-row">
            <div class="survival-group">
              <label>Livello Radiazioni
                <input type="number" name="attr_radiation" value="0" min="0" max="100">
              </label>
            </div>

            <div class="survival-group">
              <label>Recupero PF
                <input type="text" name="attr_health_recovery" value="6" readonly>
              </label>
            </div>
          </div>
        </div>
      </section>

      <section class="skill f-col nowrap">
        <h3>Caratteristiche</h3>
        <div class="f-row nowrap">
          <label>Forza</label>
          <input type="number" name="attr_for" value="0">
          Mod Tiro:
          <input type="number" name="attr_for_temp" value="0">
          <input type="number" name="attr_for_mod" value="0">
          <button type="roll" name="roll_for"
            value="&{template:rolls} {{title=Forza}} {{subtitle=@{character_name} }} {{Target=[[@{for}*5+@{level}+@{for_temp}+@{for_mod}]] }} {{roll= [[d100]]}}">
          </button>
        </div>
        <div class="f-row nowrap">
          <label>Prontezza</label>
          <input type="number" name="attr_pro" value="0">
          Mod Tiro:
          <input type="number" name="attr_pro_temp" value="0">
          <input type="number" name="attr_pro_mod" value="0">
          <button type="roll" name="roll_pro"
            value="&{template:rolls} {{title=Prontezza}} {{subtitle=@{character_name} }} {{Target=[[@{pro}*5+@{level}+@{pro_temp}+@{pro_mod}-@{encumbrance_state}*10]]}} {{roll= [[d100]]}}">
          </button>
        </div>
        <div class="f-row nowrap">
          <label>Salute</label>
          <input type="number" name="attr_sal" value="0">
          Mod Tiro:
          <input type="number" name="attr_sal_temp" value="0">
          <input type="number" name="attr_sal_mod" value="0">
          <button type="roll" name="roll_sal"
            value="&{template:rolls} {{title=Salute}} {{subtitle=@{character_name} }} {{Target=[[@{sal}*5+@{level}+@{sal_temp}+@{sal_mod}]] }} {{roll= [[d100]]}}">
          </button>
        </div>
        <div class="f-row nowrap">
          <label>Intelligenza</label>
          <input type="number" name="attr_int" value="0">
          Mod Tiro
          <input type="number" name="attr_int_temp" value="0">
          <input type="number" name="attr_int_mod" value="0">
          <button type="roll" name="roll_int"
            value="&{template:rolls} {{title=Intelligenza}} {{subtitle=@{character_name} }} {{Target=[[@{int}*5+@{level}+@{int_temp}+@{int_mod}]] }} {{roll= [[d100]]}}">
          </button>
        </div>
        <div class="f-row nowrap">
          <label>Percezione</label>
          <input type="number" name="attr_per" value="0">
          Mod Tiro:
          <input type="number" name="attr_per_temp" value="0">
          <input type="number" name="attr_per_mod" value="0">
          <button type="roll" name="roll_per"
            value="&{template:rolls} {{title=Percezione}} {{subtitle=@{character_name} }} {{Target=[[@{per}*5+@{level}+@{per_temp}+@{per_mod}]] }} {{roll= [[d100]]}}">
          </button>
        </div>
      </section>


      <section class="misc f-col nowrap">
        <h3>Abilità</h3>
        <div class="double-column">
          <label>Accademia
            <select name="attr_ability_a">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select>
          </label>

          <label>
            <select name="attr_ability_a_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select>
          </label>
          <label>
            <input type="number" name="attr_ability_a_mod" value="0">
          </label>
          <label>
            <input type="number" name="attr_ability_a_mod_temp" value="0">
          </label>
          <input type="hidden" name="attr_ability_a_target" value="0">

          <button type="roll" name="roll_ability_a"
            value="&{template:rolls} {{title=Accademia}} {{subtitle=@{character_name}}} {{Target=@{ability_a_target}}} {{Risultato=[[d100]]}}">

          </button>
        </div>

        <div class="double-column">
          </divclass><label>Armi a Distanza <select name="attr_ability_b">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_b_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <label><input type="number" name="attr_ability_b_mod" value="0"></label><label><input type="number"
              name="attr_ability_b_mod_temp" value="0"></label>
          <input type="hidden" name="attr_ability_b_target" value="0">
          <button type="roll" name="roll_ability_b"
            value="&{template:rolls} {{title=Armi a distanza}} {{subtitle=@{character_name}}} {{Target=@{ability_b_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Armi Da Fuoco <select name="attr_ability_c">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_c_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <label><input type="number" name="attr_ability_c_mod" value="0"></label><label><input type="number"
              name="attr_ability_c_mod_temp" value="0"></label>
          <input type="hidden" name="attr_ability_c_target" value="0">
          <button type="roll" name="roll_ability_c"
            value="&{template:rolls} {{title=Armi da fuoco}} {{subtitle=@{character_name}}} {{Target=@{ability_c_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Armi Da Lotta <select name="attr_ability_d">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_d_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <label><input type="number" name="attr_ability_d_mod" value="0"></label><label><input type="number"
              name="attr_ability_d_mod_temp" value="0"></label>
          <input type="hidden" name="attr_ability_d_target" value="0">
          <button type="roll" name="roll_ability_d"
            value="&{template:rolls} {{title=Armi da lotta}} {{subtitle=@{character_name}}} {{Target=@{ability_d_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Armi Da Mischia <select name="attr_ability_e">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_e_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <label><input type="number" name="attr_ability_e_mod" value="0"></label><label><input type="number"
              name="attr_ability_e_mod_temp" value="0"></label>
          <input type="hidden" name="attr_ability_e_target" value="0">
          <button type="roll" name="roll_ability_e"
            value="&{template:rolls} {{title=Armi da mischia}} {{subtitle=@{character_name}}} {{Target=@{ability_e_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Atletica <select name="attr_ability_f">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_f_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_f_target" value="0">
          <label><input type="number" name="attr_ability_f_mod" value="0"></label><label><input type="number"
              name="attr_ability_f_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_f"
            value="&{template:rolls} {{title=Atletica}} {{subtitle=@{character_name}}} {{Target=@{ability_f_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Bestialismo<select name="attr_ability_g">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_g_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_g_target" value="0">
          <label><input type="number" name="attr_ability_g_mod" value="0"></label><label><input type="number"
              name="attr_ability_g_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_g"
            value="&{template:rolls} {{title=Bestialismo}} {{subtitle=@{character_name}}} {{Target=@{ability_g_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Fabbricare <select name="attr_ability_h">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_h_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_h_target" value="0">
          <label><input type="number" name="attr_ability_h_mod" value="0"></label><label><input type="number"
              name="attr_ability_h_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_h"
            value="&{template:rolls} {{title=Fabbricare}} {{subtitle=@{character_name}}} {{Target=@{ability_h_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Furtività <select name="attr_ability_i">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_i_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_i_target" value="0">
          <label><input type="number" name="attr_ability_i_mod" value="0"></label><label><input type="number"
              name="attr_ability_i_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_i"
            value="&{template:rolls} {{title=Furtività}} {{subtitle=@{character_name}}} {{Target=@{ability_i_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Geografia <select name="attr_ability_l">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_l_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_l_target" value="0">
          <label><input type="number" name="attr_ability_l_mod" value="0"></label><label><input type="number"
              name="attr_ability_l_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_l"
            value="&{template:rolls} {{title=Geografia}} {{subtitle=@{character_name}}} {{Target=@{ability_l_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Guida <select name="attr_ability_m">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_m_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_n_target" value="0">
          <label><input type="number" name="attr_ability_m_mod" value="0"></label><label><input type="number"
              name="attr_ability_m_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_n"
            value="&{template:rolls} {{title=Guida}} {{subtitle=@{character_name}}} {{Target=@{ability_n_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Imbroglio <select name="attr_ability_o">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_o_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_o_target" value="0">
          <label><input type="number" name="attr_ability_o_mod" value="0"></label><label><input type="number"
              name="attr_ability_o_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_o"
            value="&{template:rolls} {{title=Imbroglio}} {{subtitle=@{character_name}}} {{Target=@{ability_o_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Intuito <select name="attr_ability_n">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_n_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_n_target" value="0">
          <label><input type="number" name="attr_ability_n_mod" value="0"></label><label><input type="number"
              name="attr_ability_n_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_n"
            value="&{template:rolls} {{title=Intuito}} {{subtitle=@{character_name}}} {{Target=@{ability_n_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Manualità <select name="attr_ability_p">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_p_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_p_target" value="0">
          <label><input type="number" name="attr_ability_p_mod" value="0"></label><label><input type="number"
              name="attr_ability_p_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_p"
            value="&{template:rolls} {{title=Manualità}} {{subtitle=@{character_name}}} {{Target=@{ability_p_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Meccanica <select name="attr_ability_q">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_q_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_q_target" value="0">
          <label><input type="number" name="attr_ability_q_mod" value="0"></label><label><input type="number"
              name="attr_ability_q_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_q"
            value="&{template:rolls} {{title=Meccanica}} {{subtitle=@{character_name}}} {{Target=@{ability_q_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Medicina <select name="attr_ability_r">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_r_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_r_target" value="0">
          <label><input type="number" name="attr_ability_r_mod" value="0"></label><label><input type="number"
              name="attr_ability_r_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_r"
            value="&{template:rolls} {{title=Medicina}} {{subtitle=@{character_name}}} {{Target=@{ability_r_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Natura <select name="attr_ability_s">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_s_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_s_target" value="0">
          <label><input type="number" name="attr_ability_s_mod" value="0"></label><label><input type="number"
              name="attr_ability_s_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_s"
            value="&{template:rolls} {{title=Natura}} {{subtitle=@{character_name}}} {{Target=@{ability_s_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Oltremondo <select name="attr_ability_t">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_t_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_t_target" value="0">
          <label><input type="number" name="attr_ability_t_mod" value="0"></label><label><input type="number"
              name="attr_ability_t_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_t"
            value="&{template:rolls} {{title=Oltremondo}} {{subtitle=@{character_name}}} {{Target=@{ability_t_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Persuasione <select name="attr_ability_u">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_u_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_u_target" value="0">
          <label><input type="number" name="attr_ability_u_mod" value="0"></label><label><input type="number"
              name="attr_ability_u_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_u"
            value="&{template:rolls} {{title=Persuasione}} {{subtitle=@{character_name}}} {{Target=@{ability_u_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Riflessi <select name="attr_ability_v">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_v_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_v_target" value="0">
          <label><input type="number" name="attr_ability_v_mod" value="0"></label><label><input type="number"
              name="attr_ability_v_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_v"
            value="&{template:rolls} {{title=Riflessi}} {{subtitle=@{character_name}}} {{Target=@{ability_v_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Rovistare <select name="attr_ability_z">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_z_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_z_target" value="0">
          <label><input type="number" name="attr_ability_z_mod" value="0"></label><label><input type="number"
              name="attr_ability_z_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_z"
            value="&{template:rolls} {{title=Rovistare}} {{subtitle=@{character_name}}} {{Target=@{ability_z_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Scienza Perduta <select name="attr_ability_x">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_x_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_x_target" value="0">
          <label><input type="number" name="attr_ability_x_mod" value="0"></label><label><input type="number"
              name="attr_ability_x_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_x"
            value="&{template:rolls} {{title=Scienza Perduta}} {{subtitle=@{character_name}}} {{Target=@{ability_x_target}}} {{Risultato=[[d100]]}}"></button>
          </label>
        </div>
        <div class="double-column"><label>Sensorialità <select name="attr_ability_y">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_y_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_y_target" value="0">
          <label><input type="number" name="attr_ability_y_mod" value="0"></label><label><input type="number"
              name="attr_ability_y_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_y"
            value="&{template:rolls} {{title=Sensorialità}} {{subtitle=@{character_name}}} {{Target=@{ability_y_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Survialismo <select name="attr_ability_k">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_k_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_k_target" value="0">
          <label><input type="number" name="attr_ability_k_mod" value="0"></label><label><input type="number"
              name="attr_ability_k_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_k"
            value="&{template:rolls} {{title=Survialismo}} {{subtitle=@{character_name}}} {{Target=@{ability_k_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Vigore <select name="attr_ability_j">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_j_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_j_target" value="0">
          <label><input type="number" name="attr_ability_j_mod" value="0"></label><label><input type="number"
              name="attr_ability_j_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_j"
            value="&{template:rolls} {{title=Vigore}} {{subtitle=@{character_name}}} {{Target=@{ability_j_target}}} {{Risultato=[[d100]]}}"></button>
        </div>
        <div class="double-column"><label>Volontà <select name="attr_ability_w">
              <option value="-10">Incapace -10</option>
              <option value="5">Addestrato +5</option>
              <option value="20">Esperto +20</option>
              <option value="35">Specialista +35</option>
              <option value="50">Leggendario +50</option>
            </select></label>
          <label><select name="attr_ability_w_stat">
              <option value="for">Forza</option>
              <option value="pro">Prontezza</option>
              <option value="sal">Salute</option>
              <option value="int">Intelligenza</option>
              <option value="per">Percezione</option>
            </select></label>
          <input type="hidden" name="attr_ability_w_target" value="0">
          <label><input type="number" name="attr_ability_w_mod" value="0"></label><label><input type="number"
              name="attr_ability_w_mod_temp" value="0"></label>
          <button type="roll" name="roll_ability_w"
            value="&{template:rolls} {{title=Volontà}} {{subtitle=@{character_name}}} {{Target=@{ability_w_target}}} {{Risultato=[[d100]]}}"></button>
        </div>

</div>
</section>


<!-- Datalists & thing that don't show directly on sheet -->

<!-- roll template -->

<rolltemplate class="sheet-rolltemplate-rolls">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
      {{#name}}<div class="sheet-name">{{name}}</div>{{/name}}
      {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#allprops() title name subtitle desc}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>
      {{/allprops() title name subtitle desc}}
      {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
    </div>
  </div>
</rolltemplate>

</main>


<!-- Pagina 2 -->
<div class="sheet-page2">
  <main>
    <section class="header f-center">
      <h1>Doti & maestrie</h1>
      <span>Contenuto aggiuntivo</span>
    </section>

    <section class="caselle-verticali">
      <div class="casella">
        <input type="text" name="attr_maestria1" placeholder="Maestria 1">
        <textarea name="attr_maestria1_desc" placeholder="Capacità 1"></textarea>
      </div>
      <div class="casella">
        <input type="text" name="attr_maestria2" placeholder="Maestria 2">
        <textarea name="attr_maestria2_desc" placeholder="Capacità 2"></textarea>
      </div>
      <div class="casella">
        <input type="text" name="attr_maestria3" placeholder="Maestria 3">
        <textarea name="attr_maestria3_desc" placeholder="Capacità 3"></textarea>
      </div>
    </section>

    <h3>Doti</h3>
    <fieldset class="repeating_doti">
      <div class="box">
        <input type="text" name="attr_dote_nome" placeholder="Titolo della dote">
        <textarea name="attr_dote_descrizione" placeholder="Descrizione della dote"></textarea>
      </div>
    </fieldset>

    <footer class="f-col f-center">
      <span>Nameless Lands - Pagina 2</span>
    </footer>
  </main>
</div>

<!-- Pagina 3 -->
<div class="sheet-page3">
  <main>
    <section class="header f-center">
      <h1>Combattimento</h1>
      <span>Stato Fisico & Arsenale</span>
    </section>

    <section class="tactical-body-section">
      <h3>Armatura e Lesioni</h3>
      
      <div class="body-grid">
        
        <div class="body-part head">
          <div class="part-header">TESTA</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_testa"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_testa_les_1"> / <input type="text" name="attr_testa_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_testa_ad_armor"></label>
              <label>Res <input type="text" name="attr_testa_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_testo_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_testo_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part l-arm">
          <div class="part-header">BRACCIO SX</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_BrSx"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_bracciosx_les_1"> / <input type="text" name="attr_bracciosx_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_bracciosx_ad_armor"></label>
              <label>Res <input type="text" name="attr_bracciosx_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_bracciosx_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_bracciosx_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part torso">
          <div class="part-header">TORSO</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_torso"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_torso_les_1"> / <input type="text" name="attr_torso_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_torso_ad_armor"></label>
              <label>Res <input type="text" name="attr_torso_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_torso_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_torso_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part r-arm">
          <div class="part-header">BRACCIO DX</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_BrDx"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_bracciodx_les_1"> / <input type="text" name="attr_bracciodx_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_bracciodx_ad_armor"></label>
              <label>Res <input type="text" name="attr_bracciodx_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_bracciodx_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_bracciodx_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part stomach">
          <div class="part-header">VENTRE</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_ventre"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_ventre_les_1"> / <input type="text" name="attr_ventre_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_ventre_ad_armor"></label>
              <label>Res <input type="text" name="attr_ventre_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_ventre_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_ventre_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part l-leg">
          <div class="part-header">GAMBA SX</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_GaSx"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_gambasx_les_1"> / <input type="text" name="attr_gambasx_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_gambasx_ad_armor"></label>
              <label>Res <input type="text" name="attr_gambasx_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_gambasx_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_gambasx_res_armor_nat"></label>
            </div>
          </div>
        </div>

        <div class="body-part r-leg">
          <div class="part-header">GAMBA DX</div>
          <div class="part-stats">
            <label>Armatura <input type="text" name="attr_arm_GaDx"></label>
            <div class="lesion-box">
              <span>Lesioni</span>
              <div class="slash-group">
                <input type="text" name="attr_gambadx_les_1"> / <input type="text" name="attr_gambadx_les_2">
              </div>
            </div>
            <div class="res-ad-row">
              <label>AD <input type="text" name="attr_gambadx_ad_armor"></label>
              <label>Res <input type="text" name="attr_gambadx_res_armor"></label>
            </div>
            <div class="res-ad-row">
              <label>AD Nat<input type="text" name="attr_gambadx_ad_armor_nat"></label>
              <label>Res Nat<input type="text" name="attr_gambadx_res_armor_nat"></label>
            </div>
          </div>
        </div>

      </div> </section>

    <div class="initiative-bar">
      <button type="roll" name="roll_schivata" class="init-btn"
        value="&{template:rolls} {{title=Schivata!}} {{subtitle=@{character_name}}} {{Target=[[@{ability_v_target}+?{modificatore target:|0}]]}} {{Risultato=[[d100]]}}">
          ⚠ SCHIVATA ⚠
      </button>
      <button type="roll" name="roll_schivata" class="init-btn"
        value="&{template:rolls} {{title=Parata!}} {{subtitle=@{character_name}}}  {{Target=[[@{ability_v_target}+@{shield_size}+?{modificatore target:|0}]]}} {{Risultato=[[d100]]}} {{Res=@{equip_scudo_res}}} {{AD=@{equip_scudo_ad}}}">
          ⚠ PARATA ⚠
      </button>
    </div>

    <section class="arsenal-section">
      <h3>Arsenale</h3>
      <fieldset class="repeating_weapon">
        <div class="weapon-card">
          
          <div class="weapon-header">
            <input type="text" name="attr_nome_arma" placeholder="Nome Arma" class="weapon-name">
            <select name="attr_weapon_type" class="weapon-type-select">
              <option value="roll_ability_b">Distanza</option>
              <option value="roll_ability_c">Fuoco</option>
              <option value="roll_ability_d">Lotta</option>
              <option value="roll_ability_e">Mischia</option>
            </select>
             <select name="attr_weapon_size" class="weapon-size-select">
              <option value="5">Piccola</option>
              <option value="12">Media</option>
              <option value="16">Grande</option>
              <option value="20">M.Grande</option>
            </select>
          </div>

          <div class="weapon-stats-grid">
            <div class="w-stat">
              <label>Danni</label>
              <input type="text" name="attr_attacchi" value="0">
            </div>
            <div class="w-stat">
              <label>Lesioni</label>
              <input type="number" name="attr_lesioni" value="0">
            </div>
            <div class="w-stat">
              <label>Gittata</label>
              <input type="text" name="attr_gittata" value="0">
            </div>
            <div class="w-stat">
              <label>Resistenza</label>
              <input type="number" name="attr_res" value="1">
            </div>
          </div>

          <div class="weapon-secondary-row">
            <label>Munizioni: 
               <input type="number" name="attr_munizioniattuali" placeholder="Att" style="width:40px"> / 
               <input type="number" name="attr_munizionimassime" placeholder="Max" style="width:40px">
            </label>
            <label>Tipo: <input type="text" name="attr_munType" placeholder="Calibro" style="width:60px"></label>
            <label>Bonus Hit: <input type="number" name="attr_bonus_hit" value="0" style="width:50px"></label>
            <label>Bonus Dmg: <input type="number" name="attr_bonus_dmg" value="0" style="width:50px"></label>
          </div>

          <div class="weapon-special">
            <textarea name="attr_speciali" placeholder="Note speciali, effetti..."></textarea>
          </div>

          <div class="weapon-actions">
            <button type="roll" name="roll_attacco" class="attack-btn single"
             value="&{template:rolls} {{name=@{character_name}}} {{subtitle=attacco con @{nome_arma} (@{weapon_type})}} {{target=[[@{ability_weapon_target} + @{pro}*2 -@{encumbrance_state}*10 + @{level} + @{ability_weapon_sizeMod} + @{bonus_hit} +?{modificatore target:|0}+ ?{Hai preso la mira?|no,0|1 round,+5|2 round,+10|3 round,+15|4 round,+20|5 round,+25}+?{colpo mirato?|no,0|si,-30 + @{cm}}]]}} {{attack=[[1d100]]}} {{damage=[[@{attacchi} + @{bonus_dmg} +@{ability_weapon_cac}]]}} {{locazione= [[1d10]]}} {{Lesioni= [[@{lesioni}+@{ability_weapon_lesMod}]]}} {{@{speciali}}}">
              Colpo Singolo
            </button>
             <button type="roll" name="roll_multiattacco" class="attack-btn multi"
              value="&{template:rolls} {{name=@{character_name}}} {{subtitle=Multiattacco @{nome_arma}}} {{target1=[[@{ability_weapon_target} + (@{pro}*2) + @{level} + @{bonus_hit}]]}} {{attack1=[[1d100]]}} {{damage1=[[@{attacchi} + @{bonus_dmg} +@{ability_weapon_cac}]]}} {{locazione 1= [[1d10]]}} {{attack2=[[1d100]]}} {{target2=[[@{ability_b} + (@{pro}*2) + @{level} + @{bonus_hit}-5]]}} {{damage2=[[@{attacchi} + @{bonus_dmg}+@{ability_weapon_cac}]]}} {{locazione 2= [[1d10]]}}">
              Raffica / Multi
            </button>
          </div>

          <input type="hidden" name="attr_ability_weapon_target" value="0">
          <input type="hidden" name="attr_ability_weapon_cac" value="0">
          <input type="hidden" name="attr_ability_weapon_sizeMod" value="0">
          <input type="hidden" name="attr_ability_weapon_lesMod" value="0">

        </div>
      </fieldset>
    </section>

    <footer class="f-col f-center">
      <span>Nameless Land - Combattimento</span>
    </footer>
  </main>
</div>



<!-- Pagina 4 -->
<div class="sheet-page4">
  <main>
    <section class="header f-center">
      <h1>Inventario</h1>
      <span>Equipaggiamento & Carico</span>
    </section>

    <section class="weight-section f-col">
      <div class="weight-summary f-row f-center" style="gap: 15px;">
        <label>Peso Max: 
          <input type="number" name="attr_weight_max" value="0"  style="width: 70px;" readonly>
        </label>
        
        <label>Peso Mod: 
          <input type="number" name="attr_weight_mod" value="0"  >
        </label>

        <label style="color: #a83521;">Indossato: 
          <input type="number" name="attr_weight_worn" value="0"  style="background-color: #eee; width:70px;"  readonly>
        </label>

        <label>Totale: 
          <input type="number" name="attr_weight_total" value="0"  style="background-color: #eee; font-weight:bold; width:70px;"  readonly>
        </label>
        
        <div class="encumbrance-box">
          <input type="hidden" name="attr_encumbrance_state" value="0">
          <input type="text" name="attr_encumbrance_text" value="Imposta Max" class="encumbrance-indicator"  readonly>
        </div>
      </div>
    </section>

    <div class="inventory-split-container">
      
      <section class="armor-equipment-section">
        <h3>Equipaggiamento Indossato</h3>
        <div class="armor-grid">
          
          <div class="armor-slot">
            <div class="slot-label">Testa</div>
            <input type="text" name="attr_equip_testa_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_testa_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Torso</div>
            <input type="text" name="attr_equip_torso_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_torso_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Ventre</div>
            <input type="text" name="attr_equip_ventre_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_ventre_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Braccio Dx</div>
            <input type="text" name="attr_equip_brdx_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_brdx_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Braccio Sx</div>
            <input type="text" name="attr_equip_brsx_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_brsx_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Gamba Dx</div>
            <input type="text" name="attr_equip_gadx_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_gadx_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Gamba Sx</div>
            <input type="text" name="attr_equip_gasx_nome" placeholder="Oggetto">
            <input type="number" name="attr_equip_gasx_peso" placeholder="Kg" step="0.1">
          </div>

          <div class="armor-slot">
            <div class="slot-label">Scudo</div>
            <input type="text" name="attr_equip_scudo_nome" placeholder="Scudo">
            Res:
            <input type="number" name="attr_equip_scudo_res" placeholder="res">
            Ad:
            <input type="number" name="attr_equip_scudo_ad" placeholder="ad">
            Dimensione:
            <select name="attr_shield_size" class="weapon-size-select">
              <option value="0">Piccola</option>
              <option value="10">Media</option>
              <option value="20">Grande</option>
              <option value="30">M.Grande</option>
            </select>
            <input type="number" name="attr_equip_scudo_peso" placeholder="Kg" step="0.1">
          </div>

        </div>
      </section>
      
      <section class="pockets-section">
        <h3>Pronto Uso</h3>
        <div class="pockets-grid">
          
          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_1_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_1_name" placeholder="Oggetto P1">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_2_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_2_name" placeholder="Oggetto P2">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_3_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_3_name" placeholder="Oggetto P3">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_4_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_4_name" placeholder="Oggetto P4">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_5_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_5_name" placeholder="Oggetto P5">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_6_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_6_name" placeholder="Oggetto P6">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_7_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_7_name" placeholder="Oggetto P7">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_8_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_8_name" placeholder="Oggetto P8">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_9_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_9_name" placeholder="Oggetto P9">
          </div>

          <div class="pocket-row">
            <label class="p-switch">
              <input type="checkbox" name="attr_pocket_10_active">
              <span class="p-indicator">P</span>
            </label>
            <input type="text" name="attr_pocket_10_name" placeholder="Oggetto P10">
          </div>

        </div>
      </section>

      <section class="inventory-section f-col">
        <h3>Zaino & Altro</h3>
        <div class="inventory-headers f-row">
          <span style="flex:2">Nome</span>
          <span style="flex:3">Descrizione</span>
          <span style="width: 50px;">Kg</span>
          <span style="width: 30px;"></span>
        </div>
        <fieldset class="repeating_inventory">
          <div class="inventory-row f-row">
            <input type="text" name="attr_item_name" class="item-name">
            <textarea name="attr_item_desc" class="item-desc"></textarea>
            <input type="number" name="attr_item_weight" step="0.1" class="item-weight">
            </div>
        </fieldset>
      </section>
      
    </div>

    <footer class="f-col f-center">
      <span>Nameless Land - Pagina 4</span>
    </footer>
  </main>
</div>

<!-- Pagina 5 -->
<div class="sheet-page5">
  <main>
    <section class="header f-center">
      <h1>Mutazioni Impianti & Razza</h1>
      <span>Non temere il cambiamento</span>
    </section>
    abuso grottesco:
    <input type="number" name="attr_abuso_grottesco">
    <section class="caselle-verticali">
      <h1>Bonus/Malus Razziali</h1>
      <div class="casella">
        <input type="text" name="attr_nome_bonus_r" placeholder="Bonus Razziale">
        <textarea name="attr_descr_bonus_r" placeholder="Descrizione"></textarea>
      </div>
      <div class="casella">
        <input type="text" name="attr_nome_malus_r1" placeholder="Malus Razziale 1">
        <textarea name="attr_descr_malus_r1" placeholder="Descrizione"></textarea>
      </div>
      <div class="casella">
        <input type="text" name="attr_nome_malus_r2" placeholder="Malus Razziale 2">
        <textarea name="attr_descr_malus_r2" placeholder="Descrizione"></textarea>
      </div>
    </section>


    <section class="mutations-section f-col">
      <fieldset class="repeating_mutations">
        <div class="mutation-row f-row">
          <input type="text" name="attr_mutation_name" placeholder="Nome Mutazione/Impianto" class="mutation-name">
          <textarea name="attr_mutation_desc" placeholder="Descrizione ed effetti" class="mutation-desc"></textarea>
        </div>
      </fieldset>
    </section>

    <footer class="f-col f-center">
      <span>Copyright - Pagina 3</span>
    </footer>
  </main>
</div>


<script type="text/worker">
 const abilities = "abcdefghijklmnopqrstuvwxyz".split("");
 

    on("change:pro", () => {
      getAttrs(["pro"], values => {
        const pro = parseInt(values.pro) || 0;
        setAttrs({ pro_x3: pro * 3 });
      });
    });

on("sheet:opened change:per", () => {
  getAttrs(["per"], values => {
    const per = parseInt(values.per) || 0;

    const modMap = {
      1: -20, 2: -20,
      3: -15, 4: -15,
      5: -10, 6: -10,
      7: -5,  8: -5,
      9: 0,   10: 0,
      11: 5,  12: 5,
      13: 10, 14: 10,
      15: 15, 16: 15,
      17: 20, 18: 20,
      19: 25, 20: 25
    };

    const perMirMod = modMap[per] ?? 0; // Default 0 if not found

    setAttrs({ cm: perMirMod });
  });
});


on("sheet:opened change:for", () => {
  getAttrs(["for"], values => {
    const foor = parseInt(values.for) || 0;

    const modMap = {
      1: -4, 2: -4,
      3: -3, 4: -3,
      5: -2, 6: -2,
      7: -1,  8: -1,
      9: 0,   10: 0,
      11: 1,  12: 1,
      13: 2, 14: 2,
      15: 3, 16: 3,
      17: 4, 18: 4,
      19: 5, 20: 5
    };

    const percacMod = modMap[foor] ?? 0; // Default 0 if not found

    setAttrs({ cac: percacMod });
  });
});


    abilities.forEach(letter => {
      on(`sheet:opened change:encumbrance_state change:ability_${letter} change:ability_${letter}_stat change:level change:for change:pro change:sal change:int change:per change:agi change:ability_${letter}_mod change:ability_${letter}_mod_temp `, function() {
        getAttrs([
          `ability_${letter}`,
          `ability_${letter}_stat`,
          "for", "pro", "sal", "int", "per", "agi",
          "level",`ability_${letter}_mod`,`ability_${letter}_mod_temp`,"encumbrance_state"
        ], function(values) {
          const enc=parseInt(values.encumbrance_state);
          const mod =  parseInt(values[`ability_${letter}_mod`]) || 0 ;
          const tempMod = parseInt(values[`ability_${letter}_mod_temp`]) || 0;
          const base = parseInt(values[`ability_${letter}`]) || 0;
          const statKey = values[`ability_${letter}_stat`];
          const statVal = parseInt(values[statKey]) || 0;
          const level = parseInt(values.level) || 0;

          let a=0;
          if(statKey=="pro")
          a=1;

          const total = base + (statVal * 2) + level + mod + tempMod -a*10*enc;
          setAttrs({ [`ability_${letter}_target`]: total });
        });
      });
    });



  on("sheet:opened change:hunger change:thirst change:sleep change:radiation", () => {
    getAttrs(["hunger", "thirst", "radiation","sleep"], function(values) {
      const hunger = parseInt(values.hunger) || 0;
      const thirst = parseInt(values.thirst) || 0;
      const sleep = parseInt(values.sleep) || 0;
      const radiation = parseInt(values.radiation) || 0;
      
      const survivalRecovery =  6 - hunger - thirst -sleep;
      const healthRecovery =  6 - (6 * radiation);
      
      setAttrs({
        "survival_recovery": survivalRecovery,
        "health_recovery": healthRecovery
      });
    });
});
 


const weaponTypes = ['b', 'c', 'd', 'e'];

abilities.forEach(letter => {
    // Definizione degli attributi da osservare
    const observedAttributes = [
        `sheet:opened`,
        `change:repeating_weapon:weapon_size`,
        `change:repeating_weapon:weapon_type`,
        `change:ability_${letter}`,
        `change:ability_${letter}_stat`,
        `change:ability_${letter}_mod`,
        `change:ability_${letter}_mod_temp`,
        `change:level`,
        `change:for`,
        `change:pro`,
        `change:sal`,
        `change:int`,
        `change:per`,
        `change:agi`
    ];

    on(observedAttributes.join(" "), function(eventInfo) {
        const rowId = eventInfo.sourceAttribute.split('_')[2];
        const prefix = `repeating_weapon_${rowId}_`;

        // 1. Recupero il tipo di arma per determinare quale abilità usare
        getAttrs([`${prefix}weapon_type`,`${prefix}weapon_size`, "cac", "for", "pro", "sal", "int", "per", "agi"], values => {
            const weaponType = values[`${prefix}weapon_type`] || "";
            const weaponSize = parseInt(values[`${prefix}weapon_size`]) || 0;
            const abilityLetter = weaponType.split('_').pop(); // Es. "k"
            const abilityAttr = `ability_${abilityLetter}`;
            const cacValue = parseInt(values.cac) || 0;
            const str= parseInt(values.for) || 0;

            // 2. Recupero il valore dell'abilità specifica (es. ability_k)
            getAttrs([abilityAttr], abilityValues => {
                const abilityVal = parseInt(abilityValues[abilityAttr]) || 0;
                let combat = 0;let sizeMod=0;
                let les=0;
                // Logica condizionale per il CAC
                if (abilityLetter === 'd' || abilityLetter === 'e') {
                    combat = cacValue;
                    if(weaponSize<16){
                      combat=cacValue/2;
                    }
                    if(str>=15 && weaponSize>=16){
                      les=1;
                    }
                }


                //gestione scaglioni
                const tiers = [5, 12, 16, 20];
                const wIndex = tiers.indexOf(weaponSize);
                let sIndex = -1;
                if (str >= weaponSize){
                  sizeMod=0;
                }else{
                  for (let i = 0; i < tiers.length; i++){
                    if (str >= tiers[i]) {
                      sIndex = i;
                    } else {
                    break; 
                    }
                  }
                  sizeMod=-(wIndex - sIndex)*20;
                }
                


                // 3. Aggiornamento finale degli attributi della riga
                setAttrs({
                    [`${prefix}ability_weapon_target`]: abilityVal,
                    [`${prefix}ability_weapon_cac`]: combat,
                    [`${prefix}ability_weapon_sizeMod`]: sizeMod,
                    [`${prefix}ability_weapon_lesMod`]: les
                });
            });
        });
    });
});

  /* --- LOGICA INVENTARIO AGGIORNATA (Peso Indossato + Totale) --- */

  const calculateTotalWeight = function() {
    // 1. I 7 Slot Fissi dell'armatura
    const armorFields = [
      "equip_testa_peso", "equip_torso_peso", "equip_ventre_peso",
      "equip_brdx_peso", "equip_brsx_peso", "equip_gadx_peso", "equip_gasx_peso","equip_scudo_peso"
    ];

    // 2. Ottieni ID della sezione ripetibile (Zaino)
    getSectionIDs("repeating_inventory", function(ids) {
      // Costruisci la lista di tutti i campi da leggere
      let fieldsToGet = [...armorFields,"for","weight_mod"];
      ids.forEach(id => {
        fieldsToGet.push(`repeating_inventory_${id}_item_weight`);
      });

      // 3. Leggi i valori
      getAttrs(fieldsToGet, function(values) {
        let wornTotal = 0;
        let backpackTotal = 0;
        const strg=parseInt(values.for) || 0;
        const mod=parseInt(values.weight_mod) || 0;
        const MaxPeso=(strg*4)+mod;

        // Calcola somma Armatura (Indossato)
        armorFields.forEach(field => {
          wornTotal += parseFloat(values[field]) || 0;
        });

        // Calcola somma Zaino
        ids.forEach(id => {
          backpackTotal += parseFloat(values[`repeating_inventory_${id}_item_weight`]) || 0;
        });

        // Calcola il Gran Totale
        let grandTotal = wornTotal + backpackTotal;

        let encState = 0;
        let encText = "Viaggi Leggero";
        if(MaxPeso>0){
          if(grandTotal>MaxPeso*1.5){
            encState=2;
            encText="Bloccato -3SA -1SR -20% pro";
          }else if(grandTotal>MaxPeso){
            encState=1;
            encText="Sovraccarico -2SA -10% pro";
          }
        }else{
          encText="Imposta Max";
        }

        // 4. Imposta entrambi i valori (con 1 decimale)
        setAttrs({ 
            "weight_worn": wornTotal.toFixed(1),
            "weight_total": grandTotal.toFixed(1),
            "weight_max":MaxPeso.toFixed(1),
            "encumbrance_state": encState,
            "encumbrance_text": encText
        });
      });
    });
  };

  // Listener unico: Scatta se cambia un pezzo di armatura O un oggetto nello zaino
  on("sheet:opened change:equip_testa_peso change:equip_torso_peso change:equip_ventre_peso change:equip_brdx_peso change:equip_brsx_peso change:equip_gadx_peso change:equip_gasx_peso change:equip_scudo_peso change:weight_mod change:for change:repeating_inventory:item_weight remove:repeating_inventory", calculateTotalWeight);

  /* --- CALCOLO MOVIMENTO --- */
  on("change:pro change:weight_worn change:movement_bonus sheet:opened", function() {
    getAttrs(["pro", "weight_worn", "movement_bonus",], function(values) {
      
      // 1. Recupero Valori
      const pro = parseInt(values.pro) || 0;
      const wornWeight = parseFloat(values.weight_worn) || 0; // Peso dell'equipaggiamento
      const bonus = parseInt(values.movement_bonus) || 0;     // Bonus manuale

      // 2. Calcolo Modificatore Prontezza
      // Formula: (Valore - 9) / 2 arrotondato per difetto
      // Esempi: 1->-4, 9->0, 10->0, 20->+5
      let proMod = Math.floor((pro - 9) / 2);

      // 3. Calcolo Penalità Peso
      // -1 Movimento per ogni 15kg di peso indossato (non conta lo zaino)
      let weightPenalty = Math.floor(wornWeight / 15);

      // 4. Calcolo Finale
      // Base (4) + Mod Prontezza - Penalità Peso + Bonus Utente
      let totalMovement = 4 + proMod - weightPenalty + bonus;

      // Evitiamo movimento negativo (minimo 0)
      if (totalMovement < 0) totalMovement = 0;

      // 5. Imposta il valore
      setAttrs({
        "movement": totalMovement

      });
    });
  });

</script>