<div class="container"><input class="sheet-tab-value" type="hidden" name="attr_sheet_container" value="data" />
<div class="nav-tab-container">
    <button class="nav-tab-btn btn-data" type="action" name="act_data">Dane Użytkownika</button>
    <button class="nav-tab-btn btn-skill" type="action" name="act_skills">Umiejętności</button>
    <button class="nav-tab-btn btn-equipment" type="action" name="act_equipment">Wyposażenie</button>
</div>
<div class="menu-roll">
    <div class="menu-section">
        <input type="hidden" class="difficulty-pointer" name="attr_difficulty-pointer" value="0">
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-0" title="modyfikator +2, poniżej 0">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="0"
                    checked>
                Łatwy
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-1" title="modyfikator 0, 0 do 10%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="1">
                Przeciętny
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-2" title="modyfikator -2, do 30%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="2">
                Problematyczny
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-3" title="modyfikator -5, do 60%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="3">
                Trudny
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-4" title="modyfikator -8, do 90%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="4">
                Bardzo Trudny
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-5" title="modyfikator -11, do 120%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="5">
                Cholernie Trudny
            </label>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-6" title="modyfikator -15, do 160%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="6">
                Fart
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="6"
                checked>
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-7" title="modyfikator -20, do 200%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="7">
                Mistrzowski
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="7">
        </div>

        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text difficulty-pointer-8" title="modyfikator -24, do 240%">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="8">
                Arcymistrzowski
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="8">
        </div>
    </div>

    <div class="menu-section">
        <input type="hidden" name="attr_total-difficulty-message">
        <div class="total-result">
            <div>
                <input type="checkbox" name="attr_injuries-select" value="1" checked>
                <span>Rany:</span>
            </div>
            <div>
                <input class="default-player-select injury-input-result" type="number" name="attr_total-injuries"
                    value="0" readonly>%
            </div>
        </div>
        <div class="total-result">
            <div>
                <input type="checkbox" name="attr_armor-select" value="1" checked>
                <span>Pancerz:</span>
            </div>
            <div>
                <input class="default-player-select injury-input-result" type="number" name="attr_total-armor" value="0"
                    readonly> %
            </div>
        </div>
        <div class="total-result">
            <div>
                <input type="checkbox" name="attr_weight-select" value="1" checked>
                <span>Obciążenie:</span>
            </div>
            <div>
                <input class="default-player-select weight-input-result" type="number" name="attr_total-weight"
                    value="0" readonly> %
            </div>
        </div>
        <div class="total-result">
            <div>
                <span>Suma:</span>
            </div>
            <div>
                <input class="default-player-select injury-input-result" type="number" name="attr_sum-difficulty"
                    value="0" readonly>%
            </div>
        </div>
    </div>
    <div class="menu-section">
        <input type="hidden" name="attr_total-bonus">
        <h1 class="bonus-title">Kary i Bonusy</h1>
        <fieldset class="repeating_bonus">
            <div class="bonus-row">
                <input type="checkbox" name="attr_bonus-status" value="1" checked>
                <input class="bonus-row-input" style="text-align: center;" type="number" name="attr_bonus-row-value">
                %
                <input class="bonus-row-input" type="text" name="attr_bonus-row-decription">
            </div>
        </fieldset>
    </div>
    <div class="menu-section">

        <button class="hitloc" type="roll" name="roll_hitloc" title="Rzut na lokację trafienia"
        value="&{template:hit-location} {{name=@{character_name}}} {{result=[[1d19]]}}">Lokalizacja</button>

        <button class="hitloc" type="roll" name="roll_hitloc" title="Rzut na zacięcie broni"
        value="&{template:jam} {{name=@{character_name}}} {{result=[[1d20]]}}">Zacięcie</button>
        
        <button class="hitloc" type="action" name="act_test-mod"title="Test oparty na inny współczynnik niż jest to domyślnie">Test modyfikowany</button>
        <!-- <button class="hitloc" type="action">Test wspomagany</button> -->

        <button class="open" type="roll" name="roll_open"
        value="&{template:test} {{test_name=@{last_test_name}}} {{name=@{character_name}}} {{difficulty_lvl_val=[[@{last_classic_difficulty}]]}} {{test_type_txt=[[1]]}} {{res=[[@{last_open_test_value}]]}}"></button>
        
        <button class="combat" type="roll" name="roll_combat"
        value="&{template:test} {{test_name=@{last_test_name}}} {{name=@{character_name}}} {{dice=[[@{last_dice_number}]]}}{{difficulty_lvl_val=[[@{last_combat_difficulty}]]}} {{test_type_txt=[[2]]}} {{roll1=[[@{last_combat_roll1}]]}} {{roll2=[[@{last_combat_roll2}]]}} {{roll3=[[@{last_combat_roll3}]]}} {{status1=[[@{last_combat_status1}]]}} {{status2=[[@{last_combat_status2}]]}} {{status3=[[@{last_combat_status3}]]}}"></button>
    
        <button class="openCombat" type="roll" name="roll_openCombat"
        value="&{template:test} {{test_name=@{last_test_name}}} {{name=@{character_name}}} {{difficulty_lvl_val=[[@{last_combat_difficulty}]]}} {{test_type_txt=[[3]]}} {{res=[[@{last_combat_opent_test_value}]]}}"></button>
        <input class="sheet-tab-value" type="hidden" name="attr_sheet_container" value="data" />
        <div class="combat-section">
            <p class="combat-title">Walka</p>
            <label class="weapon-location">
                Lokalizacja
                <select class="select_default" name="attr_location">
                    <option class="options" value="0" title="0%" selected>Bez celowania</option>
                    <option class="options" value="1" title="oraz miejsce witalne 80%">Głowa</option>
                    <option class="options" value="2" title="Strzelanie 20%, Walka 60%">Korpus</option>
                    <option class="options" value="3" title="Strzelanie 60%, Walka 40%">Ręce</option>
                    <option class="options" value="4" title="40%">Nogi</option>
                </select>
            </label>
            <label class="weapon-combat-state">
                Stan celu
                <input type="hidden" name="attr_state-value">
                <select class="select_default" name="attr_state">
                    <option class="options" value="0" title="0%" selected> ----- </option>
                    <option class="options" value="1" title="20%">Biegnący</option>
                    <option class="options" value="2" title="40%">Pędzący</option>
                    <option class="options" value="3" title="Cel widoczny w 2/3 - 20%">Widoczność 2/3</option>
                    <option class="options" value="4" title="Cel widoczny w 1/2 (lub klęczy) - 40%">Widoczność 1/2</option>
                    <option class="options" value="5" title="Cel widoczny w 1/3 (wychylił się lub leży) - 60%">Widoczność 1/3</option>
                    <option class="options" value="6" title="Wystaje prawie tylko sama głowa, ręka, spluwa (+20% utrudnienie do strzelania) - 80%">Ledwo wystaje</option>
                </select>
            </label>
            <label class="range-label">
                Odległość
                <input class="default-player-select" type="number" name="attr_difficulty-range">m
            </label>
        </div>
    </div>
</div><div class="data-container-tab" style="color: wheat;">
    <div class="frame-player-data">
        <div class="name-row">
            <input class="default-player-input" type="text" name="attr_character_name" placeholder="Nazwa Postaci">
        </div>
        <div class="origin-row">
            <input type="text" class="default-player-input" name="attr_origin_player" placeholder="Pochodzenie">
            <input type="text" class="default-player-input" name="attr_origin_skill" placeholder="Cecha z pochodzenia">
            <input type="text" class="default-player-input" name="attr_profession_player" placeholder="Profesja">
            <input type="text" class="default-player-input" name="attr_professoon_skill" placeholder="Cecha z Profesji">
            <input type="text" class="default-player-input" name="attr_disease" placeholder="Choroba">
            <input type="text" class="default-player-input" name="attr_medicines" placeholder="Lek na chorobę">
            <div class="label-container">
                <label class="default-player-label">Specjalizacja
                    <select name="attr_specialization" class="default-player-select">
                        <option class="options" value="0" selected>-----</option>
                        <option class="options" value="1">Wojownik</option>
                        <option class="options" value="2">Ranger</option>
                        <option class="options" value="3">Cwaniak</option>
                        <option class="options" value="4">Technik</option>
                    </select>
                </label>
            </div>
            <div class="label-container">
                <label class="default-player-label">
                    PD
                    <input type="text" class="default-player-input" style="max-width: 75px;" name="attr_exp" >
                </label>
            </div>
        </div>
    </div>
    <div class="masonry">
        <div class="item">
            <div>
                <label class="default-player-label">
                    Aktualny stan
                    <select class="default-player-select">
                        <option class="options" value="0">Bez objawów</option>
                        <option class="options" value="1">Pierwsze Syptomy</option>
                        <option class="options" value="2">Stan Ostry</option>
                        <option class="options" value="3">Stan terminalny</option>
                    </select>
                </label>
            </div>
            <div>
                <h1 class="disease-title">Pierwsze Symptomy</h1>
                <textarea class="disease-description" name="attr_first_phase"></textarea>
            </div>
            <div>
                <h1 class="disease-title">Stan Ostry</h1>
                <textarea class="disease-description" name="attr_acute_phase"></textarea>
            </div>
            <div>
                <h1 class="disease-title">Stan Krytyczny</h1>
                <textarea class="disease-description" name="attr_critical_phase"></textarea>
            </div>
            <div>
                <h1 class="disease-title">Stan Terminalny</h1>
                <textarea class="disease-description" name="attr_terminal_phase"></textarea>
            </div>
        </div>
        <div class="item">
            <div>
                <h1 class="injury-title">Rany</h1>
            </div>
            <div>
                <h3 class="injury-location-name">Głowa(1-2)</h3>
                <input type="hidden" name="attr_total-head">
                <fieldset class="repeating_injuries-head">
                    <div class="injury-container">
                        <select class="default-player-input injury-select" name="attr_injuty_type">
                            <option class="options" value="0">Rana</option>
                            <option class="options" value="1">Siniak</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_injury_head">
                            <option class="options" value="0">-</option>
                            <option class="options" value="1">D</option>
                            <option class="options" value="3">L</option>
                            <option class="options" value="9">C</option>
                            <option class="options" value="27">K</option>
                        </select>
                        <input class="injury-input default-player-select" type="number" name="attr_head_injury_value" value="0">%
                    </div>
                </fieldset>
            </div>


            <div>
                <h3 class="injury-location-name">Korpus(7-15)</h3>
                <input type="hidden" name="attr_total-torso">
                <fieldset class="repeating_injuries-torso">
                    <div class="injury-container">
                        <select class="default-player-input injury-select" name="attr_injuty_type">
                            <option class="options" value="0">Rana</option>
                            <option class="options" value="1">Siniak</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_type_torso">
                            <option class="options" value="0">-</option>
                            <option class="options" value="1">D</option>
                            <option class="options" value="3">L</option>
                            <option class="options" value="9">C</option>
                            <option class="options" value="27">K</option>
                        </select>
                        <input class="injury-input default-player-select" type="text" name="attr_torso_injury_value">%
                    </div>
                </fieldset>
            </div>


            <div>
                <h3 class="injury-location-name">Ręce P(3-4) L(5-6)</h3>
                <input type="hidden" name="attr_total-arms">
                <fieldset class="repeating_injuries-arms">
                    <div class="injury-container">
                        <select class="default-player-input injury-select" name="attr_arms_site">
                            <option class="options" value="0">L</option>
                            <option class="options" value="1">P</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_injuty_type">
                            <option class="options" value="0">Rana</option>
                            <option class="options" value="1">Siniak</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_type_arms">
                            <option class="options" value="0">-</option>
                            <option class="options" value="1">D</option>
                            <option class="options" value="3">L</option>
                            <option class="options" value="9">C</option>
                            <option class="options" value="27">K</option>
                        </select>
                        <input class="injury-input default-player-select" type="text" name="attr_arms_injury_value">%
                    </div>
                </fieldset>
            </div>


            <div>
                <h3 class="injury-location-name">Nogi P(16-17) L(18-19)</h3>
                <fieldset class="repeating_injuries-legs">
                    <div class="injury-container">
                        <select class="default-player-input injury-select" name="attr_legs_site">
                            <option class="options" value="0">L</option>
                            <option class="options" value="1">P</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_injuty_type">
                            <option class="options" value="0">Rana</option>
                            <option class="options" value="1">Siniak</option>
                        </select>
                        <select class="default-player-input injury-select" name="attr_type_legs">
                            <option class="options" value="0">-</option>
                            <option class="options" value="1">D</option>
                            <option class="options" value="3">L</option>
                            <option class="options" value="9">C</option>
                            <option class="options" value="27">K</option>
                        </select>
                        <input class="injury-input default-player-select" type="text" name="attr_legs_injury_value">%
                    </div>
                </fieldset>
            </div>


            
        </div>
        <div class="item">
            <div>
                <h1 class="tricks-title">Sztuczki</h1>
            </div>
            <div>
                <input type="text" name="attr_trick-name-static" class="default-player-input trick-name-static" placeholder="Nazwa sztuczki">
                <textarea class="disease-description" name="attr_trick_effect-static" placeholder="Działanie..."></textarea>
            </div>
            <div>
                <fieldset  class="repeating_tricks">
                    <input type="text" class="default-player-input trick-name" name="attr_trick_name_dynamic" placeholder="Nazwa sztuczki">
                    <textarea class="disease-description" name="attr_trick_effect-dynamic" placeholder="Działanie..."></textarea>
                </fieldset>
            </div>
        </div>
    </div>
</div><div class="skill-container-tab">
    <div class="wsp-container">
        <p class="wsp-label"><input type="radio" name="attr_wsp-select" value="zre" checked> Zręczność</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_zre">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_zre_mod">
            </div>
            <div class="wsp-pair">
                <button type="action" name="act_test_zre" class="roll-button wsp-roll-button"></button>
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="text" name="attr_difficulty_zre" readonly>
            </div>
        </div>
    </div>
    <input type="hidden" name="attr_title-status">
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name title-walka-wrecz">Walka wręcz</span>
            <div class="skill-container">
                <button type="action" name="act_test_bijatyka" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="bijatyka" checked>
                <input class="skill-name-input" value="Bijatyka" readonly>
                <input type="number" value="0" name="attr_bijatyka">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_br_ręczna" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="br_ręczna">
                <input class="skill-name-input" value="Broń ręczna" readonly>
                <input type="number" value="0" name="attr_br_ręczna">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_rzucanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="rzucanie">
                <input class="skill-name-input" value="Rzucanie" readonly>
                <input type="number" value="0" name="attr_rzucanie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-prowadzenie-pojazdow">Prowadzenie pojazdów</span>
            <div class="skill-container">
                <button type="action" name="act_test_samochód" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="samochód">
                <input class="skill-name-input" value="Samochód" readonly>
                <input type="number" value="0" name="attr_samochód">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_motocykl" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="motocykl">
                <input class="skill-name-input" value="Motocykl" readonly>
                <input type="number" value="0" name="attr_motocykl">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ciężarówka" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="ciężarówka">
                <input class="skill-name-input" value="Ciężarówka" readonly>
                <input type="number" value="0" name="attr_ciężarówka">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-zdolnosci-manualne">Zdolności manulane</span>
            <div class="skill-container">
                <button type="action" name="act_test_kr_kiesz" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="kr_kiesz">
                <input class="skill-name-input" value="Kradzież kieszonkowa" readonly>
                <input type="number" value="0" name="attr_kr_kiesz">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_otw_zamków" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="otw_zamków">
                <input class="skill-name-input" value="Otwieranie zamków" readonly>
                <input type="number" value="0" name="attr_otw_zamków">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zw_dłonie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="zw_dłonie">
                <input class="skill-name-input" value="Zwinne dłonie" readonly>
                <input type="number" value="0" name="attr_zw_dłonie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-bron-strzelecka">Broń strzelecka</span>
            <div class="skill-container">
                <button type="action" name="act_test_pistolety" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="pistolety">
                <input class="skill-name-input" value="Pistolety" readonly>
                <input type="number" value="0" name="attr_pistolety">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_karabiny" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="karabiny">
                <input class="skill-name-input" value="Karabiny" readonly>
                <input type="number" value="0" name="attr_karabiny">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_br_maszynowa" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="br_maszynowa">
                <input class="skill-name-input" value="Broń maszynowa" readonly>
                <input type="number" value="0" name="attr_br_maszynowa">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-bron-dystansowa">Broń dystansowa</span>
            <div class="skill-container">
                <button type="action" name="act_test_łuk" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="łuk">
                <input class="skill-name-input" value="Łuk" readonly>
                <input type="number" value="0" name="attr_łuk">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_kusza" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="kusza">
                <input class="skill-name-input" value="Kusza" readonly>
                <input type="number" value="0" name="attr_kusza">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_proca" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="proca">
                <input class="skill-name-input" value="Proca" readonly>
                <input type="number" value="0" name="attr_proca">
            </div>

        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label"><input type="radio" name="attr_wsp-select" value="per"> Percepcja</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_per">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_per_mod">
            </div>
            <button type="action" name="act_test_per" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="text" name="attr_difficulty_per" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name title-orientacja-w-terenie">Orientacja w terenie</span>
            <div class="skill-container">
                <button type="action" name="act_test_wycz_kier" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="wycz_kier">
                <input class="skill-name-input" value="Wyczucie kierunku" readonly>
                <input type="number" value="0" name="attr_wycz_kier">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_przyg_pułapki" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="przyg_pułapki">
                <input class="skill-name-input" value="Przygotowanie pułapki" readonly>
                <input type="number" value="0" name="attr_przyg_pułapki">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_tropienie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="tropienie">
                <input class="skill-name-input" value="Tropienie" readonly>
                <input type="number" value="0" name="attr_tropienie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-spostrzegawczosc">Spostrzegawczość</span>
            <div class="skill-container">
                <button type="action" name="act_test_nasłuchiwanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="nasłuchiwanie">
                <input class="skill-name-input" value="Nasłuchiwanie" readonly>
                <input type="number" value="0" name="attr_nasłuchiwanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wypatrywanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="wypatrywanie">
                <input class="skill-name-input" value="Wypatrywanie" readonly>
                <input type="number" value="0" name="attr_wypatrywanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_czujność" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="czujność">
                <input class="skill-name-input" value="Czujność" readonly>
                <input type="number" value="0" name="attr_czujność">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-kamuflaz">Kamuflaż</span>
            <div class="skill-container">
                <button type="action" name="act_test_skradanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="skradanie">
                <input class="skill-name-input" value="Skradanie się" readonly>
                <input type="number" value="0" name="attr_skradanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ukrywanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="ukrywanie">
                <input class="skill-name-input" value="Ukrywanie się" readonly>
                <input type="number" value="0" name="attr_ukrywanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_maskowanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="maskowanie">
                <input class="skill-name-input" value="Maskowanie" readonly>
                <input type="number" value="0" name="attr_maskowanie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-przetrwanie">Przetrwanie</span>
            <div class="skill-container">
                <button type="action" name="act_test_łowiectwo" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="łowiectwo">
                <input class="skill-name-input" value="Łowiectwo" readonly>
                <input type="number" value="0" name="attr_łowiectwo">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_znaj_teren" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="znaj_teren">
                <input class="skill-name-input" value="Znajomość terenu" readonly>
                <input type="number" value="0" name="attr_znaj_teren">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zdob_wody" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="zdob_wody">
                <input class="skill-name-input" value="Zdobywanie wody" readonly>
                <input type="number" value="0" name="attr_zdob_wody">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label"><input type="radio" name="attr_wsp-select" value="cha"> Charakter</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_cha">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_cha_mod">
            </div>
            <button type="action" name="act_test_cha" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="text" name="attr_difficulty_cha" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name title-negocjacje">Negocjacje</span>
            <div class="skill-container">
                <button type="action" name="act_test_zastraszanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="zastraszanie">
                <input class="skill-name-input" value="Zastraszanie" readonly>
                <input type="number" value="0" name="attr_zastraszanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_perswazja" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="perswazja">
                <input class="skill-name-input" value="Persfazja" readonly>
                <input type="number" value="0" name="attr_perswazja">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zdol_przywódcze" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="zdol_przywódcze">
                <input class="skill-name-input" value="Zdolności przywódcze" readonly>
                <input type="number" value="0" name="attr_zdol_przywódcze">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-empatia">Empatia</span>
            <div class="skill-container">
                <button type="action" name="act_test_postrz_emocje" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="postrz_emocje">
                <input class="skill-name-input" value="Postrzeganie emocji" readonly>
                <input type="number" value="0" name="attr_postrz_emocje">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_blef" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="blef">
                <input class="skill-name-input" value="Blef" readonly>
                <input type="number" value="0" name="attr_blef">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_opieka_zwierz" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="opieka_zwierz">
                <input class="skill-name-input" value="Opieka nad zwierzętami" readonly>
                <input type="number" value="0" name="attr_opieka_zwierz">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-sila-woli">Siła woli</span>
            <div class="skill-container">
                <button type="action" name="act_test_odp_na_ból" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="odp_na_ból">
                <input class="skill-name-input" value="Odporność na ból" readonly>
                <input type="number" value="0" name="attr_odp_na_ból">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_niezłomność" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="niezłomność">
                <input class="skill-name-input" value="Niezłomność" readonly>
                <input type="number" value="0" name="attr_niezłomność">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_morale" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="morale">
                <input class="skill-name-input" value="Morale" readonly>
                <input type="number" value="0" name="attr_morale">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label"><input type="radio" name="attr_wsp-select" value="spr"> Spryt</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_spr">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_spr_mod">
            </div>
            <button type="action" name="act_test_spr" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="text" name="attr_difficulty_spr" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name title-medycyna">Medycyna</span>
            <div class="skill-container">
                <button type="action" name="act_test_pier_pomoc" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="pier_pomoc">
                <input class="skill-name-input" value="Pierwsza Pomoc" readonly>
                <input type="number" value="0" name="attr_pier_pomoc">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_lecz_ran" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="lecz_ran">
                <input class="skill-name-input" value="Leczenie ran" readonly>
                <input type="number" value="0" name="attr_lecz_ran">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_lecz_chorób" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="lecz_chorób">
                <input class="skill-name-input" value="Leczenie chorób" readonly>
                <input type="number" value="0" name="attr_lecz_chorób">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-technika">Technika</span>
            <div class="skill-container">
                <button type="action" name="act_test_mechanika" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="mechanika">
                <input class="skill-name-input" value="Mechanika" readonly>
                <input type="number" value="0" name="attr_mechanika">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_elektronika" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="elektronika">
                <input class="skill-name-input" value="Elektronika" readonly>
                <input type="number" value="0" name="attr_elektronika">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_komputery" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="komputery">
                <input class="skill-name-input" value="Komputery" readonly>
                <input type="number" value="0" name="attr_komputery">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-sprzet">Sprzęt</span>
            <div class="skill-container">
                <button type="action" name="act_test_m_ciężkie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="m_ciężkie">
                <input class="skill-name-input" value="Maszyny ciężkie" readonly>
                <input type="number" value="0" name="attr_m_ciężkie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_w_bojowe" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="w_bojowe">
                <input class="skill-name-input" value="Wozy bojowe" readonly>
                <input type="number" value="0" name="attr_w_bojowe">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_kutry" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="kutry">
                <input class="skill-name-input" value="Kutry" readonly>
                <input type="number" value="0" name="attr_kutry">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-pirotechnika">Pirotechnika</span>
            <div class="skill-container">
                <button type="action" name="act_test_rusznikarstwo" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="rusznikarstwo">
                <input class="skill-name-input" value="Rusznikarstwo" readonly>
                <input type="number" value="0" name="attr_rusznikarstwo">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wyrzutnie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="wyrzutnie">
                <input class="skill-name-input" value="Wyrzutnie" readonly>
                <input type="number" value="0" name="attr_wyrzutnie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_mat_wyb" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="mat_wyb">
                <input class="skill-name-input" value="Materiały wybuchowe" readonly>
                <input type="number" value="0" name="attr_mat_wyb">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-wiedza-ogolna">Wiedza ogólna</span>
            <div class="skill-container">
                <button type="action" name="act_test_matematyka" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="matematyka">
                <input class="skill-name-input" value="Matematyka" readonly>
                <input type="number" value="0" name="attr_matematyka">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_fizyka" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="fizyka">
                <input class="skill-name-input" value="Fizyka" readonly>
                <input type="number" value="0" name="attr_fizyka">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_chemia" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="chemia">
                <input class="skill-name-input" value="Chemia" readonly>
                <input type="number" value="0" name="attr_chemia">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-wiedza-ogolna">Wiedza ogólna</span>
            <div class="skill-container">
                <button type="action" name="act_test_geografia" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="geografia">
                <input class="skill-name-input" value="Geografia" readonly>
                <input type="number" value="0" name="attr_geografia">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_biologia" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="biologia">
                <input class="skill-name-input" value="Biologia" readonly>
                <input type="number" value="0" name="attr_biologia">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_chirurgia" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="chirurgia">
                <input class="skill-name-input" value="Chirurgia" readonly>
                <input type="number" value="0" name="attr_chirurgia">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-wiedza-ogolna">Wiedza ogólna</span>
            <div class="skill-container">
                <button type="action" name="act_test_historia" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="historia">
                <input class="skill-name-input" value="Historia" readonly>
                <input type="number" value="0" name="attr_historia">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_literatura" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="literatura">
                <input class="skill-name-input" value="Literatura" readonly>
                <input type="number" value="0" name="attr_literatura">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_języki" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="języki">
                <input class="skill-name-input" value="Języki" readonly>
                <input type="number" value="0" name="attr_języki">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label"><input type="radio" name="attr_wsp-select" value="bud"> Budowa</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_bud">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_bud_mod">
            </div>
            <button type="action" name="act_test_bud" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="text" name="attr_difficulty_bud" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name title-sprawnosc">Sprawność</span>
            <div class="skill-container">
                <button type="action" name="act_test_kondycja" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="kondycja">
                <input class="skill-name-input" value="Kondycja" readonly>
                <input type="number" value="0" name="attr_kondycja">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_pływanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="pływanie">
                <input class="skill-name-input" value="Pływanie" readonly>
                <input type="number" value="0" name="attr_pływanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wspinaczka" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="wspinaczka">
                <input class="skill-name-input" value="Wspinaczka" readonly>
                <input type="number" value="0" name="attr_wspinaczka">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name title-jezdziectwo">Jeździectwo</span>
            <div class="skill-container">
                <button type="action" name="act_test_j_konna" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="j_konna">
                <input class="skill-name-input" value="Jazda Konna" readonly>
                <input type="number" value="0" name="attr_j_konna">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_powożenie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="powożenie">
                <input class="skill-name-input" value="Powożenie" readonly>
                <input type="number" value="0" name="attr_powożenie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ujeżdżanie" class="roll-button"></button>
                <input type="radio" name="attr_skill-select" value="ujeżdżanie">
                <input class="skill-name-input" value="Ujeżdzanie" readonly>
                <input type="number" value="0" name="attr_ujeżdżanie">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label">Inne</p>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <div class="skill-container">
                <input type="radio" name="attr_skill-select" value="inne1">
                <input type="text" class="skill-name-input" name="attr_skill_name_inne1" placeholder="Inne">
                <input type="number" value="0" name="attr_inne1">
            </div>
            <div class="skill-container">
                <input type="radio" name="attr_skill-select" value="inne2">
                <input type="text" class="skill-name-input" name="attr_skill_name_inne2" placeholder="Inne">
                <input type="number" value="0" name="attr_inne2">
            </div>
            <div class="skill-container">
                <input type="radio" name="attr_skill-select" value="inne3">
                <input type="text" class="skill-name-input" name="attr_skill_name_inne3" placeholder="Inne">
                <input type="number" value="0" name="attr_inne3">
            </div>
        </div>
    </div>
    
</div>
<div class="equipment-container-tab">
    <div>
        <h1>Broń Ręczna</h1>
        <div class="package-attack-type">
            <p><input type="radio" name="attr_melee_attack_type" value="0" checked>Atak</p>
            <p><input type="radio" name="attr_melee_attack_type" value="1">Obrona</p>
        </div>
        <fieldset class="repeating_weapons">
            <div class="weapon-frame">
                <div class="weapon-name-container">
                    <label class="weapon-name">
                        Nazwa
                        <input type="text" class="input-weapon-default input-weapon-name" name="attr_weapon_name">
                        <button class="weapon-roll" type="action" name="act_rolledweapon"></button>
                        <input type="text" class="input-weapon-default weapon-bonus" name="attr_bonus-attack"
                            placeholder="A+" title="Bonus do Ataku">
                        <input type="text" class="input-weapon-default weapon-bonus" name="attr_bonus-defence"
                            placeholder="O+" title="Bonus do Obrony">
                        <select class="select_default" name="attr_weapon_segment">
                            <option class="options" value="1">1s</option>
                            <option class="options" value="2">2s</option>
                            <option class="options" value="3" selected>3s</option>
                        </select>
                    </label>
                </div>
                <div class="weapon-data-container">
                    <label class="weapon-skill">
                        Umiejętność
                        <select class="select_default" name="attr_weapon_skill">
                            <option class="options" value="0" selected>Zręczność</option>
                            <option class="options" value="bijatyka">Bijatyka</option>
                            <option class="options" value="br_ręczna">Broń ręczna</option>
                            <option class="options" value="rzucanie">Rzucanie</option>
                        </select>
                    </label>
                    <label class="weapon-damage">
                        Obrażenia
                        <input type="text" class="input-weapon-default input-weapon-damage" name="attr_weapon_damage">
                    </label>
                    <label class="weapon-pp">PP
                        <input type="text" class="input-weapon-default input-weapon-pp" title="Punkty Przebicia"
                            name="attr_weapon_pp" placeholder="0">
                    </label>
                </div>
                <div class="weapon-data-container">
                    <label class="weapon-facilities">Ułatwienia
                        <input class="input-weapon-default input-weapon-facilities" name="attr_weapon-facilities-value"
                            type="text" placeholder="0">
                        %
                    </label>
                    <label class="weapon-impediments">Utrudnienia
                        <input class="input-weapon-default input-weapon-impediments"
                            name="attr_weapon-impediments-value" type="text" placeholder="0">
                        %
                    </label>
                </div>
                <div class="weapon-description-container">
                    <textarea class="weapon-description" name="attr_weapon_description" placeholder="Dodatkowy opis..."
                        rows="2"></textarea>
                </div>
            </div>
        </fieldset>

    </div>
    <div>
        <h1>Broń Dystansowa</h1>
    </div>
    <fieldset class="repeating_ranges">
        <div class="range-frame">
            <div class="range-name-container">
                <label class="range-name">
                    Nazwa
                    <input type="text" class="input-range-default input-range-name" name="attr_range_name">
                    <button class="range-roll" type="action" name="act_rolledrange"></button>
                    <select class="select_default small" name="attr_range_segment">
                        <option class="options" value="1" selected>1s</option>
                        <option class="options" value="2">2s</option>
                        <option class="options" value="3">3s</option>
                    </select>
                </label>
            </div>
            <div class="range-data-container">
                <label class="range-skill">
                    Umiejętność
                    <input type="hidden" name="attr_range_skill_value" />
                    <select class="select_default" name="attr_range_skill">
                        <option class="options" value="0" selected>Zręczność</option>
                        <option class="options" value="pistolety">Pistolety</option>
                        <option class="options" value="karabiny">Karabiny</option>
                        <option class="options" value="br_maszynowa">Broń maszynowa</option>
                        <option class="options" value="łuk">Łuk</option>
                        <option class="options" value="kusza">Kusza</option>
                        <option class="options" value="proca">Proca</option>
                    </select>
                </label>
                <label class="range-damage">
                    Obrażenia
                    <input type="text" class="input-range-default input-range-damage" name="attr_range_damage">
                </label>
                <label class="range-pp">PP
                    <input type="text" class="input-range-default input-range-pp" title="Punkty Przebicia"
                        name="attr_range_pp" placeholder="0">
                </label>
                <label class="range-jam">
                    Zacięcie<input type="text" class="input-range-default input-range-jam" title="Zacięcie broni"
                        name="attr_range_jam" value="17-20">
                </label>
                <label class="range-ammo">Amunicja
                    <input type="text" class="input-range-default input-range-ammo" name="attr_ammo"
                        title="Amunicja aktualna" placeholder="0">/
                    <input type="text" class="input-range-default input-range-ammo-max" name="attr_ammo_max"
                        placeholder="Max" title="Maksymalna Amunicja">
                </label>
                <label class="range-ammo">Szybkostrzelność
                    <input type="text" class="input-range-default input-range-ammo" name="attr_rate_fire"
                        title="Szybkostrzelność" placeholder="0">
                </label>


            </div>
            <div class="range-type-container">
                <div>

                    <label class="select_range_type">Typ broni
                        <select class="select_default" name="attr_range_type">
                            <option class="options" value="P"
                                title="Pistolety, Lekkie Kusze, Broń Odprzodowa, Pistolety, Samopały" selected>
                                P
                            </option>
                            <option class="options" value="PM"
                                title="Pistolety Maszynowe, Cięzkie Kusze, Karabiny Samopały, Granatniki, Winchester, Miotacz">
                                PM
                            </option>
                            <option class="options" value="K" title="Karabiny i Karabinki, Granatniki Automoatyczne">K
                            </option>
                            <option class="options" value="S" title="Karabiny Wyborowe, Przeciwsprzętowe">S</option>
                            <option class="options" value="SR" title="Śrutówki">ŚR</option>
                            <option class="options" value="Ł" title="Łuk">Ł</option>
                        </select></label>
                </div>
            </div>
            <div class="range-data-container">
                <label class="range-facilities">Ułatwienia
                    <input class="input-range-default input-range-facilities" type="text"
                        name="attr_range-facilities-value" placeholder="0">
                    %
                </label>
                <label class="range-impediments">Utrudnienia
                    <input class="input-range-default input-range-impediments" type="text"
                        name="attr_range-impediments-value" placeholder="0">
                    %
                </label>
            </div>
            <div class="range-description-container">
                <textarea class="range-description" name="attr_range_description" placeholder="Dodatkowy opis..."
                    rows="2"></textarea>
            </div>
        </div>
    </fieldset>
    <div>
        <h1>
            Pancerz
        </h1>
        <div class="armor-frame">
            <input type="hidden" name="attr_total-armor">
            <fieldset class="repeating_armor">
                <div class="armor-row">
                    <label class="armor-label">
                        <input type="checkbox" name="attr_armor-status" value="1" checked>
                        <input class="input-armor-default" type="number" name="attr_armor-debuff" value="0">
                        %
                        Red.
                        <input class="input-armor-default" type="number" name="attr_armor-reduction" placeholder="0">
                        Wyt.
                        <input class="input-armor-default" type="number" name="attr_armor-condition" placeholder="0">
                        <input class="input-armor-default" type="text" name="attr_armor_description"
                            placeholder="Opis...">
                    </label>
                </div>
            </fieldset>
        </div>
    </div>
    <div>
        <h1>
            Pozostały ekwipunek
        </h1>
        <div class="other-items-frame">
            <div class="item-data-container">
                <label class="item-label">Max obciążenie <input class="input-item-default" type="number"
                        name="attr_max-weight" placeholder="0">kg</label>
                <label class="item-label">Suma obciążeń <input class="input-item-default" type="number"
                        name="attr_total-weight-value" readonly>kg</label>
                <label class="item-label">Kara za przeciążenie/kg <input class="input-item-default" type="number"
                        name="attr_weight-debuff" value="10">%</label>
            </div>
            <div>
                <h1>
                    <input type="checkbox" name="attr_pocket-weight-select" value="1"> Kieszeń
                </h1>
            </div>
            <div>
                <input type="hidden" name="total-pocket">
                <fieldset class="repeating_other-items-pocket">
                    <div class="item-row">
                        <label class="item-label">
                            <input class="input-item-default" name="attr_pocket-no-item" type="number" step="0.01"
                                title="Ilość produktu" value="0">
                            <input class="input-item-default" name="attr_pocket-name-item" type="text"
                                placeholder="Nazwa produktu...">
                            <input class="input-item-default" name="attr_pocket-weight-item" type="number" step="0.01"
                                title="Waga w kg" value="0">kg
                            <input class="input-item-default" name="attr_pocket-gamlbe-item" type="number" step="0.01"
                                title="Cena w Gamblach" value="0">
                        </label>
                    </div>
                </fieldset>
            </div>
            <div>
                <h1>
                    <input type="checkbox" name="attr_bag-weight-select" value="1"> Plecak
                </h1>
            </div>
            <div>
                <input type="hidden" name="total-bag">
                <fieldset class="repeating_other-items-bag">
                    <div class="item-row">
                        <label class="item-label">
                            <input class="input-item-default" name="attr_bag-no-item" type="number" step="0.01"
                                title="Ilość" value="0">
                            <input class="input-item-default" name="attr_bag-name-item" type="text"
                                placeholder="Nazwa produktu...">
                            <input class="input-item-default" name="attr_bag-weight-item" type="number" step="0.01"
                                title="Waga w kg" value="0">kg
                            <input class="input-item-default" name="attr_bag-gamlbe-item" type="number" step="0.01"
                                title="Cena w Gamblach" value="0">
                        </label>
                    </div>
                </fieldset>
            </div>
            <div>
                <h1>
                    Magazyn
                </h1>
            </div>
            <div>
                <fieldset class="repeating_other-items-storage">
                    <div class="item-row">
                        <label class="item-label">
                            <input class="input-item-default" name="attr_storage-no-item" type="number" step="0.01"
                                title="Ilość produktu" value="0">
                            <input class="input-item-default" name="attr_storage-name-item" type="text"
                                placeholder="Nazwa produktu...">
                            <input class="input-item-default" name="attr_storage-weight-item" type="number" step="0.01"
                                title="Waga w kg" value="0">kg
                            <input class="input-item-default" name="attr_storage-gamlbe-item" type="number" step="0.01"
                                title="Cena w Gamblach" value="0">
                        </label>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</div></div><script type="text/worker">//####################################
//###############CODES################
//####################################
const wsp_code = ["zre", "per", "cha", "spr", "bud"];
const wsp_code_translate = {
  zre: "Zręczność",
  per: "Percepcja",
  cha: "Charakter",
  spr: "Spryt",
  bud: "Budowa",
};
const skill_code = {
  zre: [
    "bijatyka",
    "br_ręczna",
    "rzucanie",
    "samochód",
    "motocykl",
    "ciężarówka",
    "kr_kiesz",
    "otw_zamków",
    "zw_dłonie",
    "pistolety",
    "karabiny",
    "br_maszynowa",
    "łuk",
    "kusza",
    "proca",
  ],
  per: [
    "wycz_kier",
    "przyg_pułapki",
    "tropienie",
    "nasłuchiwanie",
    "wypatrywanie",
    "czujność",
    "skradanie",
    "ukrywanie",
    "maskowanie",
    "łowiectwo",
    "znaj_teren",
    "zdob_wody",
  ],
  cha: [
    "zastraszanie",
    "perswazja",
    "zdol_przywódcze",
    "postrz_emocje",
    "blef",
    "opieka_zwierz",
    "odp_na_ból",
    "niezłomność",
    "morale",
  ],
  spr: [
    "pier_pomoc",
    "lecz_ran",
    "lecz_chorób",
    "mechanika",
    "elektronika",
    "komputery",
    "m_ciężkie",
    "w_bojowe",
    "kutry",
    "rusznikarstwo",
    "wyrzutnie",
    "mat_wyb",
    "matematyka",
    "fizyka",
    "chemia",
    "geografia",
    "biologia",
    "chirurgia",
    "historia",
    "literatura",
    "języki",
  ],
  bud: [
    "kondycja",
    "pływanie",
    "wspinaczka",
    "j_konna",
    "powożenie",
    "ujeżdżanie",
  ],
};
const skill_code_translate = {
  bijatyka: "Bijatyka",
  br_ręczna: "Broń ręczna",
  rzucanie: "Rzucanie",
  samochód: "Samochód",
  motocykl: "Motocykl",
  ciężarówka: "Ciężarówka",
  kr_kiesz: "Kradzież kieszonkowa",
  otw_zamków: "Otwieranie zamków",
  zw_dłonie: "Zwinne dłonie",
  pistolety: "Pistolety",
  karabiny: "Karabiny",
  br_maszynowa: "Broń maszynowa",
  łuk: "Łuk",
  kusza: "Kusza",
  proca: "Proca",

  wycz_kier: "Wyczucie kierunku",
  przyg_pułapki: "Przygotowanie pułapki",
  tropienie: "Tropienie",
  nasłuchiwanie: "Nasłuchiwanie",
  wypatrywanie: "Wypatrywanie",
  czujność: "Czujność",
  skradanie: "Skradanie się",
  ukrywanie: "Ukrywanie się",
  maskowanie: "Maskowanie",
  łowiectwo: "Łowiectwo",
  znaj_teren: "Znajomość terenu",
  zdob_wody: "Zdobywanie wody",

  zastraszanie: "Zastraszanie",
  perswazja: "Perswazja",
  zdol_przywódcze: "Zdolności przywódcze",
  postrz_emocje: "Postrzeganie emocji",
  blef: "Blef",
  opieka_zwierz: "Opieka nad zwierzętami",
  odp_na_ból: "Odporność na ból",
  niezłomność: "Niezłomność",
  morale: "Morale",

  pier_pomoc: "Pierwsza pomoc",
  lecz_ran: "Leczenie ran",
  lecz_chorób: "Leczenie chorób",
  mechanika: "Mechanika",
  elektronika: "Elektronika",
  komputery: "Komputery",
  m_ciężkie: "Maszyny ciężkie",
  w_bojowe: "Wozy bojowe",
  kutry: "Kutry",
  rusznikarstwo: "Rusznikarstwo",
  wyrzutnie: "Wyrzutnie",
  mat_wyb: "Materiały wybuchowe",
  matematyka: "Matematyka",
  fizyka: "Fizyka",
  chemia: "Chemia",
  geografia: "Geografia",
  biologia: "Biologia",
  chirurgia: "Chirurgia",
  historia: "Historia",
  literatura: "Literatura",
  języki: "Języki",

  kondycja: "Kondycja",
  pływanie: "Pływanie",
  wspinaczka: "Wspinaczka",
  j_konna: "Jazda konna",
  powożenie: "Powożenie",
  ujeżdżanie: "Ujeżdżanie",
};

const difficulty_values = [2, 0, -2, -5, -8, -11, -15, -20, -24];
const difficulty_treshold = [0, 11, 31, 61, 91, 121, 161, 201, 241];
const difficulty_value_start = [-1, 0, 11, 31, 61, 91, 121, 161, 201, 241];

const buttonlist = ["skills", "equipment", "data"];

function range_difficulty_P(range) {
  if (range < 10) return 0;
  if (range < 20) return 20;
  if (range < 30) return 40;
  if (range < 40) return 80;
  if (range < 60) return 120;
  if (range < 80) return 160;
  return null;
}

function range_difficulty_PM(range) {
  if (range < 10) return 0;
  if (range < 20) return 10;
  if (range < 30) return 20;
  if (range < 40) return 30;
  if (range < 60) return 40;
  if (range < 80) return 60;
  if (range < 100) return 80;
  if (range < 150) return 120;
  if (range < 200) return 160;
  return null;
}

function range_difficulty_K(range) {
  if (range < 10) return 0;
  if (range < 20) return 10;
  if (range < 30) return 20;
  if (range < 40) return 30;
  if (range < 60) return 40;
  if (range < 80) return 60;
  if (range < 100) return 80;
  if (range < 150) return 120;
  if (range < 200) return 160;
  return null;
}

function range_difficulty_S(range) {
  if (range < 10) return 0;
  if (range < 20) return 0;
  if (range < 30) return 10;
  if (range < 40) return 10;
  if (range < 60) return 20;
  if (range < 80) return 20;
  if (range < 100) return 30;
  if (range < 150) return 30;
  if (range < 200) return 40;
  if (range < 250) return 40;
  if (range < 300) return 60;
  if (range < 400) return 80;
  if (range < 600) return 100;
  if (range < 1000) return 120;
  if (range < 1500) return 160;
  return null;
}

function range_difficulty_SR(range) {
  if (range < 10) return -30;
  if (range < 20) return 0;
  if (range < 30) return 30;
  return null;
}

function clamp(val, min, max) {
  return Math.max(min, Math.min(val, max));
}
function count_number(arr, target) {
  return arr.filter((n) => n === target).length;
}

//####################################
//################ROLL################
//####################################
/**
 * Returns the index of the first element in the `difficulty_treshold` array
 * that is greater than the provided `inputNumber`.
 *
 * This is typically used to determine the difficulty level for a given input
 * based on predefined threshold ranges.
 *
 * @param {number} inputNumber - The number to compare against the threshold levels.
 * @param {number} maxDifficulty - The maximum index threshold levels.
 * @returns {number} The index of the first threshold greater than `inputNumber`
 */
function findMaxIndex(inputNumber, maxDifficulty) {
  for (let i = 0; i < difficulty_treshold.length; i++) {
    if (inputNumber < difficulty_treshold[i]) {
      return i > maxDifficulty ? maxDifficulty : i;
    }
  }
  return maxDifficulty;
}

/**
 * Calculates and adjusts the final difficulty level of a test.
 * It considers the number of 20s and 1s rolled, the skill value (if applicable),
 * and whether the test is a battle type. Future adjustments may include injuries
 * and other modifiers (TODO).
 *
 * @param {number[]} rolls - Array of rolled d20 values.
 * @param {number} current_difficulty - The base difficulty level selected by the player.
 * @param {number} max_difficulty_level - The maximum allowed difficulty level.
 * @param {number|null} skill_value - Points from the skill used to reduce difficulty; null means no skill is used.
 * @param {boolean} is_battle - Whether the test is a battle-type test.
 * @returns {number} The final adjusted difficulty level (clamped between 0 and max).
 */
function set_difficulty_level(
  rolls,
  current_difficulty,
  max_difficulty_level,
  skill_value = null,
  is_battle = false
) {
  // let difficulty_level = current_difficulty;
  let difficulty_level = findMaxIndex(current_difficulty, max_difficulty_level);

  if (skill_value < 1 && skill_value !== null && !is_battle) {
    difficulty_level++;
  } else if (!is_battle && skill_value !== null) {
    difficulty_level -= Math.floor(skill_value / 4);
  }
  //TODO injuries, situation, etc difficulty %
  difficulty_level = Math.max(
    0,
    Math.min(difficulty_level, max_difficulty_level)
  );
  if (!is_battle) {
    difficulty_level += count_number(rolls, 20);
    difficulty_level -= count_number(rolls, 1);
  }
  difficulty_level = Math.max(
    0,
    Math.min(difficulty_level, max_difficulty_level)
  );
  return difficulty_level;
}

/**
 * Calculates the total number of failed rolls in a classic test.
 *
 * Each element in the `flags` array represents the result of a single die:
 * `0` means success, `1` means failure.
 *
 * @param {number[]} flags - Array of flags where 0 is a success and 1 is a failure.
 * @returns {number} The number of failed rolls (i.e., total test result).
 */
function calculate_result_test_classic(flags) {
  return flags.reduce((partialSum, a) => partialSum + a, 0);
}

/**
 * Calculates the result of an open test.
 *
 * In an open test, the second-lowest die result is compared to the difficulty.
 * Skill points can be used to reduce the lower dice values, starting with the second-lowest.
 *
 * @param {number[]} rolls - Array of rolled d20 values.
 * @param {number} difficulty - The difficulty level that needs to be beaten.
 * @param {number} [points=0] - Points that can be spent to reduce rolls; 0 means no skill is used (WSP test).
 * @returns {number} The difference between the difficulty and the (possibly reduced) second-lowest die value.
 */
function calculate_result_test_open(rolls, difficulty, points = 0) {
  if (rolls.length < 2) {
    const result = rolls[0] - points > 0 ? rolls[0] - points : 1;
    return difficulty - result;
  }
  const sorted_dices = rolls.concat().sort(function (a, b) {
    return a - b;
  });
  let min1 = sorted_dices[0];
  let min2 = sorted_dices[1];
  while (points && min2 > 1) {
    if (min2 > min1) {
      min2--;
    } else {
      min1--;
    }
    points--;
  }
  return difficulty - min2;
}

/**
 * Creates a flag array indicating success or failure for each roll.
 *
 * A value of `0` in the returned array means success, and `1` means failure.
 * Rolls higher than the difficulty can be reduced using available skill points.
 * In a combat test, encountering a natural 20 stops the evaluation early.
 *
 * @param {number[]} rolls - Array of d20 roll values.
 * @param {number} difficulty - The base difficulty to beat or meet.
 * @param {number} points - Points that can be spent to reduce roll values.
 * @param {boolean} [is_combat=false] - If true, encountering a 20 halts further evaluation (used in combat tests).
 * @returns {number[]} An array of 0s and 1s indicating success (0) or failure (1) for each roll.
 */
function create_flag_success(rolls, difficulty, points, is_combat = false) {
  const result = Array(rolls.length).fill(1);

  const indexedRolls = rolls
    .map((val, i) => [i, val])
    .sort((a, b) => a[1] - b[1]);

  for (const [i, val] of indexedRolls) {
    if (val === 20 && is_combat) break;
    const diff = val - difficulty;
    if (diff > points) continue;
    if (val > difficulty) {
      points -= diff;
    }
    result[i] = 0;
  }

  return result;
}

/**
 * Executes a skill or attribute test, formats the roll template,
 * assigns necessary values, and calculates the result.
 *
 * @param {string} template - Name of the Roll20 rolltemplate to use.
 * @param {string} name - Display name of the test (e.g. attribute or skill name).
 * @param {string} wsp - Base attribute used for the test.
 * @param {string} wsp_mod - Modifier for the base attribute.
 * @param {string} [skill=null] - Optional skill associated with the test, used to reduce the number of dice.
 */

function roll_test(
  template,
  name,
  wsp,
  wsp_mod,
  skill = null,
  dice = 3,
  battle_mods = { mod: 0, difficulty: 0, message: "" }
) {
  const attrs_arr = [
    wsp,
    wsp_mod,
    skill,
    "sum-difficulty",
    "difficulty_max_lvl",
    "test_type_txt",
  ].filter((a) => typeof a === "string" && a.length);
  const rollTemplate = `
    &{template:${template}}
    {{test_name=${name}}}
    {{name=@{character_name}}}
    {{message=@{total-difficulty-message}}}
    {{messageCombat=${battle_mods.message}}}
    {{difficulty_lvl_val=[[0[computed value]]]}}
    {{test_type_txt=[[0[computed value]]]}}
    {{res=[[0[computed value]]]}}
    {{roll1=[[1d20]]}}
    {{roll2=[[1d20]]}}
    {{roll3=[[1d20]]}}
    {{test_type_txt=[[0]]}}
    {{status1=[[0[computed value]]]}}
    {{status2=[[0[computed value]]]}}
    {{status3=[[0[computed value]]]}}
    {{options=[[1]]}}
    {{dice=[[${dice}]]}}
    {{tOpen=[T. Otwarty](~@{character_name}|open)}}
    {{tCombat=[T. Walki](~@{character_name}|combat)}}
    {{tOpenCombat=[T.O. Walki](~@{character_name}|openCombat)}}
  `
    .trim()
    .replace(/\n+/g, " ");

  startRoll(rollTemplate, (results) => {
    const refference_rolls = [
      results.results.roll1.result,
      results.results.roll2.result,
      results.results.roll3.result,
    ];
    const roll_dices = refference_rolls.slice(0, dice);
    getAttrs(attrs_arr, function (values) {
      let difficulty_classic =
        parseInt(values[wsp] || 0) +
        parseInt(values[wsp_mod] || 0) +
        battle_mods.mod;
      let difficulty_combat = difficulty_classic;
      const max_level_difficulty = clamp(
        parseInt(values["difficulty_max_lvl"]) || 6,
        6,
        8
      );
      const skill_value = skill === null ? null : parseInt(values[skill] || 0);
      const difficulty_mod_classic = set_difficulty_level(
        roll_dices,
        parseInt(values["sum-difficulty"] || 0) + battle_mods.difficulty,
        max_level_difficulty,
        skill_value
      );
      const difficulty_mod_combat = set_difficulty_level(
        roll_dices,
        parseInt(values["sum-difficulty"] || 0) + battle_mods.difficulty,
        max_level_difficulty,
        skill_value,
        true
      );

      difficulty_classic += difficulty_values[difficulty_mod_classic];
      difficulty_combat += difficulty_values[difficulty_mod_combat];

      const flags_classic = create_flag_success(
        roll_dices,
        difficulty_classic,
        skill_value
      );
      const flags_combat = create_flag_success(
        roll_dices,
        difficulty_combat,
        skill_value,
        true
      );
      const final_result_classic = calculate_result_test_classic(flags_classic);
      const final_result_classic_open = calculate_result_test_open(
        roll_dices,
        difficulty_classic,
        skill === null ? 0 : skill_value
      );
      const final_result_combat = calculate_result_test_classic(flags_combat);
      const final_result_combat_open = calculate_result_test_open(
        roll_dices,
        difficulty_combat,
        skill === null ? 0 : skill_value
      );
      setAttrs({
        last_test_name: name,
        last_combat_status1: flags_combat[0] || 0,
        last_combat_status2: flags_combat[1] || 0,
        last_combat_status3: flags_combat[2] || 0,
        last_combat_roll1: refference_rolls[0] || 0,
        last_combat_roll2: refference_rolls[1] || 0,
        last_combat_roll3: refference_rolls[2] || 0,
        last_open_test_value: final_result_classic_open || 0,
        last_combat_test_value: final_result_combat || 0,
        last_combat_opent_test_value: final_result_combat_open || 0,
        last_classic_difficulty: difficulty_mod_classic || 0,
        last_combat_difficulty: difficulty_mod_combat || 0,
        last_dice_number: dice || 0,
      });
      finishRoll(results.rollId, {
        status1: flags_classic[0],
        status2: flags_classic[1],
        status3: flags_classic[2],
        res: final_result_classic,
        difficulty_lvl_val: difficulty_mod_classic,
      });
    });
  });
}
/* ===== PARAMETERS ==========
destinations = the name of the attribute that stores the total quantity
section = name of repeating fieldset, without the repeating_
fields = the name of the attribute field to be summed
      can be a single attribute: 'weight'
      or an array of attributes: ['weight','number','equipped']
extras: everything after the fields parameter is optional and can be in any order:
    'ceil'
    'round'
    'floor'
    'ceil: 3'
    'round: -2'
    'round: equipment_weight, equipment_cost|2
        you want to round the final total. 
        If you supply a field name, it will round just that total. You can supply multiple fields, separated by commas.
        If you supply a number, it will round to that many digits. 
        round:1 rounds to tenths; floor:-3 rounds down to thousands, so 3567 would be shown as 3000.
        If you dont supply a number, it assumes 0, and returns an integer (whole numbers).
        IMPORTANT: if you list ANY field, then ALL fields to be rounded must be specifically stated.
        Don't do this: floor:equipment_weight|2, round,
    
    'multiplier: 2'
    'multiplier:equipment_weight|2'
    'multiplier: equipment_weight|2, equipment_cost|3'
        Multiplier will apply a multiple to the final total. You can multiple all fields, or specific fields.
        It doesnt apply to attributes being added from outside the repeating section.
        Multiplier can be negative, representing a subtraction.

    'an_attribute'
    'an_attribute:-1'
    'an_attribute:0.5'
    'an_attribute:equipment_cost'
    'an_attribute:equipment_cost|-1'
    'an_attribute:equipment_cost|-1,equipment_weight|2'
        You can also list attributes from outside the repeating section. Don't try to add attributes from other repeating sections.
        by default, the listed attribute will be added to all fields.
        You can list one or more fields, and it will only be added to those fields.
        You can list a number: the attribute will be multiplied by that amount. So -1 subtracts the attribute.
*/
const repeatingSum = (destinations, section, fields) => {
  if (!Array.isArray(destinations))
    destinations = [destinations.replace(/\s/g, "").split(",")];
  if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, "").split(",")];
  getSectionIDs(`repeating_${section}`, (idArray) => {
    const attrArray = idArray.reduce(
      (m, id) => [
        ...m,
        ...fields.map((field) => `repeating_${section}_${id}_${field}`),
      ],
      []
    );
    getAttrs([...attrArray], (v) => {
      const getValue = (section, id, field) =>
        v[`repeating_${section}_${id}_${field}`] === "on"
          ? 1
          : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
      const commonMultipliers =
        fields.length <= destinations.length
          ? []
          : fields.splice(
              destinations.length,
              fields.length - destinations.length
            );
      const output = {};
      destinations.forEach((destination, index) => {
        output[destination] = idArray.reduce(
          (total, id) =>
            total +
            getValue(section, id, fields[index]) *
              commonMultipliers.reduce(
                (subtotal, mult) => subtotal * getValue(section, id, mult),
                1
              ),
          0
        );
      });
      setAttrs(output);
    });
  });
};
on(
  "change:repeating_injuries-head:head_injury_value remove:repeating_injuries-head",
  function () {
    repeatingSum("total-head", "injuries-head", "head_injury_value");
  }
);
on(
  "change:repeating_injuries-torso:torso_injury_value remove:repeating_injuries-torso",
  function () {
    repeatingSum("total-torso", "injuries-torso", "torso_injury_value");
  }
);
on(
  "change:repeating_injuries-arms:arms_injury_value remove:repeating_injuries-arms",
  function () {
    repeatingSum("total-arms", "injuries-arms", "arms_injury_value");
  }
);
on(
  "change:repeating_injuries-legs:legs_injury_value remove:repeating_injuries-legs",
  function () {
    repeatingSum("total-legs", "injuries-legs", "legs_injury_value");
  }
);
on(
  "change:total-head change:total-torso change:total-arms change:total-legs",
  function () {
    getAttrs(
      ["total-head", "total-torso", "total-arms", "total-legs"],
      function (values) {
        let wounds =
          parseInt(values["total-head"] || 0) +
          parseInt(values["total-torso"] || 0) +
          parseInt(values["total-arms"] || 0) +
          parseInt(values["total-legs"] || 0);
        setAttrs({ "total-injuries": wounds });
      }
    );
  }
);
/**
 * ====================================
 * ============ SUM WEIGHT ============
 * ====================================
 */
on(
  "change:repeating_other-items-pocket:pocket-weight-item remove:repeating_other-items-pocket:pocket-weight-item",
  function () {
    repeatingSum("total-pocket", "other-items-pocket", "pocket-weight-item");
  }
);
on(
  "change:repeating_other-items-bag:bag-weight-item remove:repeating_other-items-bag:bag-weight-item",
  function () {
    repeatingSum("total-bag", "other-items-bag", "bag-weight-item");
  }
);
on(
  "change:total-bag change:total-pocket change:bag-weight-select change:pocket-weight-select sheet:opened",
  function () {
    getAttrs(
      [
        "total-bag",
        "total-pocket",
        "bag-weight-select",
        "pocket-weight-select",
      ],
      function (values) {
        const bag_status = values["bag-weight-select"] === "1";
        const pocket_status = values["pocket-weight-select"] === "1";
        let wounds = 0;
        if (bag_status) {
          wounds += parseFloat(values["total-bag"] || 0);
        }
        if (pocket_status) {
          wounds += parseFloat(values["total-pocket"] || 0);
        }
        setAttrs({ "total-weight-value": wounds });
      }
    );
  }
);
on(
  "change:total-weight-value change:weight-debuff change:max-weight",
  function () {
    getAttrs(
      ["total-weight-value", "weight-debuff", "max-weight"],
      function (values) {
        const total_weight = parseFloat(values["total-weight-value"] || 0);
        const weight_debuff = parseFloat(values["weight-debuff"] || 0);
        const max_weight = parseFloat(values["max-weight"] || 0);
        let weight_difference = 0;
        if (max_weight < total_weight) {
          weight_difference = Math.floor(total_weight - max_weight);
        }
        setAttrs({
          "total-weight": weight_difference * weight_debuff,
        });
      }
    );
  }
);
/**
 * ====================================
 * =========== ASSIGN ROLLS ===========
 * ====================================
 */
wsp_code.forEach((element) => {
  on(
    `change:${element} change:${element}_mod change:difficulty-pointer sheet:opened`,
    function () {
      getAttrs(
        ["difficulty-pointer", element, `${element}_mod`, "difficulty_max_lvl"],
        function (values) {
          const max_level_difficulty = clamp(
            parseInt(values["difficulty_max_lvl"]) || 6,
            6,
            8
          );
          const difficulty_lvl_index = clamp(
            parseInt(values["difficulty-pointer"]) || 0,
            0,
            max_level_difficulty
          );
          const wsp = clamp(parseInt(values[element]) || 0, 0, 50);
          const wsp_mod = parseInt(values[`${element}_mod`] || 0);
          const total_mod =
            wsp + wsp_mod + difficulty_values[difficulty_lvl_index];
          setAttrs({
            [`difficulty_${element}`]: total_mod < 1 ? "N" : total_mod,
          });
        }
      );
    }
  );
});

for (const [key, value] of Object.entries(skill_code)) {
  on(`clicked:test_${key}`, () => {
    roll_test("test", wsp_code_translate[key], key, `${key}_mod`);
  });
  value.forEach((element) => {
    on(`clicked:test_${element}`, () => {
      roll_test(
        "test",
        `${skill_code_translate[element]}\n(${wsp_code_translate[key]})`,
        key,
        `${key}_mod`,
        element
      );
    });
  });
}
/**
 * ===================================
 * ============ DIFFICULTY ===========
 * ===================================
 */
on("change:difficulty_lvl sheet:opened", function () {
  getAttrs(["difficulty_lvl", "difficulty_max_lvl"], function (values) {
    const max_level_difficulty = clamp(
      parseInt(values.difficulty_max_lvl) || 0,
      6,
      8
    );
    const difficulty_lvl_index = clamp(
      parseInt(values.difficulty_lvl) || 0,
      0,
      8
    );
    if (difficulty_lvl_index > max_level_difficulty) {
      setAttrs({
        difficulty_lvl: max_level_difficulty,
      });
    }
  });
});
on("change:difficulty_max_lvl sheet:opened", function () {
  getAttrs(["difficulty_lvl", "difficulty_max_lvl"], function (values) {
    const max_level_difficulty = clamp(
      parseInt(values.difficulty_max_lvl) || 0,
      6,
      8
    );
    const difficulty_lvl_index = clamp(
      parseInt(values.difficulty_lvl) || 0,
      0,
      8
    );
    if (difficulty_lvl_index > max_level_difficulty) {
      setAttrs({
        difficulty_lvl: max_level_difficulty,
      });
    }
  });
});

buttonlist.forEach((button) => {
  on(`clicked:${button}`, function () {
    setAttrs({
      sheet_container: button,
    });
  });
});

/**
 * ================================== REPEATING ===================================
 */

/**
 * ====================================
 * =========== MELEE WEAPON ===========
 * ====================================
 */
on("clicked:repeating_weapons:rolledweapon", function (eventInfo) {
  const rowId = eventInfo.sourceAttribute.split("_")[2];
  const prefix = `repeating_weapons_${rowId}_`;

  const attrsToGet = [
    `${prefix}weapon_skill`,
    `location`,
    `${prefix}weapon_segment`,
    `${prefix}bonus-defence`,
    `${prefix}bonus-attack`,
    `melee_attack_type`,
    `state-value`,
    `${prefix}weapon-facilities-value`,
    `${prefix}weapon-impediments-value`,
  ];

  getAttrs(attrsToGet, function (values) {
    const skill_value = values[`${prefix}weapon_skill`];
    const skill = skill_value === "0" ? null : skill_value;
    const skill_name =
      skill === null
        ? "Zręczność"
        : `${skill_code_translate[skill]}\n(Zręczność)`;

    const dice = clamp(parseInt(values[`${prefix}weapon_segment`]) || 0, 1, 3);
    const location_arr = [0, 80, 60, 40, 40];
    let message = "";

    const location = location_arr[parseInt(values[`location`] || 0)];
    message += location ? `${location}% celowanie w część ciała&#10;` : "";

    const state_value = parseInt(values[`state-value`] || 0);
    message += state_value ? `${state_value}% stan celu&#10;` : "";

    const facilities = Math.abs(
      parseInt(values[`${prefix}weapon-facilities-value`] || 0)
    );
    message += facilities ? `-${facilities}% ułatwienia broni&#10;` : "";

    const impediments = parseInt(
      values[`${prefix}weapon-impediments-value`] || 0
    );
    message += impediments ? `${impediments}% utrudnienia broni&#10;` : "";

    const diffculty_sum_weapon =
      location + state_value - facilities + impediments;
    message += `${diffculty_sum_weapon}% suma utrudnień walki&#10;`;

    let test_mod = 0;
    switch (values["melee_attack_type"]) {
      case "0":
        test_mod += parseInt(values[`${prefix}bonus-attack`] || 0);
        message += `${test_mod}-bonus do zręczności w ataku&#10;`;
        break;
      case "1":
        test_mod += parseInt(values[`${prefix}bonus-defence`] || 0);
        message += `${test_mod}-bonus do zręczności w obronie&#10;`;
        break;
      default:
        break;
    }

    roll_test("test", skill_name, "zre", "zre_mod", skill, dice, {
      mod: test_mod,
      difficulty: diffculty_sum_weapon,
      message: message,
    });
  });
});

/**
 * ===================================
 * ========== RANGE WEAPON ===========
 * ===================================
 */
on("clicked:repeating_ranges:rolledrange", function (eventInfo) {
  const rowId = eventInfo.sourceAttribute.split("_")[2];
  const prefix = `repeating_ranges_${rowId}_`;

  const attrsToGet = [
    `${prefix}range_skill`,
    `location`,
    `${prefix}range_segment`,
    `${prefix}range_type`,
    `state-value`,
    `${prefix}range-facilities-value`,
    `${prefix}range-impediments-value`,
    `${prefix}range_difficulty`,
    `difficulty-range`,
  ];

  getAttrs(attrsToGet, function (values) {
    const skill_value = values[`${prefix}range_skill`];
    const skill = skill_value === "0" ? null : skill_value;
    const skill_name =
      skill === null
        ? "Zręczność"
        : `${skill_code_translate[skill]}\n(Zręczność)`;

    const dice = clamp(parseInt(values[`${prefix}range_segment`]) || 0, 1, 3);

    const location_arr = [0, 80, 60, 40, 40];
    let message = "-------------&#10;";

    const location = location_arr[parseInt(values[`location`] || 0)];
    message += location ? `${location}% celowanie w część ciała&#10;` : "";

    const state_value = parseInt(values[`state-value`] || 0);
    message += state_value ? `${state_value}% stan celu&#10;` : "";

    const facilities = Math.abs(
      parseInt(values[`${prefix}range-facilities-value`] || 0)
    );
    message += facilities ? `-${facilities}% ułatwienia broni&#10;` : "";

    const impediments = parseInt(
      values[`${prefix}range-impediments-value`] || 0
    );
    message += impediments ? `${impediments}% utrudnienia broni&#10;` : "";
    const range = parseInt(values["difficulty-range"] || 0);
    let range_difficulty = null;

    switch (values[`${prefix}range_type`]) {
      case "P":
        range_difficulty = range_difficulty_P(range);
        break;
      case "PM":
        range_difficulty = range_difficulty_PM(range);
        break;
      case "K":
        range_difficulty = range_difficulty_K(range);
        break;
      case "S":
        range_difficulty = range_difficulty_S(range);
        break;
      case "SR":
        range_difficulty = range_difficulty_SR(range);
        break;
      case "Ł":
        range_difficulty = range * 2;
        break;
      default:
        break;
    }
    if (range_difficulty === null) {
      console.log("Strzał poza zasięgiem broni");
      return;
    }
    message += `${range_difficulty}% utrudnienie odległości&#10;`;
    const diffculty_sum_range =
      location + state_value - facilities + impediments + range_difficulty;
    message += `${diffculty_sum_range}% suma utrudnień walki&#10;`;

    roll_test("test", skill_name, "zre", "zre_mod", skill, dice, {
      mod: 0,
      difficulty: diffculty_sum_range,
      message: message,
    });
  });
});

on(
  "change:difficulty_lvl change:difficulty_max_lvl change:total-injuries change:injuries-select change:armor-select change:total-armor change:total-bonus change:total-weight change:weight-select sheet:opened",
  function () {
    getAttrs(
      [
        "difficulty_lvl",
        "total-injuries",
        "injuries-select",
        "armor-select",
        "total-armor",
        "difficulty_max_lvl",
        "total-bonus",
        "total-weight",
        "weight-select",
      ],
      (values) => {
        const difficulty_max_lvl = clamp(
          parseInt(values["difficulty_max_lvl"] || 0),
          6,
          8
        );
        let message_difficulty = "";
        const start_lvl =
          parseInt(difficulty_value_start[values["difficulty_lvl"]]) || 0;
        message_difficulty += `${start_lvl}% baza poziomu trudności &#10;`;
        const injuries = parseInt(values["total-injuries"]) || 0;
        const armor = parseInt(values["total-armor"]) || 0;
        const bonus = parseInt(values["total-bonus"]) || 0;
        const weight = parseInt(values["total-weight"]) || 0;
        const injuries_status = values["injuries-select"] === "1";
        const armor_status = values["armor-select"] === "1";
        const weight_status = values["weight-select"] === "1";
        let total_sum = 0;
        total_sum = start_lvl + bonus;
        if (injuries_status) {
          total_sum += injuries;
          message_difficulty += injuries ? `${injuries}% Rany &#10;` : "";
        }
        if (armor_status) {
          total_sum += armor;
          message_difficulty += armor ? `${armor}% Pancerz &#10;` : "";
        }
        if (weight_status) {
          total_sum += weight;
          message_difficulty += weight ? `${weight}% Obciążenie &#10;` : "";
        }
        const difficulty_pointer = findMaxIndex(total_sum, difficulty_max_lvl);
        setAttrs({
          "sum-difficulty": total_sum,
          "difficulty-pointer": difficulty_pointer,
          "total-difficulty-message": message_difficulty,
        });
      }
    );
  }
);

const sumCheckedValues = ({
  section,
  checkboxAttr,
  valueAttr,
  destinationAttr,
}) => {
  getSectionIDs(`repeating_${section}`, (idArray) => {
    const attrNames = idArray.flatMap((id) => [
      `repeating_${section}_${id}_${checkboxAttr}`,
      `repeating_${section}_${id}_${valueAttr}`,
    ]);

    getAttrs(attrNames, (values) => {
      let total = 0;

      idArray.forEach((id) => {
        const checkbox = values[`repeating_${section}_${id}_${checkboxAttr}`];
        const value =
          parseFloat(values[`repeating_${section}_${id}_${valueAttr}`]) || 0;

        if (checkbox === "1" || checkbox === "on") {
          total += value;
        }
      });

      setAttrs({ [destinationAttr]: total });
    });
  });
};

on(
  "change:repeating_bonus:bonus-status change:repeating_bonus:bonus-row-value remove:repeating_bonus",
  () => {
    sumCheckedValues({
      section: "bonus",
      checkboxAttr: "bonus-status",
      valueAttr: "bonus-row-value",
      destinationAttr: "total-bonus",
    });
  }
);

on(
  "change:repeating_armor:armor-status change:repeating_armor:armor-debuff remove:repeating_armor",
  () => {
    sumCheckedValues({
      section: "armor",
      checkboxAttr: "armor-status",
      valueAttr: "armor-debuff",
      destinationAttr: "total-armor",
    });
  }
);

on("change:specialization", function () {
  getAttrs(["specialization"], function (values) {
    setAttrs({
      "title-status": values["specialization"],
    });
  });
});

on("clicked:test-mod", function () {
  getAttrs(
    [
      "wsp-select",
      "skill-select",
      "skill_name_inne1",
      "skill_name_inne2",
      "skill_name_inne3",
    ],
    function (values) {
      const wsp = values["wsp-select"];
      const skill = values["skill-select"];
      let name = "";
      if (!skill_code_translate[skill]) {
        const tmp_skill = `skill_name_${skill}`;
        name = `${values[tmp_skill]}\n(${wsp_code_translate[wsp]})`;
        console.log(skill);
        console.log(values[tmp_skill]);
      } else {
        name = `${skill_code_translate[skill]}\n(${wsp_code_translate[wsp]})`;
      }
      const wsp_mod = `${wsp}_mod`;
      roll_test("test", name, wsp, wsp_mod, skill);
    }
  );
});

on("change:state sheet:opened", function () {
  getAttrs(["state"], function (values) {
    const status_difficulty = [0, 20, 40, 20, 40, 60, 80];
    setAttrs({
      "state-value": status_difficulty[parseInt(values["state"] || 0)],
    });
  });
});
</script><rolltemplate class="sheet-rolltemplate-test">
    <div class="sheet-rolltemplate-container">
        <div class="sheet-rolltemplate-info" title="{{message}}{{messageCombat}}">
            <h2>{{name}}
                <br>
                {{test_name}} 
                <br> 
                {{#rollTotal() computed::test_type_txt 0}}Test Zamknięty{{/rollTotal() computed::test_type_txt 0}}
                {{#rollTotal() computed::test_type_txt 1}}Test Otwarty{{/rollTotal() computed::test_type_txt 1}}
                {{#rollTotal() computed::test_type_txt 2}}Test Walki{{/rollTotal() computed::test_type_txt 2}}
                {{#rollTotal() computed::test_type_txt 3}}Test Walki Otwarty{{/rollTotal() computed::test_type_txt 3}}
            </h2>
            <h2>
                {{#rollTotal() computed::difficulty_lvl_val 0}}Łatwy{{/rollTotal() computed::difficulty_lvl_val 0}}
                {{#rollTotal() computed::difficulty_lvl_val 1}}Przeciętny{{/rollTotal() computed::difficulty_lvl_val 1}}
                {{#rollTotal() computed::difficulty_lvl_val 2}}Problematyczny{{/rollTotal() computed::difficulty_lvl_val 2}}
                {{#rollTotal() computed::difficulty_lvl_val 3}}Trudny{{/rollTotal() computed::difficulty_lvl_val 3}}
                {{#rollTotal() computed::difficulty_lvl_val 4}}Bardzo Trudny{{/rollTotal() computed::difficulty_lvl_val 4}}
                {{#rollTotal() computed::difficulty_lvl_val 5}}Cholernie Trudny{{/rollTotal() computed::difficulty_lvl_val 5}}
                {{#rollTotal() computed::difficulty_lvl_val 6}}Fartowny{{/rollTotal() computed::difficulty_lvl_val 6}}
                {{#rollTotal() computed::difficulty_lvl_val 7}}Mistrzowski{{/rollTotal() computed::difficulty_lvl_val 7}}
                {{#rollTotal() computed::difficulty_lvl_val 8}}Arcymistrzowski{{/rollTotal() computed::difficulty_lvl_val 8}}
            </h2>              
            <h2>
                {{#rollTotal() computed::test_type_txt 1}}
                {{#rollBetween() computed::res 0 100}}Punkty sukcesu:{{/rollBetween() computed::res 0 100}}
                {{#rollBetween() computed::res -100 -1}}Punkty porażki:{{/rollBetween() computed::res -100 -1}}
                <span class="sheet-rolltemplate-open-result">{{computed::res}}</span>
                {{/rollTotal() computed::test_type_txt 1}}
                {{#rollTotal() computed::test_type_txt 3}}
                {{#rollBetween() computed::res 0 100}}Punkty sukcesu:{{/rollBetween() computed::res 0 100}}
                {{#rollBetween() computed::res -100 -1}}Punkty porażki:{{/rollBetween() computed::res -100 -1}}
                <span class="sheet-rolltemplate-open-result">{{computed::res}}</span>
                {{/rollTotal() computed::test_type_txt 3}}
            </h2>
        </div>
        <div class="sheet-rolltemplate-rolls"  title="{{message}}">
            {{#rollBetween() dice 1 3}}
            {{#rollTotal() computed::status1 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status1 0}}
            {{#rollTotal() computed::status1 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status1 1}}
                <p class="sheet-rolltemplate-result-dice-value">{{roll1}}</p>
            </div>
            {{/rollBetween() dice 1 3}}
            {{#rollBetween() dice 2 3}}
            {{#rollTotal() computed::status2 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status2 0}}
            {{#rollTotal() computed::status2 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status2 1}}
                <p class="sheet-rolltemplate-result-dice-value">{{roll2}}</p>
            </div>
            {{/rollBetween() dice 2 3}}
            {{#rollBetween() dice 3 3}}
            {{#rollTotal() computed::status3 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status3 0}}
            {{#rollTotal() computed::status3 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status3 1}}
            <p class="sheet-rolltemplate-result-dice-value">{{roll3}}</p>
            </div>
            {{/rollBetween() dice 3 3}}
        </div>
        {{#rollTotal() options 1}}
        <div class="sheet-rolltemplate-rolls">
            {{tOpen}}
            {{tCombat}}
            {{tOpenCombat}}
        </div>
        {{/rollTotal() options 1}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-hit-location">
    {{#rollBetween() result 1 2}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/IKNphps.png');">    
    {{/rollBetween() result 1 2}}
    {{#rollBetween() result 3 4}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/sBpRado.png');">
    {{/rollBetween() result 3 4}}
    {{#rollBetween() result 5 6}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/exzWuO0.png');">
    {{/rollBetween() result 5 6}}
    {{#rollBetween() result 7 15}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/NQHkKby.png');">
    {{/rollBetween() result 7 15}}
    {{#rollBetween() result 16 17}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/KtQqeum.png');">
    {{/rollBetween() result 16 17}}
    {{#rollBetween() result 18 19}}
    <div class="sheet-rolltemplate-b-hit-location-background" style="background-image: url('https://i.imgur.com/mZXaqvx.png');">
    {{/rollBetween() result 18 19}}
    <h1>{{result}}</h1>
    <h1>
        {{#rollBetween() result 1 2}} 
            (1-2)
            <br>
            Głowa
        {{/rollBetween() result 1 2}}
        {{#rollBetween() result 3 4}} 
            (3-4)
            <br>
            Prawa Ręka
        {{/rollBetween() result 3 4}}
        {{#rollBetween() result 5 6}} 
            (5-6)
            <br>
            Lewa Ręka
        {{/rollBetween() result 5 6}}
        {{#rollBetween() result 7 15}} 
            (7-15)
            <br>
            Korpus
        {{/rollBetween() result 7 15}}
        {{#rollBetween() result 16 17}} 
            (16-17)
            <br>
            Prawa Noga
        {{/rollBetween() result 16 17}}
        {{#rollBetween() result 18 19}} 
            (18-19)
            <br>
            Lewa Noga
        {{/rollBetween() result 18 19}}
    </h1>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-jam">
    <h1 class="sheet-rolltemplate-jam-text">
        {{result}} - 
        {{#rollBetween() result 1 10}} 
        (1-10) spluwa zacięta. Odblokowanie cała tura.
        {{/rollBetween() result 1 10}}
        {{#rollBetween() result 11 18}} 
        (11-18) spluwa zepsuta. Można naprawić po walce.
        {{/rollBetween() result 11 18}}
        {{#rollBetween() result 19 20}} 
        (19-20) spluwa zniszczona. Do odratowania przez specjalistę.
        {{/rollBetween() result 19 20}}
    </h1>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-denided">
    <h1 class="sheet-rolltemplate-jam-text">
        {{range}}m jes poza zasięgiem tej broni
    </h1>
</rolltemplate>
