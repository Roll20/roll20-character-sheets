<!-- ~~~~~~~~~ Star Trek: Adventures - Official Sheet by Roll20 HTML File ~~~~~~~~~ -->
 <!-- ~~~~~~~~ Character Sheet Page, default view ~~~~~~~~ -->
<input class="sheet_type" name="attr_sheet_type" type="hidden" value="character">
<input class="settings_toggle" name="attr_settings_toggle" type="hidden" value="off" />
<input class="sheet_color" name="attr_sheet_color" type="hidden" value="black" />

<!-- ~~~~~~~~ Character Sheet Page, default view ~~~~~~~~ -->
<div class="character">
	<!--- Sheet Decorations -->
	<div class="vertdeco"></div>
	<div class="sidedeco-purple"></div>
	<div class="sidedeco-pink"></div>
	<div class="topdeco-purple"></div>
	<!-- Character Traits Section -->
	<div class="border-top">
		<div class="topsection">
			<div class="header toggle">
				<input type="checkbox" name="attr_settings_toggle" title="Sheet Settings & Notes"/><span>y</span>
				<h1 data-i18n="starfleet-personnel-file">STARFLEET PERSONNEL FILE</h1>
			</div>
			<div class="headerrow">
				<span data-i18n="name:" class="header-label">NAME </span><input type="text" name="attr_character_name" title="@{character_name}" spellcheck="false" /><br />
			</div>
			<div class="col">
				<span data-i18n="species:" class="header-label">SPECIES </span><input type="text" name="attr_species" title="@{species}" spellcheck="false" /><br />
				<span data-i18n="environment:" class="header-label">ENVIRONMENT </span><input type="text"  name="attr_environment" title="@{environment}" spellcheck="false" /><br />
			</div>
			<div class="col">
				<span data-i18n="rank:" class="header-label">RANK </span><input type="text" name="attr_rank" title="@{rank}" spellcheck="false" /><br />
				<span data-i18n="upbringing:" class="header-label">UPBRINGING </span><input type="text" name="attr_upbringing" title="@{upbringing}" spellcheck="false" /><br />
			</div>
			<div class="headerrow">
				<span data-i18n="assignment:" class="header-label">ASSIGNMENT </span><input type="text" name="attr_assignment" title="@{assignment}" spellcheck="false" /><br />
			</div>
			<div class="headerrow">
				<span data-i18n="traits:" class="header-label">TRAITS </span><input type="text" class="attr-traits" name="attr_traits" title="@{traits}" spellcheck="false" /><br />
			</div>
		</div>
	</div><!-- End Character Traits Section -->
	<div class="border-bottom">
		<div class="body">
			<!-- Clicking Attributes & a Discipline will provide a dice pool for the Dice Roller. User feedback still needs to be added.-->
			<div class="col-sixtypercent">
			<!-- Attributes -->
				<div class="section-heading"><span data-i18n="attributes">ATTRIBUTES</span></div>
					<input type="hidden" name="attr_attributeName" value="Control"/>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{control}" title="@{attribute}" checked="checked" />
						<span data-i18n="control" class="label-capsule-left">CONTROL</span>
					</span>
					<input type="number" class="capsule" name="attr_control" min="0" value="7" title="@{control}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{fitness}" title="@{attribute}" />
						<span data-i18n="fitness" class="label-capsule-left">FITNESS</span>
					</span>
					<input type="number" class="capsule" name="attr_fitness" min="0" value="7" title="@{fitness}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{presence}" title="@{attribute}" />
						<span data-i18n="presence" class="label-capsule-left">PRESENCE</span>
					</span>
					<input type="number" class="capsule" name="attr_presence" min="0" value="7" title="@{presence}" />
				</div>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{daring}" title="@{attribute}" />
						<span data-i18n="daring" class="label-capsule-left">DARING</span>
					</span>
					<input type="number" class="capsule" name="attr_daring" min="0" value="7" title="@{daring}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{insight}" title="@{attribute}" />
						<span data-i18n="insight" class="label-capsule-left">INSIGHT</span>
					</span>
					<input type="number" class="capsule" name="attr_insight" min="0"  value="7" title="@{insight}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_attribute" value="@{reason}" title="@{attribute}" />
						<span data-i18n="reason" class="label-capsule-left">REASON</span>
					</span>
					<input type="number" class="capsule" name="attr_reason" min="0" value="7" title="@{reason}" />
				</div>
			<!-- Disciplines -->
				<div class="section-heading"><span data-i18n="disciplines">DISCIPLINES</span></div>
					<input type="hidden" name="attr_disciplineName" value="Command"/>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{command}" title="@{discipline}" checked="checked" />
						<span data-i18n="command" class="label-capsule-left">COMMAND</span>
					</span>
					<input type="number" class="capsule" name="attr_command" min="0" value="1" title="@{command}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{security}" title="@{discipline}" />
						<span data-i18n="security" class="label-capsule-left">SECURITY</span>
					</span>
					<input type="number" class="capsule" name="attr_security" min="0" value="1" title="@{security}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{science}" title="@{discipline}" />
						<span data-i18n="science" class="label-capsule-left">SCIENCE</span>
					</span>
					<input type="number" class="capsule" name="attr_science" min="0" value="1" title="@{science}" />
				</div>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{conn}" title="@{discipline}" />
						<span data-i18n="conn" class="label-capsule-left">CONN</span>
					</span>
					<input type="number" class="capsule" name="attr_conn" min="0" value="1" title="@{conn}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{engineering}" title="@{discipline}" />
						<span data-i18n="engineering" class="label-capsule-left">ENGINEERING</span>
					</span>
					<input type="number" class="capsule" name="attr_engineering" min="0" value="1" title="@{engineering}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_discipline" value="@{medicine}" title="@{discipline}" />
						<span data-i18n="medicine" class="label-capsule-left">MEDICINE</span>
					</span>
					<input type="number" class="capsule" name="attr_medicine" min="0" value="1" title="@{medicine}" />
				</div>
				<!-- Values -->
				<div class="section-heading"><span data-i18n="values">VALUES</span></div>
				<div class="textbox toggle lefttoggles">
					<input type="checkbox" class="options-flag" name="attr_values-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_values" spellcheck="false"></textarea>
					</div>
					<div class="display">
	                    <span name="attr_values"></span>
	                </div>
	             </div>
				<!--Determination-->
				<div class="determination">
					<input type="radio" class="radio-header" name="attr_determination" value="0" title="@{determination}" checked="checked" /><span data-i18n="determination">DETERMINATION</span>
					<div class="boxes-determination">
						<input type="radio" name="attr_determination" value="1" title="@{determination}" /><span></span>
						<input type="radio" name="attr_determination" value="2" title="@{determination}" /><span></span>
						<input type="radio" name="attr_determination" value="3" title="@{determination}" /><span></span>
					</div>
				</div>
				<!--Threat-->
				<div class="determination">
					<input type="radio" class="radio-header threat" name="attr_threat" value="0" title="@{threat}" checked="checked" /><span data-i18n="threat">THREAT</span>
					<div class="boxes-determination">
						<input type="radio" name="attr_threat" value="1" title="@{threat}" /><span></span>
						<input type="radio" name="attr_threat" value="2" title="@{threat}" /><span></span>
						<input type="radio" name="attr_threat" value="3" title="@{threat}" /><span></span>
						<input type="radio" name="attr_threat" value="4" title="@{threat}" /><span></span>
						<input type="radio" name="attr_threat" value="5" title="@{threat}" /><span></span>
						<input type="radio" name="attr_threat" value="6" title="@{threat}" /><span></span>
					</div>
				</div>
				<!--Momentum -->
				<div class="determination">
					<input type="radio" class="radio-header momentum" name="attr_momentum" value="0" title="@{momentum}" checked="checked" /><span data-i18n="momentum">MOMENTUM</span>
					<div class="boxes-determination">
						<input type="radio" name="attr_momentum" value="1" title="@{momentum}" /><span></span>
						<input type="radio" name="attr_momentum" value="2" title="@{momentum}" /><span></span>
						<input type="radio" name="attr_momentum" value="3" title="@{momentum}" /><span></span>
						<input type="radio" name="attr_momentum" value="4" title="@{momentum}" /><span></span>
						<input type="radio" name="attr_momentum" value="5" title="@{momentum}" /><span></span>
						<input type="radio" name="attr_momentum" value="6" title="@{momentum}" /><span></span>
					</div>
				</div>
				<!-- Talents -->
				<div class="section-heading"><span data-i18n="talents">TALENTS</span></div>
				<div class="textbox toggle lefttoggles">
					<input type="checkbox" class="options-flag" name="attr_talents-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_talents" spellcheck="false"></textarea>
					</div>
					<div class="display">
	                    <span name="attr_talents"></span>
	                </div>
	            </div>
	            <!-- Weapons -->
				<div class="section-heading"><span data-i18n="weapons">WEAPONS</span></div>
				<fieldset class="repeating_weapons">
					<div class="weapon toggle">
						<input type="hidden" name="attr_damageRoll" value="" />
						<div class="weapon-row">
							<span data-i18n="name-type" class="label-capsule-weapon">NAME/TYPE</span><input type="text" class="weapon-name" name="attr_weapon_name" spellcheck="false" />
							<button class="weapon-button" type="roll" name="PcDamageRoll" value="@{whispertype} &{template:strek}@{damageRoll}{{attribute=@{weapon_quality}}}{{discipline=@{weapon_effect}}}{{rollname=@{weapon_name}}}" title="Security + Weapon Damage">
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
							<input type="number" class="capsule" name="attr_weapon_damage" value="0" title="Weapon Damage" />
						</div>
						<div class="weapon-row">
							<span data-i18n="qualities" class="label-capsule-weapon">QUALITIES</span><input type="text" class="weapon-quality" name="attr_weapon_quality" spellcheck="false" />
						</div>
						<div class="weapon_settings">
							<div class="weapon-row">
								<span data-i18n="effects" class="label-capsule-weapon">EFFECTS</span><input type="text" class="weapon-effect" name="attr_weapon_effect" spellcheck="false" />
								<div class="flexinl">
									<label class="labelcheck"><input type="radio" name="attr_weapon_type" value="Melee" /><span data-i18n="melee">Melee</span></label>
									<label class="labelcheck"><input type="radio" name="attr_weapon_type" value="Range" /><span data-i18n="range">Range</span></label>
								</div>
							</div>
						</div>
					</div>
					<hr />
				</fieldset>
			</div> <!-- End of the right column -->

		<!-- Beginning of the second column -->
			<div class="col col-fortypercent">
				<div class="section-heading"><span data-i18n="dice-roller">DICE ROLLER</span></div>
				<div class="diceroller">
				<!--Calculate the Target Number-->
					<input type="hidden" name="attr_target" value="[[@{attribute} + @{discipline}]]" disabled="disabled" />
					<!--Focus Used? -->
					<div class="col">
						<div class="diceroller-label"><span data-i18n="focus-used" class="label longtext">FOCUS USED: </span></div>
						<div class="diceroller-label"><span data-i18n="complication-range" class="label longtext">COMPLICATION RANGE: </span></div>
						<div class="diceroller-label"><span data-i18n="task-roll" class="label">TASK ROLL: </span></div>
						<div class="diceroller-label"><span data-i18n="challenge-dice" class="label">CHALLENGE DICE: </span></div>
					</div>
					<div class="col">
						<div class="diceroller-focus">
							<input type="radio" name="attr_focus" value="1" checked="checked" /><span data-i18n="no" class="label">NO</span>
							<input type="radio" name="attr_focus" value="@{discipline}" /><span data-i18n="yes" class="label">YES</span>
						</div>
						<!-- Complication Range -->
						<div class="diceroller-numbers">
							<input type="radio" name="attr_complication" value="20"  checked="checked"  /><span data-i18n="one" class="label">1 </span>
	 						<input type="radio" name="attr_complication" value="19" /><span data-i18n="two" class="label">2 </span>
							<input type="radio" name="attr_complication" value="18" /><span data-i18n="three" class="label">3 </span>
							<input type="radio" name="attr_complication" value="17" /><span data-i18n="four" class="label">4 </span>
							<input type="radio" name="attr_complication" value="16" /><span data-i18n="five" class="label">5 </span>
						</div>
						<!--Roll the dice!-->
						<div class="diceroller-numbers">
							<input type="hidden" name="attr_diceRoll" value="{{dice1=[[{{ceil(((@{target})-d20cf>@{complication}cs@{focus}+1e-2)/((@{target})-(@{focus}))),{2}}kl1,{0}}kh1]]}}{{dice2=[[{{ceil(((@{target})-d20cf>@{complication}cs@{focus}+1e-2)/((@{target})-(@{focus}))),{2}}kl1,{0}}kh1]]}}" />
							<button class="dice-button" type="roll" name="PcTaskRoll" value="@{whispertype} &{template:strek}@{diceRoll}{{attribute=@{attributeName} (@{attribute})}}{{discipline=@{disciplineName} (@{discipline})}}{{rollname=^{task}}}" />
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
	 						<input type="radio" name="attr_addDice" value="1" /><span data-i18n="one-d" class="label">1 </span>
	 						<input type="radio" name="attr_addDice" value="2" checked="checked"  /><span data-i18n="two-d" class="label">2 </span>
							<input type="radio" name="attr_addDice" value="3" /><span data-i18n="three-d" class="label">3 </span>
							<input type="radio" name="attr_addDice" value="4" /><span data-i18n="four-d" class="label">4 </span>
							<input type="radio" name="attr_addDice" value="5" /><span data-i18n="five-d" class="label">5 </span>
						</div>
						<!-- Challenge Dice aka Cover Dice-->
						<div>
							<input type="hidden" name="challengeRoll" value="" />
							<button class="challenge-button" type="roll" name="PcChallengeRoll" value="@{whispertype} &{template:strek}{{target=@{challenge}}}{{discipline=^{rolling} @{challenge} ^{dice}}}{{rollname=^{challenge-dice-u}}}@{challengeRoll}" />
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
							<input type="number" class="capsule" name="attr_challenge" min="0" value="0" title="@{challenge}" />
						</div>
					</div>
				</div><!-- End of dice roller -->
				<!-- Focuses -->
				<div class="section-heading"><span data-i18n="focuses">FOCUSES</span></div>
				<div class="textbox toggle">
					<input type="checkbox" class="options-flag" name="attr_focus-box-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_focuses" spellcheck="false"></textarea>
					</div>
					<div class="display">
	                    <span name="attr_focuses"></span>
	                </div>
	             </div>

				<!-- Stress (The # of visible bubbles depends on the score of Fitness and Security rating) -->
				<div class="stress">
					<input type="radio" class="radio-header-stress" name="attr_stress" value="0" title="@{stress}" checked="checked" /><div class="section-heading"><span data-i18n="stress">STRESS</span></div>
					<div class="boxes-stress">
						<input type="hidden" name="attr_stress_1_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="1" /><span></span>
						<input type="hidden" name="attr_stress_2_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="2" /><span></span>
						<input type="hidden" name="attr_stress_3_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="3" /><span></span>
						<input type="hidden" name="attr_stress_4_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="4" /><span></span>
						<input type="hidden" name="attr_stress_5_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="5"/><span></span>
						<input type="hidden" name="attr_stress_6_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="6" /><span></span>
						<input type="hidden" name="attr_stress_7_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="7" /><span></span>
						<input type="hidden" name="attr_stress_8_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="8"/><span></span>
						<input type="hidden" name="attr_stress_9_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="9"/><span></span>
						<input type="hidden" name="attr_stress_10_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="10"/><span></span>
						<input type="hidden" name="attr_stress_11_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="11"/><span></span>
						<input type="hidden" name="attr_stress_12_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="12"/><span></span>
						<input type="hidden" name="attr_stress_13_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="13"/><span></span>
						<input type="hidden" name="attr_stress_14_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="14"/><span></span>
						<input type="hidden" name="attr_stress_15_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="15" /><span></span>
						<input type="hidden" name="attr_stress_16_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="16" /><span></span>
						<input type="hidden" name="attr_stress_17_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="17" /><span></span>
						<input type="hidden" name="attr_stress_18_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="18" /><span></span>
						<input type="hidden" name="attr_stress_19_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="19" /><span></span>
						<input type="hidden" name="attr_stress_20_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="20"/><span></span>
						<input type="hidden" name="attr_stress_21_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="21"/><span></span>
						<input type="hidden" name="attr_stress_22_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="22"/><span></span>
						<input type="hidden" name="attr_stress_23_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="23"/><span></span>
						<input type="hidden" name="attr_stress_24_enabled" value="true"/>
						<input type="radio" name="attr_stress" value="24"/><span></span>
					</div>
				</div>
				<!-- Injuries -->
				<div class="section-heading"><span data-i18n="injuries">INJURIES</span></div>
				<div class="textbox toggle">
					<input type="checkbox" class="options-flag" name="attr_injuries-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_injuries" spellcheck="false"></textarea>
					</div>
					<div class="display">
	                    <span name="attr_injuries"></span>
	                </div>
	             </div>
	      		  <!-- Other Equipment -->
				<div class="section-heading"><span data-i18n="other-equipment">OTHER EQUIPMENT</span></div>
				<div class="resistance">
					<span data-i18n="resistance" class="capsule-scale capsule-resist">Resistance</span>
					<input type="number" class="capsule-orange capsule-resist" name="attr_resistance" min="0" value="0" title="@{resistance}" />
				</div>
				<div class="textbox toggle">
					<input type="checkbox" class="options-flag" name="attr_equipment-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_equipment" spellcheck="false"></textarea>
					</div>
					<div class="display">
	                    <span name="attr_equipment"></span>
	                </div>
	             </div>
			</div><!-- End of the Columns for Right Side-->
		</div><!-- End of Sheet Body for the Character Sheet-->
	</div><!-- End the Background -->
</div><!-- ~~~~~~~~ End of Character Sheet Page ~~~~~~~~ -->

<div class="starship">
	<!--- Sheet Decorations -->
	<div class="vertdeco"></div>
	<div class="sidedeco-purple"></div>
	<div class="topdeco-purple"></div>
	<!-- Starship Traits Section -->
	<div class="border-top">
		<div class="topsection">
			<div class="header toggle">
				<input type="checkbox" name="attr_settings_toggle" title="Sheet Settings & Notes"/><span>y</span>
				<input class="sheet_type" name="attr_sheet_type" type="hidden" value=""><h1 class="shipheader" data-i18n="starship-registry-entry">STARSHIP REGISTRY ENTRY</h1>
				<input class="sheet_type" name="attr_sheet_type" type="hidden" value=""><h1 class="npc" data-i18n="sheet-type-npc">NPC STARSHIP</h1>
			</div>
			<div class="col">
				<span data-i18n="name-s" class="header-label">NAME: </span><input type="text" name="attr_ship_name" title="@{ship-name}" spellcheck="false" /><br />
				<span data-i18n="service-date" class="header-label longtext">SERVICE DATE: </span><input type="text" name="attr_ship-service-date" title="@{ship-service-date}" spellcheck="false" /><br />
				<span data-i18n="mission-profile" class="header-label longtext">MISSION PROFILE: </span><input type="text" name="attr_ship-mission-profile" title="@{ship-mission-profile}" spellcheck="false" /><br />
			</div>
			<div class="col">
				<span data-i18n="designation" class="header-label">DESIGNATION: </span><input type="text" name="attr_ship-designation" title="@{ship-designation}" spellcheck="false" /><br />
				<span data-i18n="space-frame" class="header-label longtext">SPACE FRAME: </span><input type="text" name="attr_ship-space-frame" title="@{ship-space-frame}" spellcheck="false" /><br />
				<span data-i18n="refit" class="header-label">REFIT: </span><input type="text" name="attr_ship-refit" title="@{ship-refit}" spellcheck="false" /><br />
			</div>
			<div class="headerrow">
				<span data-i18n="traits" class="header-label">TRAITS: </span><input type="text" class="attr-traits" name="attr_ship-traits" title="@{ship-traits}" spellcheck="false" /><br />
			</div>
		</div>
    </div><!-- End Starship Traits Section -->
	<!-- Starship Body -->
	<div class="border-bottom">
		<div class="body">
			<div class="col-ship">
				<!-- Systems -->
				<div class="section-heading"><span data-i18n="systems">SYSTEMS</span></div>
					<input type="hidden" name="attr_systemName" value=""/>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_engines}" title="@{system}" />
						<span data-i18n="engines" class="label-capsule-left">ENGINES</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_engines" min="0" value="0" title="@{ship_engines}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_computers}" title="@{system}" />
						<span data-i18n="computers" class="label-capsule-left">COMPUTERS</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_computers" min="0"  value="0" title="@{ship_computers}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_weapons}" title="@{system}" />
						<span data-i18n="weapons-sy" class="label-capsule-left">WEAPONS</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_weapons" min="0"  value="0" title="@{ship_weapons}" />
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-engines" value="0" title="@{breach-engines}" checked="checked" />
					<span data-i18n="breaches-e">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-engines" value="1" title="@{breach-engines}" /><span></span>
						<input type="radio" name="attr_breach-engines" value="2" title="@{breach-engines}" /><span></span>
						<input type="radio" name="attr_breach-engines" value="3" title="@{breach-engines}" /><span></span>
						<input type="radio" name="attr_breach-engines" value="4" title="@{breach-engines}" /><span></span>
						<input type="radio" name="attr_breach-engines" value="5" title="@{breach-engines}" /><span></span>
						<input type="radio" name="attr_breach-engines" value="6" title="@{breach-engines}" /><span></span>
					</div>
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-computers" value="0" title="@{breach-computers}" checked="checked" />
					<span data-i18n="breaches-c">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-computers" value="1" title="@{breach-computers}" /><span></span>
						<input type="radio" name="attr_breach-computers" value="2" title="@{breach-computers}" /><span></span>
						<input type="radio" name="attr_breach-computers" value="3" title="@{breach-computers}" /><span></span>
						<input type="radio" name="attr_breach-computers" value="4" title="@{breach-computers}" /><span></span>
						<input type="radio" name="attr_breach-computers" value="5" title="@{breach-computers}" /><span></span>
						<input type="radio" name="attr_breach-computers" value="6" title="@{breach-computers}" /><span></span>
					</div>
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-weapons" value="0" title="@{breach-weapons}" checked="checked" />
					<span data-i18n="breaches-w">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-weapons" value="1" title="@{breach-weapons}" /><span></span>
						<input type="radio" name="attr_breach-weapons" value="2" title="@{breach-weapons}" /><span></span>
						<input type="radio" name="attr_breach-weapons" value="3" title="@{breach-weapons}" /><span></span>
						<input type="radio" name="attr_breach-weapons" value="4" title="@{breach-weapons}" /><span></span>
						<input type="radio" name="attr_breach-weapons" value="5" title="@{breach-weapons}" /><span></span>
						<input type="radio" name="attr_breach-weapons" value="6" title="@{breach-weapons}" /><span></span>
					</div>
				</div>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_structure}" title="@{system}" />
						<span data-i18n="structure" class="label-capsule-left">STRUCTURE</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_structure" min="0" value="0" title="@{ship_structure}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_sensors}" title="@{system}" />
						<span data-i18n="sensors" class="label-capsule-left">SENSORS</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_sensors" min="0" value="0" title="@{ship_sensors}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_system" value="@{ship_communication}" title="@{system}" />
						<span data-i18n="communcation" class="label-capsule-left">COMMUNICATION</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_communication" min="0" value="0" title="@{ship_communication}" />
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-structure" value="0" title="@{breach-structure}" checked="checked" />
					<span data-i18n="breaches-s">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-structure" value="1" title="@{breach-structure}" /><span></span>
						<input type="radio" name="attr_breach-structure" value="2" title="@{breach-structure}" /><span></span>
						<input type="radio" name="attr_breach-structure" value="3" title="@{breach-structure}" /><span></span>
						<input type="radio" name="attr_breach-structure" value="4" title="@{breach-structure}" /><span></span>
						<input type="radio" name="attr_breach-structure" value="5" title="@{breach-structure}" /><span></span>
						<input type="radio" name="attr_breach-structure" value="6" title="@{breach-structure}" /><span></span>
					</div>
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-sensors" value="0" title="@{breach-sensors}" checked="checked" />
					<span data-i18n="breaches-st">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-sensors" value="1" title="@{breach-sensors}" /><span></span>
						<input type="radio" name="attr_breach-sensors" value="2" title="@{breach-sensors}" /><span></span>
						<input type="radio" name="attr_breach-sensors" value="3" title="@{breach-sensors}" /><span></span>
						<input type="radio" name="attr_breach-sensors" value="4" title="@{breach-sensors}" /><span></span>
						<input type="radio" name="attr_breach-sensors" value="5" title="@{breach-sensors}" /><span></span>
						<input type="radio" name="attr_breach-sensors" value="6" title="@{breach-sensors}" /><span></span>
					</div>
				</div>
				<div class="breaches">
					<input class="radio-header-breaches" type="radio" name="attr_breach-communications" value="0" title="@{breach-communications}" checked="checked" />
					<span data-i18n="breaches-se">BREACHES</span>
					<div class="boxes-breaches">
						<input type="radio" name="attr_breach-communications" value="1" title="@{breach-communications}" /><span></span>
						<input type="radio" name="attr_breach-communications" value="2" title="@{breach-communications}" /><span></span>
						<input type="radio" name="attr_breach-communications" value="3" title="@{breach-communications}" /><span></span>
						<input type="radio" name="attr_breach-communications" value="4" title="@{breach-communications}" /><span></span>
						<input type="radio" name="attr_breach-communications" value="5" title="@{breach-communications}" /><span></span>
						<input type="radio" name="attr_breach-communications" value="6" title="@{breach-communications}" /><span></span>
					</div>
				</div>

			<!-- Ship Scale -->
				<div class="section-heading"><span data-i18n="ship">SHIP</span></div>
				<div class="row">
					<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_ship_diagram.png" />
					<div class="ship-scale">
						<span data-i18n="scale" class="capsule-scale">SCALE</span>
						<input type="number" class="capsule-orange" name="attr_ship_scale" value="2" title="@{ship_scale}" />
						<div class="ship-resistance">
							<span data-i18n="resistance" class="capsule-scale">Resistance</span>
							<input type="number" class="capsule-orange" name="attr_ship_resistance" value="2" title="@{ship_resistance}" />
						</div>
					</div>
				</div>

			<!-- Departments -->
				<div class="section-heading"><span data-i18n="departments">DEPARTMENTS</span></div>
					<input type="hidden" name="attr_departmentName" value=""/>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_command}" title="@{department}" />
						<span data-i18n="command-s" class="label-capsule-left">COMMAND</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_command" value="1" title="@{ship_command}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_security}" title="@{department}" />
						<span data-i18n="security-s" class="label-capsule-left">SECURITY</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_security" value="1" title="@{ship_security}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_science}" title="@{department}" />
						<span data-i18n="science-s" class="label-capsule-left">SCIENCE</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_science" value="1" title="@{ship_science}" />
				</div>
				<div class="row">
					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_conn}" title="@{department}" />
						<span data-i18n="conn-s" class="label-capsule-left">CONN</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_conn" value="1" title="@{ship_conn}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_engineering}" title="@{department}" />
						<span data-i18n="engineering-s" class="label-capsule-left">ENGINEERING</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_engineering" value="1" title="@{ship_engineering}" />

					<span class="boxes-attrdisc"><input type="radio" name="attr_department" value="@{ship_medicine}" title="@{department}" />
						<span data-i18n="medicine-s" class="label-capsule-left">MEDICINE</span>
					</span>
					<input type="number" class="capsule" name="attr_ship_medicine" value="1" title="@{ship_medicine}" />
				</div>

			<!-- Talents -->
				<div class="section-heading"><span>TALENTS</span></div>
				<div class="textbox toggle lefttoggles">
					<input type="checkbox" class="options-flag" name="attr_talents-toggle" checked="checked" /><span>y</span>
					<div class="options">
						<textarea name="attr_ship-talents" spellcheck="false"></textarea>
					</div>
					<div class="display">
			            <span name="attr_ship-talents"></span>
			        </div>
			    </div>
			</div> <!-- End of the left column->

		<!- Beginning of the second column -->
			<div class="col-ship-right">
			<!-- The Dice Roller is currently broken! It needs to be replaced when the finished dice roller above is readys -->
				<div class="section-heading"><span data-i18n="dice-roller-s">DICE ROLLER</span></div>
				<div class="diceroller">
				<!--Calculate the Target Number-->
					<input type="hidden" name="attr_crew_target" value="[[@{crew_attribute} + @{crew_discipline}]]" disabled="disabled" />
					<input type="hidden" name="attr_ship_target" value="[[@{system} + @{department}]]" disabled="disabled" />
					<!--Focus Used? -->
					<div class="col">
						<input class="sheet_type" name="attr_sheet_type" type="hidden" value="">
						<div class="npc diceroller-label"><span data-i18n="npc-attr" class="label">ATTRIBUTE</span>
							<input type="number" class="capsule" name="attr_crew_attribute" min="0" value="0" title="@{crew_attribute}" />
						</div>
						<div class="diceroller-label"><span data-i18n="focus-used" class="label">FOCUS USED: </span></div>
						<div class="diceroller-label"><span data-i18n="complication-range-s" class="label">COMPLICATION RANGE: </span></div>
						<input class="sheet_type" name="attr_sheet_type" type="hidden" value=""><div class="npc diceroller-label"><span data-i18n="crewtask-roll" class="label">CREW TASK ROLL: </span></div>
						<div class="diceroller-label"><span data-i18n="shiptask-roll" class="label">STARSHIP TASK ROLL: </span></div>
						<div class="diceroller-label"><span data-i18n="challenge-dice-s" class="label">CHALLENGE DICE: </span></div>
					</div>
					<div class="col">
						<input class="sheet_type" name="attr_sheet_type" type="hidden" value="">
						<div class="npc diceroller-label"><span data-i18n="npc-disc" class="label">DISCIPLINE</span>
							<input type="number" class="capsule" name="attr_crew_discipline" min="0" value="0" title="@{crew_discipline}" />
						</div>
						<!-- Focus Toggles -->
						<div class="diceroller-focus">
							<input type="radio" name="attr_ship_focus" value="1" checked="checked" />
							<span data-i18n="no" class="label">NO</span>
							<input type="radio" name="attr_ship_focus" value="@{discipline}" />
							<span data-i18n="yes" class="label">YES</span>
						</div>
						<!-- Complication Range -->
						<div class="diceroller-numbers">
							<input type="radio" name="attr_ship_complication" value="20"  checked="checked"  /><span data-i18n="one-s" class="label">1 </span>
	 						<input type="radio" name="attr_ship_complication" value="19" /><span data-i18n="two-s" class="label">2 </span>
							<input type="radio" name="attr_ship_complication" value="18" /><span data-i18n="three-s" class="label">3 </span>
							<input type="radio" name="attr_ship_complication" value="17" /><span data-i18n="four-s" class="label">4 </span>
							<input type="radio" name="attr_ship_complication" value="16" /><span data-i18n="five-s" class="label">5 </span>
						</div>
						<!--Crew Dice Roller the dice!-->
						<input class="sheet_type" name="attr_sheet_type" type="hidden" value="">
						<div class="npc diceroller-numbers">
							<input type="hidden" name="attr_crew_diceRoll" value="{{dice1=[[{{ceil(((@{crew_target})-d20cf>@{ship_complication}cs@{ship_focus}+1e-2)/((@{crew_target})-(@{ship_focus}))),{2}}kl1,{0}}kh1]]}}{{dice2=[[{{ceil(((@{crew_target})-d20cf>@{ship_complication}cs@{ship_focus}+1e-2)/((@{crew_target})-(@{ship_focus}))),{2}}kl1,{0}}kh1]]}}" />
							<button class="staroll crew-button dice-button" type="roll" name="CrewDiceRoll" value="@{whispertype} &{template:strek}@{crew_diceRoll}{{attribute=^{npc-attr} (@{crew_attribute})}}{{discipline=^{npc-disc} (@{crew_discipline})}}{{rollname=^{star-crew-task}}}" />
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
	 						<input type="radio" name="attr_crew_addDice" value="1" /><span data-i18n="one-sd" class="label">1 </span>
	 						<input type="radio" name="attr_crew_addDice" value="2" checked="checked" /><span data-i18n="two-sd" class="label">2 </span>
							<input type="radio" name="attr_crew_addDice" value="3" /><span data-i18n="three-sd" class="label">3 </span>
							<input type="radio" name="attr_crew_addDice" value="4" /><span data-i18n="four-sd" class="label">4 </span>
							<input type="radio" name="attr_crew_addDice" value="5" /><span data-i18n="five-sd" class="label">5 </span>
						</div>
						<!--Starship Dice Roller the dice!-->
						<div class="diceroller-numbers">
							<input type="hidden" name="attr_ship_diceRoll" value="{{dice1=[[{{ceil(((@{ship_target})-d20cf>@{ship_complication}cs@{department}+1e-2)/((@{ship_target})-(@{department}))),{2}}kl1,{0}}kh1]]}}{{dice2=[[{{ceil(((@{ship_target})-d20cf>@{ship_complication}cs@{department}+1e-2)/((@{ship_target})-(@{department}))),{2}}kl1,{0}}kh1]]}}" />
							<button class="dice-button" type="roll" name="ShipTaskRoll" value="@{whispertype} &{template:strek}@{ship_diceRoll}{{attribute=@{systemName} (@{system})}}{{discipline=@{departmentName} (@{department})}}{{rollname=^{starship-task}}}" />
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
	 						<input type="radio" name="attr_ship_addDice" value="1" /><span data-i18n="one-sd" class="label">1 </span>
	 						<input type="radio" name="attr_ship_addDice" value="2" checked="checked" /><span data-i18n="two-sd" class="label">2 </span>
							<input type="radio" name="attr_ship_addDice" value="3" /><span data-i18n="three-sd" class="label">3 </span>
							<input type="radio" name="attr_ship_addDice" value="4" /><span data-i18n="four-sd" class="label">4 </span>
							<input type="radio" name="attr_ship_addDice" value="5" /><span data-i18n="five-sd" class="label">5 </span>
						</div>
						<!-- Challenge Dice: on a d6, 1 counts 1 hit, 2 counts 2 hits, 5 & 6 counts 1 hit & effect, 3 & 4 are blanks.-->
						<div>
							<input type="hidden" name="challengeRoll" value="" />
							<button class="challenge-button" type="roll" name="ShipChallengeRoll" value="@{whispertype} &{template:strek}{{target=@{challenge}}}{{rollname=^{challenge-dice-u}}}@{challengeRoll}" />
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
							<input type="number" class="capsule" name="attr_challenge" min="0" value="0" title="@{challenge}" />
						</div>
					</div>
				</div><!-- End of dice roller -->
				<div class="col-ship-row">
					<div class="col-ship-power">
					<!-- Power -->
						<div class="section-heading"><span data-i18n="power">POWER</span></div>
						<div class="row">
							<span data-i18n="current" class="capsule-power">CURRENT</span><input type="number" class="capsule" name="attr_power" title="@{power}" />
							<span data-i18n="max-p" class="capsule-power">MAX</span><div class="capsule"><span name="attr_power_max"></span></div>
						</div>
						<!-- Shields (The # of visible bubbles depends on Structure and Security rating).-->
						<div class='shields'>
							<input type="radio" class="radio-header-shields" name="attr_shields" value="0" title="@{shields}" checked="checked" />
							<div class="section-heading"><span data-i18n="shields">SHIELDS</span></div>
							<div class="boxes-shields">
								<input type="hidden" name="attr_shields_1_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="1" /><span></span>
								<input type="hidden" name="attr_shields_2_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="2"/><span></span>
								<input type="hidden" name="attr_shields_3_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="3"/><span></span>
								<input type="hidden" name="attr_shields_4_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="4"/><span></span>
								<input type="hidden" name="attr_shields_5_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="5"/><span></span>
								<input type="hidden" name="attr_shields_6_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="6"/><span></span>
								<input type="hidden" name="attr_shields_7_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="7"/><span></span>
								<input type="hidden" name="attr_shields_8_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="8"/><span></span>
								<input type="hidden" name="attr_shields_9_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="9"/><span></span>
								<input type="hidden" name="attr_shields_10_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="10"/><span></span>
								<input type="hidden" name="attr_shields_11_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="11"/><span></span>
								<input type="hidden" name="attr_shields_12_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="12"/><span></span>
								<input type="hidden" name="attr_shields_13_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="13"/><span></span>
								<input type="hidden" name="attr_shields_14_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="14"/><span></span>
								<input type="hidden" name="attr_shields_15_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="15"/><span></span>
								<input type="hidden" name="attr_shields_16_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="16"/><span></span>
								<input type="hidden" name="attr_shields_17_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="17"/><span></span>
								<input type="hidden" name="attr_shields_18_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="18"/><span></span>
								<input type="hidden" name="attr_shields_19_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="19"/><span></span>
								<input type="hidden" name="attr_shields_20_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="20" /><span></span>
								<input type="hidden" name="attr_shields_21_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="21"/><span></span>
								<input type="hidden" name="attr_shields_22_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="22"/><span></span>
								<input type="hidden" name="attr_shields_23_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="23"/><span></span>
								<input type="hidden" name="attr_shields_24_enabled" value="true"/>
								<input type="radio" name="attr_shields" value="24"/><span></span>
							</div>
						</div>
					</div>
					<div class="col-ship-launch">
					<!-- Launch Bay -->
						<div class="section-heading"><span data-i18n="launch-bay">LAUNCH BAY</span></div>
						<div class="textbox toggle launchbay-toggle">
							<input type="checkbox" class="options-flag" name="attr_launchbay-toggle" checked="checked" /><span>y</span>
							<div class="options">
								<textarea name="attr_launchbay" spellcheck="false"></textarea>
							</div>
							<div class="display">
				                <span name="attr_launchbay"></span>
				            </div>
			           	</div>
					<!-- Crew Support -->
						<div class="section-heading"><span class="longtext"" data-i18n="crew-support">CREW SUPPORT</span></div>
						<div class="row">
							<span data-i18n="current-c" class="capsule-power">CURRENT</span><input type="number" class="capsule" name="attr_crew" title="@{crew}" />
							<span data-i18n="max-c" class="capsule-power">MAX</span><div class="capsule"><span name="attr_crew_max"></span></div>
						</div>
					</div>
				</div>
	       <!-- Weapons -->
				<div class="section-heading"><span data-i18n="weapons-s">WEAPONS</span></div>
				<fieldset class="repeating_ship">
					<input type="hidden" name="attr_damageRoll" value="" />
					<div class="weapon toggle">
						<div class="weapon-row">
							<span data-i18n="name-type-s" class="label-capsule-weapon">NAME/TYPE</span>
							<input type="text" class="weapon-name" name="attr_weapon_name" spellcheck="false" spellcheck="false"/>
							<button class="weapon-button" type="roll" name="ShipDamageRoll" value="@{whispertype} &{template:strek}{{attribute=@{weapon_quality}}}{{discipline=@{weapon_effect}}}{{rollname=@{weapon_name}}}@{damageRoll}" title="Security + Weapon Damage">
								<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
							</button>
							<input type="number" class="capsule" name="attr_weapon_damage" title="Weapon Damage" value="0" />
						</div>
						<div class="weapon-row">
							<span data-i18n="qualities-s" class="label-capsule-weapon">QUALITIES</span>
							<input type="text" class="weapon-quality" name="attr_weapon_quality" spellcheck="false" />
						</div>
						<div class="weapon_settings">
							<div class="weapon-row">
								<span data-i18n="effects-s" class="label-capsule-weapon">EFFECTS</span>
								<input type="text" class="weapon-effect" name="attr_weapon_effect" spellcheck="false" />
								<div class="flexinl">
    								<label class="labelcheck"><input type="radio" name="attr_weapon_type" value="Energy" checked="checked" /><span data-i18n="energy">Energy</span></label>
                                    <label class="labelcheck"><input type="radio" name="attr_weapon_type" value="Torpedo" /><span data-i18n="torpedo">Torpedo</span></label>
                                </div>
							</div>
						</div>
					</div>
					<hr />
				</fieldset>
			</div><!--End of 2nd column -->
		</div><!-- End of Sheet Body for Star Ship Sheet-->
	</div> <!-- End of the Body Background -->
</div><!-- ~~~~~~~~ End of Starship Sheet Page ~~~~~~~~ -->

<div class="settings"><!--  ~~~~~~~~ Sheet Settings Page ~~~~~~~~ -->
	<!--- Sheet Decorations -->
	<div class="vertdeco"></div>
	<div class="sidedeco-purple"></div>
	<div class="topdeco-purple"></div>
	<!-- Sheet Settings -->
	<div class="border-top">
		<div class="topsection">
			<div class="header toggle">
				<input class="settings_gear" type="checkbox" name="attr_settings_toggle" title="Sheet Settings & Notes"/><span>y</span>
			    <h1 data-i18n="sheet-settings">SHEET SETTINGS</h1>
			    <div class="version">
                    <span data-i18n="version">v</span>
                    <input type="hidden" name="attr_version" value="1.4"><span name="attr_version" title="@{version}"></span>
                </div>
			</div>
			<div class="settings-header">
				<div class="col-sixtypercent">
					<div class="section-heading"><span data-i18n="milestones">MILESTONES</span></div>
					<div>
						<span class="capsule-three" data-i18n="normal">NORMAL</span>
						<input class="capsule" type="number" min="0" name="attr_normal" value="0" title="@{normal}" />
				        <span class="capsule-three longtext" data-i18n="spotlight">SPOTLIGHT</span>
				        <input class="capsule" type="number" min="0" name="attr_spotlight" value="0"  title="@{spotlight}" />
				        <span class="capsule-three" data-i18n="arc">ARC</span><input class="capsule" type="number" min="0" name="attr_arc" disabled="true" value="0"  title="@{arc}" />
				    </div>
				</div>
				<div class="col-fortypercent">
					<div class="section-heading"><span data-i18n="sheet-type">SHEET TYPE</span></div>
					<div>
						<select class="sheet_type" name="attr_sheet_type" title="@{sheet_type}">
		                    <option value="character" data-i18n="sheet-type-personnel">STARFLEET PERSONNEL FILE</option>
		                    <option value="starship" data-i18n="sheet-type-starship">STARSHIP REGISTRY ENTRY</option>
		                    <option value="npc" data-i18n="sheet-type-npc">NPC STARSHIP</option>
		                </select>
		                <select class="sheet_color" name="attr_sheet_color" title="@{sheet_color}">
		                    <option value="black" selected="selected" data-i18n="sheet-color-black">BLACK</option>
		                    <option value="white" data-i18n="sheet-color-white">WHITE</option>
                        </select>
                        <input type="hidden" name="attr_ask_whisper" value="Whisper to GM?" />
                        <input type="hidden" name="attr_ask_public_roll" value="Public Roll" />
                        <input type="hidden" name="attr_ask_whisper_roll" value="Whisper Roll" />
                        <select class="sheet_gmroll" name="attr_whispertype" title="@{whispertype}">
                            <option value="" data-i18n="public-roll" selected="selected">PUBLIC ROLL</option>
                            <option value="/w gm " data-i18n="whisper-roll">WHISPER ROLL TO GM</option>
                            <option value="?{@{ask_whisper}|@{ask_public_roll},|@{ask_whisper_roll},/w gm }" data-i18n="query-whisper-roll">QUERY WHISPER ROLL TO GM</option>
                        </select>
		            </div>
				</div>
				<div>
				    <div class="section-heading"><span data-i18n="reputation">REPUTATION</span></div>
					<span data-i18n="reputation-r" class="capsule-reputation">REPUTATION</span>
					<input class="capsule" type="number" min="0" name="attr_reputation" value="10" title="@{reputation}" />
					<input type="hidden" name="attr_privilege" value="1" />
					<span data-i18n="privilege" class="capsule-reputation">PRIVILEGE</span><div class="capsule"><span name="attr_privilege"></span></div>
					<input type="hidden" name="attr_responsibility" value="1" />
			        <span data-i18n="responsibility" class="capsule-reputation">RESPONSIBILITY</span><div class="capsule"><span name="attr_responsibility"></span></div>
					<span data-i18n="rank" class="capsule-reputation">RANK</span>
			        <select class="rank-select" name="attr_rankSelect">
			        	<option selected="selected" value="Ensign" data-i18n="rank-ensign">Ensign</option>
			        	<option value="LieutenantJr" data-i18n="rank-junior">Lieutenant (junior grade)</option>
			        	<option value="Lieutenant" data-i18n="rank-lt">Lieutenant</option>
			        	<option value="LtCommander" data-i18n="rank-lt-comm">Lieutenant Commander</option>
			        	<option value="Commander" data-i18n="rank-comm">Commander</option>
			        	<option value="Captain" data-i18n="rank-cap">Captain</option>
			        </select>
					<input type="hidden" name="attr_reputationRoll" value="{{dice1=[[{{ceil(((@{reputation})-d20cf>@{responsibility}cs@{privilege}+1e-2)/((@{reputation})-(@{privilege}))),{2}}kl1,{0}}kh1]]" />
					<button class="reputation-button" type="roll" name="ReputationRoll" value="@{whispertype} &{template:strek}{{target=@{reputation}}}{{rollname=^{reputation}}}@{reputationRoll}" />
						<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_full.png" />
					</button>
					<input type="number" class="capsule" name="attr_influence" min="0" max="5" value="0" title="Roll d20s based on positive influence. Max is 5." />
				</div>
			</div>
		</div>
    </div>
   	<div class="border-bottom">
   		<div class="body">
   			<div class="col-sixtypercent">
				<div class="section-heading"><span data-i18n="stress-h">STRESS</span></div>
			    <div class="row">
			    	<input type="hidden" name="attr_stress_max" value="8"/>
		            <span data-i18n="current-s" class="capsule-three">CURRENT </span><input class="capsule" type="number" min="0" name="attr_stress" value="0" title="@{stress}" />
		            <span data-i18n="bonus-s" class="capsule-three">BONUS </span><input class="capsule" type="number" min="0" name="attr_stress_bonus" value="0"  title="@{stress_bonus}" />
		            <span data-i18n="max-s" class="capsule-three">MAX </span><div class="capsule"><span name="attr_stress_max" title="@{stress_max}"></span></div>
			    </div>
			    <div class="section-heading">
			        <span data-i18n="shields">SHIELDS</span>
			    </div>
			    <div class="row">
			    	<input type="hidden" name="attr_shields_max" value="1"/>
			        <span data-i18n="current-sh" class="label-capsule-left capsule-three">CURRENT </span><input class="capsule" type="number" min="0" name="attr_shields" value="0"  title="@{shields}" />
			        <span data-i18n="bonus-sh" class="label-capsule-left capsule-three">BONUS </span><input class="capsule" type="number" name="attr_shields_bonus" value="0"  title="@{shields_bonus}" />
			        <span data-i18n="max-sh" class="label-capsule-left capsule-three">MAX </span><div class="capsule"><span name="attr_shields_max" title="@{shields_max}"></span></div>
			    </div>
			</div>
			<div class="col-fortypercent">
				<div class="section-heading">
			        <span data-i18n="power-h">POWER</span>
			    </div>
			    <div class="row">
			        <span data-i18n="bonus-po" class="label-capsule-left capsule-two">BONUS </span><input class="capsule" type="number" name="attr_power_bonus" value="0" />
			        <span data-i18n="max-po" class="label-capsule-left capsule-two">MAX</span><div class="capsule"><span name="attr_power_max" title="@{power_max}"></span></div>
			     </div>
			     <div class="section-heading">
			        <span data-i18n="crew-u">CREW</span>
			    </div>
			    <div class="row">
			        <span data-i18n="bonus-cr" class="label-capsule-left capsule-two">BONUS </span><input class="capsule" type="number" name="attr_crew_bonus" value="0" />
			        <span data-i18n="max-cr" class="label-capsule-left capsule-two">MAX</span><div class="capsule"><span name="attr_crew_max" title="@{crew_max}"></span></div>
			     </div>
			</div>
   			<div class="section-heading">
			    <span data-i18n="notes" class="label">Notes</span>
			</div>
			<div class="textbox toggle notestoggle">
				<input type="checkbox" class="options-flag" name="attr_notes-toggle" checked="checked" /><span>y</span>
				<div class="notes options">
					<textarea name="attr_notes" spellcheck="false"></textarea>
				</div>
				<div class="display">
	                <span name="attr_notes"></span>
	            </div>
	        </div>
		</div>
	</div>
</div><!--  ~~~~~~~~ End Sheet Settings Page ~~~~~~~~ -->

<div class="sheet-footer">
    <div>TM & © 2018 CBS Studios Inc. ©2018 Paramount Pictures Corp. STAR TREK and related marks and logos are trademarks of CBS Studios Inc. All Rights Reserved.</div>
</div><!--  ~~~~~~~~ End Sheet Footer ~~~~~~~~ -->

<!--Roll Template-->

<div class="rolltemplates">
	<!--Roll Template for rolling without Focus-->
    <rolltemplate class="sheet-rolltemplate-strek">
        <div class="rolltemplate-body">
		<!--Dice Rolls -->
			<div class="dice">
 			<!--Dice 1-->
 				<span>{{#dice1}}{{dice1}}{{/dice1}}</span>
  			<!--Dice 2-->
 				<span>{{#dice2}}{{dice2}}{{/dice2}}</span>
 			<!--Dice 3-->
 				<span>{{#dice3}}{{dice3}}{{/dice3}}</span>
  			<!--Dice 4-->
 				<span>{{#dice4}}{{dice4}}{{/dice4}}</span>
  			<!--Dice 5-->
 				<span>{{#dice5}}{{dice5}}{{/dice5}}</span>
			<!--Challenge cdice 1-->
				<span>{{#rollLess() cdice1 2}}1{{/rollLess() cdice1 2}}</span>
				<span>{{#rollBetween() cdice1 2 2}}2{{/rollBetween() cdice1 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice1 3 4}}0{{/rollBetween() cdice1 3 4}}</span>
				<span>{{#rollBetween() cdice1 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice1 5 6}}</span>
			<!--Challenge cdice 2-->
				<span>{{#rollLess() cdice2 2}}1{{/rollLess() cdice2 2}}</span>
				<span>{{#rollBetween() cdice2 2 2}}2{{/rollBetween() cdice2 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice2 3 4}}0{{/rollBetween() cdice2 3 4}}</span>
				<span>{{#rollBetween() cdice2 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice2 5 6}}</span>
			<!--Challenge cdice 3-->
				<span>{{#rollLess() cdice3 2}}1{{/rollLess() cdice3 2}}</span>
				<span>{{#rollBetween() cdice3 2 2}}2{{/rollBetween() cdice3 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice3 3 4}}0{{/rollBetween() cdice3 3 4}}</span>
				<span>{{#rollBetween() cdice3 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice3 5 6}}</span>
			<!--Challenge cdice 4-->
				<span>{{#rollLess() cdice4 2}}1{{/rollLess() cdice4 2}}</span>
				<span>{{#rollBetween() cdice4 2 2}}2{{/rollBetween() cdice4 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice4 3 4}}0{{/rollBetween() cdice4 3 4}}</span>
				<span>{{#rollBetween() cdice4 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice4 5 6}}</span>
			<!--Challenge cdice 5-->
				<span>{{#rollLess() cdice5 2}}1{{/rollLess() cdice5 2}}</span>
				<span>{{#rollBetween() cdice5 2 2}}2{{/rollBetween() cdice5 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice5 3 4}}0{{/rollBetween() cdice5 3 4}}</span>
				<span>{{#rollBetween() cdice5 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice5 5 6}}</span>
			<!--Challenge cdice 6-->
				<span>{{#rollLess() cdice6 2}}1{{/rollLess() cdice6 2}}</span>
				<span>{{#rollBetween() cdice6 2 2}}2{{/rollBetween() cdice6 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice6 3 4}}0{{/rollBetween() cdice6 3 4}}</span>
				<span>{{#rollBetween() cdice6 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice6 5 6}}</span>
			<!--Challenge cdice 7-->
				<span>{{#rollLess() cdice7 2}}1{{/rollLess() cdice7 2}}</span>
				<span>{{#rollBetween() cdice7 2 2}}2{{/rollBetween() cdice7 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice7 3 4}}0{{/rollBetween() cdice7 3 4}}</span>
				<span>{{#rollBetween() cdice7 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice7 5 6}}</span>
			<!--Challenge cdice 8-->
				<span>{{#rollLess() cdice8 2}}1{{/rollLess() cdice8 2}}</span>
				<span>{{#rollBetween() cdice8 2 2}}2{{/rollBetween() cdice8 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice8 3 4}}0{{/rollBetween() cdice8 3 4}}</span>
				<span>{{#rollBetween() cdice8 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice8 5 6}}</span>
			<!--Challenge cdice 9-->
				<span>{{#rollLess() cdice9 2}}1{{/rollLess() cdice9 2}}</span>
				<span>{{#rollBetween() cdice9 2 2}}2{{/rollBetween() cdice9 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice9 3 4}}0{{/rollBetween() cdice9 3 4}}</span>
				<span>{{#rollBetween() cdice9 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice9 5 6}}</span>
			<!--Challenge cdice 10-->
				<span>{{#rollLess() cdice10 2}}1{{/rollLess() cdice10 2}}</span>
				<span>{{#rollBetween() cdice10 2 2}}2{{/rollBetween() cdice10 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice10 3 4}}0{{/rollBetween() cdice10 3 4}}</span>
				<span>{{#rollBetween() cdice10 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice10 5 6}}</span>
			<!--Challenge cdice 11-->
				<span>{{#rollLess() cdice11 2}}1{{/rollLess() cdice11 2}}</span>
				<span>{{#rollBetween() cdice11 2 2}}2{{/rollBetween() cdice11 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice11 3 4}}0{{/rollBetween() cdice11 3 4}}</span>
				<span>{{#rollBetween() cdice11 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice11 5 6}}</span>
			<!--Challenge cdice 12-->
				<span>{{#rollLess() cdice12 2}}1{{/rollLess() cdice12 2}}</span>
				<span>{{#rollBetween() cdice12 2 2}}2{{/rollBetween() cdice12 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice12 3 4}}0{{/rollBetween() cdice12 3 4}}</span>
				<span>{{#rollBetween() cdice12 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice12 5 6}}</span>
			<!--Challenge cdice 13-->
				<span>{{#rollLess() cdice13 2}}1{{/rollLess() cdice13 2}}</span>
				<span>{{#rollBetween() cdice13 2 2}}2{{/rollBetween() cdice13 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice13 3 4}}0{{/rollBetween() cdice13 3 4}}</span>
				<span>{{#rollBetween() cdice13 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice13 5 6}}</span>
			<!--Challenge cdice 14-->
				<span>{{#rollLess() cdice14 2}}1{{/rollLess() cdice14 2}}</span>
				<span>{{#rollBetween() cdice14 2 2}}2{{/rollBetween() cdice14 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice14 3 4}}0{{/rollBetween() cdice14 3 4}}</span>
				<span>{{#rollBetween() cdice14 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice14 5 6}}</span>
			<!--Challenge cdice 15-->
				<span>{{#rollLess() cdice15 2}}1{{/rollLess() cdice15 2}}</span>
				<span>{{#rollBetween() cdice15 2 2}}2{{/rollBetween() cdice15 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice15 3 4}}0{{/rollBetween() cdice15 3 4}}</span>
				<span>{{#rollBetween() cdice15 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice15 5 6}}</span>
			<!--Challenge cdice 16-->
				<span>{{#rollLess() cdice16 2}}1{{/rollLess() cdice16 2}}</span>
				<span>{{#rollBetween() cdice16 2 2}}2{{/rollBetween() cdice16 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice16 3 4}}0{{/rollBetween() cdice16 3 4}}</span>
				<span>{{#rollBetween() cdice16 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice16 5 6}}</span>
			<!--Challenge cdice 17-->
				<span>{{#rollLess() cdice17 2}}1{{/rollLess() cdice17 2}}</span>
				<span>{{#rollBetween() cdice17 2 2}}2{{/rollBetween() cdice17 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice17 3 4}}0{{/rollBetween() cdice17 3 4}}</span>
				<span>{{#rollBetween() cdice17 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice17 5 6}}</span>
			<!--Challenge cdice 18-->
				<span>{{#rollLess() cdice18 2}}1{{/rollLess() cdice18 2}}</span>
				<span>{{#rollBetween() cdice18 2 2}}2{{/rollBetween() cdice18 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice18 3 4}}0{{/rollBetween() cdice18 3 4}}</span>
				<span>{{#rollBetween() cdice18 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice18 5 6}}</span>
			<!--Challenge cdice 19-->
				<span>{{#rollLess() cdice19 2}}1{{/rollLess() cdice19 2}}</span>
				<span>{{#rollBetween() cdice19 2 2}}2{{/rollBetween() cdice19 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice19 3 4}}0{{/rollBetween() cdice19 3 4}}</span>
				<span>{{#rollBetween() cdice19 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice19 5 6}}</span>
			<!--Challenge cdice 20-->
				<span>{{#rollLess() cdice20 2}}1{{/rollLess() cdice20 2}}</span>
				<span>{{#rollBetween() cdice20 2 2}}2{{/rollBetween() cdice20 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice20 3 4}}0{{/rollBetween() cdice20 3 4}}</span>
				<span>{{#rollBetween() cdice20 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice20 5 6}}</span>
			<!--Challenge cdice 21-->
				<span>{{#rollLess() cdice21 2}}1{{/rollLess() cdice21 2}}</span>
				<span>{{#rollBetween() cdice21 2 2}}2{{/rollBetween() cdice21 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice21 3 4}}0{{/rollBetween() cdice21 3 4}}</span>
				<span>{{#rollBetween() cdice21 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice21 5 6}}</span>
			<!--Challenge cdice 22-->
				<span>{{#rollLess() cdice22 2}}1{{/rollLess() cdice22 2}}</span>
				<span>{{#rollBetween() cdice22 2 2}}2{{/rollBetween() cdice22 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice22 3 4}}0{{/rollBetween() cdice22 3 4}}</span>
				<span>{{#rollBetween() cdice22 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice22 5 6}}</span>
			<!--Challenge cdice 23-->
				<span>{{#rollLess() cdice23 2}}1{{/rollLess() cdice23 2}}</span>
				<span>{{#rollBetween() cdice23 2 2}}2{{/rollBetween() cdice23 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice23 3 4}}0{{/rollBetween() cdice23 3 4}}</span>
				<span>{{#rollBetween() cdice23 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice23 5 6}}</span>
			<!--Challenge cdice 24-->
				<span>{{#rollLess() cdice24 2}}1{{/rollLess() cdice24 2}}</span>
				<span>{{#rollBetween() cdice24 2 2}}2{{/rollBetween() cdice24 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice24 3 4}}0{{/rollBetween() cdice24 3 4}}</span>
				<span>{{#rollBetween() cdice24 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice24 5 6}}</span>
			<!--Challenge cdice 25 -->
				<span>{{#rollLess() cdice25 2}}1{{/rollLess() cdice25 2}}</span>
				<span>{{#rollBetween() cdice25 2 2}}2{{/rollBetween() cdice25 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice25 3 4}}0{{/rollBetween() cdice25 3 4}}</span>
				<span>{{#rollBetween() cdice25 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice25 5 6}}</span>
			<!--Challenge cdice 26-->
				<span>{{#rollLess() cdice26 2}}1{{/rollLess() cdice26 2}}</span>
				<span>{{#rollBetween() cdice26 2 2}}2{{/rollBetween() cdice26 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice26 3 4}}0{{/rollBetween() cdice26 3 4}}</span>
				<span>{{#rollBetween() cdice26 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice26 5 6}}</span>
			<!--Challenge cdice 27-->
				<span>{{#rollLess() cdice27 2}}1{{/rollLess() cdice27 2}}</span>
				<span>{{#rollBetween() cdice27 2 2}}2{{/rollBetween() cdice27 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice27 3 4}}0{{/rollBetween() cdice27 3 4}}</span>
				<span>{{#rollBetween() cdice27 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice27 5 6}}</span>
			<!--Challenge cdice 28-->
				<span>{{#rollLess() cdice28 2}}1{{/rollLess() cdice28 2}}</span>
				<span>{{#rollBetween() cdice28 2 2}}2{{/rollBetween() cdice28 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice28 3 4}}0{{/rollBetween() cdice28 3 4}}</span>
				<span>{{#rollBetween() cdice28 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice28 5 6}}</span>
			<!--Challenge cdice 29-->
				<span>{{#rollLess() cdice29 2}}1{{/rollLess() cdice29 2}}</span>
				<span>{{#rollBetween() cdice29 2 2}}2{{/rollBetween() cdice29 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice29 3 4}}0{{/rollBetween() cdice29 3 4}}</span>
				<span>{{#rollBetween() cdice29 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice29 5 6}}</span>
			<!--Challenge cdice 30-->
				<span>{{#rollLess() cdice30 2}}1{{/rollLess() cdice30 2}}</span>
				<span>{{#rollBetween() cdice30 2 2}}2{{/rollBetween() cdice30 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice30 3 4}}0{{/rollBetween() cdice30 3 4}}</span>
				<span>{{#rollBetween() cdice30 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice30 5 6}}</span>
			<!--Challenge cdice 31-->
				<span>{{#rollLess() cdice31 2}}1{{/rollLess() cdice31 2}}</span>
				<span>{{#rollBetween() cdice31 2 2}}2{{/rollBetween() cdice31 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice31 3 4}}0{{/rollBetween() cdice31 3 4}}</span>
				<span>{{#rollBetween() cdice31 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice31 5 6}}</span>
			<!--Challenge cdice 32-->
				<span>{{#rollLess() cdice32 2}}1{{/rollLess() cdice32 2}}</span>
				<span>{{#rollBetween() cdice32 2 2}}2{{/rollBetween() cdice32 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice32 3 4}}0{{/rollBetween() cdice32 3 4}}</span>
				<span>{{#rollBetween() cdice32 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice32 5 6}}</span>
			<!--Challenge cdice 33-->
				<span>{{#rollLess() cdice33 2}}1{{/rollLess() cdice33 2}}</span>
				<span>{{#rollBetween() cdice33 2 2}}2{{/rollBetween() cdice33 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice33 3 4}}0{{/rollBetween() cdice33 3 4}}</span>
				<span>{{#rollBetween() cdice33 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice33 5 6}}</span>
			<!--Challenge cdice 34-->
				<span>{{#rollLess() cdice34 2}}1{{/rollLess() cdice34 2}}</span>
				<span>{{#rollBetween() cdice34 2 2}}2{{/rollBetween() cdice34 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice34 3 4}}0{{/rollBetween() cdice34 3 4}}</span>
				<span>{{#rollBetween() cdice34 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice34 5 6}}</span>
			<!--Challenge cdice 35-->
				<span>{{#rollLess() cdice35 2}}1{{/rollLess() cdice35 2}}</span>
				<span>{{#rollBetween() cdice35 2 2}}2{{/rollBetween() cdice35 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice35 3 4}}0{{/rollBetween() cdice35 3 4}}</span>
				<span>{{#rollBetween() cdice35 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice35 5 6}}</span>
			<!--Challenge cdice 36-->
				<span>{{#rollLess() cdice36 2}}1{{/rollLess() cdice36 2}}</span>
				<span>{{#rollBetween() cdice36 2 2}}2{{/rollBetween() cdice36 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice36 3 4}}0{{/rollBetween() cdice36 3 4}}</span>
				<span>{{#rollBetween() cdice36 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice36 5 6}}</span>
			<!--Challenge cdice 37-->
				<span>{{#rollLess() cdice37 2}}1{{/rollLess() cdice37 2}}</span>
				<span>{{#rollBetween() cdice37 2 2}}2{{/rollBetween() cdice37 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice37 3 4}}0{{/rollBetween() cdice37 3 4}}</span>
				<span>{{#rollBetween() cdice37 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice37 5 6}}</span>
			<!--Challenge cdice 38-->
				<span>{{#rollLess() cdice38 2}}1{{/rollLess() cdice38 2}}</span>
				<span>{{#rollBetween() cdice38 2 2}}2{{/rollBetween() cdice38 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice38 3 4}}0{{/rollBetween() cdice38 3 4}}</span>
				<span>{{#rollBetween() cdice38 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice38 5 6}}</span>
			<!--Challenge cdice 39-->
				<span>{{#rollLess() cdice39 2}}1{{/rollLess() cdice39 2}}</span>
				<span>{{#rollBetween() cdice39 2 2}}2{{/rollBetween() cdice39 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice39 3 4}}0{{/rollBetween() cdice39 3 4}}</span>
				<span>{{#rollBetween() cdice39 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice39 5 6}}</span>
			<!--Challenge cdice 40-->
				<span>{{#rollLess() cdice40 2}}1{{/rollLess() cdice40 2}}</span>
				<span>{{#rollBetween() cdice40 2 2}}2{{/rollBetween() cdice40 2 2}}</span>
				<span class="cdice0">{{#rollBetween() cdice40 3 4}}0{{/rollBetween() cdice40 3 4}}</span>
				<span>{{#rollBetween() cdice40 5 6}}<img class="chevron" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Star%20Trek%20Adventures%20by%20Roll20/images/STA_starfleet_insignia_dice.png" />{{/rollBetween() cdice40 5 6}}</span>
			</div>
        	<div class="rollinfo">
	        	<span>{{#attribute}}{{attribute}}{{/attribute}}</span>
	        	<span>{{#discipline}} ♦ {{discipline}}{{/discipline}}</span>
			</div>
			<div class="rolltemplate-header">
				<div class="sectionheader"><span>{{#rollname}}{{rollname}}{{/rollname}}</span></div>
			</div>
		</div>
	</rolltemplate>
</div>

<!--Sheet Worker-->
<script type="text/worker">
	// Global variables
	const staglobals_currentversion = 1.5;

    // Check for default attributes and disciplines (system and department for ships) and rolls, if not set
    on("sheet:opened", () => {
        getAttrs(["attribute", "discipline", "system", "department"], (v) => {
            update = {};
            // Make sure roll attributes are selected + update roll strings
            if((v.attribute || "0") == "0") {
				update["attribute"] = "@{control}";
				_.extend(update,updateRollName("@{control}","attribute"));
			} else {
				_.extend(update,updateRollName(v.attribute,"attribute"));
            }
            if((v.discipline || "0") == "0") {
				update["discipline"] = "@{command}";
				_.extend(update,updateRollName("@{command}","discipline"));
			} else {
				_.extend(update,updateRollName(v.discipline,"discipline"));
            }
            if((v.system || "0") == "0") {
				update["system"] = "@{ship_engines}";
				_.extend(update,updateRollName("@{ship_engines}","system"));
			} else {
				_.extend(update,updateRollName(v.system,"system"));
            }
            if((v.department || "0") == "0") {
				update["department"] = "@{ship_command}";
				_.extend(update,updateRollName("@{ship_command}","department"));
			} else {
				_.extend(update,updateRollName(v.department,"department"));
            }
            // Load translation attributes
            update["ask_whisper"] = getTranslationByKey("ask-whisper");
            update["ask_public_roll"] = getTranslationByKey("ask-public-roll");
            update["ask_whisper_roll"] = getTranslationByKey("ask-whisper-roll");
            setAttrs(update, {silent: true}, () => {
				versioning();
			});
        });
    });

	//Grab the attributes/disciplines/system/department when they update then set attributeName/disciplineName/systemName/departmentName to the appropriate title for the rolltemplate
	var updateRollName = function(value = "", type = "") {
		// console.log("*** DEBUG PRINT updateRollName: " + value + " " + type);
		let update = {};
		if(type) {
			update[type + "Name"] = getTranslationByKey(value.replace(/[^a-z_]/gi, "").replace("ship_",""));
			if((update[type + "Name"] == "undefined") || (!update[type + "Name"])) {
				update[type + "Name"] = getTranslationByKey("null-" + type);
			}
		}
		return update;
	};
	on("change:attribute", (e) => {
		setAttrs(updateRollName(e.newValue || "","attribute"));
	});
	on("change:discipline", (e) => {
		setAttrs(updateRollName(e.newValue || "","discipline"));
	});
	//This does the same as above but for the ship. It sets departments and systems
	on("change:system", (e) => {
		setAttrs(updateRollName(e.newValue || "","system"));
	});
	on("change:department", (e) => {
		setAttrs(updateRollName(e.newValue || "","department"));
	});

	//Set the Challenge Dice in increase the dice rolled in the template.
	on("change:challenge", () => {
		getAttrs(["challenge"], (v) => {
			let challengeRoll = "";
			for (diceNumber = 1; diceNumber <= (parseInt(v.challenge) || 0); diceNumber++) {
				challengeRoll += `{{cdice${diceNumber}=[[1d6]]}}`;
			}
			setAttrs({"challengeRoll": challengeRoll});
		});
	});

	//Add additional d20s when add dice option is selected
	on("change:addDice", () => {
		getAttrs(["addDice"], (v) => {
			let diceRoll = "";
			for (diceNumber = 1; diceNumber <= (parseInt(v.addDice) || 0); diceNumber++) {
				diceRoll += `{{dice${diceNumber}=[[{{ceil(((@{target})-d20cf>@{complication}cs@{focus}+1e-2)/((@{target})-(@{focus}))),{2}}kl1,{0}}kh1]]}}`;
			}
			setAttrs({"diceRoll": diceRoll});
		});
	});

    //Add additional d20s when add dice option is selected for crew
    on("change:crew_addDice", () => {
        getAttrs(["crew_addDice"], (v) => {
            let diceRoll = "";
            for (diceNumber = 1; diceNumber <= (parseInt(v.crew_addDice) || 0); diceNumber++) {
                diceRoll += `{{dice${diceNumber}=[[{{ceil(((@{crew_target})-d20cf>@{ship_complication}cs@{ship_focus}+1e-2)/((@{crew_target})-(@{ship_focus}))),{2}}kl1,{0}}kh1]]}}`;
            }
            setAttrs({"crew_diceRoll": diceRoll});
        });
    });

    //Add additional d20s for ships
	on("change:ship_addDice", () => {
		getAttrs(["ship_addDice"], (v) => {
			let ship_diceRoll = "";
			for (diceNumber = 1; diceNumber <= (parseInt(v.ship_addDice) || 0); diceNumber++) {
				ship_diceRoll += `{{dice${diceNumber}=[[{{ceil(((@{ship_target})-d20cf>@{ship_complication}cs@{department}+1e-2)/((@{ship_target})-(@{department}))),{2}}kl1,{0}}kh1]]}}`;
			}
			setAttrs({"ship_diceRoll": ship_diceRoll});
		});
	});


	//Configure Power total
	on("change:ship_engines change:power_bonus", () => {
		getAttrs(["ship_engines", "power_bonus",], (v) => {
			setAttrs({"power_max": (parseInt(v.ship_engines) || 0) + (parseInt(v.power_bonus) || 0)});
		});
	});

	//Configure crew total
	on("change:ship_scale change:crew_bonus", () => {
		getAttrs(["ship_scale", "crew_bonus",], (v) => {
			setAttrs({"crew_max": (parseInt(v.ship_scale) || 0) + (parseInt(v.crew_bonus) || 0)});
		});
	});

	//Sets the privilege and responsibility for the Repuatations under Settings based on Rank
	on("change:rankSelect", () => {
		getAttrs(["rankSelect","rank"], (v) => {
				let update = {}, rank = "", ranks = [];
				ranks.push(getTranslationByKey("rank-ensign").toLowerCase() ,getTranslationByKey("rank-junior").toLowerCase(),getTranslationByKey("rank-lt").toLowerCase(),getTranslationByKey("rank-lt-comm").toLowerCase(),getTranslationByKey("rank-comm").toLowerCase(),getTranslationByKey("rank-cap").toLowerCase(),"");
				switch (v.rankSelect) {
					case 'Ensign':
						update["privilege"] = 1;
						update["responsibility"] = 20;
						rank = getTranslationByKey("rank-ensign");
						break;
					case 'LieutenantJr':
						update["privilege"] = 1;
						update["responsibility"] = 20;
						rank = getTranslationByKey("rank-junior");
						break;
					case 'Lieutenant':
						update["privilege"] = 2;
						update["responsibility"] = 19;
						rank = getTranslationByKey("rank-lt");
						break;
					case 'LtCommander':
						update["privilege"] = 2;
						update["responsibility"] = 19;
						rank = getTranslationByKey("rank-lt-comm");
						break;
					case 'Commander':
						update["privilege"] = 3;
						update["responsibility"] = 18;
						rank = getTranslationByKey("rank-comm");
						break;
					case 'Captain':
						update["privilege"] = 4;
						update["responsibility"] = 17;
						rank = getTranslationByKey("rank-cap");
						break;
					default:
						update["privilege"] = 1;
						update["responsibility"] = 20;
						rank = getTranslationByKey("rank-ensign");
				}
				if(ranks.includes((v.rank || "").trim().toLowerCase())) {
					update["rank"] = rank;
				}
				setAttrs(update);
		});
	});

	//Reputation dice template
	on("change:influence", () => {
		getAttrs(["influence"], (v) => {
			let reputationRoll = "";
			for (diceNumber = 1; diceNumber <= (parseInt(v.influence) || 0); diceNumber++) {
				reputationRoll += `{{dice${diceNumber}=[[{{ceil(((@{reputation})-d20cf>@{responsibility}cs@{privilege}+1e-2)/((@{reputation})-(@{privilege}))),{2}}kl1,{0}}kh1]]}}`;
			}
			setAttrs({"reputationRoll": reputationRoll});
		});
	});

	//Configure Stress Max
	on("change:fitness change:security change:stress_bonus", () => {
		getAttrs(["fitness", "security", "stress_bonus"], (v) => {
			setAttrs({"stress_max": (parseInt(v.fitness) || 0) + (parseInt(v.security) || 0) +  (parseInt(v.stress_bonus) || 0)});
		});
	});

	//Configure Shield Max
	on("change:ship_structure change:ship_security change:shields_bonus", () => {
		getAttrs(["ship_structure", "ship_security", "shields_bonus"], (v) => {
			setAttrs({"shields_max": (parseInt(v.ship_structure) || 0) + (parseInt(v.ship_security) || 0) + (parseInt(v.shields_bonus) || 0)});
		});
	});

	//Update the stress and shield bubbles when the max changes
	on("change:stress_max", () => {
		getAttrs(["stress_max"], (v) => {
			let attrs = {};
			let stress = parseInt(v.stress_max) || 0;
			for (i = 1; i <= stress; i += 1) {
				attrs[`stress_${i}_enabled`] = "true";
			}
			for (i = stress + 1; i <= 24; i += 1) {
				attrs[`stress_${i}`] = 0;
				attrs[`stress_${i}_enabled`] = "false";
			}
			setAttrs(attrs);
		});
	});

	on("change:shields_max", () => {
		getAttrs(["shields_max"], (v) => {
			let attrs = {};
			let shields = parseInt(v.shields_max) || 0;
			for (i = 1; i <= shields; i += 1) {
				attrs[`shields_${i}_enabled`] = "true";
			}
			for (i = shields + 1; i <= 24; i += 1) {
				attrs[`shields_${i}_enabled`] = "false";
			}
			setAttrs(attrs);
		});
	});

	//Configure weapon damage
	on("change:repeating_weapons:weapon_damage", () => {
		getAttrs(["repeating_weapons_weapon_damage", "security"], (v) => {
			setAttrs({"repeating_weapons_damageRoll": calcDamageRoll(v.repeating_weapons_weapon_damage, "",v.security,0)});
		});
	});
	on("change:security", () => {
		getSectionIDs("repeating_weapons", (ids) => {
			if(ids.length) {
				let fields = ["security"];
				fields.push(...ids.map((id) => `repeating_weapons_${id}_weapon_damage`));
				getAttrs(fields, (v) => {
					let update = {};
					_.each(ids, (id) => {
						update[`repeating_weapons_${id}_damageRoll`] = calcDamageRoll(v[`repeating_ship_${id}_weapon_damage`],"",v.security,0);
					});
					setAttrs(update);
				});
			}
		});
	});

	//Configure damage for ships
	on("change:repeating_ship:weapon_damage change:repeating_ship:weapon_type", () => {
		getAttrs(["repeating_ship_weapon_damage","repeating_ship_weapon_type", "ship_security" ,"ship_scale"], (v) => {
			setAttrs({"repeating_ship_damageRoll": calcDamageRoll(v.repeating_ship_weapon_damage,v.repeating_ship_weapon_type,v.ship_security,v.ship_scale)});
		});
	});
	on("change:ship_security change:ship_scale", () => {
		updateShipWeaponsAll();
	});
	const updateShipWeaponsAll = function() {
		getSectionIDs("repeating_ship", (ids) => {
			if(ids.length) {
				let fields = ["ship_security", "ship_scale"];
				fields.push(
					...ids.map((id) => `repeating_ship_${id}_weapon_damage`)
					, ...ids.map((id) => `repeating_ship_${id}_weapon_type`)
				);
				getAttrs(fields, (v) => {
					let update = {};
					_.each(ids, (id) => {
						update[`repeating_ship_${id}_damageRoll`] = calcDamageRoll(v[`repeating_ship_${id}_weapon_damage`],v[`repeating_ship_${id}_weapon_type`],v.ship_security,v.ship_scale);
					});
					setAttrs(update);
				});
			}
		});
	};
	const calcDamageRoll = function(damage, type, security, scale) {
		let roll = "", total = 0 + (parseInt(damage) || 0) + (parseInt(security) || 0) + ((type || "Energy").toLowerCase() == "energy" ? (parseInt(scale) || 0) : 0);
		if(total) {
			for(let i = 1; i <= total; i++) {
				roll += `{{cdice${i}=[[1d6]]}}`;
			}
		}
		return roll;
	};

	// Version handling
	const versioning = function() {
		getAttrs(["version"], (v) => {
			let vrs = parseFloat(v["version"]) || 0.0;
			if (vrs === staglobals_currentversion) {
				console.log("Star Trek Adventures by Roll20 v" + vrs);
			} else if (vrs < 1.5) {
				console.log("UPDATING TO 1.5");
				updateShipWeaponsAll();
				setAttrs({"version": "1.5"}, {silent: true}, () => {
					versioning();
				});
			} else {
				setAttrs({"version": staglobals_currentversion}, {silent: true}, () => {
					versioning();
				});
			}
		});
	};
</script>




