<input type="checkbox" name="attr_version" class="arrowver hidden" value="1" checked="checked">
<div class="version-notes">
    <div class="arrow-info version-arrow">
       >>> click here to close this section >>> <input type="checkbox" name="attr_version" class="arrowver" value="0">
    </div>
    <br>Welcome to Version 2.0
    <h5>Changelog:</h5>
    -4's are now signaled in rolls so that you can substract them from results
    <br>-Fixed Skill section
    <br>-Added Gimikku rolls
    <br>-Added Detailed Equipement and Contacts sections
    <br>-Automated Secondary Characteristic calculations
    <br>-Serious Wounds (to the right of Hit Points) now penalize rolls automatically
    <br>-Initiative rolls now take into account melee weapon ReactionSpeed modifyers when said weapons are "in hand"
    <br>-Added Tooltips explaining the character sheet's new functionalities
    
    <br><br>Click this arrow if you need detailed explanations:<input type="checkbox" class="arrow" name="attr_rngdrop" checked="true"/><span></span>
    <div class="rngdropfield">
    <br><h4>Roll results and Flags the for "4/shi" rule</h4>
    Roll results will appear in red if they contain some 4's, you will have to <b>substract them from the displayed roll total yourself</b>. Hover your mouse over the result to see how many 4's were rolled (they too will appear in red in the detailed roll).
    <br>For exemple: if the roll displays 23 in red, put your mouse cursor over the 23. In the black tooltip that will appear, if there are two 4's, you then substract 8 from 23, so you actually rolled a 15! Easy, insn't it?
    <br><br><h4>Melee Weapons and ReactionSpeed modifier to Initiative</h4>
    In the Melee weapon table if you check the check box at the end of the line, the value in the REA mod field of this weapon will be added to the total number of dice rolled when rolling initiative!
    <br><br><h4>Serious Wounds Counter and Auto-calc</h4>
    Right next to your Hit Points, there is a small input field labelled "SW", used to track how many Serious Wounds your character is suffuring from. The number in this field will be automatically substacted from the total number of dice rolled in all Action rolls (except Gimikku and Weapon damage).
    <br><br><h4>Automatic calculation of Secondary Characteristics</h4>
    Secondary characteristics are now calculated automatically, you can add modifiers to them by clicking on the gear icon arrow to the bottom-right of their section.
    <br>(Here are your old secondary characteristics values, if they differed from actual calculations: 
    <br>SW:<input type="number" class="oldchar" name="attr_oswt" value="@{seriousWoundThreshold}" disabled="disabled"> DT:<input type="number" class="oldchar" name="attr_odt" value="@{deathThreshold}" disabled="disabled"> MOV:<input type="number" class="oldchar" name="attr_omov" value="@{movement}" disabled="disabled"> DEF:<input type="number" class="oldchar" name="attr_odef" value="@{defence}" disabled="disabled"> REA:<input type="number" class="oldchar" name="attr_orea" value="@{reactionSpeed}" disabled="disabled"> ACT:<input type="number" class="oldchar" name="attr_oact" value="@{actions}" disabled="disabled">)
    </div>
    <br><br>Other options, like rolling in secret or asking for a modifier for each roll, are inclunded in the footer of this character sheet, as well as an option to show these version notes again!
    <br>Thank You, from Yui V.
</div>
<div class="sheet-sheet" style=" position:relative;">
    <div class="sheet-2colrow">
        <div class="sheet-col sheet-kuro_fields">
            <div class="sheet-2colrow">
                <div class="sheet-col sheet-kuro_fields">
                    <div class="kuro_logo">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSSJ-RGjufw6fPXiViS7bsYymJUn0ZV591F7A&usqp=CAU"></img>
                    </div>
                </div>
                <div class="sheet-kuro_fields-name">
                    <b><span class="sheet-name">name</span><span class="sheet-value"><input type="text" name="attr_name"  spellcheck="false"/></span></b>
                </div>
                <div class="sheet-col sheet-kuro_fields-misc">
                    <div class="sheet-kuro_field"><span class="sheet-name">age</span><span class="sheet-value"><input type="number" name="attr_age" /></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">gender</span><span class="sheet-value"><input type="text" name="attr_gender"  spellcheck="false"/></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">profession</span><span class="sheet-value"><input type="text" name="attr_profession"  spellcheck="false"/></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">kaiso</span><span class="sheet-value"><input type="number" name="attr_kaiso" /></span></div>
                </div>
                <div class="sheet-col sheet-kuro_fields-misc">
                    <div class="sheet-kuro_field"><span class="sheet-name">size</span><span class="sheet-value"><input type="text" name="attr_size"  spellcheck="false"/></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">weight</span><span class="sheet-value"><input type="text" name="attr_weight"  spellcheck="false"/></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">eyes</span><span class="sheet-value"><input type="text" name="attr_eyes"  spellcheck="false"/></span></div>
                    <div class="sheet-kuro_field"><span class="sheet-name">hair</span><span class="sheet-value"><input type="text" name="attr_hair"  spellcheck="false"/></span></div>
                </div>
            </div>
            <div>
                <textarea name="attr_notesAndEquipment" spellcheck="false"></textarea>
            </div>
        </div>
        
        
        
        <div class="sheet-col sheet-kuro_fields_char">
            
            <div class="sheet-kuro_section_title">
              Characteristics
            </div>
            
            <div class="sheet-2colrow">
                <div class="sheet-col sheet-kuro_fields">
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Strength (STR)</span><span class="sheet-value"><input type="number" name="attr_strength" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Strength (STR)}} {{roll=[[(@{strength}-@{sw})D6!cf4+[[@{strength}*(1+@{ver})]]+@{mod}]]}}"   name="roll_strenght" ></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Stamina (STA)</span><span class="sheet-value"><input type="number" name="attr_stamina" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Stamina (STA)}} {{roll=[[(@{stamina}-@{sw})D6!cf4+[[@{stamina}*(1+@{ver})]]+@{mod}]]}}"     name="roll_stamina"  ></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Reflexes (REF)</span><span class="sheet-value"><input type="number" name="attr_reflexes" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Reflexes (REF)}} {{roll=[[(@{reflexes}-@{sw})D6!cf4+[[@{reflexes}*(1+@{ver})]]+@{mod}]]}}"   name="roll_reflexes" ></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Dexterity (DEX)</span><span class="sheet-value"><input type="number" name="attr_dextirity" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Dexterity (DEX)}} {{roll=[[(@{dextirity}-@{sw})D6!cf4+[[@{dextirity}*(1+@{ver})]]+@{mod}]]}}" name="roll_dextirity"></span></div>
                </div>
                <div class="sheet-col sheet-kuro_fields">
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Intelligence(INT)</span><span class="sheet-value"><input type="number" name="attr_intelligence" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Intelligence (INT)}} {{roll=[[(@{intelligence}-@{sw})D6!cf4+[[@{intelligence}*(1+@{ver})]]+@{mod}]]}}" name="roll_intelligence"></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Perception (PER)</span><span class="sheet-value"><input type="number" name="attr_perception" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Perception (PER)}} {{roll=[[(@{perception}-@{sw})D6!cf4+[[@{perception}*(1+@{ver})]]+@{mod}]]}}"     name="roll_perception"  ></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Willpower (WIL)</span><span class="sheet-value"><input type="number" name="attr_willpower" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Willpower (WIL)}} {{roll=[[(@{willpower}-@{sw})D6!cf4+[[@{willpower}*(1+@{ver})]]+@{mod}]]}}"       name="roll_willpower"   ></span></div>
                    <div class="sheet-kuro_field_char"><span class="sheet-name">Charisma (CHA)</span><span class="sheet-value"><input type="number" name="attr_charisma" /><button 
                    type="roll" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Charisma (CHA)}} {{roll=[[(@{charisma}-@{sw})D6!cf4+[[@{charisma}*(1+@{ver})]]+@{mod}]]}}"         name="roll_charisma"    ></span></div>
                </div>
            </div>
            
            
            <div class="sheet-kuro_section_title">
              Secondary Characteristics
            </div>
            
            <div class="sheet-kuro_field-sec">
                <span class="sheet-name-hits">Hits</span><span class="sheet-value-hits"><input type="number" name="attr_hits"/> / <input type="number" class="hits-max" name="attr_hits_max" value="(@{stamina}*2+@{willpower})*5+@{pvmax}" disabled="true" /></span>
            <div class="sw"> SW:</div><input type="number" class="swnum sw" name="attr_sw" Placeholder="#"/><span class="tooltip">Number of Serious Wounds (attacks<br>
                                                            of which damage meets or overcome<br>
                                                            SWT) received by your character.<br>
                                                            Each SW inflicts a penalty of 1D6<br>
                                                            on all action rolls (this value<br>
                                                            will automatically be substracted<br>
                                                            from the number of dice rolled in<br>
                                                            all rolls on this sheet).</span><input type="hidden" class="swnum" name="attr_sw" value="0"/>
            </div>
            <div class="sheet-kuro_field-sec">
                Initiative<button type='roll' value='@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Initiative (REA)}} {{roll=[[([[@{reaction}+@{ini}]]+@{mod_REA}-@{sw})D6!cf4+[[(@{reaction}+@{ini}+@{mod_REA})*(1+@{ver})]]+@{mod}&{tracker}]]}} {{fumble=[Substract a 4 from Initiative](~substract-ini)}}{{desc=@{character_name} enters combat@{inmelee}}}' name='roll_initiative'></button>
                <button type='roll' value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{text1=@{character_name}'s Initiative is reduced by}} {{roll=[[4&{tracker:-}]]}}" class="hidden" name='roll_substract-ini'></button>
            </div> 
            <div class="3colrow">
                <div class="col-sec">
                    <span class="sheet-name-secondary">Serious Wound<div>
                    Threshold (SW)</div></span><span class="sheet-value"><input type="number" name="attr_seriouswound" value="ceil((@{hits_max})/3)+@{swt}" disabled="true" /></span>
                </div>
                
                <div class="col-sec">
                    <span class="sheet-name-secondary">Defence (DEF)</span><span class="sheet-value"><input type="number" name="attr_defense" value="(@{dextirity}+@{reflexes}+@{perception})*2+@{def}" disabled="true" /></span>
                </div>
                
                <div class="col-sec">
                    <span class="sheet-name-secondary">Actions (ACT)</span><span class="sheet-value"><input type="number" name="attr_action" value="ceil(@{reflexes}/2)+@{act}" disabled="true" /></span>
                </div>
            </div>
            
            <div class="3colrow">
                <div class="col-sec">
                    <span class="sheet-name-secondary">Death<div>
                    Threshold (DT)</div></span><span class="sheet-value"><input type="number" name="attr_death" value="(@{seriouswound})-((@{seriouswound})*2)+@{swt}-@{dt}" disabled="true" /></span>
                </div>
                
                <div class="col-sec">
                    <span class="sheet-name-secondary">Reaction Speed<div>
                    (REA)</div></span><span class="sheet-value"><input type="number" name="attr_reaction" value="@{reactionvalue}+@{rea}" disabled="true" /></span>
                </div>
                
                <div class="col-sec">
                    <span class="sheet-name-secondary">Movement (MOV)</span><span class="sheet-value"><input type="number" name="attr_move" value="@{dextirity}+@{mov}" disabled="true" /></span>
                </div>
            </div>
            
            <div class="evo">
                <span class="sheet-name-secondary">Experience Points </span><span class="sheet-value"><input type="number" name="attr_evolution-points"/></span>
            </div>
            <div class="secoptionsdrop">
                <span style="font-family: Pictos; font-size: 1.1em; display: inline;">y</span><input type="checkbox" class="arrow-left" name="attr_secoptionsdrop" checked="true"/><span></span>
                <div class="secoptions">
                    <br>
                    <b>Secondary Characteristics Modifiers:</b><br>
                    
                    SW:<input type="number" name="attr_swt" value="0"/> DEF:<input type="number" name="attr_def" value="0"/> ACT:<input type="number" name="attr_act" value="0"/> Initiative:<input type="number" name="attr_ini" value="0"/><br>
                    DT:<input type="number" name="attr_dt" value="0"/> REA:<input type="number" name="attr_rea" value="0"/> MOV:<input type="number" name="attr_mov" value="0"/> Hits:<input type="number" name="attr_pvmax" value="0"/>
                    
                </div>
            </div>
        </div>
    </div>    
    

    
    <div class="sheet-kuro_section_title">
        Skills
    </div>
    <div>
        <div class="sheet-2colrow">
            <div class="skill-column-left">
                <div class="custom-body-section">
                    <fieldset class="repeating_custom-domain">
                        
                        <input type="hidden" name="attr_cswitch" class="arrowcustomrow" value="1">
                        <div class="skill-row">
                            <input type="hidden" name="attr_cswitch" class="cswitch">
                            <div class="select-skills">
                                Click on the gear Icon to the right to create a Skill Category, Area or Specialization
                            </div>
                            <div class="section-containercat combat-skills">
                                Combat Skills
                            </div>
                            <div class="section-containercat academic-skills">
                                Academic Skills
                            </div>
                            <div class="section-containercat general-skills">
                                General Skills
                            </div>
                            <div class="section-containercat technical-skills">
                                Technical Skills
                            </div>
                            <div class="section-containercat enginering-skills">
                                Engineering Skills
                            </div>
                            <div class="section-containercat contacts-skills">
                                Contacts
                            </div>
                            <div class="domain">
                                <div class="custom-domain-container">
                                    <input type="text" class="custom-domain-name" name="attr_custom-domain" placeholder="Skill area"/><input type="number" class="domain-value" name="attr_custom-domain-value" placeholder="Value" />
                                </div>
                            </div>
                            <div class="skill">
                                <div class="custom-skill-container">
                                    <input type="text" class="custom-skill-name" name="attr_custom-skill" placeholder="Specialization"/><input type="text" class="custom-skill-gimikku" name="attr_custom-gimikku" placeholder="Gimikku"/><input type="number" class="skill-value" name="attr_custom-skill-value" placeholder="Value"/><input type="hidden" class="swnum" name="attr_custom-skill-value" value="0"/><button
                                    type='roll' value="@{msgtype}&{template:skillroll} {{name=@{character_name}}} {{skill=@{custom-skill}}} {{value=@{custom-skill-value}}} @{skill_char_dialog}-@{sw})D6!cf4+@{custom-skill-value}+@{mod}]]}}{{gimikku=@{custom-gimikku}}}" name='roll_customSkillRoll'></button>
                                </div>
                            </div>
                            <span style="font-family: Pictos; font-size: 0.9em; display: inline;margin-right:-12px;color:rgb(157,157,157);">y</span>
                            <select name="attr_cswitch" class="customswitch">
                                <option value="8" selected="selected">-</option>
                                <option value="0">Skill Area</option>       
                                <option value="1">Specialization</option>   
                                <option value="2">Combat Skills Category Header</option>
                                <option value="3">Academic Skills Category Header</option>
                                <option value="4">General Skills Category Header</option>
                                <option value="5">Technical Skills Category Header</option>
                                <option value="6">Engineering Skills Category Header</option>
                                <option value="7">Contacts Category Header</option>
                            </select>
                        </div>
                        
                    </fieldset>
                </div>
            </div>
            
                <div class="gimikku-info-roll">
                    <div class="gimikku-header">
                        Gimikku
                    </div>
                    <div class="gimikku-name-ex">
                        <b>Expertise</b> : Rerolls the lowest die <br>No «4/shi» rule on the reroll, but can explode
                    </div>
                    <button type="roll" class="gimmikku-roll-button" 
                    name="roll_ex" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Gimikku: Expertise}} {{text1=replace the lowest die of the roll with}} {{roll=[[1d6!cf0]]}} {{desc=No 4/shi on this die, but can still explode}}"></button>
                    <div class="gimikku-name">
                        <b>Accuracy</b> : Margin of success +4
                    </div>
                         <button type="roll" class="gimmikku-roll-button" 
                         name="roll_pr" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Gimikku: Accuracy}} {{text1=Add}} {{roll=[[+4]]}} {{text2=To the roll's Margin of Success}} {{desc=}}"></button>
                    <div class="gimikku-name">
                        <b>Focus</b> : +2 to the roll result
                    </div>
                        <button type="roll" class="gimmikku-roll-button" 
                        name="roll_sp" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Gimikku: Focus}} {{text1=Add}} {{roll=[[+2]]}} {{text2=To the roll result}}"></button>
                    <div class="gimikku-name">
                        <b>Mastery</b> : Explodes one 5 as if it was a 6
                    </div>
                        <button type="roll" class="gimmikku-roll-button" 
                        name="roll_ma" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Gimikku: Mastery}} {{text1=one 5 in the roll explodes once and adds}} {{roll=[[1d6!cf4]]}} {{text2=To the result}} {{desc=4/shi rule and explosion on 6's apply}}"></button>
                    <div class="gimikku-name">
                        <b>Boost</b> : +1D to the specialization
                    </div>
                       <button type="roll" class="gimmikku-roll-button" 
                       name="roll_cp" value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Gimikku: Boost}} {{text1=Add}} {{roll=[[1d6!cf4]]}} {{text2=To the roll result}} {{desc=4/shi rule and explosion on 6's apply}}"></button>

                </div>
                <div class="skill-roll-char">
                    <input type="checkbox" name="attr_skill_char_dialog" class="charbox1 hidden" value="@{skill-characteristic}"  checked="true"/>
                    <div class="skill-char-select-container">
                        __________________________________________________<br>
                        Characteristic to be used in the next Skill Roll:
                        <select name="attr_skill-characteristic"  class="skill-char-select">
                            <option value="{{char=``Oops, please select a Characteristic for this Skill Roll, just below the Gimikku section!``}} {{roll3=[[0]]}}" selected="selected">-</option>  
                            <optgroup label="Physical">
                            <option value="{{char=STR}} {{roll3=[[(@{strength}">STR</option>  
                            <option value="{{char=STA}} {{roll3=[[(@{stamina}">STA</option>
                            <option value="{{char=REF}} {{roll3=[[(@{reflexes}">REF</option>
                            <option value="{{char=DEX}} {{roll3=[[(@{dextirity}">DEX</option>
                            </optgroup>
                            <optgroup label="Mind">
                            <option value="{{char=INT}} {{roll3=[[(@{intelligence}">INT</option>
                            <option value="{{char=PER}} {{roll3=[[(@{perception}">PER</option>
                            <option value="{{char=WIL}} {{roll3=[[(@{willpower}">WIL</option>
                            <option value="{{char=CHA}} {{roll3=[[(@{charisma}">CHA</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="char-options-header">
                        ______________________________________________________ options
                    </div>
                    <input type="checkbox" class="arrow-left" name="attr_skill-char-options-toggle"/><span></span>
                    <div class="skill-char-options">
                        <div class="arrow-info">
                            click the arrow<br>to close this<br>section
                        </div>
                        <div>
                            Select here the Characteristic that will determine
                        </div> 
                        <div>
                            how many dice are rolled in the next Skill roll
                        </div>
                        <br>Select Characteristic on the sheet: <input type="checkbox" name="attr_skill_char_dialog" value="@{skill-characteristic}" checked="true"/>
                        <br>Use a dialog box when a roll button is clicked instead: <input type="checkbox" name="attr_skill_char_dialog" value="?{Characteristic | STR, {{char=STR&amp;#125;&amp;#125;  {{roll3=[[(@{strength} | STA, {{char=STA&amp;#125;&amp;#125; {{roll3=[[(@{stamina} | REF, {{char=REF&amp;#125;&amp;#125; {{roll3=[[(@{reflexes} | DEX, {{char=DEX&amp;#125;&amp;#125; {{roll3=[[(@{dextirity} | INT, {{char=INT&amp;#125;&amp;#125; {{roll3=[[(@{intelligence} | PER, {{char=PER&amp;#125;&amp;#125; {{roll3=[[(@{perception} | WIL, {{char=WIL&amp;#125;&amp;#125; {{roll3=[[(@{willpower} | CHA, {{char=CHA&amp;#125;&amp;#125; {{roll3=[[(@{charisma}}" />
                    </div>
                </div>
            
        </div>
    </div>
    
  
    <div class="left">
        <div class="sheet-kuro_section_title">
            Equipement
        </div>
        <div class="weapon-tables">
            
            <div class="ranged-weapon-table">
                <div class="rng-row-weap">
                    <b>Ranged weapons</b>
                </div>
                <div class="rng-row-dam">
                    Damage
                </div>
                <div class="rng-row-sho">
                    Short<br><span>TN 8</span>
                </div>
                <div class="rng-row-med">
                    Medium<br><span>TN 12</span>
                </div>
                <div class="rng-row-lon">
                    Long<br><span>TN 20</span>
                </div>
                <div class="rng-row-ext">
                    Extreme<br><span>TN 32</span>
                </div>
                <div class="rng-row-amm">
                    Clip
                </div>
                <div class="rng-row-not">
                    Notes
                </div>
                
                
                <fieldset class="repeating_ranged-weapons">
                    <input type="checkbox" class="arrow" name="attr_rngdrop" checked="true"/><span></span>
                    <div class="rng-row-name">
                        <input type="text" name="attr_rng"  Placeholder="Name" spellcheck="false"/>
                    </div>
                    <div class="rng-row-odd-dmg">
                        <input type="number" class="dmg-die" name="attr_dmgDie" Placeholder="#"/><input type="text" class="dmg-faces" value="d6+" disabled="true"/><input type="number" class="dmg-die" name="attr_dmgMod" /><input type="hidden" class="swnum" name="attr_dmgMod" value="0"/><button
                        type='roll' value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Ranged Damage (@{rng})}} {{text1=@{character_name} inflicts}} {{roll=[[@{dmgDie}d6cf0cs7+@{dmgMod}[@{rng}]+@{mod}]]}} {{text2=damage plus Margin of Success!}}" name='roll_rngDmg'></button>
                    </div>
                    <div class="rng-row">
                        <input type="number" name="attr_C" Placeholder="S"/>
                    </div>
                    <div class="rng-row-odd">
                        <input type="number" class="odd" name="attr_M" Placeholder="M"/>
                    </div>
                    <div class="rng-row">
                        <input type="number" name="attr_L" Placeholder="L"/>
                    </div>
                    <div class="rng-row-odd">
                        <input type="number" class="odd" name="attr_E" Placeholder="E"/>
                    </div>
                    <div class="rng-row">
                        <input type="text" class="ammo-notes" name="attr_rngAmmo" Placeholder="Clip" spellcheck="false"/>
                    </div>
                    <div class="rng-row-last">
                        <input type="text" class="odd-text" class="ammo-notes" name="attr_rngNotes" Placeholder="Notes" spellcheck="false"/>
                    </div>
                    <div class="rngdropfield">
                        <input type="text" class="Desc" name="attr_rngDesc" Placeholder="Description" spellcheck="false"/>
                    </div>
                </fieldset>
            </div>
            
            <div class="2colspan">
                <div class="col">
                    <div>
                        <b>Other</b>
                        <div class="finances-field">
                            <span class="sheet-name">Finances</span><span class="sheet-value"><input type="text" name="attr_finances"  spellcheck="false"/></span>
                        </div>
                    </div>
                    <textarea class="area-other" name="attr_weapons" spellcheck="false"></textarea>
                </div>
                <div class="col">
                    <div class="melee-weapon-table">
                        <div class="ml-row-weap">
                            <b>Melee Weapons</b>
                        </div>
                        <div class="ml-row-dam">
                            Damage
                        </div>
                        <div class="ml-row-rea">
                            Rea
                        </div>
                        <div class="ml-row-hand">
                            In Hand
                        </div>
                        <fieldset class="repeating_melee-weapons">
                            <input type="checkbox" class="arrow" name="attr_mldrop" checked="true"/><span></span>
                            <div class="ml-row">
                                <input type="text" name="attr_ml"  Placeholder="Name" spellcheck="false"/>
                            </div>
                            <div class="ml-row-odd">
                                <input type="number" class="dmg-die" name="attr_mldmgDie" Placeholder="#"/><input type="text" class="dmg-faces" value="d6+" disabled="true"/><input type="number" class="dmg-die" name="attr_mldmgMod" /><input type="hidden" class="swnum" name="attr_mldmgMod" value="0"/><button
                                type='roll' value="@{msgtype}&{template:gimikku} {{name=@{character_name}}} {{title=Melee Damage (@{ml})}} {{text1=@{character_name} inflicts}} {{roll=[[@{mldmgDie}d6cf0cs7+@{mldmgMod}[@{ml}]+@{mod}]]}} {{text2=damage plus Margin of Success!}}" name='roll_mlDmg'></button>
                            </div>
                            <div class="ml-row-number">
                                <input type="number" name="attr_mlrea" Placeholder="Rea"/>
                            </div>
                            <div class="ml-row-end">
                                <input type='checkbox' class="rea_tooltip" name='attr_reaMod' value='on'/><span class="tooltip">When checked, the weapon's<br>Reaction Speed Mod will be<br>taken into account when<br>rolling Initiative</span>
                            </div>
                            <div class="mldropfield">
                                <input type="text" class="Desc" name="attr_mlDesc" Placeholder="Description" spellcheck="false"/>
                            </div>
                        </fieldset>
                    </div>
                    
                    <div class="protections-table">
                        <div class="prot-row-arm">
                            <b>Protection</b>
                        </div>
                        <div class="prot-row-tot">
                            <input type="number" name="attr_protectionTotal" Placeholder="Total"/>
                        </div>
                        <fieldset class="repeating_protections">
                            <div class="prot-row">
                                <input type="text" name="attr_protection"  Placeholder="Name" spellcheck="false"/>
                            </div>
                            <div class="prot-row-tot">
                                <input type="number" name="attr_protectionValue" Placeholder="Value"/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
    </div>
    


                            
    <div class="row">
        <div class="sheet-kuro_section_title">
            Contacts
        </div>
        <div name="kuro_third_row">
            <div  class="contact-table">
                <div>
                    <div class="contact-row-title">
                        Contact
                    </div>
                    <div class="contact-row-title-small">
                        Profession
                    </div>
                    <div class="contact-row-title-large">
                        Description
                    </div>
                    <div class="contact-row-title-small">
                        Location
                    </div>
                </div>
                <fieldset class="repeating_contacts">
                    <div>
                        <div class="contact-row">
                            <input type="text" name="attr_contact-name"  Placeholder="Name" spellcheck="false"/>
                        </div>
                        <div class="contact-row-small">
                            <input type="text" name="attr_contact-profession"  Placeholder="Profession" spellcheck="false"/>
                        </div>
                        <div class="contact-row-large">
                            <input type="text" name="attr_contact-description"  Placeholder="Description" spellcheck="false"/>
                        </div>
                        <div class="contact-row-small">
                            <input type="text" name="attr_contact-location"  Placeholder="Location" spellcheck="false"/>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    


    <div class="sheet-kuro_section_title">
        Background
    </div>
    <textarea name="attr_background" spellcheck="false"></textarea>

</div>



<script type="text/worker">
    /* ===== Calculate REA/Initiative Modifyer ========== */
    
    /* ===== PARAMETERS ==========
    destinations = the name of the attribute that stores the total quantity
            can be a single attribute, or an array: ['total_cost', 'total_weight']
            If more than one, the matching fields must be in the same order. 
    section = name of repeating fieldset, without the repeating_
    fields = the name of the attribute field to be summed
          destination and fields both can be a single attribute: 'weight'
          or an array of attributes: ['weight','number','equipped']
    */
    const repeatingSum = (destinations, section, fields) => {
        if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
        if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
        getSectionIDs(`repeating_${section}`, idArray => {
            const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
            getAttrs([...attrArray], v => {
                const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
                const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
                const output = {};
                destinations.forEach((destination, index) => {
                    output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
                });
                setAttrs(output);
            }); 
        }); 
    };
    
    on('change:repeating_melee-weapons:mlrea change:repeating_melee-weapons:reaMod remove:repeating_melee-weapons sheet:opened', function() {
    	repeatingSum("mod_REA","melee-weapons",["mlrea", "reaMod"]);
    }); 
    
    /* ===== Calculate Reaction Speed ========== */  

    on("change:willpower change:reflexes change:intelligence sheet:opened", function() {
        getAttrs(["willpower", "reflexes", "intelligence"], function(values) {
            let will = parseInt(values.willpower)||0;
            let ref = parseInt(values.reflexes)||0;
            let int = parseInt(values.intelligence)||0;
            let sumwri = will + ref + int;   
            let rea = Math.ceil(sumwri/2);
            setAttrs({ reactionvalue: rea });
        });
    });
    
    /* ===== Display in hand melee weapon ========== */
    
    on('change:mod_rea sheet:opened', function() {
    	getAttrs(["mod_REA"], function(values) {
            let message;
            let modval = parseInt(values.mod_REA)||0;
            if ( modval > 0) message = " ready for melee, weapon in hand !";
            else if ( modval < 0) message = " ready for melee, weapon in hand !";
            else if ( modval === 0) message = "!";
            setAttrs({ 
                inmelee: message 
            });
        });    
    });
     
    /* ===== Whips to GM option ========== */
    
    on('change:whisp', function() {
    	getAttrs(["whisp"], function(values) {
            let command;
            let opt = parseInt(values.whisp)||0;
            if ( opt === 0) command = " ";
            else if ( opt === 1) command = "/w gm";
            setAttrs({ 
                msgtype: command 
            });
        });    
    });

</script>

<input  type="hidden" name="attr_reactionvalue" value="0"/>
<input  type="hidden" name="attr_mod_REA" value="0"/>
<input  type="hidden" name="attr_inmelee" value=" "/>
<input  type="hidden" name="attr_msgtype" value=" "/>

<div class="footer">
    Include a Modifier in rolls: <input type="checkbox" name="attr_mod" value="?{Modifier|0}"/> || Roll in secret: <input type="checkbox" name="attr_whisp" value="1"/> || <span class="ver-info">Use rules from: French edition<input type="radio" name="attr_ver" value="0"/> English edition<input type="radio" name="attr_ver" value="1" checked="true"/></span><span class="tooltip">The only difference is that somehow, for Straight Characteristics and Initiative Rolls:<br> In French ver: the math is Xd6+X | In English ver: the math is Xd6+(X*2)</span>
     || Show Version Notes: <input type="checkbox" name="attr_version" class="arrowver" value="1" checked="checked">
</div>


<rolltemplate class="sheet-rolltemplate-skillroll">
    <div class="sheet-template-body">
        <div class="sheet-template-header">{{name}} rolls for</div>{{skill}} ({{char}}+{{value}})
        <div class="sheet-template-results">
            <div class="sheet-template-total">{{roll3}}</div>{{#rollWasFumble() roll3}}<h4>4's were rolled, substract them from this total !</h4>{{/rollWasFumble() roll3}}
        </div>
        <div class="sheet-template-gimikku">
            <h5>gimikku</h5>{{gimikku}}
        </div>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-gimikku">
    <div class="sheet-template-body">
        <div class="sheet-template-header">{{name}} rolls for</div>{{title}}
        <div class="sheet-template-results">
            <div class="sheet-template-total"><div>{{text1}}</div>{{roll}}<br>{{text2}}</div> {{#rollWasFumble() roll}}<h4>4's were rolled, substract them from this total !{{fumble}}</h4>{{/rollWasFumble() roll}}
        </div>
        <div class="sheet-template-gimikku">
            {{desc}}
        </div>
    </div>
</rolltemplate>




