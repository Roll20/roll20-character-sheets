<input type="hidden" class="debug" name="attr_debug" />
<main id="megaverse" class="">
  <img
    class="logo"
    src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Palladium%20Rifts%20by%20Grinning%20Gecko/rifts-logo.png"
  />
  <span name="attr_character_name"></span>
  <div class="r-tabbed">
    <input type="radio" id="tab-core" name="css-tabs" checked />
    <input type="radio" id="tab-skills" name="css-tabs" />
    <input type="radio" id="tab-equipment" name="css-tabs" />
    <input type="radio" id="tab-wps" name="css-tabs" />
    <input type="radio" id="tab-powersabilities" name="css-tabs" />
    <input type="radio" id="tab-magic" name="css-tabs" />
    <input type="radio" id="tab-psionics" name="css-tabs" />
    <input type="radio" id="tab-modifiers" name="css-tabs" />
    <input type="radio" id="tab-bonuses" name="css-tabs" />
    <input type="radio" id="tab-importexport" name="css-tabs" />

    <ul class="r-tabs">
      <li class="r-tab">
        <label class="" for="tab-core">Core</label>
      </li>
      <li class="r-tab"><label for="tab-skills">Skills</label></li>
      <li class="r-tab"><label for="tab-equipment">Equipment</label></li>
      <li class="r-tab"><label for="tab-wps">Combat Skills</label></li>
      <li class="r-tab"><label for="tab-powersabilities">Abilities</label></li>
      <li class="r-tab"><label for="tab-magic">Magic</label></li>
      <li class="r-tab"><label for="tab-psionics">Psionics</label></li>
      <li class="r-tab"><label for="tab-modifiers">Modifiers</label></li>
      <li class="r-tab"><label for="tab-bonuses">Profiles</label></li>
      <li class="r-tab"><label for="tab-importexport">Options</label></li>
    </ul>

    <div class="r-tab-content">
      <!-- inject:partials/datalists.html -->
      <datalist id="distance-units">
  <option value="m"></option>
  <option value="km"></option>
  <option value="ft"></option>
  <option value="yd"></option>
  <option value="mi"></option>
  <option value="ly"></option>
</datalist>
<datalist id="damage-units">
  <option value="MDC"></option>
  <option value="SDC"></option>
</datalist>
<datalist id="time-units">
  <option value="seconds"></option>
  <option value="actions"></option>
  <option value="melees"></option>
  <option value="minutes"></option>
  <option value="hours"></option>
  <option value="days"></option>
  <option value="weeks"></option>
  <option value="months"></option>
  <option value="years"></option>
</datalist>
<datalist id="frequency-units">
  <option value="per second"></option>
  <option value="per action"></option>
  <option value="per melee"></option>
  <option value="per minute"></option>
  <option value="per hour"></option>
  <option value="per day"></option>
  <option value="per week"></option>
  <option value="per month"></option>
  <option value="per year"></option>
</datalist>
<datalist id="spell-schools">
  <option value="Elemental"></option>
  <option value="Invocation"></option>
  <option value="Necromancy"></option>
  <option value="Space"></option>
  <option value="Temporal"></option>
</datalist>
<datalist id="modifiers">
  <option value="Custom - Type Your Own"></option>
  <option value="RPA Basic"></option>
  <option value="RPA Elite: Glitter Boy"></option>
  <option value="Weapon: NG-P7"></option>
  <option value="Weapon: TW Flame Sword"></option>
  <option value="Armor: Crusader"></option>
  <option value="Power Armor: Glitter Boy"></option>
  <option value="TW: Armor of Ithan"></option>
  <option value="Spell: Superhuman Speed"></option>
  <option value="Psionic: Sixth Sense"></option>
  <option value="Magic Amulet: Charm"></option>
</datalist>
<datalist id="hand-to-hand">
  <option value="Hand to Hand: Basic"></option>
  <option value="Hand to Hand: Expert"></option>
  <option value="Hand to Hand: Martial Arts"></option>
  <option value="Hand to Hand: Assassin"></option>
  <option value="Hand to Hand: Commando"></option>
  <option value="Hand to Hand: Aikido"></option>
  <option value="Hand to Hand: Judo"></option>
  <option value="Hand to Hand: Jujitsu"></option>
  <option value="Hand to Hand: Karate"></option>
  <option value="Hand to Hand: Kendo"></option>
  <option value="Hand to Hand: Ninjitsu"></option>
  <option value="Hand to Hand: Samurai"></option>
  <option value="Hand to Hand: Teng-Jutsu"></option>
  <option value="Hand to Hand: Drunken Style Kung Fu"></option>
  <option value="Hand to Hand: Dragon"></option>
  <option value="RPA Combat: Basic"></option>
  <option value="RPA Combat: Flying Power Armor"></option>
  <option value="RPA Combat: Ground-Based Power Armor"></option>
  <option value="RPA Combat: Heavy Vehicular Style Robots"></option>
  <option value="RPA Combat: Heavy Ground Robots"></option>
  <option value="RPA Combat: Light Ground Robots"></option>
  <option value="RPA Combat: Glitter Boy"></option>
  <option value="RPA Combat: Silverhawk"></option>
  <option value="RPA Combat: Battleram"></option>
  <option value="RPA Combat: Bombard"></option>
  <option value="Space Fighter: Basic"></option>
  <option value="Space Fighter: Elite"></option>
  <option value="Mystic Martial Art: Xian Pu Kung Fu (Drunken Style)"></option>
</datalist>
<datalist id="weapon-proficiencies">
  <option value="W.P. Archery"></option>
  <option value="W.P. Axe"></option>
  <option value="W.P. Bayonet"></option>
  <option value="W.P. Blunt"></option>
  <option value="W.P. Chain"></option>
  <option value="W.P. Forked"></option>
  <option value="W.P. Grappling Hook"></option>
  <option value="W.P. Knife"></option>
  <option value="W.P. Paired Weapons"></option>
  <option value="W.P. Pole Arm"></option>
  <option value="W.P. Rope"></option>
  <option value="W.P. Shield"></option>
  <option value="W.P. Spear"></option>
  <option value="W.P. Staff"></option>
  <option value="W.P. Sword"></option>
  <option value="W.P. Targeting"></option>
  <option value="W.P. Whip"></option>
</datalist>
<datalist id="weapon-proficiencies-modern">
  <option value="W.P. Handguns"></option>
  <option value="W.P. Rifles"></option>
  <option value="W.P. Energy Heavy"></option>
  <option value="W.P. Energy Pistol"></option>
  <option value="W.P. Energy Rifle"></option>
  <option value="W.P. Heavy"></option>
  <option value="W.P. Paired Handguns"></option>
  <option value="W.P. Speargun"></option>
  <option value="W.P. Shotgun"></option>
  <option value="W.P. Submachinegun"></option>
  <option value="W.P. Flamethrower"></option>
</datalist>

      <!-- endinject -->

      <!-- inject:partials/core.html -->
      <div class="core">
  <br />
  <h3>Core Character Stats</h3>
  <div class="grid-container">
    <div class="section-one character-background">
      <label
        ><span>Character Name</span>
        <input type="text" value="" name="attr_character_name"
      /></label>
      <label
        ><span>True Name</span>
        <input type="text" value="" name="attr_truename_name"
      /></label>
      <label
        ><span>Race</span>
        <input type="text" value="" name="attr_character_race"
      /></label>
      <label
        ><span>Character Class</span>
        <input type="text" value="" name="attr_occ"
      /></label>
      <label
        ><span>Strength Type</span>
        <select class="" name="attr_character_ps_type" value="normal">
          <option value="1">Normal</option>
          <option value="2">Augmented</option>
          <option value="3">Robotic</option>
          <option value="3.5">Giant Robotic</option>
          <option value="4">Supernatural</option>
        </select></label
      >
      <label
        ><span>Level</span>
        <input type="number" name="attr_character_level" value="1"
      /></label>
      <label
        ><span>Experience</span> <input type="number" name="attr_experience"
      /></label>
      <label
        ><span>Alignment</span>
        <select class="select" name="attr_alignment" value="0">
          <option value="0"></option>
          <option value="Principled">Principled</option>
          <option value="Scrupulous">Scrupulous</option>
          <option value="Taoist">Taoist</option>
          <option value="Unprincipled">Unprincipled</option>
          <option value="Anarchist">Anarchist</option>
          <option value="Miscreant">Miscreant</option>
          <option value="Abberant">Aberrant</option>
          <option value="Diabolic">Diabolic</option>
        </select></label
      >
      <label
        ><span>Age</span>
        <input
          class="attribute"
          type="number"
          value=""
          name="attr_character_age"
      /></label>
      <label
        ><span>Gender</span>
        <input type="text" value="" name="attr_character_gender"
      /></label>
      <label
        ><span>Height</span>
        <input type="text" value="" name="attr_character_height"
      /></label>
      <label
        ><span>Weight</span>
        <input type="text" value="" name="attr_character_weight"
      /></label>
      <label
        ><span>Family Origin</span>
        <input type="text" value="" name="attr_character_familyorigin"
      /></label>
      <label
        ><span>Environment</span>
        <input value="" name="attr_character_environment"
      /></label>
      <label
        ><span>Native Language(s)</span>
        <input type="text" value="" name="attr_character_languages"
      /></label>
      <label
        ><span>Insanity, if any</span>
        <input type="text" value="" name="attr_character_insanity"
      /></label>
      <label
        ><span>Disposition</span>
        <input type="text" value="" name="attr_character_disposition"
      /></label>
    </div>

    <div class="section-two">
      <div class="ss-2a">
        <label for="iq" title="Intelligence Quotient">I.Q.</label>
        <input
          id="iq"
          type="number"
          value="0"
          name="attr_iq"
          title="Intelligence Quotient"
        />
        <input
          type="hidden"
          value="0"
          name="attr_iq_bonus"
          title="+ Skills %"
        />
        <span name="attr_iq_bonus" title="+ Skills %"></span>
        <input
          type="hidden"
          value="0"
          name="attr_perception_bonus"
          title="+ Perception (Rifter #13, p.16)"
        />
        <span
          name="attr_perception_bonus"
          title="+ Perception (Rifter #13, p.16)"
        ></span>

        <label for="mental-endurance" title="Mental Endurance">M.E.</label>
        <input
          id="mental-endurance"
          type="number"
          value="0"
          name="attr_me"
          title="Mental Endurance"
        />
        <input
          type="hidden"
          value="0"
          name="attr_me_bonus"
          title="+ Save vs. Psionics"
        />
        <span name="attr_me_bonus" title="+ Save vs. Psionics"></span>
        <div></div>

        <label for="mental-affinity" title="Mental Affinity">M.A.</label>
        <input
          id="mental-affinity"
          type="number"
          value="0"
          name="attr_ma"
          title="Mental Affinity"
        />
        <input
          type="hidden"
          value="0"
          name="attr_ma_bonus"
          title="% Trust/Intimidate"
        />
        <span name="attr_ma_bonus" title="% Trust/Intimidate"></span>
        <div></div>

        <label for="physical-strength" title="Physical Strength">P.S.</label>
        <input
          id="physical-strength"
          type="number"
          value="0"
          name="attr_ps"
          title="Physical Strength"
        />
        <input
          type="hidden"
          value="0"
          name="attr_ps_bonus"
          title="+ SDC Damage"
        />
        <span name="attr_ps_bonus" title="+ SDC Damage"></span>
        <div></div>

        <label for="physical-prowess" title="Physical Prowess">P.P.</label>
        <input
          id="physical-prowess"
          type="number"
          value="0"
          name="attr_pp"
          title="Physical Prowess"
        />
        <input
          type="hidden"
          value="0"
          name="attr_pp_bonus"
          title="+ Strike/Parry/Dodge/Entangle/Disarm"
        />
        <span
          name="attr_pp_bonus"
          title="+ Strike/Parry/Dodge/Entangle/Disarm"
        ></span>
        <div></div>

        <label for="physical-endurance" title="Physical Endurance">P.E.</label>
        <input
          id="physical-endurance"
          type="number"
          value="0"
          name="attr_pe"
          title="Physical Endurance"
        />
        <input
          type="hidden"
          value="0"
          name="attr_pe_bonus"
          title="+ Magic/Poison/Toxins"
        />
        <span name="attr_pe_bonus" title="+ Magic/Poison/Toxins"></span>
        <input
          type="hidden"
          value="0"
          name="attr_pe_coma_bonus"
          title="+ Coma/Death %"
        />
        <span name="attr_pe_coma_bonus" title="+ Coma/Death %"></span>

        <label for="physical-beauty" title="Physical Beauty">P.B.</label>
        <input
          id="physical-beauty"
          type="number"
          value="0"
          name="attr_pb"
          title="Physical Beauty"
        />
        <input
          type="hidden"
          value="0"
          name="attr_pb_bonus"
          title="% Charm/Impress"
        />
        <span name="attr_pb_bonus" title="% Charm/Impress"></span>
        <div></div>

        <label for="speed" title="Speed">Spd</label>
        <input
          id="speed"
          type="number"
          value="0"
          name="attr_spd"
          title="Speed"
        />
        <div></div>
        <div></div>

        <label for="speed_flying" title="Flying Speed">Spd: Fly</label>
        <input
          id="speed_flying"
          type="number"
          value="0"
          name="attr_spdfly"
          title="Flying Speed"
        />
      </div>
      <div class="ss-2b"></div>
      <div class="ss-2c">
        <label
          ><span>Hit Points</span>
          <input type="number" value="0" name="attr_character_hp" />
        </label>
        <label>
          <span title="Structural Damage Capacity">S.D.C.</span>
          <input
            type="number"
            value="0"
            name="attr_character_sdc"
            title="Structural Damage Capacity"
          />
        </label>
        <label
          ><span title="Armor Rating">A.R.</span
          ><input
            type="number"
            value="0"
            name="attr_character_ar"
            title="Armor Rating"
        /></label>
        <label
          ><span title="Mega Damage Capacity">M.D.C.</span>
          <input
            type="number"
            value="0"
            name="attr_character_mdc"
            title="Mega Damage Capacity"
          />
        </label>
        <label
          ><span title="Potential Psychic Energy">P.P.E.</span>
          <input
            type="number"
            value="0"
            name="attr_character_ppe"
            title="Potential Psychic Energy"
          />
        </label>
        <label
          ><span title="Inner Strength Points">I.S.P.</span
          ><input
            type="number"
            value="0"
            name="attr_character_isp"
            title="Inner Strength Points"
        /></label>
        <label
          ><span title="Horror Factor">H.F.</span
          ><input type="number" value="0" name="attr_hf" title="Horror Factor"
        /></label>
        <label
          ><span>Perception</span>
          <input
            id="perception"
            type="number"
            value="0"
            name="attr_perception"
          />
        </label>
      </div>
    </div>
  </div>

  <h2>Movement</h2>
  <div class="movement-container">
    <div></div>
    <label title="Miles per Hour">MPH</label>
    <label title="Feet per Melee">Ft/Melee</label>
    <label title="Feet per Attack">Ft/Attack</label>
    <label for="cruising">Cruising</label>
    <label>Run at Max</label>
    <label>Run</label>
    <input type="hidden" value="0" name="attr_run_mph" />
    <span name="attr_run_mph" title="Miles per Hour"></span>
    <input type="hidden" value="0" name="attr_run_ft_melee" />
    <span name="attr_run_ft_melee" title="Feet per Melee"></span>
    <input type="hidden" value="0" name="attr_run_ft_attack" />
    <span name="attr_run_ft_attack" title="Feet per Attack"></span>
    <input id="cruising" type="number" value="0" name="attr_run_cruising" />
    <div class="side-by-side">
      <input type="hidden" value="0" name="attr_run_at_max" />
      <span name="attr_run_at_max"></span
      ><span class="not-readonly center">minutes</span>
    </div>

    <label>Leaping Distance</label>
    <input type="number" name="attr_leapup" value="0" />
    <div>feet up?</div>
    <input type="number" name="attr_leapout" value="0" />
    <div>feet out?</div>
    <div></div>
  </div>
  <br />
  <div class="repeating-movement">
    <fieldset class="repeating_movement">
      <h5>Additional Movement Type</h5>
      <h5 title="Miles per Hour">MPH</h5>
      <h5 title="Feet per Melee">Ft/Melee</h5>
      <h5 title="Feet per Attack">Ft/Attack</h5>
      <h5>Cruising</h5>
      <h5>Max speed duration</h5>
      <input type="text" value="" name="attr_name" />
      <input type="number" value="0" name="attr_mph" title="Miles per Hour" />
      <input
        type="number"
        value="0"
        name="attr_ft_melee"
        title="Feet per Melee"
      />
      <input
        type="hidden"
        value="0"
        name="attr_ft_attack"
        title="Feet per Attack"
      />
      <span name="attr_ft_attack" class="readonly"></span>
      <input type="number" value="0" name="attr_cruising" />
      <label
        ><input type="number" value="0" name="attr_dur_at_max" /> minutes</label
      >
    </fieldset>
  </div>
</div>

      <!-- endinject -->
    </div>

    <br />

    <div class="r-tab-content">
      <!-- inject:partials/skills.html -->
      <div class="skills">
  <h3>Skills</h3>
  <div class="heading">
    <h5>Info</h5>
    <h5>Skill</h5>
    <h5>Category</h5>
    <h5>Base</h5>
    <h5>Per Level</h5>
    <h5>Bonus</h5>
    <h5>Level Acquired</h5>
    <h5>Level</h5>
    <h5>Total</h5>
    <h5></h5>
  </div>
  <fieldset class="repeating_skills">
    <input type="hidden" name="attr_new" value="1" />
    <details class="info">
      <summary>
        <div class="values">
          <b class="click-expand"
            ><span title="Click for more info">&nbsp;&#9432;</span></b
          >
          <input type="text" value="" name="attr_name" />
          <select name="attr_category" value="occ">
            <option value="occ">O.C.C.</option>
            <option value="related">O.C.C. Related</option>
            <option value="secondary">Secondary</option>
            <option value="rcc">R.C.C.</option>
            <option value="racial">Racial</option>
            <option value="other">Other</option>
          </select>
          <input type="number" value="0" name="attr_base" />
          <input type="number" value="0" name="attr_perlevel" />
          <input type="number" value="0" name="attr_bonus" />
          <input type="number" value="1" name="attr_levelacquired" />
          <span class="readonly" name="attr_level"></span>
          <input type="hidden" value="1" name="attr_level" />
          <input type="hidden" value="0" name="attr_total" />
          <span class="readonly" name="attr_total"></span>
          <button
            type="roll"
            value="@{opt_whisper}&{template:skill} [[ [[{@{total}+?{Modifier?|0},98}kl1]] + [[1d100]] ]] {{title=@{character_name} uses @{name}}} {{target=$[[0]]}} {{roll=$[[1]]}} {{total=$[[2]]}} {{add_skill=[[@{opt_add_skill}]]}}"
            name="roll_skill"
          ></button>
        </div>
      </summary>
      <div class="details-body">
        <textarea class="full" name="attr_description" value=""></textarea>
        <div class="macro-help">
          <label
            ><span><b>Row ID:</b></span>
            <input type="text" readonly name="attr_rowid" value=""
          /></label>
        </div>
      </div>
    </details>
  </fieldset>
</div>

      <!-- endinject -->
    </div>

    <div class="r-tab-content">
      <div class="equipment">
        <h3>Finances</h3>
        <button
          class="no-dice"
          type="roll"
          value="[The Trouble With Credits](https://palladiumbooks.com/questions-resources/resources/the-cutting-room-floor/58-resources/cutting-room-floor/224-the-trouble-with-credits)"
          name="roll_trouble_credits"
        >
          The Trouble With Credits
        </button>
        (link will appear in chat)
        <div class="finance-grid">
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  title="Anonymous. The credits belong to the bearer of the card."
                  ><span>Universal Credits - Bearer</span
                  ><input type="text" name="attr_credits_universal_bearer"
                /></label>
              </div>
            </summary>
            <div>
              Anonymous. The credits are usable by the bearer of the card.
            </div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Universal Credits - Marked</span
                  ><input type="text" name="attr_credits_universal_marked"
                /></label>
              </div>
            </summary>
            <div>
              Traceable. The credits are only usable by the specific individual
              whose name is on the card.
            </div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Black Market Credits</span
                  ><input type="text" name="attr_credits_blackmarket"
                /></label>
              </div>
            </summary>
            <div>Anonymous. Simple, encoded black plastic card.</div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>NGMI Credits</span
                  ><input type="text" name="attr_credits_ngmi"
                /></label>
              </div>
            </summary>
            <div>Northern Gun / Manistique Imperium credits.</div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Phase World Credits</span
                  ><input type="text" name="attr_credits_phaseworld"
                /></label>
              </div>
            </summary>
            <div>
              Buy: 1 Phase World credit for 10 Rifts Earth credits.<br />
              Sell: 1 Phase World credit for 5 Rifts Earth credits.
            </div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Splugorth Credits</span
                  ><input type="text" name="attr_credits_splugorth"
                /></label>
              </div>
            </summary>
            <div>1:1 with Phase World credits.</div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Gems & Precious Metals</span
                  ><input type="text" name="attr_credits_gems"
                /></label>
              </div>
            </summary>
            <div>
              Assortment of gems and precious metals that have trade value.
            </div>
          </details>
          <details>
            <summary>
              <div class="credits-summary">
                <label
                  ><span>Black Market Merchandise</span
                  ><input
                    type="text"
                    name="attr_credits_blackmarketmerchandise"
                /></label>
              </div>
            </summary>
            <div>Black Market items that have trade value.</div>
          </details>
        </div>
        <h3>Equipment</h3>
        <p>
          Free form equipment list for now. Weapons and armor should go in the
          Modifiers tab.
        </p>
        <textarea class="full tall" name="attr_equipment"></textarea>
      </div>
    </div>

    <div class="r-tab-content">
      <div class="wp">
        <h3>
          Hand to Hand & <span title="Robot/Power Armor">RPA</span> Combat
        </h3>
        <fieldset class="repeating_h2h">
          <details class="info">
            <summary>
              <div class="bonus-thing-heading">
                <b class="click-expand"
                  ><span title="Click for more info">&nbsp;&#9432;</span></b
                >
                <label
                  ><span>Name</span>
                  <input type="text" list="hand-to-hand" name="attr_name" />
                </label>
                <label
                  ><span>Level Acquired</span>
                  <input type="number" value="1" name="attr_levelacquired" />
                </label>
                <label
                  ><span>Level</span>
                  <span class="readonly" name="attr_level"></span>
                  <input type="hidden" value="1" name="attr_level" />
                </label>
              </div>
            </summary>
            <div class="details-body">
              <label class="description"
                ><b>Description</b>
                <textarea
                  class="full"
                  name="attr_description"
                  value=""
                ></textarea>
              </label>
              <div class="macro-help">
                <label
                  ><span><b>Row ID:</b></span>
                  <input type="text" readonly name="attr_rowid" value=""
                /></label>
              </div>
              <!-- inject:partials/repeating_modifiers.html -->
              <input type="hidden" name="attr_bonus_id" value="" />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span title="Intelligence Quotient">I.Q.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_iq_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span title="Mental Endurance">M.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_me_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span title="Mental Affinity">M.A.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ma_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span title="Physical Strength">P.S.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ps_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span title="Physical Prowess">P.P.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pp_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span title="Physical Endurance">P.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pe_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span title="Physical Beauty">P.B.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pb_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span title="Speed">Spd</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spd_abs" /><span></span
      ></label>
      <input type="number" value="0" name="attr_mod_spd" title="Speed"
    /></label>
    <label
      ><span title="Flying Speed">Spd: Fly</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spdfly_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
    /></label>
  </div>
  <div class="bonus-type-container allow-absolute">
    <label>
      <span title="Hit Points">H.P.</span>
      <span></span>
      <input type="number" value="0" name="attr_hp" title="Hit Points" />
    </label>
    <label>
      <span title="Structural Damage Capacity">S.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_sdc"
        title="Structural Damage Capacity"
      />
    </label>
    <label>
      <span title="Armor Rating">A.R.</span>
      <span></span>
      <input type="number" value="0" name="attr_ar" title="Armor Rating" />
    </label>
    <label>
      <span title="Mega Damage Capacity">M.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_mdc"
        title="Mega Damage Capacity"
      />
    </label>
    <label>
      <span title="Potential Psychic Energy">P.P.E.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_ppe"
        title="Potential Psychic Energy"
      />
    </label>
    <label>
      <span title="Inner Strength Points">I.S.P.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_isp"
        title="Inner Strength Points"
      />
    </label>
    <label>
      <span title="Horror Factor">H.F.</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_hf_abs" /><span></span>
      </label>
      <input type="number" value="0" name="attr_mod_hf" title="Horror Factor" />
    </label>
    <label>
      <span>Spell Strength</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_spellstrength_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_spellstrength" />
    </label>
    <label>
      <span>Trust</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_trust_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_trust" />
    </label>
    <label>
      <span>Intimidate</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_intimidate_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_intimidate" />
    </label>
    <label>
      <span>Charm/Impress</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_charmimpress_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_charmimpress" />
    </label>
    <label>
      <span>Skill Bonus %</span>
      <span></span>
      <input type="number" value="0" name="attr_mod_skillbonus" />
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label title="Crazy 2x, Juicer 4x, etc."
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label title="Crazy, Juicer 10x, etc."
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike" />
    </label>
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm" />
    </label>
    <label
      ><span>Entangle</span>
      <input type="number" value="0" name="attr_entangle" />
    </label>
    <label
      ><span>Throw</span>
      <input type="number" value="0" name="attr_throw" />
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="number" value="0" name="attr_pull" />
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="number" value="0" name="attr_flipthrow" />
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="number" value="0" name="attr_tackle" />
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="number" value="0" name="attr_leghook" />
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="number" value="0" name="attr_backwardsweepkick" />
    </label>
    <hr />
    <label
      ><span>Critical</span> <input type="number" value="" name="attr_critical"
    /></label>
    <label
      ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
    /></label>
    <label
      ><span>Death Blow</span>
      <input type="number" value="0" name="attr_deathblow"
    /></label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage" />
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="text" value="0" name="attr_damage_paired" />
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="text" value="0" name="attr_damage_mainhand" />
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="text" value="0" name="attr_damage_offhand" />
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike_range" />
    </label>
    <label
      ><span>Strike: Single/Pulse</span>
      <input type="number" value="0" name="attr_strike_range_single" />
    </label>
    <label
      ><span>Strike: Burst</span>
      <input type="number" value="0" name="attr_strike_range_burst" />
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="number" value="0" name="attr_strike_range_aimed" />
    </label>
    <label
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span name="attr_strike_range_aimed_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span name="attr_strike_range_aimed_pulse"></span>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="number" value="0" name="attr_strike_range_called" />
    </label>
    <label
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span name="attr_strike_range_called_single"></span>
    </label>
    <label
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span name="attr_strike_range_called_pulse"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span name="attr_strike_range_aimed_called_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span name="attr_strike_range_aimed_called_pulse"></span>
    </label>
    <hr />
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm_range" />
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage_range" />
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="text" value="0" name="attr_damage_range_single" />
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="text" value="0" name="attr_damage_range_burst" />
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="number" value="0" name="attr_parry" />
    </label>
    <label
      ><span>Dodge</span>
      <input type="number" value="0" name="attr_dodge" />
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="number" value="0" name="attr_dodge_flight" />
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="number" value="0" name="attr_dodge_auto" />
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="number" value="0" name="attr_dodge_teleport" />
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="number" value="0" name="attr_dodge_motion" />
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="number" value="0" name="attr_dodge_underwater" />
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="number" value="0" name="attr_roll" />
    </label>
    <label
      ><span>Break Fall</span>
      <input type="number" value="0" name="attr_breakfall" />
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="number" value="0" name="attr_comadeath" />
    </label>
    <label
      ><span>Curses</span>
      <input type="number" value="0" name="attr_curses" />
    </label>
    <label
      ><span>Despair</span>
      <input type="number" value="0" name="attr_despair" />
    </label>
    <label
      ><span>Disease</span>
      <input type="number" value="0" name="attr_disease" />
    </label>
    <label
      ><span>Drugs</span>
      <input type="number" value="0" name="attr_drugs" />
    </label>
    <label
      ><span>Fatigue</span>
      <input type="number" value="0" name="attr_fatigue" />
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="number" value="0" name="attr_horrorfactor" />
    </label>
    <label
      ><span>Illusions</span>
      <input type="number" value="0" name="attr_illusions" />
    </label>
    <label
      ><span>Insanity</span>
      <input type="number" value="0" name="attr_insanity" />
    </label>
    <label
      ><span>Magic</span>
      <input type="number" value="0" name="attr_magic" />
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="number" value="0" name="attr_maintainbalance" />
    </label>
    <label
      ><span>Mind Control</span>
      <input type="number" value="0" name="attr_mindcontrol" />
    </label>
    <label
      ><span>Pain</span>
      <input type="number" value="0" name="attr_pain" />
    </label>
    <label
      ><span>Perception</span>
      <input type="number" value="0" name="attr_perceptioncheck" />
    </label>
    <label
      ><span>Poison: Lethal</span>
      <input type="number" value="0" name="attr_lethalpoison" />
    </label>
    <label
      ><span>Poison: Non-Lethal</span>
      <input type="number" value="0" name="attr_nonlethalpoison" />
    </label>
    <label
      ><span>Possession</span>
      <input type="number" value="0" name="attr_possession" />
    </label>
    <label
      ><span>Psionics</span>
      <input type="number" value="0" name="attr_psionics" />
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="number" value="0" name="attr_telepathicprobes" />
    </label>
  </div>
</div>
<hr />

              <!-- endinject -->
            </div>
          </details>
        </fieldset>
        <hr />
        <!-- inject:partials/weapon_proficiencies.html -->
        <h3>Weapon Proficiencies</h3>
<div class="wp-container">
  <details>
    <summary><b>Instructions</b></summary>
    <p>
      Add a row and select a WP from the list. Weapon Proficiencies
      <b>automatically</b> calculate their bonuses based on level.
    </p>
    <p>
      Weapon Proficiencies are automatically added to Profiles &rarr;
      <span class="picker-title">Modifier Picker</span>.
    </p>
    <p>
      W.P. Bayonet comes from Adventure Sourcebook - Mercenary Adventures, page
      45.
    </p>
  </details>
  <p>Click <b>Instructions</b> for detailed instructions.</p>
  <div class="wp">
    <h3>Ancient Weapon Proficiencies</h3>
    <div class="heading">
      <h5>Weapon Proficiency</h5>
      <h5>Strike</h5>
      <h5>Parry</h5>
      <h5>Disarm</h5>
      <h5>Throw</h5>
      <h5>Entangle</h5>
      <h5 title="Rate of Fire">RoF</h5>
      <h5>Level Acquired</h5>
      <h5>Level</h5>
      <h5>Row ID</h5>
    </div>
    <fieldset class="repeating_wp">
      <div class="values">
        <input type="text" list="weapon-proficiencies" name="attr_name" />
        <input type="number" value="0" name="attr_strike" />
        <input type="number" value="0" name="attr_parry" />
        <input type="number" value="0" name="attr_disarm" />
        <input type="number" value="0" name="attr_throw" />
        <input type="number" value="0" name="attr_entangle" />
        <input type="number" value="0" name="attr_rof" title="Rate of Fire" />
        <input type="number" value="1" name="attr_levelacquired" />
        <span class="readonly" name="attr_level"></span>
        <input type="text" value="" name="attr_rowid" readonly />
      </div>
      <input type="hidden" value="1" name="attr_level" />
      <input type="hidden" name="attr_bonus_id" value="" />
    </fieldset>
  </div>
  <hr />
  <div class="wpmodern">
    <h3>Modern Weapon Proficiencies</h3>
    <div class="heading">
      <h5>Weapon Proficiency</h5>
      <h5>Single</h5>
      <h5>Burst</h5>
      <h5>Level Acquired</h5>
      <h5>Level</h5>
      <h5>Row ID</h5>
    </div>
    <fieldset class="repeating_wpmodern">
      <div class="values">
        <input
          type="text"
          list="weapon-proficiencies-modern"
          name="attr_name"
        />
        <input type="number" value="0" name="attr_strike_range_single" />
        <input type="number" value="0" name="attr_strike_range_burst" />
        <input type="number" value="1" name="attr_levelacquired" />
        <span class="readonly" name="attr_level"></span>
        <input type="text" value="" name="attr_rowid" readonly />
      </div>
      <input type="hidden" value="1" name="attr_level" />
      <input type="hidden" name="attr_bonus_id" value="" />
    </fieldset>
  </div>
</div>

        <!-- endinject -->
      </div>
    </div>

    <div class="r-tab-content">
      <div class="powersabilities">
        <h3>Natural Abilities / Powers</h3>
        <div class="repeating-bonuses-outer">
          <div class="heading">
            <h5>Info</h5>
            <h5>Ability</h5>
            <h5>Range</h5>
            <h5>Duration</h5>
            <h5>Frequency</h5>
            <h5>Damage</h5>
            <h5></h5>
            <h5></h5>
            <h5 title="Damage Capacity">D.C.</h5>
            <h5>Skill</h5>
            <h5></h5>
          </div>
          <fieldset class="repeating_powersabilities">
            <details class="info">
              <!-- inject:partials/powersabilities-summary.html -->
              <summary>
  <div class="abilities-list">
    <b class="click-expand"
      ><span class="not-readonly" title="Click for more info"
        >&nbsp;&#9432;</span
      ></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <input type="hidden" value="0" name="attr_frequency" />
    <span name="attr_frequency"></span>
    <span name="attr_damage"></span>
    <input type="hidden" value="0" name="attr_damage" />
    <span name="attr_damage_unit"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:custom} {{title=@{character_name} connects with @{name}}} {{Damage=[[@{damage}]] @{damage_unit}}}"
      name="roll_powerability_damage"
    ></button>
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:skill} [[ [[{@{percentage} + [[ {{ @{opt_iq_bonus},0 }dl1 } * @{active_profile_mod_iq_bonus} ]] +?{Modifier?|0},98}kl1]] + [[1d100]] ]] {{title=@{character_name} uses @{name}}} {{target=$[[1]]}} {{roll=$[[2]]}} {{total=$[[3]]}} {{add_skill=[[@{opt_add_skill}]]}}"
      name="roll_powerability_skill"
    ></button>
  </div>
</summary>

              <!-- endinject -->
              <div class="details-body">
                <!-- inject:partials/powersabilities.html -->
                <br />
<label class="addtobonuses"
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to Profiles
  &rarr; <span class="picker-title">Modifier Picker</span></label
>
<br /><br />
<div class="ability-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting frequency</span
    ><input type="number" value="0" name="attr_frequency_starting"
  /></label>
  <label
    ><span>Frequency per level</span
    ><input type="number" value="0" name="attr_frequency_per_level"
  /></label>
  <label
    ><span>Frequency unit</span
    ><input
      type="text"
      value=""
      name="attr_frequency_unit"
      list="frequency-units"
    />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span title="Starting Damage Capacity">Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span title="Damage Capacity per level">D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span title="Damage Capacity unit">D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label></label>
</div>

                <!-- endinject -->
                <label class="description"
                  ><b>Description</b>
                  <textarea
                    class="full"
                    name="attr_description"
                    value=""
                  ></textarea>
                </label>
                <div class="macro-help">
                  <label
                    ><span><b>Row ID:</b></span>
                    <input type="text" readonly name="attr_rowid" value=""
                  /></label>
                </div>
                <h2>Modifiers</h2>
                <!-- inject:partials/repeating_modifiers.html -->
                <input type="hidden" name="attr_bonus_id" value="" />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span title="Intelligence Quotient">I.Q.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_iq_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span title="Mental Endurance">M.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_me_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span title="Mental Affinity">M.A.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ma_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span title="Physical Strength">P.S.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ps_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span title="Physical Prowess">P.P.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pp_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span title="Physical Endurance">P.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pe_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span title="Physical Beauty">P.B.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pb_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span title="Speed">Spd</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spd_abs" /><span></span
      ></label>
      <input type="number" value="0" name="attr_mod_spd" title="Speed"
    /></label>
    <label
      ><span title="Flying Speed">Spd: Fly</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spdfly_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
    /></label>
  </div>
  <div class="bonus-type-container allow-absolute">
    <label>
      <span title="Hit Points">H.P.</span>
      <span></span>
      <input type="number" value="0" name="attr_hp" title="Hit Points" />
    </label>
    <label>
      <span title="Structural Damage Capacity">S.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_sdc"
        title="Structural Damage Capacity"
      />
    </label>
    <label>
      <span title="Armor Rating">A.R.</span>
      <span></span>
      <input type="number" value="0" name="attr_ar" title="Armor Rating" />
    </label>
    <label>
      <span title="Mega Damage Capacity">M.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_mdc"
        title="Mega Damage Capacity"
      />
    </label>
    <label>
      <span title="Potential Psychic Energy">P.P.E.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_ppe"
        title="Potential Psychic Energy"
      />
    </label>
    <label>
      <span title="Inner Strength Points">I.S.P.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_isp"
        title="Inner Strength Points"
      />
    </label>
    <label>
      <span title="Horror Factor">H.F.</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_hf_abs" /><span></span>
      </label>
      <input type="number" value="0" name="attr_mod_hf" title="Horror Factor" />
    </label>
    <label>
      <span>Spell Strength</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_spellstrength_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_spellstrength" />
    </label>
    <label>
      <span>Trust</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_trust_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_trust" />
    </label>
    <label>
      <span>Intimidate</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_intimidate_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_intimidate" />
    </label>
    <label>
      <span>Charm/Impress</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_charmimpress_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_charmimpress" />
    </label>
    <label>
      <span>Skill Bonus %</span>
      <span></span>
      <input type="number" value="0" name="attr_mod_skillbonus" />
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label title="Crazy 2x, Juicer 4x, etc."
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label title="Crazy, Juicer 10x, etc."
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike" />
    </label>
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm" />
    </label>
    <label
      ><span>Entangle</span>
      <input type="number" value="0" name="attr_entangle" />
    </label>
    <label
      ><span>Throw</span>
      <input type="number" value="0" name="attr_throw" />
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="number" value="0" name="attr_pull" />
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="number" value="0" name="attr_flipthrow" />
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="number" value="0" name="attr_tackle" />
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="number" value="0" name="attr_leghook" />
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="number" value="0" name="attr_backwardsweepkick" />
    </label>
    <hr />
    <label
      ><span>Critical</span> <input type="number" value="" name="attr_critical"
    /></label>
    <label
      ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
    /></label>
    <label
      ><span>Death Blow</span>
      <input type="number" value="0" name="attr_deathblow"
    /></label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage" />
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="text" value="0" name="attr_damage_paired" />
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="text" value="0" name="attr_damage_mainhand" />
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="text" value="0" name="attr_damage_offhand" />
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike_range" />
    </label>
    <label
      ><span>Strike: Single/Pulse</span>
      <input type="number" value="0" name="attr_strike_range_single" />
    </label>
    <label
      ><span>Strike: Burst</span>
      <input type="number" value="0" name="attr_strike_range_burst" />
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="number" value="0" name="attr_strike_range_aimed" />
    </label>
    <label
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span name="attr_strike_range_aimed_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span name="attr_strike_range_aimed_pulse"></span>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="number" value="0" name="attr_strike_range_called" />
    </label>
    <label
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span name="attr_strike_range_called_single"></span>
    </label>
    <label
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span name="attr_strike_range_called_pulse"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span name="attr_strike_range_aimed_called_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span name="attr_strike_range_aimed_called_pulse"></span>
    </label>
    <hr />
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm_range" />
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage_range" />
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="text" value="0" name="attr_damage_range_single" />
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="text" value="0" name="attr_damage_range_burst" />
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="number" value="0" name="attr_parry" />
    </label>
    <label
      ><span>Dodge</span>
      <input type="number" value="0" name="attr_dodge" />
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="number" value="0" name="attr_dodge_flight" />
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="number" value="0" name="attr_dodge_auto" />
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="number" value="0" name="attr_dodge_teleport" />
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="number" value="0" name="attr_dodge_motion" />
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="number" value="0" name="attr_dodge_underwater" />
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="number" value="0" name="attr_roll" />
    </label>
    <label
      ><span>Break Fall</span>
      <input type="number" value="0" name="attr_breakfall" />
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="number" value="0" name="attr_comadeath" />
    </label>
    <label
      ><span>Curses</span>
      <input type="number" value="0" name="attr_curses" />
    </label>
    <label
      ><span>Despair</span>
      <input type="number" value="0" name="attr_despair" />
    </label>
    <label
      ><span>Disease</span>
      <input type="number" value="0" name="attr_disease" />
    </label>
    <label
      ><span>Drugs</span>
      <input type="number" value="0" name="attr_drugs" />
    </label>
    <label
      ><span>Fatigue</span>
      <input type="number" value="0" name="attr_fatigue" />
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="number" value="0" name="attr_horrorfactor" />
    </label>
    <label
      ><span>Illusions</span>
      <input type="number" value="0" name="attr_illusions" />
    </label>
    <label
      ><span>Insanity</span>
      <input type="number" value="0" name="attr_insanity" />
    </label>
    <label
      ><span>Magic</span>
      <input type="number" value="0" name="attr_magic" />
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="number" value="0" name="attr_maintainbalance" />
    </label>
    <label
      ><span>Mind Control</span>
      <input type="number" value="0" name="attr_mindcontrol" />
    </label>
    <label
      ><span>Pain</span>
      <input type="number" value="0" name="attr_pain" />
    </label>
    <label
      ><span>Perception</span>
      <input type="number" value="0" name="attr_perceptioncheck" />
    </label>
    <label
      ><span>Poison: Lethal</span>
      <input type="number" value="0" name="attr_lethalpoison" />
    </label>
    <label
      ><span>Poison: Non-Lethal</span>
      <input type="number" value="0" name="attr_nonlethalpoison" />
    </label>
    <label
      ><span>Possession</span>
      <input type="number" value="0" name="attr_possession" />
    </label>
    <label
      ><span>Psionics</span>
      <input type="number" value="0" name="attr_psionics" />
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="number" value="0" name="attr_telepathicprobes" />
    </label>
  </div>
</div>
<hr />

                <!-- endinject -->
              </div>
              <!-- .details-body -->
            </details>
          </fieldset>
        </div>
      </div>
    </div>

    <div class="r-tab-content">
      <div class="magic">
        <h3>Magic</h3>
        <label
          ><span>Current P.P.E.</span>
          <input type="number" name="attr_currentppe" value="0" />
          <button type="action" name="act_resetppe">
            Reset P.P.E. from Active Profile
          </button>
        </label>
        <label>
          <span>Spell Strength</span>
          <input type="number" name="attr_spellstrength" value="0" />
        </label>
        <div class="heading">
          <h5>Info</h5>
          <h5>Spell</h5>
          <h5>Spell Level</h5>
          <h5>Range</h5>
          <h5>Duration</h5>
          <h5>Damage</h5>
          <h5></h5>
          <h5></h5>
          <h5 title="Damage Capacity">D.C.</h5>
          <h5>Skill</h5>
          <h5></h5>
          <h5 title="Potential Psychic Energy">P.P.E.</h5>
          <h5></h5>
        </div>
        <fieldset class="repeating_magic">
          <details class="info">
            <!-- inject:partials/magic-summary.html -->
            <summary>
  <div class="spells-list">
    <b class="click-expand"
      ><span class="not-readonly" title="Click for more info"
        >&nbsp;&#9432;</span
      ></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="number" value="1" name="attr_spell_level" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <span name="attr_damage"></span>
    <input type="hidden" value="0" name="attr_damage" />
    <span name="attr_damage_unit"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:custom} {{title=@{character_name} connects with @{name}}} {{Damage=[[@{damage}]] @{damage_unit}}}"
      name="roll_spell_damage"
    ></button>
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:skill} [[ [[{@{percentage} + [[ {{ @{opt_iq_bonus},0 }dl1 } * @{active_profile_mod_iq_bonus} ]] +?{Modifier?|0},98}kl1]] + [[1d100]] ]] {{title=@{character_name} uses @{name}}} {{target=$[[1]]}} {{roll=$[[2]]}} {{total=$[[3]]}} {{add_skill=[[@{opt_add_skill}]]}}"
      name="roll_spell_skill"
    ></button>
    <input type="number" value="0" name="attr_ppecost" />
    <button type="action" name="act_usespell">Cast</button>
  </div>
</summary>

            <!-- endinject -->
            <div class="details-body">
              <!-- inject:partials/magic.html -->
              <br />
<label class="addtobonuses"
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to Profiles
  &rarr; <span class="picker-title">Modifier Picker</span></label
>
<br />
<br />
<div class="spell-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span title="Starting Damage Capacity">Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span title="Damage Capacity per level">D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span title="Damage Capacity unit">D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label
    ><span>School</span
    ><input type="text" value="" name="attr_school" list="spell-schools" />
  </label>
</div>

              <!-- endinject -->
              <label class="description"
                ><b>Description</b>
                <textarea
                  class="full"
                  name="attr_description"
                  value=""
                ></textarea>
              </label>
              <div class="macro-help">
                <label
                  ><span><b>Row ID:</b></span>
                  <input type="text" readonly name="attr_rowid" value=""
                /></label>
              </div>
              <h2>Modifiers</h2>
              <!-- inject:partials/repeating_modifiers.html -->
              <input type="hidden" name="attr_bonus_id" value="" />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span title="Intelligence Quotient">I.Q.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_iq_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span title="Mental Endurance">M.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_me_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span title="Mental Affinity">M.A.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ma_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span title="Physical Strength">P.S.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ps_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span title="Physical Prowess">P.P.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pp_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span title="Physical Endurance">P.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pe_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span title="Physical Beauty">P.B.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pb_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span title="Speed">Spd</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spd_abs" /><span></span
      ></label>
      <input type="number" value="0" name="attr_mod_spd" title="Speed"
    /></label>
    <label
      ><span title="Flying Speed">Spd: Fly</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spdfly_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
    /></label>
  </div>
  <div class="bonus-type-container allow-absolute">
    <label>
      <span title="Hit Points">H.P.</span>
      <span></span>
      <input type="number" value="0" name="attr_hp" title="Hit Points" />
    </label>
    <label>
      <span title="Structural Damage Capacity">S.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_sdc"
        title="Structural Damage Capacity"
      />
    </label>
    <label>
      <span title="Armor Rating">A.R.</span>
      <span></span>
      <input type="number" value="0" name="attr_ar" title="Armor Rating" />
    </label>
    <label>
      <span title="Mega Damage Capacity">M.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_mdc"
        title="Mega Damage Capacity"
      />
    </label>
    <label>
      <span title="Potential Psychic Energy">P.P.E.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_ppe"
        title="Potential Psychic Energy"
      />
    </label>
    <label>
      <span title="Inner Strength Points">I.S.P.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_isp"
        title="Inner Strength Points"
      />
    </label>
    <label>
      <span title="Horror Factor">H.F.</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_hf_abs" /><span></span>
      </label>
      <input type="number" value="0" name="attr_mod_hf" title="Horror Factor" />
    </label>
    <label>
      <span>Spell Strength</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_spellstrength_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_spellstrength" />
    </label>
    <label>
      <span>Trust</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_trust_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_trust" />
    </label>
    <label>
      <span>Intimidate</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_intimidate_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_intimidate" />
    </label>
    <label>
      <span>Charm/Impress</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_charmimpress_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_charmimpress" />
    </label>
    <label>
      <span>Skill Bonus %</span>
      <span></span>
      <input type="number" value="0" name="attr_mod_skillbonus" />
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label title="Crazy 2x, Juicer 4x, etc."
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label title="Crazy, Juicer 10x, etc."
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike" />
    </label>
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm" />
    </label>
    <label
      ><span>Entangle</span>
      <input type="number" value="0" name="attr_entangle" />
    </label>
    <label
      ><span>Throw</span>
      <input type="number" value="0" name="attr_throw" />
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="number" value="0" name="attr_pull" />
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="number" value="0" name="attr_flipthrow" />
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="number" value="0" name="attr_tackle" />
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="number" value="0" name="attr_leghook" />
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="number" value="0" name="attr_backwardsweepkick" />
    </label>
    <hr />
    <label
      ><span>Critical</span> <input type="number" value="" name="attr_critical"
    /></label>
    <label
      ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
    /></label>
    <label
      ><span>Death Blow</span>
      <input type="number" value="0" name="attr_deathblow"
    /></label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage" />
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="text" value="0" name="attr_damage_paired" />
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="text" value="0" name="attr_damage_mainhand" />
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="text" value="0" name="attr_damage_offhand" />
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike_range" />
    </label>
    <label
      ><span>Strike: Single/Pulse</span>
      <input type="number" value="0" name="attr_strike_range_single" />
    </label>
    <label
      ><span>Strike: Burst</span>
      <input type="number" value="0" name="attr_strike_range_burst" />
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="number" value="0" name="attr_strike_range_aimed" />
    </label>
    <label
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span name="attr_strike_range_aimed_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span name="attr_strike_range_aimed_pulse"></span>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="number" value="0" name="attr_strike_range_called" />
    </label>
    <label
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span name="attr_strike_range_called_single"></span>
    </label>
    <label
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span name="attr_strike_range_called_pulse"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span name="attr_strike_range_aimed_called_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span name="attr_strike_range_aimed_called_pulse"></span>
    </label>
    <hr />
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm_range" />
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage_range" />
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="text" value="0" name="attr_damage_range_single" />
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="text" value="0" name="attr_damage_range_burst" />
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="number" value="0" name="attr_parry" />
    </label>
    <label
      ><span>Dodge</span>
      <input type="number" value="0" name="attr_dodge" />
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="number" value="0" name="attr_dodge_flight" />
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="number" value="0" name="attr_dodge_auto" />
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="number" value="0" name="attr_dodge_teleport" />
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="number" value="0" name="attr_dodge_motion" />
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="number" value="0" name="attr_dodge_underwater" />
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="number" value="0" name="attr_roll" />
    </label>
    <label
      ><span>Break Fall</span>
      <input type="number" value="0" name="attr_breakfall" />
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="number" value="0" name="attr_comadeath" />
    </label>
    <label
      ><span>Curses</span>
      <input type="number" value="0" name="attr_curses" />
    </label>
    <label
      ><span>Despair</span>
      <input type="number" value="0" name="attr_despair" />
    </label>
    <label
      ><span>Disease</span>
      <input type="number" value="0" name="attr_disease" />
    </label>
    <label
      ><span>Drugs</span>
      <input type="number" value="0" name="attr_drugs" />
    </label>
    <label
      ><span>Fatigue</span>
      <input type="number" value="0" name="attr_fatigue" />
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="number" value="0" name="attr_horrorfactor" />
    </label>
    <label
      ><span>Illusions</span>
      <input type="number" value="0" name="attr_illusions" />
    </label>
    <label
      ><span>Insanity</span>
      <input type="number" value="0" name="attr_insanity" />
    </label>
    <label
      ><span>Magic</span>
      <input type="number" value="0" name="attr_magic" />
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="number" value="0" name="attr_maintainbalance" />
    </label>
    <label
      ><span>Mind Control</span>
      <input type="number" value="0" name="attr_mindcontrol" />
    </label>
    <label
      ><span>Pain</span>
      <input type="number" value="0" name="attr_pain" />
    </label>
    <label
      ><span>Perception</span>
      <input type="number" value="0" name="attr_perceptioncheck" />
    </label>
    <label
      ><span>Poison: Lethal</span>
      <input type="number" value="0" name="attr_lethalpoison" />
    </label>
    <label
      ><span>Poison: Non-Lethal</span>
      <input type="number" value="0" name="attr_nonlethalpoison" />
    </label>
    <label
      ><span>Possession</span>
      <input type="number" value="0" name="attr_possession" />
    </label>
    <label
      ><span>Psionics</span>
      <input type="number" value="0" name="attr_psionics" />
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="number" value="0" name="attr_telepathicprobes" />
    </label>
  </div>
</div>
<hr />

              <!-- endinject -->
            </div>
          </details>
        </fieldset>
      </div>
    </div>

    <div class="r-tab-content">
      <div class="psionics">
        <h3>Psionics</h3>
        <label
          ><span>Current I.S.P.</span>
          <input type="number" name="attr_currentisp" value="0" />
          <button type="action" name="act_resetisp">
            Reset I.S.P. from Active Profile
          </button>
        </label>
        <label>
          <span>Psionic Ability</span>
          <select name="attr_psionic_ability" value="15">
            <option value="15">None</option>
            <option value="12">Minor</option>
            <option value="12">Major</option>
            <option value="10">Master</option>
          </select>
        </label>
        <div class="heading">
          <h5>Info</h5>
          <h5>Psionic</h5>
          <h5>Range</h5>
          <h5>Duration</h5>
          <h5>Damage</h5>
          <h5></h5>
          <h5></h5>
          <h5 title="Damage Capacity">D.C.</h5>
          <h5>Skill</h5>
          <h5></h5>
          <h5 title="Inner Strength Points">I.S.P.</h5>
          <h5></h5>
        </div>
        <fieldset class="repeating_psionics">
          <details class="info">
            <!-- inject:partials/psionics-summary.html -->
            <summary>
  <div class="psionics-list">
    <b class="click-expand"
      ><span class="not-readonly" title="Click for more info"
        >&nbsp;&#9432;</span
      ></b
    >
    <input type="text" value="" name="attr_name" />
    <input type="hidden" value="0" name="attr_range" />
    <span name="attr_range"></span>
    <input type="hidden" value="0" name="attr_duration" />
    <span name="attr_duration"></span>
    <span name="attr_damage"></span>
    <input type="hidden" value="0" name="attr_damage" />
    <span name="attr_damage_unit"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:custom} {{title=@{character_name} connects with @{name}}} {{Damage=[[@{damage}]] @{damage_unit}}}"
      name="roll_psionic_damage"
    ></button>
    <input type="hidden" value="0" name="attr_dc" />
    <span name="attr_dc"></span>
    <input type="hidden" value="0" name="attr_percentage" />
    <span name="attr_percentage"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:skill} [[ [[{@{percentage} + [[ {{ @{opt_iq_bonus},0 }dl1 } * @{active_profile_mod_iq_bonus} ]] +?{Modifier?|0},98}kl1]] + [[1d100]] ]] {{title=@{character_name} uses @{name}}} {{target=$[[1]]}} {{roll=$[[2]]}} {{total=$[[3]]}} {{add_skill=[[@{opt_add_skill}]]}}"
      name="roll_psionic_skill"
    ></button>
    <input type="number" value="0" name="attr_ispcost" />
    <button type="action" name="act_usepsionic">
      <span></span><span></span><span></span><span></span>
      Use
    </button>
  </div>
</summary>

            <!-- endinject -->
            <div class="details-body">
              <!-- inject:partials/psionics.html -->
              <br />
<label class="addtobonuses"
  ><input type="checkbox" name="attr_addtobonuses" value="1" /> Add to Profiles
  &rarr; <span class="picker-title">Modifier Picker</span></label
>
<br />
<br />
<div class="psionic-details">
  <label
    ><span>Starting range</span
    ><input type="number" value="0" name="attr_range_starting"
  /></label>
  <label
    ><span>Range per level</span
    ><input type="number" value="0" name="attr_range_per_level"
  /></label>
  <label
    ><span>Range unit</span
    ><input type="text" value="" name="attr_range_unit" list="distance-units" />
  </label>
  <label
    ><span>Starting duration</span
    ><input type="number" value="0" name="attr_duration_starting"
  /></label>
  <label
    ><span>Duration per level</span
    ><input type="number" value="0" name="attr_duration_per_level"
  /></label>
  <label
    ><span>Duration unit</span
    ><input type="text" value="" name="attr_duration_unit" list="time-units" />
  </label>
  <label
    ><span>Starting damage</span
    ><input type="text" value="0" name="attr_damage_starting"
  /></label>
  <label
    ><span>Damage per level</span
    ><input type="text" value="0" name="attr_damage_per_level"
  /></label>
  <label
    ><span>Damage unit</span
    ><input type="text" value="" name="attr_damage_unit" list="damage-units" />
  </label>
  <label
    ><span title="Starting Damage Capacity">Starting D.C.</span
    ><input type="number" value="0" name="attr_dc_starting"
  /></label>
  <label
    ><span title="Damage Capacity per level">D.C. per level</span
    ><input type="number" value="0" name="attr_dc_per_level"
  /></label>
  <label
    ><span title="Damage Capacity unit">D.C. unit</span
    ><input type="text" value="" name="attr_dc_unit" list="damage-units" />
  </label>
  <label
    ><span>Starting skill %</span
    ><input type="number" value="0" name="attr_percentage_starting"
  /></label>
  <label
    ><span>Skill % per level</span
    ><input type="number" value="0" name="attr_percentage_per_level"
  /></label>
  <label></label>
</div>

              <!-- endinject -->
              <label class="description"
                ><b>Description</b>
                <textarea
                  class="full"
                  name="attr_description"
                  value=""
                ></textarea>
              </label>
              <div class="macro-help">
                <label
                  ><span><b>Row ID:</b></span>
                  <input type="text" readonly name="attr_rowid" value=""
                /></label>
              </div>
              <h2>Modifiers</h2>
              <!-- inject:partials/repeating_modifiers.html -->
              <input type="hidden" name="attr_bonus_id" value="" />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span title="Intelligence Quotient">I.Q.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_iq_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span title="Mental Endurance">M.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_me_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span title="Mental Affinity">M.A.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ma_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span title="Physical Strength">P.S.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ps_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span title="Physical Prowess">P.P.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pp_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span title="Physical Endurance">P.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pe_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span title="Physical Beauty">P.B.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pb_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span title="Speed">Spd</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spd_abs" /><span></span
      ></label>
      <input type="number" value="0" name="attr_mod_spd" title="Speed"
    /></label>
    <label
      ><span title="Flying Speed">Spd: Fly</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spdfly_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
    /></label>
  </div>
  <div class="bonus-type-container allow-absolute">
    <label>
      <span title="Hit Points">H.P.</span>
      <span></span>
      <input type="number" value="0" name="attr_hp" title="Hit Points" />
    </label>
    <label>
      <span title="Structural Damage Capacity">S.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_sdc"
        title="Structural Damage Capacity"
      />
    </label>
    <label>
      <span title="Armor Rating">A.R.</span>
      <span></span>
      <input type="number" value="0" name="attr_ar" title="Armor Rating" />
    </label>
    <label>
      <span title="Mega Damage Capacity">M.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_mdc"
        title="Mega Damage Capacity"
      />
    </label>
    <label>
      <span title="Potential Psychic Energy">P.P.E.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_ppe"
        title="Potential Psychic Energy"
      />
    </label>
    <label>
      <span title="Inner Strength Points">I.S.P.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_isp"
        title="Inner Strength Points"
      />
    </label>
    <label>
      <span title="Horror Factor">H.F.</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_hf_abs" /><span></span>
      </label>
      <input type="number" value="0" name="attr_mod_hf" title="Horror Factor" />
    </label>
    <label>
      <span>Spell Strength</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_spellstrength_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_spellstrength" />
    </label>
    <label>
      <span>Trust</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_trust_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_trust" />
    </label>
    <label>
      <span>Intimidate</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_intimidate_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_intimidate" />
    </label>
    <label>
      <span>Charm/Impress</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_charmimpress_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_charmimpress" />
    </label>
    <label>
      <span>Skill Bonus %</span>
      <span></span>
      <input type="number" value="0" name="attr_mod_skillbonus" />
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label title="Crazy 2x, Juicer 4x, etc."
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label title="Crazy, Juicer 10x, etc."
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike" />
    </label>
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm" />
    </label>
    <label
      ><span>Entangle</span>
      <input type="number" value="0" name="attr_entangle" />
    </label>
    <label
      ><span>Throw</span>
      <input type="number" value="0" name="attr_throw" />
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="number" value="0" name="attr_pull" />
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="number" value="0" name="attr_flipthrow" />
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="number" value="0" name="attr_tackle" />
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="number" value="0" name="attr_leghook" />
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="number" value="0" name="attr_backwardsweepkick" />
    </label>
    <hr />
    <label
      ><span>Critical</span> <input type="number" value="" name="attr_critical"
    /></label>
    <label
      ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
    /></label>
    <label
      ><span>Death Blow</span>
      <input type="number" value="0" name="attr_deathblow"
    /></label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage" />
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="text" value="0" name="attr_damage_paired" />
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="text" value="0" name="attr_damage_mainhand" />
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="text" value="0" name="attr_damage_offhand" />
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike_range" />
    </label>
    <label
      ><span>Strike: Single/Pulse</span>
      <input type="number" value="0" name="attr_strike_range_single" />
    </label>
    <label
      ><span>Strike: Burst</span>
      <input type="number" value="0" name="attr_strike_range_burst" />
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="number" value="0" name="attr_strike_range_aimed" />
    </label>
    <label
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span name="attr_strike_range_aimed_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span name="attr_strike_range_aimed_pulse"></span>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="number" value="0" name="attr_strike_range_called" />
    </label>
    <label
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span name="attr_strike_range_called_single"></span>
    </label>
    <label
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span name="attr_strike_range_called_pulse"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span name="attr_strike_range_aimed_called_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span name="attr_strike_range_aimed_called_pulse"></span>
    </label>
    <hr />
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm_range" />
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage_range" />
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="text" value="0" name="attr_damage_range_single" />
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="text" value="0" name="attr_damage_range_burst" />
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="number" value="0" name="attr_parry" />
    </label>
    <label
      ><span>Dodge</span>
      <input type="number" value="0" name="attr_dodge" />
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="number" value="0" name="attr_dodge_flight" />
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="number" value="0" name="attr_dodge_auto" />
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="number" value="0" name="attr_dodge_teleport" />
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="number" value="0" name="attr_dodge_motion" />
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="number" value="0" name="attr_dodge_underwater" />
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="number" value="0" name="attr_roll" />
    </label>
    <label
      ><span>Break Fall</span>
      <input type="number" value="0" name="attr_breakfall" />
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="number" value="0" name="attr_comadeath" />
    </label>
    <label
      ><span>Curses</span>
      <input type="number" value="0" name="attr_curses" />
    </label>
    <label
      ><span>Despair</span>
      <input type="number" value="0" name="attr_despair" />
    </label>
    <label
      ><span>Disease</span>
      <input type="number" value="0" name="attr_disease" />
    </label>
    <label
      ><span>Drugs</span>
      <input type="number" value="0" name="attr_drugs" />
    </label>
    <label
      ><span>Fatigue</span>
      <input type="number" value="0" name="attr_fatigue" />
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="number" value="0" name="attr_horrorfactor" />
    </label>
    <label
      ><span>Illusions</span>
      <input type="number" value="0" name="attr_illusions" />
    </label>
    <label
      ><span>Insanity</span>
      <input type="number" value="0" name="attr_insanity" />
    </label>
    <label
      ><span>Magic</span>
      <input type="number" value="0" name="attr_magic" />
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="number" value="0" name="attr_maintainbalance" />
    </label>
    <label
      ><span>Mind Control</span>
      <input type="number" value="0" name="attr_mindcontrol" />
    </label>
    <label
      ><span>Pain</span>
      <input type="number" value="0" name="attr_pain" />
    </label>
    <label
      ><span>Perception</span>
      <input type="number" value="0" name="attr_perceptioncheck" />
    </label>
    <label
      ><span>Poison: Lethal</span>
      <input type="number" value="0" name="attr_lethalpoison" />
    </label>
    <label
      ><span>Poison: Non-Lethal</span>
      <input type="number" value="0" name="attr_nonlethalpoison" />
    </label>
    <label
      ><span>Possession</span>
      <input type="number" value="0" name="attr_possession" />
    </label>
    <label
      ><span>Psionics</span>
      <input type="number" value="0" name="attr_psionics" />
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="number" value="0" name="attr_telepathicprobes" />
    </label>
  </div>
</div>
<hr />

              <!-- endinject -->
            </div>
          </details>
        </fieldset>
      </div>
    </div>

    <div class="r-tab-content">
      <div class="modifiers">
        <div class="bonuses-container">
          <h3>Modifiers, Weapons, Armor, Gear</h3>
          <div class="repeating-bonuses-outer">
            <fieldset class="repeating_modifiers">
              <details class="info">
                <summary>
                  <div class="bonus-thing-heading">
                    <b class="click-expand"
                      ><span title="Click for more info">&nbsp;&#9432;</span></b
                    >
                    <label
                      ><span>Name</span>
                      <input type="text" name="attr_name" />
                    </label>
                    <label
                      ><span>Level</span>
                      <input type="number" value="1" name="attr_level" />
                    </label>
                  </div>
                </summary>
                <div class="details-body">
                  <label class="description"
                    ><b>Description</b>
                    <textarea
                      class="full"
                      name="attr_description"
                      value=""
                    ></textarea>
                  </label>
                  <div class="macro-help">
                    <label
                      ><span><b>Row ID:</b></span>
                      <input type="text" readonly name="attr_rowid" value=""
                    /></label>
                  </div>
                  <!-- inject:partials/repeating_modifiers.html -->
                  <input type="hidden" name="attr_bonus_id" value="" />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span title="Intelligence Quotient">I.Q.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_iq_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span title="Mental Endurance">M.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_me_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span title="Mental Affinity">M.A.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ma_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span title="Physical Strength">P.S.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_ps_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span title="Physical Prowess">P.P.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pp_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span title="Physical Endurance">P.E.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pe_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span title="Physical Beauty">P.B.</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_pb_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span title="Speed">Spd</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spd_abs" /><span></span
      ></label>
      <input type="number" value="0" name="attr_mod_spd" title="Speed"
    /></label>
    <label
      ><span title="Flying Speed">Spd: Fly</span>
      <label class="abs" title="Relative or absolute value"
        ><input type="checkbox" value="1" name="attr_spdfly_abs" /><span></span
      ></label>
      <input
        type="number"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
    /></label>
  </div>
  <div class="bonus-type-container allow-absolute">
    <label>
      <span title="Hit Points">H.P.</span>
      <span></span>
      <input type="number" value="0" name="attr_hp" title="Hit Points" />
    </label>
    <label>
      <span title="Structural Damage Capacity">S.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_sdc"
        title="Structural Damage Capacity"
      />
    </label>
    <label>
      <span title="Armor Rating">A.R.</span>
      <span></span>
      <input type="number" value="0" name="attr_ar" title="Armor Rating" />
    </label>
    <label>
      <span title="Mega Damage Capacity">M.D.C.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_mdc"
        title="Mega Damage Capacity"
      />
    </label>
    <label>
      <span title="Potential Psychic Energy">P.P.E.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_ppe"
        title="Potential Psychic Energy"
      />
    </label>
    <label>
      <span title="Inner Strength Points">I.S.P.</span>
      <span></span>
      <input
        type="number"
        value="0"
        name="attr_isp"
        title="Inner Strength Points"
      />
    </label>
    <label>
      <span title="Horror Factor">H.F.</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_hf_abs" /><span></span>
      </label>
      <input type="number" value="0" name="attr_mod_hf" title="Horror Factor" />
    </label>
    <label>
      <span>Spell Strength</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_spellstrength_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_spellstrength" />
    </label>
    <label>
      <span>Trust</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_trust_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_trust" />
    </label>
    <label>
      <span>Intimidate</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_intimidate_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_intimidate" />
    </label>
    <label>
      <span>Charm/Impress</span>
      <label class="abs" title="Relative or absolute value">
        <input type="checkbox" value="1" name="attr_charmimpress_abs" />
        <span></span>
      </label>
      <input type="number" value="0" name="attr_mod_charmimpress" />
    </label>
    <label>
      <span>Skill Bonus %</span>
      <span></span>
      <input type="number" value="0" name="attr_mod_skillbonus" />
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <select class="" name="attr_mod_character_ps_type" value="normal">
        <option value="1">Normal</option>
        <option value="2">Augmented</option>
        <option value="3">Robotic</option>
        <option value="3.5">Giant Robotic</option>
        <option value="4">Supernatural</option>
      </select></label
    >
    <label
      ><span>Restrained Punch</span>
      <input type="text" name="attr_mod_restrained_punch" value="0" />
      <select name="attr_mod_restrained_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Punch</span>
      <input type="text" name="attr_mod_punch" value="0" />
      <select name="attr_mod_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Power Punch</span>
      <input type="text" name="attr_mod_power_punch" value="0" />
      <select name="attr_mod_power_punch_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Kick</span>
      <input type="text" name="attr_mod_kick" value="0" />
      <select name="attr_mod_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select></label
    >

    <label
      ><span>Leap Kick</span>
      <input type="text" name="attr_mod_leap_kick" value="0" />
      <select name="attr_mod_leap_kick_unit" value="sdc">
        <option value="sdc">SDC</option>
        <option value="mdc">MDC</option>
      </select>
    </label>

    <label title="Crazy 2x, Juicer 4x, etc."
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label title="Crazy, Juicer 10x, etc."
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="number"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
      />
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="number" value="0" name="attr_mod_lift" />
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="number" value="0" name="attr_mod_carry" />
      <span>lbs</span></label
    >

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="number" value="0" name="attr_mod_throw_distance" />
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="number" value="0" name="attr_mod_carry_max" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Carry (Running)</span>
      <input type="number" value="0" name="attr_mod_carry_running" /><span
        >Minutes</span
      ></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="number" value="0" name="attr_mod_hold_max" /><span
        >Melees</span
      ></label
    >
  </div>
</div>
<hr />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="number" value="0" name="attr_attacks" />
  </label>
  <label
    ><span>Initiative</span>
    <input type="number" value="0" name="attr_initiative" />
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike" />
    </label>
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm" />
    </label>
    <label
      ><span>Entangle</span>
      <input type="number" value="0" name="attr_entangle" />
    </label>
    <label
      ><span>Throw</span>
      <input type="number" value="0" name="attr_throw" />
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="number" value="0" name="attr_pull" />
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="number" value="0" name="attr_flipthrow" />
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="number" value="0" name="attr_tackle" />
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="number" value="0" name="attr_leghook" />
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="number" value="0" name="attr_backwardsweepkick" />
    </label>
    <hr />
    <label
      ><span>Critical</span> <input type="number" value="" name="attr_critical"
    /></label>
    <label
      ><span>Knockout</span> <input type="number" value="" name="attr_knockout"
    /></label>
    <label
      ><span>Death Blow</span>
      <input type="number" value="0" name="attr_deathblow"
    /></label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage" />
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="text" value="0" name="attr_damage_paired" />
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="text" value="0" name="attr_damage_mainhand" />
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="text" value="0" name="attr_damage_offhand" />
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="number" value="0" name="attr_strike_range" />
    </label>
    <label
      ><span>Strike: Single/Pulse</span>
      <input type="number" value="0" name="attr_strike_range_single" />
    </label>
    <label
      ><span>Strike: Burst</span>
      <input type="number" value="0" name="attr_strike_range_burst" />
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="number" value="0" name="attr_strike_range_aimed" />
    </label>
    <label
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span name="attr_strike_range_aimed_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span name="attr_strike_range_aimed_pulse"></span>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="number" value="0" name="attr_strike_range_called" />
    </label>
    <label
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span name="attr_strike_range_called_single"></span>
    </label>
    <label
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span name="attr_strike_range_called_pulse"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span name="attr_strike_range_aimed_called_single"></span>
    </label>
    <label
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span name="attr_strike_range_aimed_called_pulse"></span>
    </label>
    <hr />
    <label
      ><span>Disarm</span>
      <input type="number" value="0" name="attr_disarm_range" />
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="text" value="0" name="attr_damage_range" />
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="text" value="0" name="attr_damage_range_single" />
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="text" value="0" name="attr_damage_range_burst" />
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="number" value="0" name="attr_parry" />
    </label>
    <label
      ><span>Dodge</span>
      <input type="number" value="0" name="attr_dodge" />
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="number" value="0" name="attr_dodge_flight" />
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="number" value="0" name="attr_dodge_auto" />
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="number" value="0" name="attr_dodge_teleport" />
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="number" value="0" name="attr_dodge_motion" />
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="number" value="0" name="attr_dodge_underwater" />
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="number" value="0" name="attr_roll" />
    </label>
    <label
      ><span>Break Fall</span>
      <input type="number" value="0" name="attr_breakfall" />
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="number" value="0" name="attr_comadeath" />
    </label>
    <label
      ><span>Curses</span>
      <input type="number" value="0" name="attr_curses" />
    </label>
    <label
      ><span>Despair</span>
      <input type="number" value="0" name="attr_despair" />
    </label>
    <label
      ><span>Disease</span>
      <input type="number" value="0" name="attr_disease" />
    </label>
    <label
      ><span>Drugs</span>
      <input type="number" value="0" name="attr_drugs" />
    </label>
    <label
      ><span>Fatigue</span>
      <input type="number" value="0" name="attr_fatigue" />
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="number" value="0" name="attr_horrorfactor" />
    </label>
    <label
      ><span>Illusions</span>
      <input type="number" value="0" name="attr_illusions" />
    </label>
    <label
      ><span>Insanity</span>
      <input type="number" value="0" name="attr_insanity" />
    </label>
    <label
      ><span>Magic</span>
      <input type="number" value="0" name="attr_magic" />
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="number" value="0" name="attr_maintainbalance" />
    </label>
    <label
      ><span>Mind Control</span>
      <input type="number" value="0" name="attr_mindcontrol" />
    </label>
    <label
      ><span>Pain</span>
      <input type="number" value="0" name="attr_pain" />
    </label>
    <label
      ><span>Perception</span>
      <input type="number" value="0" name="attr_perceptioncheck" />
    </label>
    <label
      ><span>Poison: Lethal</span>
      <input type="number" value="0" name="attr_lethalpoison" />
    </label>
    <label
      ><span>Poison: Non-Lethal</span>
      <input type="number" value="0" name="attr_nonlethalpoison" />
    </label>
    <label
      ><span>Possession</span>
      <input type="number" value="0" name="attr_possession" />
    </label>
    <label
      ><span>Psionics</span>
      <input type="number" value="0" name="attr_psionics" />
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="number" value="0" name="attr_telepathicprobes" />
    </label>
  </div>
</div>
<hr />

                  <!-- endinject -->
                </div>
              </details>
            </fieldset>
          </div>
        </div>
      </div>
    </div>

    <div class="r-tab-content">
      <div class="bonuses">
        <div class="bonuses-container">
          <div class="combat-combined">
            <details class="info active-container">
              <summary>
                <h2>
                  <span class="not-readonly" title="Click for more info"
                    >&nbsp;&#9432;</span
                  >
                  Active
                </h2>
              </summary>
              <!-- inject:partials/active.html -->
              <input type="hidden" placeholder="%" name="attr_active_armor_movementpenalty" />
<input
  type="hidden"
  placeholder="Base MDC"
  name="attr_active_armor_mdc_max"
  value="0"
/>
<input
  type="hidden"
  class="danger"
  placeholder="Current MDC"
  name="attr_active_armor_mdc"
  value="0"
/>
<h3>Armor: <span class="picker-title" name="attr_active_armor_name"></span></h3>
<div class="armor-inner">
  <div class="armor-row">
    <label>Movement Modifier %</label>
    <label>Base MDC</label>
    <label>Current MDC</label>
    <label>Damage</label>
  </div>
  <div class="armor-row">
    <span class="readonly" name="attr_active_armor_movementpenalty"></span>
    <span class="readonly" name="attr_active_armor_mdc_max"></span>
    <span class="readonly danger" name="attr_active_armor_mdc"></span>
    <input type="number" placeholder="Damage" name="attr_armordamage" />
    <button type="action" name="act_armorapplydamage">Apply Damage</button>
  </div>
</div>
<br />
<h3>
  Profile: <span class="picker-title" name="attr_active_profile_name"></span>
</h3>
<div class="profile-builder">
  <div class="profiles">
    <div class="profile">
      <h3>Combat</h3>
      <div class="bonus-type-container">
        <label
          ><span>Attacks</span>
          <input type="hidden" value="0" name="attr_active_profile_attacks" />
          <span name="attr_active_profile_attacks"></span>
        </label>
        <label class="roller initiative"
          ><span>Initiative</span>
          <input
            type="hidden"
            value="0"
            name="attr_active_profile_initiative"
          />
          <span>+</span>
          <span name="attr_active_profile_initiative"></span>
          <button
            type="roll"
            value="@{opt_whisper}&{template:custom} {{title=@{character_name} rolls Initiative}} {{Initiative=[[d20+@{active_profile_initiative} &{tracker}]]}}"
            name="roll_active_profile_bonus_initiative"
          ></button>
          <button
            title="Roll initiative and add it to the Turn Tracker - Palladium Style!&#010;Requires `dup-turn` API script."
            type="action"
            name="act_active_profile_initiative_turntracker"
            class="action-roll"
          >
            TT
          </button>
        </label>
      </div>
      <div class="modifiers-combat">
        <div class="combat-offense-melee bonus-type-container">
          <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
          <label
            ><span>Strike</span>
            <input type="hidden" value="0" name="attr_active_profile_strike" />
            <span>+</span>
            <span name="attr_active_profile_strike"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} strikes!}} {{Strike=[[d20cs>@{active_profile_critical}+@{active_profile_strike}]]}}"
              name="roll_bonus_active_profile_strike"
            ></button>
          </label>
          <label
            ><span>Disarm</span>
            <input type="hidden" value="0" name="attr_active_profile_disarm" />
            <span>+</span>
            <span name="attr_active_profile_disarm"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm!}} {{Disarm=[[d20+@{active_profile_disarm}]]}}"
              name="roll_active_profile_bonus_disarm"
            ></button>
          </label>
          <label
            ><span>Entangle</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_entangle"
            />
            <span>+</span>
            <span name="attr_active_profile_entangle"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to entangle!}} {{Entangle=[[d20+@{active_profile_entangle}]]}}"
              name="roll_active_profile_bonus_entangle"
            ></button>
          </label>
          <label
            ><span>Throw</span>
            <input type="hidden" value="0" name="attr_active_profile_throw" />
            <span>+</span>
            <span name="attr_active_profile_throw"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} throws something!}} {{Throw=[[d20+@{active_profile_throw}]]}}"
              name="roll_active_profile_bonus_throw"
            ></button>
          </label>
          <label
            ><span>Pull Punch vs. 11</span>
            <input type="hidden" value="0" name="attr_active_profile_pull" />
            <span>+</span>
            <span name="attr_active_profile_pull"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to pull their punch!}} {{target=[[11]]}} {{roll=[[d20+@{active_profile_pull}]]}}"
              name="roll_active_profile_bonus_pull"
            ></button>
          </label>
          <label
            ><span>Body Flip/Throw</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_flipthrow"
            />
            <span>+</span>
            <span name="attr_active_profile_flipthrow"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body flip/throw!}} {{Body Flip/Throw=[[d20cs>@{active_profile_critical}+@{active_profile_flipthrow}]]}}"
              name="roll_active_profile_bonus_flipthrow"
            ></button>
          </label>
          <label
            ><span>Body Block/Tackle</span>
            <input type="hidden" value="0" name="attr_active_profile_tackle" />
            <span>+</span>
            <span name="attr_active_profile_tackle"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body block/tackle!}} {{Body Block/Tackle=[[d20cs>@{active_profile_critical}+@{active_profile_tackle}]]}}"
              name="roll_active_profile_bonus_tackle"
            ></button>
          </label>
          <label
            ><span>Tripping/Leg Hook</span>
            <input type="hidden" value="0" name="attr_active_profile_leghook" />
            <span>+</span>
            <span name="attr_active_profile_leghook"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a trip/leg hook!}} {{Tripping/Leg Hook=[[d20cs>@{active_profile_critical}+@{active_profile_leghook}]]}}"
              name="roll_active_profile_bonus_leghook"
            ></button>
          </label>
          <label
            ><span>Backward Sweep Kick</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_backwardsweepkick"
            />
            <span>+</span>
            <span name="attr_active_profile_backwardsweepkick"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a backward sweep kick!}} {{Backward Sweep Kick=[[d20cs>@{active_profile_critical}+@{active_profile_backwardsweepkick}]]}}"
              name="roll_active_profile_bonus_backwardsweepkick"
            ></button>
          </label>
          <hr />
          <label
            ><span>Critical</span>
            <input type="hidden" value="" name="attr_active_profile_critical" />
            <span></span>
            <span name="attr_active_profile_critical"></span>
          </label>
          <label
            ><span>Knockout</span>
            <input type="hidden" value="" name="attr_active_profile_knockout" />
            <span></span>
            <span name="attr_active_profile_knockout"></span>
          </label>
          <label
            ><span>Death Blow</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_deathblow"
            />
            <span></span>
            <span name="attr_active_profile_deathblow"></span>
          </label>
          <hr />
          <label
            ><span>Damage</span>
            <input type="hidden" value="0" name="attr_active_profile_damage" />
            <span></span>
            <span name="attr_active_profile_damage"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{active_profile_damage} + ?{Add damage modifier?|
                None,0|
                Punch,@{active_profile_mod_punch}|
                P.S. Bonus,@{active_profile_mod_ps_bonus}
              }]]}}"
              name="roll_active_profile_bonus_damage"
            ></button>
          </label>
          <label
            ><span>Damage: Paired</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_paired"
            />
            <span></span>
            <span name="attr_active_profile_damage_paired"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{active_profile_damage_paired} + ?{Add damage modifier?|
                None,0|
                Punch,@{active_profile_mod_punch}|
                P.S. Bonus,@{active_profile_mod_ps_bonus} } * [[ {{ @{opt_paired_damage},0 }dl1 } * 1 + 1 ]]
              ]]}}"
              name="roll_active_profile_bonus_damage_paired"
            ></button>
          </label>
          <label
            ><span>Damage: Main Hand</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_mainhand"
            />
            <span></span>
            <span name="attr_active_profile_damage_mainhand"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{active_profile_damage_mainhand} + ?{Add damage modifier?|
                None,0|
                Punch,@{active_profile_mod_punch}|
                P.S. Bonus,@{active_profile_mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
              ]]}}"
              name="roll_active_profile_bonus_damage_mainhand"
            ></button>
          </label>
          <label
            ><span>Damage: Off Hand</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_offhand"
            />
            <span></span>
            <span name="attr_active_profile_damage_offhand"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{active_profile_damage_offhand} + ?{Add damage modifier?|
                None,0|
                Punch,@{active_profile_mod_punch}|
                P.S. Bonus,@{active_profile_mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
              ]]}}"
              name="roll_active_profile_bonus_damage_offhand"
            ></button>
          </label>
        </div>
        <div class="combat-offense-range bonus-type-container">
          <h3><span>&#x1F52B;</span> Modern/Range <span>&#x1F4A3;</span></h3>
          <label
            ><span>Strike</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range"></span>
          </label>
          <label title="1 Action"
            ><span>Strike: Single</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_single"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_single"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a single shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_single} ]]}}"
              name="roll_active_profile_bonus_strike_range_single"
            ></button>
          </label>
          <label title="1 Action"
            ><span>Strike: Pulse/Burst</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_burst"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_burst"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a burst shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_burst} ]]}}"
              name="roll_active_profile_bonus_strike_range_burst"
            ></button>
          </label>
          <label
            ><span>Strike: Aimed</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_aimed"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_aimed"></span>
          </label>
          <label title="2 Actions"
            ><span>Strike: Aimed Single</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_aimed_single"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_aimed_single"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed single shot!}} {{Range Aimed Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_aimed_single} ]]}}"
              name="roll_active_profile_bonus_strike_range_aimed_single"
            ></button>
          </label>
          <label title="2 Actions"
            ><span>Strike: Aimed Pulse</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_aimed_pulse"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_aimed_pulse"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed pulse shot!}} {{Range Aimed Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_aimed_pulse} ]]}}"
              name="roll_active_profile_bonus_strike_range_aimed_pulse"
            ></button>
          </label>
          <label
            ><span>Strike: Called</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_called"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_called"></span>
          </label>
          <label title="2 Actions"
            ><span>Strike: Called Single</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_called_single"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_called_single"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called single shot!}} {{Range Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_called_single} ]]}}"
              name="roll_active_profile_bonus_strike_range_called_single"
            ></button>
          </label>
          <label title="2 Actions"
            ><span>Strike: Called Pulse</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_called_pulse"
            />
            <span>+</span>
            <span name="attr_active_profile_strike_range_called_pulse"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called pulse shot!}} {{Range Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_called_pulse} ]]}}"
              name="roll_active_profile_bonus_strike_range_called_pulse"
            ></button>
          </label>
          <label title="3 Actions"
            ><span>Strike: Aimed Called Single</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_aimed_called_single"
            />
            <span>+</span>
            <span
              name="attr_active_profile_strike_range_aimed_called_single"
            ></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called single shot!}} {{Range Aimed Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_aimed_called_single} ]]}}"
              name="roll_active_profile_bonus_strike_range_aimed_called_single"
            ></button>
          </label>
          <label title="3 Actions"
            ><span>Strike: Aimed Called Pulse</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_strike_range_aimed_called_pulse"
            />
            <span>+</span>
            <span
              name="attr_active_profile_strike_range_aimed_called_pulse"
            ></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called pulse shot!}} {{Range Aimed Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{active_profile_critical}-20) + 20]] + @{active_profile_strike_range_aimed_called_pulse} ]]}}"
              name="roll_active_profile_bonus_strike_range_aimed_called_pulse"
            ></button>
          </label>
          <hr />
          <label
            title="Using a gun to shoot a weapon out of an opponent's hand requires a called shot and careful aim (only the gunslinger can shoot to disarm on a quick draw)"
            ><span>Disarm</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_disarm_range"
            />
            <span>+</span>
            <span name="attr_active_profile_disarm_range"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm at range!}} {{Range Disarm=[[d20+@{active_profile_disarm_range} + ?{Type of shot?|
                No additional bonus,0|
                Called Single (2 Actions),@{active_profile_strike_range_called_single}|
                Called Pulse (2 Actions),@{active_profile_strike_range_called_pulse}|
                Aimed Called Single (3 Actions),@{active_profile_strike_range_aimed_called_single}|
                Aimed Called Pulse (3 Actions),@{active_profile_strike_range_aimed_called_pulse}|
                Quick Draw Single (1 Action),@{active_profile_strike_range_single}|
                Quick Draw Pulse (1 Action),@{active_profile_strike_range_burst}
              }]]}}"
              name="roll_active_profile_bonus_disarm_range"
            ></button>
          </label>
          <hr />
          <label
            ><span>Damage</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_range"
            />
            <span></span>
            <span name="attr_active_profile_damage_range"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage!}} {{Range Damage=[[@{active_profile_damage_range}]]}}"
              name="roll_active_profile_bonus_damage_range"
            ></button>
          </label>
          <label
            ><span>Damage: Single</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_range_single"
            />
            <span></span>
            <span name="attr_active_profile_damage_range_single"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a single shot!}} {{Range Damage=[[@{active_profile_damage_range_single}]]}}"
              name="roll_active_profile_bonus_damage_range_single"
            ></button>
          </label>
          <label
            ><span>Damage: Pulse/Burst</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_damage_range_burst"
            />
            <span></span>
            <span name="attr_active_profile_damage_range_burst"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a burst!}} {{Range Damage=[[@{active_profile_damage_range_burst}]]}}"
              name="roll_active_profile_bonus_damage_range_burst"
            ></button>
          </label>
        </div>
        <div class="combat-defense bonus-type-container">
          <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
          <label
            ><span>Parry</span>
            <input type="hidden" value="0" name="attr_active_profile_parry" />
            <span>+</span>
            <span name="attr_active_profile_parry"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to parry!}} {{Parry=[[d20+@{active_profile_parry}]]}}"
              name="roll_active_profile_bonus_parry"
            ></button>
          </label>
          <label
            ><span>Dodge</span>
            <input type="hidden" value="0" name="attr_active_profile_dodge" />
            <span>+</span>
            <span name="attr_active_profile_dodge"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge!}} {{ Dodge=[[ d20+@{active_profile_dodge} - @{opt_dodge_penalty} ]] }}"
              name="roll_active_profile_bonus_dodge"
            ></button>
          </label>
          <label
            ><span>Dodge: Flight</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_dodge_flight"
            />
            <span>+</span>
            <span name="attr_active_profile_dodge_flight"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge in flight!}} {{Dodge in Flight=[[d20+@{active_profile_dodge_flight} - @{opt_dodge_penalty} ]]}}"
              name="roll_active_profile_bonus_dodge_flight"
            ></button>
          </label>
          <label
            ><span>Dodge: Auto</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_dodge_auto"
            />
            <span>+</span>
            <span name="attr_active_profile_dodge_auto"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to auto dodge!}} {{Auto Dodge=[[d20+@{active_profile_dodge_auto} - @{opt_dodge_penalty} ]]}}"
              name="roll_active_profile_bonus_dodge_auto"
            ></button>
          </label>
          <label
            ><span>Dodge: Teleport</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_dodge_teleport"
            />
            <span>+</span>
            <span name="attr_active_profile_dodge_teleport"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to teleport dodge!}} {{Teleport Dodge=[[d20+@{active_profile_dodge_teleport} - @{opt_dodge_penalty} ]]}}"
              name="roll_active_profile_bonus_dodge_teleport"
            ></button>
          </label>
          <label
            ><span>Dodge: Motion</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_dodge_motion"
            />
            <span>+</span>
            <span name="attr_active_profile_dodge_motion"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge while in motion!}} {{Dodge in Motion=[[d20+@{active_profile_dodge_motion} - @{opt_dodge_penalty} ]]}}"
              name="roll_active_profile_bonus_dodge_motion"
            ></button>
          </label>
          <label
            ><span>Dodge: Underwater</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_dodge_underwater"
            />
            <span>+</span>
            <span name="attr_active_profile_dodge_underwater"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge underwater!}} {{Dodge Underwater=[[d20+@{active_profile_dodge_underwater} - @{opt_dodge_penalty} ]]}}"
              name="roll_active_profile_bonus_dodge_underwater"
            ></button>
          </label>
          <label
            ><span>Roll w/ Impact</span>
            <input type="hidden" value="0" name="attr_active_profile_roll" />
            <span>+</span>
            <span name="attr_active_profile_roll"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to roll with impact!}} {{Roll w/ Impact=[[d20+@{active_profile_roll}]]}}"
              name="roll_active_profile_bonus_roll"
            ></button>
          </label>
          <label
            ><span>Break Fall</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_breakfall"
            />
            <span>+</span>
            <span name="attr_active_profile_breakfall"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to break fall!}} {{Break Fall=[[d20+@{active_profile_breakfall}]]}}"
              name="roll_active_profile_bonus_breakfall"
            ></button>
          </label>
        </div>
        <div class="bonus-type-container">
          <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
          <label
            ><span>Coma/Death</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_comadeath"
            />
            <span>+</span>
            <span name="attr_active_profile_comadeath"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries not to die!}} {{target=[[50+@{active_profile_comadeath}]]}} {{roll=[[d100]]}}"
              name="roll_active_profile_bonus_comadeath"
            ></button>
          </label>
          <label
            ><span>Curses vs. 15</span>
            <input type="hidden" value="0" name="attr_active_profile_curses" />
            <span>+</span>
            <span name="attr_active_profile_curses"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against being cursed!}} {{target=[[15]]}} {{roll=[[d20+@{active_profile_curses}+?{Add modifier?|
                None,0|
                Magic,@{active_magic}|
                Psionics,@{active_psionics}
              }]]}}"
              name="roll_active_profile_bonus_curses"
            ></button>
          </label>
          <label
            ><span>Despair</span>
            <input type="hidden" value="0" name="attr_active_profile_despair" />
            <span>+</span>
            <span name="attr_active_profile_despair"></span>
            <button
              type="roll"
              value="?{Type of Despair|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. magic despair!&amp;#125;&amp;#125; {{Save vs. Magic Despair=[[d20+@{active_profile_despair}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to save vs. psionic despair!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_despair}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. despair!&amp;#125;&amp;#125; {{Save vs. Despair=[[d20+@{active_profile_despair}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_despair"
            ></button>
          </label>
          <label
            ><span>Disease</span>
            <input type="hidden" value="0" name="attr_active_profile_disease" />
            <span>+</span>
            <span name="attr_active_profile_disease"></span>
            <button
              type="roll"
              value="?{Type of Disease|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a magic disease!&amp;#125;&amp;#125; {{Save vs. Magic Disease=[[d20+@{active_profile_disease}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to fight off a psionic disease!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_disease}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{Save vs. Disease=[[d20+@{active_profile_disease}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_disease"
            ></button>
          </label>
          <label
            ><span>Drugs vs. 15</span>
            <input type="hidden" value="0" name="attr_active_profile_drugs" />
            <span>+</span>
            <span name="attr_active_profile_drugs"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against harmful drugs!}} {{target=[[15]]}} {{roll=[[d20+@{active_profile_drugs}]]}}"
              name="roll_active_profile_bonus_drugs"
            ></button>
          </label>
          <label
            ><span>Fatigue</span>
            <input type="hidden" value="0" name="attr_active_profile_fatigue" />
            <span>+</span>
            <span name="attr_active_profile_fatigue"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to push through the fatigue!}} {{Fatigue=[[d20+@{active_profile_fatigue}]]}}"
              name="roll_active_profile_bonus_fatigue"
            ></button>
          </label>
          <label
            ><span>Horror Factor</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_horrorfactor"
            />
            <span>+</span>
            <span name="attr_active_profile_horrorfactor"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against horror factor!}} {{Save vs. Horror Factor=[[d20+@{active_profile_horrorfactor}]]}}"
              name="roll_active_profile_bonus_horrorfactor"
            ></button>
          </label>
          <label
            ><span>Illusions</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_illusions"
            />
            <span>+</span>
            <span name="attr_active_profile_illusions"></span>
            <button
              type="roll"
              value="?{Type of Illusion|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the magic illusion!&amp;#125;&amp;#125; {{Save vs. Magic Illusions=[[d20+@{active_profile_illusions}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to see through the psionic illusion!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_illusions}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the illusion!&amp;#125;&amp;#125; {{Save vs. Illusions=[[d20+@{active_profile_illusions}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_illusions"
            ></button>
          </label>
          <label
            ><span>Insanity</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_insanity"
            />
            <span>+</span>
            <span name="attr_active_profile_insanity"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against insanity!}} {{target=[[12]]}} {{roll=[[d20+@{active_profile_insanity}]]}}"
              name="roll_active_profile_bonus_insanity"
            ></button>
          </label>
          <label
            ><span>Magic</span>
            <input type="hidden" value="0" name="attr_active_profile_magic" />
            <span>+</span>
            <span name="attr_active_profile_magic"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against magic attack!}} {{Save vs. Magic=[[d20+@{active_profile_magic}]]}}"
              name="roll_active_profile_bonus_magic"
            ></button>
          </label>
          <label
            ><span>Maintain Balance</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_maintainbalance"
            />
            <span>+</span>
            <span name="attr_active_profile_maintainbalance"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to stay standing!}} {{Maintain Balance=[[d20+@{active_profile_maintainbalance}]]}}"
              name="roll_active_profile_bonus_maintainbalance"
            ></button>
          </label>
          <label
            ><span>Mind Control</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mindcontrol"
            />
            <span>+</span>
            <span name="attr_active_profile_mindcontrol"></span>
            <button
              type="roll"
              value="?{Type of Mind Control Attack|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off magic mind control!&amp;#125;&amp;#125; {{Save vs. Magic Mind Control=[[d20+@{active_profile_mindcontrol}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to fight off psionic mind control!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_mindcontrol}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off mind control!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{active_profile_mindcontrol}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_mindcontrol"
            ></button>
          </label>
          <label
            ><span>Pain</span>
            <input type="hidden" value="0" name="attr_active_profile_pain" />
            <span>+</span>
            <span name="attr_active_profile_pain"></span>
            <button
              type="roll"
              value="?{Type of Pain Attack|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the magic pain!&amp;#125;&amp;#125; {{Save vs. Magic Pain=[[d20+@{active_profile_pain}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to push through the psionic pain!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_pain}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the pain!&amp;#125;&amp;#125; {{Save vs. Pain=[[d20+@{active_profile_pain}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_pain"
            ></button>
          </label>
          <label
            ><span>Perception</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_perceptioncheck"
            />
            <span>+</span>
            <span name="attr_active_profile_perceptioncheck"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:custom} {{title=@{character_name} looks around carefully &#x1F440;}} {{Perception Check=[[d20+@{active_profile_perceptioncheck}]]}}"
              name="roll_active_profile_bonus_perceptioncheck"
            ></button>
          </label>
          <label
            ><span>Poison: Lethal vs. 14</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_lethalpoison"
            />
            <span>+</span>
            <span name="attr_active_profile_lethalpoison"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against lethal poison!}} {{target=[[14]]}} {{roll=[[d20+@{active_profile_lethalpoison}]]}}"
              name="roll_active_profile_bonus_lethalpoison"
            ></button>
          </label>
          <label
            ><span>Poison: Non-Lethal vs. 16</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_nonlethalpoison"
            />
            <span>+</span>
            <span name="attr_active_profile_nonlethalpoison"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against non-lethal poison!}} {{target=[[16]]}} {{roll=[[d20+@{active_profile_nonlethalpoison}]]}}"
              name="roll_active_profile_bonus_nonlethalpoison"
            ></button>
          </label>
          <label
            ><span>Possession</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_possession"
            />
            <span>+</span>
            <span name="attr_active_profile_possession"></span>
            <button
              type="roll"
              value="?{Type of Possession|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being magically possessed!&amp;#125;&amp;#125; {{Save vs. Magic Possession=[[d20+@{active_profile_possession}+@{active_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to prevent being psionically possessed!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_possession}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being possessed!&amp;#125;&amp;#125; {{Save vs. Possession=[[d20+@{active_profile_possession}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_possession"
            ></button>
          </label>
          <label
            ><span class="psi-vs"
              >Psionics vs. <span name="attr_psionic_ability"></span
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_psionics"
            />
            <span>+</span>
            <span name="attr_active_profile_psionics"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against psionic attack!}} {{target=[[@{psionic_ability}]]}} {{roll=[[d20+@{active_profile_psionics}]]}}"
              name="roll_active_profile_save_psionics"
            ></button>
          </label>
          <label
            ><span>Telepathic Probes</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_telepathicprobes"
            />
            <span>+</span>
            <span name="attr_active_profile_telepathicprobes"></span>
            <button
              type="roll"
              value="?{Type of Telepathic Probe|
                Magic,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a magic telepathic probe!&amp;#125;&amp;#125; {{Save vs. Magic Telepathic Probe=[[d20+@{active_profile_telepathicprobes}+@{active_profile_magic}]]&amp;#125;&amp;#125;|
                Psionic,
                  @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to block a psionic telepathic probe!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{active_profile_telepathicprobes}+@{active_profile_psionics}]]&amp;#125;&amp;#125;|
                Other,
                  @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a telepathic probe!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{active_profile_telepathicprobes}]]&amp;#125;&amp;#125;
              }"
              name="roll_active_profile_bonus_telepathicprobes"
            ></button>
          </label>
        </div>
      </div>
      <br />
      <h3>Attributes</h3>
      <div class="modifiers-attributes">
        <div class="bonus-type-container attributes">
          <label>
            <span style="grid-column: 3 / -1">Bonuses</span>
          </label>
          <label
            ><span>I.Q.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_iq"
              title="Intelligence Quotient"
            />
            <span
              name="attr_active_profile_mod_iq"
              title="Intelligence Quotient"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_iq_bonus"
              title="+ Skills %"
            />
            <span
              name="attr_active_profile_mod_iq_bonus"
              title="+ Skills %"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_perception_bonus"
              title="+ Perception (Rifter #13, p.16)"
            />
            <span
              name="attr_active_profile_mod_perception_bonus"
              title="+ Perception (Rifter #13, p.16)"
            ></span>
          </label>
          <label
            ><span>M.E.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_me"
              title="Mental Endurance"
            />
            <span
              name="attr_active_profile_mod_me"
              title="Mental Endurance"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_me_bonus"
              title="+ Save vs. Psionics"
            />
            <span
              name="attr_active_profile_mod_me_bonus"
              title="+ Save vs. Psionics"
            ></span>
          </label>
          <label
            ><span>M.A.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_ma"
              title="Mental Affinity"
            />
            <span
              name="attr_active_profile_mod_ma"
              title="Mental Affinity"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_ma_bonus"
              title="% Trust/Intimidate"
            />
            <span
              name="attr_active_profile_mod_ma_bonus"
              title="% Trust/Intimidate"
            ></span>
          </label>
          <label
            ><span>P.S.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_ps"
              title="Physical Strength"
            />
            <span
              name="attr_active_profile_mod_ps"
              title="Physical Strength"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_ps_bonus"
              title="+ SDC Damage"
            />
            <span
              name="attr_active_profile_mod_ps_bonus"
              title="+ SDC Damage"
            ></span>
          </label>
          <label
            ><span>P.P.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pp"
              title="Physical Prowess"
            />
            <span
              name="attr_active_profile_mod_pp"
              title="Physical Prowess"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pp_bonus"
              title="+ Strike/Parry/Dodge/Entangle/Disarm"
            />
            <span
              name="attr_active_profile_mod_pp_bonus"
              title="+ Strike/Parry/Dodge/Entangle/Disarm"
            ></span>
          </label>
          <label
            ><span>P.E.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pe"
              title="Physical Endurance"
            />
            <span
              name="attr_active_profile_mod_pe"
              title="Physical Endurance"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pe_bonus"
              title="+ Magic/Poison/Toxins"
            />
            <span
              name="attr_active_profile_mod_pe_bonus"
              title="+ Magic/Poison/Toxins"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pe_coma_bonus"
              title="+ Coma/Death %"
            />
            <span
              name="attr_active_profile_mod_pe_coma_bonus"
              title="+ Coma/Death %"
            ></span>
          </label>
          <label
            ><span>P.B.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pb"
              title="Physical Beauty"
            />
            <span
              name="attr_active_profile_mod_pb"
              title="Physical Beauty"
            ></span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_pb_bonus"
              title="% Charm/Impress"
            />
            <span
              name="attr_active_profile_mod_pb_bonus"
              title="% Charm/Impress"
            ></span>
          </label>
          <label
            ><span>Spd</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_spd"
              title="Speed"
            />
            <span name="attr_active_profile_mod_spd" title="Speed"></span>
          </label>
          <label
            ><span>Spd: Fly</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_spdfly"
              title="Flying Speed"
            />
            <span
              name="attr_active_profile_mod_spdfly"
              title="Flying Speed"
            ></span>
          </label>
        </div>
        <div class="bonus-type-container">
          <label
            ><span title="Hit Points">H.P.</span
            ><input type="hidden" value="0" name="attr_active_profile_hp" />
            <span name="attr_active_profile_hp"></span>
          </label>
          <label
            ><span>S.D.C.</span
            ><input type="hidden" value="0" name="attr_active_profile_sdc" />
            <span name="attr_active_profile_sdc"></span>
          </label>
          <label
            ><span>A.R.</span
            ><input type="hidden" value="0" name="attr_active_profile_ar" />
            <span name="attr_active_profile_ar"></span>
          </label>
          <label
            ><span>M.D.C.</span
            ><input type="hidden" value="0" name="attr_active_profile_mdc" />
            <span name="attr_active_profile_mdc"></span>
          </label>
          <label
            ><span>P.P.E.</span
            ><input type="hidden" value="0" name="attr_active_profile_ppe" />
            <span name="attr_active_profile_ppe"></span>
          </label>
          <label
            ><span>I.S.P.</span
            ><input type="hidden" value="0" name="attr_active_profile_isp" />
            <span name="attr_active_profile_isp"></span>
          </label>
          <label
            ><span>H.F.</span
            ><input type="hidden" value="0" name="attr_active_profile_mod_hf" />
            <span name="attr_active_profile_mod_hf"></span>
          </label>
          <label>
            <span>Spell Strength</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_spellstrength"
            />
            <span name="attr_active_profile_mod_spellstrength"></span>
          </label>
          <label>
            <span>Trust</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_trust"
            />
            <span name="attr_active_profile_mod_trust"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to gain someone's trust}} {{target=[[{@{active_profile_mod_trust}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
              name="roll_active_profile_trust"
            ></button>
          </label>
          <label>
            <span>Intimidate</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_intimidate"
            />
            <span name="attr_active_profile_mod_intimidate"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to intimidate someone}} {{target=[[{@{active_profile_mod_intimidate}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
              name="roll_active_profile_intimidate"
            ></button>
          </label>
          <label>
            <span>Charm/Impress</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_charmimpress"
            />
            <span name="attr_active_profile_mod_charmimpress"></span>
            <button
              type="roll"
              value="@{opt_whisper}&{template:skill} {{title=@{character_name} uses Charm/Impress}} {{target=[[{@{active_profile_mod_charmimpress}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
              name="roll_active_profile_charmimpress"
            ></button>
          </label>
          <label>
            <span>Skill Bonus %</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_skillbonus"
            />
            <span name="attr_active_profile_mod_skillbonus"></span>
          </label>
        </div>
        <div class="bonus-ps-container">
          <label class="select"
            ><span>PS Type</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_character_ps_type"
            />
            <input
              type="hidden"
              name="attr_active_profile_mod_character_ps_type_name"
            />
            <span
              class="twospan2"
              name="attr_active_profile_mod_character_ps_type_name"
            ></span>
          </label>
          <label
            ><span>Restrained Punch</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_restrained_punch"
              value="0"
            />
            <span name="attr_active_profile_mod_restrained_punch"></span>
            <input
              type="hidden"
              name="attr_active_profile_mod_restrained_punch_unit"
            />
            <span name="attr_active_profile_mod_restrained_punch_unit"></span>
          </label>

          <label
            ><span>Punch</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_punch"
              value="0"
            />
            <span name="attr_active_profile_mod_punch"></span>
            <input type="hidden" name="attr_active_profile_mod_punch_unit" />
            <span name="attr_active_profile_mod_punch_unit"></span>
          </label>

          <label
            ><span>Power Punch</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_power_punch"
              value="0"
            />
            <span name="attr_active_profile_mod_power_punch"></span>
            <input
              type="hidden"
              name="attr_active_profile_mod_power_punch_unit"
            />
            <span name="attr_active_profile_mod_power_punch_unit"></span>
          </label>

          <label
            ><span>Kick</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_kick"
              value="0"
            />
            <span name="attr_active_profile_mod_kick"></span>
            <input type="hidden" name="attr_active_profile_mod_kick_unit" />
            <span name="attr_active_profile_mod_kick_unit"></span>
          </label>

          <label
            ><span>Leap Kick</span>
            <input
              type="hidden"
              name="attr_active_profile_mod_leap_kick"
              value="0"
            />
            <span name="attr_active_profile_mod_leap_kick"></span>
            <input
              type="hidden"
              name="attr_active_profile_mod_leap_kick_unit"
            />
            <span name="attr_active_profile_mod_leap_kick_unit"></span>
          </label>

          <label
            ><span>Lift/Carry Weight Multiplier</span>
            <input
              type="hidden"
              value="1"
              name="attr_active_profile_mod_liftcarry_weight_multiplier"
              value="1"
            />
            <span
              name="attr_active_profile_mod_liftcarry_weight_multiplier"
            ></span>
            <span>&#x00D7;</span>
          </label>

          <label
            ><span>Lift/Carry Duration Multiplier</span>
            <input
              type="hidden"
              value="1"
              name="attr_active_profile_mod_liftcarry_duration_multiplier"
              value="1"
            />
            <span
              name="attr_active_profile_mod_liftcarry_duration_multiplier"
            ></span>
            <span>&#x00D7;</span>
          </label>

          <label
            ><span>Lift</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_lift"
              value="0"
            />
            <span name="attr_active_profile_mod_lift"></span>
            <span>lbs</span>
          </label>

          <label
            ><span>Carry</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_carry"
              value="0"
            />
            <span name="attr_active_profile_mod_carry"></span>
            <span>lbs</span>
          </label>

          <label
            ><span>Throw (&frac12; Carry)</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_throw_distance"
              value="0"
            />
            <span name="attr_active_profile_mod_throw_distance"></span>
            <span>Feet</span></label
          >

          <label
            ><span>Carry Max</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_carry_max"
            />
            <span name="attr_active_profile_mod_carry_max"></span>
            <span>Minutes</span>
          </label>

          <label
            ><span>Carry (Running)</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_carry_running"
            />
            <span name="attr_active_profile_mod_carry_running"></span>
            <span>Minutes</span></label
          >

          <label
            ><span>Hold Max.</span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_mod_hold_max"
            />
            <span name="attr_active_profile_mod_hold_max"></span>
            <span>Melees</span></label
          >
        </div>
        <div class="bonus-type-container movement">
          <h2>Movement</h2>
          <label><span></span><span>Imperial</span><span>Metric</span></label>
          <label
            ><span>Run/hour</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_mph"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_mph"></span>
              <span>mph</span></span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_kmh"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_kmh"></span>
              <span>km/h</span>
            </span>
          </label>
          <label
            ><span>Run/melee</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_ft_melee"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_ft_melee"></span
              ><span>ft</span></span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_m_melee"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_m_melee"></span>
              <span>m</span>
            </span>
          </label>
          <label
            ><span>Run/action</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_ft_action"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_ft_action"></span
              ><span>ft</span> </span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_run_m_action"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_run_m_action"></span>
              <span>m</span>
            </span>
          </label>
          <label
            ><span>Fly/hour</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_fly_mph"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_mph"></span>
              <span>mph</span>
            </span>
            <input type="hidden" value="0" name="attr_active_profile_fly_kmh" />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_kmh"></span>
              <span>km/h</span>
            </span>
          </label>
          <label
            ><span>Fly/melee</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_fly_ft_melee"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_ft_melee"></span>
              <span>ft</span>
            </span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_fly_m_melee"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_m_melee"></span>
              <span>m</span>
            </span>
          </label>
          <label
            ><span>Fly/action</span
            ><input
              type="hidden"
              value="0"
              name="attr_active_profile_fly_ft_action"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_ft_action"></span>
              <span>ft</span>
            </span>
            <input
              type="hidden"
              value="0"
              name="attr_active_profile_fly_m_action"
            />
            <span class="readonly-light">
              <span name="attr_active_profile_fly_m_action"></span>
              <span>m</span>
            </span>
          </label>
        </div>
      </div>
      <br />
      <label class="description"
        ><b>Description</b>
        <textarea
          class="full"
          name="attr_active_profile_description"
          value=""
          readonly
        ></textarea>
      </label>
    </div>
  </div>
</div>

              <!-- endinject -->
            </details>
            <hr />
            <div class="armor-profiles">
              <div class="armor">
                <h3>Armor</h3>
                <div class="armor-damage">
                  <label
                    >Damage
                    <input
                      type="number"
                      placeholder="Damage"
                      name="attr_armordamage"
                    />
                  </label>
                  <button type="action" name="act_armorapplydamage">
                    Apply Damage
                  </button>
                </div>
                <div class="armor-labels heading">
                  <label>Active</label>
                  <label>Name</label>
                  <label>Movement Modifier %</label>
                  <label>Base MDC</label>
                  <label>Current MDC</label>
                </div>
                <fieldset class="repeating_armor">
                  <div class="repeating_armor-inner">
                    <!-- inject:partials/armor.html -->
                    <label
  ><input type="checkbox" class="is-active" name="attr_is_active" value="1"
/></label>
<input type="text" placeholder="Armor Name" name="attr_name" />
<input type="number" placeholder="%" name="attr_movementpenalty" />
<input type="number" placeholder="Base MDC" name="attr_mdc_max" value="0" />
<input
  type="number"
  class="danger"
  placeholder="Current MDC"
  name="attr_mdc"
  value="0"
/>
<button type="action" name="act_resetmdc">Reset MDC</button>

                    <!-- endinject -->
                  </div>
                </fieldset>
              </div>
              <hr />
              <div class="profile-builder">
                <div class="profiles repeating-bonuses-outer">
                  <div class="profiles-inner">
                    <h3>Profiles</h3>
                    <button type="action" name="act_getdefaultprofile">
                      Debug Defaults
                    </button>
                    <input type="hidden" name="attr_default_mdc" />
                    <input type="hidden" name="attr_default_profile" />
                    <label>Active</label>
                    <fieldset class="repeating_profiles">
                      <div class="repeating_profiles-inner">
                        <label>
                          <input
                            type="checkbox"
                            class="is-default"
                            name="attr_is_default"
                            value="1"
                          />
                        </label>
                        <details class="info profile">
                          <summary>
                            <div class="bonus-thing-heading">
                              <b class="click-expand"
                                ><span title="Click for more info"
                                  >&nbsp;&#9432;</span
                                ></b
                              >
                              <label
                                ><span>Name</span>
                                <input type="text" name="attr_name" />
                              </label>
                            </div>
                          </summary>
                          <div class="details-body">
                            <div class="profile-management">
                              <input
                                type="text"
                                class="full"
                                name="attr_bonus_ids"
                              />
                              <input type="hidden" name="attr_bonus_names" />
                              <div class="bonus-names">
                                <span name="attr_bonus_names"></span>
                              </div>
                              <div class="buttons">
                                <button
                                  type="action"
                                  name="act_updateprofile"
                                  class="metal-btn btn-silver-flat"
                                >
                                  Refresh &#x27F3;
                                </button>
                                <button
                                  type="action"
                                  name="act_copybonusids"
                                  class="metal-btn btn-silver-flat"
                                >
                                  Apply
                                  <span class="picker-title"
                                    >Picked Modifiers</span
                                  >
                                  &#x2190;
                                </button>
                                <hr />
                                <button
                                  type="action"
                                  name="act_checkbonusids"
                                  class="metal-btn btn-silver-flat"
                                >
                                  Replace
                                  <span class="picker-title"
                                    >Picked Modifiers</span
                                  >
                                  using this profile &#x2192;
                                </button>
                              </div>
                            </div>
                            <!-- inject:partials/repeating_modifiers_readonly.html -->
                            <input type="hidden" name="attr_bonus_id" value="" />
<input type="hidden" name="global_psionic_ability" />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="hidden" value="0" name="attr_attacks" />
    <span name="attr_attacks"></span>
  </label>
  <label class="roller"
    ><span>Initiative</span>
    <input type="hidden" value="0" name="attr_initiative" />
    <span>+</span>
    <span name="attr_initiative"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:custom} {{title=@{character_name} rolls Initiative}} {{Initiative=[[d20+@{initiative} &{tracker}]]}}"
      name="roll_bonus_initiative"
    ></button>
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="hidden" value="0" name="attr_strike" />
      <span>+</span>
      <span name="attr_strike"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} strikes!}} {{Strike=[[d20cs>@{critical}+@{strike}]]}}"
        name="roll_bonus_strike"
      ></button>
    </label>
    <label
      ><span>Disarm</span>
      <input type="hidden" value="0" name="attr_disarm" />
      <span>+</span>
      <span name="attr_disarm"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm!}} {{Disarm=[[d20+@{disarm}]]}}"
        name="roll_bonus_disarm"
      ></button>
    </label>
    <label
      ><span>Entangle</span>
      <input type="hidden" value="0" name="attr_entangle" />
      <span>+</span>
      <span name="attr_entangle"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to entangle!}} {{Entangle=[[d20+@{entangle}]]}}"
        name="roll_bonus_entangle"
      ></button>
    </label>
    <label
      ><span>Throw</span>
      <input type="hidden" value="0" name="attr_throw" />
      <span>+</span>
      <span name="attr_throw"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} throws something!}} {{Throw=[[d20+@{throw}]]}}"
        name="roll_bonus_throw"
      ></button>
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="hidden" value="0" name="attr_pull" />
      <span>+</span>
      <span name="attr_pull"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to pull their punch!}} {{target=[[11]]}} {{roll=[[d20+@{pull}]]}}"
        name="roll_bonus_pull"
      ></button>
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="hidden" value="0" name="attr_flipthrow" />
      <span>+</span>
      <span name="attr_flipthrow"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body flip/throw!}} {{Body Flip/Throw=[[d20cs>@{critical}+@{flipthrow}]]}}"
        name="roll_bonus_flipthrow"
      ></button>
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="hidden" value="0" name="attr_tackle" />
      <span>+</span>
      <span name="attr_tackle"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body block/tackle!}} {{Body Block/Tackle=[[d20cs>@{critical}+@{tackle}]]}}"
        name="roll_bonus_tackle"
      ></button>
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="hidden" value="0" name="attr_leghook" />
      <span>+</span>
      <span name="attr_leghook"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a trip/leg hook!}} {{Tripping/Leg Hook=[[d20cs>@{critical}+@{leghook}]]}}"
        name="roll_bonus_leghook"
      ></button>
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="hidden" value="0" name="attr_backwardsweepkick" />
      <span>+</span>
      <span name="attr_backwardsweepkick"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a backward sweep kick!}} {{Backward Sweep Kick=[[d20cs>@{critical}+@{backwardsweepkick}]]}}"
        name="roll_bonus_backwardsweepkick"
      ></button>
    </label>
    <hr />
    <label
      ><span>Critical</span>
      <input type="hidden" value="" name="attr_critical" />
      <span></span>
      <span name="attr_critical"></span>
    </label>
    <label
      ><span>Knockout</span>
      <input type="hidden" value="" name="attr_knockout" />
      <span></span>
      <span name="attr_knockout"></span>
    </label>
    <label
      ><span>Death Blow</span>
      <input type="hidden" value="0" name="attr_deathblow" />
      <span></span>
      <span name="attr_deathblow"></span>
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="hidden" value="0" name="attr_damage" />
      <span></span>
      <span name="attr_damage"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus}
        }]]}}"
        name="roll_bonus_damage"
      ></button>
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="hidden" value="0" name="attr_damage_paired" />
      <span></span>
      <span name="attr_damage_paired"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_paired} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } * [[ {{ @{opt_paired_damage},0 }dl1 } * 1 + 1 ]]
        ]]}}"
        name="roll_bonus_damage_paired"
      ></button>
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="hidden" value="0" name="attr_damage_mainhand" />
      <span></span>
      <span name="attr_damage_mainhand"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_mainhand} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
        ]]}}"
        name="roll_bonus_damage_mainhand"
      ></button>
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="hidden" value="0" name="attr_damage_offhand" />
      <span></span>
      <span name="attr_damage_offhand"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_offhand} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
        ]]}}"
        name="roll_bonus_damage_offhand"
      ></button>
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern/Range <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="hidden" value="0" name="attr_strike_range" />
      <span>+</span>
      <span name="attr_strike_range"></span>
    </label>
    <label title="1 Action"
      ><span>Strike: Single/Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_single" />
      <span>+</span>
      <span name="attr_strike_range_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a single shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_single} ]]}}"
        name="roll_bonus_strike_range_single"
      ></button>
    </label>
    <label title="1 Action"
      ><span>Strike: Burst</span>
      <input type="hidden" value="0" name="attr_strike_range_burst" />
      <span>+</span>
      <span name="attr_strike_range_burst"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a burst shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_burst} ]]}}"
        name="roll_bonus_strike_range_burst"
      ></button>
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed" />
      <span>+</span>
      <span name="attr_strike_range_aimed"></span>
    </label>
    <label title="2 Actions"
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span>+</span>
      <span name="attr_strike_range_aimed_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed single shot!}} {{Range Aimed Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_single} ]]}}"
        name="roll_bonus_strike_range_aimed_single"
      ></button>
    </label>
    <label title="2 Actions"
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span>+</span>
      <span name="attr_strike_range_aimed_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed pulse shot!}} {{Range Aimed Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_pulse} ]]}}"
        name="roll_bonus_strike_range_aimed_pulse"
      ></button>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="hidden" value="0" name="attr_strike_range_called" />
      <span>+</span>
      <span name="attr_strike_range_called"></span>
    </label>
    <label title="2 Actions"
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span>+</span>
      <span name="attr_strike_range_called_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called single shot!}} {{Range Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_called_single} ]]}}"
        name="roll_bonus_strike_range_called_single"
      ></button>
    </label>
    <label title="2 Actions"
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span>+</span>
      <span name="attr_strike_range_called_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called pulse shot!}} {{Range Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_called_pulse} ]]}}"
        name="roll_bonus_strike_range_called_pulse"
      ></button>
    </label>
    <label title="3 Actions"
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span>+</span>
      <span name="attr_strike_range_aimed_called_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called single shot!}} {{Range Aimed Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_called_single} ]]}}"
        name="roll_bonus_strike_range_aimed_called_single"
      ></button>
    </label>
    <label title="3 Actions"
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span>+</span>
      <span name="attr_strike_range_aimed_called_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called pulse shot!}} {{Range Aimed Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_called_pulse} ]]}}"
        name="roll_bonus_strike_range_aimed_called_pulse"
      ></button>
    </label>
    <hr />
    <label
      title="Using a gun to shoot a weapon out of an opponent's hand requires a called shot and careful aim (only the gunslinger can shoot to disarm on a quick draw)"
      ><span>Disarm</span>
      <input type="hidden" value="0" name="attr_disarm_range" />
      <span>+</span>
      <span name="attr_disarm_range"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm at range!}} {{Range Disarm=[[d20+@{disarm_range} + ?{Type of shot?|
          No additional bonus,0|
          Called Single (2 Actions),@{strike_range_called_single}|
          Called Pulse (2 Actions),@{strike_range_called_pulse}|
          Aimed Called Single (3 Actions),@{strike_range_aimed_called_single}|
          Aimed Called Pulse (3 Actions),@{strike_range_aimed_called_pulse}|
          Quick Draw Single (1 Action),@{strike_range_single}|
          Quick Draw Pulse (1 Action),@{strike_range_burst}
        }]]}}"
        name="roll_bonus_disarm_range"
      ></button>
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="hidden" value="0" name="attr_damage_range" />
      <span></span>
      <span name="attr_damage_range"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage!}} {{Range Damage=[[@{damage_range}]]}}"
        name="roll_bonus_damage_range"
      ></button>
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="hidden" value="0" name="attr_damage_range_single" />
      <span></span>
      <span name="attr_damage_range_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a single shot!}} {{Range Damage=[[@{damage_range_single}]]}}"
        name="roll_bonus_damage_range_single"
      ></button>
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="hidden" value="0" name="attr_damage_range_burst" />
      <span></span>
      <span name="attr_damage_range_burst"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a burst!}} {{Range Damage=[[@{damage_range_burst}]]}}"
        name="roll_bonus_damage_range_burst"
      ></button>
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="hidden" value="0" name="attr_parry" />
      <span>+</span>
      <span name="attr_parry"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to parry!}} {{Parry=[[d20+@{parry}]]}}"
        name="roll_bonus_parry"
      ></button>
    </label>
    <label
      ><span>Dodge</span>
      <input type="hidden" value="0" name="attr_dodge" />
      <span>+</span>
      <span name="attr_dodge"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge!}} {{ Dodge=[[ d20+@{dodge} - @{opt_dodge_penalty} ]] }}"
        name="roll_bonus_dodge"
      ></button>
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="hidden" value="0" name="attr_dodge_flight" />
      <span>+</span>
      <span name="attr_dodge_flight"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge in flight!}} {{Dodge in Flight=[[d20+@{dodge_flight} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_flight"
      ></button>
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="hidden" value="0" name="attr_dodge_auto" />
      <span>+</span>
      <span name="attr_dodge_auto"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to auto dodge!}} {{Auto Dodge=[[d20+@{dodge_auto} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_auto"
      ></button>
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="hidden" value="0" name="attr_dodge_teleport" />
      <span>+</span>
      <span name="attr_dodge_teleport"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to teleport dodge!}} {{Teleport Dodge=[[d20+@{dodge_teleport} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_teleport"
      ></button>
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="hidden" value="0" name="attr_dodge_motion" />
      <span>+</span>
      <span name="attr_dodge_motion"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge while in motion!}} {{Dodge in Motion=[[d20+@{dodge_motion} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_motion"
      ></button>
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="hidden" value="0" name="attr_dodge_underwater" />
      <span>+</span>
      <span name="attr_dodge_underwater"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge underwater!}} {{Dodge Underwater=[[d20+@{dodge_underwater} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_underwater"
      ></button>
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="hidden" value="0" name="attr_roll" />
      <span>+</span>
      <span name="attr_roll"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to roll with impact!}} {{Roll w/ Impact=[[d20+@{roll}]]}}"
        name="roll_bonus_roll"
      ></button>
    </label>
    <label
      ><span>Break Fall</span>
      <input type="hidden" value="0" name="attr_breakfall" />
      <span>+</span>
      <span name="attr_breakfall"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to break fall!}} {{Break Fall=[[d20+@{breakfall}]]}}"
        name="roll_bonus_breakfall"
      ></button>
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="hidden" value="0" name="attr_comadeath" />
      <span>+</span>
      <span name="attr_comadeath"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries not to die!}} {{target=[[50+@{comadeath}]]}} {{roll=[[d100]]}}"
        name="roll_bonus_comadeath"
      ></button>
    </label>
    <label
      ><span>Curses vs. 15</span>
      <input type="hidden" value="0" name="attr_curses" />
      <span>+</span>
      <span name="attr_curses"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against being cursed!}} {{target=[[15]]}} {{roll=[[d20+@{curses}+?{Add modifier?|
            None,0|
            Magic,@{magic}|
            Psionics,@{psionics}
          }]]}}"
        name="roll_bonus_curses"
      ></button>
    </label>
    <label
      ><span>Despair</span>
      <input type="hidden" value="0" name="attr_despair" />
      <span>+</span>
      <span name="attr_despair"></span>
      <button
        type="roll"
        value="?{Type of Despair|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. magic despair!&amp;#125;&amp;#125; {{Save vs. Magic Despair=[[d20+@{despair}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to save vs. psionic despair!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{despair}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. despair!&amp;#125;&amp;#125; {{Save vs. Despair=[[d20+@{despair}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_despair"
      ></button>
    </label>
    <label
      ><span>Disease</span>
      <input type="hidden" value="0" name="attr_disease" />
      <span>+</span>
      <span name="attr_disease"></span>
      <button
        type="roll"
        value="?{Type of Disease|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{Save vs. Magic Disease=[[d20+@{disease}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{disease}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{Save vs. Disease=[[d20+@{disease}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_disease"
      ></button>
    </label>
    <label
      ><span>Drugs vs. 15</span>
      <input type="hidden" value="0" name="attr_drugs" />
      <span>+</span>
      <span name="attr_drugs"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against harmful drugs!}} {{target=[[15]]}} {{roll=[[d20+@{drugs}]]}}"
        name="roll_bonus_drugs"
      ></button>
    </label>
    <label
      ><span>Fatigue</span>
      <input type="hidden" value="0" name="attr_fatigue" />
      <span>+</span>
      <span name="attr_fatigue"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to push through the fatigue!}} {{Fatigue=[[d20+@{fatigue}]]}}"
        name="roll_bonus_fatigue"
      ></button>
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="hidden" value="0" name="attr_horrorfactor" />
      <span>+</span>
      <span name="attr_horrorfactor"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against horror factor!}} {{Save vs. Horror Factor=[[d20+@{horrorfactor}]]}}"
        name="roll_bonus_horrorfactor"
      ></button>
    </label>
    <label
      ><span>Illusions</span>
      <input type="hidden" value="0" name="attr_illusions" />
      <span>+</span>
      <span name="attr_illusions"></span>
      <button
        type="roll"
        value="?{Type of Illusion|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the magic illusion!&amp;#125;&amp;#125; {{Save vs. Magic Illusions=[[d20+@{illusions}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to see through the psionic illusion!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{illusions}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the illusion!&amp;#125;&amp;#125; {{Save vs. Illusions=[[d20+@{illusions}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_illusions"
      ></button>
    </label>
    <label
      ><span>Insanity</span>
      <input type="hidden" value="0" name="attr_insanity" />
      <span>+</span>
      <span name="attr_insanity"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against insanity!}} {{target=[[12]]}} {{roll=[[d20+@{insanity}]]}}"
        name="roll_bonus_insanity"
      ></button>
    </label>
    <label
      ><span>Magic</span>
      <input type="hidden" value="0" name="attr_magic" />
      <span>+</span>
      <span name="attr_magic"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against magic attack!}} {{Save vs. Magic=[[d20+@{magic}]]}}"
        name="roll_bonus_magic"
      ></button>
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="hidden" value="0" name="attr_maintainbalance" />
      <span>+</span>
      <span name="attr_maintainbalance"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to stay standing!}} {{Maintain Balance=[[d20+@{maintainbalance}]]}}"
        name="roll_bonus_maintainbalance"
      ></button>
    </label>
    <label
      ><span>Mind Control</span>
      <input type="hidden" value="0" name="attr_mindcontrol" />
      <span>+</span>
      <span name="attr_mindcontrol"></span>
      <button
        type="roll"
        value="?{Type of Mind Control Attack|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off magic mind control!&amp;#125;&amp;#125; {{Save vs. Magic Mind Control=[[d20+@{mindcontrol}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to fight off psionic mind control!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{mindcontrol}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off mind control!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{mindcontrol}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_mindcontrol"
      ></button>
    </label>
    <label
      ><span>Pain</span>
      <input type="hidden" value="0" name="attr_pain" />
      <span>+</span>
      <span name="attr_pain"></span>
      <button
        type="roll"
        value="?{Type of Pain Attack|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the magic pain!&amp;#125;&amp;#125; {{Save vs. Magic Pain=[[d20+@{pain}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to push through the psionic pain!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{pain}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the pain!&amp;#125;&amp;#125; {{Save vs. Pain=[[d20+@{pain}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_pain"
      ></button>
    </label>
    <label
      ><span>Perception</span>
      <input type="hidden" value="0" name="attr_perceptioncheck" />
      <span>+</span>
      <span name="attr_perceptioncheck"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} looks around carefully &#x1F440;}} {{Perception Check=[[d20+@{perceptioncheck}]]}}"
        name="roll_bonus_perceptioncheck"
      ></button>
    </label>
    <label
      ><span>Poison: Lethal vs. 14</span>
      <input type="hidden" value="0" name="attr_lethalpoison" />
      <span>+</span>
      <span name="attr_lethalpoison"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against lethal poison!}} {{target=[[14]]}} {{roll=[[d20+@{lethalpoison}]]}}"
        name="roll_bonus_lethalpoison"
      ></button>
    </label>
    <label
      ><span>Poison: Non-Lethal vs. 16</span>
      <input type="hidden" value="0" name="attr_nonlethalpoison" />
      <span>+</span>
      <span name="attr_nonlethalpoison"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against non-lethal poison!}} {{target=[[16]]}} {{roll=[[d20+@{nonlethalpoison}]]}}"
        name="roll_bonus_nonlethalpoison"
      ></button>
    </label>
    <label
      ><span>Possession</span>
      <input type="hidden" value="0" name="attr_possession" />
      <span>+</span>
      <span name="attr_possession"></span>
      <button
        type="roll"
        value="?{Type of Possession|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being magically possessed!&amp;#125;&amp;#125; {{Save vs. Magic Possession=[[d20+@{possession}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to prevent being psionically possessed!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{possession}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being possessed!&amp;#125;&amp;#125; {{Save vs. Possession=[[d20+@{possession}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_possession"
      ></button>
    </label>
    <label
      ><span class="psi-vs"
        >Psionics vs. <span name="attr_global_psionic_ability"></span
      ></span>
      <input type="hidden" value="0" name="attr_psionics" />
      <span>+</span>
      <span name="attr_psionics"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against psionic attack!}} {{target=[[@{psionic_ability}]]}} {{roll=[[d20+@{psionics}]]}}"
        name="roll_save_psionics"
      ></button>
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="hidden" value="0" name="attr_telepathicprobes" />
      <span>+</span>
      <span name="attr_telepathicprobes"></span>
      <button
        type="roll"
        value="?{Type of Telepathic Probe|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a magic telepathic probe!&amp;#125;&amp;#125; {{Save vs. Magic Telepathic Probe=[[d20+@{telepathicprobes}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to block a psionic telepathic probe!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{telepathicprobes}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a telepathic probe!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{telepathicprobes}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_telepathicprobes"
      ></button>
    </label>
  </div>
</div>
<br />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span>I.Q.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <span name="attr_mod_iq" title="Intelligence Quotient"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <span name="attr_mod_me" title="Mental Endurance"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <span name="attr_mod_ma" title="Mental Affinity"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <span name="attr_mod_ps" title="Physical Strength"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <span name="attr_mod_pp" title="Physical Prowess"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <span name="attr_mod_pe" title="Physical Endurance"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <span name="attr_mod_pb" title="Physical Beauty"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="hidden" value="0" name="attr_mod_spd" title="Speed" />
      <span name="attr_mod_spd" title="Speed"></span>
    </label>
    <label
      ><span>Spd: Fly</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
      />
      <span name="attr_mod_spdfly" title="Flying Speed"></span>
    </label>
  </div>
  <div class="bonus-type-container">
    <label
      ><span title="Hit Points">H.P.</span
      ><input type="hidden" value="0" name="attr_hp" />
      <span name="attr_hp"></span>
    </label>
    <label
      ><span>S.D.C.</span><input type="hidden" value="0" name="attr_sdc" />
      <span name="attr_sdc"></span>
    </label>
    <label
      ><span>A.R.</span><input type="hidden" value="0" name="attr_ar" />
      <span name="attr_ar"></span>
    </label>
    <label
      ><span>M.D.C.</span><input type="hidden" value="0" name="attr_mdc" />
      <span name="attr_mdc"></span>
    </label>
    <label
      ><span>P.P.E.</span><input type="hidden" value="0" name="attr_ppe" />
      <span name="attr_ppe"></span>
    </label>
    <label
      ><span>I.S.P.</span><input type="hidden" value="0" name="attr_isp" />
      <span name="attr_isp"></span>
    </label>
    <label
      ><span>H.F.</span><input type="hidden" value="0" name="attr_mod_hf" />
      <span name="attr_mod_hf"></span>
    </label>
    <label>
      <span>Spell Strength</span>
      <input type="hidden" value="0" name="attr_mod_spellstrength" />
      <span name="attr_mod_spellstrength"></span>
    </label>
    <label>
      <span>Trust</span>
      <input type="hidden" value="0" name="attr_mod_trust" />
      <span name="attr_mod_trust"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to gain someone's trust}} {{target=[[{@{mod_trust}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_trust"
      ></button>
    </label>
    <label>
      <span>Intimidate</span>
      <input type="hidden" value="0" name="attr_mod_intimidate" />
      <span name="attr_mod_intimidate"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to intimidate someone}} {{target=[[{@{mod_intimidate}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_intimidate"
      ></button>
    </label>
    <label>
      <span>Charm/Impress</span>
      <input type="hidden" value="0" name="attr_mod_charmimpress" />
      <span name="attr_mod_charmimpress"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} uses Charm/Impress}} {{target=[[{@{mod_charmimpress}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_charmimpress"
      ></button>
    </label>
    <label>
      <span>Skill Bonus %</span>
      <input type="hidden" value="0" name="attr_mod_skillbonus" />
      <span name="attr_mod_skillbonus"></span>
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <input type="hidden" name="attr_mod_character_ps_type" />
      <input type="hidden" name="attr_mod_character_ps_type_name" />
      <span class="twospan2" name="attr_mod_character_ps_type_name"></span>
    </label>
    <label
      ><span>Restrained Punch</span>
      <input type="hidden" name="attr_mod_restrained_punch" value="0" />
      <span name="attr_mod_restrained_punch"></span>
      <input type="hidden" name="attr_mod_restrained_punch_unit" />
      <span name="attr_mod_restrained_punch_unit"></span>
    </label>

    <label
      ><span>Punch</span>
      <input type="hidden" name="attr_mod_punch" value="0" />
      <span name="attr_mod_punch"></span>
      <input type="hidden" name="attr_mod_punch_unit" />
      <span name="attr_mod_punch_unit"></span>
    </label>

    <label
      ><span>Power Punch</span>
      <input type="hidden" name="attr_mod_power_punch" value="0" />
      <span name="attr_mod_power_punch"></span>
      <input type="hidden" name="attr_mod_power_punch_unit" />
      <span name="attr_mod_power_punch_unit"></span>
    </label>

    <label
      ><span>Kick</span>
      <input type="hidden" name="attr_mod_kick" value="0" />
      <span name="attr_mod_kick"></span>
      <input type="hidden" name="attr_mod_kick_unit" />
      <span name="attr_mod_kick_unit"></span>
    </label>

    <label
      ><span>Leap Kick</span>
      <input type="hidden" name="attr_mod_leap_kick" value="0" />
      <span name="attr_mod_leap_kick"></span>
      <input type="hidden" name="attr_mod_leap_kick_unit" />
      <span name="attr_mod_leap_kick_unit"></span>
    </label>

    <label
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="hidden"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
        value="1"
      />
      <span name="attr_mod_liftcarry_weight_multiplier"></span>
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="hidden"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
        value="1"
      />
      <span name="attr_mod_liftcarry_duration_multiplier"></span>
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="hidden" value="0" name="attr_mod_lift" value="0" />
      <span name="attr_mod_lift"></span>
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="hidden" value="0" name="attr_mod_carry" value="0" />
      <span name="attr_mod_carry"></span>
      <span>lbs</span>
    </label>

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="hidden" value="0" name="attr_mod_throw_distance" value="0" />
      <span name="attr_mod_throw_distance"></span>
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="hidden" value="0" name="attr_mod_carry_max" />
      <span name="attr_mod_carry_max"></span>
      <span>Minutes</span>
    </label>

    <label
      ><span>Carry (Running)</span>
      <input type="hidden" value="0" name="attr_mod_carry_running" />
      <span name="attr_mod_carry_running"></span>
      <span>Minutes</span></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="hidden" value="0" name="attr_mod_hold_max" />
      <span name="attr_mod_hold_max"></span>
      <span>Melees</span></label
    >
  </div>

  <div class="bonus-type-container movement">
    <h2>Movement</h2>
    <label><span></span><span>Imperial</span><span>Metric</span></label>
    <label
      ><span>Run/hour</span
      ><input type="hidden" value="0" name="attr_run_mph" />
      <span class="readonly-light">
        <span name="attr_run_mph"></span>
        <span>mph</span>
      </span>
      <input type="hidden" value="0" name="attr_run_kmh" />
      <span class="readonly-light">
        <span name="attr_run_kmh"></span>
        <span>km/h</span>
      </span>
    </label>
    <label
      ><span>Run/melee</span
      ><input type="hidden" value="0" name="attr_run_ft_melee" />
      <span class="readonly-light">
        <span name="attr_run_ft_melee"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_run_m_melee" />
      <span class="readonly-light">
        <span name="attr_run_m_melee"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Run/action</span
      ><input type="hidden" value="0" name="attr_run_ft_action" />
      <span class="readonly-light">
        <span name="attr_run_ft_action"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_run_m_action" />
      <span class="readonly-light">
        <span name="attr_run_m_action"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Fly/hour</span
      ><input type="hidden" value="0" name="attr_fly_mph" />
      <span class="readonly-light">
        <span name="attr_fly_mph"></span>
        <span>mph</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_kmh" />
      <span class="readonly-light">
        <span name="attr_fly_kmh"></span>
        <span>km/h</span>
      </span>
    </label>
    <label
      ><span>Fly/melee</span
      ><input type="hidden" value="0" name="attr_fly_ft_melee" />
      <span class="readonly-light">
        <span name="attr_fly_ft_melee"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_m_melee" />
      <span class="readonly-light">
        <span name="attr_fly_m_melee"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Fly/action</span
      ><input type="hidden" value="0" name="attr_fly_ft_action" />
      <span class="readonly-light">
        <span name="attr_fly_ft_action"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_m_action" />
      <span class="readonly-light">
        <span name="attr_fly_m_action"></span>
        <span>m</span>
      </span>
    </label>
  </div>
</div>
<br />
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

                            <!-- endinject -->
                          </div>
                        </details>
                      </div>
                    </fieldset>
                  </div>
                </div>
                <div class="picker">
                  <div class="picker-inner">
                    <h3 class="picker-title">Modifier Picker</h3>
                    <fieldset class="repeating_bonusselections">
                      <label>
                        <input type="checkbox" name="attr_enabled" value="1" />
                        <span name="attr_name"></span
                      ></label>
                      <input type="hidden" name="attr_name" value="" />
                      <input type="hidden" name="attr_bonus_id" value="" />
                    </fieldset>
                    <div class="selected-ids">
                      <b>Selected IDs</b>
                      <input
                        class="full"
                        type="text"
                        name="attr_bonus_ids_output"
                        value=""
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr />
          </div>
          <div class="bonus-sources repeating-bonuses-outer">
            <h3>Bonus Sources</h3>
            <fieldset class="repeating_bonuses">
              <input type="hidden" name="attr_selection_id" value="" />
              <details class="info">
                <summary>
                  <div class="bonus-thing-heading">
                    <b class="click-expand"
                      ><span title="Click for more info">&nbsp;&#9432;</span></b
                    >
                    <label
                      ><span>Name</span>
                      <input type="text" list="modifiers" name="attr_name" />
                    </label>
                    <label
                      ><span>Level</span>
                      <input type="number" value="1" name="attr_level" />
                    </label>
                  </div>
                </summary>
                <div class="details-body">
                  <!-- inject:partials/repeating_modifiers_readonly.html -->
                  <input type="hidden" name="attr_bonus_id" value="" />
<input type="hidden" name="global_psionic_ability" />
<h3>Combat</h3>
<div class="bonus-type-container">
  <label
    ><span>Attacks</span>
    <input type="hidden" value="0" name="attr_attacks" />
    <span name="attr_attacks"></span>
  </label>
  <label class="roller"
    ><span>Initiative</span>
    <input type="hidden" value="0" name="attr_initiative" />
    <span>+</span>
    <span name="attr_initiative"></span>
    <button
      type="roll"
      value="@{opt_whisper}&{template:custom} {{title=@{character_name} rolls Initiative}} {{Initiative=[[d20+@{initiative} &{tracker}]]}}"
      name="roll_bonus_initiative"
    ></button>
  </label>
</div>
<div class="modifiers-combat">
  <div class="combat-offense-melee bonus-type-container">
    <h3><span>&#x2694;</span> Ancient <span>&#x1F3F9;</span></h3>
    <label
      ><span>Strike</span>
      <input type="hidden" value="0" name="attr_strike" />
      <span>+</span>
      <span name="attr_strike"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} strikes!}} {{Strike=[[d20cs>@{critical}+@{strike}]]}}"
        name="roll_bonus_strike"
      ></button>
    </label>
    <label
      ><span>Disarm</span>
      <input type="hidden" value="0" name="attr_disarm" />
      <span>+</span>
      <span name="attr_disarm"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm!}} {{Disarm=[[d20+@{disarm}]]}}"
        name="roll_bonus_disarm"
      ></button>
    </label>
    <label
      ><span>Entangle</span>
      <input type="hidden" value="0" name="attr_entangle" />
      <span>+</span>
      <span name="attr_entangle"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to entangle!}} {{Entangle=[[d20+@{entangle}]]}}"
        name="roll_bonus_entangle"
      ></button>
    </label>
    <label
      ><span>Throw</span>
      <input type="hidden" value="0" name="attr_throw" />
      <span>+</span>
      <span name="attr_throw"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} throws something!}} {{Throw=[[d20+@{throw}]]}}"
        name="roll_bonus_throw"
      ></button>
    </label>
    <label
      ><span>Pull Punch vs. 11</span>
      <input type="hidden" value="0" name="attr_pull" />
      <span>+</span>
      <span name="attr_pull"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to pull their punch!}} {{target=[[11]]}} {{roll=[[d20+@{pull}]]}}"
        name="roll_bonus_pull"
      ></button>
    </label>
    <label
      ><span>Body Flip/Throw</span>
      <input type="hidden" value="0" name="attr_flipthrow" />
      <span>+</span>
      <span name="attr_flipthrow"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body flip/throw!}} {{Body Flip/Throw=[[d20cs>@{critical}+@{flipthrow}]]}}"
        name="roll_bonus_flipthrow"
      ></button>
    </label>
    <label
      ><span>Body Block/Tackle</span>
      <input type="hidden" value="0" name="attr_tackle" />
      <span>+</span>
      <span name="attr_tackle"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a body block/tackle!}} {{Body Block/Tackle=[[d20cs>@{critical}+@{tackle}]]}}"
        name="roll_bonus_tackle"
      ></button>
    </label>
    <label
      ><span>Tripping/Leg Hook</span>
      <input type="hidden" value="0" name="attr_leghook" />
      <span>+</span>
      <span name="attr_leghook"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a trip/leg hook!}} {{Tripping/Leg Hook=[[d20cs>@{critical}+@{leghook}]]}}"
        name="roll_bonus_leghook"
      ></button>
    </label>
    <label
      ><span>Backward Sweep Kick</span>
      <input type="hidden" value="0" name="attr_backwardsweepkick" />
      <span>+</span>
      <span name="attr_backwardsweepkick"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts a backward sweep kick!}} {{Backward Sweep Kick=[[d20cs>@{critical}+@{backwardsweepkick}]]}}"
        name="roll_bonus_backwardsweepkick"
      ></button>
    </label>
    <hr />
    <label
      ><span>Critical</span>
      <input type="hidden" value="" name="attr_critical" />
      <span></span>
      <span name="attr_critical"></span>
    </label>
    <label
      ><span>Knockout</span>
      <input type="hidden" value="" name="attr_knockout" />
      <span></span>
      <span name="attr_knockout"></span>
    </label>
    <label
      ><span>Death Blow</span>
      <input type="hidden" value="0" name="attr_deathblow" />
      <span></span>
      <span name="attr_deathblow"></span>
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="hidden" value="0" name="attr_damage" />
      <span></span>
      <span name="attr_damage"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus}
        }]]}}"
        name="roll_bonus_damage"
      ></button>
    </label>
    <label
      ><span>Damage: Paired</span>
      <input type="hidden" value="0" name="attr_damage_paired" />
      <span></span>
      <span name="attr_damage_paired"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_paired} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } * [[ {{ @{opt_paired_damage},0 }dl1 } * 1 + 1 ]]
        ]]}}"
        name="roll_bonus_damage_paired"
      ></button>
    </label>
    <label
      ><span>Damage: Main Hand</span>
      <input type="hidden" value="0" name="attr_damage_mainhand" />
      <span></span>
      <span name="attr_damage_mainhand"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_mainhand} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
        ]]}}"
        name="roll_bonus_damage_mainhand"
      ></button>
    </label>
    <label
      ><span>Damage: Off Hand</span>
      <input type="hidden" value="0" name="attr_damage_offhand" />
      <span></span>
      <span name="attr_damage_offhand"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts damage!}} {{Damage=[[@{damage_offhand} + ?{Add damage modifier?|
          None,0|
          Punch,@{mod_punch}|
          P.S. Bonus,@{mod_ps_bonus} } / [[ {{ @{opt_paired_damage},0 }dl1 } * -1 + 2 ]]
        ]]}}"
        name="roll_bonus_damage_offhand"
      ></button>
    </label>
  </div>
  <div class="combat-offense-range bonus-type-container">
    <h3><span>&#x1F52B;</span> Modern/Range <span>&#x1F4A3;</span></h3>
    <label
      ><span>Strike</span>
      <input type="hidden" value="0" name="attr_strike_range" />
      <span>+</span>
      <span name="attr_strike_range"></span>
    </label>
    <label title="1 Action"
      ><span>Strike: Single/Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_single" />
      <span>+</span>
      <span name="attr_strike_range_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a single shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_single} ]]}}"
        name="roll_bonus_strike_range_single"
      ></button>
    </label>
    <label title="1 Action"
      ><span>Strike: Burst</span>
      <input type="hidden" value="0" name="attr_strike_range_burst" />
      <span>+</span>
      <span name="attr_strike_range_burst"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a burst shot!}} {{Range Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_burst} ]]}}"
        name="roll_bonus_strike_range_burst"
      ></button>
    </label>
    <label
      ><span>Strike: Aimed</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed" />
      <span>+</span>
      <span name="attr_strike_range_aimed"></span>
    </label>
    <label title="2 Actions"
      ><span>Strike: Aimed Single</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_single" />
      <span>+</span>
      <span name="attr_strike_range_aimed_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed single shot!}} {{Range Aimed Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_single} ]]}}"
        name="roll_bonus_strike_range_aimed_single"
      ></button>
    </label>
    <label title="2 Actions"
      ><span>Strike: Aimed Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_aimed_pulse" />
      <span>+</span>
      <span name="attr_strike_range_aimed_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed pulse shot!}} {{Range Aimed Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_pulse} ]]}}"
        name="roll_bonus_strike_range_aimed_pulse"
      ></button>
    </label>
    <label
      ><span>Strike: Called</span>
      <input type="hidden" value="0" name="attr_strike_range_called" />
      <span>+</span>
      <span name="attr_strike_range_called"></span>
    </label>
    <label title="2 Actions"
      ><span>Strike: Called Single</span>
      <input type="hidden" value="0" name="attr_strike_range_called_single" />
      <span>+</span>
      <span name="attr_strike_range_called_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called single shot!}} {{Range Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_called_single} ]]}}"
        name="roll_bonus_strike_range_called_single"
      ></button>
    </label>
    <label title="2 Actions"
      ><span>Strike: Called Pulse</span>
      <input type="hidden" value="0" name="attr_strike_range_called_pulse" />
      <span>+</span>
      <span name="attr_strike_range_called_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with a called pulse shot!}} {{Range Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_called_pulse} ]]}}"
        name="roll_bonus_strike_range_called_pulse"
      ></button>
    </label>
    <label title="3 Actions"
      ><span>Strike: Aimed Called Single</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_single"
      />
      <span>+</span>
      <span name="attr_strike_range_aimed_called_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called single shot!}} {{Range Aimed Called Single Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_called_single} ]]}}"
        name="roll_bonus_strike_range_aimed_called_single"
      ></button>
    </label>
    <label title="3 Actions"
      ><span>Strike: Aimed Called Pulse</span>
      <input
        type="hidden"
        value="0"
        name="attr_strike_range_aimed_called_pulse"
      />
      <span>+</span>
      <span name="attr_strike_range_aimed_called_pulse"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} shoots with an aimed called pulse shot!}} {{Range Aimed Called Pulse Strike=[[ d20cs>[[ {{ @{opt_critical},0 }dl1 } * (@{critical}-20) + 20]] + @{strike_range_aimed_called_pulse} ]]}}"
        name="roll_bonus_strike_range_aimed_called_pulse"
      ></button>
    </label>
    <hr />
    <label
      title="Using a gun to shoot a weapon out of an opponent's hand requires a called shot and careful aim (only the gunslinger can shoot to disarm on a quick draw)"
      ><span>Disarm</span>
      <input type="hidden" value="0" name="attr_disarm_range" />
      <span>+</span>
      <span name="attr_disarm_range"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to disarm at range!}} {{Range Disarm=[[d20+@{disarm_range} + ?{Type of shot?|
          No additional bonus,0|
          Called Single (2 Actions),@{strike_range_called_single}|
          Called Pulse (2 Actions),@{strike_range_called_pulse}|
          Aimed Called Single (3 Actions),@{strike_range_aimed_called_single}|
          Aimed Called Pulse (3 Actions),@{strike_range_aimed_called_pulse}|
          Quick Draw Single (1 Action),@{strike_range_single}|
          Quick Draw Pulse (1 Action),@{strike_range_burst}
        }]]}}"
        name="roll_bonus_disarm_range"
      ></button>
    </label>
    <hr />
    <label
      ><span>Damage</span>
      <input type="hidden" value="0" name="attr_damage_range" />
      <span></span>
      <span name="attr_damage_range"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage!}} {{Range Damage=[[@{damage_range}]]}}"
        name="roll_bonus_damage_range"
      ></button>
    </label>
    <label
      ><span>Damage: Single</span>
      <input type="hidden" value="0" name="attr_damage_range_single" />
      <span></span>
      <span name="attr_damage_range_single"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a single shot!}} {{Range Damage=[[@{damage_range_single}]]}}"
        name="roll_bonus_damage_range_single"
      ></button>
    </label>
    <label
      ><span>Damage: Pulse/Burst</span>
      <input type="hidden" value="0" name="attr_damage_range_burst" />
      <span></span>
      <span name="attr_damage_range_burst"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} inflicts range damage from a burst!}} {{Range Damage=[[@{damage_range_burst}]]}}"
        name="roll_bonus_damage_range_burst"
      ></button>
    </label>
  </div>
  <div class="combat-defense bonus-type-container">
    <h3><span>&#x1F6E1;</span> Defense <span>&#x1F977;</span></h3>
    <label
      ><span>Parry</span>
      <input type="hidden" value="0" name="attr_parry" />
      <span>+</span>
      <span name="attr_parry"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to parry!}} {{Parry=[[d20+@{parry}]]}}"
        name="roll_bonus_parry"
      ></button>
    </label>
    <label
      ><span>Dodge</span>
      <input type="hidden" value="0" name="attr_dodge" />
      <span>+</span>
      <span name="attr_dodge"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge!}} {{ Dodge=[[ d20+@{dodge} - @{opt_dodge_penalty} ]] }}"
        name="roll_bonus_dodge"
      ></button>
    </label>
    <label
      ><span>Dodge: Flight</span>
      <input type="hidden" value="0" name="attr_dodge_flight" />
      <span>+</span>
      <span name="attr_dodge_flight"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge in flight!}} {{Dodge in Flight=[[d20+@{dodge_flight} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_flight"
      ></button>
    </label>
    <label
      ><span>Dodge: Auto</span>
      <input type="hidden" value="0" name="attr_dodge_auto" />
      <span>+</span>
      <span name="attr_dodge_auto"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to auto dodge!}} {{Auto Dodge=[[d20+@{dodge_auto} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_auto"
      ></button>
    </label>
    <label
      ><span>Dodge: Teleport</span>
      <input type="hidden" value="0" name="attr_dodge_teleport" />
      <span>+</span>
      <span name="attr_dodge_teleport"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to teleport dodge!}} {{Teleport Dodge=[[d20+@{dodge_teleport} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_teleport"
      ></button>
    </label>
    <label
      ><span>Dodge: Motion</span>
      <input type="hidden" value="0" name="attr_dodge_motion" />
      <span>+</span>
      <span name="attr_dodge_motion"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge while in motion!}} {{Dodge in Motion=[[d20+@{dodge_motion} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_motion"
      ></button>
    </label>
    <label
      ><span>Dodge: Underwater</span>
      <input type="hidden" value="0" name="attr_dodge_underwater" />
      <span>+</span>
      <span name="attr_dodge_underwater"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to dodge underwater!}} {{Dodge Underwater=[[d20+@{dodge_underwater} - @{opt_dodge_penalty} ]]}}"
        name="roll_bonus_dodge_underwater"
      ></button>
    </label>
    <label
      ><span>Roll w/ Impact</span>
      <input type="hidden" value="0" name="attr_roll" />
      <span>+</span>
      <span name="attr_roll"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to roll with impact!}} {{Roll w/ Impact=[[d20+@{roll}]]}}"
        name="roll_bonus_roll"
      ></button>
    </label>
    <label
      ><span>Break Fall</span>
      <input type="hidden" value="0" name="attr_breakfall" />
      <span>+</span>
      <span name="attr_breakfall"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} attempts to break fall!}} {{Break Fall=[[d20+@{breakfall}]]}}"
        name="roll_bonus_breakfall"
      ></button>
    </label>
  </div>
  <div class="bonus-type-container">
    <h3><span>&#x1F340;</span> Saving Throws <span>&#x1FAA6;</span></h3>
    <label
      ><span>Coma/Death</span>
      <input type="hidden" value="0" name="attr_comadeath" />
      <span>+</span>
      <span name="attr_comadeath"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries not to die!}} {{target=[[50+@{comadeath}]]}} {{roll=[[d100]]}}"
        name="roll_bonus_comadeath"
      ></button>
    </label>
    <label
      ><span>Curses vs. 15</span>
      <input type="hidden" value="0" name="attr_curses" />
      <span>+</span>
      <span name="attr_curses"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against being cursed!}} {{target=[[15]]}} {{roll=[[d20+@{curses}+?{Add modifier?|
            None,0|
            Magic,@{magic}|
            Psionics,@{psionics}
          }]]}}"
        name="roll_bonus_curses"
      ></button>
    </label>
    <label
      ><span>Despair</span>
      <input type="hidden" value="0" name="attr_despair" />
      <span>+</span>
      <span name="attr_despair"></span>
      <button
        type="roll"
        value="?{Type of Despair|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. magic despair!&amp;#125;&amp;#125; {{Save vs. Magic Despair=[[d20+@{despair}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to save vs. psionic despair!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{despair}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to save vs. despair!&amp;#125;&amp;#125; {{Save vs. Despair=[[d20+@{despair}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_despair"
      ></button>
    </label>
    <label
      ><span>Disease</span>
      <input type="hidden" value="0" name="attr_disease" />
      <span>+</span>
      <span name="attr_disease"></span>
      <button
        type="roll"
        value="?{Type of Disease|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{Save vs. Magic Disease=[[d20+@{disease}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{disease}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to fight off a disease!&amp;#125;&amp;#125; {{Save vs. Disease=[[d20+@{disease}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_disease"
      ></button>
    </label>
    <label
      ><span>Drugs vs. 15</span>
      <input type="hidden" value="0" name="attr_drugs" />
      <span>+</span>
      <span name="attr_drugs"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against harmful drugs!}} {{target=[[15]]}} {{roll=[[d20+@{drugs}]]}}"
        name="roll_bonus_drugs"
      ></button>
    </label>
    <label
      ><span>Fatigue</span>
      <input type="hidden" value="0" name="attr_fatigue" />
      <span>+</span>
      <span name="attr_fatigue"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to push through the fatigue!}} {{Fatigue=[[d20+@{fatigue}]]}}"
        name="roll_bonus_fatigue"
      ></button>
    </label>
    <label
      ><span>Horror Factor</span>
      <input type="hidden" value="0" name="attr_horrorfactor" />
      <span>+</span>
      <span name="attr_horrorfactor"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against horror factor!}} {{Save vs. Horror Factor=[[d20+@{horrorfactor}]]}}"
        name="roll_bonus_horrorfactor"
      ></button>
    </label>
    <label
      ><span>Illusions</span>
      <input type="hidden" value="0" name="attr_illusions" />
      <span>+</span>
      <span name="attr_illusions"></span>
      <button
        type="roll"
        value="?{Type of Illusion|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the magic illusion!&amp;#125;&amp;#125; {{Save vs. Magic Illusions=[[d20+@{illusions}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to see through the psionic illusion!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{illusions}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to see through the illusion!&amp;#125;&amp;#125; {{Save vs. Illusions=[[d20+@{illusions}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_illusions"
      ></button>
    </label>
    <label
      ><span>Insanity</span>
      <input type="hidden" value="0" name="attr_insanity" />
      <span>+</span>
      <span name="attr_insanity"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against insanity!}} {{target=[[12]]}} {{roll=[[d20+@{insanity}]]}}"
        name="roll_bonus_insanity"
      ></button>
    </label>
    <label
      ><span>Magic</span>
      <input type="hidden" value="0" name="attr_magic" />
      <span>+</span>
      <span name="attr_magic"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to save against magic attack!}} {{Save vs. Magic=[[d20+@{magic}]]}}"
        name="roll_bonus_magic"
      ></button>
    </label>
    <label
      ><span>Maintain Balance</span>
      <input type="hidden" value="0" name="attr_maintainbalance" />
      <span>+</span>
      <span name="attr_maintainbalance"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} tries to stay standing!}} {{Maintain Balance=[[d20+@{maintainbalance}]]}}"
        name="roll_bonus_maintainbalance"
      ></button>
    </label>
    <label
      ><span>Mind Control</span>
      <input type="hidden" value="0" name="attr_mindcontrol" />
      <span>+</span>
      <span name="attr_mindcontrol"></span>
      <button
        type="roll"
        value="?{Type of Mind Control Attack|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off magic mind control!&amp;#125;&amp;#125; {{Save vs. Magic Mind Control=[[d20+@{mindcontrol}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to fight off psionic mind control!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{mindcontrol}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to fight off mind control!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{mindcontrol}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_mindcontrol"
      ></button>
    </label>
    <label
      ><span>Pain</span>
      <input type="hidden" value="0" name="attr_pain" />
      <span>+</span>
      <span name="attr_pain"></span>
      <button
        type="roll"
        value="?{Type of Pain Attack|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the magic pain!&amp;#125;&amp;#125; {{Save vs. Magic Pain=[[d20+@{pain}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to push through the psionic pain!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{pain}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to push through the pain!&amp;#125;&amp;#125; {{Save vs. Pain=[[d20+@{pain}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_pain"
      ></button>
    </label>
    <label
      ><span>Perception</span>
      <input type="hidden" value="0" name="attr_perceptioncheck" />
      <span>+</span>
      <span name="attr_perceptioncheck"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:custom} {{title=@{character_name} looks around carefully &#x1F440;}} {{Perception Check=[[d20+@{perceptioncheck}]]}}"
        name="roll_bonus_perceptioncheck"
      ></button>
    </label>
    <label
      ><span>Poison: Lethal vs. 14</span>
      <input type="hidden" value="0" name="attr_lethalpoison" />
      <span>+</span>
      <span name="attr_lethalpoison"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against lethal poison!}} {{target=[[14]]}} {{roll=[[d20+@{lethalpoison}]]}}"
        name="roll_bonus_lethalpoison"
      ></button>
    </label>
    <label
      ><span>Poison: Non-Lethal vs. 16</span>
      <input type="hidden" value="0" name="attr_nonlethalpoison" />
      <span>+</span>
      <span name="attr_nonlethalpoison"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against non-lethal poison!}} {{target=[[16]]}} {{roll=[[d20+@{nonlethalpoison}]]}}"
        name="roll_bonus_nonlethalpoison"
      ></button>
    </label>
    <label
      ><span>Possession</span>
      <input type="hidden" value="0" name="attr_possession" />
      <span>+</span>
      <span name="attr_possession"></span>
      <button
        type="roll"
        value="?{Type of Possession|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being magically possessed!&amp;#125;&amp;#125; {{Save vs. Magic Possession=[[d20+@{possession}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} tries to prevent being psionically possessed!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{possession}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} tries to prevent being possessed!&amp;#125;&amp;#125; {{Save vs. Possession=[[d20+@{possession}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_possession"
      ></button>
    </label>
    <label
      ><span class="psi-vs"
        >Psionics vs. <span name="attr_global_psionic_ability"></span
      ></span>
      <input type="hidden" value="0" name="attr_psionics" />
      <span>+</span>
      <span name="attr_psionics"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:goe} {{title=@{character_name} tries to save against psionic attack!}} {{target=[[@{psionic_ability}]]}} {{roll=[[d20+@{psionics}]]}}"
        name="roll_save_psionics"
      ></button>
    </label>
    <label
      ><span>Telepathic Probes</span>
      <input type="hidden" value="0" name="attr_telepathicprobes" />
      <span>+</span>
      <span name="attr_telepathicprobes"></span>
      <button
        type="roll"
        value="?{Type of Telepathic Probe|
          Magic,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a magic telepathic probe!&amp;#125;&amp;#125; {{Save vs. Magic Telepathic Probe=[[d20+@{telepathicprobes}+@{magic}]]&amp;#125;&amp;#125;|
          Psionic,
            @{opt_whisper}&{template:goe&amp;#125; {{title=@{character_name} attempts to block a psionic telepathic probe!&amp;#125;&amp;#125; {{target=[[@{psionic_ability}]]&amp;#125;&amp;#125; {{roll=[[d20+@{telepathicprobes}+@{psionics}]]&amp;#125;&amp;#125;|
          Other,
            @{opt_whisper}&{template:custom&amp;#125; {{title=@{character_name} attempts to block a telepathic probe!&amp;#125;&amp;#125; {{Save vs. Mind Control=[[d20+@{telepathicprobes}]]&amp;#125;&amp;#125;
        }"
        name="roll_bonus_telepathicprobes"
      ></button>
    </label>
  </div>
</div>
<br />
<h3>Attributes</h3>
<div class="modifiers-attributes">
  <div class="bonus-type-container attributes">
    <label>
      <span style="grid-column: 3 / -1">Bonuses</span>
    </label>
    <label
      ><span>I.Q.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq"
        title="Intelligence Quotient"
      />
      <span name="attr_mod_iq" title="Intelligence Quotient"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_iq_bonus"
        title="+ Skills %"
      />
      <span name="attr_mod_iq_bonus" title="+ Skills %"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      />
      <span
        name="attr_mod_perception_bonus"
        title="+ Perception (Rifter #13, p.16)"
      ></span>
    </label>
    <label
      ><span>M.E.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_me"
        title="Mental Endurance"
      />
      <span name="attr_mod_me" title="Mental Endurance"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_me_bonus"
        title="+ Save vs. Psionics"
      />
      <span name="attr_mod_me_bonus" title="+ Save vs. Psionics"></span>
    </label>
    <label
      ><span>M.A.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma"
        title="Mental Affinity"
      />
      <span name="attr_mod_ma" title="Mental Affinity"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ma_bonus"
        title="% Trust/Intimidate"
      />
      <span name="attr_mod_ma_bonus" title="% Trust/Intimidate"></span>
    </label>
    <label
      ><span>P.S.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps"
        title="Physical Strength"
      />
      <span name="attr_mod_ps" title="Physical Strength"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_ps_bonus"
        title="+ SDC Damage"
      />
      <span name="attr_mod_ps_bonus" title="+ SDC Damage"></span>
    </label>
    <label
      ><span>P.P.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp"
        title="Physical Prowess"
      />
      <span name="attr_mod_pp" title="Physical Prowess"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      />
      <span
        name="attr_mod_pp_bonus"
        title="+ Strike/Parry/Dodge/Entangle/Disarm"
      ></span>
    </label>
    <label
      ><span>P.E.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe"
        title="Physical Endurance"
      />
      <span name="attr_mod_pe" title="Physical Endurance"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_bonus"
        title="+ Magic/Poison/Toxins"
      />
      <span name="attr_mod_pe_bonus" title="+ Magic/Poison/Toxins"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pe_coma_bonus"
        title="+ Coma/Death %"
      />
      <span name="attr_mod_pe_coma_bonus" title="+ Coma/Death %"></span>
    </label>
    <label
      ><span>P.B.</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb"
        title="Physical Beauty"
      />
      <span name="attr_mod_pb" title="Physical Beauty"></span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_pb_bonus"
        title="% Charm/Impress"
      />
      <span name="attr_mod_pb_bonus" title="% Charm/Impress"></span>
    </label>
    <label
      ><span>Spd</span>
      <input type="hidden" value="0" name="attr_mod_spd" title="Speed" />
      <span name="attr_mod_spd" title="Speed"></span>
    </label>
    <label
      ><span>Spd: Fly</span>
      <input
        type="hidden"
        value="0"
        name="attr_mod_spdfly"
        title="Flying Speed"
      />
      <span name="attr_mod_spdfly" title="Flying Speed"></span>
    </label>
  </div>
  <div class="bonus-type-container">
    <label
      ><span title="Hit Points">H.P.</span
      ><input type="hidden" value="0" name="attr_hp" />
      <span name="attr_hp"></span>
    </label>
    <label
      ><span>S.D.C.</span><input type="hidden" value="0" name="attr_sdc" />
      <span name="attr_sdc"></span>
    </label>
    <label
      ><span>A.R.</span><input type="hidden" value="0" name="attr_ar" />
      <span name="attr_ar"></span>
    </label>
    <label
      ><span>M.D.C.</span><input type="hidden" value="0" name="attr_mdc" />
      <span name="attr_mdc"></span>
    </label>
    <label
      ><span>P.P.E.</span><input type="hidden" value="0" name="attr_ppe" />
      <span name="attr_ppe"></span>
    </label>
    <label
      ><span>I.S.P.</span><input type="hidden" value="0" name="attr_isp" />
      <span name="attr_isp"></span>
    </label>
    <label
      ><span>H.F.</span><input type="hidden" value="0" name="attr_mod_hf" />
      <span name="attr_mod_hf"></span>
    </label>
    <label>
      <span>Spell Strength</span>
      <input type="hidden" value="0" name="attr_mod_spellstrength" />
      <span name="attr_mod_spellstrength"></span>
    </label>
    <label>
      <span>Trust</span>
      <input type="hidden" value="0" name="attr_mod_trust" />
      <span name="attr_mod_trust"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to gain someone's trust}} {{target=[[{@{mod_trust}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_trust"
      ></button>
    </label>
    <label>
      <span>Intimidate</span>
      <input type="hidden" value="0" name="attr_mod_intimidate" />
      <span name="attr_mod_intimidate"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} tries to intimidate someone}} {{target=[[{@{mod_intimidate}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_intimidate"
      ></button>
    </label>
    <label>
      <span>Charm/Impress</span>
      <input type="hidden" value="0" name="attr_mod_charmimpress" />
      <span name="attr_mod_charmimpress"></span>
      <button
        type="roll"
        value="@{opt_whisper}&{template:skill} {{title=@{character_name} uses Charm/Impress}} {{target=[[{@{mod_charmimpress}+?{Modifier?|0},98}kl1]]}} {{roll=[[d100]]}}"
        name="roll_charmimpress"
      ></button>
    </label>
    <label>
      <span>Skill Bonus %</span>
      <input type="hidden" value="0" name="attr_mod_skillbonus" />
      <span name="attr_mod_skillbonus"></span>
    </label>
  </div>
  <div class="bonus-ps-container">
    <label class="select"
      ><span>PS Type</span>
      <input type="hidden" name="attr_mod_character_ps_type" />
      <input type="hidden" name="attr_mod_character_ps_type_name" />
      <span class="twospan2" name="attr_mod_character_ps_type_name"></span>
    </label>
    <label
      ><span>Restrained Punch</span>
      <input type="hidden" name="attr_mod_restrained_punch" value="0" />
      <span name="attr_mod_restrained_punch"></span>
      <input type="hidden" name="attr_mod_restrained_punch_unit" />
      <span name="attr_mod_restrained_punch_unit"></span>
    </label>

    <label
      ><span>Punch</span>
      <input type="hidden" name="attr_mod_punch" value="0" />
      <span name="attr_mod_punch"></span>
      <input type="hidden" name="attr_mod_punch_unit" />
      <span name="attr_mod_punch_unit"></span>
    </label>

    <label
      ><span>Power Punch</span>
      <input type="hidden" name="attr_mod_power_punch" value="0" />
      <span name="attr_mod_power_punch"></span>
      <input type="hidden" name="attr_mod_power_punch_unit" />
      <span name="attr_mod_power_punch_unit"></span>
    </label>

    <label
      ><span>Kick</span>
      <input type="hidden" name="attr_mod_kick" value="0" />
      <span name="attr_mod_kick"></span>
      <input type="hidden" name="attr_mod_kick_unit" />
      <span name="attr_mod_kick_unit"></span>
    </label>

    <label
      ><span>Leap Kick</span>
      <input type="hidden" name="attr_mod_leap_kick" value="0" />
      <span name="attr_mod_leap_kick"></span>
      <input type="hidden" name="attr_mod_leap_kick_unit" />
      <span name="attr_mod_leap_kick_unit"></span>
    </label>

    <label
      ><span>Lift/Carry Weight Multiplier</span>
      <input
        type="hidden"
        value="1"
        name="attr_mod_liftcarry_weight_multiplier"
        value="1"
      />
      <span name="attr_mod_liftcarry_weight_multiplier"></span>
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift/Carry Duration Multiplier</span>
      <input
        type="hidden"
        value="1"
        name="attr_mod_liftcarry_duration_multiplier"
        value="1"
      />
      <span name="attr_mod_liftcarry_duration_multiplier"></span>
      <span>&#x00D7;</span>
    </label>

    <label
      ><span>Lift</span>
      <input type="hidden" value="0" name="attr_mod_lift" value="0" />
      <span name="attr_mod_lift"></span>
      <span>lbs</span>
    </label>

    <label
      ><span>Carry</span>
      <input type="hidden" value="0" name="attr_mod_carry" value="0" />
      <span name="attr_mod_carry"></span>
      <span>lbs</span>
    </label>

    <label
      ><span>Throw (&frac12; Carry)</span>
      <input type="hidden" value="0" name="attr_mod_throw_distance" value="0" />
      <span name="attr_mod_throw_distance"></span>
      <span>Feet</span></label
    >

    <label
      ><span>Carry Max</span>
      <input type="hidden" value="0" name="attr_mod_carry_max" />
      <span name="attr_mod_carry_max"></span>
      <span>Minutes</span>
    </label>

    <label
      ><span>Carry (Running)</span>
      <input type="hidden" value="0" name="attr_mod_carry_running" />
      <span name="attr_mod_carry_running"></span>
      <span>Minutes</span></label
    >

    <label
      ><span>Hold Max.</span>
      <input type="hidden" value="0" name="attr_mod_hold_max" />
      <span name="attr_mod_hold_max"></span>
      <span>Melees</span></label
    >
  </div>

  <div class="bonus-type-container movement">
    <h2>Movement</h2>
    <label><span></span><span>Imperial</span><span>Metric</span></label>
    <label
      ><span>Run/hour</span
      ><input type="hidden" value="0" name="attr_run_mph" />
      <span class="readonly-light">
        <span name="attr_run_mph"></span>
        <span>mph</span>
      </span>
      <input type="hidden" value="0" name="attr_run_kmh" />
      <span class="readonly-light">
        <span name="attr_run_kmh"></span>
        <span>km/h</span>
      </span>
    </label>
    <label
      ><span>Run/melee</span
      ><input type="hidden" value="0" name="attr_run_ft_melee" />
      <span class="readonly-light">
        <span name="attr_run_ft_melee"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_run_m_melee" />
      <span class="readonly-light">
        <span name="attr_run_m_melee"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Run/action</span
      ><input type="hidden" value="0" name="attr_run_ft_action" />
      <span class="readonly-light">
        <span name="attr_run_ft_action"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_run_m_action" />
      <span class="readonly-light">
        <span name="attr_run_m_action"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Fly/hour</span
      ><input type="hidden" value="0" name="attr_fly_mph" />
      <span class="readonly-light">
        <span name="attr_fly_mph"></span>
        <span>mph</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_kmh" />
      <span class="readonly-light">
        <span name="attr_fly_kmh"></span>
        <span>km/h</span>
      </span>
    </label>
    <label
      ><span>Fly/melee</span
      ><input type="hidden" value="0" name="attr_fly_ft_melee" />
      <span class="readonly-light">
        <span name="attr_fly_ft_melee"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_m_melee" />
      <span class="readonly-light">
        <span name="attr_fly_m_melee"></span>
        <span>m</span>
      </span>
    </label>
    <label
      ><span>Fly/action</span
      ><input type="hidden" value="0" name="attr_fly_ft_action" />
      <span class="readonly-light">
        <span name="attr_fly_ft_action"></span>
        <span>ft</span>
      </span>
      <input type="hidden" value="0" name="attr_fly_m_action" />
      <span class="readonly-light">
        <span name="attr_fly_m_action"></span>
        <span>m</span>
      </span>
    </label>
  </div>
</div>
<br />
<label class="description"
  ><b>Description</b>
  <textarea class="full" name="attr_description" value=""></textarea>
</label>
<div class="macro-help">
  <label
    ><span><b>Row ID:</b></span>
    <input type="text" readonly name="attr_rowid" value=""
  /></label>
</div>

                  <!-- endinject -->
                </div>
              </details>
            </fieldset>
          </div>
        </div>
      </div>
    </div>

    <!-- inject:partials/options.html -->
    <div class="r-tab-content">
  <div class="options">
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Welcome to the Rifts Character Sheet on Roll20. Note that whenever you
        see this icon <b>&#9432;</b> it means you can click it and expand the
        row in order to see and input more detail. Get used to this - you will
        use it a lot.
      </p>
      <p>
        Profiles are the key to this sheet. Profiles can consist of any number
        of abilities, magic, psionics, weapons, gear, etc. Anything that can
        mechanically affect your character can be added to a Profile. Some
        examples of Profiles might be:
      </p>
      <ul>
        <li>Walking around town (no armor, no MDC weapons).</li>
        <li>Battle ready in a Glitter Boy.</li>
        <li>
          Prepped for battle with a number of active spells like Armor of Ithan
          and Superhuman Speed.
        </li>
      </ul>
      <p>
        But before you can create a Profile, you need to populate your Combat
        Skills, Abilities, Magic, Psionics, and Modifiers. I'll explain what
        each of those tabs is for (not necessarily in the order they appear in
        the sheet), and then I'll explain the simpler first three tabs - Core,
        Skills, and Equipment.
      </p>
      <h3>Modifiers</h3>
      <p>
        Modifiers are those crunchy bits of Palladium games. Combat bonuses,
        savings throws, attribute bonuses, etc. The sheet makes use of Modifiers
        in a couple of ways.
      </p>
      <ol>
        <li>
          A Modifiers tab lets you add generic modifiers. Some examples of items
          that could be added to the Modifiers tab are:
          <ul>
            <li>A magic amulet that gives a +1 vs. magic.</li>
            <li>
              Boxing, which adds to your PS, attacks, parry, dodge, roll, and
              SDC.
            </li>
            <li>OCC/RCC/Race bonuses.</li>
            <li>An NG-P7 that inflicts 1D4*10 MD.</li>
            <li>
              A vibro-sword daisho with 3D6 MD main hand and 2D6 MD off hand
              swords.
            </li>
          </ul>
          The list goes on. Primarily this section is for static things that
          don't have an off switch. That doesn't mean your character is always
          using these, but they don't require PPE/ISP to activate, and they
          don't increase per level. Every row you add to the Modifiers tab will
          show up in the <span class="picker-title">Modifier Picker</span> (more
          on that later).<br /><br />
        </li>
        <li>
          Modifiers are also a sub-section of Abilities, Magic, and Psionics.
          When you add one of those and expand it, you'll see that the first
          section is dedicated to how the power increases as you level, but the
          section below that is exactly the same as the Modifiers tab. Some
          examples of how you'd use these tabs would be:
          <ul>
            <li>
              Firing a laser beam from your eyes that gives +2 to strike and
              does 1D6 MD per level.
            </li>
            <li>
              A spell like Call Lightning that costs PPE and does increasing
              damage as you level.
            </li>
            <li>
              A spell like Superhuman Speed that costs PPE, provides static
              bonuses, and increases its duration as you level.
            </li>
            <li>
              A Techno-Wizard gun that costs PPE to activate and inflicts a
              static amount of damage.
            </li>
          </ul>
          In these cases, the top section would be used for the per-level values
          (if applicable), and the Modifiers section would be used for the
          static bonuses. If a power has a range (or whatever) that doesn't
          increase per level, just set that value as Starting and leave Per
          Level at 0.
        </li>
      </ol>
      <p>
        On some fields in Modifiers, you'll see this button
        <label class="abs" title="Relative or absolute value"
          ><input type="checkbox" value="1" /><span></span></label
        >. By default, when the "+" is dark, it indicates that the value is to
        be additive. So, for example, if I have a Modifier for a gun that gives
        me +1 to strike, and I have a Weapon Proficiency for that gun, those
        will be added together. However, if I cast Superhuman Speed, it gives me
        an absolute Spd value of of 44. In this case it's not additive - it just
        is the value - so press the button to make the "+" grey/inactive -
        <label class="abs" title="Relative or absolute value"
          ><input type="checkbox" value="1" checked /><span></span></label
        >.
      </p>
      <h3>Abilities, Magic, & Psionics</h3>
      <p>
        As mentioned above, these all contain Modifiers, but each also contains
        some additional fields that are specific to the type of power, though
        all are very similar.
      </p>
      <p>
        In all cases there are fields for range, duration, damage, D.C., and
        skill. Where they differ is that Psionics has an ISP field, Magic has a
        PPE field, and Abilities have a frequency (how often the ability can be
        performed) field. Magic and Psionics also have <button>Cast</button> /
        <button>Use</button> buttons respectively, which will deduct the PPE/ISP
        from your total. The total is pulled from your Active Profile (more on
        that later).
      </p>
      <p>
        Please note that you can track powers here that don't apply any
        Modifiers as well. Magic Pigeon, for example, could be tracked and the
        PPE and duration could be filled in. Because of this, not all powers are
        automatically added to the
        <span class="picker-title">Modifier Picker</span>. If you enter a power
        that <i>does</i> have Modifiers, you should check the box that says
        <label class="addtobonuses"
          ><input type="checkbox" value="1" disabled /> Add to Profiles &rarr;
          <span class="picker-title">Modifier Picker</span></label
        >
        so that it's available to be added to a Profile.
      </p>
      <h3>Combat Skills</h3>
      <p>
        There are 2 main sections on the Combat Skills tab -
        <b>Hand to Hand & RPA Combat</b>, and <b>Weapon Proficiencies</b>. In
        both of these sections just add a new row and select from the list. It
        will auto-calculate the bonuses based on the level of the entry. If
        you're using a Hand to Hand or Weapon Proficiency that isn't part of
        Rifts, just type the name and fill in the bonuses yourself. A couple
        things to make note of if you go the manual route:
      </p>
      <ul>
        <li>You'll need to adjust the bonuses manually as you level up.</li>
        <li>
          Don't name it exactly the same as any of the items in the list, or the
          automatic level calculator will overwrite your changes.
        </li>
        <li>
          Names are not case sensitive, so "W.P. Sword" is the same as "w.p.
          sWORD".
        </li>
      </ul>
      <h3>Profiles</h3>
      <p>
        Here we get to the golden goose. The Profiles tab has 4 sections -
        Active, Armor, Profiles, and Modifier Picker. Unintuitively, I'm going
        to start at the bottom and work my way up.
      </p>
      <h4>Modifier Picker</h4>
      <p>
        The Modifier Picker is where all of the Abilities, Magic, Psionics (that
        you've checked the
        <label class="addtobonuses"
          ><input type="checkbox" value="1" disabled /> Add to Profiles &rarr;
          <span class="picker-title">Modifier Picker</span></label
        >
        checkbox), and Modifiers show up in a list. You pick and choose / mix
        and match various Modifiers to create Profiles.
      </p>
      <h4>Profiles</h4>
      <p>
        Add a Profile and give it a name. Next select some Modifiers from the
        <span class="picker-title">Modifier Picker</span>, and click
        <button>
          Apply
          <span class="picker-title">Picked Modifiers</span>
          &#x2190;</button
        >. This will attach all of the Modifiers have you have selected to the
        current Profile, and add up all of the bonuses.
      </p>
      <p>
        <b
          >Note that when adding new Modifiers to a Profile, it's a good idea to
          wait a few seconds, and then click <button>Refresh &#x27F3;</button>.
          Due to the asynchronous nature of Roll20, sometimes bonuses get
          calculated before attributes (and their associated bonuses) get
          updated.
        </b>
      </p>
      <p>
        If you want to copy a Profile so that you can use it as the baseline for
        a new Profile, click
        <button>
          Replace <span class="picker-title">Picked Modifiers</span> using this
          profile &#x2192;</button
        >. This will check off all of the Modifiers in the
        <span class="picker-title">Modifier Picker</span> that correspond with
        the selected Profile.
      </p>
      <p>
        Setting a Profile as Active makes it appear in the Active section (see
        below for details). If a Profile is already active and you update it in
        some way, press <button>Refresh &#x27F3;</button> to update the data in
        the Active section.
      </p>
      <p>
        PP bonus is added to Strike, Parry, Throw, and all the Dodges. It is
        added to Disarm and Entangle if the option is enabled. Damage adds
        everything together as a rollable field, and prompts to add Punch or PS
        damage. Crit/Knockout/Death Blow use the lowest of the available options
        (ex. Crit: 17 is better than Crit: 19).
      </p>
      <h4>Armor</h4>
      <p>
        Armor is relatively straightforward. Enter as many different armor types
        as you have available, providing Name, Movement Modifier %, and Base
        MDC. Armor stacks, so you can have more than one Active Armor at a time.
        When you enter a value in the Damage field and press
        <button>Apply Damage</button>, that value is subtracted from the first
        Active Armor in the list. If it's already at 0, it will be subtracted
        from the next, and so on. If the last Active Armor is below zero, you're
        dead.
      </p>
      <p>
        Pressing
        <button>Reset MDC</button> will reset the Current MDC to the Base MDC
        value.
      </p>
      <h4>Active</h4>
      <p>
        The Active section shows a consolidated view of your active Profile and
        Armor. This is especially useful for assigning "active_armor_" or
        "active_profile_" attributes to your Token Bar and for use in other
        macros. By referencing the "active_" fields, when you switch Profiles,
        the macros stay the same, but the values update accordingly.
      </p>
      <p>
        The Active Armor shows the armor that last took damage. If it goes below
        zero and there's another Active Armor in the list, the Armor displayed
        in the Active section will change to that one. Note that you can also
        apply/track damage here.
      </p>
      <h3>Core</h3>
      <p>
        The Core tabs is mostly just informational. Attribute bonuses
        auto-calculate, so just enter your attributes without worrying about the
        bonuses. Beneath those, Hit Points through Perception must be entered
        manually, likely as the outcome of some dice rolling. Movement is
        calculated automatically based on the Spd attribute in your Active
        Profile.
      </p>
      <h3>Skills</h3>
      <p>
        Skill Total is calculated automatically. IQ Bonus of your Active Profile
        is added automatically. New skills start at level 1. All skills increase
        in level as your character does, and the total is recalculated. Ex. if
        you select Computer Programming when you're level 1, it will continue to
        match your level as you increase. If at level 3 you select Computer
        Hacking, it will start at level 1, and when you reach level 4, Computer
        Hacking will become level 2. You can adjust individual skill levels
        manually as well - they will always remain the same distance from your
        character level as it changes.
      </p>
      <h3>Equipment</h3>
      <p>
        Just some free-form equipment tracking, with a few fields for different
        currencies. Any gear that modifies your character in any way should be
        tracked in Modifiers or one of the other Powers tabs.
      </p>
      <h3>Options</h3>
      <p>
        This tab. There are a number of options you can select that will affect
        dice rolls, calculations, and other mechanics in the sheet. You can also
        export/import your character in JSON format so that you can easily move
        characters between games.
      </p>
      <p>
        <b>Note that importing a character can take a few minutes.</b> Again,
        due to the asynchronous nature of Roll20, it's difficult to
        programmatically know when the import is complete. The best way to know
        for sure is to open your browser console and wait until no messages have
        appeared for at least 30 seconds to a minute.
      </p>
      <h3>General Info</h3>
      <p>
        Each repeating row includes a read-only Row ID that can be used in
        macros.
      </p>
      <p>
        I intended to have the Description field within
        skills/abilities/magic/psionics to be used for copy/pasting the book
        description so that it's easier for both the player and the GM to find.
        However I've found that this has a tendency to slow down Roll20/the
        browser. So do so at your own risk.
      </p>
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <hr />
    <h3>Options</h3>
    <input type="hidden" name="attr_version" value="1.2.0" />
    <label>Version: <span name="attr_version"></span></label>
    <input type="hidden" name="attr_migrated" value="0" />
    <label>Migrated: <span name="attr_migrated"></span></label>
    <button type="action" name="act_migrate">Migrate</button>

    <label>
      Whisper Rolls to GM?
      <select name="attr_opt_whisper">
        <option value="">Never Whisper Rolls</option>
        <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">
          Query Whisper
        </option>
        <option value="/w gm ">Always Whisper Rolls</option>
      </select>
    </label>
    <label
      ><input type="checkbox" name="attr_debug" value="1" /> View Sheet in Debug
      Mode</label
    >
    <label
      ><input type="checkbox" name=attr_outputusage" value="1" /> Output
      ISP/PPE/Damage usage to chat</label
    >
    <label
      ><input type="checkbox" name=attr_outputarmorwarnings" value="1" /> Show
      Armor warnings when damage is taken on last layer</label
    >
    <hr />
    <label
      ><input
        type="checkbox"
        name="attr_opt_dodge_penalty"
        value="?{Dodging gunfire?|> 50 feet,0|10-50 feet,5|< 10 feet,10}"
      />
      Apply Rifts: Ultimate Edition penalties to dodging gunfire</label
    >
    <p>
      In Rifts: Ultimate Edition, characters are -10 to dodge gunfire at less
      than 10 feet, and -5 between 10 and 50 feet.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_pp_extras" value="1" /> Add PP
      bonus to Disarm and Entangle</label
    >
    <p>
      Add bonus from PP attribute to Disarm and Entangle, in addition to
      Strike/Parry/Dodge.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_iq_perception" value="1" /> Add IQ
      bonus to Perception as per Rifter #13, p.16</label
    >
    <p>
      Rifter #13, p.16 describes a Perception bonus based on IQ. Checking this
      will factor in that bonus.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_paired_damage" value="1" /> Apply
      PS damage to <b>each hand</b> in Paired attack</label
    >
    <p>
      If attacking using paired weapons, checking this will apply any PS
      bonus/Punch damage as applicable to <b>each weapon</b> in a Paired Weapons
      attack. Otherwise the PS damage is applied once to the total of both
      hands. If unchecked, this will also divide the PS damage by 2 when using
      Paired Weapons but only striking with one weapon.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_critical" value="1" /> Apply Hand
      to Hand critical (19-20, 18-20) to modern weapons as well</label
    >
    <p>
      If a character has a critical on 19-20 or 18-20 from their Hand to Hand
      skill, apply this to modern weapons as well.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_iq_bonus" value="1" /> Apply IQ
      bonus to skill-based abilities</label
    >
    <p>
      Adds IQ bonus to abilities/magic/psionic that use a skill-based
      percentage. Some examples include, but are not limited to, Telemechanics,
      Object Read, Locate, etc.
    </p>
    <label
      ><input type="checkbox" name="attr_opt_add_skill" value="1" /> Skill
      Rolls: Add roll to skill %.</label
    >
    <p>
      Instead of trying to roll <b>under</b> your skill %, add your roll to your
      skill % where a success is > 100.
    </p>
    <hr />
    <h3>Import/Export</h3>
    <details>
      <summary><b>Instructions</b></summary>
      <p>
        Click the <b>Export</b> button to get a JSON object representing your
        character. Paste a valid JSON object and click <b>Import</b> to import a
        character.
      </p>
      <p>
        In order to know what the valid fields are, complete all the fields with
        at least one of each repeating section and do an Export.
      </p>
    </details>
    <p>Click <b>Instructions</b> for detailed instructions.</p>
    <button type="action" name="act_import">
      <span></span><span></span><span></span><span></span>
      Import
    </button>
    <button type="action" name="act_export">
      <span></span><span></span><span></span><span></span>
      Export
    </button>
    <!-- <button class="test" type="action" name="act_test">Test</button> -->
    <label>Status: <span name="attr_importexportstatus"></span></label>
    <input type="hidden" name="attr_importexportstatus" />
    <textarea class="full tall" name="attr_importexport"></textarea>
  </div>
</div>

    <!-- endinject -->
  </div>
  <br /><br /><br /><br /><br />

  <!-- .r-tabbed -->
  <input type="hidden" name="attr_prefix" value="@{" />
</main>
<script type="text/worker">
  // Change from javascript to worker before upload

  /* inject:js/async.js */
  function setActiveCharacterId(charId) {
  var oldAcid = getActiveCharacterId();
  var ev = new CustomEvent("message");
  ev.data = { id: "0", type: "setActiveCharacter", data: charId };
  self.dispatchEvent(ev);
  return oldAcid;
}
var _sIn = setInterval;
setInterval = function (callback, timeout) {
  var acid = getActiveCharacterId();
  _sIn(function () {
    var prevAcid = setActiveCharacterId(acid);
    callback();
    setActiveCharacterId(prevAcid);
  }, timeout);
};
var _sto = setTimeout;
setTimeout = function (callback, timeout) {
  var acid = getActiveCharacterId();
  _sto(function () {
    var prevAcid = setActiveCharacterId(acid);
    callback();
    setActiveCharacterId(prevAcid);
  }, timeout);
};
function getAttrsAsync(props) {
  var acid = getActiveCharacterId(); //save the current activeCharacterID in case it has changed when the promise runs
  var prevAcid = null; //local variable defined here, because it needs to be shared across the promise callbacks defined below
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid); //in case the activeCharacterId has changed, restore it to what we were expecting and save the current value to restore later
    try {
      getAttrs(props, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid); //restore activeCharcterId to what it was when the promise first ran
  });
}
//use the same pattern for each of the following...
function setAttrsAsync(propObj, options) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      setAttrs(propObj, options, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}

function getSectionIDsAsync(sectionName) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      getSectionIDs(sectionName, (values) => {
        resolve(values);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}
function getSingleAttrAsync(prop) {
  var acid = getActiveCharacterId();
  var prevAcid = null;
  return new Promise((resolve, reject) => {
    prevAcid = setActiveCharacterId(acid);
    try {
      getAttrs([prop], (values) => {
        resolve(values[prop]);
      });
    } catch {
      reject();
    }
  }).finally(() => {
    setActiveCharacterId(prevAcid);
  });
}

  /* endinject */

  /* inject:js/definitions.js */
  /**
 * Run this function in the console, and modify as needed
 * for other definitions
 */
function getKeysFromH2h() {
  const keys = new Set();
  Object.entries(H2H).forEach(([name, skill]) => {
    skill.forEach((level) => {
      Object.keys(level).forEach((mod) => {
        keys.add(mod);
      });
    });
  });
  console.log(JSON.stringify([...keys]));
}

const H2H = {
  "hand to hand: basic": [
    { attacks: 4, pull: 2, roll: 2 },
    { parry: 2, dodge: 2 },
    { description: "Kick attack does 1D8 points of damage\n" },
    { attacks: 1 },
    { strike: 1, disarm: 1 },
    { critical: 19 },
    { damage: 2 },
    {
      description:
        "Judo-style body flip/throw; does 1D6 damage, and victim loses initiative and one attack\n",
    },
    { attacks: 1 },
    { pull: 2, roll: 2 },
    { parry: 1, dodge: 1 },
    { strike: 1 },
    { description: "Critical Strike or knockout from behind\n" },
    { damage: 2 },
    { attacks: 1 },
  ],
  "hand to hand: expert": [
    { attacks: 4, pull: 2, roll: 2, description: "kick attack 1D8 damage\n" },
    { parry: 3, dodge: 3, pull: 1 },
    { strike: 2, disarm: 2, description: "can perform a Karate Punch\n" },
    { attacks: 1 },
    { description: "Can perform a Karate Kick, does 2D6 damage\n" },
    { critical: 18 },
    {
      description:
        "W.P. Paired Weapons\nbackhand strike (average, does 1D4 damage)\n",
    },
    {
      description:
        "Body flip/throw; does 1D6 damage, and victim loses initiative and one attack\n",
    },
    { attacks: 1, disarm: 1 },
    { damage: 3 },
    { knockout: 18 },
    { parry: 2, dodge: 2 },
    {
      description: "Critical Strike or knockout from behind (triple damage)\n",
    },
    { attacks: 1 },
    { deathblow: 20 },
  ],
  "hand to hand: martial arts": [
    {
      attacks: 4,
      pull: 3,
      roll: 3,
      description:
        "body flip/throw; does ID6 damage, victim loses initiative and one attack\n",
    },
    {
      parry: 3,
      dodge: 3,
      strike: 2,
      description: "may perform Ka­rate and any hand strike/punch\n",
    },
    {
      initiative: 1,
      description:
        "may perform a Karate-style kick (does 2D6 damage) and any foot strike except Leap Kick\n",
    },
    { attacks: 1 },
    {
      entangle: 2,
      description: "Leap Kick (3D8 damage, but counts as two melee attacks)\n",
    },
    { critical: 18 },
    { disarm: 2, description: "W.P. Paired Weapons\ncan perform Holds\n" },
    { description: "Back flip and back flip escape\n" },
    { attacks: 1 },
    { disarm: 2, description: "Back flip attack\n" },
    { damage: 4, initiative: 1 },
    { parry: 2, dodge: 2 },
    { knockout: 18 },
    { attacks: 1 },
    { deathblow: 20 },
  ],
  "hand to hand: assassin": [
    { attacks: 3, strike: 2, description: "W.P. Paired Weapons\n" },
    { initiative: 1, attacks: 2 },
    { pull: 3, roll: 2, description: "Karate Punch (2D4 damage)\n" },
    { damage: 4, initiative: 1, description: "Karate Kick (2D6 damage)\n" },
    { attacks: 1, throw: 1 },
    {
      parry: 3,
      dodge: 3,
      entangle: 2,
      description: "backhand strike (martial arts 1D6)\n",
    },
    {
      knockout: 17,
      description: "leap kick (3D8 damage, but counts as two melee attacks)\n",
    },
    { attacks: 1, strike_range: 1, initiative: 1 },
    { initiative: 1 },
    { critical: 19 },
    {
      strike: 2,
      throw: 1,
      strike_range: 1,
      description: "can perform back flip attack\n",
    },
    { pull: 2, deathblow: 19 },
    { attacks: 1 },
    { damage: 2, description: "can perform Holds\n" },
    { strike: 2, strike_range: 1 },
  ],
  "hand to hand: commando": [
    {
      attacks: 4,
      horrorfactor: 2,
      description: "W.P. Paired Weapons, body flip/throw, body block/tackle\n",
    },
    {
      initiative: 1,
      strike: 1,
      parry: 2,
      dodge: 2,
      roll: 3,
      pull: 3,
      description:
        "Backward sweep kick, used only against opponents coming up behind the character. Does no damage; it is purely a knockdown attack (same penalties as body flip) but cannot be parried (an opponent can try to dodge it but is -2 to do so)\n",
    },
    {
      initiative: 1,
      disarm: 1,
      description: "Karate punch/strike (does 2D4 damage)\n",
    },
    {
      attacks: 1,
      description:
        "Karate kick (does 2D6). The karate-style kick starts with bringing the knee, folded, up to chest level, then the foot is completely extended\n",
    },
    { dodge_auto: 2, description: "Automatic dodge, all foot strikes\n" },
    { initiative: 1, strike: 1, parry: 1, dodge: 1, flipthrow: 1 },
    { damage: 2, horrorfactor: 1, disarm: 1, dodge_auto: 1, pull: 2 },
    { attacks: 1, flipthrow: 2, roll: 1 },
    { deathblow: 18, pull: 2 },
    { horrorfactor: 2, initiative: 1, strike: 1 },
    { disarm: 1, pull: 1, flipthrow: 2 },
    { damage: 2, parry: 1, dodge: 1, dodge_auto: 2 },
    { attacks: 1 },
    { initiative: 1, description: "Can perform holds\n" },
    { critical: 17 },
  ],
  "hand to hand: aikido": [
    {
      attacks: 4,
      breakfall: 3,
      roll: 2,
      flipthrow: 2,
      pull: 2,
      mod_pp: 1,
      mod_pe: 1,
      description: "+2D6 S.D.C., +1D4 to M.E.\n",
    },
    { initiative: 1, parry: 2, dodge: 2 },
    { disarm: 1, description: "Automatic dodge\n" },
    { attacks: 1, flipthrow: 1 },
    {
      description:
        "Critical body flip/throw on Natural 18-20 (double damage)\n",
    },
    { parry: 1, dodge: 1, flipthrow: 1 },
    { pull: 2, description: "Automatic flip/throw\n" },
    { attacks: 1 },
    { initiative: 1, strike: 1, parry: 1, dodge: 1 },
    { disarm: 1, description: "Double existing P.P.E. (inner spirit)\n" },
    { parry: 1, dodge: 2, flipthrow: 1 },
    { attacks: 1 },
    { initiative: 1, tackle: 2 },
    { critical: 18 },
    { attacks: 1 },
  ],
  "hand to hand: judo": [
    {
      attacks: 4,
      roll: 3,
      pull: 3,
      mod_me: 1,
      mod_pp: 1,
      description:
        "+2D4 S.D.C.\nBody block/tackle, body flip/throw, break fall, disarm, roll with punch/fall/impact, strike, parry, dodge, and pull punch are available at first level.\n",
    },
    { parry: 2, dodge: 2, strike: 1 },
    { flipthrow: 1, tackle: 1, disarm: 1 },
    { attacks: 1, description: "Karate-style kick (2D6 damage).\n" },
    { critical: 19 },
    { strike: 1, parry: 1, dodge: 1, flipthrow: 1 },
    { damage: 2, description: "W.P. Paired Weapons\n" },
    { roll: 1, description: "Jump kick\n" },
    { attacks: 1 },
    { initiative: 2, parry: 1, dodge: 1 },
    { breakfall: 1, disarm: 1 },
    { critical: 18 },
    { damage: 2, knockout: 19 },
    { attacks: 1 },
    { description: "Automatic body flip/throw.\n" },
  ],
  "hand to hand: jujitsu": [
    {
      mod_ps: 2,
      mod_pp: 1,
      attacks: 4,
      roll: 3,
      parry: 2,
      dodge: 2,
      pull: 2,
      description:
        "+3D6 S.D.C.\nsnap kick (1D6 damage), knife hand (2D4 damage)\nMaintain balance, break fall, disarm, body block/tackle, body flip/throw, holds, roll with punch/fall/impact, pull punch, kick attack (2D4 damage), knee and elbow strikes (1D6 damage), and the usual strike, parry and dodge.\n",
    },
    { strike: 1, leghook: 1, backwardsweepkick: 1 },
    { initiative: 1, description: "Critical strike from behind.\n" },
    { attacks: 1, damage: 2 },
    { description: "Palm strike (2D4 damage) and drop kick.\n" },
    { critical: 18 },
    { strike: 1, flipthrow: 1, disarm: 1 },
    { attacks: 1, maintainbalance: 1 },
    { description: "Critical body flip/throw on natural 1 7-20.\n" },
    { description: "Jump kick and leap attacks.\n" },
    { attacks: 1, pull: 2 },
    { initiative: 1, parry: 1, dodge: 1, strike: 1 },
    { damage: 2, pull: 2, breakfall: 2 },
    { attacks: 1 },
    { description: "Death blow!\n" },
  ],
  "hand to hand: karate": [
    {
      mod_pe: 2,
      mod_spd: 2,
      attacks: 4,
      initiative: 1,
      roll: 2,
      parry: 2,
      dodge: 1,
      breakfall: 1,
      pull: 2,
      description:
        "+3D6 S.D.C., +1D4 to P.S.\nBreak fall, body block/tackle, roll with punch/fall/impact, pull punch, kick at­tack (2D4 damage), karate kick (2D6 damage), karate punch (2D4 damage), knees and elbow strikes (1D6 damage), and the usual strike, parry and dodge.\n",
    },
    { strike: 1, leghook: 1, backwardsweepkick: 1 },
    { attacks: 1, damage: 2 },
    {
      initiative: 1,
      disarm: 1,
      description: "roundhouse kick (3D6 damage).\n",
    },
    { description: "Power punch and palm strike (2D4 damage).\n" },
    { attacks: 1, pull: 2 },
    {
      strike: 1,
      parry: 1,
      breakfall: 1,
      description: "Power kick, wheel kick\n",
    },
    {
      critical: 18,
      deathblow: 20,
      description: "critical strike from behind.\n",
    },
    { attacks: 1, damage: 2 },
    { description: "Jump kick and leap attacks.\n" },
    { initiative: 1, parry: 1, dodge: 1, strike: 1 },
    { attacks: 1, pull: 2 },
    { description: "Death Blow!\n" },
    { damage: 2, pull: 2, breakfall: 2 },
    { attacks: 1 },
  ],
  "hand to hand: kendo": [
    {
      mod_ps: 1,
      mod_pp: 1,
      mod_spd: 2,
      attacks: 4,
      initiative: 1,
      roll: 2,
      disarm: 1,
      parry: 1,
      dodge: 1,
      breakfall: 1,
      pull: 2,
      description:
        "+2D4 S.D.C.\n+2 to parry with sword or staff (in addition to W.P. bonuses)\nDisarm, break fall, roll with punch/fall/impact, pull punch, karate punch (2D4 damage), kick attack (2D4), knees and elbow strikes (1D6 damage), and the usual strike, parry and dodge.\n",
    },
    { strike: 1, description: "W.P. Paired Weapons\n" },
    { attacks: 1, damage: 2 },
    { initiative: 1, disarm: 1, parry: 1 },
    { description: "Tripping/leg hook and backward sweep kicks.\n" },
    { description: "Power punch and palm strike (2D4 damage).\n" },
    { attacks: 1, pull: 2 },
    {
      critical: 18,
      deathblow: 19,
      description: "critical strike from behind\n",
    },
    { attacks: 1, damage: 4 },
    { description: "Automatic dodge.\n" },
    { initiative: 1, strike: 1, breakfall: 2 },
    { attacks: 1, pull: 2 },
    { description: "Jump kick and leap attacks.\n" },
    { description: "Death Blow!\n" },
    { attacks: 1 },
  ],
  "hand to hand: ninjitsu": [
    {
      mod_ma: 2,
      mod_ps: 1,
      mod_pe: 1,
      mod_pp: 1,
      mod_spd: 4,
      attacks: 4,
      roll: 2,
      initiative: 2,
      parry: 1,
      dodge: 2,
      pull: 2,
      description:
        "snap kick (1D6 dam­age), knife hand (2D4 damage)\nW.P. Paired Weapons\nMaintain balance, back flip, body block/tackle, body flip/throw, holds, roll with punch/fall/impact, pull punch, drop kick, kick attack (2D4 damage), knee and elbow strikes (1D6 damage), paired weapons, and the usual strike, parry and dodge. Also see Samurai Hand to Hand combat.",
    },
    {
      strike: 1,
      description:
        "cartwheel (attack), back flip (escape), back flip (defensive), and back flip (attack).\n",
    },
    { attacks: 1, description: "palm strike (2D4 damage).\n" },
    {
      description:
        "Leap attack, axe kick, and +2 to strike when performing any backflip or cartwheel.\n",
    },
    { description: "Tripping/leg hook and backward sweep kicks\n", damage: 2 },
    { attacks: 1, description: "roundhouse kick (3D6).\n" },
    { critical: 18, deathblow: 20, description: "Critical from behind.\n" },
    { initiative: 1, strike: 1, parry: 1, roll: 1, maintainbalance: 2 },
    { description: "Death Blow!\n" },
    { attacks: 1, pull: 2 },
    { description: "Double existing P.P.E. (inner spirit)!\n" },
    { initiative: 1, roll: 2 },
    { damage: 2, disarm: 1 },
    { damage: 2, description: "Jump kick, +2 to back flip/cartwheel\n" },
    { attacks: 1 },
  ],
  "hand to hand: samurai": [
    {
      mod_me: 2,
      mod_pp: 2,
      mod_pe: 1,
      attacks: 4,
      initiative: 2,
      roll: 2,
      dodge: 3,
      damage: 2,
      pull: 2,
      description:
        "+3D6 S.D.C.\n+2 to parry with sword or staff (in addition to W.P. bonuses)\nDisarm, maintain balance, roll with punch/fall/im­ pact, pull punch, Karate punch (2D4 damage), kick attack (2D4), knee and elbow strikes (1D6 damage), and the usual strike, parry and dodge.\n",
    },
    { attacks: 1, disarm: 1, maintainbalance: 1 },
    {
      initiative: 1,
      strike: 1,
      parry: 1,
      deathblow: 20,
      description: "critical strike from behind\n",
    },
    { attacks: 1, damage: 2 },
    { critical: 18, maintainbalance: 1 },
    { roll: 1, dodge: 1, maintainbalance: 1 },
    {
      description:
        "Power punch/stab (with hand or sword), jump kick and backward sweep kick.\n",
    },
    { attacks: 1, dodge: 1 },
    { description: "Death Blow!\n" },
    { initiative: 1, horrorfactor: 1, maintainbalance: 1 },
    { attacks: 1 },
    {
      damage: 2,
      horrorfactor: 1,
      description:
        'the knowledge and skill to create a "true" samurai sword.\n',
    },
    { attacks: 1 },
    { disarm: 1, description: "Double existing P.P.E. (inner spirit)\n" },
    { attacks: 1 },
  ],
  "hand to hand: teng-jutsu": [
    {
      attacks: 4,
      dodge: 2,
      pull: 2,
      disarm: 1,
      roll: 1,
      maintainbalance: 3,
      breakfall: 1,
      description:
        "Break fall, roll with punch/fall/impact, maintain balance, back flip escape, back flip attack, cartwheel (attack), body block/tackle, pull punch, kick attack (2D4 damage), karate kick (2D6 damage), karate punch (2D4 damage), knees and elbow strikes (1D6 damage), and the usual strike, parry and dodge, plus the Tengu special mystic martial art powers.\n",
    },
    {
      initiative: 1,
      description: "Drop kick, +2 on all back flips.\n",
    },
    { strike: 1, disarm: 1, description: "+1 to leap dodge." },
    { attacks: 1 },
    {
      description:
        "Critical strike from all kicks (double damage) and jump kick and leap attacks.\n",
    },
    { roll: 1, pull: 2, description: "+ 1 to leap dodge.\n" },
    {
      initiative: 1,
      description: "tripping/leg hook and backward sweep kicks.\n",
    },
    { attacks: 1 },
    {
      disarm: 2,
      description: "+1 on all back flips, and +1 on cartwheel attack.\n",
    },
    { initiative: 1, parry: 1, description: "Axe kick\n" },
    { attacks: 1 },
    { disarm: 1, description: "+1 to leap dodge\n" },
    { description: "Snap kick and wheel kick.\n" },
    { pull: 1, description: "+1 to leap dodge\n" },
    { attacks: 1 },
  ],
  "hand to hand: drunken style kung fu": [
    {
      attacks: 3,
      roll: 2,
      knockout: 19,
      critical: 19,
      description:
        "Drunken Style Foot Play\nDrunken Style Controlled Staggering\n+2 to somersault/stagger/roll/backflip\nCritical Strike from behind\n",
    },
    {
      dodge: 2,
      dodge_auto: 2,
      pull: 2,
    },
    { strike: 1, initiative: 1 },
    { description: "Faked Alcohol Sickness\n" },
    { attacks: 1 },
    { strike: 1 },
    { disarm: 2, entangle: 2 },
    { description: "Projectile Vomit\n" },
    { attacks: 1 },
    { roll: 2, pull: 1 },
    { description: "Joint Twisting\n" },
    { dodge: 1, dodge_auto: 1, strike: 1 },
    { roll: 2, pull: 1 },
    { attacks: 1 },
    { damage: 1, knockout: 17 },
  ],
  "hand to hand: dragon": [
    {
      attacks: 3,
      roll: 2,
      pull: 1,
      description:
        "Instinctively knows the following attack types: Bite, punch, kick, Claw Swipe, and standard use of breath weapon (counts as one melee attack). Dragon metamor­phosis takes one full melee (15 seconds).\n",
    },
    {
      parry: 2,
      dodge: 2,
      description: "Tail Slap, Wing At­tack: Basic, and Crush\n",
    },
    {
      damage: 2,
      description:
        "Dragon metamorphosis takes half a melee round (7 sec­onds), and Tail Slap Power Strike\n",
    },
    { attacks: 1, description: "Bite & Grip, and Tail Sweep\n" },
    { strike: 1, parry: 1, dodge_flight: 2, description: "Tail Parry\n" },
    {
      mod_spellstrength: 1,
      description: "gains the Wing Sweep and Grappling Hold.\n",
    },
    { disarm: 2, entangle: 2, pull: 2, description: "Wing Attack: Advanced\n" },
    {
      attacks: 1,
      strike: 1,
      parry: 1,
      dodge_flight: 1,
      description: "Wing Gliding Sweep Attack\n",
    },
    {
      roll: 1,
      pull: 1,
      description:
        "Gains Breath Weapon Concentrated Beam, and an additional +5% to Dimensional Teleport (a natural ability).\n",
    },
    { initiative: 1, critical: 19, description: "Teleport Dodge\n" },
    { damage: 2, dodge_flight: 2, mod_spellstrength: 1 },
    { attacks: 1, strike: 1, dodge_teleport: 1 },
    { initiative: 1, description: "Breath Weapon Cone\n" },
    { dodge_teleport: 1, pull: 1 },
    { mod_spellstrength: 1, description: "+ 1D4x10 to M.D.C\n" },
    { attacks: 1, damage: 2 },
    { dodge_teleport: 1, dodge_flight: 1 },
    { strike: 1, parry: 1, description: "+ 1 to Spell Strength\n" },
    {
      dodge_teleport: 1,
      disarm: 1,
      roll: 1,
      description: "+1D4x10 to physical M.D.C.\n",
    },
    { attacks: 1 },
  ],
  "rpa combat: basic": [
    {
      attacks: 1,
      strike: 1,
      parry: 1,
      dodge: 1,
      roll: 1,
      description:
        "Power Armor Body Block/Tackle/Ram: 1D4 M.D. plus a 01-50% chance of knocking an opponent down, causing him to lose initiative and one melee attack/action. Counts as two of the power armor's melee attacks.\n" +
        "Robot Body Block/Tackle/Ram: M.D. equal to Robot Punch M.D. plus a 01-60% chance of knocking down an opponent that is approxi­ mately the same size or larger. Increase the odds of knocking down an opponent that is half the size or smaller than the robot to 0 1 -80%. The victim suffers M.D. and loses initiative and two melee attacks/actions. Counts as two ofthe robot's melee attacks.\n",
    },
  ],
  "rpa combat: flying power armor": [
    {
      attacks: 1,
      initiative: 2,
      strike_range: 2,
      strike: 2,
      parry: 2,
      dodge: 2,
      dodge_flight: 5,
      disarm: 2,
      pull: 3,
      roll: 4,
      description:
        "Punch Damage: As per Robot (or Augmented) P.S.\nPower Punch: Double damage, but counts as two melee attacks. Tear or Pry with Hands: 1D4 M.D.\nKick Damage: As per Robot (or Augmented) P.S.\nBody B1ock/Ram: Equal to the Robot P.S. punch damage.\nFull Speed Running Ram: Double Robot P.S. punch damage, plus 01-60% likelihood of knocking an opponent off his feet if the opponent is the same size or smaller (reduce by half if twice as big). Victim takes M.D. and is knocked off his feet, losing initiative and two melee at­tacks/actions.\n",
    },
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
  ],
  "rpa combat: ground-based power armor": [
    {
      attacks: 1,
      initiative: 1,
      strike_range: 2,
      strike: 3,
      parry: 2,
      dodge: 2,
      disarm: 3,
      pull: 3,
      roll: 2,
      description:
        "Punch Damage: As per Robot (or Augmented) P.S.\nPower Punch: Double damage, but counts as two melee attacks.\nTear or Pry with Hands: 1D4 M.D.\nKick Damage: As per Robot (or Augmented) P.S.\nBody B1ock/Ram: Equal to the Robot P.S. punch damage.\nFull Speed Running Ram: Double Robot P.S. punch damage, plus 01-50% likelihood of knocking an opponent off his feet if the opponent is the same size or smaller (reduce by half if twice as big). Victim takes M.D. and is knocked off his feet, losing initiative and two melee at­tacks/actions.\n",
    },
    {},
    { attacks: 1 },
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    { attacks: 1 },
  ],
  "rpa combat: heavy vehicular style robots": [
    {
      attacks: 1,
      initiative: 1,
      strike_range: 3,
      strike: 1,
      parry: 1,
      dodge: 1,
      dodge_motion: 2,
      roll: 1,
      description:
        "Punch/Kick Damage: As per Robot P.S.\n" +
        "Power Punch/Kick: Double damage, but counts as two melee attacks.\n" +
        "Kick Damage: As per Robot P.S.\n" +
        "Body Block/Ram: Equal to the Robot P.S. punch damage.\n" +
        "Full Speed Running Ram: Triple the Robot P.S. punch damage, plus 01-80% likelihood of knocking opponent off his feet if the opponent is the same size or smaller. Victim takes M.D. and is knocked off his feet, losing initiative and two melee attacks/actions.\n" +
        "Stomp: 1D6 M.D.; effective only against objects smaller than one third the robot's total height.\n",
    },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
  ],
  "rpa combat: heavy ground robots": [
    {
      attacks: 1,
      initiative: 1,
      strike_range: 1,
      strike: 2,
      parry: 3,
      dodge: 1,
      dodge_motion: 2,
      disarm: 1,
      pull: 2,
      roll: 3,
      description:
        "Punch Damage: As per Robot P.S.\n" +
        "Power Punch: Double damage, but counts as two melee attacks.\n" +
        "Tear or Pry with Hands: 1D6 M.D.\n" +
        "Kick Damage: As per Robot P.S.\n" +
        "Body Block/Ram: Equal to the Robot P.S. punch damage.\n" +
        "Full Speed Running Ram: Double the Robot P.S. punch damage, plus 01-85% likelihood of knocking opponent off his feet if the opponent is the same size or smaller. Victim takes M.D. and is knocked off his feet, losing initiative and two melee attacks/actions.\n" +
        "Stomp: 1D6 M.D.; effective only against objects smaller than one third the robot's total height.\n",
    },
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    { attacks: 1 },
  ],
  "rpa combat: light ground robots": [
    {
      attacks: 1,
      initiative: 2,
      strike_range: 1,
      strike: 3,
      parry: 3,
      dodge: 2,
      dodge_motion: 3,
      disarm: 2,
      pull: 4,
      roll: 4,
      description:
        "Punch Damage: As per Robot P.S.\n" +
        "Power Punch: Double damage, but counts as two melee attacks.\n" +
        "Tear or Pry with Hands: 1D4 M.D.\n" +
        "Kick Damage: As per Robot P.S.\n" +
        "Body Block/Ram: Equal to the Robot P.S. punch damage.\n" +
        "Full Speed Running Ram: Double the Robot P.S. punch damage, plus 01-70% likelihood of knocking opponent off his feet if the opponent is the same size or smaller. Victim takes M.D. and is knocked off his feet, losing initiative and two melee attacks/actions.\n" +
        "Stomp: 1D4 M.D.; effective only against objects smaller than one third the robot's total height.\n",
    },
    {},
    { attacks: 1 },
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
  ],
  "rpa combat: glitter boy": [
    {
      attacks: 2,
      initiative: 2,
      strike_range: 2,
      strike: 2,
      parry: 2,
      dodge: 2,
      disarm: 1,
      pull: 4,
      roll: 3,
      description:
        "Punch Damage: 1D4 M.D. on a restrained punch, 1D6 M.D. on a full strength punch.\n" +
        "Power Punch: 2D6 M.D., but counts as two melee attacks.\n" +
        "Kick Damage: 2D4 M.D., Power Kick is not possible.\n" +
        "Running Leap Kick: 4D6 M.D., but counts as three attacks.\n" +
        "Tear or Pry with Hands (Special): 1D6 M.D.\n" +
        "Body BlocklRam: 2D4 M.D.\n" +
        "Full Speed Running Ram: 3D6 M.D., but this attack uses up three melee actions.\n" +
        "Stomp: 1D6 M.D.; effective only against objects smaller than three feet (0.9 m) tall.\n" +
        "Pylon Impalement: 1D6 M.D., not very useful in most combat situa­tions.\n",
    },
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
  ],
  "rpa combat: silverhawk": [
    {
      strike: 2,
      parry: 4,
      dodge: 4,
      dodge_flight: 6,
      roll: 3,
      pull: 2,
      attacks: 2,
      description:
        "Restrained Punch - 1D6 M.D.\n" +
        "Full Strength Punch - 3D6 M.D.\n" +
        "Power Punch - 6D6 M.D. (counts as two attacks) Kick - 4D6 M.D.\n" +
        "Leap Kick - 6D6 +3 (counts as two attacks) Body Block/Ram (on the ground) - 2D6 M.D.\n" +
        "Body Block/Ram (flying) - 4D6 M.D.\n",
    },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
  ],
  "rpa combat: battleram": [
    {
      strike: 1,
      parry: 1,
      dodge_flight: 1,
      description:
        "Restrained Punch - 4D6 M.D.\n" +
        "Full Strength Punch - 2D6x10 M.D.\n" +
        "Power Punch - 4D6x10 M.D. (counts as two attacks)\n" +
        "Crush, Pry or Tear - 2D6x10 M.D.\n" +
        "Kick - 3D4x10 M.D.\n" +
        "Leap Kick (only while flying) - 4D6x10 M.D.\n" +
        "Body Flip/Throw - 4D6 M.D.\n" +
        "Body BlocklRam (on the ground ) - 2D4x10 M.D.\n" +
        "Flying Ram - 5D6x10 M.D.\n" +
        "Stomp - 6D6 M.D. against targets 15 feet (4.5 m) tall or smaller.\n",
    },
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    { attacks: 1 },
    {},
  ],
  "rpa combat: bombard": [
    {
      strike: 2,
      parry: 4,
      dodge: 2,
      roll: 3,
      pull: 4,
      attacks: 2,
      description:
        "Restrained Punch - 1D6 M.D.\n" +
        "Full Strength Punch - 2D6 M.D.\n" +
        "Power Punch - 4D6 M.D. (counts as two attacks) Vibro-blade - 4D6 M.D.\n" +
        "Crush, Pry or Tear - 1D6 M.D.\n" +
        "Kick - 2D6 M.D.\n" +
        "Body Flip/Throw - 1D6 M.D.\n" +
        "Body Block/Ram - 2D4 M.D.\n" +
        "Stomp - 2D4 M.D. against man-sized targets\n",
    },
    {},
    {},
    { attacks: 1 },
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
  ],
  "space fighter: basic": [
    {
      attacks: 1,
      strike_range: 2,
      dodge_flight: 3,
      description:
        "+1 to dog-fighting rolls\n" +
        "Critical strike, same as pilot's hand to hand.\n",
    },
    {},
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
  ],
  "space fighter: elite": [
    {
      attacks: 2,
      strike_range: 2,
      dodge_flight: 5,
      description:
        "+3 to dog-fighting rolls\n" +
        "Critical strike, same as pilot's hand to hand.\n",
    },
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    { attacks: 1 },
    {},
    {},
    {},
    {},
    {},
  ],
};

const H2H_KEYS = [
  "name",
  "levelacquired",
  "level",
  "attacks",
  "pull",
  "roll",
  "breakfall",
  "parry",
  "dodge",
  "description",
  "strike",
  "disarm",
  "critical",
  "damage",
  "knockout",
  "deathblow",
  "initiative",
  "entangle",
  "throw",
  "strike_range",
  "horrorfactor",
  "dodge_auto",
  "flipthrow",
  "tackle",
  "leghook",
  "backwardsweepkick",
  "maintainbalance",
  "dodge_flight",
  "dodge_teleport",
  "dodge_motion",
  "mod_spellstrength",
  "mod_me",
  "mod_ma",
  "mod_ps",
  "mod_pp",
  "mod_pe",
  "mod_spd",
];

const WP = {
  "w.p. archery": [
    { strike: 1, parry: 1, rof: 2 },
    { strike: 1, disarm: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    { disarm: 1, rof: 1 },
    { strike: 1 },
    {},
    { strike: 1, rof: 1 },
    {},
    { strike: 1, disarm: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    {},
    { strike: 1, rof: 1 },
    { disarm: 1 },
  ],
  "w.p. axe": [
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
  ],
  "w.p. bayonet": [
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    {},
  ],
  "w.p. blunt": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    { throw: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    {},
    { throw: 1 },
  ],
  "w.p. chain": [
    { strike: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    {},
  ],
  "w.p. forked": [
    { strike: 1, parry: 1, entangle: 1 },
    {},
    { strike: 1, parry: 1, entangle: 1 },
    { throw: 1 },
    { strike: 1, entangle: 1 },
    { parry: 1 },
    {},
    { strike: 1, entangle: 1 },
    {},
    { parry: 1, throw: 1 },
    { strike: 1, entangle: 1 },
    {},
    { strike: 1, parry: 1, entangle: 1 },
    {},
    { throw: 1 },
  ],
  "w.p. knife": [
    { parry: 1, throw: 1 },
    { strike: 1 },
    { parry: 1, throw: 1 },
    { strike: 1 },
    {},
    { parry: 1, throw: 1 },
    { strike: 1 },
    { throw: 1 },
    { parry: 1 },
    { strike: 1, throw: 1 },
    {},
    { parry: 1 },
    { strike: 1, throw: 1 },
    {},
    {},
  ],
  "w.p. grappling hook": [
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    { strike: 1, entangle: 1 },
    {},
    {},
    {},
  ],
  "w.p. pole arm": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    { strike: 1, parry: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    {},
  ],
  "w.p. rope": [
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    {},
    { strike: 1 },
    {},
    {},
    {},
    { strike: 1 },
    {},
    {},
    {},
    { strike: 1 },
    {},
    {},
    { strike: 1 },
  ],
  "w.p. shield": [
    { parry: 1 },
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    {},
    { parry: 1 },
    { strike: 1 },
    {},
    { parry: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    {},
  ],
  "w.p. spear": [
    { strike: 1, parry: 1 },
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1, throw: 1 },
    {},
    {},
    { strike: 1, parry: 1 },
    { throw: 1 },
    {},
    { strike: 1, parry: 1 },
    {},
    { throw: 1 },
    {},
  ],
  "w.p. staff": [
    { strike: 1 },
    { parry: 1 },
    { strike: 1 },
    {},
    { parry: 1, throw: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1, throw: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    { throw: 1 },
  ],
  "w.p. sword": [
    { strike: 1 },
    { parry: 1 },
    { strike: 1 },
    { parry: 1, throw: 1 },
    {},
    { strike: 1 },
    { parry: 1 },
    { throw: 1 },
    { strike: 1 },
    { parry: 1 },
    {},
    { strike: 1, throw: 1 },
    { parry: 1 },
    {},
    { strike: 1 },
  ],
  "w.p. targeting": [
    { throw: 1 },
    {},
    { throw: 1 },
    {},
    {},
    {},
    { throw: 1 },
    {},
    {},
    { throw: 1 },
    {},
    {},
    {},
    {},
    {},
  ],
  "w.p. whip": [
    {},
    { strike: 1, entangle: 1, disarm: 1, damage: 1 },
    {},
    { strike: 1, entangle: 1, disarm: 1, damage: 1 },
    {},
    {},
    { strike: 1, entangle: 1, disarm: 1 },
    { damage: 1 },
    {},
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    { damage: 1 },
    { strike: 1, entangle: 1, disarm: 1 },
    {},
    {},
  ],
  "w.p. handguns": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. rifles": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    {},
  ],
  "w.p. energy heavy": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
  ],
  "w.p. energy pistol": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
  "w.p. energy rifle": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. heavy": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. speargun": [
    {},
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1 },
  ],
  "w.p. shotgun": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
  ],
  "w.p. submachinegun": [
    { strike_range_single: 1 },
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
  "w.p. flamethrower": [
    {},
    { strike_range_single: 1 },
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1 },
    {},
    {},
    {},
    {},
    { strike_range_single: 1, strike_range_burst: 1 },
  ],
};

const WP_KEYS = {
  wp: [
    "name",
    "levelacquired",
    "level",
    "strike",
    "parry",
    "disarm",
    "rof",
    "throw",
    "entangle",
  ],
  wpmodern: [
    "name",
    "levelacquired",
    "level",
    "strike_range_single",
    "disarm",
    "strike_range_burst",
  ],
};

const ATTRIBUTE_KEYS = [
  "mod_iq",
  "iq_abs",
  "mod_iq_bonus",
  "mod_perception_bonus",
  "mod_me",
  "mod_me_bonus",
  "me_abs",
  "mod_ma",
  "mod_ma_bonus",
  "ma_abs",
  "mod_ps",
  "mod_ps_bonus",
  "ps_abs",
  "mod_pp",
  "mod_pp_bonus",
  "pp_abs",
  "mod_pe",
  "mod_pe_bonus",
  "mod_pe_coma_bonus",
  "pe_abs",
  "mod_pb",
  "mod_pb_bonus",
  "pb_abs",
  "mod_spd",
  "spd_abs",
  "mod_spdfly",
  "spdfly_abs",
  "mod_character_ps_type",
  "mod_character_ps_type_name",
  "mod_restrained_punch",
  "mod_restrained_punch_unit",
  "mod_punch",
  "mod_punch_unit",
  "mod_power_punch",
  "mod_power_punch_unit",
  "mod_kick",
  "mod_kick_unit",
  "mod_leap_kick",
  "mod_leap_kick_unit",
  "mod_liftcarry_weight_multiplier",
  "mod_liftcarry_duration_multiplier",
  "mod_lift",
  "mod_carry",
  "mod_throw_distance",
  "mod_carry_max",
  "mod_carry_running",
  "mod_hold_max",
  "hp",
  "sdc",
  "ar",
  "mdc",
  "ps_type",
  "ppe",
  "isp",
  "mod_hf",
  "hf_abs",
  "mod_spellstrength",
  "spellstrength_abs",
  "mod_trust",
  "trust_abs",
  "mod_intimidate",
  "intimidate_abs",
  "mod_charmimpress",
  "charmimpress_abs",
  "mod_skillbonus",
];

const COMBAT_KEYS = [
  // "selection_id",
  "name",
  "level",
  "attacks",
  "sdc",
  "mdc",
  "initiative",
  "strike",
  "parry",
  "dodge",
  "throw",
  "disarm",
  "entangle",
  "pull",
  "roll",
  "breakfall",
  "damage",
  "damage_paired",
  "damage_mainhand",
  "damage_offhand",
  "dodge_flight",
  "dodge_auto",
  "dodge_teleport",
  "dodge_motion",
  "dodge_underwater",
  "strike_range",
  "strike_range_single",
  "strike_range_burst",
  "strike_range_aimed",
  "strike_range_aimed_single",
  "strike_range_aimed_pulse",
  "strike_range_called",
  "strike_range_called_single",
  "strike_range_called_pulse",
  "strike_range_aimed_called_single",
  "strike_range_aimed_called_pulse",
  "disarm_range",
  "damage_range",
  "damage_range_single",
  "damage_range_burst",
  "critical",
  "knockout",
  "deathblow",
  "flipthrow",
  "tackle",
  "leghook",
  "backwardsweepkick",
  "description",
];
const SAVE_KEYS_ATTRIBUTE_BONUSES = {
  me_bonus: ["psionics", "insanity"],
  pe_bonus: ["magic", "lethalpoison", "nonlethalpoison", "disease", "drugs"],
  pe_coma_bonus: ["comadeath"],
  perception_bonus: ["perceptioncheck"],
  none: [
    "pain",
    "horrorfactor",
    "mindcontrol",
    "illusions",
    "possession",
    "curses",
    "maintainbalance",
    "fatigue",
    "despair",
    "telepathicprobes",
  ],
};
const SAVE_KEYS = Object.values(SAVE_KEYS_ATTRIBUTE_BONUSES).reduce(
  (acc, cur) => acc.concat(cur),
  []
);
const REPEATING_MOVEMENT_KEYS = [
  "run_mph",
  "run_kmh",
  "fly_mph",
  "fly_kmh",
  "run_ft_melee",
  "run_m_melee",
  "fly_ft_melee",
  "fly_m_melee",
  "run_ft_action",
  "run_m_action",
  "fly_ft_action",
  "fly_m_action",
];
const REPEATING_BONUS_KEYS = COMBAT_KEYS.concat(
  SAVE_KEYS,
  ATTRIBUTE_KEYS,
  REPEATING_MOVEMENT_KEYS
);
const SKILL_KEYS = [
  "name",
  "category",
  "base",
  "bonus",
  "perlevel",
  "levelacquired",
  "level",
  "total",
  "description",
];

const ABILITIES_REPEATERS = ["magic", "psionics", "powersabilities"];

const MAGIC_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "school",
  "spell_level",
  "range",
  "damage",
  "duration",
  "percentage",
  "ppecost",
  "range_starting",
  "range_per_level",
  "range_unit",
  "damage_starting",
  "damage_per_level",
  "damage_unit",
  "dc_starting",
  "dc_per_level",
  "dc_unit",
  "duration_starting",
  "duration_per_level",
  "duration_unit",
  "percentage_starting",
  "percentage_per_level",
  "addtobonuses",
  "description",
]);

const PSIONICS_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "range",
  "damage",
  "duration",
  "percentage",
  "ispcost",
  "range_starting",
  "range_per_level",
  "range_unit",
  "damage_starting",
  "damage_per_level",
  "damage_unit",
  "dc_starting",
  "dc_per_level",
  "dc_unit",
  "duration_starting",
  "duration_per_level",
  "duration_unit",
  "percentage_starting",
  "percentage_per_level",
  "addtobonuses",
  "description",
]);

const ABILITIES_KEYS = REPEATING_BONUS_KEYS.concat([
  "name",
  "range",
  "damage",
  "duration",
  "percentage",
  "range_starting",
  "range_per_level",
  "range_unit",
  "damage_starting",
  "damage_per_level",
  "damage_unit",
  "dc_starting",
  "dc_per_level",
  "dc_unit",
  "duration_starting",
  "duration_per_level",
  "duration_unit",
  "frequency_starting",
  "frequency_per_level",
  "frequency_unit",
  "percentage_starting",
  "percentage_per_level",
  "addtobonuses",
  "description",
]);

const PROFILES_KEYS = REPEATING_BONUS_KEYS.concat(["bonus_ids", "bonus_names"]);

const CORE_KEYS = [
  "character_name",
  "truename_name",
  "character_race",
  "occ",
  "character_ps_type",
  "character_level",
  "experience",
  "alignment",
  "character_age",
  "character_gender",
  "character_height",
  "character_weight",
  "character_familyorigin",
  "character_environment",
  "character_languages",
  "character_insanity",
  "character_disposition",
  "iq",
  "iq_bonus",
  "perception_bonus",
  "me",
  "me_bonus",
  "ma",
  "ma_bonus",
  "ps",
  "ps_bonus",
  "pp",
  "pp_bonus",
  "pe",
  "pe_bonus",
  "pe_coma_bonus",
  "pb",
  "pb_bonus",
  "spd",
  "spdfly",
  "charmimpress",
  "character_hp",
  "character_sdc",
  "character_ar",
  "character_mdc",
  "character_ppe",
  "character_isp",
  "hf",
  "spellstrength",
  "perception",
  "run_mph",
  "run_ft_melee",
  "run_ft_attack",
  "run_cruising",
  "run_at_max",
  "leapup",
  "leapout",
  "equipment",
  "psionic_ability",
  "credits_universal_bearer",
  "credits_universal_marked",
  "credits_blackmarket",
  "credits_ngmi",
  "credits_phaseworld",
  "credits_splugorth",
  "credits_gems",
  "credits_blackmarketmerchandise",
];

const ARMOR_KEYS = ["is_active", "name", "movementpenalty", "mdc", "mdc_max"];

const MOVEMENT_KEYS = ["name", "mph", "ft_melee", "cruising", "dur_at_max"];

const EQUIPMENT_KEYS = ["equipment"];

const SECTIONS = {
  h2h: H2H_KEYS,
  wp: WP_KEYS.wp,
  wpmodern: WP_KEYS.wpmodern,
  skills: SKILL_KEYS,
  modifiers: REPEATING_BONUS_KEYS,
  magic: MAGIC_KEYS,
  psionics: PSIONICS_KEYS,
  movement: MOVEMENT_KEYS,
  powersabilities: ABILITIES_KEYS,
  armor: ARMOR_KEYS,
  // profiles: PROFILES_KEYS, // Tricky to export because IDs that they refer to won't line up
  equipment: EQUIPMENT_KEYS,
};

  /* endinject */

  /* inject:js/utils.js */
  /**
 * Aggregates repeating values
 * @param {string[]} destinations An array of field names to output to
 * @param {string} section A repeating section name
 * @param {string[]} fields An array of fields to aggregate into the associated destination
 * @param  {...any} extras Some extra stuff
 * If an extra is an object, it will be used for extendedProps.
 */
async function repeatingSumAsync(destinations, section, fields, ...extras) {
  const isNumber = (value) => parseFloat(value).toString() === value.toString();
  const isOption = (value) =>
    [...checks.valid, ...checks.roundtypes].includes(value);
  const isRounding = (value) => checks.roundtypes.includes(value);
  const isFraction = (value) =>
    value.includes("/") && !(value.includes(",") || value.includes("|"));
  const getTrimmed = (value) => value.toLowerCase().replace(/\s/g, "");
  const getRounded = (type, value, pow) =>
    (Math[type](value * Math.pow(10, pow)) / Math.pow(10, pow)).toFixed(
      Math.max(0, pow)
    );
  const getFraction = (value /*{ console.log(`value: ${value}`); */) =>
    parseInt(value.split("/")[0]) / parseInt(value.split("/")[1]);
  const getMultiplier = (value, rounding = 1) =>
    "undefined" === typeof value
      ? rounding
        ? 0
        : 1
      : isNumber(value)
      ? parseFloat(value)
      : isFraction(value)
      ? getFraction(value)
      : value;
  if (!Array.isArray(destinations)) destinations = [getTrimmed(destinations)];
  if (!Array.isArray(fields)) fields = [getTrimmed(fields)];
  const fields_trimmed = fields.map((field) => getTrimmed(field).split(":")[0]);
  const subfields = fields_trimmed.slice(0, destinations.length);
  const checks = {
    valid: ["multiplier"],
    roundtypes: ["ceil", "round", "floor"],
  };
  let properties = { attributes: {}, options: {} };
  let extendedProps = {};
  extras.forEach((extra) => {
    if (extra.constructor.name === "Object") {
      extendedProps = extra;
      return;
    }
    const [prop, v] = getTrimmed(extra).split(":");
    const multiplier_maybe = getMultiplier(v, isRounding(prop));
    const obj = isNumber(multiplier_maybe)
      ? subfields.reduce((obj, field) => {
          obj[field] = multiplier_maybe;
          return obj;
        }, {})
      : multiplier_maybe.split(",").reduce((obj, item) => {
          const [stat, value] = item.split("|");
          const multiplier = getMultiplier(value, isRounding(prop));
          obj[stat] = multiplier;
          return obj;
        }, {});
    properties[isOption(prop) ? "options" : "attributes"][prop] = obj;
  });
  const idArray = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = idArray.reduce(
    (m, id) => [
      ...m,
      ...fields_trimmed.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (properties.attributes.filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      Object.keys(properties.attributes.filter).some(
        (sectionId) => sectionId && attr.includes(sectionId)
      )
    );
  }
  const v = await getAttrsAsync([
    ...filteredAttrArray,
    ...Object.keys(properties.attributes),
  ]);
  const getValue = (section, id, field) =>
    v[`repeating_${section}_${id}_${field}`] === "on"
      ? 1
      : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
  const commonMultipliers =
    fields.length <= destinations.length
      ? []
      : fields.splice(destinations.length, fields.length - destinations.length);
  const output = destinations.reduce((obj, destination, index) => {
    let sumTotal = idArray.reduce(
      (total, id) =>
        total +
        getValue(section, id, fields_trimmed[index]) *
          commonMultipliers.reduce(
            (subtotal, mult) =>
              subtotal *
              (!mult.includes(":") ||
              mult.split(":")[1].split(",").includes(fields_trimmed[index])
                ? getValue(section, id, mult.split(":")[0])
                : 1),
            1
          ),
      0
    );
    sumTotal *=
      properties.options.hasOwnProperty("multiplier") &&
      Object.keys(properties.options.multiplier).includes(fields_trimmed[index])
        ? parseFloat(properties.options.multiplier[fields_trimmed[index]]) || 0
        : 1;
    sumTotal += Object.entries(properties.attributes).reduce(
      (total, [key, value]) =>
        (total += value.hasOwnProperty(fields_trimmed[index])
          ? parseFloat(v[key] || 0) *
            (parseFloat(value[fields_trimmed[index]]) || 1)
          : 0),
      0
    );
    checks.roundtypes.forEach((type) => {
      if (properties.options.hasOwnProperty(type)) {
        if (
          Object.keys(properties.options[type]).includes(fields_trimmed[index])
        ) {
          sumTotal = getRounded(
            type,
            sumTotal,
            +properties.options[type][fields_trimmed[index]] || 0
          );
        } else if (
          properties.options[type] == "0" ||
          !isNaN(+properties.options[type] || "x")
        ) {
          sumTotal = getRounded(type, sumTotal, +properties.options[type]);
        }
      }
    });
    obj[destination] = sumTotal;
    return obj;
  }, {});
  await setAttrsAsync(output);
}

async function repeatingPickBestAsync({
  destinations,
  section,
  fields,
  defaultValues,
  ranks,
  filter,
}) {
  console.log("repeatingPickBestAsync", {
    destinations,
    section,
    fields,
    defaultValues,
    ranks,
    filter,
  });
  const sectionIds = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = sectionIds.reduce(
    (m, id) => [
      ...m,
      ...fields.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      filter.some((sectionId) => sectionId && attr.includes(sectionId))
    );
  }
  const a = await getAttrsAsync(filteredAttrArray);
  const output = destinations.reduce((acc, cur, i) => {
    acc[cur] = Object.keys(a)
      .filter((val) => {
        // the 4th part of `val` needs to match fields[i]
        const [, , , ...attrParts] = val.split("_");
        const attr = attrParts.join("_");
        return attr == fields[i];
      })
      .reduce((accVal, attrCur) => {
        if (+a[attrCur] == 0) {
          return accVal;
        }

        if (+accVal != 0) {
          if (ranks[i] === "high") {
            return +a[attrCur] > +accVal ? a[attrCur] : accVal;
          } else {
            return +a[attrCur] < +accVal ? a[attrCur] : accVal;
          }
        } else {
          return a[attrCur];
        }
      }, defaultValues[i]);
    return acc;
  }, {});
  console.log(output);
  await setAttrsAsync(output);
}

async function repeatingStringConcatAsync({
  destinations,
  section,
  fields,
  filter,
}) {
  console.log({
    destinations,
    section,
    fields,
    filter,
  });
  const sectionIds = await getSectionIDsAsync(`repeating_${section}`);
  const attrArray = sectionIds.reduce(
    (m, id) => [
      ...m,
      ...fields.map((field) => `repeating_${section}_${id}_${field}`),
    ],
    []
  );
  let filteredAttrArray = attrArray;
  if (filter) {
    filteredAttrArray = attrArray.filter((attr) =>
      filter.some((sectionId) => sectionId && attr.includes(sectionId))
    );
  }
  const a = await getAttrsAsync(filteredAttrArray);
  const output = destinations.reduce((acc, cur, i) => {
    acc[cur] = Object.keys(a)
      .filter((val) => {
        // the 4th part of `val` needs to match fields[i]
        const [, , , ...attrParts] = val.split("_");
        const attr = attrParts.join("_");
        return attr == fields[i];
      })
      .reduce((attrAcc, attrCur) => {
        return a[attrCur] == "" || a[attrCur] == "0"
          ? attrAcc
          : `${a[attrCur]}+${attrAcc}`
              .replace(/\+\s*$/, "")
              .replace(/^\s*\+/, "");
      }, "");
    return acc;
  }, {});
  await setAttrsAsync(output);
}

function getBiAttributeBonus(attr) {
  const bonus = attr > 15 ? Math.ceil((Math.min(attr, 30) - 15) / 2) : 0;
  return bonus;
}

function mergeAndAddObjects(data) {
  const result = {};
  data.forEach((obj) => {
    for (let [key, value] of Object.entries(obj)) {
      if (result[key]) {
        if (key === "critical" || key === "knockout" || key === "deathblow") {
          result[key] = result[key] > value ? value : result[key];
        } else {
          result[key] += value;
        }
      } else {
        result[key] = value;
      }
    }
  });
  return result;
}

async function getSectionIDsOrderedAsync(sectionName) {
  const v = await getAttrsAsync([`_reporder_repeating_${sectionName}`]);
  const idArray = await getSectionIDsAsync(sectionName);
  const reporderArray = v[`_reporder_repeating_${sectionName}`]
    ? v[`_reporder_repeating_${sectionName}`].toLowerCase().split(",")
    : [];
  const ids = [
    ...new Set(
      reporderArray.filter((x) => idArray.includes(x)).concat(idArray)
    ),
  ];
  return ids;
}

/**
 * Add a token {attack} times to the Turn Tracker in order against other tokens.
 * Requires API script access.
 * For use on an action button.
 *
 * [[d20+@{selected|repeating_profiles_-MibcwHG5hZXUJn6A7OG_initiative} &{tracker}]]
 */
async function palladiumAddToTurnTracker(initKey, attacksKey) {
  const { [initKey]: init, [attacksKey]: attacks } = await getAttrsAsync([
    initKey,
    attacksKey,
  ]);
  const initString = init > 0 ? `+${init}` : `${init}`;
  const roll = await startRoll(
    `@{opt_whisper}&{template:initiative} {{title=@{selected|character_name} rolls initiative!}} {{diceroll=[[1d20]]}} {{modifier=${initString}}}`
  );
  console.log(roll);
  const computed = roll.results.diceroll.result + init;
  console.log(computed);
  finishRoll(roll.rollId, {
    diceroll: computed,
  });
  const addToTracker = await startRoll(
    `@{opt_whisper}&{template:custom} {{title=@{selected|character_name} added to Turn Tracker}} {{Initiative=[[[[${computed}]] &{tracker}]]}}`
  );
  finishRoll(addToTracker.rollId);
  // https://app.roll20.net/forum/post/6817409/multiple-initiative-values-for-a-single-character/?pageforid=6817748#post-6817748
  const dupeTracker = await startRoll(`!dup-turn ${attacks}`);
  finishRoll(dupeTracker.rollId);
}

/**
 * Determines if a repeating section change event is a new row.
 * Requires the repeating section to have a `rowid` attribute.
 * Note that when a new row is added the
 *
 * @param {*} e Roll20 change event object.
 * @returns bool
 */
async function isNewRow(e) {
  const [r, section, rowId, attr] = e.sourceAttribute.split("_");
  const rowPrefix = `${r}_${section}_${rowId}`;
  const a = await getAttrsAsync([`${rowPrefix}_rowid`]);
  if (a[`${rowPrefix}_rowid`].length === 0) {
    await setAttrsAsync(
      { [`${rowPrefix}_rowid`]: `${r}_${section}_${rowId}` },
      { silent: true }
    );
    return true;
  }
  return false;
}

/**
 * Sets generic defaults when a new row is created.
 *
 * @param {*} e Roll20 change event object.
 */
async function setRowDefaults(e, setAttrsOptions) {
  const [r, section, rowId, attr] = e.sourceAttribute.split("_");
  const rowPrefix = `${r}_${section}_${rowId}`;
  const a = await getAttrsAsync(["character_level"]);
  const attrs = {
    [`${rowPrefix}_levelacquired`]: a["character_level"],
    [`${rowPrefix}_level`]: 1,
  };
  console.log(attrs);
  await setAttrsAsync(attrs, setAttrsOptions);
}

  /* endinject */

  /* inject:js/migrate.js */
  /**
 * Migration Notes

Current / Max (HP, DC, ISP, PPE) - In all cases, Max is migrated to the sheet and Current is dropped.
(S/M)DC assumes SDC and populates that field.
Hunger isn't a thing, so isn't migrated.
IQ Bonus to Skill, Trust/Intimidate, and Charm/Impress are not migrated because they're auto-calculated.

 */

/**
 *
 * @param {string} repeater
 * @param {string} category
 */
async function migrateSkills(repeater, category) {
  console.log("migrateSkills", repeater, category);
  const oldRowIds = await getSectionIDsOrderedAsync(repeater);
  const skillKeys = oldRowIds.reduce((acc, cur) => {
    const pre = `repeating_${repeater}_${cur}`;
    return [
      `${pre}_${repeater}`,
      `${pre}_${repeater}P`,
      `${pre}_${repeater}PL`,
      ...acc,
    ];
  }, []);
  skillKeys.push("character_level");
  const a = await getAttrsAsync(skillKeys);
  const newRowIds = [];
  const attrs = oldRowIds.reduce((acc, cur) => {
    const rowId = generateRowID();
    newRowIds.push(rowId);
    const oldPre = `repeating_${repeater}_${cur}`;
    const newPre = `repeating_skills_${rowId}`;
    acc[`${newPre}_name`] = a[`${oldPre}_${repeater}`];
    acc[`${newPre}_category`] = category;
    acc[`${newPre}_base`] = a[`${oldPre}_${repeater}P`];
    acc[`${newPre}_perlevel`] = a[`${oldPre}_${repeater}PL`];
    acc[`${newPre}_level`] = a[`character_level`];
    return acc;
  }, {});
  await setAttrsAsync(attrs);
  for (const rowId of newRowIds) {
    await updateSkill(rowId);
  }
}

async function oldSheetProfile() {}

async function migrateFromOldSheet() {
  console.log("migrateFromOldSheet");
  const oldKeys = ["PsionicLevel"];
  const a = await getAttrsAsync(oldKeys);
  const attrs = {};
  attrs["psionic_ability"] = +a["PsionicLevel"] + 10;
  await setAttrsAsync(attrs);
  await migrateSkills("OCCSK", "occ");
  await migrateSkills("OCRCSK", "related");
  await migrateSkills("SECSK", "secondary");
}

async function migrateAddRowIds() {
  // @todo Loop through all h2h,wp,wpmodern,skills IDs and create/populate rowid wherever it's empty.
  console.log("migrateAddRowIds");
  const sections = ["skills", "h2h", "wp", "wpmodern"];
  for (const section of sections) {
    const ids = await getSectionIDsOrderedAsync(section);
    const attrKeys = ids.map((id) => `repeating_${section}_${id}_rowid`);
    const a = await getAttrsAsync(attrKeys);
    const attrs = ids.reduce((acc, id) => {
      const key = `repeating_${section}_${id}`;
      if (!a[`${key}_rowid`]) {
        acc[`${key}_rowid`] = key;
      }
      return acc;
    }, {});
    console.log(attrs);
    await setAttrsAsync(attrs);
  }
}

async function migrateAttributes() {
  const lcOpts = [undefined, { numeric: true, sensitivity: "base" }];

  const versions = [
    {
      version: "1.0.0",
      attributes: [
        {
          from: [
            "Name",
            "Gender",
            "OCC",
            "Level",
            "XP",
            "Alignment",
            "IQ",
            "ME",
            "MA",
            "PS",
            "PP",
            "PE",
            "PB",
            "Spd",
            "HP_max",
            "DamageCapacity_max",
            "ISP_max",
            "PPE_max",
          ],
          to: [
            "character_name",
            "character_gender",
            "occ",
            "character_level",
            "experience",
            "alignment",
            "iq",
            "me",
            "ma",
            "ps",
            "pp",
            "pe",
            "pb",
            "spd",
            "character_hp",
            "character_sdc",
            "character_isp",
            "character_ppe",
          ],
        },
      ],
    },
    {
      version: "1.1.0",
      attributes: [
        {
          repeating: ["modifiers", "magic", "psionics", "powersabilities"],
          from: "trustintimidate",
          to: ["trust", "intimidate"],
        },
      ],
    },
    {
      version: "1.2.0",
      attributes: [
        {
          repeating: ["armor"],
          from: "currentmdc",
          to: ["mdc"],
        },
        {
          repeating: ["armor"],
          from: "basemdc",
          to: ["mdc_max"],
        },
      ],
    },
    {
      version: "1.3.0",
    },
    {
      version: "1.4.0",
    },
    {
      version: "1.5.0",
      function: migrateAddRowIds,
    },
  ];

  const { version, migrated } = await getAttrsAsync(["version", "migrated"]);
  console.log(version, migrated);
  const [latest] = versions.slice(-1);
  if (!version || !Boolean(+migrated)) {
    migrateFromOldSheet();
  } else {
    // https://stackoverflow.com/a/65687141/177943
    if (
      latest.version.localeCompare(version, ...lcOpts) < 1 &&
      Boolean(+migrated)
    ) {
      return;
    }
  }

  for (const v of versions) {
    if (v.attributes) {
      for (const attribute of v.attributes) {
        if (attribute.repeating) {
          for (const section of attribute.repeating) {
            const ids = await getSectionIDsAsync(section);
            const attrKeys = ids.map(
              (id) => `repeating_${section}_${id}_${attribute.from}`
            );
            const a = await getAttrsAsync(attrKeys);
            const attrs = ids.reduce((acc, id) => {
              for (const to of attribute.to) {
                const fromKey = `repeating_${section}_${id}_${attribute.from}`;
                if (a[fromKey]) {
                  acc[`repeating_${section}_${id}_${to}`] = a[fromKey];
                }
                return acc;
              }
            }, {});
            if (Object.keys(attrs).length > 0) {
              await setAttrsAsync(attrs);
            }
          }
        } else {
          if (Array.isArray(attribute.from) && Array.isArray(attribute.to)) {
            const a = await getAttrsAsync(attribute.from);
            const attrs = attribute.from.reduce((acc, cur, idx) => {
              if (a[cur]) {
                acc[attribute.to[idx]] = a[cur];
              }
              return acc;
            }, {});
            await setAttrsAsync(attrs);
          }
        }
      }
    }
    if (v.function) {
      v.function();
    }
  }
  await setAttrsAsync({ version: latest.version, migrated: 1 });
}

  /* endinject */

  /* inject:js/bonuses.js */
  /**
 * @todo same issue as in movement.js - which profile takes precedence?
 */
on("change:repeating_profiles:attacks", async (e) => {
  console.log("change:repeating_profiles:attacks", e);
  const movementIds = await getSectionIDsAsync("movement");
  const attrNames = movementIds.map(
    (id) => `repeating_movement_${id}_ft_melee`
  );
  const attrs = {};
  const a = await getAttrsAsync(attrNames.concat(["run_ft_melee"]));
  attrs.run_ft_attack = Math.round(a.run_ft_melee / e.newValue);
  movementIds.forEach((id) => {
    const row = `repeating_movement_${id}`;
    const feetPerMelee = a[`${row}_ft_melee`] || 0;
    if (feetPerMelee) {
      attrs[`${row}_ft_attack`] = Math.round(feetPerMelee / e.newValue);
    }
  });
  await setAttrsAsync(attrs);
});

async function addStrikeRangeToCombinedAsync(rowPrefix) {
  console.log("addStrikeRangeToCombinedAsync", rowPrefix);
  const a = await getAttrsAsync([
    `${rowPrefix}_strike_range`,
    `${rowPrefix}_strike_range_single`,
    `${rowPrefix}_strike_range_burst`,
    `${rowPrefix}_strike_range_aimed`,
    `${rowPrefix}_strike_range_called`,
  ]);
  const strikeRangeSingle =
    +a[`${rowPrefix}_strike_range`] + +a[`${rowPrefix}_strike_range_single`];
  const strikeRangeBurst =
    +a[`${rowPrefix}_strike_range`] + +a[`${rowPrefix}_strike_range_burst`];
  const strikeRangeAimedSingle =
    strikeRangeSingle + +a[`${rowPrefix}_strike_range_aimed`] + 2;
  const strikeRangeAimedPulse = Math.floor(strikeRangeAimedSingle / 2);
  const strikeRangeCalledSingle =
    strikeRangeSingle + a[`${rowPrefix}_strike_range_called`];
  const strikeRangeCalledPulse = Math.floor(strikeRangeCalledSingle / 2);
  const strikeRangeAimedCalledSingle =
    strikeRangeAimedSingle + +a[`${rowPrefix}_strike_range_called`];
  const strikeRangeAimedCalledPulse = Math.floor(
    strikeRangeAimedCalledSingle / 2
  );
  const attrs = {
    [`${rowPrefix}_strike_range_single`]: strikeRangeSingle,
    [`${rowPrefix}_strike_range_burst`]: strikeRangeBurst,
    [`${rowPrefix}_strike_range_aimed_single`]: strikeRangeAimedSingle,
    [`${rowPrefix}_strike_range_aimed_pulse`]: strikeRangeAimedPulse,
    [`${rowPrefix}_strike_range_called_single`]: strikeRangeCalledSingle,
    [`${rowPrefix}_strike_range_called_pulse`]: strikeRangeCalledPulse,
    [`${rowPrefix}_strike_range_aimed_called_single`]:
      strikeRangeAimedCalledSingle,
    [`${rowPrefix}_strike_range_aimed_called_pulse`]:
      strikeRangeAimedCalledPulse,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function repeatingAbsoluteAttributes(rowIds, destinationPrefix) {
  console.log("repeatingAbsoluteAttributes", rowIds, destinationPrefix);
  const fields = [
    "iq",
    "me",
    "ma",
    "ps",
    "pp",
    "pe",
    "pb",
    "spd",
    "spdfly",
    "hf",
    "spellstrength",
    "trust",
    "intimidate",
    "charmimpress",
  ];
  const fieldNames = rowIds.reduce((acc, rowId) => {
    const absFieldNames = fields.map(
      (f) => `repeating_bonuses_${rowId}_${f}_abs`
    );
    const attFieldNames = fields.map(
      (f) => `repeating_bonuses_${rowId}_mod_${f}`
    );
    return acc.concat(absFieldNames, attFieldNames);
  }, []);
  const a = await getAttrsAsync(fieldNames);

  fields.forEach(async (field) => {
    let fieldAbsValue = null;
    rowIds.forEach((rowId) => {
      const rowFieldAbs = a[`repeating_bonuses_${rowId}_${field}_abs`];
      if (Boolean(Number(rowFieldAbs)) == true) {
        rowFieldValue = +a[`repeating_bonuses_${rowId}_mod_${field}`];
        fieldAbsValue = +(fieldAbsValue > rowFieldValue
          ? fieldAbsValue
          : rowFieldValue);
      }
    });
    if (fieldAbsValue) {
      // compare the modified absolute value against the original attribute
      // const coreValue = (await getAttrsAsync([field]))[field];
      const { [field]: rawCoreValue } = await getAttrsAsync([field]);
      const coreValue = +rawCoreValue;
      const newValue = coreValue > fieldAbsValue ? coreValue : fieldAbsValue;
      const attr = {
        [`${destinationPrefix}_mod_${field}`]: newValue,
      };
      await setAttrsAsync(attr);
    } else {
      // repeatingSum
      const rsaDestinations = [`${destinationPrefix}_mod_${field}`];
      const rsaFields = [`mod_${field}`];
      let base = field;
      if (field == "trust" || field == "intimidate") {
        base = `${destinationPrefix}_mod_ma_bonus`;
      } else if (field == "charmimpress") {
        base = `${destinationPrefix}_mod_pb_bonus`;
      }
      await repeatingSumAsync(
        rsaDestinations,
        "bonuses",
        rsaFields,
        `filter:${rowIds.toString()}`,
        base
      );
    }
  });
}

async function combineBonuses(rowIds, destinationPrefix) {
  // we need to combine the values of each repeated attribute within
  // each of the sectionIds and aggregate them in the combined combat section
  // +PP +PS, and add a saving throws section with +ME +PE

  console.log("combineBonuses", rowIds, destinationPrefix);

  const options = await getAttrsAsync(["opt_pp_extras"]);
  const optPpExtras = Boolean(+options["opt_pp_extras"]);

  await repeatingAbsoluteAttributes(rowIds, destinationPrefix);

  await repeatingStringConcatAsync({
    destinations: [
      `${destinationPrefix}_damage`,
      `${destinationPrefix}_damage_paired`,
      `${destinationPrefix}_damage_mainhand`,
      `${destinationPrefix}_damage_offhand`,
      `${destinationPrefix}_damage_range`,
      `${destinationPrefix}_damage_range_single`,
      `${destinationPrefix}_damage_range_burst`,
    ],
    section: "bonuses",
    fields: [
      "damage",
      "damage_paired",
      "damage_mainhand",
      "damage_offhand",
      "damage_range",
      "damage_range_single",
      "damage_range_burst",
    ],
    filter: rowIds,
  });

  const pickBestFieldsBase = [
    "ar",
    "critical",
    "knockout",
    "deathblow",
    "mod_character_ps_type",
    "mod_liftcarry_weight_multiplier",
    "mod_liftcarry_duration_multiplier",
  ];
  const pickBestDestinations = pickBestFieldsBase.map(
    (field) => `${destinationPrefix}_${field}`
  );
  const pickBestFields = pickBestFieldsBase;
  const core = await getAttrsAsync(["character_ps_type"]);
  await repeatingPickBestAsync({
    destinations: pickBestDestinations,
    section: "bonuses",
    fields: pickBestFields,
    defaultValues: [0, 20, 0, 0, core.character_ps_type, 1, 1],
    ranks: ["high", "low", "low", "low", "high", "high", "high", "high"],
    filter: rowIds,
  });

  let noAttributeBonusFields = [
    "attacks",
    "initiative",
    "pull",
    "roll",
    "breakfall",
    "strike_range",
    "strike_range_single",
    "strike_range_burst",
    "strike_range_aimed",
    "strike_range_called",
    "disarm_range",
  ];

  let ppBonusFields = [
    "strike",
    "parry",
    "dodge",
    "throw",
    "dodge_flight",
    "dodge_auto",
    "dodge_teleport",
    "dodge_motion",
    "dodge_underwater",
    "flipthrow",
    "tackle",
    "leghook",
    "backwardsweepkick",
  ];

  const ppExtras = ["disarm", "entangle"];
  if (optPpExtras) {
    ppBonusFields = ppBonusFields.concat(ppExtras);
  } else {
    noAttributeBonusFields = noAttributeBonusFields.concat(ppExtras);
  }

  // No attribute bonuses.
  await repeatingSumAsync(
    noAttributeBonusFields.map((field) => `${destinationPrefix}_${field}`),
    "bonuses",
    noAttributeBonusFields,
    `filter:${rowIds.toString()}`
  );
  await addStrikeRangeToCombinedAsync(destinationPrefix);

  await repeatingSumAsync(
    [`${destinationPrefix}_hp`],
    "bonuses",
    ["hp"],
    `filter:${rowIds.toString()}`,
    "character_hp"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_sdc`],
    "bonuses",
    ["sdc"],
    `filter:${rowIds.toString()}`,
    "character_sdc"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_mdc`],
    "bonuses",
    ["mdc"],
    `filter:${rowIds.toString()}`,
    "character_mdc"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_ppe`],
    "bonuses",
    ["ppe"],
    `filter:${rowIds.toString()}`,
    "character_ppe"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_isp`],
    "bonuses",
    ["isp"],
    `filter:${rowIds.toString()}`,
    "character_isp"
  );

  await repeatingSumAsync(
    [`${destinationPrefix}_mod_skillbonus`],
    "bonuses",
    ["mod_skillbonus"],
    `filter:${rowIds.toString()}`
  );

  await repeatingSumAsync(
    ppBonusFields.map((field) => `${destinationPrefix}_${field}`),
    "bonuses",
    ppBonusFields,
    `filter:${rowIds.toString()}`,
    `${destinationPrefix}_mod_pp_bonus`
  );

  // Saving Throws
  Object.entries(SAVE_KEYS_ATTRIBUTE_BONUSES).forEach(
    async ([attributeBonus, saves]) => {
      const destinations = saves.map((save) => `${destinationPrefix}_${save}`);
      const section = "bonuses";
      const fields = saves;
      await repeatingSumAsync(
        destinations,
        section,
        fields,
        `filter:${rowIds.toString()}`,
        `${destinationPrefix}_mod_${attributeBonus}`
      );
    }
  );

  await updateMovement(destinationPrefix);
}

async function updateMovement(destinationPrefix) {
  console.log("updateMovement", destinationPrefix);
  const {
    [`${destinationPrefix}_mod_spd`]: spd,
    [`${destinationPrefix}_mod_spdfly`]: spdfly,
    [`${destinationPrefix}_attacks`]: attacks,
  } = await getAttrsAsync([
    `${destinationPrefix}_mod_spd`,
    `${destinationPrefix}_mod_spdfly`,
    `${destinationPrefix}_attacks`,
  ]);
  console.log(spd, spdfly, attacks);
  const run_ft_second = +spd;
  const fly_ft_second = +spdfly;
  const apm = +attacks;
  const run_m_second = run_ft_second / 3.28084;
  const fly_m_second = fly_ft_second / 3.28084;
  const attrs = {
    [`${destinationPrefix}_run_mph`]: Math.round(
      (run_ft_second * 60 * 60) / 5280
    ),
    [`${destinationPrefix}_run_ft_melee`]: run_ft_second * 15,
    [`${destinationPrefix}_run_ft_action`]: Math.round(
      (run_ft_second * 15) / (apm || 1)
    ),
    [`${destinationPrefix}_run_m_melee`]: Math.round(run_m_second * 15),
    [`${destinationPrefix}_run_m_action`]: Math.round(
      (run_m_second * 15) / (apm || 1)
    ),
    [`${destinationPrefix}_run_kmh`]: Math.round(
      (run_m_second * 60 * 60) / 1000
    ),
    [`${destinationPrefix}_fly_mph`]: Math.round(
      (fly_ft_second * 60 * 60) / 5280
    ),
    [`${destinationPrefix}_fly_ft_melee`]: fly_ft_second * 15,
    [`${destinationPrefix}_fly_ft_action`]: Math.round(
      (fly_ft_second * 15) / (apm || 1)
    ),
    [`${destinationPrefix}_fly_m_melee`]: Math.round(fly_m_second * 15),
    [`${destinationPrefix}_fly_m_action`]: Math.round(
      (fly_m_second * 15) / (apm || 1)
    ),
    [`${destinationPrefix}_fly_kmh`]: Math.round(
      (fly_m_second * 60 * 60) / 1000
    ),
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function removeBonusSelectionsRowAsync(bonusRowId) {
  const a = await getAttrsAsync([
    `repeating_bonuses_${bonusRowId}_selection_id`,
  ]);
  removeRepeatingRow(
    `repeating_bonusselections_${
      a[`repeating_bonuses_${bonusRowId}_selection_id`]
    }`
  );
}

async function removeBonusRowsAsync(bonusRowId) {
  await removeBonusSelectionsRowAsync(bonusRowId);
  removeRepeatingRow(`repeating_bonuses_${bonusRowId}`);
}

on("remove:repeating_wp remove:repeating_wpmodern", async (e) => {
  console.log("remove wp", e);
  // const [r, section, rowId] = e.sourceAttribute.split('_');
  const bonusRowId = e.removedInfo[`${e.sourceAttribute}_bonus_id`];
  await removeBonusRowsAsync(bonusRowId);
});

async function outputSelectedBonusIds() {
  const bonusselectionsIds = await getSectionIDsAsync("bonusselections");
  const checkboxNames = bonusselectionsIds.map(
    (id) => `repeating_bonusselections_${id}_enabled`
  );
  const bonusIdNames = bonusselectionsIds.map(
    (id) => `repeating_bonusselections_${id}_bonus_id`
  );
  const attrNames = checkboxNames.concat(bonusIdNames);
  const a = await getAttrsAsync(attrNames);
  const bonusRowIds = bonusselectionsIds.reduce((acc, id) => {
    const prefix = `repeating_bonusselections_${id}`;
    if (Boolean(Number(a[`${prefix}_enabled`])) == true) {
      acc.push(a[`${prefix}_bonus_id`]);
    }
    return acc;
  }, []);
  await setAttrsAsync({ bonus_ids_output: bonusRowIds.toString() });
}

on("change:repeating_bonusselections:enabled", async (e) => {
  console.log("change:repeating_bonusselections:enabled", e);
  await outputSelectedBonusIds();
});

const insertedBonuses = [];
async function insertSelection(name, bonusRowId, level) {
  console.log("insertSelection", name, bonusRowId, level);
  if (insertedBonuses.includes(bonusRowId)) {
    return;
  } else {
    insertedBonuses.push(bonusRowId);
  }
  const selectionRowId = generateRowID();
  const attrs = {};
  attrs[`repeating_bonusselections_${selectionRowId}_bonus_id`] = bonusRowId;
  attrs[
    `repeating_bonusselections_${selectionRowId}_name`
  ] = `${name} (${level})`;
  attrs[`repeating_bonuses_${bonusRowId}_selection_id`] = selectionRowId;
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function updateSelection(name, selectionRowId, level) {
  console.log("updateSelection", name, selectionRowId, level);
  const attrs = {};
  attrs[
    `repeating_bonusselections_${selectionRowId}_name`
  ] = `${name} (${level})`;
  await setAttrsAsync(attrs);
}

on(
  "change:repeating_bonuses:name \
  change:repeating_bonuses:level",
  async (e) => {
    console.log("change:repeating_bonuses:name", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    const selectionIdKey = `repeating_bonuses_${rowId}_selection_id`;
    const levelKey = `repeating_bonuses_${rowId}_level`;
    const nameKey = `repeating_bonuses_${rowId}_name`;
    const a = await getAttrsAsync([selectionIdKey, levelKey, nameKey]);
    console.log(a);
    if (a[selectionIdKey]) {
      await updateSelection(a[nameKey], a[selectionIdKey], a[levelKey]);
    } else {
      await insertSelection(a[nameKey], rowId, a[levelKey]);
    }
  }
);

on("change:repeating_profiles:name", async (e) => {
  console.log("change:repeating_profiles:name", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await setAttrsAsync({
    repeating_profiles_rowid: `${r}_${section}_${rowId}_`,
  });
  await setDefaultRepeatingRow(section, null, "is_default", "default_profile");
});

on("change:repeating_profiles:mod_iq", async (e) => {
  console.log("change:repeating_profiles:mod_iq", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await iqBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

on(
  "change:repeating_profiles:mod_me \
  change:repeating_profiles:mod_pp \
  change:repeating_profiles:mod_pe",
  async (e) => {
    await mePpPeBonus(e.sourceAttribute, e.newValue);
  }
);

on("change:repeating_profiles:mod_ma", async (e) => {
  console.log("change:repeating_profiles:mod_ma", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await maBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

on(
  "change:repeating_profiles:mod_ps \
  change:repeating_profiles:mod_character_ps_type \
  change:repeating_profiles:mod_liftcarry_weight_multiplier \
  change:repeating_profiles:mod_liftcarry_duration_multiplier",
  async (e) => {
    console.log("change:repeating_profiles:mod_ps", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    await psBonusComplete(`${r}_${section}_${rowId}_mod_`);
  }
);

on("change:repeating_profiles:mod_pb", async (e) => {
  console.log("change:repeating_profiles:mod_pb", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  await pbBonus(e.newValue, `${r}_${section}_${rowId}_mod_`);
});

  /* endinject */

  /* inject:js/combat_skills.js */
  async function updateHandToHands(section) {
  const ids = await getSectionIDsAsync(section);
  const attrKeys = ids
    .reduce((keys, id) => {
      return keys.concat([
        `repeating_${section}_${id}_name`,
        `repeating_${section}_${id}_level`,
        `repeating_${section}_${id}_levelacquired`,
      ]);
    }, [])
    .concat(["character_level"]);

  // const attrNames = ids.map((id) => `repeating_${section}_${id}_name`);
  const a = await getAttrsAsync(attrKeys);
  for (rowId of ids) {
    const rowPrefix = `repeating_${section}_${rowId}`;
    const level = +a[`character_level`] - +a[`${rowPrefix}_levelacquired`] + 1;
    await calculateH2h(
      section,
      rowId,
      rowPrefix,
      a[`${rowPrefix}_name`].toLowerCase(),
      level
    );
  }
}

async function calculateH2h(section, rowId, keyPrefix, lowerCaseName, level) {
  console.log("calculateH2h", section, rowId, keyPrefix, lowerCaseName, level);
  if (!Object.keys(H2H).includes(lowerCaseName)) {
    // Exit if this isn't one of the pre-defined skills
    return;
  }
  const attrs = {};
  const levelBonuses = H2H[lowerCaseName].slice(0, level);
  const totalBonuses = mergeAndAddObjects(levelBonuses);
  console.log(totalBonuses);
  for (const [key, val] of Object.entries(totalBonuses)) {
    attrs[`${keyPrefix}_${key}`] = val;
  }
  attrs[`${keyPrefix}_level`] = level;
  console.log(attrs);
  await setAttrsAsync(attrs);
  await addModifierToBonusesAsync(section, rowId);
}

on("change:repeating_h2h", async (e) => {
  console.log("change:repeating_h2h", e);
  const sourceParts = e.sourceAttribute.split("_");
  const [r, section, rowId] = sourceParts;
  const rowPrefix = `${r}_${section}_${rowId}`;

  const isNew = await isNewRow(e);
  if (isNew) {
    await setRowDefaults(e, { silent: true });
  }

  // Exit if the sheetworker was doing something other than increasing the level.
  if (e.sourceType === "sheetworker" && !e.sourceAttribute.endsWith("_level")) {
    return;
  }
  // Exit if only the name was changed.
  if (!isNew && e.sourceAttribute.endsWith("_name")) {
    return;
  }
  // Exit if no attribute was changed and it's the row itself.
  if (sourceParts.length < 4) {
    return;
  }

  const attrKeys = [
    `${rowPrefix}_name`,
    `${rowPrefix}_levelacquired`,
    `character_level`,
  ];
  const a = await getAttrsAsync(attrKeys);
  const level = +a[`character_level`] - +a[`${rowPrefix}_levelacquired`] + 1;
  await setAttrsAsync({ [`${rowPrefix}_level`]: level });

  const lowerCaseName = a[`${rowPrefix}_name`].toLowerCase();
  if (Object.keys(H2H).includes(lowerCaseName)) {
    // H2H is defined.
    await calculateH2h(section, rowId, rowPrefix, lowerCaseName, level);
  } else {
    // H2H is custom.
    await addModifierToBonusesAsync(section, rowId);
  }
});

on("remove:repeating_h2h", async (e) => {
  console.log("remove h2h", e);
  const bonusRowId = e.removedInfo[`${e.sourceAttribute}_bonus_id`];
  await removeBonusRowsAsync(bonusRowId);
});

  /* endinject */

  /* inject:js/wps.js */
  async function addWpToBonuses(section, rowId, wpName) {
  console.log("addWpToBonuses", section, rowId);
  if (!section || !rowId || !wpName) {
    return;
  }
  const wpActions = WP_KEYS[section];
  const wpAttrs = wpActions.map(
    (action) => `repeating_${section}_${rowId}_${action}`
  );
  const wpCombatId = `repeating_${section}_${rowId}_bonus_id`;
  wpAttrs.push(wpCombatId);
  const a = await getAttrsAsync(wpAttrs);
  const attrs = {};
  let combatRowId;
  if (a[wpCombatId]) {
    combatRowId = a[wpCombatId];
  } else {
    combatRowId = generateRowID();
    attrs[wpCombatId] = combatRowId;
  }
  REPEATING_BONUS_KEYS.forEach((key) => {
    attrs[`repeating_bonuses_${combatRowId}_${key}`] =
      a[`repeating_${section}_${rowId}_${key}`] || 0;
  });
  await setAttrsAsync(attrs);
}

async function setWpRow(section, name, keyPrefix, level) {
  console.log("setWpRow", name, keyPrefix, level);
  const attrs = {};
  const levelBonuses = WP[name.toLowerCase()].slice(0, level);
  const totalBonuses = mergeAndAddObjects(levelBonuses);
  /**
   * These values shouldn't be accumulated.
   */
  const nonActions = ["name", "level", "levelacquired"];
  WP_KEYS[section].forEach((action) => {
    if (nonActions.includes(action)) {
      return;
    }
    const key = `${keyPrefix}_${action}`;
    attrs[key] = action in totalBonuses ? totalBonuses[action] : 0;
  });
  await setAttrsAsync(attrs);
}

async function setWp({ section, rowId, rowPrefix }) {
  const attrKeys = [
    `${rowPrefix}_name`,
    `${rowPrefix}_levelacquired`,
    `character_level`,
  ];
  const a = await getAttrsAsync(attrKeys);
  console.log(a);
  const level = +a[`character_level`] - +a[`${rowPrefix}_levelacquired`] + 1;
  await setAttrsAsync({ [`${rowPrefix}_level`]: level }, { silent: true });

  const lowerCaseName = a[`${rowPrefix}_name`].toLowerCase();
  if (Object.keys(WP).includes(lowerCaseName)) {
    // pre-defined WP
    await setWpRow(section, lowerCaseName, rowPrefix, level);
  } else {
    // user-defined
    await addModifierToBonusesAsync(section, rowId);
  }
  await addWpToBonuses(section, rowId, lowerCaseName);
}

on("change:repeating_wp change:repeating_wpmodern", async (e) => {
  console.log("change:repeating_wp change:repeating_wpmodern", e);
  const sourceParts = e.sourceAttribute.split("_");
  const [r, section, rowId] = sourceParts;
  const rowPrefix = `${r}_${section}_${rowId}`;

  const isNew = await isNewRow(e);
  if (isNew) {
    await setRowDefaults(e, { silent: true });
  }
  console.log("isNew", isNew);

  // Exit if the sheetworker was doing something other than increasing the level.
  if (e.sourceType === "sheetworker" && !e.sourceAttribute.endsWith("_level")) {
    return;
  }
  // Exit if only the name was changed.
  if (!isNew && e.sourceAttribute.endsWith("_name")) {
    return;
  }
  // Exit if no attribute was changed and it's the row itself.
  if (sourceParts.length < 4) {
    return;
  }

  await setWp({ section, rowId, rowPrefix });
});

/**
 * This is called by the level up function.
 * @param {*} section
 */
async function updateWeaponProficiencies(section) {
  const ids = await getSectionIDsAsync(section);
  const attrNames = ids.map((id) => `repeating_${section}_${id}_name`);
  const a = await getAttrsAsync(attrNames);
  for (rowId of ids) {
    const rowPrefix = `repeating_${section}_${rowId}`;
    await setWp({ section, rowId, rowPrefix });
  }
}

  /* endinject */

  /* inject:js/modifiers.js */
  /**
 * User adds a thing to repeating_modifiers
 * -> addModifierToBonuses
 * -> triggers "change:repeating_bonuses:name"
 * -> addBonusToSelections
 */

async function addModifierToBonusesAsync(section, rowId) {
  console.log("addModifierToBonusesAsync", section, rowId);
  if (!section || !rowId) {
    return;
  }

  const thingBonusId = `repeating_${section}_${rowId}_bonus_id`;
  const thingAttrs = REPEATING_BONUS_KEYS.map(
    (key) => `repeating_${section}_${rowId}_${key}`
  );
  thingAttrs.push(thingBonusId);
  const a = await getAttrsAsync(thingAttrs);
  console.log(a);
  const attrs = {};
  let bonusRowId;
  if (a[thingBonusId]) {
    bonusRowId = a[thingBonusId];
  } else {
    bonusRowId = generateRowID();
    attrs[thingBonusId] = bonusRowId;
  }
  REPEATING_BONUS_KEYS.forEach((key) => {
    attrs[`repeating_bonuses_${bonusRowId}_${key}`] =
      a[`repeating_${section}_${rowId}_${key}`] || 0;
  });
  await setAttrsAsync(attrs);
}

on(
  "change:repeating_modifiers \
  change:repeating_powersabilities \
  change:repeating_magic \
  change:repeating_psionics",
  async (e) => {
    console.log("change:repeating_modifiers", e);
    const sourceParts = e.sourceAttribute.split("_");
    if (
      e.sourceAttribute.endsWith("_bonus_id") ||
      e.sourceAttribute.endsWith("_rowid") ||
      e.sourceAttribute.endsWith("_addtobonuses") ||
      e.sourceAttribute.endsWith("_description") ||
      sourceParts.length < 4
    ) {
      return;
    }
    const [r, section, rowId] = sourceParts;
    await setAttrsAsync({
      [`${r}_${section}_rowid`]: `${r}_${section}_${rowId}_`,
    });
    if (section == "modifiers") {
      await addModifierToBonusesAsync(section, rowId);
    } else {
      const addToBonusesKey = `${r}_${section}_${rowId}_addtobonuses`;
      const a = await getAttrsAsync([addToBonusesKey]);
      const addToBonuses = Boolean(Number(a[addToBonusesKey]));
      if (addToBonuses) {
        await addModifierToBonusesAsync(section, rowId);
      }
    }
  }
);

on(
  "remove:repeating_modifiers \
  remove:repeating_powersabilities \
  remove:repeating_magic \
  remove:repeating_psionics",
  async (e) => {
    console.log("remove:repeating_modifiers", e);
    // remove repeating_bonusselections row with the same index
    const bonusRowId = e.removedInfo[`${e.sourceAttribute}_bonus_id`];
    await removeBonusRowsAsync(bonusRowId);
  }
);

  /* endinject */

  /* inject:js/armor.js */
  async function applyDamageToNextActiveArmor(section, damage) {
  console.log("applyDamageToNextActiveArmor", section, damage);
  const ids = await getSectionIDsOrderedAsync(section);
  const attrKeys = ids
    .flatMap((id) => [
      `repeating_${section}_${id}_is_active`,
      `repeating_${section}_${id}_mdc`,
    ])
    .concat(["outputarmorwarnings"]);
  const attrs = {};
  const a = await getAttrsAsync(attrKeys);
  let damageCarry = damage;
  // let nextCurrentMdc = false;
  let currentMdc = false;

  const activeIds = ids.reduce((acc, cur) => {
    if (Boolean(Number(a[`repeating_${section}_${cur}_is_active`]))) {
      acc.push(cur);
    }
    return acc;
  }, []);

  let i = 0;
  let activeRowId;
  for (activeRowId of activeIds) {
    currentMdc = +a[`repeating_${section}_${activeRowId}_mdc`] - damageCarry;
    if (currentMdc < 0 && ++i < activeIds.length) {
      console.log(
        "applyDamageToNextActiveArmor",
        "BELOW ZERO on " + activeRowId
      );
      const { character_name: characterName } = await getAttrsAsync([
        "character_name",
      ]);
      if (Boolean(Number(a["outputarmorwarnings"]))) {
        const warning = await startRoll(
          `${characterName} is taking damage to their last layer!`
        );
        finishRoll(warning.rollId);
      }
      attrs[`repeating_${section}_${activeRowId}_mdc`] = 0;
      damageCarry = Math.abs(currentMdc);
    } else {
      attrs[`repeating_${section}_${activeRowId}_mdc`] = currentMdc;
      break;
    }
  }
  await setAttrsAsync(attrs);
  await updateActiveArmor(activeRowId);
  return currentMdc;
}

/**
 * Updates the global active_armor attributes with the values
 * from the currently active repeating armor row
 * @param {string} rowId Row ID of the active armor row
 */
async function updateActiveArmor(rowId) {
  console.log("updateActiveArmor", ARMOR_KEYS.length);
  const attrKeys = ARMOR_KEYS.map((key) => `repeating_armor_${rowId}_${key}`);
  const a = await getAttrsAsync(attrKeys);
  const attrs = ARMOR_KEYS.reduce((acc, cur) => {
    if (a[`repeating_armor_${rowId}_${cur}`] !== undefined) {
      if (cur === "mdc") {
        acc[`active_armor_mdc`] = a[`repeating_armor_${rowId}_${cur}`];
      } else if (cur === "mdc_max") {
        acc[`active_armor_mdc_max`] = a[`repeating_armor_${rowId}_${cur}`];
      } else {
        acc[`active_armor_${cur}`] = a[`repeating_armor_${rowId}_${cur}`];
        acc[`active_armor_${cur}_max`] = a[`repeating_armor_${rowId}_${cur}`];
      }
    }
    return acc;
  }, {});
  console.log(attrs);
  await setAttrsAsync(attrs);
}

on("change:repeating_armor:movementpenalty", async (e) => {
  await recalculateMovement();
});

on("clicked:armorapplydamage", async (e) => {
  console.log("clicked:armorapplydamage", e);
  const a = await getAttrsAsync([
    `armordamage`,
    `character_name`,
    `active_armor_mdc`,
    `active_armor_name`,
    `outputusage`,
  ]);
  const currentMdc = await applyDamageToNextActiveArmor(
    "armor",
    +a[`armordamage`]
  );
  const outputUsage = Boolean(Number(a.outputusage));
  if (outputUsage) {
    // const b = await getAttrsAsync([`active_armor_mdc`, `active_armor_name`]);
    const chat = await startRoll(
      `@{opt_whisper}&{template:damage} {{character_name=${
        a["character_name"]
      }}} {{spent=${a["armordamage"]}}} {{name=${
        a[`active_armor_name`]
      }}} {{remaining=${currentMdc}}}`
    );
    finishRoll(chat.rollId);
  }
});

on("clicked:repeating_armor:resetmdc", async (e) => {
  console.log("clicked:repeating_armor:resetmdc", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const a = await getAttrsAsync([`repeating_armor_${rowId}_mdc_max`]);
  await setAttrsAsync({
    [`repeating_armor_${rowId}_mdc`]: a[`repeating_armor_${rowId}_mdc_max`],
  });
  await updateActiveArmor(rowId);
});

on("change:repeating_armor:is_active", async (e) => {
  await recalculateMovement();
  await applyDamageToNextActiveArmor("armor", 0);
});

  /* endinject */

  /* inject:js/profiles.js */
  async function getDefaultProfileID() {
  const { default_profile } = await getAttrsAsync(["default_profile"]);
  return default_profile;
}

async function updateActiveProfile(rowId) {
  console.log("updateActiveProfile", REPEATING_BONUS_KEYS.length);
  const attrKeys = REPEATING_BONUS_KEYS.map(
    (key) => `repeating_profiles_${rowId}_${key}`
  );
  const a = await getAttrsAsync(attrKeys);
  const attrs = REPEATING_BONUS_KEYS.reduce((acc, cur, idx) => {
    if (a[`repeating_profiles_${rowId}_${cur}`] !== undefined) {
      acc[`active_profile_${cur}`] = a[`repeating_profiles_${rowId}_${cur}`];
      acc[`active_profile_${cur}_max`] =
        a[`repeating_profiles_${rowId}_${cur}`];
    }
    return acc;
  }, {});
  console.log(attrs);
  await setAttrsAsync(attrs);
}

//   const a = await getAttrsAsync(["psionic_ability"]);
//   const attrs = {};
//   attrs[`repeating_${section}_${rowId}_global_psionic_ability`] =
//     a["psionic_ability"];

async function updateProfile(rowId) {
  const bonusIds = (
    await getAttrsAsync(["repeating_profiles_bonus_ids"])
  ).repeating_profiles_bonus_ids.split(",");
  console.log(bonusIds);
  const bonusNameKeys = bonusIds.map((id) => `repeating_bonuses_${id}_name`);
  const a = await getAttrsAsync(bonusNameKeys);
  const names = Object.values(a).reduce(
    // using Em Space https://www.compart.com/en/unicode/U+2003
    (acc, cur) => `${acc}     ✔︎${cur}`.trim(),
    ""
  );
  const globals = await getAttrsAsync(["psionic_ability"]);
  await setAttrsAsync({
    [`repeating_profiles_${rowId}_bonus_names`]: names,
    [`repeating_profiles_${rowId}_rowid`]: `repeating_profiles_${rowId}_`,
    [`repeating_profiles_${rowId}_global_psionic_ability`]:
      globals["psionic_ability"],
  });
  await combineBonuses(bonusIds, `repeating_profiles_${rowId}`);
  const isActive = await isDefault("profiles", rowId);
  if (isActive) {
    await updateActiveProfile(rowId);
  }
}

async function setSingleAttributeFromDefaultProfile(attrName, profileAttrName) {
  const profileMeta = await getAttrsAsync(["default_profile"]);
  const repeatingAttribute = `repeating_profiles_${profileMeta["default_profile"]}_${profileAttrName}`;
  const a = await getAttrsAsync([repeatingAttribute]);
  await setAttrsAsync({ [attrName]: +a[repeatingAttribute] });
}

/**
 * Whether or not the current row is set as default
 * @param {string} rowId The Profile row ID
 * @returns boolean
 */
async function isDefault(section, rowId, attrName = "is_default") {
  const rowKey = `repeating_${section}_${rowId}_${attrName}`;
  const a = await getAttrsAsync([rowKey]);
  return a[rowKey] == "1";
}

async function setDefaultRepeatingRowAndUnsetOthers(
  section,
  rowId,
  attrName = "is_default",
  attrCurrent = "default_profile"
) {
  console.log("setDefaultRepeatingRowAndUnsetOthers", section, rowId, attrName);
  const rowIds = await getSectionIDsAsync(section);
  const isDefaultKeys = rowIds.map(
    (id) => `repeating_${section}_${id}_${attrName}`
  );
  const a = await getAttrsAsync(isDefaultKeys);
  const attrs = Object.entries(a).reduce((acc, [key, value]) => {
    acc[key] = "0";
    return acc;
  }, {});
  attrs[`repeating_${section}_${rowId}_${attrName}`] = "1";
  attrs[attrCurrent] = rowId;
  await setAttrsAsync(attrs);
}

/**
 * Sets the default row
 *  - Only row
 *  - A row that was set as default was deleted
 * @param {string} section Repeating section name.
 * @param {string} rowId Row ID that triggered this function. If a valid string, this
 *    row is set as default.
 * @param {string} attrName Attribute name to look for if different than "is_default".
 * @param {string} attrCurrent The attribute that holds the value of the current default row.
 */
async function setDefaultRepeatingRow(
  section,
  rowId,
  attrName = "is_default",
  attrCurrent = "default_profile"
) {
  if (rowId) {
    await setDefaultRepeatingRowAndUnsetOthers(
      section,
      rowId,
      attrName,
      attrCurrent
    );
    return;
  }

  const rowIds = await getSectionIDsOrderedAsync(section);
  const firstRow = `repeating_${section}_${rowIds[0]}_${attrName}`;

  const attrs = {};
  attrs[firstRow] = "1";
  attrs[attrCurrent] = rowIds[0];

  if (rowIds.length < 1) {
    await setAttrsAsync({ [attrCurrent]: "" });
    return;
  }

  if (rowIds.length === 1) {
    await setAttrsAsync(attrs);
    return;
  }

  // Was something deleted? If there's no current default, set the top item.
  const isDefaultKeys = rowIds.map(
    (id) => `repeating_${section}_${id}_${attrName}`
  );
  const a = await getAttrsAsync(isDefaultKeys);
  const isDefaultSet = Object.values(a).some((value) => +value == 1);
  if (!isDefaultSet) {
    await setAttrsAsync(attrs);
  }
}

on("change:default_profile", async (e) => {
  console.log("change:default_profile", e);
  if (e.newValue == "") {
    return;
  }
  const prefix = `repeating_profiles_${e.newValue}`;
  const a = await getAttrsAsync([`${prefix}_mdc`]);
  await setAttrsAsync({ default_mdc: a[`${prefix}_mdc`] });
  await updateSkills();
  await updateActiveProfile(e.newValue);
});

on("change:repeating_profiles:is_default", async (e) => {
  console.log("clicked:repeating_profiles:is_default", e);
  if (e.newValue != "1") {
    if (e.sourceType == "player") {
      // check it - don't allow unchecking
      await setAttrsAsync({ [e.sourceAttribute]: "1" });
    }
    return;
  }
  const [r, section, rowId, ...attrNameArray] = e.sourceAttribute.split("_");
  const attrName = attrNameArray.join("_");
  await setDefaultRepeatingRow(section, rowId, attrName, "default_profile");
});

on("clicked:repeating_profiles:copybonusids", async (e) => {
  console.log("clicked:copybonusids", e);
  const a = await getAttrsAsync(["bonus_ids_output"]);
  const attrs = {};
  attrs[`repeating_profiles_bonus_ids`] = a.bonus_ids_output;
  await setAttrsAsync(attrs);
});

on("clicked:repeating_profiles:checkbonusids", async (e) => {
  console.log("clicked:repeating_profiles:checkbonusids", e);
  const a = await getAttrsAsync(["repeating_profiles_bonus_ids"]);
  console.log(a);
  const bonusIds = a["repeating_profiles_bonus_ids"].split(",");
  const bonusselectionsSectionIds = await getSectionIDsAsync("bonusselections");
  const bonusIdKeys = bonusselectionsSectionIds.map(
    (id) => `repeating_bonusselections_${id}_bonus_id`
  );
  const allBonusselectionsIds = await getAttrsAsync(bonusIdKeys);
  console.log(allBonusselectionsIds);
  const attrs = {};
  for (const [key, val] of Object.entries(allBonusselectionsIds)) {
    const [r, section, rowId] = key.split("_");
    attrs[`repeating_bonusselections_${rowId}_enabled`] = bonusIds.includes(val)
      ? "1"
      : "0";
  }
  await setAttrsAsync(attrs);
});

on(
  "clicked:repeating_profiles:updateprofile \
  change:repeating_profiles:bonus_ids",
  async (e) => {
    console.log("clicked:repeating_profiles:updateprofile", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    await updateProfile(rowId);
  }
);

// on("change:repeating_profiles", async (e) => {
//   console.log("change:repeating_profiles", e);
//   const [r, section, rowId] = e.sourceAttribute.split("_");
//   const a = await getAttrsAsync(["psionic_ability"]);
//   const attrs = {};
//   attrs[`repeating_${section}_${rowId}_global_psionic_ability`] =
//     a["psionic_ability"];
//   await setAttrsAsync(attrs);
// });

on("change:_reporder:profiles", async (e) => {
  console.log("change:_reporder:profiles", e);
});

on("change:repeating_profiles:mod_skillbonus", async (e) => {
  console.log("change:repeating_profiles:mod_skillbonus", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  if (await isDefault(section, rowId)) {
    await updateSkills();
  }
});

on("remove:repeating_profiles", async (e) => {
  console.log("remove:repeating_profiles", e);
  await setDefaultRepeatingRow("profiles");
});

on("clicked:getdefaultprofile", async (e) => {
  console.log("clicked:getdefaultprofile", e);
  const a = await getAttrsAsync(["default_profile", "default_mdc"]);
  console.log(a);
});

on("clicked:active_profile_initiative_turntracker", async (e) => {
  console.log("clicked:active_profile_initiative_turntracker", e);
  await palladiumAddToTurnTracker(
    "active_profile_initiative",
    "active_profile_attacks"
  );
});

  /* endinject */

  /* inject:js/attributes.js */
  async function iqBonus(value, prefix = "") {
  console.log("iqBonus", value, prefix);

  const attrs = {};
  attrs[`${prefix}iq_bonus`] = value > 15 ? value - 14 : 0;

  // check if Perception option is enabled
  const { opt_iq_perception } = await getAttrsAsync(["opt_iq_perception"]);
  if (!!+opt_iq_perception) {
    const perception_bonus = getBiAttributeBonus(value);
    attrs[`${prefix}perception_bonus`] = perception_bonus;
  }

  console.log(attrs);
  await setAttrsAsync(attrs);

  const defaultProfile = await getDefaultProfileID();
  const profilesSections = await getSectionIDsAsync("profiles");
  if (!profilesSections || prefix.includes(defaultProfile)) {
    await updateSkills();
  }
}

async function mePpPeBonus(attribute, value, prefix = "") {
  console.log("mePpPeBonus", attribute, value, prefix);
  const bonus = getBiAttributeBonus(value);
  const attrs = {};
  attrs[`${prefix}${attribute}_bonus`] = bonus;
  if (attribute.endsWith("pe")) {
    attrs[`${prefix}${attribute}_coma_bonus`] =
      value >= 16
        ? value <= 18
          ? 4 + (value - 16)
          : value <= 30
          ? 8 + (value - 19) * 2
          : 30 + (value - 30)
        : 0;
    attrs[`${prefix}run_at_max`] = Math.round(value / 2);
  }
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function maBonus(value, prefix = "") {
  const ma_bonus =
    value >= 16
      ? value <= 24
        ? 40 + (value - 16) * 5
        : value <= 27
        ? 80 + (value - 24) * 4
        : value <= 29
        ? 92 + (value - 27) * 2
        : 97
      : 0;
  setAttrs({
    [`${prefix}ma_bonus`]: ma_bonus,
    [`${prefix}trust`]: ma_bonus,
    [`${prefix}intimidate`]: ma_bonus,
  });
}

async function psBonus(prefix = "") {
  const a = await getAttrsAsync([`${prefix}ps`]);
  const ps = +a[`${prefix}ps`];
  const ps_bonus = ps > 15 ? ps - 15 : 0;
  const attrs = { [`${prefix}ps_bonus`]: ps_bonus };
  await setAttrsAsync(attrs);
}

async function psBonusComplete(prefix = "") {
  const a = await getAttrsAsync([
    `${prefix}ps`,
    `${prefix}character_ps_type`,
    `${prefix}pe`,
    `${prefix}liftcarry_weight_multiplier`,
    `${prefix}liftcarry_duration_multiplier`,
  ]);
  const ps = +a[`${prefix}ps`];
  const pe = +a[`${prefix}pe`];
  const ps_type = a[`${prefix}character_ps_type`];
  const liftcarry_weight_multiplier =
    +a[`${prefix}liftcarry_weight_multiplier`];
  const liftcarry_duration_multiplier =
    +a[`${prefix}liftcarry_duration_multiplier`];
  const ps_bonus = ps > 15 ? ps - 15 : 0;

  let restrained_punch = (punch = power_punch = kick = leap_kick = "");
  let restrained_punch_unit =
    (punch_unit =
    power_punch_unit =
    kick_unit =
    leap_kick_unit =
      "sdc");

  let carry = ps < 17 ? ps * 10 : ps * 20;
  let lift = carry * 2;
  let hold_max = Math.round((pe * 3) / 15);
  let throw_distance = ps;
  let name = "";

  switch (ps_type) {
    case "1":
      name = "Normal";
      punch = "1D4";
      kick = "1D4";
      break;
    case "2":
      name = "Augmented";
      throw_distance = ps * 2;
      if (ps < 24) {
        // nop
      } else if (ps == 24) {
        power_punch = "1";
        power_punch_unit = "mdc";
      } else if (ps <= 27) {
        power_punch = "1D4";
        power_punch_unit = "mdc";
      } else if (ps <= 30) {
        power_punch = "1D6";
        power_punch_unit = "mdc";
      } else if (ps <= 40) {
        power_punch = "2D4";
        power_punch_unit = "mdc";
      } else if (ps <= 50) {
        restrained_punch = "3D6";
        punch = "1D4";
        punch_unit = "mdc";
        power_punch = "3D4";
        power_punch_unit = "mdc";
      } else {
        restrained_punch = "4D6";
        punch = "1D8";
        punch_unit = "mdc";
        power_punch = "4D4";
        power_punch_unit = "mdc";
      }
      break;
    case "3":
    case "3.5":
      name = ps_type === "3" ? "Robotic" : "Giant Robotic";
      if (ps >= 17) {
        if (ps_type == "3") {
          lift = carry = ps * 25;
        } else {
          lift = carry = ps * 100;
        }
      }
      hold_max = 0;
      throw_distance = ps * 3;
      if (ps <= 15) {
        restrained_punch = "1D6";
        punch = "2D6";
        power_punch = "4D6";
        kick = "2D6";
        leap_kick = "3D6";
      } else if (ps <= 20) {
        restrained_punch = "2D6";
        punch = "1";
        power_punch = "1D6";
        kick = "1D4";
        leap_kick = "2D4";
        punch_unit = power_punch_unit = kick_unit = leap_kick_unit = "mdc";
      } else if (ps <= 25) {
        restrained_punch = "6D6";
        punch = "1D4";
        power_punch = "2D4";
        kick = "1D6";
        leap_kick = "2D6";
        punch_unit = power_punch_unit = kick_unit = leap_kick_unit = "mdc";
      } else if (ps <= 30) {
        restrained_punch = "1D4";
        punch = "1D6";
        power_punch = "2D6";
        kick = "2D4";
        leap_kick = "2D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 35) {
        restrained_punch = "1D4";
        punch = "2D4";
        power_punch = "4D4";
        kick = "2D8";
        leap_kick = "4D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 40) {
        restrained_punch = "1D4";
        punch = "2D6";
        power_punch = "4D6";
        kick = "3D8";
        leap_kick = "5D8";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else if (ps <= 50) {
        restrained_punch = "1D6";
        punch = "3D6";
        power_punch = "1D6*10";
        kick = "5D8";
        leap_kick = "1D8*10";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      } else {
        restrained_punch = "2D6";
        punch = "6D6";
        power_punch = "2D6*10";
        kick = "6D8";
        leap_kick = "2D6*10";
        restrained_punch_unit =
          punch_unit =
          power_punch_unit =
          kick_unit =
          leap_kick_unit =
            "mdc";
      }
      break;
    case "4":
      name = "Supernatural";
      if (ps >= 18) {
        carry = ps * 50;
      } else {
        carry = ps * 20;
      }
      lift = carry * 2;
      hold_max = pe * 4;
      if (ps <= 16) {
        throw_distance = ps * 3;
      } else {
        throw_distance = ps * 5;
      }
      if (ps <= 15) {
        restrained_punch = "1D6";
        punch = "4D6";
        power_punch = "1D4";
        power_punch_unit = "mdc";
      } else if (ps <= 20) {
        restrained_punch = "3D6";
        punch = "1D6";
        power_punch = "2D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 25) {
        restrained_punch = "4D6";
        punch = "2D6";
        power_punch = "4D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 30) {
        restrained_punch = "5D6";
        punch = "3D6";
        power_punch = "6D6";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 35) {
        restrained_punch = "5D6";
        punch = "4D6";
        power_punch = "1D4*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 40) {
        restrained_punch = "6D6";
        punch = "5D6";
        power_punch = "1D6*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 50) {
        restrained_punch = "1D6*10";
        punch = "6D6";
        power_punch = "2D4*10";
        punch_unit = power_punch_unit = "mdc";
      } else if (ps <= 60) {
        restrained_punch = "1D6";
        punch = "1D6*10";
        power_punch = "2D6*10";
        restrained_punch_unit = punch_unit = power_punch_unit = "mdc";
      } else {
        // > 60
        const extra = Math.ceil((ps - 60) / 10) * 10;
        restrained_punch = "1D6";
        punch = `1D6*10+${extra}`;
        power_punch = `2D6*10+${extra * 2}`;
        restrained_punch_unit = punch_unit = power_punch_unit = "mdc";
      }
      break;
  }
  if (liftcarry_weight_multiplier > 0) {
    lift *= liftcarry_weight_multiplier;
    carry *= liftcarry_weight_multiplier;
    throw_distance *= liftcarry_weight_multiplier;
  }
  if (liftcarry_duration_multiplier > 0) {
    hold_max *= liftcarry_duration_multiplier;
  }
  const attrs = {
    [`${prefix}character_ps_type_name`]: name,
    [`${prefix}ps_bonus`]: ps_bonus,
    [`${prefix}restrained_punch`]: restrained_punch,
    [`${prefix}punch`]: punch,
    [`${prefix}power_punch`]: power_punch,
    [`${prefix}kick`]: kick,
    [`${prefix}leap_kick`]: leap_kick,
    [`${prefix}restrained_punch_unit`]: restrained_punch_unit,
    [`${prefix}punch_unit`]: punch_unit,
    [`${prefix}power_punch_unit`]: power_punch_unit,
    [`${prefix}kick_unit`]: kick_unit,
    [`${prefix}leap_kick_unit`]: leap_kick_unit,
    [`${prefix}lift`]: lift,
    [`${prefix}carry`]: carry,
    [`${prefix}hold_max`]: hold_max,
    [`${prefix}throw_distance`]: throw_distance,
  };
  console.log(attrs);
  await setAttrsAsync(attrs);
}

async function pbBonus(value, prefix = "") {
  const pb_bonus =
    value >= 16
      ? value <= 26
        ? 30 + (value - 16) * 5
        : value <= 28
        ? 80 + (value - 26) * 3
        : value == 29
        ? 90
        : 92
      : 0;
  await setAttrsAsync({
    [`${prefix}pb_bonus`]: pb_bonus,
    [`${prefix}charmimpress`]: pb_bonus,
  });
}

// DEPRECATED
async function spdBonus(value) {
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = value * 15;
  const attrs = {
    run_mph: ((feetPerMelee * 4 * 60) / 5280).toFixed(1),
    run_ft_melee: feetPerMelee,
    run_ft_attack: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
}

on("change:iq", async (e) => {
  await iqBonus(e.newValue);
});

on("change:me change:pp change:pe", async (e) => {
  await mePpPeBonus(e.sourceAttribute, e.newValue);
});

on("change:ma", async (e) => {
  await maBonus(e.newValue);
});

on("change:ps change:character_ps_type", async (e) => {
  await psBonus();
});

on("change:pb", async (e) => {
  await pbBonus(e.newValue);
});

on("change:spd", async (e) => {
  recalculateMovement();
});

  /* endinject */

  /* inject:js/skills.js */
  async function updateSkill(rowId) {
  const row = `repeating_skills_${rowId}`;
  const keys = SKILL_KEYS.map((key) => `${row}_${key}`).concat([
    "default_profile",
    "character_level",
  ]);
  console.log("keys", keys);
  const a = await getAttrsAsync(keys);
  console.log(a);

  const level = +a["character_level"] - +a[`${row}_levelacquired`] + 1;

  const iqBonusKey = `repeating_profiles_${a["default_profile"]}_mod_iq_bonus`;
  const skillBonusKey = `repeating_profiles_${a["default_profile"]}_mod_skillbonus`;
  const profileKeys = [iqBonusKey, skillBonusKey];
  console.log("profileKeys", profileKeys);
  const profileBonuses = await getAttrsAsync(profileKeys);
  console.log(profileBonuses);

  const total =
    +a[`${row}_base`] +
    +a[`${row}_bonus`] +
    (level - 1) * +a[`${row}_perlevel`] +
    (+profileBonuses[iqBonusKey] || 0) +
    (+profileBonuses[skillBonusKey] || 0);
  console.log("total", total);
  await setAttrsAsync({ [`${row}_total`]: total, [`${row}_level`]: level });
}

async function updateSkills() {
  console.log("updateSkills");
  const ids = await getSectionIDsAsync("skills");
  const keys = ids
    .reduce((acc, cur) => {
      const row = `repeating_skills_${cur}`;
      const skillKeys = SKILL_KEYS.map((key) => `${row}_${key}`);
      return acc.concat(skillKeys);
    }, [])
    .concat(["default_profile"]);
  console.log("keys", keys);
  const a = await getAttrsAsync(keys);
  console.log("a", a);
  // calculate IQ bonus once we know the default_profile
  const iqBonusKey = `repeating_profiles_${a["default_profile"]}_mod_iq_bonus`;
  const skillBonusKey = `repeating_profiles_${a["default_profile"]}_mod_skillbonus`;
  const profileKeys = [iqBonusKey, skillBonusKey];
  console.log("profileKeys", profileKeys);
  const profileBonuses = await getAttrsAsync(profileKeys);
  console.log("profileBonuses", profileBonuses);
  const totals = ids.reduce((acc, cur) => {
    const row = `repeating_skills_${cur}`;
    const total =
      +a[`${row}_base`] +
      +a[`${row}_bonus`] +
      (+a[`${row}_level`] - 1) * +a[`${row}_perlevel`] +
      (+profileBonuses[iqBonusKey] || 0) +
      (+profileBonuses[skillBonusKey] || 0);
    acc[`${row}_total`] = total;
    return acc;
  }, {});
  console.log("totals", totals);
  await setAttrsAsync(totals);
}

async function updateSkillLevels() {
  const ids = await getSectionIDsAsync("skills");
  const attrKeys = ids
    .reduce((keys, id) => {
      keys.push(`repeating_skills_${id}_level`);
      keys.push(`repeating_skills_${id}_levelacquired`);
      return keys;
    }, [])
    .concat(["character_level"]);
  const a = await getAttrsAsync(attrKeys);
  const attrs = {};
  ids.forEach((id) => {
    attrs[`repeating_skills_${id}_level`] =
      +a[`character_level`] - +a[`repeating_skills_${id}_levelacquired`] + 1;
  });
  await setAttrsAsync(attrs);
}

on("change:repeating_skills", async (e) => {
  console.log("change:repeating_skills", e);
  const sourceParts = e.sourceAttribute.split("_");
  const [r, section, rowId] = sourceParts;

  const isNew = await isNewRow(e);
  if (isNew) {
    await setRowDefaults(e, { silent: true });
  }

  // Exit if the sheetworker was doing something other than increasing the level.
  if (e.sourceType === "sheetworker" && !e.sourceAttribute.endsWith("_level")) {
    return;
  }
  // Exit if only the name was changed.
  if (!isNew && e.sourceAttribute.endsWith("_name")) {
    return;
  }
  // Exit if no attribute was changed and it's the row itself.
  if (sourceParts.length < 4) {
    return;
  }

  await updateSkill(rowId);
});

  /* endinject */

  /* inject:js/magic_psionics_abilities.js */
  on("clicked:repeating_magic:usespell", async (e) => {
  console.log(e);
  const a = await getAttrsAsync([
    "repeating_magic_ppecost",
    "currentppe",
    "repeating_magic_name",
    "character_name",
    "outputusage",
  ]);
  console.log(a);
  const newppe = a.currentppe - a.repeating_magic_ppecost;
  await setAttrsAsync({ currentppe: newppe });
  const outputUsage = Boolean(Number(a.outputusage));
  if (outputUsage) {
    const chat = await startRoll(
      `@{opt_whisper}&{template:castspell} {{character_name=${
        a["character_name"]
      }}} {{spent=${a["repeating_magic_ppecost"]}}} {{name=${
        a[`repeating_magic_name`]
      }}} {{remaining=${newppe}}}`
    );
    finishRoll(chat.rollId);
  }
});

on("clicked:resetppe", async (e) => {
  console.log("clicked:resetppe", e);
  await setSingleAttributeFromDefaultProfile("currentppe", "ppe");
});

on("clicked:repeating_psionics:usepsionic", async (e) => {
  console.log(e);
  const a = await getAttrsAsync([
    "repeating_psionics_ispcost",
    "repeating_psionics_name",
    "currentisp",
    "character_name",
    "outputusage",
  ]);
  console.log(a);
  const newisp = a.currentisp - a.repeating_psionics_ispcost;
  await setAttrsAsync({ currentisp: newisp });
  const outputUsage = Boolean(Number(a.outputusage));
  if (outputUsage) {
    const chat = await startRoll(
      `@{opt_whisper}&{template:usepsionic} {{character_name=${
        a["character_name"]
      }}} {{spent=${a["repeating_psionics_ispcost"]}}} {{name=${
        a[`repeating_psionics_name`]
      }}} {{remaining=${newisp}}}`
    );
    finishRoll(chat.rollId);
  }
});

on("clicked:resetisp", async (e) => {
  console.log("clicked:resetisp", e);
  await setSingleAttributeFromDefaultProfile("currentisp", "isp");
});

async function calculateRangeDuration(row) {
  console.log("calculateRangeDuration", row);
  const attrNames = ["starting", "per_level", "unit"].map(
    (subProp) => `${row}_${subProp}`
  );
  console.log(attrNames);
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const value =
    +a[`${row}_starting`] + (+a.character_level - 1) * +a[`${row}_per_level`];
  const unit = a[`${row}_unit`];
  const valueWithUnits = `${value} ${unit}`;
  await setAttrsAsync({ [row]: valueWithUnits });
}

async function calculatePercentage(row) {
  const attrNames = ["starting", "per_level"].map(
    (subProp) => `${row}_${subProp}`
  );
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const value =
    +a[`${row}_starting`] + (+a.character_level - 1) * +a[`${row}_per_level`];
  await setAttrsAsync({ [row]: value });
}

async function calculateDamage(row) {
  const attrNames = ["starting", "per_level", "unit"].map(
    (subProp) => `${row}_${subProp}`
  );
  const a = await getAttrsAsync(attrNames.concat(["character_level"]));
  console.log(a);
  const perLevel = a[`${row}_per_level`];
  const starting = a[`${row}_starting`];
  const unit = a[`${row}_unit`];
  let damage = "";
  if (starting != "" && starting != "0") {
    damage = starting;
  }
  if (perLevel != "" && perLevel != "0" && a.character_level > 1) {
    if (!damage) {
      damage = "0"; // Give a base of "0" so that the "+" is adding to something
    }
    damage += `+${perLevel}`.repeat(a.character_level - 1);
  }
  await setAttrsAsync({ [row]: damage });
}

async function updateMagicPsionicsLevels() {
  for (const section of ABILITIES_REPEATERS) {
    const ids = await getSectionIDsAsync(section);
    for (const id of ids) {
      const row = `repeating_${section}_${id}`;
      console.log("updateMagicPsionicsLevels", row);
      await calculateDamage(`${row}_damage`);
      await calculatePercentage(`${row}_percentage`);
      await calculateRangeDuration(`${row}_range`);
      await calculateRangeDuration(`${row}_duration`);
      await calculateRangeDuration(`${row}_frequency`);
      await calculateRangeDuration(`${row}_dc`);
    }
  }
}

const nameListeners = ABILITIES_REPEATERS.map(
  (repeater) => `change:repeating_${repeater}:name`
).join(" ");

const damageListeners = ABILITIES_REPEATERS.reduce((acc, cur) => {
  acc.push(`change:repeating_${cur}:damage_starting`);
  acc.push(`change:repeating_${cur}:damage_unit`);
  acc.push(`change:repeating_${cur}:damage_per_level`);
  return acc;
}, []).join(" ");

const percentageListeners = ABILITIES_REPEATERS.reduce((acc, cur) => {
  acc.push(`change:repeating_${cur}:percentage_starting`);
  acc.push(`change:repeating_${cur}:percentage_per_level`);
  return acc;
}, []).join(" ");

const rangeDurationFrequencyDcListeners = ABILITIES_REPEATERS.reduce(
  (acc, cur) => {
    ["range", "duration", "frequency", "dc"].forEach((property) => {
      acc.push(`change:repeating_${cur}:${property}_starting`);
      acc.push(`change:repeating_${cur}:${property}_unit`);
      acc.push(`change:repeating_${cur}:${property}_per_level`);
    });
    return acc;
  },
  []
).join(" ");

on(damageListeners, async (e) => {
  console.log("damageListeners", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_damage`;
  await calculateDamage(row);
});

on(percentageListeners, async (e) => {
  console.log(e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_percentage`;
  await calculatePercentage(row);
});

on(rangeDurationFrequencyDcListeners, async (e) => {
  console.log(e);
  const [r, section, rowId, property] = e.sourceAttribute.split("_");
  const row = `${r}_${section}_${rowId}_${property}`;
  await calculateRangeDuration(row);
});

on(nameListeners, async (e) => {
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const attrs = {};
  attrs[`${r}_${section}_rowid`] = `${r}_${section}_${rowId}_`;
  await setAttrsAsync(attrs);
});

on(
  "change:repeating_powersabilities:addtobonuses \
  change:repeating_magic:addtobonuses \
  change:repeating_psionics:addtobonuses",
  async (e) => {
    console.log("change:repeating_powersabilities:addtobonuses", e);
    const [r, section, rowId] = e.sourceAttribute.split("_");
    const enabled = Boolean(Number(e.newValue));
    if (enabled) {
      addModifierToBonusesAsync(section, rowId);
    } else {
      const a = await getAttrsAsync([`${r}_${section}_${rowId}_bonus_id`]);
      await removeBonusRowsAsync(a[`${r}_${section}_${rowId}_bonus_id`]);
    }
  }
);

on(
  "change:repeating_powersabilities:dc \
  change:repeating_magic:dc \
  change:repeating_psionics:dc",
  async (e) => {
    const [r, section, rowId] = e.sourceAttribute.split("_");
    const prefix = `${r}_${section}_${rowId}`;
    const a = await getAttrsAsync([`${prefix}_dc_unit`]);
    const unit = a[`${prefix}_dc_unit`].toLowerCase();
    if (unit == "sdc" || unit == "mdc") {
      const value = parseInt(e.newValue);
      const attrs = { [`${prefix}_${unit}`]: value };
      await setAttrsAsync(attrs);
    }
  }
);

on("change:psionic_ability", (e) => {
  console.log("change:psionic_ability", e);
});

  /* endinject */

  /* inject:js/movement.js */
  on("change:repeating_movement:mph", async (e) => {
  console.log("change:repeating_movement:mph", e);
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = Math.round((e.newValue * 5280) / 60 / 4);
  const attrs = {
    [`repeating_movement_${rowId}_ft_melee`]: feetPerMelee,
    [`repeating_movement_${rowId}_ft_attack`]: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
});

on("change:repeating_movement:ft_melee", async (e) => {
  const [r, section, rowId] = e.sourceAttribute.split("_");
  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  const a = await getAttrsAsync([
    `repeating_profiles_${orderedSectionIds[0]}_attacks`,
  ]);
  const feetPerMelee = e.newValue;
  const mph = ((feetPerMelee * 4 * 60) / 5280).toFixed(1);
  const attrs = {
    [`repeating_movement_${rowId}_mph`]: mph,
    [`repeating_movement_${rowId}_ft_attack`]: Math.round(
      feetPerMelee / a[`repeating_profiles_${orderedSectionIds[0]}_attacks`]
    ),
  };
  await setAttrsAsync(attrs);
});

async function recalculateMovement(manualFeetPerMelee) {
  console.log("Recalculating Speed Values");
  let feetPerMelee = manualFeetPerMelee;
  let attacksPerMelee = 2;

  const orderedSectionIds = await getSectionIDsOrderedAsync("profiles");
  /**
   * @todo short-term - this should use Default profile
   * @todo long-term - movement section should be incorporated into each profile
   */
  const attacksAttrName = `repeating_profiles_${orderedSectionIds[0]}_attacks`;

  if (!manualFeetPerMelee) {
    const ids = await getSectionIDsOrderedAsync("armor");
    const {
      spd,
      [attacksAttrName]: perMelee,
      ...penalties
    } = await getAttrsAsync([
      "spd",
      attacksAttrName,
      ...ids.map((id) => `repeating_armor_${id}_is_active`),
      ...ids.map((id) => `repeating_armor_${id}_movementpenalty`),
    ]);
    attacksPerMelee = perMelee;

    const activeArmorIds = ids.reduce((acc, id) => {
      if (!!Number(penalties[`repeating_armor_${id}_is_active`])) {
        acc.push(id);
      }
      return acc;
    }, []);

    const speedPenalty = activeArmorIds.reduce((penalty, id) => {
      const p = +penalties[`repeating_armor_${id}_movementpenalty`];
      return penalty + p;
    }, 0);

    feetPerMelee = spd * 15;
    feetPerMelee = Math.round(
      feetPerMelee + feetPerMelee * (speedPenalty / 100.0)
    );
  } else {
    // To save a network call, pull only attacks on a manual override
    const { [attacksAttrName]: perMelee } = await getAttrsAsync([
      attacksAttrName,
    ]);
    attacksPerMelee = perMelee;
  }
  const attrs = {
    run_mph: ((feetPerMelee * 4 * 60) / 5280).toFixed(1),
    run_ft_melee: feetPerMelee,
    run_ft_attack: Math.round(feetPerMelee / attacksPerMelee),
  };
  await setAttrsAsync(attrs);
}

  /* endinject */

  /* inject:js/import_export.js */
  (function () {
  async function getRepeatingSectionArrayAsync(section, rowIds, attrNames) {
    let sectionArray = [];
    const attrs = await getAttrsAsync(attrNames);
    rowIds.forEach((rowId) => {
      const wpObj = Object.keys(attrs).reduce((acc, attr) => {
        if (attr.includes(rowId)) {
          acc[attr.replace(`repeating_${section}_${rowId}_`, "")] = attrs[attr];
        }
        return acc;
      }, {});
      sectionArray.push(wpObj);
    });
    return sectionArray;
  }

  async function getRepeatingRowsAsync(section) {
    const ids = await getSectionIDsOrderedAsync(section);
    const attrNames = ids.reduce((acc, id) => {
      SECTIONS[section].forEach((key) => {
        acc.push(`repeating_${section}_${id}_${key}`);
      });
      return acc;
    }, []);
    const repeatingSectionArray = await getRepeatingSectionArrayAsync(
      section,
      ids,
      attrNames
    );
    return repeatingSectionArray;
  }

  on("clicked:export", async (e) => {
    console.log("export", e);
    const attrs = {};
    attrs.h2h = await getRepeatingRowsAsync("h2h");
    attrs.wp = await getRepeatingRowsAsync("wp");
    attrs.wpmodern = await getRepeatingRowsAsync("wpmodern");
    attrs.skills = await getRepeatingRowsAsync("skills");
    attrs.magic = await getRepeatingRowsAsync("magic");
    attrs.psionics = await getRepeatingRowsAsync("psionics");
    attrs.movement = await getRepeatingRowsAsync("movement");
    attrs.powersabilities = await getRepeatingRowsAsync("powersabilities");
    attrs.modifiers = await getRepeatingRowsAsync("modifiers");
    attrs.armor = await getRepeatingRowsAsync("armor");
    attrs.equipment = await getRepeatingRowsAsync("equipment");
    // Profiles are tricky to export because IDs that they refer to won't line up
    // attrs.profiles = await getRepeatingRowsAsync("profiles");
    attrs.core = await getAttrsAsync(CORE_KEYS);
    await setAttrsAsync({ importexport: JSON.stringify(attrs, null, 2) });
  });

  async function setRepeatingRowsAsync(section, data) {
    await setAttrsAsync({ importexportstatus: `Importing ${section}...` });
    console.log("setRepeatingRows", section, data);
    if (!data) return;
    console.log("continuing setRepeatingRows", section);
    const attrs = data.reduce((acc, row) => {
      const rowId = generateRowID();
      Object.entries(row).forEach(([key, val]) => {
        if (parseInt(val) == 0) {
          return;
        }
        acc[`repeating_${section}_${rowId}_${key}`] = val;
      });
      return acc;
    }, {});
    attrs.importexportstatus = `Done importing ${section}...`;
    await setAttrsAsync(attrs);
  }

  function importAll(data) {
    let attrs = data.core || {};
    Object.keys(SECTIONS).forEach((section) => {
      if (!data[section]) {
        return;
      }
      console.log(section, data[section]);
      const sectionAttrs = data[section].reduce((acc, row) => {
        const rowId = generateRowID();
        Object.entries(row).forEach(([key, val]) => {
          acc[`repeating_${section}_${rowId}_${key}`] = val;
        });
        return acc;
      }, {});
      attrs = Object.assign(attrs, sectionAttrs);
    });
    setAttrs(attrs, {}, () => {
      setAttrs({ importexport: "Done" });
    });
  }

  on("clicked:import", async (e) => {
    console.log("import", e);
    await setAttrsAsync({ importexportstatus: "Importing core..." });
    const a = await getAttrsAsync(["importexport"]);
    const data = JSON.parse(a.importexport);
    console.log(data);
    // importAll(data);
    // return;
    await setAttrsAsync(data.core);
    await setRepeatingRowsAsync("h2h", data.h2h);
    await setRepeatingRowsAsync("wp", data.wp);
    await setRepeatingRowsAsync("wpmodern", data.wpmodern);
    await setRepeatingRowsAsync("skills", data.skills);
    await setRepeatingRowsAsync("magic", data.magic);
    await setRepeatingRowsAsync("psionics", data.psionics);
    await setRepeatingRowsAsync("movement", data.movement);
    await setRepeatingRowsAsync("powersabilities", data.powersabilities);
    await setRepeatingRowsAsync("modifiers", data.modifiers);
    await setRepeatingRowsAsync("armor", data.armor);
    await setRepeatingRowsAsync("equipment", data.equipment);
    await setAttrsAsync({
      importexportstatus:
        "Done importing, but triggered events are probably still running. To be sure open your browser console and when the logging stops, the import is really done.",
    });
  });
})();

on("sheet:opened", async (e) => {
  console.log("sheet:opened", e);
  await setAttrsAsync({ debug: "0" });
  // await migrateAttributes();
});

on("clicked:migrate", async (e) => {
  console.log("clicked:migrate", e);
  await migrateAttributes();
});

// $20("button.test").on("mouseenter", (e) => {
//   console.log(e);
// });

// on("clicked:test", async (e) => {
//   console.log("test");
//   const acid = getActiveCharacterId();
//   const attrs = findObjs({
//     _type: "attribute",
//     _characterid: acid,
//   });
//   console.log(acid, attrs);
// });

  /* endinject */

  /**
   * [] When adding damage type to calculated damage on psionics, it adds the type to the Damage field in Modifiers as well, which will break rolls
   * [] Migrate attributes from existing Rifts sheet
   * [] Add repeating modifiers to Skills and allow them to be added to Profiles
   * [] Represent Critical/Knockout from behind
   * [] Add skills (WP Paired) from h2h
   * [] Define "combat moves" somewhere - stuff from H2H with damage and penalties (loses initiave and one attack), etc.
   * [] Add a non-repeating section for Default Profile so that profile attributes can be set on the token
   * [] Include non-zero modifier in roll template (ex -10 should appear as a line item to indicate it was factored in)
   * [] Refactor to get rid of the Bonuses repeating section and instead go straight from Modifiers to Picked Modifiers. I think the Bonuses section causes weird issues related to network/multiple updates at the same time.
   * [] Add range to modifiers (guns)
   * [] Factor in "Aimed Attack/Called Shot" (/disarm) from WP Targeting (RUE p328)
   *  - [] Also factor in the natural 19-20 automatic success with a roll template/green highlight
   *  - [] Including check has WP Targeting
   * [] Ability to hide tabs (ex. a Grunt doesn't need Magic and Psionics tabs)
   * [] Add Cybernetics/Bionics tab
   * [] Prompt to add Magic/Psionic bonus when saving against Mind Control, Illusions, Pain, Curses, Possession
   * [] Armor tab / repeater; Armor checkboxes in Aggregate Bonuses, and Armor list (name, MDC) underneath
   *  - [x] Move Damage/Apply Damage outside repeater
   *  - [] "Add to Armor" checkbox on Abilities/Psionics/Magic/Modifiers
   *  - [] Cast/Use magic/psionic should check the Active checkbox on the associated armor row
   *    - consider different MDC for different body parts
   * [] Add Range, Ammo to Modifiers
   * [] Carry PS damage rolls through to profile (ex. kick: 2d4 sdc)
   * [] Add details/summary to some Core background fields like Insanity, Environment, Family Origin, Disposition
   * [] Add roll buttons for punches/kicks
   * [] Add WP Sharpshooting that takes into account the PP of the profile it's used in
   * [x] Two hands worth of damage
   *  - [x] Separate Main Hand, Off Hand, and Combined damage
   *  - [] Each damage should include a checkbox for "stacks" vs. "overrides". Overrides uses greatest of.
   *  - [] If Combined is empty on the Profile, it should use the combined main+off.
   * [] Make range/duration text instead of number ("2D6 minutes", "varies", "touch")
   * [] Profile damage should use bonus damage if it exists instead of calculating based on PS type
   * [] Add option for increased magic/psionics at Ley Line (+50%, +100%, +200%)
   *  - Not sure how to implement this. Does it go on the psionic, on the profile? Feels like it should be a sheet wide toggle,
   *    but then damage values in the profile need to know that they came from, ex. psi-sword, and only to multiply that portion
   *    of the total damage. Complicated.
   *
   * [] Changing values causes other fields to set to 0
   *    - ex. change frequency starting then quickly change frequency per level
   *      _but don't change focus_. The per level pops back to 0.
   * [] Maintain index on each ability/magic/psionic of which profiles it's on,
   *    so that changes can be pushed to the profile and can eliminate the Update button.
   *    This is tricky because a Profile knows about its bonusselections IDs.
   *    Bonusselections know about their Bonus IDs. Bonuses get updated when the original modifier changes,
   *    but now we'd need another change listener on the Bonus rows which would trigger a Profile update.
   * [] Add Sort Alphabetically option for skills/abilities/magic/psionics
   * [] Add Sort by Spell Level option for magic
   * [] Add weight to abilities/magic/psionics
   * [] Pressing space when typing an ability name expands and collapses the Details panel
   * [] Removing Bonus Sources doesn't remove them from Selections
   *
   * [x] Add option to include IQ bonus on skill-based abilities (Telemechanics, Object Read, Locate, etc.)
   * [x] Fix CSS on "Psionics vs. [n]"
   * [x] Note how many actions aimed/called shots take
   * [x] Skills don't appear to recalculate when the level changes due to character level adjustment
   * [x] Move Instructions to Options tab
   * [x] Checking Active armor needs to trigger a global armor update
   * [x] replace "currentmdc" and "basemdc" armor attributes with "mdc" and "mdc_max"
   * - [x] include migration
   * [x] Add a non-repeating section for Default Profile so that profile attributes can be set on the token
   * - [x] Also include Armor
   * [x] Make Imp/Exp -> Options, and add checkboxes for:
   * ** Or use sheet options - "useroptions" https://wiki.roll20.net/Sheet.json#Example
   *  - [x] Add PP to disarm/entangle
   *  - [x] Add IQ to Perception
   *  - [x] Apply PS damage to each hand or total in Paired attack
   *  - [x] Add Supernatural (and Robotic) punch damage to melee attacks
   * [x] Set spell strength modifier from h2h
   * [x] Add Break Fall defensive bonus
   * [x] Add "racial" and "other" to skill categories
   * [x] Add RPA to Combat Skills
   * [x] Add Hand to Hand selector / auto calculator
   * [x] Roll query for dodge - Range attack? 10', 50', N/A
   * [x] Add "vs. #" for rolls that are against a static target
   * [x] Fix iq_bonus() function to use default profile, not top.
   * - [x] skill bonuses aren't calculating properly.
   * - [x] TEST THOROUGHLY!
   * [x] Prompt for modifier when rolling a skill
   * [x] Factor in critical strike when rolling strike-type-moves with roll template
   * [x] Remove Charm/Impress and Perception dice roll from Core tab
   * [x] Add init roll to tracker
   * [x] Move Initiative outside of Ancient section
   * [x] Range Strike roll template - update text for single/burst
   * [x] Make debug a button/attribute instead of having to edit the markup
   * [x] Make sure that armor attributes are in definitions.js
   * [x] Make export use ordered section IDs
   * [x] Add vs Telepathic Probes (Changeling)
   * [x] Add vs Despair (Psyscape)
   * [x] Separate Trust and Intimidate (cuz kraks get a bonus to trust and a penalty to intimidate)
   * [x] Add multiplier option for lift/carry (juicer, crazy, etc.)
   * [x] Add Single and Pulse damage to Range Combat modifiers
   * [x] There's a disconnect between level and skill level. It seems like level needs to be changed once before it "connects" to skill level, at which point it's out of sync if they both started at 1.
   * [x] Add Dodge: Underwater
   * [x] Add Spd: Fly attribute
   * [x] Add Fatigue to Saves
   * [x] Show name above tabs
   * [x] roll template css not working again
   * [x] Add Maintain Balance to bonuses
   * [x] Swap Bonus and Per Level skill columns
   * [x] Remove roll buttons for Combat and Save sections in non-readonly modifiers
   * [x] Set default character level to 1, not 0
   * [x] Move description above Modifiers for Abilities/Psionics/Magic
   * [x] Dodge: teleport is using Dodge: Auto maybe in Profiles maybe? See Crazy.
   * [x] Fix Targeting - Throw bonus, not Strike
   * [x] Add title attributes to any and all acronyms (labels and inputs)
   * [x] Group similar bonuses (offense, defense, damage); make columnar
   * - [x] Handle non-readonly modifiers
   * - [x] Add +/- to relevant read-only modifier fields, depending on roll. Ex. magic is +, psionics isn't
   * [x] Skill Category not being exported or imported
   * [x] Damage unit isn't getting added on spells
   * [x] Make headings sticky
   * [x] Independent scroll on Profiles
   * [x] Add overflow:scroll to tabs for narrow sheet
   * [x] Restructure
   * - "Toolbar" cumulative modifiers on the right
   *  - visual separation - make it look like a palette
   * - arrows pointing left/right for applying in that direction
   * - Cumulative Modifiers => <color>Modifier Picker
   * - Button - Apply <color>Picked Modifiers
   * - Button - Replace <color>Picked Modifiers</c> using this profile
   * - Button - Refresh Icon [first button]
   * Core|Skills|Equipment || WPs|Abilities|Magic|Psionics|Modifiers|Profiles || Utils
   * - replace |x| with +/- (emoji)
   * [x] Use a radio button to determine default profile
   * [x] Add credits field(s) - Universal, Black Market, Splugorth, Phase World, gems, gold, etc.
   * [x] Re-implement "Set this profile's selections as checked"
   * [x] Skill calculation requires a default profile or it breaks. fix this.
   * [x] Fix P.P. missing dot
   * [x] Filter +0s from combined damage fields
   * [x] Set skill check to be skill % or 98, whichever is lower
   * [x] Perception on Profile isn't including profile IQ bonus
   * [x] Changing level doesn't change DC for abilities
   * [x] Remove punch/lift section from Core as it's in Profiles
   * [x] Add +skill % and any other missing attribute bonuses
   * [x] Add Psionics type to Psionics tab (minor, major, master), and use that to calculate save roll
   * [x] Add trust/charm to Profile (consider an item that gives MA/PB bonus)
   * [x] Make sure that "Add to Bonuses" checkbox is exported/imported
   * [x] Add Spell Strength to magic tab
   * [x] Change Profile fields to hidden + span for efficiency's sake
   * [x] Profile values (bonuses, saves) that aggregate with a global attribute/attribute bonus should use the profile-specific value instead
   * [x] Fix coma/death aggregation in profiles (and add a roll button?)
   * [x] Fix +Punch/PS roll to use value in current section rather than global
   * [x] Magic/... DC should populate S/MDC based on DC unit.
   * [x] Why are Abilities showing up on the Bonuses tab without Add to Bonuses being checked?
   * [x] PPE on Profiles needs to include primary. Reset PPE on Magic tabs needs to pull from default (1st) profile
   * [x] Removing Abilities doesn't seem to remove them from Bonus Sources
   *
   * [x] Add/update Instructions on every tab, then re-release.
   *
   * Add attributes, PS type, ISP, PPE, HP, SDC, MDC, etc. to Bonuses
   * [x] Allow for an "absolute" value
   * [x] Add additional field(s) to Profile for aggregate attribute bonuses
   * [] Use a "text" input and allow for values like `*2` or `/2`
   * Aggregate Logic:
   * - PS includes type
   * - HP, SDC, AR, MDC are grouped on their own Armor row w/ Name
   * - PPE, ISP are grouped on their own "Mana"? row w/ Name
   *
   * [x] Have abilities/magic/psionics auto-calculate/populate MDC/SDC/HP/...
   * [x] Make things async
   *
   * @todo add Ammo/Uses to Combat, Magic
   * @todo add import status - add an attribute and update count on each callback, or just once at the end indicating completion
   *
   * @todo Import isn't setting Skill level properly, probably because it's already "1"
   * @todo when Aggregate Attacks change, recalculate ft/attack fields
   *
   * Questions
   * - Paratrooper gets a save vs. Torture. What is this?
   *
   * @todo standardize/improve markup on Core tab
   *
   * @todo add an active combat section above Aggregate bonuses
   *    - track attacks
   *    - track ammo (roll20 has something for this)
   *    - track MDC - for each aggregate MDC modifier, track it separately in a repeater. allow the user to reorder, and deduct from bottom to top
   *
   * @todo combat row `level` needs to populate when `skill` does
   * @todo combat row `level` needs to adjust with Character level like WPs do
   *
   * @todo better better build process with imports/file modules
   *
   * To get Character ID, `getAttrs(["character_id"])`
   * Variables are browser-wide, not sheet-wide. Setting a JS variable in one sheet provides that value to any other sheet.
   * shift-dblclick on token to open that tokens sheet
   * */

  /**
   * This one could be a doozy
   * */
  on("change:character_level", async (e) => {
    console.log(e);
    console.log("change:character_level", e.newValue, e.previousValue);

    /**
     * Defend against
     * https://app.roll20.net/forum/post/10351259/first-time-the-value-is-changed-previousvalue-and-newvalue-are-the-same
     * */
    if (e.newValue == e.previousValue) {
      e.previousValue = "1";
    }
    // Update WPs
    await updateHandToHands("h2h");
    await updateWeaponProficiencies("wp", e.newValue, e.previousValue);
    await updateWeaponProficiencies("wpmodern", e.newValue, e.previousValue);
    await updateSkillLevels();
    await updateMagicPsionicsLevels();
  });
</script>
<!-- inject:partials/roll-templates.html -->
<!-- https://wiki.roll20.net/Building_Character_Sheets/Roll_Templates#Jakob.27s_Better_Default_Rolltemplate -->

<rolltemplate class="sheet-rolltemplate-skill">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}} {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      <div class="sheet-key">Skill %</div>
      <div class="sheet-value">{{target}}</div>
      <div class="sheet-key">Roll</div>
      <div class="sheet-value">{{roll}}</div>
      <!-- -->
      {{#rollLess() add_skill 1}}
      <!-- -->
      {{#rollGreater() roll target }}
      <!-- -->
      <div class="sheet-template-row">Failure!</div>
      <!-- -->
      {{/rollGreater() roll target }}
      <!-- -->
      {{#^rollGreater() roll target }}
      <!-- -->
      {{#successtext}}
      <!-- -->
      <div class="sheet-template-row">{{successtext}}</div>
      <!-- -->
      {{/successtext}}
      <!-- -->
      {{^successtext}}
      <!-- -->
      <div class="sheet-template-row">Success!</div>
      <!-- -->
      {{/successtext}}
      <!-- -->
      {{/^rollGreater() roll target }}
      <!-- -->
      {{/rollLess() add_skill 1}}
      <!-- -->
      {{#^rollLess() add_skill 1}}
      <!-- -->
      <div class="sheet-key">Total</div>
      <div class="sheet-value">{{total}}</div>
      <!-- -->
      {{#rollLess() total 101 }}
      <div class="sheet-template-row">Failure!</div>
      {{/rollLess() total 101 }}
      <!-- -->
      {{#^rollLess() total 101 }}
      <!-- -->
      {{#successtext}}
      <div class="sheet-template-row">{{successtext}}</div>
      {{/successtext}}
      <!-- -->
      {{^successtext}}
      <div class="sheet-template-row">Success!</div>
      {{/successtext}}
      <!-- -->
      {{/^rollLess() total 101 }}
      <!-- -->
      {{/^rollLess() add_skill 1}}
    </div>
  </div>
</rolltemplate>

<!-- goe=Greater or Equal -->
<rolltemplate class="sheet-rolltemplate-goe">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}} {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      <div class="sheet-key">Target</div>
      <div class="sheet-value">{{target}}</div>
      <div class="sheet-key">Roll</div>
      <div class="sheet-value">{{roll}}</div>
      {{#rollLess() roll target }}
      <div class="sheet-template-row">Failure!</div>
      {{/rollLess() roll target }}
      <!-- -->
      {{#^rollLess() roll target }}
      <div class="sheet-template-row">Success!</div>
      {{/^rollLess() roll target }}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-strike">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}} {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#rollWasCrit() strikeroll}}
      <div class="sheet-key">Crit!</div>
      <div class="sheet-value">{{strikeroll}}</div>
      {{/rollWasCrit() strikeroll}}
      <!-- -->
      {{#^rollWasCrit() strikeroll}}
      <div class="sheet-key">Strike</div>
      <div class="sheet-value">{{strikeroll}}</div>
      {{/^rollWasCrit() strikeroll}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-custom">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}} {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#allprops() title subtitle desc color}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>
      {{/allprops() title subtitle desc color}}
      <!-- -->
      {{#desc}}
      <div class="sheet-desc">{{desc}}</div>
      {{/desc}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-initiative">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}} {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      <div class="sheet-key">Dice Roll</div>
      <div class="sheet-value">{{diceroll}}</div>
      <div class="sheet-key">Mod {{modifier}}</div>
      <div class="sheet-value">{{computed::diceroll}}</div>
      {{#desc}}
      <div class="sheet-desc">{{desc}}</div>
      {{/desc}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
  <div class="sheet-container sheet-color-{{color}}">
    <span class="character_name">{{character_name}}</span> got hit for
    <span class="spent">{{spent}}</span> points of damage, reducing their
    <span class="name">{{name}}</span> to
    <span class="remaining">{{remaining}}</span>!
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-castspell">
  <div class="sheet-container sheet-color-{{color}}">
    <span class="character_name">{{character_name}}</span> casts
    <span class="name">{{name}}</span> for
    <span class="spent">{{spent}}</span> PPE, leaving them
    <span class="remaining">{{remaining}}</span> PPE!
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-usepsionic">
  <div class="sheet-container sheet-color-{{color}}">
    <span class="character_name">{{character_name}}</span> uses
    <span class="name">{{name}}</span> for
    <span class="spent">{{spent}}</span> ISP, leaving them
    <span class="remaining">{{remaining}}</span> ISP!
  </div>
</rolltemplate>

<!-- endinject -->




