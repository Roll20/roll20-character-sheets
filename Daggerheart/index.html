<div class="fade-background"></div>
<div class="layout-root">
<!-- Radio buttons for manual toggle -->
<input type="radio" name="attr_sheet_mode" id="mode_character" value="character" checked>
<label class="white-label" for="mode_character">Character</label>

<input type="radio" name="attr_sheet_mode" id="mode_adversary" value="adversary">
<label class="white-label" for="mode_adversary">Adversary</label>
<div class="sheet-character">
<div class="sheet-normal-content">
<div class="spacer"></div>
  <div class="whisper-toggle">
  <label class="white-label">Whisper to GM?
    <select name="attr_whisper_type">
      <option value="">Public</option>
      <option value="/w gm ">Whisper</option>
    </select>
  </label>
</div>
<div class="name-grid">
<div class="section essentials-grid">
<div class="name-wrapper">
  <label for="character_name">Name:</label>
  <input type="text" name="attr_character_name" id="attr_character_name" />
</div>

<div class="resources-wrapper">
<div class="resource-toggle-wrapper">
<input type="checkbox" id="toggle-resource-menu" class="toggle-resource-menu" name="attr_show_resource_menu" />
<label class="resource-menu-button white-label" for="toggle-resource-menu">Short Rest</label>

  <div class="resource-menu white-label">
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish HP}} {{Result=[[1d4]]}}">Tend To Wounds</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Resolve}} {{Result=[[1d4]]}}">Clear Stress</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Result=[[1d4]]}}">Repair Armor</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Gain 1 Hope, or 2 if you prepare with others}}">Prepare</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You do Something Else}}">Other</button>
  </div>
</div>

<div></div>

<div class="resource-toggle-wrapper-2">
<input type="checkbox" id="toggle-resource-menu-2" class="toggle-resource-menu-2" name="attr_show_resource_menu-2" />
<label class="resource-menu-button-2 white-label" for="toggle-resource-menu-2">Long Rest</label>

  <div class="resource-menu-2">
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish HP}} {{You Regenerate All Wounds}}">Tend To All Wounds</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Resolve}} {{You Clear All Stress}}">Clear All Stress</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Repair All Armor}}">Repair All Armor</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Gain 1 Hope, or 2 if you prepare with others}}">Prepare</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You Make Progress In Your Project}}">Work On A Project</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You do Something Else}}">Other</button>
  </div>
</div>
</div>

<div class="conditions-grid">
<label class="condtions-label" for="vulnerable">Vulnerable</label><input type="checkbox" id="vulnerable" class="vulnerable" name="attr_vulnerable" />
<label class="condtions-label" for="hidden">Hidden</label><input type="checkbox" id="state_hidden" class="state_hidden" name="state_hidden" />
<label class="condtions-label" for="restrained">Restrained</label><input type="checkbox" id="restrained" class="restrained" name="attr_restrained" />
</div>

<div class="level-wrapper">
    <label class="level-label" for="level">Level:</label>
  <input class="level-input"type="number" name="attr_level" id="attr_level" min="1" max="20" /><br />
</div>
<div class="etc-essentials-wrapper">
  <label for="player_name">Player:</label>
  <input class="small-input" type="text" name="attr_player_name" id="attr_player_name" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Player Name}} {{Player Name=@{player_name}}}"></button>
  <label for="Ancestry">Ancestry:</label>
  <input class="small-input" type="text" name="attr_Ancestry" id="attr_Ancestry" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Ancestry}} {{Ancestry=@{Ancestry}}}"></button>
  <label for="Community">Community:</label>
  <input class="small-input" type="text" name="attr_Community" id="attr_Community" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Community}} {{Community=@{Community}}}"></button>
  <label for="class">Class:</label>
  <input class="small-input" type="text" name="attr_class" id="attr_class" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Class}} {{Class=@{class}}}"></button>
  <label for="subclass">Subclass:</label>
  <input class="small-input" type="text" name="attr_subclass" id="attr_subclass" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Subclass}} {{Subclass=@{subclass}}}"></button>
</div>
</div>
</div>

<h2>Combat Stats</h2>
<div class="combat_stats">  
<div class="Damage-Wounds-Wrapper">
  <div class="damage-thresholds">
  <h2 class="hp-header">Damage Thresholds</h2>
  <label>Major Damage Threshold</label>
  <input type="text" name="attr_major_threshold" readonly />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Major Threshold}} {{Major Threshold=@{major_threshold}}}"></button>
  <label>Severe Damage Threshold</label>
  <input type="text" name="attr_severe_threshold" readonly />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Severe Threshold}} {{Severe Threshold=@{severe_threshold}}}"></button>
  <div class="armor-score-boxes">
    <label>Evasion:
  <input type="number" name="attr_evasion" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Evasion}} {{Evasion=@{evasion}}}"></button>
</label>
<label>Score:
  <input type="number" name="attr_armor_score" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Armor Score}} {{Armor Score=@{armor_score}}}"></button>
</label>
<input type="hidden" name="attr_armor_score" class="sheet-armor_score" />

<div class="sheet-score-checks">
  <input type="checkbox" name="attr_armor_score_1" class="sheet-score-1" />
  <input type="checkbox" name="attr_armor_score_2" class="sheet-score-2" />
  <input type="checkbox" name="attr_armor_score_3" class="sheet-score-3" />
  <input type="checkbox" name="attr_armor_score_4" class="sheet-score-4" />
  <input type="checkbox" name="attr_armor_score_5" class="sheet-score-5" />
  <input type="checkbox" name="attr_armor_score_6" class="sheet-score-6" />
  <input type="checkbox" name="attr_armor_score_7" class="sheet-score-7" />
  <input type="checkbox" name="attr_armor_score_8" class="sheet-score-8" />
  <input type="checkbox" name="attr_armor_score_9" class="sheet-score-9" />
  <input type="checkbox" name="attr_armor_score_10" class="sheet-score-10" />
</div>
</div>
</div>

<div class="attributes-wrapper">
  <h2 class="hp-header">Attributes</h2>
  <table>
    <thead>
      <tr>
        <th>Attribute</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
<tr>
  <td>Agility</td>
  <td>
  <input type="number" name="attr_agility_base"value="0" />
  <input type="hidden" name="attr_agility_total" value="0" readonly />
<button type="roll"
  value="@{whisper_type}&{template:default} {{name=Agility Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{agility_total}]]}}">
</button>
  </td>
</tr>

<tr>
  <td>Strength</td>
  <td>
  <input type="number" name="attr_strength_base"value="0" />
  <input type="hidden" name="attr_strength_total" value="0" readonly />
        <button type="roll"
  value="@{whisper_type}&{template:default} {{name=Strength Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{strength_total}]]}}">
</button>
  </td>
</tr>

<tr>
  <td>Finesse</td>
  <td>
  <input type="number" name="attr_finesse_base"value="0" />
  <input type="hidden" name="attr_finesse_total" value="0" readonly />
        <button type="roll"
  value="@{whisper_type}&{template:default} {{name=Finesse Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{finesse_total}]]}}">
</button>
  </td>
</tr>

<tr>
  <td>Instinct</td>
  <td>
  <input type="number" name="attr_instinct_base"value="0" />
  <input type="hidden" name="attr_instinct_total" value="0" readonly />
        <button type="roll"
  value="@{whisper_type}&{template:default} {{name=Instinct Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{instinct_total}]]}}">
</button>
  </td>
</tr>

<tr>
  <td>Presence</td>
  <td>
  <input type="number" name="attr_presence_base"value="0" />
  <input type="hidden" name="attr_presence_total" value="0" readonly />
        <button type="roll"
  value="@{whisper_type}&{template:default} {{name=Presence Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{presence_total}]]}}">
</button>
  </td>
</tr>

<tr>
  <td>Knowledge</td>
  <td>
  <input type="number" name="attr_knowledge_base"value="0" />
  <input type="hidden" name="attr_knowledge_total" value="0" readonly />
        <button type="roll"
  value="@{whisper_type}&{template:default} {{name=Knowledge Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{knowledge_total}]]}}">
</button>
  </td>
</tr>
<fieldset class="repeating_attrmods">
  <div class="gold-border">
  <select name="attr_mod_target">
    <option value="agility">Agility</option>
    <option value="strength">Strength</option>
    <option value="finesse">Finesse</option>
    <option value="instinct">Instinct</option>
    <option value="presence">Presence</option>
    <option value="knowledge">Knowledge</option>
  </select>
  <input type="number" name="attr_mod_value" value="0" />
  <label>
    <input type="checkbox" name="attr_mod_enabled" value="1" /> Enabled
  </label>
  </div>
</fieldset>
    </tbody>
  </table>
</div>

</div>


  <div class="hp-box">
    <h2 class="hp-header">HP</h2>
    <!-- Controls -->
    <div class="container">
      <div class="radio-slots">
        <label for="slot_count">Number of Slots:</label>
            <input type="number" name="attr_slots_enabled" value="6" min="0" max="10" />
      </div>
      <!-- Mirror value for CSS to read -->
      <input
        type="hidden"
        name="attr_slots_enabled"
        id="attr_slots_enabled"
        value="1"
      />

      <div class="slots">
  <input type="checkbox" name="attr_slots1" class="slot slot-1" value="1" />
  <input type="checkbox" name="attr_slots2" class="slot slot-2" value="1" />
  <input type="checkbox" name="attr_slots3" class="slot slot-3" value="1" />
  <input type="checkbox" name="attr_slots4" class="slot slot-4" value="1" />
  <input type="checkbox" name="attr_slots5" class="slot slot-5" value="1" />
  <input type="checkbox" name="attr_slots6" class="slot slot-6" value="1" />
  <input type="checkbox" name="attr_slots7" class="slot slot-7" value="1" />
  <input type="checkbox" name="attr_slots8" class="slot slot-8" value="1" />
  <input type="checkbox" name="attr_slots9" class="slot slot-9" value="1" />
  <input type="checkbox" name="attr_slots10" class="slot slot-10" value="1" />
      </div>
    </div>

    <h2 class="hp-header">Stress</h2>

    <!-- Controls -->
    <div class="container">
      <div class="radio-slots">
        <label for="slot_count">Number of Slots:</label>
            <input type="number" name="attr_stress_slots_enabled" value="6" min="0" max="10" />
      </div>
      <!-- Mirror value for CSS to read -->
      <input
        type="hidden"
        name="attr_stress_slots_enabled"
        id="attr_stress_slots_enabled"
        value="1"
      />

      <div class="slots">
        <input
          type="checkbox"
          name="attr_stress_slot_1"
          class="slot stress-slot-1"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_2"
          class="slot stress-slot-2"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_3"
          class="slot stress-slot-3"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_4"
          class="slot stress-slot-4"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_5"
          class="slot stress-slot-5"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_6"
          class="slot stress-slot-6"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_7"
          class="slot stress-slot-7"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_8"
          class="slot stress-slot-8"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_9"
          class="slot stress-slot-9"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_10"
          class="slot stress-slot-10"
          value="1"
        />
      </div>
    </div>
  </div>



<div class="weapons-box">
<h2 class="hp-header">Weapons</h2>
<fieldset class="repeating_weapons">
  <div class="weapon-entry gold-border">
    <div class="weapon-header">
      <input type="text" name="attr_weapon_name" placeholder="Weapon Name" />
        <button class="quote-button" type="roll" name="roll_quote_all_weapon" value="@{whisper_type}&{template:default} {{name=Weapon: @{weapon_name}}}{{Attack Trait=@{attack_trait}}}{{Damage Die=@{damage_die_size}}}{{Additional Damage=@{additional_damage}}}{{Additional Features=@{additional_features}}}{{Base Damage Type=@{base_damage_type}}}{{Range=@{range}}}{{Burden=@{burden}}}{{Weapon Type=@{weapon_type}}}">
</button>
<button type="roll"
  name="roll_attack_damage"
  value="@{whisper_type}&{template:default} {{name=@{weapon_name}}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{@{attack_trait} Roll=[[ @{attack_trait_value} ]]}} {{Damage=[[@{damage_die_size} + @{final_damage_bonus}]]}}">
  Roll Attack
</button>

<input type="hidden" name="attr_attack_trait_value" value="0" />

    </div>

    <!-- Hidden checkbox to toggle details -->
    <input type="checkbox" class="details-toggle" name="attr_show_details" />

    <!-- Label for toggling -->
    <label class="details-toggle-label"><input type="checkbox" class="details-toggle" name="attr_show_details" />Show Details ▼</label>

    <!-- Weapon details to show/hide -->
    <div class="weapon-details">
<label>Attack Trait:
  <select name="attr_attack_trait">
    <option value="Agility">Agility</option>
    <option value="Strength">Strength</option>
    <option value="Finesse">Finesse</option>
    <option value="Instinct">Instinct</option>
    <option value="Presence">Presence</option>
    <option value="Knowledge">Knowledge</option>
  </select>
</label>
<input type="hidden" name="attr_attack_trait_value" value="0" />



      <label>Additional Damage:
        <input type="text" name="attr_additional_damage" placeholder="e.g. 1d10+3" />
      </label>

      <label>Additional Damage:
        <input type="text" name="attr_additional_features" placeholder="extra attack, etc" />
      </label>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Additional Features}} {{Description=@{additional_features}}}"></button>
      <label>Damage Die Size:
        <select name="attr_damage_die_size">
          <option value="d4">d4</option>
          <option value="d6">d6</option>
          <option value="d8">d8</option>
          <option value="d10">d10</option>
          <option value="d12">d12</option>
        </select>
      </label>

      <label>Base Damage Type:
        <select name="attr_base_damage_type">
          <option value="Physical">Physical</option>
          <option value="Magical">Magical</option>
          <option value="Any">Any</option>
        </select>
      </label>

      <label>Range:
        <select name="attr_range">
          <option value="Melee">Melee</option>
          <option value="Very Close">Very Close</option>
          <option value="Close">Close</option>
          <option value="Far">Far</option>
          <option value="Very Far">Very Far</option>
        </select>
      </label>

      <label>Burden:
        <select name="attr_burden">
          <option value="One Handed">One Handed</option>
          <option value="Two Handed">Two Handed</option>
        </select>
      </label>

      <label>Weapon Type:
        <select name="attr_weapon_type">
          <option value="Primary">Primary</option>
          <option value="Secondary">Secondary</option>
        </select>
      </label>
    </div>
  </div>
</fieldset>
<h3>Weapon Modifiers</h3>
<fieldset class="repeating_weaponmods">
  <div class="gold-border">
  <label>Target Weapon:
    <input type="text" name="attr_target_weapon_name" placeholder="Exact weapon name" />
  </label>

  <label>Attack Modifier:
    <input type="number" name="attr_attack_mod" value="0" />
  </label>

  <label>Damage Modifier:
    <input type="number" name="attr_damage_mod" value="0" />
  </label>

  <label>
    <input type="checkbox" name="attr_mod_enabled" value="1" />
    Enabled
  </label>
</div>
</fieldset>
</div>

<div>
<div>
  <label class="white-label">Hope Slots:
    <input class="white-input" type="number" name="attr_hope_max" value="6" min="0" max="6" />
  </label>

  <!-- Hidden flags for CSS -->
  <input type="hidden" class="sheet-show_hope_slot_1" name="attr_show_hope_slot_1" value="0" />
  <input type="hidden" class="sheet-show_hope_slot_2" name="attr_show_hope_slot_2" value="0" />
  <input type="hidden" class="sheet-show_hope_slot_3" name="attr_show_hope_slot_3" value="0" />
  <input type="hidden" class="sheet-show_hope_slot_4" name="attr_show_hope_slot_4" value="0" />
  <input type="hidden" class="sheet-show_hope_slot_5" name="attr_show_hope_slot_5" value="0" />
  <input type="hidden" class="sheet-show_hope_slot_6" name="attr_show_hope_slot_6" value="0" />

  <div class="hope-tracker">
    <h2 class="hope-name hp-header">Hope Tracker</h2>
    <input type="checkbox" name="attr_hope_slot_1" class="hope-slot 1" value="1" />
    <input type="checkbox" name="attr_hope_slot_2" class="hope-slot 2" value="1" />
    <input type="checkbox" name="attr_hope_slot_3" class="hope-slot 3" value="1" />
    <input type="checkbox" name="attr_hope_slot_4" class="hope-slot 4" value="1" />
    <input type="checkbox" name="attr_hope_slot_5" class="hope-slot 5" value="1" />
    <input type="checkbox" name="attr_hope_slot_6" class="hope-slot 6" value="1" />
  </div>
</div>

<div class="experiences-box">
  <h1 class="hp-header">Experiences:</h1>
  <fieldset class="repeating_experiences-box">
    <div class="repeating_experiences gold-border">
      <div class="attr_grid_item">
        <label for="attr_experiences_experience_field">Experience:</label>
        <input
          type="text"
          class="attr_experiences_experience_input"
          name="attr_experiences_experience_field"
        ></input>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Experience Name}} {{Experience-Name Bonus=@{experiences_experience_field} @{experiences_bonus_field}}}"></button>
      </div>
      <div class="attr_grid_item">
        <label for="attr_experiences_bonus_field">Bonus:</label>
        <input
          type="number"
          class="attr_experiences_bonus_input"
          name="attr_experiences_bonus_field"
        ></input>
      </div>
      </div>
    </div>
  </fieldset>
</div>

<div class="resources-box">
  <h1 class="hp-header">Resources:</h1>
  <fieldset class="repeating_resources-box">
    <div class="repeating_resources gold-border">
      <div class="attr_grid_item">
        <label for="attr_resources_resource_field">Resource:</label>
        <input
          type="text"
          class="attr_resources_resource_input"
          name="attr_resources_resource_name_field"
        ></input>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Resource: @{resources_resource_name_field}}}{{Current=@{resources_current_field}}}{{Maximum=@{resources_maximum_field}}}"></button>
      </div>
      <div class="attr_grid_item">
        <label for="attr_resources_current_field">Current:</label>
        <input
          type="number"
          class="attr_resources_current_input"
          name="attr_resources_current_field"
        ></input>
      </div>
            <div class="attr_grid_item">
        <label for="attr_resources_maximum_field">Maximum:</label>
        <input
          type="number"
          class="attr_resources_maximum_input"
          name="attr_resources_maximum_field"
        ></input>
      </div>
      </div>
    </div>

<div class="bottom-tab">
<div class="tab-section">
<!-- Radio inputs (tab selectors) -->
<input type="radio" name="sheet-tab" id="tab-domain-effects" class="tab-toggle" selected>
<input type="radio" name="sheet-tab" id="tab-feature-effects" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-equipment" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-details" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-journal" class="tab-toggle">

<div class="tabs">
  <label for="tab-domain-effects" checked>Domain Effects</label>
  <label for="tab-feature-effects">Feature Effects</label>
  <label for="tab-equipment">Equipment</label>
  <label for="tab-details">Details</label>
  <label for="tab-journal">Journal</label>
</div>

<!-- Effects Tab -->
<div class="domain-effects-tab tab-content">
  <div class="attr_domains">
    <h2>Domains:</h2>

    <fieldset class="repeating_domain-effects">
      <div class="repeating_domain-effect-item gold-border">

        <label>Name:</label>
        <input type="text" name="attr_domain_effect_name" />
        <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Domain-Feature}} {{Name=@{domain_effect_name}}} {{Source=@{domain_effect_source}}} {{Description=@{domain_effect_description}}} {{Bonus Score=@{domain_effect_bonus_score}}} {{Mod Target=@{domain_effect_mod_target}}} {{Roll1=@{domain_effect_roll_1}}} {{Roll2=@{domain_effect_roll_2}}} {{Cost=@{domain_effect_cost}}} {{Uses per Rest=@{domain_effect_uses_per_rest}}}"></button>
        <button type="roll" name="roll_domain_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 1}} {{Roll=[[@{domain_effect_roll_1}]]}}">
        </button>
        
        <button type="roll" name="roll_domain_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 2}} {{Roll=[[@{domain_effect_roll_2}]]}}">
        </button>
        <input type="checkbox" class="details-toggle" name="attr_domain_show_details" />
    <span class="details-toggle-label">Show Details ▼</span>

        <div class="domain-details">

          <label>Source:</label>
          <input type="text" name="attr_domain_effect_source" />

          <label>Description:</label>
          <textarea name="attr_domain_effect_description" class="overflow"></textarea>

          <label>Active?</label>
          <input type="checkbox" name="attr_domain_effect_bonus_active" />

          <label>Bonus:</label>
          <input type="number" name="attr_domain_effect_bonus_score" value="0" />

          <label>Modify Stat:</label>
          <select name="attr_domain_effect_mod_target">
            <option value="strength">Strength</option>
            <option value="agility">Agility</option>
            <option value="finesse">Finesse</option>
            <option value="instinct">Instinct</option>
            <option value="presence">Presence</option>
            <option value="knowledge">Knowledge</option>
            <option value="attack">Attack Bonus</option>
          </select>

          <label>Roll 1:</label>
          <button type="roll" name="roll_domain_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 1}} {{Roll=[[@{domain_effect_roll_1}]]}}">
          </button>
          <input type="text" name="attr_domain_effect_roll_1" />

          <label>Roll 2:</label>
          <button type="roll" name="roll_domain_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 2}} {{Roll=[[@{domain_effect_roll_2}]]}}">
          </button>
          <input type="text" name="attr_domain_effect_roll_2" />

          <label>Cost:</label>
          <input type="text" name="attr_domain_effect_cost" />

          <label>How Many Uses:</label>
          <input type="number" name="attr_domain_effect_uses_per_rest" />

        </div>
      </div>
    </fieldset>
  </div>
</div>

<div class="feature-effects-tab tab-content">
  <div class="attr_features">
    <h2>Features:</h2>

    <fieldset class="repeating_feature-effects">
      <div class="repeating_feature-effect-item gold-border">

        <label>Name:</label>
        <input type="text" name="attr_feature_effect_name" />
        <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Feature-Effect}} {{Name=@{feature_effect_name}}} {{Source=@{feature_effect_source}}} {{Description=@{feature_effect_description}}} {{Bonus Score=@{feature_effect_bonus_score}}} {{Mod Target=@{feature_effect_mod_target}}} {{Roll1=@{feature_effect_roll_1}}} {{Roll2=@{feature_effect_roll_2}}} {{Cost=@{feature_effect_cost}}} {{Uses per Rest=@{feature_effect_uses_per_rest}}}"></button>
          <button type="roll" name="roll_feature_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 1}} {{Roll=[[@{feature_effect_roll_1}]]}}">
          </button>
          <button type="roll" name="roll_feature_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 2}} {{Roll=[[@{feature_effect_roll_2}]]}}">
          </button>
        <input type="checkbox" class="details-toggle" name="attr_feature_show_details" />
    <span class="details-toggle-label">Show Details ▼</span>

        <div class="feature-details">

          <label>Source:</label>
          <input type="text" name="attr_feature_effect_source" />

          <label>Description:</label>
          <textarea name="attr_feature_effect_description" class="overflow"></textarea>

          <label>Active?</label>
          <input type="checkbox" name="attr_feature_effect_bonus_active" />

          <label>Bonus:</label>
          <input type="number" name="attr_feature_effect_bonus_score" value="0" />

          <label>Modify Stat:</label>
          <select name="attr_feature_effect_mod_target">
            <option value="strength">Strength</option>
            <option value="agility">Agility</option>
            <option value="finesse">Finesse</option>
            <option value="instinct">Instinct</option>
            <option value="presence">Presence</option>
            <option value="knowledge">Knowledge</option>
            <option value="attack">Attack Bonus</option>
          </select>

          <label>Roll 1:</label>
          <button type="roll" name="roll_feature_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 1}} {{Roll=[[@{feature_effect_roll_1}]]}}">
          </button>
          <input type="text" name="attr_feature_effect_roll_1" />

          <label>Roll 2:</label>
          <button type="roll" name="roll_feature_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 2}} {{Roll=[[@{feature_effect_roll_2}]]}}">
          </button>
          <input type="text" name="attr_feature_effect_roll_2" />

          <label>Cost:</label>
          <input type="text" name="attr_feature_effect_cost" />

          <label>How Many Uses:</label>
          <input type="number" name="attr_feature_effect_uses_per_rest" />

        </div>
      </div>
    </fieldset>
  </div>
  </div>

  <!-- Equipment Tab (fixed here) -->
  <div class="tab-content tab-equipment">
    <div class="gold">
    <h2>Gold:</h2>
    <label>Handfulls:</label>
      <input type="number" name="attr_gold_handfulls" />
    <label>Bags:</label>
      <input type="number" name="attr_gold_bags" />
    <label>Chest:</label>
      <input type="number" name="attr_gold_chest" />
    </div>
    <h1 style="color: white; background-color: black">Equipment:</h1>
<fieldset class="repeating_armor">
  <div class="armor-item gold-border">
    <label>
      <input type="checkbox" name="attr_armor_active" /> Equipped
    </label>

    <label>Name:
      <input type="text" name="attr_armor_name" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Armor}} {{Name=@{armor_name}}} {{Description=@{armor_description}}} {{Major Threshold=@{armor_major_threshold}}} {{Severe Threshold=@{armor_severe_threshold}}} {{Armor Score=@{armor_score}}}"></button>
    <label>Description:
      <textarea name="attr_armor_description" class="overflow"></textarea>
    </label>

    <label>Major Threshold:
      <input type="number" name="attr_armor_major_threshold" />
    </label>

    <label>Severe Threshold:
      <input type="number" name="attr_armor_severe_threshold" />
    </label>

    <label>Score:
      <input type="number" name="attr_armor_score" />
    </label>
  </div>
</fieldset>
  </div>

  <!-- Details Tab -->
  <div class="tab-content tab-details">
    <h2>Details</h2>
<fieldset class="repeating_armor">
  <div class="gold-border">
    <label>Question:
      <input type="text" name="attr_details_question" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Details Question}} {{Question=@{details_question}}}"></button>
      <label>Answer:
      <textarea name="attr_details_description" class="overflow"></textarea>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Details Answer}} {{Answer=@{details_description}}}"></button>
    </label>
    </div>
    </fieldset>
  </div>

  <!-- Journal Tab -->
  <div class="tab-content tab-journal">
    <h2>Journal</h2>
<fieldset class="repeating_armor">
  <div class="gold-border">
    <label>Title:
      <input type="text" name="attr_journal_title" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Journal Title}} {{Title=@{journal_title}}}"></button>
      <label>Entry:
      <textarea name="attr_journal_description" class="overflow"></textarea>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Journal Entry}} {{Entry=@{journal_description}}}"></button>
    </label>
    </div>
    </fieldset>
  </div>
</div>
</div>
</div>
</div>
</div>

<div class="sheet-adversary">
    <div class="sheet-fear-content">
    <label class="white-label">Fear Tracker:
      <input class="white-input" type="number" name="attr_fear_tracker" value="0" />
    </label>
  </div>

  <div class="sheet-normal-content">
    
  <div class="spacer"></div>
<div class="whisper-toggle">
  <label class="white-label">Whisper to GM?
    <select name="attr_whisper_type">
      <option value="">Public</option>
      <option value="/w gm ">Whisper</option>
    </select>
  </label>
</div>
    <h1>Daggerheart</h1>
<div class="name-grid">
<div class="section essentials-grid">
<div class="name-wrapper">
  <label for="character_name">Name:</label>
  <input type="text" name="attr_character_name" id="attr_character_name" />
</div>

<div class="resources-wrapper">
<div class="resource-toggle-wrapper">
  <input type="checkbox" class="toggle-resource-menu" name="attr_show_resource_menu" />
  <label class="resource-menu-button white-label" for="toggle-resource-menu">Short Rest</label>

  <div class="resource-menu">
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish HP}} {{Result=[[1d4]]}}">Tend To Wounds</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Resolve}} {{Result=[[1d4]]}}">Clear Stress</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Result=[[1d4]]}}">Repair Armor</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Gain 1 Hope, or 2 if you prepare with others}}">Prepare</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You do Something Else}}">Other</button>
  </div>
</div>

<div></div>

<div class="resource-toggle-wrapper-2">
  <input type="checkbox" class="toggle-resource-menu-2" name="attr_show_resource_menu-2" />
  <label class="resource-menu-button-2 white-label" for="toggle-resource-menu-2">Long Rest</label>

  <div class="resource-menu-2">
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish HP}} {{You Regenerate All Wounds}}">Tend To All Wounds</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Resolve}} {{You Clear All Stress}}">Clear All Stress</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Repair All Armor}}">Repair All Armor</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{Gain 1 Hope, or 2 if you prepare with others}}">Prepare</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You Make Progress In Your Project}}">Work On A Project</button>
    <button type="roll" value="@{whisper_type}&{template:default} {{name=Replenish Spirit}} {{You do Something Else}}">Other</button>
  </div>
</div>
</div>

<div class="conditions-grid">
<label class="condtions-label" for="vulnerable">Vulnerable</label><input type="checkbox" id="vulnerable" class="vulnerable" name="attr_vulnerable" />
<label class="condtions-label" for="hidden">Hidden</label><input type="checkbox" id="state_hidden" class="state_hidden" name="state_hidden" />
<label class="condtions-label" for="restrained">Restrained</label><input type="checkbox" id="restrained" class="restrained" name="attr_restrained" />
</div>

<div class="level-wrapper">
    <label class="level-label" for="level">Level:</label>
  <input class="level-input"type="number" name="attr_level" id="attr_level" min="1" max="20" /><br />
</div>
<div class="etc-essentials-wrapper">
  <label for="player_name">Player:</label>
  <input class="small-input" type="text" name="attr_player_name" id="attr_player_name" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Player Name}} {{Player Name=@{player_name}}}"></button>
  <label for="Ancestry">Ancestry:</label>
  <input class="small-input" type="text" name="attr_Ancestry" id="attr_Ancestry" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Ancestry}} {{Ancestry=@{Ancestry}}}"></button>
  <label for="Community">Community:</label>
  <input class="small-input" type="text" name="attr_Community" id="attr_Community" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Community}} {{Community=@{Community}}}"></button>
  <label for="class">Class:</label>
  <input class="small-input" type="text" name="attr_class" id="attr_class" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Class}} {{Class=@{class}}}"></button>
  <label for="subclass">Subclass:</label>
  <input class="small-input" type="text" name="attr_subclass" id="attr_subclass" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Subclass}} {{Subclass=@{subclass}}}"></button>
</div>
</div>
</div>

<h2>Combat Stats</h2>
<div class="combat_stats">  
<div class="Damage-Wounds-Wrapper-adv">
  <div class="damage-thresholds">
  <h2>Damage Thresholds</h2>
  <label class="white-label">Major Damage Threshold</label>
  <input class="white-input" type="text" name="attr_major_threshold" readonly />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Major Threshold}} {{Major Threshold=@{major_threshold}}}"></button>
  <label class="white-label">Severe Damage Threshold</label>
  <input class="white-input" type="text" name="attr_severe_threshold" readonly />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Severe Threshold}} {{Severe Threshold=@{severe_threshold}}}"></button>
  <div class="armor-score-boxes">
    <label class="white-label">Evasion:
  <input class="white-input" type="number" name="attr_evasion" />
  <button type="roll" value="@{whisper_type}&{template:default} {{name=Player Name}} {{Player Name=@{player_name}}}"></button>
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Evasion}} {{Evasion=@{evasion}}}"></button>
</label>
<label class="white-label">Score:
  <input class="white-input" type="number" name="attr_armor_score" />
  <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Armor Score}} {{Armor Score=@{armor_score}}}"></button>
</label>
<input type="hidden" name="attr_armor_score" class="sheet-armor_score" />

<div class="sheet-score-checks">
  <input type="checkbox" name="attr_armor_score_1" class="sheet-score-1" />
  <input type="checkbox" name="attr_armor_score_2" class="sheet-score-2" />
  <input type="checkbox" name="attr_armor_score_3" class="sheet-score-3" />
  <input type="checkbox" name="attr_armor_score_4" class="sheet-score-4" />
  <input type="checkbox" name="attr_armor_score_5" class="sheet-score-5" />
  <input type="checkbox" name="attr_armor_score_6" class="sheet-score-6" />
  <input type="checkbox" name="attr_armor_score_7" class="sheet-score-7" />
  <input type="checkbox" name="attr_armor_score_8" class="sheet-score-8" />
  <input type="checkbox" name="attr_armor_score_9" class="sheet-score-9" />
  <input type="checkbox" name="attr_armor_score_10" class="sheet-score-10" />
</div>
</div>
</div>

<div class="attributes-wrapper">
  <h2>Attributes</h2>
  <table>
    <thead>
      <tr>
        <th>Atrribute</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
<tr>
  <td>Difficulty</td>
  <td>
  <input class="white-input" type="number" name="attr_agility_base"value="0" />
  <input type="hidden" name="attr_agility_total" value="0" readonly />
<button type="roll"
  value="@{whisper_type}&{template:default} {{name=Agility Roll}} {{Hope=[[1d12]]}} {{Fear=[[1d12]]}} {{Modifier=[[@{agility_total}]]}}">
</button>
  </td>
</tr>

</div>


  <div class="hp-box">
    <h2>HP</h2>
    <!-- Controls -->
    <div class="container">
      <div class="radio-slots">
        <label for="slot_count">Number of Slots:</label>
            <input type="number" name="attr_slots_enabled" value="6" min="0" max="10" />
      </div>
      <!-- Mirror value for CSS to read -->
      <input
        type="hidden"
        name="attr_slots_enabled"
        id="attr_slots_enabled"
        value="1"
      />

      <div class="slots">
  <input type="checkbox" name="attr_slots1" class="slot slot-1" value="1" />
  <input type="checkbox" name="attr_slots2" class="slot slot-2" value="1" />
  <input type="checkbox" name="attr_slots3" class="slot slot-3" value="1" />
  <input type="checkbox" name="attr_slots4" class="slot slot-4" value="1" />
  <input type="checkbox" name="attr_slots5" class="slot slot-5" value="1" />
  <input type="checkbox" name="attr_slots6" class="slot slot-6" value="1" />
  <input type="checkbox" name="attr_slots7" class="slot slot-7" value="1" />
  <input type="checkbox" name="attr_slots8" class="slot slot-8" value="1" />
  <input type="checkbox" name="attr_slots9" class="slot slot-9" value="1" />
  <input type="checkbox" name="attr_slots10" class="slot slot-10" value="1" />
      </div>
    </div>

    <h2>Stress</h2>

    <!-- Controls -->
    <div class="container">
      <div class="radio-slots">
        <label for="slot_count">Number of Slots:</label>
            <input type="number" name="attr_stress_slots_enabled" value="6" min="0" max="10" />
      </div>
      <!-- Mirror value for CSS to read -->
      <input
        type="hidden"
        name="attr_stress_slots_enabled"
        id="attr_stress_slots_enabled"
        value="1"
      />

      <div class="slots">
        <input
          type="checkbox"
          name="attr_stress_slot_1"
          class="slot stress-slot-1"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_2"
          class="slot stress-slot-2"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_3"
          class="slot stress-slot-3"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_4"
          class="slot stress-slot-4"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_5"
          class="slot stress-slot-5"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_6"
          class="slot stress-slot-6"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_7"
          class="slot stress-slot-7"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_8"
          class="slot stress-slot-8"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_9"
          class="slot stress-slot-9"
          value="1"
        />
        <input
          type="checkbox"
          name="attr_stress_slot_10"
          class="slot stress-slot-10"
          value="1"
        />
      </div>
    </div>
  </div>



<div class="weapons-box">
<fieldset class="repeating_weapons">
  <div class="weapon-entry gold-border">
    <div class="weapon-header">
      <input type="text" name="attr_weapon_name" placeholder="Weapon Name" />
        <button class="quote-button" type="roll" name="roll_quote_all_weapon" value="@{whisper_type}&{template:default} {{name=Weapon: @{weapon_name}}}{{Attack Trait=@{attack_trait}}}{{Damage Die=@{damage_die_size}}}{{Additional Damage=@{additional_damage}}}{{Additional Features=@{additional_features}}}{{Base Damage Type=@{base_damage_type}}}{{Range=@{range}}}{{Burden=@{burden}}}{{Weapon Type=@{weapon_type}}}">
</button>
<button type="roll"
  name="roll_attack_damage"
  value="@{whisper_type}&{template:default} {{name=@{weapon_name}}} {{Attack=[[1d20]]}} {{@{attack_trait} Roll=[[ @{attack_trait_value} ]]}} {{Damage=[[@{damage_die_size} + @{additional_damage}]]}}">
  Roll Attack
</button>

<input type="hidden" name="attr_attack_trait_value" value="0" />

    </div>

    <!-- Hidden checkbox to toggle details -->
    <input type="checkbox" class="details-toggle" name="attr_show_details" />

    <!-- Label for toggling -->
    <label class="details-toggle-label"><input type="checkbox" class="details-toggle" name="attr_show_details" />Show Details ▼</label>

    <!-- Weapon details to show/hide -->
    <div class="weapon-details">
      <label>Attack Trait:
        <select name="attr_attack_trait">
          <option value="Agility">Agility</option>
          <option value="Strength">Strength</option>
          <option value="Finesse">Finesse</option>
          <option value="Instinct">Instinct</option>
          <option value="Presence">Presence</option>
          <option value="Knowledge">Knowledge</option>
        </select>
      </label>

      <label>Additional Damage:
        <input type="text" name="attr_additional_damage" placeholder="e.g. 1d10+3" />
      </label>

      <label>Additional Damage:
        <input type="text" name="attr_additional_features" placeholder="extra attack, etc" />
      </label>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Additional Features}} {{Description=@{additional_features}}}"></button>
      <label>Damage Die Size:
        <select name="attr_damage_die_size">
          <option value="d4">d4</option>
          <option value="d6">d6</option>
          <option value="d8">d8</option>
          <option value="d10">d10</option>
          <option value="d12">d12</option>
        </select>
      </label>

      <label>Base Damage Type:
        <select name="attr_base_damage_type">
          <option value="Physical">Physical</option>
          <option value="Magical">Magical</option>
          <option value="Any">Any</option>
        </select>
      </label>

      <label>Range:
        <select name="attr_range">
          <option value="Melee">Melee</option>
          <option value="Very Close">Very Close</option>
          <option value="Close">Close</option>
          <option value="Far">Far</option>
          <option value="Very Far">Very Far</option>
        </select>
      </label>

      <label>Burden:
        <select name="attr_burden">
          <option value="One Handed">One Handed</option>
          <option value="Two Handed">Two Handed</option>
        </select>
      </label>

      <label>Weapon Type:
        <select name="attr_weapon_type">
          <option value="Primary">Primary</option>
          <option value="Secondary">Secondary</option>
        </select>
      </label>
    </div>
  </div>
</fieldset>
</div>

<div class="experiences-box">
  <h1 class="experiences-label" style="color: white; background-color: black">Experiences:</h1>
  <fieldset class="repeating_experiences-box">
    <div class="repeating_experiences">
      <div class="attr_grid_item">
        <label for="attr_experiences_experience_field">Experience:</label>
        <input
          type="text"
          class="attr_experiences_experience_input"
          name="attr_experiences_experience_field"
        ></input>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Experience Name}} {{Experience-Name Bonus=@{experiences_experience_field} @{experiences_bonus_field}}}"></button>
      </div>
      <div class="attr_grid_item">
        <label for="attr_experiences_bonus_field">Bonus:</label>
        <input
          type="number"
          class="attr_experiences_bonus_input"
          name="attr_experiences_bonus_field"
        ></input>
      </div>
      </div>
    </div>
  </fieldset>
</div>

<div class="bottom-tab">
<div class="tab-section">
<!-- Radio inputs (tab selectors) -->
<input type="radio" name="sheet-tab" id="tab-domain-effects-adv" class="tab-toggle" checked>
<input type="radio" name="sheet-tab" id="tab-feature-effects-adv" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-equipment-adv" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-details-adv" class="tab-toggle">
<input type="radio" name="sheet-tab" id="tab-journal-adv" class="tab-toggle">

<div class="tabs">
  <label for="tab-domain-effects-adv">Domain Effects</label>
  <label for="tab-feature-effects-adv">Feature Effects</label>
  <label for="tab-equipment-adv">Equipment</label>
  <label for="tab-details-adv">Details</label>
  <label for="tab-journal-adv">Journal</label>
</div>

<!-- Effects Tab -->
<div class="domain-effects-tab-adv tab-content">
  <div class="attr_domains">
    <h2>Domains:</h2>

    <fieldset class="repeating_domain-effects">
      <div class="repeating_domain-effect-item">

        <label>Name:</label>
        <input type="text" name="attr_domain_effect_name" />
        <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Domain-Feature}} {{Name=@{domain_effect_name}}} {{Source=@{domain_effect_source}}} {{Description=@{domain_effect_description}}} {{Bonus Score=@{domain_effect_bonus_score}}} {{Mod Target=@{domain_effect_mod_target}}} {{Roll1=@{domain_effect_roll_1}}} {{Roll2=@{domain_effect_roll_2}}} {{Cost=@{domain_effect_cost}}} {{Uses per Rest=@{domain_effect_uses_per_rest}}}"></button>
        <label>Roll 1:</label>
          <button type="roll" name="roll_domain_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=@{domain_effect_name}}} {{Roll=[[@{domain_effect_roll_1}]]}}">
            Roll 1 
          </button>
          <label>Roll 2:</label>
          <button type="roll" name="roll_domain_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=@{domain_effect_name}}} {{Roll=[[@{domain_effect_roll_2}]]}}">
            Roll 2
          </button>
        <input type="checkbox" class="details-toggle" name="attr_domain_show_details" />
    <span class="details-toggle-label">Show Details ▼</span>

        <div class="domain-details">

          <label>Source:</label>
          <input type="text" name="attr_domain_effect_source" />

          <label>Description:</label>
          <textarea name="attr_domain_effect_description" class="overflow"></textarea>

          <label>Active?</label>
          <input type="checkbox" name="attr_domain_effect_bonus_active" />

          <label>Bonus:</label>
          <input type="number" name="attr_domain_effect_bonus_score" value="0" />

          <label>Modify Stat:</label>
          <select name="attr_domain_effect_mod_target">
            <option value="strength">Strength</option>
            <option value="agility">Agility</option>
            <option value="finesse">Finesse</option>
            <option value="instinct">Instinct</option>
            <option value="presence">Presence</option>
            <option value="knowledge">Knowledge</option>
            <option value="attack">Attack Bonus</option>
          </select>

          <label>Roll 1:</label>
          <button type="roll" name="roll_domain_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 1}} {{Roll=[[@{domain_effect_roll_1}]]}}">
            Roll 1
          </button>
          <input type="text" name="attr_domain_effect_roll_1" />

          <label>Roll 2:</label>
          <button type="roll" name="roll_domain_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Domain Roll 2}} {{Roll=[[@{domain_effect_roll_2}]]}}">
            Roll 2
          </button>
          <input type="text" name="attr_domain_effect_roll_2" />

          <label>Cost:</label>
          <input type="text" name="attr_domain_effect_cost" />

          <label>How Many Uses:</label>
          <input type="number" name="attr_domain_effect_uses_per_rest" />

        </div>
      </div>
    </fieldset>
  </div>
</div>

<div class="feature-effects-tab-adv tab-content">
  <div class="attr_features">
    <h2>Features:</h2>

    <fieldset class="repeating_feature-effects">
      <div class="repeating_feature-effect-item">

        <label>Name:</label>
        <input type="text" name="attr_feature_effect_name" />
        <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Feature-Effect}} {{Name=@{feature_effect_name}}} {{Source=@{feature_effect_source}}} {{Description=@{feature_effect_description}}} {{Bonus Score=@{feature_effect_bonus_score}}} {{Mod Target=@{feature_effect_mod_target}}} {{Roll1=@{feature_effect_roll_1}}} {{Roll2=@{feature_effect_roll_2}}} {{Cost=@{feature_effect_cost}}} {{Uses per Rest=@{feature_effect_uses_per_rest}}}"></button>
    <input type="checkbox" class="details-toggle" name="attr_feature_show_details" />
          <label>Roll 1:</label>
          <button type="roll" name="roll_feature_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=@{feature_effect_name}}} {{Roll=[[@{feature_effect_roll_1}]]}}">
            Roll 1
          </button>
          <label>Roll 2:</label>
          <button type="roll" name="roll_feature_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=@{feature_effect_name}}} {{Roll=[[@{feature_effect_roll_2}]]}}">
            Roll 2
          </button>
    <span class="details-toggle-label">Show Details ▼</span>

        <div class="feature-details">

          <label>Source:</label>
          <input type="text" name="attr_feature_effect_source" />

          <label>Description:</label>
          <textarea name="attr_feature_effect_description" class="overflow"></textarea>

          <label>Active?</label>
          <input type="checkbox" name="attr_feature_effect_bonus_active" />

          <label>Bonus:</label>
          <input type="number" name="attr_feature_effect_bonus_score" value="0" />

          <label>Modify Stat:</label>
          <select name="attr_feature_effect_mod_target">
            <option value="strength">Strength</option>
            <option value="agility">Agility</option>
            <option value="finesse">Finesse</option>
            <option value="instinct">Instinct</option>
            <option value="presence">Presence</option>
            <option value="knowledge">Knowledge</option>
            <option value="attack">Attack Bonus</option>
          </select>

          <label>Roll 1:</label>
          <button type="roll" name="roll_feature_effect_roll_1"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 1}} {{Roll=[[@{feature_effect_roll_1}]]}}">
            Roll 1
          </button>
          <input type="text" name="attr_feature_effect_roll_1" />

          <label>Roll 2:</label>
          <button type="roll" name="roll_feature_effect_roll_2"
            value="@{whisper_type}&{template:default} {{name=Feature Roll 2}} {{Roll=[[@{feature_effect_roll_2}]]}}">
            Roll 2
          </button>
          <input type="text" name="attr_feature_effect_roll_2" />

          <label>Cost:</label>
          <input type="text" name="attr_feature_effect_cost" />

          <label>How Many Uses:</label>
          <input type="number" name="attr_feature_effect_uses_per_rest" />

        </div>
      </div>
    </fieldset>
  </div>
  </div>

  <!-- Equipment Tab (fixed here) -->
  <div class="tab-content tab-equipment-adv">
    <div class="gold">
    <h2>Gold:</h2>
    <label>Handfulls:</label>
      <input type="number" name="attr_gold_handfulls" />
    <label>Bags:</label>
      <input type="number" name="attr_gold_bags" />
    <label>Chest:</label>
      <input type="number" name="attr_gold_chest" />
    </div>
    <h1 style="color: white; background-color: black">Equipment:</h1>
<fieldset class="repeating_armor">
  <div class="armor-item">
    <label>
      <input type="checkbox" name="attr_armor_active" /> Equipped
    </label>

    <label>Name:
      <input type="text" name="attr_armor_name" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Armor}} {{Name=@{armor_name}}} {{Description=@{armor_description}}} {{Major Threshold=@{armor_major_threshold}}} {{Severe Threshold=@{armor_severe_threshold}}} {{Armor Score=@{armor_score}}}"></button>
    <label>Description:
      <textarea name="attr_armor_description" class="overflow"></textarea>
    </label>

    <label>Major Threshold:
      <input type="number" name="attr_armor_major_threshold" />
    </label>

    <label>Severe Threshold:
      <input type="number" name="attr_armor_severe_threshold" />
    </label>

    <label>Score:
      <input type="number" name="attr_armor_score" />
    </label>
  </div>
</fieldset>
  </div>

  <!-- Details Tab -->
  <div class="tab-content tab-details-adv">
    <h2>Details</h2>
<fieldset class="repeating_armor">
    <label>Question:
      <input type="text" name="attr_details_question" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Details Question}} {{Question=@{details_question}}}"></button>
      <label>Answer:
      <textarea name="attr_details_description" class="overflow"></textarea>
      <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Details Answer}} {{Answer=@{details_description}}}"></button>
    </label>
    </fieldset>
  </div>

  <!-- Journal Tab -->
  <div class="tab-content tab-journal-adv">
    <h2>Journal</h2>
<fieldset class="repeating_armor">
    <label>Title:
      <input type="text" name="attr_journal_title" />
    </label>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Journal Title}} {{Title=@{journal_title}}}"></button>
      <label>Entry:
      <textarea name="attr_journal_description" class="overflow"></textarea>
    <button class="quote-button" type="roll" value="@{whisper_type}&{template:default} {{name=Journal Entry}} {{Entry=@{journal_description}}}"></button>
    </label>
    </fieldset>
  </div>
</div>
</div>
</div>
</div>
</div>

<script type="text/worker">
  on("change:level change:armor_major_threshold change:armor_severe_threshold", function () {
    getAttrs(["level", "armor_major_threshold", "armor_severe_threshold"], function (values) {
      const level = parseInt(values.level, 10) || 0;
      const armorMajor = parseInt(values.armor_major_threshold, 10) || 0;
      const armorSevere = parseInt(values.armor_severe_threshold, 10) || 0;

      const majorThreshold = level + armorMajor;
      const severeThreshold = level + armorSevere;
      const summary = `Level ${level}: Major ${majorThreshold} / Severe ${severeThreshold}`;

      setAttrs({
        major_threshold: majorThreshold,
        severe_threshold: severeThreshold,
        armor_summary: summary
      });
    });
  });
</script>

<script type="text/worker">
  on("change:level change:repeating_armor change:repeating_armor:armor_active change:repeating_armor:armor_major_threshold change:repeating_armor:armor_severe_threshold", function () {
    getSectionIDs("repeating_armor", function (ids) {
      getAttrs(["level"], function (base) {
        const level = parseInt(base.level) || 0;

        // Fetch all repeating armor attributes
        const fieldNames = [];
        ids.forEach(id => {
          fieldNames.push(
            `repeating_armor_${id}_armor_active`,
            `repeating_armor_${id}_armor_major_threshold`,
            `repeating_armor_${id}_armor_severe_threshold`
          );
        });

        getAttrs(fieldNames, function (fields) {
          let major = 0;
          let severe = 0;

          // Use first checked armor
          for (let id of ids) {
            if (fields[`repeating_armor_${id}_armor_active`] === "on") {
              major = parseInt(fields[`repeating_armor_${id}_armor_major_threshold`]) || 0;
              severe = parseInt(fields[`repeating_armor_${id}_armor_severe_threshold`]) || 0;
              break;
            }
          }

          const majorThreshold = level + major;
          const severeThreshold = level + severe;
          const summary = `Level ${level}: Major ${majorThreshold} / Severe ${severeThreshold}`;

          setAttrs({
            major_threshold: majorThreshold,
            severe_threshold: severeThreshold,
            armor_summary: summary
          });
        });
      });
    });
  });
</script>

<script type="text/worker">
  on("change:repeating_armor:armor_score", function (eventInfo) {
    const id = eventInfo.sourceAttribute.split("_")[2];
    const baseName = `repeating_armor_${id}`;

    getAttrs([`${baseName}_armor_score`], function (values) {
      const score = parseInt(values[`${baseName}_armor_score`]) || 0;

      const updates = {};
      for (let i = 1; i <= 10; i++) {
        updates[`${baseName}_armor_score_${i}_disabled`] = i <= score ? "0" : "1";
      }

      setAttrs(updates);
    });
  });
</script>

<script type="text/worker">
on("change:repeating_weapons:attack_trait", function(eventInfo) {
  getAttrs([
    "repeating_weapons_" + eventInfo.sourceAttribute.split("_")[2] + "_attack_trait",
    "agility", "strength", "finesse", "instinct", "presence", "knowledge"
  ], function(values) {
    const trait = (values[`repeating_weapons_${eventInfo.sourceAttribute.split("_")[2]}_attack_trait`] || "").toLowerCase();
    const traitValue = parseInt(values[trait]) || 0;
    const setting = {};
    setting[`repeating_weapons_${eventInfo.sourceAttribute.split("_")[2]}_attack_trait_value`] = traitValue;
    setAttrs(setting);
  });
});
</script>

<script type="text/worker">
  on("change:level change:armor_major_threshold change:armor_severe_threshold", function () {
    getAttrs(["level", "armor_major_threshold", "armor_severe_threshold"], function (values) {
      const level = parseInt(values.level, 10) || 0;
      const armorMajor = parseInt(values.armor_major_threshold, 10) || 0;
      const armorSevere = parseInt(values.armor_severe_threshold, 10) || 0;

      const majorThreshold = level + armorMajor;
      const severeThreshold = level + armorSevere;
      const summary = `Level ${level}: Major ${majorThreshold} / Severe ${severeThreshold}`;

      setAttrs({
        major_threshold: majorThreshold,
        severe_threshold: severeThreshold,
        armor_summary: summary
      });
    });
  });
</script>

<script type="text/worker">
const stats = ["strength", "agility", "finesse", "instinct", "presence", "knowledge", "attack"];

const calculateStatTotal = (stat) => {
  getAttrs([`${stat}_base`], (baseValues) => {
    const base = parseInt(baseValues[`${stat}_base`], 10) || 0;

    const getBonusSum = (section, prefix, callback) => {
      getSectionIDs(section, (ids) => {
        if (!ids.length) return callback(0);

        const fields = ids.flatMap(id => [
          `${section}_${id}_${prefix}bonus_active`,
          `${section}_${id}_${prefix}bonus_score`,
          `${section}_${id}_${prefix}mod_target`
        ]);

        getAttrs(fields, (values) => {
          let sum = 0;
          ids.forEach(id => {
            const active = values[`${section}_${id}_${prefix}bonus_active`] === "on";
            const score = parseInt(values[`${section}_${id}_${prefix}bonus_score`], 10) || 0;
            const target = values[`${section}_${id}_${prefix}mod_target`];
            if (active && target === stat) {
              sum += score;
            }
          });
          callback(sum);
        });
      });
    };

    getBonusSum("repeating_domain-effects", "domain_effect_", (domainSum) => {
      getBonusSum("repeating_feature-effects", "feature_effect_", (featureSum) => {
        const total = base + domainSum + featureSum;
        setAttrs({ [`${stat}_total`]: total });
      });
    });
  });
};

// Initial run
on("sheet:opened", () => {
  stats.forEach(stat => calculateStatTotal(stat));
});

// Base stat changes
stats.forEach(stat => {
  on(`change:${stat}_base`, () => calculateStatTotal(stat));
});

// Listen for changes in the repeating sections
["repeating_domain-effects", "repeating_feature-effects"].forEach(section => {
  const prefix = section.includes("domain") ? "domain_effect_" : "feature_effect_";

  on(`change:${section} remove:${section}`, () => {
    stats.forEach(stat => calculateStatTotal(stat));
  });

  on(`change:${section}:*:${prefix}bonus_active change:${section}:*:${prefix}bonus_score change:${section}:*:${prefix}mod_target`, () => {
    stats.forEach(stat => calculateStatTotal(stat));
  });
});
</script>

<script type="text/worker">
const cascadeSlots = [
  'slots1','slots2','slots3','slots4','slots5',
  'slots6','slots7','slots8','slots9','slots10'
];

cascadeSlots.forEach((slot, index) => {
  on(`change:${slot}`, function(event) {
    const updates = {};
    const checked = event.newValue === '1';

    if (checked) {
      // ✅ Check this and all *lower* boxes
      for (let i = 0; i <= index; i++) {
        updates[cascadeSlots[i]] = '1';
      }
    } else {
      // ❌ Uncheck this and all *higher* boxes
      for (let i = index; i < cascadeSlots.length; i++) {
        updates[cascadeSlots[i]] = '0';
      }
    }

    setAttrs(updates, {silent: true});
  });
});
</script>

<script type="text/worker">
  const stressSlots = [
  'stress_slot_1','stress_slot_2','stress_slot_3','stress_slot_4','stress_slot_5',
  'stress_slot_6','stress_slot_7','stress_slot_8','stress_slot_9','stress_slot_10'
];

stressSlots.forEach((slot, index) => {
  on(`change:${slot}`, function(event) {
    const updates = {};
    const isChecked = event.newValue === '1';

    if (isChecked) {
      // ✅ Check this and all *lower-numbered* boxes
      for (let i = 0; i <= index; i++) {
        updates[stressSlots[i]] = '1';
      }
    } else {
      // ❌ Uncheck this and all *higher-numbered* boxes
      for (let i = index; i < stressSlots.length; i++) {
        updates[stressSlots[i]] = '0';
      }
    }

    setAttrs(updates, {silent: true});
  });
});
</script>

<script type="text/worker">
  const hopeSlots = [
  'hope_slot_1','hope_slot_2','hope_slot_3','hope_slot_4','hope_slot_5',
  'hope_slot_6','hope_slot_7','hope_slot_8','hope_slot_9','hope_slot_10'
];

hopeSlots.forEach((slot, index) => {
  on(`change:${slot}`, function(event) {
    const updates = {};
    const isChecked = event.newValue === '1';

    if (isChecked) {
      // ✅ Check this and all *lower-numbered* boxes
      for (let i = 0; i <= index; i++) {
        updates[hopeSlots[i]] = '1';
      }
    } else {
      // ❌ Uncheck this and all *higher-numbered* boxes
      for (let i = index; i < hopeSlots.length; i++) {
        updates[hopeSlots[i]] = '0';
      }
    }

    setAttrs(updates, {silent: true});
  });
});
</script>

<script type="text/worker">
on("change:hope_max sheet:opened", () => {
  getAttrs(["hope_max"], (v) => {
    const max = parseInt(v.hope_max, 10) || 0;
    const update = {};

    for (let i = 1; i <= 6; i++) {
      update[`show_hope_slot_${i}`] = i <= max ? "1" : "0";
    }

    setAttrs(update);
  });
});
</script>

<script type="text/worker">
const stats = ["strength", "agility", "finesse", "instinct", "presence", "knowledge", "attack"];

// Calculate total stat from base + modifiers
const calculateStatTotal = (stat) => {
  getAttrs([`${stat}_base`], (baseValues) => {
    const base = parseInt(baseValues[`${stat}_base`], 10) || 0;

    const getBonusSum = (section, prefix, callback) => {
      getSectionIDs(section, (ids) => {
        if (!ids.length) return callback(0);

        const fields = ids.flatMap(id => [
          `${section}_${id}_${prefix}bonus_active`,
          `${section}_${id}_${prefix}bonus_score`,
          `${section}_${id}_${prefix}mod_target`
        ]);

        getAttrs(fields, (values) => {
          let sum = 0;
          ids.forEach(id => {
            const active = values[`${section}_${id}_${prefix}bonus_active`] === "on";
            const score = parseInt(values[`${section}_${id}_${prefix}bonus_score`], 10) || 0;
            const target = values[`${section}_${id}_${prefix}mod_target`];
            if (active && target === stat) {
              sum += score;
            }
          });
          callback(sum);
        });
      });
    };

    getBonusSum("repeating_domain-effects", "domain_effect_", (domainSum) => {
      getBonusSum("repeating_feature-effects", "feature_effect_", (featureSum) => {
        const total = base + domainSum + featureSum;
        const update = {};
        update[`${stat}_total`] = total;
        setAttrs(update, () => {
          updateAllWeaponTraitValues(); // Update weapon trait values whenever a stat total changes
        });
      });
    });
  });
};

// Update a single weapon row's trait value
const updateWeaponTraitValue = (id) => {
  const traitAttr = `repeating_weapons_${id}_attack_trait`;
  getAttrs([traitAttr], (v) => {
    const trait = (v[traitAttr] || "").toLowerCase();
    if (stats.includes(trait)) {
      const totalAttr = `${trait}_total`;
      getAttrs([totalAttr], (vals) => {
        const total = parseInt(vals[totalAttr], 10) || 0;
        const update = {};
        update[`repeating_weapons_${id}_attack_trait_value`] = total;
        setAttrs(update);
      });
    } else {
      const update = {};
      update[`repeating_weapons_${id}_attack_trait_value`] = 0;
      setAttrs(update);
    }
  });
};

// Update all weapon rows
const updateAllWeaponTraitValues = () => {
  getSectionIDs("repeating_weapons", (ids) => {
    ids.forEach(id => updateWeaponTraitValue(id));
  });
};

// Initial run on sheet open
on("sheet:opened", () => {
  stats.forEach(stat => calculateStatTotal(stat));
  updateAllWeaponTraitValues();
});

// Recalculate total when base value changes
stats.forEach(stat => {
  on(`change:${stat}_base`, () => calculateStatTotal(stat));
});

// Listen for changes in domain/feature effect modifiers
["repeating_domain-effects", "repeating_feature-effects"].forEach(section => {
  const prefix = section.includes("domain") ? "domain_effect_" : "feature_effect_";

  on(`change:${section} remove:${section}`, () => {
    stats.forEach(stat => calculateStatTotal(stat));
  });

  on(`change:${section}:*:${prefix}bonus_active change:${section}:*:${prefix}bonus_score change:${section}:*:${prefix}mod_target`, () => {
    stats.forEach(stat => calculateStatTotal(stat));
  });
});

// Update weapon trait value when the selected trait changes
on("change:repeating_weapons:attack_trait", (event) => {
  const id = event.sourceAttribute.split("_")[2]; // Extract row ID
  updateWeaponTraitValue(id);
});
</script>

<script type="text/worker">
const baseStats = ["agility", "strength", "finesse", "instinct", "presence", "knowledge"];

baseStats.forEach(stat => {
  on(`change:${stat}_base change:repeating_attrmods`, () => updateTotals());
});

function updateTotals() {
  getSectionIDs("repeating_attrmods", ids => {
    const attrList = baseStats.map(stat => `${stat}_base`);
    let fieldNames = [...attrList];

    ids.forEach(id => {
      fieldNames.push(`repeating_attrmods_${id}_mod_target`);
      fieldNames.push(`repeating_attrmods_${id}_mod_value`);
      fieldNames.push(`repeating_attrmods_${id}_mod_enabled`);
    });

    getAttrs(fieldNames, values => {
      let totals = {};
      baseStats.forEach(stat => {
        const base = parseInt(values[`${stat}_base`], 10) || 0;
        totals[`${stat}_total`] = base;
      });

      ids.forEach(id => {
        const enabled = values[`repeating_attrmods_${id}_mod_enabled`] === "1";
        if (!enabled) return;

        const target = values[`repeating_attrmods_${id}_mod_target`];
        const value = parseInt(values[`repeating_attrmods_${id}_mod_value`], 10) || 0;

        if (baseStats.includes(target)) {
          totals[`${target}_total`] += value;
        }
      });

      setAttrs(totals);
    });
  });
}
</script>

<script type="text/worker">
  on("change:repeating_weaponmods change:repeating_weapons", function () {
  updateWeaponModifiers();
});

function updateWeaponModifiers() {
  getSectionIDs("repeating_weapons", weaponIDs => {
    getSectionIDs("repeating_weaponmods", modIDs => {
      const attrList = [];

      // Collect field names for all weapons
      weaponIDs.forEach(id => {
        attrList.push(`repeating_weapons_${id}_weapon_name`);
        attrList.push(`repeating_weapons_${id}_attack_trait`);
      });

      // Collect all modifier fields
      modIDs.forEach(id => {
        attrList.push(`repeating_weaponmods_${id}_target_weapon_name`);
        attrList.push(`repeating_weaponmods_${id}_attack_mod`);
        attrList.push(`repeating_weaponmods_${id}_damage_mod`);
        attrList.push(`repeating_weaponmods_${id}_mod_enabled`);
      });

      // Get all values
      getAttrs(attrList, values => {
        const updates = {};

        weaponIDs.forEach(weaponID => {
          const wName = values[`repeating_weapons_${weaponID}_weapon_name`] || "";
          const trait = values[`repeating_weapons_${weaponID}_attack_trait`] || "";

          let totalAttackMod = 0;
          let totalDamageMod = 0;

          // Go through modifiers
          modIDs.forEach(modID => {
            const enabled = values[`repeating_weaponmods_${modID}_mod_enabled`] === "1";
            const targetName = values[`repeating_weaponmods_${modID}_target_weapon_name`] || "";
            const attackMod = parseInt(values[`repeating_weaponmods_${modID}_attack_mod`], 10) || 0;
            const damageMod = parseInt(values[`repeating_weaponmods_${modID}_damage_mod`], 10) || 0;

            if (enabled && targetName.toLowerCase() === wName.toLowerCase()) {
              totalAttackMod += attackMod;
              totalDamageMod += damageMod;
            }
          });

          // Compose final computed values
          updates[`repeating_weapons_${weaponID}_attack_trait_value`] = `@{${trait.toLowerCase()}_total} + ${totalAttackMod}`;
          updates[`repeating_weapons_${weaponID}_final_damage_bonus`] = `${totalDamageMod}`;
        });

        setAttrs(updates, {silent: true});
      });
    });
  });
}
</script>
</div>