<div id="menuContainer">

<div id="credits"> <div class="creditIcon"></div> 

<div class="creditText">
<span data-i18n="credits0">
<b>Project Moon TRPG</b><br> is a fan-made system based on the games of Project Moon.</span><br><br>

<b><span data-i18n="credits1">Sheet base:</span></b> @ChungMu35<br>
<b><span data-i18n="credits2">Game system:</span></b> @helloing0119<br>
<b><span data-i18n="credits3">Translations/Editing:</span></b> @punibird<br>
<b><span data-i18n="credits4">Supported by:</span></b> Project Moon Tabletop Discord<br><br>
<b>Discord:</b> <input type="text" class="darkInput" value="https://discord.gg/AJBnUV5tbVt"><br>
<b><span data-i18n="credits5">System:</span></b> <input type="text" class="darkInput" value="https://drive.google.com/drive/u/2/folders/15nMYLz0sB5xWUiSOG4oN6IsteRJjpdZk">
</div>

<br>
</div>

<div id="settings">
<div class="settingsIcon"><img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/gear.png"></div>

	<div class="rowContainer">
		<div class="settingsText">
			<span class="settingsTitle" data-i18n="settings-general">General Settings</span>
		
			<input type="text" name="attr_messageOverride" value="0" hidden="true">
				
			<label for="GenericTokenMode"><input type="checkbox" id="GenericTokenMode" name="attr_settingGenericTokenMode" value="true"><span data-i18n="settings-generictokenmode">Sheet: Generic token mode</span></label>
			
			<label for="DistortSave"><input type="checkbox" id="DistortSave" name="attr_settingDistortSave" value="true"><span data-i18n="settings-distortsave">Auto: Save/Load on Distort</span></label>
		
			<label for="SimpleDisplay"><input type="checkbox" id="SimpleDisplay" name="attr_settingSimpleDisplay" value="true"><span data-i18n="settings-simpledisplay">Simple roll display</label>
		
			<label for="ExtraEquip"><input type="checkbox" id="ExtraEquip" name="attr_settingExtraEquip" value="true"><span data-i18n="settings-extraequip">Extra weapons/tools/skills</span></label>
		
			<label for="HideSpecial"><input type="checkbox" id="HideSpecial" name="attr_settingHideSpecial" value="true"><span data-i18n="settings-hidespecial">Hide: Special items</span></label>
		
			<label for="HelperText"><input type="checkbox" id="HelperText" name="attr_settingHelperText" value="true"><span data-i18n="settings-hidehelpertext">Hide:  Helper text</span></label>
		
			<label for="HideShare"><input type="checkbox" id="HideShare" name="attr_settingHideShare" value="true"><span data-i18n="settings-hideshare">Hide: Share buttons</span></label>
		
			<label for="HideUses"><input type="checkbox" id="HideUses" name="attr_settingHideUses" value="true"><span data-i18n="settings-hideuses">Hide: Uses in messages</span></label>
		
			
			<span class="settingsTitle" data-i18n="settings-combat">Combat Settings</span>

			<label for="LoopEnabled"><input type="checkbox" id="LoopEnabled" name="attr_settingLoopEnabled" value="true"><span data-i18n="settings-autoupdate">Auto: Update on Round end</span></label>
			<input type="checkbox" name="attr_loopEnabled" value="true" hidden="true">
			<input type="number" name="attr_configLoopDelay" value="10000" hidden="true">
			<input type="number" name="attr_configUpdateDelay" value="1000" hidden="true">
			<input type="text" name="attr_configTrackerItemName" value="Round end" hidden="true">

			<label for="AutoDetect"><input type="checkbox" id="AutoDetect" name="attr_settingAutoDetect" value="true" checked><span data-i18n="settings-detect">Auto: Detect combat states</span></label>
		
			<label for="TurnUpdate"><input type="checkbox" id="TurnUpdate" name="attr_settingTurnUpdate" value="true"><span data-i18n="settings-turnupdate">Auto: Update Turn Order</span></label>
			
			<label for="MultihitUses"><input type="checkbox" id="MultihitUses" name="attr_settingMultihitUses" value="true"><span data-i18n="settings-multihituses">Spend Uses per Multi-hit</span></label>
		
			<label for="MultihitFull"><input type="checkbox" id="MultihitFull" name="attr_settingMultihitFull" value="true"><span data-i18n="settings-multihitfull">No Power debuff on Multi-hit</span></label>

			<label for="HideCombatOptions"><input type="checkbox" id="HideCombatOptions" name="attr_settingHideCombatOptions" value="true"><span data-i18n="settings-hidecombatoptions">Hide: Combat options</span></label>

			<label for="HideFromTargeting"><input type="checkbox" id="HideFromTargeting" name="attr_settingHideDetailsFromTargeting" value="true"><span data-i18n="settings-hidedetailsfromtargeting">Hide: Details from targeting</span></label>
		</div>

		<div class="settingsText" style="padding-left: 10px;">
			<span class="settingsTitle" data-i18n="settings-ailments">Ailment Settings</span>

			<label for="MuteMessage"><input type="checkbox" id="MuteMessage" name="attr_settingMuteMessage" value="true"><span data-i18n="settings-mute">Mute ailment messages</span></label>

			<label for="LimbusStyle"><input type="checkbox" id="LimbusStyle" name="attr_settingLimbusStyle" value="true"><span data-i18n="settings-limbusstyle">Limbus style ailment icons</span></label>

			<label for="HideNextTurn"><input type="checkbox" id="HideNextTurn" name="attr_settingHideNextTurn" value="true"><span data-i18n="settings-hidenextturn">Hide: Next turn input </span></label>

			<label for="BurnImmune"><input type="checkbox" id="BurnImmune" name="attr_settingBurnImmune" value="true"><span data-i18n="settings-burnimmune">No Burn damage</span></label>
		
			<label for="BleedImmune"><input type="checkbox" id="BleedImmune" name="attr_settingBleedImmune" value="true"><span data-i18n="settings-bleedimmune">No Bleed damage</span></label>


			<span class="settingsTitle" data-i18n="settings-damage-helper">Damage Helper Settings</span>

			<label for="AutoApplyDamage"><input type="checkbox" id="AutoApplyDamage" name="attr_settingAutoApplyDamage" value="true" checked><span data-i18n="settings-autoapplydamage">Auto: Apply damage taken</label>

			<label for="HideBarUpdate"><input type="checkbox" id="HideBarUpdate" name="attr_settingHideBarUpdate" value="true"><span data-i18n="settings-hidebarupdate">Hide: Status bar update </span></label>


			<span class="settingsTitle" data-i18n="settings-autoeffects">AutoEffect Settings</span>

			<label for="CollapseSections"><input type="checkbox" id="CollapseSections" name="attr_settingCollapseAutoEffectSections" value="true"><span data-i18n="settings-collapsesections">Collapse AutoEffect sections</span></label>

			<label for="ConditionalButtonReminder"><input type="checkbox" id="ConditionalButtonReminder" name="attr_settingHideConditionalButtonReminder" value="true"><span data-i18n="settings-hideconditionalreminder">Hide: Conditional button reminder</span></label>

			<label for="HideActionButtons"><input type="checkbox" id="HideActionButtons" name="attr_settingHideActionButtons" value="true"><span data-i18n="settings-hideactionbuttons">Hide: Action buttons</span></label>
			
			<label for="HideBaseEffect"><input type="checkbox" id="HideBaseEffect" name="attr_settingHideBaseEffect" value="true"><span data-i18n="settings-hidebaseeffect">Hide: Base effects</span></label>
		</div>
	</div>

</div>

</div>
<br>

 	<div class="player">
            <div><span data-i18n="assessed">Assessed by: </span></div>
            <input type="text" placeholder="Player name" id="playerName" name="attr_player_name" data-i18n-placeholder="playername">
        </div>

              <div id="logo">
                    <img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/PMTRPGLogo.png" title="Project Moon TRPG"></div>

	<div class="rowContainer centerFlex">    
        <div id="sheetTitle"><span data-i18n="sheet-title">Background Investigation and Combat Ability Report</span></div>

	      </div>


<div id="sheetWrapper">

<input type="checkbox" id="messageToggle" name="attr_popup_display" value="true" hidden="true">
<div id="messagePop">
<div class="rowContainer centerFlex">

<div class="messageContent columnAlign">

<div class="messageClose">
<label for="messageToggle">x</label></div>

<input type="text" class="mHeader transpInput" name="attr_popup_messageHeader">
<textarea type="text" class="mBody transpInput" name="attr_popup_messageBody" style="overflow: hidden;">


</div>
</div>
</div>

<!-- AutoScript edit popup -->
<input type="checkbox" id="autoScriptEditorToggle" name="attr_autoScriptEditor_display" value="true" hidden="true">
<div class="contentContainer darkBG autoscriptEditorContainer">
	<input type="checkbox" class="toggleStylingButton" name="attr_autoScriptEditorTarget" value="autoScriptStyling" hidden="true">
	<button type="action" id="autoScriptStyling" class="darkInput styleAutoScriptButton" name="act_autoScriptEdit" data-i18n-title="autoscript-open-style-editor" title="Open Styling Editor" data-i18n="autoscript-open-style-editor">Open AutoScript Styling Editor</button>
	<button type="action" id="autoScriptStylingDefault" class="darkInput styleAutoScriptDefault" name="act_autoScriptStylingDefault">Reset Styling to Default</button>
	<button type="action" class="darkInput saveAutoScriptButton" name="act_saveAutoScriptEdit" data-i18n-title="autoscript-save-changes-title" title="Save AutoScript changes" data-i18n="autoscript-save-changes">Save</button>
	<button type="action" class="darkInput closeAutoScriptButton" name="act_closeAutoScriptEdit" data-i18n-title="autoscript-close-editor" title="Save and close AutoScript Editor"></button>
	<label for="autoScriptInput" style="margin-left: 5px;" data-i18n="autoscript-editor">AutoScript Editor</label>
	<input type="text" class="autoScriptEditorTarget darkBG" name="attr_autoScriptEditorTarget" readonly>
	<textarea id="autoScriptInput" name="attr_autoScriptEditorInput"></textarea>
	<textarea type="text" class="autoScriptStylingStorage" name="attr_autoScriptStyling" hidden="true"></textarea>
	<textarea type="text" class="autoScriptStylingStorage" name="attr_autoScriptStylingDefault" hidden="true"></textarea>
</div>


<!-- Generic token mode popup -->
<input type="checkbox" id="genericTokenModeToggle" name="attr_settingGenericTokenMode" value="true" hidden="true">
<div class="contentContainer columnAlign genericTokenContainer">

	<!-- Generic token instances -->
	<div class="rowContainer genericTokenInstanceContainer">
		<fieldset class="repeating_tokens">
			<input type="checkbox" class="style-toggle" name="attr_token_selected" value="true" hidden="true">
			<div class="contentContainer darkBG genericToken">
				<!-- Selection button -->
				<input type="checkbox" class="hide-toggle-rev" name="attr_token_selected" value="true" hidden="true">
				<button type="action" class="hide-item-rev genericTokenSelectButton" name="act_selectinstance"></button>

				<!-- Token attributes -->
				<input type="text" class="tokenName" name="attr_tokenName" placeholder="Token Name" data-i18n-placeholder="token-name" readonly>
				<input type="text" name="attr_tokenId" hidden="true">
				<input type="text" name="attr_tokenAilmentList" hidden="true">

				<!-- Status bars -->
				<div class="bars">
					<input id="HPbar" class="Cstat HPtext" type="number" name="attr_HP" value="30">
					<div>
						<input type="checkbox" class="hide-toggle" name="attr_HP_token_display" value="true" hidden="true">
						<input id="HPbarToken" class="hide-item Tstat HPtext" type="number" name="attr_HP_token" value="">
					</div>
					<input class="Mstat HP" type="text" name="attr_HP_max" value="30">
				</div>
				<div class="bars">
					<input id="STGRbar" class="Cstat egoSTGRtext" type="number" name="attr_StagRes" value="20">
					<div>
						<input type="checkbox" class="hide-toggle" name="attr_StagRes_token_display" value="true" hidden="true">
						<input id="STGRbarToken" class="hide-item Tstat egoSTGRtext" type="number" name="attr_StagRes_token" value="">
					</div>
					<input class="Mstat egoSTGR" type="text" name="attr_StagRes_max" value="20">
				</div>
				<div class="bars">
					<input type="checkbox" class="hide-toggle-rev" name="attr_distortState_token" value="true">
					<div class="hide-item-rev">
						<input id="SANbar" class="Cstat SANtext" type="number" name="attr_SP" value="15">
						<div>
							<input type="checkbox" class="hide-toggle" name="attr_SP_token_display" value="true" hidden="true">
							<input id="SANbarToken" class="hide-item Tstat SANtext" type="number" name="attr_SP_token" value="">
						</div>
						<input class="Mstat SAN" type="text" name="attr_SP_max" value="15">
					</div>
				</div>
				<div class="bars">
					<input id="LIGHTbar" class="Cstat LIGHTtext" type="number" name="attr_Light" value="3">
					<input id="LIGHTbarToken" class="Tstat LIGHTtext" type="number" name="attr_Light_token" value="">
					<input class="Mstat LIGHT" type="text" name="attr_Light_max" value="3">
				</div>

				<!-- Temporary status bars -->
				<input type="text" name="attr_tokenTHP_Sources" value="{}" hidden="true">
				<input type="text" name="attr_tokenTST_Sources" value="{}" hidden="true">

				<!-- Ailment previews -->
				<div class="rowContainer">
					<input type="checkbox" class="hide-toggle-rev" name="attr_tokenAilment1Num" value="0" hidden="true">
					<div class="tokenAilment hide-item-rev">
						<img name="attr_tokenAilment1Icon">
						<input type="text" name="attr_tokenAilment1Name" hidden="true">
						<input type="number" name="attr_tokenAilment1Num" min="0" value="0">
					</div>
					<input type="checkbox" class="hide-toggle-rev" name="attr_tokenAilment2Num" value="0" hidden="true">
					<div class="tokenAilment hide-item-rev">
						<img name="attr_tokenAilment2Icon">
						<input type="text" name="attr_tokenAilment2Name" hidden="true">
						<input type="number" name="attr_tokenAilment2Num" min="0" value="0">
					</div>
					<input type="checkbox" class="hide-toggle-rev" name="attr_tokenAilment3Num" value="0" hidden="true">
					<div class="tokenAilment hide-item-rev">
						<img name="attr_tokenAilment3Icon">
						<input type="text" name="attr_tokenAilment3Name" hidden="true">
						<input type="number" name="attr_tokenAilment3Num" min="0" value="0">
					</div>
					<input type="checkbox" class="hide-toggle-rev" name="attr_tokenAilment4Num" value="0" hidden="true">
					<div class="tokenAilment hide-item-rev">
						<img name="attr_tokenAilment4Icon">
						<input type="text" name="attr_tokenAilment4Name" hidden="true">
						<input type="number" name="attr_tokenAilment4Num" min="0" value="0">
					</div>
				</div>

				<!-- States -->
				<input type="text" name="attr_tokenPanicState" value="0" hidden="true">
				<input type="text" name="attr_tokenStaggerState" value="0" hidden="true">
				<input type="text" name="attr_tokenStaggerDuration" value="0" hidden="true">
				<input type="text" name="attr_tokenSealState" value="0" hidden="true">
				<input type="text" name="attr_tokenImmobileState" value="0" hidden="true">
				<input type="text" name="attr_tokenDefeatState" value="0" hidden="true">
			</div>
		</fieldset>

		<!-- Generic token controls -->
		<input type="text" name="attr_tokenId_selected" value="" hidden="true">
		<input type="text" name="attr_tokenId_suppressUpdate" value="false" hidden="true">


		<!-- Theorical way to handle multiple multiple token bars at once
		<input type="number" name="attr_.1HP" > <input type="number" name="attr_.1ST" > <input type="number" name="attr_.1SP" >
		<input type="number" name="attr_.2HP" > <input type="number" name="attr_.2ST" > <input type="number" name="attr_.2SP" >
		<input type="number" name="attr_.1HP_max" value="30" hidden="true"> <input type="number" name="attr_.1ST_max" value="20" hidden="true"> <input type="number" name="attr_.1SP_max" value="15" hidden="true">
		<input type="number" name="attr_.2HP_max" value="30" hidden="true"> <input type="number" name="attr_.2ST_max" value="20" hidden="true"> <input type="number" name="attr_.2SP_max" value="15" hidden="true">
		-->

		<div class="columnAlign genericToken_controls">
			<button type="action" name="act_addToken" placeholder="Add token" data-i18n-placeholder="token-add">Add token</button>
			<button type="action" name="act_addTokenMultiple" placeholder="Add multiple" data-i18n-placeholder="token-add-multiple">Add multiple</button>
			<button type="action" name="act_deleteToken" placeholder="Delete token" data-i18n-placeholder="token-delete">Delete token</button>
		</div>
	</div>
</div>


<div id="TopContainer"> <!-- Top section container -->

<div id="TopColumnL" style="position: relative;"> <!-- Column 1 -->

<div class="profileHeader">
<input type="checkbox" name="attr_distortStateTemp" value="true" hidden="true">
<input type="checkbox" id="attr_distortState" name="attr_distortState" value="true"><label for="attr_distortState" class="distortIcon" data-i18n-title="distort-toggleText" title="Distort"></label>
</div>

<!-- Distortion Top Profile block -->

<div class="columnContent">



<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
        <div class="contentContainer hide-item BLACK distortProfile">
	<div class="sectionHeader rowContainer BLACK" style="position: relative;">
		<div>
<input class="characterRank" type="text" name="attr_charaRankCalculated" value="@{charRankBase}" placeholder="0" disabled="true" title="Rank" data-i18n-title="rank">
		</div>

		<input type="text" class="transpInput contentName" id="DistortionName" name="attr_distort_name" placeholder="Distortion Name" data-i18n-placeholder="distort-name">

<div id="Counter" style="position: absolute; right: 20px; top: 5px; z-index: 50;">
                            <div class="columnAlign"> 

	<div class="rowContainer centerFlex bars" data-i18n-title="distort-counter-title">
	<input id="counterBar" class="Cstat counterText" type="number" name="attr_distortCounter" value="4" min="0">
	<input class="Mstat HPtext" type="text" name="attr_distortCounter_max" value="4">
	</div>

                            </div>
			</div>

	</div>


<div class="columnAlign BLACK work" style="padding-left: 10px; padding-right: 105px; padding-top: 5px; position: relative; margin-bottom: 10px;">

<b data-i18n="distort-workamount-title">Required work amount</b>
	<div id="WorkAmount" class="rowContainer centerFlex workPref" style="margin-top: 5px;">
<input type="text" name="attr_distortWorkBase" value="4" hidden="true">
<input type="text" class="workAmount whiteInput" name="attr_distortWorkBase" value="4" data-i18n-title="distort-workamount-title" title="Required work amount" style="width: 90px; !important; height: 35px !important;">

         </div>

<div class="columnAlign workPref" style="margin-top: 5px;">

<div class="rowContainer">
<input type="text" class="instinct workPref whiteInput" name="attr_distortWorkInstinct" min="-8" max="8" value="0" data-i18n-title="stats-instinct" title="Instinct">
<input type="text" class="wisdom workPref whiteInput" name="attr_distortWorkWisdom" min="-8" max="8" value="0" data-i18n-title="stats-wisdom" title="Wisdom">
<input type="text" class="justice workPref whiteInput" name="attr_distortWorkJustice" min="-8" max="8" value="0" data-i18n-title="stats-justice" title="Justice">
</div>
<div class="rowContainer">
<input type="text" class="charm workPref whiteInput" name="attr_distortWorkCharm" min="-8" max="8" value="0" data-i18n-title="stats-charm" title="Charm">
<input type="text" class="insight workPref whiteInput" name="attr_distortWorkInsight" min="-8" max="8" value="0" data-i18n-title="stats-insight" title="Insight">
<input type="text" class="temperance workPref whiteInput" name="attr_distortWorkTemperance" min="-8" max="8" value="0" data-i18n-title="stats-temperance" title="Temperance">
</div>

<b data-i18n="distort-workpreference">Work Preference</b>

</div>

<div class="columnAlign" style="position: absolute; bottom: 0px; right: 5px;">

<div class="rowContainer centerFlex" data-i18n-title="distort-loweringresults-title" title="Counter-lowering results">
<div class="toggleable">
<input type="checkbox" name="attr_distortResultGood" value="Good" id="result_good" class="expand-toggle">
<label class="status_effect_item expand-btn" for="result_good">
<img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/good.png" class="statusIcon staggered">
</label>
</div>

<div class="toggleable">
<input type="checkbox" name="attr_distortResultNormal" value="Normal" id="result_normal" class="expand-toggle">
<label class="status_effect_item expand-btn" for="result_normal">
<img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/normal.png" class="statusIcon staggered">
</label>
</div>

<div class="toggleable">
<input type="checkbox" name="attr_distortResultBad" value="Bad" id="result_bad" class="expand-toggle">
<label class="status_effect_item expand-btn" for="result_bad">
<img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/bad.png" class="statusIcon staggered">
</label>
</div>

</div>
<b data-i18n="distort-loweringresults">Counter-lowering Results</b>

</div>
</div>


<div class="CharImage distortion" style="right: 5px;"><img name="attr_character_avatar"><div class="CharImageText"><span data-i18n="character-photo">Photo</span></div></div>

<div class="profileData">
<div class="textSection">URL</div>
<input class="CharDetail whiteInput" type="text" name="attr_distort_url" placeholder="External sheet/reference." data-i18n-placeholder="character-url-placeholder"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-summary">Summary</span></div>
<textarea spellcheck="false"  name="attr_distort_summary"  class="CharMediumNotes whiteInput" placeholder="General Distortion summary." data-i18n-placeholder="distort-summary-placeholder"></textarea></div>

<div class="profileData">
<div class="textSection"><span data-i18n="distort-behavior">Behavior</span></div>
<textarea spellcheck="false"  name="attr_distort_behavior"  class="CharMediumNotes whiteInput" placeholder="Notes on Distortion behavior." data-i18n-placeholder="distort-behavior-placeholder"></textarea></div>

	<div class="profileData">
	<div class="textSection" data-i18n="distort-taboo">Taboos/Boons</div>
	<textarea spellcheck="false"  name="attr_distort_taboo" class="CharMediumNotes whiteInput" data-i18n-placeholder="distort-taboo-placeholder" placeholder="Distortion taboos."></textarea>
	</div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-combatnote">Combat Notes</span></div>
<textarea spellcheck="false"  name="attr_distort_combatnote"  class="CharMediumNotes whiteInput" placeholder="Reminders for passive effects, extra damage, etc." data-i18n-placeholder="character-combatnote-placeholder"></textarea></div>




<!-- Distortion effects --> 
                <div class="columnContent distortionContainer">

<div class="rowContainer centerFlex BLACK" style="padding: 5px;">
<b data-i18n="distort-effectText">Distortion Effects</b>
</div>

<div class="columnAlign">

<div class="rowContainer">
<textarea spellcheck="false" name="attr_distortDescription" class="distortDescInput instinct" placeholder="Distortion description." data-i18n-placeholder="distort-descAtt" style="margin-bottom: 0px;"></textarea>

	<textarea spellcheck="false" class="distortEffectInput instinct" name="attr_distortEffect" placeholder="Distortion effects." data-i18n-placeholder="distort-effectAtt" style="margin-bottom: 0px;"></textarea>
</div>

<div class="rowContainer">
<textarea spellcheck="false"   name="attr_distortDescription2" class="distortDescInput SANtext" placeholder="Distortion description." data-i18n-placeholder="distort-descDef" style="margin-bottom: 0px;"></textarea>

	<textarea spellcheck="false" class="distortEffectInput SANtext"  name="attr_distortEffect2" placeholder="Distortion effects." data-i18n-placeholder="distort-effectDef" style="margin-bottom: 0px;"></textarea>
</div>

<!-- Distort Share section -->
<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideShare" value="true">
<div class="hide-item-rev" style="position: absolute; bottom: 0px; right: 0px;">

<button type="action" class="darkInput shareButton" name="act_shareDistort" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="egoAutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>

</div>
<!-- Distort Share end -->

<!-- Distort edit -->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="editCover hide-item">

<div class="columnAlign">
<div class="rowContainer">
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_burnResist_ego" value="0" hidden="true">

        <div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon burn"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	</div>

        <div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_burnResist_ego" value="0"></div>
</div>

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_bleedResist_ego" value="0" hidden="true">

        <div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon bleed"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	</div>

       <div class="status_effect_value"><input type="number"  class="ailmentNum" name="attr_bleedResist_ego" value="0"></div>
</div>

<div class="rowContainer">
	<input type="checkbox" class="fade-toggle" name="attr_damageResist_ego" value="0" hidden="true">
	
		<div class="ailmentIconSelector rowContainer centerFlex">
			<div class="icon">
				<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon damageResist"></div>
			</div>
	
			<div class="icon">
				<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon damageResist-limbus"></div>
			</div>
		</div>
		
		<div class="status_effect_value"><input type="number"  class="ailmentNum" name="attr_damageResist_ego" value="0"></div>
	</div>

	</div>
</div>

<!-- Outfit Custom Ailment Resistances -->
<div class="outfitCustomResistDisplay">
	<fieldset class="repeating_ailments">
		<input type="checkbox" class="hide-toggle" name="attr_ailCustomResistance" hidden="true" value="true">
		<div class="rowContainer hide-item">
			<input type="checkbox" class="fade-toggle" name="attr_ailCustomResistanceNumEgo" value="0" hidden="true">
			<div class="status_effect_item rowContainer centerFlex">
				<!-- Icon selector -->
				<div class="ailmentIconSelector rowContainer centerFlex">
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Question" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="0" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Burn" name="attr_ailIcon"><div class="type-image skillIcon burn"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Charge" name="attr_ailIcon"><div class="type-image skillIcon charge"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Protection" name="attr_ailIcon"><div class="type-image skillIcon protection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Strength" name="attr_ailIcon"><div class="type-image skillIcon strength"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Haste" name="attr_ailIcon"><div class="type-image skillIcon haste"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bind" name="attr_ailIcon"><div class="type-image skillIcon bind"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Panic" name="attr_ailIcon"><div class="type-image skillIcon panic"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_ailIcon"><div class="type-image skillIcon burn-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_ailIcon"><div class="type-image skillIcon charge-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_ailIcon"><div class="type-image skillIcon protection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_ailIcon"><div class="type-image skillIcon strength-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_ailIcon"><div class="type-image skillIcon haste-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_ailIcon"><div class="type-image skillIcon bind-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus-blue"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_ailIcon"><div class="type-image skillIcon rupture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_ailIcon"><div class="type-image skillIcon tremor-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_ailIcon"><div class="type-image skillIcon tremorchain-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_ailIcon"><div class="type-image skillIcon tremordecay-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_ailIcon"><div class="type-image skillIcon tremordistribution-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_ailIcon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_ailIcon"><div class="type-image skillIcon tremorfracture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_ailIcon"><div class="type-image skillIcon tremorreverb-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_ailIcon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_ailIcon"><div class="type-image skillIcon sinking-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_ailIcon"><div class="type-image skillIcon poise-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_ailIcon"><div class="type-image skillIcon frostbite-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_ailIcon"><div class="type-image skillIcon poison-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_ailIcon"><div class="type-image skillIcon nails-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_ailIcon"><div class="type-image skillIcon ruin-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_ailIcon"><div class="type-image skillIcon devastation-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_ailIcon"><div class="type-image skillIcon critical-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_ailIcon"><div class="type-image skillIcon aggro-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_ailIcon"><div class="type-image skillIcon ammo-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_ailIcon"><div class="type-image skillIcon bullseye-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_ailIcon"><div class="type-image skillIcon barrier-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_ailIcon"><div class="type-image skillIcon duel-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus-green"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_ailIcon"><div class="type-image skillIcon heal-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_ailIcon"><div class="type-image skillIcon kampule-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_ailIcon"><div class="type-image skillIcon ttime-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_ailIcon"><div class="type-image skillIcon rottingskin-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Blood" name="attr_ailIcon"><div class="type-image skillIcon blood"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_ailIcon"><div class="type-image skillIcon slashprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_ailIcon"><div class="type-image skillIcon pierceprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_ailIcon"><div class="type-image skillIcon bluntprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_ailIcon"><div class="type-image skillIcon slashfragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_ailIcon"><div class="type-image skillIcon piercefragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_ailIcon"><div class="type-image skillIcon bluntfragility-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_ailIcon"><div class="type-image skillIcon wrath-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_ailIcon"><div class="type-image skillIcon lust-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_ailIcon"><div class="type-image skillIcon sloth-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_ailIcon"><div class="type-image skillIcon gluttony-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_ailIcon"><div class="type-image skillIcon gloom-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_ailIcon"><div class="type-image skillIcon pride-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_ailIcon"><div class="type-image skillIcon envy-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_ailIcon"><div class="type-image skillIcon damageup-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_ailIcon"><div class="type-image skillIcon damagedown-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_ailIcon"><div class="type-image skillIcon style-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_ailIcon"><div class="type-image skillIcon thorns-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_ailIcon"><div class="type-image skillIcon rhythm-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_ailIcon"><div class="type-image skillIcon frenzy-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_ailIcon"><div class="type-image skillIcon shock-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_ailIcon"><div class="type-image skillIcon terror-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_ailIcon"><div class="type-image skillIcon staggerdamageup-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_ailIcon"><div class="type-image skillIcon staggerdamagedown-community"></div>
					</div>
				</div>
			</div>
			<div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_ailCustomResistanceNumEgo" value="0"></div>
		</div>
	</fieldset>
</div>

</div>

<!-- Distort edit -->




</div>

<div class="sectionHeader rowContainer BLACK" style="height: 40px">

<div class="rowContainer centerFlex distortionDice">
	<div class="dicerollBlock egoDiceATK" data-i18n-title="distort-weapon-dice" title="Att modifier applied when Distorted.">
		<input type="text" class="diceNum" name="attr_distortWeaponDice1" placeholder="0" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_distortWeaponDice2" placeholder="0" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_distortWeaponDice3" placeholder="0" value="0">
	</div>

	<div class="dicerollBlock egoDiceDEF" data-i18n-title="distort-def-dice" title="Def modifier applied when Distorted." style="margin: 0px !important;">
		<input type="text" class="diceNum" name="attr_distortDefDice1" placeholder="0" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_distortDefDice2" placeholder="0" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_distortDefDice3" placeholder="0" value="0">
		</div>

		<div class="dicerollBlock egoDiceEVD" data-i18n-title="distort-evd-dice" title="Evd modifier applied when Distorted.">
		<input type="text" class="diceNum" name="attr_distortEvdDice1" placeholder="0" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_distortEvdDice2" placeholder="0" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_distortEvdDice3" placeholder="0" value="0">
		</div>


</div>

</div></div> <!-- Distortion Effects container -->



                    </div>
                </div>
<!-- Distortion profile END -->


<!-- Top Profile block -->
<div class="columnContent" style="margin-bottom: 5px;">

<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true">
        <div class="contentContainer hide-item-rev">
	<div class="sectionHeader rowContainer skillN" style="position: relative;">
		<input type="text" name="attr_charRankBase" value="0" hidden="true">

		<div>
		<input type="text" name="attr_charRankNum" value="0" hidden="true">
<input class="characterRank transpInput" type="text" name="attr_charaRankCalculated" value="@{charRankBase}" placeholder="0" disabled="true" title="Rank" data-i18n-title="rank">
		</div>

<input type="text" name="attr_character_name" hidden="true">
		<input type="text" class="transpInput contentName" id="CharacterName" name="attr_character_nameBase" placeholder="Character Name" data-i18n-placeholder="character-name">

	<div class="rowContainer levelBox">
                        
                        <div id="Level">
                            <div class="columnAlign" style="position: relative;">
			<div class="blocker"></div>
<span data-i18n="character-level">Level</span><input type="text" class="characterLevel darkInput" name="attr_level" id="level_value" value="0">
                            </div>
			</div>

			<div id="EXP">
                            <div class="columnAlign"><span data-i18n="character-exp">EXP</span><input type="number" class="darkInput" name="attr_EXP" value="0"></div>
                        </div>

         </div>

	</div>

<div class="CharImage"><img name="attr_character_avatar"><div class="CharImageText"><span data-i18n="character-photo">Photo</span></div></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-job">Occupation</span></div>
<input class="CharJob" type="text" name="attr_character_job"></div>
                        
<div class="profileData">
<div class="textSection"><span data-i18n="character-age">Age</span></div>
<input class="CharAge" type="text" name="attr_age"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-height">Height</span></div>
<input class="CharHeight" type="text" name="attr_height"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-origin">Birthplace</span></div>
<input class="CharOrigin" type="text" name="attr_character_origin"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-residence">Residence</span></div>
<input class="CharOrigin" type="text" name="attr_character_residence"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-assets">Assets</span></div>
<input class="CharDetail" type="text" name="attr_character_assets" placeholder="Money, items, other assets." data-i18n-placeholder="character-assets-placeholder"></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-ahn">Ahn</span></div>
<input class="CharDetail" type="text" name="attr_character_ahn" placeholder="500,000 ahn" data-i18n-placeholder="character-ahn-placeholder"></div>

<div class="profileData">
<div class="textSection">URL</div>
<input class="CharDetail" type="text" name="attr_character_url" placeholder="External sheet/reference." data-i18n-placeholder="character-url-placeholder"></div>
                            
<div class="profileData">
<div class="textSection"><span data-i18n="character-summary">Summary</span></div>
<textarea spellcheck="false"  name="attr_character_summary"  class="CharMediumNotes" placeholder="General character summary." data-i18n-placeholder="character-summary-placeholder"></textarea></div>

<div class="profileData">
<div class="textSection"><span data-i18n="character-combatnote">Combat Notes</span></div>
<textarea spellcheck="false"  name="attr_character_combatnote"  class="CharMediumNotes" placeholder="Reminders for passive effects, extra damage, etc." data-i18n-placeholder="character-combatnote-placeholder"></textarea></div>


                    </div>
                </div>
<!-- Top profile END -->


<!-- EGO block -->
                <div class="columnContent">

	<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true">
                    <div class="contentContainer egoContainer hide-item-rev">

	<div class="sectionHeader rowContainer BLACK">

<input type="text" class="transpInput contentName" name="attr_egoName" placeholder="Mystery name (E.G.O)" data-i18n-placeholder="ego-name" style="margin-left: 35px; width: 100% !important">
	

<div class="iconHolder">

		<div>
		<div class="icon">
		<div class="typeIcon question"></div>
		</div>


		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Weapon">
		<div class="hide-item">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_egoWeaponType"><div class="type-image typeIcon egoSlash BLACK"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_egoWeaponType"><div class="type-image typeIcon egoPierce BLACK"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_egoWeaponType"><div class="type-image typeIcon egoBlunt BLACK"></div>
		</div>

		<div style="position: absolute; top:0; left: 0; width: 100%;">
		<input type="checkbox" class="transpInput egoCheck" name="attr_egoActiveState" value="true" style="accent-color: #cc4125" title="Activate Mystery" data-i18n-title="ego-activate">
		</div>

		</div>
		</div></div>

		<div>
		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Outfit">
		<div class="hide-item">
<input type="checkbox" class="transpInput egoCheck" name="attr_egoActiveState" value="true" style="accent-color: #6d9eeb" title="Activate Mystery" data-i18n-title="ego-activate">

		<div class="icon">
		<div class="typeIcon egoDef"></div>
		</div>

		</div></div>

		<div>
		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Tool">
		<div class="hide-item">
<input type="checkbox" class="transpInput egoCheck" name="attr_egoActiveState" value="true" style="accent-color: #8e7cc3" data-i18n-title="ego-activate" title="Activate Mystery">

		<div class="icon">
		<div class="typeIcon egoAct"></div>
		</div>

		</div></div>

		<div>
		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Special">
		<div class="hide-item">
		<input type="checkbox" class="transpInput egoCheck" name="attr_egoActiveState" value="true" data-i18n-title="ego-activate" style="accent-color: #cf8c44" title="Activate Mystery">

		<div class="icon">
		<div class="typeIcon egoSpecial"></div>
		</div>

		</div></div>

	</div>

	<div class="rowContainer toolDescription centerFlex BLACK" style="padding-bottom: 5px;">
	<input type="text" class="egoRank whiteInput" name="attr_egoRank" value="0" placeholder="0" data-i18n-title="rank" title="Rank" style="border: none;">

<div class="rowContainer centerFlex BLACK" data-i18n-title="ego-activecondition" title="Activation condition">

	<input type="text" name="attr_egoConditionTemp" hidden="true">
                                        <select name="attr_egoCondition" class="whiteInput half" style="height: 25px; margin-right: 5px;">
                                            <option value="None" data-i18n="ego-active-None">---</option>
                                            <option value="AlwaysActive" data-i18n="ego-active-AlwaysActive">Always active</option>
                                            <option value="HalfHealth" data-i18n="ego-active-HalfHealth">50% health</option>
                                            <option value="OnStagger" data-i18n="ego-active-OnStagger">On stagger</option>
                                            <option value="EnemyDefeat" data-i18n="ego-active-EnemyDefeat">Enemy defeat</option>
                                            <option value="AllyDefeat" data-i18n="ego-active-AllyDefeat">Ally defeat</option>
                                            <option value="Other" data-i18n="ego-active-Other">Other</option>
                                        </select>

                                        <select name="attr_egoType" class="whiteInput half" style="height: 25px; margin-right: 5px;" title="Manifestation type">
                                            <option value="None" data-i18n="ego-type-None">---</option>
                                            <option value="Weapon" data-i18n="ego-type-Weapon">Weapon</option>
                                            <option value="Outfit" data-i18n="ego-type-Outfit">Outfit</option>
                                            <option value="Tool" data-i18n="ego-type-Tool">Tool</option>
                                            <option value="Special" data-i18n="ego-type-Special">Special item</option>
                                        </select>

	</div>

        </div>

<div class="columnAlign">
<input name="attr_egoIdeology" type="text" class="egoIdeologyInput" placeholder="Manifested ideology." data-i18n-placeholder="ego-ideology">

<div class="rowContainer">
<textarea spellcheck="false"   name="attr_egoDescription" class="egoDescInput" placeholder="Mystery description." data-i18n-placeholder="ego-description" style="margin-bottom: 0px;"></textarea>

	<textarea spellcheck="false"   name="attr_egoEffect" placeholder="Mystery effects." data-i18n-placeholder="ego-effect" style="margin-bottom: 0px;"></textarea>
</div>

<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideShare" value="true">
<div class="hide-item-rev" style="position: absolute; bottom: 0px; right: 0px;">

<button type="action" class="darkInput shareButton" name="act_shareEgo" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="egoAutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_egoAutoScript" hidden="true">

</div>

<!-- EGO edit -->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="editCover hide-item">


<input type="checkbox" class="hide-toggle-rev" name="attr_egoType" value="Outfit" hidden="true">
	<div class="rowContainer hide-item-rev">
	<div class="settingStyle">
	<div class="settingStyle" style="width: 40px;"><b data-i18n="message-uses">Uses</b>:</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_egoUses" value="5"> / 
	<input type="number" class="darkInput" name="attr_egoUses_max" value="5" min="1">
	<select name="attr_egoUseType" class="darkInput" style="width: 70px; margin-left: 5px;">
		<option data-i18n="uses-nolimit" value="Limitless" selected>No limit</option>
		<option data-i18n="uses-reload" value="Reload">Reload</option>
		<option data-i18n="uses-deplete" value="Deplete">Deplete</option>
	</select>

	</div>
	</div>


<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Outfit" hidden="true">
<div class="hide-item">
<div class="columnAlign">
<div class="rowContainer">
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_burnResist_ego" value="0" hidden="true">

        <div class="ailmentIconSelector status_effect_item rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon burn"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	</div>

        <div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_burnResist_ego" value="0"></div>
</div>

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_bleedResist_ego" value="0" hidden="true">

        <div class="ailmentIconSelector status_effect_item rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon bleed"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	</div>

       <div class="status_effect_value"><input type="number"  class="ailmentNum" name="attr_bleedResist_ego" value="0"></div>
</div>

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_damageResist_ego" value="0" hidden="true">

	<div class="ailmentIconSelector status_effect_item rowContainer centerFlex">
		<div class="icon">
			<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon damageResist"></div>
		</div>

		<div class="icon">
			<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon damageResist-limbus"></div>
		</div>
	</div>
	
	<div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_damageResist_ego" value="0"></div>
</div>
</div>

<!-- Outfit Custom Ailment Resistances -->
<div class="outfitCustomResistDisplay">
	<fieldset class="repeating_ailments">
		<input type="checkbox" class="hide-toggle" name="attr_ailCustomResistance" hidden="true" value="true">
		<div class="rowContainer hide-item">
			<input type="checkbox" class="fade-toggle" name="attr_ailCustomResistanceNumEgo" value="0" hidden="true">
			<div class="status_effect_item rowContainer centerFlex">
				<!-- Icon selector -->
				<div class="ailmentIconSelector rowContainer centerFlex">
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Question" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="0" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Burn" name="attr_ailIcon"><div class="type-image skillIcon burn"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Charge" name="attr_ailIcon"><div class="type-image skillIcon charge"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Protection" name="attr_ailIcon"><div class="type-image skillIcon protection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Strength" name="attr_ailIcon"><div class="type-image skillIcon strength"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Haste" name="attr_ailIcon"><div class="type-image skillIcon haste"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bind" name="attr_ailIcon"><div class="type-image skillIcon bind"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Panic" name="attr_ailIcon"><div class="type-image skillIcon panic"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile"></div>
					</div>
				
				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_ailIcon"><div class="type-image skillIcon burn-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_ailIcon"><div class="type-image skillIcon charge-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_ailIcon"><div class="type-image skillIcon protection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_ailIcon"><div class="type-image skillIcon strength-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_ailIcon"><div class="type-image skillIcon haste-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_ailIcon"><div class="type-image skillIcon bind-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus-blue"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_ailIcon"><div class="type-image skillIcon rupture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_ailIcon"><div class="type-image skillIcon tremor-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_ailIcon"><div class="type-image skillIcon tremorchain-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_ailIcon"><div class="type-image skillIcon tremordecay-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_ailIcon"><div class="type-image skillIcon tremordistribution-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_ailIcon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_ailIcon"><div class="type-image skillIcon tremorfracture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_ailIcon"><div class="type-image skillIcon tremorreverb-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_ailIcon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_ailIcon"><div class="type-image skillIcon sinking-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_ailIcon"><div class="type-image skillIcon poise-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_ailIcon"><div class="type-image skillIcon frostbite-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_ailIcon"><div class="type-image skillIcon poison-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_ailIcon"><div class="type-image skillIcon nails-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_ailIcon"><div class="type-image skillIcon ruin-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_ailIcon"><div class="type-image skillIcon devastation-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_ailIcon"><div class="type-image skillIcon critical-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_ailIcon"><div class="type-image skillIcon aggro-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_ailIcon"><div class="type-image skillIcon ammo-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_ailIcon"><div class="type-image skillIcon bullseye-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_ailIcon"><div class="type-image skillIcon barrier-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_ailIcon"><div class="type-image skillIcon duel-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus-green"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_ailIcon"><div class="type-image skillIcon heal-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_ailIcon"><div class="type-image skillIcon kampule-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_ailIcon"><div class="type-image skillIcon ttime-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_ailIcon"><div class="type-image skillIcon rottingskin-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Blood" name="attr_ailIcon"><div class="type-image skillIcon blood"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_ailIcon"><div class="type-image skillIcon slashprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_ailIcon"><div class="type-image skillIcon pierceprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_ailIcon"><div class="type-image skillIcon bluntprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_ailIcon"><div class="type-image skillIcon slashfragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_ailIcon"><div class="type-image skillIcon piercefragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_ailIcon"><div class="type-image skillIcon bluntfragility-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_ailIcon"><div class="type-image skillIcon wrath-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_ailIcon"><div class="type-image skillIcon lust-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_ailIcon"><div class="type-image skillIcon sloth-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_ailIcon"><div class="type-image skillIcon gluttony-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_ailIcon"><div class="type-image skillIcon gloom-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_ailIcon"><div class="type-image skillIcon pride-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_ailIcon"><div class="type-image skillIcon envy-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_ailIcon"><div class="type-image skillIcon damageup-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_ailIcon"><div class="type-image skillIcon damagedown-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_ailIcon"><div class="type-image skillIcon style-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_ailIcon"><div class="type-image skillIcon thorns-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_ailIcon"><div class="type-image skillIcon rhythm-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_ailIcon"><div class="type-image skillIcon frenzy-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_ailIcon"><div class="type-image skillIcon shock-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_ailIcon"><div class="type-image skillIcon terror-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_ailIcon"><div class="type-image skillIcon staggerdamageup-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_ailIcon"><div class="type-image skillIcon staggerdamagedown-community"></div>
					</div>
				</div>
			</div>
			<div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_ailCustomResistanceNumEgo" value="0"></div>
		</div>
	</fieldset>
</div>
</div>
</div>

<!-- EGO edit -->
</div>
</div>

<!-- Weapon EGO menu -->
<div class="rowContainer centerFlex">
<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Weapon" hidden="true">
<div class="hide-item BLACK centerFlex" style="width: 100%; padding-top: 5px; padding-bottom: 5px;">

<div class="rowContainer centerFlex">

	<div class="dicerollBlock egoDiceATK" data-i18n-title="ego-weapon-dice" title="Att dice applied when Mystery is active." style="margin-bottom: 5px;">
		<input type="text" class="diceNum" name="attr_egoWeaponDice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoWeaponDice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoWeaponDice3" placeholder="0" value="0">
		</div>



	</div>

	<select name="attr_egoWeaponType" class="weapon_type whiteInput">
 	<option value="None"   data-i18n="weapon-type-None">---</option>
         <option value="Slash" data-i18n="weapon-type-Slash">Slash</option>
         <option value="Pierce" data-i18n="weapon-type-Pierce">Pierce</option>
	 <option value="Blunt" data-i18n="weapon-type-Blunt">Blunt</option>
         </select>

	<select name="attr_egoWeaponRange" class="weapon_type whiteInput">
 	<option value="None"   data-i18n="weapon-type-None">---</option>
         <option value="Melee" data-i18n="weapon-type-Melee">Melee</option>
         <option value="Ranged" data-i18n="weapon-type-Ranged">Ranged</option>
         </select>

</div>
</div>
<!-- Weapon EGO menu END -->


<!-- Outfit EGO menu -->
<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Outfit" hidden="true">
<div class="hide-item BLACK" style="padding-top: 5px; padding-bottom: 5px; width: 100%;">

	<div class="rowContainer centerFlex BLACK" style="margin-bottom: 5px;">

		<div class="dicerollBlock egoDiceDEF" data-i18n-title="ego-defend-dice" title="Def dice applied when Mystery is active.">
		<input type="text" class="diceNum" name="attr_egoDefDice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoDefDice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoDefDice3" placeholder="0" value="0">
		</div>

		<div class="dicerollBlock egoDiceEVD" data-i18n-title="ego-evade-dice" title="Evd dice applied when Mystery is active.">
		<input type="text" class="diceNum" name="attr_egoEvdDice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoEvdDice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoEvdDice3" placeholder="0" value="0">
		</div>

	</div>

	<div class="rowContainer centerFlex" style="width: 100%;">

	<div class="rowContainer resistanceChart BLACK" style="width: 200px;">
		<div class="rowContainer centerFlex">

	<div id="outfit_res_slash">
		<div class="resIconLeft">
		<div class="resistIcon slashNormal"></div>
		</div>
	</div>
                            <select name="attr_egoImmune1" class="outfitresistVal whiteInput dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_egoImmune2" class="outfitresistVal whiteInput stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

<div id="outfit_res_slashSTG">
		<div class="resIconRight">
		<div class="resistIcon slashNormalSTG"></div>
		</div>
	</div>
		</div>

		<div class="rowContainer centerFlex">
<div id="outfit_res_pierce">
		<div class="resIconLeft">
		<div class="resistIcon pierceNormal"></div>
		</div>
	</div>
                            <select name="attr_egoImmune3" class="outfitresistVal whiteInput dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_egoImmune4" class="outfitresistVal whiteInput stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>


<div id="outfit_res_pierceSTG">
		<div class="resIconRight">
		<div class="resistIcon pierceNormalSTG"></div>
		</div>
	</div>

		</div>

		<div class="rowContainer centerFlex">
<div id="outfit_res_blunt">
		<div class="resIconLeft">
		<div class="resistIcon bluntNormal"></div>
		</div>
	</div>


                            <select name="attr_egoImmune5" class="outfitresistVal whiteInput dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_egoImmune6" class="outfitresistVal whiteInput stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

<div id="outfit_res_bluntSTG">
		<div class="resIconRight">
		<div class="resistIcon bluntNormalSTG"></div>
		</div>
	</div>


		</div>
</div>
</div>

</div>
<!-- Outfit EGO menu end -->

<!-- Tool EGO menu -->
<div class="rowContainer centerFlex">
<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Tool" hidden="true">
<div class="hide-item BLACK centerFlex" style="width: 100%; padding-top: 5px; padding-bottom: 5px;">

<div class="rowContainer centerFlex">



</div>
</div>

</div>
<!-- Tool EGO menu END -->

<!-- Special EGO menu -->
<div class="rowContainer centerFlex">
<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Special" hidden="true">
<div class="hide-item BLACK centerFlex" style="width: 100%; padding-top: 5px; padding-bottom: 5px;">

<div class="columnAlign">


<div class="rowContainer centerFlex egoSpecialLabel">
<span data-i18n="special-risk-text">Risk Level</span>
<select name="attr_egoRisk" class="whiteInput" style="text-align: center;">
			<option data-i18n="special-risk-none" value="none">---</option>
			<option data-i18n="special-risk-0" value="0">Canard</option>
			<option data-i18n="special-risk-1" value="1">Urban Myth</option>
			<option data-i18n="special-risk-2" value="2">Urban Legend</option>
			<option data-i18n="special-risk-3" value="3">Urban Plague</option>
			<option data-i18n="special-risk-4" value="4">Urban Nightmare</option>
			<option data-i18n="special-risk-5" value="5">Star of the City</option>
			<option data-i18n="special-risk-6" value="6">Impuritas Civitatis</option>
		</select>
</div>


<div class="rowContainer centerFlex egoSpecialLabel">
	<span data-i18n="special-range-text">Effect Range</span>
 		<select name="attr_egoRange" class="whiteInput" id="ego_range" style="text-align: center;">
                          <option data-i18n="special-range-none" value="none">---</option>
                          <option data-i18n="special-range-0" value="0">One or two people</option>
                          <option data-i18n="special-range-1" value="1">Street</option>
                          <option data-i18n="special-range-2" value="2">Neighborhood</option>
                          <option data-i18n="special-range-3" value="3">Residence Area</option>
                          <option data-i18n="special-range-4" value="4">Nest</option>
                          <option data-i18n="special-range-5" value="5">Multiple Nests</option>
                          <option data-i18n="special-range-6" value="6">City</option>
               	</select>
</div>


<div class="rowContainer centerFlex egoSpecialLabel">
	<span data-i18n="special-duration-text">Duration</span>
		<select name="attr_egoDuration" class="whiteInput" id="ego_duration" style="text-align: center;">
			<option data-i18n="special-duration-none" value="none">---</option>
			<option data-i18n="special-duration-0" value="0">A moment</option>
			<option data-i18n="special-duration-1" value="1">Seconds</option>
			<option data-i18n="special-duration-2" value="2">Minutes</option>
			<option data-i18n="special-duration-3" value="3">Hours</option>
			<option data-i18n="special-duration-4" value="4">Days</option>
			<option data-i18n="special-duration-5" value="5">Weeks</option>
			<option data-i18n="special-duration-6" value="6">Months</option>
              	</select>
</div>


</div>
</div>
</div>
<!-- Special EGO menu END -->



</div> <!-- end EGO container -->


</div>
</div>

            <div id="TopColumnM"> <!-- column 2 -->
                        <div class="rowContainer titleHeader"><button type="action" class="qolButton" name="act_resetHealth" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-derived">Derived values</h4> </div>

                <div class="contentContainer darkBG">

<!-- row 1 -->
                    <div class="rowContainer">
	<input type="text" name="attr_dummy" value="0" hidden="true">
	<input type="text" name="attr_dummy2" value="0" hidden="true">
	<input type="text" name="attr_dummyIcon" value="0" hidden="true">

<div class="banner HPtext"><span data-i18n="bar-health">Health</span>
	<div class="rowContainer centerFlex bars">
	<input type="checkbox" class="style-toggle-rev" name="attr_THP_Sources" value="{}" hidden="true">
	<input id="HPbar" class="Cstat HPtext" type="number" name="attr_HP" value="30">
	<input class="Mstat HP" type="text" name="attr_HP_max" value="30">
	</div>
</div>

	<div class="banner egoSTGRtext"><span data-i18n="bar-stagres">Stagger Res</span>
	<div class="rowContainer centerFlex bars">
	<input type="checkbox" class="style-toggle-rev" name="attr_TST_Sources" value="{}" hidden="true">
	<input id="STGRbar" class="Cstat egoSTGRtext" type="number" name="attr_StagRes" value="20">
	<input class="Mstat egoSTGR" type="text" name="attr_StagRes_max" value="20">

	</div>
</div>

</div>

<!-- row 2 -->
		<div class="rowContainer">
	<div class="banner SANtext"><span data-i18n="bar-sanity">Sanity</span>
	<div class="rowContainer centerFlex bars">

	<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true" >
	<div class="hide-item-rev">
	<input id="SANbar" class="Cstat SANtext" type="number" name="attr_SP" value="15">
	<input class="Mstat SAN" type="text" name="attr_SP_max" value="15">
	</div>

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true" >
	<div class="hide-item" data-i18n="message-distorted" style="text-align: center; opacity: 50%;">
	Distorted
	</div>

	</div>
</div>

	<div class="banner LIGHTtext"><span data-i18n="bar-light">Light</span>
	<div class="rowContainer centerFlex bars">
	<input id="LIGHTbar" class="Cstat LIGHTtext" type="number" name="attr_Light" value="3">
	<input class="Mstat LIGHT" type="text" name="attr_Light_max" value="3">
	</div>
</div>
</div>

                </div>




	<!-- Roll helper palette -->
	<div class="rowContainer titleHeader"><button type="action" class="qolButton" name="act_resetHelpers" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-rollhelper">Roll helpers</h4></div>

	<input type="checkbox" class="helperText" name="attr_settingHelperText" value="true" hidden="true">
	<div class="contentContainer darkBG helperTextContainer">


	<div class="rowContainer">

<div class="columnAlign centerFlex helpers" style="margin-left: 0px;">
<b data-i18n="helper-text-speedluck">Speed/Luck</b>
<div class="rowContainer centerFlex helpers">

	<button type="action" class="speed utilitybuttons" name="act_rollChallenge" id="autoroll_speed" data-i18n-title="helper-roll-speed" title="Roll Speed"></button>

	<input type="text" name="attr_baseSpeed" value="0" hidden="true">
	<input type="text" name="attr_prevSpeed" value="0" hidden="true">
	<input type="text" name="attr_thisRoundSpeed" value="0" hidden="true">
	<input type="text" name="attr_nextRoundSpeed" value="0" hidden="true">
	<input type="text" name="attr_isFirstRound" value="false" hidden="true">
	<input type="number" name="attr_prevRoundInit" value="0" hidden="true">
	<input type="number" name="attr_prevRoundInitAttempts" value="1" hidden="true">
	<div style="overflow: hidden; position: relative;"><div class="blocker"></div><input type="text" class="speedbox whiteInput" name="attr_calcSpeed" value="0" data-i18n-title="helper-current-speed" title="Current Speed"></div>

</div>


<div class="rowContainer centerFlex helpers">
	<button type="action" class="speed luck utilitybuttons" id="autoroll_luck" name="act_rollChallenge" data-i18n-title="helper-roll-luck" title="Roll Luck"></button>

<input type="text" name="attr_baseLuckNum" value="0" hidden="true">
<input type="text" class="speedbox whiteInput" name="attr_luckNum" value="@{baseLuckNum}" disabled="true" data-i18n-title="helper-current-luck" title="Current Luck">

</div>

</div>

<div class="columnAlign helpers">

<b data-i18n="helper-text-update">Update</b>

<div class="sideDice columnAlign centerFlex">

<input type="checkbox" name="attr_settingLoopEnabled" class="loopEnabledToggle" value="true" hidden="true">
<input type="checkbox" name="attr_prevRoundInitAttempts" class="loopSearchingToggle" value="0" hidden="true">
<input type="checkbox" name="attr_prevRoundInitAttempts" class="loopStandbyToggle" value="5" hidden="true">
<div class="autoUpdateIndicator"></div>

<input type="text" name="attr_baseActNum" value="0" hidden="true">
<button type="action" class="speed next updateInput" name="act_updateAilments" data-i18n-title="helper-update-ailments" title="Update Ailments"></button>
	
</div>

</div>


<div class="columnAlign helpers">

<div class="rowContainer">
<div class="sideDice columnAlign centerFlex">
<b data-i18n="helper-text-difficulty">Difficulty</b>
		<input type="number" class="whiteInput difficultyInput" name="attr_difficulty" value="0" data-i18n-title="helper-text-difficulty" title="Difficulty">
		</div>	

<div class="columnAlign centerFlex helpers">
<b data-i18n="helper-text-advantages">Advantages</b>
		<div data-i18n-title="helper-text-disadv" title="Disadvantage" class="rowContainer centerFlex">
<input type="text" class="transpInput disadvCounter" name="attr_disadvNum"  value="0"><input type="checkbox" name="attr_advState" class="disadvCheck" value="Disadvantage">
		</div>

		<div data-i18n-title="helper-text-adv" title="Advantage" class="rowContainer centerFlex">
		<input type="text" class="transpInput advCounter" name="attr_advNum" value="0"><input type="checkbox"  name="attr_advState" class="advCheck" value="Advantage">
		</div>
	</div>

</div>

</div>
	
	</div>


<div class="rowContainer" style="margin-top: 3px;">

<div class="columnAlign centerFlex helpers" style="width: 70px; overflow: hidden;">
<b data-i18n="helper-text-whisper">Whisper</b>

<label for="WhisperRolls" style="margin: 0px; padding: 0px;">
<input type="checkbox" id="WhisperRolls" name="attr_settingWhisperRolls" value="true" class="expand-toggle" style="display: none !important;">
<div class="speed whisper" data-i18n-title="helper-toggle-whisper" title="Toggle Whisper" style="width: 65px; height: 27px; background-size: contain; background-position: center; margin: 0px !important;"></div>
</label>


</div>


<div class="columnAlign helpers">
<b data-i18n="helper-text-tracker">Tracker</b>

<input type="text" class="speedbox whiteInput helpers" name="attr_actNum" value="@{baseActNum}" disabled="true" data-i18n-title="helper-action-tracker" title="Action Tracker" style="width: 50px !important; margin-top: 1px; margin-bottom: 3px; margin-right: 2px;">



</div>

<div class="columnAlign helpers">
<b data-i18n="helper-text-power">Power</b>
<div class="rowContainer centerFlex helpers">

		<input type="text" name="attr_attPower" value="0" hidden="true">
		<input type="text" name="attr_defPower" value="0" hidden="true">
		<input type="text" name="attr_evdPower" value="0" hidden="true">

		<input type="text" class="power HPtext darkInput" name="attr_powerATT" value="@{attPower}+@{Strength}-@{Feeble}" disabled="true" data-i18n-title="helper-att-power" title="Att Power">
		<input type="text" class="power SANtext darkInput" name="attr_powerDEF" value="@{defPower}+@{Endurance}-@{Disarm}" disabled="true" data-i18n-title="helper-def-power" title="Def Power">

		<input type="text" name="attr_evdPositive" value="0" hidden="true">
		<input type="text" name="attr_evdNegative" value="0" hidden="true">
		<input type="text" class="power STGRtext darkInput" name="attr_powerEVD" value="@{evdPower}+@{evdPositive}-@{evdNegative}" data-i18n-title="helper-evd-power" title="Evd Power" disabled="true">
	</div>


</div>


</div>



<input type="checkbox" name="attr_settingWhisperRolls" class="hide-toggle" value="true">
<div class="hide-item" style="margin-top: 3px;">
<span class="half" style="color: #888; font-weight: bold;" data-i18n="settings-whisper">Whisper rolls to: </span>
<input type="text" class="whiteInput half" name="attr_settingWhisperTarget" value="GM">
</div>

</div>


	<!-- Helper END -->


<div id="ailmentBlock">
	<input type="text" name="attr_ailmentList" hidden>

<div class="rowContainer titleHeader"><button type="action" class="qolButton" name="act_resetAilments" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-ailments">Status ailments</h4> </div>
<div class="contentContainer darkBG">

<!-- States -->
<div class="rowContainer centerFlex topRow ailmentStates">
<input type="text" name="attr_PanicStateSuppressUpdate" value="false" hidden="true">
<input type="text" name="attr_StaggerStateSuppressUpdate" value="false" hidden="true">
<input type="text" name="attr_StaggerDurationSuppressUpdate" value="false" hidden="true">
<input type="text" name="attr_SealStateSuppressUpdate" value="false" hidden="true">
<input type="text" name="attr_ImmobileStateSuppressUpdate" value="false" hidden="true">
<input type="text" name="attr_DefeatStateSuppressUpdate" value="false" hidden="true">

<!-- Hostile -->
<div>
<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
<div class="toggleable hide-item">
<input type="checkbox" name="attr_HostileState" value="Hostile" class="expand-toggle" id="state_Hostile">
<label class="status_effect_item expand-btn rowContainer" for="state_Hostile" data-i18n-title="ailments-hostile-title" title="Hostile">

	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle">
	<div class="skillIcon statusIcon hide-item-rev hostile"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle">
	<div class="skillIcon statusIcon type-image hostile-limbus"></div>
	</div>

</label>
</div></div>
<!-- Hostile END -->


<div>
<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true">
<div class="toggleable hide-item-rev">
<input type="checkbox" name="attr_PanicState" value="Panic" class="expand-toggle" id="state_Panic">
<label class="status_effect_item expand-btn rowContainer" for="state_Panic" data-i18n-title="ailments-panic-title" title="Panic">

	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon hide-item-rev panic"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon type-image panic-limbus"></div>
	</div>

</label>
</div></div>

<div class="toggleable">
<input type="checkbox" name="attr_StaggerState" value="Staggered" id="state_Stagger" class="expand-toggle">
<input type="number" name="attr_StaggerDuration" value="0" hidden="true">
<label class="status_effect_item expand-btn rowContainer" for="state_Stagger" data-i18n-title="ailments-stagger-title" title="Stagger">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon hide-item-rev stagger"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon type-image stagger-limbus"></div>
	</div>
</label>
</div>

<div class="toggleable">
<input type="checkbox" name="attr_SealState" id="state_Seal" value="Seal" class="expand-toggle">

<label class="status_effect_item expand-btn rowContainer" for="state_Seal" data-i18n-title="ailments-seal-title" title="Seal (Incapable of reactions)">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon hide-item-rev seal"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle">
	<div class="skillIcon statusIcon type-image seal-limbus"></div>
	</div>
</label>
</div>

<div class="toggleable">
<input type="checkbox" name="attr_ImmobileState" id="state_Immobile" value="Immobile" class="expand-toggle">

<label class="status_effect_item expand-btn rowContainer" for="state_Immobile" data-i18n-title="ailments-immobile-title" title="Immobile (Incapable of action/reaction)">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon hide-item-rev immobile"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon type-image immobile-limbus"></div>
	</div>
</label>
</div>

<div class="toggleable">
<input type="checkbox" name="attr_DefeatState" id="state_Defeat" value="Defeated" class="expand-toggle">

<label class="status_effect_item expand-btn rowContainer" for="state_Defeat" data-i18n-title="ailments-defeat-title" title="Defeated (Incapable of combat)">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon hide-item-rev defeat"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle" >
	<div class="skillIcon statusIcon type-image defeat-limbus"></div>
	</div>
</label>
</div>

</div>
<!-- States END -->


<div class="rowContainer ailmentRow">

<!-- Burn -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Burn" value="0" hidden="true" checked>
<div class="status_effect_item rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Burn" name="act_ailmentClicker" data-i18n-title="ailments-burn" title="Burn"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon burn"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon burn-limbus"></div>
	</div>

</div>
</div>
<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="checkbox" class="hide-toggle" name="attr_burnNextTurnSetting" value="true" hidden="true" checked>
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_Burn" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item hide-item-rev" name="attr_BurnNextTurn" min="0" value="0">
	<input type="number" name="attr_BurnDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Bleed -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Bleed" value="0" hidden="true" checked>
<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Bleed" name="act_ailmentClicker" data-i18n-title="ailments-bleed" title="Bleed"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon bleed"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon bleed-limbus"></div>
	</div>

</div>

</div>
<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="checkbox" class="hide-toggle" name="attr_bleedNextTurnSetting" value="true" hidden="true" checked>
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_Bleed" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item hide-item-rev" name="attr_BleedNextTurn" min="0" value="0">
	<input type="number" name="attr_BleedDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Paralysis -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Paralysis" value="0" hidden="true" checked>
 <div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Paralysis" name="act_ailmentClicker"  data-i18n-title="ailments-paralysis" title="Paralysis"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon paralysis"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>

</div>

</div>
                                

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" class="ailmentNum ailmentNumThisTurn" min="0" name="attr_Paralysis" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item-rev" min="0" name="attr_ParalysisNextTurn" value="0">
	<input type="number" name="attr_ParalysisDecayPause" hidden="true" value="0">
	<input type="number" name="attr_prevParalysis" value="0" hidden="true">
</div>
</div>

                            </div> 

<!-- Row 2 -->
<div class="rowContainer ailmentRow">

<!-- Fragile -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Fragile" value="0" hidden="true" checked>   
                <div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Fragile" name="act_ailmentClicker"  data-i18n-title="ailments-fragile" title="Fragile"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon fragile"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon fragile-limbus-red"></div>
	</div>

</div>	
</div>
    <div class="status_effect_value rowContainer">
		<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
		<input type="number" min="0" class="ailmentNum ailmentNumThisTurn"name="attr_Fragile" value="0">
		<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev"name="attr_FragileNextTurn" value="0">
		<input type="number" name="attr_FragileDecayPause" hidden="true" value="0">
	</div>
</div>

<!-- Protection -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Protection" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Protection" name="act_ailmentClicker"  data-i18n-title="ailments-protection" title="Protection"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon protection"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon protection-limbus"></div>
	</div>

</div>	

</div>
    <div class="status_effect_value rowContainer">
		<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
		<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Protection" value="0">
		<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_ProtectionNextTurn" value="0">
		<input type="number" name="attr_ProtectionDecayPause" hidden="true" value="0">
	</div>
</div>

<!-- Stagger Protection -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_StaggerProtection" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_StaggerProtection" name="act_ailmentClicker"  data-i18n-title="ailments-stgprotection" title="Stagger Protection"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon staggerprotection"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
</div>	

</div>
<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_StaggerProtection" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_StaggerProtectionNextTurn" value="0">
	<input type="number" name="attr_StaggerProtectionDecayPause" hidden="true" value="0">
</div>
</div>

</div>


<!-- Row 3 -->
<div class="rowContainer ailmentRow">

<!-- Strength -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Strength" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Strength" name="act_ailmentClicker"  data-i18n-title="ailments-strength" title="Strength"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon strength"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon strength-limbus"></div>
	</div>
</div>	

</div>

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Strength" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_StrengthNextTurn" value="0">
	<input type="number" name="attr_StrengthDecayPause" hidden="true" value="0">
</div>
</div>
                                
<!-- Endurance -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Endurance" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Endurance" name="act_ailmentClicker"  data-i18n-title="ailments-endurance" title="Endurance"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon endurance"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon endurance-limbus-blue"></div>
	</div>
</div>	

</div>                               

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Endurance" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_EnduranceNextTurn" value="0">
	<input type="number" name="attr_EnduranceDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Haste -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Haste" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Haste" name="act_ailmentClicker"  data-i18n-title="ailments-haste" title="Haste"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon haste"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon haste-limbus"></div>
	</div>
</div>	

</div>

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Haste" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_HasteNextTurn" value="0">
	<input type="number" name="attr_HasteDecayPause" hidden="true" value="0">
</div>
</div>

                           </div>


<!-- Row 4 -->
<div class="rowContainer ailmentRow">

<!-- Feeble -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Feeble" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Feeble" name="act_ailmentClicker"  data-i18n-title="ailments-feeble" title="Feeble"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon feeble"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
</div>	

</div>

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Feeble" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_FeebleNextTurn" value="0">
	<input type="number" name="attr_FeebleDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Disarm -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Disarm" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Disarm" name="act_ailmentClicker"  data-i18n-title="ailments-disarm" title="Disarm"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon disarm"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon disarm-limbus-blue"></div>
	</div>
</div>	

</div>				

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Disarm" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_DisarmNextTurn" value="0">
	<input type="number" name="attr_DisarmDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Bind -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Bind" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Bind" name="act_ailmentClicker"  data-i18n-title="ailments-bind" title="Bind"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon bind-limbus"></div>
	</div>
</div>	

</div>                               

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" min="0" class="ailmentNum ailmentNumThisTurn" name="attr_Bind" value="0">
	<input type="number" min="0" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_BindNextTurn" value="0">
	<input type="number" name="attr_BindDecayPause" hidden="true" value="0">
</div>
</div>

                            </div>

<!-- Row 5 -->
<div class="rowContainer ailmentRow">

<!-- Smoke -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Smoke" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Smoke" name="act_ailmentClicker"  data-i18n-title="ailments-smoke" title="Smoke"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon smoke"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
</div>	

</div>                            

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle" name="attr_smokeNextTurnSetting" value="true" hidden="true" checked>
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_Smoke" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item" name="attr_SmokeNextTurn" min="0" value="0">
	<input type="number" name="attr_SmokeDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Charge -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Charge" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Charge" name="act_ailmentClicker"  data-i18n-title="ailments-charge" title="Charge"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon charge"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon charge-limbus"></div>
	</div>
</div>	

</div>  

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle" name="attr_chargeNextTurnSetting" value="true" hidden="true" checked>
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_Charge" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item" name="attr_ChargeNextTurn" min="0" value="0">
	<input type="number" name="attr_ChargeDecayPause" hidden="true" value="0">
</div>
</div>

<!-- Fortune -->
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_Fortune" value="0" hidden="true" checked>

<div class="status_effect_item  rowContainer centerFlex">
<button type="action" class="blocker ailmentButton" id="ailment_Fortune" name="act_ailmentClicker"  data-i18n-title="ailments-fortune" title="Fortune"></button>

<div class="ailmentIconSelector rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon fortune"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
</div>	

</div> 

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideNextTurn" value="true">
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_Fortune" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item-rev" name="attr_FortuneNextTurn" min="0" value="0">
	<input type="number" name="attr_FortuneDecayPause" hidden="true" value="0">
	<input type="number" name="attr_prevFortune" min="0" value="0" hidden="true">
</div>
</div>

</div>

<!-- repeating test - custom -->
<div class="ailmentCustomDisplay">
<fieldset class="repeating_ailments">

<input type="checkbox" class="hide-toggle-rev displayButton" name="attr_ailDisplay" hidden="true" value="0">

<button type="action" class="blocker hide-item-rev ailmentButton" name="act_clickercustom"></button>
<div class="hide-item-rev">

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_ailNum" value="0" hidden="true" checked>
  <div class="status_effect_item rowContainer centerFlex">
	<!-- Icon selector -->
	<div class="ailmentIconSelector rowContainer centerFlex">

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_ailIcon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_ailIcon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_ailIcon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_ailIcon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_ailIcon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_ailIcon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_ailIcon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_ailIcon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_ailIcon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_ailIcon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_ailIcon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_ailIcon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_ailIcon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_ailIcon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_ailIcon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_ailIcon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_ailIcon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_ailIcon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_ailIcon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_ailIcon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_ailIcon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_ailIcon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_ailIcon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_ailIcon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_ailIcon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_ailIcon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_ailIcon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_ailIcon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_ailIcon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_ailIcon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_ailIcon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_ailIcon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_ailIcon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_ailIcon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_ailIcon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_ailIcon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_ailIcon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_ailIcon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_ailIcon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_ailIcon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_ailIcon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_ailIcon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_ailIcon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_ailIcon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_ailIcon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_ailIcon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_ailIcon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_ailIcon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_ailIcon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_ailIcon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_ailIcon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_ailIcon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_ailIcon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_ailIcon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_ailIcon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_ailIcon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_ailIcon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_ailIcon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_ailIcon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_ailIcon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_ailIcon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_ailIcon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_ailIcon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>


	<!-- Icon selector END -->

</div>
</div>

<div class="status_effect_value rowContainer">
	<input type="checkbox" class="hide-toggle" name="attr_ailNextTurn" value="true">
	<input type="number" class="ailmentNum ailmentNumThisTurn" name="attr_ailNum" min="0" value="0">
	<input type="number" class="ailmentNum ailmentNumNextTurn hide-item" name="attr_ailNumNextTurn" min="0" value="0">
	<input type="number" name="attr_ailDecayPause" hidden="true" value="0">
</div>


<input type="text" name="attr_ailName" hidden="true">
<input type="text" name="attr_ailTrigger" hidden="true">
<input type="text" name="attr_ailEffect" hidden="true">
<input type="text" name="attr_ailEffectMode" hidden="true">
<input type="text" name="attr_ailEffectVal" hidden="true">
<input type="text" name="attr_ailDecayMode" hidden="true">
<input type="text" name="attr_ailDecayVal" hidden="true">
<input type="text" name="attr_ailMax" hidden="true">
<input type="text" name="attr_ailCustomReistance" hidden="true">
<input type="text" name="attr_ailMessageCheck" hidden="true">
<input type="text" name="attr_ailMessage" hidden="true">

</div>
</div>

</fieldset>
</div>
<!-- repeating test -->
                      
                    </div>

               </div>
	<!-- status ailments end -->

	<!-- Observation section palette -->


<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
<div class="hide-item">
<div class="rowContainer titleHeader">
<button type="action" class="qolButton" name="act_resetObservation" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-observation">Observation levels</h4> </div>

	<input type="checkbox" name="attr_distortState" value="true" hidden="true">
	<div class="contentContainer darkBG helperTextContainer">

<div class="rowContainer observationSelect">
<div class="columnAlign">
<b data-i18n="distort-obs-details">Details</b><br>
<label for="obsDesc"><input type="checkbox" id="obsDesc" name="attr_obsDesc" value="true" checked><span data-i18n="distort-obs-desc">Effect desc.</span></label>
<label for="obsEffect"><input type="checkbox" id="obsEffect" name="attr_obsEffect" value="true"><span data-i18n="distort-obs-effect">Effects</span></label>
<label for="obsBehavior"><input type="checkbox" id="obsBehavior" name="attr_obsBehavior" value="true"><span data-i18n="distort-behavior">Behavior</span></label>
<label for="obsTaboon"><input type="checkbox" id="obsTaboon" name="attr_obsTaboon" value="true"><span data-i18n="distort-obs-taboon">Taboos/Boons</span></label>
</div>

<div class="columnAlign">
<b data-i18n="distort-obs-work">Work</b><br>
<label for="obsCounter"><input type="checkbox" id="obsCounter" name="attr_obsCounter" value="true" checked><span data-i18n="distort-counter">Counter</span></label>
<label for="obsWorkAmount"><input type="checkbox" id="obsWorkAmount" name="attr_obsWorkAmount" value="true" checked><span data-i18n="distort-workamount">Work amount</span></label>
<label for="obsWorkPref"><input type="checkbox" id="obsWorkPref" name="attr_obsWorkPref" value="true"><span data-i18n="distort-obs-workpreference">Preferences</span></label>
<label for="obsWorkResults"><input type="checkbox" id="obsWorkResults" name="attr_obsWorkResults" value="true"><span data-i18n="distort-obs-workresults">Work results</span></label>
</div>

<div class="columnAlign">
<b data-i18n="distort-obs-flavor">Flavor</b><br>
<label for="obsSummary"><input type="checkbox" id="obsSummary" name="attr_obsSummary" value="true" checked><span data-i18n="character-summary">Summary</span></label>
<label for="obsAppearance"><input type="checkbox" id="obsAppearance" name="attr_obsAppearance" value="true"><span data-i18n="distort-appearance">Appearance</span></label>
<label for="obsAtmosphere"><input type="checkbox" id="obsAtmosphere" name="attr_obsAtmosphere" value="true"><span data-i18n="distort-atmosphere">Atmosphere</span></label>
<label for="obsStory"><input type="checkbox" id="obsStory" name="attr_obsStory" value="true"><span data-i18n="distort-story">Story</span></label>
</div>

</div>


	</div>
</div>

	<!-- Observation END -->

 

            </div>


            <!-- Stats Section -->
            <div id="TopColumnR">

<div class="rowContainer titleHeader"><button type="action" class="qolButton" name="act_resetStats" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-stats">Stats</h4> <button type="action" class="reloadButton reusableIcon" name="act_resetUses" data-i18n-title="reset-button" title="Reset"></button></div>

                <div class="contentContainer darkBG" id="baseStats">

		<div class="rowContainer">

		<!-- Instinct -->
              	<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="InstinctStat" data-i18n-title="stats-instinct" title="Instinct"> 
			<input type="text" class="instinct" name="attr_instinct" value="0">
			</div>
</div>
		<div class="statHeader instinct" data-i18n-title="stats-instinct-roll" title="Roll Instinct">
<button type="action" class="challengeButton instinct" name="act_rollChallenge" id="autoroll_instinct" data-i18n="stats-instinct">Instinct</button>

		</div>
	
			
		</div>

		<!-- Wisdom -->
		<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="WisdomStat" data-i18n-title="stats-wisdom" title="Wisdom"> 
			<input type="text" class="wisdom" name="attr_wisdom" value="0">
			</div>

			</div>

			<div class="statHeader wisdom" data-i18n-title="stats-wisdom-roll" title="Roll Wisdom">

<button type="action" class="challengeButton wisdom" name="act_rollChallenge" id="autoroll_wisdom" data-i18n="stats-wisdom">Wisdom</button>

			</div>

		</div>

		<!-- Justice -->
		<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="JusticeStat" data-i18n-title="stats-justice" title="Justice"> 
			<input type="text" class="justice" name="attr_justice" value="0">
			</div>

			</div>

			<div class="statHeader justice"  data-i18n-title="stats-justice-roll" title="Roll Justice">

<button type="action" class="challengeButton justice" name="act_rollChallenge" id="autoroll_justice" data-i18n="stats-justice">Justice</button>
			
			</div>
		</div>
	</div>
	<!-- Stat first row end -->



	<div class="rowContainer">
		<!-- Charm -->
		<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="CharmStat" title="Charm" data-i18n-title="stats-charm"> 
			<input type="text" class="charm" name="attr_charm" value="0">
			</div>

			</div>

			<div class="statHeader charm" data-i18n-title="stats-charm-roll" title="Roll Charm">

<button type="action" class="challengeButton charm" name="act_rollChallenge" id="autoroll_charm" data-i18n="stats-charm">Charm</button>
			
			</div>
		</div>

		<!-- Insight -->
		<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="InsightStat" data-i18n-title="stats-insight" title="Insight"> 
			<input type="text" class="insight" name="attr_insight" value="0">
			</div>

			</div>

			<div class="statHeader insight" data-i18n-title="stats-insight-roll" title="Roll Insight">

<button type="action" class="challengeButton insight" name="act_rollChallenge" id="autoroll_insight" data-i18n="stats-insight">Insight</button>
			
			</div>
		</div>

		<!-- Temperance -->
		<div class="statBlock">
			<div class="statImage">
			<div class="statInput" id="TemperanceStat" data-i18n-title="stats-temperance" title="Temperance"> 
			<input type="text" class="temperance" name="attr_temperance" value="0">
			</div>

			</div>

			<div class="statHeader temperance" data-i18n-title="stats-temperance-roll" title="Roll Temperance">

<button type="action" class="challengeButton temperance" name="act_rollChallenge" id="autoroll_temperance" data-i18n="stats-temperance">Temperance</button>
			
			</div>
		</div>

	</div>
	<!-- Stat row2 end --> 

    			</div>

<!-- Damage & healing helpers -->
<div class="rowContainer titleHeader">
	<button type="action" class="qolButton" name="act_resetDamageHelper" data-i18n-title="reset-button" title="Reset"> ! </button> <h4 data-i18n="heading-damagehelper">Damage helper</h4>
</div>
<div class="contentContainer darkBG">
	<input type="checkbox" class="helperText" name="attr_settingHelperText" value="true" hidden="true">
	<div class="rowContainer damageHelperContainer helperTextContainer">
		<div class="columnAlign damageHelperType">
			<input type="radio" id="damageHelperNone" name="attr_damageHelperType" value="None" checked>

			<input type="radio" id="damageHelperSlash" name="attr_damageHelperType" value="Slash">
			<label for="damageHelperSlash" class="type-image typeIcon slash"></label>

			<input type="radio" id="damageHelperPierce" name="attr_damageHelperType" value="Pierce">
			<label for="damageHelperPierce" class="type-image typeIcon pierce"></label>

			<input type="radio" id="damageHelperBlunt" name="attr_damageHelperType" value="Blunt">
			<label for="damageHelperBlunt" class="type-image typeIcon blunt"></label>
		</div>

		<div class="columnAlign baseDamage helpers">
			<b data-i18n="helper-text-basedamage">Base Damage</b>
			<input type="number" class="whiteInput baseDamageInput" name="attr_baseDamage" value="0" min="0" data-i18n-title="helper-text-basedamage" title="Base damage">
		</div>
		<div class="columnAlign flatDamage helpers" style="margin-left: 3px;">
			<b data-i18n="helper-text-flatdamagehp">Flat HP DMG</b>
			<input type="number" class="whiteInput flatHPInput" name="attr_flatDamageHP" value="0" data-i18n-title="helper-text-flatdamagehp" title="Flat HP DMG">
		</div>
		<div class="columnAlign flatDamage helpers">
			<b data-i18n="helper-text-flatdamagest">Flat ST DMG</b>
			<input type="number" class="whiteInput flatSTInput" name="attr_flatDamageST" value="0" data-i18n-title="helper-text-flatdamagest" title="Flat ST DMG">
		</div>
		<div class="columnAlign applyDamage helpers">
			<b data-i18n="helper-text-applydamage">Apply damage</b>
			<button type="action" class="applyDamageInput" name="act_applyDamage" data-i18n-title="helper-text-applydamage" title="Apply damage"></button>
		</div>
	</div>
	<input type="text" name="attr_THP_Sources" value="{}" hidden="true">
	<input type="text" name="attr_TST_Sources" value="{}" hidden="true">
</div>


<!-- AutoEffect Conditional Buttons -->
<div class="conditionalButtonDisplay" style="margin-top: 10px; width: calc(100% + 5px);">
	<fieldset class="repeating_conditionalButtons">
		<input type="checkbox" name="attr_buttonColor" value="green" class="conditioalButtonColorSelection" hidden checked/>
		<input type="checkbox" name="attr_buttonColor" value="blue" class="conditioalButtonColorSelection" hidden />
		<input type="checkbox" name="attr_buttonColor" value="red" class="conditioalButtonColorSelection" hidden />
		<input type="checkbox" name="attr_buttonColor" value="orange" class="conditioalButtonColorSelection" hidden />
		<input type="checkbox" name="attr_buttonColor" value="yellow" class="conditioalButtonColorSelection" hidden />
		<input type="checkbox" name="attr_buttonColor" value="purple" class="conditioalButtonColorSelection" hidden />
		<input type="checkbox" name="attr_buttonColor" value="black" class="conditioalButtonColorSelection" hidden />
		<img name="attr_buttonIcon" class="conditionalButtonIcon conditioalButtonColor">
		<button type="action" class="conditionalButtonAct" name="act_activate"></button> 
		<div class="conditionalButton conditioalButtonColor">
			<span type="text" class="conditionalButtonName" name="attr_buttonName"></span>
			<input type="text" name="attr_buttonAutoScript" hidden="true">
		</div>
	</fieldset>
</div>


<!-- Combat palette -->
<div class="status_effect" style="margin-top: 5px;">
<div class="status_effect" style="margin-top: 5px;">
	<div class="contentContainer darkBG">

	<!-- Combat options -->
	<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideCombatOptions" value="true">
	<div class="rowContainer combatOptionsContainer hide-item-rev">
		
		<!-- Target selector -->
		<div class="columnAlign helpers">
			<b data-i18n="helper-text-selecttarget">Target</b>
			<button type="action" class="selectTargetButton" name="act_selectTarget" title="Select target. Double click button to reset target" data-i18n-title="helper-text-selecttarget-title">
				<img name="attr_targetToken" class="targetToken">
				<div class="selectTargetIcon"></div>
			</button>
		</div>

		<!-- Target statistics -->
		<div class="columnAlign helpers" style="margin-left: 3px;">
			<input type="text" class="tokenName" name="attr_targetTokenName" value="" style="width: 150px;" placeholder="No target selected" data-i18n-placeholder="helper-text-notarget" readonly="">
			<input type="text" name="attr_targetName" value="" hidden="true">
			<input type="text" name="attr_targetTokenId" value="" hidden="true">
			<input type="text" name="attr_targetSettings" value="{}" hidden="true">
			
			<!-- Target bars -->
			<input type="text" name="attr_targetBarList" value="{}" hidden="true">
			<input type="text" name="attr_targetBarDamageList" value="{}"  hidden="true">
			<div class="rowContainer" style="width: 150px;">
				<div class="bars"><input class="Cstat HPtext" type="text" name="attr_HP_target" value="---"></div>
				<div class="bars"><input class="Cstat egoSTGRtext" type="text" name="attr_StagRes_target" value="---"></div>
				<div class="bars"><input class="Cstat SANtext" type="text" name="attr_SP_target" value="---"></div>
			</div>

			<!-- Target ailments -->
			<input type="text" name="attr_targetAilmentList" value="{}" hidden="true">
			<div class="rowContainer">
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment1Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment1Icon">
					<input type="number" name="attr_targetAilment1Num" min="0" value="0">
				</div>
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment2Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment2Icon">
					<input type="number" name="attr_targetAilment2Num" min="0" value="0">
				</div>
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment3Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment3Icon">
					<input type="number" name="attr_targetAilment3Num" min="0" value="0">
				</div>
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment4Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment4Icon">
					<input type="number" name="attr_targetAilment4Num" min="0" value="0">
				</div>
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment5Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment5Icon">
					<input type="number" name="attr_targetAilment5Num" min="0" value="0">
				</div>
				<input type="checkbox" class="hide-toggle-rev" name="attr_targetAilment6Num" value="0" hidden="true">
				<div class="targetAilment hide-item-rev">
					<img name="attr_targetAilment6Icon">
					<input type="number" name="attr_targetAilment6Num" min="0" value="0">
				</div>
			</div>
		</div>

		<!-- Last defence dice -->
		<div class="columnAlign helpers" style="margin-left: 3px;">
			<b data-i18n="helper-text-defencedice">Defence</b>
			<input type="number" class="darkInput defenceDice" name="attr_lastDefenceRoll" min="0" value="0" data-i18n-title="helper-text-lastdefenceroll" title="Last Defence roll"> <!-- delete this later -->
			<input type="text" name="attr_selfToken" hidden>
		</div>
	</div>


                     
	<!-- Weapon 1 Palette -->
	<div class="weaponSlot">
	<div class="rowContainer weapon paletteButton"> <!-- color portion -->


	<!-- Weapon1 Uses -->
	<div class="buffer weaponPaletteUses">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon1UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon1Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon1UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  
		<div class="blocker"></div>
		</div>

	</div>

	<div class="buffer">
	<input type="checkbox" class="hide-toggle" name="attr_weapon1Uses" value="0" hidden="true">
		<div class="hide-item">
		<div class="blocker weaponBlocker"></div>
		</div>
	</div>
	<!-- Weapon1 Uses END -->



	<div class="rowContainer half centerFlex">
		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon1Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon1Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon1Type"><div class="type-image typeIcon blunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon1Name" data-i18n-placeholder="palette-weapon1-name" placeholder="Weapon (1)">

	</div>


	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>

	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon1Roll1" placeholder="1" value="(@{weapon1Dice1} + @{selectAtkDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon1Roll2" placeholder="6" value="(@{weapon1Dice2} + @{selectAtkDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon1Roll3" placeholder="0" value="(@{weapon1Dice3}+@{attPower}+@{selectAtkDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

	<button type="action" class="NDice" id="autoroll_weapon1" name="act_rollCombat"></button>



	</div> <!-- weapon 1 (under) end -->

	<!-- EGO (Weapon 1) Palette -->
	<div class="paletteOverride" style="z-index: 30;">
	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="0" checked>
	<div class="hide-item">
	<input type="checkbox" class="hide-toggle" name="attr_egoActiveState" value="true">
	<div class="hide-item">

		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Weapon">
		<div class="hide-item">

	<div class="buffer">
	<input type="checkbox" class="hide-toggle" name="attr_egoUses" value="0" hidden="true">
		<div class="hide-item" style="z-index: 35; position: absolute; top: 0; left:0; width: 100%; height: 30px;">
		<div class="blocker weaponBlocker"></div>
		</div>
	</div>
	
		<!-- actual content -->
		<div class="rowContainer egoAttPalette paletteButton">
		<div class="rowContainer half centerFlex">

		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_egoWeaponType"><div class="type-image typeIcon egoSlash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_egoWeaponType"><div class="type-image typeIcon egoPierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_egoWeaponType"><div class="type-image typeIcon egoBlunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_egoName" data-i18n-placeholder="palette-egoweapon-name" placeholder="Mystery weapon">

		</div> <!-- first half -->

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange">

	<!-- EGO Uses -->
	<div class="buffer weaponPaletteUses">
	<input type="checkbox" class="hide-toggle-rev" name="attr_egoUseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_egoUses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_egoUseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  
		<div class="blocker"></div>
		</div>

	</div>

	<!-- EGO Uses END -->

	</div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_egoWeaponRoll1" placeholder="1" value="(@{egoWeaponDice1} + @{selectAtkDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_egoWeaponRoll2" placeholder="6" value="(@{egoWeaponDice2} + @{selectAtkDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_egoWeaponRoll3" placeholder="0" value="(@{egoWeaponDice3}+@{attPower}+@{selectAtkDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_egoWeapon" name="act_rollCombat"></button>


		</div>			
       </div>
</div></div></div></div>
	<!-- EGO (Weapon 1) Palette END -->


<!-- Distortion (Weapon 1) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
		<!-- actual content -->
		<div class="rowContainer egoAttPalette paletteButton">
		<div class="rowContainer half centerFlex">

		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon1Type"><div class="type-image typeIcon egoSlash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon1Type"><div class="type-image typeIcon egoPierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon1Type"><div class="type-image typeIcon egoBlunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon1Name" data-i18n-placeholder="palette-weapon1-name" placeholder="Weapon (1)">

		</div> <!-- first half -->

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon1Roll1" placeholder="1" value="(@{weapon1Dice1} + @{selectAtkDice1} + @{distortWeaponDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon1Roll2" placeholder="6" value="(@{weapon1Dice2} + @{selectAtkDice2} + @{distortWeaponDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon2Roll3" placeholder="0" value="(@{weapon1Dice3}+@{attPower}+@{selectAtkDice3}+@{distortWeaponDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_weapon1_distort" name="act_rollCombat"></button>


		</div>			
       </div>
</div></div>
	<!-- Distortion (Weapon 1) Palette END -->


 
	<!-- Weapon 1 Palette END -->
	</div></div>

	<!-- Weapon 2 Palette -->
	<div class="weaponSlot">
			<input type="checkbox" class="hide-toggle-rev" name="attr_weapon2Name" value="" hidden="true" checked>
	<div class="hide-item-rev" style="width: 100%;">

	<div class="rowContainer weapon paletteButton">

	<!-- Weapon2 Uses -->
	<div class="buffer weaponPaletteUses">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon2UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon2Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon2UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  
		<div class="blocker"></div>
		</div>

	</div>

	<div class="buffer">
	<input type="checkbox" class="hide-toggle" name="attr_weapon2Uses" value="0" hidden="true">
		<div class="hide-item">
		<div class="blocker weaponBlocker"></div>
		</div>
	</div>
	<!-- Weapon2 Uses END -->




	<div class="rowContainer half centerFlex">
		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon2Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon2Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon2Type"><div class="type-image typeIcon blunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon2Name" data-i18n-placeholder="palette-weapon2-name" placeholder="Weapon (2)">

	</div>

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


		<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon2Roll1" placeholder="1" value="(@{weapon2Dice1} + @{selectAtkDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon2Roll2" placeholder="6" value="(@{weapon2Dice2} + @{selectAtkDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon2Roll3" placeholder="0" value="(@{weapon2Dice3}+@{attPower}+@{selectAtkDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

	<button type="action" class="NDice" id="autoroll_weapon2" name="act_rollCombat"></button>
	</div>

<!-- Distortion (Weapon 2) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
		<!-- actual content -->
		<div class="rowContainer egoAttPalette paletteButton">
		<div class="rowContainer half centerFlex">

		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon2Type"><div class="type-image typeIcon egoSlash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon2Type"><div class="type-image typeIcon egoPierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon2Type"><div class="type-image typeIcon egoBlunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon2Name" data-i18n-placeholder="palette-weapon2-name" placeholder="Weapon (2)">

		</div> <!-- first half -->

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon2Roll1" placeholder="1" value="(@{weapon2Dice1} + @{selectAtkDice1} + @{distortWeaponDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon2Roll2" placeholder="6" value="(@{weapon2Dice2} + @{selectAtkDice2} + @{distortWeaponDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon2Roll3" placeholder="0" value="(@{weapon2Dice3}+@{attPower}+@{selectAtkDice3}+@{distortWeaponDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_weapon2_distort" name="act_rollCombat"></button>


		</div>			
       </div>
</div></div>
	<!-- Distortion (Weapon 2) Palette END -->

		</div>
        </div>
	</div>

	<!-- Weapon 2 Palette END -->


	<!-- Weapon EXTRA palette -->
		<!-- Weapon 3 Palette -->
	<div class="weaponSlot">
			<input type="checkbox" class="hide-toggle-rev" name="attr_weapon3Name" value="" hidden="true" checked>
	<div class="hide-item-rev" style="width: 100%;">

	<div class="rowContainer weapon paletteButton">

	<!-- Weapon3 Uses -->
	<div class="buffer weaponPaletteUses">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon3UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon3Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon3UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  
		<div class="blocker"></div>
		</div>

	</div>

	<div class="buffer">
	<input type="checkbox" class="hide-toggle" name="attr_weapon3Uses" value="0" hidden="true">
		<div class="hide-item">
		<div class="blocker weaponBlocker"></div>
		</div>
	</div>
	<!-- Weapon3 Uses END -->


	<div class="rowContainer half centerFlex">
		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon3Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon3Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon3Type"><div class="type-image typeIcon blunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon3Name" data-i18n-placeholder="palette-weapon3-name" placeholder="Weapon (3)">

	</div>

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


		<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon3Roll1" placeholder="1" value="(@{weapon3Dice1} + @{selectAtkDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon3Roll2" placeholder="6" value="(@{weapon3Dice2} + @{selectAtkDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon3Roll3" placeholder="0" value="(@{weapon3Dice3}+@{attPower}+@{selectAtkDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

	<button type="action" class="NDice" id="autoroll_weapon3" name="act_rollCombat"></button>
	</div>

<!-- Distortion (Weapon 3) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
		<!-- actual content -->
		<div class="rowContainer egoAttPalette paletteButton">
		<div class="rowContainer half centerFlex">

		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon3Type"><div class="type-image typeIcon egoSlash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon3Type"><div class="type-image typeIcon egoPierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon3Type"><div class="type-image typeIcon egoBlunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon3Name" data-i18n-placeholder="palette-weapon3-name" placeholder="Weapon (3)">

		</div> <!-- first half -->

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon3Roll1" placeholder="1" value="(@{weapon3Dice1} + @{selectAtkDice1} + @{distortWeaponDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon3Roll2" placeholder="6" value="(@{weapon3Dice2} + @{selectAtkDice2} + @{distortWeaponDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon3Roll3" placeholder="0" value="(@{weapon3Dice3}+@{attPower}+@{selectAtkDice3}+@{distortWeaponDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_weapon3_distort" name="act_rollCombat"></button>


		</div>			
       </div>
</div></div>
	<!-- Distortion (Weapon 3) Palette END -->


		</div>
        </div>
	</div>

	<!-- Weapon 3 Palette END -->

	<!-- Weapon 4 Palette -->
	<div class="weaponSlot">
			<input type="checkbox" class="hide-toggle-rev" name="attr_weapon4Name" value="" hidden="true" checked>
	<div class="hide-item-rev" style="width: 100%;">

	<div class="rowContainer weapon paletteButton">

	<!-- Weapon4 Uses -->
	<div class="buffer weaponPaletteUses">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon4UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon4Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon4UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  
		<div class="blocker"></div>
		</div>

	</div>

	<div class="buffer">
	<input type="checkbox" class="hide-toggle" name="attr_weapon4Uses" value="0" hidden="true">
		<div class="hide-item">
		<div class="blocker weaponBlocker"></div>
		</div>
	</div>
	<!-- Weapon4 Uses END -->

	<div class="rowContainer half centerFlex">
		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon4Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon4Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon4Type"><div class="type-image typeIcon blunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon4Name" data-i18n-placeholder="palette-weapon4-name" placeholder="Weapon (4)">

	</div>

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon4Roll1" placeholder="1" value="(@{weapon4Dice1} + @{selectAtkDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon4Roll2" placeholder="6" value="(@{weapon4Dice2} + @{selectAtkDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon4Roll3" placeholder="0" value="(@{weapon4Dice3}+@{attPower}+@{selectAtkDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

	<button type="action" class="NDice" id="autoroll_weapon4" name="act_rollCombat"></button>
	</div>

<!-- Distortion (Weapon 4) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
		<!-- actual content -->
		<div class="rowContainer egoAttPalette paletteButton">
		<div class="rowContainer half centerFlex">

		<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon4Type"><div class="type-image typeIcon egoSlash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon4Type"><div class="type-image typeIcon egoPierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon4Type"><div class="type-image typeIcon egoBlunt"></div>
		</div>

		</div>

	<input type="text" class="combatPaletteName transpInput" name="attr_weapon4Name" data-i18n-placeholder="palette-weapon4-name" placeholder="Weapon (4)">

		</div> <!-- first half -->

	<div class="rowContainer half" style="position: relative;">
	
	<div class="paletteRange"></div>


	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_weapon4Roll1" placeholder="1" value="(@{weapon4Dice1} + @{selectAtkDice1} + @{distortWeaponDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_weapon4Roll2" placeholder="6" value="(@{weapon4Dice2} + @{selectAtkDice2} + @{distortWeaponDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_weapon4Roll3" placeholder="0" value="(@{weapon4Dice3}+@{attPower}+@{selectAtkDice3}+@{distortWeaponDice3}+@{Strength}-@{Feeble}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_weapon4_distort" name="act_rollCombat"></button>


		</div>			
       </div>
</div></div>
	<!-- Distortion (Weapon 4) Palette END -->


		</div>
        </div>
	</div>

	<!-- Weapon 4 Palette END -->

	<!-- Weapon EXTRA palette END -->

	

	<!-- Def/Evd palette -->
	<div class="rowContainer">

	<!-- Action Palette -->
	<div class="rowContainer half" style="margin-right: 5px;">


	<!-- Distortion (Action) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
	<div class="columnAlign BLACK paletteButton" style="height: 63px; overflow: hidden; align-items: start; justify-content: start;">
	<div class="rowContainer" style="height: 50%;">
	<select name="attr_actionType" class="darkInput toolText" style="height: 100%; margin-bottom: 0px;">
         <option data-i18n="palette-action-tool" value="tool">Use Tool</option>
         <option data-i18n="palette-action-move" value="move">Move</option>
         <option data-i18n="palette-action-protect" value="protect">Protect</option>
	 <option data-i18n="palette-action-other" value="other">Other</option>
         </select>

	<button type="action" class="declare toolText" data-i18n="palette-action-text" name="act_declareAction">Action</button>
	</div>
		
       </div>
	</div>
	</div>

	<!-- Distortion (Action) Palette END -->

	<div class="columnAlign tool paletteButton" style="height: 63px; overflow: hidden;  justify-content: start;">
	<div class="rowContainer" style="height: 50%;">
	<select name="attr_actionType" class="darkInput" style="height: 100%; margin-bottom: 0px;">
         <option data-i18n="palette-action-tool" value="tool">Use Tool</option>
         <option data-i18n="palette-action-move" value="move">Move</option>
         <option data-i18n="palette-action-protect" value="protect">Protect</option>
	 <option data-i18n="palette-action-other" value="other">Other</option>
         </select>

	<button type="action" class="declare" data-i18n="palette-action-text" name="act_declareAction">Action</button>
	</div>
	
<!-- Tool Selector Box -->
	<div class="rowContainer centerFlex toolSelect">


	<!-- EGO Tool selector -->

	<div>


	<input type="checkbox" class="hide-toggle" name="attr_egoActiveState" value="true" hidden="true"><div class="hide-item">

	<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Tool" hidden="true"><div class="hide-item">

	<div class="toolSelectHolder">

	<input id="select-egoTool" class="toolSelector" type="checkbox" name="attr_toolSelect" value="egoTool">
	<label for="select-egoTool" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>	

<input type="checkbox" class="hide-toggle-rev" name="attr_egoUseType" value="Limitless" hidden="true" checked>
	<input type="text" name="attr_egoUses" class="hide-item-rev toolSelectBox" value="5">

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Tool" name="attr_egoType"><div class="type-image skillIcon egoAct"></div>
	</div>

	</label>


	<input type="checkbox" class="hide-toggle" name="attr_egoUses" value="0" hidden="true"><div class="hide-item blocker" style="z-index: 100;"></div>

	</div>

	</div> 
	</div>
	</div>
	<!-- EGO tool selector end -->

	<!-- EGO special selector -->
	<div>


	<input type="checkbox" class="hide-toggle" name="attr_egoActiveState" value="true" hidden="true"><div class="hide-item">

	<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Special" hidden="true"><div class="hide-item">

	<div class="toolSelectHolder">

	<input id="select-egoSpecial" class="toolSelector" type="checkbox" name="attr_toolSelect" value="egoSpecial">
	<label for="select-egoSpecial" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>

<input type="checkbox" class="hide-toggle-rev" name="attr_egoUseType" value="Limitless" hidden="true" checked>
	<input type="text" name="attr_egoUses" class="hide-item-rev toolSelectBox" value="5">

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Special" name="attr_egoType"><div class="type-image skillIcon egoSpecial"></div>
	</div>

	</label>

	<input type="checkbox" class="hide-toggle" name="attr_egoUses" value="0" hidden="true"><div class="hide-item blocker" style="z-index: 100;"></div>

	</div>

	</div> 
	</div>
	</div>
	<!-- EGO special end -->



	<!-- Tool1 selector -->

	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool1Uses" value="0" hidden="true">
	<div class="hide-item-rev">
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool1Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">

	<input id="select-tool1" class="toolSelector" type="checkbox" name="attr_toolSelect" value="tool1">
	<label for="select-tool1" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>
	
	<input type="text" name="attr_tool1Uses" class="toolSelectBox" value="1">

	<!-- Tool1 Icon Selection -->
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_tool1Icon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_tool1Icon"><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="Hand" name="attr_tool1Icon" checked><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_tool1Icon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_tool1Icon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_tool1Icon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_tool1Icon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_tool1Icon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_tool1Icon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_tool1Icon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_tool1Icon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_tool1Icon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_tool1Icon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_tool1Icon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_tool1Icon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_tool1Icon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_tool1Icon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_tool1Icon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_tool1Icon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_tool1Icon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_tool1Icon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_tool1Icon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_tool1Icon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_tool1Icon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_tool1Icon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_tool1Icon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_tool1Icon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_tool1Icon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_tool1Icon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_tool1Icon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_tool1Icon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_tool1Icon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_tool1Icon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_tool1Icon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_tool1Icon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_tool1Icon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_tool1Icon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_tool1Icon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_tool1Icon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_tool1Icon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_tool1Icon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_tool1Icon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_tool1Icon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_tool1Icon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_tool1Icon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_tool1Icon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_tool1Icon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_tool1Icon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_tool1Icon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_tool1Icon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_tool1Icon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_tool1Icon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_tool1Icon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_tool1Icon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_tool1Icon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_tool1Icon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_tool1Icon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_tool1Icon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_tool1Icon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_tool1Icon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_tool1Icon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_tool1Icon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_tool1Icon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_tool1Icon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_tool1Icon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_tool1Icon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_tool1Icon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_tool1Icon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_tool1Icon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_tool1Icon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_tool1Icon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_tool1Icon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_tool1Icon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_tool1Icon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_tool1Icon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_tool1Icon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_tool1Icon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_tool1Icon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_tool1Icon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_tool1Icon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_tool1Icon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_tool1Icon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_tool1Icon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_tool1Icon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_tool1Icon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_tool1Icon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_tool1Icon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_tool1Icon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_tool1Icon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_tool1Icon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>

	<!-- Tool1 Icon selection end -->


	</label>

	</div> 
	</div>
	</div>
	<!-- Tool1 selector end -->

	<!-- Tool2 selector -->

	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool2Uses" value="0" hidden="true">
	<div class="hide-item-rev">
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool2Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">

	<input id="select-tool2" class="toolSelector" type="checkbox" name="attr_toolSelect" value="tool2">
	<label for="select-tool2" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>
	

	<input type="text" name="attr_tool2Uses" class="toolSelectBox" value="1">

	<!-- Tool2 Icon Selection -->
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_tool2Icon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_tool2Icon"><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="Hand" name="attr_tool2Icon" checked><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_tool2Icon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_tool2Icon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_tool2Icon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_tool2Icon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_tool2Icon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_tool2Icon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_tool2Icon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_tool2Icon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_tool2Icon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_tool2Icon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_tool2Icon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_tool2Icon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_tool2Icon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_tool2Icon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_tool2Icon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_tool2Icon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_tool2Icon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_tool2Icon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_tool2Icon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_tool2Icon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_tool2Icon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_tool2Icon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_tool2Icon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_tool2Icon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_tool2Icon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_tool2Icon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_tool2Icon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_tool2Icon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_tool2Icon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_tool2Icon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_tool2Icon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_tool2Icon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_tool2Icon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_tool2Icon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_tool2Icon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_tool2Icon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_tool2Icon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_tool2Icon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_tool2Icon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_tool2Icon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_tool2Icon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_tool2Icon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_tool2Icon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_tool2Icon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_tool2Icon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_tool2Icon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_tool2Icon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_tool2Icon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_tool2Icon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_tool2Icon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_tool2Icon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_tool2Icon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_tool2Icon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_tool2Icon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_tool2Icon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_tool2Icon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_tool2Icon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_tool2Icon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_tool2Icon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_tool2Icon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_tool2Icon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_tool2Icon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_tool2Icon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_tool2Icon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_tool2Icon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_tool2Icon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_tool2Icon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_tool2Icon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_tool2Icon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_tool2Icon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_tool2Icon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_tool2Icon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_tool2Icon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_tool2Icon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_tool2Icon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_tool2Icon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_tool2Icon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_tool2Icon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_tool2Icon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_tool2Icon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_tool2Icon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_tool2Icon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_tool2Icon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_tool2Icon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_tool2Icon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_tool2Icon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_tool2Icon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>

	<!-- Tool2 Icon selection end -->


	</label>

	</div> 
	</div>
	</div>
	<!-- Tool2 selector end -->

	<!-- Tool3 selector -->

	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool3Uses" value="0" hidden="true">
	<div class="hide-item-rev">
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool3Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">

	<input id="select-tool3" class="toolSelector" type="checkbox" name="attr_toolSelect" value="tool3">
	<label for="select-tool3" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>
	

	<input type="text" name="attr_tool3Uses" class="toolSelectBox" value="1">

	<!-- Tool3 Icon Selection -->
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_tool3Icon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_tool3Icon"><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="Hand" name="attr_tool3Icon" checked><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_tool3Icon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_tool3Icon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_tool3Icon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_tool3Icon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_tool3Icon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_tool3Icon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_tool3Icon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_tool3Icon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_tool3Icon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_tool3Icon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_tool3Icon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_tool3Icon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_tool3Icon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_tool3Icon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_tool3Icon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_tool3Icon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_tool3Icon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_tool3Icon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_tool3Icon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_tool3Icon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_tool3Icon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_tool3Icon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_tool3Icon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_tool3Icon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_tool3Icon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_tool3Icon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_tool3Icon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_tool3Icon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_tool3Icon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_tool3Icon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_tool3Icon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_tool3Icon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_tool3Icon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_tool3Icon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_tool3Icon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_tool3Icon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_tool3Icon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_tool3Icon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_tool3Icon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_tool3Icon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_tool3Icon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_tool3Icon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_tool3Icon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_tool3Icon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_tool3Icon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_tool3Icon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_tool3Icon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_tool3Icon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_tool3Icon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_tool3Icon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_tool3Icon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_tool3Icon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_tool3Icon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_tool3Icon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_tool3Icon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_tool3Icon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_tool3Icon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_tool3Icon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_tool3Icon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_tool3Icon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_tool3Icon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_tool3Icon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_tool3Icon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_tool3Icon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_tool3Icon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_tool3Icon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_tool3Icon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_tool3Icon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_tool3Icon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_tool3Icon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_tool3Icon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_tool3Icon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_tool3Icon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_tool3Icon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_tool3Icon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_tool3Icon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_tool3Icon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_tool3Icon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_tool3Icon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_tool3Icon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_tool3Icon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_tool3Icon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_tool3Icon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_tool3Icon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_tool3Icon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_tool3Icon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_tool3Icon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>

	<!-- Tool3 Icon selection end -->


	</label>

	</div> 
	</div>
	</div>
	<!-- Tool3 selector end -->

	<!-- Tool4 selector -->

	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool4Uses" value="0" hidden="true">
	<div class="hide-item-rev">
	<input type="checkbox" class="hide-toggle-rev" name="attr_tool4Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">

	<input id="select-tool4" class="toolSelector" type="checkbox" name="attr_toolSelect" value="tool4">
	<label for="select-tool4" class="skillSelectionLabel">

	<div class="blocker toolBlocker"></div>
	

	<input type="text" name="attr_tool4Uses" class="toolSelectBox" value="1">

	<!-- Tool4 Icon Selection -->
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_tool4Icon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_tool4Icon"><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="Hand" name="attr_tool4Icon" checked><div class="type-image skillIcon portableIcon"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_tool4Icon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_tool4Icon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_tool4Icon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_tool4Icon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_tool4Icon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_tool4Icon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_tool4Icon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_tool4Icon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_tool4Icon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_tool4Icon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_tool4Icon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_tool4Icon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_tool4Icon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_tool4Icon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_tool4Icon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_tool4Icon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_tool4Icon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_tool4Icon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_tool4Icon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_tool4Icon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_tool4Icon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_tool4Icon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_tool4Icon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_tool4Icon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_tool4Icon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_tool4Icon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_tool4Icon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_tool4Icon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_tool4Icon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_tool4Icon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_tool4Icon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_tool4Icon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_tool4Icon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_tool4Icon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_tool4Icon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_tool4Icon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_tool4Icon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_tool4Icon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_tool4Icon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_tool4Icon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_tool4Icon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_tool4Icon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_tool4Icon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_tool4Icon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_tool4Icon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_tool4Icon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_tool4Icon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_tool4Icon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_tool4Icon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_tool4Icon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_tool4Icon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_tool4Icon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_tool4Icon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_tool4Icon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_tool4Icon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_tool4Icon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_tool4Icon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_tool4Icon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_tool4Icon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_tool4Icon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_tool4Icon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_tool4Icon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_tool4Icon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_tool4Icon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_tool4Icon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_tool4Icon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_tool4Icon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_tool4Icon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_tool4Icon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_tool4Icon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_tool4Icon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_tool4Icon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_tool4Icon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_tool4Icon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_tool4Icon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_tool4Icon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_tool4Icon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_tool4Icon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_tool4Icon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_tool4Icon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_tool4Icon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_tool4Icon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_tool4Icon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_tool4Icon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_tool4Icon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_tool4Icon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_tool4Icon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>

	<!-- Tool4 Icon selection end -->


	</label>

	</div> 
	</div>
	</div>
	<!-- Tool4 selector end -->


	<!-- Special1 selector -->
	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_special1Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">
	<input id="select-special1" class="toolSelector" type="checkbox" name="attr_toolSelect" value="special1">
	<label for="select-special1" class="skillSelectionLabel">

	<div class="type-image skillIcon skillSpecial"></div>

	</label>

	</div> 
	</div>
	<!-- Special1 selector end -->

	<!-- Special2 selector -->
	<div>
	<input type="checkbox" class="hide-toggle-rev" name="attr_special2Name" value="" hidden="true" checked>
	<div class="toolSelectHolder hide-item-rev">
	<input id="select-special2" class="toolSelector" type="checkbox" name="attr_toolSelect" value="special2">
	<label for="select-special2" class="skillSelectionLabel">

	<div class="type-image skillIcon skillSpecial"></div>

	</label>

	</div> 
	</div>
	<!-- Special2 selector end -->



	</div>
	<!-- Tool selector Box end -->

	</div>

	</div>
	<!-- Action Palette END -->

	<!-- Def Palette -->
	<div class="rowContainer columnAlign half">
	<div class="rowContainer outfit paletteButton" style="justify-content: flex-start;">

		<div class="iconHolder">
		<div class="type-image typeIcon defend"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">

			<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_defRoll1" placeholder="1" value="(@{defDice1} + @{selectDefDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_defRoll2" placeholder="6" value="(@{defDice2} + @{selectDefDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_defRoll3" placeholder="0" value="(@{defDice3}+@{defPower}+@{selectDefDice3}+@{Endurance}-@{Disarm}+@{difficulty})" disabled="true">
	</div>



	<button type="action" class="NDice" id="autoroll_def" name="act_rollCombat"></button>		
		</div>

	<!-- EGO (Def) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_egoActiveState" value="true">
	<div class="hide-item">

		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Outfit">
		<div class="hide-item">
	
		<div class="rowContainer egoDefPalette paletteButton" style="justify-content: flex-start;">
		<div class="iconHolder">
		<div class="type-image typeIcon egoDef"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">
	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_egoDefRoll1" placeholder="1" value="(@{egoDefDice1} + @{selectDefDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_egoDefRoll2" placeholder="6" value="(@{egoDefDice2} + @{selectDefDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_egoDefRoll3" placeholder="0" value="(@{egoDefDice3}+@{defPower}+@{selectDefDice3}+@{Endurance}-@{Disarm}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_egoDef" name="act_rollCombat"></button>			
		</div>

	</div></div></div></div>
	<!-- EGO (Def) Palette END -->

	<!-- Distort (Def) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">
	
		<div class="rowContainer egoDefPalette paletteButton" style="justify-content: flex-start;">
		<div class="iconHolder">
		<div class="type-image typeIcon egoDef"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">
	<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_distortDefRoll1" placeholder="1" value="(@{defDice1} + @{distortDefDice1} + @{selectDefDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_distortDefRoll2" placeholder="6" value="(@{defDice2} + @{distortDefDice2} + @{selectDefDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_distortDefRoll3" placeholder="0" value="(@{defDice3}+@{distortDefDice3}+@{defPower}+@{selectDefDice3}+@{Endurance}-@{Disarm}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_def_distort" name="act_rollCombat"></button>			
		</div>

	</div>

	</div></div>
	<!-- Distort (Def) Palette END -->




	</div>
              

	<!-- Defend Palette END -->

	<!-- Evade Palette -->
	<div class="rowContainer STGR paletteButton" style="justify-content: flex-start;">

		<div class="iconHolder">
		<div class="type-image typeIcon evade"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">
		<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_evdRoll1" placeholder="1" value="(@{evdDice1} + @{selectEvdDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_evdRoll2" placeholder="6" value="(@{evdDice2} + @{selectEvdDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_evdRoll3" placeholder="0" value="(@{evdDice3}+@{evdPower}+@{evdPositive}-@{evdNegative}+@{selectEvdDice3}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_evd" name="act_rollCombat"></button>			
		</div>

	<!-- EGO (Evd) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_egoActiveState" value="true">
	<div class="hide-item">

		<input type="checkbox" class="hide-toggle" name="attr_egoType" value="Outfit">
		<div class="hide-item">
	

<div class="rowContainer egoEvdPalette paletteButton" style="justify-content: flex-start;">

		<div class="iconHolder">
		<div class="type-image typeIcon egoEvd"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">
		<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_egoEvdRoll1" placeholder="1" value="(@{egoEvdDice1} + @{selectEvdDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_egoEvdRoll2" placeholder="6" value="(@{egoEvdDice2} + @{selectEvdDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_egoEvdRoll3" placeholder="0" value="(@{egoEvdDice3}+@{evdPower}+@{evdPositive}-@{evdNegative}+@{selectEvdDice3}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_egoEvd" name="act_rollCombat"></button>			
		</div>

	</div>

		</div></div></div>

	<!-- EGO (Evd) Palette END -->

	<!-- Distort (Evd) Palette -->
	<div class="paletteOverride">

	<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
	<div class="hide-item">

<div class="rowContainer egoEvdPalette paletteButton" style="justify-content: flex-start;">

		<div class="iconHolder">
		<div class="type-image typeIcon egoEvd"></div>
		</div>

		<div class="rowContainer" style="width: 100%; position: absolute; top: 0; left: -2px;">
		<div class="rowContainer darkInput paletteDice">
			<input type="text" name="attr_distortEvdRoll1" placeholder="1" value="(@{evdDice1} + @{distortEvdDice1} + @{selectEvdDice1})" disabled="true">
			<div class="plainText">D</div>
			<input type="text" name="attr_distortEvdRoll2" placeholder="6" value="(@{evdDice2} + @{distortEvdDice2} + @{selectEvdDice2})" disabled="true">
			<div class="plainText">+</div>
			<input type="text" name="attr_distortEvdRoll3" placeholder="0" value="(@{evdDice3}+@{distortEvdDice3}+@{evdPower}+@{evdPositive}-@{evdNegative}+@{selectEvdDice3}+@{difficulty})" disabled="true">
	</div>

<button type="action" class="NDice" id="autoroll_evd_distort" name="act_rollCombat"></button>			
		</div>

	</div>

		</div></div></div>
	<!-- Distort (Evd) Palette END -->




		</div>
	<!-- Evade Palette END -->
              
	</div>
<!-- Def/Evd section END -->


	<div class="skillSelect">

<!-- Skill palette selection area (normal) -->

<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true" hidden="true" checked>
<div class="hide-item-rev" style="width: 100%;">

<div class="rowContainer centerFlex" style="width: 100%; flex-wrap: wrap; margin-top: 5px;">

<!-- EGO Skill 1 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill1Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill1" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill1">
	<label for="select-egoSkill1" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill1Name" data-i18n-placeholder="palette-egoskill1-name" placeholder="MYS Skill (1)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill1Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill1Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill1Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill1Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill1Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill1Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 1 block END -->

<!-- Skill 1 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill1Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill1" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill1">
	<label for="select-skill1" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill1Name" data-i18n-placeholder="palette-skill1-name" placeholder="Skill (1)">
	</div>


<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill1Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill1Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill1Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill1Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill1Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill1Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 1 block END -->

<!-- EGO Skill 2 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill2Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill2" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill2">
	<label for="select-egoSkill2" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill2Name" data-i18n-placeholder="palette-egoskill2-name" placeholder="MYS Skill (2)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill2Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill2Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill2Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill2Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill2Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill2Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 2 block END -->

<!-- Skill 2 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill2Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill2" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill2">
	<label for="select-skill2" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill2Name" data-i18n-placeholder="palette-skill2-name" placeholder="Skill (2)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill2Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill2Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill2Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill2Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill2Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill2Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 2 block END -->

<!-- EGO Skill 3 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill3Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill3" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill3">
	<label for="select-egoSkill3" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill3Name" data-i18n-placeholder="palette-egoskill3-name" placeholder="MYS Skill (3)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill3Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill3Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill3Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill3Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill3Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill3Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 3 block END -->


<!-- Skill 3 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill3Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill3" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill3">
	<label for="select-skill3" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill3Name" data-i18n-placeholder="palette-skill3-name" placeholder="Skill (3)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill3Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill3Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill3Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill3Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill3Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill3Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 3 block END -->

<!-- EGO Skill 4 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill4Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill4" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill4">
	<label for="select-egoSkill4" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill4Name" data-i18n-placeholder="palette-egoskill4-name" placeholder="MYS Skill (4)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill4Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill4Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill4Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill4Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill4Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill4Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 4 block END -->

<!-- Skill 4 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill4Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill4" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill4">
	<label for="select-skill4" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill4Name" data-i18n-placeholder="palette-skill4-name" placeholder="Skill (4)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill4Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill4Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill4Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill4Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill4Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill4Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 4 block END -->

<!-- EGO Skill 5 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill5Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill5" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill5">
	<label for="select-egoSkill5" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill5Name" data-i18n-placeholder="palette-egoskill5-name" placeholder="MYS Skill (5)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill5Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill5Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill5Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill5Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill5Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill5Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 5 block END -->

<!-- Skill 5 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill5Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill5" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill5">
	<label for="select-skill5" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill5Name" data-i18n-placeholder="palette-skill5-name" placeholder="Skill (5)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill5Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill5Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill5Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill5Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill5Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill5Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 5 block END -->

<!-- EGO Skill 6 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoActiveState" value="0" hidden="true" checked>
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill6Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill6" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill6">
	<label for="select-egoSkill6" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill6Name" data-i18n-placeholder="palette-egoskill6-name" placeholder="MYS Skill (6)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill6Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill6Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill6Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill6Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill6Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill6Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 6 block END -->

<!-- Skill 6 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill6Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill6" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill6">
	<label for="select-skill6" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill6Name" data-i18n-placeholder="palette-skill6-name" placeholder="Skill (6)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill6Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill6Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill6Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill6Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill6Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill6Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 6 block END -->

    
</div>	</div> <!-- Skill palette END -->


<!-- Skill palette selection area (Distortion) -->

<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true" hidden="true" checked>
<div class="hide-item" style="width: 100%;">

<div class="rowContainer centerFlex" style="width: 100%; flex-wrap: wrap; margin-top: 5px;">

<!-- EGO Skill 1 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill1Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill1" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill1">
	<label for="select-egoSkill1" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill1Name" data-i18n-placeholder="palette-egoskill1-name" placeholder="MYS Skill (1)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill1Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill1Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill1Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill1Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill1Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill1Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 1 block END -->

<!-- Skill 1 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill1Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill1" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill1">
	<label for="select-skill1" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill1Name" data-i18n-placeholder="palette-skill1-name" placeholder="Skill (1)">
	</div>


<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill1Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill1Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill1Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill1Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill1Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill1Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 1 block END -->

<!-- EGO Skill 2 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill2Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill2" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill2">
	<label for="select-egoSkill2" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill2Name" data-i18n-placeholder="palette-egoskill2-name" placeholder="MYS Skill (2)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill2Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill2Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill2Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill2Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill2Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill2Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 2 block END -->

<!-- Skill 2 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill2Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill2" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill2">
	<label for="select-skill2" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill2Name" data-i18n-placeholder="palette-skill2-name" placeholder="Skill (2)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill2Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill2Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill2Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill2Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill2Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill2Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 2 block END -->

<!-- EGO Skill 3 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill3Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill3" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill3">
	<label for="select-egoSkill3" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill3Name" data-i18n-placeholder="palette-egoskill3-name" placeholder="MYS Skill (3)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill3Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill3Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill3Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill3Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill3Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill3Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 3 block END -->


<!-- Skill 3 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill3Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill3" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill3">
	<label for="select-skill3" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill3Name" data-i18n-placeholder="palette-skill3-name" placeholder="Skill (3)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill3Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill3Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill3Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill3Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill3Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill3Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 3 block END -->

<!-- EGO Skill 4 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill4Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill4" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill4">
	<label for="select-egoSkill4" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill4Name" data-i18n-placeholder="palette-egoskill4-name" placeholder="MYS Skill (4)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill4Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill4Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill4Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill4Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill4Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill4Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 4 block END -->

<!-- Skill 4 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill4Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill4" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill4">
	<label for="select-skill4" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill4Name" data-i18n-placeholder="palette-skill4-name" placeholder="Skill (4)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill4Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill4Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill4Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill4Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill4Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill4Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 4 block END -->

<!-- EGO Skill 5 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill5Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill5" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill5">
	<label for="select-egoSkill5" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill5Name" data-i18n-placeholder="palette-egoskill5-name" placeholder="MYS Skill (5)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill5Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill5Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill5Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill5Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill5Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill5Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 5 block END -->

<!-- Skill 5 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill5Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill5" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill5">
	<label for="select-skill5" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill5Name" data-i18n-placeholder="palette-skill5-name" placeholder="Skill (5)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill5Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill5Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill5Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill5Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill5Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill5Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 5 block END -->

<!-- EGO Skill 6 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_egoSkill6Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-egoSkill6" class="skillSelector" type="checkbox" name="attr_skillSelect" value="egoSkill6">
	<label for="select-egoSkill6" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_egoSkill6Name" data-i18n-placeholder="palette-egoskill6-name" placeholder="MYS Skill (6)">
	</div>

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill6Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill6Type"><div class="skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill6Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill6Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill6Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill6Type"><div class="type-image skillIcon skillMass"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- EGO Skill 6 block END -->

<!-- Skill 6 Palette -->
<div class="skillBuffer">
<input type="checkbox" class="hide-toggle-rev" name="attr_skill6Type" value="None" hidden="true" checked>
	<div class="hide-item-rev skillhide">
	<div class="rowContainer paletteButton skillSelectionElement" style="width: 100%;">

	<input id="select-skill6" class="skillSelector" type="checkbox" name="attr_skillSelect" value="skill6">
	<label for="select-skill6" class="skillSelectionLabel" style="width: 100%;">
	<div class="skillWrap">

	<div style="position: relative;">
	<div class="blocker"></div>
	<input type="text" class="combatPaletteName skillSelectionName" name="attr_skill6Name" data-i18n-placeholder="palette-skill6-name" placeholder="Skill (6)">
	</div>

<div class="iconHolder">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill6Type"><div class="skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill6Type"><div class="skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill6Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill6Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill6Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill6Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

	</div>

	</div>

	</label>
	</div>
	</div>
</div>
<!-- Skill 6 block END -->

    
</div>	</div> <!-- Skill palette END -->



	</div> <!-- Skill section end -->






<!-- Skill data viewer -->
<div class="rowContainer contentContainer centerFlex" style="width: 100%;">
<input class="text" name="attr_selectName" value="" hidden="true">
<input class="text" name="attr_selectType" value="" hidden="true">
<input class="text" name="attr_selectRank" value="0" hidden="true">
<input class="text" name="attr_selectLight" value="0" hidden="true">
<input class="text" name="attr_selectDescription" value="" hidden="true">
<input class="text" name="attr_selectEffect" value="" hidden="true">

<input class="text" name="attr_selectAtkDice1" value="0" hidden="true">
<input class="text" name="attr_selectAtkDice2" value="0" hidden="true">
<input class="text" name="attr_selectAtkDice3" value="0" hidden="true">

<input type="text" name="attr_selectDefDice1" value="0" hidden="true">
<input type="text" name="attr_selectDefDice2" value="0" hidden="true">
<input type="text" name="attr_selectDefDice3" value="0" hidden="true">

<input type="text" name="attr_selectEvdDice1" value="0" hidden="true">
<input type="text" name="attr_selectEvdDice2" value="0" hidden="true">
<input type="text" name="attr_selectEvdDice3" value="0" hidden="true">

<input type="text" name="attr_selectDice1" value="0" hidden="true">
<input type="text" name="attr_selectDice2" value="0" hidden="true">
<input type="text" name="attr_selectDice3" value="0" hidden="true">

<input type="checkbox" class="hide-toggle-rev" name="attr_skillSelect" value="0" checked>
<div class="hide-item-rev contentContainer darkBG" style="width: 100%;">

<div class="rowContainer titleHeader">

<div style="position: absolute; left: 0px;" class="half">
<div class="blocker"></div>
<input type="text" class="transpInput viewerName" name="attr_selectName" data-i18n-placeholder="skill-name" placeholder="Skill name" value="" style="width: 100%;">
</div>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill" style="position: absolute; right: 30px;">
<div class="blocker"></div>
		<input type="text" class="diceNum" name="attr_selectDice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_selectDice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_selectDice3" placeholder="0" value="0">
		</div>

<div class="lightCost" style="position: absolute; top: 2px; right: 0px;" data-i18n-title="skill-light-cost" title="Light Cost">
<div class="blocker"></div>
<input type="text" class="lightCostInput" style="margin: 0px !important; padding: 0px !important;" name="attr_selectLight">

</div>

	</div>


	<div class="rowContainer weaponInfo" style="overflow: hidden; border-radius: 3px;">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_selectDescription" class="augmentDescriptionInput noHover" data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_selectEffect" class="weaponEffectInput noHover" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div> 

<div>
<input type="checkbox" class="hide-toggle" name="attr_selectCancel" value="true">
<div class="hide-item LIGHTtext" style="position: absolute; top: 0px; left: 0px; background-color: rgba(0,0,0,0.65); height: 100%; width: 100%; padding-top: 45px;">
<b data-i18n="viewer-light-warning">NOT ENOUGH LIGHT</b>
	</div>
	</div>

	</div>

	</div>
</div>
<!-- Skill data viewer END -->

</div> <!-- skill section REALLY end -->


            </div>
        </div>

</div>
</div>
</div>

<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="equipment">
<div class="toggleButtons">


<button type="action" id="exportButton" name="act_export" data-i18n="tabs-export">Export/Import</button>
<button type="action" id="detailsButton" name="act_details" data-i18n="tabs-character">Character Details</button>
<button type="action" id="equipmentButton" name="act_equipment" data-i18n="tabs-equipment">Equipment</button>
<button type="action" id="skillsButton" name="act_skills" data-i18n="tabs-skills">Skills</button>

<input type="checkbox" class="hide-toggle" name="attr_global_editMode" value="0" hidden="true" checked>
<button type="action" class="hide-item-rev" id="editButton" name="act_edit" style="position:relative;">
<span data-i18n="tabs-edit">Editor</span> 
</button>


</div>


<!-- Equipment section -->
	<div class="sheet-body sheet-equipment darkBG">

	<!-- EGO uses dummy -->
	<input type="text" name="attr_egoUses" value="5" hidden="true">

        <div class="contentBlock" id="equipmentSection">
				<div class="weaponContainer">
               
<!-- Weapon1 block -->
<div class="contentContainer">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_weapon1" name="act_shareWeapon" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="weapon1AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_weapon1AutoScript" hidden="true">

	<!-- Weapon 1 header -->
	<div class="sectionHeader weapon">


	<input type="text" class="weaponRank" name="attr_weapon1Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="transpInput contentName" name="attr_weapon1Name" data-i18n-placeholder="equip-weapon1-name" placeholder="Weapon Name (1)">

	<!-- Weapon dice roll block -->
	<div class="rowContainer combatDice">

	<!-- Weapon1 Uses indicator -->
	<div class="buffer" style="width: 30px; height: 30px;">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon1UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon1Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon1UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  

		</div>

	</div>
	<!-- Weapon1 Uses indicator END -->

<div class="weaponIcons">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon1Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon1Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon1Type"><div class="type-image typeIcon blunt"></div>
		</div>
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_weapon1Dice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_weapon1Dice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_weapon1Dice3" placeholder="0" value="0">
		</div>

	<div>
             
	<button type="action" class="NDice" id="autoroll_weapon1_raw" name="act_rollCombat"></button>

	</div>
	<!-- dice roll end -->

	</div></div>
	<!-- header end -->

	<!-- Weapon1 Edit-->
<div>
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle">
	<div class="settingStyle" style="width: 60px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_weapon1Uses" value="5"> / 
	<input type="number" class="darkInput" name="attr_weapon1Uses_max" value="5" min="1">
	<select name="attr_weapon1UseType" class="darkInput" style="width: 70px; margin-left: 5px;">
		<option data-i18n="uses-nolimit" value="Limitless" selected>No limit</option>
		<option data-i18n="uses-reload" value="Reload">Reload</option>
		<option data-i18n="uses-deplete" value="Deplete">Deplete</option>
	</select>

	</div>

</div>
</div>
	<!-- Weapon1 Edit end -->

	<div class="weaponPropertySelect weapon"> 

	<select name="attr_weapon1Type" class="weapon_type">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Slash" value="Slash">Slash</option>
         <option data-i18n="weapon-type-Pierce" value="Pierce">Pierce</option>
	 <option data-i18n="weapon-type-Blunt" value="Blunt">Blunt</option>
         </select>


	<select name="attr_weapon1Range" class="weapon_distance">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Melee" value="Melee">Melee</option>
         <option data-i18n="weapon-type-Ranged" value="Ranged">Ranged</option>
         </select>

	</div>

	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
	<div class="descHead"></div>
       <textarea spellcheck="false"  name="attr_weapon1Description" class="weaponDescriptionInput" data-i18n-placeholder="weapon-desc" placeholder="Weapon description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_weapon1Effect" class="weaponEffectInput" data-i18n-placeholder="weapon-effect" placeholder="Weapon effects."></textarea>
        </div>

	</div>
	<!-- desc end -->	

	</div>
<!-- Weapon 1 Block END -->

<!-- Weapon2 block -->
<div class="contentContainer" style="margin-top: 8px;">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_weapon2" name="act_shareWeapon" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="weapon2AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_weapon2AutoScript" hidden="true">

	<!-- Weapon2 header -->
	<div class="sectionHeader weapon">


	<input type="text" class="weaponRank" name="attr_weapon2Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="transpInput contentName" name="attr_weapon2Name" data-i18n-placeholder="equip-weapon2-name" placeholder="Weapon Name (2)">

	<!-- Weapon dice roll block -->
	<div class="rowContainer combatDice">

	<!-- Weapon2 Uses indicator -->
	<div class="buffer" style="width: 30px; height: 30px;">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon2UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon2Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon2UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  

		</div>

	</div>
	<!-- Weapon2 Uses indicator END -->

<div class="weaponIcons">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon2Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon2Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon2Type"><div class="type-image typeIcon blunt"></div>
		</div>
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_weapon2Dice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_weapon2Dice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_weapon2Dice3" placeholder="0" value="0">
		</div>

	<div>
             
	<button type="action" class="NDice" id="autoroll_weapon2_raw" name="act_rollCombat"></button>

	</div>
	<!-- dice roll end -->

	</div></div>
	<!-- header end -->

	<!-- Weapon2 Edit-->
<div>
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle">
	<div class="settingStyle" style="width: 60px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_weapon2Uses" value="5"> / 
	<input type="number" class="darkInput" name="attr_weapon2Uses_max" value="5" min="1">
	<select name="attr_weapon2UseType" class="darkInput" style="width: 70px; margin-left: 5px;">
		<option data-i18n="uses-nolimit" value="Limitless" selected>No limit</option>
		<option data-i18n="uses-reload" value="Reload">Reload</option>
		<option data-i18n="uses-deplete" value="Deplete">Deplete</option>
	</select>

	</div>

</div>
</div>

	<!-- Weapon2 Edit end -->

	<div class="weaponPropertySelect weapon"> 

	<select name="attr_weapon2Type" class="weapon_type">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Slash" value="Slash">Slash</option>
         <option data-i18n="weapon-type-Pierce" value="Pierce">Pierce</option>
	 <option data-i18n="weapon-type-Blunt" value="Blunt">Blunt</option>
         </select>


	<select name="attr_weapon2Range" class="weapon_distance">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Melee" value="Melee">Melee</option>
         <option data-i18n="weapon-type-Ranged" value="Ranged">Ranged</option>
         </select>

	</div>

	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
	<div class="descHead"></div>
       <textarea spellcheck="false"  name="attr_weapon2Description" class="weaponDescriptionInput" data-i18n-placeholder="weapon-desc" placeholder="Weapon description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_weapon2Effect" class="weaponEffectInput" data-i18n-placeholder="weapon-effect" placeholder="Weapon effects."></textarea>
        </div>

	</div>
	<!-- desc end -->	

	</div>
<!-- Weapon2 Block END -->

<!-- !!EXTRA!! Weapons area -->
<input type="checkbox" class="hide-toggle" name="attr_settingExtraEquip" value="true">
<div class="hide-item">

<!-- Weapon3 block -->
<div class="contentContainer" style="margin-top: 8px;">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_weapon3" name="act_shareWeapon" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="weapon3AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_weapon3AutoScript" hidden="true">

	<!-- Weapon3 header -->
	<div class="sectionHeader weapon">


	<input type="text" class="weaponRank" name="attr_weapon3Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="transpInput contentName" name="attr_weapon3Name" data-i18n-placeholder="equip-weapon3-name" placeholder="Weapon Name (3)">

	<!-- Weapon dice roll block -->
	<div class="rowContainer combatDice">

	<!-- Weapon3 Uses indicator -->
	<div class="buffer" style="width: 30px; height: 30px;">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon3UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon3Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon3UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  

		</div>

	</div>
	<!-- Weapon3 Uses indicator END -->

<div class="weaponIcons">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon3Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon3Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon3Type"><div class="type-image typeIcon blunt"></div>
		</div>
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_weapon3Dice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_weapon3Dice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_weapon3Dice3" placeholder="0" value="0">
		</div>

	<div>
             
	<button type="action" class="NDice" id="autoroll_weapon3_raw" name="act_rollCombat"></button>

	</div>
	<!-- dice roll end -->

	</div></div>
	<!-- header end -->

	<!-- Weapon3 Edit-->
<div>
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle">
	<div class="settingStyle" style="width: 60px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_weapon3Uses" value="5"> / 
	<input type="number" class="darkInput" name="attr_weapon3Uses_max" value="5" min="1">
	<select name="attr_weapon3UseType" class="darkInput" style="width: 70px; margin-left: 5px;">
		<option data-i18n="uses-nolimit" value="Limitless" selected>No limit</option>
		<option data-i18n="uses-reload" value="Reload">Reload</option>
		<option data-i18n="uses-deplete" value="Deplete">Deplete</option>
	</select>

	</div>

</div>
</div>

	<!-- Weapon3 Edit end -->

	<div class="weaponPropertySelect weapon"> 

	<select name="attr_weapon3Type" class="weapon_type">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Slash" value="Slash">Slash</option>
         <option data-i18n="weapon-type-Pierce" value="Pierce">Pierce</option>
	 <option data-i18n="weapon-type-Blunt" value="Blunt">Blunt</option>
         </select>


	<select name="attr_weapon3Range" class="weapon_distance">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Melee" value="Melee">Melee</option>
         <option data-i18n="weapon-type-Ranged" value="Ranged">Ranged</option>
         </select>

	</div>

	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
	<div class="descHead"></div>
       <textarea spellcheck="false"  name="attr_weapon3Description" class="weaponDescriptionInput" data-i18n-placeholder="weapon-desc" placeholder="Weapon description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_weapon3Effect" class="weaponEffectInput" data-i18n-placeholder="weapon-effect" placeholder="Weapon effects."></textarea>
        </div>

	</div>
	<!-- desc end -->	

	</div>
<!-- Weapon3 Block END -->

<!-- Weapon4 block -->
<div class="contentContainer" style="margin-top: 8px;">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_weapon4" name="act_shareWeapon" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="weapon4AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_weapon4AutoScript" hidden="true">

	<!-- Weapon4 header -->
	<div class="sectionHeader weapon">


	<input type="text" class="weaponRank" name="attr_weapon4Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="transpInput contentName" name="attr_weapon4Name" data-i18n-placeholder="equip-weapon4-name" placeholder="Weapon Name (4)">

	<!-- Weapon dice roll block -->
	<div class="rowContainer combatDice">

	<!-- Weapon4 Uses indicator -->
	<div class="buffer" style="width: 30px; height: 30px;">
	<input type="checkbox" class="hide-toggle-rev" name="attr_weapon4UseType" value="Limitless" hidden="true" checked>
		<div class="hide-item-rev rowContainer centerFlex" style="position: relative;">

		<input type="text" class="transpInput blocker" name="attr_weapon4Uses" style="text-align: center; height: 100%;" value="5">

		<input type="checkbox" class="fade-toggle" name="attr_weapon4UseType" value="Deplete" hidden="true">
		<div class="fade-item reusableIcon" style="width: 30px; height: 30px;"></div>  

		</div>

	</div>
	<!-- Weapon4 Uses indicator END -->

<div class="weaponIcons">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Slash" name="attr_weapon4Type"><div class="type-image typeIcon slash"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Pierce" name="attr_weapon4Type"><div class="type-image typeIcon pierce"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Blunt" name="attr_weapon4Type"><div class="type-image typeIcon blunt"></div>
		</div>
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_weapon4Dice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_weapon4Dice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_weapon4Dice3" placeholder="0" value="0">
		</div>

	<div>
             
	<button type="action" class="NDice" id="autoroll_weapon4_raw" name="act_rollCombat"></button>

	</div>
	<!-- dice roll end -->

	</div></div>
	<!-- header end -->

	<!-- Weapon4 Edit-->
<div>
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle">
	<div class="settingStyle" style="width: 60px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_weapon4Uses" value="5"> / 
	<input type="number" class="darkInput" name="attr_weapon4Uses_max" value="5" min="1">
	<select name="attr_weapon4UseType" class="darkInput" style="width: 70px; margin-left: 5px;">
		<option data-i18n="uses-nolimit" value="Limitless" selected>No limit</option>
		<option data-i18n="uses-reload" value="Reload">Reload</option>
		<option data-i18n="uses-deplete" value="Deplete">Deplete</option>
	</select>

	</div>

</div>
</div>
	<!-- Weapon4 Edit end -->

	<div class="weaponPropertySelect weapon"> 

	<select name="attr_weapon4Type" class="weapon_type">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Slash" value="Slash">Slash</option>
         <option data-i18n="weapon-type-Pierce" value="Pierce">Pierce</option>
	 <option data-i18n="weapon-type-Blunt" value="Blunt">Blunt</option>
         </select>


	<select name="attr_weapon4Range" class="weapon_distance">
 	<option value="None" data-i18n="weapon-type-None">---</option>
         <option data-i18n="weapon-type-Melee" value="Melee">Melee</option>
         <option data-i18n="weapon-type-Ranged" value="Ranged">Ranged</option>
         </select>

	</div>

	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
	<div class="descHead"></div>
       <textarea spellcheck="false"  name="attr_weapon4Description" class="weaponDescriptionInput" data-i18n-placeholder="weapon-desc" placeholder="Weapon description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_weapon4Effect" class="weaponEffectInput" data-i18n-placeholder="weapon-effect" placeholder="Weapon effects."></textarea>
        </div>

	</div>
	<!-- desc end -->	

	</div>
<!-- Weapon4 Block END -->

</div>
<!-- !!EXTRA!! Weapons end -->

<!-- Augmentation block -->
	<div class="augmentBlock">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" name="act_shareAugment" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput autoScriptButton" id="augmentAutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_augmentAutoScript" hidden="true">

	<!-- Augment header -->
	<div class="sectionHeader augment rowContainer" id="augment-name">
	<input type="text" class="augmentRank" name="attr_augmentRank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="transpInput contentName" name="attr_augmentName" data-i18n-placeholder="augment-name" placeholder="Augmentation name">

        <select name="attr_augmentType" class="darkInput contentName topRight">
	<option data-i18n="augment-type-None" value="None">---</option>
	<option data-i18n="augment-type-Tattoos" value="Tattoos">Tattoos</option>
	<option data-i18n="augment-type-Drugs" value="Drugs">Serums/Drugs</option>
	<option data-i18n="augment-type-Surgery" value="Surgery">Surgery</option>
	<option data-i18n="augment-type-Prosthesis" value="Prosthesis">Prosthesis</option>
	<option data-i18n="augment-type-FullProsthesis" value="FullProsthesis">Full Prosthesis</option>
	<option data-i18n="augment-type-Other" value="Other">Other</option>
        </select>

	</div>

	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_augmentDescription" class="augmentDescriptionInput" data-i18n-placeholder="augment-desc" placeholder="Augment description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_augmentEffect" class="weaponEffectInput" data-i18n-placeholder="augment-effect" placeholder="Augment effects."></textarea>
        </div>

	</div>
	<!-- desc end -->	

	</div>

<!-- Augmentation block - END -->

                </div>
<!-- Weapon section END -->

<!-- Outfit / Other equipment section -->
<div class="rowContainer" style="max-width: 600px; flex-wrap: wrap;">
<div class="outfitContainer">

<!-- Outfit block -->
<div class="contentContainer">
<div>

<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideShare" value="true">
<div class="hide-item-rev" style="position: absolute; bottom: 0px; right: 0px;">

<button type="action" class="darkInput shareButton" name="act_shareOutfit" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="outfitAutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_outfitAutoScript" hidden="true">
</div>

<!-- Outfit Burn/Bleed/Damage Resist -->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="editCover hide-item">

<div class="columnAlign">
<div class="rowContainer">
<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_burnResist" value="0" hidden="true">

        <div class="ailmentIconSelector status_effect_item centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon burn"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	</div>

        <div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_burnResist" value="0"></div>
</div>

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_bleedResist" value="0" hidden="true">

        <div class="ailmentIconSelector status_effect_item rowContainer centerFlex">
	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon bleed"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	</div>

       <div class="status_effect_value"><input type="number"  class="ailmentNum" name="attr_bleedResist" value="0"></div>
	</div>

<div class="rowContainer">
<input type="checkbox" class="fade-toggle" name="attr_damageResist" value="0" hidden="true">

	<div class="ailmentIconSelector status_effect_item rowContainer centerFlex">
		<div class="icon">
			<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_settingLimbusStyle"><div class="hide-item-rev skillIcon damageResist"></div>
		</div>

		<div class="icon">
			<input type="checkbox" class="expand-toggle" value="true" name="attr_settingLimbusStyle"><div class="type-image skillIcon damageResist-limbus"></div>
		</div>
	</div>
	
	<div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_damageResist" value="0"></div>
</div>

</div>
<!-- Outfit Custom Ailment Resistances -->
<div class="outfitCustomResistDisplay">
	<fieldset class="repeating_ailments">
		<input type="checkbox" class="hide-toggle" name="attr_ailCustomResistance" hidden="true" value="true">
		<div class="rowContainer hide-item">
			<input type="checkbox" class="fade-toggle" name="attr_ailCustomResistanceNum" value="0" hidden="true">
			<div class="status_effect_item rowContainer centerFlex">
				<!-- Icon selector -->
				<div class="ailmentIconSelector rowContainer centerFlex">
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Question" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="0" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Burn" name="attr_ailIcon"><div class="type-image skillIcon burn"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Charge" name="attr_ailIcon"><div class="type-image skillIcon charge"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Protection" name="attr_ailIcon"><div class="type-image skillIcon protection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Strength" name="attr_ailIcon"><div class="type-image skillIcon strength"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Haste" name="attr_ailIcon"><div class="type-image skillIcon haste"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Bind" name="attr_ailIcon"><div class="type-image skillIcon bind"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Panic" name="attr_ailIcon"><div class="type-image skillIcon panic"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile"></div>
					</div>
				
				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_ailIcon"><div class="type-image skillIcon burn-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_ailIcon"><div class="type-image skillIcon charge-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_ailIcon"><div class="type-image skillIcon protection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_ailIcon"><div class="type-image skillIcon strength-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_ailIcon"><div class="type-image skillIcon haste-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_ailIcon"><div class="type-image skillIcon bind-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus-blue"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_ailIcon"><div class="type-image skillIcon rupture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_ailIcon"><div class="type-image skillIcon tremor-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_ailIcon"><div class="type-image skillIcon tremorchain-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_ailIcon"><div class="type-image skillIcon tremordecay-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_ailIcon"><div class="type-image skillIcon tremordistribution-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_ailIcon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_ailIcon"><div class="type-image skillIcon tremorfracture-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_ailIcon"><div class="type-image skillIcon tremorreverb-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_ailIcon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_ailIcon"><div class="type-image skillIcon sinking-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_ailIcon"><div class="type-image skillIcon poise-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_ailIcon"><div class="type-image skillIcon frostbite-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_ailIcon"><div class="type-image skillIcon poison-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_ailIcon"><div class="type-image skillIcon nails-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_ailIcon"><div class="type-image skillIcon ruin-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_ailIcon"><div class="type-image skillIcon devastation-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_ailIcon"><div class="type-image skillIcon critical-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_ailIcon"><div class="type-image skillIcon aggro-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_ailIcon"><div class="type-image skillIcon ammo-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_ailIcon"><div class="type-image skillIcon bullseye-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_ailIcon"><div class="type-image skillIcon barrier-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_ailIcon"><div class="type-image skillIcon duel-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus-green"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_ailIcon"><div class="type-image skillIcon heal-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_ailIcon"><div class="type-image skillIcon kampule-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_ailIcon"><div class="type-image skillIcon ttime-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_ailIcon"><div class="type-image skillIcon rottingskin-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="Blood" name="attr_ailIcon"><div class="type-image skillIcon blood"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_ailIcon"><div class="type-image skillIcon slashprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_ailIcon"><div class="type-image skillIcon pierceprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_ailIcon"><div class="type-image skillIcon bluntprotection-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_ailIcon"><div class="type-image skillIcon slashfragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_ailIcon"><div class="type-image skillIcon piercefragility-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_ailIcon"><div class="type-image skillIcon bluntfragility-limbus"></div>
					</div>
				
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_ailIcon"><div class="type-image skillIcon wrath-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_ailIcon"><div class="type-image skillIcon lust-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_ailIcon"><div class="type-image skillIcon sloth-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_ailIcon"><div class="type-image skillIcon gluttony-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_ailIcon"><div class="type-image skillIcon gloom-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_ailIcon"><div class="type-image skillIcon pride-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_ailIcon"><div class="type-image skillIcon envy-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_ailIcon"><div class="type-image skillIcon damageup-limbus"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_ailIcon"><div class="type-image skillIcon damagedown-limbus"></div>
					</div>

					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_ailIcon"><div class="type-image skillIcon style-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_ailIcon"><div class="type-image skillIcon thorns-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_ailIcon"><div class="type-image skillIcon rhythm-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_ailIcon"><div class="type-image skillIcon frenzy-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_ailIcon"><div class="type-image skillIcon shock-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_ailIcon"><div class="type-image skillIcon terror-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_ailIcon"><div class="type-image skillIcon staggerdamageup-community"></div>
					</div>
					<div class="icon">
					<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_ailIcon"><div class="type-image skillIcon staggerdamagedown-community"></div>
					</div>
				</div>
			</div>
			<div class="status_effect_value"><input type="number" class="ailmentNum" name="attr_ailCustomResistanceNum" value="0"></div>
		</div>
	</fieldset>
</div>
</div>
</div>

<!-- Outfit Resistances -->


<!-- Outfit header -->
	<div class="sectionHeader outfit" id="outfit-name">

	<input type="text" class="outfitRank" name="attr_outfitRank" placeholder="0" data-i18n-title="rank" title="Rank">
		<input type="text" class="transpInput contentName" name="attr_outfitName" data-i18n-placeholder="outfit-name" placeholder="Outfit">

	<!-- Outfit dice roll block -->
	<div class="rowContainer combatDice">
	
	<div class="evadeIcon typeIcon defend">
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_defDice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_defDice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_defDice3" value="0">
		</div>

	<div>
              
<button type="action" class="NDice" id="autoroll_def_raw" name="act_rollCombat"></button>

	</div>
	<!-- dice roll end -->

	</div></div>
	<!-- header end -->

	<div class="weaponRangeBox outfit"> 

	<div class="rowContainer combatDice evadeAdjust">

	<div class="evadeIcon typeIcon evade">
	</div>


		<div class="dicerollBlock">
		<input type="text" class="diceNum" name="attr_evdDice1" value="1">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_evdDice2" value="6">
		<div class="plainText">+</div>
		<input type="text" name="attr_evdDice3" value="0">
		</div>

	<div>
              
<button type="action" class="NDice" id="autoroll_evd_raw" name="act_rollCombat"></button>

	</div>

	</div>
	</div>


	<!-- Description/Effect section -->

<div class="rowContainer">

<div class="rowContainer">
	<textarea spellcheck="false"  name="attr_outfitEffect" class="weaponEffectInput" data-i18n-placeholder="outfit-effect" placeholder="Outfit effects."></textarea>

	</div>

<!-- Outfit resistance table -->
	<div class="rowContainer resistanceChart" style="margin-top: 25px">
		<div class="rowContainer centerFlex">

<div id="outfit_res_slash">
		<div class="resIconLeft">
		<div class="resistIcon slashNormal"></div>
		</div>

	</div>

                            <select name="attr_outfitImmune1" id="outfitImmune1" class="outfitResistVal dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_outfitImmune2" id="outfitImmune2" class="outfitResistVal stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

<div id="outfit_res_slashSTG">
		<div class="resIconRight">
		<div class="resistIcon slashNormalSTG"></div>
		</div>

	</div>


		</div>

		<div class="rowContainer centerFlex">


<div id="outfit_res_pierce">
		<div class="resIconLeft">
		<div class="resistIcon pierceNormal"></div>
		</div>


	</div>


                            <select name="attr_outfitImmune3" id="outfitImmune3" class="outfitResistVal dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_outfitImmune4" id="outfitImmune4" class="outfitResistVal stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>


<div id="outfit_res_pierceSTG">
		<div class="resIconRight">
		<div class="resistIcon pierceNormalSTG"></div>
		</div>


	</div>



		</div>

		<div class="rowContainer centerFlex">


<div id="outfit_res_blunt">
		<div class="resIconLeft">
		<div class="resistIcon bluntNormal"></div>
		</div>


	</div>


                            <select name="attr_outfitImmune5" id="outfitImmune5" class="outfitResistVal dmg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

                            <select name="attr_outfitImmune6" id="outfitImmune6" class="outfitResistVal stg">
				<option data-i18n="outfit-res-none" value="" selected disabled hidden>---</option>
                                <option data-i18n="outfit-res-fatal" value="2">[x2]　　　Fatal</option>
                                <option data-i18n="outfit-res-weak" value="1.5">[x1.5]　　Weak</option>
                                <option data-i18n="outfit-res-normal" value="1">[x1]　　　Normal</option>
                                <option data-i18n="outfit-res-endured" value="0.5">[x0.5]　　Endured</option>
                                <option data-i18n="outfit-res-ineffective" value="0.25">[x0.25]　　Ineffective</option>
                                <option data-i18n="outfit-res-immune" value="0">[x0]　　　Immune</option>
                            </select>

<div id="outfit_res_bluntSTG">
		<div class="resIconRight">
		<div class="resistIcon bluntNormalSTG"></div>
		</div>

	</div>


		</div>
</div>
<!-- Resistance chart end -->
</div>

<div class="outfitDescription"><textarea spellcheck="false"  name="attr_outfitDescription" class="outfitDescriptionInput" data-i18n-placeholder="outfit-desc" placeholder="Outfit description."></textarea></div> 


</div>

</div>





	<!-- desc end -->	

	</div>


<!-- Item section -->
<div class="toolContainer">

	<!-- Tool1 block -->
	<div class="contentContainer half" style="margin-right: 8px;">

	<!-- header -->
	<div class="sectionHeader tool rowContainer">
	<input type="text" class="toolRank" name="attr_tool1Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="toolName transpInput" name="attr_tool1Name" data-i18n-placeholder="tool-name" placeholder="Tool name">

	<input type="checkbox" id="attr_tool1Portable" name="attr_tool1Portable" value="Portable"><label for="attr_tool1Portable" class="portableIcon" data-i18n-title="tool-portable" title="Portable"></label> 

	<input type="checkbox" id="attr_tool1Reusable" name="attr_tool1Reusable" value="Reusable"><label for="attr_tool1Reusable" class="reusableIcon" data-i18n-title="tool-reusable" title="Reusable"> 

<div class="rowContainer centerFlex" style="width: 30px; height: 30px;">   
<input type="text" class="transpInput" name="attr_tool1Uses" style="width: 100%; height: 100%; text-align: center;" value="1">
<div class="blocker"></div>  
</div>

</label>

	</div>
	<!-- header end -->
  
	<!-- Tool1 Edit-->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle" style="margin-bottom: 3px;">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-icon">Icon</b>:</div> 
	<input type="text" class="darkInput" list="iconlist" name="attr_tool1Icon" style="width: 149px;" data-i18n-placeholder="message-icon-placeholder" placeholder="Icon selection" value="Hand">
	</div>
	<div class="settingStyle">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_tool1Uses" value="1"> / 
	<input type="number" class="darkInput toolMaxInput" style="width: 32px; margin-left: 2px;" name="attr_tool1Uses_max" value="3" min="1">

	</div>

</div>

	<!-- Tool1 Edit end -->

<div>
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_tool1" name="act_shareTool" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="tool1AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_tool1AutoScript" hidden="true">
</div>


	<!-- Description/Effect section -->

        <div class="toolDescription">
       <textarea spellcheck="false"  name="attr_tool1Description" class="toolDescriptionInput" data-i18n-placeholder="tool-desc" placeholder="Tool description."></textarea>
        </div>

        <div class="itemEffect">
	<textarea spellcheck="false"  name="attr_tool1Effect" class="weaponEffectInput" data-i18n-placeholder="tool-effect" placeholder="Tool effects."></textarea>
        </div>

	<!-- desc end -->	

	</div>
	<!-- Tool1 Block - end -->


	<!-- Tool2 block -->
	<div class="contentContainer half">

	<!-- header -->
	<div class="sectionHeader tool rowContainer">
	<input type="text" class="toolRank" name="attr_tool2Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="toolName transpInput" name="attr_tool2Name" data-i18n-placeholder="tool-name" placeholder="Tool name">

	<input type="checkbox" id="attr_tool2Portable" name="attr_tool2Portable" value="Portable"><label for="attr_tool2Portable" class="portableIcon" title="Portable" data-i18n-title="tool-portable"></label> 

	<input type="checkbox" id="attr_tool2Reusable" name="attr_tool2Reusable" value="Reusable"><label for="attr_tool2Reusable" class="reusableIcon" data-i18n-title="tool-reusable" title="Reusable"> 

<div class="rowContainer centerFlex" style="width: 30px; height: 30px;">   
<input type="text" class="transpInput" name="attr_tool2Uses" style="width: 100%; height: 100%; text-align: center;" value="1">
<div class="blocker"></div>  
</div>

</label>

	</div>
	<!-- header end -->
  
	<!-- Tool2 Edit-->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle" style="margin-bottom: 3px;">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-icon">Icon</b>:</div> 
	<input type="text" class="darkInput" list="iconlist" name="attr_tool2Icon" style="width: 149px;" data-i18n-placeholder="message-icon-placeholder" placeholder="Icon selection" value="Hand">
	</div>
	<div class="settingStyle">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_tool2Uses" value="1"> / 
	<input type="number" class="darkInput toolMaxInput" style="width: 32px; margin-left: 2px;" name="attr_tool2Uses_max" value="3" min="1">

	</div>

</div>

	<!-- Tool2 Edit end -->

<div>
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_tool2" name="act_shareTool" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="tool2AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_tool2AutoScript" hidden="true">
</div>

	<!-- Description/Effect section -->
        <div class="toolDescription">
       <textarea spellcheck="false"  name="attr_tool2Description" class="toolDescriptionInput" data-i18n-placeholder="tool-desc" placeholder="Tool description."></textarea>
        </div>

        <div class="itemEffect">
	<textarea spellcheck="false"  name="attr_tool2Effect" class="weaponEffectInput"
data-i18n-placeholder="tool-effect" placeholder="Tool effects."></textarea>
        </div>

	<!-- desc end -->	

	</div>
	<!-- Tool2 Block - end -->

</div>
<!-- Tool Block END -->

<!-- !!EXTRA!! Tool section -->
<input type="checkbox" class="hide-toggle" name="attr_settingExtraEquip" value="true">
<div class="hide-item">

<div class="toolContainer">

	<!-- Tool3 block -->
	<div class="contentContainer half" style="margin-right: 8px;">

	<!-- header -->
	<div class="sectionHeader tool rowContainer">
	<input type="text" class="toolRank" name="attr_tool3Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="toolName transpInput" name="attr_tool3Name" data-i18n-placeholder="tool-name" placeholder="Tool name">

	<input type="checkbox" id="attr_tool3Portable" name="attr_tool3Portable" value="Portable"><label for="attr_tool3Portable" class="portableIcon" title="Portable" data-i18n-title="tool-portable"></label> 

	<input type="checkbox" id="attr_tool3Reusable" name="attr_tool3Reusable" value="Reusable"><label for="attr_tool3Reusable" class="reusableIcon" data-i18n-title="tool-reusable" title="Reusable"> 

<div class="rowContainer centerFlex" style="width: 30px; height: 30px;">   
<input type="text" class="transpInput" name="attr_tool3Uses" style="width: 100%; height: 100%; text-align: center;" value="1">
<div class="blocker"></div>  
</div>

</label>

	</div>
	<!-- header end -->
  
	<!-- Tool3 Edit-->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle" style="margin-bottom: 3px;">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-icon">Icon</b>:</div> 
	<input type="text" class="darkInput" list="iconlist" name="attr_tool3Icon" style="width: 149px;" data-i18n-placeholder="message-icon-placeholder" placeholder="Icon selection" value="Hand">
	</div>
	<div class="settingStyle">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_tool3Uses" value="1"> / 
	<input type="number" class="darkInput toolMaxInput" style="width: 32px; margin-left: 2px;" name="attr_tool3Uses_max" value="3" min="1">

	</div>

</div>

	<!-- Tool3 Edit end -->

<div>
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_tool3" name="act_shareTool" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="tool3AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_tool3AutoScript" hidden="true">
</div>




	<!-- Description/Effect section -->

        <div class="toolDescription">
       <textarea spellcheck="false"  name="attr_tool3Description" class="toolDescriptionInput" data-i18n-placeholder="tool-desc" placeholder="Tool description."></textarea>
        </div>

        <div class="itemEffect">
	<textarea spellcheck="false"  name="attr_tool3Effect" class="weaponEffectInput" data-i18n-placeholder="tool-effect" placeholder="Tool effects."></textarea>
        </div>

	<!-- desc end -->	

	</div>
	<!-- Tool3 Block - end -->


	<!-- Tool4 block -->
	<div class="contentContainer half">

	<!-- header -->
	<div class="sectionHeader tool rowContainer">
	<input type="text" class="toolRank" name="attr_tool4Rank" placeholder="0" data-i18n-title="rank" title="Rank">
	<input type="text" class="toolName transpInput" name="attr_tool4Name" data-i18n-placeholder="tool-name" placeholder="Tool name">

	<input type="checkbox" id="attr_tool4Portable" name="attr_tool4Portable" value="Portable"><label for="attr_tool4Portable" class="portableIcon" title="Portable" data-i18n-title="tool-portable"></label> 

	<input type="checkbox" id="attr_tool4Reusable" name="attr_tool4Reusable" value="Reusable"><label for="attr_tool4Reusable" class="reusableIcon" data-i18n-title="tool-reusable" title="Reusable"> 

<div class="rowContainer centerFlex" style="width: 30px; height: 30px;">   
<input type="text" class="transpInput" name="attr_tool4Uses" style="width: 100%; height: 100%; text-align: center;" value="1">
<div class="blocker"></div>  
</div>

</label>

	</div>
	<!-- header end -->
  
	<!-- Tool4 Edit-->
<input type="checkbox" class="hide-toggle" name="attr_settingEditMode" value="true">
<div class="hide-item editCover">

	<div class="settingStyle" style="margin-bottom: 3px;">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-icon">Icon</b>:</div> 
	<input type="text" class="darkInput" list="iconlist" name="attr_tool4Icon" style="width: 149px;" data-i18n-placeholder="message-icon-placeholder" placeholder="Icon selection" value="Hand">
	</div>
	<div class="settingStyle">
	<div class="settingStyle" style="width: 36px;"><b data-i18n="message-uses">Uses</b>:	</div> 

	<input type="text" class="transpInput" style="width: 23px;" name="attr_tool4Uses" value="1"> / 
	<input type="number" class="darkInput toolMaxInput" style="width: 32px; margin-left: 2px;" name="attr_tool4Uses_max" value="3" min="1">

	</div>

</div>

	<!-- Tool4 Edit end -->

<div>
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_tool4" name="act_shareTool" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput editButton" name="act_editMode" data-i18n-title="edit" title="Edit"></button>
<button type="action" class="darkInput autoScriptButton" id="tool4AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_tool4AutoScript" hidden="true">
</div>


	<!-- Description/Effect section -->
        <div class="toolDescription">
       <textarea spellcheck="false"  name="attr_tool4Description" class="toolDescriptionInput" data-i18n-placeholder="tool-desc" placeholder="Tool description."></textarea>
        </div>

        <div class="itemEffect">
	<textarea spellcheck="false"  name="attr_tool4Effect" class="weaponEffectInput" data-i18n-placeholder="tool-effect" placeholder="Tool effects."></textarea>
        </div>

	<!-- desc end -->	

	</div>
	<!-- Tool4 Block - end -->
</div>
</div>
<!-- !!EXTRA!! Item Block END -->


</div>

</div>

<!-- ??? -->

<!-- Special Items section -->
<input type="checkbox" class="hide-toggle-rev" name="attr_settingHideSpecial" value="true">
<div class="hide-item-rev rowContainer">
<div class="contentBlock">

	<!-- Special Item1 block -->
	<div class="specialBlock">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_special1" name="act_shareSpecial" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput autoScriptButton" id="special1AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_special1AutoScript" hidden="true">

	<!-- Header -->
	<div class="sectionHeader special" id="special1Name">
		
	<input type="text" type="text" class="specialItemRank" name="attr_special1Rank" placeholder="0" data-i18n-title="rank" title="Rank">

	<input type="text" class="transpInput contentName" name="attr_special1Name" data-i18n-placeholder="special-name" placeholder="Special item name">

		<select name="attr_special1Risk" class="darkInput contentName topRight" data-i18n-title="special-risk-text" title="Risk Level">
			<option data-i18n="special-risk-none" value="none">---</option>
			<option data-i18n="special-risk-0" value="0">Canard</option>
			<option data-i18n="special-risk-1" value="1">Urban Myth</option>
			<option data-i18n="special-risk-2" value="2">Urban Legend</option>
			<option data-i18n="special-risk-3" value="3">Urban Plague</option>
			<option data-i18n="special-risk-4" value="4">Urban Nightmare</option>
			<option data-i18n="special-risk-5" value="5">Star of the City</option>
			<option data-i18n="special-risk-6" value="6">Impuritas Civitatis</option>
		</select>

	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

	<div class="special" style="height: 110px;"> 

	<div class="specialColumn">
	<span data-i18n="special-range-text">Effect Range</span>
 		<select name="attr_special1Range" class="specialInput darkInput" id="special1Range" style="text-align: center;">
                          <option data-i18n="special-range-none" value="none">---</option>
                          <option data-i18n="special-range-0" value="0">One or two people</option>
                          <option data-i18n="special-range-1" value="1">Street</option>
                          <option data-i18n="special-range-2" value="2">Neighborhood</option>
                          <option data-i18n="special-range-3" value="3">Residence Area</option>
                          <option data-i18n="special-range-4" value="4">Nest</option>
                          <option data-i18n="special-range-5" value="5">Multiple Nests</option>
                          <option data-i18n="special-range-6" value="6">City</option>
               	</select>
	</div>

	<div class="specialColumn">
	<span data-i18n="special-duration-text">Duration</span>
		<select name="attr_special1Duration" class="specialInput darkInput" id="special1_duration" style="text-align: center;">
			<option data-i18n="special-duration-none" value="none">---</option>
			<option data-i18n="special-duration-0" value="0">A moment</option>
			<option data-i18n="special-duration-1" value="1">Seconds</option>
			<option data-i18n="special-duration-2" value="2">Minutes</option>
			<option data-i18n="special-duration-3" value="3">Hours</option>
			<option data-i18n="special-duration-4" value="4">Days</option>
			<option data-i18n="special-duration-5" value="5">Weeks</option>
			<option data-i18n="special-duration-6" value="6">Months</option>
              	</select>
	</div>

	</div>

       <textarea spellcheck="false"  name="attr_special1Description" class="specialDescriptionInput" data-i18n-placeholder="special-desc" placeholder="Special item description/effects."></textarea>

	</div>
	<!-- desc end -->	

	</div>
<!-- Special Item 1 Block END -->


<!-- Special Item2 block -->
	<div class="specialBlock">

<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
<button type="action" class="darkInput shareButton" id="share_special2" name="act_shareSpecial" data-i18n-title="share" title="Share info"></button>
<button type="action" class="darkInput autoScriptButton" id="special2AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
<input type="text" name="attr_special2AutoScript" hidden="true">

	<!-- Header -->
	<div class="sectionHeader special" id="special2Name">
		
	<input type="text" type="text" class="specialItemRank" name="attr_special2Rank" placeholder="0" data-i18n-title="rank" title="Rank">

	<input type="text" class="transpInput contentName" name="attr_special2Name" data-i18n-placeholder="special-name" placeholder="Special item name">

	<select name="attr_special2Risk" class="darkInput contentName topRight" data-i18n-title="special-risk-text" title="Risk Level">
			<option data-i18n="special-risk-none" value="none">---</option>
			<option data-i18n="special-risk-0" value="0">Canard</option>
			<option data-i18n="special-risk-1" value="1">Urban Myth</option>
			<option data-i18n="special-risk-2" value="2">Urban Legend</option>
			<option data-i18n="special-risk-3" value="3">Urban Plague</option>
			<option data-i18n="special-risk-4" value="4">Urban Nightmare</option>
			<option data-i18n="special-risk-5" value="5">Star of the City</option>
			<option data-i18n="special-risk-6" value="6">Impuritas Civitatis</option>
		</select>

	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

	<div class="special" style="height: 110px;"> 

	<div class="specialColumn">
	<span data-i18n="special-range-text">Effect Range</span>
 		<select name="attr_special2Range" class="specialInput darkInput" id="special2Range" style="text-align: center;">
                          <option data-i18n="special-range-none" value="none">---</option>
                          <option data-i18n="special-range-0" value="0">One or two people</option>
                          <option data-i18n="special-range-1" value="1">Street</option>
                          <option data-i18n="special-range-2" value="2">Neighborhood</option>
                          <option data-i18n="special-range-3" value="3">Residence Area</option>
                          <option data-i18n="special-range-4" value="4">Nest</option>
                          <option data-i18n="special-range-5" value="5">Multiple Nests</option>
                          <option data-i18n="special-range-6" value="6">City</option>
               	</select>
	</div>

	<div class="specialColumn">
	<span data-i18n="special-duration-text">Duration</span>
		<select name="attr_special2Duration" class="specialInput darkInput" id="special2_duration" style="text-align: center;">
			<option data-i18n="special-duration-none" value="none">---</option>
			<option data-i18n="special-duration-0" value="0">A moment</option>
			<option data-i18n="special-duration-1" value="1">Seconds</option>
			<option data-i18n="special-duration-2" value="2">Minutes</option>
			<option data-i18n="special-duration-3" value="3">Hours</option>
			<option data-i18n="special-duration-4" value="4">Days</option>
			<option data-i18n="special-duration-5" value="5">Weeks</option>
			<option data-i18n="special-duration-6" value="6">Months</option>
              	</select>
	</div>

	</div>

       <textarea spellcheck="false"  name="attr_special2Description" class="specialDescriptionInput" data-i18n-placeholder="special-desc" placeholder="Special item description/effects."></textarea>

	</div>
	<!-- desc end -->	

	</div>
<!-- Special Item2 Block END -->

</div>

</div>
</div>
</div>
</div>
<!-- Equipment END -->

<!-- Skill section -->

	<div class="sheet-body sheet-skills darkBG">
        <div class="contentBlock" id="skillSection">

<!-- EGO Skills Column -->
            <div class="egoSkillContainer">

	<!-- EGO Skill1 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill1" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill1AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill1AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill1Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill1Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill1Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill1Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill1Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill1Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill1Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill1Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill1Type" class="whiteInput skillType" id="EGOskill1-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill1Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill1Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill1Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill1Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill1Description" class="augmentDescriptionInput" data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill1Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill1 block - END -->

<!-- EGO Skill2 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill2" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill2AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill2AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill2Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill2Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill2Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill2Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill2Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill2Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill2Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill2Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill2Type" class="whiteInput skillType" id="egoSkill2-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill2Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill2Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill2Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill2Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill2Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill2Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill2 block - END -->

<!-- EGO Skill3 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill3" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill3AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill3AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill3Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill3Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill3Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill3Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill3Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill3Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill3Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill3Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill3Type" class="whiteInput skillType" id="egoSkill3-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill3Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill3Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill3Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill3Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill3Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill3Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill3 block - END -->

<!-- EGO Skill4 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill4" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill4AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill4AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill4Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill4Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill4Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill4Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill4Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill4Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill4Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill4Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill4Type" class="whiteInput skillType" id="egoSkill4-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill4Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill4Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill4Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill4Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill4Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill4Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill4 block - END -->


<!-- !!EXTRA!! EGO skills -->
<input type="checkbox" class="hide-toggle" name="attr_settingExtraEquip" value="true">
<div class="hide-item" style="width: 100%;">

<!-- EGO Skill5 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill5" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill5AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill5AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill5Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill5Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill5Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill5Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill5Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill5Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill5Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill5Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill5Type" class="whiteInput skillType" id="egoSkill5-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill5Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill5Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill5Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill5Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill5Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill5Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill5 block - END -->

<!-- EGO Skill6 block -->
	<div class="skillBlock">

	<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_egoSkill6" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="egoSkill6AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_egoSkill6AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillE rowContainer">

	<input type="text" class="transpInput skillName" name="attr_egoSkill6Name" data-i18n-placeholder="skill-ego-name" placeholder="Mystery skill name">

<div class="iconHolder egoSkills">
		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_egoSkill6Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_egoSkill6Type"><div class="type-image skillIcon skillAtt"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_egoSkill6Type"><div class="type-image skillIcon skillDef"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_egoSkill6Type"><div class="type-image skillIcon skillEvd"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_egoSkill6Type"><div class="type-image skillIcon skillAct"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_egoSkill6Type"><div class="type-image skillIcon skillMass"></div>
		</div>

<input class="skillRank" type="text" name="attr_egoSkill6Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">

	</div>

	<div class="rowContainer centerFlex skillE"> 

				<select name="attr_egoSkill6Type" class="whiteInput skillType" id="egoSkill6-type">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_egoSkill6Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_egoSkill6Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_egoSkill6Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="egoLightCostInput" type="text" name="attr_egoskill6Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_egoSkill6Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_egoSkill6Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- EGO Skill6 block - END -->


</div>


<!-- !!EXTRA!! EGO skills - END -->

</div> 
<!-- EGO Skills Column END -->


<!-- Regular Skills column -->
            <div class="skillContainer">

	<!-- Skill1 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill1" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill1AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill1AutoScript" hidden="true">


	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill1Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill1Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill1Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill1Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill1Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill1Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill1Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill1Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill1Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill1Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill1Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill1Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill1Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill1Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill1Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill1 block - END -->

	<!-- Skill2 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill2" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill2AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill2AutoScript" hidden="true">


	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill2Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill2Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill2Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill2Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill2Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill2Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill2Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill2Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill2Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill2Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill2Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill2Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill2Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill2Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill2Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill2 block - END -->

<!-- Skill3 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill3" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill3AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill3AutoScript" hidden="true">


	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill3Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill3Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill3Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill3Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill3Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill3Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill3Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill3Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill3Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill3Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill3Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill3Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill3Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill3Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill3Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill3 block - END -->

<!-- Skill4 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill4" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill4AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill4AutoScript" hidden="true">


	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill4Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill4Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill4Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill4Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill4Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill4Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill4Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill4Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill4Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill4Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill4Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill4Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill4Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill4Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill4Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill4 block - END -->


<!-- !!EXTRA!! Regular Skills -->
<input type="checkbox" class="hide-toggle" name="attr_settingExtraEquip" value="true">
<div class="hide-item" style="width: 100%;">

<!-- Skill5 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill5" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill5AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill5AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill5Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill5Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill5Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill5Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill5Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill5Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill5Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill5Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill5Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill5Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill5Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill5Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill5Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill5Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill5Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill5 block - END -->

<!-- Skill6 block -->
	<div class="skillBlock">
<input type="checkbox" class="hide-toggle" name="attr_settingHideShare" value="true">
	<button type="action" class="darkInput shareButton" id="share_skill6" name="act_shareSkill" data-i18n-title="share" title="Share info"></button>
	<button type="action" class="darkInput autoScriptButton" id="skill6AutoScript" name="act_autoScriptEdit" data-i18n-title="autoscript-edit" title="Edit AutoScript"></button>
	<input type="text" name="attr_skill6AutoScript" hidden="true">

	<!-- header -->
	<div class="sectionHeader skillN rowContainer" style="position: relative;">

	<input type="text" class="transpInput skillName" name="attr_skill6Name" data-i18n-placeholder="skill-name" placeholder="Skill name">


<div class="iconHolder">

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="" name="attr_skill6Type"><div class="type-image skillIcon skillNone"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Attack" name="attr_skill6Type"><div class="type-image skillIcon skillAtt weapon"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Defend" name="attr_skill6Type"><div class="type-image skillIcon skillDef outfit"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Evade" name="attr_skill6Type"><div class="type-image skillIcon skillEvd STGR"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Action" name="attr_skill6Type"><div class="type-image skillIcon skillAct tool"></div>
		</div>

		<div class="icon">
		<input type="checkbox" class="expand-toggle" value="Mass" name="attr_skill6Type"><div class="type-image skillIcon skillMass weapon"></div>
		</div>

<input class="skillRank" type="text" name="attr_skill6Rank" value="0" placeholder="0" data-i18n-title="rank" title="Rank">


	</div>

	<div class="rowContainer centerFlex skillN"> 

				<select name="attr_skill6Type" class="whiteInput skillType">
				    <option data-i18n="skill-type-None" value="None" selected>---</option>
                                    <option data-i18n="skill-type-Attack" value="Attack">Attack</option>
                                    <option data-i18n="skill-type-Defend" value="Defend">Defend</option>
                                    <option data-i18n="skill-type-Evade" value="Evade">Evade</option>
                                    <option data-i18n="skill-type-Action" value="Action">Action</option>
                                    <option data-i18n="skill-type-Mass" value="Mass">Mass</option>
                                </select>

		<div class="dicerollBlock whiteInput" data-i18n-title="skill-dice-text" title="Dice modifiers applied when using skill">
		<input type="text" class="diceNum" name="attr_skill6Dice1" value="0">
		<div class="plainText">D</div>
		<input type="text" class="diceVval" name="attr_skill6Dice2" value="0">
		<div class="plainText">+</div>
		<input type="text" name="attr_skill6Dice3" placeholder="0" value="0">
		</div>
	

	<div class="lightCost">
				<input class="lightCostInput" type="text" name="attr_skill6Light" value="1" data-i18n-title="skill-light-cost" title="Light Cost">
	</div>

	</div>


	</div>
	<!-- header end -->


	<!-- Description/Effect section -->
	<div class="rowContainer weaponInfo">

        <div class="weaponDescription">
       <textarea spellcheck="false"  name="attr_skill6Description" class="augmentDescriptionInput"data-i18n-placeholder="skill-desc" placeholder="Skill description."></textarea>
        </div>

        <div class="weaponEffect">
	<textarea spellcheck="false"  name="attr_skill6Effect" class="weaponEffectInput" data-i18n-placeholder="skill-effect" placeholder="Skill effects."></textarea>
        </div>

	</div>
	<!-- desc end -->
	</div>
<!-- Skill6 block - END -->


</div>


<!-- !!EXTRA!! Regular Skills - END -->


</div> 
<!-- Regular Skills - END -->






</div> <!-- outside of green line -->
  
              </div></div></div></div>
<!-- Skill section END -->


<!-- Character Details -->
	<div class="sheet-body sheet-details darkBG">
	<div class="contentContainer" id="characterDetails">

<div class="profileHeader" style="top: 12px; right: 10px; left: auto;">
<input type="checkbox" id="attr_distortState" name="attr_distortState" value="true"><label for="attr_distortState" class="distortIcon" data-i18n-title="distort-toggleText" title="Distort"></label>
</div>

<!-- Normal profile -->
<input type="checkbox" class="hide-toggle-rev" name="attr_distortState" value="true">
<div class="hide-item-rev" style="width: 100%;">
<div class="rowContainer" style="padding-top: 5px;">
<div class="half" style="position: relative;">

	<div class="CharImage"><img name="attr_character_avatar">
	<div class="CharImageText" data-i18n="character-photo">Photo</div></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-name-text">Name</div>
	<input class="CharSmallNotes" type="text" name="attr_character_nameBase"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-job">Occupation</div>
	<input class="CharSmallNotes" type="text" name="attr_character_job"></div>
               
	<div class="profileData">
	<div class="textSection" data-i18n="character-age">Age</div>
	<input class="CharSmallNotes" type="text" name="attr_age"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-height">Height</div>
	<input class="CharSmallNotes" type="text" name="attr_height"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-origin">Birthplace</div>
	<input class="CharSmallNotes" type="text" name="attr_character_origin"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-residence">Residence</div>
	<input class="CharSmallNotes" type="text" name="attr_character_residence"></div>

	<div class="profileData" style="position: relative;">
	<div class="textSection" data-i18n="character-assets">Assets</div>
	<input class="CharSmallNotes" type="text" name="attr_character_assets" data-i18n-placeholder="character-assets-placeholder" placeholder="Money, items, other assets.">


<input class="CharDetail" type="text" name="attr_character_ahn" placeholder="500,000 ahn" data-i18n-placeholder="character-ahn-placeholder" style="width: 154px !important; position: absolute; right: 2px; top: 0px;">

</div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-summary">Summary</div>
	<textarea spellcheck="false"  name="attr_character_summary" data-i18n-placeholder="character-summary-placeholder" class="CharMediumNotes" placeholder="General character summary."></textarea></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-history">Notable History</div>
	<textarea spellcheck="false"  name="attr_character_history" class="CharMediumNotes" data-i18n-placeholder="character-history-placeholder" placeholder="Recent or past history."></textarea>
	</div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-relations">Relations</div>
	<textarea spellcheck="false"  name="attr_character_relations" class="CharMediumNotes" data-i18n-placeholder="character-relations-placeholder" placeholder="Relations with others."></textarea>
	</div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-notes">Notes</div>
	<textarea spellcheck="false"  name="attr_character_notes" class="CharMediumNotes" data-i18n-placeholder="character-notes-placeholder" placeholder="Any other notes."></textarea>
	</div>

</div>


<div class="columnAlign half centerFlex" id="CharExtra">

	<div class="profileData">
	<div class="textSection" style="width: 50px !important;">URL</div>
	<input type="text" class="CharDetail" name="attr_character_url" data-i18n-placeholder="character-url-placeholder" placeholder="External sheet/reference" style="max-width: 300px;"></div>

<div class="textSection" data-i18n="character-desc">Description</div>
<div class="CharBigNotes">
<textarea spellcheck="false" name="attr_character_desc" data-i18n-placeholder="character-desc-placeholder" placeholder="Physical description."></textarea></div>


<div class="textSection" data-i18n="character-personality">Personality</div>
<div class="CharBigNotes">
<textarea spellcheck="false" name="attr_character_personality" data-i18n-placeholder="character-personality-placeholder" placeholder="Personality description."></textarea></div>


<div class="textSection" data-i18n="character-background">Background</div>
<div class="CharBigNotes">
<textarea spellcheck="false" name="attr_character_background" data-i18n-placeholder="character-background-placeholder" placeholder="Background description."></textarea></div>

</div>
</div>
</div>

<!-- Distortion profile -->
<input type="checkbox" class="hide-toggle" name="attr_distortState" value="true">
<div class="hide-item" style="width: 100%;">
<div class="rowContainer distortProfile" style="padding-top: 5px;">
<div class="half" style="position: relative;">

	<div class="CharImage"><img name="attr_character_avatar">
	<div class="CharImageText" data-i18n="character-photo">Photo</div></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-name-text">Name</div>
	<input class="whiteInput" type="text" name="attr_distort_name"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-job">Occupation</div>
	<input class="whiteInput" type="text" name="attr_character_job"></div>
               
	<div class="profileData">
	<div class="textSection" data-i18n="character-age">Age</div>
	<input class="whiteInput" type="text" name="attr_age"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-height">Height</div>
	<input class="whiteInput" type="text" name="attr_height"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-origin">Birthplace</div>
	<input class="whiteInput" type="text" name="attr_character_origin"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-residence">Residence</div>
	<input class="whiteInput" type="text" name="attr_character_residence"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="distort-origin">Origin</div>
	<input class="CharDetail whiteInput" data-i18n-placeholder="distort-origin-placeholder" placeholder="Origin of Distortion." type="text" name="attr_distort_origin"></div>

	<div class="profileData">
	<div class="textSection" data-i18n="distort-summary">Summary</div>
	<textarea spellcheck="false"  name="attr_distort_summary" data-i18n-placeholder="distort-summary-placeholder" class="CharMediumNotes whiteInput" placeholder="General summary of Distortion."></textarea></div>

	<div class="profileData">
	<div class="textSection" data-i18n="distort-behavior">Behavior</div>
	<textarea spellcheck="false"  name="attr_distort_behavior" class="CharMediumNotes whiteInput" data-i18n-placeholder="distort-behavior-placeholder" placeholder="Notes on Distortion behaviour."></textarea>
	</div>

	<div class="profileData">
	<div class="textSection" data-i18n="distort-taboo">Taboos/Boons</div>
	<textarea spellcheck="false"  name="attr_distort_taboo" class="CharMediumNotes whiteInput" data-i18n-placeholder="distort-taboo-placeholder" placeholder="Distortion taboos."></textarea>
	</div>

	<div class="profileData">
	<div class="textSection" data-i18n="character-notes">Notes</div>
	<textarea spellcheck="false"  name="attr_distort_notes" class="CharMediumNotes whiteInput" data-i18n-placeholder="distort-notes-placeholder" placeholder="Other Distortion notes."></textarea>
	</div>


</div>


<div class="columnAlign half centerFlex" id="distortExtra">

	<div class="profileData">
	<div class="textSection" style="width: 50px !important;">URL</div>
	<input type="text" class="CharDetail whiteInput" name="attr_distort_url" data-i18n-placeholder="character-url-placeholder" placeholder="External sheet/reference" style="max-width: 300px;"></div>

<div class="textSection" data-i18n="distort-appearance">Appearance</div>
<div class="CharBigNotes">
<textarea spellcheck="false" class="whiteInput" name="attr_distort_appearance" data-i18n-placeholder="distort-appearance-placeholder" placeholder="Appearance of Distortion."></textarea></div>

<div class="textSection" data-i18n="distort-atmosphere">Atmosphere</div>
<div class="CharBigNotes">
<textarea spellcheck="false" class="whiteInput" name="attr_distort_atmosphere" data-i18n-placeholder="distort-atmosphere-placeholder" placeholder="Atmosphere of Distortion."></textarea></div>

<div class="textSection" data-i18n="distort-story">Story</div>
<div class="CharBigNotes">
<textarea spellcheck="false" class="whiteInput" name="attr_distort_story" data-i18n-placeholder="distort-story-placeholder" placeholder="Story of Distortion."></textarea></div>

</div>
</div>

<!-- distortion details end -->



</div>
	</div>
</div>

<!-- Details END -->

<!-- Sheet Editor -->
<div class="sheet-body sheet-export darkBG">
	<div class="contentContainer" id="sheetExport">

		<div class="rowContainer centerFlex">

<button type="action" class="declare" name="act_clearButton" id="clear_editorOutput" data-i18n-title="reset-button" title="Reset" style="position: absolute; left: 0;">x</button>

	<select name="attr_exportType" class="darkInput" style="width: 200px !important; position: absolute; left: 90px; margin-bottom: 0px;">
 	<option data-i18n="export-type-All" value="All" /selected>All</option>
         <option data-i18n="export-type-Equip" value="Equip">Equipment</option>
	<option data-i18n="export-type-Skill" value="Skills">Skills</option>
	<option data-i18n="export-type-Ego" value="Ego">E.G.O</option>
         <option data-i18n="export-type-Distort" value="Distort">Distortion</option>
	<option data-i18n="export-type-Character" value="Character">Character details</option>
	<option data-i18n="export-type-Settings" value="Settings">Settings</option>
         </select>

<button type="action" class="declare" name="act_export" data-i18n="message-export">Export</button>
<button type="action" class="declare" name="act_swap" title="Swap" style="font-size: 14pt; margin-left: 5px; margin-right: 5px;">⇔</button>
<button type="action" class="declare" name="act_import" data-i18n="message-import">Import</button>

<button type="action" class="declare" name="act_clearButton" data-i18n-title="reset-button" title="Reset" id="clear_editorInput" style="position: absolute; right: 0;">x</button>

		</div>

		<div class="rowContainer">
	<textarea spellcheck="false" class="half" name="attr_editorOutput" data-il18n-placeholder="editor-outputText" placeholder="Editor output"></textarea>

	<textarea spellcheck="false" class="half" name="attr_editorInput" data-il18n-placeholder="editor-inputText" placeholder="Editor input"></textarea>
		</div>

</div>
</div>


<!-- Sheet Editor -->
	<div class="sheet-body sheet-edit darkBG">

<input type="text" name="attr_global_editKey" hidden="true">

<div class="rowContainer centerFlex">
<input type="checkbox" class="hide-toggle" name="attr_global_accessCheck" value="0" hidden="true">
<div class="hide-item" style="width: 200px; height: 250px; text-align: center;">
<h4 data-il18n-placeholder="editor-pw">Edit Mode Password</h4>
<input type="text" class="darkInput" name="attr_global_access">
</div>

</div>

	<div class="contentContainer" id="sheetSettings">

<input type="checkbox" class="hide-toggle-rev" name="attr_global_accessCheck" value="0" hidden="true">
<div class="hide-item-rev rowContainer">

<!-- Game Setting Section -->
<div><h3>
<input type="checkbox" class="switch-toggle" name="attr_syncLockGame" value="true" hidden="true">
<button type="action" class="lockButton" id="lock_Game" name="act_lockSection"></button>

	<div>
	<input type="checkbox" class="hide-toggle" name="attr_syncStateGame" value="true">
	<div class="hide-item syncIcon"></div>
	</div>

<span data-i18n="editor-gamesettings">Game Settings</span> 

<label for="hideGameSettings" class="arrowholder"><input type="checkbox" class="switch-toggle" id="hideGameSettings" name="attr_hideGameSettings" value="true" style="display: none;"><div class="arrow"></div></label></h3>

<input type="checkbox" class="hide-toggle-rev" name="attr_hideGameSettings" value="true" hidden="true">
<div class="hide-item-rev" style="width: 100%;">

<div class="rowContainer centerFlex">
	<textarea spellcheck="false" class="half" name="attr_gameEditor" data-il18n-placeholder="editor-outputText" data-i18n-placeholder="editor-gamesettings-textedit" placeholder="Game Settings output"></textarea>
</div>
<div class="rowContainer">
<button type="action" name="act_resetGlobal" data-i18n="clear-button" class="btn">Clear</button>
<button type="action" name="act_syncGlobal" data-i18n="sync-button" class="btn">Sync Data</button>
<button type="action" name="act_exportGlobal" data-i18n="message-export" class="btn">Export</button>
<button type="action" name="act_importGlobal" data-i18n="message-import" class="btn">Import</button>
</div>


<!-- Obscured -->
<div id="globalSettings">
<fieldset class="repeating_global">

<input type="text" name="attr_editKey" hidden="true">
<textarea name="attr_gameSettingSource" hidden="true"></textarea>
<textarea name="attr_ailmentSettingSource" hidden="true"></textarea>
<textarea name="attr_sheetSettingSource" hidden="true"></textarea>

<div class="rowContainer">

<!-- General settings -->
<div style="text-align: left; padding: 10px;">

<div>
<div class="settingStyle">
<div style="width: 100px">
<b data-i18n="editor-rulename">Ruleset Name</b>:</div> <input type="text" style="input" name="attr_ruleName" data-i18n="editor-rulename-placeholder" value="Original Rulebook (Default)">
</div>

<div class="settingStyle">
<div style="width: 100px">
<b data-i18n="bar-health">Health</b>:</div> <input type="number" name="attr_healthBase" value="30">

+
(<select type="text" name="attr_healthStat" value="Instinct" style="width: 80px;">
<option value="Instinct" data-i18n="stats-instinct">Fortitude</option>
<option value="InstinctTemperance" data-i18n="editor-instinct-temperance">(Fortitude + Temperance)/2</option>
</select>
 * 

<input type="number" name="attr_healthStatMod" value="6">)
+ (<span data-i18n="rank">Rank</span> *
<input type="number" name="attr_healthRankMod" value="6">)
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="bar-stagres">Stagger Res</b>:</div> <input type="number" name="attr_staggerBase" value="20">

+
(<select type="text" name="attr_staggerStat" value="Charm" style="width: 80px;">
<option value="Charm" data-i18n="stats-charm">Charm</option>
<option value="CharmJustice" data-i18n="editor-charm-justice">(Charm + Justice)/2</option>
</select>
 *  

 <input type="number" name="attr_staggerStatMod" value="4">)
+ (<span data-i18n="rank">Rank</span> *
<input type="number" name="attr_staggerRankMod" value="4">)
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="bar-sanity">Sanity</b>:</div> <input type="number" name="attr_sanityBase" value="15">

+
(<select type="text" name="attr_sanityStat" value="Wisdom" style="width: 80px;">
<option value="Wisdom" data-i18n="stats-wisdom">Prudence</option>
<option value="WisdomInsight" data-i18n="editor-wisdom-insight">(Prudence + Insight)/2</option>
</select>
 * 

 <input type="number" name="attr_sanityStatMod" value="3">)
+ (<span data-i18n="rank">Rank</span> *
<input type="number" name="attr_sanityRankMod" value="0">)
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="bar-light">Light</b>:</div> <input type="number" name="attr_lightBase" value="3">
 + (<span data-i18n="rank">Rank</span> * <input type="number" name="attr_lightRankMod" value="1">)
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="editor-distortlight">Distort Light</b>:</div> <input type="number" name="attr_distortLightBase" value="5">
 + (<span data-i18n="rank">Rank</span> * <input type="number" name="attr_distortLightRankMod" value="1">)
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="character-level">Level</b>:</div> <input type="number" name="attr_expCalc" value="8"> <span data-i18n="character-exp">EXP</span>
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="helper-att-power">Att Power</b>:</div> <select type="text" name="attr_attStat" value="Instinct" style="width: 120px;">
<option value="Instinct" data-i18n="stats-instinct">Fortitude</option>
<option value="Rank" data-i18n="rank">Rank</option>
<option value="InstinctRank" data-i18n="editor-instinct-rank">Fortitude + Rank</option>
<option value="InstinctWisdom" data-i18n="editor-instinct-wisdom">(Fortitude + Prudence)/2</option>
</select>
+ <span data-i18n="ailments-strength">Strength</span> / <span data-i18n="ailments-feeble">Feeble</span>
</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="helper-def-power">Def Power</b>:</div> <select type="text" name="attr_defStat" value="Temperance" style="width: 120px;">
<option value="Temperance" data-i18n="stats-temperance">Temperance</option>
<option value="Rank" data-i18n="rank">Rank</option>
<option value="TemperanceRank" data-i18n="editor-temperance-rank">Temperance + Rank</option>
<option value="TemperanceCharm" data-i18n="editor-temperance-charm">(Temperance + Charm)/2</option>

</select>
+ <span data-i18n="ailments-endurance">Endurance</span> / <span data-i18n="ailments-disarm">Disarm</span>

</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="helper-evd-power">Evd Power</b>:</div> <select type="text" name="attr_evdStat" value="Insight" style="width: 120px;">
<option value="Insight" data-i18n="stats-insight">Insight</option>
<option value="Rank" data-i18n="rank">Rank</option>
<option value="InsightRank" data-i18n="editor-insight-rank">Insight + Rank</option>
<option value="InsightJustice" data-i18n="editor-insight-justice">(Insight + Justice)/2</option>
</select> + 

<select type="text" name="attr_evdAilment" class="transpInput" style="width: 135px; text-align: left;">
<option value="EnduranceDisarm" data-i18n="editor-endurance-disarm">Endurance/Disarm</option>
<option value="HasteBind" data-i18n="editor-haste-bind">Haste/Bind</option>
</select>

</div>

<div class="settingStyle"><div style="width: 100px">
<b data-i18n="editor-multihit-penalty">Multi-hit Penalty</b>:</div> <input type="number" name="attr_multiPenalty" value="-2"><select type="text" class="transpInput" name="attr_multiStyle" style="width: 90px;">
<option data-i18n="editor-nattacks" value="n" selected>x n Attacks</option>
<option data-i18n="editor-flat" value="Flat">Flat</option>
</select>
</div>


</div>
</div>
<!-- General settings end -->

<input type="checkbox" value="true" name="attr_iconStyle" hidden="true" checked>

<!-- Default ailments -->
<div>

<label for="LimbusStyleInternal"><input type="checkbox" id="LimbusStyleInternal" name="attr_iconStyle" value="true"><span data-i18n="settings-limbusstyle">Limbus style ailment icons</span></label>

<div class="settingStyle columnAlign centerFlex">

<!-- Stagger -->
<div class="rowContainer repitemMock" style="width: 250px;">

	<div class="ailmentIconSelector rowContainer centerFlex">

	<div class="icon">
	<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_iconStyle"><div class="hide-item-rev skillIcon stagger"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="true" name="attr_iconStyle"><div class="type-image skillIcon stagger-limbus"></div>
	</div>

	</div>

<div class="columnAlign">

<div class="rowContainer settingStyle"><div style="width: 100px;">
<b data-i18n="editor-stg-recovery">STG Recovery</b>:</div> <input type="number" name="attr_staggerRecoverPercent" min="0" value="100" style="width:50px;">% + <input type="number" name="attr_staggerRecoverBase" value="0"></div>

<div class="rowContainer settingStyle"><div style="width: 100px;">
<b data-i18n="editor-stg-duration">STG Duration</b>:</div> <input type="number" name="attr_staggerDurationMax" value="1"></div>

<div class="rowContainer settingStyle"><div style="width: 100px;">
<b data-i18n="editor-stg-sanity">SP Damage</b>:</div> <input type="number" name="attr_staggerSanity" value="5"></div>

</div>



</div>
<!-- Stagger end -->

<!-- Generic token bars -->
<div class="rowContainer repitemMock" style="width: 300px;">
	<div class="rowContainer settingStyle">
		<div style="width: 40px;"><b data-i18n="token-bar1">Bar 1</b>:</div>
		<select name="attr_settingBar1" class="darkInput" style="width: 56px;">
			<option data-i18n="bar-health" value="HP" selected>Health</option>
			<option data-i18n="bar-stagres" value="StagRes">Stagger Res</option>
			<option data-i18n="bar-sanity" value="SP">Sanity</option>
			<option data-i18n="token-bar-none" value="None">None</option>
		</select>
	</div>
	<div class="rowContainer settingStyle">
		<div style="width: 40px;"><b data-i18n="token-bar2">Bar 2</b>:</div>
		<select name="attr_settingBar2" class="darkInput" style="width: 56px;">
			<option data-i18n="bar-health" value="HP">Health</option>
			<option data-i18n="bar-stagres" value="StagRes" selected>Stagger Res</option>
			<option data-i18n="bar-sanity" value="SP">Sanity</option>
			<option data-i18n="token-bar-none" value="None">None</option>
		</select>
	</div>
	<div class="rowContainer settingStyle">
		<div style="width: 40px;"><b data-i18n="token-bar3">Bar 3</b>:</div>
		<select name="attr_settingBar3" class="darkInput" style="width: 56px;">
			<option data-i18n="bar-health" value="HP">Health</option>
			<option data-i18n="bar-stagres" value="StagRes">Stagger Res</option>
			<option data-i18n="bar-sanity" value="SP" selected>Sanity</option>
			<option data-i18n="token-bar-none" value="None">None</option>
		</select>
	</div>
</div>
<!-- Generic token bars end -->

<div class="rowContainer centerFlex">

<!-- Burn -->
<div class="rowContainer repitemMock">
	<div class="columnAlign">
		<div class="rowContainer">
			<div class="ailmentIconSelector rowContainer centerFlex">
				<div class="icon">
					<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_iconStyle"><div class="hide-item-rev skillIcon burn"></div>
				</div>

				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="true" name="attr_iconStyle"><div class="type-image skillIcon burn-limbus"></div>
				</div>
			</div>

			<div class="settingStyle"><div style="width: 46px">
				<b data-i18n="message-decay">Decay</b>:</div>
			<div class="settingStyle">
			<select name="attr_burnDecayMode" class="darkInput" style="width: 40px;">
				<option value="+">+</option>
				<option value="x" selected>x</option>
				<option value="=">=</option>
			</select>
				<input type="text" name="attr_burnDecayVal" style="width: 40px;" value="0.5">
			</div>
			</div>
		</div>


		<div class="rowContainer">
			<div class="settingStyle"><div style="width: 66px; margin-left: 5px;">
				<b data-i18n="message-next-turn">Next turn</b>:
			</div> 
			<select name="attr_burnNextTurnSetting" class="darkInput" style="width: 80px;">
				<option data-i18n="false" value="false" selected>False</option>
				<option data-i18n="true" value="true">True</option>
			</select>
			</div>
		</div>
	</div>
</div>
<!-- Burn end -->

<!-- Bleed -->
<div class="rowContainer repitemMock">
	<div class="columnAlign">
		<div class="rowContainer">
			<div class="ailmentIconSelector rowContainer centerFlex">
				<div class="icon">
					<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_iconStyle"><div class="hide-item-rev skillIcon bleed"></div>
				</div>
			
				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="true" name="attr_iconStyle"><div class="type-image skillIcon bleed-limbus"></div>
				</div>
			</div>

			<div class="settingStyle"><div style="width: 46px">
				<b data-i18n="message-decay">Decay</b>:
			</div> 
			<select name="attr_bleedDecayMode" class="darkInput" style="width: 40px;">
				<option value="+">+</option>
				<option value="x" selected>x</option>
				<option value="=">=</option>
			  </select>
			<input type="text" name="attr_bleedDecayVal" style="width: 40px;" value="0.5">
			</div>
		</div>

		<div class="rowContainer">
			<div class="settingStyle"><div style="width: 66px; margin-left: 5px;">
				<b data-i18n="message-next-turn">Next turn</b>:
			</div> 
			<select name="attr_bleedNextTurnSetting" class="darkInput" style="width: 80px;">
				<option data-i18n="false" value="false" selected>False</option>
				<option data-i18n="true" value="true">True</option>
			</select>
			</div>
		</div>
	</div>
</div>
<!-- Bleed end -->

</div>
<div class="rowContainer centerFlex">

<!-- Smoke -->
<div class="rowContainer repitemMock">
	<div class="columnAlign">
		<div class="rowContainer">
			<div class="ailmentIconSelector rowContainer centerFlex">
				<div class="icon">
					<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_iconStyle"><div class="hide-item-rev skillIcon smoke"></div>
				</div>
				
				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="true" name="attr_iconStyle"><div class="type-image skillIcon smoke-limbus"></div>
				</div>
			</div>

			<div class="settingStyle"><div style="width: 46px">
				<b data-i18n="message-decay">Decay</b>:
			</div> 
			<select name="attr_smokeDecayMode" class="darkInput" style="width: 40px;">
				<option value="+">+</option>
				<option value="x" selected>x</option>
				<option value="=">=</option>
			</select>
			<input type="text" name="attr_smokeDecayVal" style="width: 40px;" value="0.5">
			</div>
		</div>

		<div class="rowContainer">
			<div class="settingStyle"><div style="width: 66px; margin-left: 5px;">
				<b data-i18n="message-next-turn">Next turn</b>:
			</div> 
			<select name="attr_smokeNextTurnSetting" class="darkInput" style="width: 80px;">
				<option data-i18n="false" value="false" selected>False</option>
				<option data-i18n="true" value="true">True</option>
			</select>
			</div>
		</div>

		<div class="rowContainer">
			<div class="settingStyle"><div style="width: 66px; margin-left: 5px;">
				<b data-i18n="message-damage-calculation">Damage</b>:
			</div>
			<select name="attr_smokeCalculationMode" class="darkInput" style="width: 40px;">
				<option value="/" selected>/</option>
				<option value="%">%</option>
				<option value="=">=</option>
			</select>
			<input type="text" name="attr_smokeCalculationVal" style="width: 40px;" value="3">
			</div>
		</div>
	</div>
</div>
<!-- Smoke end -->

<!-- Charge -->
<div class="rowContainer repitemMock">
	<div class="columnAlign">
		<div class="rowContainer">
			<div class="ailmentIconSelector rowContainer centerFlex">
				<div class="icon">
					<input type="checkbox" class="hide-toggle-rev" value="true" name="attr_iconStyle"><div class="hide-item-rev skillIcon charge"></div>
				</div>
				
				<div class="icon">
					<input type="checkbox" class="expand-toggle" value="true" name="attr_iconStyle"><div class="type-image skillIcon charge-limbus"></div>
				</div>
			</div>

			<div class="settingStyle"><div style="width: 46px">
				<b data-i18n="message-decay">Decay</b>:</div>
			<select name="attr_chargeDecayMode" class="darkInput" style="width: 40px;">
				<option value="+">+</option>
				<option value="x" selected>x</option>
				<option value="=">=</option>
			</select>
			<input type="text" name="attr_chargeDecayVal" style="width: 40px;" value="0.5">
			</div>
		</div>

		<div class="rowContainer">
			<div class="settingStyle"><div style="width: 66px; margin-left: 5px;">
				<b data-i18n="message-next-turn">Next turn</b>:
			</div> 
			<select name="attr_chargeNextTurnSetting" class="darkInput" style="width: 80px;">
				<option data-i18n="false" value="false" selected>False</option>
				<option data-i18n="true" value="true">True</option>
			</select>
			</div>
		</div>
	</div>
</div>
<!-- Charge end -->
</div>

</div>

</div></div>
<!-- Default Ailments END -->

</div>
</fieldset>
</div>
<!-- Obscured end -->



</div>

<!-- Game Setting section END -->


<!-- Custom Ailment section -->
<div><h3>
<input type="checkbox" class="switch-toggle" name="attr_syncLockAilment" value="true" hidden="true">
<button type="action" class="lockButton" id="lock_Ailment" name="act_lockSection">
</button>

	<div>
	<input type="checkbox" class="hide-toggle" name="attr_syncStateAilment" value="true">
	<div class="hide-item syncIcon"></div>
	</div>


<span data-i18n="editor-customailments">Custom Ailments</span>

<label for="hideAilmentSettings" class="arrowholder"><input type="checkbox" class="switch-toggle" id="hideAilmentSettings" name="attr_hideAilmentSettings" value="true" style="display: none;"><div class="arrow"></div></label></h3>

<input type="checkbox" class="hide-toggle-rev" name="attr_hideAilmentSettings" value="true" hidden="true">
<div class="hide-item-rev" style="width: 100%;">

	<textarea spellcheck="false" class="half" name="attr_ailmentEditor" data-i18n-placeholder="editor-customailments-textedit" placeholder="Custom Ailments Editor"></textarea>


<!-- menu -->
<div class="rowContainer">

<button type="action" name="act_clearAilment" data-i18n="clear-button" class="btn">Clear</button>


<button type="action" name="act_syncAilment" data-i18n="sync-button" class="btn">Sync Data</button>


<div>
<label for="ailmentCollapse">
<div class="btn rowContainer centerFlex" style="width: 40px;"> <input type="checkbox" id="ailmentCollapse" class="switch-toggle" name="attr_settingCustomCollapse" value="true" style="display: none !important"><div class="smallarrow"></div></div>
</label>
</div>

<button type="action" name="act_exportRepeating" data-i18n="message-export" class="btn">Export</button>

  <select name="attr_customImportMode" class="darkInput" style="width: 100px;">
    <option data-i18n="import-type-replace" value="Replace" selected>Replace</option>
    <option data-i18n="import-type-add" value="Add">Add</option>
  </select>

<button type="action" name="act_importRepeating" data-i18n="message-import" class="btn">Import</button>


</div>

<!-- menu -->

<div class="ailmentCustomEditor rowContainer">

<fieldset class="repeating_ailments">
<button type="action" class="copyButton" name="act_copycustom"></button>

<input type="checkbox" class="switch-toggle" name="attr_ailDisplay" value="true" hidden="true" checked>
<button type="action" class="displayButton" name="act_displaycustom"></button>

<div class="columnAlign">

<div class="rowContainer settingStyle">

	<!-- Icon selector -->
	<div class="ailmentIconSelector rowContainer centerFlex">

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Question" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
<input type="checkbox" class="expand-toggle" value="0" name="attr_ailIcon"><div class="type-image skillIcon question"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Burn" name="attr_ailIcon"><div class="type-image skillIcon burn"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Charge" name="attr_ailIcon"><div class="type-image skillIcon charge"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Protection" name="attr_ailIcon"><div class="type-image skillIcon protection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Strength" name="attr_ailIcon"><div class="type-image skillIcon strength"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Haste" name="attr_ailIcon"><div class="type-image skillIcon haste"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Bind" name="attr_ailIcon"><div class="type-image skillIcon bind"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Panic" name="attr_ailIcon"><div class="type-image skillIcon panic"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile"></div>
	</div>

<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Burn" name="attr_ailIcon"><div class="type-image skillIcon burn-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bleed" name="attr_ailIcon"><div class="type-image skillIcon bleed-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Paralysis" name="attr_ailIcon"><div class="type-image skillIcon paralysis-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Smoke" name="attr_ailIcon"><div class="type-image skillIcon smoke-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Charge" name="attr_ailIcon"><div class="type-image skillIcon charge-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fortune" name="attr_ailIcon"><div class="type-image skillIcon fortune-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fragile" name="attr_ailIcon"><div class="type-image skillIcon fragile-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Protection" name="attr_ailIcon"><div class="type-image skillIcon protection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/StaggerProtection" name="attr_ailIcon"><div class="type-image skillIcon staggerprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Strength" name="attr_ailIcon"><div class="type-image skillIcon strength-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Feeble" name="attr_ailIcon"><div class="type-image skillIcon feeble-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Endurance" name="attr_ailIcon"><div class="type-image skillIcon endurance-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Disarm" name="attr_ailIcon"><div class="type-image skillIcon disarm-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Haste" name="attr_ailIcon"><div class="type-image skillIcon haste-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bind" name="attr_ailIcon"><div class="type-image skillIcon bind-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Hostile" name="attr_ailIcon"><div class="type-image skillIcon hostile-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Panic" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PanicBlue" name="attr_ailIcon"><div class="type-image skillIcon panic-limbus-blue"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Rupture" name="attr_ailIcon"><div class="type-image skillIcon rupture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Tremor" name="attr_ailIcon"><div class="type-image skillIcon tremor-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorChain" name="attr_ailIcon"><div class="type-image skillIcon tremorchain-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDecay" name="attr_ailIcon"><div class="type-image skillIcon tremordecay-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorDistribution" name="attr_ailIcon"><div class="type-image skillIcon tremordistribution-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorEverlasting" name="attr_ailIcon"><div class="type-image skillIcon tremoreverlasting-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorFracture" name="attr_ailIcon"><div class="type-image skillIcon tremorfracture-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorReverb" name="attr_ailIcon"><div class="type-image skillIcon tremorreverb-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TremorSuperposition" name="attr_ailIcon"><div class="type-image skillIcon tremorsuperposition-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sinking" name="attr_ailIcon"><div class="type-image skillIcon sinking-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poise" name="attr_ailIcon"><div class="type-image skillIcon poise-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Frostbite" name="attr_ailIcon"><div class="type-image skillIcon frostbite-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Poison" name="attr_ailIcon"><div class="type-image skillIcon poison-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Nails" name="attr_ailIcon"><div class="type-image skillIcon nails-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ruin" name="attr_ailIcon"><div class="type-image skillIcon ruin-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Devastation" name="attr_ailIcon"><div class="type-image skillIcon devastation-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Critical" name="attr_ailIcon"><div class="type-image skillIcon critical-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Aggro" name="attr_ailIcon"><div class="type-image skillIcon aggro-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Ammo" name="attr_ailIcon"><div class="type-image skillIcon ammo-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Bullseye" name="attr_ailIcon"><div class="type-image skillIcon bullseye-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Barrier" name="attr_ailIcon"><div class="type-image skillIcon barrier-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Duel" name="attr_ailIcon"><div class="type-image skillIcon duel-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Fist" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FistGreen" name="attr_ailIcon"><div class="type-image skillIcon fist-limbus-green"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Heal" name="attr_ailIcon"><div class="type-image skillIcon heal-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/KAmpule" name="attr_ailIcon"><div class="type-image skillIcon kampule-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/TTime" name="attr_ailIcon"><div class="type-image skillIcon ttime-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/RottingSkin" name="attr_ailIcon"><div class="type-image skillIcon rottingskin-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="Blood" name="attr_ailIcon"><div class="type-image skillIcon blood"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/FragileStagger" name="attr_ailIcon"><div class="type-image skillIcon fragilestagger-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashProtection" name="attr_ailIcon"><div class="type-image skillIcon slashprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceProtection" name="attr_ailIcon"><div class="type-image skillIcon pierceprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntProtection" name="attr_ailIcon"><div class="type-image skillIcon bluntprotection-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/SlashFragility" name="attr_ailIcon"><div class="type-image skillIcon slashfragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/PierceFragility" name="attr_ailIcon"><div class="type-image skillIcon piercefragility-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/BluntFragility" name="attr_ailIcon"><div class="type-image skillIcon bluntfragility-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Wrath" name="attr_ailIcon"><div class="type-image skillIcon wrath-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Lust" name="attr_ailIcon"><div class="type-image skillIcon lust-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Sloth" name="attr_ailIcon"><div class="type-image skillIcon sloth-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gluttony" name="attr_ailIcon"><div class="type-image skillIcon gluttony-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Gloom" name="attr_ailIcon"><div class="type-image skillIcon gloom-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Pride" name="attr_ailIcon"><div class="type-image skillIcon pride-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/Envy" name="attr_ailIcon"><div class="type-image skillIcon envy-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageUp" name="attr_ailIcon"><div class="type-image skillIcon damageup-limbus"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="limbus/DamageDown" name="attr_ailIcon"><div class="type-image skillIcon damagedown-limbus"></div>
	</div>

	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Style" name="attr_ailIcon"><div class="type-image skillIcon style-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Thorns" name="attr_ailIcon"><div class="type-image skillIcon thorns-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Rhythm" name="attr_ailIcon"><div class="type-image skillIcon rhythm-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Frenzy" name="attr_ailIcon"><div class="type-image skillIcon frenzy-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Shock" name="attr_ailIcon"><div class="type-image skillIcon shock-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/Terror" name="attr_ailIcon"><div class="type-image skillIcon terror-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageUp" name="attr_ailIcon"><div class="type-image skillIcon staggerdamageup-community"></div>
	</div>
	<div class="icon">
	<input type="checkbox" class="expand-toggle" value="community/StaggerDamageDown" name="attr_ailIcon"><div class="type-image skillIcon staggerdamagedown-community"></div>
	</div>


	<!-- Icon selector END -->

</div>

<input type="text" name="attr_ailName" class="transpInput" data-i18n-placeholder="message-ailname-placeholder" placeholder="Ailment Name">
<input type="number" name="attr_ailNum" hidden="true">
<input type="number" name="attr_ailNumNextTurn" hidden="true">
<input type="number" name="attr_ailDecayPause" hidden="true" value="0">

</div>

<input type="checkbox" class="hide-toggle-rev" name="attr_ailCollapse" value="true" hidden="true">
<div class="hide-item-rev rowContainer" style="margin-top: 3px;">
<div class="rowContainer settingStyle">

<div class="customAilText">
<span data-i18n="message-icon">Icon</span>:
</div>

<input name="attr_ailIcon" list="iconlist" type="text" placeholder="Type for icon selection." value="Question">
</div>

<div class="rowContainer settingStyle">

<div class="customAilText">
<span data-i18n="message-trigger">Trigger</span>:
</div>

  <select name="attr_ailTrigger" class="whiteInput" style="width: 210px;">
    <option data-i18n="message-none" value="None" selected>None</option>
    <option data-i18n="trigger-roundend" value="RoundEnd">Round End</option>
    <option data-i18n="trigger-onaction" value="OnAction">On Action</option>
	<option data-i18n="trigger-whenhit" value="WhenHit">When Hit</option>
  </select>

</div>

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-next-turn-field">Has next turn field</span>:
	</div>

	<select name="attr_ailNextTurn" class="whiteInput" style="width: 105px">
		<option data-i18n="true" value="true" selected>True</option>
		<option data-i18n="false" value="false">False</option>
	</select>
</div>

<input type="checkbox" class="fade-toggle" name="attr_ailTrigger" value="None" hidden="true" checked>

<div class="hide-item columnAlign">

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-hit-trigger-damage-type">Trigger dmg type</span>:
	</div>

	<select name="attr_ailDamageTypeTrigger" class="whiteInput" style="width: 105px">
		<option data-i18n="when-hit-damage-any" value="Any" selected>Any</option>
		<option data-i18n="weapon-type-Slash" value="Slash">Slash</option>
		<option data-i18n="weapon-type-Pierce" value="Pierce">Pierce</option>
		<option data-i18n="weapon-type-Blunt" value="Blunt">Blunt</option>
	</select>
</div>

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-hit-resistance-mode">Resistance mode</span>:
	</div>

	<select name="attr_ailBeforeResistance" class="whiteInput" style="width: 105px">
		<option data-i18n="when-hit-mode-beforeResistance" value="beforeResistance" selected>Before Resistance</option>
		<option data-i18n="when-hit-mode-afterResistance" value="afterResistance">After Resistance</option>
	</select>
</div>

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-hit-decaywhenhit">Decay when hit</span>:
	</div>

	<select name="attr_ailDecayWhenHit" class="whiteInput" style="width: 105px">
		<option data-i18n="true" value="true" selected>True</option>
		<option data-i18n="false" value="false">False</option>
	</select>
</div>

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-hit-decayroundend">Decay round end</span>:
	</div>

	<select name="attr_ailDecayRoundEnd" class="whiteInput" style="width: 105px">
		<option data-i18n="true" value="true" selected>True</option>
		<option data-i18n="false" value="false">False</option>
	</select>
</div>

<input type="checkbox" class="hide-toggle-rev" name="attr_ailEffectVal" value="-n">
<input type="checkbox" class="hide-toggle-rev" name="attr_ailBeforeResistance" value="beforeResistance">
<div class="rowContainer settingStyle hide-item-rev">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-positive-type">Positive type</span>:
	</div>

	<select name="attr_ailPositiveType" class="whiteInput" style="width: 105px">
		<option data-i18n="positive-type-regen" value="Regen" selected>Regen</option>
		<option data-i18n="positive-type-reduction" value="Reduction">Reduction</option>
	</select>
</div>

</div>

<div class="rowContainer settingStyle">
	<div class="customAilText" style="width: 135px !important;">
		<span data-i18n="message-has-custom-resistance">Custom resistance</span>:
	</div>

	<select name="attr_ailCustomResistance" class="whiteInput" style="width: 105px">
		<option data-i18n="false" value="false" selected>False</option>
		<option data-i18n="true" value="true">True</option>
	</select>
</div>

<div class="rowContainer settingStyle">

	<div class="customAilText">
		<span data-i18n="message-effect">Effect</span>:
		</div>
		
		<select name="attr_ailEffect" class="whiteInput" style="width: 105px;">
			<option data-i18n="message-none" value="None" selected>None</option>
			<option data-i18n="bar-health-and-stagres" value="HPStagRes">Health and Stagger</option>
			<option data-i18n="bar-health" value="HP">Health</option>
			<option data-i18n="bar-stagres" value="StagRes">Stagger</option>
			<option data-i18n="bar-health-temp" value="THP">Temp HP</option>
			<option data-i18n="bar-stagres-temp" value="TST">Temp ST</option>
			<option data-i18n="bar-sanity" value="SP">Sanity</option>
			<option data-i18n="bar-light" value="Light">Light</option>
			<option data-i18n="distort-counter-full" value="distortCounter">Distortion Counter</option>
			<option data-i18n="helper-text-difficulty" value="difficulty">Difficulty</option>
		</select>

		<!-- Used by Temp HP and Temp ST -->
		<input type="number" name="attr_ailTempBarOverride" value="0" hidden="true">
		
		<select name="attr_ailEffectMode" class="darkInput" style="width: 40px;">
			<option value="+" selected>+</option>
			<option value="x">x</option>
			<option value="=">=</option>
		</select>
		
		<input type="text" name="attr_ailEffectVal" style="width: 40px;" value="-n">
		</div>

		<div class="rowContainer settingStyle">
		
		<div class="customAilText">
		<span data-i18n="message-decay">Decay</span>:
		</div>
		
		  <select name="attr_ailDecayMin" class="whiteInput" style="width: 105px">
			<option data-i18n="decay-min-1" value="1" selected>Count (Min: 1)</option>
			<option data-i18n="decay-min-0" value="0">Count (Min: 0)</option>
		  </select>
		
		  <select name="attr_ailDecayMode" class="darkInput" style="width: 40px;">
			<option value="+">+</option>
			<option value="x">x</option>
			<option value="=" selected>=</option>
		  </select>
		
		 <input type="text" name="attr_ailDecayVal" style="width: 40px;" value="0">
	
	</div>

<input type="checkbox" class="fade-toggle" name="attr_ailMax" value="0" hidden="true" checked>
<div class="rowContainer settingStyle">


<div class="customAilText">
<span data-i18n="message-max">Max</span>:
</div>

<div class="settingStyle">
 <input type="number" name="attr_ailMax" style="width: 40px;" min="0" value="0">

<select name="attr_ailMaxBehavior" class="transpInput" type="text" style="width: 140px;">
    <option data-i18n="max-none" value="None" selected>No Override</option>
    <option data-i18n="max-clear" value="Clear">Clear on Max</option>
    <option data-i18n="max-effect" value="Effect">Effect on Max</option>
    <option data-i18n="max-decay" value="Decay">Decay on Max</option>
    <option data-i18n="max-effectdecay" value="EffectDecay">Effect + Decay on Max</option>
   <option data-i18n="max-effectclear" value="EffectClear">Effect + Clear on Max</option>

</select>
</div>

</div>

<input type="checkbox" class="fade-toggle" name="attr_ailMessageCheck" value="0" hidden="true" checked>
<div class="columnAlign settingStyle">

 <select name="attr_ailMessageCheck" class="darkInput" value="0">
    <option data-i18n="message-nomessage" value="0" selected>No Message</option>
    <option data-i18n="message-sendmessage" value="true">Send Message</option>
  </select>

<div>
 <textarea name="attr_ailMessage" data-i18n="message-custom-placeholder" value="[CHAR]: [DIFF] damage from [AIL]">[CHAR]: [DIFF] damage from [AIL]</textarea>
</div>

</div>
</div>

</div>
</div>


</div>

</fieldset>
</div>

</div>
<!-- Custom Ailment section END -->



</div>
<!-- Icon Selector Data -->
<datalist id="iconlist">
    <option value="None">None</option>
    <option value="Question">Question</option>

    <option value="Burn">Burn</option>
    <option value="Bleed">Bleed</option>
    <option value="Paralysis">Paralysis</option>
    <option value="Smoke">Smoke</option>
    <option value="Charge">Charge</option>
    <option value="Fortune">Fortune</option>
    <option value="Fragile">Fragile</option>
	<option value="FragileStagger">Stagger Fragile</option>
    <option value="Protection">Protection</option>
    <option value="StaggerProtection">Stagger Protection</option>
    <option value="Strength">Strength</option>
    <option value="Feeble">Feeble</option>
    <option value="Endurance">Endurance</option>
    <option value="Disarm">Disarm</option>
    <option value="Haste">Haste</option>
    <option value="Bind">Bind</option>
    <option value="Panic">Panic</option>
    <option value="Hostile">Hostile</option>

    <option value="limbus/Burn">Burn (Limbus)</option>
    <option value="limbus/Bleed">Bleed (Limbus)</option>
    <option value="limbus/Paralysis">Paralysis (Limbus)</option>
    <option value="limbus/Smoke">Smoke (Limbus)</option>
    <option value="limbus/Charge">Charge (Limbus)</option>
    <option value="limbus/Fortune">Fortune (Limbus)</option>
    <option value="limbus/Fragile">Fragile (Limbus)</option>
	<option value="limbus/FragileStagger">Stagger Fragile (Limbus)</option>
    <option value="limbus/Protection">Protection (Limbus)</option>
    <option value="limbus/StaggerProtection">Stagger Protection (Limbus)</option>
    <option value="limbus/Strength">Strength (Limbus)</option>
    <option value="limbus/Feeble">Feeble (Limbus)</option>
    <option value="limbus/Endurance">Endurance (Limbus)</option>
    <option value="limbus/Disarm">Disarm (Limbus)</option>
    <option value="limbus/Haste">Haste (Limbus)</option>
    <option value="limbus/Bind">Bind (Limbus)</option>
    <option value="limbus/Hostile">Hostile (Limbus)</option>

    <option value="limbus/Rupture">Rupture (Limbus)</option>
    <option value="limbus/Tremor">Tremor (Limbus)</option>
	<option value="limbus/TremorChain">Tremor Chain (Limbus)</option>
	<option value="limbus/TremorDecay">Tremor Decay (Limbus)</option>
	<option value="limbus/TremorDistribution">Tremor Distribution (Limbus)</option>
	<option value="limbus/TremorEverlasting">Tremor Everlasting (Limbus)</option>
	<option value="limbus/TremorFracture">Tremor Fracture (Limbus)</option>
	<option value="limbus/TremorReverb">Tremor Reverb (Limbus)</option>
	<option value="limbus/TremorSuperposition">Tremor Superposition (Limbus)</option>
    <option value="limbus/Sinking">Sinking (Limbus)</option>
    <option value="limbus/Poise">Poise (Limbus)</option>
    <option value="limbus/Panic">Panic: !!! (Limbus)</option>
    <option value="limbus/PanicBlue">Panic: Brain (Limbus)</option>
    <option value="limbus/Frostbite">Frostbite (Limbus)</option>
    <option value="limbus/Poison">Poison (Limbus)</option>
    <option value="limbus/Nails">Nails (Limbus)</option>
    <option value="limbus/Ruin">Ruin (Limbus)</option>
    <option value="limbus/Devastation">Devastation (Limbus)</option>
    <option value="limbus/Critical">Critical (Limbus)</option>

    <option value="limbus/Aggro">Aggro (Limbus)</option>
    <option value="limbus/Bullseye">Bullseye (Limbus)</option>
    <option value="limbus/Ammo">Ammo (Limbus)</option>
    <option value="limbus/Barrier">Charge Barrier (Limbus)</option>
    <option value="limbus/Duel">Duel (Limbus)</option>
    <option value="limbus/Fist">Fist: Red (Limbus)</option>
    <option value="limbus/FistGreen">Fist: Green (Limbus)</option>
    <option value="limbus/Heal">Heal (Limbus)</option>
    <option value="limbus/KAmpule">K-Corp Ampule (Limbus)</option>
    <option value="limbus/TTime">T-Corp Time (Limbus)</option>
	<option value="limbus/RottingSkin">Rotting Skin (Limbus)</option>

	<option value="Blood">Blood</option>

    <option value="limbus/SlashProtection">Slash Protection (Limbus)</option>
    <option value="limbus/PierceProtection">Pierce Protection (Limbus)</option>
    <option value="limbus/BluntProtection">Blunt Protection (Limbus)</option>
    <option value="limbus/SlashFragility">Slash Fragility (Limbus)</option>
    <option value="limbus/PierceFragility">Pierce Fragility (Limbus)</option>
    <option value="limbus/BluntFragility">Blunt Fragility (Limbus)</option>

    <option value="limbus/Wrath">Wrath (Limbus)</option>
    <option value="limbus/Lust">Lust (Limbus)</option>
    <option value="limbus/Sloth">Sloth (Limbus)</option>
    <option value="limbus/Gluttony">Gluttony (Limbus)</option>
    <option value="limbus/Gloom">Gloom (Limbus)</option>
    <option value="limbus/Pride">Pride (Limbus)</option>
    <option value="limbus/Envy">Envy (Limbus)</option>

	<option value="limbus/DamageUp">Damage Up (Limbus)</option>
	<option value="limbus/DamageDown">Damage Down (Limbus)</option>

    <option value="community/Style">Style (Community)</option>
    <option value="community/Thorns">Thorns (Community)</option>
    <option value="community/Rhythm">Rhythm (Community)</option>

    <option value="community/Frenzy">Frenzy (Community)</option>
    <option value="community/Shock">Shock (Community)</option>
    <option value="community/Terror">Terror (Community)</option>
    <option value="community/StaggerDamageUp">Stagger Damage Up (Community)</option>
    <option value="community/StaggerDamageDown">Stagger Damage Down (Community)</option>
</datalist> 

<!-- Icon Selector Data END -->


	</div>
	</div>
<!-- Sheet Editor END -->


<br><br><br><br><br><br><br><br><br>

<rolltemplate class="sheet-rolltemplate-errorMessage">
    <div class="sheet-template-wrapper" style="background-color: #350909; border-radius: 5px; color: #fff; padding: 5px;">
       {{icon}} {{message}}
    </div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-damagecalculation">
    <div class="sheet-template-wrapper" style="background-color: #454545; border-radius: 5px; color: #eee; height: auto; padding: 5px; overflow: hidden;">
		<div style="background-color: #222; height: 30px; border: 2px #000 solid; color: #fff">
			<div style="float: left; height: 30px; width: 30px; margin-right: 7px; background-image: linear-gradient(to bottom right, #c25944 0% ,#c25944 50% ,#dbb748 50% , #dbb748 100%)">
				{{icon}}
			</div>
			<div style="width: 55% ; overflow: hidden ; height: 20px ; padding-top: 5px ; float: left"><b>{{#title}}{{title}}{{/title}}</b></div>
		</div>
		<div><b>For: </b>{{#name}}{{name}}{{/name}}</div>
		<div>{{#damagecalculations}} {{damagecalculations}} {{/damagecalculations}}</div>
	</div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-autoeffect">
    <div class="sheet-template-wrapper" style="background-color: #454545; border-radius: 5px; color: #eee; height: auto; padding: 5px; overflow: hidden;">
		<div style="background-color: #222; height: 30px; border: 2px #000 solid; color: #fff">
			<div style="float: left; height: 30px; width: 30px; margin-right: 7px; background-color: #85a874;">
				{{icon}}
			</div>
			<div style="width: 80% ; overflow: hidden ; height: 20px ; padding-top: 5px ; float: left"><b>{{#title}}{{title}}{{/title}}</b></div>
		</div>
		<div><b>For: </b>{{#name}}{{name}}{{/name}}</div>
		<div>{{#message}} {{message}} {{/message}}</div>
	</div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-message">
    <div class="sheet-template-wrapper" style="background-color: #333; border-radius: 5px; color: #fff; padding: 5px;">

       {{icon}} {{#name}}<b>{{name}}</b>{{/name}}{{message}}
	{{#roll1}} {{roll1}} {{/roll1}}
    </div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-shareB">
    	<div class="sheet-template-wrapper" style="background-color: #333; border-radius: 5px;  overflow: hidden; border: 1px #555 solid;">
    		<div class="sheet-template-wrapper" style="color: #fff; position: relative;">

		{{header}}

		{{body}}

		</div>
	</div>

</rolltemplate>

<rolltemplate class="sheet-rolltemplate-baseRoll">
    <div class="sheet-template-wrapper" style="background-color: #454545; border-radius: 5px; color: #eee; height: auto; padding: 5px; overflow: hidden;">
	<div style="position: relative;">
	{{#infodump}} {{infodump}} {{/infodump}}
	{{#roll1}}
	<div style="position: absolute; top: 2px; right: 0px;"><h4 style="background-color: #000; height: 25px; min-width: 30px; padding-left: 3px; padding-right: 3px; text-align: center; padding-top: 6px;">
		{{#allprops() infodump advantage}}
		{{value}}
		{{/allprops() infodump advantage}}
	</div>
	{{/roll1}}

	{{#challenge}}
	{{#roll1}}
	<div style="text-align: center; margin-top: 5px;">
	{{#rollLess() roll1 7}}
	<b data-i18n="message-failure">Failure...</b> <img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/bad.png" style="width: 25px; height: 25px;">
	{{/rollLess() roll1 7}}

	{{#rollBetween() roll1 7 9}}
	<b data-i18n="message-normal">Partial Success</b> <img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/normal.png" style="width: 25px; height: 25px;">
	{{/rollBetween() roll1 7 9}}

	{{#rollGreater() roll1 9}}
	<b data-i18n="message-success">Success!</b> <img src="https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/good.png" style="width: 25px; height: 25px;">
	{{/rollGreater() roll1 9}}

	</div>
 	{{/roll1}}
	{{/challenge}}

	</div>


    </div>
</rolltemplate>

<!-- Chat message action buttons -->
<div style="display:none">
<button type="action" name="act_selectToken"></button>
<button type="action" name="act_deleteTokenMultiple"></button>
<button type="action" name="act_actionButtonDamage"></button>
<button type="action" name="act_actionButtonInflict"></button>
<button type="action" name="act_actionButtonGive"></button>
</div>

<rolltemplate class="sheet-rolltemplate-actionbuttons">
    <div class="sheet-actionButtonBlocker{{whisperMode}}"></div>
	
	<div class="sheet-actionButtonContainer">{{#buttonlabel0}}<div class="sheet-button {{color0}}">[x]({{icon0}})[{{buttonlabel0}}](~{{computed::targetid0}}|{{buttonlink0}}||{{computed::datapackage0}})</div>{{/buttonlabel0}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel1}}<div class="sheet-button {{color1}}">[x]({{icon1}})[{{buttonlabel1}}](~{{computed::targetid1}}|{{buttonlink1}}||{{computed::datapackage1}})</div>{{/buttonlabel1}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel2}}<div class="sheet-button {{color2}}">[x]({{icon2}})[{{buttonlabel2}}](~{{computed::targetid2}}|{{buttonlink2}}||{{computed::datapackage2}})</div>{{/buttonlabel2}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel3}}<div class="sheet-button {{color3}}">[x]({{icon3}})[{{buttonlabel3}}](~{{computed::targetid3}}|{{buttonlink3}}||{{computed::datapackage3}})</div>{{/buttonlabel3}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel4}}<div class="sheet-button {{color4}}">[x]({{icon4}})[{{buttonlabel4}}](~{{computed::targetid4}}|{{buttonlink4}}||{{computed::datapackage4}})</div>{{/buttonlabel4}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel5}}<div class="sheet-button {{color5}}">[x]({{icon5}})[{{buttonlabel5}}](~{{computed::targetid5}}|{{buttonlink5}}||{{computed::datapackage5}})</div>{{/buttonlabel5}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel6}}<div class="sheet-button {{color6}}">[x]({{icon6}})[{{buttonlabel6}}](~{{computed::targetid6}}|{{buttonlink6}}||{{computed::datapackage6}})</div>{{/buttonlabel6}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel7}}<div class="sheet-button {{color7}}">[x]({{icon7}})[{{buttonlabel7}}](~{{computed::targetid7}}|{{buttonlink7}}||{{computed::datapackage7}})</div>{{/buttonlabel7}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel8}}<div class="sheet-button {{color8}}">[x]({{icon8}})[{{buttonlabel8}}](~{{computed::targetid8}}|{{buttonlink8}}||{{computed::datapackage8}})</div>{{/buttonlabel8}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel9}}<div class="sheet-button {{color9}}">[x]({{icon9}})[{{buttonlabel9}}](~{{computed::targetid9}}|{{buttonlink9}}||{{computed::datapackage9}})</div>{{/buttonlabel9}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel10}}<div class="sheet-button {{color10}}">[x]({{icon10}})[{{buttonlabel10}}](~{{computed::targetid10}}|{{buttonlink10}}||{{computed::datapackage10}})</div>{{/buttonlabel10}}</div>
	<div class="sheet-actionButtonContainer">{{#buttonlabel11}}<div class="sheet-button {{color11}}">[x]({{icon11}})[{{buttonlabel11}}](~{{computed::targetid11}}|{{buttonlink11}}||{{computed::datapackage11}})</div>{{/buttonlabel11}}</div>

</rolltemplate>


<script type="text/worker">

//-------------------------------------------------------------------------------------
// orcsAsync
// Compensates for a defect in the underlying Roll20 system, where it "loses context"
// (forgets which player is active) during asynchronous methods and callbacks, 
// resulting in error messages like:
//
//      Error: Trying to do getAttrs when no character is active in sandbox.
//
// Include this script at the top of your character sheet's code setion to have 
// setTimeout() and setInterval() just start working as expected; no additional setup
// required.  Additionally, async-safe versions of the typical attribute functions will 
// be available:
//
//      getAttrsAsync
//      setAttrsAsync
//      getSectionIDsAsync
//      
function isRunningOnServer() { return self.dispatchEvent == undefined; }
function setActiveCharacterId(charId){
    var oldAcid=getActiveCharacterId();
    var msg={"id":"0", "type":"setActiveCharacter", "data":charId};
    
    if(isRunningOnServer()==false){ //if in a browser, use "dispatchEvent" to process the message
        var ev = new CustomEvent("message");
        ev.data=msg; 
        self.dispatchEvent(ev);
    }else{ //otherwise, use the API (server) message processor, "onmessage"
        self.onmessage({data:msg});
    }
    return oldAcid; //return what the value used to be, so calling code can be a little cleaner 
} 
var _sIn=setInterval;
setInterval=function(callback, timeout){
    var acid=getActiveCharacterId();
    _sIn(
        function(){
            var prevAcid=setActiveCharacterId(acid);
            callback();
            setActiveCharacterId(prevAcid);
        }
    ,timeout);
}
var _sto=setTimeout
setTimeout=function(callback, timeout){
    var acid=getActiveCharacterId();
    _sto(
        function(){
            var prevAcid=setActiveCharacterId(acid);
            callback();
            setActiveCharacterId(prevAcid);
        }
    ,timeout);
}
function getAttrsAsync(props){
    var acid=getActiveCharacterId(); //save the current activeCharacterID in case it has changed when the promise runs 
    var prevAcid=null;               //local variable defined here, because it needs to be shared across the promise callbacks defined below
    return new Promise((resolve,reject)=>{
            prevAcid=setActiveCharacterId(acid);  //in case the activeCharacterId has changed, restore it to what we were expecting and save the current value to restore later
            try{
                getAttrs(props,(values)=>{  resolve(values); }); 
            }
            catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); //restore activeCharcterId to what it was when the promise first ran
    });
}
//use the same pattern for each of the following...
function setAttrsAsync(propObj, options){
    var acid=getActiveCharacterId(); 
    var prevAcid=null;               
    return new Promise((resolve,reject)=>{
            prevAcid=setActiveCharacterId(acid);  
            try{
                setAttrs(propObj,options,(values)=>{ resolve(values); });
            }
            catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); 
    });
}

function getSectionIDsAsync(sectionName){
    var acid = getActiveCharacterId(); 
    var prevAcid=null;               
    return new Promise((resolve,reject)=>{
            prevAcid = setActiveCharacterId(acid);  
            try{
                getSectionIDs(sectionName,(values)=>{ resolve(values); });
            }
            catch{ reject(); }
    }).finally(()=>{
        setActiveCharacterId(prevAcid); 
    });
}



/* Update Loop begins */
let loopDelay = 10000;
let trackerItemName = "Round end";
on('sheet:opened change:settingLoopEnabled change:configLoopDelay change:configTrackerItemName change:prevRoundInitAttempts', (info) => {
	getAttrs(["settingLoopEnabled", "configLoopDelay", "configTrackerItemName"], function(values) {
		setAttrs({"loopEnabled":"false"});
		if (values.settingLoopEnabled == "true") {
			loopDelay = parseInt(values.configLoopDelay);
			trackerItemName = values.configTrackerItemName;
			restartLoop();
		} else {
			setAttrs({"prevRoundInit": 0, "prevRoundInitAttempts":1});
		}
	});
});
function restartLoop() {
	setTimeout(function() {
		//console.log("reset complete")
		setAttrs({"loopEnabled":"true"});
	}, loopDelay + 1000);
}

on('change:loopEnabled', (info) => {
	if (info.newValue == "true") {
		//console.log("beginning loop")
		stepLoop();
	}
});
function stepLoop() {
	setTimeout(function() {
		getAttrs(["loopEnabled", "prevRoundInitAttempts"], async function(values) {
			//console.log(values.prevRoundInitAttempts)
			if (values.loopEnabled == "true" && parseInt(values.prevRoundInitAttempts) < 6) {
				
				/* Auto: Update */
				let newRoundInit = await getInitiative(trackerItemName);
				if (newRoundInit == "") {
					setAttrs({prevRoundInitAttempts: parseInt(values.prevRoundInitAttempts) + 1});
				} else {
					setAttrs({prevRoundInit: newRoundInit, prevRoundInitAttempts: 0});
				}

				/* Sync: Target Ailment/Bar lists */
				getAttrs(["targetName", "targetSettings"], async function(values) {
					if (values.targetName != "" && !values.targetName.includes("@{target|")) {
						updateTargetAilmentList();
						updateTargetBarLists();
					}

					let targetSettings = Data.unpackage(values.targetSettings);
					if (targetSettings.hideDetailsFromTargeting == "true") {
						unknownTarget();
					}
				});

				setTimeout(stepLoop, loopDelay);
			} else {
				//console.log("ending loop");
			}
		});
	});
}

async function getInitiative(trackerName="") {
	let selectAttrs = {}
	let rollBase = `! {{trackerInitiative=[[0[@{tracker|${trackerName}}]]]}}`;
	let selectRoll = await startRoll(rollBase);
	let trackerInitiative =  selectRoll.results.trackerInitiative.expression.match(/^0\[(.*)\]\s*$/)[1]
	finishRoll(selectRoll.rollId);
	return trackerInitiative;
}
on('change:prevRoundInit', (info) => {
	if (parseInt(info.newValue) < parseInt(info.previousValue)) {
		Update();
	}
})
/* Update Loop ends */



/* --- Token interaction functions  --- */

/* Select token instance functionality */
on('clicked:selectToken', async function(info) {
	getTokenAttrs("selected", "select", "true");
});
on('clicked:repeating_tokens:selectinstance', async function(info) {
	setAttrs({"tokenId_selected":info.sourceAttribute.replace("repeating_tokens_","").replace("_selectinstance","")});
});

/* Gets the tokenId, tokenName and bar values of a token. Also gets the bar and bar max values from the sheet */
/* setSelectModes: select (always set selection or bars), false (do not set selection or bars), unset (set if unset)*/
function getTokenAttrs(target="selected", setSelectMode="false", queryGenericMode="false", callback=()=>{}) {
	getAttrs(["tokenId_selected"], function(values) {
		let tokenId_selected = values.tokenId_selected;
	
	/* If setting is disabled, ask if it should be enabled. Continue if yes */
	checkGenericMode(queryGenericMode, async function(genericModeCheck) {
		if (genericModeCheck == "false") { return; }

		/* Get selected token attributes */
		let selectAttrs = {}
		let rollBase = `! {{token_id=[[0[@{${target}|token_id}]]]}} {{token_name=[[0[@{${target}|token_name}]]]}}
			{{HP=[[0[@{${target}|HP}]]]}} {{StagRes=[[0[@{${target}|StagRes}]]]}} {{SP=[[0[@{${target}|SP}]]]}}
			{{HP_max=[[0[@{${target}|HP_max}]]]}} {{StagRes_max=[[0[@{${target}|StagRes_max}]]]}} {{SP_max=[[0[@{${target}|SP_max}]]]}}
			{{bar1=[[0[@{${target}|bar1}]]]}} {{bar2=[[0[@{${target}|bar2}]]]}} {{bar3=[[0[@{${target}|bar3}]]]}}`.replaceAll("\n","").replaceAll("\t","");
		
		let selectRoll = await startRoll(rollBase);
		selectAttrs = {
			tokenName: selectRoll.results.token_name.expression.match(/^0\[(.*)\]\s*$/)[1],
			tokenId: selectRoll.results.token_id.expression.match(/^0\[(.*)\]\s*$/)[1].replaceAll("_","Ø"),
			HP: selectRoll.results.HP.expression.match(/^0\[(.*)\]\s*$/)[1],
			StagRes: selectRoll.results.StagRes.expression.match(/^0\[(.*)\]\s*$/)[1],
			SP: selectRoll.results.SP.expression.match(/^0\[(.*)\]\s*$/)[1],
			HP_max: selectRoll.results.HP_max.expression.match(/^0\[(.*)\]\s*$/)[1],
			StagRes_max: selectRoll.results.StagRes_max.expression.match(/^0\[(.*)\]\s*$/)[1],
			SP_max: selectRoll.results.SP_max.expression.match(/^0\[(.*)\]\s*$/)[1],
			bar1: selectRoll.results.bar1.expression.match(/^0\[(.*)\]\s*$/)[1],
			bar2: selectRoll.results.bar2.expression.match(/^0\[(.*)\]\s*$/)[1],
			bar3: selectRoll.results.bar3.expression.match(/^0\[(.*)\]\s*$/)[1]
		}
		finishRoll(selectRoll.rollId);

		/* If token instance does not exist, ask if it should be added. Continue if yes */
		checkTokenInstance(selectAttrs, setSelectMode, async function(addTokenInstance) {
			if (addTokenInstance == "false") { return; };

		if (setSelectMode == "select" || setSelectMode == "add" || (setSelectMode == "unset" && tokenId_selected == "")) {
			setAttrs({"tokenId_selected":selectAttrs.tokenId});
		}

		/* If the token already exists, update its token bar values */
		getSectionIDs(`repeating_tokens`, async function(idarray) {
			if (idarray.includes(selectAttrs.tokenId.toLowerCase()) && setSelectMode != "false") {
				updateToken(selectAttrs, "tokenbars");
			}
		});

		callback(selectAttrs);
	});
	});
	});
}
/* Manipulate token instances functionality */
on('clicked:addToken', async function(info) {
	getTokenAttrs("selected", "add", "true", (selectAttrs) => {
		updateToken(selectAttrs);
	});
});
on('clicked:addTokenMultiple', async function(info) {
	addTokenMultiple();
});
function addTokenMultiple() {
	getTokenAttrs(`target|Target`, "add", "true", (selectAttrs) => {
		updateToken(selectAttrs);
		addTokenMultiple();
	});
}

on('clicked:deleteToken', async function(info) {
	getAttrs(["tokenId_selected"], function(values) {
		let selectedId = values.tokenId_selected;
		if (info.htmlAttributes != {}) {
			if (selectedId != "") {
				deleteToken(selectedId);
				setAttrs({"tokenId_selected":""});
			}
		} else {
			getTokenAttrs("selected", "false", "false", (selectAttrs) => {
				deleteToken(selectAttrs.tokenId);
				if (selectAttrs.tokenId == selectedId) {
					setAttrs({"tokenId_selected":""});
				}
			});
		}
	});
});
on('clicked:deleteTokenMultiple', async function(info) {
	getAttrs(["tokenId_selected"], async function(values) {
		let selectedId = values.tokenId_selected;
		deleteTokenMultiple(selectedId);
	});
});
function deleteToken(tokenId) {
	removeRepeatingRow("repeating_tokens_" + tokenId);
}
function deleteTokenMultiple(selectedId) {
	getTokenAttrs("target|Target", "false", "false", (selectAttrs) => {
		deleteToken(selectAttrs.tokenId);
		if (selectAttrs.tokenId == selectedId) {
			setAttrs({"tokenId_selected":""});
		};
		deleteTokenMultiple(selectedId);
	});
}

/* On changing the selected token, imports the status bars and ailments of that token */
on('change:tokenId_selected', (info) => {
	getAttrs(["tokenId_suppressUpdate", "settingGenericTokenMode"], function(values) {
		if (values.tokenId_suppressUpdate == "true") {
			setAttrs({"tokenId_suppressUpdate": "false"});
		} else {
			if (values.settingGenericTokenMode == "true") {
				/* Clears conditional buttons and re-generates any Permanent buttons */
				resetConditionals();
				AutoScriptMain("", "Permanent", "true", "true");

				updateSelectedToken(info);
			}
		}
	});
});
function updateSelectedToken(info, callback=()=>{}) {
	/* Clear the old selection if there was one */
	if (info.previousValue != undefined && info.newValue != undefined) {
		setAttrs({[`repeating_tokens_${info.previousValue}_token_selected`]:"false"});
	}

	/* Import values from new selection */
	if (info.newValue != undefined) {
		let tokenPrefix = `repeating_tokens_${info.newValue}`;
		let tokenValues = [`${tokenPrefix}_tokenAilmentList`];

		let barlist = ["HP", "StagRes", "SP", "Light"];
		barlist.forEach(bar => {
			tokenValues.push(`${tokenPrefix}_${bar}`/*, `${tokenPrefix}_${bar}_max`,*/);
		});

		let tempbarlist = ["THP", "TST"];
		tempbarlist.forEach(tempbar => {
			tokenValues.push(`${tokenPrefix}_token${tempbar}_Sources`);
		});

		let statelist = ["PanicState", "StaggerState", "StaggerDuration", "SealState", "ImmobileState", "DefeatState"];
		statelist.forEach(state => {
			tokenValues.push(`${tokenPrefix}_token${state}`, state);
		});

		getAttrs([...tokenValues], async function(values) {
			let output = {}

			/* Set bars to that of the token instance */
			barlist.forEach(bar => {
				output[`${bar}`] = values[`${tokenPrefix}_${bar}`];
				/*output[`${bar}_max`] = values[`${tokenPrefix}_${bar}_max`];*/
			});

			tempbarlist.forEach(tempbar => {
				/* For temp bar values from ailments, add an override to make sure any ailment list updates do not change the temp bar value */
				let tempBarSourceRaw = values[`${tokenPrefix}_token${tempbar}_Sources`];
				let tempBarSource = Data.unpackage(tempBarSourceRaw);
				for (const [sourceName, sourceVals] of Object.entries(tempBarSource)) {
					if (sourceName != "AutoEffects") {
						output[`${sourceName.replace("ailnum","ailTempBarOverride")}`] = sourceVals[0];
					}
				}
				output[`${tempbar}_Sources`] = tempBarSourceRaw;
			});

			/* If a state changes between token, suppress the change event listener for the state */
			statelist.forEach(state => {
				output[`${state}`] = values[`${tokenPrefix}_token${state}`];
				if (output[`${state}`] != values[`${state}`]) {
					output[`${state}SuppressUpdate`] = "true";
				}
			});

			/* Sets ailments to those of the token instance. If ailmentList is unset, initialize a new empty ailmentList */
			let ailmentList = values[`${tokenPrefix}_tokenAilmentList`];
			if (ailmentList != "") {
				importAilmentList(Data.unpackage(ailmentList));
			} else {
				resetAilments(() => {
					exportAilmentList({}, function(newAilmentList) {
						setAttrs({[`${tokenPrefix}_tokenAilmentList`]: Data.package(newAilmentList)});
					});
				});
			}

			/* Set new selection */
			output[`${tokenPrefix}_token_selected`] = "true";
			setAttrs(output, {}, () => {
				callback();
			});
		});
	}
}
function getSelectedToken(callback=()=>{}) {
	getAttrs(["tokenId_selected"], function(values) {
		callback(values.tokenId_selected);
	});
}

/* Hides token bar value in display if it matches that of the character sheet */
let barList = ["hp", "stagres", "sp", "light"];
barList.forEach(bar => {
	on(`change:repeating_tokens:${bar} change:repeating_tokens:${bar}_token`, (info) => {
		let attr_sheet = `${info.sourceAttribute}`;
		let attr_token = `${info.sourceAttribute}`;
		if (info.sourceAttribute.match(/_token/g).length == 2) {
			attr_sheet = `${info.sourceAttribute.replace(/_token([^_]*)$/, '$1')}`;
		} else {
			attr_token = `${info.sourceAttribute}` + "_token";
		}
		getAttrs(["settingGenericTokenMode", `${attr_sheet}`, `${attr_token}`], function(values) {
			if (values.settingGenericTokenMode == "true") {
				let bar_sheet = values[`${attr_sheet}`];
				let bar_token = values[`${attr_token}`];
				setAttrs({[`${attr_token + "_display"}`]:"" + (bar_sheet != bar_token)});
			}
		});
	});
});

/* Sync: Token Status bars */
barList.forEach(bar => {
	on(`change:${bar} change:repeating_tokens:${bar}`, (info) => {
		if (info.newValue != undefined) {
			getAttrs(["tokenId_selected", "settingGenericTokenMode"], function(values) {
				if (values.settingGenericTokenMode == "true") {
					let selectedId = values.tokenId_selected;
					if (selectedId != "") {
						if (barList.includes(info.sourceAttribute)) {
							setAttrs({[`repeating_tokens_${selectedId}_${bar}`]:info.newValue})
						}
						else if (info.sourceAttribute.includes(selectedId.toLowerCase())) {
							setAttrs({[`${bar}`]:info.newValue})
						}
					}
				}
			});
		}
	});
});

/* Sync: Token Temporary status bars */
let tempBarList = ["thp", "tst"];
tempBarList.forEach(tempBar => {
	on(`change:${tempBar}_sources`, (info) => {
		if (info.newValue != undefined) {
			getAttrs(["tokenId_selected", "settingGenericTokenMode"], function(values) {
				if (values.settingGenericTokenMode == "true") {
					let selectedId = values.tokenId_selected;
					if (selectedId != "") {
						if (tempBarList.includes(info.sourceAttribute.replace("_sources", ""))) {
							setAttrs({[`repeating_tokens_${selectedId}_token${tempBar}_sources`]:info.newValue});
						}
					}
				}
			});
		}
	});
});

/* Sync: Token States */
let stateList = ["panicstate", "staggerstate", "staggerduration", "sealstate", "immobilestate", "defeatstate"];
stateList.forEach(state => {
	on(`change:${state}`, (info) => {
		getAttrs(["tokenId_selected", "settingGenericTokenMode"], function(values) {
			if (values.settingGenericTokenMode == "true") {
				let selectedId = values.tokenId_selected;
				if (selectedId != "") {
					if (stateList.includes(info.sourceAttribute)) {
						/* newValue will in some cases not be set when decreasing staggerduration. This ensures the value is properly decreased */
						if (info.newValue == undefined && info.sourceAttribute == "staggerduration") {
							info.newValue = parseInt(info.previousValue) - 1;
						}
						setAttrs({[`repeating_tokens_${selectedId}_token${state}`]:info.newValue});
					}
				}
			}
		});
	});
});

/* Sync: Token Ailments */
on(`change:ailmentList`, (info) => {
	if (info.newValue != undefined) {
		getAttrs(["tokenId_selected", "settingGenericTokenMode"], function(values) {
			if (values.settingGenericTokenMode == "true") {
				let ailmentList = Data.unpackage(info.newValue);
				let selectedId = values.tokenId_selected;
				if (selectedId != "") {
					setAttrs({[`repeating_tokens_${selectedId}_tokenAilmentList`]:info.newValue});
					updateAilmentDisplay(`repeating_tokens_${selectedId}_token`, 4, ailmentList);
				}
			}
		});
	}
});
for (let i = 0; i <= 4; i++) {
	on(`change:repeating_tokens:tokenAilment${i}Num`, (info) => {
		if (info.newValue != undefined) {
			let tokenPrefix = info.sourceAttribute.match((/(repeating_tokens_[^_]+)/g))[0];
			let tokenIndex = info.sourceAttribute.match((/([\d])num/g))[0].replace("num","");
			getAttrs(["tokenId_selected", "settingGenericTokenMode", `${tokenPrefix}_tokenAilmentList`,
				`${tokenPrefix}_tokenAilment${tokenIndex}Name`, `${tokenPrefix}_tokenAilment${tokenIndex}Num`], function(values) {
				
				if (values.settingGenericTokenMode == "true") {

					let selectedId = values.tokenId_selected;
					let ailmentList = Data.unpackage(values[`${tokenPrefix}_tokenAilmentList`]);
					let ailmentName = values[`${tokenPrefix}_tokenAilment${tokenIndex}Name`];
					let ailmentNum = values[`${tokenPrefix}_tokenAilment${tokenIndex}Num`];
					let output = {}
	
					ailmentList[ailmentName][1] = ailmentNum;
					ailmentList[ailmentName][3] = ailmentNum;
					output[`${tokenPrefix}_tokenAilmentList`] = Data.package(ailmentList);
	
					if (tokenPrefix.includes(selectedId.toLowerCase())) {
						output["ailmentList"] = Data.package(ailmentList);
						if (ailmentList[ailmentName][5] != 0) {
							output[`repeating_ailments_${ailmentList[ailmentName][5]}_ailNum`] = ailmentNum;
						} else {
							output[`${ailmentName}`] = ailmentNum;
						}
					}
					setAttrs(output);
				}
			});
		}
	});
}
function updateAilmentDisplay(ailmentPrefix, ailmentDisplayCount, ailmentList) {
	getAttrs(["settingLimbusStyle"], function(values) {
		let ailmentDisplayList = [];
		for (var ailmentName in ailmentList) {
			ailmentDisplayList.push([ailmentName, ailmentList[ailmentName]]);
		}
		ailmentDisplayList.sort(function(ail1, ail2) {
			return ail1[1][1] - ail2[1][1];
		});
		ailmentDisplayList = ailmentDisplayList.slice(ailmentDisplayList.length - ailmentDisplayCount).reverse();
		
		let output = {}
		for (i = 0; i < ailmentDisplayCount; i++) {
			output[`${ailmentPrefix}Ailment${i+1}Icon`] = getIcon("ailments", ailmentDisplayList[i][1][6], values.settingLimbusStyle).replace('<img src="','').replace('" >','');
			output[`${ailmentPrefix}Ailment${i+1}Num`] = ailmentDisplayList[i][1][1];
			output[`${ailmentPrefix}Ailment${i+1}Name`] = ailmentDisplayList[i][0];
		}
		setAttrs(output);
	});
}
function resetAilmentDisplay(ailmentPrefix, ailmentDisplayCount) {
	let output = {}
		for (i = 0; i < ailmentDisplayCount; i++) {
			output[`${ailmentPrefix}Ailment${i+1}Icon`] = "";
			output[`${ailmentPrefix}Ailment${i+1}Num`] = 0;
			output[`${ailmentPrefix}Ailment${i+1}Name`] = "";
		}
		setAttrs(output);
}

on('change:settingGenericTokenMode', (info) => { 
	if (info.newValue == "0") {
		getSectionIDs(`repeating_tokens`, async function(idarray) {
			idarray.forEach(tokenId => {
				removeRepeatingRow("repeating_tokens_" + tokenId);
			});
			setAttrs({"tokenId_selected":""});
		});
	}
});

on('change:settingHideCombatOptions', (info) => {
	if (info.newValue == "true") {
		resetTarget();
		setAttrs({lastDefenceRoll: 0});
	}
});

/* Sync: Action number */
/*on(`change:actNum change:repeating_tokens:actNum`, (info) => {
	
});*/


/* --- Token helper functions --- */
async function checkGenericMode(executeQuery, callback=()=>{}) {
	getAttrs(["settingGenericTokenMode"], async function(values) {
		let genericMode = values.settingGenericTokenMode;
		
		if (genericMode != "true" && executeQuery == "true") {
			let queryResults = await sendQuery(["enableGenericMode",
				getTranslationByKeyCustom("Generic token mode not enabled for sheet. Enable setting?", "query-enable-generic-mode"), {
					[getTranslationByKeyCustom("No","query-no")]:"false",
					[getTranslationByKeyCustom("Yes","query-yes")]:"true"
				}
			]);
			if (queryResults.enableGenericMode == "true") {
				setAttrs({"settingGenericTokenMode":"true"});
			}
			callback(queryResults.enableGenericMode);
		} else {
			callback(genericMode);
		}
	});
}
async function checkTokenInstance(selectAttrs, setSelectMode, callback=()=>{}) {
	getSectionIDs(`repeating_tokens`, async function(idarray) {
		if (!idarray.includes(selectAttrs.tokenId.toLowerCase()) && setSelectMode == "select") {
			let queryResults = await sendQuery(["addTokenInstance",
				getTranslationByKeyCustom("Token does not have a token instance. Add instance?", "query-add-token-instance"), {
					[getTranslationByKeyCustom("No","query-no")]:"false",
					[getTranslationByKeyCustom("Yes","query-yes")]:"true"
				}
			]);
			if (queryResults.addTokenInstance == "true") {
				updateToken(selectAttrs);
			}
			callback(queryResults.addTokenInstance)
		} else {
			callback("true")
		}
	});
}
async function updateToken(selectAttrs, mode="full") {
	getSectionIDs(`repeating_global`, idarray => {
		let id = `repeating_global_${idarray[0]}`;
	
	getAttrs([`${id}_settingBar1`, `${id}_settingBar2`, `${id}_settingBar3`, "HP_max", "StagRes_max", "SP_max", "Light_max"], function(values) {
		selectAttrs = {...selectAttrs, barHP: values.HP_max, barStagRes: values.StagRes_max, barSP: values.SP_max}
		for (let i = 1; i <= 3; i++) {
			/* Matches token bars to the correct status bars */
			if (values[`${id}_settingBar${i}`] != "None") { selectAttrs[`bar${values[`${id}_settingBar${i}`]}`] = selectAttrs[`bar${i}`]; }
		}

		let tokenPrefix = `repeating_tokens_${selectAttrs.tokenId}`;
		let tokenValues = {
			[`${tokenPrefix}_tokenName`]:selectAttrs.tokenName,
			[`${tokenPrefix}_tokenId`]:selectAttrs.tokenId,
			[`${tokenPrefix}_HP`]:selectAttrs.barHP, [`${tokenPrefix}_HP_max`]:values.HP_max, // Supposed to be selectAttrs.HP_max. Currently bugged and gives the default value (30) and not the calculated value
			[`${tokenPrefix}_StagRes`]:selectAttrs.barStagRes, [`${tokenPrefix}_StagRes_max`]:values.StagRes_max, // Supposed to be selectAttrs.StagRes_max
			[`${tokenPrefix}_SP`]:selectAttrs.barSP, [`${tokenPrefix}_SP_max`]:values.SP_max, // Supposed to be selectAttrs.SP_max
			[`${tokenPrefix}_Light`]:values.Light_max, [`${tokenPrefix}_Light_max`]:values.Light_max,
		}
		if (mode == "tokenbars") {
			tokenValues = {}
		}
		tokenValues = {...tokenValues,
			[`${tokenPrefix}_HP_token`]:selectAttrs.barHP,
			[`${tokenPrefix}_StagRes_token`]:selectAttrs.barStagRes,
			[`${tokenPrefix}_SP_token`]:selectAttrs.barSP
		}
		console.log(tokenValues)
		setAttrs(tokenValues);
	});
	});
}
async function changeActiveToken(tokenId, callback=()=>{}) {
	getAttrs(["settingGenericTokenMode", "tokenId_selected"], function(values) {
		if (values.settingGenericTokenMode != "true" || tokenId == "" || tokenId == values.tokenId_selected) {
			callback();
		} else {
			/* Makes certain the tokenId update is being suppressed before setting the attribute */
			setAttrs({"tokenId_suppressUpdate": "true"}, {}, () => {
				setAttrs({"tokenId_selected": tokenId}, {}, () => {
					let info = {newValue: tokenId}
					if (values.tokenId_selected != "") { info.previousValue = values.tokenId_selected; }
					updateSelectedToken(info, ()=>{
						callback();
					});
				});
			})
		}
	});
}
/* --- Token interaction functions end  --- */



/* --- Select target functionality --- */
on('clicked:selectTarget', (info) => {
	getTargetAttrs("target", ["character_name", "selfToken", "token_name", "token_id", "settingGenericTokenMode", "settingHideBarUpdate", "settingHideDetailsFromTargeting"], function(values) {

		if (values.character_name.includes("@{target|")) {
			resetTarget();
		} else {
			setAttrs({
				"targetName": values.character_name,
				"targetToken": values.selfToken,
				"targetTokenName": values.token_name,
				"targetTokenId": values.token_id.replaceAll("_","Ø"),
				"targetSettings": Data.package({
					"genericTokenMode": values.settingGenericTokenMode,
					"hideBarUpdate": values.settingHideBarUpdate,
					"hideDetailsFromTargeting": values.settingHideDetailsFromTargeting
				})
			},{},() => {
				isValidTarget(result => {
					if (result == "true") {
						updateTargetAilmentList();
						updateTargetBarLists();
					} else {
						resetTarget();
					}
				});
			});
		}
	});
});

function resetTarget() {
	setAttrs({
		"targetName": "",
		"targetToken": "",
		"targetTokenName": "",
		"targetTokenId": "",
		"targetSettings": "{}",
		"HP_target":"---",
		"StagRes_target":"---",
		"SP_target":"---",
		"targetAilmentList":"{}",
		"targetBarList":"{}",
		"targetBarDamageList":"{}"
	});
	resetAilmentDisplay("target", 6);
}
function unknownTarget() {
	setAttrs({
		"targetTokenName": "?????",
		"HP_target":"???",
		"StagRes_target":"???",
		"SP_target":"???"
	});
	resetAilmentDisplay("target", 6);
}

/* Checks if a token is an invalid target. Currently happens if genericTokenMode is enabled but the token has not been added as an instance  */
function isValidTarget(callback=()=>{}) {
	getAttrs(["character_name", "targetName", "targetTokenId", "targetSettings"], function(values) {
		let characterName = values.character_name;
		let targetTokenId = values.targetTokenId;
		let targetSettings = Data.unpackage(values.targetSettings);

		if (targetSettings.genericTokenMode == "true") {
			getTargetAttrs(values.targetName, [`repeating_tokens_${targetTokenId}_tokenId`], function(values) {
				if (targetTokenId != values[`repeating_tokens_${targetTokenId}_tokenId`]) {
					
					let alertIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/limbus/Aggro.png' style='width: 25px; height: 25px;' >"
					let alertMessage = getTranslationByKeyCustom("Invalid Target: Token is not a token instance", "message-invalid-target");
					setAttrs({"dummy":alertMessage, "dummyIcon":alertIcon});
					startRoll(("/w " + characterName + "&{template:errorMessage} {{icon=@{dummyIcon}}} {{message=@{dummy} }}"), (results) => {
						finishRoll(results.rollId, {} );
					});
	
					callback("false");
				} else {
					callback("true");
				}
			});
		} else {
			callback("true");
		}
	});
}


function updateTargetAilmentList(callback=()=>{}) {
	getAttrs(["settingHideCombatOptions", "targetName", "targetTokenId", "targetSettings"], function(values) {
		if (values.settingHideCombatOptions == "0" && values.targetName != "") {

			let targetSettings = Data.unpackage(values.targetSettings);
			let targetAilmentListName = (targetSettings.genericTokenMode == "true") ? `repeating_tokens_${values.targetTokenId}_tokenAilmentList` : "ailmentList";
			getTargetAttrs(values.targetName, [targetAilmentListName], function(values) {

				let targetAilmentList = values[targetAilmentListName];
				if (targetAilmentList != "") {

					updateAilmentDisplay("target", 6, Data.unpackage(targetAilmentList));

					if (callback != "()=>{}") {
						callback(Data.unpackage(targetAilmentList));
					} else {
						setAttrs({"targetAilmentList": targetAilmentList});
					}

				} else {
					callback()
				}
			});
		} else {
			callback();
		}
	});
}
function updateTargetBarLists(callback=()=>{}) {
	getAttrs(["settingHideCombatOptions", "targetName", "targetTokenId", "targetSettings"], function(values) {
		if (values.settingHideCombatOptions == "0" && values.targetName != "") {

			let targetBarAttrs = [];
			let targetSettings = Data.unpackage(values.targetSettings);
			let targetPrefix = (targetSettings.genericTokenMode == "true") ? `repeating_tokens_${values.targetTokenId}_` : "";
			barList.forEach(bar => {
				targetBarAttrs.push(`${targetPrefix}${bar}`, `${targetPrefix}${bar}_max`);
			});
			getTargetAttrs(values.targetName, targetBarAttrs, function(values) {

				let targetBarList = {}
				let targetBarDamageList = {}
				barList.forEach(bar => {
					let barName = "";
					switch (bar) {
						case "hp": barName = "HP"; break;
						case "stagres": barName = "ST"; break;
						case "sp": barName = "SP"; break;
						case "light": barName = "Light"; break;
					}
					targetBarList[`${barName}`] = parseInt(values[`${targetPrefix}${bar}`]); 
					targetBarDamageList[`-${barName}`] = parseInt(values[`${targetPrefix}${bar}_max`]) - targetBarList[`${barName}`];
				});

				if (targetSettings.hideDetailsFromTargeting == "true") {
					unknownTarget();
				} else if (targetSettings.hideBarUpdate == "true") {
					setAttrs({"HP_target":"???", "StagRes_target":"???", "SP_target":"???"});
				} else {
					setAttrs({"HP_target":targetBarList.HP, "StagRes_target":targetBarList.ST, "SP_target":targetBarList.SP});
				}

				if (callback != "()=>{}") {
					callback({"targetBarList": targetBarList, "targetBarDamageList": targetBarDamageList});
				} else {
					setAttrs({"targetBarList": Data.package(targetBarList), "targetBarDamageList": Data.package(targetBarDamageList)});
				}
			});
		}
		else {
			callback();
		}
	});
}

async function getTargetAttrs(target, attrList, callback=()=>{}) {
	
	let rollBase = "! ";
	attrList.forEach(attribute => {
		rollBase += `{{${attribute}=[[0[@{${target}|${attribute}}]]]}}`;
	});
	
	let targetRoll = await startRoll(rollBase);
	
	let targetAttrs = {}
	attrList.forEach(attribute => {
		targetAttrs[attribute] = targetRoll.results[attribute].expression.match(/^0\[(.*)\]\s*$/)[1];
	});
	finishRoll(targetRoll.rollId);

	callback(targetAttrs);
}
/* --- Select target functionality end --- */



/* --- Action button functionality --- */
/*
async function createActionButtons(buttonList, override="") {
	
	getAttrs(["targetName"], async function(values) {

	*//* Configure whisper */
	/* If no target exists or the "selected" override is included for the function, reveal the button to all character *//*
	let whisper = "";
	let targetName = values.targetName;
	if (targetName != "" && override != "selected") {
		whisper = `/w ${targetName.split(" ")[0]} `;
	}
	else {
		whisper = "";
	}

	let rollBase = whisper + "&{template:actionbuttons}";
	let dataList = {}

	*//* Convert buttonList to action buttons *//*
	if (buttonList[0] != undefined) {
		for (let i = 0; i < buttonList.length; i++) {
			rollBase += ` {{targetid${i}=[[0]]}} {{datapackage${i}=[[0]]}} {{buttonlabel${i}=${buttonList[i][0]}}} {{icon${i}=${buttonList[i][1]}}} {{color${i}=${buttonList[i][2]}}} {{buttonlink${i}=${buttonList[i][3]}}}`;
			dataList[`datapackage${i}`] = Data.package([buttonList[i][4]]);
			
			*//* If no target exists or the "selected" targetOverride is included for the button, use selected for targetting *//*
			dataList[`targetid${i}`] = (buttonList[i][5] == "selected" || targetName == "") ? "selected" : targetName;
		}
		let buttonRoll = await startRoll(rollBase); 
		finishRoll(buttonRoll.rollId, dataList);
	}
	});
}*/

function generateActionButton(name, icon, color, action, data, target) {
	name = name.replace("autoDamage", getTranslationByKeyCustom("Apply damage", "helper-text-applydamage")) ;
	name = name.replace("autoInflict", getTranslationByKeyCustom("Apply ailments", "helper-text-applyailments"));
	name = name.replace("autoGive", getTranslationByKeyCustom("Give ailments", "helper-text-giveailments"), );
	
	icon = icon.replaceAll('<img src="',"").replaceAll('" >',"");
	
	return [name, icon, color, action, data, target];
}	

/* Creates one or more action buttons and post them to the chat */
/* Taken in a buttonList of the format: label, icon, color, transferFunction, transferData, targetOverride */
async function createActionButtons(buttonList, targetOverride="") {

	getAttrs(["settingHideActionButtons", "settingWhisperRolls", "settingWhisperTarget", "targetName", "targetTokenId"], async function(values) {

	if (values.settingHideActionButtons == "true") {
		return;
	}

	let targetName = values.targetName;
	let targetTokenId = values.targetTokenId;

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whispermode = ""
	let whisper = "";
	if(whisperrolls == "true"){
		whisper =  `/w ${whispertarget} `;
		whispermode = "Whisper";
	}
	else if (targetName != "" && targetOverride == "") {
		whisper =  `/w ${targetName} `
		whispermode = "Whisper";
	}

	let rollBase = whisper + `&{template:actionbuttons} {{whisperMode=${whispermode}}} `;
	let dataList = {}

	if (buttonList[0] != undefined) {
		for (let i = 0; i < buttonList.length; i++) {
			rollBase += ` {{targetid${i}=[[0]]}} {{datapackage${i}=[[0]]}} {{buttonlabel${i}=${buttonList[i][0]}}} {{icon${i}=${buttonList[i][1]}}} {{color${i}=${buttonList[i][2]}}} {{buttonlink${i}=${buttonList[i][3]}}}`;
			dataList[`datapackage${i}`] = Data.package([buttonList[i][4]]);

			// For the target, use this function's override if set, otherwise use the generateActionButton target if set, otherwise use the sheet's targetId if it's set. If all else fails use "selected"
			if (targetOverride != "") {
				dataList[`targetid${i}`] = targetOverride;
			} else if (buttonList[i][5] != undefined) {
				dataList[`targetid${i}`] = buttonList[i][5];
			} else if (targetName != "") {
				dataList[`targetid${i}`] = targetName;
			} else {
				dataList[`targetid${i}`] = "selected";
			}
		}
		let buttonRoll = await startRoll(rollBase); 
		finishRoll(buttonRoll.rollId, dataList);
	}
	});
}

function generateActionButton(name, icon, color, action, data, target) {
	name = name.replace("autoDamage", getTranslationByKeyCustom("Apply damage", "helper-text-applydamage")) ;
	name = name.replace("autoInflict", getTranslationByKeyCustom("Apply ailments", "helper-text-applyailments"));
	name = name.replace("autoGive", getTranslationByKeyCustom("Give ailments", "helper-text-giveailments"), );
	
	icon = icon.replaceAll('<img src="',"").replaceAll('" >',"");
	
	return [name, icon, color, action, data, target];
}

/* Action button functions */
on('clicked:actionButtonDamage', async (data) => {
	getAttrs(["lastDefenceRoll"], async function(values) {

		let defenceRoll = parseInt(values.lastDefenceRoll);
		data = Data.unpackage(data.originalRollId);
		data = data[0];
		actionButtonTokenIdHelper(data.targetTokenId, async (tokenId) => {

			/* If the damage type is unset (such as for ranged weapon) query the player for a damage type */
			if (data.damageTypeOverride == "---") {
				let queryResults = await sendQuery(["damageTypeOverride",
					getTranslationByKeyCustom("Select damage type of attack", "query-damage-type"), {
						[getTranslationByKeyCustom("---", "weapon-type-None")]:"None",
						[getTranslationByKeyCustom("Slash","weapon-type-Slash")]:"Slash",
						[getTranslationByKeyCustom("Pierce","weapon-type-Pierce")]:"Pierce",
						[getTranslationByKeyCustom("Blunt","weapon-type-Blunt")]:"Blunt"
					}
				]);
				data.damageTypeOverride = queryResults.damageTypeOverride;
			}

			/* If taking Light damage, process it as an Add AutoEffect */
			if (data.flatLightOverride != undefined && data.flatLightOverride != 0) {
				data.autoScriptOverride = `(Add -${data.flatLightOverride} Light)`;
			}

			if (data.AutoScript != undefined) {
				AutoScriptMain(data.AutoScript, "None", "false", "true", { tokenId: tokenId }, () => {}, getTranslationByKeyCustom("Apply damage", "helper-text-applydamage"));
			} else {
				damageHelper({...data, tokenId: tokenId}, defenceRoll);
			}

			setAttrs({"lastDefenceRoll": 0});
		});
	});
});
on('clicked:actionButtonInflict', async (data) => {
	data = Data.unpackage(data.originalRollId);
	data = data[0];
	actionButtonTokenIdHelper(data.targetTokenId, (tokenId) => {
		AutoScriptMain(data.AutoScript, "None", "false", "true", { tokenId: tokenId }, () => {}, getTranslationByKeyCustom("Apply ailments", "helper-text-applyailments"));
	});
});
on('clicked:actionButtonGive', async (data) => {
	data = Data.unpackage(data.originalRollId);
	data = data[0];
	actionButtonTokenIdHelper("", (tokenId) => {
		AutoScriptMain(data, "None", "false", "true", { tokenId: tokenId }, () => {}, getTranslationByKeyCustom("Give ailments", "helper-text-giveailments"));
	});
});
/* Helper function that gets and returns to the selected token's instance if generic token mode is enabled but targeting is not used */
/* Otherwise it returns the inputted tokenId */
function actionButtonTokenIdHelper(targetTokenId, callback=()=>{}) {
	getAttrs(["settingGenericTokenMode"], function(values) {
		if (targetTokenId == "" && values.settingGenericTokenMode == "true") {
			getTokenAttrs("selected", "unset", "false", (selectAttrs) => {
				callback(selectAttrs.tokenId);
			});
		} else {
			callback(targetTokenId);
		}
	});
}
/* --- Action button functionality --- */



/* Auto: Recalculate derived stats */
on("change:instinct change:wisdom change:justice change:charm change:insight change:temperance change:repeating_global", function() {

getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["instinct", "wisdom", "justice", "charm", "insight", "temperance", "distortState", "settingTestOption", 
	`${id}_healthBase`, `${id}_healthStat`, `${id}_healthStatMod`, `${id}_healthRankMod`,
	`${id}_staggerBase`, `${id}_staggerStat`, `${id}_staggerStatMod`, `${id}_staggerRankMod`,
	`${id}_sanityBase`, `${id}_sanityStat`, `${id}_sanityStatMod`, `${id}_sanityRankMod`,
	`${id}_lightBase`, `${id}_lightRankMod`, `${id}_distortLightBase`, `${id}_distortLightRankMod`,
	`${id}_attStat`, `${id}_defStat`, `${id}_evdStat`,
	`${id}_burnNextTurnSetting`, `${id}_bleedNextTurnSetting`, `${id}_smokeNextTurnSetting`, `${id}_chargeNextTurnSetting`], function(values) {

	let instinctVal = parseInt(values.instinct);
	let wisdomVal = parseInt(values.wisdom);
	let justiceVal = parseInt(values.justice);
	let charmVal = parseInt(values.charm);
	let insightVal = parseInt(values.insight);
	let temperanceVal = parseInt(values.temperance);

	let distortState = values.distortState;
	let optionstate = values.settingTestOption;

	let healthBase = parseInt(values[`${id}_healthBase`]);
	let healthStat = values[`${id}_healthStat`];
	let healthStatMod = parseInt(values[`${id}_healthStatMod`]);
	let healthRankMod = parseInt(values[`${id}_healthRankMod`]);

	let staggerBase = parseInt(values[`${id}_staggerBase`]);
	let staggerStat = values[`${id}_staggerStat`];
	let staggerStatMod = parseInt(values[`${id}_staggerStatMod`]);
	let staggerRankMod = parseInt(values[`${id}_staggerRankMod`]);

	let sanityBase = parseInt(values[`${id}_sanityBase`]);
	let sanityStat = values[`${id}_sanityStat`];
	let sanityStatMod = parseInt(values[`${id}_sanityStatMod`]);
	let sanityRankMod = parseInt(values[`${id}_sanityRankMod`]);

	let lightBase = parseInt(values[`${id}_lightBase`]);
	let lightRankMod = parseInt(values[`${id}_lightRankMod`]);

	let dlightBase = parseInt(values[`${id}_distortLightBase`]);
	let dlightRankMod = parseInt(values[`${id}_distortLightRankMod`]);

	let attStat = values[`${id}_attStat`];
	let defStat = values[`${id}_defStat`];
	let evdStat = values[`${id}_evdStat`];

	let burnNextTurn = values[`${id}_burnNextTurnSetting`];
	let bleedNextTurn = values[`${id}_bleedNextTurnSetting`];
	let smokeNextTurn = values[`${id}_smokeNextTurnSetting`];
	let chargeNextTurn = values[`${id}_chargeNextTurnSetting`];

	let ranknew = parseInt((instinctVal+wisdomVal+justiceVal+charmVal+insightVal+temperanceVal)/(6));
	let rnum = ranknew;
	let worknew = "4";

	if(rnum > 6){
	rnum = "6";
	}
	if(ranknew > 5){
	ranknew = "EX";
	worknew = "8";
	} 
	else if (ranknew == 5 || ranknew == 4){
	worknew = "8";
	}
	else if (ranknew == 3 || ranknew == "2"){
	worknew = "6";
	}

	let hpnew = parseInt(healthBase + (instinctVal * healthStatMod) + (rnum * healthRankMod));
	let stagresnew = parseInt(staggerBase + (charmVal * staggerStatMod) + (rnum * staggerRankMod));
	let spnew = parseInt(sanityBase + (wisdomVal * sanityStatMod) + (rnum * sanityRankMod));
	let mixVal = "";

	if(healthStat == "InstinctTemperance"){
	mixVal = parseInt((instinctVal + temperanceVal)/2);
	hpnew = parseInt(healthBase + (mixVal * healthStatMod) + (rnum * healthRankMod));
	}

	if(staggerStat == "CharmJustice"){
	mixVal = parseInt((charmVal + justiceVal)/2);
	stagresnew = parseInt(staggerBase + (mixVal * staggerStatMod) + (rnum * staggerRankMod));
	}

	if(sanityStat == "WisdomInsight"){
	mixVal = parseInt((wisdomVal + insightVal)/2);
	spnew = parseInt(sanityBase + (mixVal * sanityStatMod) + (rnum * sanityRankMod));
	}


	let lightnew = parseInt((rnum * lightRankMod) + lightBase);

	if(distortState == "true"){
	lightnew = parseInt((rnum * dlightRankMod) + dlightBase);
	}

	/* Att, Def, Evd Calculation */
	let newAtt = instinctVal;
	let newDef = temperanceVal;
	let newEvd = insightVal;

	if(attStat == "Rank"){
	newAtt = rnum;
	}
	else if (attStat == "InstinctRank") {
	newAtt = parseInt(instinctVal + rnum);
	}
	else if(attStat == "InstinctWisdom"){
	newAtt = parseInt((instinctVal + wisdomVal)/2);
	}

	if(defStat == "Rank"){
	newDef = rnum;
	}
	else if (defStat == "TemperanceRank") {
	newDef = parseInt(temperanceVal + rnum);
	}
	else if(defStat == "TemperanceCharm"){
	newDef = parseInt((temperanceVal + charmVal)/2);
	}

	if(evdStat == "Rank"){
	newEvd = rnum;
	}
	else if (evdStat == "InsightRank") {
	newEvd = parseInt(insightVal + rnum);
	}
	else if(evdStat == "InsightJustice"){
	newEvd = parseInt((insightVal + justiceVal)/2);
	}	


	setAttrs({"charRankBase":ranknew, "charRankNum":rnum, "HP_max":hpnew, "StagRes_max":stagresnew, "SP_max":spnew, "Light_max":lightnew, "distortWorkBase":worknew, "attPower":newAtt, "defPower":newDef, "evdPower":newEvd, "burnNextTurnSetting":burnNextTurn, "bleedNextTurnSetting":bleedNextTurn, "smokeNextTurnSetting":smokeNextTurn, "chargeNextTurnSetting":chargeNextTurn});

		});
	});
});

/* Recalculate level */
on("change:EXP change:repeating_global:expCalc", function(){
getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["EXP", `${id}_expCalc`], function(values) {
		let exp = parseInt(values.EXP);
		let calc = parseInt(values[`${id}_expCalc`]);
		let newlevel = parseInt(exp/calc);

		setAttrs({"level":newlevel});


		});
	});
});

/* Set Icon Style */
on("change:settingLimbusStyle", function() {
getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;
	output = [];

	getAttrs(["settingLimbusStyle", `${id}_iconStyle`], function(values) {

	if(values.settingLimbusStyle != values[`${id}_iconStyle`]){
	output[`${id}_iconStyle`] = values.settingLimbusStyle;

	setAttrs(output);
	}

		});
	});
});

on("change:repeating_global:iconStyle", function() {
getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;
	output = [];

	getAttrs(["settingLimbusStyle", `${id}_iconStyle`], function(values) {

	if(values.settingLimbusStyle != values[`${id}_iconStyle`]){
	output["settingLimbusStyle"] = values[`${id}_iconStyle`];

	setAttrs(output);
	}

		});
	});
});

/* Change stagger duration */
on("change:repeating_global:staggerDurationMax", function() {
	getSectionIDs(`repeating_global`, idarray => {
		let id = `repeating_global_${idarray[0]}`;
	
	getAttrs(["StaggerDuration", `${id}_staggerDurationMax`], function(values) {
	
	if (values.StaggerDuration != values[`${id}_staggerDurationMax`]) {
		setAttrs({"StaggerDuration":values[`${id}_staggerDurationMax`]});
	}
	});
	});
});


/* Edit toggle */
on("change:settingHideShare", function() {
	setAttrs({"settingEditMode":"0"});

});

/* Auto: Community Rules (Test) */
on("change:settingTestOption", function() {

getAttrs(["settingTestOption", "instinct", "charRankNum"], function(values) {

	let state = values.settingTestOption;

	/* Rank-based Attack Power */
	let instinct = parseInt(values.instinct);
	let charRankNum = parseInt(values.charRankNum);
	
	if(state == "true"){
	setAttrs({"attPower":charRankNum});
	}
	else{
	setAttrs({"attPower":instinct});
	}


	});

});

/* Auto: Setting Evade influence */
on("change:settingEvdInfluence", function() {

getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

getAttrs(["settingEvdInfluence", `${id}_evdAilment`, "insight", "Haste", "Bind", "Endurance", "Disarm"], function(values) {

	let evdinfluence = values[`${id}_evdAilment`];
	let newevd = "0";	
	let insight = parseInt(values.insight);
	let positive = 0;
	let negative = 0;
	
	if(evdinfluence == "HasteBind"){
	positive = parseInt(values.Haste);
	negative = parseInt(values.Bind);

	setAttrs({"evdPositive":positive, "evdNegative":negative});
	}
	else{
	positive = parseInt(values.Endurance);
	negative = parseInt(values.Disarm);

	setAttrs({"evdPositive":positive, "evdNegative":negative});
	}


		});
	});

});

/* Auto: Set Distortion state */
on("change:distortState", function() {

getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["distortState", "distortStateTemp", "character_name", "character_nameBase", "distort_name", "egoCondition", "egoConditionTemp", "settingDistortSave", "editorInput", "editorOutput", `${id}_lightBase`, `${id}_lightRankMod`, `${id}_distortLightBase`, `${id}_distortLightRankMod`, "charRankNum"], function(values) {
	let state = values.distortState;
	let prevstate = values.distortStateTemp;

	let updatename = "";
	let origname = values.character_name;
	let basename = values.character_nameBase;
	let distortname = values.distort_name;
	let distortstring = getTranslationByKey("message-distorted");
	let newcondition = "";
	let currentcondition = values.egoCondition;
	let prevcondition = values.egoConditionTemp;
	let save = values.settingDistortSave;

	let rnum = parseInt(values.charRankNum);

	let lightBase = parseInt(values[`${id}_lightBase`]);
	let lightRank = parseInt(values[`${id}_lightRankMod`]);

	let dlightBase = parseInt(values[`${id}_distortLightBase`]);
	let dlightRank = parseInt(values[`${id}_distortLightRankMod`]);

	let light = values.Light_max;

	if(prevcondition == "" || (state == "true" && prevcondition != currentcondition)){
	prevcondition = values.egoCondition;
	}

	if(origname != "" && basename == ""){
	basename = origname;
	newcondition = prevcondition;
	}

	if(state == "true" && distortname != ""){

	updatename = distortname;
	newcondition = "AlwaysActive";

	}
	else if(state == "true" && distortname == ""){
	updatename = basename + " (" + distortstring + ")";
	newcondition = "AlwaysActive";	
	}
	else {
	newcondition = prevcondition;
	updatename = basename;
	}

	/* Auto Save/Load data */
	if(save == "true"){
	let input = values.editorInput;
	let output = values.editorOutput;

	setAttrs({"editorOutput":input, "editorInput":output});
	dataExport("All");
	dataImport();

	
	}

	if(state == "true"){
	light = parseInt((rnum * dlightRank) + dlightBase);
	}
	else {
	light = parseInt((rnum * lightRank) + lightBase);
	}


	setAttrs({"character_nameBase":basename, "character_name":updatename, "Light_max":light, "Light":light});

		});
	});
});

/* Auto: Update Distortion Name */
on("change:distort_name", function() {
	getAttrs(["distortState", "distort_name", "character_nameBase"], function(values) {
	let name = values.distort_name;
	let basename = values.character_nameBase;
	let state = values.distortState;
	let distortstring = getTranslationByKey("message-distorted");

	if(state == "true" && name != ""){

	setAttrs({"character_name":name});

	}
	else if(state == "true" && name == ""){
	name = basename + " (" + distortstring + ")";

	setAttrs({"character_name":name});

	}

	});
});

/* Auto: Update Base name */
on("change:character_nameBase", function() {
	getAttrs(["distortState", "character_name", "character_nameBase"], function(values) {
	let name = values.character_name;
	let basename = values.character_nameBase;
	let state = values.distortState;

	if(state != "true" && name != basename){

	setAttrs({"character_name":basename});

	}

	});
});


/* Auto: Initialize Base name and distort state */
on("sheet:opened", function() {
	getAttrs(["distortState", "character_name", "character_nameBase"], function(values) {
	let name = values.character_name;
	let basename = values.character_nameBase;
	let state = values.distortState;

	if(state != "true" && basename != name){
		setAttrs({"character_nameBase":name});
		setAttrs({"distortState":"0"});
	}
	});
});

/* Auto: Initialize token image link */
/* character_token and character_avatar cannot be retrieved from outside the charactersheet. As such a copy is made which can be retrieved */
on("sheet:opened", function() {
	getAttrs(["character_token", "selfToken"], function(values) {
		let token = values.character_token;
		let selfToken = values.selfToken;

		if(token != selfToken){
			setAttrs({"selfToken": token});
		}
	});
});

/* Auto: Detect empty Temp Bar source */
/* The sheet doesn't properly detect these fields for some reason.  */
on("sheet:opened", function() {
	getAttrs(["THP_Sources", "TST_Sources"], function(values) {
		setAttrs({"THP_Sources": values.THP_Sources, "TST_Sources": values.TST_Sources});
	});
});



/* Auto: Detect Stagger */
on("change:StagRes", function() {
	getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["StagRes", "StaggerState", `${id}_staggerDurationMax`], function(values) {
	let currentstag = parseInt(values.StagRes);
	let currentstate = values.StaggerState;
	let statedurationmax = parseInt(values[`${id}_staggerDurationMax`]);

		if(currentstag <= 0 && currentstate == "0"){

		setAttrs({"StaggerState":"Staggered"});
		setAttrs({"StaggerDuration":statedurationmax});

		} /* Value check end */

	});
	});
});

/* Auto: Recalc Advantage state */
on("change:advNum change:disadvNum", function() {
	getAttrs(["advNum", "disadvNum"], function(values) {
	let currentadv = parseInt(values.advNum);
	let currentdisadv = parseInt(values.disadvNum);
	let newstate = "0";

	if(currentadv > currentdisadv){
	newstate = "Advantage";
	}
	else if(currentdisadv > currentadv){
	newstate = "Disadvantage";
	}


	setAttrs({"advNum":currentadv, "disadvNum":currentdisadv, "advState":newstate});

	});
});

/* Auto: Recalc Advantages */
on("change:Fortune change:Paralysis", function() {
	getAttrs(["Fortune", "Paralysis"], function(values) {
	let currentadv = parseInt(values.Fortune);
	let currentdisadv = parseInt(values.Paralysis);
	
	let newadv = currentadv - currentdisadv;
	let newdisadv = currentdisadv - currentadv;
	let newstate = "0";

	if(newadv <= 0){
	newadv = "0";
	}
	
	if(newdisadv <= 0){
	newdisadv = "0";
	}

	if(newadv > newdisadv){
	newstate = "Advantage";
	}
	else if(newdisadv > newadv){
	newstate = "Disadvantage";
	}


	setAttrs({"advNum":newadv, "disadvNum":newdisadv, "advState":newstate});

	});
});

/* Auto: Detect Hostile */
on("change:distortCounter", function() {
	getAttrs(["settingAutoDetect", "HostileState", "distortCounter"], function(values) {
	let detect = values.settingAutoDetect;
	let hostilestate = values.HostileState;
	let currentcounter = parseInt(values.distortCounter);

	/* AutoDetect check */
	if(detect != "0"){

		if(currentcounter <= 0 && hostilestate == "0"){
			setAttrs({"HostileState":"Hostile"});
 
		}
		else if(currentcounter > 0 && hostilestate != "0"){
		setAttrs({"HostileState":"0"});


		} /* Value check end */

	} /* AutoDetect check end */

		});
});



/* Auto: Detect Panic */
on("change:SP", function() {
	getAttrs(["settingAutoDetect", "settingMuteMessage", "PanicState", "SP"], function(values) {
	let detect = values.settingAutoDetect;
	let mutemessage = values.settingMuteMessage;
	let panicstate = values.PanicState;
	let currentsan = parseInt(values.SP);

	/* AutoDetect check */
	if(detect != "0"){
		currentsan = parseInt(values.SP);

		if(currentsan <= 0 && panicstate == "0"){
			setAttrs({"PanicState":"Panic"});
		}
		else if(currentsan > 0 && panicstate != "0"){
		setAttrs({"PanicState":"0"});


		} /* Value check end */

	} /* AutoDetect check end */

	});
});

/* Auto: HP related updates (Detect Defeat, Detect EGO activation) */
on("change:HP", function() {

	getAttrs(["settingAutoDetect", "settingMuteMessage", "DefeatState", "egoActiveState", "HP", "HP_max", "egoCondition"], function(values) {
	let detect = values.settingAutoDetect;
	let mutemessage = values.settingMuteMessage;
	let defeatstate = values.DefeatState;
	let iconnew = "";
	let currenthp = parseInt(values.HP);
	let halfhp = parseInt((values.HP_max) / 2);
	let egocon = values.egoCondition;
	let egostate = values.egoActiveState;

	/* EGO check*/
	if(egocon == "HalfHealth" && currenthp <= halfhp && egostate != "true"){
		setAttrs({"egoActiveState":"true"});
	}

	/* Defeat check */
	if(currenthp <= 0 && detect != "0" && defeatstate == "0"){

		setAttrs({"DefeatState":"Defeated"});

		} /* Defeat check end */

	});

});

/* Auto: EGO - Clear skill select */
on("change:egoActiveState", function() {

	getAttrs(["egoActiveState"], function(values) {
	let egostate = values.egoActiveState;
	output = {};

	if(egostate == "0"){
	output["skillSelect"] = "0";
	} 

	output["toolSelect"] = "";

	setAttrs(output);
	});

});

/* Auto: Skill loadout change - Clear skill select */
on("change:skill1Type change:skill2Type change:skill3Type change:skill4Type change:skill5Type change:skill6Type change:egoSkill1Type change:egoSkill2Type change:egoSkill3Type change:egoSkill4Type change:egoSkill5Type change:egoSkill6Type", function() {

	setAttrs({"skillSelect":"0"});


});

/* Auto: Hostile State updates */
on("change:HostileState", function() {
	getAttrs(["distortCounter", "distortCounter_max", "HostileState", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "messageOverride", "settingLimbusStyle"], function(values) {

	let currentstate = values.HostileState;
	let currentcounter = values.distortCounter;
	let messagestate = values.settingMuteMessage;
	let overridecheck = values.messageOverride;

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}

	let iconnew = "<img src='" + style + "Hostile.png' style='width: 25px; height: 25px;' >";

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	if(overridecheck == "true"){
	messagestate = "true";
	setAttrs({"messageOverride":"0"});
	}

	if(currentstate != "Hostile" && currentcounter == "0"){
	let newcounter = values.distortCounter_max;
	setAttrs({"distortCounter":newcounter});

	}

	setAttrs({"dummyIcon":iconnew});

	/* Translation prep */
	let langStateTrue = " is Hostile!";
	let langStateFalse = " is no longer Hostile.";

	if(getTranslationByKey("message-hostile1") != false){

	langStateTrue = getTranslationByKey("message-hostile1");
	langStateFalse = getTranslationByKey("message-hostile2");
	}
	
	if(messagestate != "true" && currentstate != "Hostile"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateFalse + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}
	else if(messagestate != "true" && currentstate == "Hostile"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateTrue + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}

	});
});

/* Auto: Panic State updates */
on("change:PanicState", function(info) {
	getAttrs(["PanicStateSuppressUpdate", "SP", "PanicState", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "messageOverride", "settingLimbusStyle"], function(values) {
	if (values.PanicStateSuppressUpdate == "true") { setAttrs({"PanicStateSuppressUpdate":"false"}); return; }

	let currentstate = values.PanicState;
	let messagestate = values.settingMuteMessage;
	let overridecheck = values.messageOverride;
	let overrideeffect = values.settingHideBaseEffect;

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}

	let iconnew = "<img src='" + style + "Panic.png' style='width: 25px; height: 25px;' >";

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	if(overridecheck == "true"){
	messagestate = "true";
	setAttrs({"messageOverride":"0"});
	}

	setAttrs({"dummyIcon":iconnew});

	/* AutoScripts */
	resetConditionals();
	let autoScriptTrigger = currentstate == "Panic" ? "Panic" : "None";
	AutoScriptMain("", autoScriptTrigger, "true", "true", { targetmode:"false" })

	/* Translation prep */
	let langStateTrue = " went into Panic!";
	let langStateFalse = " is no longer Panicked";

	if(getTranslationByKey("message-panic1") != false){

	langStateTrue = getTranslationByKey("message-panic1");
	langStateFalse = getTranslationByKey("message-panic2");
	}
	
	if(messagestate != "true" && currentstate != "Panic"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateFalse + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}
	else if(messagestate != "true" && currentstate == "Panic"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateTrue  + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}

	});
});

/* Auto: Defeat State updates */
on("change:DefeatState", function() {
	getAttrs(["DefeatStateSuppressUpdate", "DefeatState", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "messageOverride", "settingLimbusStyle"], function(values) {
	if (values.DefeatStateSuppressUpdate == "true") { setAttrs({"DefeatStateSuppressUpdate":"false"}); return; }

	let currentstate = values.DefeatState;
	let messagestate = values.settingMuteMessage;
	let overridecheck = values.messageOverride;

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}

	let iconnew = "<img src='" + style + "Defeat.png' style='width: 25px; height: 25px;'>";

	if(overridecheck == "true"){
	messagestate = "true";
	setAttrs({"messageOverride":"0"});
	}

	setAttrs({"dummyIcon":iconnew});

	/* AutoScripts */
	resetConditionals();
	AutoScriptMain("", "Defeated", "true", "true", { targetmode:"false" })

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Translation prep */
	let langDefeat = " can no longer fight.";

	if(getTranslationByKey("message-defeat") != false){

	langDefeat = getTranslationByKey("message-defeat");

	}
	
	if(messagestate != "true" && currentstate == "Defeated"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langDefeat + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}

	});
});

/* Auto: Stagger State updates */
on("change:StaggerState change:StaggerDuration", function(info) {
	//console.log(info)
	
getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs([`${info.sourceAttribute}SuppressUpdate`, "StagRes", "StaggerState", "StaggerDuration", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "SP", "egoCondition", "egoActiveState", "messageOverride", "distortState", `${id}_staggerSanity`, `${id}_staggerDurationMax`, "settingLimbusStyle"], function(values) {
	if (values[`${info.sourceAttribute}SuppressUpdate`] == "true") { setAttrs({[`${info.sourceAttribute}SuppressUpdate`]:"false"}); return; }

	/* Get the trigger type */
	let type = "state";
	if (info.sourceAttribute == "staggerduration") {
		type = "duration";
	}
	
	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
		style = style + "limbus/";
	}

	let iconnew = "<img src='" + style + "FragileStagger.png' style='width: 25px; height: 25px;' >";
	let currentstate = values.StaggerState;
	let stateduration = parseInt(values.StaggerDuration);
	let statedurationmax = parseInt(values[`${id}_staggerDurationMax`]);
	let messagestate = values.settingMuteMessage;
	let egocon = values.egoCondition;
	let egostate = values.egoActiveState;
	let sanity = parseInt(values.SP) - parseInt(values[`${id}_staggerSanity`]);
	
	/* Aborts the function if staggerduration is set to its max value. Hinders a double messages when Staggered or Unstaggered (StaggerState and StaggerDuration are both changed) */
	if (type == "duration" && stateduration == statedurationmax) {
		return;
	}

	if(type == "state" && egocon == "OnStagger" && currentstate != "0"){
		setAttrs({"egoActiveState":"true"});
	}

	if(type == "state" && currentstate == "Staggered" && values.distortState != "true") {
		setAttrs({"SP":sanity});
	}

	let overridecheck = values.messageOverride;
	if(overridecheck == "true"){
		messagestate = "true";
		setAttrs({"messageOverride":"0"});
	}

	setAttrs({"dummyIcon":iconnew});

	if (type == "state" && currentstate == "Staggered") {
		/* AutoScripts */
		resetConditionals();
		let autoScriptTrigger = currentstate == "Staggered" ? "Staggered" : "None";
		AutoScriptMain("", autoScriptTrigger, "true", "true", { targetmode:"false" })
	}

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Translation prep */
	let langStateTrue = getTranslationByKeyCustom(" is Staggered!", "message-stagger1");
	let langStateFalse = getTranslationByKeyCustom(" is no longer Staggered.", "message-stagger2");
	let langStateDurationNextRound = getTranslationByKeyCustom(" will stop being Staggered next round.", "message-stagger3");
	let langStateDurationMultiRound = getTranslationByKeyCustom(" will stop being Staggered in ", "message-stagger4") + parseInt(stateduration + 1) + " " + getTranslationByKeyCustom("rounds", "message-round-plural");
	let messageDescription = "";

	if (type == "state" && currentstate == "Staggered") {
		messageDescription = langStateTrue;
	}
	else if (type == "duration" && stateduration == 0) {
		messageDescription = langStateDurationNextRound;
	}
	else if (type == "duration" && stateduration < statedurationmax) {
		messageDescription = langStateDurationMultiRound;
	}
	else if (type == "state" && currentstate != "Staggered") {
		messageDescription = langStateFalse;
	}
	

	if(messagestate != "true"){
		startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + messageDescription + "}}"), (results) => {
            finishRoll(results.rollId, {} );
        });
	}

	});
	});
});

/* Auto: Immobile State updates */
on("change:ImmobileState", function() {
	getAttrs(["ImmobileStateSuppressUpdate", "ImmobileState", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "messageOverride", "settingLimbusStyle"], function(values) {
	if (values.ImmobileStateSuppressUpdate == "true") { setAttrs({"ImmobileStateSuppressUpdate":"false"}); return; }


	let currentstate = values.ImmobileState;
	let messagestate = values.settingMuteMessage;
	let overridecheck = values.messageOverride;

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}
	let iconnew = "<img src='" + style + "Immobile.png' style='width: 25px; height: 25px;'>";

	if(overridecheck == "true"){
	messagestate = "true";
	setAttrs({"messageOverride":"0"});
	}

	setAttrs({"dummyIcon":iconnew});

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Translation prep */
	let langStateTrue = " is Immobile!";
	let langStateFalse = " is no longer Immobile.";

	if(getTranslationByKey("message-immobile1") != false){

	langStateTrue = getTranslationByKey("message-immobile1");
	langStateFalse = getTranslationByKey("message-immobile2");
	}
	
	if(messagestate != "true" && currentstate != "Immobile"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateFalse + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}
	else if(messagestate != "true" && currentstate == "Immobile"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateTrue + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}

	});
});

/* Auto: Seal State updates */
on("change:SealState", function() {
	getAttrs(["SealStateSuppressUpdate", "SealState", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "messageOverride", "settingLimbusStyle"], function(values) {
	if (values.SealStateSuppressUpdate == "true") { setAttrs({"SealStateSuppressUpdate":"false"}); return; }

	let currentstate = values.SealState;
	let messagestate = values.settingMuteMessage;
	let overridecheck = values.messageOverride;

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}

	let iconnew = "<img src='" + style + "Seal.png' style='width: 25px; height: 25px;'>";

	if(overridecheck == "true"){
	messagestate = "true";
	setAttrs({"messageOverride":"0"});
	}

	setAttrs({"dummyIcon":iconnew});

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Translation prep */
	let langStateTrue = " is Sealed!";
	let langStateFalse = " is no longer Sealed.";

	if(getTranslationByKey("message-seal1") != false){

	langStateTrue = getTranslationByKey("message-seal1");
	langStateFalse = getTranslationByKey("message-seal2");
	}
	
	if(messagestate != "true" && currentstate != "Seal"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateFalse + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}
	else if(messagestate != "true" && currentstate == "Seal"){
	startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=" + langStateTrue + "}}"), (results) => {

            finishRoll(results.rollId, {} );
        });
	}

	});
});

/* Auto: Update Evd power (Endurance/Disarm) */
on("change:Endurance change:Disarm", function() {

getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["settingEvdInfluence", `${id}_evdAilment`, "evdPositive", "evdNegative", "Endurance", "Disarm"], function(values) {
	let evdinfluence = values[`${id}_evdAilment`];

	let endurancenum = parseInt(values.Endurance);
	let disarmnum = parseInt(values.Disarm);

	/* Update Evd */
	if(evdinfluence == "EnduranceDisarm"){
	setAttrs({"evdPositive":endurancenum, "evdNegative":disarmnum});

	}

		});
	});
});

/* Auto: Update calculated speed | Update Evd power (Haste/Bind) */
on("change:Haste change:Bind change:thisRoundSpeed change:baseSpeed", function() {
getSectionIDs(`repeating_global`, idarray => {
    let id = `repeating_global_${idarray[0]}`;

	getAttrs(["settingTurnUpdate", "baseSpeed", "prevSpeed", "thisRoundSpeed", "Haste", "Bind", "character_name", "settingEvdInfluence", `${id}_evdAilment`, "evdPositive", "evdNegative"], function(values) {
	let turnupdate = values.settingTurnUpdate;
	let evdinfluence = values[`${id}_evdAilment`];

	let basespeed = parseInt(values.baseSpeed);
	let prevspeed = parseInt(values.prevSpeed);
	let thisRoundSpeed = parseInt(values.thisRoundSpeed);

	let hastenum = parseInt(values.Haste);
	let bindnum = parseInt(values.Bind);
	let name = values.character_name;
	let newspeed = basespeed + hastenum - bindnum + thisRoundSpeed;
	let command = "[[" + newspeed + "&{tracker} ]]";
	let message = "Speed update: ";
	
	setAttrs({"calcSpeed":newspeed, "prevSpeed":newspeed});

	/* Update Evd */
	if(evdinfluence == "HasteBind"){
	setAttrs({"evdPositive":hastenum, "evdNegative":bindnum});

	}

	if(turnupdate == "true"){
	if(prevspeed != newspeed){
	startRoll("/w @{character_name} Speed updated: [[@{calcSpeed} &{tracker}]]", (results) => {
            finishRoll(results.rollId, {} );
       			 });
	}
	}	


	});
	});
});


/* Auto: Update ailment list */
let ailments = ["Burn", "Bleed", "Paralysis", "Protection", "StaggerProtection", "Fragile", "Strength", "Feeble", "Endurance", "Disarm", "Haste", "Bind", "Smoke", "Charge", "Fortune"];
let ailmentAttributes = `sheet:opened change:repeating_ailments:ailIcon change:repeating_ailments:ailNum change:repeating_ailments:ailNumNextTurn change:repeating_ailments:ailName change:repeating_ailments:ailDecayPause clicked:importRepeating clicked:importGlobal
	change:settingHideNextTurn change:repeating_global:burnNextTurnSetting change:repeating_global:bleedNextTurnSetting change:repeating_global:smokeNextTurnSetting change:repeating_global:chargeNextTurnSetting`;
ailments.forEach(ailment => {
	ailmentAttributes += ` change:${ailment} change:${ailment}NextTurn change:${ailment}DecayPause`;
});
on(ailmentAttributes, function() {
	exportAilmentList({}, function(ailmentList) {
		setAttrs({ailmentList: Data.package(ailmentList)});
	});
});


/* Action: Reset Ailments */
on('clicked:resetAilments', function() {
	resetAilments();
});
function resetAilments(callback=()=>{}) {
	getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["SP", `${id}_staggerDurationMax`], function(values) {
	let newsan = parseInt(values.SP);
	let staggerdurationmax = parseInt(values[`${id}_staggerDurationMax`]);

	if(newsan <= "0"){
	newsan = "1";
	}

	setAttrs({"messageOverride":"true"});

	let ailmentNames = ["Burn", "Bleed", "Paralysis", "Protection", "StaggerProtection", "Fragile", "Strength", "Feeble", "Endurance", "Disarm", "Haste", "Bind", "Smoke", "Charge", "Fortune"];
	let attributeObject = {};
	ailmentNames.forEach(ailment => {
		attributeObject[`${ailment}`] = 0;
		attributeObject[`${ailment}NextTurn`] = 0;
		attributeObject[`${ailment}DecayPause`] = 0;
	});
	setAttrs({...attributeObject, "StaggerState":"0", "StaggerDuration":staggerdurationmax, "PanicState":"0", "SealState":"0", "ImmobileState":"0", "DefeatState":"0", "Seal":"0", "SP":newsan, "THP_Sources":"", "TST_Sources":""});	});

	/* Custom Ailments */
        getSectionIDs(`repeating_ailments`, idarray => {
            const fieldnames = idarray.reduce((rows,id) => [...rows, `repeating_ailments_${id}_ailNum`, `repeating_ailments_${id}_ailNumNextTurn`, `repeating_ailments_${id}_ailDecayPause`], '');
            getAttrs([...fieldnames], v => {
                const output = {};
                idarray.forEach(id => {
                    output[`repeating_ailments_${id}_ailNum`] = 0;
					output[`repeating_ailments_${id}_ailNumNextTurn`] = 0;
					output[`repeating_ailments_${id}_ailDecayPause`] = 0;
                });
                setAttrs(output);
				callback();
            });
        });
	});
}

/*Action: Reset uses */
on('clicked:resetUses', function() {
	getAttrs(["tool1Reusable", "tool1Uses_max", "tool2Reusable", "tool2Uses_max", "tool3Reusable", "tool3Uses_max", "tool4Reusable", "tool4Uses_max", "weapon1Uses_max", "weapon1UseType", "weapon2Uses_max", "weapon2UseType", "weapon3Uses_max", "weapon3UseType", "weapon4Uses_max", "weapon4UseType", "egoUses_max", "egoUseType"], function(values) {
	
	let output = {};

	if(values.tool1Reusable == "Reusable"){
	output["tool1Uses"] = values.tool1Uses_max;
	}
	if(values.tool2Reusable == "Reusable"){
	output["tool2Uses"] = values.tool2Uses_max;
	}
	if(values.tool3Reusable == "Reusable"){
	output["tool3Uses"] = values.tool3Uses_max;
	}
	if(values.tool4Reusable == "Reusable"){
	output["tool4Uses"] = values.tool4Uses_max;
	}

	if(values.weapon1UseType == "Reload"){
	output["weapon1Uses"] = values.weapon1Uses_max;
	}
	if(values.weapon2UseType == "Reload"){
	output["weapon2Uses"] = values.weapon2Uses_max;
	}
	if(values.weapon3UseType == "Reload"){
	output["weapon3Uses"] = values.weapon3Uses_max;
	}
	if(values.weapon4UseType == "Reload"){
	output["weapon4Uses"] = values.weapon4Uses_max;
	}

	if(values.egoUseType == "Reload"){
	output["egoUses"] = values.egoUses_max;
	}



	setAttrs(output);

	});
});

/* Action: Reset health */
   on('clicked:resetHealth', function() {
	getSectionIDs(`repeating_global`, idarray => {
        let id = `repeating_global_${idarray[0]}`;

	getAttrs(["HP_max", "StagRes_max", "SP_max", "Light_max", "distortCounter_max", "egoCondition", `${id}_staggerDurationMax`], function(values) {
	let egocon = values.egoCondition;
	let egonew = "0";
 	let hpnew = parseInt(values.HP_max);
	let stagrnew = parseInt(values.StagRes_max);
	let spnew = parseInt(values.SP_max);
	let lightnew = parseInt(values.Light_max);
	let counternew = parseInt(values.distortCounter_max);
	let staggerdurationmax = parseInt(values[`${id}_staggerDurationMax`])

	if(egocon == "AlwaysActive"){
	egonew = "true";
	}

	setAttrs({"messageOverride":"true"});

	setAttrs({"HP": hpnew, "StagRes": stagrnew, "SP":spnew, "Light":lightnew, "egoActiveState":egonew, "StaggerState":"0", "StaggerDuration":staggerdurationmax, "PanicState":"0", "SealState":"0", "ImmobileState":"0", "DefeatState":"0", "distortCounter":counternew, "THP_Sources":"", "TST_Sources":""});

 	});
	});
});

/* Action: Reset stats */
   on('clicked:resetStats', function() {

	setAttrs({"instinct":"0", "wisdom":"0", "justice":"0", "charm":"0", "insight":"0", "temperance":"0"});

	});

/* Action: Reset Observation level */
   on('clicked:resetObservation', function() {

	setAttrs({"obsDesc":"true", "obsSummary":"true", "obsCounter":"true", "obsWorkAmount":"true", "obsEffect":"0", "obsBehavior":"0", "obsTaboon":"0", "obsWorkResults":"0", "obsWorkPref":"0", "obsAppearance":"0", "obsAtmosphere":"0", "obsStory":"0"});

	});

/* Action: Reset global settings to default */
   on('clicked:resetGlobal', function() {

        getSectionIDs(`repeating_global`, idarray => {
           let id = `repeating_global_${idarray[0]}`;

	/* Translation prep */
	let langRulename = "Original Rulebook (Default)";

	if(getTranslationByKey("editor-rulename-placeholder") != false){

	langRulename = getTranslationByKey("editor-rulename-placeholder");
	}

	setAttrs({[`${id}_ruleName`]:langRulename, [`${id}_healthBase`]:"30", [`${id}_healthStat`]:"Instinct", [`${id}_healthStatMod`]:"6", [`${id}_healthRankMod`]:"6", [`${id}_staggerBase`]:"20", [`${id}_staggerStat`]:"Charm", [`${id}_staggerStatMod`]:"4", [`${id}_staggerRankMod`]:"4", [`${id}_sanityBase`]:"15", [`${id}_sanityStat`]:"Wisdom", [`${id}_sanityStatMod`]:"3", [`${id}_sanityRankMod`]:"0", [`${id}_lightBase`]:"3", [`${id}_lightRankMod`]:"1", [`${id}_distortLightBase`]:"5", [`${id}_distortLightRankMod`]:"1", [`${id}_expCalc`]:"8", [`${id}_attStat`]:"Instinct", [`${id}_defStat`]:"Temperance", [`${id}_evdStat`]:"Insight", [`${id}_evdAilment`]:"EnduranceDisarm", [`${id}_multiPenalty`]:"-2", [`${id}_multiStyle`]:"n", [`${id}_staggerRecoverPercent`]:"100", [`${id}_staggerRecoverBase`]:"0", [`${id}_staggerDurationMax`]:"1", [`${id}_staggerSanity`]:"5", [`${id}_settingBar1`]:"HP", [`${id}_settingBar2`]:"StagRes", [`${id}_settingBar3`]:"SP", [`${id}_burnDecayMode`]:"x", [`${id}_burnDecayVal`]:"0.5", [`${id}_burnNextTurnSetting`]:"false", [`${id}_bleedDecayMode`]:"x", [`${id}_bleedDecayVal`]:"0.5", [`${id}_bleedNextTurnSetting`]:"false", [`${id}_smokeDecayMode`]:"+", [`${id}_smokeDecayVal`]:"-1", [`${id}_smokeNextTurnSetting`]:"false", [`${id}_smokeCalculationMode`]:"/", [`${id}_smokeCalculationVal`]:"2", [`${id}_chargeDecayMode`]:"+", [`${id}_chargeDecayVal`]:"0", [`${id}_chargeNextTurnSetting`]:"false", "settingLimbusStyle":"0"});

        	});

	});

/* Action: Export global settings from button */
   on('clicked:exportGlobal', function() {

	dataExportGlobal();

});

function dataExportGlobal() {
     getSectionIDs(`repeating_global`, idarray => {
	let id = `repeating_global_${idarray[0]}_`;
	let attrkey = [`${id}ruleName`, `${id}healthBase`, `${id}healthStat`, `${id}healthStatMod`, `${id}healthRankMod`, `${id}staggerBase`, `${id}staggerStat`, `${id}staggerStatMod`, `${id}staggerRankMod`, `${id}sanityBase`, `${id}sanityStat`, `${id}sanityStatMod`, `${id}sanityRankMod`, `${id}lightBase`, `${id}lightRankMod`, `${id}distortLightBase`, `${id}distortLightRankMod`, `${id}attStat`, `${id}defStat`, `${id}evdStat`, `${id}evdAilment`, `${id}multiPenalty`, `${id}multiStyle`, `${id}staggerRecoverPercent`, `${id}staggerRecoverBase`, `${id}staggerDurationMax`, `${id}staggerSanity`, `${id}settingBar1`, `${id}settingBar2`, `${id}settingBar3`, `${id}burnDecayMode`, `${id}burnDecayVal`, `${id}burnNextTurnSetting`, `${id}bleedDecayMode`, `${id}bleedDecayVal`, `${id}bleedNextTurnSetting`, `${id}smokeDecayMode`, `${id}smokeDecayVal`, `${id}smokeNextTurnSetting`, `${id}smokeCalculationMode`, `${id}smokeCalculationVal`, `${id}chargeDecayMode`, `${id}chargeDecayVal`, `${id}chargeNextTurnSetting`, `settingLimbusStyle`];
	let exportkey = attrkeyGlobal;
	let textbase = "";

	getAttrs(attrkey, function(values) {

		for(let i = 0; i< attrkey.length ;i++){
		tempval = values[attrkey[i]];

		if(tempval == undefined){
		tempval = "";
		}

   	 	textbase += "[`" + exportkey[i] + "`,`" + tempval + "`]";

		if(i < (attrkey.length - 1)){
		textbase += ", ";
		}

		}


	textbase = textbase.replace(/	/g, ''); /* Remove whitespace */
	

	setAttrs({"gameEditor": textbase });


		});
	});

}

/* Action: Import global settings */
   on('clicked:importGlobal', function() {

      getSectionIDs(`repeating_global`, idarray => {
           let id = `repeating_global_${idarray[0]}_`;

		dataImport("gameEditor", id, "global_");

		});

});

/* Action: Sync global settings */
on('clicked:syncGlobal', function() {

getSectionIDs(`repeating_global`, idarray => {
	let id = `repeating_global_${idarray[0]}_`;

	getAttrs(["syncLockGame", "syncStateGame", "gameEditor", `${id}gameSettingSource`], function(values) {
	let syncCheck = values.syncLockGame;
	let syncState = values.syncStateGame;

	let current = values.gameEditor;
	let source = values[`${id}gameSettingSource`];

	/* Translation prep */
	let langSync = "Sync";
	let langGameSettings = "Game Settings";
	let langSyncSuccess = " sync successful.";
	let langSyncFail =  " is locked.\n Unlock before syncing.";
	let langSyncNoChange = "No change. Current data is synced.\n(Press Import if display does not match.)";
	let langSyncEmpty = "No change. Source data is empty.";

	if(getTranslationByKey("sync-button") != false){
	langSync = getTranslationByKey("sync-button");
	langGameSettings = getTranslationByKey("editor-gamesettings");
	langSyncSuccess = getTranslationByKey("pop-sync-success");
	langSyncFail = getTranslationByKey("pop-sync-fail");
	langSyncNoChange = getTranslationByKey("pop-sync-synced");
	langSyncEmpty = getTranslationByKey("pop-sync-empty");

	}

	let syncHeader = langSync;
	let syncBody = "";
	let syncToggle = "0"; 
	const output = {};


	if(source != null && source != ""){
	if(source != current && syncCheck != "true"){

	setAttrs({"gameEditor":source});

	dataImport(`${id}gameSettingSource`, id, "global_");

	syncState = "0";
	syncBody = langGameSettings + langSyncSuccess;
	syncToggle = "true"; 

		}
	else if(source != current && syncCheck == "true"){
	syncBody = langGameSettings + langSyncFail;
	syncToggle = "true"; 

		}
	else if(source == current) {
	syncBody = langSyncNoChange;
	syncToggle = "true"; 

		}
	}
	else {
	syncHeader = langSync;
	syncBody = langSyncEmpty;
	syncToggle = "true"; 
	}

	output[`popup_messageHeader`] = syncHeader;
	output[`popup_messageBody`] = syncBody;
	output[`popup_display`] = syncToggle;
	output[`syncStateGame`] = syncState;

	setAttrs(output);


			});
		});

});


/* Action: Reset damage helper values */
on('clicked:resetDamageHelper', function() {
	setAttrs({"baseDamage":"0", "flatDamageHP":"0", "flatDamageST":"0", "damageHelperType":"None"});
});


/* Action: Reset roll helper values */
on('clicked:resetHelpers', function() {
	getAttrs(["Paralysis", "Fortune"], function(values) {

	let newadvNum = values.Fortune;
	let newdisadvNum = values.Paralysis;

	setAttrs({"baseSpeed":"0", "Difficulty":"0", "advNum":newadvNum, "disadvNum":newdisadvNum, "advState":"0", "baseActNum":"0", "baseLuckNum":"0", "skillSelect":"0"});


 		});

	});


/* Auto: EGO condition update */
on("change:egoCondition", function() {

	getAttrs(["egoCondition", "HP", "HP_max", "StaggerState"], function(values) {
	let condition = values.egoCondition;
	let currenthp = parseInt(values.HP);
	let halfhp = parseInt((values.HP_max) / 2);
	let stagger = values.StaggerState;
	setAttrs({"egoActiveState":"0"});

	if(condition == "AlwaysActive"){
	setAttrs({"egoActiveState":"true"});

	}
	else if(condition == "OnStagger" && stagger != "0"){
	setAttrs({"egoActiveState":"true"});
	}
	else if(condition == "HalfHealth" && currenthp <= halfhp){
	setAttrs({"egoActiveState":"true"});
	}

	});
});

/* Checking for tool select changes */
on("change:tool1Name change:tool2Name change:tool3Name change:tool4Name change:tool1Uses change:tool2Uses change:tool3Uses change:tool4Uses change:special1Name change:special2Name ", function(){

	setAttrs({"toolSelect":""});

});

/* Checking for weapon range changes */
on("change:weapon1Range", function(){ 
	getAttrs(["weapon1Range"], function(values){
	if(values.weapon1Range == "Ranged"){setAttrs({"weapon1UseType":"Reload"}); }
	else { setAttrs({"weapon1UseType":"Limitless"}); }
	}); });

on("change:weapon2Range", function(){ 
	getAttrs(["weapon2Range"], function(values){
	if(values.weapon2Range == "Ranged"){setAttrs({"weapon2UseType":"Reload"}); }
	else { setAttrs({"weapon2UseType":"Limitless"}); }
	}); });

on("change:weapon3Range", function(){ 
	getAttrs(["weapon3Range"], function(values){
	if(values.weapon3Range == "Ranged"){setAttrs({"weapon3UseType":"Reload"}); }
	else { setAttrs({"weapon3UseType":"Limitless"}); }
	}); });

on("change:weapon4Range", function(){ 
	getAttrs(["weapon4Range"], function(values){
	if(values.weapon4Range == "Ranged"){setAttrs({"weapon4UseType":"Reload"}); }
	else { setAttrs({"weapon4UseType":"Limitless"}); }
	}); });

/* Auto: Update Skill Selection */
on("change:skillSelect", function() {

	/* Get IDs/names */
	getAttrs(["skillSelect"], function(values){
    let buttonid = values.skillSelect;
	let skillcat = buttonid.split('S')[0];

	let name = buttonid + "Name";
	let type = buttonid + "Type";
	let rank = buttonid + "Rank";
	let effect = buttonid + "Effect";
	let desc = buttonid + "Description";
	let light = buttonid + "Light";

	let diceA = buttonid + "Dice1";
	let diceB = buttonid + "Dice2";
	let diceC = buttonid + "Dice3";
	let noskill = "0";

	/* Get attributes */
	if(buttonid != "0"){
        getAttrs([`${name}`, `${type}`, `${rank}`, `${effect}`, `${desc}`, `${light}`, `${diceA}`, `${diceB}`, `${diceC}`, "Light"], function(values) {

	let skillname = values[name];
	let skillrank = values[rank];
	let skilltype = values[type];
	let skilleffect = values[effect];
	let skilldesc = values[desc];
	let skilllight = values[light];

	let skilldiceA = values[diceA];
	let skilldiceB = values[diceB];
	let skilldiceC = values[diceC];

	let currentLight = values.Light;

	if(currentLight < skilllight){
	noskill = "true";

	setAttrs({"selectName":skillname, "selectRank":"0", "selectType":"0", "selectEffect":skilleffect, "selectDescription":skilldesc, "selectLight":skilllight, "selectDice1":"0", "selectDice2":"0", "selectDice3":"0", "selectDefDice1":"0", "selectDefDice2":"0", "selectDefDice3":"0", "selectAtkDice1":"0", "selectAtkDice2":"0", "selectAtkDice3":"0", "selectEvdDice1":"0", "selectEvdDice2":"0", "selectEvdDice3":"0", "selectCancel":noskill});
	}
	else{
	if(skilltype == "Attack" || skilltype == "Mass"){
	setAttrs({"selectAtkDice1":skilldiceA, "selectAtkDice2":skilldiceB, "selectAtkDice3":skilldiceC, "selectDefDice1":"0", "selectDefDice2":"0", "selectDefDice3":"0", "selectEvdDice1":"0", "selectEvdDice2":"0", "selectEvdDice3":"0"});
		}
	else if(skilltype == "Defend"){
	setAttrs({"selectDefDice1":skilldiceA, "selectDefDice2":skilldiceB, "selectDefDice3":skilldiceC, "selectAtkDice1":"0", "selectAtkDice2":"0", "selectAtkDice3":"0", "selectEvdDice1":"0", "selectEvdDice2":"0", "selectEvdDice3":"0"});
		}
	else if(skilltype == "Evade"){
	setAttrs({"selectEvdDice1":skilldiceA, "selectEvdDice2":skilldiceB, "selectEvdDice3":skilldiceC, "selectDefDice1":"0", "selectDefDice2":"0", "selectDefDice3":"0", "selectAtkDice1":"0", "selectAtkDice2":"0", "selectAtkDice3":"0"});
		}
	else {
	setAttrs({"selectEvdDice1":"0", "selectEvdDice2":"0", "selectEvdDice3":"0", "selectDefDice1":"0", "selectDefDice2":"0", "selectDefDice3":"0", "selectAtkDice1":"0", "selectAtkDice2":"0", "selectAtkDice3":"0"});

		}

	setAttrs({"selectName":skillname, "selectRank":skillrank, "selectType":skilltype, "selectEffect":skilleffect, "selectDescription":skilldesc, "selectLight":skilllight, "selectDice1":skilldiceA, "selectDice2":skilldiceB, "selectDice3":skilldiceC, "selectCancel":noskill});
	}
		});
	}
else {
	setAttrs({"selectName":" ", "selectRank":"0", "selectType":"0", "selectEffect":" ", "selectDescription":" ", "selectLight":"0", "selectDice1":"0", "selectDice2":"0", "selectDice3":"0", "selectDefDice1":"0", "selectDefDice2":"0", "selectDefDice3":"0", "selectAtkDice1":"0", "selectAtkDice2":"0", "selectAtkDice3":"0", "selectEvdDice1":"0", "selectEvdDice2":"0", "selectEvdDice3":"0", "selectCancel":noskill});
	}

});

});


/* Action: Update ailments */
on('clicked:updateAilments', function() {
	Update();
});
/* Executed either a standard update or a generic token update if the setting is enabled */
let updateDelay = 1000;
let initialTokenId_selected = "";
function Update() {
	getAttrs(['settingGenericTokenMode', 'tokenId_selected', 'configUpdateDelay'], async function(values) {
		if (values.settingGenericTokenMode == "true") {
			getSectionIDs(`repeating_tokens`, tokenidarray => {
				initialTokenId_selected = values.tokenId_selected;
				updateDelay = parseInt(values.configUpdateDelay);
				delayUpdateAilments(tokenidarray);
			});
		} else {
			updateAilments();
		}
	});
}
/* When using multiple tokens, due to all the on:change functions used by the sheet, a delay is 
    needed to ensure all fields have been properly updated before proceeding to the next token */
function delayUpdateAilments(tokenidarray) {
	setTimeout(function() {
		let tokenId = tokenidarray[0];
		changeActiveToken(tokenId, () => {
			updateAilments([], () => {
				/* Repeat loop while unupdated tokenIds remain */
				if (tokenidarray.length > 1) {
					delayUpdateAilments(tokenidarray.slice(1));
				} else {
					setTimeout(function() {
						setAttrs({"tokenId_selected": initialTokenId_selected});
						initialTokenId_selected = "";
					}, updateDelay);
				}
			});
		});
	}, updateDelay); // For my PC 500ms seems fine, but leaving it at 1000ms to hopefully make it run properly for lower spec PCs
}

/* Has the following modes: */
/* single: updates main sheet */
/* multiple: updates all token's sheets */
function updateAilments(ailmentOverride=[], callback=()=>{}) {
	
	getSectionIDs(`repeating_global`, idarray => {
		let id = `repeating_global_${idarray[0]}`;

		let ailmentNames = ["Burn", "Bleed", "Paralysis", "Protection", "StaggerProtection", "Fragile", "Strength", "Feeble", "Endurance", "Disarm", "Haste", "Bind", "Smoke", "Charge", "Fortune"];
		if (ailmentOverride.length != 0) { ailmentNames = ailmentOverride; }

		let attributeList = [];
		ailmentNames.forEach(ailment => {
			attributeList.push(`${ailment}`, `${ailment}NextTurn`, `${ailment}DecayPause`);
		});

	getAttrs(["settingMuteMessage", "settingWhisperRolls", "settingWhisperTarget", "settingBurnImmune", "nextRoundSpeed",
		"StaggerState", "StaggerDuration", `${id}_staggerDurationMax`, "SealState", "ImmobileState", "burnResist", "burnResist_ego", "distortState", "egoActiveState", "egoType", "HP", "StagRes_max", "settingLimbusStyle",
		`${id}_staggerRecoverPercent`, `${id}_staggerRecoverBase`, `${id}_burnDecayMode`, `${id}_burnDecayVal`, `${id}_smokeDecayMode`, `${id}_smokeDecayVal`, `${id}_chargeDecayMode`, `${id}_chargeDecayVal`,
		...attributeList, "THP_Sources"], function(values) {

 	let burnnew = 0;
	let bleednew = parseInt(values.Bleed);
	let smokenew = 0;
	let chargenew = 0;
	let stagnew = "0";

	let nomessage = values.settingMuteMessage;
	let burnimmune = values.settingBurnImmune;
	let iconstyle = values.settingLimbusStyle;
	let stagcheck = values.StaggerState;
	let stagduration = parseInt(values.StaggerDuration);
	let stagdurationmax = parseInt(values[`${id}_staggerDurationMax`]);
	let sealcheck = values.SealState;
	let immobilecheck = values.ImmobileState;

	let iconnew = "";

	let style = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/";
	if(values.settingLimbusStyle == "true"){
	style = style + "limbus/";
	}

	let nextRoundSpeed = parseInt(values.nextRoundSpeed);

	let burnresist = values.burnResist;
	let distortstate = values.distortState;
	let egostate = values.egoActiveState;
	let egotype = values.egoType;

	if(egostate == "true" && egotype == "Outfit" && distortstate != "true"){
	burnresist = values.burnResist_ego;
	}
	else if(distortstate == "true"){
	burnresist = parseInt(values.burnResist) + parseInt(values.burnResist_ego);
	}

	let THP_Sources = {};
	if (values.THP_Sources != "" && values.THP_Sources != "{}") {
		THP_Sources = JSON.parse(values.THP_Sources);
	}
	
	let output = {};
	let autoScriptOverrideList = {};

	/* Whisper roll */
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Burn processing */
	if(ailmentNames.includes("Burn")) {
		let burncurrent = parseInt(values.Burn);
		let burndecay = parseFloat(values[`${id}_burnDecayVal`]);
		
		if (burncurrent > 0) {
	
			/* Decay */
			if (parseInt(values.BurnDecayPause) == 0) {
				if(burndecay == "n"){
				burndecay = parseInt(burncurrent);
				}
				else if(burndecay == "-n"){
				burndecay = parseInt(0 - burncurrent);
				}
		
				if(values[`${id}_burnDecayMode`] == "+"){
				burnnew += parseInt(burncurrent) + parseInt(burndecay);
				}
				else if(values[`${id}_burnDecayMode`] == "x"){
				burnnew += parseInt(parseInt(burncurrent) * parseFloat(burndecay));
				}
				else if(values[`${id}_burnDecayMode`] == "="){
				burnnew += parseInt(burndecay);
				}
			}

			/* Damage */
			let burndamage = parseInt(values.Burn - burnresist);
	
			if(burndamage <= 0){
			burndamage = 0;
			}
	
			let burnresult = parseInt(values.HP - burndamage);
	
			let iconnew = "<img src='"+ style + "Burn.png' style='width: 25px; height: 25px;' >";
	
			if(burnimmune == "true"){
				burnresult = parseInt(values.HP);
				burndamage = 0;
			}

			/* Temporary HP */
			let THPUsed = {}
			let THPmessage = "";
			if (burndamage > 0 && Object.keys(THP_Sources).length > 0) {
				let returnTHP = applyTempBarDamageAilment(THP_Sources, "THP", burndamage, burnresult);
				burnresult = returnTHP.newBar;
				burndamage = returnTHP.damage;
				THPUsed = returnTHP.THPUsed;
			}
			for (const sourceName in THPUsed) {
				let countUpdate = ` [${parseInt(THPUsed[sourceName][0] + THPUsed[sourceName][1])} -> ${THPUsed[sourceName][0]}]`;
				THPmessage += "<b style='opacity: 50%;'><br>(" + sourceName + ": " + THPUsed[sourceName][1] + countUpdate + ")</b>";
			}
	
			/* Translation prep */
			let langBurn = " was burned for ";
			let langDamage = " damage.";
			let langResist = "Resistance: ";
			let langResistCombined = "";
	
			if(getTranslationByKey("message-burn") != false){
	
			langBurn = getTranslationByKey("message-burn");
			langDamage= getTranslationByKey("message-damage");
			langResist= getTranslationByKey("message-resist");
			}
	
			if(burnresist != "0"){
				langResistCombined = "<b style='opacity: 50%;'><br>(" + langResist + burnresist + ")</b>";
			}
	
			let burnmessage = langBurn + "<b>" + burndamage + "</b> " + langDamage + "." + langResistCombined + THPmessage;
	
			setAttrs({"HP":burnresult, "dummy":burnmessage, "dummyIcon":iconnew});
			autoScriptOverrideList.Burn = [burnnew, burncurrent];
	
			if(nomessage != "true" && burnimmune != "true"){
				startRoll((whisper + "&{template:message} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{message=@{dummy} }}"), (results) => {
					finishRoll(results.rollId, {} );
				});
			}
		}
	}


	/* Custom Ailments */
	/* Do not process if only specific ailments are being updated */
	updateCustomAilments((ailmentNames.length == 15) ? ["RoundEnd"] : [], "standard", "true", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);

	updateCustomAilments((ailmentNames.length == 15) ? ["OnAction", "WhenHit"] : [], "decay", "true", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);


	/* Smoke processing */
	if(ailmentNames.includes("Smoke")) {
		let smokecurrent = parseInt(values.Smoke);
		let smokedecay = parseFloat(values[`${id}_smokeDecayVal`]);

		if (smokecurrent > 0){
	
			if (parseInt(values.SmokeDecayPause) == 0) {
				if(smokedecay == "n"){
				smokedecay = parseInt(smokecurrent);
				}
				else if(smokedecay == "-n"){
				smokedecay = parseInt(0 - smokecurrent);
				}
	
				if(values[`${id}_smokeDecayMode`] == "+"){
				smokenew += parseInt(smokecurrent) + parseInt(smokedecay);
				}
				else if(values[`${id}_smokeDecayMode`] == "x"){
				smokenew += parseInt(parseInt(smokecurrent) * parseFloat(smokedecay));
				}
				else if(values[`${id}_smokeDecayMode`] == "="){
				smokenew += parseInt(smokedecay);
				}
			}
			autoScriptOverrideList.Smoke = [smokenew, smokecurrent];
		}
	}

	/* Charge processing */
	if(ailmentNames.includes("Charge")) {
		let chargecurrent = parseInt(values.Charge);
		let chargedecay = parseFloat(values[`${id}_chargeDecayVal`]);

		if (chargecurrent > 0){
			
			if (parseInt(values.ChargeDecayPause) == 0) {
				if(chargedecay == "n"){
				chargedecay = parseInt(chargecurrent);
				}
				else if(chargedecay == "-n"){
				chargedecay = parseInt(0 - chargecurrent);
				}

				if(values[`${id}_chargeDecayMode`] == "+"){
				chargenew += parseInt(chargecurrent) + parseInt(chargedecay);
				}
				else if(values[`${id}_chargeDecayMode`] == "x"){
				chargenew += parseInt(parseInt(chargecurrent) * parseFloat(chargedecay));
				}
				else if(values[`${id}_chargeDecayMode`] == "="){
				chargenew += parseInt(chargedecay);
				}
			}
			autoScriptOverrideList.Charge = [chargenew, chargecurrent];
		}
	}


	/* Stagger processing */
	if(stagcheck == "Staggered"){
		if(stagduration == 0) {
			stagnew = parseInt((values.StagRes_max) * parseFloat(parseInt(values[`${id}_staggerRecoverPercent`])/100) + parseInt(values[`${id}_staggerRecoverBase`]));
			setAttrs({"StaggerState":"0", "StaggerDuration":stagdurationmax, "StagRes":stagnew});
		} else {
			setAttrs({"StaggerDuration":stagduration-1});
		}
	}

	/* Seal processing */
	if(sealcheck != "0"){
		setAttrs({"SealState":"0"});
	}

	/* Immobile processing */
	if(immobilecheck != "0"){
		setAttrs({"ImmobileState":"0"});
	}

	/* AutoScripts */
	resetConditionals();
	AutoScriptMain("", "Round start", "true", "true", {...autoScriptOverrideList, targetmode: "false"});

	output = {
		...output, "thisRoundSpeed":nextRoundSpeed, "nextRoundSpeed":0, "isFirstRound":"false", "baseActNum":"0",
		"Bleed":bleednew, "Burn": burnnew, "Smoke":smokenew, "Charge": chargenew
	}

	/*output = {
		...output, "thisRoundSpeed":nextRoundSpeed, "nextRoundSpeed":0, "isFirstRound":"false", "baseActNum":"0",
		"Bleed":bleednew, "BleedNextTurn":"0", "Burn": burnnew, "BurnNextTurn":"0", "Paralysis": paralysisnew, "ParalysisNextTurn":"0", "Protection": protectionnew, "ProtectionNextTurn":"0",
		"StaggerProtection": staggerprotectionnew, "StaggerProtectionNextTurn":"0", "Fragile": fragilenew, "FragileNextTurn":"0", "Strength": strengthnew, "StrengthNextTurn":"0",
		"Feeble": feeblenew, "FeebleNextTurn":"0", "Endurance": endurancenew, "EnduranceNextTurn":"0", "Disarm": disarmnew, "DisarmNextTurn":"0", "Haste": hastenew, "HasteNextTurn":"0",
		"Bind": bindnew, "BindNextTurn":"0", "Smoke": smokenew, "SmokeNextTurn":"0", "Charge":chargenew, "ChargeNextTurn":"0", "Fortune":fortunenew, "FortuneNextTurn":"0"
	}*/

	ailmentNames.forEach(ailment => {
		/* If decay pause is active, keep current count and decrease the pause count by 1 */
		if (parseInt(values[`${ailment}DecayPause`]) > 0 && ailment != "Bleed") {
			output[`${ailment}`] = parseInt(values[`${ailment}`]);
			output[`${ailment}DecayPause`] = parseInt(values[`${ailment}DecayPause`]) - 1;
		}

		/* Add NextTurn count */
		if (output[`${ailment}`] != undefined) { output[`${ailment}`] += parseInt(values[`${ailment}NextTurn`]); }
		else { output[`${ailment}`] = parseInt(values[`${ailment}NextTurn`]); }
		output[`${ailment}NextTurn`] = 0;
	});
	setAttrs(output, {}, () => {
		callback();
	});
	});
	});
	});
	});
}

function updateAdvantages(changeval){

getAttrs(["Paralysis", "Fortune", "advState", "advNum", "disadvNum"], function(values) {

	let newadvstate = values.advState;

	let newparalysis = values.Paralysis - parseInt(changeval);
	let newfortune = values.Fortune - parseInt(changeval);
	let newadvnum = values.advNum - parseInt(changeval);
	let newdisadvnum = values.disadvNum - parseInt(changeval);

	if(newfortune < 0){newfortune = 0;}
	if(newparalysis < 0){newparalysis = 0;}
	if(newadvnum < 0){ newadvnum = 0;}
	if(newdisadvnum < 0) { newdisadvnum = 0;}

	let comparePos = newadvnum;
	let compareNeg = newdisadvnum;

	const output = {};

	if(values.advState == "Advantage" && values.advNum != "0"){

		if(values.Fortune > 0){
		output["Fortune"] = newfortune;
		comparePos = newfortune;
		compareNeg = newparalysis;
		}
		else{
		output["advNum"] = newadvnum;}

	}
	else if(values.advState == "Disadvantage" && values.disadvNum != "0"){

		if(values.Paralysis > 0){
		output["Paralysis"] = newparalysis;
		comparePos = newfortune;
		compareNeg = newparalysis;
		}
		else{
		output["disadvNum"] = newdisadvnum;}
	}

	if(comparePos == compareNeg){
	newadvstate = "0";
	}
	else if(comparePos > compareNeg){
	newadvstate = "Advantage";
	}
	else if(comparePos < compareNeg){
	newadvstate = "Disadvantage";
	}

	output["advState"] = newadvstate;

	setAttrs(output);

	});

}

/* Has the following modes : */
/* standard - Triggers both decay and damage like normal */
/* decay - Triggers only decay */
/* damage - Triggers only damage */
function updateBleed(mode="standard", callback=() => {}) {
getSectionIDs(`repeating_global`, idarray => {
           let id = `repeating_global_${idarray[0]}`;

getAttrs(["Bleed", "BleedDecayPause", "bleedResist", "bleedResist_ego", "distortState", "egoActiveState", "egoType", "HP",
	"settingBleedImmune", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage", "settingLimbusStyle", "character_name", `${id}_bleedDecayMode`, `${id}_bleedDecayVal`,
	"THP_Sources"], function(values) {

	let bleednew = "0";
	let bleedcurrent = values.Bleed;
	let bleeddecaypause = parseInt(values.BleedDecayPause);
	let bleeddecay = values[`${id}_bleedDecayVal`];
	let bleeddamage = 0;
	let bleedresult = parseInt(values.HP);

	let bleedimmune = values.settingBleedImmune;
	let bleedmessage = " ";
	let charname = values.character_name;
	let nomessage = values.settingMuteMessage;
	let hiddenroll = values.settingWhisperRolls;
	let bleedresist = values.bleedResist;

	let distortstate = values.distortState;
	let egostate = values.egoActiveState;
	let egotype = values.egoType;

	if(egostate == "true" && egotype == "Outfit" && distortstate != "true"){
		bleedresist = values.bleedResist_ego;
	}
	else if(distortstate == "true"){
		bleedresist = parseInt(values.bleedResist) + parseInt(values.bleedResist_ego);
	}

	if (bleeddecaypause > 0) {
		mode = "damage";
		setAttrs({"BleedDecayPause":bleeddecaypause - 1});
	}

	let THP_Sources = {};
	if (values.THP_Sources != "" && values.THP_Sources != "{}") {
		THP_Sources = JSON.parse(values.THP_Sources);
	}

	/* Translation prep */
	let langBleed = " bled for ";
	let langDamage = " damage.";
	let langResist = "Resistance: "
	let langResistCombined = "";

	if(getTranslationByKey("message-bleed") != false){

	langBleed = getTranslationByKey("message-bleed");
	langDamage= getTranslationByKey("message-damage");
	langResist= getTranslationByKey("message-resist");
	}

	if(bleedresist != "0"){
	langResistCombined = "<b style='opacity: 50%;'><br>(" + langResist + bleedresist + ")</b>";
	}

	/* Bleed processing */
	if (parseInt(values.Bleed) > 0) {

		/* Decay */
		if (mode == "standard" || mode == "decay") {
			if(bleeddecay == "n"){
			bleeddecay = parseInt(bleedcurrent);
			}
			else if(bleeddecay == "-n"){
			bleeddecay = parseInt(0 - bleedcurrent);
			}
	
			if(values[`${id}_bleedDecayMode`] == "+"){
			bleednew = parseInt(bleedcurrent) + parseInt(bleeddecay);
			}
			else if(values[`${id}_bleedDecayMode`] == "x"){
			bleednew = parseInt(parseInt(bleedcurrent) * parseFloat(bleeddecay));
			}
			else if(values[`${id}_bleedDecayMode`] == "="){
			bleednew = parseInt(bleeddecay);
			}
		}
		else {
			bleednew = parseInt(bleedcurrent)
		}

		/* Damage */
		if (mode == "standard" || mode == "damage" || bleedimmune != "true") {
			bleeddamage = Math.max(parseInt(values.Bleed - bleedresist), 0);
			bleedresult -= bleeddamage;
		}

		/* Temporary HP */
		let THPUsed = {}
		let THPmessage = "";
		if (bleeddamage > 0 && Object.keys(THP_Sources).length > 0) {
			let returnTHP = applyTempBarDamageAilment(THP_Sources, "THP", bleeddamage, bleedresult);
			bleedresult = returnTHP.newBar;
			bleeddamage = returnTHP.damage;
			THPUsed = returnTHP.THPUsed;
		}
		for (const sourceName in THPUsed) {
			let countUpdate = ` [${parseInt(THPUsed[sourceName][0] + THPUsed[sourceName][1])} -> ${THPUsed[sourceName][0]}]`;
			THPmessage += "<b style='opacity: 50%;'><br>(" + sourceName + ": " + THPUsed[sourceName][1] + countUpdate + ")</b>";
		}

		/* Chat message */
		if(nomessage != "true" && bleedimmune != "true"){
			let iconnew = getIcon("ailments", "Bleed", values.settingLimbusStyle, 'style="width: 25px; height: 25px;"');
			
			bleedmessage = iconnew + " <b>" + charname + "</b>" + langBleed + "<b>" + bleeddamage + "</b> " + langDamage + "." + langResistCombined + THPmessage;

			/* Whisper roll */
			let whisperrolls = values.settingWhisperRolls;
			let whispertarget = values.settingWhisperTarget;
			let whisper = "";
			if(whisperrolls == "true"){
			whisper = "/w " + whispertarget;
			}

			setAttrs({"dummy":bleedmessage});

			/*--- Send roll --*/
			startRoll((whisper + `&{template:message} {{message=@{dummy} }}`), (results) => {
				finishRoll(results.rollId, { });
			});

			setAttrs({"dummy":" "});
		}

		/* Apply damage */
		if (bleedimmune != "true") {
			setAttrs({"HP":bleedresult, "Bleed":bleednew});
		}
		callback({ Bleed: [bleednew, bleedcurrent] });
	} else {
		callback();
	}
	});
	});
}

/* Action: Combat Roll */
on('clicked:rollCombat', (info) => {
	/* Preparing values */
	/* Get IDs/names */
	let buttonid = info.htmlAttributes.id.split('_')[1];
	let rawcheck = info.htmlAttributes.id.split('_')[2];
	let numcheck = info.htmlAttributes.id.split('_')[3];

	let name = buttonid + "Name";
	let type = buttonid + "Type";
	let effect = buttonid + "Effect";
	let range = buttonid + "Range";
	let uses = "";
	let usesmax = "";
	let usetype = "";

	if(buttonid != "def" && buttonid != "evd"){
	uses = buttonid + "Uses";
	usesmax = buttonid + "Uses_max";
	usetype = buttonid + "UseType";
	}

	if(buttonid == "egoWeapon" || buttonid == "egoDef" || buttonid == "egoEvd"){
	uses = "egoUses";
	usesmax = "egoUses_max";
	usetype = "egoUseType";
	}

	let diceA = buttonid + "Dice1";
	let diceB = buttonid + "Dice2";
	let diceC = buttonid + "Dice3";

	let headercolor = "#888";
	let headertext = "#fff";

	let basetype = "";

	let newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png";

	/* Action type formatting */
	if(buttonid == "def" && rawcheck != "distort"){
	basetype = "Defend";
	headercolor = "#7397d1";
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/defend.png";
	}
	else if(buttonid == "egoDef" || (buttonid == "def" && rawcheck == "distort")) {
	basetype = "Defend";
	headercolor = "#000";
	headertext = "#6d9eeb";
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoDef.png";
	}
	else if(buttonid == "evd" && rawcheck != "distort"){
	basetype = "Evade";
	headercolor = "#dbb748";
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/evade.png";
	}
	else if(buttonid == "egoEvd" || (buttonid == "evd" && rawcheck == "distort")){
	basetype = "Evade";
	headercolor = "#000";
	headertext = "#f1c232";
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoEvd.png";
	}
	else if(buttonid == "act"){
	basetype = "Action";
	headercolor = "#8e7cc3";
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Portable.png";
	}
	else if(buttonid == "egoWeapon" || rawcheck == "distort"){
	basetype = "Attack";
	headercolor = "#000";
	headertext = "#cc4125";
	}
	else {
	basetype = "Attack";
	headercolor = "#c25944";
	}

	if(buttonid == "egoWeapon" || buttonid == "egoDef" || buttonid == "egoEvd"){
	effect = "egoEffect";
	name = "egoName";
	}
	else if(buttonid == "def" || buttonid == "evd"){
	effect = "outfitEffect";
	name = "outfitName";

	}
	

	/* Get attributes */

getSectionIDs(`repeating_global`, idarray => {
           let id = `repeating_global_${idarray[0]}`;

		/* Get skillSelect and toolSelect first as they're used to gather further values */
		getAttrs(["skillSelect", "toolselect"], function(values) {
			let skillselect = values.skillSelect;
			let toolselect = values.toolselect;

        getAttrs(["egoActiveState", "settingSimpleDisplay", "settingHideBaseEffect", "settingHideCombatOptions", "settingWhisperRolls", "settingWhisperTarget", "settingMultihitFull",
		`${id}_multiPenalty`, `${id}_multiStyle`, "targetName", "targetTokenId", "character_name", "advState", "difficulty", "baseActNum", "Light",
		"difficulty", "Bleed", "Endurance", "Disarm", "Strength", "Feeble", "evdPositive", "evdNegative", "advNum", "disadvNum", "attPower", "defPower", "evdPower",
		"selectName", "selectLight", "selectType", "selectDice1", "selectDice2", "selectDice3", "selectEffect",
		"distortWeaponDice1", "distortWeaponDice2", "distortWeaponDice3", "distortDefDice1", "distortDefDice2", "distortDefDice3", "distortEvdDice1", "distortEvdDice2", "distortEvdDice3", "distortEffect", "distortEffect2", "settingMultihitUses", "settingHideUses",
		`${name}`, `${type}`, `${range}`, `${effect}`, `${diceA}`, `${diceB}`, `${diceC}`, `${uses}`, `${usesmax}`, `${usetype}`,
		`${buttonid}AutoScript`, "outfitAutoScript", "egoAutoScript",
		`${skillselect}AutoScript`, `${toolselect}Name`, `${toolselect}Description`, `${toolselect}Effect`, `${toolselect}Uses`, `${toolselect}Uses_max`, `${toolselect}Reusable`, `${toolselect}AutoScript`], function(values) {

	let output = {}

	let currentlight = parseInt(values.Light);
	let newlight = parseInt(values.Light);
	let charname = values.character_name;
	let targetname = values.targetName;
	let targettokenid = values.targetTokenId;
	let simpledisplay = values.settingSimpleDisplay;
	let hidebaseffect = values.settingHideBaseEffect;
	let hidecombatoptions = values.settingHideCombatOptions;
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;

	let currentuses = parseInt(values[`${uses}`]);
	let newuses = parseInt(values[`${uses}`]);
	let maxuses = values[`${usesmax}`];
	let limitbehavior = values[`${usetype}`];
	let weaponuse = "";

	if(limitbehavior != "Limitless" && limitbehavior != null && values.settingHideUses != "true"){
	weaponuse = " (" + currentuses + "/" + maxuses + ")";
	}

	let multihitfull = values.settingMultihitFull;
	let multipenalty = parseInt(values[`${id}_multiPenalty`]);
	let multistyle = values[`${id}_multiStyle`];

	let distortstate = values.distortState;

	let advstate = values.advState;
	let difficulty = parseInt(values.difficulty);
	let lightmessage = "";

	let advcounter = values.advNum;
	let disadvcounter = values.disadvNum;

	let actcounter = parseInt(values.baseActNum) + 1;

	/* Base dice */
	let baseset = values;
	let basename = values[name];
	let baseeffect = values[effect];

	let basedice1 = values[diceA];
	let basedice2 = values[diceB];
	let basedice3 = values[diceC];

	let weapontype = values[type];
	let weaponrange = values[range];

	let basetypemessage = basetype;
	let weaponmessage = "";
	let attackmessage = "";

	/* Weapon icon variations */
	if(weapontype == "Slash" && buttonid != "egoWeapon" && rawcheck != "distort"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Slash.png";
	}
	else if(weapontype == "Pierce" && buttonid != "egoWeapon" && rawcheck != "distort"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/pierce.png";
	}
	else if(weapontype == "Blunt" && buttonid != "egoWeapon" && rawcheck != "distort"){
	newicon= "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/blunt.png";
	}
	else if(weapontype == "Slash" && (buttonid == "egoWeapon" || rawcheck == "distort")){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoSlash.png";
	}
	else if(weapontype == "Pierce" && (buttonid == "egoWeapon" || rawcheck == "distort")){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoPierce.png";
	}
	else if(weapontype == "Blunt" && (buttonid == "egoWeapon" || rawcheck == "distort")){
	newicon= "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoBlunt.png";
	}

	/* Outfit name */ 
	if((buttonid == "def" || buttonid == "evd") && basename == ""){
	basename = getTranslationByKey("outfit-name") || "Outfit";

	}

	/* Translation prep */
	let langFrom = "From";
	let langRoll = "Roll";
	let langSkill = "Skill";
	let langEffectBase = "Base effect";
	let langEffectSkill = "Skill effect";
	let langAdv = "Adv.";
	let langDisadv = "Disadv.";
	let langMass = "Mass Attack";
	let skilleffect = "(No Skill)";
	let langDistortEffect = "Distortion Effect";

	if(getTranslationByKey("message-from") != false){

	langFrom = getTranslationByKey("message-from");
	langTarget = getTranslationByKey("message-target");
	langRoll = getTranslationByKey("message-roll");
	langSkill = getTranslationByKey("message-skill");
	langEffectBase = getTranslationByKey("message-effectbase");
	langEffectSkill = getTranslationByKey("message-effectskill");
	langAdv = getTranslationByKey("message-adv");
	langDisadv = getTranslationByKey("message-disadv");

	skilleffect = getTranslationByKey("message-noskill");
	langDistortEffect = getTranslationByKey("distort-effectText");
	langMass = getTranslationByKey("skill-type-Mass");

	if(basetype == "Attack" && buttonid != "egoWeapon"){
	weapontype = getTranslationByKey("weapon-type-" + weapontype) || "";
	weaponrange = getTranslationByKey("weapon-type-" + weaponrange) || "";
	}

	}

	/* Tool */
	let toolDescription = "";
	let toolEffectDescription = "";
	let toolinfo = "";
	let toolname = "";
	let tooldesc = "";
	let tooleffect = "";

	let langUse = "Use Tool";
	let langEffectTool = "Tool Effects";

	if (toolselect != "" && toolselect != null && toolselect != "0") {
		toolname = values[`${toolselect}Name`];
		tooldesc = values[`${toolselect}Description`];
		tooleffect = values[`${toolselect}Effect`];
		let tooluses = values[`${toolselect}Uses`];
		let toolusesmax = values[`${toolselect}Uses_max`];
		let toolreuse = values[`${toolselect}Reusable`];
		let toolnewuses = tooluses;

		if (getTranslationByKey("palette-action-tool") != false) {
			langUse = getTranslationByKey("palette-action-tool");
			langEffectTool = getTranslationByKey("tool-effect").replace(".","");
		}

		if(toolreuse == "Reusable"){
			toolnewuses = parseInt(tooluses) - 1;
			if(parseInt(newuses) < 0){ 
				toolnewuses = "0";
			}
			output[`${toolselect}Uses`] = toolnewuses;
		}
		else {
			output[`${toolselect}Uses`] = "0";
		}
	}

	/* Skill */
	let skillname = values.selectName;
	let skilltype = values.selectType;
	let skillcost = values.selectLight;
	let skilldice1 = "0";
	let skilldice2 = "0";
	let skilldice3 = "0";
	let skillmass = "";
	let skillinfo = "";

	if(currentlight >= skillcost && rawcheck != "raw"){

		if(skilltype == "Mass" && basetype == "Attack"){
		skilltype = "Attack";
		skillmass = " | " + langMass;


			if(buttonid == "egoWeapon" || rawcheck == "distort") {
			newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoWide.png";	
			}
			else {
			newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Wide.png";
			}

		}

		if(basetype == skilltype){

		skilldice1 = values.selectDice1;
		skilldice2 = values.selectDice2;
		skilldice3 = values.selectDice3;

		newlight = currentlight - skillcost;

		lightmessage = " <span style='color: #fee2b0'>(" + langSkill + ")</span>";
		skillinfo= "<br><b>" + langSkill + ": </b>" + skillname;

		skilleffect = values.selectEffect;

		}
	}

	/* Bleed processing */
	let autoScriptOverrideList = {};
	updateBleed("standard", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);

	/* Custom Ailments processing */
	updateCustomAilments(["OnAction"], "standard", "false", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);

	/* AutoScripts */
	let AutoScript = "";
	let triggerType = "None";

	/* Get AutoScript from taken action */
	switch (buttonid) {
		case "def": case "evd": AutoScript = values.outfitAutoScript; break;
		case "egoWeapon": case "egoDef": case "egoEvd": AutoScript = values.egoAutoScript; break;
		default: AutoScript = values[`${buttonid}AutoScript`]; break;
	}

	/* Get trigger type if any. Set Action buttons target mode to selected if defensive */
	switch (basetype) {
		case "Attack": triggerType = "Offensive"; break;
		case "Defend": triggerType = "Block"; autoScriptOverrideList.targetmode = "false"; break;
		case "Evade": triggerType = "Evade"; autoScriptOverrideList.targetmode = "false"; break;
	}

	/* Get tool AutoAcript if any */
	if (toolselect != "0") {
		AutoScript += "(Reset)" + values[`${toolselect}AutoScript`];
	}

	/* Get skill AutoAcript if any */
	if ((skillselect != undefined || skillselect != "0") && basetype == skilltype) {
		AutoScript += "(Reset)" + values[`${skillselect}AutoScript`];
	}

	/* Clean AutoScript. Remove nested and undefined */
	AutoScript = AutoScript.replace(/\[([#][^]+[#])\]/g, "");
	AutoScript = AutoScript.replace("undefined", "");
	
	resetConditionals();
	AutoScriptMain(AutoScript, triggerType, "true", "false", autoScriptOverrideList, function(returnValues) {
	
	/* Action buttons */
	let buttonList = [];
	let giveButtonList = [];
	let damageAutoScript = "";
	for (const [buttonKey, buttonValue] of Object.entries(returnValues)) {
		if (buttonKey.startsWith("auto")) {
			switch (buttonKey.split(" ")[0]) {
				case "autoDamage":
					if (basetype != "Attack") {
						buttonList.push(generateActionButton(buttonKey, getIcon("icons","damage"), "red", "actionButtonDamage", {AutoScript: buttonValue, targetTokenId: targettokenid}))
					} else {
						damageAutoScript = buttonValue;
					}; break;
				case "autoInflict": buttonList.push(generateActionButton(buttonKey, getIcon("icons","lose"), "purple", "actionButtonInflict", {AutoScript: buttonValue, targetTokenId: targettokenid})); break;
				case "autoGive": giveButtonList.push(generateActionButton(buttonKey, getIcon("icons","win"), "blue", "actionButtonGive", buttonValue, "selected")); break;
			}
		}
	}

	let autoeffectdice1 = 0;
	let autoeffectdice2 = 0;
	let autoeffectdice3 = 0;
	if (returnValues.diceCount != undefined) { autoeffectdice1 = returnValues.diceCount; }
	if (returnValues.diceMax != undefined) { autoeffectdice2 = returnValues.diceMax; }
	if (returnValues.dicePower != undefined) { autoeffectdice3 = returnValues.dicePower; }

	let autoeffectBaseDamage = 0;
	let autoeffectBaseDamageHP = 0;
	let autoeffectBaseDamageST = 0;
	let autoeffectFlatDamageHP = 0;
	let autoeffectFlatDamageST = 0;
	let autoeffectFlatDamageSP = 0;
	let autoeffectFlatDamageLight = 0;
	if (returnValues.baseDamage != undefined) { autoeffectBaseDamage = returnValues.baseDamage; }
	if (returnValues.baseDamageHP != undefined) { autoeffectBaseDamageHP = returnValues.baseDamageHP; }
	if (returnValues.baseDamageST != undefined) { autoeffectBaseDamageST = returnValues.baseDamageST; }
	if (returnValues.flatDamageHP != undefined) { autoeffectFlatDamageHP = returnValues.flatDamageHP; }
	if (returnValues.flatDamageST != undefined) { autoeffectFlatDamageST = returnValues.flatDamageST; }
	if (returnValues.flatDamageSP != undefined) { autoeffectFlatDamageSP = returnValues.flatDamageSP; }
	if (returnValues.flatDamageLight != undefined) { autoeffectFlatDamageLight = returnValues.flatDamageLight; }

	let autoEffectLight = 0;
	if (returnValues.Light != undefined) {autoEffectLight = parseInt(returnValues.Light); }

	let autoScriptMessage = "";
	if (returnValues.message != undefined) { autoScriptMessage = returnValues.message }
	
	/* Power */
	let activepower = "0";
	if(basetype == "Attack"){
		activepower = parseInt(values.attPower) + parseInt(values.Strength) - parseInt(values.Feeble);
		attackmessage = weapontype + " | " + weaponrange + weaponuse + skillmass + "<br>";
	}
	else if(basetype == "Defend"){
		activepower = parseInt(values.defPower) + parseInt(values.Endurance) - parseInt(values.Disarm);
	}
	else if(basetype == "Evade"){
		activepower = parseInt(values.evdPower) + parseInt(values.evdPositive) - parseInt(values.evdNegative);
	}

	/* Distortion modifiers */
	let distortdice1 = "0";
	let distortdice2 = "0";
	let distortdice3 = "0";
	let distorteffect = "";

	if(rawcheck == "distort" && basetype == "Attack"){
	distortdice1 = values.distortWeaponDice1;
	distortdice2 = values.distortWeaponDice2;
	distortdice3 = values.distortWeaponDice3;
	distorteffect = values.distortEffect;
	}
	else if(rawcheck == "distort" && basetype == "Defend"){
	distortdice1 = values.distortDefDice1;
	distortdice2 = values.distortDefDice2;
	distortdice3 = values.distortDefDice3;
	distorteffect = values.distortEffect2;

	}
	else if(rawcheck == "distort" && basetype == "Evade"){
	distortdice1 = values.distortEvdDice1;
	distortdice2 = values.distortEvdDice2;
	distortdice3 = values.distortEvdDice3;
	distorteffect = values.distortEffect2;

	}

	/* Dice formatting */
	combinedice1 = Math.max(parseInt(basedice1) + parseInt(distortdice1) + parseInt(skilldice1) + parseInt(autoeffectdice1), 0);
	combinedice2 = Math.max(parseInt(basedice2) + parseInt(distortdice2) + parseInt(skilldice2) + parseInt(autoeffectdice2), 0);
	combinedice3 = parseInt(basedice3) + parseInt(distortdice3) + parseInt(skilldice3) + parseInt(activepower) + parseInt(autoeffectdice3);

	if(values.settingMultihitUses == "true" && limitbehavior != "Limitless" && limitbehavior != null){
		if(combinedice1 > currentuses){
		combinedice1 = newuses;
		newuses = "0";
		}
		else if(combinedice1 <= currentuses){
		newuses = newuses - combinedice1;
		if(newuses < 0){ newuses = "0";}
		}

	}
	else if(values.settingMultihitUses != "true" && limitbehavior != "Limitless" && limitbehavior != null) {
		newuses = newuses - 1;
		if(newuses < 0){ newuses = "0";}
	}

	/* Multi-hit roll prep */
	let multihitdebuff = "";

	if(combinedice1 > 1 && multihitfull != "true"){

		if(multistyle == "Flat"){
		multihitdebuff = multipenalty;	
		}
		else {
		multihitdebuff = parseInt((multipenalty)*(combinedice1 - 1));
		}

	}


	let rollformat = "";
	let baseformat = "1d" + combinedice2 + "+" + combinedice3 + "+(" + parseInt(difficulty) + ")" + multihitdebuff;

	/* Raw base dice override */
	if(rawcheck == "raw"){
	combinedice1 = basedice1;
	conbinedice2 = basedice2;
	combinedice3 = basedice3;

	}


	/* Advantage processing */
	let advmod = "";
	let advquantity = "";
	let advformat = "{(" + baseformat + "), (" + baseformat + ")}";
	let acounter = "0";
	let dcounter = combinedice1;
	let rollformatmessage = combinedice1 + "d" + combinedice2 + "+" + combinedice3 + "+(" + parseInt(difficulty) + ")" + multihitdebuff + lightmessage;

	if(advstate == "Advantage"){
	advmod = "kh1";
	acounter = advcounter;

	rollformatmessage = rollformatmessage + " <span style='color: #85a874;'>(" + langAdv;
	}

	else if(advstate == "Disadvantage"){
	advmod = "dh1";
	acounter = disadvcounter;

	rollformatmessage = rollformatmessage + " <span style='color: #cc4125;'>(" + langDisadv;
	}
	else{
	advstate == " ";
	}


	
	
	if(advstate != "0" && acounter == "0"){
	acounter = dcounter;
	rollformatmessage += ") </span>";
	}
	else if(acounter > dcounter && advstate != "0"){
	acounter = dcounter;
	rollformatmessage += " x" + acounter + ")</span>";
	}
	else if(acounter <= dcounter && advstate != "0"){
	rollformatmessage += " x" + acounter + ")</span>";
	}

	/* Multi-hit formatting */
	let diceNumber = 0;
	if(combinedice1 > 1){

		if(acounter != "0"){
		for(let i = 0; i< acounter ;i++){
				rollformat += ` {{roll${diceNumber+1}=[[${advformat}${advmod}]]}}`;
		dcounter = dcounter - 1;
				diceNumber++
			}
		}

		if(dcounter > 0){
		for(let i = 0; i< dcounter ;i++){
				rollformat += ` {{roll${diceNumber+1}=[[${baseformat}]]}}`;
				diceNumber++
		}
		}

	}
	else {
		if(advstate != "0"){
		rollformat = `{{roll1=[[${advformat}${advmod}]]}}`;
		}
		else {

		rollformat = `{{roll1=[[${baseformat}]]}}`;
		}

	}

	let distortformat = "";
	if(rawcheck == "distort"){
	distortformat = "<br><div style='width: 100%; background-color: #111; height: 80px; float: left; text-align: center; color:" + headertext + "'><b>" + langDistortEffect + "</b><br><div style='overflow: auto; border-top: 1px #555 solid; height: 70px;'>" + distorteffect + "</div></div>";
	}

	let baseEffectDescription = "<br><div class='descriptionContainer'><b>" + langEffectBase + ":</b><br><div class='effectDescription'>" + baseeffect + "</div></div>";
	let skillEffectDescription = "<div class='descriptionContainer'><b>" + langEffectSkill + ":</b><br><div class='effectDescription'>" + skilleffect + "</div></div>"
	if (baseeffect == "") { baseEffectDescription = ""; }
	if (skilleffect == "(No Skill)" || skilleffect == "") { skillEffectDescription = ""; }

	if(toolselect != "" && toolselect != null && toolselect != "0") {
		toolDescription = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px;'><div style='text-align: left; padding: 5px;'>" + tooldesc + "</div></div>";
		toolEffectDescription = "<br><b>" + langEffectTool + ":</b><div class='toolEffect' style='max-height: 60px; width: 96.5%; border: 1px #555 solid; overflow: auto; float: left; padding: 3px;'>" + tooleffect + "</div>";
		if (tooleffect == "") { toolEffectDescription = ""; toolDescription = toolDescription.replaceAll(" padding-bottom: 3px;","").replaceAll(" padding: 5px;"," padding-top: 5px;"); }

		toolinfo = "<br><b>" + langUse + "</b>: " +  toolname + "<br>";
		
		skillEffectDescription += toolEffectDescription;
		skillinfo += toolinfo;
	}

	if (hidebaseffect == "true") { baseEffectDescription = ""; skillEffectDescription = ""; }

	let header = "<div style='background-color: #222; overflow: hidden; height: 30px; border: 2px #000 solid; color: " + headertext + "'><div style='float: left'><img src='" + newicon + "' style='width: 30px; height: 30px; border-right: 2px #000 solid; margin-right: 5px; background-color:" + headercolor + "'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + basename + "</b></div></div>";

	let body = "<b>" + langFrom + ": </b>"+ charname + "<br>"
	if (basetype == "Attack" && targetname != "") { body += "<b>" + langTarget + ": </b>"+ targetname + "<br>"; }
	body += "<b>" + langRoll + ": </b>" + rollformatmessage + skillinfo + "<div style='text-align: center'>" + attackmessage + "</div>" + baseEffectDescription + skillEffectDescription + distortformat;

	let info = header + body + autoScriptMessage;

	if(simpledisplay == "true"){
	info = header;

	}

	setAttrs({"baseActNum":actcounter, "dummy":info, "Light":newlight + autoEffectLight, "advState":advstate}, () => {
	setAttrs(output);

	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/*--- send roll end --*/
	startRoll((whisper + `&{template:baseRoll} ${rollformat} {{advantage=@{advState}}} {{infodump=@{dummy}}}`), (results) => {

		let total = 0;
		let rollList = {}
		for (let i = 1; i <= 5; i++) {
			let rollKey = "roll" + i;
			if (results.results.hasOwnProperty(rollKey)) {
				rollList[rollKey] = Math.max(parseInt(results.results[rollKey].result), 0);
			}
		}

		finishRoll(results.rollId, {} );

		/* Store defensive reaction rolls */
		if (basetype == "Defend" && hidecombatoptions != "true") {
			setAttrs({lastDefenceRoll: Math.max(parseInt(rollList["roll1"]),0)})
		} else {
			setAttrs({lastDefenceRoll: 0})
		}

		/* Handle Apply Damage action button for attacks */
		if (basetype == "Attack") {
			/* Remove any (Add N HP/ST/SP) from damageAutoScript, leaving only (Add N Light) and any non-Add effects */
			/* This functionality is already handeled by the flatBarOverrides */
			damageAutoScript = damageAutoScript.replaceAll(/(\(Add -?\d+ \w{2}\))/g, "");
		
			let damage_data = {
				baseHPOverride: autoeffectBaseDamageHP,
				baseSTOverride: autoeffectBaseDamageST,
				flatHPOverride: autoeffectFlatDamageHP,
				flatSTOverride: autoeffectFlatDamageST,
				flatSPOverride: autoeffectFlatDamageSP,
				flatLightOverride: autoeffectFlatDamageLight,
				damageTypeOverride: weapontype,
				autoScriptOverride: damageAutoScript
			}

			for (const rollKey in rollList) {
				damage_data.baseOverride = Math.max(parseInt(rollList[rollKey]) + parseInt(autoeffectBaseDamage),0);

				let rollNumber = ` (#${rollKey.replace("roll","")})`;
				if (Object.keys(rollList).length == 1) {
					rollNumber = "";
				}
				buttonList.push(generateActionButton("autoDamage"+rollNumber, getIcon("icons","damage"), "red", "actionButtonDamage", {...damage_data, targetTokenId: targettokenid}));
			}
		}
		createActionButtons(buttonList);
		createActionButtons(giveButtonList, "selected");
    });
	/*--- send roll end ---*/

	/* Cleanup */
	updateAdvantages(combinedice1);

	setAttrs({"dummy":" ", "skillSelect":"0", [`${uses}`]:newuses});

	});
	});
    });
	});
	});
	});
  });
});

/* Action: Challenge Roll */
on('clicked:rollChallenge', (info) => {
	/* Get IDs/names */
	let buttonid = info.htmlAttributes.id.split('_')[1];
	rollChallenge(buttonid);
});
function rollChallenge(buttonid, rollDifficulty=0, collectAutoScripts="false") {
	
	/* Preparing values */
	let headercolor = "#888";
	let newicon = "/";
	let headertext = "#fff";
	let challenge = "{{challenge= }}";

	let basetype = "";

	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Portable.png";

	/* Get attributes */
        getAttrs([`${buttonid}`, "advState", "difficulty", "justice", "settingSimpleDisplay", "settingWhisperRolls", "settingWhisperTarget", "character_name", "advNum", "disadvNum"], function(values) {

	let charname = values.character_name;
	let stat = values[buttonid];
	let statn = "";
	let advstate = values.advState;
	let simpledisplay = values.settingSimpleDisplay;
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let tracker = "";

	let difficulty = parseInt(values.difficulty) + parseInt(rollDifficulty);
	let spdjustice = values.justice;
	let newicon = "/";
	let lucknum = "0";

	/* AutoScripts */
	let autoScriptTriggers = ["None"];
	if (buttonid == "speed") { autoScriptTriggers.push("Combat start"); collectAutoScripts = "true"; }
	else if (buttonid != "luck") { autoScriptTriggers.push("Challenge"); }

	if (collectAutoScripts == "true") { resetConditionals(); }
	AutoScriptMain("", autoScriptTriggers, collectAutoScripts, "false", { targetmode: "false" }, function(returnValues) {

	let autoEffectDiceCount = 0;
	let autoEffectDiceMax = 0;
	let autoEffectSpeedCombat = 0;
	if (returnValues.dicePower != undefined) { stat += returnValues.parseInt(dicePower); }
	if (returnValues.diceCount != undefined) { autoEffectDiceCount = parseInt(returnValues.diceCount); }
	if (returnValues.diceMax != undefined) { autoEffectDiceMax = parseInt(returnValues.diceMax); }
	if (returnValues.speedCombat != undefined) { autoEffectSpeedCombat = parseInt(returnValues.speedCombat); }

	let autoScriptMessage = "";
	if (returnValues.message != undefined) { autoScriptMessage = returnValues.message }
	
	let rollformat = Math.max(autoEffectDiceCount + 2, 0) + "d" + Math.max(autoEffectDiceMax + 6, 0) + "+" + parseInt(stat) + "+(" + parseInt(difficulty) + ")";

	/* Type Formatting */
	if(buttonid == "instinct"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Instinct.png";
	statn = "Instinct";
	}
	else if(buttonid == "wisdom"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Wisdom.png";
	statn = "Wisdom";
	}
	else if(buttonid == "justice"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Justice.png";
	statn = "Justice";

	}
	else if(buttonid == "charm"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Charm.png";
	statn = "Charm";
	}
	else if(buttonid == "insight"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Insight.png";
	statn = "Insight";
	}
	else if(buttonid == "temperance"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/stats/Temperance.png";
	statn = "Temperance";
	}
	else if(buttonid == "luck"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/fortunewhite.png";
	statn = "Luck";
	headercolor = "#dbb748";
	rollformat = "2d6+" + "(" + parseInt(difficulty) + ")";
	challenge = " ";
	}
	else if(buttonid == "speed"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Speed.png";
	statn = "Speed";
	headercolor = "#cf8c44";
	tracker = "&{tracker}"
	rollformat = "1d6+" + (parseInt(spdjustice) + parseInt(autoEffectSpeedCombat)) + "+(" + parseInt(difficulty) + ")";
	challenge = " ";

	}

	/* Translation prep */
	let langFrom = "From";
	let langRoll = "Roll";

	let langAdv = "Adv.";
	let langDisadv = "Disadv.";
	let langStat = statn;

	if(getTranslationByKey("message-from") != false){

	langFrom = getTranslationByKey("message-from");
	langRoll = getTranslationByKey("message-roll");

	langAdv = getTranslationByKey("message-adv");
	langDisadv = getTranslationByKey("message-disadv");


	langStat = getTranslationByKey("stats-" + buttonid);

	}


/* Advantage processing */
	let advmod = "";
	let rollformatmessage = rollformat;
	rollformat += tracker;

	if(advstate == "Advantage"){
	advmod = "kh1";
	rollformat = "{(" + rollformat + "), (" + rollformat + ")}" + advmod;
	rollformatmessage = rollformatmessage + " <span style='color: #85a874;'>(" + langAdv + ")</span>";
	}

	else if(advstate == "Disadvantage"){
	advmod = "dh1";
	rollformat = "{(" + rollformat + "), (" + rollformat + ")}" + advmod;
	rollformatmessage = rollformatmessage + " <span style='color: #cc4125;'>(" + langDisadv + ")</span>";
	}
	else{
	advstate == " ";
	}

	let header = "<div style='background-color: #222; overflow: hidden; height: 30px; border: 2px #000 solid; color: #fff'><div style='float: left'><img src='" + newicon + "' style='width: 30px; height: 30px; border-right: 2px #000 solid; margin-right: 5px; background-color:" + headercolor + "'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + langStat + "</b></div></div>";

	let body = "<b>" + langFrom + ": </b>" + charname + "<br><b>" + langRoll + ": </b>" + rollformatmessage;

	let info = header + body + autoScriptMessage;

	if(simpledisplay == "true"){
	info = header;

	}

	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}


	setAttrs({"dummy":info, "dummy2":rollformat, "advState":advstate});

	/*--- send roll end --*/
	startRoll((whisper + "&{template:baseRoll} {{roll1=[[ @{dummy2} ]]}} {{infodump=@{dummy}}}" + challenge), (results) => {
	    const total = results.results.roll1.result;

	if(statn == "Luck"){
	setAttrs({"baseLuckNum": total });
	}
	else if(statn == "Speed"){
	setAttrs({"baseSpeed": total, "isFirstRound": "true", "prevRoundInitAttempts": 0});
	}

		finishRoll(results.rollId,{});
		
	});
	/*--- send roll end ---*/

	/* Cleanup */
	updateAdvantages("1");

	setAttrs({"dummy":" ", "skillSelect":"0"});


	});
	});
}


/* Action: Damage helper apply damage */
on('clicked:applyDamage', (info) => {
	getAttrs(["lastDefenceRoll"], function(values) {
		let defenceRoll = parseInt(values.lastDefenceRoll);
		damageHelper({}, defenceRoll);

		setAttrs({lastDefenceRoll: 0});
	});
});

function damageHelper(overrideList={}, defenceRoll=0) {

	let tokenId = "";
	if (overrideList.tokenId != undefined) {tokenId = overrideList.tokenId; }
	changeActiveToken(tokenId, () => {

	/* Get attribute values */
	getAttrs(["character_name", "HP", "StagRes", "SP", "HP_max", "StagRes_max", "SP_max",
	"settingLimbusStyle", "settingWhisperRolls", "settingWhisperTarget", "settingSimpleDisplay", "settingAutoApplyDamage", "settingHideBarUpdate",
	"baseDamage", "flatDamageHP", "flatDamageST", "damageHelperType",
	"distortState", "egoActiveState", "egoType", "StaggerState", "damageResist", "damageResist_ego",
	"THP_Sources", "TST_Sources"], function(values) {

	const output = {};

	let settingLimbusStyle = values.settingLimbusStyle;
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let simpledisplay = values.settingSimpleDisplay;
	let autoapplydamage = values.settingAutoApplyDamage;
	let hidebarupdate = values.settingHideBarUpdate;
	
	let characterName = values.character_name;

	let maxHP = parseInt(values.HP_max);
	let maxST = parseInt(values.StagRes_max);
	let maxSP = parseInt(values.SP_max);
	let oldHP = parseInt(values.HP);
	let oldST = parseInt(values.StagRes);
	let oldSP = parseInt(values.SP);
	let newHP = parseInt(oldHP);
	let newST = parseInt(oldST);
	let newSP = parseInt(oldSP);

	let baseDamage = parseInt(values.baseDamage);
	let baseDamageHP = 0;
	let baseDamageST = 0;
	let flatDamageHP = parseInt(values.flatDamageHP);
	let flatDamageST = parseInt(values.flatDamageST);
	let flatDamageSP = 0;
	let damageType = values.damageHelperType;

	if (overrideList.baseOverride != undefined) { baseDamage = overrideList.baseOverride; }
	if (overrideList.baseHPOverride != undefined) { baseDamageHP = overrideList.baseHPOverride; }
	if (overrideList.baseSTOverride != undefined) { baseDamageST = overrideList.baseSTOverride; }
	if (overrideList.flatHPOverride != undefined) { flatDamageHP = overrideList.flatHPOverride; }
	if (overrideList.flatSTOverride != undefined) { flatDamageST = overrideList.flatSTOverride; }
	if (overrideList.flatSPOverride != undefined) { flatDamageSP = overrideList.flatSPOverride; }
	if (overrideList.damageTypeOverride != undefined) { damageType = overrideList.damageTypeOverride; }

	let hpResistance = 1.0;
	let stResistance = 1.0;
	let damageResistance = 1;

	let distortState = values.distortState;
	let egoType = values.egoType;
	let egoActiveState = values.egoActiveState;
	let staggerState = values.StaggerState;
	let outfitType = "";

	let autoScript = "";
	if (overrideList.autoScriptOverride != undefined) { autoScript = overrideList.autoScriptOverride; }

	
	let THP_Sources = {};
	if (values.THP_Sources != "" && values.THP_Sources != "{}") {
		THP_Sources = JSON.parse(values.THP_Sources);
	}
	let TST_Sources = {};
	if (values.TST_Sources != "" && values.TST_Sources != "{}") {
		TST_Sources = JSON.parse(values.TST_Sources);
	}

	let ailCalculationList = {}; 


	/* Checks active character outfit type: ego or standard outfit */
	/* Applies damage resistance effect based on the type */
	if (egoActiveState == "true" && egoType == "Outfit") {
		outfitType = "ego";
		damageResistance = parseInt(values.damageResist_ego);
	} else {
		outfitType = "outfit";
		if (distortState != "true") { damageResistance = parseInt(values.damageResist);
		} else if ((distortState == "true")) { damageResistance = parseInt(values.damageResist_ego); }
		
	}

	/* Get resistance values based on outfit type. On stagger, resistances are fatal (2x) */
	getAttrs([`${outfitType}Immune1`, `${outfitType}Immune2`, `${outfitType}Immune3`, `${outfitType}Immune4`, `${outfitType}Immune5`, `${outfitType}Immune6`],
	function(values) {
	
	if (staggerState == "Staggered") {
		hpResistance = 2.0; stResistance = 2.0;
	} else {
		switch (damageType) {
			case "Slash": hpResistance = parseFloat(values[`${outfitType}Immune1`]); stResistance = parseFloat(values[`${outfitType}Immune2`]); break;
			case "Pierce": hpResistance = parseFloat(values[`${outfitType}Immune3`]); stResistance = parseFloat(values[`${outfitType}Immune4`]); break;
			case "Blunt": hpResistance = parseFloat(values[`${outfitType}Immune5`]); stResistance = parseFloat(values[`${outfitType}Immune6`]); break;
			default: break;
		}
	}

	/* If one or both resistances are unset, give an error message and return */
	if (isNaN(hpResistance) || isNaN(stResistance)) {
		let alertIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/limbus/Aggro.png' style='width: 25px; height: 25px;' >"
		let alertMessage = "";
		let langAlertMessage = "Outfit resistances not set for";
		let langDamage = "damage";

		langDamage = getTranslationByKey("message-damage")
		if (outfitType == "ego") {
			langAlertMessage = getTranslationByKey("message-mystery-missing-resistance");
			alertMessage = `${langAlertMessage} ${damageType} ${langDamage}`;
		} else {
			langAlertMessage = getTranslationByKey("message-outfit-missing-resistance");
			alertMessage = `${langAlertMessage} ${damageType} ${langDamage}`;
		}
		setAttrs({"dummy":alertMessage, "dummyIcon":alertIcon});
		startRoll(("/w " + characterName + "&{template:errorMessage} {{icon=@{dummyIcon}}} {{message=@{dummy} }}"), (results) => {
            finishRoll(results.rollId, {} );
    	});
		return;
	}


	/* Damage calculations block beginning */

	/* Sum of all modifiers that apply before resistances */
	let sumBothBefore = -baseDamage;
	let sumHpBefore = -baseDamageHP;
	let sumStBefore = -baseDamageST;

	/* Sum of all modifiers that apply after resistances*/
	let sumBothAfter = 0;
	let sumHpAfter = -flatDamageHP;
	let sumStAfter = -flatDamageST;

	/* Percentage modifier to modifiers before resistance. Currently only used by the Smoke "%" mode */
	let percentageModHP = 1.0;

	/* Sum of all modifiers that do not take resistance into consideration */
	let sumSanity = -flatDamageSP;

	/* Retrieve global settings for Smoke settings */
	getSectionIDs(`repeating_global`, idarray => {
    let id = `repeating_global_${idarray[0]}`;

	/* Get damage modifiers from status ailments */
	getAttrs(["Fragile", "Protection", "StaggerProtection", "Smoke", `${id}_smokeCalculationMode`, `${id}_smokeCalculationVal`], function(values) {
	
	let hpFragile = parseInt(values.Fragile);
	let hpProtection = parseInt(values.Protection);
	let stProtection = parseInt(values.StaggerProtection);
	let smoke = parseInt(values.Smoke);
	let smokeCalcMode = values[`${id}_smokeCalculationMode`];
	let smokeCalcVal = values[`${id}_smokeCalculationVal`];

	/* Fragile applies a flat amount of damage */
	sumHpAfter -= hpFragile;

	/* Get damage modifiers from When Hit custom status ailments */
	getSectionIDs(`repeating_ailments`, idarray => {
		const fieldnames = idarray.reduce((rows,id) => 
		[...rows, `repeating_ailments_${id}_ailTrigger`, `repeating_ailments_${id}_ailDamageTypeTrigger`, `repeating_ailments_${id}_ailBeforeResistance`, `repeating_ailments_${id}_ailPositiveType`, `repeating_ailments_${id}_ailDecayWhenHit`,
		`repeating_ailments_${id}_ailEffect`, `repeating_ailments_${id}_ailEffectMode`, `repeating_ailments_${id}_ailEffectVal`, `repeating_ailments_${id}_ailCustomResistanceNum`, `repeating_ailments_${id}_ailCustomResistanceNumEgo`,,
		`repeating_ailments_${id}_ailNum`, `repeating_ailments_${id}_ailName`, `repeating_ailments_${id}_ailIcon`], '');
		
		let ailTrigger = "";
		let ailDamageTypeTrigger = "";
		let ailBeforeResistance = "";
		let ailDecayWhenHit = "";
		let ailEffect = "";
		let ailEffectMode = "";
		let ailEffectVal = 0;
		let ailType = "";
		let ailCustomResistanceNum = 0;
		let ailCustomResistanceNumEgo = 0;
		let ailName = "";
		let ailIcon = "";
		let count = 0;

		let hpStRegen = 0;
		let stRegen = -flatDamageST;
		let hpRegen = -flatDamageHP;
		let spRegen = -flatDamageSP;

		getAttrs([...fieldnames], v => {
			idarray.forEach(id => {
		
				ailTrigger = v[`repeating_ailments_${id}_ailTrigger`];
				ailDamageTypeTrigger = v[`repeating_ailments_${id}_ailDamageTypeTrigger`];
				ailBeforeResistance = v[`repeating_ailments_${id}_ailBeforeResistance`];
				ailDecayWhenHit = v[`repeating_ailments_${id}_ailDecayWhenHit`];
				ailEffect = v[`repeating_ailments_${id}_ailEffect`];
				ailEffectMode = v[`repeating_ailments_${id}_ailEffectMode`];
				ailEffectVal = v[`repeating_ailments_${id}_ailEffectVal`];
				ailCustomResistanceNum = parseInt(v[`repeating_ailments_${id}_ailCustomResistanceNum`]);
				ailCustomResistanceNumEgo = parseInt(v[`repeating_ailments_${id}_ailCustomResistanceNumEgo`]);
				
				ailName = v[`repeating_ailments_${id}_ailName`];
				ailIcon = v[`repeating_ailments_${id}_ailIcon`];
				count = v[`repeating_ailments_${id}_ailNum`];

				if ((/(-[0-9]*n)/).test(ailEffectVal)) {
					ailType = "Damage";
				} else {
					if (ailBeforeResistance == "beforeResistance") { ailType = "Reduction"; }
					else { ailType = v[`repeating_ailments_${id}_ailPositiveType`]; }
				}

				if (egoActiveState == "true" && egoType == "Outfit" && distortState != "true") {
					ailCustomResistanceNum = parseInt(ailCustomResistanceNumEgo);
				}
				else if (distortState == "true") {
					ailCustomResistanceNum += parseInt(ailCustomResistanceNumEgo);
				}
				
				let tempSumBoth = 0;
				let tempSumHp = 0;
				let tempSumSt = 0;
				
				if (ailTrigger == "WhenHit") {

					if ((ailDamageTypeTrigger == "Any" || ailDamageTypeTrigger == damageType) && (ailEffect != "None" && ailEffect != null && count != 0)) {

						/* Calculate base attribute change and its polarity */
						
						/* Ailment is n or -n multiplied by a number */
						if ((/([0-9]+n)/).test(ailEffectVal)) {
							ailEffectVal = ailEffectVal.replaceAll("n","");
							ailEffectVal = parseInt(count) * parseInt(ailEffectVal)
						}
						else if ((/(-[0-9]+n)/).test(ailEffectVal)) {
							ailEffectVal = (0 - parseInt(count)) * parseInt(ailEffectVal)
						}
						/* Ailment is n or -n */
						else if (ailEffectVal == "n") {
							ailEffectVal = parseInt(count);
						}
						else if (ailEffectVal == "-n") {
							ailEffectVal = (0 - parseInt(count)) + Math.min(count, ailCustomResistanceNum);
						}

						let apply_effect_mode = {
							"x": function (x, y, res) {
								if (y < 1) {
									return Math.floor(x * y) + Math.min(Math.floor(x-(x*y)), ailCustomResistanceNum);
								} else {
									return Math.floor(x * y);
								} 
							},
							"=": function (x, y, res) {
								if (y < x) {
									return x = y + Math.min((x-y), ailCustomResistanceNum);
								} else {
									return x = y;
								}
							}
						};

						
						/* Get effect mode. "x" and "=" apply directly to the relevant stat */
						if (ailEffectMode == "+") {
							switch (ailEffect) {
								case "HPStagRes": tempSumBoth += parseInt(ailEffectVal); break;
								case "HP": tempSumHp += parseInt(ailEffectVal); break;
								case "StagRes": tempSumSt += parseInt(ailEffectVal); break;
								case "SP": sumSanity += parseInt(ailEffectVal); break;
							}
						} else {
							switch (true) {
								case ailEffect == "HPStagRes": 
									newHP = apply_effect_mode[ailEffectMode](newHP, parseFloat(ailEffectVal), ailCustomResistanceNum); /* No break. Intentional fall through */
								case ailEffect == "StagRes":
									newST = apply_effect_mode[ailEffectMode](newST, parseFloat(ailEffectVal), ailCustomResistanceNum);
									ailEffectVal = newST - oldST; break;
								case ailEffect == "HP" : 
									newHP = apply_effect_mode[ailEffectMode](newHP, parseFloat(ailEffectVal), ailCustomResistanceNum);
									ailEffectVal = newHP - oldHP; break;
								case ailEffect == "SP":
									newSP = apply_effect_mode[ailEffectMode](newSP, parseFloat(ailEffectVal), ailCustomResistanceNum);
									ailEffectVal = newSP - oldSP; break;
							}
						}

						/* Select sum to apply modifier to based on damage being before or after resistance */
						if (ailBeforeResistance == "beforeResistance") {
							sumBothBefore += tempSumBoth; sumHpBefore += tempSumHp; sumStBefore += tempSumSt;
						} else {
							sumBothAfter += tempSumBoth; sumHpAfter += tempSumHp; sumStAfter += tempSumSt; 
						}

						/* Regen tracking  */
						if (ailType == "Regen") {
							switch (ailEffect) {
								case "HPStagRes": hpStRegen += tempSumBoth;
								case "StagRes": stRegen += tempSumSt;
								case "HP": hpRegen += tempSumHp;
								case "SP": spRegen += sumSanity;
							}
						}

						/* Temp sum cleanup */
						tempSumBoth = 0; tempSumHp = 0; tempSumSt = 0;

						/* Used to generate a damage calculation message later in this function */
						ailCalculationList[id] = {name: ailName, icon: ailIcon, effect: ailEffect, count: count, effectVal: ailEffectVal, type: ailType, beforeRes: ailBeforeResistance, customRes: ailCustomResistanceNum}
					}
				
					// Decay status ailment
					if (ailDecayWhenHit == "true") {
						updateCustomAilment(id, "decay", "false");
					}
				}
				
			});


	/* Calculate smoke damage */
	if (smoke != 0) {
		switch (smokeCalcMode) {
			case "/": sumHpAfter -= Math.floor(smoke / parseInt(smokeCalcVal)); break;
			case "%": percentageModHP += smoke * parseFloat(smokeCalcVal); break;
			case "=": sumHpAfter -= parseInt(smokeCalcVal); break;
		}
	}

	/* Final calculation */
	/*                          \---------------------------- Before Resistance -----------------------------/  \----------------------- After Resistance ----------------------- / */
	newHP += Math.ceil(Math.min((hpResistance * percentageModHP * (sumBothBefore + sumHpBefore + defenceRoll)) + hpProtection + damageResistance, 0)) + (sumBothAfter + sumHpAfter);
	newST += Math.ceil(Math.min((stResistance *                   (sumBothBefore + sumStBefore + defenceRoll)) + stProtection + damageResistance, 0)) + (sumBothAfter + sumStAfter);
	newSP += Math.ceil(sumSanity);

	/* Use temporary HP and ST */
	let HPDamage = oldHP - newHP;
	let STDamage = oldST - newST;
	let tempHPUsed = {}
	let tempSTUsed = {}
	
	if (newHP < oldHP) {
		if (Object.keys(THP_Sources).length > 0) {
			for (const sourceName in THP_Sources) {
				let returnTHP = applyTempBarDamage(sourceName, THP_Sources[sourceName], "THP", HPDamage, newHP);
				if (returnTHP != undefined) {
					if (returnTHP.tempBarVal == 0) {
						delete THP_Sources[sourceName];
					} else {
						THP_Sources[sourceName][0] = returnTHP.tempBarVal;
					}
					newHP = returnTHP.newBar;
					HPDamage = returnTHP.damage;
					tempHPUsed[returnTHP.messageName] = [returnTHP.tempBarVal, returnTHP.messageVal, returnTHP.messageIcon]
				}
			}
			setAttrs({"THP_Sources":JSON.stringify(THP_Sources)});
		}
	}
	if (newST < oldST) {
		if (Object.keys(TST_Sources).length > 0) {
			for (const sourceName in TST_Sources) {
				let returnTST = applyTempBarDamage(sourceName, TST_Sources[sourceName], "TST", STDamage, newST);
				if (returnTST != undefined) {
					if (returnTST.tempBarVal == 0) {
						delete TST_Sources[sourceName];
					} else {
						TST_Sources[sourceName][0] = returnTST.tempBarVal;
					}
					newST = returnTST.newBar;
					STDamage = returnTST.damage;
					tempSTUsed[returnTST.messageName] = [returnTST.tempBarVal, returnTST.messageVal, returnTST.messageIcon]
				}
			}
			setAttrs({"TST_Sources":JSON.stringify(TST_Sources)});
		}
	}

	/* Caps increase by regen amount */
	newHP = Math.min(newHP, oldHP + hpRegen + hpStRegen);
	newST = Math.min(newST, oldST + stRegen + hpStRegen);
	newSP = Math.min(newSP, oldSP + spRegen);

	/* Apply damage. Caps healing but not damage to the maximum value of the bar */
	if (newHP > maxHP && oldHP < newHP) { newHP = maxHP }
	if (newST > maxST && oldST < newST) { newST = maxST }
	if (newSP > maxSP && oldSP < newSP) { newSP = maxSP }
	output["HP"] = newHP; output["StagRes"] = newST; output["SP"] = newSP;
	if (autoapplydamage == "true") {
		setAttrs(output);
	}

	/* AutoScripts */
	let autoScriptTriggers = ["None"];
	if (newHP < oldHP) { autoScriptTriggers.push("DamagedHP"); }
	if (newST < oldST) { autoScriptTriggers.push("DamagedST"); }
	if (newSP < oldSP) { autoScriptTriggers.push("DamagedSP"); }
	
	resetConditionals();
	AutoScriptMain(autoScript, autoScriptTriggers, "true", "false", { targetmode: "false" }, function(returnValues) {

	let autoScriptMessage = "";
	if (returnValues.message != undefined) { autoScriptMessage = returnValues.message }

	
	/* console.log("HP base: " + sumBothBefore + ". HP after resistance: " + Math.ceil(Math.min((hpResistance * (sumBothBefore + sumHpBefore)) + hpProtection + damageResistance, 0)))
	console.log("ST base: " + sumBothBefore + ". ST after resistance: " + Math.ceil(Math.min((stResistance * (sumBothBefore + sumStBefore)) + stProtection + damageResistance, 0)))
	console.log("HP flat: " + sumHpAfter)
	console.log("ST flat: " + sumStAfter)
	console.log("HP: " + oldHP + " -> " + newHP);
	console.log("ST: " + oldST + " -> " + newST); */
	
	/* Damage calculations block end */

	/* Translation prep */
	let langBaseDamage = "Base damage";
	let langFlatDamageHP = "Flat HP DMG";
	let langFlatDamageST = "Flat ST DMG";
	let langFlatDamageSP = "Flat SP DMG";
	let langDamage = "damage";
	let langDealt = "dealt";
	let langIncreasedHPDamageBy = "increased HP damage by";
	let langSmoke = "Smoke";
	let langFragile = "Fragile";
	let langProtection = "Protection";
	let langStProtection = "Stagger Protection";
	let langDamageResistance = "Damage Resistance";
	let langDefence = "Block";

	if(getTranslationByKey("helper-text-basedamage") != false){
		langBaseDamage = getTranslationByKey("helper-text-basedamage");
		langFlatDamageHP= getTranslationByKey("helper-text-flatdamagehp");
		langFlatDamageST = getTranslationByKey("helper-text-flatdamagest");
		langFlatDamageSP = getTranslationByKey("helper-text-flatdamagesp");
		langDamage = getTranslationByKey("message-damage");
		langDealt = getTranslationByKey("message-dealt");
		langIncreasedHPDamageBy = getTranslationByKey("message-increased-HP-damage-by");
		langSmoke = getTranslationByKey("ailments-smoke");
		langFragile = getTranslationByKey("ailments-fragile");
		langProtection = getTranslationByKey("ailments-protection");
		langStProtection = getTranslationByKey("ailments-stgprotection");
		langDamageResistance = getTranslationByKey("oufit-damage-resistance");
		langDefence = getTranslationByKey("autoeffect-trigger-block");
	}

	/* Damage calculation chat message block begin */
	let damageCalculation = "";
	let hpDamageHead = ""; 	let hpDamageBody = "";
	let stDamageHead = ""; 	let stDamageBody = "";
	let spDamageHead = ""; 	let spDamageBody = "";
	let resHPIcon = "Res" + damageType;
	let resSTIcon = "Res" + damageType + "Stg";

	/* Calculation summaries (Message head) */
	hpDamageHead = generateDamageHelperHeader("HP", newHP, oldHP, "0", autoapplydamage, hidebarupdate);
	stDamageHead = generateDamageHelperHeader("ST", newST, oldST, staggerState, autoapplydamage, hidebarupdate);
	spDamageHead = generateDamageHelperHeader("SP", newSP, oldSP, "0", autoapplydamage, hidebarupdate);

	/* Simple display settings (Envelops entire body block)*/
	if (simpledisplay == "0") {

	/* Base damage and flat damage/regen */
	let sumBaseDamageHP = -(sumBothBefore + sumHpBefore);
	let sumBaseDamageST = -(sumBothBefore + sumStBefore);
	if (baseDamage != 0) { 
		hpDamageBody += `<div class="baseDamage"><b>${langBaseDamage}:</b> ${sumBaseDamageHP} x [${hpResistance}x]` + getIcon("def", resHPIcon) + "</div>";
		stDamageBody += `<div class="baseDamage"><b>${langBaseDamage}:</b> ${sumBaseDamageST} x [${stResistance}x]` + getIcon("def", resSTIcon) + "</div>";
	}
	if (flatDamageHP != 0) { hpDamageBody += `<div class="flatModifier">${langFlatDamageHP}: ${flatDamageHP}</div>`; }
	if (flatDamageST != 0) { stDamageBody += `<div class="flatModifier">${langFlatDamageST}: ${flatDamageST}</div>`; }
	if (flatDamageSP != 0) { spDamageBody += `<div class="flatModifier">${langFlatDamageSP}: ${flatDamageSP}</div>`; }

	/* Defence roll */
	if (defenceRoll != 0) {
		hpDamageBody += generateDamageHelperBodyEffect(langDefence, defenceRoll, "Defence", 0, getIcon("icons", "egoDef", "false"));
		stDamageBody += generateDamageHelperBodyEffect(langDefence, defenceRoll, "Defence", 0, getIcon("icons", "egoDef", "false"));
	}
	
	/* Fragile*/
	if (hpFragile != 0) { hpDamageBody += generateDamageHelperBodyEffect(langFragile, hpFragile, "Damage", 0, getIcon("ailments", "Fragile", settingLimbusStyle)); }

	/* Smoke */
	if ((smokeCalcMode != "/" && smoke != 0) || (smokeCalcMode == "/" && smoke >= smokeCalcVal)) {
		hpDamageBody += "<div>" + getIcon("ailments", "Smoke", settingLimbusStyle) + "<div>";
		switch (smokeCalcMode) {
			case "/": hpDamageBody += `<b>${langSmoke}</b> ${langDealt} ${Math.floor(smoke/parseInt(smokeCalcVal))} ${langDamage}</div></div>`; break;
			case "%": hpDamageBody += `<b>${langSmoke}</b> ${langIncreasedHPDamageBy} ${Math.floor(smoke * parseFloat(smokeCalcVal) * 100)}%</div></div>`; break;
			case "=": hpDamageBody += `<b>${langSmoke}</b> ${langDealt} ${smokeCalcVal} ${langDamage}</div></div>`; break;
		}
	}

	/* Custom status ailment damage/regen/resistance */
	for (var ailment in ailCalculationList) {
		let ailmentArray = ailCalculationList[ailment];
		
		if (ailmentArray["count"] != 0) {
			if (ailmentArray["effect"] == "HP" || ailmentArray["effect"] == "HPStagRes") { 
				hpDamageBody += generateDamageHelperBodyEffect(ailmentArray["name"], ailmentArray["effectVal"], ailmentArray["type"], ailmentArray["customRes"], getIcon("ailments", ailmentArray["icon"]), ailmentArray["beforeRes"], hpResistance, resHPIcon);
			}
			if (ailmentArray["effect"] == "StagRes" || ailmentArray["effect"] == "HPStagRes") {
				stDamageBody += generateDamageHelperBodyEffect(ailmentArray["name"], ailmentArray["effectVal"], ailmentArray["type"], ailmentArray["customRes"], getIcon("ailments", ailmentArray["icon"]), ailmentArray["beforeRes"], stResistance, resSTIcon);
			}
			if (ailmentArray["effect"] == "SP") {
				spDamageBody += generateDamageHelperBodyEffect(ailmentArray["name"], ailmentArray["effectVal"], ailmentArray["type"], ailmentArray["customRes"], getIcon("ailments", ailmentArray["icon"]));
			}
		}
	}

	/* Flat damage resistance status ailments and outfit damage resistance effect */
	if (hpProtection != 0) { hpDamageBody += generateDamageHelperBodyEffect(langProtection, hpProtection, "Reduction", 0, getIcon("ailments", "Protection", settingLimbusStyle)); }
	if (stProtection != 0) { stDamageBody += generateDamageHelperBodyEffect(langStProtection, stProtection, "Reduction", 0, getIcon("ailments", "StaggerProtection", settingLimbusStyle)); }
	
	if ((damageResistance != 0) && (Math.abs(sumBothBefore + sumHpBefore)) > 0) { hpDamageBody += generateDamageHelperBodyEffect(langDamageResistance, damageResistance, "Reduction", 0, getIcon("ailments", "DamageResist", settingLimbusStyle)); }
	if ((damageResistance != 0) && (Math.abs(sumBothBefore + sumStBefore)) > 0) { stDamageBody += generateDamageHelperBodyEffect(langDamageResistance, damageResistance, "Reduction", 0, getIcon("ailments", "DamageResist", settingLimbusStyle)); }

	/* Temporary HP and ST */
	if (Object.keys(tempHPUsed).length > 0) {
		for (const [sourceName, sourceVals] of Object.entries(tempHPUsed)) {
			let effectName = sourceName;
			if (sourceName == "AutoEffects THP") {
				effectName = getTranslationByKeyCustom(`AutoEffects`, "autoeffect-title") + " " + getTranslationByKeyCustom("Temp HP", "bar-health-temp-shorter");
			}
			let countUpdate = `[${parseInt(sourceVals[0] + sourceVals[1])} -> ${sourceVals[0]}]`;
			hpDamageBody += generateDamageHelperBodyEffect(effectName, `${sourceVals[1]} ${countUpdate}`, "TempReduction", 0, sourceVals[2]);
		}
	}
	if (Object.keys(tempSTUsed).length > 0) {
		for (const [sourceName, sourceVals] of Object.entries(tempSTUsed)) {
			let effectName = sourceName;
			if (sourceName == "AutoEffects TST") {
				effectName = getTranslationByKeyCustom(`AutoEffects`, "autoeffect-title") + " " + getTranslationByKeyCustom("Temp ST", "bar-stagres-temp-shorter");
			}
			let countUpdate = `[${parseInt(sourceVals[0] + sourceVals[1])} -> ${sourceVals[0]}]`;
			stDamageBody += generateDamageHelperBodyEffect(effectName, `${sourceVals[1]} ${countUpdate}`, "TempReduction", 0, sourceVals[2]);
		}
	}

	}

	/* Combine damage calculations into one message*/
	damageCalculation += `<div class="calculationContainer hpCalculationContainer">${hpDamageHead}${hpDamageBody}</div>`;
	damageCalculation += `<div class="calculationContainer stCalculationContainer">${stDamageHead}${stDamageBody}</div>`;
	damageCalculation += `<div class="calculationContainer spCalculationContainer">${spDamageHead}${spDamageBody}</div>`;
	damageCalculation += autoScriptMessage;
	
	/* Damage type icon */
	let damageIcon = "";
	let damageIconStyling = "style='height: 30px; width: 30px; border-right: 2px solid black;' </div>";
	switch (damageType) {
		case "Slash": damageIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Slash.png'" + damageIconStyling; break;
		case "Pierce": damageIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/pierce.png'" + damageIconStyling; break;
		case "Blunt": damageIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/blunt.png'" + damageIconStyling; break;
		case "None": damageIcon = "<img src='https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png'" + damageIconStyling; break;
	}

	/* Whisper and roll */
	let whisper = "";
	if(whisperrolls == "true") {
		whisper = "/w " + whispertarget;
	}

	setAttrs({"dummy":damageCalculation, "dummyIcon":damageIcon, "damageHelperType":"None"});

	startRoll((whisper + `&{template:damagecalculation} {{icon=@{dummyIcon}}} {{name=@{character_name}}} {{title=${getTranslationByKeyCustom("Damage Calculation", "heading-damagecalculation")}}} {{damagecalculations=@{dummy} }}`), (results) => {
		finishRoll(results.rollId, {} );
	});
	/* Damage calculation chat message block end */

	/* Cleanup */
	setAttrs({"dummy":" "});

	});
	});
	});
	});
	});
	});
	});
	});
}


/* Damage helper functions beginning */
function generateDamageHelperHeader(statName, newStat, oldStat, staggerState="0", autoapplydamage="true", hidebarupdate="false") {
	let langBar = "HP";
	let langDamage = "damage";
	let langSuffered = "received";
	let langSufferedNo = "Received no";
	let langRegened = "Regened";
	let langStaggered = "Regened";
	
	let updateDisplay = "";
	let displayContent = "";

	if(getTranslationByKey("message-damage") != false) {
		langDamage = getTranslationByKey("message-damage");
		langStaggered = getTranslationByKey("ailments-stagger-text");
		switch (statName) {
			case "HP": langBar = getTranslationByKey("bar-health-shortened"); break;
			case "ST": langBar = getTranslationByKey("bar-stagres-shortened"); break;
			case "SP": langBar = getTranslationByKey("bar-sanity-shortened"); break;
		}
	} else {
		langBar = statName;
	}
	if (staggerState == "Staggered") { updateDisplay = `<div class="updateStatDisplay"><b>${langStaggered}!</b></div>`; }
	else if (autoapplydamage != "true" || hidebarupdate == "true") { updateDisplay = `<div class="updateStatDisplay"><b>---</b></div>`; }
	else { updateDisplay = `<div class="updateStatDisplay"><b>${oldStat} -> ${newStat}</b></div>`; }

	if (newStat < oldStat) { langSuffered = getTranslationByKey("message-received");
		return `<div><div class="damageDisplay">${oldStat-newStat} ${langBar} ${langDamage} ${langSuffered}</div>${updateDisplay}</div>`; }
	else if (newStat > oldStat) { langRegened = getTranslationByKey("message-regened-capitalized");
		return `<div><div class="damageDisplay">${langRegened} ${newStat-oldStat} ${langBar}</div>${updateDisplay}</div>`; }
	else { langSufferedNo = getTranslationByKey("message-received-no");
		return `<div><div class="noDamage damageDisplay">${langSufferedNo} ${langBar} ${langDamage}</div>${updateDisplay}</div>` }
}

function generateDamageHelperBodyEffect(effectName, effectVal, effectType, ailmentRes, iconString, resMode = "", resVal = "", resIcon = "") {
	let langDamage = getTranslationByKeyCustom("damage", "message-damage");
	let langDealt = getTranslationByKeyCustom("dealt", "message-dealt");
	let langRegened = getTranslationByKeyCustom("regened", "message-regened");
	let langResist = getTranslationByKeyCustom("Resistance: ", "message-resist");
	let langReducedBaseDamageBy = getTranslationByKeyCustom("reduced base damage by", "message-reduced-basedamage-by");
	
	let langReduction = "";
	if (effectVal < 0) {
		langReduction = getTranslationByKeyCustom("increased damage by", "message-increased-damage-by");
	} else {
		langReduction = getTranslationByKeyCustom("reduced damage by", "message-reduced-damage-by");
	}


	let message = "<div>";
	switch (effectType) {
		case "Damage": message += `${iconString}<div><b>${effectName}</b> ${langDealt} ${Math.abs(effectVal)} ${langDamage}`; break;
		case "Regen": message += `${iconString}<div><b>${effectName}</b> ${langRegened} ${Math.abs(effectVal)} ${langDamage}`; break;
		case "Reduction": message += `${iconString}<div><b>${effectName}</b> ${langReduction} ${Math.abs(effectVal)}`; break;
		case "TempReduction": message += `${iconString}<div><b>${effectName}</b> ${langReduction} ${effectVal}`; break;
		case "Defence": message += `${iconString}<div><b>${effectName}</b> ${langReducedBaseDamageBy} ${Math.abs(effectVal)}`; break;
	}
	if (resMode == "beforeResistance") {
		message += ` x [${resVal}x] ` + getIcon("def", resIcon);
	}
	if (ailmentRes != 0) {
		message += `<b style='opacity: 50%;'> (${effectName} ${langResist}${ailmentRes})</b>`; 
	}
	return message + "</div></div>";
}

function applyTempBarDamage(sourceName, sourceVals, targetBar, damage, newBar) {

	if (damage > 0) {
		let tempBarVal = parseInt(sourceVals[0]);
		let messageVal = Math.min(tempBarVal, damage);
		let messageName = sourceVals[2];
		let messageIcon = getIcon(sourceVals[3], sourceVals[4]);

		if (tempBarVal > damage) {
			tempBarVal -= damage;
			newBar += damage;
			damage = 0;
		} else {
			damage -= tempBarVal;
			newBar += tempBarVal;
			tempBarVal = 0;
		}

		if (sourceVals[1] != "None") {
			let newCount = Math.ceil(tempBarVal/sourceVals[1]);
			setAttrs({[sourceName]:newCount, [`${sourceName.replace("ailnum","ailTempBarOverride")}`]:tempBarVal});
		}
		return { tempBarVal:tempBarVal, newBar:newBar, damage:damage, messageName:messageName, messageVal:messageVal, messageIcon:messageIcon};
	}
}
/* Damage helper functions end */



/* Temporary HP and ST */
function applyTempBarDamageAilment(tempBar_Sources, target, damage, newBar) {

	let tempBarUsed = {};
	let returnTempBar = {};
	if (Object.keys(tempBar_Sources).length > 0) {
		for (const sourceName in tempBar_Sources) {
			if (damage > 0) {
				returnTempBar = applyTempBarDamage(sourceName, tempBar_Sources[sourceName], target, damage, newBar);
				if (returnTempBar != undefined) {
					if (returnTempBar.tempBarVal == 0) {
						delete tempBar_Sources[sourceName];
					} else {
						tempBar_Sources[sourceName][0] = returnTempBar.tempBarVal;
					}
					newBar = returnTempBar.newBar;
					damage = returnTempBar.damage;
					tempBarUsed[returnTempBar.messageName] = [returnTempBar.tempBarVal, returnTempBar.messageVal, returnTempBar.messageIcon]
				}
			}
		}
		setAttrs({[`${target}_Sources`]:JSON.stringify(tempBar_Sources)});
	}
	if (returnTempBar.tempBarVal != undefined) {
		return { tempBarVal:returnTempBar.tempBarVal, newBar:newBar, damage:damage, [`${target}Used`]:tempBarUsed }
	}
}

on('change:repeating_ailments:ailNum', (info) => {

	let ailPrefix = info.sourceAttribute.replace("ailnum","");

	getAttrs([`${ailPrefix}ailNum`, `${ailPrefix}ailEffect`, `${ailPrefix}ailName`, `${ailPrefix}ailEffectVal`, `${ailPrefix}ailEffectMode`,
		`${ailPrefix}ailIcon`, `${ailPrefix}ailTempBarOverride`], function(values) {

		let ailNum = values[`${ailPrefix}ailNum`];
		let ailTarget = values[`${ailPrefix}ailEffect`];
		let ailName = values[`${ailPrefix}ailName`];
		let ailEffectVal = Math.abs(parseFloat(values[`${ailPrefix}ailEffectVal`].replaceAll("n", "")));
		let ailEffectMode = values[`${ailPrefix}ailEffectMode`];
		let ailIcon = values[`${ailPrefix}ailIcon`];
		let ailTempBarOverride = values[`${ailPrefix}ailTempBarOverride`];
		let tempBarVal = 0;

		if (ailTarget == "THP" || ailTarget == "TST") {
			/* Calculate temp bar value */
			if(ailEffectMode == "+") {
				tempBarVal = parseInt(ailNum) * parseFloat(ailEffectVal);
			}
			else if(ailEffectMode == "=" && ailNum != 0) {
				tempBarVal = parseFloat(ailEffectVal);
				ailEffectVal = "None";
			} else {
				ailEffectVal = 0;
			}

			/* If a temp bar override value exists for the ailment, use that value instead */
			if (parseInt(ailTempBarOverride) > 0 && (info.newValue != undefined || (info.newValue == undefined && info.previousValue == undefined))) {
				tempBarVal = parseInt(ailTempBarOverride);
			}

			/* Update the temp source for the correct bar */
			updateTempBar(ailTarget, info.sourceAttribute, tempBarVal, ailEffectVal, ailName, "ailments", ailIcon);
			setAttrs({[`${ailPrefix}ailTempBarOverride`]:"0"});
		}
	});
})

function updateTempBar(target, name, tempBarVal, tempNum, effectName, iconFolder, iconName, stack="false") {
	getAttrs(["THP_Sources", "TST_Sources"], function(values) {

		let tempSource = {};
		if (values[`${target}_Sources`] != "") { tempSource = JSON.parse(values[`${target}_Sources`]); }

		if (!(tempNum == 0 || tempBarVal == 0 || (isNaN(tempNum) && tempNum != "None"))) {
			if (tempSource[`${name}`] != undefined && stack == "true") {
				tempSource[`${name}`] = [tempSource[`${name}`][0] + tempBarVal, tempNum, effectName, iconFolder, iconName];
			} else {
				tempSource[`${name}`] = [tempBarVal, tempNum, effectName, iconFolder, iconName];
			}
		} else {
			delete tempSource[`${name}`];
		}

		setAttrs({[`${target}_Sources`]: JSON.stringify(tempSource)});
	});
}


/* Update: Tool uses */
on('change:tool1Reusable change:tool2Reusable change:tool3Reusable change:tool4Reusable', () => {

        getAttrs(["tool1Reusable", "tool1Uses", "tool1Uses_max", "tool2Reusable", "tool2Uses", "tool2Uses_max", "tool3Reusable", "tool3Uses", "tool3Uses_max", "tool4Reusable", "tool4Uses", "tool4Uses_max"], function(values) {
	output = {};	

	if(values.tool1Reusable != "Reusable"){
	output["tool1Uses"] = "1";
	}
	else if(values.tool1Reusable == "Reusable" && parseInt(values.tool1Uses) <= 1){
	output["tool1Uses"] = values.tool1Uses_max;
	}

	if(values.tool2Reusable != "Reusable"){
	output["tool2Uses"] = "1";
	}
	else if(values.tool2Reusable == "Reusable" && parseInt(values.tool2Uses) <= 1){
	output["tool2Uses"] = values.tool2Uses_max;
	}

	if(values.tool3Reusable != "Reusable"){
	output["tool3Uses"] = "1";
	}
	else if(values.tool3Reusable == "Reusable" && parseInt(values.tool3Uses) <= 1){
	output["tool3Uses"] = values.tool3Uses_max;
	}

	if(values.tool4Reusable != "Reusable"){
	output["tool4Uses"] = "1";
	}
	else if(values.tool4Reusable == "Reusable" && parseInt(values.tool4Uses) <= 1){
	output["tool4Uses"] = values.tool4Uses_max;
	}

	setAttrs(output);

	});
});

/* Action: Declare action */
on('clicked:declareAction', (info) => {

	let headercolor = "#888";
	let newicon = "/";
	let headertext = "#fff";

	let basetype = "Action";
	headercolor = "#8e7cc3";
	newicon = "/";

	/* Get skillSelect and toolSelect first as they're used to gather further values */
	getAttrs(["skillSelect", "toolselect"], function(values) {
		let skillselect = values.skillSelect;
		let toolselect = values.toolselect;

	/* Get attributes */
        getAttrs(["actionType", "settingSimpleDisplay", "settingHideBaseEffect", "settingWhisperRolls", "settingWhisperTarget", "targetName", "targetTokenId", "character_name", "Light", "skillSelect", "selectName", "selectLight", "selectType", "selectDice1", "selectDice2", "selectDice3", "selectEffect", "selectDescription", "baseActNum", "distortState", "tool1Name", "tool1Reusable", "tool1Uses", "tool1Uses_max", "tool1Effect", "tool1Description", "tool2Name", "tool2Reusable", "tool2Uses", "tool2Uses_max", "tool2Effect", "tool2Description", "tool3Name", "tool3Reusable", "tool3Uses", "tool3Uses_max", "tool3Effect", "tool3Description", "tool4Name", "tool4Reusable", "tool4Uses", "tool4Uses_max", "tool4Effect", "tool4Description", "special1Name","special1Description",  "special1Range", "special1Duration", "special1Risk", "special2Name", "special2Description", "special2Range", "special2Duration", "special2Risk", "egoName", "egoType", "egoDescription", "egoUses", "egoUses_max", "egoUseType", "egoEffect", "egoRisk", "egoRange", "egoDuration", "settingHideUses", `${toolselect}AutoScript`, `${skillselect}AutoScript`, "Bleed"], function(values) {

	let charname = values.character_name;
	let targetname = values.targetName;
	let targettokenid = values.targetTokenId;
	let simpledisplay = values.settingSimpleDisplay;
	let hidebaseffect = values.settingHideBaseEffect;
	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let distortstate = values.distortState;
	let hideuse = values.settingHideUses;

	let actiontype = values.actionType;
	let actiontext = "";
	let currentlight = parseInt(values.Light);
	let newlight = parseInt(values.Light);
	let actcounter = parseInt(values.baseActNum) + 1;

	let output = {};

	if(distortstate == "true"){
	headertext = "#8e7cc3";
	headercolor = "#000";

	}

	/* Type Formatting */
	if(actiontype == "tool"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Portable.png";
	actiontext = "Use Tool";
	}
	else if(actiontype == "move"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Speed.png";
	actiontext = "Move";
	}
	else if(actiontype == "protect"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/defend.png";
	actiontext = "Protect";

	}
	else if(actiontype == "other"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png";
	actiontext = "Other";
	}

	if(toolselect == "egoTool"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoAct.png";
	headertext = "#8e7cc3";
	headercolor = "#000";
	}
	else if(toolselect == "egoSpecial"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoSpecial.png";	
	headertext = "#cf8c44";
	headercolor = "#000";
	}
	else if(toolselect == "special1" || toolselect == "special2"){
	newicon = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/specialwhite.png";
	}

	/* Tool info */
	let toolname = "";
	let toolreuse = "0";
	let tooluses = "1";
	let toolusesmax = "1";
	let newuses = "0";
	let toolusestext = "";
	let tooldesc = "";
	let tooleffect = "";

	let specialriskNum = "0";
	let specialrangeNum = "0";
	let specialdurationNum = "0";

	let toolinfo = "";

	if(toolselect == "egoTool" || toolselect == "egoSpecial"){
	toolname = values.egoName;
	tooldesc = values.egoDescription;
	tooleffect = values.egoEffect;

	tooluses = values.egoUses;
	toolusesmax = values.egoUses_max;
	toolreuse = values.egoUseType;

		if(toolreuse != "Limitless" && toolreuse != null){
		toolusestext = " (" + tooluses + "/" + toolusesmax + ")";

		newuses = parseInt(tooluses) - 1;
			if(parseInt(newuses) < 0){ 
			newuses = "0";
			}

		output["egoUses"] = newuses;
		}

		if(toolselect == "egoSpecial"){
		specialriskNum = values.egoRisk;
		specialrangeNum = values.egoRange;
		specialdurationNum = values.egoDuration; 
		}

	}
	else if(toolselect == "special1" || toolselect == "special2"){
	toolname = values[`${toolselect}Name`];
	tooldesc = values[`${toolselect}Description`];

	specialriskNum = values[`${toolselect}Risk`];
	specialrangeNum = values[`${toolselect}Range`];
	specialdurationNum = values[`${toolselect}Duration`]; 

	}
	else if(toolselect == "" || toolselect == null){
	toolselect = "";
	}
	else {
	toolname = values[`${toolselect}Name`];
	tooldesc = values[`${toolselect}Description`];
	tooleffect = values[`${toolselect}Effect`];
	tooluses = values[`${toolselect}Uses`];
	toolusesmax = values[`${toolselect}Uses_max`];
	toolreuse = values[`${toolselect}Reusable`];

		if(toolreuse == "Reusable"){
		toolusestext = " (" + tooluses + "/" + toolusesmax + ")";

		newuses = parseInt(tooluses) - 1;
			if(parseInt(newuses) < 0){ 
			newuses = "0";
			}

		output[`${toolselect}Uses`] = newuses;
		}
		else {
		toolusestext = " (1/1)";
		output[`${toolselect}Uses`] = "0";
		}


	}

	if(values.settingHideUses == "true"){
	toolusestext = "";
	}

	/* Skill info */
	let skillname = values.selectName;
	let skilltype = values.selectType;
	let skillcost = values.selectLight;
	let skilldesc = values.selectDescription;
	let skilleffect = values.selectEffect;
	let skillinfo = "";
	let lightmessage = "";

	/* Bleed processing */
	let autoScriptOverrideList = {};
	updateBleed("standard", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);

	updateCustomAilments(["OnAction"], "standard", "false", function(returnValues) {
	Object.assign(autoScriptOverrideList, returnValues);

	/* AutoScripts */
	let AutoScript = "";

	/* Get tool AutoAcript if any */
	if (toolselect != "0") {
		AutoScript += "(Reset)" + values[`${toolselect}AutoScript`];
	}

	/* Get skill AutoAcript if any */
	if ((skillselect != undefined || skillselect != "0") && skilltype == "Action") {
		AutoScript += "(Reset)" + values[`${skillselect}AutoScript`];
	}

	/* Clean AutoScript. Remove nested and undefined */
	if (AutoScript != "") {
		AutoScript = AutoScript.replace(/\[([#][^]+[#])\]/g, "");
		AutoScript = AutoScript.replace("undefined", "");
	}

	resetConditionals();
	AutoScriptMain(AutoScript, "None", "true", "false", autoScriptOverrideList, function(returnValues) {

	let autoEffectLight = 0;
	if (returnValues.Light != undefined) {autoEffectLight = parseInt(returnValues.Light); }

	/* Action buttons */
	let buttonList = [];
	let giveButtonList = [];
	for (const [buttonKey, buttonValue] of Object.entries(returnValues)) {
		if (buttonKey.startsWith("auto")) {
			switch (buttonKey.split(" ")[0]) {
				case "autoDamage": buttonList.push(generateActionButton(buttonKey, getIcon("icons","damage"), "red", "actionButtonDamage", {AutoScript: buttonValue, targetTokenId: targettokenid})); break;
				case "autoInflict": buttonList.push(generateActionButton(buttonKey, getIcon("icons","lose"), "purple", "actionButtonInflict", {AutoScript: buttonValue, targetTokenId: targettokenid})); break;
				case "autoGive": giveButtonList.push(generateActionButton(buttonKey, getIcon("icons","win"), "blue", "actionButtonGive", buttonValue, "selected")); break;
			}
		}
	}

	let autoScriptMessage = "";
	if (returnValues.message != undefined) { autoScriptMessage = returnValues.message }

	/* Translation prep */
	let langFrom = "From";
	let langTarget = "Target"
	let langUse = "Use Tool";
	let langSkill = "Skill";
	let langDesc = "Description";
	let langEffect = "Effect";

	let langRisk = "Risk";
	let langRange = "Range";
	let langDuration = "Duration";


	if(getTranslationByKey("message-from") != false){

	actiontext = getTranslationByKey("palette-action-" + actiontype);

	langFrom = getTranslationByKey("message-from");
	langTarget = getTranslationByKey("message-target");
	langUse = getTranslationByKey("palette-action-tool");
	langSkill = getTranslationByKey("message-skill");
	langDesc = getTranslationByKey("message-desc");
	langEffect = getTranslationByKey("message-effect");

	langRisk = getTranslationByKey("special-risk-text");
	langRange = getTranslationByKey("special-range-text");
	langDuration = getTranslationByKey("special-duration-text");

	specialrisk = getTranslationByKey("special-risk-" + specialriskNum);
	specialrange = getTranslationByKey("special-range-" + specialrangeNum);
	specialduration = getTranslationByKey("special-duration-" + specialdurationNum);

	}

	if(toolselect == "special1" || toolselect == "special2"){
	tooleffect = tooldesc;
	tooldesc = "<b>Risk</b>: " + specialrisk + "<br><b>Range</b>: " + specialrange + "<br><b>Duration</b>: " + specialduration;
	}
	else if(toolselect == "egoSpecial"){
	tooldesc = "<b>Risk</b>: " + specialrisk + "<br><b>Range</b>: " + specialrange + "<br><b>Duration</b>: " + specialduration + "<br>" + tooldesc;

	}

	let toolDescription = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px;'><div style='text-align: left; padding: 5px;'>" + tooldesc + "</div></div>";
	let toolEffectDescription = "<div class='toolEffect' style='max-height: 60px; width: 96.5%; border: 1px #555 solid; overflow: auto; float: left; padding: 3px;'>" + tooleffect + "</div>";
	if (tooldesc == "") { toolDescription = ""; }
	if (tooleffect == "") { toolEffectDescription = ""; toolDescription = toolDescription.replaceAll(" padding-bottom: 3px;","").replaceAll(" padding: 5px;"," padding-top: 5px;"); }

	if(toolselect != "" && toolselect != null && toolselect != "0") {
		toolinfo = "<b>" + langUse + "</b>: " +  toolname + toolusestext + "<br>" + toolDescription + toolEffectDescription;
	}

	if(currentlight >= skillcost && skilltype == "Action") {
		newlight = currentlight - skillcost;
		lightmessage = " <span style='color: #fee2b0'>(" + langSkill + ")</span>";

		skillinfo= "<b>" + langSkill + ": </b>" + skillname;
		let skillDescription = "<br><div class='descriptionContainer'><b>" + langDesc + ":</b><br><div class='effectDescription'>" + skilldesc + "</div></div>";
		let skillEffectDescription = "<div class='descriptionContainer'><b>" + langEffect + ":</b><br><div class='effectDescription''>" + skilleffect + "</div></div>";

		if (skilldesc == "") { skillDescription = ""; }
		if (skilleffect == "") { skillEffectDescription = ""; }
		skillinfo = skillinfo + skillDescription + skillEffectDescription;
	}

	if (hidebaseffect == "true") { skillinfo= "<b>" + langSkill + ": </b>" + skillname; toolinfo = "<b>" + langUse + "</b>: " +  toolname + toolusestext + "<br>"; }

	let info = "<div style='background-color: #222; overflow: hidden; height: 30px; border: 2px #000 solid; color: " + headertext + ";'><div style='float: left'><img src='" + newicon + "' style='width: 30px; height: 30px; border-right: 2px #000 solid; margin-right: 5px; background-color:" + headercolor + "'></div><div style='width: 80%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + actiontext + lightmessage + "</b></div></div><b>" + langFrom + ": </b> " + charname + "<br>";
	if (targetname != "") { info += "<b>" + langTarget + ": </b>"+ targetname + "<br>"; }
	info += toolinfo + skillinfo + autoScriptMessage;

	setAttrs({"dummy":info});

	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/*--- send roll end --*/
	startRoll((whisper + "&{template:baseRoll} {{infodump=@{dummy} }}"), (results) => {
        finishRoll(results.rollId,{});

		/* Action Buttons */
		createActionButtons(buttonList);
		createActionButtons(giveButtonList, "selected");
    });
	/*--- send roll end ---*/

	output["skillSelect"] = "";
	output["toolSelect"] = "";
	output["Light"] = newlight + autoEffectLight;
	output["baseActNum"] = actcounter;
	output["lastDefenceRoll"] = 0;

	setAttrs(output);

	});
	});
	});
	});
	});
});

/* Share: Outfit */
on("clicked:shareOutfit", function() {
	getAttrs(["outfitImmune1", "outfitImmune2", "outfitImmune3", "outfitImmune4", "outfitImmune5", "outfitImmune6", "outfitName", "outfitRank", "outfitEffect", "outfitDescription", "defDice1", "defDice2", "defDice3", "evdDice1", "evdDice2", "evdDice3", "settingWhisperRolls", "settingWhisperTarget"], function(values) {

	let name = values.outfitName;
	let rank = values.outfitRank;
	let desc = values.outfitDescription;
	let effect = values.outfitEffect;
	let diceD = values.defDice1 + "d" + values.defDice2 + "+" + values.defDice3;
	let diceE = values.evdDice1 + "d" + values.evdDice2 + "+" + values.evdDice3;


	let iconSlash = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResSlash.png' style='width: 25px; height: 25px;'>";
	let iconSlashSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResSlashStg.png' style='width: 25px; height: 25px;'>";

	let iconPierce = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResPierce.png' style='width: 25px; height: 25px;'>";
	let iconPierceSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResPierceStg.png' style='width: 25px; height: 25px;'>";

	let iconBlunt = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResBlunt.png' style='width: 25px; height: 25px;'>";
	let iconBluntSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResBluntStg.png' style='width: 25px; height: 25px;'>";

	let immune = 
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconSlash + " x" + values.outfitImmune1 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconSlashSTG + " x" + values.outfitImmune2 + "</div></div><br>" + 
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconPierce + " x" + values.outfitImmune3 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconPierceSTG + " x" + values.outfitImmune4 + "</div></div><br>" +
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconBlunt + " x" + values.outfitImmune5 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconBluntSTG + " x" + values.outfitImmune6 + "</div></div>";


	/* Translation prep */
	let langRank = "Rank";
	let langDef = "Def";
	let langEvd = "Evd";
	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");
	langDef = getTranslationByKey("message-defend");
	langEvd = getTranslationByKey("message-evade");

	}

	let iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/defend.png' style='width: 30px; height: 30px;' >";

	header = "<div style='background-color: #7397d1; overflow: hidden; height: 30px;'><div style='float: left'>" + iconnew + "</div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + name + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>" + langRank + ": </b>" + rank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><b>" + langDef + ": </b>" + diceD + " | <b>" + langEvd + ": </b>" + diceE + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + effect + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + immune + "</div></div><div style='height: 60px; width: 98%; border-top: 1px #555 solid; overflow: auto; float: left; padding: 3px;'>" + desc + "</div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/* Share: Augment */
on("clicked:shareAugment", function() {
 getAttrs(["settingWhisperRolls", "settingWhisperTarget", "augmentName", "augmentType", "augmentDescription", "augmentEffect", "augmentRank"], function(values) {

	let headTag = "<div style='background-color: #85a874; overflow: hidden; height: 30px;'>";
	let iconnew = "<img src='/' style='width: 5px; height: 30px; opacity: 0%;'>";

	let augmentname = values.augmentName;
	let augmentdesc = values.augmentDescription;
	let augmenteffect = values.augmentEffect;
	let augmentrank = values.augmentRank;
	let augmenttype = values.augmentType;

	/* Translation prep */
	let langRank = "Rank";
	let langType = "Type";
	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");
	langType = getTranslationByKey("message-type");

	augmenttype = getTranslationByKey("augment-type-" + augmenttype);

	}

	if(augmenttype == "FullProsthesis"){
	augmenttype = "Full Prosthesis";
	}
	else if(augmenttype == "Drugs"){
	augmenttype = "Drugs/Serums";
	}

	header = "<div style='background-color: #85a874; overflow: hidden; height: 30px;'><div style='float: left'><img src='/' style='width: 5px; height: 30px; opacity: 0%;'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + augmentname + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>" + langRank + ": </b>" + augmentrank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><b>" + langType + ": </b>" + augmenttype + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + augmentdesc + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + augmenteffect + "</div></div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/*-- Share: Tools --*/
on("clicked:shareTool", function(info) {

	/* Get IDs/names */
        let buttonid = info.htmlAttributes.id.split('_')[1];

	let name = buttonid + "Name";
	let type = buttonid + "Type";
	let rank = buttonid + "Rank";
	let effect = buttonid + "Effect";
	let desc = buttonid + "Description";

	let portable = buttonid + "Portable";
	let reusable = buttonid + "Reusable";
	let uses = buttonid + "Uses";

	let header = "";
	let body = "";

	/* Get attributes */
        getAttrs([`${name}`, `${type}`, `${rank}`, `${effect}`, `${desc}`, `${portable}`, `${reusable}`, `${uses}`, "settingWhisperRolls", "settingWhisperTarget"], function(values) {

	let toolname = values[name];
	let toolrank = values[rank];
	let tooltype = values[type];
	let tooleffect = values[effect];
	let tooldesc = values[desc];
	let toolportable = values[portable];
	let toolreusable = values[reusable];
	let tooluses = values[uses];
	let toolinfo = "";

	/* Translation prep */
	let langRank = "Rank";
	let langPortable = "Portable";
	let langPortableNo = "Not portable";

	let langReusable = "Reusable";
	let langReusableNo = "Not reusable";

	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");

	langPortable = getTranslationByKey("tool-portable");
	langPortableNo = getTranslationByKey("tool-portableNo");

	langReusable = getTranslationByKey("tool-reusable");
	langReusableNo = getTranslationByKey("tool-reusableNo");

	}

	/* Formatting */

	if(toolportable != "Portable"){
	toolportable = langPortableNo;
	}
	else { toolportable = "<b>" + langPortable + "</b>"; }
	
	if(toolreusable != "Reusable") {
	toolreusable = langReusableNo;
	}
	else{ toolreusable = "<b>" + langReusable + " (" + tooluses + ")</b>"; }

	if(toolreusable != " " && toolportable != " ") {
	toolinfo = toolportable + " | " + toolreusable; 
	}
	else { toolinfo = toolportable + toolreusable; }

	header = "<div style='background-color: #8e7cc3; overflow: hidden; height: 30px;'><div style='float: left'><img src='/' style='width: 5px; height: 30px; opacity: 0%;'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + toolname + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>"+ langRank + ": </b>" + toolrank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'>" + toolinfo + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + tooldesc + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + tooleffect + "</div></div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});


/*-- Share: Special items --*/
on("clicked:shareSpecial", function(info) {

	/* Get IDs/names */
        let buttonid = info.htmlAttributes.id.split('_')[1];

	let name = buttonid + "Name";
	let rank = buttonid + "Rank";
	let desc = buttonid + "Description";

	let risk = buttonid + "Risk";
	let duration = buttonid + "Duration";
	let range = buttonid + "Range";

	let header = "";
	let body = "";

	/* Get attributes */
        getAttrs([`${name}`, `${rank}`, `${desc}`, `${risk}`, `${range}`, `${duration}`, "settingWhisperRolls", "settingWhisperTarget"], function(values) {

	let specialname = values[name];
	let specialrank = values[rank];
	let specialdesc = values[desc];
	let specialriskNum = values[risk];
	let specialrangeNum = values[range];
	let specialdurationNum = values[duration];

	let specialrisk = "---";
	let specialrange = "---";
	let specialduration = "---";

	/* Formatting */

/* Switching Risk to string */
	switch (specialriskNum) {
  	case "0":
   	 specialrisk = "Canard";
    	 break;
 	case "1":
   	 specialrisk = "Urban Myth";
    	 break;
 	case "2":
   	 specialrisk = "Urban Legend";
    	 break;
	case "3":
   	 specialrisk = "Urban Plague";
    	 break;
	case "4":
   	 specialrisk = "Urban Nightmare";
    	 break;
	case "5":
   	 specialrisk = "Star of the City";
    	 break;
	case "6":
   	 specialrisk = "Impuritas Civitatis";
    	 break;
  	default:
    	 specialrisk = "---";
	}

	/* Switching Range to string */
	switch (specialrangeNum) {
  	case "0":
   	 specialrange = "One or two people";
    	 break;
 	case "1":
   	 specialrange = "Street";
    	 break;
 	case "2":
   	 specialrange = "Neighborhood";
    	 break;
	case "3":
   	 specialrange = "Residence Area";
    	 break;
	case "4":
   	 specialrange = "Nest";
    	 break;
	case "5":
   	 specialrange = "Multiple Nests";
    	 break;
	case "6":
   	 specialrange = "City";
    	 break;
  	default:
    	 specialrange = "---";
	}

	/* Switching Duration to string */
	switch (specialdurationNum) {
  	case "0":
   	 specialduration = "A moment";
    	 break;
 	case "1":
   	 specialduration = "Seconds";
    	 break;
 	case "2":
   	 specialduration = "Minutes";
    	 break;
	case "3":
   	 specialduration = "Hours";
    	 break;
	case "4":
   	 specialduration = "Days";
    	 break;
	case "5":
   	 specialduration = "Weeks";
    	 break;
	case "6":
   	 specialduration = "Months";
    	 break;
  	default:
    	 specialduration = "---";
	}

	/* Translation prep */
	let langRank = "Rank";
	let langRisk = "Risk";
	let langRange = "Range";
	let langDuration = "Duration";
	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");

	langRisk = getTranslationByKey("special-risk-text");
	langRange = getTranslationByKey("special-range-text");
	langDuration = getTranslationByKey("special-duration-text");

	specialrisk = getTranslationByKey("special-risk-" + specialriskNum);
	specialrange = getTranslationByKey("special-range-" + specialrangeNum);
	specialduration = getTranslationByKey("special-duration-" + specialdurationNum);

	}

	header = "<div style='background-color: #cf8c44; overflow: hidden; height: 30px;'><div style='float: left'><img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/specialwhite.png' style='width: 30px; height: 30px;'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + specialname + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>" + langRank + ": </b>" + specialrank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><div style='text-align: left; padding: 5px;'><b>" + langRisk +": </b>" + specialrisk + "<br> <b>" + langRange + ": </b>" + specialrange + "<br> <b>" + langDuration + ": </b>" + specialduration + "</div></div><div style='height: 60px; width: 98%; border-top: 1px #555 solid; overflow: auto; float: left; padding: 3px;'>" + specialdesc + "</div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/*-- Share: Weapons --*/
on("clicked:shareWeapon", function(info) {

	/* Get IDs/names */
        let buttonid = info.htmlAttributes.id.split('_')[1];

	let name = buttonid + "Name";
	let type = buttonid + "Type";
	let rank = buttonid + "Rank";
	let effect = buttonid + "Effect";
	let desc = buttonid + "Description";
	let range = buttonid + "Range";

	let diceA = buttonid + "Dice1";
	let diceB = buttonid + "Dice2";
	let diceC = buttonid + "Dice3";

	let header = "";
	let body = "";

	/* Get attributes */
        getAttrs([`${name}`, `${type}`, `${rank}`, `${effect}`, `${desc}`, `${range}`, `${diceA}`, `${diceB}`, `${diceC}`, "settingWhisperRolls", "settingWhisperTarget"], function(values) {

	let weaponname = values[name];
	let weaponrank = values[rank];
	let weapontype = values[type];
	let weaponeffect = values[effect];
	let weapondesc = values[desc];
	let weaponrange = values[range];
	let weapondice = values[diceA] + "d" + values[diceB] + "+" + values[diceC];

	/* Formatting */
	iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png' style='width: 30px; height: 30px;'>";

	if(weapontype == "Slash"){
	iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Slash.png' style='width: 30px; height: 30px;'>";
	}
	else if(weapontype == "Pierce"){
	iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/pierce.png' style='width: 30px; height: 30px;'>";
	}
	else if(weapontype == "Blunt"){
	iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/blunt.png' style='width: 30px; height: 30px;'>";
	}

	/* Translation prep */
	let langRank = "Rank";
	let langDiceType = "Att";

	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");
	langDiceType = getTranslationByKey("message-attack");

	weapontype = getTranslationByKey("weapon-type-" + weapontype);
	weaponrange = getTranslationByKey("weapon-type-" + weaponrange);

	}

	header = "<div style='background-color: #c25944; overflow: hidden; height: 30px;'><div style='float: left'>" + iconnew + "</div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + weaponname + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>" + langRank + ": </b>" + weaponrank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><b>" + langDiceType + ": </b>" + weapondice + " | " + weapontype + " | " + weaponrange + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + weapondesc + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + weaponeffect + "</div></div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/*-- Share: Distortion --*/
on("clicked:shareDistort", function(info) {

	/* Get attributes */
        getAttrs(["distort_name", "distort_summary", "distortDescription", "distortEffect", "distortDescription2", "distortEffect2", "distortWeaponDice1", "distortWeaponDice2", "distortWeaponDice3", "distortDefDice1", "distortDefDice2", "distortDefDice3", "distortEvdDice1", "distortCounter", "distortEvdDice2", "distortEvdDice3", "distortCounter", "distortCounter_max", "obsDesc", "obsEffect", "obsBehavior", "obsTaboon", "obsCounter", "obsWorkAmount", "obsWorkResults", "obsWorkPref", "obsSummary", "obsAppearance", "obsAtmosphere", "obsStory", "settingWhisperRolls", "settingWhisperTarget", "distortWorkBase", "distortResultGood", "distortResultNormal", "distortResultBad", "distortWorkInstinct", "distortWorkWisdom", "distortWorkJustice", "distortWorkCharm", "distortWorkInsight", "distortWorkTemperance", "distort_behavior", "distort_taboo", "distort_atmosphere", "distort_appearance", "distort_story"], function(values) {
	let name = values.distort_name;
	let rank = values.charRankBase;
	let attEffect = values.distortEffect;
	let attDesc = values.distortDescription;
	let defEffect = values.distortEffect2;
	let defDesc = values.distortDescription2;

	let iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Distort.png";
	let typecolor = "#fff";

	/* Translation prep */
	let langMod = "Mod";
	let langWorkPref = "Preferences";
	let langWorkResult = "Results";
	let langWorkAmount = "Work Amount";
	let langTaboon = "Taboos/Boons";
	let langBehavior = "Behavior";
	let langStory = "Story";
	
	if(getTranslationByKey("message-mod") != false){
	langMod = getTranslationByKey("message-mod");
	langWorkPref = getTranslationByKey("distort-obs-workpreference");
	langWorkResult = getTranslationByKey("distort-loweringresults");
	langWorkAmount = getTranslationByKey("distort-obs-work");
	langTaboon = getTranslationByKey("distort-obs-taboon");
	langBehavior = getTranslationByKey("distort-behavior");
	langStory = getTranslationByKey("distort-story");

	}


	/* Formatting */
	let diceA = values.distortWeaponDice1 + "d" + values.distortWeaponDice2 + "+" + values.distortWeaponDice3;
	let diceD = values.distortDefDice1 + "d" + values.distortDefDice2 + "+" + values.distortDefDice3;
	let diceE = values.distortEvdDice1 + "d" + values.distortEvdDice2 + "+" + values.distortEvdDice3;
	let counter = values.distortCounter + "/" + values.distortCounter_max;

	let distortSummary = "";
	if(values.obsSummary == "true"){
	distortSummary = "<div style='padding: 3px; border-bottom: 1px #555 solid; max-height: 60px; overflow: auto;'>" + values.distort_summary + "</div>";}

	let distortAppearance = "";
	if(values.obsAppearance == "true"){
	distortAppearance = "<div style='padding: 3px; border-bottom: 1px #555 solid; max-height: 50px; overflow: auto;'>" + values.distort_appearance + "</div>";
	}

	let distortAtmosphere = "";
	if(values.obsAtmosphere == "true"){
	distortAtmosphere = "<div style='padding: 3px; border-bottom: 1px #555 solid; max-height: 50px; overflow: auto;'>" + values.distort_atmosphere + "</div>";
	}

	let distortStory = "";
	if(values.obsStory == "true"){
	distortStory = "<div style='background-color:#111; padding: 5px;'><b>" + langStory + "</b></div><div style='padding: 3px; border-bottom: 1px #555 solid; max-height: 80px; overflow: auto;'>" + values.distort_story + "</div>";}

	/* Work result formatting */
	let goodIcon = "opacity: 30%";
	let normalIcon = "opacity: 30%";
	let badIcon = "opacity: 30%";

	if(values.distortResultGood == "Good"){
	goodIcon = "opacity: 100%";
	}
	if(values.distortResultNormal == "Normal"){
	normalIcon = "opacity: 100%";
	}
	if(values.distortResultBad == "Bad"){
	badIcon = "opacity: 100%";
	}

	let distortWorkResult = "<div style='text-align: center; width: 39%; float:left; opacity: 30%;'><b>"+ langWorkResult +"</b><br> ?</div>";
	if(values.obsWorkResults == "true"){
	distortWorkResult = "<div style='text-align: center; width: 39%; float:left;'><b>"+ langWorkResult +"</b><br> <img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/good.png' style='height: 25px; width: 25px; " + goodIcon + ";'> <img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/normal.png' style='height: 25px; width: 25px; " + normalIcon + ";'> <img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/bad.png' style='height: 25px; width: 25px; " + badIcon + ";'></div>";
	}

	/* Work preference formatting */

	let distortWorkPref = "<div style='text-align: center; width: 30%; float: left; opacity: 30%;'><b>"+ langWorkPref +"</b><br><b style='color: #cc4125;'>?</b> | <b style='color: #d9d9d9;'>?</b> | <b style='color: #46bdc6;'>?</b><br><b style='color: #9c66c6;'>?</b> | <b style='color: #ffe599;'>?</b> | <b style='color: #ac609d;'>?</b></div>";
	if(values.obsWorkPref == "true"){
	distortWorkPref = "<div style='text-align: center; width: 30%; float: left;'><b>"+ langWorkPref +"</b><br><b style='color: #cc4125;'>" + values.distortWorkInstinct + "</b> | <b style='color: #d9d9d9;'>"+ values.distortWorkWisdom +"</b> | <b style='color: #46bdc6;'>" + values.distortWorkJustice + "</b><br><b style='color: #9c66c6;'>" + values.distortWorkCharm + "</b> | <b style='color: #ffe599;'>"+ values.distortWorkInsight +"</b> | <b style='color: #ac609d;'>" + values.distortWorkTemperance + "</b></div>";
	}

	let distortWorkAmount = "<div style='text-align: center; width: 30%; float: left; opacity: 30%;'><b>" + langWorkAmount + "</b><br><span style='font-size: 25px;'>?</span></div>";
	if(values.obsWorkAmount == "true"){
	distortWorkAmount = "<div style='text-align: center; width: 30%; float: left;'><b>" + langWorkAmount + "</b><br><span style='font-size: 25px;'>"+ values.distortWorkBase + "</span></div>";
	}


	let workSection = "";
	if(values.obsWorkAmount == "true" || values.obsWorkPref == "true" || values.obsWorkResults == "true"){
	workSection = "<div style='width: 100%; background-color: #222; overflow: auto; height: 55px;'>" + distortWorkAmount + distortWorkPref + distortWorkResult + "</div>";}

	/* Behavior/Taboo formatting */

	let distortBehavior = "";
	let distortTaboo = "";
	let flexwidth1 = "49%";
	let flexwidth2 = "50%";

	if(values.obsBehavior != "true" || values.obsTaboon != "true"){
	flexwidth1 = "100%";
	flexwidth2 = "100%";

	}

	if(values.obsBehavior == "true"){
	distortBehavior = "<div style='width: " + flexwidth1 + "; float: left;'><b>" + langBehavior + ": </b><br><div style='height: 60px; overflow: auto;'>" + values.distort_behavior + "</div></div>";

	}
	if(values.obsTaboon == "true"){
	distortTaboo = "<div style='width: "+ flexwidth2 + "; float: left;'><b>" + langTaboon + ": </b><br><div style='height: 60px; overflow: auto;'>" + values.distort_taboo + "</div></div>";
	}
	
	let behaviorSection = "<div style='width: 100%; max-height: 80px; overflow: hidden; background-color: #222;'>"+ distortBehavior + distortTaboo  + "</div>";

	if(values.obsTaboon != "true" && values.obsBehavior != "true"){
	behaviorSection = "";
	}
	/* Behavior section end */

	let distortCounter = "";
	if(values.obsCounter == "true"){
	distortCounter = "<div style='position: absolute; top: 5px; right: 5px; font-size: 20px; color: #cc4125;'> <b>" + counter + "</b></div>";
	}

	let distortDesc = "";
	if(values.obsDesc == "true"){
	distortDesc = "<div style='width: 100%; max-height: 50px; overflow: hidden; background-color: #111;'><div style='height: 50px; width: 49%; border-right: 1px #555 solid; overflow: auto; color: #cc4125; float: left;'><b>" + attDesc + "</b></div><div style='height: 50px; width: 50%; overflow: auto; float: left; color: #6d9eeb;'><b>" + defDesc + "</b></div></div>";
	}

	let distortEffect = "";
	if(values.obsEffect == "true"){
	distortEffect = "<div style='width: 100%; height: 60px; overflow: hidden; background-color: #111; border-top: 1px #555 solid; border-bottom: 1px #555 solid;'><div style='height: 60px; width: 49%; color: #cc4125; border-right: 1px #555 solid; overflow: auto; float: left;'>" + attEffect + "</div><div style='height: 60px; width: 50%; color: #6d9eeb; overflow: auto; float: left;'>" + defEffect + "</div></div> <div style='text-align: center; padding-top: 5px; padding-bottom: 5px; color: #fff; background-color: #000;'><b>" + langMod + ": </b> <span style=' color: #cc4125'>" + diceA + "</span> | <span style='color: #6d9eeb;'>" + diceD + "</span> | <span style='color: #dbb748'>" + diceE + "</span></div>";

	}



	header = "<div style='background-color: #000; color: " + typecolor + "; overflow: hidden; height: 30px;'><div style='float: left'><img src='" + iconnew + "' style='width: 30px; height: 30px; opacity: 50%;'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + name + "</b></div>" + distortCounter + "</div>";

	body = workSection + behaviorSection + distortSummary + distortAppearance + distortAtmosphere + distortStory + distortDesc + distortEffect + " ";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/*-- Share: Ego --*/
on("clicked:shareEgo", function(info) {

	/* Get attributes */
        getAttrs(["egoName", "egoRank", "egoIdeology", "egoCondition", "egoType", "egoDescription", "egoEffect", "egoWeaponType", "egoWeaponRange", "egoWeaponDice1", "egoWeaponDice2", "egoWeaponDice3", "egoDefDice1", "egoDefDice2", "egoDefDice3", "egoEvdDice1", "egoEvdDice2", "egoEvdDice3", "egoImmune1", "egoImmune2", "egoImmune3", "egoImmune4", "egoImmune5", "egoImmune6", "egoRisk", "egoRange", "egoDuration", "settingWhisperRolls", "settingWhisperTarget"], function(values) {
	let name = values.egoName;
	let rank = values.egoRank;
	let conditionBase = values.egoCondition;
	let condition = conditionBase;
	let type = values.egoType;
	let effect = values.egoEffect;
	let desc = values.egoDescription;
	let ideology = values.egoIdeology;

	let specialriskNum = values.egoRisk;
	let specialrangeNum = values.egoRange;
	let specialdurationNum = values.egoDuration;

	let iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png";
	let typecolor = "#fff";
	let bottomdata = "";

	/* Condition formatting */
	switch (condition) {
  	case "AlwaysActive":
   	 condition = "Always active";
    	 break;
 	case "HalfHealth":
   	 condition = "50% health";
    	 break;
 	case "OnStagger":
   	 condition = "On stagger";
    	 break;
 	case "EnemyDefeat":
   	 condition = "Enemy defeat";
    	 break;
 	case "AllyDefeat":
   	 condition = "Ally defeat";
    	 break;
  	default:
    	 condition = "---";
	}

	/* Translation prep */
	let langRank = "Rank";
	let langDiceTypeAtt = "Att";
	let langDiceTypeDef = "Def";
	let langDiceTypeEvd = "Evd";
	let langType = "Type";
	let langEgoType = type;

	let langRisk = "Risk";
	let langRange = "Range";
	let langDuration = "Duration";
	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");
	langType = getTranslationByKey("message-type");
	langDiceTypeAtt = getTranslationByKey("message-attack");
	langDiceTypeDef = getTranslationByKey("message-defend");
	langDiceTypeEvd = getTranslationByKey("message-evade");

	langEgoType = getTranslationByKey("ego-type-" + type);
	condition = getTranslationByKey("ego-active-" + conditionBase);

	langRisk = getTranslationByKey("special-risk-text");
	langRange = getTranslationByKey("special-range-text");
	langDuration = getTranslationByKey("special-duration-text");

	specialrisk = getTranslationByKey("special-risk-" + specialriskNum);
	specialrange = getTranslationByKey("special-range-" + specialrangeNum);
	specialduration = getTranslationByKey("special-duration-" + specialdurationNum);

	}


	/* Formatting */
	if(type == "Weapon"){
	let diceA = values.egoWeaponDice1 + "d" + values.egoWeaponDice2 + "+" + values.egoWeaponDice3;
	let weapontype = values.egoWeaponType;
	let weaponrange = values.egoWeaponRange;

	typecolor = "#cc4125";

	if(weapontype == "Slash"){
	iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoSlash.png";
		}
	else if(weapontype == "Pierce"){
	iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoPierce.png";
		}
	else if(weapontype == "Blunt"){
	iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoBlunt.png";
		}

	if(getTranslationByKey("weapon-type-" + weapontype) != false){
	weapontype = getTranslationByKey("weapon-type-" + weapontype);
	weaponrange = getTranslationByKey("weapon-type-" + weaponrange);
	}

	bottomdata = "<div style='text-align: center; padding-top: 5px; padding-bottom: 5px; color:" + typecolor + "; background-color: #000;'><b>" + langDiceTypeAtt + ": </b>" + diceA + " | " + weapontype + " | " + weaponrange + "</div>";
	

	}
	else if(type == "Outfit"){
	typecolor = "#6d9eeb";
	iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoDef.png";

	let diceD = values.egoDefDice1 + "d" + values.egoDefDice2 + "+" + values.egoDefDice3;
	let diceE = values.egoEvdDice1 + "d" + values.egoEvdDice2 + "+" + values.egoEvdDice3;

let iconSlash = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResSlash.png' style='width: 25px; height: 25px;'>";
	let iconSlashSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResSlashStg.png' style='width: 25px; height: 25px;'>";

	let iconPierce = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResPierce.png' style='width: 25px; height: 25px;'>";
	let iconPierceSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResPierceStg.png' style='width: 25px; height: 25px;'>";

	let iconBlunt = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResBlunt.png' style='width: 25px; height: 25px;'>";
	let iconBluntSTG = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/def/ResBluntStg.png' style='width: 25px; height: 25px;'>";

	let immune = 
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconSlash + " x" + values.egoImmune1 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconSlashSTG + " x" + values.egoImmune2 + "</div></div><br>" + 
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconPierce + " x" + values.egoImmune3 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconPierceSTG + " x" + values.egoImmune4 + "</div></div><br>" +
	"<div style='height:15px;'><div style='width: 70px; color: #c25944; float: left'>" + iconBlunt + " x" + values.egoImmune5 + "</div> <div style='width: 70px; color: #dbb748; float: left;'>" + iconBluntSTG + " x" + values.egoImmune6 + "</div></div>";

	bottomdata = "<div style='background-color: #000; height: 70px;'><div style='text-align: center; padding-top: 15px; padding-bottom: 15px; color:" + typecolor + "; width: 49%; float: left;'><b>" + langDiceTypeDef + ": </b> " + diceD + "<br><span style='color: #dbb748'><b>" + langDiceTypeEvd + ": </b>" + diceE + "</span></div><div style='height: 70px; width:49%; float: left; overflow: auto;'>" + immune +"</div></div>";

	}
	else if(type == "Tool"){
	typecolor = "#8e7cc3";
iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoAct.png";
	}
	else if(type == "Special"){
	typecolor = "#cf8c44";
iconnew = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoSpecial.png";

	bottomdata = "<div style='text-align: center; padding-top: 5px; padding-bottom: 5px; color:" + typecolor + "; background-color: #000;'><div style='text-align: left; padding: 5px;'><b>" + langRisk + ": </b>" + specialrisk + "<br> <b>" + langRange + ": </b>" + specialrange + "<br> <b>" + langDuration + ": </b>" + specialduration + "</div></div>";


	}
	else if(type == "0"){
	type = "---";
	}

	header = "<div style='background-color: #000; color: " + typecolor + "; overflow: hidden; height: 30px;'><div style='float: left'><img src='" + iconnew + "' style='width: 30px; height: 30px;'></div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; float: left;'><b>" + name + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>"+ langRank + ": </b>" + rank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><b>" + langType + ": </b>" + langEgoType + " | " + condition + "</div><div style='padding: 3px; border-bottom: 1px #555 solid; max-height: 30px; overflow: auto;'>" + ideology + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + desc + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + effect + "</div></div>" + bottomdata;

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/*-- Share: Skills --*/
on("clicked:shareSkill", function(info) {

	/* Get IDs/names */
        let buttonid = info.htmlAttributes.id.split('_')[1];
	let skillcat = buttonid.split('S')[0];

	let name = buttonid + "Name";
	let type = buttonid + "Type";
	let rank = buttonid + "Rank";
	let effect = buttonid + "Effect";
	let desc = buttonid + "Description";
	let light = buttonid + "Light";

	let diceA = buttonid + "Dice1";
	let diceB = buttonid + "Dice2";
	let diceC = buttonid + "Dice3";

	let header = "";
	let body = "";

	/* Get attributes */
        getAttrs([`${name}`, `${type}`, `${rank}`, `${effect}`, `${desc}`, `${light}`, `${diceA}`, `${diceB}`, `${diceC}`, "settingWhisperRolls", "settingWhisperTarget"], function(values) {

	let skillname = values[name];
	let skillrank = values[rank];
	let skilltype = values[type];
	let skilleffect = values[effect];
	let skilldesc = values[desc];
	let skilllight = values[light];
	let skilldice = values[diceA] + "d" + values[diceB] + "+" + values[diceC];
	let iconurl = "/";
	let iconbg = "#555";
	let headerbg = "#555";

	/* Formatting */

	if (skillcat == "ego"){
	iconbg = "#000";
	headerbg = "#000";

	if(skilltype == "Attack"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoAtt.png";
		}
	else if(skilltype == "Defend"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoDef.png";
		}
	else if(skilltype == "Evade"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoEvd.png";
		}
	else if(skilltype == "Action"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoAct.png";
		}
	else if(skilltype == "Mass"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/egoWide.png";
		}
	}
	else{
	if(skilltype == "Attack"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Attack.png";
	iconbg = "#c25944";
		}
	else if(skilltype == "Defend"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/defend.png";
	iconbg = "#7397d1";
		}
	else if(skilltype == "Evade"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/evade.png";
	iconbg = "#dbb748";
		}
	else if(skilltype == "Action"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Portable.png";
	iconbg = "#8e7cc3";
		}
	else if(skilltype == "Mass"){
	iconurl = "https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/Wide.png";
	iconbg = "#c25944";
		}
	}

	/* Translation prep */
	let langRank = "Rank";
	let langMod = "Mod";
	let langCost = "Cost";
	
	if(getTranslationByKey("rank") != false){

	langRank = getTranslationByKey("rank");
	langMod = getTranslationByKey("message-mod");
	langCost = getTranslationByKey("message-cost");

	skilltype = getTranslationByKey("skill-type-" + skilltype);

	}

	let iconnew = "<img src='" + iconurl + "' style='width: 28px; height: 28px; border-radius: 100px; border: 1px #fff solid; background-color: " + iconbg + ";'>";

	header = "<div style='background-color: " + headerbg + "; overflow: hidden; height: 30px;'><div style='float: left'>" + iconnew + "</div><div style='width: 55%; overflow: hidden; height: 20px; padding-top: 5px; padding-left: 2px; float: left;'><b>" + skillname + "</b></div><div style='position: absolute; top: 5px; right: 5px;'> <b>" + langRank + ": </b>" + skillrank + "</div></div>";

	body = "<div style='text-align: center; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px #555 solid;'><b>" + skilltype + "</b> | <b>" + langMod + ": </b>" + skilldice + " | <b>" + langCost + ": </b>" + skilllight + "</div><div style='width: 100%; height: 70px; overflow: hidden;'><div style='height: 70px; width: 49%; border-right: 1px #555 solid; overflow: auto; float: left;'>" + skilldesc + "</div><div style='height: 70px; width: 49%; overflow: auto; float: left;'>" + skilleffect + "</div></div>";

	setAttrs({"dummy":header, "dummy2":body});

	let whisperrolls = values.settingWhisperRolls;
	let whispertarget = values.settingWhisperTarget;
	let whisper = "";
	if(whisperrolls == "true"){
	whisper = "/w " + whispertarget;
	}

	/* Send */
	startRoll((whisper + "&{template:shareB} {{header=@{dummy} }} {{body=@{dummy2} }}"), (results) => {

            finishRoll(results.rollId, {} );
        });

	setAttrs({"dummy":" ", "dummy2":" "});

    });

});

/* Toggle: Edit Mode */
on("clicked:editMode", function(){
getAttrs(["settingEditMode"], function(values) {

	let newstate = "";
	let editmode = values.settingEditMode;

	if(editmode == "true"){
	newstate = "0";
	}
	else {
	newstate = "true";
	}
	

	setAttrs({"settingEditMode":newstate});

	});

});


/* Tab toggler */
    const buttonlist = ["equipment","skills","details","export", "edit"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });




/*--- AutoScript functions ---*/

/* Auto: Set default AutoScript styling */
/* This is intended as a temporary solution while I figure out a better way to add styling as a setting */
on("sheet:opened", function() {
	getAttrs(["autoScriptStylingDefault"], function(values) {
	let sheetDefaults = values.autoScriptStylingDefault;

	let stylingDefault =
`/* Clash results */
(Clash Win, icons, win, red) (CW, icons, win, red)
(Clash Lose, icons, lose, yellow) (CL, icons, lose, yellow)

/* On Use and On Hit */
(On Use, icons, Portable, blue)
(On Hit, icons, Attack, purple)

/* Action buttons */
(Apply damage, icons, damage, red)
(Apply ailments, icons, lose, purple)
(Give ailments, icons, win, yellow)`;

	if(sheetDefaults != stylingDefault){

	setAttrs({"autoScriptStylingDefault":stylingDefault});

	}

	});
});

/* AutoScript editor open button */
on("clicked:autoScriptEdit", function(info) {	
	let newEditorTarget = info.htmlAttributes.id;
	getAttrs([`${newEditorTarget}`,"autoScriptEditorTarget", "autoScriptEditorInput"], function(values) {
		let oldEditorTarget = values.autoScriptEditorTarget;
		let newEditorInput = values[`${newEditorTarget}`];
		let oldEditorInput = values.autoScriptEditorInput;
		setAttrs({
			[oldEditorTarget]: oldEditorInput,
			autoScriptEditorInput: newEditorInput,
			autoScriptEditorTarget: newEditorTarget,
			autoScriptEditor_display: "true"
		});
	});
});
/* AutoScript editor save button */
function saveAutoScriptEditor() {
	getAttrs(["autoScriptEditorTarget", "autoScriptEditorInput"], function(values) {
		let editorTarget = values.autoScriptEditorTarget;
		let editorInput = values.autoScriptEditorInput;

		if (editorTarget != "") {
			setAttrs({
				[editorTarget]: editorInput
			});
		}
	});
}
on("clicked:saveAutoScriptEdit", function(info) {
	saveAutoScriptEditor();
});
/* AutoScript editor close button */
on("clicked:closeAutoScriptEdit", function(info) {
	saveAutoScriptEditor();
	setAttrs({
		autoScriptEditor_display: "0",
		autoScriptEditorTarget: ""
	});
});
/* AutoScript editor reset styling to default button */
on("clicked:autoScriptStylingDefault", async function(info) {
	let queryResults = await sendQuery(["userConfirmation",
		getTranslationByKeyCustom("Are you certain you want to reset back to the default AutoEffect styling settings? This action can not be reversed", "query-reset-styling"), {
			[getTranslationByKeyCustom("No","query-no")]:"false",
			[getTranslationByKeyCustom("Yes","query-yes")]:"true"
		}
	]);

	if (queryResults.userConfirmation == "true") {
		loadDefaultAutoScriptStyling();
	}
});
function loadDefaultAutoScriptStyling() {
	getAttrs(["autoScriptStylingDefault", "autoScriptEditorTarget"], function(values) {
		let stylingDefault = values.autoScriptStylingDefault;
		let editorTarget = values.autoScriptEditorTarget;
		
		let output = {autoScriptStyling: stylingDefault}
		
		// Only modifies the editor input if autoScriptStyling is currently open in the editor
		// Avoids issues with styling rules being applied to other AutoScripts
		if (editorTarget == "autoScriptStyling") {
			output.autoScriptEditorInput = stylingDefault;
		}
		
		setAttrs(output);
	});
}

/* Executes a conditional button. Hides the button if at least one check fails */
/* Also hides the button if a Consume check would fail after using the button again */
on("clicked:repeating_conditionalButtons:activate", function(info) {
	let buttonid = info.sourceAttribute.split("_")[2];
	let buttonAutoScript = "";
	let buttonName = "";

	getAttrs([`repeating_conditionalButtons_${buttonid}_buttonAutoScript`, `repeating_conditionalButtons_${buttonid}_buttonName`], function(values) {
	buttonAutoScript = values[`repeating_conditionalButtons_${buttonid}_buttonAutoScript`];
	buttonName = values[`repeating_conditionalButtons_${buttonid}_buttonName`];

	AutoScriptMain(buttonAutoScript, "None", "false", "true", { targetmode: "false" }, function(returnValues) {
		if (returnValues.checkResult != "success") {
			removeRepeatingRow("repeating_conditionalButtons_" + buttonid)
		}
	}, buttonName);
	});
});

/* Main function for using AutoScripts. Called by actions through on click events */
/* inputAutoScript: AutoScript provided by the action. Can be an empty string */
/* trigger: "Combat start", "Round start", "Permanent", "Damaged", "DamagedHP", "DamagedST", "DamagedSP",
"Staggered", "Defeated", "Panic", "Challenge", "Offensive", "Defensive", "Block", "Evade" or "None".
Selects which type of AutoEffects to collect and append to an AutoScript.
Block and Evade also include Defensive */
/* collect: If the function should collect augment/outfit/etc. AutoEffects or not */
/* sendMessage: If true, the function print a standard chat message */
/* callback: Function to be run on returnValues. Defaults to an empty function */
/* messageHeaderTitle: Title of the standard chat message printed by the function */
function AutoScriptMain(inputAutoScript, triggerType="None", collect="true", sendMessage="true", overrideList={}, callback=() => {}, messageHeaderTitle=getTranslationByKeyCustom("AutoEffects", "autoeffect-title")) {
	
	/* If using generic token mode, switches to the correct token before applying incoming AutoEffects */
	let tokenId = (overrideList.tokenId != undefined) ? overrideList.tokenId : "";
	changeActiveToken(tokenId, () => {
	
	/* Adds the input AutoScript */
	let AutoScript = "";
	if (inputAutoScript != "") {
		AutoScript = inputAutoScript;
	}
	
	/* Appends one or more AutoScripts based on the trigger type */
	let autoScriptTriggers = [];
	if (collect == "true") {
		if (typeof triggerType == "string") { autoScriptTriggers.push(triggerType) }
		else {autoScriptTriggers.push(...triggerType) }
		if (triggerType != "None") {
			if (autoScriptTriggers.includes("Block") || autoScriptTriggers.includes("Evade")) {
				autoScriptTriggers.push("Defensive");
			}
			else if (autoScriptTriggers.includes("Combat start")) {
				autoScriptTriggers.push("Round start");
			}
			else if (autoScriptTriggers.some(item => ["DamagedHP", "DamagedST", "DamagedSP"].includes(item))) {
				autoScriptTriggers.push("Damaged");
			}
		}
		if (!autoScriptTriggers.includes("Permanent")) {
			autoScriptTriggers.push("Permanent")
		}
	}

	let autoScriptList = ["weapon1", "weapon2", "weapon3", "weapon4", "augment", "outfit", "ego", "tool1", "tool2", "tool3", "tool4", "special1", "special2",
	"skill1", "skill2", "skill3", "skill4", "skill5", "skill6", "egoSkill1", "egoSkill2", "egoSkill3", "egoSkill4", "egoSkill5", "egoSkill6"];
	autoScriptList = autoScriptList.map(prefix => prefix + "AutoScript");
	
	getAttrs([...autoScriptList, "distortState", "egoActiveState", "isFirstRound"], function(values) {
		
		let collectedAutoScripts = "";
		autoScriptList.forEach(autoScript => {

			/* Finds all substrings that begin with "[#" and end with "#]" */
			if (autoScript.includes("ego") && !(values.distortState == "true" || values.egoActiveState == "true")) {
				return;
			}
			if ((/\[([#][^]+[#])\]/g).test(values[`${autoScript}`])) {
				collectedAutoScripts += values[`${autoScript}`].match(/\[([#][^]+[#])\]/g);
			}
		});
		collectedAutoScripts = parseAutoScript(collectedAutoScripts, "nested");

		let firstRound = getTranslationByKeyCustom("#First round", "autoeffect-option-firstround")

		collectedAutoScripts.forEach((trigger) => {
			
			/* Accept #First round triggers if it is currently the first round. Otherwise discard them */
			if (trigger[0].includes(firstRound) && values.isFirstRound == "true") { trigger[0] = trigger[0].replace(firstRound,"").trim(); }

			if (autoScriptTriggers.includes(getTriggerFromTranslation(trigger[0]))) {
				if (AutoScript != "") { AutoScript += "(Reset)"; }
				AutoScript += trigger[1];
			}
		});

	/* Convert AutoScript to an array */
	AutoScript = parseAutoScript(AutoScript);

	/* Translates AutoEffect names, bars and ailments to English */
	AutoScript = translateAutoScriptToEnglish(AutoScript);

	/* Get relevant attributes */
	getAttrs(["settingMuteMessage", "settingWhisperRolls", "settingWhisperTarget", "settingLimbusStyle", "settingHideNextTurn",
	"settingCollapseAutoEffectSections", "settingHideConditionalButtonReminder", "targetTokenId", //"settingTargetMode",
	"HP", "HP_max", "StagRes", "StagRes_max", "SP", "SP_max", "Light", "Light_max", "thisRoundSpeed", "nextRoundSpeed", 
	"StaggerState", "distortState", "egoActiveState", "egoType", "autoScriptStyling",
	"THP_Sources", "TST_Sources", "targetAilmentList", "targetBarList", "targetBarDamageList"], function(values) {
		
		let settingMuteMessage = values.settingMuteMessage;
		let settingWhisperRolls = values.settingWhisperRolls;
		let settingWhisperTarget = values.settingWhisperTarget;
		let settingLimbusStyle = values.settingLimbusStyle;
		let settingHideNextTurn = values.settingHideNextTurn;
		let settingCollapseSections = values.settingCollapseAutoEffectSections;
		let settingConditionalButtonReminder = values.settingHideConditionalButtonReminder;

		let targetTokenId = values.targetTokenId;
		//let targetmode = values.settingTargetMode;
		//if (overrideList.targetmode != undefined) { targetmode = overrideList.targetmode; }

		let HP = values.HP;
		let ST = values.StagRes;
		let SP = values.SP;
		let Light = values.Light;
		let barList = { HP: parseInt(HP), ST:parseInt(ST), SP:parseInt(SP), Light:parseInt(Light), THP:0, TST:0 };
		let HPdamage = values.HP_max - HP;
		let STdamage = values.StagRes_max - ST;
		let SPdamage = values.SP_max - SP;
		let LightExpended = values.Light_max - Light;
		let barDamageList = { "-HP": HPdamage, "-ST":STdamage, "-SP":SPdamage, "-Light":LightExpended }

		let targetAilmentList = (values.targetAilmentList != undefined && values.targetAilmentList != "") ? Data.unpackage(values.targetAilmentList) : {};
		let targetBarList = (values.targetBarList != undefined && values.targetBarList != "") ? Data.unpackage(values.targetBarList) : {};
		let targetBarDamageList = (values.targetBarDamageList != undefined  && values.targetBarDamageList != "") ? Data.unpackage(values.targetBarDamageList) : {};

		let THP_Sources = (values.THP_Sources != "" && values.THP_Sources != "{}") ? JSON.parse(values.THP_Sources) : "";
		if (THP_Sources.AutoEffects != undefined) { barList.THP = THP_Sources.AutoEffects[0]; }
		let TST_Sources = (values.TST_Sources != "" && values.TST_Sources != "{}") ? JSON.parse(values.TST_Sources) : "";
		if (TST_Sources.AutoEffects != undefined) { barList.TST = TST_Sources.AutoEffects[0]; }

		let thisRoundSpeed = parseInt(values.thisRoundSpeed);
		let nextRoundSpeed = parseInt(values.nextRoundSpeed);
		
		let StaggerState = values.StaggerState;
		let distortState = values.distortState;
		let egoActiveState = values.egoActiveState;
		let egoType = values.egoType;
		
		let scaling = 1;
		let checkResult = "success";
		let autoEffectType = "standard";
		let autoBuffer = "";

		let autoEffectConditional = "";
		let conditionalMessageList = {};
		let conditionalButtonList = {};
		let conditionalButtonSilent = "";
		let errorMessageList = {};
		
		let stylingList = parseAutoScriptStyling(values.autoScriptStyling);
		
		let output = {};
		let tempOutput = {};
		let returnValues = { checkResult:"success", error:false };
		let challengeRollList = {};
		let procAilmentList = {};
		let message = "";
		let messageValues = {};
		
	/* Get all ailments */
	exportAilmentList(overrideList, function(ailmentList) { 
	// console.log(ailmentList)

	/* If targeting is in use, update target ailments and bars */
	updateTargetAilmentList(returnListAilment => {
	if (returnListAilment != undefined) {
		targetAilmentList = returnListAilment;
	}
	updateTargetBarLists(returnListBars => {
	if (returnListBars != undefined) {
		targetBarList = returnListBars.targetBarList;
		targetBarDamageList = returnListBars.targetBarDamageList;
	}


	/* Execute each AutoEffect in the AutoScript */
	AutoScript.forEach(AutoEffect => {
	if (AutoEffect == undefined) {
		return;
	}

	/* Handle conditionals */
	if (AutoEffect.length > 1) {
		AutoEffect.slice(1).forEach(conditional => {
			
			/* Reset if new conditional doesn't match previous one */
			if (conditional.replaceAll("#Section","").trim() != autoEffectConditional) {
				scaling = 1; checkResult = "success";
			}

			/* If action buttons are requested, execute the script as if it was unconditional but add the effects to a seperate section */
			if (conditional.includes("#Section")) {
				autoEffectConditional = conditional.replaceAll("#Section","").trim();
				autoEffectType = "section";
			}
			/* If conditional buttons are requested, do not execute any conditional AutoEffects and store them in conditional buttons to be executed later */
			else {
				autoEffectConditional = conditional.replaceAll("#Conditional","").trim();
				autoEffectType = "conditional";

				if (conditionalButtonList.hasOwnProperty(autoEffectConditional)) {
					conditionalButtonList[autoEffectConditional] += " (" + AutoEffect[0].join(" ") + conditionalButtonSilent + ")";
				} else {
					conditionalButtonList[autoEffectConditional] = "(" + AutoEffect[0].join(" ") + conditionalButtonSilent + ")";
				}
			}

			/* If AutoEffect is Require or Consume, do not display the button if the check will fail */
			if (AutoEffect[0][0] == "Require" || AutoEffect[0][0] == "Consume") {
				switch (AutoEffect[0][0]) {
					case "Require": tempOutput = autoEffectRequire(AutoEffect[0], ailmentList, barList, barDamageList, targetAilmentList, targetBarList, targetBarDamageList, settingLimbusStyle); break;
					case "Consume": tempOutput = autoEffectConsume(AutoEffect[0], ailmentList, barList, targetAilmentList, targetBarList, settingLimbusStyle, autoEffectType); break;
					default: tempOutput = {}; break;
				}
				if (tempOutput.checkResult == "failure") {
					conditionalButtonList[autoEffectConditional] = "#Do not display#";
				}
			}
		});
	} else {
		if (autoEffectType != "standard") {
			scaling = 1; checkResult = "success";
		}
		autoEffectType = "standard";
		autoEffectConditional = "";
	}
	if (autoEffectType != "conditional") {
		/* Checks and Reset are always processed. Other AutoEffects are not processed if the last check failed */
		switch (AutoEffect[0][0]) {
			case "Require": tempOutput = autoEffectRequire(AutoEffect[0], ailmentList, barList, barDamageList, targetAilmentList, targetBarList, targetBarDamageList, settingLimbusStyle); break;
			case "Consume": tempOutput = autoEffectConsume(AutoEffect[0], ailmentList, barList, targetAilmentList, targetBarList, settingLimbusStyle, autoEffectType); break;
			case "Reset": tempOutput = autoEffectReset(AutoEffect[0]); break;
			case "CustomMessage": tempOutput = autoEffectCustomMessage(AutoEffect[0], messageValues); break;
			default: tempOutput = {}; break;
		}
		if (checkResult != "failure") {
			switch (AutoEffect[0][0]) {
				case "Require": case "Consume": case "Reset": case "CustomMessage": break; /* Already executed above */
				case "Gain": tempOutput = autoEffectAilment(AutoEffect[0], ailmentList, scaling, settingLimbusStyle, autoEffectType); break;
				case "Inflict": tempOutput = autoEffectAilment(AutoEffect[0], ailmentList, scaling, settingLimbusStyle); break;
				case "Give": tempOutput = autoEffectAilment(AutoEffect[0], ailmentList, scaling, settingLimbusStyle); break;
				case "Set": tempOutput = autoEffectSetBar(AutoEffect[0], barList, scaling); break;
				case "Add": tempOutput = autoEffectAddBar(AutoEffect[0], barList, scaling, autoEffectType); break;
				case "Multi": tempOutput = autoEffectMultiBar(AutoEffect[0], barList, scaling); break;
				case "DicePower": tempOutput = autoEffectDice(AutoEffect[0], scaling); break;
				case "DiceMax": tempOutput = autoEffectDice(AutoEffect[0], scaling); break;
				case "DiceCount": tempOutput = autoEffectDice(AutoEffect[0], scaling); break;
				case "BaseDamage": tempOutput = autoEffectDamage(AutoEffect[0], barList, scaling); break;
				case "FlatDamage": tempOutput = autoEffectDamage(AutoEffect[0], barList, scaling); break;
				case "Proc": tempOutput = autoEffectProc(AutoEffect[0], ailmentList, scaling, settingLimbusStyle); break;
				case "Pause": tempOutput = autoEffectPause(AutoEffect[0], ailmentList, scaling, settingLimbusStyle); break;
				case "ChallengeRoll": tempOutput = autoEffectChallengeRoll(AutoEffect[0], scaling); break;
				case "Speed": tempOutput = autoEffectSpeed(AutoEffect[0], scaling, thisRoundSpeed, nextRoundSpeed); break;
				default: tempOutput = autoEffectErrorMessage("Invalid AutoEffect", `${AutoEffect[0][0].replace("Unknown: ","")} is not a valid AutoEffect`, AutoEffect[0]); break;
			}
		}
		// console.log(tempOutput)
			
			/* Handle errors. Continues executing AutoEffects for the sake of finding additional errors, */
			/*  but does not apply any changes to attributes */
			if (tempOutput.hasOwnProperty("error") || returnValues.error == true) {
				if (tempOutput.errorType != undefined) {
					if (errorMessageList[tempOutput.errorType] != undefined) {
						errorMessageList[tempOutput.errorType] += "\n" + tempOutput.errorMessage;
					} else {
						errorMessageList[tempOutput.errorType] = tempOutput.errorMessage;
					}
				}
				
				if (returnValues.error != true) {
					returnValues.error = tempOutput.error;
				}
				output = {};
				return;
			}

			/* Handle changes to scaling */
			if (tempOutput.hasOwnProperty("scaling")) {
				scaling = parseInt(tempOutput.scaling);
				delete tempOutput.scaling;
			}

			/* Handle check results from Require and Consume */
			/* For the returnValues, the worst result is returned */
			if (tempOutput.checkResult != undefined) {
				checkResult = tempOutput.checkResult;
				if (returnValues.checkResult == "success") {
					returnValues.checkResult = tempOutput.checkResult;
				}
				else if (returnValues.checkResult == "last success" && tempOutput.checkResult == "failure") {
					returnValues.checkResult = tempOutput.checkResult;
				}
				delete tempOutput.checkResult;
			}

			/* Handle updating ailmentList and barList after a successful AutoEffect */
			/* If a target is not selected, an error will be thrown instead. May change this behaviour in the future */
			if (tempOutput.modifyList != undefined) {
				if (tempOutput.modifyList.includes("barList")) {
					if (tempOutput.modifyList.includes("target")) {
						targetBarList[tempOutput.modifyTarget] = parseInt(targetBarList[tempOutput.modifyTarget]) + parseInt(tempOutput.modifyVal);
					} else {
						barList[tempOutput.modifyTarget] = parseInt(barList[tempOutput.modifyTarget]) + parseInt(tempOutput.modifyVal);
					}
				} else {
					let targetIndex = 1;
					if (tempOutput.modifyNextTurn != undefined && tempOutput.modifyNextTurn == "true") {
						targetIndex = 2;
					}
					if (tempOutput.modifyList.includes("target")) {
						targetAilmentList[tempOutput.modifyTarget][targetIndex] = parseInt(targetAilmentList[tempOutput.modifyTarget][targetIndex]) + parseInt(tempOutput.modifyVal);
					} else {
						ailmentList[tempOutput.modifyTarget][targetIndex] = parseInt(ailmentList[tempOutput.modifyTarget][targetIndex]) + parseInt(tempOutput.modifyVal);
					}
				}
				delete tempOutput.modifyList;
				delete tempOutput.modifyTarget;
				delete tempOutput.modifyNextTurn;
				delete tempOutput.modifyVal;
			}

			/* Handle DicePower, DiceMax, DiceCount, Speed with Combat duration, */
			/* BaseDamage, FlatDamageHP, FlatDamageST and FlatDamageSP */
			/* FlatDamageLight and Light (combatRoll, declareAction and action buttons need Light added/consumed by AutoEffects to update the Light count properly) */
			let effectList = ["dicePower", "diceMax", "diceCount", "speedCombat", "baseDamage", "baseDamageHP",
			"baseDamageST" , "flatDamageHP", "flatDamageST", "flatDamageSP", "flatDamageLight", "Light"];
			effectList.forEach(effect => {
				if (tempOutput[effect] != undefined) {
					if (returnValues[effect] != undefined) { returnValues[effect] += tempOutput[effect] }
					else { returnValues[effect] = tempOutput[effect] }
					if (effect != "Light") {
						delete tempOutput[effect];
					}
				}
			});

			/* Handle target options for Reset and CustomMessage */
			effectList = ["autoReset", "autoCustomMessage"];
			effectList.forEach(effect => {
				if (tempOutput[effect] != undefined) {
					if (autoEffectConditional == "") {
						autoBuffer += tempOutput[effect];
					}
					delete tempOutput[effect];
				}
			});

			/* Handle Inflict, Give and FlatDamage (for non-attacks) */
			/* Also handles Consume on the Target, which counts as autoInflict for both bars and ailments (will change this later) */
			effectList = ["autoInflict", "autoGive", "autoDamage"];
			effectList.forEach(effect => {
				if (tempOutput[effect] != undefined) {
					if (autoBuffer != "") {
						tempOutput[effect] = autoBuffer + tempOutput[effect];
						autoBuffer = "";
					}
					if (autoEffectConditional == "") {
						if (returnValues[effect] != undefined) { returnValues[effect] += tempOutput[effect] }
						else { returnValues[effect] = tempOutput[effect] }
					} else {
						if (returnValues[`${effect} (${autoEffectConditional})`] != undefined) { returnValues[`${effect} (${autoEffectConditional})`] += tempOutput[effect] }
						else { returnValues[`${effect} (${autoEffectConditional})`] = tempOutput[effect] }
					}
					delete tempOutput[effect];
				}
			});

			/* Handle challenge rolls */
			if (tempOutput.challengeRollStat != undefined) {
				challengeRollList[tempOutput.challengeRollStat] = tempOutput.challengeRollDifficulty;
				delete tempOutput.challengeRollStat;
				delete tempOutput.challengeRollDifficulty;
			}

			/* Handle proc ailment */
			if (tempOutput.procAilment != undefined) {
				if (procAilmentList[tempOutput.procAilment] != undefined) {
					procAilmentList[tempOutput.procAilment] += 1;
				} else { procAilmentList[tempOutput.procAilment] = 1; }
				delete tempOutput.procAilment;
			}

			/* Handle message */
			if (tempOutput.message != undefined) {
				/* Translate output message. Targets are still written in English */
				if (autoEffectType != "section") {
					message += autoEffectTranslateMessage(tempOutput.message);
				} else {
					if (conditionalMessageList[autoEffectConditional] != undefined) {
						conditionalMessageList[autoEffectConditional] += autoEffectTranslateMessage(tempOutput.message);
					} else {
						conditionalMessageList[autoEffectConditional] = autoEffectTranslateMessage(tempOutput.message);
					}
				}
			}

			/* Handle messageValues. Used by the CustomMessage AutoEffect. Outputted by all AutoEffects that generate messages */
			if (tempOutput.messageValues != undefined) {
				messageValues = tempOutput.messageValues;
				delete tempOutput.messageValues;
			}

			/* Handle temporary HP and ST */
			effectList = ["THP", "TST"];
			effectList.forEach(effect => {
				if (tempOutput[effect] != undefined) {
					updateTempBar(effect, "AutoEffects", tempOutput[effect], "None", `AutoEffects ${effect}`, "icons", "gear", "true");
					delete tempOutput[effect];
				}
			});
			
			/* Add attribute changes from AutoEffect to output */
			/* The first time a attribute is modified, add its count */
			/* For example, if Gain 3 Burn is used and current Burn is 2, output Burn is set to 5 */
			/* If Consume 4 Burn is used later, this amount will be removed without adding count */
			for (const property in tempOutput) {
				if (property != "count") {
					if (output.hasOwnProperty(property)) {
						output[property] += Math.floor(tempOutput[property]);
					} else {
						output[property] = Math.floor(tempOutput[property] + tempOutput.count);
					}
				}
			}
		}
	});
	
	/* Create conditional buttons */
	let conditionalAlert = "";
	for (const [buttonName, buttonAutoScript] of Object.entries(conditionalButtonList)) {
		/* Checks if any checks failed and the button should not be displayed */
		if (buttonAutoScript.indexOf("#Do not display#") != -1) { continue; }
		
		let iconFolder = "icons";
		let iconName = "gear";
		let iconColor = "green"; 
		if (stylingList[buttonName] != undefined) {
			iconFolder = stylingList[buttonName][0];
			iconName = stylingList[buttonName][1];
			iconColor = stylingList[buttonName][2];
			if (!["green","blue","red","orange","yellow","purple","black"].includes(iconColor)) { iconColor = "green"; }
		}
		createConditionalButton(buttonName, buttonAutoScript, iconFolder, iconName, iconColor);
		if (conditionalAlert != "") { conditionalAlert += ", "}
		conditionalAlert += buttonName;
	}
	if (conditionalAlert != "" && settingConditionalButtonReminder != "true") {
		message += `<div class="autoeffectEntry">${getIcon("icons","whisper","false","class=autoEffectImage")}<b>Created conditional buttons:</b><br> ${conditionalAlert}</div>`
	}

	/* Execute challange rolls */
	for (const [statName, rollDifficulty] of Object.entries(challengeRollList)) {
		/* Checks if any checks failed and the button should not be displayed */
		rollChallenge(statName, rollDifficulty, "false");
	}

	/* Execute proc effects */
	for (const [ailmentName, procCount] of Object.entries(procAilmentList)) {
		for (let i = 0; i < procCount; i++) {
			if (ailmentName[0] == "-") { /* If custom ailment */
				updateCustomAilment(ailmentName, "standard", "false");
			} else if (ailmentName == "Bleed") { /* If Bleed */
				updateBleed();
			} else { /* If standard ailment */
				updateAilments([ailmentName]);
			}
		}
	}
	
	/* Message handling */
	/* Standard messages print as a generic "AutoEffects" section and include all unconditional effects */
	if (returnValues.error != true && message != "") {
		if (sendMessage == "false") {
			returnValues.message = autoEffectSection("AutoEffects", message, settingCollapseSections);
		}
	}

	/* Conditional message handling */
	/* One conditional message section is printed for each conditional in the AutoScript */
	for (const [conditionName, conditionMessage] of Object.entries(conditionalMessageList)) {
		let iconFolder = "icons";
		let iconName = "gear";
		let iconColor = "#85a874"; 
		if (stylingList[conditionName] != undefined) {
			iconFolder = stylingList[conditionName][0];
			iconName = stylingList[conditionName][1];
			iconColor = stylingList[conditionName][2];
		}
		
		if (returnValues.message == undefined) {
			returnValues.message = autoEffectSection(conditionName, conditionMessage, settingCollapseSections, iconFolder, iconName, getColor(iconColor));
		} else {
			returnValues.message += autoEffectSection(conditionName, conditionMessage, settingCollapseSections, iconFolder, iconName, getColor(iconColor));
		}
	}

	/* Error handling  */
	if (returnValues.error == true) {
		returnValues.message = "";
		
		/* Error message */
		for (const [errorType, errorMessage] of Object.entries(errorMessageList)) {
			if (errorType)
			if (returnValues.message == undefined) {
				returnValues.message = autoEffectSection(errorType, errorMessage, settingCollapseSections, "icons", "exit", getColor("Red"));
			} else {
				returnValues.message += autoEffectSection(errorType, errorMessage, settingCollapseSections, "icons", "exit", getColor("Red"));
			}
		}
		resetConditionals();
	}

	/* If a message is to be sent, print all unconditional and conditional sections in one chat message. Attach any action buttons that exist for the AutoScript */
	if (settingMuteMessage != "true" && sendMessage == "true" && !((message == undefined || message == "") && (returnValues.message == undefined || returnValues.message == ""))) {
		
		/* Get AutoScript styling */
		let iconFolder = "icons";
		let iconName = "gear";
		let iconColor = "#85a874"; 
		if (stylingList[messageHeaderTitle] != undefined) {
			iconFolder = stylingList[messageHeaderTitle][0];
			iconName = stylingList[messageHeaderTitle][1];
			iconColor = stylingList[messageHeaderTitle][2];
		}
		let messageHeaderIcon = getIcon(iconFolder, iconName, "false", `style="background-color: ${getColor(iconColor)}"`);

		/* Prepare unconditional and conditional sections into one message block */
		if (message == undefined) { message = ""; }
		if (returnValues.message == undefined) { returnValues.message = ""; }
		let messageContents = "<div class='autoeffectContainer'>" + message + returnValues.message + "</div>";
		
		/* Collapse sections if the setting is enabled */
		if (settingCollapseSections == "true") {
			messageContents = messageContents.replaceAll("autoeffectContainer'>", "autoeffectContainer collapseSection'><div class='arrow'></div>")
		}
		
		let whisper = "";
		if(settingWhisperRolls == "true"){
			whisper = "/w " + settingWhisperTarget;
		}
		
		/* Post the message to the chat */
		setAttrs({dummyIcon: messageHeaderIcon, dummy: messageContents});
		startRoll((whisper + "&{template:autoeffect} {{icon=@{dummyIcon}}} {{title=" + messageHeaderTitle + "}} {{name=@{character_name}}} {{message=@{dummy} }}"), (results) => {
			finishRoll(results.rollId, {} );
		
			/* Attach any action buttons that have been created for the AutoScript*/
			let buttonList = [];
			let giveButtonList = [];
			for (const [buttonKey, buttonValue] of Object.entries(returnValues)) {
				if (buttonKey.startsWith("auto")) {
					switch (buttonKey.split(" ")[0]) {
						case "autoDamage": buttonList.push(generateActionButton(buttonKey, getIcon("icons","damage"), "red", "actionButtonDamage", {AutoScript: buttonValue, targetTokenId: targetTokenId})); break;
						case "autoInflict": buttonList.push(generateActionButton(buttonKey, getIcon("icons","lose"), "purple", "actionButtonInflict", {AutoScript: buttonValue, targetTokenId: targetTokenId})); break;
						case "autoGive": giveButtonList.push(generateActionButton(buttonKey, getIcon("icons","win"), "blue", "actionButtonGive", buttonValue, "selected")); break;
					}
				}
			}
			createActionButtons(buttonList);
			createActionButtons(giveButtonList, "selected");
		});
	}

	setAttrs(output);
	callback(returnValues);
	});
	});
	});
	});
	});
	});
}

/* Removes all newline and tab characters as well as JavaScript comments from an AutoScript */
function cleanAutoScript(AutoScript) {

	/* Remove all newlines and tab spaces */
	let cleanAutoScript = AutoScript.replace(/(\r\n|\n|\r|\t)/gm, "");

	/* Remove all comments */
	cleanAutoScript = cleanAutoScript.replace(/\/\*[\s\S]*?\*\/|(?<=[^:])\/\/.*|^\/\/.*/g,'');

	/* Remove all spaces between AutoEffects ex. )    ( -> )( */
	cleanAutoScript = cleanAutoScript.replace(/\)( +)\(/g,')(')

	/* Replace all “” quotes with "" quotes */
	cleanAutoScript = cleanAutoScript.replaceAll('“','"').replaceAll('”','"');

	/* Remove any of the old v0.6 options that still remain in the AutoScript */
	cleanAutoScript = cleanAutoScript.replaceAll("#MessageButton","").replaceAll("#Button","").replaceAll("#Message","#Section").trim();

	/* Replace Stagger_Protection with StaggerProtection. The space is added to avoid affecting image links */
	cleanAutoScript = cleanAutoScript.replaceAll(' Stagger_Protection',' StaggerProtection');

	return cleanAutoScript;
}

/* Converts an AutoScript from a string to an array */
/* mode: normal is for strings of type (AutoEffect...) (AutoEffect...) ... */
/* mode: nested is for strings of type [#Offensive, (AutoEffect...) ... #] [#Round start, (AutoEffect...) ... ]*/
function parseAutoScript(inputAutoScript, mode="normal") {
	let AutoScript = inputAutoScript;
	let AutoEffect = "";
	let AutoEffectArray = [];
	let AutoScriptArray = [];

	let beginChar = "(";
	let middleChar = ")("
	let endChar = ")";
	let charOffset = 1;

	if (mode == "nested") {
		beginChar = "[#";
		middleChar = "#][#";
		endChar = "#]";
		charOffset = 2;
	}

	AutoScript = cleanAutoScript(AutoScript);

	do {
		AutoScript = AutoScript.trim();

		/* Checks if an AutoEffect still remains in the AutoScript */
		if (AutoScript.indexOf(beginChar) == 0 && AutoScript.indexOf(endChar)) {

			/* Removes the next AutoEffect from the AutoScript. Removes the parentheses */
			if (AutoScript.indexOf(middleChar) != "-1") {
				AutoEffect = AutoScript.substring(charOffset, AutoScript.indexOf(middleChar));
				AutoScript = AutoScript.substring(AutoScript.indexOf(middleChar)+charOffset);
			} else {
				AutoEffect = AutoScript.substring(charOffset, AutoScript.length-charOffset);
				AutoScript = "";
			}
			
			/* Structures the AutoEffect into an array and stores it */
			if (mode == "nested") {
				AutoEffect = AutoEffect.trim().replace(",","£");
				AutoEffectArray = AutoEffect.split("£");
				AutoEffectArray = AutoEffectArray.map(e => e.trim());
			} else {
				/* For CustomMessage AutoScripts, preserve commas in the messages format by extracting the format before splitting over "," */
				if (AutoEffect.includes("CustomMessage")) {
					if (AutoEffect.lastIndexOf(",") > AutoEffect.lastIndexOf('"')) {
						AutoEffectArray = AutoEffect.trim().split(",");
					} else {
						let messageFormat = AutoEffect.match(/"(.*?)"/g);
						AutoEffect = AutoEffect.replace(/"(.*?)"/g,"£").replace(",","").trim();
						AutoEffectArray = [AutoEffect.replace("£", messageFormat)];
					}
				} else {
					AutoEffectArray = AutoEffect.trim().split(",");
				}
				//AutoEffectArray = AutoEffectArray.map(e => e.trim());
				AutoEffectArray[0] = AutoEffectArray[0].split(/\s+/);
			}

			AutoScriptArray.push(AutoEffectArray);
		} else {
			break;
		}
	} while (AutoScript.length > 1)

	/* Return the converted AutoScript */
	return AutoScriptArray;
}

function translateAutoScriptToEnglish(AutoScript) {
	for (let i = 0; i < AutoScript.length; i++) {
		/* Translate AutoEffect names */
		AutoScript[i][0][0] = getAutoEffectFromTranslation(AutoScript[i][0][0]);
	
		/* Translate Ailments and Bars */
		switch (AutoScript[i][0][0]) {
			case "Reset": case "CustomMessage": case "DicePower": case "DiceMax": case "DiceCount": case "BaseDamage": break;
			case "Require": case "Consume": AutoScript[i][0][2] = getAilmentOrBarFromTranslation(AutoScript[i][0][2]); break;
			case "Gain": case "Inflict": case "Give": case "Pause": AutoScript[i][0][2] = getAilmentFromTranslation(AutoScript[i][0][2]); break;
			case "Set": case "Add": case "Multi": case "FlatDamage": AutoScript[i][0][2] = getBarFromTranslation(AutoScript[i][0][2]); break;
			case "ChallengeRoll": AutoScript[i][0][1] = getStatFromTranslation(AutoScript[i][0][1]); break;
			case "Proc": AutoScript[i][0][1] = getAilmentFromTranslation(AutoScript[i][0][1]); break;
			default: console.log("Translation error with AutoEffect name " + AutoScript[i][0][0])
		}

		/* Translate Options */
		for (let j = 0; j < AutoScript[i][0].length; j++) {
			if(getOptionFromTranslation(AutoScript[i][0][j]) != "Unknown: " + AutoScript[i][0][j]) {
				AutoScript[i][0][j] = getOptionFromTranslation(AutoScript[i][0][j]);
			}
		}

		/* Translate conditional options */
		let langButtonOption = getTranslationByKeyCustom("#Button", "autoeffect-option-button");
		let langMessageOption = getTranslationByKeyCustom("#Message", "autoeffect-option-message");
		let langMessageButtonOption = getTranslationByKeyCustom("#MessageButton", "autoeffect-option-messagebutton");

		for (let k = 1; k < AutoScript[i].length; k++) {
			AutoScript[i][k] = AutoScript[i][k].replace(langButtonOption,"#Button");
			AutoScript[i][k] = AutoScript[i][k].replace(langMessageOption,"#Message");
			AutoScript[i][k] = AutoScript[i][k].replace(langMessageButtonOption,"#MessageButton");
		}
	}
	return AutoScript;
}

function parseAutoScriptStyling(AutoScriptStyling) {
	let stylingList = {};
	let stylingRule = "";

	/* Remove all newlines, tab spaces and comments */
	AutoScriptStyling = cleanAutoScript(AutoScriptStyling);

	do {
		AutoScriptStyling = AutoScriptStyling.trim();

		/* Checks if an styling rule still remains in the AutoScript */
		if (AutoScriptStyling.indexOf("(") == 0 && AutoScriptStyling.indexOf(")")) {

			/* Removes the next styling rule from the string. Removes the parentheses */
			stylingRule = AutoScriptStyling.substring(1, AutoScriptStyling.indexOf(")"));
			AutoScriptStyling = AutoScriptStyling.substring(AutoScriptStyling.indexOf(")")+1);

			stylingRule = stylingRule.trim().split(",");
			stylingRule = stylingRule.map(e => e.trim());

			stylingList[stylingRule[0]] = [stylingRule[1], stylingRule[2], stylingRule[3]];
		} else {
			break;
		}
	} while (AutoScriptStyling.length > 1)

	/* Return the styling list */
	return stylingList;
}
/*--- AutoScript functions end ---*/




/*--- AutoEffect functions ---*/
function autoEffectEntry(message) {
	return "<div class='autoeffectEntry'>" + message + "</div>";
}
function autoEffectSection(header, message, collapseSections, iconFolder="icons", iconName="gear", iconColor="#85a874") {
	let newEntry  = "<div class='autoeffectContainer'>"
		newEntry += `<div style="background-color: #222; height: 25px; border: 2px #000 solid; color: #fff">`
		newEntry += `<div style="float: left; height: 25px; width: 25px; margin-right: 7px; background-color: ${iconColor};">`
		newEntry += `${getIcon(iconFolder, iconName)}`
		newEntry += `</div>`;
		newEntry += `<div class="autoEffectTitle" style="overflow: hidden ; height: 20px ; padding-top: 5px ; float: left"><b>${header}</b></div>`
		newEntry += `</div>` + message + "</div>";
	if (collapseSections == "true") {
		newEntry = newEntry.replaceAll("autoeffectContainer'>", "autoeffectContainer collapseSection'><div class='arrow'></div>")
	}

	return newEntry;
}

function autoEffectMessage(messageFormat, effectTarget="No target", effectVal=0, effectCount=0, scaling=1, checkResult="success", settingLimbusStyle="false", effectIcon="No icon", iconColor=undefined) {
	if(messageFormat != ""){
		let message = messageFormat;

		let langCheck = getTranslationByKeyCustom("[CHECK]", "autoeffect-match-check");
		let langSuccess = getTranslationByKeyCustom("Success", "distort-results-good");
		let langFailure = getTranslationByKeyCustom("Failure", "distort-results-bad");
		let langNoTarget = getTranslationByKeyCustom("No target", "autoeffect-alert-notarget");
		let langNum = getTranslationByKeyCustom("[NUM]", "autoeffect-match-num");
		let langScaling = getTranslationByKeyCustom("[SCALING]", "autoeffect-match-scaling");
		let langScalingNum = getTranslationByKeyCustom("[SCALING NUM]", "autoeffect-match-scalingnum");
		let langNegNum = getTranslationByKeyCustom("[-NUM]", "autoeffect-match-neg-num");
		let langNegScaling = getTranslationByKeyCustom("[-SCALING]", "autoeffect-match-neg-scaling");
		let langNegScalingNum = getTranslationByKeyCustom("[-SCALING NUM]", "autoeffect-match-neg-scalingnum");
		let langInitial = getTranslationByKeyCustom("[INITIAL]", "autoeffect-match-initial");
		let langResult = getTranslationByKeyCustom("[RESULT]", "autoeffect-match-result");
		let langTarget = getTranslationByKeyCustom("[TARGET]", "autoeffect-match-target");
		let langTargetIcon = getTranslationByKeyCustom("[/TARGET]", "autoeffect-match-targeticon");

		if (checkResult == "failure") { message = message.replaceAll(langCheck, "<b>" + langFailure + "</b>"); }
		if (checkResult == "no target") { message = message.replaceAll(langCheck, "<b>" + langNoTarget + "</b>"); }
		else { message = message.replaceAll(langCheck, "<b>" + langSuccess + "</b>"); }
		message = message.replaceAll(langNum, "<b>" + effectVal + "</b>");
		message = message.replaceAll(langScaling,  "<b>" + scaling + "</b>");
		message = message.replaceAll(langScalingNum, "<b>" + (parseFloat(scaling) * parseFloat(effectVal)) + "</b>");
		message = message.replaceAll(langNegNum, "<b>" + (-effectVal) + "</b>");
		message = message.replaceAll(langNegScaling,  "<b>" + (-scaling) + "</b>");
		message = message.replaceAll(langNegScalingNum, "<b>" + (-parseFloat(scaling) * parseFloat(effectVal)) + "</b>");
		message = message.replaceAll(langInitial, "<b>" + parseFloat(effectCount) + "</b>");
		if (checkResult != "failure" || checkResult != "no target") { message = message.replaceAll(langResult, "<b>" + (parseFloat(effectCount) + (parseFloat(scaling) * parseFloat(effectVal))) + "</b>"); }
		else {message = message.replaceAll(langResult, "<b>" + (parseFloat(effectCount)) + "</b>");}
		message = message.replaceAll(langTarget, "<b>" + effectTarget.replace("_"," ") + "</b>");

		/* Icon handling */
		/* Get target icon. Is in this format: [/TARGET]. If a effectIcon is procided, use that instead */
		if (effectIcon != "No icon") {
			if (settingLimbusStyle == "true") { effectIcon = effectIcon.replace("limbus/",""); }
			message = message.replaceAll(langTargetIcon, getIcon("ailments", effectIcon, settingLimbusStyle, `class="autoEffectImage" style="background-color: ${iconColor}"`));
		} else {
			message = message.replaceAll(langTargetIcon, getIcon("ailments", effectTarget.replace("_"," "), settingLimbusStyle, `class="autoEffectImage" style="background-color: ${iconColor}"`));
		}
		
		/* Question mark icon */
		message = message.replaceAll("[/Question]", getIcon("icons", "Question", "false", `class="autoEffectImage" style="background-color: ${iconColor}"`));

		if ((/\[\/([^0-9]+)\]/g).test(message)) {
			/* Get custom icon. Is in one of these formats: [/iconName], [/limbus/iconName], [/community/iconName]*/
			message = message.replaceAll("[/community/", "[community, ");
			message = message.replaceAll("[/limbus/", "[ailments, limbus/");
			message = message.replaceAll("[/", "[ailments, ");
			
			message.match((/\[([^0-9]+)\]/g)).forEach(icon => {
				let iconSelector = icon.replaceAll("[","").replaceAll("]","");
				let iconFolder = iconSelector.split(", ")[0];
				let iconName = iconSelector.split(", ")[1]
				message = message.replace(icon, getIcon(iconFolder, iconName, "false", `class="autoEffectImage" style="background-color: ${iconColor}"`));
			});
		}

		/* Message structure */
		if (message.startsWith("<img") == true) {
			message = message.replace(">","><div>") + "</div>";
		} else {
			message = "<div>" + message + "</div>";
		}
		newmessage = autoEffectEntry(message);

		return newmessage;
	}
}

function autoEffectTranslateMessage(message) {
	let returnMessage = message
		.replaceAll("Burn", getTranslationByKeyCustom("Burn","ailments-burn"))
		.replaceAll("Bleed", getTranslationByKeyCustom("Bleed","ailments-bleed"))
		.replaceAll("Paralysis", getTranslationByKeyCustom("Paralysis","ailments-paralysis"))
		.replaceAll("Fragile", getTranslationByKeyCustom("Fragile","ailments-fragile"))
		.replaceAll("Protection", getTranslationByKeyCustom("Protection","ailments-protection"))
		.replaceAll("Stagger Protection", getTranslationByKeyCustom("Stagger Protection","ailments-stgprotection"))
		.replaceAll("Strength", getTranslationByKeyCustom("Strength","ailments-strength"))
		.replaceAll("Endurance", getTranslationByKeyCustom("Endurance","ailments-endurance"))
		.replaceAll("Haste", getTranslationByKeyCustom("Haste","ailments-haste"))
		.replaceAll("Feeble", getTranslationByKeyCustom("Feeble","ailments-feeble"))
		.replaceAll("Disarm", getTranslationByKeyCustom("Disarm","ailments-disarm"))
		.replaceAll("Bind", getTranslationByKeyCustom("Bind","ailments-bind"))
		.replaceAll("Smoke", getTranslationByKeyCustom("Smoke","ailments-smoke"))
		.replaceAll("Charge", getTranslationByKeyCustom("Charge","ailments-charge"))
		.replaceAll("Fortune", getTranslationByKeyCustom("Fortune","ailments-fortune"))
		.replaceAll("HP", getTranslationByKeyCustom("HP","bar-health-shortened"))
		.replaceAll("ST", getTranslationByKeyCustom("ST","bar-stagres-shortened"))
		.replaceAll("SP", getTranslationByKeyCustom("SP","bar-sanity-shortened"))
		.replaceAll("THP", getTranslationByKeyCustom("THP","bar-health-temp-shortest"))
		.replaceAll("TST", getTranslationByKeyCustom("TST","bar-stagres-temp-shortest"));
	
	return returnMessage;
}

/* Converts an AutoEffect from an array back into its string form */
function autoEffectToString(AutoEffect) {
	return "(" + AutoEffect.join(" ") + ")";
}

function hasOption(AutoEffect, optionName) {
	let optionRegex = new RegExp(`(${optionName.replace("#","[0-9]+")})`, "ig");
	return AutoEffect.some(option => optionRegex.test(option));
}

/* Whispers an error message to the user detailing an AutoEffect error */
function autoEffectErrorMessage(errorType, errorString, AutoEffect) {
	AutoEffect = AutoEffect.join(" ").replace("Unknown: ","");
	errorMessage = `(${AutoEffect}) - ${errorString}`
	return { errorType: errorType, errorMessage: errorMessage, error: true};
}

/* Creates a new conditional button*/
function createConditionalButton(buttonName, buttonAutoScript, iconFolder, iconName, iconColor) {
	let output = {}
	let buttonIcon = getIcon(iconFolder, iconName, "false").replace('<img src="','').replace('" >','');

	let newrowid = generateRowID();
	output[`repeating_conditionalButtons_${newrowid}_buttonName`] = buttonName;
	output[`repeating_conditionalButtons_${newrowid}_buttonAutoScript`] = buttonAutoScript;
	output[`repeating_conditionalButtons_${newrowid}_buttonIcon`] = buttonIcon;
	output[`repeating_conditionalButtons_${newrowid}_buttonColor`] = iconColor;
	setAttrs(output);
}

/* Removes all conditional buttons */
function resetConditionals() {
	getSectionIDs("conditionalButtons", function(idarray) {
		for(var i=0; i < idarray.length; i++) {
			removeRepeatingRow("repeating_conditionalButtons_" + idarray[i]);
		}
	});
}

function autoEffectCustomMessage(AutoEffect, messageValues = {}) {
	if (AutoEffect.length > 2) { AutoEffect.slice(3).forEach(option => { if (!["checksuccess", "checkfailure", "checkignore", "target"].includes(option.toLowerCase())) { return autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }

	let messageFormat = "";
	let checkResultOption = "success";
	let effectTarget = "No target";
	let effectIcon = "No icon";
	let effectVal = 0;
	let effectCount = 0;
	let scaling = 1;
	let checkResult = "success";
	let settingLimbusStyle = "false";

	/* Check if CustomMessage is silent. No reason to do any formatting being that the message will not be displayed anyways */
	let silent = "false";
	if (autoEffectToString(AutoEffect).lastIndexOf("Silent") > autoEffectToString(AutoEffect).lastIndexOf('"')) {
		silent = "true";
	}

	/* Handle the target option */
	if (autoEffectToString(AutoEffect).lastIndexOf("Target") > autoEffectToString(AutoEffect).lastIndexOf('"')) {
		return {autoCustomMessage: autoEffectToString(AutoEffect).replaceAll("Target","") };
	} else {
		if (AutoEffect[1] != undefined) { messageFormat = AutoEffect.slice(1).join(" "); }
		if ((/\"[ \t]*(checksuccess)/ig).test(messageFormat)) { messageFormat = messageFormat.replaceAll((/\"[ \t]*(checksuccess)/ig), "") }
		else if ((/\"[ \t]*(checkfailure)/ig).test(messageFormat)) { checkResultOption = "failure"; messageFormat = messageFormat.replaceAll(/\"[ \t]*(checkfailure)/ig, "") }
		else if ((/\"[ \t]*(checkignore)/ig).test(messageFormat)) { checkResultOption = "ignore"; messageFormat = messageFormat.replaceAll(/\"[ \t]*(checkignore)/ig, "")}
		messageFormat = messageFormat.replaceAll('"','');

		if (messageValues.effectTarget != undefined) { effectTarget = messageValues.effectTarget; }
		if (messageValues.effectIcon != undefined) { effectIcon = messageValues.effectIcon; }
		if (messageValues.effectVal != undefined) { effectVal = messageValues.effectVal; }
		if (messageValues.effectCount != undefined) { effectCount = messageValues.effectCount; }
		if (messageValues.scaling != undefined) { scaling = messageValues.scaling; }
		if (messageValues.checkResult != undefined) { checkResult = messageValues.checkResult.replace("last ","");}
		if (messageValues.settingLimbusStyle != undefined) { settingLimbusStyle = messageValues.settingLimbusStyle; }

		if (silent == "false" && (checkResult == checkResultOption || checkResultOption == "ignore")) {
			return { message: autoEffectMessage(messageFormat, effectTarget, effectVal, effectCount, scaling, checkResult, settingLimbusStyle, effectIcon) }
		} else {
			return {}
		}
	}
}

function autoEffectRequire(AutoEffect, ailmentList, barList, barDamageList, targetAilmentList, targetBarList, targetBarDamageList, settingLimbusStyle) {
	let returnValues = {};
	
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 6) { return autoEffectErrorMessage("Format Error", `Expected format: (Require N #Ailment/#Bar/#BarDamage #Scaling(optional) #Target(optional) #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { AutoEffect.slice(3).forEach(option => { if (!(["scaling", "silent", "target"].includes(option.toLowerCase()) || (/(scaling[0-9]+)/ig).test(option))) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }

	/* Handle the target option */
	let noTarget;
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		if (Object.keys(targetAilmentList).length > 0) {
			ailmentList = targetAilmentList;
			barList = targetBarList;
			barDamageList = targetBarDamageList;
		} else {
			noTarget = "no target";
			// return autoEffectErrorMessage("Targeting Error", `Used the Target option for Require, but not target is selected`, AutoEffect);
		}
	}

	/* Get target count */
	let effectName = AutoEffect[2];
	let count = 0;
	let countImmutable = 0;

	/* Handle ailment count */
	if (ailmentList.hasOwnProperty(effectName)) { count = ailmentList[effectName][1]; countImmutable = ailmentList[effectName][3]; }
	/* Handle bar count */
	else if (barList.hasOwnProperty(effectName)) { count = barList[effectName]; countImmutable = count; }
	/* Handle bar damage count */
	else if (barDamageList.hasOwnProperty(effectName)) { count = barDamageList[effectName]; countImmutable = count; }
	else { return autoEffectErrorMessage("Invalid Target", `Ailment, Bar or BarDamage "${effectName}" does not exist`, AutoEffect); }

	/* Get required value. Recalculate count if percentage */
	let effectVal = AutoEffect[1];
	if (isNaN(parseFloat(Math.abs(effectVal))) == false) {
		effectVal = parseFloat(Math.abs(effectVal));
	}
	else if ((/[0-9]+[%]/g).test(String(effectVal))) {
		let percentage = parseFloat(effectVal.replace("%","")) / 100;
		let barVal = parseInt(barList[effectName.replace("-","")]);
		let barMax = parseInt(barVal) + parseInt(barDamageList[`-${effectName.replace("-","")}`]);
		if (barList.hasOwnProperty(effectName)) {
			count = barVal;
		}
		else if (barDamageList.hasOwnProperty(effectName)) {
			count = barMax - barVal;
		}
		effectVal = barMax*percentage;
		countImmutable = count;
	}
	else { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number or percentage`, AutoEffect); }

	/* Handle the scaling option */
	let scaling = 1;
	let scalingOption = AutoEffect.find(option => (/(scaling)/ig).test(option));
	if (scalingOption != undefined) {
		if ((/(scaling[0-9]+)/ig).test(scalingOption)) {
			scaling = Math.min(Math.floor(countImmutable/effectVal), parseInt(scalingOption.toLowerCase().replace("scaling","")));
		} else {
			scaling = Math.floor(countImmutable/effectVal);
		}
		returnValues.scaling = scaling;
	}
	
	/* Execute AutoEffect check */
	if (countImmutable >= effectVal && noTarget == undefined) {
		returnValues.checkResult = "success";
	} else {
		returnValues.checkResult = "failure";
	}

	/* Handle message */
	let messageFormat = getTranslationByKeyCustom("Require [SCALING NUM] [TARGET]: [CHECK]", "autoeffect-format-require");
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		messageFormat = `${getTranslationByKeyCustom("Target", "message-target")} - ${messageFormat}`;
	}
	
	let effectIcon = effectName;
	if (ailmentList.hasOwnProperty(effectName)) {
		messageFormat = "[/TARGET] " + messageFormat;
		effectIcon = ailmentList[effectName][6];
	}

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		returnValues.message = autoEffectMessage(messageFormat, effectName, effectVal, count, Math.max(scaling,1), noTarget ?? returnValues.checkResult, settingLimbusStyle, effectIcon);
	}
	returnValues.messageValues = { effectTarget: effectName, effectIcon: effectIcon, effectVal: effectVal, effectCount: count, scaling: Math.max(scaling,1), checkResult: noTarget || returnValues.checkResult }

	/* Return check result */
	return returnValues;
}

function autoEffectConsume(AutoEffect, ailmentList, barList, targetAilmentList, targetBarList, settingLimbusStyle, autoEffectType) {
	let returnValues = {};

	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 6) { return autoEffectErrorMessage("Format Error", `Expected format: (Consume N #Ailment/#Bar #Scaling(optional) #Target(optional) #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { AutoEffect.slice(3).forEach(option => { if (!(["scaling", "silent", "target"].includes(option.toLowerCase()) || (/(scaling[0-9]+)/ig).test(option))) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }
	
	/* Handle the target option */
	let noTarget;
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		if (Object.keys(targetAilmentList).length > 0) {
			ailmentList = targetAilmentList;
			barList = targetBarList;
		} else {
			noTarget = "no target";
			// return autoEffectErrorMessage("Targeting Error", `Used the Target option for Consume, but not target is selected`, AutoEffect);
		}
	}

	/* Get consumed value */
	let effectVal = parseInt(Math.abs(AutoEffect[1]));
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = 0;
	let countImmutable = 0;

	/* Get target */
	let effectName = AutoEffect[2];
	let effectTarget = "";
	
	/* Handle ailment target */
	if (ailmentList.hasOwnProperty(effectName)) {
		if (ailmentList[effectName][5] == "0") { effectTarget = effectName; } /* If standard ailment */
		else { effectTarget = `repeating_ailments_${ailmentList[effectName][5]}_ailNum`; } /* If custom ailment */
		count = ailmentList[effectName][1]; countImmutable = ailmentList[effectName][3];
	}
	/* Handle bar target */
	else if (barList.hasOwnProperty(effectName)) {
		effectTarget = effectName;
		count = barList[effectName];
		countImmutable = count;
	}
	else { return autoEffectErrorMessage("Invalid Target", `Ailment or Bar "${effectName}" does not exist`, AutoEffect); }
	
	/* Handle the scaling option */
	let scaling = 1;
	let scalingOption = AutoEffect.find(option => (/(scaling)/ig).test(option));
	if (scalingOption != undefined) {
		if ((/(scaling[0-9]+)/ig).test(scalingOption)) {
			scaling = Math.min(Math.floor(countImmutable/effectVal), parseInt(scalingOption.toLowerCase().replace("scaling","")));
		} else {
			scaling = Math.floor(countImmutable/effectVal);
		}
		returnValues.scaling = scaling;
	}

	/* Execute AutoEffect check */
	if (countImmutable >= effectVal && count >= effectVal && noTarget == undefined) {
		returnValues[effectTarget] = -effectVal*scaling;
		returnValues.count = parseInt(count);
		if (!(count >= 2*effectVal)) {
			returnValues.checkResult = "last success";
		} else {
			returnValues.checkResult = "success";
		}
		if (ailmentList.hasOwnProperty(effectName)) { returnValues.modifyList = "ailmentList"; }
		else { returnValues.modifyList = "barList";  }
		returnValues.modifyTarget = effectName;
		returnValues.modifyVal = -effectVal*scaling;

		/* If using the target option, do not Consume ailment/bar values for the character and modify the target's ailment/bar lists instead */
		if (AutoEffect.some(option => (/(target)/ig).test(option))) {
			returnValues.modifyList = `target${returnValues.modifyList}`;
		}
	} else {
		returnValues.checkResult = "failure";
	}

	/* When using the target option, on a successful check, run the Consume again for the target to actually deduct the consumed ailment/bar value */
	/* Also makes certain the Consume uses no ailment/bar value on the user */
	if (returnValues.checkResult != "failure" && hasOption(AutoEffect, "target")) {
		returnValues.autoInflict = `(Consume 1 ${effectTarget} Scaling${effectVal*scaling} ${(hasOption(AutoEffect, "silent")) ? "Silent" : ""}) (Reset)` ;
		delete returnValues[effectTarget];
		delete returnValues.count;
	}

	/* Handle message */
	let messageFormat = getTranslationByKeyCustom("Consume [-SCALING NUM] [TARGET]: [CHECK]", "autoeffect-format-consume");
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		messageFormat = `${getTranslationByKeyCustom("Target", "message-target")} - ${messageFormat}`;
	}
	if (returnValues.checkResult != "failure" && (autoEffectType == "standard" || autoEffectType == "section")) {
		messageFormat += " [[INITIAL] -> [RESULT]]";
	}
	
	let effectIcon = effectName;
	if (ailmentList.hasOwnProperty(effectName)) {
		messageFormat = "[/TARGET] " + messageFormat;
		effectIcon = ailmentList[effectName][6];
	}

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		returnValues.message = autoEffectMessage(messageFormat, effectName, -effectVal, count, Math.max(scaling,1), noTarget ?? returnValues.checkResult, settingLimbusStyle, effectIcon);
	}
	returnValues.messageValues = { effectTarget: effectName, effectIcon: effectIcon, effectVal: -effectVal, effectCount: count, scaling: Math.max(scaling,1), checkResult: noTarget || returnValues.checkResult }

	/* Return check result */
	return returnValues;
}

function autoEffectReset(AutoEffect) {
	/* Handle the target option */
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		return { autoReset: autoEffectToString(AutoEffect).replace(/(target)/ig,"") };
	} else {
		return { checkResult: "success", scaling: 1, messageValues: {checkResult:"success"} };
	}
}

function autoEffectAilment(AutoEffect, ailmentList, scaling, settingLimbusStyle, autoEffectType) {
	let returnValues = {};
	
	/* Check if Gain, Inflict or Give */
	let autoEffectVariant = "";
	switch (AutoEffect[0]) {
		case "Gain": autoEffectVariant = "Gain"; break;
		case "Inflict": autoEffectVariant = "Inflict"; break;
		case "Give": autoEffectVariant = "Give"; break;
		default: return autoEffectErrorMessage("Invalid AutoEffect", `${AutoEffect[0]} is not a valid AutoEffect`, AutoEffect);
	}

	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 6) { return autoEffectErrorMessage("Format Error", `Expected format: (${autoEffectVariant} N #Ailment #Round(optional) #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { AutoEffect.slice(3).forEach(option => { if (!["this", "next", "thisround", "nextround", "thisturn", "nextturn", "turn", "round", "silent"].includes(option.toLowerCase())) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }
	
	/* Get ailment name */
	let effectAilment = AutoEffect[2];
	if (!ailmentList.hasOwnProperty(effectAilment)) { return autoEffectErrorMessage("Invalid Target", `Ailment "${effectAilment}" does not exist`, AutoEffect); }
	
	/* Get values */
	let effectVal = parseInt(Math.abs(AutoEffect[1]));
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = ailmentList[effectAilment][1];

	/* Handle the optional turn override */
	/* This is between you and me, but "Next turn" doesn't actually do anything ;) */
	let forceTarget = "";

	if (AutoEffect[3] != undefined) {
		if (["this", "thisround", "this round, thisturn, this turn"].includes(AutoEffect[3].toLowerCase())) { forceTarget = "This round"; }
	}

	/* Get target attribute */
	let effectTarget = "";
	let effectRepeatingId = ailmentList[effectAilment][5];
	let effectHasNextTurn = ailmentList[effectAilment][0];
	if (effectRepeatingId == 0) { effectTarget = effectAilment; } /* If standard ailment */
	else { effectTarget = `repeating_ailments_${effectRepeatingId}_ailNum`; } /* If custom ailment */
	
	/* Update target list */
	if (autoEffectVariant == "Gain") {
		returnValues.modifyList = "ailmentList";
		returnValues.modifyTarget = effectAilment;
		returnValues.modifyNextTurn = "false";
		returnValues.modifyVal = effectVal*scaling;
	}

	/* Effect changes target to the next turn field if it's enabled */
	/* Is ignored if "This turn" override is included */
	if (effectHasNextTurn == 'true' && forceTarget != "This round") {
		effectTarget += "NextTurn";
		count = ailmentList[effectAilment][2];
		if (returnValues.modifyNextTurn != undefined) { returnValues.modifyNextTurn = "true"; }
	}

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = "";
	switch (autoEffectVariant) {
		case "Gain": messageFormat = getTranslationByKeyCustom("[/TARGET] Gain [SCALING NUM] [TARGET]", "autoeffect-format-gain"); break;
		case "Inflict": messageFormat = getTranslationByKeyCustom("[/TARGET] Inflict [SCALING NUM] [TARGET] to target", "autoeffect-format-inflict"); break;
		case "Give": messageFormat = getTranslationByKeyCustom("[/TARGET] Give [SCALING NUM] [TARGET] to ally", "autoeffect-format-give"); break;
	}
	
	let effectIcon = ailmentList[effectAilment][6];
	if (effectHasNextTurn == 'true' && forceTarget != "This round") { messageFormat += " next round"; }
	if (autoEffectType == "standard" || autoEffectType == "section") { messageFormat += " [[INITIAL] -> [RESULT]]" }

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, effectAilment, effectVal/scaling, count, scaling, "success", settingLimbusStyle, effectIcon);
	}
	messageValues = { effectTarget: effectAilment, effectIcon: effectIcon, effectVal: effectVal/scaling, effectCount: count, scaling: scaling, checkResult: "success", settingLimbusStyle: settingLimbusStyle }
	
	/* Execute AutoEffect */
	returnValues = {...returnValues, message: message, messageValues: messageValues };
	if (autoEffectVariant == "Gain") { returnValues = { ...returnValues, [effectTarget]: parseInt(effectVal), count: parseInt(count) } }
	if (autoEffectVariant == "Inflict") { returnValues = { ...returnValues, "autoInflict": autoEffectToString(AutoEffect).replace("Inflict","Gain") } }
	if (autoEffectVariant == "Give") { returnValues = { ...returnValues, "autoGive": autoEffectToString(AutoEffect).replace("Give","Gain") } }

	return returnValues;
}

function autoEffectSetBar(AutoEffect, barList, scaling) {
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (Set N #Bar #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { if (AutoEffect[3].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[3]}" is not a valid option`, AutoEffect); } }

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }

	/* Get value */
	let effectVal = parseInt(Math.abs(AutoEffect[1]));
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = 0;

	/* Get target */
	let effectBar = AutoEffect[2];
	let effectTarget = "";
	if (barList.hasOwnProperty(effectBar)) {
		effectTarget = effectBar.replace("ST", "StagRes");
		count = barList[effectBar];
	}
	else { return autoEffectErrorMessage("Invalid Target", `Bar "${effectBar}" does not exist`, AutoEffect); }

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = getTranslationByKeyCustom("Set [TARGET] to [RESULT]", "autoeffect-format-set");

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, effectTarget, (parseInt(effectVal) - parseInt(count))/scaling, count, scaling, "success");
	}
	messageValues = { effectTarget: effectTarget, effectVal: (parseInt(effectVal) - parseInt(count))/scaling, effectCount: count, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	return {[effectTarget]: parseInt(effectVal) - parseInt(count), count: count, message: message, messageValues: messageValues};
}
function autoEffectAddBar(AutoEffect, barList, scaling, autoEffectType) {
	returnValues = {};
	
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (Add N #Bar #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { if (AutoEffect[3].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[3]}" is not a valid option`, AutoEffect); } }

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }

	/* Get value */
	let effectVal = parseInt(AutoEffect[1]);
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = 0;

	/* Get target */
	let effectBar = AutoEffect[2];
	let effectTarget = "";
	if (barList.hasOwnProperty(effectBar)) {
		effectTarget = effectBar;
		if (effectTarget == "ST") { effectTarget = "StagRes"}
		count = barList[effectBar];
	}
	else { return autoEffectErrorMessage("Invalid Target", `Bar "${effectBar}" does not exist`, AutoEffect); }

	/* Update target list */
	returnValues.modifyList = "barList";
	returnValues.modifyTarget = effectTarget;
	returnValues.modifyVal = effectVal;

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = ""
	if (effectBar != "Light" && effectBar != "THP" && effectBar != "TST") {
		if (effectVal < 0) {
			messageFormat = getTranslationByKeyCustom("Receive [-SCALING NUM] [TARGET] damage", "autoeffect-format-add-neg");
		} else {
			messageFormat = getTranslationByKeyCustom("Regen [SCALING NUM] [TARGET]", "autoeffect-format-add");
		}
	} else {
		if (effectVal < 0) {
			messageFormat = getTranslationByKeyCustom("Lose [-SCALING NUM] [TARGET]", "autoeffect-format-add-light-neg");
		} else {
			messageFormat = getTranslationByKeyCustom("Gain [-SCALING NUM] [TARGET]", "autoeffect-format-add-light");
		}
	}
	
	if (autoEffectType == "standard" || autoEffectType == "section") {
		messageFormat += " [[INITIAL] -> [RESULT]]"
	}

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		returnValues.message = autoEffectMessage(messageFormat, effectTarget, effectVal/scaling, count, scaling, "success");
	}
	returnValues.messageValues = { effectTarget: effectTarget, effectVal: effectVal/scaling, effectCount: count, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	return {... returnValues, [effectTarget]: parseInt(effectVal), count: parseInt(count) };
}
function autoEffectMultiBar(AutoEffect, barList, scaling) {
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (Multi N #Bar #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { if (AutoEffect[3].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[3]}" is not a valid option`, AutoEffect); } }

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }

	/* Get value */
	let effectVal = parseFloat(Math.abs(AutoEffect[1]));
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }

	/* Get target */
	let effectBar = AutoEffect[2];
	let effectTarget = "";
	if (barList.hasOwnProperty(effectBar)) {
		effectTarget = effectBar.replace("ST", "StagRes");
		count = barList[effectBar];
	}
	else { return autoEffectErrorMessage("Invalid Target", `Bar "${effectBar}" does not exist`, AutoEffect); }

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = getTranslationByKeyCustom("Multiply [TARGET] by <b>", "autoeffect-format-multi1") + effectVal + getTranslationByKeyCustom("</b> [[SCALING NUM]]", "autoeffect-format-multi2");

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, effectTarget, Math.floor(parseFloat(effectVal) * parseInt(count) - parseInt(count))/scaling, count, scaling, "success");
	}
	messageValues = { effectTarget: effectTarget, effectVal: Math.floor(parseFloat(effectVal) * parseInt(count) - parseInt(count))/scaling, effectCount: count, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	return {[effectTarget]: Math.floor(parseFloat(effectVal) * parseInt(count) - parseInt(count)), count: count, message: message, messageValues: messageValues };
}

function autoEffectDice(AutoEffect, scaling) {
	/* Check if DicePower, DiceMax or DiceCount */
	let autoEffectVariant = "";
	switch (AutoEffect[0]) {
		case "DicePower": autoEffectVariant = "dicePower"; break;
		case "DiceMax": autoEffectVariant = "diceMax"; break;
		case "DiceCount": autoEffectVariant = "diceCount"; break;
		default: return autoEffectErrorMessage("Invalid AutoEffect", `${AutoEffect[0]} is not a valid AutoEffect`, AutoEffect);
	}

	/* Check format */
	if (AutoEffect.length < 2 || AutoEffect.length > 3) { return autoEffectErrorMessage("Format Error", `Expected format: (${capitalize(autoEffectVariant)} N #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 2) { if (AutoEffect[2].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[2]}" is not a valid option`, AutoEffect); } }
	
	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }
	
	/* Get values */
	let effectVal = parseFloat(AutoEffect[1]);
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = getTranslationByKeyCustom("Increase [TARGET] by [SCALING NUM]", "autoeffect-format-dice");
	if (effectVal < 0) { messageFormat = getTranslationByKeyCustom("Reduce [TARGET] by [SCALING NUM]", "autoeffect-format-dice-neg"); }
	
	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, AutoEffect[0].replace("Dice", "Dice "), effectVal/scaling, 0, scaling, "success");
	}
	messageValues = { effectTarget: AutoEffect[0].replace("Dice", "Dice "), effectVal: effectVal/scaling, effectCount: 0, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	return { [autoEffectVariant]: parseFloat(effectVal), message: message, messageValues: messageValues }
}

function autoEffectChallengeRoll(AutoEffect, scaling) {
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 3 ) { return autoEffectErrorMessage("Format Error", `Expected format: (ChallengeRoll #Stat N #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { if (AutoEffect[3].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[3]}" is not a valid option`, AutoEffect); } }
	
	/* Handle scaling */
	AutoEffect[2] *= scaling;
	if (scaling == 0) { return {}; }
	
	/* Get values */
	let effectVal = parseInt(AutoEffect[2]);
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }

	/* Get target stat */
	let statTarget = "";
	if (["fortitude", "instinct", "prudence", "wisdom", "justice", "charm", "insight", "temperance"].includes(AutoEffect[1].toLowerCase())) {
		statTarget = AutoEffect[1].toLowerCase();
	}
	else { return autoEffectErrorMessage("Invalid Stat", `Stat "${AutoEffect[1]}" does not exist.`, AutoEffect); }

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = getTranslationByKeyCustom("Rolling [TARGET] <b>+</b>[SCALING NUM]", "autoeffect-format-challengeroll");
	if (effectVal < 0) { messageFormat = getTranslationByKeyCustom("Rolling [TARGET] [SCALING NUM]", "autoeffect-format-challengeroll-neg"); }

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, (statTarget.charAt(0).toUpperCase() + statTarget.slice(1)), effectVal/scaling, 0, scaling, "success");
	}
	messageValues = { effectTarget: (statTarget.charAt(0).toUpperCase() + statTarget.slice(1)), effectVal: effectVal/scaling, effectCount: 0, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	return { challengeRollStat: statTarget.replace("fortitude","instinct").replace("prudence","wisdom"), challengeRollDifficulty: effectVal, message: message, messageValues: messageValues }
}

function autoEffectSpeed(AutoEffect, scaling, prevThisRoundSpeed, prevNextRoundSpeed) {
	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 5) { return autoEffectErrorMessage("Format Error", `Expected format: (Speed N #Duration #Silent(optional))`, AutoEffect); }
	
	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }
	
	/* Get values */
	let effectVal = parseFloat(AutoEffect[1]);
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }

	/* Get duration */
	let effectDuration = "";
	if (["thiscombat"].includes(AutoEffect[2].toLowerCase()) || AutoEffect[3].toLowerCase() == "combat" ) { effectDuration = "Combat"; }
	else if (["this", "thisround", "this round, thisturn, this turn"].includes(AutoEffect[2].toLowerCase())) { effectDuration = "ThisRound"; }
	else if (["next", "nextround", "next round, nextturn, next turn"].includes(AutoEffect[2].toLowerCase())) { effectDuration = "NextRound"; }
	else { return autoEffectErrorMessage("Invalid Option", `Duration "${AutoEffect.slice(2).join(" ")}" does not exist. Expected "This Combat", "This round" or "Next round"`, AutoEffect); }

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = getTranslationByKeyCustom("Increase [TARGET] by [SCALING NUM]", "autoeffect-format-speed");
	if (effectVal < 0) { messageFormat = getTranslationByKeyCustom("Reduce [TARGET] by [SCALING NUM]", "autoeffect-format-speed-neg"); }
	switch (effectDuration) {
		case "Combat": messageFormat += " " + getTranslationByKeyCustom("this combat", "autoeffect-option-thiscombat"); break;
		case "ThisRound": messageFormat += " " + getTranslationByKeyCustom("this round", "autoeffect-option-thisround"); break;
		case "NextRound": messageFormat += " " + getTranslationByKeyCustom("next round", "autoeffect-option-nextround"); break;
	}

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, "Speed", effectVal/scaling, 0, scaling, "success");
	}
	messageValues = { effectTarget: "Speed", effectVal: effectVal/scaling, effectCount: 0, scaling: scaling, checkResult: "success" }

	/* Execute AutoEffect */
	switch (effectDuration) {
		case "Combat": return { speedCombat: parseFloat(effectVal), message: message, messageValues: messageValues }; break;
		case "ThisRound": return { thisRoundSpeed: parseFloat(effectVal), count: parseInt(prevThisRoundSpeed), message: message, messageValues: messageValues }; break;
		case "NextRound": return { nextRoundSpeed: parseFloat(effectVal), count: parseInt(prevNextRoundSpeed), message: message, messageValues: messageValues }; break;
	}
}

function autoEffectDamage(AutoEffect, barList, scaling) {
	let returnValues = {};

	/* Check if BaseDamage or FlatDamage */
	let autoEffectVariant = "";
	switch (AutoEffect[0]) {
		case "BaseDamage": autoEffectVariant = "baseDamage"; break;
		case "FlatDamage": autoEffectVariant = "flatDamage"; break;
		default: return autoEffectErrorMessage("Invalid AutoEffect", `${AutoEffect[0]} is not a valid AutoEffect`, AutoEffect);
	}
	
	/* Check format */
	if (autoEffectVariant == "baseDamage") {
		if (AutoEffect.length < 2 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (${autoEffectVariant} N #Bar(optional) #Silent(optional))`, AutoEffect); }
		if (AutoEffect.length > 2) { AutoEffect.slice(2).forEach(option => { if (!["hp", "st", "silent"].includes(option.toLowerCase())) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[2]}" is not a valid option`, AutoEffect); } }); }
	} else {
		if (AutoEffect.length < 3 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (${autoEffectVariant} N #Bar #Silent(optional))`, AutoEffect); }
		if (AutoEffect.length > 3) { if (AutoEffect[3].toLowerCase() != "silent") { return autoEffectErrorMessage("Invalid Option", `Option "${AutoEffect[3]}" is not a valid option`, AutoEffect); } }
	}

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }

	/* Get value */
	let effectVal = parseInt(AutoEffect[1]);
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = 0;

	/* Get target */
	let effectBar = AutoEffect[2];
	let effectTarget = "";
	if (effectBar != undefined && effectBar.toLowerCase() != "silent") {
		if (barList.hasOwnProperty(effectBar)) {
			effectTarget = effectBar;
		}
		else { return autoEffectErrorMessage("Invalid Target", `Bar "${effectBar}" does not exist`, AutoEffect); }
	}

	/* Handle message */
	let message = "";
	let messageValues = {};
	let messageFormat = "";
	switch (autoEffectVariant) {
		case "baseDamage": messageFormat = getTranslationByKeyCustom("Increase [TARGET] Base Damage by [SCALING NUM]", "autoeffect-format-basedamage"); break;
		case "flatDamage": messageFormat = getTranslationByKeyCustom("Deal [SCALING NUM] [TARGET] Damage", "autoeffect-format-flatdamage"); break;
	}

	if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
		message = autoEffectMessage(messageFormat, effectTarget, effectVal/scaling, count, scaling, "success");
	}
	messageValues = { effectTarget: effectTarget, effectVal: effectVal/scaling, effectCount: count, scaling: scaling, checkResult: "success" }
	
	/* Execute AutoEffect */
	returnValues = { ...returnValues, [`${autoEffectVariant}${effectTarget}`]: effectVal, message: message, messageValues: messageValues }
	if (autoEffectVariant != "baseDamage") {
		returnValues.autoDamage = `(Add ${effectVal * -1} ${AutoEffect[2]})`;
	}
	return returnValues;
}

function autoEffectProc(AutoEffect, ailmentList, scaling, settingLimbusStyle) {
	let returnValues = {};

	/* Check format */
	if (AutoEffect.length < 2 || AutoEffect.length > 4) { return autoEffectErrorMessage("Format Error", `Expected format: (Proc #Ailment #Target(optional) #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 2) { AutoEffect.slice(2).forEach(option => { if (!(["silent", "target"].includes(option.toLowerCase()))) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }

	/* Handle scaling */
	if (scaling == 0) { return {}; }
	
	/* Get ailment name or id */
	let effectAilment = AutoEffect[1];
	let effectRepeatingId = ailmentList[effectAilment][5];
	if (!ailmentList.hasOwnProperty(effectAilment)) { return autoEffectErrorMessage("Invalid Target", `Ailment "${effectAilment}" does not exist`, AutoEffect); }
	
	/* Get target */
	let effectTarget = "";
	if (effectRepeatingId == 0) { effectTarget = effectAilment; } /* If standard ailment */
	else { effectTarget = effectRepeatingId; } /* If custom ailment */ 
	
	/* Handle the target option */
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		returnValues = {...returnValues, "autoInflict": autoEffectToString(AutoEffect.slice(0, 2)) }
	} else {
		returnValues.procAilment = effectTarget;

		/* Handle message */
		let message = "";
		let messageValues = {};
		let messageFormat = getTranslationByKeyCustom("[/TARGET] Proc [TARGET]", "autoeffect-format-proc");
		let effectIcon = ailmentList[effectAilment][6];
		
		if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
			message = autoEffectMessage(messageFormat, effectAilment, 0, 0, 1, "success", settingLimbusStyle, effectIcon);
		}
		messageValues = { effectTarget: effectAilment, effectIcon: effectIcon, effectVal: 0, effectCount: 0, scaling: 1, checkResult: "success", settingLimbusStyle: settingLimbusStyle }
		returnValues = {...returnValues, message: message, messageValues: messageValues }
	}

	return returnValues;
}

function autoEffectPause(AutoEffect, ailmentList, scaling, settingLimbusStyle) {
	let returnValues = {};

	/* Check format */
	if (AutoEffect.length < 3 || AutoEffect.length > 5) { return autoEffectErrorMessage("Format Error", `Expected format: (Pause N #Ailment #Target(optional) #Silent(optional))`, AutoEffect); }
	if (AutoEffect.length > 3) { AutoEffect.slice(3).forEach(option => { if (!(["silent", "target"].includes(option.toLowerCase()))) { returnValues = autoEffectErrorMessage("Invalid Option", `Option "${option}" is not a valid option`, AutoEffect); } }); }

	/* Handle scaling */
	AutoEffect[1] *= scaling;
	if (scaling == 0) { return {}; }
	
	/* Get ailment name */
	let effectAilment = AutoEffect[2];
	if (!ailmentList.hasOwnProperty(effectAilment)) { return autoEffectErrorMessage("Invalid Target", `Ailment "${effectAilment}" does not exist`, AutoEffect); }
	
	/* Get values */
	let effectVal = parseInt(Math.abs(AutoEffect[1]));
	if (isNaN(effectVal) == true) { return autoEffectErrorMessage("Invalid Value", `Value "${AutoEffect[1]}" is not a number`, AutoEffect); }
	let count = 0;

	/* Get target attribute */
	let effectTarget = "";
	let effectRepeatingId = ailmentList[effectAilment][5];
	let effectHasNextTurn = ailmentList[effectAilment][0];
	if (effectRepeatingId == 0) { effectTarget = `${effectAilment}DecayPause`; } /* If standard ailment */
	else { effectTarget = `repeating_ailments_${effectRepeatingId}_ailDecayPause`; } /* If custom ailment */

	/* Handle the target option */
	if (AutoEffect.some(option => (/(target)/ig).test(option))) {
		returnValues = {...returnValues, "autoInflict": autoEffectToString(AutoEffect.slice(0, 3)) }
	} else {

		/* Handle message */
		let message = "";
		let messageValues = {};
		let messageFormat = getTranslationByKeyCustom("[/TARGET] Paused [TARGET] for [SCALING NUM] activations", "autoeffect-format-pause");
		let effectIcon = ailmentList[effectAilment][6];

		if (!AutoEffect.some(option => (/(silent)/ig).test(option))) {
			message = autoEffectMessage(messageFormat, effectAilment, effectVal/scaling, count, scaling, "success", settingLimbusStyle, effectIcon);
		}
		messageValues = { effectTarget: effectAilment, effectIcon: effectIcon, effectVal: effectVal/scaling, effectCount: count, scaling: scaling, checkResult: "success", settingLimbusStyle: settingLimbusStyle }
		
		/* Execute AutoEffect */
		returnValues = { [effectTarget]: parseInt(effectVal), count: parseInt(count), message: message, messageValues: messageValues }
	}

	return returnValues;
}



/*--- AutoEffect functions end ---*/




/*--- Export/Import functions ---*/

let attrkeyCharacter = ["character_nameBase", "instinct", "wisdom", "justice", "charm", "insight", "temperance", "EXP", "character_job", "age", "height", "character_origin", "character_residence", "character_assets", "character_ahn", "character_url", "character_summary", "character_combatnote", "character_history", "character_relations", "character_notes", "character_desc", "character_personality", "character_background"];

let attrkeySettings = ["settingWhisperRolls",

"settingSimpleDisplay", "settingExtraEquip", "settingHideSpecial", "settingHelperText", "settingHideShare", "settingHideUses",
"settingLoopEnabled", "configLoopDelay", "configUpdateDelay", "configTrackerItemName", "settingAutoDetect", "settingTurnUpdate", "settingMultihitFull", "settingMultihitUses",
"settingMuteMessage", "settingHideNextTurn", "settingBurnImmune", "settingBleedImmune",
"settingAutoApplyDamage", "settingHideBarUpdate",
"settingCollapseAutoEffectSections", "settingHideConditionalButtonReminder", "settingHideActionButtons", "settingHideBaseEffect", "AutoScriptStyling"];

let attrkeyEquip = ["outfitName", "outfitRank", "outfitDescription", "outfitEffect", "defDice1", "defDice2", "defDice3", "evdDice1", "evdDice2", "evdDice3", "outfitImmune1", "outfitImmune2", "outfitImmune3", "outfitImmune4", "outfitImmune5", "outfitImmune6", "bleedResist", "burnResist", "damageResist", "outfitAutoScript",

"weapon1Name", "weapon1Rank", "weapon1Description", "weapon1Effect", "weapon1Dice1", "weapon1Dice2", "weapon1Dice3", "weapon1Type", "weapon1Range", "weapon1Uses", "weapon1Uses_max", "weapon1UseType", "weapon1AutoScript",
"weapon2Name", "weapon2Rank", "weapon2Description", "weapon2Effect", "weapon2Dice1", "weapon2Dice2", "weapon2Dice3", "weapon2Type", "weapon2Range", "weapon2Uses", "weapon2Uses_max", "weapon2UseType", "weapon2AutoScript",
"weapon3Name", "weapon3Rank", "weapon3Description", "weapon3Effect", "weapon3Dice1", "weapon3Dice2", "weapon3Dice3", "weapon3Type", "weapon3Range", "weapon3Uses", "weapon3Uses_max", "weapon3UseType", "weapon3AutoScript",
"weapon4Name", "weapon4Rank", "weapon4Description", "weapon4Effect", "weapon4Dice1", "weapon4Dice2", "weapon4Dice3", "weapon4Type", "weapon4Range", "weapon4Uses", "weapon4Uses_max", "weapon4UseType", "weapon4AutoScript",

"augmentName", "augmentRank", "augmentType", "augmentDescription", "augmentEffect", "augmentAutoScript",

"tool1Name", "tool1Rank", "tool1Description", "tool1Effect", "tool1Portable", "tool1Reusable", "tool1Uses", "tool1Uses_max", "tool1Icon", "tool1AutoScript",
"tool2Name", "tool2Rank", "tool2Description", "tool2Effect", "tool2Portable", "tool2Reusable", "tool2Uses", "tool2Uses", "tool2Uses_max", "tool2Icon", "tool2AutoScript",
"tool3Name", "tool3Rank", "tool3Description", "tool3Effect", "tool3Portable", "tool3Reusable", "tool3Uses", "tool3Uses", "tool3Uses_max", "tool3Icon", "tool3AutoScript",
"tool4Name", "tool4Rank", "tool4Description", "tool4Effect", "tool4Portable", "tool4Reusable", "tool4Uses", "tool4Uses", "tool4Uses_max", "tool4Icon", "tool4AutoScript",

"special1Name", "special1Rank", "special1Risk", "special1Range", "special1Duration", "special1Description", "special1AutoScript",
"special2Name", "special2Rank", "special2Risk", "special2Range", "special2Duration", "special2Description", "special2AutoScript"];

let attrkeyDistort = ["distort_name", "distortWork", "distortCounter", "distortWorkInstinct", "distortWorkWisdom", "distortWorkJustice", "distortWorkCharm", "distortWorkInsight", "distortWorkTemperance", "distortResultGood", "distortResultNormal", "distortResultBad", "distortWeaponDice1", "distortWeaponDice2", "distortWeaponDice3", "distortDefDice1", "distortDefDice2", "distortDefDice3", "distortEvdDice1", "distortEvdDice2", "distortEvdDice3", "distortDescription", "distortEffect", "distortDescription2", "distortEffect2", "distort_url", "distort_summary", "distort_behavior", "distort_combatnote", "distort_origin", "distort_notes", "distort_taboo", "distort_appearance", "distort_atmosphere", "distort_story"];

let attrkeyEgo = ["egoName", "egoCondition", "egoType", "egoRank", "egoIdeology", "egoDescription", "egoEffect", "egoWeaponDice1", "egoWeaponDice2", "egoWeaponDice3", "egoWeaponType", "egoWeaponRange", "egoDefDice1", "egoDefDice2", "egoDefDice3", "egoEvdDice1", "egoEvdDice2", "egoEvdDice3", "egoImmune1", "egoImmune2", "egoImmune3", "egoImmune4", "egoImmune5", "egoImmune6", "egoUses", "egoUses_max", "egoUseType", "egoRisk", "egoRange", "egoDuration", "bleedResist_ego", "burnResist_ego", "damageResist_ego", "egoAutoScript"];

let attrkeySkills = ["skill1Name", "skill1Rank", "skill1Type", "skill1Light", "skill1Dice1", "skill1Dice2", "skill1Dice3", "skill1Description", "skill1Effect", "skill1AutoScript",
"skill2Name", "skill2Rank", "skill2Type", "skill2Light", "skill2Dice1", "skill2Dice2", "skill2Dice3", "skill2Description", "skill2Effect", "skill2AutoScript",
"skill3Name", "skill3Rank", "skill3Type", "skill3Light", "skill3Dice1", "skill3Dice2", "skill3Dice3", "skill3Description", "skill3Effect", "skill3AutoScript",
"skill4Name", "skill4Rank", "skill4Type", "skill4Light", "skill4Dice1", "skill4Dice2", "skill4Dice3", "skill4Description", "skill4Effect", "skill4AutoScript",
"skill5Name", "skill5Rank", "skill5Type", "skill5Light", "skill5Dice1", "skill5Dice2", "skill5Dice3", "skill5Description", "skill5Effect", "skill5AutoScript",
"skill6Name", "skill6Rank", "skill6Type", "skill6Light", "skill6Dice1", "skill6Dice2", "skill6Dice3", "skill6Description", "skill6Effect", "skill6AutoScript",
"egoSkill1Name", "egoSkill1Rank", "egoSkill1Type", "egoSkill1Light", "egoSkill1Dice1", "egoSkill1Dice2", "egoSkill1Dice3", "egoSkill1Description", "egoSkill1Effect", "egoSkill1AutoScript",
"egoSkill2Name", "egoSkill2Rank", "egoSkill2Type", "egoSkill2Light", "egoSkill2Dice1", "egoSkill2Dice2", "egoSkill2Dice3", "egoSkill2Description", "egoSkill2Effect", "egoSkill2AutoScript",
"egoSkill3Name", "egoSkill3Rank", "egoSkill3Type", "egoSkill3Light", "egoSkill3Dice1", "egoSkill3Dice2", "egoSkill3Dice3", "egoSkill3Description", "egoSkill3Effect", "egoSkill3AutoScript",
"egoSkill4Name", "egoSkill4Rank", "egoSkill4Type", "egoSkill4Light", "egoSkill4Dice1", "egoSkill4Dice2", "egoSkill4Dice3", "egoSkill4Description", "egoSkill4Effect", "egoSkill4AutoScript",
"egoSkill5Name", "egoSkill5Rank", "egoSkill5Type", "egoSkill5Light", "egoSkill5Dice1", "egoSkill5Dice2", "egoSkill5Dice3", "egoSkill5Description", "egoSkill5Effect", "egoSkill5AutoScript",
"egoSkill6Name", "egoSkill6Rank", "egoSkill6Type", "egoSkill6Light", "egoSkill6Dice1", "egoSkill6Dice2", "egoSkill6Dice3", "egoSkill6Description", "egoSkill6Effect", "egoSkill6AutoScript"];

let attrkeyGlobal = ["global_ruleName", "global_healthBase", "global_healthStat", "global_healthStatMod", "global_healthRankMod", "global_staggerBase", "global_staggerStat", "global_staggerStatMod", "global_staggerRankMod", "global_sanityBase", "global_sanityStat", "global_sanityStatMod", "global_sanityRankMod", "global_lightBase", "global_lightRankMod", "global_distortLightBase", "global_distortLightRankMod", "global_attStat", "global_defStat", "global_evdStat", "global_evdAilment", "global_multiPenalty", "global_multiStyle", "global_staggerRecoverPercent", "global_staggerRecoverBase", `global_staggerDurationMax`, "global_staggerSanity", "global_settingBar1", "global_settingBar2", "global_settingBar3", "global_burnDecayMode", "global_burnDecayVal", "global_burnNextTurnSetting", "global_bleedDecayMode", "global_bleedDecayVal", "global_bleedNextTurnSetting", "global_smokeDecayMode", "global_smokeDecayVal", "global_smokeNextTurnSetting", "global_smokeCalculationMode", "global_smokeCalculationVal", "global_chargeDecayMode", "global_chargeDecayVal", "global_chargeNextTurnSetting", "settingLimbusStyle"];

/* Data Exporter */
function dataExport(override, target){

getAttrs(["exportType"], function(values) {

	let exporttype = values.exportType;
	let textbase = "";
	let tempval = "";
	let attrkey = "";
	let output = "editorOutput";

	if(target != null){
	output = target;
	}

	let char = "";
	let distort = "";
	let ego = "";
	let equip = "";
	let skills = "";

	/* Format key */

	if(override != null){
	exporttype = override;
	}

	if(exporttype == "All"){
	
	attrkey = attrkeyCharacter.concat(attrkeyDistort, attrkeyEgo, attrkeyEquip, attrkeySkills, attrkeySettings);
	
	}
	else if (exporttype == "Equip"){
	attrkey = attrkeyEquip;
	}
	else if (exporttype == "Distort"){
	attrkey = attrkeyDistort;
	}
	else if (exporttype == "Ego"){
	attrkey = attrkeyEgo;
	}
	else if (exporttype == "Skills"){
	attrkey = attrkeySkills;
	}
	else if (exporttype == "Character"){
	attrkey = attrkeyCharacter;
	}
	else if (exporttype == "Settings"){
	attrkey = attrkeySettings;
	}
	else if (exporttype == "Global"){
	attrkey = attrkeyGlobal;
	}
	else {
	attrkey = [];
	}

	/* Get attributes */

	getAttrs(attrkey, function(values) {

	for(let i = 0; i< attrkey.length ;i++){
	tempval = values[attrkey[i]];

	if(tempval == undefined){
	tempval = "";
	}

   	 	textbase += "[`" + attrkey[i] + "`,`" + tempval + "`]";

		if(i < (attrkey.length - 1)){
		textbase += ", ";
		}

	}


	textbase = textbase.replace(/	/g, ''); /* Remove whitespace */
	

	setAttrs({[output]: textbase });

		});


	});

}

/* Data Importer */
function dataImport(target, prefix, replacestr){

	let inputsource = "editorInput";
	let inputprefix = "";
	
	if(target != null){
	inputsource = target;

	}

getAttrs([`${inputsource}`], function(values) {

	let input = values[`${inputsource}`];

	input = input.replace(/	/g, ''); /* Remove whitespace */
	input = input.replace(/\n/g, "@"); /* Temporarily replace line breaks */
	input = input.replace(/"/g, "“"); /* Temporarily replace " quotes */

	if(replacestr != null && prefix != null){
	input = input.replaceAll(replacestr, prefix);
	}

	let inputarray = "[" + input + "]";
	let attrtarget = "";
	let attrvalue = "";

	inputarray = inputarray.replace(/`/g, '"');

	inputarray = JSON.parse(inputarray);

	const output = {};

	for(let i = 0; i< inputarray.length ;i++){

	attrtarget = inputarray[i][0].toString();
	attrvalue = inputarray[i][1].toString();

	//console.log("Set " + attrtarget + " to: " + attrvalue);

	attrvalue = attrvalue.replace(/@/g, "\n"); /* Reintroduce line breaks */
	attrvalue = attrvalue.replace(/“/g, '"'); /* Reintroduce " quotes */

	output[`${attrtarget}`] = attrvalue;

		}

      	setAttrs(output);	


	});
}

/* Data Exporter - Repeating Section */
function dataExportRepeating(section){

getSectionIDs("repeating_ailments", function(idarray) {

	let textbase = "";
	let tempval = "";
	let attrkey = [];
	let exportkey = [];

	/* Get attributes */
      for(var i=0; i < idarray.length; i++) {
	let currentid = `repeating_${section}_${idarray[i]}`;
	let finalid = i;

	let currentkeys = [`${currentid}_ailName`, `${currentid}_ailIcon`, `${currentid}_ailDisplay`, `${currentid}_ailTrigger`, `${currentid}_ailNextTurn`, `${currentid}_ailEffect`, `${currentid}_ailEffectMode`, `${currentid}_ailEffectVal`, `${currentid}_ailDecayMode`, `${currentid}_ailDecayVal`, `${currentid}_ailDecayMin`, `${currentid}_ailMax`, `${currentid}_ailMaxBehavior`, `${currentid}_ailMessageCheck`, `${currentid}_ailMessage`, `${currentid}_ailDamageTypeTrigger`, `${currentid}_ailBeforeResistance`, `${currentid}_ailDecayWhenHit`, `${currentid}_ailDecayRoundEnd`, `${currentid}_ailPositiveType`, `${currentid}_ailCustomResistance`, `${finalid}_ailCustomResistanceNum`, `${currentid}_ailCustomResistanceNumEgo`];

	let finalkeys = [`${finalid}_ailName`, `${finalid}_ailIcon`, `${finalid}_ailDisplay`, `${finalid}_ailTrigger`, `${finalid}_ailNextTurn`, `${finalid}_ailEffect`, `${finalid}_ailEffectMode`, `${finalid}_ailEffectVal`, `${finalid}_ailDecayMode`, `${finalid}_ailDecayVal`, `${finalid}_ailDecayMin`, `${finalid}_ailMax`, `${finalid}_ailMaxBehavior`, `${finalid}_ailMessageCheck`, `${finalid}_ailMessage`, `${finalid}_ailDamageTypeTrigger`, `${finalid}_ailBeforeResistance`, `${finalid}_ailDecayWhenHit`, `${finalid}_ailDecayRoundEnd`, `${finalid}_ailPositiveType`, `${finalid}_ailCustomResistance`, `${finalid}_ailCustomResistanceNum`,  `${finalid}_ailCustomResistanceNumEgo`];

	attrkey = attrkey.concat(currentkeys);
	exportkey = exportkey.concat(finalkeys);

      }


	getAttrs(attrkey, function(values) {

		for(let i = 0; i< attrkey.length ;i++){
		tempval = values[attrkey[i]];

		if(tempval == undefined){
		tempval = "";
		}

   	 	textbase += "[`" + exportkey[i] + "`,`" + tempval + "`]";

		if(i < (attrkey.length - 1)){
		textbase += ", ";
		}

		}


	textbase = textbase.replace(/	/g, ''); /* Remove whitespace */
	

	setAttrs({"ailmentEditor": textbase });

		});
	});
}

function dataImportRepeating(section, override){

getAttrs(["ailmentEditor", "customImportMode", "settingCustomCollapse"], function(values) {

	let input = values.ailmentEditor;
	let mode = values.customImportMode;
	let collapseSetting = values.settingCustomCollapse;

	input = input.replace(/	/g, ''); /* Remove whitespace */
	input = input.replace(/\n/g, "@"); /* Temporarily replace line breaks */
	input = input.replace(/"/g, "“"); /* Temporarily replace " quotes */

	let inputarray = "[" + input + "]";
	let attrid = "";
	let attrtarget = "";
	let attrvalue = "";

	inputarray = inputarray.replace(/`/g, '"');

	inputarray = JSON.parse(inputarray);

	const output = {};
	let currentid = 0;
	let oldrowid = "";
	let newrowid = generateRowID();
	output[`repeating_${section}_${newrowid}_ailCollapse`] = collapseSetting;

	if(input != null && input != ""){
		if(override != null){
		mode = override;
		}

		if(mode != "Add"){
		clearCustomAilments();
		}

		for(let i = 0; i< inputarray.length ;i++){

		attrid = inputarray[i][0].split('_')[0];
		attrtarget = inputarray[i][0].split('_')[1];
		attrvalue = inputarray[i][1].toString();

		attrvalue = attrvalue.replace(/@/g, "\n"); /* Reintroduce line breaks */
		attrvalue = attrvalue.replace(/“/g, '"'); /* Reintroduce " quotes */

		/* Moving to next item */
		if(currentid != attrid){
		oldrowid = newrowid;
		newrowid = generateRowID();

			while(oldrowid == newrowid){
			//console.log("This shouldn't happen:" + newrowid);

			newrowid = generateRowID();
			//console.log("Fixing:" + newrowid);
			}

		output[`repeating_${section}_${newrowid}_ailCollapse`] = collapseSetting;

		currentid += 1;
		//console.log("ID: " + newrowid + " | " + attrtarget + "|" + attrid + ", " + currentid + "|");
			}
	
		output[`repeating_${section}_${newrowid}_${attrtarget}`] = attrvalue;

		}

      	setAttrs(output);

	}	


	});
}

/* Export Repeating button */
on("clicked:exportRepeating", function(info) { 
	dataExportRepeating("ailments");

});

/* Import Repeating button */
on("clicked:importRepeating", function(info) { 
	dataImportRepeating("ailments");

});


/* Swap function */
function dataSwap() {
	getAttrs(["editorOutput", "editorInput"], function(values) {
	
	let newoutput = values.editorInput;
	let newinput = values.editorOutput;


	setAttrs({ "editorOutput":newoutput, "editorInput":newinput});
	});
}

/* Swap button */ 
on("clicked:swap", function(info) {
	dataSwap();

	});

/* Function: Clear specified attribute from button */
on("clicked:clearButton", function(info) {

        let buttonid = info.htmlAttributes.id.split('_')[1];

	setAttrs({ [buttonid]:""});

});

/* Import button */
on("clicked:import", function(info) {
	dataImport();

});

/* Export button */
on("clicked:export", function(info) { 
	dataExport();

});

/* Action: Status ailment clicker */
on('clicked:ailmentClicker', (info) => {

	/* Get IDs/names */
        let buttonid = info.htmlAttributes.id.split('_')[1];
	let ailment = buttonid.toString();

	/* Get attributes */
        getAttrs([`${ailment}`], function(values) {

	let currentValue = parseInt(values[ailment]);
	let newval = currentValue + 1;

	setAttrs({ [buttonid]:newval});

    });

});

/* Action: Custom ailment clicker */
on('clicked:repeating_ailments:clickercustom', (info) => {

	const rowid = info.sourceAttribute.split('_')[2];
        getAttrs([`repeating_ailments_${rowid}_ailNum`], function(values) {

	let newval = values[`repeating_ailments_${rowid}_ailNum`];

	newval = parseInt(newval) + 1;

          setAttrs({ [`repeating_ailments_${rowid}_ailNum`]:newval });

        });
});

/* Action: Lock section from sync */
on('clicked:lockSection', (info) => {

	let target = info.htmlAttributes.id.split('_')[1];
	let attrname = "syncLock" + target;

	getAttrs([`${attrname}`], function(values) {

	let synclock = values[`${attrname}`];

	if(synclock != "true"){
          setAttrs({ [`${attrname}`]:"true" });

	}
	else {
	  setAttrs({ [`${attrname}`]:"0" });
	}

        });

});


/* Action: Custom ailment display toggle */
on('clicked:repeating_ailments:displaycustom', (info) => {

	const rowid = info.sourceAttribute.split('_')[2];
        getAttrs([`repeating_ailments_${rowid}_ailDisplay`], function(values) {

	let currentval = values[`repeating_ailments_${rowid}_ailDisplay`];
	let newval = "0";

	if(currentval == "0"){
	newval = "true";
	}
	else {
	newval = "0";
	}

          setAttrs({ [`repeating_ailments_${rowid}_ailDisplay`]:newval });

        });
});


/* Action: Custom ailment copy */
on('clicked:repeating_ailments:copycustom', (info) => {

	let rowid = info.sourceAttribute.split('_')[2];

        getAttrs([`repeating_ailments_${rowid}_ailNum`, `repeating_ailments_${rowid}_ailName`, `repeating_ailments_${rowid}_ailIcon`, `repeating_ailments_${rowid}_ailDisplay`, `repeating_ailments_${rowid}_ailCollapse`, `repeating_ailments_${rowid}_ailTrigger`, `repeating_ailments_${rowid}_ailNextTurn`, `repeating_ailments_${rowid}_ailEffect`, `repeating_ailments_${rowid}_ailEffectMode`, `repeating_ailments_${rowid}_ailEffectVal`, `repeating_ailments_${rowid}_ailDecayMode`, `repeating_ailments_${rowid}_ailDecayVal`, `repeating_ailments_${rowid}_ailDecayMin`, `repeating_ailments_${rowid}_ailMax`, `repeating_ailments_${rowid}_ailMaxBehavior`, `repeating_ailments_${rowid}_ailMessageCheck`, `repeating_ailments_${rowid}_ailMessage`, `repeating_ailments_${rowid}_ailDamageTypeTrigger`, `repeating_ailments_${rowid}_ailBeforeResistance`, `repeating_ailments_${rowid}_ailDecayWhenHit`, `repeating_ailments_${rowid}_ailDecayRoundEnd`, `repeating_ailments_${rowid}_ailPositiveType`, `repeating_ailments_${rowid}_ailCustomResistance`], function(values) {

	let newrowid = generateRowID();
	let newrowattrs = {};

	/* Translation prep */
	let langCopy = "Copy";

	if(getTranslationByKey("message-copy") != false){
	langCopy = getTranslationByKey("message-copy");
	}

	newrowattrs[`repeating_ailments_${newrowid}_ailName`] = values[`repeating_ailments_${rowid}_ailName`] + " (" + langCopy + ")";
	newrowattrs[`repeating_ailments_${newrowid}_ailIcon`] = values[`repeating_ailments_${rowid}_ailIcon`];
	newrowattrs[`repeating_ailments_${newrowid}_ailDisplay`] = values[`repeating_ailments_${rowid}_ailDisplay`];
	newrowattrs[`repeating_ailments_${newrowid}_ailCollapse`] = values[`repeating_ailments_${rowid}_ailCollapse`];

	newrowattrs[`repeating_ailments_${newrowid}_ailTrigger`] = values[`repeating_ailments_${rowid}_ailTrigger`];

	newrowattrs[`repeating_ailments_${newrowid}_ailNextTurn`] = values[`repeating_ailments_${rowid}_ailNextTurn`];

	newrowattrs[`repeating_ailments_${newrowid}_ailEffect`] = values[`repeating_ailments_${rowid}_ailEffect`];
	newrowattrs[`repeating_ailments_${newrowid}_ailEffectMode`] = values[`repeating_ailments_${rowid}_ailEffectMode`];
	newrowattrs[`repeating_ailments_${newrowid}_ailEffectVal`] = values[`repeating_ailments_${rowid}_ailEffectVal`];

	newrowattrs[`repeating_ailments_${newrowid}_ailDecayMin`] = values[`repeating_ailments_${rowid}_ailDecayMin`];
	newrowattrs[`repeating_ailments_${newrowid}_ailDecayMode`] = values[`repeating_ailments_${rowid}_ailDecayMode`];
	newrowattrs[`repeating_ailments_${newrowid}_ailDecayVal`] = values[`repeating_ailments_${rowid}_ailDecayVal`];

	newrowattrs[`repeating_ailments_${newrowid}_ailMax`] = values[`repeating_ailments_${rowid}_ailMax`];
	newrowattrs[`repeating_ailments_${newrowid}_ailMaxBehavior`] = values[`repeating_ailments_${rowid}_ailMaxBehavior`];

	newrowattrs[`repeating_ailments_${newrowid}_ailMessageCheck`] = values[`repeating_ailments_${rowid}_ailMessageCheck`];
	newrowattrs[`repeating_ailments_${newrowid}_ailMessage`] = values[`repeating_ailments_${rowid}_ailMessage`];

	newrowattrs[`repeating_ailments_${newrowid}_ailDamageTypeTrigger`] = values[`repeating_ailments_${rowid}_ailDamageTypeTrigger`];
	newrowattrs[`repeating_ailments_${newrowid}_ailBeforeResistance`] = values[`repeating_ailments_${rowid}_ailBeforeResistance`];
	newrowattrs[`repeating_ailments_${newrowid}_ailDecayWhenHit`] = values[`repeating_ailments_${rowid}_ailDecayWhenHit`];
	newrowattrs[`repeating_ailments_${newrowid}_ailDecayRoundEnd`] = values[`repeating_ailments_${rowid}_ailDecayRoundEnd`];
	newrowattrs[`repeating_ailments_${newrowid}_ailPositiveType`] = values[`repeating_ailments_${rowid}_ailPositiveType`];
	newrowattrs[`repeating_ailments_${newrowid}_ailCustomResistance`] = values[`repeating_ailments_${rowid}_ailCustomResistance`];


	setAttrs(newrowattrs);


        });


});



/* Action: Clear all ailment data */
on('clicked:clearAilment', (info) => {

clearCustomAilments();

});

function clearCustomAilments() {

   getSectionIDs("repeating_ailments", function(idarray) {
      for(var i=0; i < idarray.length; i++) {
        removeRepeatingRow("repeating_ailments_" + idarray[i]);
      }
	});

}

/* Check: Collapse all ailment data */
on('change:settingCustomCollapse', (info) => {

getAttrs(["settingCustomCollapse"], function(values) {

	let setting = values.settingCustomCollapse;

        getSectionIDs(`repeating_ailments`, idarray => {
            const fieldnames = idarray.reduce((rows,id) => [...rows, `repeating_ailments_${id}_ailCollapse`], '');
            getAttrs([...fieldnames], v => {
                const output = {};
                idarray.forEach(id => {

                    output[`repeating_ailments_${id}_ailCollapse`] = setting;

                });
                setAttrs(output);
            });
        });

   });

});


/* Action: Sync all ailment data */
on('clicked:syncAilment', (info) => {

getSectionIDs(`repeating_global`, idarray => {
           let id = `repeating_global_${idarray[0]}`;

 getAttrs(["ailmentEditor", `${id}_ailmentSettingSource`, "syncLockAilment", "syncStateAilment"], function(values) {

	let current = values.ailmentEditor;
	let source = values[`${id}_ailmentSettingSource`];

	const output = {};

	/* Translation prep */
	let langSync = "Sync";
	let langCustomAilments = "Custom Ailments";
	let langSyncSuccess = " sync successful.";
	let langSyncFail =  " is locked.\n Unlock before syncing.";
	let langSynced = "No change. Current data is synced.\n(Press Import if display does not match.)";
	let langSyncEmpty = "No change. Source data is empty.";

	if(getTranslationByKey("sync-button") != false){
	langSync = getTranslationByKey("sync-button");
	langCustomAilments = getTranslationByKey("editor-customailments");
	langSyncSuccess = getTranslationByKey("pop-sync-success");
	langSyncFail = getTranslationByKey("pop-sync-fail");
	langSynced = getTranslationByKey("pop-sync-synced");
	langSyncEmpty = getTranslationByKey("pop-sync-empty");

	}

	let syncHeader = langSync;
	let syncBody = "";
	let syncToggle = "0"; 
	let syncCheck = values.syncLockAilment;
	let syncState = values.syncStateAilment;

	if(source != null && source != ""){
	if(source != current && syncCheck != "true"){


	setAttrs({"ailmentEditor":source});

	dataImportRepeating("ailments", "Replace");
	syncBody = langCustomAilments + langSyncSuccess;
	syncToggle = "true"; 
	syncState = "0";

		}
	else if(source != current && syncCheck == "true"){
	syncBody = langCustomAilments + langSyncFail;
	syncToggle = "true"; 

		}
	else if(source == current) {
	syncBody = langSynced;
	syncToggle = "true"; 

		}
	}
	else {
	syncBody = langSyncEmpty;
	syncToggle = "true"; 
	}

	output[`popup_messageHeader`] = syncHeader;
	output[`popup_messageBody`] = syncBody;
	output[`popup_display`] = syncToggle;
	output[`syncStateAilment`] = syncState;

	setAttrs(output);

		});
	});
});

/* Gives a list with the following format: hasNextTurnField, count, nextTurnCount, countImmutable, countDecayPause, repeatingAilmentId, ailmentIconName */
/* countImmutable: Matches the count at the beginning of the AutoEffect execution. Should never be modified */
/* repeatingAilmentId: Is set to 0 for standard ailments */
async function exportAilmentList(overrideList={}, callback=() => {}) {
	getSectionIDs(`repeating_ailments`, idarray => {
	
	let ailmentList = {}
	let ailmentNames = ["Burn", "Bleed", "Paralysis", "Protection", "StaggerProtection", "Fragile", "Strength", "Feeble", "Endurance", "Disarm", "Haste", "Bind", "Smoke", "Charge", "Fortune"];
	const fieldnames = ailmentNames.concat(
		ailmentNames.reduce((rows,ailment) => [...rows, `${ailment}NextTurn`, `${ailment}DecayPause`], ''),
		idarray.reduce((rows,id) => [...rows, `repeating_ailments_${id}_ailName`, `repeating_ailments_${id}_ailNextTurn`,`repeating_ailments_${id}_ailNum`, `repeating_ailments_${id}_ailNumNextTurn`, `repeating_ailments_${id}_ailIcon`, `repeating_ailments_${id}_ailDecayPause`], '')
	);

	getAttrs([...fieldnames, "settingHideNextTurn", "burnNextTurnSetting", "bleedNextTurnSetting", "smokeNextTurnSetting", "chargeNextTurnSetting"], function(values) {
		
		let settingHideNextTurn = values.settingHideNextTurn;
		const HasNextTurn = settingHideNextTurn == "true" ? 'false' : 'true';

		/* Export default ailments */
		ailmentNames.forEach(ailment => {
			if (["Burn", "Bleed", "Smoke", "Charge"].includes(ailment)) {
				let ailmentNextTurnSetting = (settingHideNextTurn == "true") ? "false" : values[ailment.toLowerCase()+"NextTurnSetting"];
				ailmentList[ailment] = [ailmentNextTurnSetting, values[ailment], values[`${ailment}NextTurn`], values[ailment], values[`${ailment}DecayPause`], 0, ailment];
			} else {
				ailmentList[ailment] = [HasNextTurn, values[ailment], values[`${ailment}NextTurn`], values[ailment], values[`${ailment}DecayPause`], 0, ailment];
			}
			if (overrideList.hasOwnProperty(ailment)) {
				ailmentList[ailment][1] = Math.max(overrideList[ailment][0], 0);
				ailmentList[ailment][3] = Math.max(overrideList[ailment][1], 0);
			}
		});

		/* Export custom ailments */
		idarray.forEach(id => {
			let ailName = values[`repeating_ailments_${id}_ailName`].replaceAll(" ","_");

			ailmentList[ailName] = [
				values[`repeating_ailments_${id}_ailNextTurn`],
				values[`repeating_ailments_${id}_ailNum`],
				values[`repeating_ailments_${id}_ailNumNextTurn`],
				values[`repeating_ailments_${id}_ailNum`],
				values[`repeating_ailments_${id}_ailDecayPause`],
				id,
				values[`repeating_ailments_${id}_ailIcon`]
			];

			if (overrideList.hasOwnProperty(ailName)) {
				ailmentList[ailName][1] = Math.max(overrideList[ailName.replaceAll(" ","_")][0], 0);
				ailmentList[ailName][3] = Math.max(overrideList[ailName.replaceAll(" ","_")][1], 0);
			}
		});

		callback(ailmentList);
	});
	});
}

function importAilmentList(ailmentList) {
	let output = {}
	for (const [ailmentName, ailmentValues] of Object.entries(ailmentList)) {
		/* Default ailments */
		if (ailmentValues[5] != 0) {
			output[`repeating_ailments_${ailmentValues[5]}_ailNum`] = ailmentValues[1];
			output[`repeating_ailments_${ailmentValues[5]}_ailNumNextTurn`]  = ailmentValues[2];
			output[`repeating_ailments_${ailmentValues[5]}_ailDecayPause`]  = ailmentValues[4];
		}
		/* Custom ailments */
		else {
			output[`${ailmentName}`] = ailmentValues[1];
			output[`${ailmentName}NextTurn`] = ailmentValues[2];
			output[`${ailmentName}DecayPause`] = ailmentValues[4];
		}
	}
	setAttrs(output);
}


/* Function: Update multiple custom ailments */
/* triggerList: array which contains at least one of None, RoundEnd, OnAction and WhenHit */
/* See updateCustomAilment() function below for details on modes */
function updateCustomAilments(triggerList=["OnAction"], mode="standard", roundEnd="true", callback=() => {}) {
	getSectionIDs(`repeating_ailments`, idarray => {
		let autoScriptOverrideList = {};
		let updatesRemaining = 0;

		/* Immediately callback if no custom ailments exist */
		if (idarray.length == 0) {
			callback({});
		}
		
		const fieldnames = idarray.reduce((rows,id) => [...rows, `repeating_ailments_${id}_ailTrigger`, `repeating_ailments_${id}_ailName`], '');
		getAttrs([...fieldnames], v => {

			idarray.forEach(id => {
	
				let current = v[`repeating_ailments_${id}_ailTrigger`];
	
				/* Update each custom ailment with the requested trigger(s). After the last valid ailment updates, callback */
				if(triggerList.includes(current)) {
					updatesRemaining += 1;
					//console.log(updatesRemaining)
					updateCustomAilment(id, mode, roundEnd, function(returnValues) {
						Object.assign(autoScriptOverrideList, returnValues);
						updatesRemaining -= 1;
						//console.log(updatesRemaining)
						//console.log(v[`repeating_ailments_${id}_ailName`] + ": finished updating")
						if (updatesRemaining == 0) {
							callback(autoScriptOverrideList);
						}
					});
				}
				//console.log(v[`repeating_ailments_${id}_ailName`] + ": " + updatesRemaining);

				/* If no custom ailments have the requested trigger(s), callback */
				if (idarray.indexOf(id) == idarray.length-1 && updatesRemaining == 0) {
					callback({});
				}
			});
		});
	});
}


/* Function: Update custom ailment */
/* Has the following modes : */
/* standard - Triggers both decay and effect */
/* decay - Triggers only decay */
/* effect - Triggers only effect */
function updateCustomAilment(rowid, mode="standard", roundEnd="true", callback=() => {}) {

    getAttrs(["distortState", "egoActiveState", "egoType", "settingWhisperRolls", "settingWhisperTarget", "settingMuteMessage",
		`repeating_ailments_${rowid}_ailNum`, `repeating_ailments_${rowid}_ailNumNextTurn`, `repeating_ailments_${rowid}_ailDecayPause`, `repeating_ailments_${rowid}_ailName`,
		`repeating_ailments_${rowid}_ailIcon`, `repeating_ailments_${rowid}_ailTrigger`, `repeating_ailments_${rowid}_ailEffect`, `repeating_ailments_${rowid}_ailEffectMode`,
		`repeating_ailments_${rowid}_ailEffectVal`, `repeating_ailments_${rowid}_ailDecayWhenHit`, `repeating_ailments_${rowid}_ailCustomResistanceNum`,
		`repeating_ailments_${rowid}_ailCustomResistanceNumEgo`, `repeating_ailments_${rowid}_ailDecayRoundEnd`, `repeating_ailments_${rowid}_ailDecayMode`,
		`repeating_ailments_${rowid}_ailDecayVal`, `repeating_ailments_${rowid}_ailDecayMin`, `repeating_ailments_${rowid}_ailMax`, `repeating_ailments_${rowid}_ailMaxBehavior`,
		`repeating_ailments_${rowid}_ailMessageCheck`, `repeating_ailments_${rowid}_ailMessage`,
		"HP", "StagRes", "SP", "Light", "distortCounter", "difficulty", "baseSpeed", "baseLuckNum", "character_name",
		"THP_Sources", "TST_Sources"], function(values) {

	let charname = values.character_name;
	let nomessage = values.settingMuteMessage;
	let mutemessage = values.settingMuteMessage;
	let hiddenroll = values.settingWhisperRolls;

	let ailname = values[`repeating_ailments_${rowid}_ailName`];
	let icon = values[`repeating_ailments_${rowid}_ailIcon`];
	let count = parseInt(values[`repeating_ailments_${rowid}_ailNum`]);
	let countnextturn = parseInt(values[`repeating_ailments_${rowid}_ailNumNextTurn`]);

	let trigger = values[`repeating_ailments_${rowid}_ailTrigger`];

	let customRes = parseInt(values[`repeating_ailments_${rowid}_ailCustomResistanceNum`]);
	let customResEgo = parseInt(values[`repeating_ailments_${rowid}_ailCustomResistanceNumEgo`]);
	
	let distortState = values.distortState;
	let egoActiveState = values.egoActiveState;
	let egoType = values.egoType;

	let effecttarget = values[`repeating_ailments_${rowid}_ailEffect`];
	let effectmode = values[`repeating_ailments_${rowid}_ailEffectMode`];
	let effectval = values[`repeating_ailments_${rowid}_ailEffectVal`];

	let decayRoundEnd = values[`repeating_ailments_${rowid}_ailDecayRoundEnd`]; 
	let decaypause = parseInt(values[`repeating_ailments_${rowid}_ailDecayPause`]);
	let decaymode = values[`repeating_ailments_${rowid}_ailDecayMode`];
	let decayval = values[`repeating_ailments_${rowid}_ailDecayVal`];
	let decaymin = parseInt(values[`repeating_ailments_${rowid}_ailDecayMin`]);

	if (decaypause > 0) {
		if (trigger != "OnAction" || (trigger == "OnAction" && mode == "standard")) {
			mode = "effect";
			setAttrs({[`repeating_ailments_${rowid}_ailDecayPause`]:decaypause - 1});
		}
	}

	let THP_Sources = {};
	if (values.THP_Sources != "" && values.THP_Sources != "{}") {
		THP_Sources = JSON.parse(values.THP_Sources);
	}
	let TST_Sources = {};
	if (values.TST_Sources != "" && values.TST_Sources != "{}") {
		TST_Sources = JSON.parse(values.TST_Sources);
	}

	let maxcount = parseInt(values[`repeating_ailments_${rowid}_ailMax`]);
	let maxtype = values[`repeating_ailments_${rowid}_ailMaxBehavior`];

	let messagecheck = values[`repeating_ailments_${rowid}_ailMessageCheck`];
	let message = values[`repeating_ailments_${rowid}_ailMessage`]; 

	//console.log("Name: " + name + " | Icon: " + icon + " | Count: " + count + " | Trigger: " + trigger + " | Effect: " + effecttarget + effectmode + effectval + " | Decay: Count " + decaymode + decayval + " | Message: (" + messagecheck + ")" + message);

	let output = { [`repeating_ailments_${rowid}_ailNum`]: count };
	let returnValues = { [ailname]: [count, count] };

	let newcount = parseInt(count);
	let newmessage = message;
	let tempBarMessage = "";

	let targetval = "";
	let result = "";
	let change = "";

	let activateEffect = "true";
	let activateDecay = "true";
	let activateMessage = "";

	if (egoActiveState == "true" && egoType == "Outfit" && distortState != "true") {
		customRes = parseInt(customResEgo);
	}
	else if (distortState == "true") {
		customRes += parseInt(customResEgo);
	}

	/* Mode behaviour */
	if (mode == "decay") { activateEffect = "false"; }
	if (mode == "effect") { activateDecay = "false"; }
	if (trigger == "None" && mode != "standard") {
		activateEffect = "false";
		activateDecay = "false";
	}

	/* Max Behavior Check */
	if(maxcount > 0 && count < maxcount){
		if(maxtype == "Effect" || maxtype == "EffectClear"){
		activateEffect = "false";
		}
		else if(maxtype == "Decay"){
		activateDecay = "false";
		}
		else if(maxtype == "EffectDecay"){
		activateEffect = "false";
		activateDecay = "false";
		}
	}
	else if(maxcount > 0 && count >= maxcount){
		if(maxtype == "Clear" || maxtype == "EffectClear"){
		decaymode = "=";
		decayval = 0;
		}
	}

	/*-- Process Effect --*/
	let effecttargetlist = [];
	if (effecttarget == "HPStagRes") {
		effecttargetlist.push("HP", "StagRes");
	} else {
		effecttargetlist.push(effecttarget);
	}
	
	effecttargetlist.forEach((effecttargetinlist) => {

		targetval = values[`${effecttargetinlist}`];

		if(effecttargetinlist != "None" && effecttargetinlist != null && activateEffect == "true" && count != 0) {
			
			/* Ailment is n or -n multiplied by a number */
			if ((/([0-9]+n)/).test(effectval)) {
				effectval = effectval.replaceAll("n","");
				effectval = parseInt(count) * parseInt(effectval)
			}
			else if ((/(-[0-9]+n)/).test(effectval)) {
				effectval = (0 - parseInt(count)) * parseInt(effectval)
			}
			/* Ailment is n or -n */
			else if (effectval == "n") {
				effectval = parseInt(count);
			}
			else if (effectval == "-n") {
				effectval = (0 - parseInt(count));
			}

			if(effectmode == "+"){
			result = parseInt(targetval) + parseInt(effectval);

			}
			else if(effectmode == "x"){
			result = parseInt(parseInt(targetval) * parseFloat(effectval));

			}
			else if(effectmode == "="){
			result = parseInt(effectval);

			}

			change = parseInt(targetval) - parseInt(result);
			if (change > 0) {
				result += Math.min(change, customRes);
				change -= Math.min(change, customRes);
			}

			/* Temporary bar values */
			let tempBarTarget = "";
			let tempBar_Sources = {};
			if (effecttargetinlist == "HP") { tempBarTarget = "THP"; tempBar_Sources = THP_Sources }
			if (effecttargetinlist == "StagRes") { tempBarTarget = "TST"; tempBar_Sources = TST_Sources }
			
			let tempBarUsed = {}
			if (change > 0 && Object.keys(tempBar_Sources).length > 0) {
				let returnTempBar = applyTempBarDamageAilment(tempBar_Sources, tempBarTarget, change, result, roundEnd);
				result = returnTempBar.newBar;
				change = returnTempBar.damage;
				tempBarUsed = returnTempBar[`${tempBarTarget}Used`];
			}
			for (const sourceName in tempBarUsed) {
				let countUpdate = ` [${parseInt(tempBarUsed[sourceName][0] + tempBarUsed[sourceName][1])} -> ${tempBarUsed[sourceName][0]}]`;
				tempBarMessage += "<b style='opacity: 50%;'><br>(" + sourceName + ": " + tempBarUsed[sourceName][1] + countUpdate + ")</b>";
			}

			output[`${effecttargetinlist}`] = result;

			activateMessage = "true";
		}
	});
	/*-- Process Effect end --*/

	
	/*-- Decay --*/
	if(activateDecay == "true" && count >= decaymin) {
		if ( !(trigger == "OnAction" && roundEnd == "true")) {
			if(decayval == "n") {
			decayval = parseInt(count);
			}
			else if(decayval == "-n"){
			decayval = (0 - parseInt(count));
			}
	
			if(decaymode == "+"){
			newcount = parseInt(count) + parseInt(decayval);	
			}
			else if(decaymode == "x"){
			newcount = parseInt(parseInt(count) * parseFloat(decayval));
			}
			else if(decaymode == "="){
			newcount = parseInt(decayval);
			}
	
			/* Overflow adjustment */
			if(maxcount != 0 && newcount > maxcount){
			newcount = maxcount;
			}
			if(newcount <= 0){
			newcount = 0;
			}
		}
		output[`repeating_ailments_${rowid}_ailNum`] = parseInt(newcount);
		returnValues[ailname][0] = parseInt(newcount);
	}
	if (roundEnd == "true") {
		if (trigger == "WhenHit" && decayRoundEnd != "true") {
			output[`repeating_ailments_${rowid}_ailNum`] = parseInt(count);
		}
		output[`repeating_ailments_${rowid}_ailNum`] += parseInt(countnextturn);
		output[`repeating_ailments_${rowid}_ailNumNextTurn`] = 0;
		returnValues[ailname][0] += parseInt(countnextturn);
	}
	/*-- Decay end --*/

	/* Message */
	if(messagecheck != "0" && activateMessage == "true" && mutemessage != "true"){

		let langEffectValue = "[EVAL]";
		let langDecayValue = "[DVAL]";
		let langName = "[CHAR]";
		let langCount = "[COUNT]";
		let langAilName = "[AIL]";
		let langResult = "[RESULT]";
		let langChange = "[DIFF]";

		/*if(getTranslationByKey("message-match-value") != false){

			langEffectValue = getTranslationByKey("message-match-evalue");
			langDecayValue = getTranslationByKey("message-match-dvalue");
			langName = getTranslationByKey("message-match-name");
			langCount = getTranslationByKey("message-match-count");
			langAilName = getTranslationByKey("message-match-ailment");
			langResult = getTranslationByKey("message-match-result");
			langChange = getTranslationByKey("message-match-change");
			}*/
		
		message = message.replaceAll(langEffectValue, "<b>" + effectval + "</b>");
		message = message.replaceAll(langDecayValue, "<b>" + decayval + "</b>");
		message = message.replaceAll(langName,  "<b>" + charname + "</b>");
		message = message.replaceAll(langCount, "<b>" + count + "</b>");
		message = message.replaceAll(langAilName, "<b>" + ailname + "</b>");
		message = message.replaceAll(langResult, "<b>" + result + "</b>");
		message = message.replaceAll(langChange, "<b>" + change + "</b>");

		if (customRes != 0) {
			message += `<b style='opacity: 50%;'><br>(Resistance: ${customRes})</b>`
		}
		newmessage = message;

		let iconnew = "";

		if(icon == "Question"){
		iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/icons/question.png' style='width: 25px; height: 25px;' >";
		}
		if(icon != "Question" && icon != "None"){
		iconnew = "<img src='https://raw.githubusercontent.com/punibird/roll20-character-sheets/master/ProjectMoonTRPG/images/ailments/"+ icon +".png' style='width: 25px; height: 25px;' >";
		}
		newmessage = iconnew + newmessage + tempBarMessage;

		/* Whisper roll */
		let whisperrolls = values.settingWhisperRolls;
		let whispertarget = values.settingWhisperTarget;
		let whisper = "";
		if(whisperrolls == "true"){
		whisper = "/w " + whispertarget;
			}

		setAttrs({"dummy":newmessage});

		/*--- Send roll --*/
		startRoll((whisper + "&{template:message} {{icon=@{dummy}}}"), (results) => {
			finishRoll(results.rollId, { });
		});

		setAttrs({"dummy":" "});
	}
	/*--Message end --*/

	/* Apply to target */
	setAttrs(output);
	if (count != 0) {
		callback(returnValues);
	} else {
		callback();
	}
	});
}

/* Update: Edit Mode state */
on("change:global_editMode", function() {

getAttrs(["global_editMode"], function(values) {
	let state = values.global_editMode;

	if(state != "true"){
	    setAttrs({ "sheetTab": "equipment" });
	}

	});
});

/* Access PW Check */
on("change:global_access", function() {
getSectionIDs("repeating_global", function(idarray) {

	let id = idarray[0];

        getAttrs([`repeating_global_${id}_editKey`, "global_access", "global_accessCheck"], function(values) {

		/* Translation prep */
		let langEditMode = "Edit Mode";
		let langPasswordError = "Wrong password.";

		if(getTranslationByKey("pop-editmode") != false){

		langEditMode = getTranslationByKey("pop-editmode");
		langPasswordError = getTranslationByKey("pop-pwerror");
		}

		const output = {};

		let state = "0";
		let popupdisplay = "0";

		let internalpw = values[`repeating_global_${id}_editKey`];
		let accesspw = values.global_access;       
 
		if(internalpw == accesspw){
		state = "true";
		}
		else if(internalpw == null || internalpw == ""){
		state = "true";
		}
		else {
		output[`popup_messageHeader`] = langEditMode;
		output[`popup_messageBody`] = langPasswordError;

		popupdisplay = "true";
		state = "0";
		}

		output[`popup_display`] = popupdisplay;
		output["global_accessCheck"] = state;

		setAttrs(output);

		});
	});
});

/* Sheet Initialization */
on("sheet:opened", function() { 
getSectionIDs("repeating_global", function(idarray) {

	/* Message Setup */
	let syncHeader = "";
	let syncBody = "";
	let syncToggle = "0"; 
	const output = {};

	setAttrs({"popup_messageHeader":"", "popup_messageBody":"", "popup_display":"0"});


	let rowid = "";

	/* Global Settings Check */
	if(idarray.length >= 1){
	rowid = idarray[0];
	
	}
	else if(idarray.length == 0) {
	rowid = generateRowID();
	//syncBody += "Initialize game settings. ID: " + rowid + "\n";
	//syncToggle = "true"; 

	output[`repeating_global_${rowid}_ruleName`] = "";

	}

    getAttrs(["syncStateGame", "syncStateAilment", "syncLockGame", "syncLockAilment",
	"global_access", "global_editMode", "global_editKey", "global_gameSettingSource", "global_ailmentSettingSource", "global_sheetSettingSource", "gameEditor", "ailmentEditor",
	`repeating_global_${rowid}_editKey`, `repeating_global_${rowid}_gameSettingSource`, `repeating_global_${rowid}_ailmentSettingSource`, `repeating_global_${rowid}_sheetSettingSource`,
	"settingEvdInfluence", "settingTestOption", "autoScriptStyling", "autoScriptEditorTarget", "autoScriptEditorInput",
	"weapon1AutoScript", "weapon2AutoScript", "weapon3AutoScript", "weapon4AutoScript", "augmentAutoScript", "outfitAutoScript",
	"tool1AutoScript", "tool2AutoScript", "tool3AutoScript", "tool4AutoScript", "special1AutoScript", "special2AutoScript",
	"skill1AutoScript", "skill2AutoScript", "skill3AutoScript", "skill4AutoScript", "skill5AutoScript", "skill6AutoScript",
	"egoSkill1AutoScript", "egoSkill2AutoScript", "egoSkill3AutoScript", "egoSkill4AutoScript", "egoSkill5AutoScript", "egoSkill6AutoScript"], function(values) {

	/* Translation prep */
	let langUpdate = "Update";
	let langGameSettings = "Game Settings";
	let langCustomAilments = "Custom Ailments";
	let langSheetSettings = "Sheet Settings";
	let langSyncSuccess = "Update synced.";
	let langSyncFail = "Update detected, but section is locked.";

	if(getTranslationByKey("pop-update") != false){

	langUpdate = getTranslationByKey("pop-update");
	langGameSettings = getTranslationByKey("editor-gamesettings");
	langCustomAilments = getTranslationByKey("editor-customailments");
	langSheetSettings = getTranslationByKey("editor-sheetsettings")
	langSyncSuccess = getTranslationByKey("pop-update-success");
	langSyncFail = getTranslationByKey("pop-update-fail");
	}

	let lockGame = values.syncLockGame;
	let syncGame = values.syncStateGame;
	let lockAilment = values.syncLockAilment;
	let syncAilment = values.syncStateAilment;

	let gameSettings = values[`repeating_global_${rowid}_gameSettingSource`];
	let ailmentSettings = values[`repeating_global_${rowid}_ailmentSettingSource`];
	let sheetSettings = values[`repeating_global_${rowid}_sheetSettingSource`];

	let updateFlagGame = "0";
	let updateFlagAilments = "0";
	let updateFlagSheet = "0";

	let passCompare = values[`repeating_global_${rowid}_editKey`];
	let passInput = values.global_access;

	let comparekey = rowid.toLowerCase();

	/* Check: External (Default Sheet Settings) updates */
		if(values.global_editKey.toLowerCase() != comparekey){
			output[`repeating_global_${rowid}_editKey`] = values.global_editKey;
			output["global_editKey"] = rowid;

			passCompare = values.global_editKey;
		}

		if(values.global_gameSettingSource != null && values.global_gameSettingSource.toLowerCase() != comparekey){
			output[`repeating_global_${rowid}_gameSettingSource`] = values.global_gameSettingSource;
			output["global_gameSettingSource"] = rowid;
			gameSettings = values.global_gameSettingSource;

			updateFlagGame = "true";
		}

		if(values.global_ailmentSettingSource != null && values.global_ailmentSettingSource.toLowerCase() != comparekey){
			output[`repeating_global_${rowid}_ailmentSettingSource`] = values.global_ailmentSettingSource;
			output["global_ailmentSettingSource"] = rowid;
			ailmentSettings = values.global_ailmentSettingSource;

			updateFlagAilments = "true";
		}

		if(values.global_sheetSettingSource != null && values.global_sheetSettingSource.toLowerCase() != comparekey){
			output[`repeating_global_${rowid}_sheetSettingSource`] = values.global_sheetSettingSource;
			output["global_sheetSettingSource"] = rowid;
			sheetSettings = values.global_sheetSettingSource;

			updateFlagSheet = "true";
		}


	/* Check: PW updates */ 
	if(passCompare != passInput && passCompare != ""){
	output["global_accessCheck"] = "0";

	}
	else if(passCompare == passInput && passCompare != "") {
	output["global_accessCheck"] = "true";
	}

	if(passCompare == "" || passCompare == null){
	output["global_accessCheck"] = "true";
	}

	/* Check: Internal setting updates */
	if(gameSettings != "" && gameSettings != null && updateFlagGame != "0"){
		if(gameSettings != values.gameEditor && lockGame != "true"){

			setAttrs({"gameEditor":gameSettings});
			dataImport("gameEditor", `repeating_global_${rowid}_`, "global_");
			output["syncStateGame"] = "0";

			syncToggle = "true";
			syncHeader = langUpdate; 
			syncBody += langGameSettings + ": " + langSyncSuccess + "\n";
		}
		else if(gameSettings != values.gameEditor && lockGame == "true"){

			output["syncStateGame"] = "true";

			if(syncGame != "true"){
				syncToggle = "true";
				syncHeader = langUpdate; 
				syncBody += langGameSettings + ": " + langSyncFail + "\n";
			}
		}
	}

	if(ailmentSettings != "" && ailmentSettings != null && updateFlagAilments != "0"){
		if(ailmentSettings != values.ailmentEditor && lockAilment != "true"){

			setAttrs({"ailmentEditor":ailmentSettings});
			dataImportRepeating("ailments", "Replace");
			output["syncStateAilment"] = "0";

			syncToggle = "true";
			syncHeader = langUpdate; 
			syncBody += langCustomAilments + ": " + langSyncSuccess + "\n";
		}
		else if(ailmentSettings != values.ailmentEditor && lockAilment == "true"){

			output["syncStateAilment"] = "true";

			if(syncAilment != "true"){
				syncToggle = "true";
				syncHeader = langUpdate; 
				syncBody += langCustomAilments + ": " + langSyncFail + "\n";
			}
		}
	}

	if(sheetSettings != "" && sheetSettings != null && updateFlagSheet != "0"){

		setAttrs({"editorInput":sheetSettings});
		dataImport();

		syncToggle = "true";
		syncHeader = langUpdate; 
		syncBody += langSheetSettings + ": " + langSyncSuccess + "\n";
	}

	/* Check missing AutoScript styling */
	let autoScriptStyling = values.autoScriptStyling;
	if (autoScriptStyling == "" && !sheetSettings.includes("`AutoScriptStyling`")) {
		loadDefaultAutoScriptStyling();
	}

	/* Delete any AutoScript styling rules present in normal AutoScripts */
	/* There used to be a bug that replaced one AutoScript with the default AutoScript styling rules. This cleans up any sheets affected by the bug */
	/* Should be able to remove this after a few updates have passed and all currently used character sheets have been cleaned (added in update 0.6.3) */
	let colorList = ["green","blue","red","orange","yellow","purple","black"];
	let autoScriptList = ["weapon1", "weapon2", "weapon3", "weapon4", "augment", "outfit", "ego", "tool1", "tool2", "tool3", "tool4", "special1", "special2",
	"skill1", "skill2", "skill3", "skill4", "skill5", "skill6", "egoSkill1", "egoSkill2", "egoSkill3", "egoSkill4", "egoSkill5", "egoSkill6",
	"autoScriptEditorInput"];

	let editorTarget = values.autoScriptEditorTarget;
	autoScriptList.forEach(autoScriptPrefix => {
		let target = `${autoScriptPrefix}AutoScript`;
		if (autoScriptPrefix == "autoScriptEditorInput") {
			if (editorTarget == "autoScriptStyling") {
				return;
			} else {
				target = "autoScriptEditorInput";
			}
		}
		let autoScript = values[target];
		
		colorList.forEach(color => {
			let stylingRegex = new RegExp(`[(].+?,.+?,.+?,.*?${color}.*?[)]`, "ig");
			if (stylingRegex.test(autoScript)) {
				autoScript = autoScript.replaceAll(stylingRegex, "");
				output[target] = autoScript;
			}
		});
	});

	/* Check: Obsolete attributes  */
	let evdInfluence = values.settingEvdInfluence;
	let testRankPower = values.settingTestOption;

	if(evdInfluence == "true"){
	output[`repeating_global_${rowid}_evdAilment`] = "HasteBind";
	output["settingEvdInfluence"] = "0";
	}

	if(testRankPower == "true"){
	output[`repeating_global_${rowid}_attStat`] = "Rank";
	output["settingTestOption"] = "0";
	}


	output[`popup_messageHeader`] = syncHeader;
	output[`popup_messageBody`] = syncBody;
	output[`popup_display`] = syncToggle;

	setAttrs(output);
	});
	});
});


/* --- Generic helper functions --- */

/* Takes in arguments of the format: [returnValue, queryText, {label1:value1, label2:value2, ...}] */
/* Sends one query for each argument included and returns an array of results */
async function sendQuery(...args) {
	let queryList = [];
	args.forEach(arg => { if(arg != [] && arg != "") { queryList.push(arg); } });
	
	let rollBase = "! ";
	queryList.forEach(query => {
		rollBase += `{{${query[0]}=[[0[?{${query[1]}`;
		
		for (const [label, value] of Object.entries(query[2])) {
			rollBase += `|${label},${value}`;
		}

		rollBase += "}]]]}}";
	});

	//?{Name of Query|Label 1, value1|Label 2, value2}
	
	let queryRoll = await startRoll(rollBase);
	
	let queryResults = {}
	queryList.forEach(query => {
		queryResults[query[0]] = queryRoll.results[query[0]].expression.match(/^0\[(.*)\]\s*$/)[1];
	});
    finishRoll(queryRoll.rollId);
	return queryResults;
}

function getIcon(iconFolder, iconName, settingLimbusStyle = "false", style="") {
	if (settingLimbusStyle == "true") {
		return `<img src="https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/ailments/limbus/${iconName.replace("limbus/","")}.png" ${style}>`;
	} else {
		return `<img src="https://raw.githubusercontent.com/beautidemise/roll20-character-sheets/master/ProjectMoonTRPG/imagesResized/${iconFolder}/${iconName}.png" ${style}>`
	}
}

function getColor(color) {
	if (color == undefined) {
		return "#85a874";
	}
	if (!(/^#(?:[0-9a-fA-F]{6}){1,2}$/).test(color)) {
		switch (color.toLowerCase()) {
			case "blue": color = "#7397d1"; break;
			case "red": color = "#c25944"; break;
			case "orange": color = "#cf8c44"; break;
			case "yellow": color = "#dbb748"; break;
			case "purple": color = "#8e7cc3"; break;
			case "black": color = "#000000"; break;
			default: color = "#85a874";
		}
	}
	return color;
}

/* Returns a translation, or a base string if no translation is available */
function getTranslationByKeyCustom(base, key) {
	if (getTranslationByKey(key) != false) {
		return getTranslationByKey(key);
	} else {
		return base;
	}
}

/* Inputs an AutoEffect name written in the current language and returns it back to English */
function getAutoEffectFromTranslation(autoEffect) {
	if (getTranslationByKey("autoeffect-require") == autoEffect) { return "Require"; }
	if (getTranslationByKey("autoeffect-consume") == autoEffect) { return "Consume"; }
	if (getTranslationByKey("autoeffect-custommessage") == autoEffect) { return "CustomMessage"; }
	if (getTranslationByKey("autoeffect-reset") == autoEffect) { return "Reset"; }
	if (getTranslationByKey("autoeffect-gain") == autoEffect) { return "Gain"; }
	if (getTranslationByKey("autoeffect-inflict") == autoEffect) { return "Inflict"; }
	if (getTranslationByKey("autoeffect-give") == autoEffect) { return "Give"; }
	if (getTranslationByKey("autoeffect-set") == autoEffect) { return "Set"; }
	if (getTranslationByKey("autoeffect-add") == autoEffect) { return "Add"; }
	if (getTranslationByKey("autoeffect-multi") == autoEffect) { return "Multi"; }
	if (getTranslationByKey("autoeffect-basedamage") == autoEffect) { return "BaseDamage"; }
	if (getTranslationByKey("autoeffect-flatdamage") == autoEffect) { return "FlatDamage"; }
	if (getTranslationByKey("autoeffect-dicepower") == autoEffect) { return "DicePower"; }
	if (getTranslationByKey("autoeffect-dicemax") == autoEffect) { return "DiceMax"; }
	if (getTranslationByKey("autoeffect-dicecount") == autoEffect) { return "DiceCount"; }
	if (getTranslationByKey("autoeffect-challengeroll") == autoEffect) { return "ChallengeRoll"; }
	if (getTranslationByKey("autoeffect-proc") == autoEffect) { return "Proc"; }
	if (getTranslationByKey("autoeffect-pause") == autoEffect) { return "Pause"; }
	if (getTranslationByKey("autoeffect-speed") == autoEffect) { return "Speed"; }
	return "Unknown: " + autoEffect;
}

/* Inputs a trigger written in the current language and returns it back to English */
function getTriggerFromTranslation(trigger) {
	if (getTranslationByKey("autoeffect-trigger-combatstart") == trigger) { return "Combat start"; }
	if (getTranslationByKey("autoeffect-trigger-roundstart") == trigger) { return "Round start"; }
	if (getTranslationByKey("autoeffect-trigger-permanent") == trigger) { return "Permanent"; }
	if (getTranslationByKey("autoeffect-trigger-damaged") == trigger) { return "Damaged"; }
	if (getTranslationByKey("autoeffect-trigger-damagedhp") == trigger) { return "DamagedHP"; }
	if (getTranslationByKey("autoeffect-trigger-damagedst") == trigger) { return "DamagedST"; }
	if (getTranslationByKey("autoeffect-trigger-damagedsp") == trigger) { return "DamagedSP"; }
	if (getTranslationByKey("autoeffect-trigger-staggered") == trigger) { return "Staggered"; }
	if (getTranslationByKey("autoeffect-trigger-defeated") == trigger) { return "Defeated"; }
	if (getTranslationByKey("autoeffect-trigger-panic") == trigger) { return "Panic"; }
	if (getTranslationByKey("autoeffect-trigger-challenge") == trigger) { return "Challenge"; }
	if (getTranslationByKey("autoeffect-trigger-offensive") == trigger) { return "Offensive"; }
	if (getTranslationByKey("autoeffect-trigger-defensive") == trigger) { return "Defensive"; }
	if (getTranslationByKey("autoeffect-trigger-block") == trigger) { return "Block"; }
	if (getTranslationByKey("autoeffect-trigger-evade") == trigger) { return "Evade"; }
	return "Unknown: " + trigger;
}

/* Inputs an ailment written in the current language and returns it back to English */
function getAilmentFromTranslation(ailment) {
	if (getTranslationByKey("ailments-burn") == ailment) { return "Burn"; }
	if (getTranslationByKey("ailments-bleed") == ailment) { return "Bleed"; }
	if (getTranslationByKey("ailments-paralysis") == ailment) { return "Paralysis"; }
	if (getTranslationByKey("ailments-fragile") == ailment) { return "Fragile"; }
	if (getTranslationByKey("ailments-protection") == ailment) { return "Protection"; }
	if (getTranslationByKey("ailments-stgprotection") == ailment) { return "Stagger Protection"; }
	if (getTranslationByKey("ailments-strength") == ailment) { return "Strength"; }
	if (getTranslationByKey("ailments-endurance") == ailment) { return "Endurance"; }
	if (getTranslationByKey("ailments-haste") == ailment) { return "Haste"; }
	if (getTranslationByKey("ailments-feeble") == ailment) { return "Feeble"; }
	if (getTranslationByKey("ailments-disarm") == ailment) { return "Disarm"; }
	if (getTranslationByKey("ailments-bind") == ailment) { return "Bind"; }
	if (getTranslationByKey("ailments-smoke") == ailment) { return "Smoke"; }
	if (getTranslationByKey("ailments-charge") == ailment) { return "Charge"; }
	if (getTranslationByKey("ailments-fortune") == ailment) { return "Fortune"; }
	return ailment; /* Is presumably a custom ailment */
}

/* Inputs an status bar shorthand written in the current language and returns it back to English */
function getBarFromTranslation(bar) {
	if (getTranslationByKey("bar-health-shortened") == bar) { return "HP"; }
	if (getTranslationByKey("bar-stagres-shortened") == bar) { return "ST"; }
	if (getTranslationByKey("bar-sanity-shortened") == bar) { return "SP"; }
	if ("-" + getTranslationByKey("bar-health-shortened") == bar) { return "-HP"; }
	if ("-" + getTranslationByKey("bar-stagres-shortened") == bar) { return "-ST"; }
	if ("-" + getTranslationByKey("bar-sanity-shortened") == bar) { return "-SP"; }
	if (getTranslationByKey("bar-health-temp-shortest") == bar) { return "THP"; }
	if (getTranslationByKey("bar-stagres-temp-shortest") == bar) { return "TST"; }
	if (getTranslationByKey("bar-light") == bar) { return "Light"; }
	return "Unknown: " + bar;
}

function getAilmentOrBarFromTranslation(input) {
	if (getBarFromTranslation(input) != "Unknown: " + input) { return getBarFromTranslation(input); }
	return getAilmentFromTranslation(input);
}

function getStatFromTranslation(stat) {
	if (getTranslationByKey("stats-instinct") == stat) { return "Fortitude"; }
	if (getTranslationByKey("stats-wisdom") == stat) { return "Prudence"; }
	if (getTranslationByKey("stats-justice") == stat) { return "Justice"; }
	if (getTranslationByKey("stats-charm") == stat) { return "Charm"; }
	if (getTranslationByKey("stats-insight") == stat) { return "Insight"; }
	if (getTranslationByKey("stats-temperance") == stat) { return "Temperance"; }
	return "Unknown: " + stat;
}

function getOptionFromTranslation(option) {
	if (getTranslationByKey("autoeffect-option-scaling") == option) { return "Scaling"; }
	if (getTranslationByKey("autoeffect-option-silent") == option) { return "Silent"; }
	if (getTranslationByKey("autoeffect-option-thisround") == option) { return "this round"; }
	if (getTranslationByKey("autoeffect-option-nextround") == option) { return "next round"; }
	if (getTranslationByKey("autoeffect-option-thiscombat") == option) { return "this combat"; }
	if (getTranslationByKey("autoeffect-option-checksuccess") == option) { return "CheckSuccess"; }
	if (getTranslationByKey("autoeffect-option-checkfailure") == option) { return "CheckFailure"; }
	if (getTranslationByKey("autoeffect-option-checkignore") == option) { return "CheckIgnore"; }
	return "Unknown: " + option;
}

function capitalize(string) {
	return string.charAt(0).toUpperCase() + string.slice(1);
}

// Helper used to package and unpackage data transferred through action buttons
// Read more about this system at https://app.roll20.net/forum/post/10346883/adventures-with-startroll/?pageforid=10346884#post-10346884
const Data = {
    chars: {
        '"': '%quot;',
        ',': '%comma;',
        ':': '%colon;',
        '}': '%rcub;',
        '{': '%lcub;',
    },
    package(data) {
		data = (typeof(data) === 'object') ? JSON.stringify(data) : (typeof(data) === 'string') ? data : null;
        data = (data) ? `${data}`.replace(new RegExp(`[${Object.keys(this.chars)}]`, 'g'), (r) => this.chars[r]) : null;
		return data.replaceAll(']','%rbrack;').replaceAll('[','%lbrack;');
    },
    unpackage(data) {
		data = data.replaceAll('%rbrack;',']').replaceAll('%lbrack;','[');
		data = `${data}`.replace(new RegExp(`(${Object.values(this.chars).join('|')})`, 'g'), (r) => Object.entries(this.chars).find(e=>e[1]===r)[0]);
        return JSON.parse(data);
    }
}

</script>





