<!-- Set up the Tabs -->
<div class="tab-section">
    <input type="radio" class="tab tab1" name="attr_core-tab" value="1" title="Angel" checked="checked"> 
    <span class="tab tab1" style="line-height: 40px;" data-i18n="Angel">Angel</span>
    <input type="radio" class="tab tab2" name="attr_core-tab" value="2" title="Demon"> 
    <span class="tab tab2" style="line-height: 40px;" data-i18n="Demon">Demon</span>
</div>
<div class="main-grid">
	<div class="header-grid">
        <!-- In Nomine logo text -->
        <div class="logo vertical-container" style="grid-column-start:1; grid-row-start:span 2">
            <span class="serif-font vertical-center" data-i18n="In Nomine">In Nomine</span>
        </div>
        <div class="header-entry" style="grid-column-start:2; grid-row-start:1">
            <span class="vertical-center" data-i18n="Name">Name</span>
            <input class="vertical-center" name="attr_name" type="text" title="@{name}">
        </div>
        <div class="header-entry" style="grid-column-start:2; grid-row-start:2;">
            <!-- These hidden checkboxes will hide/show the angel/demon content. -->
            <input type="checkbox" class="tab1 hidden" name="attr_core-tab" value="1" title="Angel" checked="checked" data-i18n-title="Angel">
            <input type="checkbox" class="tab2 hidden" name="attr_core-tab" value="2" title="Demon" data-i18n-title="Demon">
            <span class="angel-section vertical-center" data-i18n="Archangel">Archangel</span>
            <select class="angel-section vertical-center" name="attr_archangel" title="@{archangel}">
                <option value="Blandine" data-i18n="Blandine">Blandine</option>
                <option value="David" data-i18n="David">David</option>
                <option value="Dominic" data-i18n="Dominic">Dominic</option>
                <option value="Eli" data-i18n="Eli">Eli</option>
                <option value="Gabriel" data-i18n="Gabriel">Gabriel</option>
                <option value="Janus" data-i18n="Janus">Janus</option>
                <option value="Jean" data-i18n="Jean">Jean</option>
                <option value="Jordi" data-i18n="Jordi">Jordi</option>
                <option value="Laurence" data-i18n="Laurence">Laurence</option>
                <option value="Marc" data-i18n="Marc">Marc</option>
                <option value="Michael" data-i18n="Michael">Michael</option>
                <option value="Novalis" data-i18n="Novalis">Novalis</option>
                <option value="Yves" data-i18n="Yves">Yves</option>
            </select>
            <span class="demon-section vertical-center" data-i18n="Prince">Prince</span>
            <select class="demon-section vertical-center" name="attr_prince" title="@{prince}">
                <option value="Andrealphus" data-i18n="Andrealphus">Andrealphus</option>
                <option value="Asmodeus" data-i18n="Asmodeus">Asmodeus</option>
                <option value="Baal" data-i18n="Baal">Baal</option>
                <option value="Beleth" data-i18n="Beleth">Beleth</option>
                <option value="Belial" data-i18n="Belial">Belial</option>
                <option value="Haagenti" data-i18n="Haagenti">Haagenti</option>
                <option value="Kobal" data-i18n="Kobal">Kobal</option>
                <option value="Kronos" data-i18n="Kronos">Kronos</option>
                <option value="Lilith" data-i18n="Lilith">Lilith</option>
                <option value="Malphas" data-i18n="Malphas">Malphas</option>
                <option value="Nybbas" data-i18n="Nybbas">Nybbas</option>
                <option value="Saminga" data-i18n="Saminga">Saminga</option>
                <option value="Valefor" data-i18n="Valefor">Valefor</option>
                <option value="Vapula" data-i18n="Vapula">Vapula</option>
            </select>
        </div>
        <div class="header-entry" style="grid-column-start:3; grid-row-start:1">
            <!-- These hidden checkboxes will hide/show the angel/demon content. -->
            <input type="checkbox" class="tab1 hidden" name="attr_core-tab" value="1" title="Angel" checked="checked" data-i18n-title="Angel">
            <input type="checkbox" class="tab2 hidden" name="attr_core-tab" value="2" title="Demon" data-i18n-title="Demon">
            <span class="angel-section vertical-center" data-i18n="Choir">Choir</span>
            <select class="angel-section vertical-center" name="attr_choir" title="@{choir}">
                <option value="Cherubim" data-i18n="Cherubim">Cherubim</option>
                <option value="Elohim" data-i18n="Elohim">Elohim</option>
                <option value="Grigori" data-i18n="Grigori">Grigori</option>
                <option value="Kyriotates" data-i18n="Kyriotates">Kyriotates</option>
                <option value="Malakim" data-i18n="Malakim">Malakim</option>
                <option value="Mercurians" data-i18n="Mercurians">Mercurians</option>
                <option value="Ofanim" data-i18n="Ofanim">Ofanim</option>
                <option value="Seraphim" data-i18n="Seraphim">Seraphim</option>
            </select>
            <span class="demon-section vertical-center" data-i18n="Band">Band</span>
            <select class="demon-section vertical-center" name="attr_band" title="@{band}">
                <option value="Balseraphs" data-i18n="Balseraphs">Balseraphs</option>
                <option value="Djinn" data-i18n="Djinn">Djinn</option>
                <option value="Calabim" data-i18n="Calabim">Calabim</option>
                <option value="Habbalah" data-i18n="Habbalah">Habbalah</option>
                <option value="Impudites" data-i18n="Impudites">Impudites</option>
                <option value="Lilim" data-i18n="Lilim">Lilim</option>
                <option value="Shedim" data-i18n="Shedim">Shedim</option>
            </select>
        </div>
        <div class="header-entry" style="grid-column-start:3; grid-row-start:2">
            <span class="vertical-center" data-i18n="Word">Word</span>
            <input class="vertical-center" name="attr_word" type="text" title="@{word}">
        </div>
        <div class="header-entry" style="grid-column-start:4; grid-row-start:span 2">
            <span style="justify-self:center;" data-i18n="Essence">Essence</span>
            <input class="center-input" name="attr_essence" type="text" style="width:50px;justify-self:center;" title="@{essence}">
        </div>
    </div>
    <!-- Core Stats -->
    <div class="attributes-grid">
        <!--============== Corporeal ==============-->
        <div class="corporeal-grid attribute-padding" style="grid-column:1/6;grid-row:1/4" id="corporeal">
            <div class="core-stats-header" style="grid-column:1/7;grid-row:1/2">
                <span class="serif-font" data-i18n="Corporeal">Corporeal</span>
                <input name="attr_corporeal" type="text" title="@{corporeal}">
            </div>
            <!-- Strength and Agility Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_strength" type="text" title="@{strength}">
                <p data-i18n="Strength">Strength</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4">
                <input class="center-input characteristic" name="attr_agility" type="text" title="@{agility}">
                <p data-i18n="Agility">Agility</p>
            </div>
            <!-- Vessel 1-->
            <div style="grid-column:1/5;grid-row:4/5">
                <input name="attr_vessel1" type="text" title="@{vessel1}">
                <p data-i18n="Vessel">Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:4/5">
                <input name="attr_body1" type="text" title="@{body1}">
                <p data-i18n="Body">Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:4/5">
                <input name="attr_vessel-hits1" type="text" title="@{vessel-hits1}">
                <p data-i18n="Hits">Hits</p>
            </div>
            <!-- Vessel 2-->
            <div style="grid-column:1/5;grid-row:5/6">
                <input name="attr_vessel2" type="text" title="@{vessel2}">
                <p data-i18n="Vessel">Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:5/6">
                <input name="attr_body2" type="text" title="@{body2}">
                <p data-i18n="Body">Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:5/6">
                <input name="attr_vessel-hits2" type="text" title="@{vessel-hits2}">
                <p data-i18n="Hits">Hits</p>
            </div>
            <!-- Vessel 3-->
            <div style="grid-column:1/5;grid-row:6/7">
                <input name="attr_vessel3" type="text" title="@{vessel3}">
                <p data-i18n="Vessel">Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:6/7">
                <input name="attr_body3" type="text" title="@{body3}">
                <p data-i18n="Body">Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:6/7">
                <input name="attr_vessel-hits3" type="text" title="@{vessel-hits3}">
                <p data-i18n="Hits">Hits</p>
            </div>
        </div>
        <!-- Corporeal Textarea -->
        <div class="attribute-padding" style="grid-column:1/6;grid-row-start:4">
            <textarea name="attr_box1" class="large-textarea" title="@{box1}"></textarea>
        </div>
        <!--============== Ethereal ==============-->
        <div class="ethereal-grid attribute-padding" style="grid-column:6/11;grid-row:1/4" id="ethereal">
            <div class="core-stats-header" style="grid-column-start:span 6;grid-row:1/2">
                <span class="serif-font" data-i18n="Ethereal">Ethereal</span>
                <input name="attr_ethereal" type="text" title="@{ethereal}">
            </div>
            <!-- Intelligence and Precision Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_intelligence" type="text" title="@{intelligence}">
                <p data-i18n="Intelligence">Intelligence</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_precision" type="text" title="@{precision}">
                <p data-i18n="Precision">Precision</p>
            </div>
            <!-- Mind and Hits -->
            <div style="grid-column:2/3;grid-row:4/5;">
                <input name="attr_mind" type="text" title="@{mind}">
                <p data-i18n="Mind">Mind</p>
            </div>
            <div style="grid-column:4/5;grid-row:4/5;">
                <input name="attr_mind-hits" type="text" title="@{mind-hits}">
                <p data-i18n="Hits">Hits</p>
            </div>
        </div>
        <!-- Ethereal Textarea -->
        <div class="attribute-padding" style="grid-column:6/11;grid-row-start:4">
            <textarea name="attr_box2" class="large-textarea" title="@{box2}"></textarea>
        </div>
        <!--============== Dissonance ==============-->
        <div class="dissonance" style="grid-column:10/12;grid-row-start:3">
            <input class="center-input" name="attr_dissonance" type="text" title="@{dissonance}">
            <p data-i18n="Dissonance">Dissonance</p>
        </div>
        <!--============== Celestial ==============-->

        <div class="celestial-grid attribute-padding" style="grid-column:11/16;grid-row:1/4" id="celestial">
            <div class="core-stats-header" style="grid-column-start:span 6;grid-row:1/2">
                <span class="serif-font" data-i18n="Celestial">Celestial</span>
                <input name="attr_celestial" type="text" title="@{celestial}">
            </div>
            <!-- Intelligence and Precision Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_will" type="text" title="@{will}">
                <p data-i18n="Will">Will</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_perception" type="text" title="@{perception}">
                <p data-i18n="Perception">Perception</p>
            </div>
            <!-- Mind and Hits -->
            <div style="grid-column:3/4;grid-row:4/5;">
                <input name="attr_soul" type="text" title="@{soul}">
                <p data-i18n="Soul">Soul</p>
            </div>
            <div style="grid-column:5/6;grid-row:4/5;">
                <input name="attr_soul-hits" type="text" title="@{soul-hits}">
                <p data-i18n="Hits">Hits</p>
            </div>
        </div>
        <!-- Celestial Textarea -->
        <div class="attribute-padding" style="grid-column:11/16;grid-row-start:4">
            <textarea name="attr_box3" class="large-textarea" title="@{box3}"></textarea>
        </div>
        <!-- Other boxes -->
        <div class="attribute-padding" style="grid-column:16/21;grid-row-start:span 2" id="boxes">
            <p data-i18n="Attunements &amp; Distinctions">Attunements &amp; Distinctions</p>
            <textarea name="attr_attunements" class="large-textarea" title="@{attunements}"></textarea>
			<p data-i18n="Discord">Discord</p>
			<textarea name="attr_discord" class="large-textarea" title="@{discord}"></textarea>
        </div>
    </div>
</div>
<!--
    This contains a roll button which I will want to implement later.
<div class="section-demon">
    <button name="roll_action" type="roll" value="&amp;{template:default} {{name=?{Description}}} {{Target attribute=[[(2d6)&lt;?{Attribute}]]}} {{Digito Verificador=[[1d6]]}}"></button>
</div>-->
<div class="footer" /> 

<!-- Sheet workers -->
<script type="text/worker">
    // This sheetworker serves to migrate attributes from any old sheets to the new attribute names.
on("sheet:opened", function() {
    console.log("Checking if attribute migration needed.");
    // This checks to see if any of these 5 attributes are in use, which should be sufficient to tell whether the sheet was used before overhaul.
    getAttrs(["nome","Arcanjo","Coro","Corporeo", "Essencia"], function(values) {
        // Gets the attribute if it exists, uses a default of 0 if not.
        let name = values.nome||0;
        let archangel = values.Arcanjo||0;
        let choir = values.Coro||0;
        let corporeal = values.Corporeo||0;
        let essence = values.Essencia||0;
        // If any of these attributes have a value from an old attribute name, then attributes are migrated.
        if(name != 0 || archangel !=0 || choir != 0 || corporeal != 0 || essence != 0) {
            console.log("Attributes need to be migrated");
            // The names of some choirs are different in Portuguese. Archangel names are identical.
            switch (choir) {
                case "Serafim":
                    choir = "Seraphim";
                    break;
                case "Querubim":
                    choir = "Cherubim";
                    break;
                case "Kyriotetes":
                    choir = "Kyriotates";
                    break;
                case "Mercurianos":
                    choir = "Mercurians";
                    break;
                default:
                    break;
            }
            getAttrs(["Coro","Palavra","Veste1","Veste2","Veste3","Corpo1","Corpo2","Corpo3","Força","Agilidade","Etero","Pontos","Mente","Disonacia","Inteligencia","Precisao","cPontos","Alma","Vontade","Precepcao","Sintonias","Discordias"], function(values) {
                // Set all of the attributes from the old sheet
                // First the 5 test attributes which have already been called, then the rest
                setAttrs({
                    "name":name,
                    "archangel":archangel,
                    "choir":choir,
                    "essence":essence,
                    "corporeal":corporeal, 
                    "word":values.Palavra,
                    "vessel1":values.Veste1,
                    "vessel2":values.Veste2,
                    "vessel3":values.Veste3,
                    "body1":values.Corpo1,
                    "body2":values.Corpo2,
                    "body3":values.Corpo3,
                    "strength":values.Força,
                    "agility":values.Agilidade,
                    "ethereal":values.Etero,
                    "mind-hits":values.Pontos,
                    "mind":values.Mente,
                    "dissonance":values.Disonacia,
                    "intelligence":values.Inteligencia,
                    "precision":values.Precisao,
                    "soul-hits":values.cPontos,
                    "soul":values.Alma,
                    "will":values.Vontade,
                    "perception":values.Precepcao,
                    "attunements":values.Sintonias,
                    "discord":values.Discordias
                });
                console.log("Finished migration of attributes.");
                // Set the key old attribute names of the sheet to 0 to prevent the sheetworker from running again.
                setAttrs({
                    "nome":"0",
                    "Arcanjo":0,
                    "Coro":0,
                    "Corporeo":0,
                    "Essencia":0
                });
            });
        }
        else {
            console.log("No attributes need to be migrated.");
        }
    });
});
</script>
