<input type='hidden' class='sheet-typetoggle' name='attr_sheetType' value='pc' xmlns="http://www.w3.org/1999/html"/>
<div class="sheet-settings">
    <span data-i18n="settings-u"></span><span>&nbsp;</span>
    <input type="checkbox" name="attr_ro_default_show" class="sheet-hider sheet-crate" value="1"/><span></span>
    <input type="checkbox" name="attr_ro_default_show" class="sheet-hider sheet-hidden" value="1"/>
    <div class="sheet-body">
        <div>
            <span data-i18n="sheettype-u">Sheet Type:</span>
            <input type='hidden' class='sheet-typeshow' name='attr_sheetTypeShow' value='pc'/>
            <button type="action" name="act_pc" class="sheet-type sheet-type-pc" data-i18n="pc-u">PC</button>
            <button type="action" name="act_npc" class="sheet-type sheet-type-npc" data-i18n="npc-u">NPC</button>
            <button type="action" name="act_animal" class="sheet-type sheet-type-animal" data-i18n="animal-u">Animal</button>
            <button type="action" name="act_ship" class="sheet-type sheet-type-ship" data-i18n="ship-u">Ship</button>
            <button type="action" name="act_vehicle" class="sheet-type sheet-type-vehicle" data-i18n="vehicle-u">Vehicle</button>
            <button type="action" name="act_trade" class="sheet-type sheet-type-trade" data-i18n="trade-u">Trade
            </button>
        </div>
        <span data-i18n="rollbehaviour-u">Roll behaviour:</span> <span> <select name="attr_ro_default">
        <option value="1" data-i18n="legacy-u">Legacy</option>
        <option value="2" data-i18n="prompt-u">Prompt</option>
        <option selected value="3" data-i18n="toggle-u">Toggle</option>
    </select> </span> <span data-i18n="askmodifier-u">Ask for Modifier?</span> <span> <select name="attr_mod_default">
        <option value="1" data-i18n="yes-u">Yes</option>
        <option value="2" data-i18n="no-u">No</option>
        <option selected value="3" data-i18n="toggle-u">Toggle</option>
    </select> </span> <input type="checkbox" name="attr_initiative_effect" value="-8" class="sheet-button">
        <span class="sheet-button sheet-checkbox-option">Initiative Effect</span>
    </div>
    <span>
        <input type="hidden" name="attr_ro_default" class="sheet-roll-switch">
        <input type="hidden" name="attr_mod_default" class="sheet-mod-switch" value="3">
        <span class="sheet-roll_toggle">
            <span data-i18n="rolltype-u"></span>
            <input type="hidden" class="sheet-rollselect" name="attr_ro_toggle_sel" value="normal"/>
            <button type="action" class="sheet-button sheet-roll_boon" name="act_boon">
                <span class="sheet-button_header" data-i18n="boon-u"></span>
            </button>
            <button type="action" class="sheet-button sheet-roll_normal" name="act_normal">
                <span class="sheet-button_header" data-i18n="normal-u"></span>
            </button>
            <button type="action" class="sheet-button sheet-roll_bane" name="act_bane">
                <span class="sheet-button_header" data-i18n="bane-u"></span>
            </button>
        </span>
        <span>&nbsp;&nbsp;</span>
        <span class="sheet-mod_toggle"> <span data-i18n="modprompt-u"></span>
            <input type="hidden" class="sheet-modselect" name="attr_mod_toggle_sel" value="yes"/>
            <button type="action" class="sheet-button sheet-mod_yes" name="act_modyes">
                <span class="sheet-button_header" data-i18n="yes-u"></span>
            </button>
            <button type="action" class="sheet-button sheet-mod_no" name="act_modno">
                <span class="sheet-button_header" data-i18n="no-u"></span>
            </button>
        </span>
        <span>&nbsp;&nbsp;</span>
        <input type="checkbox" name="attr_whispertoggle" value="/w gm" class="sheet-button"/>
        <span class="sheet-button sheet-checkbox-option" data-i18n="whisper-u"></span>
    </span>
</div><!--    Top Bar -->
<div class="sheet-topbar">
    <div class='sheet-characteristics-wrapper'>
        <div class="sheet-laf-characteristics">
            <span>
                <button type="action" class="sheet-tight_button sheet-roll_stats" name="act_roll-stats">&#9860;&#9860;</button>
            </span>
            <span data-i18n="rating-u">Rating</span>
            <span data-i18n="temp-u">Temp</span>
            <span data-i18n="mod-u">Mod</span>
            <span></span>
            <span data-i18n="rating-u">Rating</span>
            <span data-i18n="temp-u">Temp</span>
            <span data-i18n="mod-u">Mod</span>
            <span></span>
            <span data-i18n="rating-u">Rating</span>
            <span data-i18n="temp-u">Temp</span>
            <span data-i18n="mod-u">Mod</span>
        </div>
        <div class="sheet-laf-characteristics">
            <span>
                <button class="sheet-button" name="roll_Strength" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{strength-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Strength}[STR] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="strength-u">Strength</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Strength" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Strength" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Strength" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Strength" value="0"/></span>

            <span>
                <button class="sheet-button" name="roll_Dexterity" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{dexterity-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Dexterity}[DEX] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="dexterity-u">Dexterity</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Dexterity" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Dexterity" value="0"/></span> <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Dexterity" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Dexterity" value="0"/></span>

            <span>
                <button class="sheet-button" name="roll_Endurance" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{endurance-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Endurance}[END] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="endurance-u">Endurance</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Endurance" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Endurance" value="0"/></span> <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Endurance" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Endurance" value="0"/></span>

            <span>
                <button class="sheet-button" name="roll_Intellect" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{intellect-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Intellect}[INT] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="intellect-u">Intellect</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Intellect" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Intellect" value="0"/></span> <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Intellect" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Intellect" value="0"/></span>

            <span>
                <button class="sheet-button" name="roll_Education" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{education-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Education}[EDU] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="education-u">Education</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Education" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Education" value="0"/></span> <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Education" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Education" value="0"/></span>

            <span>
                <button class="sheet-button" name="roll_Social" type="roll" value='@{whispertoggle}&{template:skill-attrib} {{skill=^{social-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-Social}[SOC] @{ro_default_mod}]] }}  }}'>
                    <span class="sheet-button_header" data-i18n="social-u">Social</span>
                </button>
            </span> <span><input type="number" class="sheet-input sheet-bold" name="attr_base-Social" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-norm" name="attr_injury-Social" value="0"/></span>
            <span><input type="number" class="sheet-input sheet-mod" name="attr_mod-Social" value="0"/></span>
            <span class="sheet-hidden"><input type="hidden" name="attr_calc-Social" value="0"/></span>
        </div>
    </div> <!-- 'sheet-characteristics-wrapper' -->

    <div class='sheet-charmancer_stats-wrapper sheet-hidden'>
      <div class='sheet-charmancer_stats-header'>
        <span class='sheet-charmancer_roll-panel'>
          <span data-i18n='method-u'>Method: </span>
          <select name='attr_charmancer_roll_method'>
            <option value='[[2d6]]'    data-i18n='2d6-u' selected>2d6</option>
            <option value='[[2d6r<1]]' data-i18n='2d6reroll1s-u'>2d6 reroll 1&apos;s</option>
            <option value='yolo'       data-i18n='yolo-u'>YOLO</option>
          </select>
          <button type='action' name='act_generate-stats' class='sheet-button sheet-proceed_button' data-i18n='generate-u'>Generate</button>
          </span>
      </div> <!-- 'sheet-charmancer_stats-header -->

      <div class='sheet-charmancer_stats-content'>
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll1'/>
          <span>
            <input  id='roll1-str' type='radio' name='attr_charmancer_roll1_assignment' value='base-Strength' checked/>
            <label for='roll1-str'>STR</label>
            <input  id='roll1-dex' type='radio' name='attr_charmancer_roll1_assignment' value='base-Dexterity'/>
            <label for='roll1-dex'>DEX</label>
            <input  id='roll1-end' type='radio' name='attr_charmancer_roll1_assignment' value='base-Endurance'/>
            <label for='roll1-end'>END</label>
            <input  id='roll1-int' type='radio' name='attr_charmancer_roll1_assignment' value='base-Intellect'/>
            <label for='roll1-int'>INT</label>
            <input  id='roll1-edu' type='radio' name='attr_charmancer_roll1_assignment' value='base-Education'/>
            <label for='roll1-edu'>EDU</label>
            <input  id='roll1-soc' type='radio' name='attr_charmancer_roll1_assignment' value='base-Social'/>
            <label for='roll1-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll2'/>
          <span>
            <input  id='roll2-str' type='radio' name='attr_charmancer_roll2_assignment' value='base-Strength'/>
            <label for='roll2-str'>STR</label>
            <input  id='roll2-dex' type='radio' name='attr_charmancer_roll2_assignment' value='base-Dexterity' checked/>
            <label for='roll2-dex'>DEX</label>
            <input  id='roll2-end' type='radio' name='attr_charmancer_roll2_assignment' value='base-Endurance'/>
            <label for='roll2-end'>END</label>
            <input  id='roll2-int' type='radio' name='attr_charmancer_roll2_assignment' value='base-Intellect'/>
            <label for='roll2-int'>INT</label>
            <input  id='roll2-edu' type='radio' name='attr_charmancer_roll2_assignment' value='base-Education'/>
            <label for='roll2-edu'>EDU</label>
            <input  id='roll2-soc' type='radio' name='attr_charmancer_roll2_assignment' value='base-Social'/>
            <label for='roll2-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll3'/>
          <span>
            <input  id='roll3-str' type='radio' name='attr_charmancer_roll3_assignment' value='base-Strength'/>
            <label for='roll3-str'>STR</label>
            <input  id='roll3-dex' type='radio' name='attr_charmancer_roll3_assignment' value='base-Dexterity'/>
            <label for='roll3-dex'>DEX</label>
            <input  id='roll3-end' type='radio' name='attr_charmancer_roll3_assignment' value='base-Endurance' checked/>
            <label for='roll3-end'>END</label>
            <input  id='roll3-int' type='radio' name='attr_charmancer_roll3_assignment' value='base-Intellect'/>
            <label for='roll3-int'>INT</label>
            <input  id='roll3-edu' type='radio' name='attr_charmancer_roll3_assignment' value='base-Education'/>
            <label for='roll3-edu'>EDU</label>
            <input  id='roll3-soc' type='radio' name='attr_charmancer_roll3_assignment' value='base-Social'/>
            <label for='roll3-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll4'/>
          <span>
            <input  id='roll4-str' type='radio' name='attr_charmancer_roll4_assignment' value='base-Strength'/>
            <label for='roll4-str'>STR</label>
            <input  id='roll4-dex' type='radio' name='attr_charmancer_roll4_assignment' value='base-Dexterity'/>
            <label for='roll4-dex'>DEX</label>
            <input  id='roll4-end' type='radio' name='attr_charmancer_roll4_assignment' value='base-Endurance'/>
            <label for='roll4-end'>END</label>
            <input  id='roll4-int' type='radio' name='attr_charmancer_roll4_assignment' value='base-Intellect' checked/>
            <label for='roll4-int'>INT</label>
            <input  id='roll4-edu' type='radio' name='attr_charmancer_roll4_assignment' value='base-Education'/>
            <label for='roll4-edu'>EDU</label>
            <input  id='roll4-soc' type='radio' name='attr_charmancer_roll4_assignment' value='base-Social'/>
            <label for='roll4-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll5'/>
          <span>
            <input  id='roll5-str' type='radio' name='attr_charmancer_roll5_assignment' value='base-Strength'/>
            <label for='roll5-str'>STR</label>
            <input  id='roll5-dex' type='radio' name='attr_charmancer_roll5_assignment' value='base-Dexterity'/>
            <label for='roll5-dex'>DEX</label>
            <input  id='roll5-end' type='radio' name='attr_charmancer_roll5_assignment' value='base-Endurance'/>
            <label for='roll5-end'>END</label>
            <input  id='roll5-int' type='radio' name='attr_charmancer_roll5_assignment' value='base-Intellect'/>
            <label for='roll5-int'>INT</label>
            <input  id='roll5-edu' type='radio' name='attr_charmancer_roll5_assignment' value='base-Education' checked/>
            <label for='roll5-edu'>EDU</label>
            <input  id='roll5-soc' type='radio' name='attr_charmancer_roll5_assignment' value='base-Social'/>
            <label for='roll5-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
        <div class='sheet-charmancer_stat-panel'>
          <input type='text' name='attr_charmancer_roll6'/>
          <span>
            <input  id='roll6-str' type='radio' name='attr_charmancer_roll6_assignment' value='base-Strength'/>
            <label for='roll6-str'>STR</label>
            <input  id='roll6-dex' type='radio' name='attr_charmancer_roll6_assignment' value='base-Dexterity'/>
            <label for='roll6-dex'>DEX</label>
            <input  id='roll6-end' type='radio' name='attr_charmancer_roll6_assignment' value='base-Endurance'/>
            <label for='roll6-end'>END</label>
            <input  id='roll6-int' type='radio' name='attr_charmancer_roll6_assignment' value='base-Intellect'/>
            <label for='roll6-int'>INT</label>
            <input  id='roll6-edu' type='radio' name='attr_charmancer_roll6_assignment' value='base-Education'/>
            <label for='roll6-edu'>EDU</label>
            <input  id='roll6-soc' type='radio' name='attr_charmancer_roll6_assignment' value='base-Social' checked/>
            <label for='roll6-soc'>SOC</label>
          <span>
        </div> <!-- sheet-charmancer_stat-panel -->
      </div> <!-- 'sheet-charmancer_stats-content -->

      <div class='sheet-charmancer_stats-footer'>
        <span class='sheet-charmancer_actions-panel'>
          <button type='action' name='act_assign-stats' class='sheet-button sheet-proceed_button' data-i18n='assign-u'>Assign</button>
          <button type='action' name='act_cancel-roll-stats' class='sheet-button sheet-cancel_button' data-i18n='cancel-u'>Cancel</button>
        </span>
      </div> <!-- 'sheet-charmancer_stats-footer -->
    </div> <!-- 'sheet-charmancer_stats-wrapper' -->
</div>

<div class="sheet-pc">
    <input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='prime'/>
    <button type="action" name="act_prime" class="sheet-tab sheet-but-prime" data-i18n="prime-u">Prime</button>
    <button type="action" name="act_skills" class="sheet-tab sheet-but-skills" data-i18n="skillstitle-u">Skills</button>
    <button type="action" name="act_inventory" class="sheet-tab sheet-but-inventory" data-i18n="inventory-u">Inventory</button>
    <button type="action" name="act_combat" class="sheet-tab sheet-but-combat" data-i18n="skills-combat-u">Combat</button>
    <button type="action" name="act_powers" class="sheet-tab sheet-but-powers" data-i18n="powerstitle-u">Powers</button>
    <button type="action" name="act_notes" class="sheet-tab sheet-but-notes" data-i18n="notestitle-u">Notes</button>
    <!--    Prime  -->
    <div class="sheet-tab-content sheet-prime sheet-pc">
        <br>
        <div class='sheet-laf-centredgrid sheet-laf-2colrow'>
            <div class="sheet-redborder">
                <div class='sheet-laf-centredgrid sheet-laf-2colrow12'>
                    <span class="sheet-header" data-i18n="name-u">Name</span>
                    <input type="text" class="sheet-input" name="attr_character_name"/>
                    <span class="sheet-header" data-i18n="age-u">Age</span>
                    <input type="text" class="sheet-input" name="attr_character_age"/>
                    <span class="sheet-header" data-i18n="homeworld-u">Homeworld</span>
                    <input type="text" class="sheet-input" name="attr_character_Homeworld1"/>
                    <span class="sheet-header" data-i18n="race-u">Race</span>
                    <input type="text" class="sheet-input" name="attr_character_race"/>
                    <span class="sheet-header" data-i18n="rads-u">Rads</span>
                    <input type="text" class="sheet-input" name="attr_character_rads"/>
                    <span class="sheet-header" data-i18n="movement-u">Movement</span>
                    <span><input type="number" class="sheet-input" name="attr_character_movement" value="6"/><strong>m</strong></span>


                </div>
            </div>
            <div class="sheet-redborder">
                <h3 data-i18n="studyperiod-u">Study Period</h3>
                <div class='sheet-laf-centredgrid sheet-laf-3colrow113'>
                    <div class="sheet-header" data-i18n="studyweeks-u" name="attr_studyweeks">Weeks</div>
                    <div class="sheet-header" data-i18n="studyperiods-u" name="attr_studyperiods">Periods</div>
                    <div class="sheet-header" data-i18n="studyskill-u" name="attr_studyskill">Skill</div>
                </div>
                <div class='sheet-laf-centredgrid sheet-laf-3colrow113'>
                    <input type="number" class="sheet-input" name="attr_study-weeks" value="0"/>
                    <input type="number" class="sheet-input" name="attr_study-periods" value="0"/>
                    <input type="text" class="sheet-input" name="attr_study-skill"/>
                </div>
                <textarea class="sheet-armournote" name="attr_studynotes" placeholder="Study Notes"></textarea>
            </div>
        </div>
        <br>
        <div class="sheet-redborder">
            <h3 data-i18n="characteristics-u">Characteristics</h3>
            <div class="sheet-laf-centredgrid sheet-laf-custom-characteristics">
                <span class="sheet-header">Name</span>
                <span class="sheet-header">Rating</span>
                <span class="sheet-header">Temp</span>
                <span class="sheet-header">Mod</span>
                <span></span>
            </div>
            <fieldset class="repeating_characteristic">
                <div class="sheet-laf-centredgrid sheet-laf-custom-characteristics">
                    <input class="sheet-redbold" type="text" name="attr_name">
                    <input type="number" class="sheet-input sheet-bold" name="attr_base" value="0">
                    <input type="number" class="sheet-input sheet-norm" name="attr_injury" value="0">
                    <input type="number" class="sheet-input sheet-mod" name="attr_modifier" value="0">
                    <button class="sheet-button btn sheet-weaponrollbutton" name="act_characteristic" type="action">b</button>
                    <input type="hidden" name="attr_calc" value="0"/>
                </div>
            </fieldset>
        </div>
        <br>
        <div class="sheet-redborder">
            <h3 data-i18n="characterhistorytitle-u">Character History</h3>
            <textarea name="attr_character_history" placeholder="Character History" class="sheet-laf-borderbox"></textarea>
        </div>
        <br>
        <div class="sheet-tabbed-panel sheet-redborder">
            <h3 data-i18n="recenthistory-u">Recent History</h3>
            <fieldset class="repeating_history">
                <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1313">
                    <span data-i18n="recenteventname-u">Event Name</span>
                    <input class="sheet-input" type="text" name="attr_history-event"/>
                    <span data-i18n="recenteventdate-u">Event Date</span>
                    <input class="sheet-input" type="text" name="attr_history-date"/>
                    <textarea name="attr_note-history" placeholder="Event Details"></textarea>
                </div>
                <br>
            </fieldset>
        </div>
        <br>
        <div class="sheet-tabbed-panel sheet-redborder">
            <div class="sheet-row-panel">
                <h3 data-i18n="alliestitle-u">Allies</h3>
                <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                </div>
                <fieldset class="repeating_allies">
                    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                        <input class="sheet-input" type="text" name="attr_name-allies" placeholder="Allies Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-allies" placeholder="Sector"/>
                        <input class="sheet-input" type="text" name="attr_name-allies2" placeholder="Allies Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-allies2" placeholder="Sector"/>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-allies" placeholder="Allies Notes"></textarea>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-allies2" placeholder="Allies Notes"></textarea>
                    </div>
                    <br>
                </fieldset>
            </div>
        </div>
        <div class="sheet-tabbed-panel sheet-redborder">
            <div class="sheet-row-panel">
                <h3 data-i18n="contacttitle-u">Contacts</h3>
                <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                </div>
                <fieldset class="repeating_contact">
                    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                        <input class="sheet-input" type="text" name="attr_name-contact" placeholder="Contact Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-contact" placeholder="Sector"/>
                        <input class="sheet-input" type="text" name="attr_name-contact2" placeholder="Contact Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-contact2" placeholder="Sector"/>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-contact" placeholder="Contact Notes"></textarea>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-contact2" placeholder="Contact Notes"></textarea>

                    </div>
                    <br>
                </fieldset>
            </div>
        </div>
        <div class="sheet-tabbed-panel sheet-redborder">
            <div class="sheet-row-panel">
                <h3 data-i18n="enemiestitle-u">Enemies</h3>
                <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                </div>
                <fieldset class="repeating_enemy">
                    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                        <input class="sheet-input" type="text" name="attr_name-enemy" placeholder="Enemy Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-enemy" placeholder="Sector"/>
                        <input class="sheet-input" type="text" name="attr_name-enemy2" placeholder="Enemy Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-enemy2" placeholder="Sector"/>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-enemy" placeholder="Enemy Notes"></textarea>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-enemy2" placeholder="Enemy Notes"></textarea>

                    </div>
                    <br>
                </fieldset>
            </div>
        </div>
        <div class="sheet-tabbed-panel sheet-redborder">
            <div class="sheet-row-panel">
                <h3 data-i18n="rivalstitle-u">Rivals</h3>
                <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                    <h5 data-i18n="name-u">Name</h5>
                    <h5 data-i18n="location-u">Location</h5>
                </div>
                <fieldset class="repeating_rivals">
                    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-4colrow1111">
                        <input class="sheet-input" type="text" name="attr_name-rivals" placeholder="rivals Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-rivals" placeholder="Sector"/>
                        <input class="sheet-input" type="text" name="attr_name-rivals2" placeholder="rivals Name"/>
                        <input class="sheet-input" type="text" name="attr_reference-rivals2" placeholder="Sector"/>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-rivals" placeholder="Rivals Notes"></textarea>
                        <textarea wrap="soft" class="sheet-laf-spangrid-textarea" name="attr_note-rivals2" placeholder="Rivals Notes"></textarea>

                    </div>
                    <br>
                </fieldset>
            </div>
        </div>
    </div>
    <!--    Skills  -->
    <div class="sheet-tab-content sheet-skills sheet-pc">
        <br>
        <h5>
            <input type="checkbox" name="attr_Skill" class="sheet-power sheet-groupfunds" value="1"/><span></span><span data-i18n="skillstoshow-u">&nbsp;&nbsp;&nbsp;Select which skills to show</span>
        </h5><br>
        <div>
            <input type="checkbox" name="attr_Skill_Show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-body">
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Admin" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="admin-u">Admin</span>
                    <input type="checkbox" name="attr_Advocate" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="advocate-u">Advocate</span>
                    <input type="checkbox" name="attr_Animals" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="animals-u">Animals</span>
                    <input type="checkbox" name="attr_Athletics" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="athletics-u">Athletics</span>
                    <input type="checkbox" name="attr_Art" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="art-u">Art</span>
                    <input type="checkbox" name="attr_Astrogation" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="astrogation-u">Astrogation</span>
                    <input type="checkbox" name="attr_Broker" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="broker-u">Broker</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Carouse" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="carouse-u">Carouse</span>
                    <input type="checkbox" name="attr_Deception" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="deception-u">Deception</span>
                    <input type="checkbox" name="attr_Diplomat" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="diplomat-u">Diplomat</span>
                    <input type="checkbox" name="attr_Drive" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="drive-u">Drive</span>
                    <input type="checkbox" name="attr_Electronics" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="electronics-u">Electronics</span>
                    <input type="checkbox" name="attr_Engineer" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="engineer-u">Engineer</span>
                    <input type="checkbox" name="attr_Explosives" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="explosives-u">Explosives</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Flyer" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="flyer-u">Flyer</span>
                    <input type="checkbox" name="attr_Gambler" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="gambler-u">Gambler</span>
                    <input type="checkbox" name="attr_Gunner" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="gunner-u">Gunner</span>
                    <input type="checkbox" name="attr_GunCombat" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="guncombat-u">Gun Combat</span>
                    <input type="checkbox" name="attr_HeavyWeapons" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="heavyweapons-u">Heavy Weapons</span>
                    <input type="checkbox" name="attr_Investigate" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="investigate-u">Investigate</span>
                    <input type="checkbox" name="attr_JackOfAllTrades" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="jackot-u">Jack-Of-All-Trades</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Language" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="language-u">Language</span>
                    <input type="checkbox" name="attr_Leadership" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="leadership-u">Leadership</span>
                    <input type="checkbox" name="attr_Mechanic" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="mechanic-u">Mechanic</span>
                    <input type="checkbox" name="attr_Medic" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="medic-u">Medic</span>
                    <input type="checkbox" name="attr_Melee" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="melee-u">Melee</span>
                    <input type="checkbox" name="attr_Navigation" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="navigation-u">Navigation</span>
                    <input type="checkbox" name="attr_Persuade" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="persuade-u">Persuade</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Pilot" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="pilot-u">Pilot</span>
                    <input type="checkbox" name="attr_Profession" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="profession-u">Profession</span>
                    <input type="checkbox" name="attr_Recon" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="recon-u">Recon</span>
                    <input type="checkbox" name="attr_Science" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="science-u">Science</span>
                    <input type="checkbox" name="attr_Seafarer" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="seafarer-u">Seafarer</span>
                    <input type="checkbox" name="attr_Stealth" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="stealth-u">Stealth</span>
                    <input type="checkbox" name="attr_Steward" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="steward-u">Steward</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-skillsummaryrow">
                    <input type="checkbox" name="attr_Streetwise" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="streetwise-u">Streetwise</span>
                    <input type="checkbox" name="attr_Survival" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="survival-u">Survival</span>
                    <input type="checkbox" name="attr_Tactics" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="tactics-u">Tactics</span>
                    <input type="checkbox" name="attr_VaccSuit" value="1" class="sheet-skillbox"/><span class="sheet-skillbox" data-i18n="vaccsuit-u">VaccSuit</span>
                </div>
                <hr class="sheet-hr">
                <div class="sheet-skill-toggles">
                    <span class="sheet-bold sheet-textright" data-i18n="skills-all-u">All</span>
                    <span><input type="checkbox" name="attr_skill_all" value="1" class="sheet-reddot"/><span></span></span>
                    <span class="sheet-bold sheet-textright" data-i18n="skills-trained-u">Trained</span>
                    <span><input type="checkbox" name="attr_skill_trained" value="1" class="sheet-reddot"/><span></span></span>
                    <span class="sheet-bold sheet-textright" data-i18n="skills-combat-u">Combat</span>
                    <span><input type="checkbox" name="attr_skill_combat" value="1" class="sheet-reddot"/><span></span></span>
                </div>
            </div>
        </div>
        <div class="sheet-laf-centredgrid sheet-laf-skillrow sheet-redborder sheet-bold">
            <span data-i18n="skilltableskill-u">Skill</span>
            <span data-i18n="skilltablecharacteristic-u">Characteristic</span>
            <span data-i18n="skilltabledicemodifier-u">DM</span>
            <span data-i18n="skilltableskilllevel-u">Skill Level</span>
            <span data-i18n="skilltablemiscmodifier-u">Misc. Mod.</span>
            <span data-i18n="skilltabletrained-u">Trained</span>
            <span data-i18n="skilltabletotalmodifier-u">Total</span>
            <span data-i18n="skilltablespecialty-u">Speciality</span>
        </div>

        <div>
            <input type="checkbox" name="attr_Admin_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Admin" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{admin-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Admin}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="admin-u">Admin</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Admin" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Admin" value="@{skillCharacteristicDM-Admin}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Admin" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Admin" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Admin" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Admin" value="@{skillDM-Admin} + @{skilllevel-Admin} + @{skillmodifier-Admin} + @{untrained-Admin}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Advocate_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Advocate" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{advocate-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Advocate}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="advocate-u">Advocate</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Advocate" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Advocate" value="@{skillCharacteristicDM-Advocate}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Advocate" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Advocate" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Advocate" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Advocate" value="@{skillDM-Advocate} + @{skilllevel-Advocate} + @{skillmodifier-Advocate} + @{untrained-Advocate}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Animals_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Animals" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{animals-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Animals}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="animals-u">Animals</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Animals" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Animals" value="@{skillCharacteristicDM-Animals}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Animals" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Animals" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Animals" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Animals" value="@{skillDM-Animals} + @{skilllevel-Animals} + @{skillmodifier-Animals} + @{untrained-Animals}" disabled/>
                <input type="checkbox" name="attr_Animals_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Animals_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_animalsspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Animalsspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{animals-u}}} {{spec= @{skillSpeciality-Animalsspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Animalsspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Animalsspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Animalsspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Animalsspec" value="@{skillCharacteristicDM-Animals} + @{skilllevel-Animalsspec} + @{skilllevel-Animals} + @{skillmodifier-Animals}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Athletics_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Athletics" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{athletics-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Athletics}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="athletics-u">Athletics</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Athletics" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Athletics" value="@{skillCharacteristicDM-Athletics}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Athletics" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Athletics" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Athletics" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Athletics" value="@{skillDM-Athletics} + @{skilllevel-Athletics} + @{skillmodifier-Athletics} + @{untrained-Athletics}" disabled/>
                <input type="checkbox" name="attr_Athletics_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Athletics_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_athleticsspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Athleticsspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{athletics-u}}} {{spec= @{skillSpeciality-Athleticsspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Athleticsspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Athleticsspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Athleticsspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Athleticsspec" value="@{skillCharacteristicDM-Athletics} + @{skilllevel-Athleticsspec} + @{skilllevel-Athletics} + @{skillmodifier-Athletics}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Art_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Art" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{art-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Art}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="art-u">Art</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Art" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Art" value="@{skillCharacteristicDM-Art}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Art" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Art" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Art" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Art" value="@{skillDM-Art} + @{skilllevel-Art} + @{skillmodifier-Art} + @{untrained-Art}" disabled/>
                <input type="checkbox" name="attr_Art_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Art_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_artspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Artspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{art-u}}} {{spec= @{skillSpeciality-Artspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Artspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Artspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Artspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Artspec" value="@{skillCharacteristicDM-Art} + @{skilllevel-Artspec} + @{skilllevel-Art} + @{skillmodifier-Art}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Astrogation_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Astrogation" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{astrogation-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Astrogation}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="astrogation-u">Astrogation</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Astrogation" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Astrogation" value="@{skillCharacteristicDM-Astrogation}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Astrogation" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Astrogation" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Astrogation" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Astrogation" value="@{skillDM-Astrogation} + @{skilllevel-Astrogation} + @{skillmodifier-Astrogation} + @{untrained-Astrogation}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Broker_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Broker" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{broker-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Broker}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="broker-u">Broker</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Broker" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Broker" value="@{skillCharacteristicDM-Broker}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Broker" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Broker" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Broker" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Broker" value="@{skillDM-Broker} + @{skilllevel-Broker} + @{skillmodifier-Broker} + @{untrained-Broker}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Carouse_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Carouse" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{carouse-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Carouse}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="carouse-u">Carouse</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Carouse" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" selected data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Carouse" value="@{skillCharacteristicDM-Carouse}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Carouse" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Carouse" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Carouse" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Carouse" value="@{skillDM-Carouse} + @{skilllevel-Carouse} + @{skillmodifier-Carouse} + @{untrained-Carouse}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Deception_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Deception" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{deception-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Deception}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="deception-u">Deception</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Deception" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Deception" value="@{skillCharacteristicDM-Deception}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Deception" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Deception" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Deception" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Deception" value="@{skillDM-Deception} + @{skilllevel-Deception} + @{skillmodifier-Deception} + @{untrained-Deception}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Diplomat_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Diplomat" type="roll"
                        value='@{whispertoggle}&{template:skill-general} {{skill=^{diplomat-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Diplomat}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="diplomat-u">Diplomat</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Diplomat" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" selected data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Diplomat" value="@{skillCharacteristicDM-Diplomat}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Diplomat" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Diplomat" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Diplomat" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Diplomat"
                        value="@{skillDM-Diplomat} + @{skilllevel-Diplomat} + @{skillmodifier-Diplomat} + @{untrained-Diplomat}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Drive_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Drive" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{drive-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Drive}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="drive-u">Drive</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Drive" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Drive" value="@{skillCharacteristicDM-Drive}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Drive" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Drive" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Drive" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Drive" value="@{skillDM-Drive} + @{skilllevel-Drive} + @{skillmodifier-Drive} + @{untrained-Drive}" disabled/>
                <input type="checkbox" name="attr_Drive_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Drive_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_drivespec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Drivespec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{drive-u}}} {{spec= @{skillSpeciality-Drivespec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Drivespec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Drivespec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Drivespec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Drivespec" value="@{skillCharacteristicDM-Drive} + @{skilllevel-Drivespec} + @{skilllevel-Drive} + @{skillmodifier-Drive}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Electronics_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Electronics" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{electronics-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Electronics}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="electronics-u">Electronics</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Electronics" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Electronics" value="@{skillCharacteristicDM-Electronics}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Electronics" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Electronics" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Electronics" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Electronics" value="@{skillDM-Electronics} + @{skilllevel-Electronics} + @{skillmodifier-Electronics} + @{untrained-Electronics}" disabled/>
                <input type="checkbox" name="attr_Electronics_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Electronics_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_electronicsspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Electronicsspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{electronics-u}}} {{spec= @{skillSpeciality-Electronicsspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Electronicsspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Electronicsspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Electronicsspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Electronicsspec" value="@{skillCharacteristicDM-Electronics} + @{skilllevel-Electronicsspec} + @{skilllevel-Electronics} + @{skillmodifier-Electronics}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Engineer_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Engineer" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{engineer-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Engineer}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="engineer-u">Engineer</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Engineer" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Engineer" value="@{skillCharacteristicDM-Engineer}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Engineer" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Engineer" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Engineer" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Engineer" value="@{skillDM-Engineer} + @{skilllevel-Engineer} + @{skillmodifier-Engineer} + @{untrained-Engineer}" disabled/>
                <input type="checkbox" name="attr_Engineer_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Engineer_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_engineerspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Engineerspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{engineer-u}}} {{spec= @{skillSpeciality-Engineerspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Engineerspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Engineerspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Engineerspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Engineerspec" value="@{skillCharacteristicDM-Engineer} + @{skilllevel-Engineerspec} + @{skilllevel-Engineer} + @{skillmodifier-Engineer}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Explosives_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Explosives" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{explosives-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Explosives}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="explosives-u">Explosives</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Explosives" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Explosives" value="@{skillCharacteristicDM-Explosives}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Explosives" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Explosives" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Explosives" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Explosives" value="@{skillDM-Explosives} + @{skilllevel-Explosives} + @{skillmodifier-Explosives} + @{untrained-Explosives}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Flyer_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Flyer" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{flyer-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Flyer}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="flyer-u">Flyer</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Flyer" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Flyer" value="@{skillCharacteristicDM-Flyer}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Flyer" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Flyer" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Flyer" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Flyer" value="@{skillDM-Flyer} + @{skilllevel-Flyer} + @{skillmodifier-Flyer} + @{untrained-Flyer}" disabled/>
                <input type="checkbox" name="attr_Flyer_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Flyer_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_flyerspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Flyerspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{flyer-u}}} {{spec= @{skillSpeciality-Flyerspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Flyerspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Flyerspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Flyerspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Flyerspec" value="@{skillCharacteristicDM-Flyer} + @{skilllevel-Flyerspec} + @{skilllevel-Flyer} + @{skillmodifier-Flyer}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Gambler_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Gambler" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{gambler-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Gambler}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="gambler-u">Gambler</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Gambler" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Gambler" value="@{skillCharacteristicDM-Gambler}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Gambler" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Gambler" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Gambler" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Gambler" value="@{skillDM-Gambler} + @{skilllevel-Gambler} + @{skillmodifier-Gambler} + @{untrained-Gambler}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Gunner_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Gunner" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{gunner-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Gunner}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="gunner-u">Gunner</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Gunner" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Gunner" value="@{skillCharacteristicDM-Gunner}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Gunner" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Gunner" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Gunner" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Gunner" value="@{skillDM-Gunner} + @{skilllevel-Gunner} + @{skillmodifier-Gunner} + @{untrained-Gunner}" disabled/>
                <input type="checkbox" name="attr_Gunner_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Gunner_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_gunnerspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Gunnerspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{gunner-u}}} {{spec= @{skillSpeciality-Gunnerspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Gunnerspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Gunnerspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Gunnerspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Gunnerspec" value="@{skillCharacteristicDM-Gunner} + @{skilllevel-Gunnerspec} + @{skilllevel-Gunner} + @{skillmodifier-Gunner}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_GunCombat_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_GunCombat" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{guncombat-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-GunCombat}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="guncombat-u">Gun Combat</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-GunCombat" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-GunCombat" value="@{skillCharacteristicDM-GunCombat}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-GunCombat" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-GunCombat" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-GunCombat" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-GunCombat" value="@{skillDM-GunCombat} + @{skilllevel-GunCombat} + @{skillmodifier-GunCombat} + @{untrained-GunCombat}" disabled/>
                <input type="checkbox" name="attr_GunCombat_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_GunCombat_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_guncombatspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_GunCombatspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{guncombat-u}}} {{spec= @{skillSpeciality-GunCombatspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-GunCombatspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-GunCombatspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-GunCombatspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-GunCombatspec" value="@{skillCharacteristicDM-GunCombat} + @{skilllevel-GunCombatspec} + @{skilllevel-GunCombat} + @{skillmodifier-GunCombat}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_HeavyWeapons_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_HeavyWeapons" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{heavyweapons-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-HeavyWeapons}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="heavyweapons-u">Heavy Weapons</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-HeavyWeapons" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-HeavyWeapons" value="@{skillCharacteristicDM-HeavyWeapons}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-HeavyWeapons" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-HeavyWeapons" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-HeavyWeapons" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-HeavyWeapons" value="@{skillDM-HeavyWeapons} + @{skilllevel-HeavyWeapons} + @{skillmodifier-HeavyWeapons} + @{untrained-HeavyWeapons}" disabled/>
                <input type="checkbox" name="attr_HeavyWeapons_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_HeavyWeapons_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_heavyweaponsspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_HeavyWeaponsspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{heavyweapons-u}}} {{spec= @{skillSpeciality-HeavyWeaponsspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-HeavyWeaponsspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-HeavyWeaponsspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-HeavyWeaponsspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-HeavyWeaponsspec" value="@{skillCharacteristicDM-HeavyWeapons} + @{skilllevel-HeavyWeaponsspec} + @{skilllevel-HeavyWeapons} + @{skillmodifier-HeavyWeapons}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Investigate_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Investigate" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{investigate-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Investigate}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="investigate-u">Investigate</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Investigate" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Investigate" value="@{skillCharacteristicDM-Investigate}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Investigate" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Investigate" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Investigate" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Investigate" value="@{skillDM-Investigate} + @{skilllevel-Investigate} + @{skillmodifier-Investigate} + @{untrained-Investigate}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_JackOfAllTrades_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_JackOfAllTrades" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{jackot-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-JackOfAllTrades}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="jackot-u">Jack-Of-All-Trades</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-JackOfAllTrades" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-JackOfAllTrades" value="@{skillCharacteristicDM-JackOfAllTrades}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-JackOfAllTrades" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-JackOfAllTrades" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-JackOfAllTrades" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-JackOfAllTrades" value="@{skillDM-JackOfAllTrades} + @{skilllevel-JackOfAllTrades} + @{skillmodifier-JackOfAllTrades} + @{untrained-JackOfAllTrades}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Language_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Language" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{language-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Language}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="language-u">Language</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Language" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Language" value="@{skillCharacteristicDM-Language}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Language" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Language" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Language" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Language" value="@{skillDM-Language} + @{skilllevel-Language} + @{skillmodifier-Language} + @{untrained-Language}" disabled/>
                <input type="checkbox" name="attr_Language_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Language_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_languagespec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Languagespec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{language-u}}} {{spec= @{skillSpeciality-Languagespec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Languagespec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Languagespec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Languagespec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Languagespec" value="@{skillCharacteristicDM-Language} + @{skilllevel-Languagespec} + @{skilllevel-Language} + @{skillmodifier-Language}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Leadership_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Leadership" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{leadership-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Leadership}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="leadership-u">Leadership</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Leadership" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" selected data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Leadership" value="@{skillCharacteristicDM-Leadership}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Leadership" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Leadership" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Leadership" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Leadership" value="@{skillDM-Leadership} + @{skilllevel-Leadership} + @{skillmodifier-Leadership} + @{untrained-Leadership}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Mechanic_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Mechanic" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{mechanic-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Mechanic}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="mechanic-u">Mechanic</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Mechanic" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Mechanic" value="@{skillCharacteristicDM-Mechanic}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Mechanic" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Mechanic" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Mechanic" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Mechanic" value="@{skillDM-Mechanic} + @{skilllevel-Mechanic} + @{skillmodifier-Mechanic} + @{untrained-Mechanic}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Medic_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Medic" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{medic-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Medic}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="medic-u">Medic</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Medic" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Medic" value="@{skillCharacteristicDM-Medic}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Medic" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Medic" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Medic" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Medic" value="@{skillDM-Medic} + @{skilllevel-Medic} + @{skillmodifier-Medic} + @{untrained-Medic}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Melee_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Melee" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{melee-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Melee}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="melee-u">Melee</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Melee" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Melee" value="@{skillCharacteristicDM-Melee}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Melee" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Melee" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Melee" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Melee" value="@{skillDM-Melee} + @{skilllevel-Melee} + @{skillmodifier-Melee} + @{untrained-Melee}" disabled/>
                <input type="checkbox" name="attr_Melee_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Melee_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_meleespec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Meleespec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{melee-u}}} {{spec= @{skillSpeciality-Meleespec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Meleespec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Meleespec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Meleespec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Meleespec" value="@{skillCharacteristicDM-Melee} + @{skilllevel-Meleespec} + @{skilllevel-Melee} + @{skillmodifier-Melee}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Navigation_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Navigation" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{navigation-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Navigation}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="navigation-u">Navigation</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Navigation" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Navigation" value="@{skillCharacteristicDM-Navigation}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Navigation" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Navigation" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Navigation" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Navigation" value="@{skillDM-Navigation} + @{skilllevel-Navigation} + @{skillmodifier-Navigation} + @{untrained-Navigation}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Persuade_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Persuade" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{persuade-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Persuade}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="persuade-u">Persuade</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Persuade" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Persuade" value="@{skillCharacteristicDM-Persuade}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Persuade" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Persuade" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Persuade" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Persuade" value="@{skillDM-Persuade} + @{skilllevel-Persuade} + @{skillmodifier-Persuade} + @{untrained-Persuade}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Pilot_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Pilot" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{pilot-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Pilot}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="pilot-u">Pilot</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Pilot" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Pilot" value="@{skillCharacteristicDM-Pilot}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Pilot" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Pilot" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Pilot" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Pilot" value="@{skillDM-Pilot} + @{skilllevel-Pilot} + @{skillmodifier-Pilot} + @{untrained-Pilot}" disabled/>
                <input type="checkbox" name="attr_Pilot_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Pilot_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_pilotspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Pilotspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{pilot-u}}} {{spec= @{skillSpeciality-Pilotspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Pilotspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Pilotspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Pilotspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Pilotspec" value="@{skillCharacteristicDM-Pilot} + @{skilllevel-Pilotspec} + @{skilllevel-Pilot} + @{skillmodifier-Pilot}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Profession_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Profession" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{profession-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Profession}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="profession-u">Profession</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Profession" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Profession" value="@{skillCharacteristicDM-Profession}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Profession" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Profession" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Profession" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Profession" value="@{skillDM-Profession} + @{skilllevel-Profession} + @{skillmodifier-Profession} + @{untrained-Profession}" disabled/>
                <input type="checkbox" name="attr_Profession_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Profession_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_professionspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Professionspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{profession-u}}} {{spec= @{skillSpeciality-Professionspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Professionspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Professionspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Professionspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Professionspec" value="@{skillCharacteristicDM-Profession} + @{skilllevel-Professionspec} + @{skilllevel-Profession} + @{skillmodifier-Profession}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Recon_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Recon" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{recon-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Recon}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="recon-u">Recon</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Recon" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Recon" value="@{skillCharacteristicDM-Recon}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Recon" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Recon" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Recon" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Recon" value="@{skillDM-Recon} + @{skilllevel-Recon} + @{skillmodifier-Recon} + @{untrained-Recon}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Science_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Science" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{science-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Science}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="science-u">Science</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Science" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Science" value="@{skillCharacteristicDM-Science}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Science" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Science" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Science" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Science" value="@{skillDM-Science} + @{skilllevel-Science} + @{skillmodifier-Science} + @{untrained-Science}" disabled/>
                <input type="checkbox" name="attr_Science_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Science_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_sciencespec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Sciencespec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{science-u}}} {{spec= @{skillSpeciality-Sciencespec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Sciencespec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Sciencespec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Sciencespec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Sciencespec" value="@{skillCharacteristicDM-Science} + @{skilllevel-Sciencespec} + @{skilllevel-Science} + @{skillmodifier-Science}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Seafarer_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Seafarer" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{seafarer-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Seafarer}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="seafarer-u">Seafarer</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Seafarer" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" selected data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Seafarer" value="@{skillCharacteristicDM-Seafarer}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Seafarer" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Seafarer" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Seafarer" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Seafarer" value="@{skillDM-Seafarer} + @{skilllevel-Seafarer} + @{skillmodifier-Seafarer} + @{untrained-Seafarer}" disabled/>
                <input type="checkbox" name="attr_Seafarer_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Seafarer_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_seafarerspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Seafarerspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{seafarer-u}}} {{spec= @{skillSpeciality-Seafarerspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Seafarerspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Seafarerspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Seafarerspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Seafarerspec" value="@{skillCharacteristicDM-Seafarer} + @{skilllevel-Seafarerspec} + @{skilllevel-Seafarer} + @{skillmodifier-Seafarer}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Stealth_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Stealth" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{stealth-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Stealth}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="stealth-u">Stealth</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Stealth" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Stealth" value="@{skillCharacteristicDM-Stealth}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Stealth" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Stealth" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Stealth" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Stealth" value="@{skillDM-Stealth} + @{skilllevel-Stealth} + @{skillmodifier-Stealth} + @{untrained-Stealth}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Steward_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Steward" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{steward-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Steward}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="steward-u">Steward</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Steward" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Steward" value="@{skillCharacteristicDM-Steward}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Steward" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Steward" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Steward" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Steward" value="@{skillDM-Steward} + @{skilllevel-Steward} + @{skillmodifier-Steward} + @{untrained-Steward}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Streetwise_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Streetwise" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{streetwise-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Streetwise}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="streetwise-u">Streetwise</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Streetwise" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Streetwise" value="@{skillCharacteristicDM-Streetwise}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Streetwise" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Streetwise" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Streetwise" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Streetwise" value="@{skillDM-Streetwise} + @{skilllevel-Streetwise} + @{skillmodifier-Streetwise} + @{untrained-Streetwise}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Survival_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Survival" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{survival-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Survival}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="survival-u">Survival</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Survival" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Survival" value="@{skillCharacteristicDM-Survival}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Survival" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Survival" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Survival" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Survival" value="@{skillDM-Survival} + @{skilllevel-Survival} + @{skillmodifier-Survival} + @{untrained-Survival}" disabled/>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_Tactics_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_Tactics" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{tactics-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Tactics}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="tactics-u">Tactics</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Tactics" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" selected data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Tactics" value="@{skillCharacteristicDM-Tactics}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Tactics" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Tactics" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Tactics" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Tactics" value="@{skillDM-Tactics} + @{skilllevel-Tactics} + @{skillmodifier-Tactics} + @{untrained-Tactics}" disabled/>
                <input type="checkbox" name="attr_Tactics_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <div class="sheet-gridspan19">
                    <input type="checkbox" name="attr_Tactics_spec_show" class="sheet-power sheet-hidden" value="1"/>
                    <div class="sheet-laf-gridbody">
                        <div class="sheet-laf-centredgrid sheet-laf-4colrow1311 sheet-bold">
                            <span data-i18n="skilltableroll-u">Roll</span>
                            <span data-i18n="skilltablespecialty-u">Speciality</span>
                            <span data-i18n="skilltablelevel-u">Level</span>
                            <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        </div>
                        <fieldset class="repeating_tacticsspec">
                            <div class="sheet-laf-centredgrid sheet-laf-4colrow1311">
                                <button name="roll_Tacticsspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{tactics-u}}} {{spec= @{skillSpeciality-Tacticsspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Tacticsspec}]] @{ro_default_mod}]] }} '>
                                    <div class="sheet-button_header_rep">b</div>
                                </button>
                                <input type="text" class="sheet-input" name="attr_skillSpeciality-Tacticsspec" placeholder="Specialty Name"/>
                                <input type="number" class="sheet-input" name="attr_skilllevel-Tacticsspec" value="0"/>
                                <input type="number" class="sheet-input" name="attr_skilltotal-Tacticsspec" value="@{skillCharacteristicDM-Tactics} + @{skilllevel-Tacticsspec} + @{skilllevel-Tactics} + @{skillmodifier-Tactics}" disabled/>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" name="attr_VaccSuit_show" class="sheet-hider sheet-hidden" value="1"/>
            <div class="sheet-laf-gridbody sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
                <button name="roll_VaccSuit" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{vaccsuit-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-VaccSuit}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header" data-i18n="vaccsuit-u">VaccSuit</div>
                </button>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-VaccSuit" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" selected data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-VaccSuit" value="@{skillCharacteristicDM-VaccSuit}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-VaccSuit" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-VaccSuit" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-VaccSuit" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-VaccSuit" value="@{skillDM-VaccSuit} + @{skilllevel-VaccSuit} + @{skillmodifier-VaccSuit} + @{untrained-VaccSuit}" disabled/>
            </div>
        </div>

        <h4 data-i18n="otherskills-u">Other Skills</h4><br>
        <div class="sheet-laf-centredgrid sheet-laf-otherskillrow sheet-bold">
            <span data-i18n="skilltableroll-u">Roll</span> <span data-i18n="skilltableskill-u">Skill</span>
            <span data-i18n="skilltablespecialty-u">Speciality</span>
            <span data-i18n="skilltablecharacteristic-u">Characteristic</span>
            <span data-i18n="skilltabledicemodifier-u">DM</span>
            <span data-i18n="skilltableskilllevel-u">Skill<br>Level</span>
            <span data-i18n="skilltablemiscmodifier-u">Misc.<br>Modifier</span>
            <span data-i18n="skilltabletrained-u">Trained</span>
            <span data-i18n="skilltabletotalmodifier-u">Total</span>
        </div>
        <fieldset class="repeating_otherspec">
            <div class="sheet-laf-centredgrid sheet-laf-otherskillrow sheet-bold">
                <button name="roll_Otherspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill= @{skillName-Other} }} {{spec= @{skillSpeciality-Other} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Other}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header_rep">b</div>
                </button>
                <input type="text" class="sheet-input sheet-bold" name="attr_skillName-Other"/>
                <input type="text" class="sheet-input" name="attr_skillSpeciality-Other"/>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Other" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select>
                <input type="number" class="sheet-input" name="attr_skillDM-Other" value="@{skillCharacteristicDM-Other}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Other" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Other" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c8r1" checked name="attr_untrained-Other" value="-3"/>
                <span class="sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Other" value="@{skillCharacteristicDM-Other} + @{skilllevel-Other} + @{untrained-Other} + @{skillmodifier-Other}" disabled/>
            </div>
        </fieldset>
    </div>
    <!--    Inventory  -->
    <div class="sheet-tab-content sheet-inventory sheet-pc">
        <br>
        <div class="sheet-row-panel">
            <h3 data-i18n="geartitle-u">Gear</h3>
            <div class='sheet-1colrow'>
                <div class='sheet-hidden'>
                    <input type="number" class="sheet-hidden" name="attr_weightleft" value="0" step="0.05"/>
                </div>
                <div class='sheet-hidden'></div>
                <div class='sheet-col sheet-redborder sheet-bold'>
                    <span>Total Gear Weight</span>
                    <input type="number" class="sheet-hidden" name="attr_weightright" value="0" step="0.05"/>
                    <input type="number" class="sheet-input_II" name="attr_totalweight" value="0" step="0.05"/>
                    <span>KG</span>
                </div>
            </div>
            <br>
            <fieldset class="repeating_othergear">
                <div class='sheet-2colrow'>
                    <div class='sheet-col'>
                        <span data-i18n="gearequipped-u">Carried</span>
                        <input type="checkbox" class="sheet-carried" name="attr_equippedleft" value="1"/><span></span>
                        <div class="sheet-laf-centredgrid sheet-laf-gearrow sheet-bold">
                            <span data-i18n="gearcell-u">Gear</span>
                            <input type="text" class="sheet-input sheet-redbold" name="attr_gear_name-left"/>
                            <span data-i18n="gearquantity-u">Qty</span>
                            <input type="number" class="sheet-input" name="attr_quantityleft" value="0"/>
                            <span data-i18n="gearweight-u">KG</span>
                            <input type="number" class="sheet-input_II" name="attr_massleft" value="0" step="0.05"/>
                            <input type="hidden" class="sheet-input" name="attr_masstotalleft" value="0" step="0.05"/>
                        </div>
                        <textarea class="sheet-input sheet-gearnotes" name="attr_gearnotes-left"></textarea>
                    </div>
                    <div class='sheet-col'>
                        <span data-i18n="gearequipped-u">Carried</span>
                        <input type="checkbox" class="sheet-carried" name="attr_equippedright" value="1"/><span></span>
                        <div class="sheet-laf-centredgrid sheet-laf-gearrow sheet-bold">
                            <span data-i18n="gearcell-u">Gear</span>
                            <input type="text" class="sheet-input sheet-redbold" name="attr_gear_name-right"/>
                            <span data-i18n="gearquantity-u">Qty</span>
                            <input type="number" class="sheet-input" name="attr_quantityright" value="0"/>
                            <span data-i18n="gearweight-u">KG</span>
                            <input type="number" class="sheet-input_II" name="attr_massright" value="0" step="0.05"/>
                            <input type="hidden" class="sheet-input" name="attr_masstotalright" value="0" step="0.05"/>
                        </div>
                        <textarea class="sheet-input sheet-gearnotes" name="attr_gearnotes-right"></textarea>
                    </div>
                </div>
            </fieldset>
        </div>
        <br>
        <div class="sheet-row-panel">
            <h4 data-i18n="financestitle-u">Finances</h4><br>
            <div class="sheet-laf-finance sheet-bold">
                <div data-i18n="pension-u">Pension</div>
                <input type="number" class="sheet-input" name="attr_Pension" value="0"/>
                <span data-i18n="debt-u">Debt</span>
                <input type="number" class="sheet-input" name="attr_Debt" value="0"/>
                <span data-i18n="cash-u">Cash on Hand</span>
                <input type="number" class="sheet-input" name="attr_CashonHand" value="0"/>
                <span data-i18n="monthlyship-u">Monthly Ship Payment</span>
                <input type="number" class="sheet-input" name="attr_MonthlyShipPayment" value="0"/>
                <span data-i18n="monthlylifesupport-u">Monthly Life Support</span>
                <input type="number" class="sheet-input" name="attr_MonthlyLifeSupport" value="0"/>
            </div>
        </div>
        <br>
        <h4 data-i18n="otherwealth-u">Other Wealth</h4><br>
        <div class="sheet-laf-centredgrid sheet-laf-otherwealth">
            <span data-i18n="otherwealthitem-u" class="sheet-header">Item</span>
            <span data-i18n="otherwealthvalue-u" class="sheet-header">Value</span>
            <span data-i18n="otherwealthlocation-u" class="sheet-header">Location</span>
        </div>
        <fieldset class="repeating_otherweath">
            <div class="sheet-laf-centredgrid sheet-laf-otherwealth sheet-redborder">
                <input class="sheet-input sheet-redbold" type="text" name="attr_otherwealth_name" placeholder="Item Name"/>
                <input class="sheet-input" type="number" value="0" step="10" name="attr_otherwealth_value"/>
                <input class="sheet-input" type="text" name="attr_otherwealth_location" placeholder="Item Location"/>
                <textarea wrap="soft" class="sheet-input" name="attr_otherwealth_item_note" placeholder="Item Details"></textarea>
            </div>
        </fieldset>
    </div>
    <!--    Combat  -->
    <div class="sheet-tab-content sheet-combat sheet-pc">
        <div>
            <h3 data-i18n="shiparmour-u">Armour</h3>
            <div class="sheet-laf-centredgrid sheet-laf-armourlist sheet-bold sheet-redborder">
                <span data-i18n="armourtype-u">Type</span> <span data-i18n="armourtechlevel-u">TL</span>
                <span data-i18n="armourprotection-u">Protection</span>
                <span data-i18n="armourprotectionlaser-u">Protection (Laser)</span>
                <span data-i18n="armourrads-u">Rad</span> <span data-i18n="armourkgweight-u">KG</span>
                <span data-i18n="armourskill-u">Required Skill</span>
                <input type="text" class="sheet-input sheet-redbold" name="attr_armour-type"/>
                <input type="number" name="attr_armour-tl"/> <input type="number" name="attr_armour-protection"/>
                <input type="number" name="attr_armour-protection-laser"/>
                <input type="number" name="attr_armour-rads"/>
                <input type="number" name="attr_armour-mass" step="0.05"/>
                <select type="text" name="attr_armour-RequiredSkill" value="0">
                    <option value="0" data-i18n="armournoneskill-u">None</option>
                    <option value="1" data-i18n="armourvaccsuit0-u">Vacc Suit 0</option>
                    <option value="2" data-i18n="armourvaccsuit1-u">Vacc Suit 1</option>
                    <option value="3" data-i18n="armourvaccsuit2-u">Vacc Suit 2</option>
                    <option value="4" data-i18n="armourvaccsuit3-u">Vacc Suit 3</option>
                    <option value="5" data-i18n="armourvaccsuit4-u">Vacc Suit 4</option>
                </select>
                <textarea class="sheet-input sheet-gridspan18 sheet-laf-wauto" name="attr_armornotes"></textarea>
            </div>
            <fieldset class="repeating_armour">
                <div class="sheet-laf-centredgrid sheet-laf-armourlist sheet-redborder">
                    <input type="text" class="sheet-input sheet-redbold" name="attr_reparmour-type"/>
                    <input type="number" class="sheet-input" name="attr_reparmour-tl"/>
                    <input type="number" class="sheet-input" name="attr_reparmour-protection"/>
                    <input type="number" class="sheet-input" name="attr_reparmour-protection-laser"/>
                    <input type="number" class="sheet-input" name="attr_reparmour-rads"/>
                    <input type="number" class="sheet-input" name="attr_reparmour-mass" step="0.05"/>
                    <select type="text" class="sheet-input" name="attr_reparmour-RequiredSkill" value="0">
                        <option value="0" data-i18n="armournoneskill-u">None</option>
                        <option value="1" data-i18n="armourvaccsuit0-u">Vacc Suit 0</option>
                        <option value="2" data-i18n="armourvaccsuit1-u">Vacc Suit 1</option>
                        <option value="3" data-i18n="armourvaccsuit2-u">Vacc Suit 2</option>
                        <option value="4" data-i18n="armourvaccsuit3-u">Vacc Suit 3</option>
                        <option value="5" data-i18n="armourvaccsuit4-u">Vacc Suit 4</option>
                    </select>
                    <textarea class="sheet-input sheet-gridspan18 sheet-laf-wauto" name="attr_reparmornotes"></textarea>
                </div>
            </fieldset>
            <br>
            <div class="sheet-trade_content sheet-redborder">
                <select type="text" class="sheet-input" name="attr_initiativeattribute" value="0">
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                </select>
                <button class="sheet-laf-initbutton" data-i18n="initiativeroll-u" type="roll" name="roll_initiative" value="@{whispertoggle}&{template:skill-general} {{skill= ^{initiative-u}}} {{character= @{character_name} }} @{ro_default_rolltype}+@{initiativeattribute}[Attribute Modifier]+@{initiative_effect} @{ro_default_mod} &{tracker}]]}}"></button>
            </div>
        </div>
        <div class="sheet-tabbed-panel">
            <div class="sheet-row-panel">
                <br>
                <h3 data-i18n="weaponstitle-u">Weapons</h3>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-bold">
                    <span data-i18n="weaponroll-u">Roll</span> <span data-i18n="weaponweapon-u">Weapon</span>
                    <span data-i18n="weaponskilltotal-u">Skill Total</span> <span data-i18n="weapondicemod-u">DM</span>
                    <span data-i18n="weapondamage-u">Damage</span> <span data-i18n="weapontechlevel-u">TL</span>
                    <span data-i18n="weaponrange-u">Range</span> <span data-i18n="weaponweight-u">KG</span>
                    <span data-i18n="weaponmagazine-u">Magazine</span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-1" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-input sheet-redbold" type="text" name="attr_weapon_name-1"/>
                    <input class="sheet-input" type="number" name="attr_weapon_skill-1" value="0"/>
                    <select class="sheet-input" type="text" name="attr_weapon_DM-1" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-input" type="text" name="attr_weapon_damage-1"/>
                    <input class="sheet-input" type="number" name="attr_weapon_tl-1" value="0"/>
                    <input class="sheet-input" type="text" name="attr_weapon_range-1" value="0"/>
                    <input class="sheet-input" type="number" name="attr_weapon_weight-1" value="0" step="0.05"/>
                    <input class="sheet-input" type="text" name="attr_weapon_magazine-1" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-1"></textarea>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-2" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-2"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-2" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-2" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-2"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-2" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-2" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-2" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-2" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-2"></textarea>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist  sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-3" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-3"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-3" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-3" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-3"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-3" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-3" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-3" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-3" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-3"></textarea>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-4" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-4"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-4" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-4" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-4"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-4" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-4" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-4" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-4" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-4"></textarea>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-5" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-5"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-5" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-5" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-5"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-5" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-5" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-5" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-5" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-5"></textarea>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                    <button class="sheet-weaponroll" name="act_roll-weapon-6" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-6"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-6" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-6" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-6"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-6" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-6" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-6" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-6" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-6"></textarea>
                </div>
                <fieldset class="repeating_weapons">
                    <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-redborder">
                        <button class="sheet-weaponroll" name="act_roll-weapon-rep" type="action">
                            <div class="sheet-weaponrollbutton">b</div>
                        </button>
                        <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-rep"/>
                        <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-rep" value="0"/>
                        <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-rep" value="0">
                            <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                            <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity
                            </option>
                        </select>
                        <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-rep"/>
                        <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-rep" value="0"/>
                        <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-rep" value="0"/>
                        <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-rep" value="0" step="0.05"/>
                        <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-rep" value="0"/>
                        <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-rep"></textarea>
                    </div>
                </fieldset>
            </div>
        </div>
    </div><!--    Powers  -->
    <div class="sheet-tab-content sheet-powers sheet-pc">
        <div class="sheet-col">
            <div class="sheet-laf-centredgrid sheet-laf-psistr">
                <span></span> <span data-i18n="rating-u">Rating</span> <span data-i18n="temp-u">Temp</span>
                <span data-i18n="mod-u">Mod</span>
                <button class="sheet-button" name="roll_PsionicStrength" type="roll" value='@{whispertoggle}&{template:power} {{power=^{psionicstrength-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-PsionicStrength} @{ro_default_mod}]] }}'>
                    <div class="sheet-button_header" data-i18n="psionicstrength-u">Psionic Strength</div>
                </button>
                <input type="number" class="sheet-input sheet-bold" name="attr_base-PsionicStrength" value="0"/>
                <input type="number" class="sheet-input sheet-norm" name="attr_injury-PsionicStrength" value="0"/>
                <input type="number" class="sheet-input sheet-mod" name="attr_mod-PsionicStrength" value="0"/>
                <input type="hidden" name="attr_calc-PsionicStrength" value="0"/>
            </div>
        </div>
        <br>
        <div class="sheet-laf-centredgrid sheet-laf-skillrow sheet-redborder sheet-bold">
            <span data-i18n="skilltabletalent-u">Talent</span>
            <span data-i18n="skilltablecharacteristic-u">Characteristic</span>
            <span data-i18n="skilltabledicemodifier-u">DM</span>
            <span data-i18n="skilltableskilllevel-u">Skill Level</span>
            <span data-i18n="skilltablemiscmodifier-u">Misc. Mod.</span>
            <span data-i18n="skilltabletrained-u">Trained</span>
            <span data-i18n="skilltabletotalmodifier-u">Total</span>
            <span data-i18n="skilltablespecialty-u">Speciality</span>
        </div>
        <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
            <button name="roll_Telepathy" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{telepathy-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Telepathy}]] @{ro_default_mod}]] }} '>
                <div class="sheet-button_header" data-i18n="telepathy-u">Telepathy</div>
            </button>
            <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Telepathy" value="0">
                <option value="@{mod-PsionicStrength}" data-i18n="psionicstrength-u">Psionic Strength</option>
            </select>
            <input type="number" class="sheet-input" name="attr_skillDM-Telepathy" value="@{skillCharacteristicDM-Telepathy}" disabled/>
            <input type="number" class="sheet-input" name="attr_skilllevel-Telepathy" value="0"/>
            <input type="number" class="sheet-input" name="attr_skillmodifier-Telepathy" value="0"/>
            <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Telepathy" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
            <input type="number" class="sheet-input" name="attr_skilltotal-Telepathy" value="@{skillDM-Telepathy} + @{skilllevel-Telepathy} + @{skillmodifier-Telepathy} + @{untrained-Telepathy}" disabled/>
            <input type="checkbox" name="attr_Telepathy_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
            <div class="sheet-gridspan19">
                <input type="checkbox" name="attr_Telepathy_spec_show" class="sheet-power sheet-hidden" value="1"/>
                <div class="sheet-laf-gridbody">
                    <div class="sheet-laf-centredgrid sheet-laf-5colrow13111 sheet-bold">
                        <span data-i18n="skilltableroll-u">Roll</span>
                        <span data-i18n="skilltablepower-u">Power</span>
                        <span data-i18n="skilltablelevel-u">Level</span>
                        <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        <span>PSI Cost</span>
                    </div>
                    <fieldset class="repeating_telepathyspec">
                        <div class="sheet-laf-centredgrid sheet-laf-5colrow13111">
                            <button name="roll_Telepathyspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{telepathy-u}}} {{spec= @{skillSpeciality-Telepathyspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Telepathyspec}]] @{ro_default_mod}]] }} '>
                                <div class="sheet-button_header_rep">b</div>
                            </button>
                            <input type="text" class="sheet-input" name="attr_skillSpeciality-Telepathyspec" placeholder="Specialty Name"/>
                            <input type="number" class="sheet-input" name="attr_skilllevel-Telepathyspec" value="0"/>
                            <input type="number" class="sheet-input" name="attr_skilltotal-Telepathyspec" value="@{skillCharacteristicDM-Telepathy} + @{skilllevel-Telepathyspec} + @{skilllevel-Telepathy} + @{skillmodifier-Telepathy}" disabled/>
                            <input type="number" class="sheet-input" name="attr_skillpsicost-Telepathyspec" value="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
            <button name="roll_Clairvoyance" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{clairvoyance-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Clairvoyance}]] @{ro_default_mod}]] }} '>
                <div class="sheet-button_header" data-i18n="clairvoyance-u">Clairvoyance</div>
            </button>
            <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Clairvoyance" value="0">
                <option value="@{mod-PsionicStrength}" data-i18n="psionicstrength-u">Psionic Strength</option>
            </select>
            <input type="number" class="sheet-input" name="attr_skillDM-Clairvoyance" value="@{skillCharacteristicDM-Clairvoyance}" disabled/>
            <input type="number" class="sheet-input" name="attr_skilllevel-Clairvoyance" value="0"/>
            <input type="number" class="sheet-input" name="attr_skillmodifier-Clairvoyance" value="0"/>
            <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Clairvoyance" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
            <input type="number" class="sheet-input" name="attr_skilltotal-Clairvoyance" value="@{skillDM-Clairvoyance} + @{skilllevel-Clairvoyance} + @{skillmodifier-Clairvoyance} + @{untrained-Clairvoyance}" disabled/>
            <input type="checkbox" name="attr_Clairvoyance_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
            <div class="sheet-gridspan19">
                <input type="checkbox" name="attr_Clairvoyance_spec_show" class="sheet-power sheet-hidden" value="1"/>
                <div class="sheet-laf-gridbody">
                    <div class="sheet-laf-centredgrid sheet-laf-5colrow13111 sheet-bold">
                        <span data-i18n="skilltableroll-u">Roll</span>
                        <span data-i18n="skilltablespecialty-u">Speciality</span>
                        <span data-i18n="skilltablelevel-u">Level</span>
                        <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        <span>PSI Cost</span>
                    </div>
                    <fieldset class="repeating_clairvoyancespec">
                        <div class="sheet-laf-centredgrid sheet-laf-5colrow13111">
                            <button name="roll_Clairvoyancespec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{clairvoyance-u}}} {{spec= @{skillSpeciality-Clairvoyancespec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Clairvoyancespec}]] @{ro_default_mod}]] }} '>
                                <div class="sheet-button_header_rep">b</div>
                            </button>
                            <input type="text" class="sheet-input" name="attr_skillSpeciality-Clairvoyancespec" placeholder="Specialty Name"/>
                            <input type="number" class="sheet-input" name="attr_skilllevel-Clairvoyancespec" value="0"/>
                            <input type="number" class="sheet-input" name="attr_skilltotal-Clairvoyancespec" value="@{skillCharacteristicDM-Clairvoyance} + @{skilllevel-Clairvoyancespec} + @{skilllevel-Clairvoyance} + @{skillmodifier-Clairvoyance}" disabled/>
                            <input type="number" class="sheet-input" name="attr_skillpsicost-Clairvoyancespec" value="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
            <button name="roll_Telekinesis" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{telekinesis-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Telekinesis}]] @{ro_default_mod}]] }} '>
                <div class="sheet-button_header" data-i18n="telekinesis-u">Telekinesis</div>
            </button>
            <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Telekinesis" value="0">
                <option value="@{mod-PsionicStrength}" data-i18n="psionicstrength-u">Psionic Strength</option>
            </select>
            <input type="number" class="sheet-input" name="attr_skillDM-Telekinesis" value="@{skillCharacteristicDM-Telekinesis}" disabled/>
            <input type="number" class="sheet-input" name="attr_skilllevel-Telekinesis" value="0"/>
            <input type="number" class="sheet-input" name="attr_skillmodifier-Telekinesis" value="0"/>
            <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Telekinesis" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
            <input type="number" class="sheet-input" name="attr_skilltotal-Telekinesis" value="@{skillDM-Telekinesis} + @{skilllevel-Telekinesis} + @{skillmodifier-Telekinesis} + @{untrained-Telekinesis}" disabled/>
            <input type="checkbox" name="attr_Telekinesis_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
            <div class="sheet-gridspan19">
                <input type="checkbox" name="attr_Telekinesis_spec_show" class="sheet-power sheet-hidden" value="1"/>
                <div class="sheet-laf-gridbody">
                    <div class="sheet-laf-centredgrid sheet-laf-5colrow13111 sheet-bold">
                        <span data-i18n="skilltableroll-u">Roll</span>
                        <span data-i18n="skilltablespecialty-u">Speciality</span>
                        <span data-i18n="skilltablelevel-u">Level</span>
                        <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        <span>PSI Cost</span>
                    </div>
                    <fieldset class="repeating_telekinesisspec">
                        <div class="sheet-laf-centredgrid sheet-laf-5colrow13111">
                            <button name="roll_Telekinesisspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{telekinesis-u}}} {{spec= @{skillSpeciality-Telekinesisspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Telekinesisspec}]] @{ro_default_mod}]] }} '>
                                <div class="sheet-button_header_rep">b</div>
                            </button>
                            <input type="text" class="sheet-input" name="attr_skillSpeciality-Telekinesisspec" placeholder="Specialty Name"/>
                            <input type="number" class="sheet-input" name="attr_skilllevel-Telekinesisspec" value="0"/>
                            <input type="number" class="sheet-input" name="attr_skilltotal-Telekinesisspec" value="@{skillCharacteristicDM-Telekinesis} + @{skilllevel-Telekinesisspec} + @{skilllevel-Telekinesis} + @{skillmodifier-Telekinesis}" disabled/>
                            <input type="number" class="sheet-input" name="attr_skillpsicost-Telekinesisspec" value="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
            <button name="roll_Awareness" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{awareness-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Awareness}]] @{ro_default_mod}]] }} '>
                <div class="sheet-button_header" data-i18n="awareness-u">Awareness</div>
            </button>
            <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Awareness" value="0">
                <option value="@{mod-PsionicStrength}" data-i18n="psionicstrength-u">Psionic Strength</option>
            </select>
            <input type="number" class="sheet-input" name="attr_skillDM-Awareness" value="@{skillCharacteristicDM-Awareness}" disabled/>
            <input type="number" class="sheet-input" name="attr_skilllevel-Awareness" value="0"/>
            <input type="number" class="sheet-input" name="attr_skillmodifier-Awareness" value="0"/>
            <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Awareness" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
            <input type="number" class="sheet-input" name="attr_skilltotal-Awareness" value="@{skillDM-Awareness} + @{skilllevel-Awareness} + @{skillmodifier-Awareness} + @{untrained-Awareness}" disabled/>
            <input type="checkbox" name="attr_Awareness_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
            <div class="sheet-gridspan19">
                <input type="checkbox" name="attr_Awareness_spec_show" class="sheet-power sheet-hidden" value="1"/>
                <div class="sheet-laf-gridbody">
                    <div class="sheet-laf-centredgrid sheet-laf-5colrow13111 sheet-bold">
                        <span data-i18n="skilltableroll-u">Roll</span>
                        <span data-i18n="skilltablespecialty-u">Speciality</span>
                        <span data-i18n="skilltablelevel-u">Level</span>
                        <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        <span>PSI Cost</span>
                    </div>
                    <fieldset class="repeating_awarenessspec">
                        <div class="sheet-laf-centredgrid sheet-laf-5colrow13111">
                            <button name="roll_Awarenessspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{awareness-u}}} {{spec= @{skillSpeciality-Awarenessspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Awarenessspec}]] @{ro_default_mod}]] }} '>
                                <div class="sheet-button_header_rep">b</div>
                            </button>
                            <input type="text" class="sheet-input" name="attr_skillSpeciality-Awarenessspec" placeholder="Specialty Name"/>
                            <input type="number" class="sheet-input" name="attr_skilllevel-Awarenessspec" value="0"/>
                            <input type="number" class="sheet-input" name="attr_skilltotal-Awarenessspec" value="@{skillCharacteristicDM-Awareness} + @{skilllevel-Awarenessspec} + @{skilllevel-Awareness} + @{skillmodifier-Awareness}" disabled/>
                            <input type="number" class="sheet-input" name="attr_skillpsicost-Awarenessspec" value="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-skillrow">
            <button name="roll_Teleportation" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{teleportation-u}}} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Teleportation}]] @{ro_default_mod}]] }} '>
                <div class="sheet-button_header" data-i18n="teleportation-u">Teleportation</div>
            </button>
            <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Teleportation" value="0">
                <option value="@{mod-PsionicStrength}" data-i18n="psionicstrength-u">Psionic Strength</option>
            </select>
            <input type="number" class="sheet-input" name="attr_skillDM-Teleportation" value="@{skillCharacteristicDM-Teleportation}" disabled/>
            <input type="number" class="sheet-input" name="attr_skilllevel-Teleportation" value="0"/>
            <input type="number" class="sheet-input" name="attr_skillmodifier-Teleportation" value="0"/>
            <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c6r1" checked name="attr_untrained-Teleportation" value="-3"/><span class="sheet-laf-centre-checkbox sheet-grid-c6r1"></span>
            <input type="number" class="sheet-input" name="attr_skilltotal-Teleportation" value="@{skillDM-Teleportation} + @{skilllevel-Teleportation} + @{skillmodifier-Teleportation} + @{untrained-Teleportation}" disabled/>
            <input type="checkbox" name="attr_Teleportation_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"/><span class=" sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
            <div class="sheet-gridspan19">
                <input type="checkbox" name="attr_Teleportation_spec_show" class="sheet-power sheet-hidden" value="1"/>
                <div class="sheet-laf-gridbody">
                    <div class="sheet-laf-centredgrid sheet-laf-5colrow13111 sheet-bold">
                        <span data-i18n="skilltableroll-u">Roll</span>
                        <span data-i18n="skilltablespecialty-u">Speciality</span>
                        <span data-i18n="skilltablelevel-u">Level</span>
                        <span data-i18n="skilltabletotalmodifier-u">Total</span>
                        <span>PSI Cost</span>
                    </div>
                    <fieldset class="repeating_teleportationspec">
                        <div class="sheet-laf-centredgrid sheet-laf-5colrow13111">
                            <button name="roll_Teleportationspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill=^{teleportation-u}}} {{spec= @{skillSpeciality-Teleportationspec} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Teleportationspec}]] @{ro_default_mod}]] }} '>
                                <div class="sheet-button_header_rep">b</div>
                            </button>
                            <input type="text" class="sheet-input" name="attr_skillSpeciality-Teleportationspec" placeholder="Specialty Name"/>
                            <input type="number" class="sheet-input" name="attr_skilllevel-Teleportationspec" value="0"/>
                            <input type="number" class="sheet-input" name="attr_skilltotal-Teleportationspec" value="@{skillCharacteristicDM-Teleportation} + @{skilllevel-Teleportationspec} + @{skilllevel-Teleportation} + @{skillmodifier-Teleportation}" disabled/>
                            <input type="number" class="sheet-input" name="attr_skillpsicost-Teleportationspec" value="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <br>
        <hr class="sheet-hr">
        <span class="sheet-bold">Legacy Psionics</span><input type="checkbox" name="attr_legacypsi_spec_show" class="sheet-power sheet-hider sheet-laf-centre-checkbox sheet-grid-c8r1" value="1"><span></span>
        <div class="sheet-body">
            <div class="sheet-laf-centredgrid sheet-laf-power sheet-bold">
                <span data-i18n="skilltableroll-u">Roll</span> <span data-i18n="skilltablename-u">Talent</span>
                <span data-i18n="skilltablecharacteristic-u">Characteristic</span>
                <span data-i18n="skilltableskilllevel-u">Skill Level</span>
                <button type="roll" class="sheet-button" name="roll_skill-power" value='@{whispertoggle}&{template:power} {{power= @{skillSpeciality-power} }} {{character= @{character_name} }} @{ro_default_rolltype} + @{skillCharacteristicDM-power} + @{skilllevel-power} @{ro_default_mod}]] }} {{note= @{skillnote-power} }} '>
                    <div class="sheet-weaponrollbutton">b</div>
                </button>
                <select type="text" class="sheet-input sheet-redbold" name="attr_skillSpeciality-talent">
                    <option>Telepathy</option>
                    <option>Clairvoyance</option>
                    <option>Telekinesis</option>
                    <option>Awareness</option>
                    <option>Teleportation</option>
                </select>
                <input type="text" class="sheet-input sheet-redbold" name="attr_skillSpeciality-power"/>
                <input type="number" class="sheet-input" name="attr_skilllevel-power" value="0"/>
                <textarea name="attr_skillnote-power" placeholder="Power Notes"></textarea>
            </div>
            <fieldset class="repeating_powers">
                <div class="sheet-laf-centredgrid sheet-laf-power sheet-bold">
                    <button type="roll" class="sheet-button" name="roll_skill-reppower" value='@{whispertoggle}&{template:power} {{power= @{skillSpeciality-reppower} }} {{character= @{character_name} }} @{ro_default_rolltype} + @{mod-PsionicStrength} + @{skilllevel-reppower} @{ro_default_mod}]] }} {{note= @{skillnote-reppower} }}'>
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <select type="text" class="sheet-input sheet-redbold" name="attr_skillSpeciality-talent">
                        <option>Telepathy</option>
                        <option>Clairvoyance</option>
                        <option>Telekinesis</option>
                        <option>Awareness</option>
                        <option>Teleportation</option>
                    </select>
                    <input type="text" class="sheet-input sheet-redbold" name="attr_skillSpeciality-reppower"/>
                    <input type="number" class="sheet-input" name="attr_skilllevel-reppower" value="0"/>
                    <textarea name="attr_skillnote-reppower" placeholder="Power Notes"></textarea>
                </div>
            </fieldset>
        </div>
    </div>
    <!--    Notes   -->
    <div class="sheet-tab-content sheet-notes sheet-pc">
        <textarea name="attr_notes" class="sheet-notes-textarea"></textarea>
    </div>
</div>
<div class="sheet-tab-content sheet-npc">
    <div class="sheet-redborder">
        <h4 data-i18n="npcskills-u">NPC Skills</h4><br>
        <div class="sheet-npc-movement">
            <span class="sheet-header sheet-bordered-width">Movement:&nbsp;</span>
            <input type="number" class="sheet-input" name="attr_character_movement">
            <span class="sheet-header sheet-bordered-width">m</span>
        </div>
        <br>
        <div class="sheet-laf-centredgrid sheet-laf-otherskillrow sheet-bold">
            <span data-i18n="skilltableroll-u">Roll</span> <span data-i18n="skilltableskill-u">Skill</span>
            <span data-i18n="skilltablespecialty-u">Speciality</span>
            <span data-i18n="skilltablecharacteristic-u">Characteristic</span>
            <span data-i18n="skilltabledicemodifier-u">DM</span> <span data-i18n="skilltableskilllevel-u">Skill<br>Level</span>
            <span data-i18n="skilltablemiscmodifier-u">Misc.<br>Modifier</span>
            <span data-i18n="skilltabletrained-u">Trained</span>
            <span data-i18n="skilltabletotalmodifier-u">Total</span>
        </div>
        <fieldset class="repeating_npcspec">
            <div class="sheet-laf-centredgrid sheet-laf-otherskillrow">
                <button name="roll_Npcspec" type="roll" value='@{whispertoggle}&{template:skill-general} {{skill= @{skillName-Npc} }} {{spec= @{skillSpeciality-Npc} }} {{character= @{character_name} }} @{ro_default_rolltype} + [[@{skilltotal-Npc}]] @{ro_default_mod}]] }} '>
                    <div class="sheet-button_header_rep">b</div>
                </button>
                <input type="text" class="sheet-input sheet-bold" name="attr_skillName-Npc"/>
                <input type="text" class="sheet-input" name="attr_skillSpeciality-Npc"/>
                <select type="text" class="sheet-input sheet-laf-wauto" name="attr_skillCharacteristicDM-Npc" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                    <option value="@{mod-Education}" data-i18n="skilleducationoption-u">Education</option>
                    <option value="@{mod-Endurance}" data-i18n="skillenduranceoption-u">Endurance</option>
                    <option value="@{mod-Social}" data-i18n="skillsocialoption-u">Social</option>
                </select><input type="number" class="sheet-input" name="attr_skillDM-Npc" value="@{skillCharacteristicDM-Npc}" disabled/>
                <input type="number" class="sheet-input" name="attr_skilllevel-Npc" value="0"/>
                <input type="number" class="sheet-input" name="attr_skillmodifier-Npc" value="0"/>
                <input type="checkbox" class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c8r1" checked name="attr_untrained-Npc" value="-3"/>
                <span class="sheet-untrained sheet-laf-centre-checkbox sheet-grid-c8r1"></span>
                <input type="number" class="sheet-input" name="attr_skilltotal-Npc" value="@{skillCharacteristicDM-Npc} + @{skilllevel-Npc} + @{untrained-Npc} + @{skillmodifier-Npc}" disabled/>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-trade_content sheet-redborder">
        <select type="text" class="sheet-input" name="attr_initiativeattribute" value="0">
            <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
            <option value="@{mod-Intellect}" data-i18n="skillintellectoption-u">Intellect</option>
        </select>
        <button class="sheet-laf-initbutton btn ui-draggable" data-i18n="initiativeroll-u" type="roll" name="roll_initiative" value="@{whispertoggle} &{template:skill-general} {{skill=^{initiative-u}}} {{character= @{character_name} }} @{ro_default_rolltype}+@{initiativeattribute}[Attribute Modifier]+@{initiative_effect} @{ro_default_mod} &{tracker}]]}}">
            <div class="sheet-button_header">Roll Initiative (Select Token)</div>
        </button>
    </div>
    <br>
    <div class="sheet-redborder">
        <h3 data-i18n="shiparmour-u">Armour</h3>
        <div class="sheet-laf-centredgrid sheet-laf-armourlist sheet-bold sheet-redborder">
            <span data-i18n="armourtype-u">Type</span> <span data-i18n="armourtechlevel-u">TL</span>
            <span data-i18n="armourprotection-u">Protection</span>
            <span data-i18n="armourprotectionlaser-u">Protection (Laser)</span>
            <span data-i18n="armourrads-u">Rad</span> <span data-i18n="armourkgweight-u">KG</span>
            <span data-i18n="armourskill-u">Required Skill</span>
            <input type="text" class="sheet-input sheet-redbold" name="attr_armour-type"/>
            <input type="number" name="attr_armour-tl"/> <input type="number" name="attr_armour-protection"/>
            <input type="number" name="attr_armour-protection-laser"/>
            <input type="number" name="attr_armour-rads"/>
            <input type="number" name="attr_armour-mass" step="0.05"/>
            <select type="text" name="attr_armour-RequiredSkill" value="0">
                <option value="0" data-i18n="armournoneskill-u">None</option>
                <option value="1" data-i18n="armourvaccsuit0-u">Vacc Suit 0</option>
                <option value="2" data-i18n="armourvaccsuit1-u">Vacc Suit 1</option>
                <option value="3" data-i18n="armourvaccsuit2-u">Vacc Suit 2</option>
                <option value="4" data-i18n="armourvaccsuit3-u">Vacc Suit 3</option>
                <option value="5" data-i18n="armourvaccsuit4-u">Vacc Suit 4</option>
            </select>
            <textarea class="sheet-input sheet-gridspan18 sheet-laf-wauto" name="attr_armornotes"></textarea>
        </div>
        <fieldset class="repeating_armour">
            <div class="sheet-laf-centredgrid sheet-laf-armourlist sheet-redborder">
                <input type="text" class="sheet-input sheet-redbold" name="attr_reparmour-type"/>
                <input type="number" class="sheet-input" name="attr_reparmour-tl"/>
                <input type="number" class="sheet-input" name="attr_reparmour-protection"/>
                <input type="number" class="sheet-input" name="attr_reparmour-protection-laser"/>
                <input type="number" class="sheet-input" name="attr_reparmour-rads"/>
                <input type="number" class="sheet-input" name="attr_reparmour-mass" step="0.05"/>
                <select type="text" class="sheet-input" name="attr_reparmour-RequiredSkill" value="0">
                    <option value="0" data-i18n="armournoneskill-u">None</option>
                    <option value="1" data-i18n="armourvaccsuit0-u">Vacc Suit 0</option>
                    <option value="2" data-i18n="armourvaccsuit1-u">Vacc Suit 1</option>
                    <option value="3" data-i18n="armourvaccsuit2-u">Vacc Suit 2</option>
                    <option value="4" data-i18n="armourvaccsuit3-u">Vacc Suit 3</option>
                    <option value="5" data-i18n="armourvaccsuit4-u">Vacc Suit 4</option>
                </select>
                <textarea class="sheet-input sheet-gridspan18 sheet-laf-wauto" name="attr_reparmornotes"></textarea>
            </div>
        </fieldset>
    </div>
    <div class="sheet-redborder">
        <h3 data-i18n="shipweapons-u">Weapons</h3>
        <div class="sheet-weaponlist">
            <div class="sheet-laf-centredgrid sheet-laf-weaponlist sheet-bold">
                <span data-i18n="weaponroll-u">Roll</span>
                <span data-i18n="weaponweapon-u">Weapon</span>
                <span data-i18n="weaponskilltotal-u">Skill Total</span>
                <span data-i18n="weapondicemod-u">DM</span>
                <span data-i18n="weapondamage-u">Damage</span>
                <span data-i18n="weapontechlevel-u">TL</span>
                <span data-i18n="weaponrange-u">Range</span>
                <span data-i18n="weaponweight-u">KG</span>
                <span data-i18n="weaponmagazine-u">Magazine</span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-weaponlist">
                <button class="sheet-weaponroll" name="act_roll-weapon-1" type="action">
                    <div class="sheet-weaponrollbutton">b</div>
                </button>
                <input class="sheet-input sheet-redbold" type="text" name="attr_weapon_name-1"/>
                <input class="sheet-input" type="number" name="attr_weapon_skill-1" value="0"/>
                <select class="sheet-input" type="text" name="attr_weapon_DM-1" value="0">
                    <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                    <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity</option>
                </select> <input class="sheet-input" type="text" name="attr_weapon_damage-1"/>
                <input class="sheet-input" type="number" name="attr_weapon_tl-1" value="0"/>
                <input class="sheet-input" type="text" name="attr_weapon_range-1" value="0""/>
                <input class="sheet-input" type="number" name="attr_weapon_weight-1" value="0" step="0.05"/>
                <input class="sheet-input" type="text" name="attr_weapon_magazine-1" value="0"/>
                <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-1"></textarea>
            </div>
            <fieldset class="repeating_weapons">
                <div class="sheet-laf-centredgrid sheet-laf-weaponlist">
                    <button class="sheet-weaponroll" name="act_roll-weapon-rep" type="action">
                        <div class="sheet-weaponrollbutton">b</div>
                    </button>
                    <input class="sheet-weaponweapon sheet-input sheet-redbold" type="text" name="attr_weapon_name-rep"/>
                    <input class="sheet-weaponskill sheet-input" type="number" name="attr_weapon_skill-rep" value="0"/>
                    <select class="sheet-weapondm sheet-input" type="text" name="attr_weapon_DM-rep" value="0">
                        <option value="@{mod-Strength}" data-i18n="skillstrengthoption-u">Strength</option>
                        <option value="@{mod-Dexterity}" data-i18n="skilldexterityoption-u">Dexterity
                        </option>
                    </select>
                    <input class="sheet-weapondmg sheet-input" type="text" name="attr_weapon_damage-rep"/>
                    <input class="sheet-weapontl sheet-input" type="number" name="attr_weapon_tl-rep" value="0"/>
                    <input class="sheet-weaponrange sheet-input" type="text" name="attr_weapon_range-rep" value="0"/>
                    <input class="sheet-weaponweight sheet-input" type="number" name="attr_weapon_weight-rep" value="0" step="0.05"/>
                    <input class="sheet-weaponmag sheet-input" type="text" name="attr_weapon_magazine-rep" value="0"/>
                    <textarea class="sheet-input sheet-laf-wauto" name="attr_weapon_note-rep"></textarea>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<div class="sheet-tab-content sheet-animal">
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal">
        <h5>Animal</h5>
        <h5>Hits</h5>
        <h5>Speed</h5>
        <input type="text" class="sheet-input" name="attr_animal_name"/>
        <input type="number" class="sheet-input" name="attr_animal_hits" value="0"/>
        <span><input type="number" class="sheet-input" name="attr_animal_speed" value="0"/>m</span>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal-sub">
        <span class="sheet-bold">Skills</span>
        <fieldset class="repeating_animalskills">
            <div class="sheet-laf-centredgrid sheet-laf-animal-cols sheet-laf-animal-detail">
                <input class="sheet-laf-wauto" type="text" name="attr_name"/>
                <input type="number" name="attr_mod" value="0"/>
                <button class="sheet-weaponroll" name="act_animalskill" type="action">
                    <span class="sheet-weaponrollbutton">b</span>
                </button>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal-sub">
        <span class="sheet-bold">Attacks</span>
        <fieldset class="repeating_animalattacks">
            <div class="sheet-laf-centredgrid sheet-laf-animal-weapon">
                <input type="text" name="attr_name"/>
                <span class="sheet-bold sheet-textright">Skill Total:</span>
                <input class="sheet-laf-wnum" type="number" value="0" name="attr_attackmod"/>
                <span class="sheet-bold sheet-textright">Damage:</span>
                <input class="sheet-laf-wnum2" type="text" name="attr_damage"/>
                <button class="sheet-weaponroll" name="act_animalattack" type="action">
                    <span class="sheet-weaponrollbutton">b</span>
                </button>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal-sub">
        <span class="sheet-bold">Traits</span>
        <fieldset class="repeating_animaltraits">
            <div class="sheet-laf-animal-cols sheet-laf-centredgrid sheet-laf-animal-detail">
                <input class="sheet-laf-wauto" type="text" name="attr_animaltraits-trait"/>
                <input type="number" name="attr_animaltraits-mod" value="0"/>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal-sub">
        <span class="sheet-bold">Behaviour</span>
        <fieldset class="repeating_animalbehaviour">
            <div class="sheet-laf-animal-cols sheet-laf-centredgrid sheet-laf-animal-detail">
                <input class="sheet-laf-wauto" type="text" name="attr_animalbehaviour"/>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-animal-init">
        <span class="sheet-bold">Mod:&nbsp;</span>
        <input type="number" class="sheet-input" name="attr_animal_initmod" value="0">
        <button class="sheet-laf-initbutton btn ui-draggable sheet-wide-button" type="roll" name="roll_initiative" value="@{whispertoggle} &{template:skill-general} {{skill=^{initiative-u}}} {{character= @{character_name} }} @{ro_default_rolltype}+@{animal_initmod}+@{initiative_effect} @{ro_default_mod} &{tracker}]]}}">
            <div class="sheet-button_header">Roll Initiative (Select Token)</div>
        </button>
    </div>
</div>
<div class="sheet-tab-content sheet-ship">
    <br>
    <div class="sheet-laf-centredgrid sheet-laf-ship">
        <span class="sheet-header sheet-textright" data-i18n="shipname-u"></span>
        <input type="text" class="sheet-input sheet-redbold" name="attr_ship_name"/>
        <span class="sheet-header sheet-textright" data-i18n="shipclass-u"></span>
        <input type="text" class="sheet-input sheet-redbold" name="attr_ship_class"/>
        <span class="sheet-header sheet-textright" data-i18n="shiptl-u"></span>
        <input type="number" class="sheet-input sheet-redbold" name="attr_ship_tl"/>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-ship-hulldamage">
        <span class="sheet-header sheet-shipcomponent" data-i18n="hullpoints-u"></span>
        <span class="sheet-header sheet-textright" data-i18n="hullpointsmax-u"></span>
        <input class="sheet-input sheet-laf-wnum2" type="number" name="attr_hullpoints_max" value="0"/>
        <span class="sheet-header sheet-textright" data-i18n="hullpointscurr-u"></span>
        <input class="sheet-input sheet-laf-wnum2" type="number" name="attr_hullpoints_curr" value="0"/>
        <span></span>
        <span class="sheet-header sheet-shipcomponent" data-i18n="hullcritdam-u"></span>
        <span class="sheet-header sheet-textright" data-i18n="hulllocations-u"></span>
        <select class="sheet-input" name="attr_ship_loc" value="0">
            <option selected></option>
            <option data-i18n="shipsensors-u"></option>
            <option data-i18n="shippower-u"></option>
            <option data-i18n="shipfuel-u"></option>
            <option data-i18n="shipweapons-u"></option>
            <option data-i18n="shiparmour-u"></option>
            <option data-i18n="shiphull-u"></option>
            <option data-i18n="shipmdrive-u"></option>
            <option data-i18n="shipcargo-u"></option>
            <option data-i18n="shipjdrive-u"></option>
            <option data-i18n="crew-u"></option>
            <option data-i18n="shipcomputer-u"></option>
        </select>
        <span class="sheet-header sheet-textright" data-i18n="hullcritlevel-u"></span>
        <select class="sheet-critseverity" name="attr_ship_crit" value="0">>
            <option selected></option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>6</option>
        </select>
        <input type="checkbox" name="attr_shipcrit_more_show" class="sheet-hider sheet-crate sheet-grid-c6r2 sheet-laf-ship-hulldamage-cb" value="1"/><span class=" sheet-grid-c6r2"></span>
        <input type="checkbox" name="attr_shipcrit_more_show" class="sheet-hider sheet-hidden sheet-grid-c6r2" value="1"/>
        <div class="sheet-body sheet-laf-ship-component-rep2">
            <fieldset class="repeating_shipcrit">
                <div class="sheet-laf-centredgrid sheet-laf-ship-hulldamage">
                    <span class="sheet-header sheet-shipcomponent">Critical Damage</span>
                    <span class="sheet-header sheet-textright" data-i18n="hulllocations-u"></span>
                    <select class="sheet-input" name="attr_ship_loc-rep" value="0">
                        <option selected></option>
                        <option data-i18n="shipsensors-u"></option>
                        <option data-i18n="shippower-u"></option>
                        <option data-i18n="shipfuel-u"></option>
                        <option data-i18n="shipweapons-u"></option>
                        <option data-i18n="shiparmour-u"></option>
                    </select>
                    <span class="sheet-header  sheet-textright" data-i18n="hullcritlevel-u"></span>
                    <select class="sheet-critseverity" name="attr_ship_crit-rep" value="0">>
                        <option selected></option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                    </select>
                    <span></span>
                </div>
            </fieldset>
        </div>
    </div>
    <br>
    <div class="sheet-redborder">
        <h4>Sensors</h4>
        <div class="sheet-laf-centredgrid sheet-laf-vehicle-sensors sheet-bold">
            <span>Type</span>
            <span>Sensor Mod</span>
            <span>Player Mod</span>
            <span>Roll</span>
            <span></span>

            <input class="sheet-redbold" type="text" name="attr_ship_sensor_type">
            <input class="" type="number" value="0" name="attr_ship_sensor_playermod">
            <input class="" type="number" value="0" name="attr_ship_sensor_sensormod">
            <button type="roll" class="sheet-button btn ui-draggable" name="roll_vehicle-sensor" value="@{whispertoggle}&{template:skill-attrib} {{skill=Sensor: @{ship_sensor_type}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{ship_sensor_playermod} + @{ship_sensor_sensormod} @{ro_default_mod}]] }}  }}">
                <div class="sheet-weaponrollbutton">b</div>
            </button>
            <span></span>

        </div>
        <fieldset class="repeating_shipsensor">
            <div class="sheet-laf-centredgrid sheet-laf-vehicle-sensors">
                <input class="sheet-redbold" type="text" name="attr_ship_sensor_type">
                <input class="" type="number" value="0" name="attr_ship_sensor_playermod">
                <input class="" type="number" value="0" name="attr_ship_sensor_sensormod">
                <button type="roll" class="sheet-button btn ui-draggable" name="roll_vehicle-sensor" value="@{whispertoggle}&{template:skill-attrib} {{skill=Sensor: @{ship_sensor_type}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{ship_sensor_playermod} + @{ship_sensor_sensormod} @{ro_default_mod}]] }}  }}">
                    <div class="sheet-weaponrollbutton">b</div>
                </button>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid">
        <h4>Hardpoints/Firmpoints [<span name="attr_ship_numhardpoints"></span>]</h4>
        <input type="hidden" name="attr_ship_numhardpoints" value="0">
        <p>Add a hardpoint then add the weapons below for that hardpoint. Destructive weapons should have their damage in the form e.g.: 2DD</p>
        <span class="sheet-redbold-noborder" name="attr_hardpoint_error"></span>
        <fieldset class="repeating_shiphardpoint">
            <div class="sheet-redborder sheet-laf-ship-hardpoint">
                <span>Hardpoint</span>
                <div class="sheet-redborder sheet-boldspan">
                    <span>Gunner Skill:</span>
                    <input class="sheet-laf-wnum" type="number" name="attr_gunner" value="0">
                    <span>DEX Mod.</span>
                    <input class="sheet-laf-wnum" type="number" name="attr_dexmod" value="0">
                    <span>Custom Mod.</span>
                    <input class="sheet-laf-wnum" type="number" name="attr_custommod" value="0">
                    <span></span>
                    <span></span>
                </div>
                <div class="sheet-laf-centredgrid sheet-laf-ship-hardpoint">
                    <span>Name</span>
                    <span>Type</span>
                    <span>TL</span>
                    <span>Power</span>
                    <span>Tons</span>
                    <span>Cost (MCr)</span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>

                    <input class="sheet-laf-ship-traitstext sheet-redbold" type="text" name="attr_hp_name">
                    <input type="text" name="attr_hp_type">
                    <input class="sheet-laf-wnum" type="number" min="0" name="attr_hp_tl" value="0">
                    <input class="sheet-laf-wnum" type="number" min="0" name="attr_hp_power" value="0">
                    <input class="sheet-laf-ship-costtext" type="number" min="0" name="attr_hp_tons" value="0">
                    <input class="sheet-laf-ship-costtext" type="text" name="attr_hp_cost">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </fieldset>
    </div>
    <br>
    <div class="sheet-redborder">
        <h4>Weapons</h4>
        <p>Add weapons ensuring you set the hardpoint name correctly.<br>
            Note that for hardpoints with missiles you will have to add the number of missiles in the salvo to the custom modifier.<br>
            (Note that weapons information from before new updates appear below after Cargo as 'Legacy Weapons'.)</p>
        <span class="sheet-redbold-noborder" name="attr_shipweapon_error"></span>
        <div class="sheet-laf-centredgrid sheet-laf-ship-hardpoint-px">
            <span>Hardpoint Name</span>
            <span>Type</span>
            <span>TL</span>
            <span>Power</span>
            <span>Range</span>
            <span>Cost (MCr)</span>
            <span>Damage</span>
            <span>Traits</span>
            <span>#</span>
            <span></span>
        </div>
        <fieldset class="repeating_shipweapon">
            <div class="sheet-laf-centredgrid sheet-laf-ship-hardpoint">
                <input class="sheet-laf-ship-traitstext sheet-redbold" type="text" min="0" name="attr_w_hardpoint_name">
                <input class="sheet-redbold" type="text" name="attr_w_type">
                <input class="sheet-laf-wnum" type="number" min="0" name="attr_w_tl">
                <input class="sheet-laf-wnum" type="number" min="0" name="attr_w_power">
                <input class="sheet-laf-ship-costtext" type="text" name="attr_w_range">
                <input class="sheet-laf-ship-costtext" type="text" name="attr_w_cost">
                <input class="sheet-laf-wnum" type="text" name="attr_w_damage">
                <input class="sheet-laf-ship-traitstext" type="text" name="attr_w_traits">
                <input class="sheet-laf-wnum" type="number" min="0" name="attr_w_num">
                <button class="sheet-weaponroll" name="act_ship-weapon" type="action">
                    <div class="sheet-weaponrollbutton">b</div>
                </button>
                <input class="sheet-hidden" type="text" name="attr_w_hardpoint_id">
            </div>
        </fieldset>
    </div>
    <br/>
    <div class="sheet-laf-ship-components-template">
        <div class="sheet-redborder sheet-laf-ship-components-p">
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span data-i18n="shipcomponent-u">Component</span>
                <span data-i18n="shipdetail-u">Detail</span>
                <span data-i18n="shiptons-u">Tons</span>
                <span data-i18n="shipcost-u">Cost (MCr)</span>
            </div>
            <br>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shiphull-u">Hull</span>
                <input type="text" name="attr_shiphull_detail"/>
                <input type="text" name="attr_shiphull_tons" value="0" min="0"/>
                <input type="text" name="attr_shiphull_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shiparmour-u">Armour</span>
                <input type="text" name="attr_shiparmour_detail"/>
                <input type="text" name="attr_shiparmour_tons" value="0" min="0"/>
                <input type="text" name="attr_shiparmour_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipmdrive-u">M-Drive</span>
                <input type="text" name="attr_shipmdrive_detail"/>
                <input type="text" name="attr_shipmdrive_tons" value="0" min="0"/>
                <input type="text" name="attr_shipmdrive_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipjdrive-u">J-Drive</span>
                <input type="text" name="attr_shipjdrive_detail"/>
                <input type="number" name="attr_shipjdrive_tons" value="0" min="0"/>
                <input type="text" name="attr_shipjdrive_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shippower-u">Power Plant</span>
                <div class="sheet-power-detail">
                    <input type="text" name="attr_shippower_detail"/>
                    <span>&nbsp;Power:</span>
                    <input type="text" value="0" min="0" name="attr_shippower_rating"/>
                </div>
                <input type="text" name="attr_shippower_tons" value="0" min="0"/>
                <input type="text" name="attr_shippower_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipfuel-u">Fuel Tanks</span>
                <input type="text" name="attr_shipfuel_detail"/>
                <input type="text" name="attr_shipfuel_tons" value="0" min="0"/>
                <input type="text" name="attr_shipfuel_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipbridge-u">Bridge</span>
                <input type="text" name="attr_shipbridge_detail"/>
                <input type="text" name="attr_shipbridge_tons" value="0" min="0"/>
                <input type="text" name="attr_shipbridge_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipcomputer-u">Computer</span>
                <input type="text" name="attr_shipcomputer_detail"/>
                <input type="text" name="attr_shipcomputer_tons" value="0" min="0"/>
                <input type="text" name="attr_shipcomputer_cost" value="0" min="0"/>
                <span></span>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipsensors-u">Sensors</span>
                <input type="text" name="attr_shipsensors_detail"/>
                <input type="text" name="attr_shipsensors_tons" value="0" min="0"/>
                <input type="text" name="attr_shipsensors_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipsensors_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipsensors_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipsensors">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Sensors</span>
                            <input type="text" name="attr_shipsensors_detail-rep"/>
                            <input type="text" name="attr_shipsensors_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipsensors_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipammunition-u">Ammunition</span>
                <input type="text" name="attr_shipammunition_detail"/>
                <input type="text" name="attr_shipammunition_tons" value="0" min="0"/>
                <input type="text" name="attr_shipammunition_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipammunition_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipammunition_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipammunition">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Ammunition</span>
                            <input type="text" name="attr_shipammunition_detail-rep"/>
                            <input type="text" name="attr_shipammunition_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipammunition_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipscreens-u">Screens</span>
                <input type="text" name="attr_shipscreens_detail"/>
                <input type="text" name="attr_shipscreens_tons" value="0" min="0"/>
                <input type="text" name="attr_shipscreens_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipscreens_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipscreens_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipscreens">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Screens</span>
                            <input type="text" name="attr_shipscreens_detail-rep"/>
                            <input type="text" name="attr_shipscreens_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipscreens_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shiparmouredbulkheads-u">Armoured Bulkheads</span>
                <input type="text" name="attr_shiparmouredbulkheads_detail"/>
                <input type="text" name="attr_shiparmouredbulkheads_tons" value="0" min="0"/>
                <input type="text" name="attr_shiparmouredbulkheads_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shiparmouredbulkheads_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shiparmouredbulkheads_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shiparmouredbulkheads">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Armoured Bulkheads</span>
                            <input type="text" name="attr_shiparmouredbulkheads_detail-rep"/>
                            <input type="text" name="attr_shiparmouredbulkheads_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shiparmouredbulkheads_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipcraft-u">Craft</span>
                <input type="text" name="attr_shipcraft_detail"/>
                <input type="text" name="attr_shipcraft_tons" value="0" min="0"/>
                <input type="text" name="attr_shipcraft_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipcraft_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipcraft_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipcraft">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Craft</span>
                            <input type="text" name="attr_shipcraft_detail-rep"/>
                            <input type="text" name="attr_shipcraft_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipcraft_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipsystems-u">Systems</span>
                <input type="text" name="attr_shipsystems_detail"/>
                <input type="text" name="attr_shipsystems_tons" value="0" min="0"/>
                <input type="text" name="attr_shipsystems_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipsystems_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipsystems_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipsystems">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Systems</span>
                            <input type="text" name="attr_shipsystems_detail-rep"/>
                            <input type="text" name="attr_shipsystems_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipsystems_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipstaterooms-u">Staterooms</span>
                <input type="text" name="attr_shipstaterooms_detail"/>
                <input type="text" name="attr_shipstaterooms_tons" value="0" min="0"/>
                <input type="text" name="attr_shipstaterooms_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipstaterooms_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipstaterooms_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipstaterooms">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Staterooms</span>
                            <input type="text" name="attr_shipstaterooms_detail-rep"/>
                            <input type="text" name="attr_shipstaterooms_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipstaterooms_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipsoftware-u">Software</span>
                <input type="text" name="attr_shipsoftware_detail"/>
                <input type="text" name="attr_shipsoftware_tons" value="0" min="0"/>
                <input type="text" name="attr_shipsoftware_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipsoftware_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipsoftware_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipsoftware">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Software</span>
                            <input type="text" name="attr_shipsoftware_detail-rep"/>
                            <input type="text" name="attr_shipsoftware_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipsoftware_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipcommonareas-u">CommonAreas</span>
                <input type="text" name="attr_shipcommonareas_detail"/>
                <input type="text" name="attr_shipcommonareas_tons" value="0" min="0"/>
                <input type="text" name="attr_shipcommonareas_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipcommonareas_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipcommonareas_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipcommonareas">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Software</span>
                            <input type="text" name="attr_shipcommonareas_detail-rep"/>
                            <input type="text" name="attr_shipcommonareas_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipcommonareas_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text" data-i18n="shipcargo-u">Cargo</span>
                <input type="text" name="attr_shipcargo_detail"/>
                <input type="text" name="attr_shipcargo_tons" value="0" min="0"/>
                <input type="text" name="attr_shipcargo_cost" value="0" min="0"/>
            </div>
            <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                <span type="text">Legacy Weapons</span>
                <input type="text" name="attr_shipweapons_detail"/>
                <input type="text" name="attr_shipweapons_tons" value="0" min="0"/>
                <input type="text" name="attr_shipweapons_cost" value="0" min="0"/>
                <input type="checkbox" name="attr_shipweapons_more_show" class="sheet-hider sheet-crate sheet-laf-ship-component-hider" value="1"/>
                <span class="sheet-laf-ship-component-hider"></span>
                <input type="checkbox" name="attr_shipweapons_more_show" class="sheet-hider sheet-hidden" value="1"/>
                <div class="sheet-laf-ship-component-rep sheet-body">
                    <fieldset class="repeating_shipweapons">
                        <div class="sheet-laf-centredgrid sheet-laf-ship-components sheet-bold">
                            <span type="text">Weapons</span>
                            <input type="text" name="attr_shipweapons_detail-rep"/>
                            <input type="text" name="attr_shipweapons_tons-rep" value="0" min="0"/>
                            <input type="text" name="attr_shipweapons_cost-rep" value="0" min="0"/>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="sheet-redborder sheet-laf-ship-crew-p">
            <h4>Crew</h4>
            <textarea class="sheet-laf-borderbox" name="attr_crew"></textarea>
        </div>
        <div class="sheet-redborder sheet-laf-ship-runningcosts-p">
            <h4>Running Costs</h4>
            <h5>Maintenance Cost</h5>
            <span class="sheet-laf-centre">&nbsp;&nbsp;Cr&nbsp;<input type="text" name="attr_ship_maintenance_cost">/month</span>
            <h5>Purchase Cost</h5>
            <span>MCr&nbsp;<input type="text" name="attr_ship_purchase_cost"></span>
        </div>
        <div class="sheet-redborder sheet-laf-ship-power-p">
            <h4>Power [<span name="attr_ship_totalpower"></span>/<span name="attr_shippower_rating"></span>]</h4>
            <input type="hidden" name="attr_ship_totalpower" value="0">
            <h5>Manoeuvre Drive</h5>
            <input class="sheet-input" type="number" name="attr_power_manu" value="0" min="0">
            <h5>Jump Drive</h5>
            <input class="sheet-input" type="number" name="attr_power_jump" value="0" min="0">
            <h5>Basic Ship Systems</h5>
            <input class="sheet-input" type="number" name="attr_power_basic" value="0" min="0">
            <h5>Fuel Processor</h5>
            <input class="sheet-input" type="number" name="attr_power_fuel" value="0" min="0">
            <h5>Sensors</h5>
            <input class="sheet-input" type="number" name="attr_power_sensors" value="0" min="0">
            <h5>Weapons</h5>
            <input class="sheet-input" type="number" name="attr_power_weapons" value="0" min="0">
            <span>&nbsp;</span>
        </div>
    </div>
    <br>
    <div class="sheet-redborder">
        <div>
            <span class="sheet-header sheet-shipcomponent" data-i18n="description-u">Description</span>
        </div>
        <div>
            <textarea class="sheet-laf-width-99" name="attr_ship_description"></textarea>
        </div>
    </div>
</div>
<div class="sheet-tab-content sheet-vehicle">
    <h3 class="sheet-header">Vehicle Name</h3>
    <div>
        <input type="text" class="sheet-input sheet-laf-vehicle-textarea sheet-redbold" name="attr_vehicle_name">
    </div>
    <br>
    <h3>Armor</h3>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-vehicle-armor sheet-bold">
        <span class="sheet-textright">Front</span>
        <input class="sheet-laf-wnum2" type="number" name="attr_vehicle_armorfront" value="0" min="0">
        <span class="sheet-textright">Rear</span>
        <input class="sheet-laf-wnum2" type="number" name="attr_vehicle_armorrear" value="0" min="0">
        <span class="sheet-textright">Sides</span>
        <input class="sheet-laf-wnum2" type="number" name="attr_vehicle_armorsides" value="0" min="0">
    </div>
    <br>
    <h4>Details</h4>
    <div class="sheet-redborder sheet-laf-centredgrid sheet sheet-laf-vehicle-data sheet-bold">
        <span>Tech Level</span>
        <input type="text" name="attr_vehicle_tl">
        <span>Skill</span>
        <input type="text" name="attr_vehicle_skill">
        <span>Agility</span>
        <input type="text" name="attr_vehicle_agility">
        <span>Speed (Cruise)</span>
        <input type="text" name="attr_vehicle_speed">
        <span>Range (Cruise)</span>
        <input type="text" name="attr_vehicle_range">
        <span>Crew</span>
        <input type="text" name="attr_vehicle_crew">
        <span>Passengers</span>
        <input type="text" name="attr_vehicle_passengers">
        <span>Cargo</span>
        <input type="text" name="attr_vehicle_cargo">
        <span>Hull</span>
        <input type="text" name="attr_vehicle_hull">
        <span>Shipping</span>
        <input type="text" name="attr_vehicle_shipping">
        <span>Cost</span>
        <input type="text" name="attr_vehicle_cost">
    </div>
    <br>
    <div class="sheet-redborder sheet-laf-centredgrid sheet-laf-vehicle-data sheet-bold">
        <span>Autopilot (skill level)</span>
        <div class="sheet-trade_content">
            <input type="number" name="attr_vehicle_autopilot" value="0">
            <button class="sheet-weaponroll" name="act_vehicle-autopilot" type="action">
                <span class="sheet-weaponrollbutton">b</span>
            </button>
        </div>
        <span>Communications Range</span>
        <input type="text" name="attr_vehicle_commsrange">
        <span>Navigation (Navigation DM)</span>
        <div class="sheet-trade_content">
            <input type="number" name="attr_vehicle_navigation" value="0">
            <button class="sheet-weaponroll" name="act_vehicle-navigation" type="action">
                <span class="sheet-weaponrollbutton">b</span>
            </button>
        </div>
        <span>Sensors (Electronics (sensors) DM)</span>
        <div class="sheet-trade_content">
            <input type="number" name="attr_vehicle_sensors" value="0">
            <button class="sheet-weaponroll" name="act_vehicle-sensors" type="action">
                <span class="sheet-weaponrollbutton">b</span>
            </button>
        </div>
        <span>Camoflage (Recon DM)</span>
        <div class="sheet-trade_content">
            <input type="number" name="attr_vehicle_camoflage" value="0">
            <button class="sheet-weaponroll" name="act_vehicle-camoflage" type="action">
                <span class="sheet-weaponrollbutton">b</span>
            </button>
        </div>
        <span>Stealth (Electronics (sensors) DM)</span>
        <div class="sheet-trade_content">
            <input type="number" name="attr_vehicle_stealth" value="0">
            <button class="sheet-weaponroll" name="act_vehicle-stealth" type="action">
                <span class="sheet-weaponrollbutton">b</span>
            </button>
        </div>
    </div>
    <br>
    <div class="sheet-redborder">
        <h4>Sensors</h4>
        <div class="sheet-laf-centredgrid sheet-laf-vehicle-sensors sheet-bold">
            <span>Type</span>
            <span>Sensor Mod</span>
            <span>Player Mod</span>
            <span>Roll</span>
            <span></span>
            <input class="sheet-redbold" type="text" name="attr_vehicle_sensor_type">
            <input class="" type="number" value="0" name="attr_vehicle_sensor_playermod">
            <input class="" type="number" value="0" name="attr_vehicle_sensor_sensormod">
            <button type="roll" class="sheet-button btn ui-draggable" name="roll_vehicle-sensor" value="@{whispertoggle}&{template:skill-attrib} {{skill=Sensor: @{vehicle_sensor_type}}} {{character= @{character_name} }} @{ro_default_rolltype} + @{vehicle_sensor_playermod} + @{vehicle_sensor_sensormod} @{ro_default_mod}]] }}  }}">
                <div class="sheet-weaponrollbutton">b</div>
            </button>
        </div>
    </div>
    <br>
    <div class="sheet-redborder">
        <div class="sheet-redborder sheet-laf-centredgrid">
            <h4>Mounts</h4>
            <p>Add a mount then add the weapons below for that mount. Destructive weapons should have their damage in the form e.g.: 2DD</p>
            <span class="sheet-redbold-noborder" name="attr_vehiclemount_error"></span>
            <fieldset class="repeating_vehiclemount">
                <div class="sheet-laf-ship-hardpoint">
                    <div class="sheet-redborder sheet-boldspan">
                        <span>Name: </span>
                        <input class="sheet-laf-ship-traitstext sheet-redbold" type="text" name="attr_mount_name">
                        <span>Type: </span>
                        <input type="text" name="attr_hp_type">
                        <span>Gunner Skill:</span>
                        <input class="sheet-laf-wnum" type="number" name="attr_gunner" value="0">
                        <span>DEX Mod.</span>
                        <input class="sheet-laf-wnum" type="number" name="attr_dexmod" value="0">
                        <span>Custom Mod.</span>
                        <input class="sheet-laf-wnum" type="number" name="attr_custommod" value="0">
                        <input class="sheet-hidden" type="text" name="attr_mount_id">

                    </div>
                </div>
            </fieldset>
        </div>
        <br>
        <h4>Weapons</h4>
        <div class="sheet-redborder">
            <span><strong>Note:</strong> For Destructive weapons enter the damage as e.g. 3DD.</span>
            <br>
            <span class="sheet-redbold-noborder" name="attr_vehicleweapon_error"></span>
            <hr class="sheet-hr">
            <div class="sheet-laf-centredgrid sheet-laf-vehicle-weaponsrow sheet-bold sheet-laf-wauto">
                <span>Mount</span>
                <span>Weapon</span>
                <span>Range</span>
                <span>Damage</span>
                <span>Magazine</span>
                <span>Mag. Cost</span>
                <span>Traits</span>
                <span>Fire Control</span>
                <!--            <span>Mod.</span>-->
                <span></span>
            </div>
            <div>
                <fieldset class="repeating_vehicleweapons">
                    <div class="sheet-laf-centredgrid sheet-laf-vehicle-weaponsrow sheet-bold sheet-laf-wauto">
                        <input class="sheet-redbold" type="text" name="attr_mount_name">
                        <input class="sheet-redbold" type="text" name="attr_weapon">
                        <input type="text" name="attr_range">
                        <input type="text" name="attr_damage">
                        <input type="text" name="attr_magazine">
                        <input type="text" name="attr_magcost">
                        <input type="text" name="attr_traits">
                        <input type="text" name="attr_firecontrol">
                        <!--                    <input type="number" name="attr_mod" value="0">-->
                        <button class="sheet-weaponroll" name="act_vehicle-weapon" type="action">
                            <span class="sheet-weaponrollbutton">b</span>
                        </button>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <br>
    <hr class="sheet-hr">
    <div class="sheet-narrowtext">
        <h4>Traits</h4>
        <textarea class="sheet-laf-vehicle-textarea" name="attr_vehicle_traits"></textarea>
        <br>
        <hr class="sheet-hr">
        <h4>Equipment</h4>
        <textarea class="sheet-laf-vehicle-textarea" name="attr_vehicle_equipment"></textarea>
        <br>
        <hr class="sheet-hr">
        <h4>Description</h4>
        <textarea class="sheet-laf-vehicle-textarea" name="attr_vehicle_description"></textarea>
        <br>
        <hr class="sheet-hr">
        <h4>Notes</h4>
        <textarea class="sheet-laf-vehicle-textarea" name="attr_vehicle_weapons"></textarea>
    </div>
</div>
<div class="sheet-tab-content sheet-trade">
    <!-- Sub-tabs-->
    <input type='hidden' class='sheet-tradetoggle' name='attr_sheetTradeType' value='passengers'/>
    <div>
        <input type='hidden' class='sheet-tradetypeshow' name='attr_sheetTradeTypeShow' value='passengers'/>
        <button type="action" name="act_passengers" class="sheet-type sheet-type-passengers" data-i18n="passengers-u">
            Passengers
        </button>
        <button type="action" name="act_freight" class="sheet-type sheet-type-freight" data-i18n="freight-u">Freight
        </button>
        <button type="action" name="act_speculative" class="sheet-type sheet-type-speculative" data-i18n="speculative-u">Speculative
        </button>
        <button type="action" name="act_tradelog" class="sheet-type sheet-type-tradelog">Log</button>
    </div>
    <!--    Cargo Manifest-->
    <span class="sheet-bold">(It is recommended using the Purchase and Sale UWPs as these will auto-fill attributes across all Trade types)</span>
    <br>
    <span class="sheet-bold sheet-textright">Purchase UWP: </span>
    <input type="text" name="attr_trade_purchase_uwp" placeholder="CA6A643-9 N Ri Wa" class="sheet-redbold sheet-uwptext">
    <button type="action" name="act_trade-purchase-uwp" class="sheet-type sheet-type-speculative sheet-manifest-button sheet-uwpbutton">Apply
    </button>
    <span class="sheet-bold sheet-textright-margin">Sale UWP: </span>
    <input type="text" name="attr_trade_sale_uwp" placeholder="CA6A643-9 N Ri Wa" class="sheet-redbold sheet-uwptext">
    <button type="action" name="act_trade-sale-uwp" class="sheet-type sheet-type-speculative sheet-manifest-button sheet-uwpbutton">Apply
    </button>
    <div class="sheet-speculative-subpanel sheet-hazard-border">
        <span class="sheet-bold sheet-mod sheet-big">&nbsp;Cargo Manifest&nbsp;&nbsp;</span>
        <input type="checkbox" name="attr_cargomanifest_show" class="sheet-hider sheet-crate" value="1" checked>
        <span></span>
        <div class="sheet-body sheet-slidein sheet-speculativegoods">
            <div class="sheet-groupfunds">
                <h3>Group Funds: Cr</h3>
                <input name="attr_group_funds" type="number" value="0">
                <input name="attr_speculative_sg_tons_total" type="number" value="0" class="sheet-hidden">
                <input name="attr_speculative_fg_tons_total" type="number" value="0" class="sheet-hidden">
                <input name="attr_speculative_og_tons_total" type="number" value="0" class="sheet-hidden">
            </div>
            <br>
            <div class="sheet-speculativegoods-row-pg">
                <h5>Key</h5>
                <h5>Type</h5>
                <h5>Tons</h5>
                <h5>Base Px/Ton</h5>
                <h5>Supp. Px/Ton</h5>
                <h5 class="sheet-textright">Total Tons:</h5>
                <h5><span name="attr_speculative_tons_total"></span></h5>
            </div>
            <hr class="sheet-hr">
            <h3>Speculative Goods</h3>
            <fieldset class="repeating_speculative-sale-goods">
                <div class="sheet-speculativegoods-row-pg">
                    <span name="attr_speculative_sg_key"></span> <span name="attr_speculative_sg_type"></span>
                    <span name="attr_speculative_sg_tons_display"></span>
                    <span>Cr<span name="attr_speculative_sg_baseprice"></span></span>
                    <span>Cr<span name="attr_speculative_pg_price"></span></span>
                </div>
            </fieldset>
            <div class="sheet-speculativegoods-row-pg">
                <h5></h5>
                <h5>
                    <button type="action" name="act_consolidate-speculative-goods" class="sheet-redborder sheet-bordered-width sheet-manifest-button">Consolidate
                    </button>
                </h5>
                <h5></h5>
                <h5></h5>
                <h5>
                    <button type="action" name="act_clear-speculative-goods" class="sheet-redborder sheet-bordered-width sheet-manifest-button">Clear
                    </button>
                </h5>
                <h5></h5>
            </div>
            <hr class="sheet-hr">
            <h3>Freight Goods</h3>
            <fieldset class="repeating_speculative-freight-goods">
                <div class="sheet-speculativegoods-row-pg">
                    <span name="attr_speculative_fg_key"></span> <span name="attr_speculative_fg_type"></span>
                    <span name="attr_speculative_fg_tons_display"></span>
                    <span>Cr<span name="attr_speculative_fg_baseprice"></span></span>
                </div>
            </fieldset>
            <div class="sheet-speculativegoods-row-pg">
                <h5></h5>
                <h5></h5>
                <h5></h5>
                <h5></h5>
                <h5>
                    <button type="action" name="act_clear-freight-goods" class="sheet-redborder sheet-bordered-width sheet-manifest-button">Clear
                    </button>
                </h5>
                <h5></h5>
            </div>
            <hr class="sheet-hr">
            <h3>Other Goods</h3>
            <fieldset class="repeating_speculative-other-goods">
                <div class="sheet-speculativegoods-row-pg">
                    <span name="attr_speculative_og_key">-</span> <input type="text" name="attr_speculative_og_type">
                    <input type="number" name="attr_speculative_og_tons_display" value="0" min="0">
                    <input type="text" name="attr_speculative_og_notes" placeholder="Note">
                </div>
            </fieldset>
            <hr class="sheet-hr">
            <h3>Passengers</h3>
            <div class="sheet-passenger-info-row">
                <h5 class="sheet-textright">High:</h5>
                <span name="attr_passengers_high_num_taken"></span>
                <h5 class="sheet-textright">Medium:</h5>
                <span name="attr_passengers_medium_num_taken"></span>
                <h5 class="sheet-textright">Basic:</h5>
                <span name="attr_passengers_basic_num_taken"></span>
                <h5 class="sheet-textright">Low:</h5>
                <span name="attr_passengers_low_num_taken"></span>
            </div>
            <div class="sheet-speculativegoods-row-pg">
                <h5></h5>
                <h5></h5>
                <h5></h5>
                <h5></h5>
                <h5>
                    <button name="act_passengers-clear" type="action" class="sheet-redborder sheet-bordered-width sheet-manifest-button">Clear
                    </button>
                </h5>
                <h5></h5>
            </div>
        </div>
    </div>
    <div class="sheet-tab-content sheet-passengers">
        <p class="sheet-bold">Passengers</p>
        <div class="sheet-redborder">
            <span>Broker, Carouse or Streetwise Check Effect</span>
            <input type="number" class="sheet-input sheet-bold" name="attr_passengers_effect_broker" value="0">
        </div>
        <br>
        <div class="sheet-redborder">
            <span>Highest Steward Skill on Ship</span>
            <input type="number" class="sheet-input sheet-bold" name="attr_passengers_mod_steward" value="0">
        </div>
        <br>
        <div class="sheet-redborder sheet-trade-passagetype">
            <span class="sheet-bold">Passage Type</span>
            <input type="radio" name="attr_passengers_class" value="All" checked>
            <span>All</span>
            <input type="radio" name="attr_passengers_class" value="High">
            <span>High Passage</span>
            <input type="radio" name="attr_passengers_class" value="Medium">
            <span>Medium Passage</span>
            <input type="radio" name="attr_passengers_class" value="Basic">
            <span>Basic Passage</span>
            <input type="radio" name="attr_passengers_class" value="Low">
            <span>Low Passage</span>
        </div>
        <br>
        <div class="sheet-redborder sheet-trade-parsecs">
            <span class="sheet-bold">Parsecs</span>
            <input type="radio" name="attr_passengers_parsecs" value="1" checked> <span>1</span>
            <input type="radio" name="attr_passengers_parsecs" value="2"> <span>2</span>
            <input type="radio" name="attr_passengers_parsecs" value="3"> <span>3</span>
            <input type="radio" name="attr_passengers_parsecs" value="4"> <span>4</span>
            <input type="radio" name="attr_passengers_parsecs" value="5"> <span>5</span>
            <input type="radio" name="attr_passengers_parsecs" value="6"> <span>6</span>
        </div>
        <br>
        <div class="sheet-passenger-content">
            <div class="sheet-redborder">
                <h4>Source</h4>
                <span></span>
                <span></span>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Population</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_population" value="pop1">
                            <span>&lt;= 1</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_population" value="pop67">
                            <span>6-7</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_population" value="pop8">
                            <span>8+</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_population" value="na" checked>
                            <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Starport</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="a" checked>
                            <span>A</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="b"> <span>B</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="c"> <span>C</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="d"> <span>D</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="e"> <span>E</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_starport" value="x"> <span>X</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Zone</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_zone" value="amber"> <span>Amber</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_zone" value="red"> <span>Red</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_src_zone" value="zone-neither" checked>
                            <span>Neither</span>
                        </td>
                    </tr>
                </table>

            </div>
            <div class="sheet-redborder">
                <h4>Destination</h4>
                <span></span>
                <span></span>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Population</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_population" value="pop1">
                            <span>&lt;= 1</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_population" value="pop67">
                            <span>6-7</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_population" value="pop8">
                            <span>8+</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_population" value="na" checked>
                            <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Starport</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="a" checked>
                            <span>A</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="b"> <span>B</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="c"> <span>C</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="d"> <span>D</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="e"> <span>E</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_starport" value="x"> <span>X</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Zone</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_zone" value="amber"> <span>Amber</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_zone" value="red"> <span>Red</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_passengers_dest_zone" value="zone-neither" checked>
                            <span>Neither</span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <br>
        <div class="sheet-redborder">
            <div class="sheet-redborder">
                <span>Custom modifier:</span>
                <input type="number" class="sheet-input sheet-bold" name="attr_passengers_mod_custom" value="0">
            </div>
            <div>
                <button type="action" class="sheet-button sheet-roll_boon sheet-wide-button" name="act_passengers-calculate">
                    <span class="sheet-button_header">Calculate Passengers</span>
                </button>
                <input name="attr_passenger_info" type="text" class="sheet-hidden" value="" disabled>
                <br> <br>
                <div class="sheet-freight-info-row">
                    <h5>Type</h5>
                    <h5># To Take</h5>
                    <h5># Available</h5>
                    <h5>Cost/Passenger</h5>
                </div>
                <div class="sheet-freight-info-row">
                    <span>High Passage</span>
                    <input name="attr_passengers_high_num_take" type="number" value="0" min="0">
                    <span name="attr_passengers_high_num_available"></span>
                    <span name="attr_passengers_high_cost"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Medium Passage</span>
                    <input name="attr_passengers_medium_num_take" type="number" value="0" min="0">
                    <span name="attr_passengers_medium_num_available"></span>
                    <span name="attr_passengers_medium_cost"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Basic Passage</span>
                    <input name="attr_passengers_basic_num_take" type="number" value="0" min="0">
                    <span name="attr_passengers_basic_num_available"></span>
                    <span name="attr_passengers_basic_cost"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Low Passage</span> <input name="attr_passengers_low_num_take" type="number" value="0" min="0">
                    <span name="attr_passengers_low_num_available"></span>
                    <span name="attr_passengers_low_cost"></span>
                </div>
                <button type="action" class="sheet-button sheet-roll_boon sheet-wide-button" name="act_passengers-take">
                    <span class="sheet-button_header sheet-med">Take Passengers</span></button>
            </div>
        </div>
    </div>
    <div class="sheet-tab-content sheet-freight">
        <p class="sheet-bold">Freight (Note <span class="sheet-mail-attrs">coloured</span> parameters only applicable to
            <span class="sheet-mail-attrs">Mail</span>)</p>
        <div class="sheet-redborder">
            <span>Broker or Streetwise Check Effect</span>
            <input type="number" class="sheet-input sheet-bold" name="attr_freight_effect_broker" value="0">
            <span class="sheet-mail-attrs">Highest Naval or Scout DM</span>
            <input type="number" class="sheet-input sheet-bold" name="attr_freight_navalscout" value="0">
            <span class="sheet-mail-attrs">Highest Society DM</span>
            <input type="number" class="sheet-input sheet-bold" name="attr_freight_society" value="0">
            <span class="sheet-mail-attrs">Ship Armed?</span>
            <input type="checkbox" name="attr_freight_shiparmed" value="on" class="sheet-button">
        </div>
        <br>
        <div class="sheet-redborder">
            <table class="sheet-laf-animal">
                <tr>
                    <td class="sheet-bold">Cargo Type&nbsp;&nbsp;</td>
                    <td>
                        <input type="radio" name="attr_freight_cargotype" value="All" checked> <span>All</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_cargotype" value="Incidental">
                        <span>Incidental</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_cargotype" value="Minor"> <span>Minor</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_cargotype" value="Major"> <span>Major</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_cargotype" value="Mail">
                        <span class="sheet-mail-attrs">Mail</span>
                    </td>
                </tr>
            </table>
        </div>
        <br>
        <div class="sheet-redborder">
            <table class="sheet-laf-animal">
                <tr>
                    <td class="sheet-bold">Parsecs</td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="1" checked> <span>1</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="2"> <span>2</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="3"> <span>3</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="4"> <span>4</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="5"> <span>5</span>
                    </td>
                    <td>
                        <input type="radio" name="attr_freight_parsecs" value="6"> <span>6</span>
                    </td>
                </tr>
            </table>
        </div>
        <br>
        <div class="sheet-freight-content">
            <div class="sheet-redborder">
                <h4>Source</h4>
                <span></span>
                <span></span>
                <span></span>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Population</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_population" value="pop1"> <span>&lt;=1</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_population" value="pop67"> <span>6-7</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_population" value="pop8"> <span>8+</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_population" value="na" checked>
                            <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Starport</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="a" checked>
                            <span>A</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="b"> <span>B</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="c"> <span>C</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="d"> <span>D</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="e"> <span>E</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_starport" value="x"> <span>X</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Tech Level</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_techlevel" value="tl5">
                            <span class="sheet-mail-attrs">&lt;=5</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_techlevel" value="tl6"> <span>&lt;=6</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_techlevel" value="tl9"> <span>&gt;=9</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_techlevel" value="na" checked> <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Zone</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_zone" value="amber"> <span>Amber</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_zone" value="red"> <span>Red</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_src_zone" value="zone-neither" checked>
                            <span>Neither</span>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="sheet-redborder">
                <h4>Destination</h4>
                <span></span>
                <span></span>
                <span></span>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Population</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_population" value="pop1"> <span>&lt;=1</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_population" value="pop67"> <span>6-7</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_population" value="pop8"> <span>8+</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_population" value="na" checked>
                            <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Starport</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="a" checked>
                            <span>A</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="b"> <span>B</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="c"> <span>C</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="d"> <span>D</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="e"> <span>E</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_starport" value="x"> <span>X</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Tech Level</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_techlevel" value="tl5">
                            <span class="sheet-mail-attrs">&lt;=5</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_techlevel" value="tl6"> <span>&lt;=6</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_techlevel" value="tl9"> <span>&gt;=9</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_techlevel" value="na" checked>
                            <span>Other</span>
                        </td>
                    </tr>
                </table>
                <table class="sheet-redborder sheet-trade-block">
                    <tr>
                        <td class="sheet-bold">Zone</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_zone" value="amber"> <span>Amber</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_zone" value="red"> <span>Red</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="attr_freight_dest_zone" value="zone-neither" checked>
                            <span>Neither</span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <br>
        <div class="sheet-redborder">
            <div class="sheet-redborder">
                <span>Custom modifier:</span>
                <input type="number" class="sheet-input sheet-bold" name="attr_freight_mod_custom" value="0">
            </div>
            <div>
                <button type="action" class="sheet-button sheet-roll_boon sheet-wide-button" name="act_freight-calculate">
                    <span class="sheet-button_header">Calculate Freight</span>
                </button>
                <input name="attr_freight_modifier" type="number" class="sheet-hidden" value="0">
                <input name="attr_freight_info" type="text" class="sheet-hidden" value=""> <br> <br>
                <div class="sheet-freight-info-row">
                    <h5>Type</h5>
                    <h5>Lots To Take</h5>
                    <h5>Lots Available</h5>
                    <h5>Tons/Lot</h5>
                    <h5>Price/Ton</h5>
                    <h5>Price/Lot</h5>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Major Cargo</span>
                    <input name="attr_freight_major_lots_to_take" type="number" value="0" min="0">
                    <span name="attr_freight_major_lots_available"></span>
                    <span name="attr_freight_major_tons_per_lot"></span>
                    <span name="attr_freight_major_price_per_ton"></span>
                    <span name="attr_freight_major_price_per_lot"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Minor Cargo</span>
                    <input name="attr_freight_minor_lots_to_take" type="number" value="0" min="0">
                    <span name="attr_freight_minor_lots_available"></span>
                    <span name="attr_freight_minor_tons_per_lot"></span>
                    <span name="attr_freight_minor_price_per_ton"></span>
                    <span name="attr_freight_minor_price_per_lot"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Incidental Cargo</span>
                    <input name="attr_freight_incidental_lots_to_take" type="number" value="0" min="0">
                    <span name="attr_freight_incidental_lots_available"></span>
                    <span name="attr_freight_incidental_tons_per_lot"></span>
                    <span name="attr_freight_incidental_price_per_ton"></span>
                    <span name="attr_freight_incidental_price_per_lot"></span>
                </div>
                <div class="sheet-freight-info-row">
                    <span>Mail</span> <input name="attr_freight_mail_lots_to_take" type="number" value="0" min="0">
                    <span name="attr_freight_mail_lots_available"></span>
                    <span name="attr_freight_mail_tons_per_lot"></span>
                    <span name="attr_freight_mail_price_per_ton"></span>
                    <span name="attr_freight_mail_price_per_lot"></span>
                </div>
                <button type="action" class="sheet-button sheet-roll_boon sheet-wide-button" name="act_freight-take">
                    <span class="sheet-button_header">Take Freight</span>
                </button>
                <span class="sheet-bold">Freight Late?</span>
                <input type="checkbox" name="attr_freight_late" value="on" class="sheet-button">
                <button type="action" class="sheet-button sheet-roll_boon sheet-wide-button" name="act_freight-deliver">
                    <span class="sheet-button_header">Deliver Freight</span>
                </button>
            </div>
        </div>
    </div>
    <div class="sheet-tab-content sheet-speculative">
        <p class="sheet-bold">Speculative</p>
        <button type="action" class="sheet-redborder sheet-bordered-width" name="act_speculative-reset">
            <span class="sheet-speculativebutton">9&nbsp;</span>Reset Speculative To Defaults
        </button>
        <div class="sheet-hazard-border-purchase">
            <div class="sheet-speculative-subpanel">
                <p class="sheet-bold">1. Find a Supplier or Local Broker</p>
                <p>Select starport then click the
                    <span class="sheet-speculativebutton">b</span> button for the type of Broker or Supplier you require (Regular, Black Market or Online).
                </p>
                <p>Populate your Traveller's Broker Skill or click the Local broker
                    <span class="sheet-speculativebutton">b</span> button to generate their Broker skill and set their Negotiation modifier and the Supplier's Broker Skill as advised by your GM (normally both are +2).
                </p>
                <div class="sheet-speculativestarport-row sheet-redborder">
                    <span class="sheet-textright">Starport A</span>
                    <input type="radio" name="attr_speculative_purchase_starport_dm" value="6">
                    <span class="sheet-textright">Starport B</span>
                    <input type="radio" name="attr_speculative_purchase_starport_dm" value="4">
                    <span class="sheet-textright">Starport C</span>
                    <input type="radio" name="attr_speculative_purchase_starport_dm" value="2">
                    <span class="sheet-textright">Other</span>
                    <input type="radio" name="attr_speculative_purchase_starport_dm" value="0" checked>
                </div>
                <input type="text" name="attr_speculative_purchase_blackmarket" class="sheet-hidden">
                <div class="sheet-redborder">
                    <input type="text" name="attr_speculative_purchase_broker_type" class="sheet-hidden" value="">
                    <p>
                        <input type="text" name="attr_speculative_purchase_broker_type_normal" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_purchase_broker_type_normal"></span>Finding a Regular Supplier or Broker: Broker EDU or SOC DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_broker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-purchase-broker-find">b
                        </button>
                    </p>
                    <p>
                        <input type="text" name="attr_speculative_purchase_broker_type_illegal" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_purchase_broker_type_illegal"></span>Finding a Black Market Supplier or Broker of Illegal Goods: Streetwise EDU or SOC DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_illegalbroker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-purchase-illegalbroker-find">b
                        </button>
                    </p>
                    <p>
                        <input type="text" name="attr_speculative_purchase_broker_type_online" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_purchase_broker_type_online">&nbsp;</span>Finding an Online Supplier or Broker (TL8+ worlds only): EDU DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_onlinebroker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-purchase-onlinebroker-find">b
                        </button>
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>
                        <input type="radio" name="attr_speculative_purchase_localbroker_flag" value="false" checked>Traveller's Broker skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_broker_skill" value="0">
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>
                        <input type="radio" name="attr_speculative_purchase_localbroker_flag" value="true">Local Broker (Takes 10% of gross (20% on illegal)). Click for their broker skill.
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-purchase-localbroker-skill">b
                        </button>
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_localbroker_skill" value="0"> Negotiation skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_localbroker_negskill" value="2">
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>Supplier's Broker Skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_supplier_skill" value="2">
                    </p>
                </div>
            </div>
            <div class="sheet-speculative-subpanel">
                <p class="sheet-bold">2. Determine Goods Available &</p>
                <p class="sheet-bold">3. Determine Purchase Price</p>
                <p>Set the current planet's Population and tick the relevant trade codes, then click the
                    <em>Determine Trade Goods' button</em>. This will calculate all available goods and their local prices.
                </p>
                <p>Select the tons of each type of goods you wish to purchase. Use the
                    <span class="sheet-speculativebutton">D</span> buttons to quickly zero the quantities for goods you do not wish to buy, and the
                    <span class="sheet-speculativebutton">r</span> buttons to restore the value. (Or just delete the rows).
                </p>
                <p>Once you are happy with your selections click
                    <em>Purchase Trade Goods</em>. This will transfer the trade goods details to your 'Cargo Manifest'
                </p>
                <div class="sheet-trade_content">
                    <div class="sheet-redborder">
                        <span class="sheet-bold">Population</span>
                        <br>
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_population" value="0" min="0" max="12">
                        <br>
                        <span class="sheet-bold">Law Level</span>
                        <br>
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_purchase_lawlevel" value="0" min="0" max="18">
                    </div>
                    <div class="sheet-redborder">
                        <p class="sheet-bold">Trade Codes</p>
                        <table>
                            <tr>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_agricultural" value="1" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Agricultural</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_asteroid" value="2" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Asteroid</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_barren" value="3" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Barren</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_desert" value="4" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Desert</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_fluid_oceans" value="5" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Fluid Oceans</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_garden" value="6" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Garden</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_high_population" value="7" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">High Population</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_high_tech" value="8" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">High Tech</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_ice_capped" value="9" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Ice-Capped</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_industrial" value="10" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Industrial</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_low_population" value="11" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Low Population</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_low_tech" value="12" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Low Tech</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_non_agricultural" value="13" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Non-Agricultural</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_non_industrial" value="14" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Non-Industrial</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_poor" value="15" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Poor</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_rich" value="16" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Rich</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_vacuum" value="17" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Vacuum</span>
                                </td>
                                <td>
                                    <input type="checkbox" name="attr_purchase_tc_waterworld" value="18" class="sheet-button"/>
                                    <span class="sheet-button" class="sheet-mail-attrs">Water World</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <button type="action" name="act_determine-trade-goods-and-prices" class="sheet-redborder sheet-bordered-width">
                    <span class="sheet-speculativebutton">9&nbsp;</span>Determine Trade Goods & Prices
                </button>
                <input type="text" class="sheet-hidden" name="attr_speculative_purchase_warning">
                <span class="sheet-warning" name="attr_speculative_purchase_warning"></span>
            </div>
            <div class="sheet-speculative-subpanel">
                <p class="sheet-bold">4. Purchase Goods</p>
                <div>
                    <div class="sheet-speculativegoods-row-pg">
                        <h5>Key</h5>
                        <h5>Type</h5>
                        <h5>Tons To Buy</h5>
                        <h5>Tons Available</h5>
                        <h5>Supplier Px/Ton</h5>
                        <h5>(Multiplier)</h5>
                        <h5>Base Px/Ton</h5>
                    </div>
                    <fieldset class="repeating_speculative-purchase-goods">
                        <div class="sheet-speculativegoods-row-pg">
                            <span name="attr_speculative_pg_key"></span>
                            <span name="attr_speculative_pg_type"></span>
                            <span>
                                <button class="sheet-speculativebutton sheet-speculativezerobutton" type="action" name="act_speculative-pg-zero-qty">D</button>
                                <input class="sheet-input" type="number" name="attr_speculative_pg_tons" min="0" value="0"/>
                                <button class="sheet-speculativebutton sheet-speculativezerobutton" type="action" name="act_speculative-pg-restore-qty">r</button>
                            </span> <span>/ <span name="attr_speculative_pg_tons_display"></span></span>
                            <span>Cr<span name="attr_speculative_pg_price"></span></span> <span>(x
                            <span name="attr_speculative_pg_multiplier"></span>%)</span>
                            <span>Cr<span name="attr_speculative_pg_baseprice"></span></span>
                        </div>
                    </fieldset>
                    <hr class="sheet-hr">
                    <div class="sheet-speculativegoodstotal-row">
                        <h5 class="sheet-textright">Total Tons:</h5>
                        <h5><span name="attr_speculative_pg_tons_total"></span></h5>
                        <h5 class="sheet-textright">Total Supplier Price: </h5>
                        <h5><span>Cr<span name="attr_speculative_pg_price_suppliertotal"></span></span></h5>
                        <h5 class="sheet-textright">Local Broker Fee: </h5>
                        <h5><span>Cr<span name="attr_speculative_pg_broker_fee"></span></span></h5>
                        <h5></h5>
                    </div>
                    <div class="sheet-speculativegoodstotal-row">
                        <h5 class="sheet-textright"></h5>
                        <h5></h5>
                        <h5 class="sheet-textright">Total You Pay: </h5>
                        <h5><span>Cr<span name="attr_speculative_pg_price_total"></span></span></h5>
                        <h5></h5>
                        <h5></h5>
                        <h5></h5>
                    </div>
                </div>
            </div>
            <button type="action" name="act_purchase-trade-goods" class="sheet-redborder sheet-bordered-width">
                <span class="sheet-speculativebutton">9&nbsp;</span>Purchase Trade Goods
            </button>
        </div>
        <br>
        <div class="sheet-speculative-subpanel">
            <p class="sheet-bold">5. Travel To Another Market</p>
        </div>
        <br>
        <div class="sheet-hazard-border-sale">
            <div class="sheet-speculative-subpanel">
                <p class="sheet-bold">6. Find a Buyer or Local Broker</p>
                <p>Basically as per buying goods.</p>
                <div class="sheet-speculativestarport-row sheet-redborder">
                    <span class="sheet-textright">Starport A</span>
                    <input type="radio" name="attr_speculative_sale_starport_dm" value="6">
                    <span class="sheet-textright">Starport B</span>
                    <input type="radio" name="attr_speculative_sale_starport_dm" value="4">
                    <span class="sheet-textright">Starport C</span>
                    <input type="radio" name="attr_speculative_sale_starport_dm" value="2">
                    <span class="sheet-textright">Other</span>
                    <input type="radio" name="attr_speculative_sale_starport_dm" value="0" checked>
                </div>
                <input type="text" name="attr_speculative_sale_blackmarket" class="sheet-hidden">
                <div class="sheet-redborder">
                    <input type="text" name="attr_speculative_sale_broker_type" class="sheet-hidden" value="">
                    <p>
                        <input type="text" name="attr_speculative_sale_broker_type_normal" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_sale_broker_type_normal"></span>Finding a Regular Buyer or Broker: Broker EDU or SOC DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_broker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-sale-broker-find">b
                        </button>
                    </p>
                    <p>
                        <input type="text" name="attr_speculative_sale_broker_type_illegal" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_sale_broker_type_illegal"></span>Finding a Black Market Buyer or Broker of Illegal Goods: Streetwise EDU or SOC DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_illegalbroker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-sale-illegalbroker-find">b
                        </button>
                    </p>
                    <p>
                        <input type="text" name="attr_speculative_sale_broker_type_online" class="sheet-hidden" value="">
                        <span class="sheet-speculativemarker" name="attr_speculative_sale_broker_type_online">&nbsp;</span>Finding an Online Buyer or Broker (TL8+ worlds only): EDU DM:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_onlinebroker_dm" value="0">
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-sale-onlinebroker-find">b
                        </button>
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>
                        <input type="radio" name="attr_speculative_sale_localbroker_flag" value="false" checked>Traveller's Broker skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_broker_skill" value="0">
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>
                        <input type="radio" name="attr_speculative_sale_localbroker_flag" value="true">Local Broker (Takes 10% of gross (20% on illegal)). Click for their broker skill.
                        <button type="action" class="sheet-speculativebutton" name="act_speculative-sale-localbroker-skill">b
                        </button>
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_localbroker_skill" value="0"> Negotiation skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_localbroker_negskill" value="2">
                    </p>
                </div>
                <div class="sheet-redborder sheet-trade-broker-section">
                    <p>Buyer's Broker Skill:
                        <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_supplier_skill" value="2">
                    </p>
                </div>
            </div>
            <div class="sheet-trade_content">
                <div class="sheet-redborder">
                    <span class="sheet-bold">Population</span>
                    <br>
                    <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_population" value="0" min="0" max="12">
                    <span class="sheet-bold">Law Level</span>
                    <br>
                    <input type="number" class="sheet-input sheet-bold" name="attr_speculative_sale_lawlevel" value="0" min="0" max="18">
                </div>
                <div class="sheet-redborder">
                    <p class="sheet-bold">Trade Codes</p>
                    <table>
                        <tr>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_agricultural" value="1" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Agricultural</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_asteroid" value="2" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Asteroid</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_barren" value="3" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Barren</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_desert" value="4" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Desert</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_fluid_oceans" value="5" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Fluid Oceans</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_garden" value="6" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Garden</span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_high_population" value="7" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">High Population</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_high_tech" value="8" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">High Tech</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_ice_capped" value="9" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Ice-Capped</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_industrial" value="10" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Industrial</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_low_population" value="11" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Low Population</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_low_tech" value="12" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Low Tech</span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_non_agricultural" value="13" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Non-Agricultural</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_non_industrial" value="14" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Non-Industrial</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_poor" value="15" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Poor</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_rich" value="16" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Rich</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_vacuum" value="17" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Vacuum</span>
                            </td>
                            <td>
                                <input type="checkbox" name="attr_sale_tc_waterworld" value="18" class="sheet-button"/><span class="sheet-button" class="sheet-mail-attrs">Water World</span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <button type="action" name="act_determine-buyer-prices" class="sheet-redborder sheet-bordered-width">
                <span class="sheet-speculativebutton">9&nbsp;</span>Determine Buyer Prices
            </button>
            <input type="text" class="sheet-hidden" name="attr_speculative_sale_warning">
            <span class="sheet-warning" name="attr_speculative_sale_warning"></span>
            <div class="sheet-speculative-subpanel">
                <p class="sheet-bold">7. Sell Goods</p>
                <div>
                    <div class="sheet-speculativegoods-row">
                        <h5>Key</h5>
                        <h5>Type</h5>
                        <h5>Tons To Sell</h5>
                        <h5>Tons Avail.</h5>
                        <h5>Buyer Px/Ton</h5>
                        <h5>(Multiplier)</h5>
                        <h5>Base Px/Ton</h5>
                        <h5>P/L</h5>
                        <h5>Illegal</h5>
                    </div>
                    <fieldset class="repeating_speculative-sale-goods">
                        <div class="sheet-speculativegoods-row">
                            <span name="attr_speculative_sg_key"></span>
                            <span name="attr_speculative_sg_type"></span>
                            <span>
                                <button class="sheet-speculativebutton sheet-speculativezerobutton" type="action" name="act_speculative-sg-zero-qty">D</button>
                                <input class="sheet-input" type="number" name="attr_speculative_sg_tons" min="0"/>
                                <button class="sheet-speculativebutton sheet-speculativezerobutton" type="action" name="act_speculative-sg-restore-qty">r</button>
                            </span> <span>/ <span name="attr_speculative_sg_tons_display"></span></span>
                            <span>Cr<span name="attr_speculative_sg_saleprice"></span></span> <span>(x
                            <span name="attr_speculative_sg_sale_multiplier"></span>%)</span>
                            <span>Cr<span name="attr_speculative_sg_baseprice"></span></span>
                            <span class="sheet-grid-c8r1">Cr<span name="attr_speculative_sg_pl"></span></span>
                            <span class="sheet-grid-c8r1">Cr<span class="sheet-pl-neg" name="attr_speculative_sg_pl_neg"></span></span>
                            <input type="checkbox" name="attr_speculative_sg_illegal">
                        </div>
                    </fieldset>
                    <hr class="sheet-hr">
                    <div class="sheet-speculativegoodstotal-row">
                        <h5 class="sheet-textright">Total Tons:</h5>
                        <h5><span name="attr_speculative_sg_sell_tons_buyertotal"></span></h5>
                        <h5 class="sheet-textright">Total Buyer Price: </h5>
                        <h5><span>Cr<span name="attr_speculative_sg_price_buyertotal"></span></span></h5>
                        <h5 class="sheet-textright">Local Broker Fee: </h5>
                        <h5><span>Cr<span name="attr_speculative_sg_broker_fee"></span></span></h5>
                        <h5></h5>
                    </div>
                    <div class="sheet-speculativegoodstotal-row">
                        <h5></h5>
                        <h5></h5>
                        <h5 class="sheet-textright">Total You Receive: </h5>
                        <h5><span>Cr<span name="attr_speculative_sg_price_total"></span></span></h5>
                        <h5 class="sheet-textright">Total P/L: </h5>
                        <h5 class="sheet-grid-c6r1"><span>Cr<span name="attr_speculative_sg_pl_total"></span></span>
                        </h5>
                        <h5 class="sheet-grid-c6r1">
                            <span>Cr<span class="sheet-pl-neg" name="attr_speculative_sg_pl_total_neg"></span></span>
                        </h5>
                        <h5></h5>
                    </div>
                </div>
            </div>
            <button type="action" name="act_sell-trade-goods" class="sheet-redborder sheet-bordered-width">
                <span class="sheet-speculativebutton">9&nbsp;</span>Sell Trade Goods
            </button>
            <button type="action" name="act_copy-buyer-details" class="sheet-redborder sheet-bordered-width">
                <span class="sheet-speculativebutton">9&nbsp;</span>Copy Buyer Details Up To Supplier
            </button>
        </div>
    </div>
    <div class="sheet-tab-content sheet-tradelog">
        <h3 class="sheet-bold">Trade Log</h3>
        <p>The information below is logged from the various trade operations to give diagnostic information.</p>
        <div class="sheet-laf-centredgrid sheet-laf-animal">
            <input type="text" name="attr_find_value">
            <button class="sheet-redborder sheet-bordered-width" type="action" name="act_find-value">Find Attr Value</button>
            <input type="text" name="attr_show_value" readonly>
        </div>
        <button type="action" name="act_show-trade-log-messages" class="sheet-redborder sheet-bordered-width">Show Trade Log Messages
        </button>
        <textarea readonly name="attr_trade_log_messages"></textarea>
    </div>
</div>
<div class="sheet-acknowledgement">Background image: https://www.deviantart.com/elcapitan1023654/art/Free-Sci-fi-Ship-Panel-767780402</div>
<div class="sheet-acknowledgement">The Traveller game in all forms is owned by Far Future Enterprises. Copyright  1977  2023 Far Future Enterprises.</div>
<div>
    <rolltemplate class="sheet-rolltemplate-power">
        <table class="sheet-skill-attrib">
            <tr>
                <th colspan="2">{{power}}</th>
            </tr>
            <tr>
                <td colspan="2">{{character}}</td>
            </tr>
            {{#rollhasboon}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithboon-u">Rolling with BOON</span></td>
            </tr>
            {{/rollhasboon}} {{#rollhasbane}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithbane-u">Rolling with BANE</span></td>
            </tr>
            {{/rollhasbane}}
            <tr>
                <!--                <td><span data-i18n="skilltableroll-u">Roll</span></td>-->
                <td colspan="2">{{roll}}</td>
            </tr>
            <tr>
                <td colspan="2">{{note}}</td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-range">
        <table class="sheet-range">
            <tr>
                <th colspan="4">{{weapon}}</th>
            </tr>
            <tr>
                <td colspan="4">{{character}}</td>
            </tr>
            {{#rollhasboon}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithboon-u">Rolling with BOON</span></td>
            </tr>
            {{/rollhasboon}} {{#rollhasbane}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithbane-u">Rolling with BANE</span></td>
            </tr>
            {{/rollhasbane}}
            <tr>
                <td><span data-i18n="attack-u">Attack</span></td>
                <td>{{roll}}</td>
            </tr>
            {{#bb}}
            <tr>
                <td colspan="2"><span data-i18n="boonbane-u">Boon/Bane</span></td>
                <td colspan="2">{{bb}}</td>
            </tr>
            {{/bb}}
            <tr>
                <td><span data-i18n="weapondamage-u">Damage</span></td>
                <td>{{computed::damage}}</td>
            </tr>
            <tr>
                <td colspan="4">{{note}}</td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-skill-attrib">
        <table class="sheet-skill-attrib">
            <tr>
                <th colspan="2">{{skill}}</th>
            </tr>
            <tr>
                <td colspan="2">{{character}}</td>
            </tr>
            {{#rollhasboon}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithboon-u">Rolling with BOON</span></td>
            </tr>
            {{/rollhasboon}} {{#rollhasbane}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithbane-u">Rolling with BANE</span></td>
            </tr>
            {{/rollhasbane}}
            <tr>
                <!--                <td><span data-i18n="skilltableroll-u">Roll</span></td>-->
                <td colspan="2">{{roll}}</td>
            </tr>
            {{#bb}}
            <tr>
                <td><span data-i18n="boonbane-u">Boon/Bane</span></td>
                <td>{{bb}}</td>
            </tr>
            {{/bb}}
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-skill-general">
        <table class="sheet-skill-general">
            <tr>
                <th colspan="2">
                    {{skill}}<br> {{spec}}
                </th>
            </tr>
            <tr>
                <td colspan="2">{{character}}</td>
            </tr>
            {{#rollhasboon}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithboon-u">Rolling with BOON</span></td>
            </tr>
            {{/rollhasboon}} {{#rollhasbane}}
            <tr>
                <td colspan="2"><span data-i18n="rollwithbane-u">Rolling with BANE</span></td>
            </tr>
            {{/rollhasbane}} {{#dm}}
            <tr>
                <td><span data-i18n="skilltabledicemodifier-u">DM</span></td>
                <td>{{dm}}</td>
            </tr>
            <tr>
                <td><span data-i18n="skilltableskill-u">Skill</span></td>
                <td>{{rank}}</td>
            </tr>
            <tr>
                <td><span data-i18n="misc-u">Misc</span></td>
                <td>{{misc}}</td>
            </tr>
            {{/dm}}
            <tr>
                <!--                <td><span data-i18n="skilltableroll-u">Roll</span></td>-->
                <td colspan="2">{{roll}}</td>
            </tr>
            {{#bb}}
            <tr>
                <td><span data-i18n="boonbane-u">Boon/Bane</span></td>
                <td>{{bb}}</td>
            </tr>
            {{/bb}}
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-trade-index">
        <!--        Specifically dummy roll template to hide the roll which ends up as an index for another roll-->
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-passengers">
        <table class="sheet-passengers">
            <tr>
                <th colspan="2">{{skill}} Passage</th>
            </tr>
            <!--            <tr>-->
            <!--                <td colspan="2">(Index: {{indexRoll}})</td>-->
            <!--            </tr>-->
            <tr>
                <td colspan="2">Passengers: {{roll}}</td>
            </tr>
            <tr>
                <td colspan="2">Cost/Passenger: {{computed::cost}}</td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-freight">
        <table class="sheet-passengers">
            <tr>
                <th colspan="2">{{cargoType}} Cargo</th>
            </tr>
            <tr>
                <td colspan="2"># Lots: {{computed::numLots}}</td>
            </tr>
            <tr>
                <td colspan="2">Tons/Lot: {{computed::tonsPerLot}}</td>
            </tr>
            <tr>
                <td colspan="2">Paid/Ton: {{computed::costPerTon}}</td>
            </tr>
            <tr>
                <td colspan="2">Paid/Lot: {{computed::costPerLot}}</td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-trade-broker">
        <table class="sheet-passengers">
            <tr>
                <th colspan="2">{{header}}</th>
            </tr>
            <tr>
                <td colspan="2">{{message}}</td>
            </tr>
            <tr>
                <td colspan="2">{{roll}}</td>
            </tr>
        </table>
    </rolltemplate>

    <script type="text/worker">

		on('change:ro_default sheet:opened', function() {
			getAttrs(["ro_default", "ro_toggle_sel"], function(value) {
				let opt = parseInt(value.ro_default)||1;
				var def_ro_obj;

				if(1 === opt ){
					def_ro_obj = {
						ro_default_rolltype: "{{bb= [[(1d6)]] }} {{roll=[[2d6"
					};
				}
				else if(2 === opt ){
					def_ro_obj = {
						ro_default_rolltype: "?{@{rolltypetrans}|@{normaltrans}, &#123&#123roll=[[2d6|@{boontrans},&#123&#123rollhasboon= 1&#125&#125 &#123&#123roll=[[3d6kh2|@{banetrans},&#123&#123rollhasbane= 1&#125&#125 &#123&#123roll=[[3d6kl2}"
					};
				}
				else if(3 === opt ){
					def_ro_obj = {
					   ro_default_rolltype: "{{roll=[[2d6",
					   ro_toggle_sel: "normal"
					};
				}
				def_ro_obj.passenger_info = "";
				def_ro_obj.freight_info = "";
				setAttrs(def_ro_obj);
			});
		});

		on('clicked:normal', function() {
			// save the updated attribute to the sheet
			setAttrs({
			   ro_default_rolltype: "{{roll=[[2d6",
			   ro_toggle_sel: "normal"
			});
		});

		on('clicked:boon', function() {
			// save the updated attribute to the sheet
			setAttrs({
			   ro_default_rolltype: "{{rollhasboon= 1}} {{roll=[[ 3d6kh2",
			   ro_toggle_sel: "boon"
			});
		});

		on('clicked:bane', function() {
			// save the updated attribute to the sheet
			setAttrs({
			   ro_default_rolltype: "{{rollhasbane= 1}} {{roll=[[ 3d6kl2",
			   ro_toggle_sel: "bane"
			});
		});

		on('change:mod_default sheet:opened', function() {
			getAttrs(["mod_default", "mod_toggle_sel"], function(value) {
				let opt = parseInt(value.mod_default)||1;
				var def_mod_obj;

				console.log("MgT2E: change:mod_default sheet:opened: opt: " + opt);

				if(1 === opt ){
					def_mod_obj = {
						ro_default_mod: "+ ?{@{modifiertrans}|0}[Mod] "
					};
				}
				else if(2 === opt ){
					def_mod_obj = {
						ro_default_mod: " "
					};
				}
				else if(3 === opt ){
					if("yes" === value.mod_toggle_sel) {
						def_mod_obj = {
							ro_default_mod: "+ ?{@{modifiertrans}|0}[Mod] ",
							mod_toggle_sel: "yes"
						};
					}
					else {
						def_mod_obj = {
							ro_default_mod: " ",
							mod_toggle_sel: "no"
						};
					}
				}
				setAttrs(def_mod_obj);
			});
		});

		on('clicked:modyes', function() {
			// save the updated attribute to the sheet
			setAttrs({
			   ro_default_mod: "+ ?{@{modifiertrans}|0}[Mod] ",
			   mod_toggle_sel: "yes"
			});
		});

		on('clicked:modno', function() {
			// save the updated attribute to the sheet
			setAttrs({
			   ro_default_mod: " ",
			   mod_toggle_sel: "no"
			});
		});

		/* ---- BEGIN: TheAaronSheet.js ---- */
		// Github:   https://github.com/shdwjk/TheAaronSheet/blob/master/TheAaronSheet.js
		// By:       The Aaron, Arcane Scriptomancer
		// Contact:  https://app.roll20.net/users/104025/the-aaron
		var TAS = TAS || (function(){
			'use strict';

			var version = '0.2.3',
				lastUpdate = 1457098056,

				loggingSettings = {
					debug: {
						key:     'debug',
						title:   'DEBUG',
						color: {
							bgLabel: '#7732A2',
							label:   '#F2EF40',
							bgText:  '#FFFEB7',
							text:    '#7732A2'
						}
					},
					error: {
						key:     'error',
						title:   'Error',
						color: {
							bgLabel: '#C11713',
							label:   'white',
							bgText:  '#C11713',
							text:    'white'
						}
					},
					warn: {
						key:     'warn',
						title:   'Warning',
						color: {
							bgLabel: '#F29140',
							label:   'white',
							bgText:  '#FFD8B7',
							text:    'black'
						}
					},
					info: {
						key:     'info',
						title:   'Info',
						color: {
							bgLabel: '#413FA9',
							label:   'white',
							bgText:  '#B3B2EB',
							text:    'black'
						}
					},
					notice: {
						key:     'notice',
						title:   'Notice',
						color: {
							bgLabel: '#33C133',
							label:   'white',
							bgText:  '#ADF1AD',
							text:    'black'
						}
					},
					log: {
						key:     'log',
						title:   'Log',
						color: {
							bgLabel: '#f2f240',
							label:   'black',
							bgText:  '#ffff90',
							text:    'black'
						}
					},
					callstack: {
						key:     'TAS',
						title:   'function',
						color: {
							bgLabel: '#413FA9',
							label:   'white',
							bgText:  '#B3B2EB',
							text:    'black'
						}
					},
					callstack_async: {
						key:     'TAS',
						title:   'ASYNC CALL',
						color: {
							bgLabel: '#413FA9',
							label:   'white',
							bgText:  '#413FA9',
							text:    'white'
						}
					},
					TAS: {
						key:     'TAS',
						title:   'TAS',
						color: {
							bgLabel: 'grey',
							label:   'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)',
							bgText:  'grey',
							text:    'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)'
						}
					}
				},


				config = {
					debugMode: false,
					logging: {
						log: true,
						notice: true,
						info: true,
						warn: true,
						error: true,
						debug: false
					}
				},

				callstackRegistry = [],
				queuedUpdates = {}, //< Used for delaying saves till the last momment.

			complexType = function(o){
				switch(typeof o){
					case 'string':
						return 'string';
					case 'boolean':
						return 'boolean';
					case 'number':
						return (_.isNaN(o) ? 'NaN' : (o.toString().match(/\./) ? 'decimal' : 'integer'));
					case 'function':
						return 'function: '+(o.name ? o.name+'()' : '(anonymous)');
					case 'object':
						return (_.isArray(o) ? 'array' : (_.isArguments(o) ? 'arguments' : ( _.isNull(o) ? 'null' : 'object')));
					default:
						return typeof o;
				}
			},

			dataLogger = function(primaryLogger,secondaryLogger,data){
				_.each(data,function(m){
					var type = complexType(m);
					switch(type){
						case 'string':
							primaryLogger(m);
							break;
						case 'undefined':
						case 'null':
						case 'NaN':
							primaryLogger('['+type+']');
							break;
						case 'number':
						case 'not a number':
						case 'integer':
						case 'decimal':
						case 'boolean':
							primaryLogger('['+type+']: '+m);
							break;
						default:
							primaryLogger('['+type+']:=========================================');
							secondaryLogger(m);
							primaryLogger('=========================================================');
							break;
					}
				});
			},

			colorLog = function(options){
				var coloredLoggerFunction,
					key = options.key,
					label = options.title || 'TAS',
					lBGColor = (options.color && options.color.bgLabel) || 'blue',
					lTxtColor = (options.color && options.color.label) || 'white',
					mBGColor = (options.color && options.color.bgText) || 'blue',
					mTxtColor = (options.color && options.color.text) || 'white';

				coloredLoggerFunction = function(message){
					console.log(
						'%c '+label+': %c '+message + ' ',
						'background-color: '+lBGColor+';color: '+lTxtColor+'; font-weight:bold;',
						'background-color: '+mBGColor+';color: '+mTxtColor+';'
					);
				};
				return function(){
					if('TAS'===key || config.logging[key]){
					   dataLogger(coloredLoggerFunction,function(m){console.log(m);},_.toArray(arguments));
					}
				};
			},

			logDebug  = colorLog(loggingSettings.debug),
			logError  = colorLog(loggingSettings.error),
			logWarn   = colorLog(loggingSettings.warn),
			logInfo   = colorLog(loggingSettings.info),
			logNotice = colorLog(loggingSettings.notice),
			logLog    = colorLog(loggingSettings.log),
			log       = colorLog(loggingSettings.TAS),
			logCS     = colorLog(loggingSettings.callstack),
			logCSA    = colorLog(loggingSettings.callstack_async),

			registerCallstack = function(callstack,label){
				var idx=_.findIndex(callstackRegistry,function(o){
					return (_.difference(o.stack,callstack).length === _.difference(callstack,o.stack).length) &&
						_.difference(o.stack,callstack).length === 0 &&
						o.label === label;
				});
				if(-1 === idx){
					idx=callstackRegistry.length;
					callstackRegistry.push({
						stack: callstack,
						label: label
					});
				}
				return idx;
			},

			setConfigOption = function(options){
				var newconf =_.defaults(options,config);
				newconf.logging=_.defaults(
					(options && options.logging)||{},
					config.logging
				);
				config=newconf;
			},

			debugMode = function(){
				config.logging.debug=true;
				config.debugMode = true;
			},

			getCallstack = function(){
				var e = new Error('dummy'),
					stack = _.map(_.rest(e.stack.replace(/^[^\(]+?[\n$]/gm, '')
					.replace(/^\s+at\s+/gm, '')
					.replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
					.split('\n')),function(l){
						return l.replace(/\s+.*$/,'');
					});
				return stack;
			},
			logCallstackSub = function(cs){
				var matches, csa;
				_.find(cs,function(line){
					matches = line.match(/TAS_CALLSTACK_(\d+)/);
					if(matches){
					   csa=callstackRegistry[matches[1]];
					   logCSA( '===================='+(csa.label ? '> '+csa.label+' <' : '')+'====================');
					   logCallstackSub(csa.stack);
					   return true;
					}
					logCS(line);
					return false;
				});
			},
			logCallstack = function(){
				var cs;
				if(config.debugMode){
					cs = getCallstack();
					cs.shift();
					log('==============================> CALLSTACK <==============================');
					logCallstackSub(cs);
					log('=========================================================================');
				}
			},

			wrapCallback = function (label, callback, context){
				var callstack;
				if('function' === typeof label){
					context=callback;
					callback=label;
					label=undefined;
				}
				if(!config.debugMode){
					return (function(cb,ctx){
						return function(){
							cb.apply(ctx||{},arguments);
						};
					}(callback,context));
				}

				callstack = getCallstack();
				callstack.shift();

				return (function(cb,ctx,cs,lbl){
					var ctxref=registerCallstack(cs,lbl);

					/*jshint -W054 */
					return new Function('cb','ctx','TASlog',
						"return function TAS_CALLSTACK_"+ctxref+"(){"+
							"TASlog('Entering: '+(cb.name||'(anonymous function)'));"+
							"cb.apply(ctx||{},arguments);"+
							"TASlog('Exiting: '+(cb.name||'(anonymous function)'));"+
						"};")(cb,ctx,log);
					/*jshint +W054 */
				}(callback,context,callstack,label));
			},


			prepareUpdate = function( attribute, value ){
				queuedUpdates[attribute]=value;
			},

			applyQueuedUpdates = function() {
			  setAttrs(queuedUpdates);
			  queuedUpdates = {};
			},

			namesFromArgs = function(args,base){
				return _.chain(args)
					.reduce(function(memo,attr){
						if('string' === typeof attr) {
							memo.push(attr);
						} else if(_.isArray(args) || _.isArguments(args)){
							memo = namesFromArgs(attr,memo);
						}
						return memo;
					},(_.isArray(base) && base) || [])
					.uniq()
					.value();
			},

			addId = function(obj,value){
				Object.defineProperty(obj,'id',{
					value: value,
					writeable: false,
					enumerable: false
				});
			},

			addProp = function(obj,prop,value,fullname){
				(function(){
					var pname=(_.contains(['S','F','I','D'],prop) ? '_'+prop : prop),
						full_pname = fullname || prop,
						pvalue=value;

					_.each(['S','I','F'],function(p){
						if( !_.has(obj,p)){
							Object.defineProperty(obj, p, {
								value: {},
								enumerable: false,
								readonly: true
							});
						}
					});
					if( !_.has(obj,'D')){
						Object.defineProperty(obj, 'D', {
							value: _.reduce(_.range(10),function(m,d){
									Object.defineProperty(m, d, {
										value: {},
										enumerable: true,
										readonly: true
									});
									return m;
								},{}),
							enumerable: false,
							readonly: true
						});
					}


					// Raw value
					Object.defineProperty(obj, pname, {
						enumerable: true,
						set: function(v){
							if(v!==pvalue) {
								pvalue=v;
								prepareUpdate(full_pname,v);
							}
						},
						get: function(){
							return pvalue;
						}
					});

					// string value
					Object.defineProperty(obj.S, pname, {
						enumerable: true,
						set: function(v){
							var val=v.toString();
							if(val !== pvalue) {
								pvalue=val;
								prepareUpdate(full_pname,val);
							}
						},
						get: function(){
							return pvalue.toString();
						}
					});

					// int value
					Object.defineProperty(obj.I, pname, {
						enumerable: true,
						set: function(v){
							var val=parseInt(v,10) || 0;
							if(val !== pvalue){
								pvalue=val;
								prepareUpdate(full_pname,val);
							}
						},
						get: function(){
							return parseInt(pvalue,10) || 0;
						}
					});

					// float value
					Object.defineProperty(obj.F, pname, {
						enumerable: true,
						set: function(v){
							var val=parseFloat(v) || 0;
							if(val !== pvalue) {
								pvalue=val;
								prepareUpdate(full_pname,val);
							}
						},
						get: function(){
							return parseFloat(pvalue) || 0;
						}
					});
					_.each(_.range(10),function(d){
						Object.defineProperty(obj.D[d], pname, {
							enumerable: true,
							set: function(v){
								var val=(parseFloat(v) || 0).toFixed(d);
								if(val !== pvalue){
									pvalue=val;
									prepareUpdate(full_pname,val);
								}
							},
							get: function(){
								return (parseFloat(pvalue) || 0).toFixed(d);
							}
						});
					});

				}());
			},

			repeating = function( section ) {
				return (function(s){
					var sectionName = s,
						attrNames = [],
						fieldNames = [],
						operations = [],
						after = [],

					repAttrs = function TAS_Repeating_Attrs(){
						attrNames = namesFromArgs(arguments,attrNames);
						return this;
					},
					repFields = function TAS_Repeating_Fields(){
						fieldNames = namesFromArgs(arguments,fieldNames);
						return this;
					},
					repReduce = function TAS_Repeating_Reduce(func, initial, final, context) {
						operations.push({
							type: 'reduce',
							func: (func && _.isFunction(func) && func) || _.noop,
							memo: (_.isUndefined(initial) && 0) || initial,
							final: (final && _.isFunction(final) && final) || _.noop,
							context: context || {}
						});
						return this;
					},
					repMap = function TAS_Repeating_Map(func, final, context) {
						operations.push({
							type: 'map',
							func: (func && _.isFunction(func) && func) || _.noop,
							final: (final && _.isFunction(final) && final) || _.noop,
							context: context || {}
						});
						return this;
					},
					repEach = function TAS_Repeating_Each(func, final, context) {
						operations.push({
							type: 'each',
							func: (func && _.isFunction(func) && func) || _.noop,
							final: (final && _.isFunction(final) && final) || _.noop,
							context: context || {}
						});
						return this;
					},
					repTap = function TAS_Repeating_Tap(final, context) {
						operations.push({
							type: 'tap',
							final: (final && _.isFunction(final) && final) || _.noop,
							context: context || {}
						});
						return this;
					},
					repAfter = function TAS_Repeating_After(callback,context) {
						after.push({
							callback: (callback && _.isFunction(callback) && callback) || _.noop,
							context: context || {}
						});
						return this;
					},
					repExecute = function TAS_Repeating_Execute(callback,context){
						var rowSet = {},
							attrSet = {},
							fieldIds = [],
							fullFieldNames = [];

						repAfter(callback,context);

						// call each operation per row.
						// call each operation's final
						getSectionIDs("repeating_"+sectionName,function(ids){
							fieldIds = ids;
							fullFieldNames = _.reduce(fieldIds,function(memo,id){
								return memo.concat(_.map(fieldNames,function(name){
									return 'repeating_'+sectionName+'_'+id+'_'+name;
								}));
							},[]);
							getAttrs( _.uniq(attrNames.concat(fullFieldNames)), function(values){
								_.each(attrNames,function(aname){
									if(values.hasOwnProperty(aname)){
										addProp(attrSet,aname,values[aname]);
									}
								});

								rowSet = _.reduce(fieldIds,function(memo,id){
									var r={};
									addId(r,id);
									_.each(fieldNames,function(name){
										var fn = 'repeating_'+sectionName+'_'+id+'_'+name;
										addProp(r,name,values[fn],fn);
									});

									memo[id]=r;

									return memo;
								},{});

								_.each(operations,function(op){
									var res;
									switch(op.type){
										case 'tap':
											_.bind(op.final,op.context,rowSet,attrSet)();
											break;

										case 'each':
											_.each(rowSet,function(r){
												_.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
											});
											_.bind(op.final,op.context,rowSet,attrSet)();
											break;

										case 'map':
											res = _.map(rowSet,function(r){
												return _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
											});
											_.bind(op.final,op.context,res,rowSet,attrSet)();
											break;

										case 'reduce':
											res = op.memo;
											_.each(rowSet,function(r){
												res = _.bind(op.func,op.context,res,r,attrSet,r.id,rowSet)();
											});
											_.bind(op.final,op.context,res,rowSet,attrSet)();
											break;
									}
								});

								// finalize attrs
								applyQueuedUpdates();
								_.each(after,function(op){
									_.bind(op.callback,op.context)();
								});
							});
						});
					};

					return {
						attrs: repAttrs,
						attr: repAttrs,

						column: repFields,
						columns: repFields,
						field: repFields,
						fields: repFields,

						reduce: repReduce,
						inject: repReduce,
						foldl: repReduce,

						map: repMap,
						collect: repMap,

						each: repEach,
						forEach: repEach,

						tap: repTap,
						'do': repTap,

						after: repAfter,
						last: repAfter,
						done: repAfter,

						execute: repExecute,
						go: repExecute,
						run: repExecute
					};
				}(section));
			},


			repeatingSimpleSum = function(section, field, destination){
				repeating(section)
					.attr(destination)
					.field(field)
					.reduce(function(m,r){
						return m + (r.F[field]);
					},0,function(t,r,a){
						a.S[destination]=t;
					})
					.execute();
			};

			console.log('%c..*`*..*`*.  The Aaron Sheet  v'+version+'  .*`*..*`*..','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
			console.log('%c..*`*..*`*.  Last update: '+(new Date(lastUpdate*1000))+'  .*`*..*`*..','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');


			return {
				/* Repeating Sections */
				repeatingSimpleSum: repeatingSimpleSum,
				repeating: repeating,

				/* Configuration */
				config: setConfigOption,

				/* Debugging */
				callback: wrapCallback,
				callstack: logCallstack,
				debugMode: debugMode,
				_fn: wrapCallback,

				/* Logging */
				debug: logDebug,
				error: logError,
				warn: logWarn,
				info: logInfo,
				notice: logNotice,
				log: logLog
			};
		}());

		/* ---- END: TheAaronSheet.js ---- */

		on('change:repeating_othergear remove:repeating_othergear', function(){
			TAS.repeatingSimpleSum('othergear','masstotalright','weightright');
		});
		on('change:repeating_othergear remove:repeating_othergear', function(){
			TAS.repeatingSimpleSum('othergear','masstotalleft','weightleft');
		});
			//Total Weight
		on("change:weightright change:weightleft sheet:opened", function() {
				getAttrs(["weightright", "weightleft"], function(values) {
					const tw = parseFloat(values.weightright) + parseFloat(values.weightleft);
					setAttrs({
						totalweight: tw.toFixed(2)
					});
				});
			});

		on("change:repeating_othergear:massleft change:repeating_othergear:quantityleft change:repeating_othergear:equippedleft sheet:opened", function() {
		   getAttrs(["repeating_othergear_massleft", "repeating_othergear_quantityleft", "repeating_othergear_equippedleft"], function(values) {
			    setAttrs({
					repeating_othergear_masstotalleft: (parseFloat(values.repeating_othergear_massleft).toFixed(2)) * (parseInt(values.repeating_othergear_quantityleft) * parseInt(values.repeating_othergear_equippedleft))
				});
			});
		});

		on("change:repeating_othergear:massright change:repeating_othergear:quantityright change:repeating_othergear:equippedright sheet:opened", function() {
		   getAttrs(["repeating_othergear_massright", "repeating_othergear_quantityright", "repeating_othergear_equippedright"], function(values) {
				setAttrs({
					repeating_othergear_masstotalright: (parseFloat(values.repeating_othergear_massright).toFixed(2)) * (parseInt(values.repeating_othergear_quantityright) * parseInt(values.repeating_othergear_equippedright))
				});
			});
		});

		// ===========================================
		//      STAT AND SKILL ARRAYS
		// ===========================================
		/* If modifying this sheet for your own use, just change the stat and skill arrays to match your campaign, and the sheet workers will work for you. */

		const int = (score, error = 0) => parseInt(score) || error;
		const stats = ['Strength', 'Dexterity', 'Endurance', 'Intellect', 'Education', 'Social', 'PsionicStrength'];
		// if modifying thise
		const skills = ['Admin', 'Advocate', 'Animals', 'Animals2', 'Athletics', 'Athletics2', 'Athletics3', 'Art', 'Art2', 'Astrogation', 'Broker', 'Carouse', 'Deception', 'Diplomat', 'Drive', 'Drive2', 'Engineer', 'Engineer2', 'Electronics', 'Electronics2', 'Explosives', 'Flyer', 'Flyer2', 'Gambler', 'Gunner', 'Gunner2', 'GunCombat', 'GunCombat2', 'GunCombat3', 'HeavyWeapons', 'HeavyWeapons2', 'Investigate', 'JackOfAllTrades', 'Language', 'Language2', 'Leadership', 'Mechanic', 'Medic', 'Melee', 'Melee2', 'Navigation', 'Persuade', 'Pilot', 'Pilot2', 'Profession', 'Profession2', 'Recon', 'Science', 'Science2', 'Seafarer', 'Seafarer2', 'Stealth', 'Steward', 'Streetwise', 'Survival', 'Tactics', 'Tactics2', 'VaccSuit'];

		const skills_combat = ['Athletics', 'Athletics2', 'Athletics3', 'Explosives', 'Gunner', 'Gunner2', 'GunCombat', 'GunCombat2', 'GunCombat3', 'HeavyWeapons', 'HeavyWeapons2', 'Melee', 'Melee2', 'Tactics', 'Tactics2', 'VaccSuit'];
		const skillsets = {skill_combat: skills_combat, skill_all: skills};

		// ===========================================
		//      ATTRIBUTE MODS
		// ===========================================
		stats.forEach(stat => {
			on(`change:base-${stat.toLowerCase()} change:injury-${stat.toLowerCase()} sheet:opened`, function () {
				getAttrs([`base-${stat}`, `injury-${stat}`], function(values) {
					const score = int(values[`base-${stat}`]);
					const injury = int(values[`injury-${stat}`]);
					const calc = score + injury;
					//const mod = (calc <= 0) ? -3 : ((calc >= 15) ? 3 : (Math.floor(calc/3) -2));
					const mod = (calc <= 0) ? -3 : (Math.floor(calc/3) -2);
					setAttrs({
						[`calc-${stat}`]: calc,
						[`mod-${stat}`]: mod
					});
				});
			});
		});

        on("change:repeating_characteristic:base change:repeating_characteristic:injury", function (info) {

            console.log("MgT2E: Repeating characteristic change: " + JSON.stringify(info));

            const rowId = info.sourceAttribute.split('_')[2];
            const baseAttr = "repeating_characteristic_" + rowId + "_base";
            const injuryAttr = "repeating_characteristic_" + rowId + "_injury";
            const modAttr = "repeating_characteristic_" + rowId + "_modifier";
            const calcAttr = "repeating_characteristic_" + rowId + "_calc";

            getAttrs([baseAttr, injuryAttr, modAttr], function(values) {

                const score = +values[baseAttr];
                const injury = +values[injuryAttr];
                const calc = score + injury;
                const mod = (calc <= 0) ? -3 : (Math.floor(calc/3) -2);

                setAttrs({
                    [modAttr]: mod
                });
            });
        });

        on("clicked:repeating_characteristic:characteristic", (info) => {

            console.log("MgT2E: Repeating characteristic click: " + JSON.stringify(info));

            const rowId = info.sourceAttribute.split('_')[2];
            const nameAttr = "repeating_characteristic_" + rowId + "_name";
            const modAttr = "repeating_characteristic_" + rowId + "_modifier";

            getAttrs([nameAttr, modAttr], function(values) {

                startRoll("@{whispertoggle}&{template:skill-attrib} {{skill=" + values[nameAttr] + "}} {{character= @{character_name} }} @{ro_default_rolltype} + " + values[modAttr] + " @{ro_default_mod}]] }}  }}", (results) => {

                    finishRoll(results.rollId, {});
                });
            });
        });

		// ===========================================
		//      SKILL TOGGLES
		// ===========================================
		on(`change:skill sheet:opened`, () => {
			getAttrs(['Skill'], values => {
				const toggle = int(values['Skill']);
				setAttrs({
					Skill_Show: toggle
				});
			});
		});
		skills.forEach(skill => {
			on(`change:${skill.toLowerCase()} sheet:opened`, () => {
				getAttrs([skill], values => {
					const toggle = int(values[skill]);
					console.log("MgT2E: Skill: " + skill + ", toggle: " + toggle);
					setAttrs({
						[`${skill}_show`]: toggle
					})
				});
			});
		});
		Object.keys(skillsets).forEach(set => {
			on(`change:${set.toLowerCase()}`, () => {
				getAttrs([set], values =>  {
					const toggle = int(values[set]);
					const output = {};
					skillsets[set].forEach(skill => output[skill] = toggle);
					setAttrs(output);
				});
			});
		});


        on("change:skill_trained", (info) => {

            console.log("MgT2E: Skill trained: " + JSON.stringify(info));

            attrs=[];
            skills.forEach(skill => {
                attrs.push("untrained-" + skill);
            });

            getAttrs(attrs, values =>  {

                var attrsToSet = {};
                skills.forEach(skill => {
                    if(+values["untrained-" + skill] === 0) {
                        // Trained
                        attrsToSet[skill] = +info.newValue;
                    }
                    else {
                        // Untrained
                        //attrsToSet[skill] = +info.previousValue;
                    }
                });

                setAttrs(attrsToSet);
            });
        });

		const buttonlist = ["prime","skills","inventory","combat","powers","notes"];
		buttonlist.forEach(button => {
			on(`clicked:${button}`, function() {
				setAttrs({
					sheetTab: button
				});
			});
		});

		const buttonlist_sheettype = ["pc", "npc", "animal", "ship", "vehicle", "trade"];
		buttonlist_sheettype.forEach(button => {
			on(`clicked:${button}`, function() {
				setAttrs({
					sheetType: button,
					sheetTypeShow: button
				});
			});
		});

		const buttonlist_sheettradetype = ["passengers", "freight", "speculative", "tradelog"];
		buttonlist_sheettradetype.forEach(button => {
			on(`clicked:${button}`, function() {
				setAttrs({
					sheetTradeType: button,
					sheetTradeTypeShow: button
				});
			});
		});

		on("sheet:opened", function(info){
			setAttrs({
				rolltypetrans: getTranslationByKey("rolltype-u"),
				normaltrans: getTranslationByKey("normal-u"),
				boontrans: getTranslationByKey("boon-u"),
				banetrans: getTranslationByKey("bane-u"),
				modifiertrans: getTranslationByKey("modprompt-u")
			});
		});

        const weapons = ["1", "2", "3", "4", "5", "6"];
        weapons.forEach(weapon => {

            on("clicked:roll-weapon-" + weapon, (info) => {
                startRoll("@{whispertoggle}&{template:range} {{character=@{character_name}}} {{weapon=@{weapon_name-" + weapon + "}}}  @{ro_default_rolltype} + @{weapon_DM-" + weapon + "}[DM] + @{weapon_skill-" + weapon + "}[Skill] @{ro_default_mod}]]}} {{damage=[[@{weapon_damage-" + weapon + "}]]}} {{effect=''}} {{range=@{weapon_range-" + weapon + "}}}", (results) => {
                    const toHit = results.results.roll.result;
                    var damage = results.results.damage.result

                    if(toHit > 8) {
                        damage += (toHit - 8);
                    }

                    finishRoll(
                        results.rollId,
                        {
                            roll: toHit,
                            damage: damage,
                        }
                    );
                });
            });
        });

        on("clicked:repeating_weapons:roll-weapon-rep", (info) => {

            const rowId = info.sourceAttribute.split('_')[2];
            const weaponName   = "repeating_weapons_" + rowId + "_weapon_name-rep";
            const weaponDM     = "repeating_weapons_" + rowId + "_weapon_DM-rep";
            const weaponSkill  = "repeating_weapons_" + rowId + "_weapon_skill-rep";
            const weaponDamage = "repeating_weapons_" + rowId + "_weapon_damage-rep";
            const weaponRange  = "repeating_weapons_" + rowId + "_weapon_range-rep";

            startRoll("@{whispertoggle}&{template:range} {{character=@{character_name}}} {{weapon=@{" + weaponName + "}}}  @{ro_default_rolltype} + @{" + weaponDM + "}[DM] + @{" + weaponSkill + "}[Skill] @{ro_default_mod}]]}}  {{damage=[[@{" + weaponDamage + "}]]}} {{range=@{" + weaponRange + "}}}", (results) => {
                const toHit = results.results.roll.result;
                var damage = results.results.damage.result
                if(toHit > 8) {
                    damage += (toHit - 8);
                }

                finishRoll(
                    results.rollId,
                    {
                        roll: toHit,
                        damage: damage
                    }
                );
            });
        });

        // TRADE
        const passengerTraffic = [
            "-",
            "0D6",
            "1D6",
            "1D6",
            "2D6",
            "2D6",
            "2D6",
            "3D6",
            "3D6",
            "3D6",
            "3D6",
            "4D6",
            "4D6",
            "4D6",
            "5D6",
            "5D6",
            "6D6",
            "7D6",
            "8D6",
            "9D6",
            "10D6"
        ];

        const passengerCost = {
            "1": { High: 9000, Medium: 6500, Basic: 2000, Low: 700, Freight: 1000 },
            "2": { High: 14000, Medium: 10000, Basic: 3000, Low: 1300, Freight: 1600 },
            "3": { High: 21000, Medium: 14000, Basic: 5000, Low: 2200, Freight: 2600 },
            "4": { High: 34000, Medium: 23000, Basic: 8000, Low: 3900, Freight: 4400 },
            "5": { High: 60000, Medium: 40000, Basic: 14000, Low: 7200, Freight: 8500 },
            "6":{ High: 210000, Medium: 130000, Basic: 55000, Low: 27000, Freight: 32000 }
        };

        // Update group funds, we may call this from somehwere we are doing a getAttrs, so current total
        // could be provided, if not, we get it
        function updateGroupFunds(updateBy, currentTotal) {

            console.log("MgT2E: Update group funds: Update by:" + updateBy + ", current total: " + currentTotal);

            var newTotal = 0;
            if(currentTotal !== undefined) {
                newTotal = +updateBy + +currentTotal;
                setAttrs({group_funds: newTotal});
            }
            else {
                getAttrs(["group_funds"], function(value) {
                    setAttrs({group_funds: +value.groupFunds + +updateBy});
                });
            }
            setAttrs();
        }

        // We will keep a log of major operations for diagnostic purposes and blank this out on sheet:open
        // We will keep this in a JS variable and then provide a button to show it, so we are not polluting
        // setAttrs code with random log attrs, that's the idea any way!
        // The attr is: attr_trade_log_messages
        // 'Session' var below...should this be an array...for more strutured logging...?
        var tradeLogMessages = "";

        function addTradeLogMessage(msg, c) {

            tradeLogMessages += msg + "\r\n";

            if(c) {
                console.log(msg);
            }
        }

        on("clicked:show-trade-log-messages", (info) => {

            setAttrs({trade_log_messages: tradeLogMessages});
        });

		function sgn(n) {
			return (+n<=0 ? n: "+" + n)
		}

        on("clicked:passengers-calculate", (info) => {

            addTradeLogMessage("MgT2E: In Passenger Calculate", true);
            var infoMsg = "";

            // Get all the attributes we need to calculate the overall modifier
            getAttrs(["passengers_parsecs", "passengers_effect_broker", "passengers_mod_steward", "passengers_class",
                "passengers_src_population", "passengers_src_starport", "passengers_src_zone",
                "passengers_dest_population", "passengers_dest_starport", "passengers_dest_zone",
                "passengers_mod_custom" ], function(value) {

                var modifier = +value.passengers_effect_broker + +value.passengers_mod_steward + +value.passengers_mod_custom;

                infoMsg = "[ Modifiers: Broker Etc.: " + sgn(value.passengers_effect_broker) + ", Steward: " + sgn(value.passengers_mod_steward) + ", Custom: " + sgn(value.passengers_mod_custom) + " ]\r\n";

                // Note: We apply the modifier for passenger class further down
                // Src
                switch(value.passengers_src_population) {
                    case "pop1":
                        modifier -= 4;
                        infoMsg += "[ Src Population <=1: -4, ";
                    break;
                    case "pop67":
                        modifier += 1;
                        infoMsg += "[ Src Population 6-7: +1, ";
                    break;
                    case "pop8":
                        modifier += 3;
                        infoMsg += "[ Src Population 8+: +3, ";
                    break;
                    default:
                    	infoMsg += "[ Src Population: 0, ";
                }

                switch(value.passengers_src_starport) {
                    case "a":
                        modifier += 2;
                        infoMsg += "Src Starport A: +2, ";
                    break;
                    case "b":
                        modifier += 1;
                        infoMsg += "Src Starport B: +1, ";
                    break;
                    case "e":
                        modifier -= 1;
                        infoMsg += "Src Starport E: -1, ";
                    break;
                    case "x":
                        modifier -= 3;
                        infoMsg += "Src Starport X: -3, ";
                    break;
                    default:
                    	infoMsg += "Src Starport: 0, ";
                }

                switch(value.passengers_src_zone) {
                    case "amber":
                        modifier += 1;
                        infoMsg += "Src Amber Zone: +1";
                    break;
                    case "red":
                        modifier -= 4;
                        infoMsg += "Src Red Zone: -4";
                    break;
                    default:
                    	infoMsg += "Src Zone: 0";
                }

                // Dest
                switch(value.passengers_dest_population) {
                    case "pop1":
                        modifier -= 4;
                        infoMsg += "[ Dest Population <=1: -4, ";
                    break;
                    case "pop67":
                        modifier += 1;
                        infoMsg += "[ Dest Population 6-7: +1, ";
                    break;
                    case "pop8":
                        modifier += 3;
                        infoMsg += "[ Dest Population 8+: +3, ";
                    break;
                    default:
                    	infoMsg += "[ Dest Population: 0, ";
                }

                switch(value.passengers_dest_starport) {
                    case "a":
                        modifier += 2;
                        infoMsg += "Dest Starport A: +2, ";
                    break;
                    case "b":
                        modifier += 1;
                        infoMsg += "Dest Starport B: +1, ";
                    break;
                    case "e":
                        modifier -= 1;
                        infoMsg += "Dest Starport E: -1, ";
                    break;
                    case "x":
                        modifier -= 3;
                        infoMsg += "Dest Starport X: -3, ";
                    break;
                    default:
                    	infoMsg += "Dest Starport: 0, ";
                }

                switch(value.passengers_dest_zone) {
                    case "amber":
                        modifier += 1;
                        infoMsg += "Dest Amber Zone: +1";
                    break;
                    case "red":
                        modifier -= 4;
                        infoMsg += "Dest Red Zone: -4";
                    break;
                    default:
                    	infoMsg += "Dest Zone: 0";
                }

                infoMsg += " ]\r\n";

				// Check which class we are rolling for, create an array which we adjust for specifics
				var classes = ["High", "Medium", "Basic", "Low"];

				if(value.passengers_class !== "All") {
					classes = [value.passengers_class];
				}

                // Need to zero out all attrs and re-set as we may go from 'All' to a specific one...
                var attrs = {
                    passengers_high_num_take: 0,
                    passengers_high_num_available: 0,
                    passengers_high_cost: 0,

                    passengers_medium_num_take: 0,
                    passengers_medium_num_available: 0,
                    passengers_medium_cost: 0,

                    passengers_basic_num_take: 0,
                    passengers_basic_num_available: 0,
                    passengers_basic_cost: 0,

                    passengers_low_num_take: 0,
                    passengers_low_num_available: 0,
                    passengers_low_cost: 0,
                };

                // We need to make up to 4 rolls, and setAttrs, so don't want to do that in a loop, so we'll make 4 rolls regardless and process what we want

                var rollString = "";
				for (let i = 0; i < classes.length; i++) {

					var currentModifier = modifier;

					infoMsg += "Passage: [ ";

					switch(classes[i]) {
						case "High":
							currentModifier -= 4;
							infoMsg += "High: -4 ] ";
						break;
						case "Low":
							currentModifier += 1;
							infoMsg += "Low: +1 ] ";
						break;
						default:
							infoMsg += classes[i] + ": 0 ] ";
					}

					infoMsg += " [ Total Modifier: " + sgn(currentModifier) + " ]\r\n";

					rollString += "{{roll" + classes[i] + "=[[2d6+" + currentModifier + "]]}} "
                }

			    // Perform our index roll
			    startRoll("!" + rollString, (results) => {

                    // We now have 1, or 4 roll results, iterate again and process them
                    var rollString2 = "";

                    for (let i = 0; i < classes.length; i++) {

                        const key = "roll" + classes[i];
                        var index = results.results[key].result;

                        if(index < 1) {
                            index = 1;
                        }
                        if(index > 20) {
                            index = 20;
                        }

                        // Find the number of D6s to roll by lookup
                        var numDice = passengerTraffic[index];
                        rollString2 += "{{roll" + classes[i] + "=[[" + numDice + "]]}} "

                        infoMsg += "[ " + classes[i] + " Passage: Index Roll: " + index + ", # Dice: " + numDice + "]\r\n";
                    }
                    infoMsg += "[ rollString2: " +  rollString2 + " ]";
                    startRoll("!" + rollString2, (results2) => {

                        for (let i = 0; i < classes.length; i++) {

                            const key = "roll" + classes[i];
                            const numPassengers = results2.results[key].result;
							const cost = passengerCost[value.passengers_parsecs][classes[i]];

							// Build up our attributes to set
							var attrClass = classes[i].toLowerCase();
							attrs["passengers_" + attrClass + "_num_available"] = numPassengers;
							attrs["passengers_" + attrClass + "_cost"] = cost;
						}
						addTradeLogMessage(infoMsg);
						setAttrs(attrs);
						finishRoll(results2.rollId, {});
				    });
                    finishRoll(results.rollId, {});
				});
            });
        });

        on("change:passengers_high_num_take change:passengers_medium_num_take change:passengers_basic_num_take change:passengers_low_num_take", (info) => {

            // Do over max
            const attr = info.sourceAttribute.replace("take", "available");
            getAttrs([attr], function(v) {
                if(+info.newValue > +v[attr]) {
                    setAttrs({
                        [info.sourceAttribute]: v[attr]
                    });
                }
            });
        });

        on("clicked:passengers-clear", (info) => {

            setAttrs({
                passengers_high_num_taken: 0,
                passengers_medium_num_taken: 0,
                passengers_basic_num_taken: 0,
                passengers_low_num_taken: 0,
                passengers_parsecs: 1
            });
        });

        on("clicked:passengers-take", (info) => {

            addTradeLogMessage("MgT2E: In Passenger Take: " + JSON.stringify(info), true);

            var attrs = [];
            var attrsToSet = {};
            ["high", "medium", "basic", "low"].forEach(key => {
                attrs.push("passengers_" + key + "_num_take");
                attrs.push("passengers_" + key + "_cost");
            });
            attrs.push("group_funds");

            var passengersTaken = 0;
            getAttrs(attrs, function(value) {

                var profit = 0;
                var msg = "(";
                ["High", "Medium", "Basic", "Low"].forEach(key => {

                    var k = key.toLowerCase();
                    var passengersToTake = +value["passengers_" + k + "_num_take"];
                    passengersTaken += passengersToTake
                    var cash = Math.round(passengersToTake * +value["passengers_" + k + "_cost"])
                    attrsToSet["passengers_" + k + "_num_taken"] = +value["passengers_" + k + "_num_take"];
                    profit += cash;
                    if(cash > 0) {
                        msg += key + ": Cr" + cash + " "
                    }
                });
                msg += ")";

                // Check we actually selected some passengers to take!
                if(passengersTaken === 0) {

                    addTradeLogMessage("- NO passengers taken", true);
                    return
                }

                // Chat this out, then update group funds
                startRoll("&{template:trade-broker} {{header=Passengers Taken}} {{message=Cr" + profit + " Received}} {{roll=" + (msg === "()" ? "" : msg) + "}}", (results) => {

                    updateGroupFunds(profit, +value.group_funds);
                    setAttrs(attrsToSet);
			        finishRoll(results.rollId, {});
			    });
            });
        });

        const freightTraffic = [
            "-",
            "0D6",
            "1D6",
            "1D6",
            "2D6",
            "2D6",
            "3D6",
            "3D6",
            "3D6",
            "4D6",
            "4D6",
            "4D6",
            "5D6",
            "5D6",
            "5D6",
            "6D6",
            "6D6",
            "7D6",
            "8D6",
            "9D6",
            "10D6"
        ];

		on("clicked:freight-calculate", (info) => {

            addTradeLogMessage("MgT2E: In Freight Calculate: " + JSON.stringify(info), true);

            var infoMsg = "";

            // Get all the attributes we need to calculate the overall modifier
            getAttrs(["freight_parsecs", "freight_effect_broker", "freight_cargotype",
                "freight_src_population", "freight_src_starport", "freight_src_techlevel", "freight_src_zone",
                "freight_dest_population", "freight_dest_starport", "freight_dest_techlevel", "freight_dest_zone",
                "freight_mod_custom", "freight_navalscout", "freight_society", "freight_shiparmed"], function(value) {

                var modifier = +value.freight_effect_broker + +value.freight_mod_custom;

                infoMsg = "Modifiers: [ Broker Etc.: " + sgn(value.freight_effect_broker) + ", Custom: " + sgn(value.freight_mod_custom) + ", ";

                // Src
				switch(value.freight_src_population) {
					case "pop1":
						modifier -= 4;
						infoMsg += "Src Population <=1: -4, ";
					break;
					case "pop67":
						modifier += 2;
						infoMsg += "Src Population 6-7: +2, ";
					break;
					case "pop8":
						modifier += 4;
						infoMsg += "Src Population 8+: +4, ";
					break;
					default:
				}

				switch(value.freight_src_starport) {
					case "a":
						modifier += 2;
						infoMsg += "Src Starport A: +2, ";
					break;
					case "b":
						modifier += 1;
						infoMsg += "Src Starport B: +1, ";
					break;
					case "e":
						modifier -= 1;
						infoMsg += "Src Starport E: -1, ";
					break;
					case "x":
						modifier -= 3;
						infoMsg += "Src Starport X: -3, ";
					break;
					default:
						infoMsg += "Src Starport: 0, ";
				}

				switch(value.freight_src_techlevel) {
					case "tl5":
					case "tl6":
						modifier -= 1;
						infoMsg += "Src Tech Level <= 6: -1, ";
					break;
					case "tl9":
						modifier += 2;
						infoMsg += "Src Tech Level >= 9: +2, ";
					break;
					default:
						infoMsg += "Src Tech Level: 0, ";
				}

				switch(value.freight_src_zone) {
					case "amber":
						modifier -= 2;
						infoMsg += "Src Amber Zone: -2 ] ";
					break;
					case "red":
						modifier -= 6;
						infoMsg += "Src Red Zone: -6 ] ";
					break;
					default:
						infoMsg += "Src Zone: 0 ] ";
				}

                // Dest
				switch(value.freight_dest_population) {
					case "pop1":
						modifier -= 4;
						infoMsg += "Dest Population <=1: -4, ";
					break;
					case "pop67":
						modifier += 2;
						infoMsg += "Dest Population 6-7: +2, ";
					break;
					case "pop8":
						modifier += 4;
						infoMsg += "Dest Population 8+: +4, ";
					break;
					default:
				}

				switch(value.freight_dest_starport) {
					case "a":
						modifier += 2;
						infoMsg += "Dest Starport A: +2, ";
					break;
					case "b":
						modifier += 1;
						infoMsg += "Dest Starport B: +1, ";
					break;
					case "e":
						modifier -= 1;
						infoMsg += "Dest Starport E: -1, ";
					break;
					case "x":
						modifier -= 3;
						infoMsg += "Dest Starport X: -3, ";
					break;
					default:
						infoMsg += "Dest Starport: 0, ";
				}

				switch(value.freight_dest_techlevel) {
					case "tl5":
					case "tl6":
						modifier -= 1;
						infoMsg += "Dest Tech Level <= 6: -1, ";
					break;
					case "tl9":
						modifier += 2;
						infoMsg += "Dest Tech Level >= 9: +2, ";
					break;
					default:
						infoMsg += "Dest Tech Level: 0, ";
				}

				switch(value.freight_dest_zone) {
					case "amber":
						modifier -= 2;
						infoMsg += "Dest Amber Zone: -2 ] ";
					break;
					case "red":
						modifier -= 6;
						infoMsg += "Dest Red Zone: -6 ] ";
					break;
					default:
						infoMsg += "Dest Zone: 0 ] ";
				}

				infoMsg += "[ Total Modifier: " + sgn(modifier) + " ]\r\n";

				// Check which cargo type we are rolling for, create an array which we adjust for specifics
				var cargoTypes = ["Mail", "Major", "Minor", "Incidental"];

				if(value.freight_cargotype !== "All") {
					cargoTypes = [value.freight_cargotype]
				}

				// At this point we have a 'freight traffic DM' (var modifier) which we use for Mail calculations,
				var mailModifier = 0;

				// Big if-else type tree, only do if we include mail
				const mailDMs = {};
				if(value.freight_cargotype === "All" || value.freight_cargotype === "Mail") {

					var mailMsg = "Mail Modifiers: [ ";
					// Freight modifier checks
					if(modifier <= -10) {
						mailModifier -= 2;
						mailMsg += "Freight modifier: -2, ";
					}
					else if(modifier >= -9 && modifier <= -5) {
						mailModifier -= 1;
						mailMsg += "Freight modifier: -1, ";
					}
					else if(modifier >= -4 && modifier <= 4) {
						mailModifier -= 0;
						mailMsg += "Freight modifier: 0, ";
					}
					else if(modifier >= 5 && modifier <= 9) {
						mailModifier += 1;
						mailMsg += "Freight modifier: +1, ";
					}
					else if(modifier >= 10) {
						mailModifier += 2;
						mailMsg += "Freight modifier: +2, ";
					}

					if(value.freight_shiparmed === "on") {
						//console.log("- Ship armed: " + value.freight_shiparmed);
						mailModifier += 2;
						mailMsg += "Ship armed: +2, ";
					}
					else {
						mailMsg += "Ship armed: 0, ";
					}

					if(value.freight_src_techlevel === "tl5") {
						mailModifier -= 4;
						mailMsg += "Src Tech level: -4, ";
					}
					else {
						mailMsg += "Src Tech level: -0, ";
					}

					if(value.freight_dest_techlevel === "tl5") {
						mailModifier -= 4;
						mailMsg += "Dest Tech level: -4, ";
					}
					else {
						mailMsg += "Dest Tech level: -0, ";
					}

					// Add in the naval/scout and society
					mailModifier += +value.freight_navalscout + +value.freight_society;
					mailMsg += "Naval/Scout: " + sgn(value.freight_navalscout) + ", Society: " + sgn(value.freight_society) + " ]\r\n";
					infoMsg += mailMsg;

					// To resolve this we roll 2D6, add our modifier and compare with >=12, see below
				}

                // TODO Restructure the calls to startRoll into a single call outside of the loop, just build the dice rolls and execute once
				for (let i=0; i<cargoTypes.length; i++) {

					// Because mail is a weird one, need to if/else the actual freight code...
					if(cargoTypes[i] === "Mail")
					{
						// Do our roll, compare the value
						startRoll("!{{cargoType=Mail}} {{numLots=[[1D6]]}} {{mailRoll=[[2D6+" + mailModifier + "]]}} {{costPerLot=[[0D6]]}} {{tonsPerLot=[[0D6]]}}", (results) => {

							var numLots = 0;
							var costPerLot = 0;
							var tonsPerLot = 0;

							if(+results.results.mailRoll.result >= 12) {
								numLots = +results.results.numLots.result;
								costPerLot = 25000;
								tonsPerLot = 5;
							}

							finishRoll(
								results.rollId,
								{
									numLots: numLots,
									costPerLot: costPerLot,
									tonsPerLot: tonsPerLot
								}
							);
							infoMsg += "[ Cargo Type: Mail, Roll: " + results.results.mailRoll.result + " (" + (+results.results.mailRoll.result >= 12) + "), Lots: " + numLots + "] ";
							infoMsg += "\r\n";
							setAttrs({
							    freight_info: infoMsg,
							    freight_mail_lots_available: numLots,
							    freight_mail_tons_per_lot: tonsPerLot,
							    freight_mail_price_per_ton: 5000,
							    freight_mail_price_per_lot: 25000
							});
						});
					}
					else {
						startRoll("!{{skill=" + cargoTypes[i] + "}} {{roll=[[2d6+" + modifier + "]]}}", (results) => {

							infoMsg += "[ Cargo Type: ";
							var tonsPerLot = "";
							switch(cargoTypes[i]) {
								case "Incidental":
									//console.log("- Incidental: " + cargoTypes[i]);
									modifier += 2;
									tonsPerLot = "1D6";
									infoMsg += "Incidental: +2, ";
								break;
								case "Major":
									//console.log("- Major: " + cargoTypes[i]);
									modifier -= 4;
									tonsPerLot = "1D6*10";
									infoMsg += "Major: +1, ";
								break;
								case "Minor":
									//console.log("- Minor: " + cargoTypes[i]);
									tonsPerLot = "1D6*5";
									infoMsg += "Minor: 0, ";
								break;
								default:
									// Mail, will never get here
							}

							var total = results.results.roll.result;
							if(total < 1) {
								total = 1;
							}
							if(total > 20) {
								total = 20;
							}

							// Find the number of D6s to roll by lookup
							var numDice = freightTraffic[total];

							infoMsg += " Index: " + total + ", #Dice: " + numDice + " ] ";
							infoMsg += "\r\n";
							addTradeLogMessage("- Rolling: " + numDice + " for index value of: " + total, true);

							finishRoll(results.rollId, {});

							startRoll("!{{cargoType=" + cargoTypes[i] + "}} {{numLots=[[" + numDice + "]]}} {{indexRoll=" + total + "}} {{costPerTon=[[0D6]]}} {{costPerLot=[[0D6]]}} {{tonsPerLot=[[" + tonsPerLot + "]]}}", (results2) => {

								// Lookup cost
								const costPerTon = passengerCost[value.freight_parsecs].Freight;
								const costPerLot = costPerTon * results2.results.tonsPerLot.result;

								addTradeLogMessage("- " + cargoTypes[i] + ": Cost: Roll: " + results2.results.numLots.result + " Parsecs: " + value.freight_parsecs + " Paid/Lot: " + costPerLot, true);

								finishRoll(
									results2.rollId,
									{
										numLots: results2.results.numLots.result,
										costPerLot: costPerLot,
										costPerTon: costPerTon
									}
								);

                                var attrsToSet = { freight_info: infoMsg };

								var freightType = cargoTypes[i].toLowerCase();
								attrsToSet["freight_" + freightType + "_lots_available"] = results2.results.numLots.result;
								attrsToSet["freight_" + freightType + "_tons_per_lot"] = results2.results.tonsPerLot.result;
								attrsToSet["freight_" + freightType + "_price_per_ton"] = costPerTon;
								attrsToSet["freight_" + freightType + "_price_per_lot"] = costPerLot;

								setAttrs(attrsToSet);
							});
						});
					}
                }
            });
        });

        on("change:freight_major_lots_to_take change:freight_minor_lots_to_take change:freight_incidental_lots_to_take change:freight_mail_lots_to_take", (info) => {

            // Do over max
            const attr = info.sourceAttribute.replace("to_take", "available");
            getAttrs([attr], function(v) {
                if(+info.newValue > +v[attr]) {
                    setAttrs({
                        [info.sourceAttribute]: v[attr]
                    });
                }
            });
        });

      	on("clicked:freight-take", (info) => {

            addTradeLogMessage("MgT2E: In Freight Take: " + JSON.stringify(info), true);

            var attrs = [];
            ["mail", "major", "minor", "incidental"].forEach((freightType, i) => {

                attrs.push("freight_" + freightType + "_lots_to_take");
                attrs.push("freight_" + freightType + "_lots_available");
				attrs.push("freight_" + freightType + "_tons_per_lot");
				attrs.push("freight_" + freightType + "_price_per_ton");
				attrs.push("freight_" + freightType + "_price_per_lot");
            });

            const pseudoKeys = ["00", "01", "02", "03"];
            getAttrs(attrs, function(value) {

                var selectedSomeLots = false;
                var newRowAttrs = {};
                // See which freight we need to add
                ["Mail", "Major", "Minor", "Incidental"].forEach((freightType, i) => {

                    var freightTypeAttr = freightType.toLowerCase();
                    if(+value["freight_" + freightTypeAttr + "_lots_to_take"] !== 0 && +value["freight_" + freightTypeAttr + "_lots_available"] !== 0) {

                        var newRowId = generateRowID();
                        var totalTons = +value["freight_" + freightTypeAttr + "_tons_per_lot"] * +value["freight_" + freightTypeAttr + "_lots_to_take"];
                        newRowAttrs["repeating_speculative-freight-goods_" + newRowId + "_speculative_fg_key"] = pseudoKeys[i];
                        newRowAttrs["repeating_speculative-freight-goods_" + newRowId + "_speculative_fg_type"] = freightType + " Freight";
                        newRowAttrs["repeating_speculative-freight-goods_" + newRowId + "_speculative_fg_tons"] = totalTons;
                        newRowAttrs["repeating_speculative-freight-goods_" + newRowId + "_speculative_fg_tons_display"] = totalTons;
                        newRowAttrs["repeating_speculative-freight-goods_" + newRowId + "_speculative_fg_baseprice"] = value["freight_" + freightTypeAttr + "_price_per_ton"];
                        selectedSomeLots = true;
                    }
                });

                // Make sure we selected something, otherwise just bail
                if(selectedSomeLots) {
                    // Zero out the current values
                    for(let i=0; i<attrs.length; i++) {
                        newRowAttrs[attrs[i]] = 0;
                    }
                    // And set our freight into the cargo manifest
                    setAttrs(newRowAttrs);
                    repeatingSum("speculative_fg_tons_total", "speculative-freight-goods", "speculative_fg_tons_display");
                }
            });
        });

        on("clicked:freight-deliver", (info) => {

            addTradeLogMessage("MgT2E: In Freight Deliver: " + JSON.stringify(info), true);

            // Iterate through the hold finding any rows with keys that start with "0"
            var keyAttrs = [];
            getSectionIDs("repeating_speculative-freight-goods", function(idArray) {

                if(idArray.length === 0) {
                    addTradeLogMessage("- NO freight has been taken", true);
                    return;
                }

                for(var i=0; i < idArray.length; i++) {
                    // Create attribute names for keys
                    var attr = "repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_key";
                    keyAttrs.push(attr);
                    attr = "repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_tons_display";
                    keyAttrs.push(attr);
                    attr = "repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_baseprice";
                    keyAttrs.push(attr);
                }
                keyAttrs.push("group_funds");
                keyAttrs.push("freight_late");

                // Gather the attributes we need
                getAttrs(keyAttrs, function(value) {

                    //console.log("- Value from getAttrs: " + JSON.stringify(value));

                    // Only interested in keys starting with 0n
                    var profit = 0;
                    for(var i=0; i < idArray.length; i++) {

                        const key = value["repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_key"];
                        if(key.startsWith("0")) {

                            var tons = +value["repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_tons_display"];
                            var price = +value["repeating_speculative-freight-goods_" + idArray[i] + "_speculative_fg_baseprice"];
                            profit += (tons * price);

                            removeRepeatingRow("repeating_speculative-freight-goods_" + idArray[i]);
                            repSpeculativeSaleGoodsChanged();
                        }
                    }

                    // Send a message to show monies received
                    startRoll("!{{roll=[[1D6]]}} {{header=Freight Goods Delivered}}", (results) => {

                        var lateCharge = 0;
                        var origProfit = profit;
                        addTradeLogMessage("- Profit: " + profit + ", freight late: " + value.freight_late, true);
                        if(value.freight_late === "on") {
                            lateCharge = (results.results.roll.result+4) * 10;
                            profit = Math.round((1-((results.results.roll.result+4)*0.1)) * profit);
                            addTradeLogMessage("- Late delivery: late charge: " + lateCharge + "%, profit: " + profit, true);
                        }
                        updateGroupFunds(profit, +value.group_funds);
                        var msg = "";
                        if(lateCharge > 0) {
                            msg = "Late Charge: Cr" + (origProfit - profit) + " (" + lateCharge + "%)";
                        }
                        startRoll("&{template:trade-broker} {{header=Freight Goods Delivered}} {{message=Cr" + profit.toLocaleString("EN-us") + " Received}} {{roll=" + msg + "}}", (results2) => {
                            finishRoll(results2.rollId, {});
                        });
                        finishRoll(results.rollId, {});
			        });
                });
            });
        });

        // Callback to find a broker or local broker, deals with purchase (where Traveller's buy) and sale (where Traveller's sell
        on("clicked:speculative-purchase-broker-find clicked:speculative-purchase-illegalbroker-find clicked:speculative-purchase-onlinebroker-find clicked:speculative-purchase-localbroker-skill "+
           "clicked:speculative-sale-broker-find clicked:speculative-sale-illegalbroker-find clicked:speculative-sale-onlinebroker-find clicked:speculative-sale-localbroker-skill", (info) => {

            addTradeLogMessage("MgT2E: In Find Supplier/Broker|Local Broker: " + JSON.stringify(info), true);

            var infoMsg = "";
            var localBroker = false;
            var brokerType = "";
            // TODO: Refactor: These are just used to display a flag (a Pictos tick symbol) to show selection as I couldn't get readonly radio/check boxes to work
            var brokerTypeNormal = "";
            var brokerTypeIllegal = "";
            var brokerTypeOnline = "";

            // Need to know if we are 'purchase' or 'sale', so set up a flag
            var isPurchase = true;

            // Get all the attributes we need to calculate the overall modifier
            getAttrs(["speculative_purchase_broker_dm", "speculative_purchase_illegalbroker_dm", "speculative_purchase_onlinebroker_dm", "speculative_purchase_starport_dm",
                      "speculative_purchase_broker_type_illegal",
                      "speculative_sale_broker_dm", "speculative_sale_illegalbroker_dm", "speculative_sale_onlinebroker_dm", "speculative_sale_starport_dm",
                      "speculative_sale_broker_type_illegal"], function(value) {

				var modifier = 0;
				var durationUnit = "day";
				switch(info.triggerName) {
					case "clicked:speculative-purchase-broker-find":
						modifier = +value.speculative_purchase_broker_dm;
						brokerType = "normal";
						brokerTypeNormal = "3"; // Pictos font tick value
					break;
					case "clicked:speculative-purchase-illegalbroker-find":
						modifier = +value.speculative_purchase_illegalbroker_dm;
						brokerType = "illegal";
						brokerTypeIllegal = "3";
					break;
					case "clicked:speculative-purchase-onlinebroker-find":
						modifier = +value.speculative_purchase_onlinebroker_dm;
						durationUnit = "hour";
						brokerType = "online";
						brokerTypeOnline = "3";
					break;
					case "clicked:speculative-purchase-localbroker-skill":
						// Local broker is a special case, we just roll for the skill: floor(2D6/3),we calculate that below, then return
						localBroker = true;
					break;
					case "clicked:speculative-sale-broker-find":
						modifier = +value.speculative_sale_broker_dm;
						brokerType = "normal";
						brokerTypeNormal = "3"; // Pictos font tick value
						isPurchase = false;
					break;
					case "clicked:speculative-sale-illegalbroker-find":
						modifier = +value.speculative_sale_illegalbroker_dm;
						brokerType = "illegal";
						brokerTypeIllegal = "3";
						isPurchase = false;
					break;
					case "clicked:speculative-sale-onlinebroker-find":
						modifier = +value.speculative_sale_onlinebroker_dm;
						durationUnit = "hour";
						brokerType = "online";
						brokerTypeOnline = "3";
						isPurchase = false;
					break;
					case "clicked:speculative-sale-localbroker-skill":
						// Local broker is a special case, we just roll for the skill: floor(2D6/3),we calculate that below, then return
						localBroker = true;
						isPurchase = false;
					break;
					default:
						addTradeLogMessage("- Unknown broker type: " + info.triggerName, true);
				}

				startRoll("!{{skill=Speculative}} {{roll=[[2d6+" + modifier + "]]}} {{local=[[floor(2d6/3)]]}} {{time=[[1d6]]}}", (results) => {

					var brokerResult = results.results.roll.result;
					var time = results.results.time.result;
					var localBrokerSkill = results.results.local.result;

					// At this point see if we were successful UNLESS using a local broker in which case just store and display their skill
					if(localBroker) {
					    if(isPurchase) {
                            setAttrs({
                                speculative_purchase_localbroker_skill: localBrokerSkill,
                                speculative_purchase_localbroker_flag: "true"
                            });
						}
						else {
                            setAttrs({
                                speculative_sale_localbroker_skill: localBrokerSkill,
                                speculative_sale_localbroker_flag: "true"
                            });
						}

                        // Handle illegal broker
                        var isIllegalBroker = false;
                        if(info.triggerName == "clicked:speculative-purchase-localbroker-skill" && value.speculative_purchase_broker_type_illegal === "3") {
                            isIllegalBroker = true;
                        }
                        if(info.triggerName == "clicked:speculative-sale-localbroker-skill" && value.speculative_sale_broker_type_illegal === "3") {
                            isIllegalBroker = true;
                        }
                        //console.log("- Illegal broker: " + isIllegalBroker + ", roll: " + results.results.local.rolls[0].results.reduce((a,b)=>a+b));
						if(isIllegalBroker && results.results.local.rolls[0].results.reduce((a,b)=>a+b) == 2) {
					        // Critical fail, supplier/broker was a plant
                            startRoll("/w gm &{template:trade-broker} {{header=Busted!}} {{message=Your illegal contact is not what they seem!}}", (results) => {
			                    finishRoll(results.rollId, {});
			                });
					    }
					}
					else {
					    // Add in the starport modifier
					    if(isPurchase) {
					        modifier += +value.speculative_purchase_starport_dm;
					    }
					    else {
					        modifier += +value.speculative_sale_starport_dm;
					    }

						var findBrokerMsg = ""
						if(brokerResult >= 8) {
						    if(time > 1) {
						        durationUnit += "s";
						    }
							findBrokerMsg = "Broker/" + (isPurchase?"Supplier":"Buyer") + " found in " + time + " " + durationUnit;
						}
						else {
							findBrokerMsg = "Failed to find Broker/" + (isPurchase ? "Supplier" : "Buyer") + " in " + time + " " + durationUnit;
							// Reset broker type flagging
							brokerTypeNormal = "";
							brokerTypeIllegal = "";
							brokerTypeOnline = "";
							switch(brokerType) {
							    case "normal":
							        brokerTypeNormal = "*"
							    break;
								case "illegal":
                                    brokerTypeIllegal = "*"
							    break;
							    case "online":
                                    brokerTypeOnline = "*"
							    break;
							}
							brokerType = "";
						}
						var rawDice = results.results.roll.dice[0] + results.results.roll.dice[1];
						var brokerDM = isPurchase ? sgn(modifier- +value.speculative_purchase_starport_dm) : sgn(modifier- +value.speculative_sale_starport_dm);
						var starportDM = isPurchase ? sgn(value.speculative_purchase_starport_dm) : sgn(value.speculative_sale_starport_dm);

						startRoll("&{template:trade-broker} {{header=Find Broker/" + (isPurchase ? "Supplier" : "Buyer") + "}} {{message=" + findBrokerMsg + "}} {{roll=2D6 (" + rawDice + ") + (Broker DM: " + brokerDM + ") + (Starport: " + starportDM + ")}}", (results2) => {
							finishRoll(results2.rollId, {});
						});
						// Store the broker type which will set the radio button to show which broker/supplier the player has chosen
						// This is a bit hacky using three variables just to display an indicator, but I couldn't get readonly/disabled radio buttons to work!
						if(isPurchase) {
                            setAttrs({
                                speculative_purchase_broker_type: brokerType,
                                speculative_purchase_broker_type_normal: brokerTypeNormal,
                                speculative_purchase_broker_type_illegal: brokerTypeIllegal,
                                speculative_purchase_broker_type_online: brokerTypeOnline,
                            });
						}
						else {
                            setAttrs({
                                speculative_sale_broker_type: brokerType,
                                speculative_sale_broker_type_normal: brokerTypeNormal,
                                speculative_sale_broker_type_illegal: brokerTypeIllegal,
                                speculative_sale_broker_type_online: brokerTypeOnline,
                            });
						}
					}

					finishRoll(results.rollId,{});
				});
            });
        });

        const tradeGoods = {
            "11": {
                type: "Common Electronics",
                availability: [ "All" ],
                tons: "2D6*10",
                basePrice: "20000",
                purchaseDM: { Industrial:+2,HighTech:+3,Rich:+1 },
                saleDM: { NonIndustrial:+2,LowTech:+1,Poor:+1 },
                examples: "Simple electronics including basic computers up to TL 10"
            },
            "12": {
                type: "Common Industrial Goods",
                availability: [ "All" ],
                tons: "2D6*10",
                basePrice: "10000",
                purchaseDM: { NonAgricultural:+2,Industrial:+5 },
                saleDM: { NonIndustrial:+3,Agricultural:+2 },
                examples: "Machine components and spare parts for common machinery"
            },
            "13": {
                type: "Common Manufactured Goods",
                availability: [ "All" ],
                tons: "2D6*10",
                basePrice: "20000",
                purchaseDM: { NonAgricultural:+2,Industrial:+5 },
                saleDM: { NonIndustrial:+3,HighPopulation:+2 },
                examples: "Household appliances, clothing and so forth"
            },
            "14": {
                type: "Common Raw Materials",
                availability: [ "All" ],
                tons: "2D6*20",
                basePrice: "5000",
                purchaseDM: { Agricultural:+3,Garden:+2 },
                saleDM: { Industrial:+2,Poor:+2 },
                examples: "Metal, plastics, chemicals and other basic materials"
            },
            "15": {
                type: "Common Consumables",
                availability: [ "All" ],
                tons: "2D6*20",
                basePrice: "500",
                purchaseDM: { Agricultural:+3,WaterWorld:+2,Garden:+1,Asteroid:-4 },
                saleDM: { Asteroid:+1,FluidOceans:+1,IceCapped:+1,HighPopulation:+1 },
                examples: "Food, drink and other agricultural products"
            },
            "16": {
                type: "Common Ore",
                availability: [ "All" ],
                tons: "2D6*20",
                basePrice: "1000",
                purchaseDM: { Asteroid:+4 },
                saleDM: { Industrial:+3,NonIndustrial:+1 },
                examples: "Ore bearing common metals"
            },
            "21": {
                type: "Advanced Electronics",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "100000",
                purchaseDM: { Industrial:+2,HighTech:+3 },
                saleDM: { NonIndustrial:+1,Rich:+2,Asteroid:+3 },
                examples: "Advanced sensors, computers and other electronics up to TL15"
            },
            "22": {
                type: "Advanced Machine Parts",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "75000",
                purchaseDM: { Industrial:+2,HighTech:+1 },
                saleDM: { Asteroid:+2,NonIndustrial:+1 },
                examples: "Machine components and spare parts, including gravitic components"
            },
            "23": {
                type: "Advanced Manufactured Goods",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "100000",
                purchaseDM: { Industrial:+1 },
                saleDM: { HighPopulation:+1,Rich:+2 },
                examples: "Devices and clothing incorporating advanced technologies"
            },
            "24": {
                type: "Advanced Weapons",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "150000",
                purchaseDM: { HighTech:+2 },
                saleDM: { Poor:+1,AmberZone:+2,RedZone:+4 },
                examples: "Firearms, explosives, ammunition, artillery and other military-grade weaponry"
            },
            "25": {
                type: "Advanced Vehicles",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "180000",
                purchaseDM: { HighTech:+2 },
                saleDM: { Asteroid:+2,Rich:+2 },
                examples: "Air/rafts, spacecraft, grav tanks and other vehicles up to TL15"
            },
            "26": {
                type: "Biochemicals",
                availability: [ "Agricultural","WaterWorld" ],
                tons: "1D6*5",
                basePrice: "50000",
                purchaseDM: { Agricultural:+1,WaterWorld:+2 },
                saleDM: { Industrial:+2 },
                examples: "Biofuels, organic chemicals, extracts"
            },
            "31": {
                type: "Crystals & Gems",
                availability: [ "Asteroid","Desert","Ice-Capped" ],
                tons: "1D6*5",
                basePrice: "20000",
                purchaseDM: { Asteroid:+2,Desert:+1,IceCapped:+1 },
                saleDM: { Industrial:+3,Rich:+2 },
                examples: "Diamonds, synthetic or natural gemstones"
            },
            "32": {
                type: "Cybernetics",
                availability: [ "High-Tech" ],
                tons: "1D6",
                basePrice: "250000",
                purchaseDM: { HighTech:+1 },
                saleDM: { Asteroid:+1,IceCapped:+1,Rich:+2 },
                examples: "Cybernetic components, replacement limbs"
            },
            "33": {
                type: "Live Animals",
                availability: [ "Agricultural","Garden" ],
                tons: "1D6*10",
                basePrice: "10000",
                purchaseDM: { Agricultural:+2 },
                saleDM: { LowPopulation:+3 },
                examples: "Riding animals, beasts of burden, exotic pets"
            },
            "34": {
                type: "Luxury Consumables",
                availability: [ "Agricultural","Garden","WaterWorld" ],
                tons: "1D6*10",
                basePrice: "20000",
                purchaseDM: { Agricultural:+2,WaterWorld:+1 },
                saleDM: { Rich:+2,HighPopulation:+2 },
                examples: "Rare foods, fine liquors"
            },
            "35": {
                type: "Luxury Goods",
                availability: [ "HighPopulation" ],
                tons: "1D6",
                basePrice: "200000",
                purchaseDM: { HighPopulation:+1 },
                saleDM: { Rich:+4 },
                examples: "Rare or extremely high-quality manufactured goods"
            },
            "36": {
                type: "Medical Supplies",
                availability: [ "HighTech,HighPopulation" ],
                tons: "1D6*5",
                basePrice: "50000",
                purchaseDM: { HighTech:+2 },
                saleDM: { Industrial:+2,Poor:+1,Rich:+1 },
                examples: "Diagnostic equipment, basic drugs, cloning technology"
            },
            "41": {
                type: "Petrochemicals",
                availability: [ "Desert","FluidOceans","IceCapped","WaterWorld" ],
                tons: "1D6*10",
                basePrice: "10000",
                purchaseDM: { Desert:+2 },
                saleDM: { Industrial:+2,Agricultural:+1,LowTech:+2 },
                examples: "Oil, liquid fuels"
            },
            "42": {
                type: "Pharmaceuticals",
                availability: [ "Asteroid","Desert","HighPopulation","WaterWorld" ],
                tons: "1D6",
                basePrice: "100000",
                purchaseDM: { Asteroid:+2,HighPopulation:+1 },
                saleDM: { Rich:+2,LowTech:+1 },
                examples: "Drugs, medical supplies, anagathics, fast or slow drugs"
            },
            "43": {
                type: "Polymers",
                availability: [ "Industrial" ],
                tons: "1D6*10",
                basePrice: "7000",
                purchaseDM: { Industrial:+1 },
                saleDM: { Rich:+2,NonIndustrial:+1 },
                examples: "Plastics and other synthetics"
            },
            "44": {
                type: "Precious Metals",
                availability: [ "Asteroid","Desert","IceCapped","FluidOceans" ],
                tons: "1D6",
                basePrice: "50000",
                purchaseDM: { Asteroid:+3,Desert:+1,IceCapped:+2 },
                saleDM: { Rich:+3,Industrial:+2,HighTech:+1 },
                examples: "Gold, silver, platinum, rare elements"
            },
            "45": {
                type: "Radioactives",
                availability: [ "Asteroid","Desert","LowPop" ],
                tons: "1D6",
                basePrice: "1000000",
                purchaseDM: { Asteroid:+2,LowPopulation:+2 },
                saleDM: { Industrial:+3,HighTech:+1,NonIndustrial:-2,Agricultural:-3 },
                examples: "Uranium, plutonium, unobtanium, rare elements"
            },
            "46": {
                type: "Robots",
                availability: [ "Industrial" ],
                tons: "1D6*5",
                basePrice: "400000",
                purchaseDM: { Industrial:+1 },
                saleDM: { Agricultural:+2,HighTech:+1 },
                examples: "Industrial and personal robots and drones"
            },
            "51": {
                type: "Spices",
                availability: [ "Garden","Desert","WaterWorld" ],
                tons: "1D6*10",
                basePrice: "6000",
                purchaseDM: { Desert:+2 },
                saleDM: { HighPopulation:+2,Rich:+3,Poor:+3 },
                examples: "Preservatives, luxury food additives, natural drugs"
            },
            "52": {
                type: "Textiles",
                availability: [ "Agricultural","NonIndustrial" ],
                tons: "1D6*20",
                basePrice: "3000",
                purchaseDM: { Agricultural:+7 },
                saleDM: { HighPopulation:+3,NonAgricultural:+2 },
                examples: "Clothing and fabrics"
            },
            "53": {
                type: "Uncommon Ore",
                availability: [ "Asteroid","IceCapped" ],
                tons: "1D6*20",
                basePrice: "5000",
                purchaseDM: { Asteroid:+4 },
                saleDM: { Industrial:+3,NonIndustrial:+1 },
                examples: "Ore containing precious or valuable metals"
            },
            "54": {
                type: "Uncommon Raw Materials",
                availability: [ "Agricultural","Desert","WaterWorld" ],
                tons: "1D6*10",
                basePrice: "20000",
                purchaseDM: { Agricultural:+2,WaterWorld:+1 },
                saleDM: { Industrial:+2,HighTech:+1 },
                examples: "Valuable metals like titanium, rare elements"
            },
            "55": {
                type: "Wood",
                availability: [ "Agricultural","Garden" ],
                tons: "1D6*20",
                basePrice: "1000",
                purchaseDM: { Agricultural:+6 },
                saleDM: { Rich:+2,Industrial:+1 },
                examples: "Hard or beautiful woods and plant extracts"
            },
            "56": {
                type: "Vehicles",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*10",
                basePrice: "15000",
                purchaseDM: { Industrial:+2,HighTech:+1 },
                saleDM: { NonIndustrial:+2,HighPopulation:+1 },
                examples: "Wheeled, tracked and other vehicles from TL10 or lower"
            }
        };

        const tradeGoodsIllegal = {
            "61": {
                type: "Illegal Biochemicals",
                availability: [ "Agricultural","WaterWorld" ],
                tons: "1D6*5",
                basePrice: "50000",
                purchaseDM: { WaterWorld:+2 },
                saleDM: { Industrial:+6 },
                examples: "Dangerous chemicals, extracts from endangered species"
            },
            "62": {
                type: "Cybernetics, Illegal",
                availability: [ "HighTech" ],
                tons: "1D6",
                basePrice: "250000",
                purchaseDM: { HighTech:+1 },
                saleDM: { Asteroid:+4,IceCapped:+4,Rich:+8,AmberZone:+6,RedZone:+6 },
                examples: "Combat cybernetics, illegal enhancements"
            },
            "63": {
                type: "Drugs, Illegal",
                availability: [ "Asteroid","Desert","HighPopulation","WaterWorld" ],
                tons: "1D6",
                basePrice: "100000",
                purchaseDM: { Asteroid:+1,Desert:+1,Garden:+1,WaterWorld:+1 },
                saleDM: { Rich:+6,HighPopulation:+6 },
                examples: "Addictive drugs, combat drugs"
            },
            "64": {
                type: "Luxuries, Illegal",
                availability: [ "Agricultural","Garden","WaterWorld" ],
                tons: "1D6",
                basePrice: "50000",
                purchaseDM: { Agricultural:+2,WaterWorld:+1 },
                saleDM: { Rich:+6,HighPopulation:+4 },
                examples: "Debauched or addictive luxuries"
            },
            "65": {
                type: "Weapons, Illegal",
                availability: [ "Industrial","HighTech" ],
                tons: "1D6*5",
                basePrice: "150000",
                purchaseDM: { HighTech:+2 },
                saleDM: { Poor:+6,AmberZone:+8,RedZone:+10 },
                examples: "Weapons of mass destruction, naval weapons"
            },
            "66": {
                type: "Exotics",
                availability: [ "" ],
                tons: "10",
                basePrice: "0",
                purchaseDM: {  },
                saleDM: {  },
                examples: ""
            }
        };

        const tradeCodeGoodsMapping = {};
        const tradeCodeGoodsIllegalMapping = {};

        on('sheet:opened', function() {

            // Build a map of trade goods, e.g. for each trade code, add a list of trade goods IDs, effectively bucketing up goods by trade codes
            for (const [key, value] of Object.entries(tradeGoods)) {
                // Iterate over trade codes (availability)
                for(const tc of value.availability) {
                    if(tradeCodeGoodsMapping[tc] === undefined) {
                        // Add key, e.g. 11, 12 etc. to an array first time around
                        tradeCodeGoodsMapping[tc] = [key];
                    }
                    else {
                        // Push subsequent mappings onto the array
                        tradeCodeGoodsMapping[tc].push(key);
                    }
                }
            }

            for (const [key, value] of Object.entries(tradeGoodsIllegal)) {
                // Iterate over trade codes (availability)
                for(const tc of value.availability) {
                    if(tradeCodeGoodsIllegalMapping[tc] === undefined) {
                        // Add key, e.g. 11, 12 etc. to an array first time around
                        tradeCodeGoodsIllegalMapping[tc] = [key];
                    }
                    else {
                        // Push subsequent mappings onto the array
                        tradeCodeGoodsIllegalMapping[tc].push(key);
                    }
                }
            }
            // We should end up with being able to look up something like: tradeCodeGoodsMapping.Industrial = ["23", "35", "37"]

            // Clear trade log messages
            setAttrs({trade_log_messages: "-"});
        });

		const tradeCodes = [
		    "Dummy",
			"Agricultural",
			"Asteroid",
			"Barren",
			"Desert",
			"FluidOceans",
			"Garden",
			"HighPopulation",
			"HighTech",
			"IceCapped",
			"Industrial",
			"LowPopulation",
			"LowTech",
			"NonAgricultural",
			"NonIndustrial",
			"Poor",
			"Rich",
			"Vacuum",
			"WaterWorld"
		];

        // Array of 'slots' to keep track of which trade codes are selected (note 19 elements as the zero-th does not get used as "0" is the default checkbox value when unchecked
		const selectedPurchaseTradeCodes = [  false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false ];

        const purchaseTradeCodeAttrs = [ "purchase_tc_agricultural", "purchase_tc_asteroid", "purchase_tc_barren", "purchase_tc_desert", "purchase_tc_fluid_oceans", "purchase_tc_garden", "purchase_tc_high_population", "purchase_tc_high_tech",
                                 "purchase_tc_ice_capped", "purchase_tc_industrial", "purchase_tc_low_population", "purchase_tc_low_tech", "purchase_tc_non_agricultural", "purchase_tc_non_industrial", "purchase_tc_poor", "purchase_tc_rich",
                                 "purchase_tc_vacuum", "purchase_tc_waterworld" ];

        const selectedSaleTradeCodes = [  false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false ];

        const saleTradeCodeAttrs = [ "sale_tc_agricultural", "sale_tc_asteroid", "sale_tc_barren", "sale_tc_desert", "sale_tc_fluid_oceans", "sale_tc_garden", "sale_tc_high_population", "sale_tc_high_tech",
                                 "sale_tc_ice_capped", "sale_tc_industrial", "sale_tc_low_population", "sale_tc_low_tech", "sale_tc_non_agricultural", "sale_tc_non_industrial", "sale_tc_poor", "sale_tc_rich",
                                 "sale_tc_vacuum", "sale_tc_waterworld" ];

        // Add on change handlers for our purchase trade code checkboxes
        purchaseTradeCodeAttrs.forEach((tc, i) => {
            on("change:" + tc, (info) => {

                //console.log("MgT2E: Purchase Trade Code Change: " + JSON.stringify(info));
                // Set the trade code to be true, if the checkbox is switched off it has a value of zero, so we just end up setting selectedPurchaseTradeCodes[0] = true, which is fine
                // as we will never use the zero-th element of the array
                selectedPurchaseTradeCodes[+info.newValue] = true;
                selectedPurchaseTradeCodes[+info.previousValue] = false;
            });
        });

        // Create our local array of values from checkboxes
        function populateSelectedPurchaseTradeCodes(value) {

            purchaseTradeCodeAttrs.forEach((tc, i) => {
                selectedPurchaseTradeCodes[value[tc]] = true;
            });
        }

        // Add on change handlers for our purchase trade code checkboxes
        saleTradeCodeAttrs.forEach((tc, i) => {
            on("change:" + tc, (info) => {

                //console.log("MgT2E: Sale Trade Code Change: " + JSON.stringify(info));

                // Set the trade code to be true, if the checkbox is switched off it has a value of zero, so we just end up setting selectedSaleTradeCodes[0] = true, which is fine
                // as we will never use the zero-th element of the array
                selectedSaleTradeCodes[+info.newValue] = true;
                selectedSaleTradeCodes[+info.previousValue] = false;
            });
        });

        // Create our local array of values from checkboxes
        function populateSelectedSaleTradeCodes(value) {

            saleTradeCodeAttrs.forEach((tc, i) => {
                selectedSaleTradeCodes[value[tc]] = true;
            });
        }

        function deleteRepeatingRows(name) {

            getSectionIDs(name, function(idArray) {
                for(var i=0; i < idArray.length; i++) {
                    removeRepeatingRow(name + "_" + idArray[i]);
                }
            });
        }

        /* ----------------------------------------------
        Working example of jquery to add a class
        TODO Remove
        on("change:speculative_purchase_population change:speculative_sale_population", (info) => {

            console.log("MgT2E: Population Change: " + JSON.stringify(info));
            // Alert colour
            var attr = "[name=\"attr_" + info.triggerName + "\"]";
            console.log("MgT2E: JQuery selector: " + attr);
            if(+info.newValue === 0) {
                $20(attr).addClass('sheet-error');
            }
            else {
                $20(attr).removeClass('sheet-error');
            }
        });
        ---------------------------------------------- */

        /* ===== PARAMETERS ==========
        destinations = the name of the attribute that stores the total quantity
                can be a single attribute, or an array: ['total_cost', 'total_weight']
                If more than one, the matching fields must be in the same order.
            section = name of repeating fieldset, without the repeating_
            fields = the name of the attribute field to be summed
                  destination and fields both can be a single attribute: 'weight'
                  or an array of attributes: ['weight','number','equipped']
        */
        const repeatingSum = (destinations, section, fields, locale=false, copyNeg=false) => {
            if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
            if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
            getSectionIDs(`repeating_${section}`, idArray => {
                const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
                getAttrs([...attrArray], v => {
                    const getValue = (section, id, field) => (v[`repeating_${section}_${id}_${field}`] === 'on' || v[`repeating_${section}_${id}_${field}`] === '    ') ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
                    const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
                    const output = {};
                    destinations.forEach((destination, index) => {
                        output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
                        if(copyNeg) {
                            if(output[destination] < 0) {
                                output[destination + "_neg"] = output[destination];
                                output[destination] = "    ";
                            }
                            else {
                                output[destination + "_neg"] = "    ";
                            }
                        }
                        if(locale) {
                            output[destination] = output[destination].toLocaleString("en-US");
                        }
                    });
                    setAttrs(output);
                });
            });
        };

        var purchasePriceModifiers = [3,2.5,2,1.75,1.5,1.35,1.25,1.2,1.15,1.1,1.05,1,0.95,0.9,0.85,0.8,0.75,0.7,0.65,0.6,0.55,0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.15]
        var salePriceModifiers =     [0.1,0.2,0.3,0.4,0.45,0.5,0.55,0.6,0.65,0.7,0.75,0.8,0.85,0.9,1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.5,1.6,1.75,2,2.5,3,4]

        // Here's where the most complex calculations are done to find goods available, quantities and prices by trade code for purchase
        on("clicked:determine-trade-goods-and-prices", (info) => {

            addTradeLogMessage("MgT2E: Determine Buyer Prices: " + JSON.stringify(info), true);

            addTradeLogMessage("Determine Buyer Prices");

            // Gather the attributes we need. We need to populate selectedPurchaseTradeCodes as although that builds up as user checks boxes, that array is lost on a char sheet close/open...
            // We could put it in a sheet:open but its baggage at start-up, so do it on demand as we are doing a getAttrs call anyway
            getAttrs(["speculative_purchase_population", "speculative_purchase_broker_type",
                      "speculative_purchase_localbroker_flag", "speculative_purchase_localbroker_skill", "speculative_purchase_localbroker_negskill",
                      "speculative_purchase_supplier_skill", "speculative_purchase_broker_skill", "speculative_purchase_broker_type_illegal",
                      "speculative_purchase_lawlevel"].concat(purchaseTradeCodeAttrs), function(value) {

                // Check player has found a supplier/broker
                addTradeLogMessage("- speculative_purchase_broker_type: " + value.speculative_purchase_broker_type, true);
                if(!value.speculative_purchase_broker_type) {
                    // Player hasn't gone through the broker selection process, set info message and return
                    setAttrs({ speculative_purchase_warning: "Error: Buyer/Broker must be found first!" });
                    return;
                }
                if(+value.speculative_purchase_population === 0 || +value.speculative_purchase_lawlevel === 0) {
                    setAttrs({ speculative_purchase_warning: "Warning: Population and/or Law Level is zero!" });
                }

                // Are we going illegal?
                var isIllegal = false;
                if(value.speculative_purchase_broker_type_illegal === "3") {
                    addTradeLogMessage("- Purchasing illegal goods", true);
                    isIllegal = true;
                }

                populateSelectedPurchaseTradeCodes(value);
                addTradeLogMessage("- Selected trade codes: " + JSON.stringify(selectedPurchaseTradeCodes), true);

                // We use population to adjust quantity if necessary
                var qtyModifier = 0;
                const population = +value.speculative_purchase_population;

                if(population <= 3) {
                    qtyModifier = -3
                }
                else if(population >= 9) {
                    qtyModifier = 3
                }

                // All common goods are available, we just roll quantity for them
                var availableTradeGoodsKeys = ["11", "12", "13", "14", "15", "16"];
                if(isIllegal) {
                    availableTradeGoodsKeys = [];
                }

                // TODO Refactor into using a pre-defined structure for tradeCodeGoodsMapping (currently built on sheet:open)?
                selectedPurchaseTradeCodes.forEach((tc, i) => {
                    // Have we flagged it from checkboxes
                    if(selectedPurchaseTradeCodes[i] === true) {
                        // Index into trade code array to get text of trade code, and grab from mapping
                        const keys = isIllegal ? tradeCodeGoodsIllegalMapping[tradeCodes[i]] : tradeCodeGoodsMapping[tradeCodes[i]];
                        // Keys should be a list of keys e.g. 11 23 34 etc.
                        addTradeLogMessage("- Determine Trade Goods: Keys: " + tradeCodes[i] + ": " + keys, true);
                        if(keys !== undefined) {
                            // Concatenate into our unique array, mildly inefficient but our arrays are small
                            availableTradeGoodsKeys = availableTradeGoodsKeys.concat(keys);
                        }
                    }
                });

                // Uniquify our keys and sort them
                availableTradeGoodsKeys = [...new Set(availableTradeGoodsKeys)].sort();
                addTradeLogMessage("- Determine Trade Goods: All Unique Keys: " + availableTradeGoodsKeys, true);

                // We now have to add a random amount of goods equal to population. To do this we will roll 1D5 (1-5 as 6 is black market) and 1D6 to find our codes population value times.
                // Duplicate codes double up on quantity
                // To do it all in one go we will compile a dice expression along the lines: 1d5+1d6+1d5+1d6... etc. for a pop. of 9
                var diceRoll = "";
                if(population === 0)
                {
                    // Need to populate diceRoll with something or template will fail
                    diceRoll = "0D5+0D6";
                }
                else
                {
                    for(var i=0; i<population; i++) {
                        diceRoll += "1D5+1D6+";
                    }
                }
                addTradeLogMessage("- Random goods dice roll: " + diceRoll, true);
                startRoll("!{{skill=Speculative}} {{roll=[[" + diceRoll + "]]}}", (results) => {

                    addTradeLogMessage("- Random goods dice roll result: " + JSON.stringify(results), true);

                    // Now we take the first value from the dice array, and iterate over subsequent dice that many times
                    //results.results.roll.dice[0] + results.results.roll.dice[1]
                    var counter = 0;
                    var randomGoodsKeys = [];
                    for(var i=0; i<population; i++) {
                        // Grab counter and counter +1 from the array to make a key and store it
                        var firstResult = isIllegal ? 6 : results.results.roll.dice[counter++];
                        randomGoodsKeys.push("" + firstResult + "" + results.results.roll.dice[counter++]);
                    }

                    addTradeLogMessage("- Random goods keys: " + randomGoodsKeys, true);

                    // Switch our trade goods if illegal
                    var tg = isIllegal ? tradeGoodsIllegal : tradeGoods;

                    addTradeLogMessage("- Keys By Trade Code: [" + availableTradeGoodsKeys + "] Random Keys: [" + randomGoodsKeys + "]");

                    // Now we roll for quantities, but need to see if we have any duplicates from the goods keys by trade code plus the randomly available ones,
                    // easiest way is to build an object then run that through a roll template again by building a dice string to do all the rolls in one go.
                    // However the results object does NOT preserve the individual dice resolutions, we can only get the raw dice rolls, so e.g. (2D6-3)*10 will only
                    // give us an array of e.g. [1, 5]... so *for now* we'll roll all the dice and then calculate the amounts later
                    // TODO See if this needs refactoring
                    var tradeGoodsQuantities = {};
                    var goodsDiceRoll = "";
                    var allGoodsKeys = availableTradeGoodsKeys.concat(randomGoodsKeys);
                    allGoodsKeys.forEach((key, i) => {

                        // Strip off the *10 or similar
                        var tonsRoll = tg[key].tons.replace(/\*.*/, "");

                        // Build our dice roll string
                        goodsDiceRoll += tonsRoll + "+";
                    });

                    // We also will need to roll 3D6 for each UNIQUE goods key for price, may as well do it now and pluck off the rolls we need
                    var priceGoodsRoll = "";
                    var uniqueGoodsKeys = [...new Set(allGoodsKeys)];
                    uniqueGoodsKeys.forEach((key, i) => {
                        priceGoodsRoll += "3D6" + "+";
                    });

                    // Roll the dice
                    startRoll("!{{skill=Speculative}} {{roll=[[" + goodsDiceRoll + "]]}} {{priceroll=[[" + priceGoodsRoll + "]]}}", (qtyResults) => {

                        addTradeLogMessage("- Goods quantity tons roll: " + JSON.stringify(qtyResults), true);

                        // Now dissect the rolls array, it's a little tricky as qtyResults.results.roll.rolls[n].results is an array so sometimes we have 1d6 and sometimes 2d6
                        var goodsSummary = {};
                        qtyResults.results.roll.rolls.forEach((roll, i) => {

                            // Sum up the rolls and apply the population modifier
                            var total = roll.results.reduce((a, b) => a + b, 0) + qtyModifier

                            // Now get the modifier from the dictionary, the results from the dice roll are in order of the array of goods keys which is allGoodsKeys ["11", "23",...]
                            // So pick our tons back out of the tg 'dictionary' object
                            var multiplier = 1;
                            var tons = tg[allGoodsKeys[i]].tons;
                            if(tons.includes("*")) {
                                multiplier = +tg[allGoodsKeys[i]].tons.replace(/.*\*/, "")
                            }

                            var result = total * multiplier;
                            if(result <= 0) {
                                result = 0;
                            }
                            if(goodsSummary[allGoodsKeys[i]] !== undefined) {
                                // Doubling up
                                addTradeLogMessage("- Available tons, adding to: " + allGoodsKeys[i] + " Tons: " + result, true);
                                goodsSummary[allGoodsKeys[i]].quantity += result;
                            }
                            else {
                                addTradeLogMessage("- Available tons, setting: " + allGoodsKeys[i] + " Tons: " + result, true);
                                goodsSummary[allGoodsKeys[i]] = { quantity: result };
                            }
                        });

                        addTradeLogMessage("- Total tons for available goods: " + JSON.stringify(goodsSummary), true);

                        // Now we have the available goods and their quantities we move onto the purchase price
                        // For this we need the player's broker skill, or the local broker's skill and +2 (negotiation) modifier
                        // ADD the highest APPLICABLE trade code purchase DM
                        // SUBTRACT the highest APPLICABLE trade code sale DM
                        // SUBTRACT the supplier's Broker skill, default 2

                        // Are we player broker or local broker
                        var pxModifier = +value.speculative_purchase_broker_skill;
                        if(value.speculative_purchase_localbroker_flag === "true") {
                            pxModifier = +value.speculative_purchase_localbroker_skill + +value.speculative_purchase_localbroker_negskill
                            addTradeLogMessage("- Using local broker stats for prices", true);
                        }
                        else {
                            addTradeLogMessage("- Using Traveller's broker stats for prices", true);
                        }

                        // Subtract supplier broker skill
                        pxModifier -= +value.speculative_purchase_supplier_skill;

                        // Now it gets tricky, find the highest DM from the purchase and sales dm entries. Variable uniqueGoodsKeys has our list of keys, start processing the tradeGoods entries
                        // For reference, a trade good looks like
                        /*
                            "21": {
                                type: "Advanced Electronics",
                                availability: [ "Industrial","HighTech" ],
                                tons: "1D6*5",
                                basePrice: "100000",
                                purchaseDM: { Industrial:+2,HighTech:+3 },
                                saleDM: { NonIndustrial:+1,Rich:+2,Asteroid:+3 },
                                examples: "Advanced sensors, computers and other electronics up to TL15"
                            },
                        */
                        // We need to match purchaseDM with the list of selected trade codes for the current planet, taking the highest (if multiple) which apply...
                        // Note: purchase/saleDM are keyed objects...
                        // Note: Planet trade codes are held in selectedPurchaseTradeCodes which is just an array of true/false using index from text list tradeCodes
                        // So, first thing, create an array of strings of our selected trade codes (skip zero-th element as that's a dummy)
                        // TODO: Build this somewhere above when checkboxes change?
                        var tradeCodeLabels = [];
                        for(var i=1; i<selectedPurchaseTradeCodes.length; i++) {
                            //console.log("- Selected trade codes iter: " + i + ": " + selectedPurchaseTradeCodes[i] + ": " + tradeCodes[i]);
                            if(selectedPurchaseTradeCodes[i] === true) {
                                tradeCodeLabels.push(tradeCodes[i]);
                            }
                        }
                        addTradeLogMessage("- Selected trade codes text: " + tradeCodeLabels, true);

                        // Iterate through our unique list of goods keys and grab and process the purchase/saleDM...
                        uniqueGoodsKeys.forEach((key, i) => {
                            var purchaseDM = tg[key].purchaseDM;
                            // ...so now we a) probably want this:  purchaseDM: "{ Industrial:+2,HighTech:+3 }" as an array (Object.keys(o)) and b) need to 'intersect' to see which apply
                            // Firstly, let's try and grab the trade codes that apply...
                            var commonCodes = Object.keys(purchaseDM).filter(x => tradeCodeLabels.includes(x));
                            // Build our 'current price modifier as pxModifier is just a 'baseline' sale/purchase broker skill
                            var currentPxModifier = pxModifier;
                            switch(commonCodes.length) {
                                case 0:
                                    // Easy, do nothing
                                break;
                                case 1:
                                    // Grab the modifier
                                    currentPxModifier += purchaseDM[commonCodes[0]]
                                break;
                                default:
                                    // 2 or more, find the highest modifier
                                    var highestKey = Object.keys(purchaseDM).reduce((a, b) => purchaseDM[a] > purchaseDM[b] ? a : b);
                                    addTradeLogMessage("- Highest purchaseDM: Key: " + key + ", purchaseDM: " + JSON.stringify(purchaseDM) + ", highest: " + highestKey, true);
                                    currentPxModifier += purchaseDM[highestKey];
                            }

                            // Do the same for saleDM!
                            // TODO Remove repeated code into function
                            var saleDM = tg[key].saleDM;
                            var commonCodes = Object.keys(saleDM).filter(x => tradeCodeLabels.includes(x));
                            switch(commonCodes.length) {
                                case 0:
                                    // Easy, do nothing
                                break;
                                case 1:
                                    // Grab the modifier
                                    currentPxModifier -= saleDM[commonCodes[0]]
                                break;
                                default:
                                    // 2 or more, find the highest modifier
                                    var highestKey = Object.keys(saleDM).reduce((a, b) => saleDM[a] > saleDM[b] ? a : b);
                                    currentPxModifier -= saleDM[highestKey];
                            }

                            // So now we can calulate price modifier, remember price roll results held in: qtyResults.results.priceroll.rolls[n]
                            var priceLookupIndex = qtyResults.results.priceroll.rolls[i].results.reduce((partialSum, a) => partialSum + a, 0) + currentPxModifier;
                            if(priceLookupIndex < -3) {
                                priceLookupIndex = -3;
                            }
                            if(priceLookupIndex > 25) {
                                priceLookupIndex = 25;
                            }
                            // The modified price table goes from a result of -3 to 25, so the lookup array is 28 'slots', so add three to the overall dm to give an *index* of 0 to 27
                            // Our arrays are just a multiplier, so multiply!
                            goodsSummary[key].price = purchasePriceModifiers[3 + priceLookupIndex] * tg[key].basePrice
                            goodsSummary[key].multiplier = purchasePriceModifiers[3 + priceLookupIndex];
                        });

                        // Phew! OK, so we made it to the end of available goods, display it for the user, keys seem to be ordered, and add repeating rows into the
                        // 'Purchase goods section' (clearing it out first)
                        deleteRepeatingRows("repeating_speculative-purchase-goods");
                        repSpeculativePurchaseGoodsChanged();

                        var newRowAttrs = {};
                        for (const [key, value] of Object.entries(goodsSummary)) {
                            var goodsEntry = tg[key];
                            addTradeLogMessage("[" + key + "] [" + goodsEntry.type + "] : [" + value.quantity + " tons] [" + goodsEntry.examples + "] [" + goodsEntry.availability.toString().replace(",", ", ") + "]");

                            var newRowId = generateRowID();
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_key"] = key;
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_type"] = goodsEntry.type;
                            //newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_tons"] = value.quantity;
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_tons_display"] = value.quantity;
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_price"] = Math.round(value.price);
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_multiplier"] = Math.round(value.multiplier * 100); // Percent
                            newRowAttrs["repeating_speculative-purchase-goods_" + newRowId + "_speculative_pg_baseprice"] = goodsEntry.basePrice;

                        }
                        newRowAttrs.speculative_purchase_warning = "";
                        setAttrs(newRowAttrs);
                        finishRoll(qtyResults.rollId,{});
                    });
                    finishRoll(results.rollId,{});
                });
            });
        });

        // Purchase the selected goods, add to 'cargo manifest' and chat price paid
        on("clicked:purchase-trade-goods", (info) => {

            addTradeLogMessage("MgT2E: Purchase Trade Goods", true);

            // For buying we want to iterate over the 'purchase goods' repeating section and add them into an equivalent buy goods repeating section, discarding any zero tons
            // This effectively becomes the manifest for the starships hold, as it were
            // Build an array of all the unique attr names as we only want to do getAttrs once
            // Hmmm... if we want to allow for multiple phases of buying goods then *maybe* we just add (and consolidate)
            // That means that as we go to add a new row to the 'sale side' (cargo manifest) we'll need to check if it exists...lot of attr mangling...
            // We'll just add a consolidate (and a clear) button...it's probably quite an edge case...

            var attrArray = [];
            var rowIdsArray;
            getSectionIDs("repeating_speculative-purchase-goods", function(idArray) {

                if(idArray.length === 0) {
                    addTradeLogMessage("- Buy Trade Goods: No goods selected", true);
                    setAttrs({ speculative_purchase_warning: "Error: No goods selected!" });
                    return;
                }

                rowIdsArray = idArray;
                for(var i=0; i < idArray.length; i++) {

                    // Create attribute names, note we do not use price or multiplier as they will get recalculated on the 'sell' action
                    const id = idArray[i];
                    const key = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_key";
                    const goodsType = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_type";
                    const tons = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_tons";
                    const tonsDisplay = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_tons_display";
                    const basePrice = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_baseprice";
                    const price = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_price";
                    attrArray = attrArray.concat([key, tons, goodsType, tonsDisplay, basePrice, price]);
                }
                attrArray.push("speculative_pg_price_total");
                attrArray.push("group_funds");

                // Make our (single) getAttrs call, then loop through our IDs again to process
                getAttrs(attrArray, function (value) {

                    addTradeLogMessage("- Buy Trade Goods: getAttr values: " + JSON.stringify(value), true);
                    updateGroupFunds(+value.speculative_pg_price_total.replaceAll(",", "") * -1, +value.group_funds);

                    var newRowAttrs = {};

                    if(+value.speculative_pg_price_total === 0) {
                        addTradeLogMessage("- Purchase Trade Goods: No tons selected", true);
                        setAttrs({ speculative_purchase_warning: "Error: No tons selected!" });
                        return;
                    }

                    for(var i=0; i < rowIdsArray.length; i++) {

                        addTradeLogMessage("- Adding new row: " + i + ": " + rowIdsArray[i], true);

                        const id = rowIdsArray[i];
                        const key = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_key";
                        const goodsType = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_type";
                        const tons = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_tons";
                        const tonsDisplay = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_tons_display";
                        const basePrice = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_baseprice";
                        const price = "repeating_speculative-purchase-goods_" + id + "_speculative_pg_price";

                        // Originally just cleared out goods that were not bought, but at some point we need to clear out the purchase side as we copy
                        // the goods data into the sale side/cargo manifest below...

                        if(+value[tons] !== 0) {
                            // ...or add in a good row to sell side ('cargo manifest')
                            var newRowId = generateRowID();
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_key"] = value[key];
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_type"] = value[goodsType];
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_tons"] = value[tons];
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_tons_display"] = value[tons];
                            //newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_price"] = 0;
                            //newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_multiplier"] = 0;
                            // NOTE We are adding in the PURCHASE multiplier as a hidden field so we can calculate profit/loss
                            console.log("- Multiplier: " + newRowId + ": " + value[price]);
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_pg_price"] = value[price];
                            newRowAttrs["repeating_speculative-sale-goods_" + newRowId + "_speculative_sg_baseprice"] = value[basePrice];
                        }

                        // Clear out the purchase side row, as we're in a loop anyway
                        removeRepeatingRow("repeating_speculative-purchase-goods_" + id);
                    }

                    // We will also send a message to chat showing how much the players have spent, including local broker fees where applicable
                    startRoll("&{template:trade-broker} {{header=Trade Goods Purchased}} {{message=Cr" + value.speculative_pg_price_total + " Spent}}", (results) => {
					    finishRoll(results.rollId, {});
			        });
			        newRowAttrs.speculative_purchase_warning = "";
                    setAttrs(newRowAttrs);
                });
            });
        });

        // Consolidate any duplicate goods in the cargo manifest
        on("clicked:consolidate-speculative-goods clicked:clear-speculative-goods", (info) => {
            clearConsolidateGoods(info);
        });

        function clearConsolidateGoods(info)
        {
            if(info.triggerName === "clicked:clear-speculative-goods") {

                addTradeLogMessage("MgT2E: Clearing hold goods", true);
                deleteRepeatingRows("repeating_speculative-sale-goods");
                repSpeculativeSaleGoodsChanged();
            }
            else {
                getSectionIDs("repeating_speculative-sale-goods", function(idArray) {
                    addTradeLogMessage("- Consolidating hold goods", true);
                    var keyAttrs = [];
                    for(var i=0; i < idArray.length; i++) {
                        // Create attribute names for keys
                        var key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_key";
                        keyAttrs.push(key);
                        key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_tons_display";
                        keyAttrs.push(key);
                    }

                    // Get the rows
                    var updates = {};
                    var tradeKeyInfo = {};
                    getAttrs(keyAttrs, function (value) {
                        for(var i=0; i < idArray.length; i++) {
                            var tradeKey = value["repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_key"];
                            var tons = +value["repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_tons_display"];

                            if(tradeKeyInfo[tradeKey] === undefined) {
                                // First time seen
                                tradeKeyInfo[tradeKey] = { tons: tons, id: idArray[i] }
                            }
                            else {
                                // We have a duplicate, create/update a setAttr object key...
                                updates["repeating_speculative-sale-goods_" + tradeKeyInfo[tradeKey].id + "_speculative_sg_tons_display"] = tradeKeyInfo[tradeKey].tons + tons;
                                // ...and delete this duplicate row
                                removeRepeatingRow("repeating_speculative-sale-goods_" + idArray[i]);
                                repSpeculativeSaleGoodsChanged();
                            }
                        }
                        setAttrs(updates);
                    });
                });
            }
        }

        on("clicked:clear-freight-goods", (info) => {

            deleteRepeatingRows("repeating_speculative-freight-goods");
            repSpeculativeFreightGoodsChanged();
        });

        on("clicked:clear-other-goods", (info) => {

            deleteRepeatingRows("repeating_speculative-other-goods");
            repSpeculativeOtherGoodsChanged();
        });

        on('change:repeating_speculative-other-goods remove:repeating_speculative-other-goods', function(info) {

            repSpeculativeOtherGoodsChanged();
        });

        // For sale we just need the price modifiers to populate our 'Sell Goods' repeating row section
        on("clicked:determine-buyer-prices", (info) => {

            addTradeLogMessage("MgT2E: Determine Buyer Prices: " + JSON.stringify(info), true);

            var availableGoodsInfo = "";

            // We need to iterate over the 'Cargo Manifest' which is repeating_speculative-sale-goods ,
            // grab the keys and then do the price processing, but again this is a series of 3D6 rolls that we apply modifiers to post-roll
            var rowIdsArray;
            var keyAttrs = [];
            getSectionIDs("repeating_speculative-sale-goods", function(idArray) {

                if(idArray.length === 0) {
                    addTradeLogMessage("- Determine Buyer Prices: No goods available", true);
                    setAttrs({ speculative_sale_warning: "Error: No goods available!" });
                    return;
                }

                rowIdsArray = idArray;
                for(var i=0; i < idArray.length; i++) {
                    // Create attribute names for keys
                    var key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_key";
                    keyAttrs.push(key);
                    key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_illegal";
                    keyAttrs.push(key);
                    key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_pg_price";
                    keyAttrs.push(key);
                    key = "repeating_speculative-sale-goods_" + idArray[i] + "_speculative_sg_tons";
                    keyAttrs.push(key);
                }

                // Gather the attributes we need. We need to populate selectedSaleTradeCodes as although that builds up as user checks boxes, that array is lost on a char sheet close/open...
                getAttrs(["speculative_sale_population", "speculative_sale_broker_type", "speculative_sale_broker_type_illegal",
                      "speculative_sale_localbroker_flag", "speculative_sale_localbroker_skill", "speculative_sale_localbroker_negskill",
                      "speculative_sale_supplier_skill", "speculative_sale_broker_skill", "speculative_sale_lawlevel",
                      "speculative_purchase_lawlevel"].concat(saleTradeCodeAttrs).concat(keyAttrs), function(value) {

                    populateSelectedSaleTradeCodes(value);
                    addTradeLogMessage("- Selected trade codes: " + JSON.stringify(selectedSaleTradeCodes), true);
                    addTradeLogMessage("- Broker type: " + value.speculative_sale_broker_type, true);

                    // Check player has found a supplier/broker
                    if(!value.speculative_sale_broker_type) {
                        // Player hasn't gone through the broker selection process, set info message and return
                        setAttrs({ speculative_sale_warning: "Error: Broker/Buyer must be found first!" });
                        return;
                    }
                    if(+value.speculative_sale_population === 0 || +value.speculative_sale_lawlevel === 0) {
                        setAttrs({ speculative_sale_warning: "Warning: Population and/or Law Level is zero!" });
                    }

                    // Get the list of keys
                    var saleGoodsKeys = []
                    var tmpRowIdsArray = [];
                    for(var i=0; i < rowIdsArray.length; i++) {
                        // Discard codes starting with 0, they are freight
                        var key = value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_key"];
                        if(!key.startsWith("0")) {
                            saleGoodsKeys.push(key);
                            tmpRowIdsArray.push(rowIdsArray[i]);
                        }
                    }
                    // So the above does a bit of a switcheroo, if we lose the 0x freight codes, we have to recombobulate rowIdsArray as we index into both
                    // to find the key, and then the unique row id corresponding to that key, ergh!
                    rowIdsArray = tmpRowIdsArray;
                    saleGoodsKeys = [...new Set(saleGoodsKeys)];
                    addTradeLogMessage("- Unique trade code keys: " + JSON.stringify(saleGoodsKeys), true);

                    // We also will need to roll 3D6 for each UNIQUE goods key for price, may as well do it now and pluck off the rolls we need
                    var priceGoodsRoll = "";
                    saleGoodsKeys.forEach((key, i) => {
                        priceGoodsRoll += "3D6" + "+";
                    });

                    // Roll the dice
                    startRoll("!{{skill=Speculative}} {{priceroll=[[" + priceGoodsRoll + "]]}}", (qtyResults) => {

                        // Now we have the available goods and their quantities we move onto the purchase price
                        // For this we need the player's broker skill, or the local broker's skill and +2 (negotiation) modifier
                        // ADD the highest APPLICABLE trade code sale DM
                        // SUBTRACT the highest APPLICABLE trade code purchase DM
                        // SUBTRACT the buyer's Broker skill, default 2

                        // Are we player broker or local broker
                        var pxModifier = +value.speculative_sale_broker_skill;
                        if(value.speculative_sale_localbroker_flag === "true") {
                            pxModifier = +value.speculative_sale_localbroker_skill + +value.speculative_sale_localbroker_negskill
                            console.log("- Using local broker stats for prices");
                        }
                        else {
                            console.log("- Using Traveller's broker stats for prices");
                        }

                        // Subtract buyer's broker skill
                        pxModifier -= +value.speculative_sale_supplier_skill;

                        // Now it gets tricky, find the highest DM from the purchase and sales dm entries. Variable saleGoodsKeys has our list of keys, start processing the tradeGoods entries
                        // For reference, a trade good looks like
                        /*
                            "21": {
                                type: "Advanced Electronics",
                                availability: [ "Industrial","HighTech" ],
                                tons: "1D6*5",
                                basePrice: "100000",
                                purchaseDM: { Industrial:+2,HighTech:+3 },
                                saleDM: { NonIndustrial:+1,Rich:+2,Asteroid:+3 },
                                examples: "Advanced sensors, computers and other electronics up to TL15"
                            },
                        */
                        // We need to match purchaseDM with the list of selected trade codes for the current planet, taking the highest (if multiple) which apply...
                        // Note: purchase/saleDM are keyed objects...
                        // Note: Planet trade codes are held in selectedSaleTradeCodes which is just an array of true/false using index from text list tradeCodes
                        // So, first thing, create an array of strings of our selected trade codes (skip zero-th element as that's a dummy)
                        // TODO: Build this somewhere above when checkboxes change?
                        var tradeCodeLabels = [];
                        for(var i=1; i<selectedSaleTradeCodes.length; i++) {
                            //console.log("- Selected trade codes iter: " + i + ": " + selectedSaleTradeCodes[i] + ": " + tradeCodes[i]);
                            if(selectedSaleTradeCodes[i] === true) {
                                tradeCodeLabels.push(tradeCodes[i]);
                            }
                        }
                        addTradeLogMessage("- Selected trade codes text: " + tradeCodeLabels, true);
                        var isIllegal = false;
                        if(value.speculative_sale_broker_type_illegal === "3") {
                            //console.log("- Purchasing illegal goods");
                            isIllegal = true;
                        }

                        // Switch our trade goods if illegal
                        var tg = isIllegal ? tradeGoodsIllegal : tradeGoods;

                        // Iterate through our sale list of goods keys and grab and process the purchase/saleDM...
                        var goodsSummary = {};
                        saleGoodsKeys.forEach((key, i) => {

                            // We may have a mixed cargo hold so need to check if the key is present
                            if(tg[key] === undefined)
                            {
                                return;
                            }
                            goodsSummary[key] = {};
                            var purchaseDM = tg[key].purchaseDM;
                            // ...so now we a) probably want this:  purchaseDM: "{ Industrial:+2,HighTech:+3 }" as an array (Object.keys(o)) and b) need to 'intersect' to see which apply
                            // Firstly, let's try and grab the trade codes that apply...
                            var commonCodes = Object.keys(purchaseDM).filter(x => tradeCodeLabels.includes(x));
                            // Build our 'current price modifier as pxModifier is just a 'baseline' sale/purchase broker skill
                            var currentPxModifier = pxModifier;
                            switch(commonCodes.length) {
                                case 0:
                                    // Easy, do nothing
                                break;
                                case 1:
                                    // Grab the modifier
                                    currentPxModifier -= purchaseDM[commonCodes[0]]
                                break;
                                default:
                                    // 2 or more, find the highest modifier
                                    var highestKey = Object.keys(purchaseDM).reduce((a, b) => purchaseDM[a] > purchaseDM[b] ? a : b);
                                    currentPxModifier -= purchaseDM[highestKey];
                            }

                            // Do the same for saleDM!
                            // TODO Remove repeated code into function
                            var saleDM = tg[key].saleDM;

                            // If the illegal checkbox is checked then we use sale law level minus purchase law level, note this is
                            // not a key 6x illegal, this is a normal cargo which is illegal on the destination planet
                            if(!isIllegal && value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_illegal"] === "on")
                            {
                                var key = value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_key"];
                                addTradeLogMessage("- Goods key: " + key + " marked as illegal", true);

                                var lawDiff = +value["speculative_sale_lawlevel"] - +value["speculative_purchase_lawlevel"];
                                addTradeLogMessage("- Goods key: " + key + " using saleDM: " + lawDiff + ", NOT: " + JSON.stringify(tg[key].saleDM), true);

                                currentPxModifier += lawDiff;
                            }
                            else {
                                var commonCodes = Object.keys(saleDM).filter(x => tradeCodeLabels.includes(x));
                                switch(commonCodes.length) {
                                    case 0:
                                        // Easy, do nothing
                                    break;
                                    case 1:
                                        // Grab the modifier
                                        currentPxModifier += saleDM[commonCodes[0]]
                                    break;
                                    default:
                                        // 2 or more, find the highest modifier
                                        var highestKey = Object.keys(saleDM).reduce((a, b) => saleDM[a] > saleDM[b] ? a : b);
                                        currentPxModifier += saleDM[highestKey];
                                }
                            }

                            // So now we can calulate price modifier, remember price roll results held in: qtyResults.results.priceroll.rolls[n]
                            var priceLookupIndex = qtyResults.results.priceroll.rolls[i].results.reduce((partialSum, a) => partialSum + a, 0) + currentPxModifier;
                            if(priceLookupIndex < -3) {
                                priceLookupIndex = -3;
                            }
                            if(priceLookupIndex > 25) {
                                priceLookupIndex = 25;
                            }
                            // The modified price table goes from a result of -3 to 25, so the lookup array is 28 'slots', so add three to the overall dm to give an *index* of 0 to 27
                            // Our arrays are just a multiplier, so multiply!
                            goodsSummary[key].price = salePriceModifiers[3 + priceLookupIndex] * tg[key].basePrice
                            goodsSummary[key].multiplier = salePriceModifiers[3 + priceLookupIndex];
                        });
                        // Now poke the buyer px and multiplier into our repeating rows
                        var priceAttrs = {}
                        // saleGoodsKeys is an array of keys and rowIdsArray is an array of repeating row ids, so iterate and build the setAttrs
                        saleGoodsKeys.forEach((key, i) => {
                            if(goodsSummary[key] !== undefined) {
                                // Work out profit and loss (P/L), to do this we:
                                // bought = multiply the tons by the purchase price
                                // sold = multiply the tons by the base px/ton by the multiplier/100
                                // p/l = sold - bought
                                var price = +value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_pg_price"];
                                var tons = +value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_tons"];
                                var bought = price * tons;
                                console.log("- Bought: " + bought + ", price: " + price + ", tons: " + tons);
                                var sold = +value["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_tons"] * goodsSummary[key].price;
                                console.log("- Sold: " + sold);
                                var pl = Math.round(sold - bought);
                                console.log("- Purchase multiplier: " + rowIdsArray[i] + ": " + pl);
                                priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_saleprice"] = Math.round(goodsSummary[key].price);
                                priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_sale_multiplier"] = Math.round(goodsSummary[key].multiplier * 100);

                                if(pl < 0) {
                                    priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_pl_neg"] = pl;
                                    priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_pl"] = "    ";
                                }
                                else {
                                    priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_pl_neg"] = "    ";
                                    priceAttrs["repeating_speculative-sale-goods_" + rowIdsArray[i] + "_speculative_sg_pl"] = pl;
                                }
                                console.log("- PriceAttrs: " + JSON.stringify(priceAttrs));
                            }
                        });
                        finishRoll(qtyResults.rollId, {});
                        priceAttrs.speculative_sale_warning = "";
                        setAttrs(priceAttrs);
                    });
                });
            });
        });

        on("change:repeating_speculative-sale-goods:speculative_sg_tons", (info) => {

            console.log("MgT2E: Sale Ton Change: " + JSON.stringify(info));
            const rowid = info.sourceAttribute.split('_')[2];

            var keyAttrs = [
                "repeating_speculative-sale-goods_" + rowid + "_speculative_sg_sale_multiplier",
                "repeating_speculative-sale-goods_" + rowid + "_speculative_pg_price",
                "repeating_speculative-sale-goods_" + rowid + "_speculative_sg_baseprice",
                "repeating_speculative-sale-goods_" + rowid + "_speculative_sg_tons"
            ]

            getAttrs(keyAttrs, function (value) {

                addTradeLogMessage("- P/L Attrs: " + JSON.stringify(value), true);

                var priceAttrs = {};
                var bprice = +value["repeating_speculative-sale-goods_" + rowid + "_speculative_pg_price"];
                var btons = +value["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_tons"];
                var bought = bprice * btons;
                console.log("- Bought: " + bought + ", price: " + bprice + ", tons: " + btons);
                var sprice = +value["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_sale_multiplier"]/100;
                var stons = +value["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_tons"]
                var sbase = +value["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_baseprice"]
                var sold = sprice * stons * sbase;
                console.log("- Sold: " + sold + ", price: " + sprice + ", tons: " + stons + ", base: " + sbase);
                var pl = Math.round(sold - bought);
                console.log("- P/L: " + rowid + ": " + pl);

                if(pl < 0) {
                    priceAttrs["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_pl_neg"] = pl;
                    priceAttrs["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_pl"] = "    ";
                }
                else {
                    priceAttrs["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_pl_neg"] = "    ";
                    priceAttrs["repeating_speculative-sale-goods_" + rowid + "_speculative_sg_pl"] = pl;
                }

                setAttrs(priceAttrs);
            });
        });

        on("clicked:sell-trade-goods", (info) => {

            addTradeLogMessage("MgT2E: Sell Trade Goods: " + JSON.stringify(info), true);

            // Recalculate and reset the rows based on the user inputs and calculate the amount received from the sale. Simples!
            var attrArray = [];
            getSectionIDs("repeating_speculative-sale-goods", function(idArray) {

                if(idArray.length === 0) {
                    addTradeLogMessage("- Sell Trade Goods: NO goods selected", true);
                    setAttrs({speculative_sale_warning: "Error: No goods selected" });
                    return;
                }

                for(var i=0; i < idArray.length; i++) {

                    // Create attribute names, note we do not use price or multiplier as they will get recalculated on the 'sell' action
                    const id = idArray[i];
                    const keyAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_key";
                    const tonsAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_tons";
                    const tonsDisplayAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_tons_display";
                    const salePriceAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_saleprice";

                    attrArray = attrArray.concat([keyAttr, tonsAttr, tonsDisplayAttr, salePriceAttr]);
                }
                attrArray.push("speculative_sg_price_buyertotal");
                attrArray.push("speculative_sg_broker_fee");
                attrArray.push("speculative_sale_broker_type");
                attrArray.push("group_funds");
                attrArray.push("speculative_sg_price_total");

                // Make our (single) getAttrs call, then loop through our IDs again to process as we need to see if we have sold all goods of a certain type
                // to tidy up our display and cargo manifest
                var setAttrArray = {};
                getAttrs(attrArray, function (value) {

                    //console.log("- Sell Trade Goods Attrs: " + JSON.stringify(value));

                    // Up front check that we have determined prices
                    if(+value.speculative_sg_price_buyertotal === 0) {
                        addTradeLogMessage("- Sell Trade Goods: No prices or no tons selected", true);
                        setAttrs({speculative_sale_warning: "Error: No prices or no tons selected" });
                        return;
                    }

                    // We may have a mixed hold of legal and illegal goods, so some entries will have blank prices, make sure we check for that

                    for(var i=0; i < idArray.length; i++) {

                        const id = idArray[i];
                        const keyAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_key"
                        const tonsAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_tons"
                        const salePriceAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_saleprice"
                        const tonsDisplayAttr = "repeating_speculative-sale-goods_" + id + "_speculative_sg_tons_display"

                        // We may have a mixed hold of legal and illegal goods, so some entries will have blank prices, skip these
                        if(!+value[salePriceAttr]) {

                            addTradeLogMessage("- Sell Trade Goods: Undefined price for: " + value[keyAttr] + ": " + +value[salePriceAttr], true);
                            continue;
                        }

                        // If the tons sold === tons available then all goods of that type are sold so remove the row, which will also update the cargo manifest as they use the same attributes
                        console.log("- Tons To Sell: " + value[tonsAttr] + ", Tons In Hold: " + value[tonsDisplayAttr]);
                        if(value[tonsAttr] === value[tonsDisplayAttr]) {
                            // We've sold everything
                            removeRepeatingRow("repeating_speculative-sale-goods_" + id);
                            repSpeculativeSaleGoodsChanged();
                        }
                        else {
                            // Update the tons available to the new value
                            setAttrArray[tonsDisplayAttr] = +value[tonsDisplayAttr] - +value[tonsAttr];
                        }
                    }
                    setAttrArray.speculative_sg_price_buyertotal = 0;
                    setAttrArray.speculative_sg_sell_tons_buyertotal = 0;
                    setAttrArray.speculative_sale_warning = "";
                    setAttrs(setAttrArray);
                    // That's about it, send a message to chat, checking to see if there is a broker fee
                    var brokerMessage = "";
                    if(+value.speculative_sg_broker_fee !== 0)
                    {
                        brokerMessage = "(Broker Fee Deducted: Cr" + value.speculative_sg_broker_fee.toLocaleString("EN-us") + ")";
                    }
                    startRoll("&{template:trade-broker} {{header=Trade Goods Sold}} {{message=Cr" + value.speculative_sg_price_total + " Received}} {{roll=" + brokerMessage + "}}", (results) => {
                        console.log("- About to value.speculative_sg_price_total: " + value.speculative_sg_price_total);
                        updateGroupFunds(+value.speculative_sg_price_total.replaceAll(",", ""), +value.group_funds);
					    finishRoll(results.rollId, {});
			        });
                });
            });
        });

        on("clicked:copy-buyer-details", (info) => {

            addTradeLogMessage("MgT2E: Copy Buyer Details: " + JSON.stringify(info), true);

            var attrs = [
                "speculative_sale_starport_dm",
                "speculative_sale_population",
                "speculative_sale_lawlevel",
                "speculative_sale_broker_type_normal",
                "speculative_sale_broker_dm",
                "speculative_sale_broker_type_illegal",
                "speculative_sale_illegalbroker_dm",
                "speculative_sale_broker_type_online",
                "speculative_sale_onlinebroker_dm",
                "speculative_sale_broker_skill",
                "speculative_sale_localbroker_flag",
                "speculative_sale_localbroker_skill",
                "speculative_sale_localbroker_negskill",
                "speculative_sale_supplier_skill",
                "trade_sale_uwp",
            ];

            var defaults = {
                speculative_sale_starport_dm: "0",
                speculative_sale_localbroker_negskill: 2,
                speculative_sale_supplier_skill: 2
            };

            attrs = attrs.concat(saleTradeCodeAttrs);

            getAttrs(attrs, function(v) {

                if(v.trade_sale_uwp) {
                    applyUWP({triggerName: "clicked:trade-purchase-uwp"});
                }

                attrsToSet = {};

                for(let i=0; i<attrs.length; i++) {
                    attrsToSet[attrs[i].replace("sale", "purchase")] = v[attrs[i]];

                    if(defaults[attrs[i]]) {
                        attrsToSet[attrs[i]] = defaults[attrs[i]];
                    }
                    else {
                        attrsToSet[attrs[i]] = "";
                    }
                }
                setAttrs(attrsToSet, null, function() {
                    if(v.trade_sale_uwp) {
                        applyUWP({triggerName: "clicked:trade-purchase-uwp"});
                    }
                });

            });
        });

        // TODO WE have some duplicate functions separated only by purchase/sale, can probably aggregate

        // Zero out a goods quantity, sort of convenience function, then recalc totals
        on("clicked:repeating_speculative-purchase-goods:speculative-pg-zero-qty", function(info) {

            // Check the current value of the hidden attribute.
            //console.log("MgT2E: Zeroing out purchase quantity");
            const rowid = info.sourceAttribute.split('_')[2];
            setAttrs({
                [`repeating_speculative-purchase-goods_${rowid}_speculative_pg_tons`]: 0
            });
            repeatingSum("speculative_pg_tons_total", "speculative-purchase-goods", "speculative_pg_tons", true);
            repeatingSum("speculative_pg_price_suppliertotal", "speculative-purchase-goods", ["speculative_pg_tons", "speculative_pg_price"], true);
        });

        // Zero out a goods quantity, sort of convenience function, then recalc totals
        on("clicked:repeating_speculative-sale-goods:speculative-sg-zero-qty", function(info) {

            // Check the current value of the hidden attribute.
            //console.log("MgT2E: Zeroing out sale quantity");
            const rowid = info.sourceAttribute.split('_')[2];
            setAttrs({
                [`repeating_speculative-sale-goods_${rowid}_speculative_sg_tons`]: 0
            });
            repeatingSum("speculative_sg_tons_total", "speculative-sale-goods", "speculative_sg_tons_display");
            repeatingSum("speculative_sg_price_buyertotal", "speculative-sale-goods", ["speculative_sg_tons", "speculative_sg_saleprice"], true);
        });

        on("clicked:repeating_speculative-purchase-goods:speculative-pg-restore-qty", function(info) {

            // Check the current value of the hidden attribute.
            //console.log("MgT2E: Restoring zeroed out quantity");
            const rowid = info.sourceAttribute.split('_')[2];
            getAttrs([`repeating_speculative-purchase-goods_${rowid}_speculative_pg_tons_display`], function(v) {
                setAttrs({
                    [`repeating_speculative-purchase-goods_${rowid}_speculative_pg_tons`]: v[`repeating_speculative-purchase-goods_${rowid}_speculative_pg_tons_display`]
                });
                //("speculative_pg_tons_total", "speculative-purchase-goods", "speculative_pg_tons", true);
                repeatingSum("speculative_pg_price_suppliertotal", "speculative-purchase-goods", ["speculative_pg_tons", "speculative_pg_price"], true);
            });
        });

        on("clicked:repeating_speculative-sale-goods:speculative-sg-restore-qty", function(info) {

            // Check the current value of the hidden attribute.
            //console.log("MgT2E: Restoring zeroed out quantity");
            const rowid = info.sourceAttribute.split('_')[2];
            getAttrs([`repeating_speculative-sale-goods_${rowid}_speculative_sg_tons_display`], function(v) {
                setAttrs({
                    [`repeating_speculative-sale-goods_${rowid}_speculative_sg_tons`]: v[`repeating_speculative-sale-goods_${rowid}_speculative_sg_tons_display`]
                });
                //repeatingSum("speculative_sg_tons_total", "speculative-sale-goods", "speculative_sg_tons_display");
                repeatingSum("speculative_sg_price_buyertotal", "speculative-sale-goods", ["speculative_sg_tons", "speculative_sg_saleprice"], true);
            });
        });

        // Recalc totals on a change, we use a helper function as we programmatically remove rows which does not fire the remove: event
        function repSpeculativePurchaseGoodsChanged() {

            //console.log("MgT2E: On change tons, or row/addition/replacement: " + JSON.stringify(info));
    	    repeatingSum("speculative_pg_tons_total", "speculative-purchase-goods", "speculative_pg_tons", true);
            repeatingSum("speculative_pg_price_suppliertotal", "speculative-purchase-goods", ["speculative_pg_tons", "speculative_pg_price"], true);
        }
        on('change:repeating_speculative-purchase-goods remove:repeating_speculative-purchase-goods', function(info) {

            repSpeculativePurchaseGoodsChanged();
        });

        // Recalc totals on a change, we use a helper function as we programmatically remove rows which does not fire the remove: event
        function repSpeculativeSaleGoodsChanged() {

            //console.log("MgT2E: On change tons, or row/addition/replacement: " + JSON.stringify(info));
            repeatingSum("speculative_sg_tons_total", "speculative-sale-goods", "speculative_sg_tons_display");
            repeatingSum("speculative_sg_sell_tons_buyertotal", "speculative-sale-goods", "speculative_sg_tons", true);
            repeatingSum("speculative_sg_price_buyertotal", "speculative-sale-goods", ["speculative_sg_tons", "speculative_sg_saleprice"], true);
            //repeatingSum("speculative_sg_pl_total", "speculative-sale-goods", "speculative_sg_pl", true);
            repeatingSum("speculative_sg_pl_total", "speculative-sale-goods", ["speculative_sg_pl", "speculative_sg_pl_neg"], true, true);
        }

        on('change:repeating_speculative-freight-goods remove:repeating_speculative-freight-goods', function(info) {

            repSpeculativeFreightGoodsChanged();
        });

        function repSpeculativeFreightGoodsChanged() {

            repeatingSum("speculative_fg_tons_total", "speculative-freight-goods", "speculative_fg_tons_display");
        }

        function repSpeculativeOtherGoodsChanged() {

            repeatingSum("speculative_og_tons_total", "speculative-other-goods", "speculative_og_tons_display");
        }

        on('change:repeating_speculative-sale-goods remove:repeating_speculative-sale-goods', function(info) {

            repSpeculativeSaleGoodsChanged();
        });

        on('change:speculative_fg_tons_total change:speculative_sg_tons_total change:speculative_og_tons_total ', function(info) {

            console.log("MgT2E: Change of freight, speculative or other total tons: " + JSON.stringify(info));

            getAttrs(["speculative_fg_tons_total", "speculative_sg_tons_total", "speculative_og_tons_total"], function(value) {
                setAttrs({speculative_tons_total : +value.speculative_fg_tons_total + +value.speculative_sg_tons_total + +value.speculative_og_tons_total});
            });
        });

        on('change:speculative_og_tons_display', function(info) {

            console.log("MgT2E: Change of other total tons: " + JSON.stringify(info));

            repSpeculativeOtherGoodsChanged()
        });

        // Calculate broker fee if applicable and set the price total attr
        on('change:speculative_pg_price_suppliertotal change:speculative_sg_price_buyertotal', function(info) {

            console.log("MgT2E: On change supplier/buyer total: " + JSON.stringify(info));

            var attrArray;
            var isPurchase = true;
            var side = "supplier";
            if(info.triggerName === "speculative_pg_price_suppliertotal") {
                attrArray = ["speculative_purchase_localbroker_flag", "speculative_purchase_broker_type"];
            }
            else {
                attrArray = ["speculative_sale_localbroker_flag", "speculative_sale_broker_type"];
                isPurchase = false;
                var side = "buyer";
            }

            getAttrs(attrArray, function(v) {

                var localBrokerFlag = isPurchase ? "speculative_purchase_localbroker_flag" : "speculative_sale_localbroker_flag";
                var localBrokerType = isPurchase ? "speculative_purchase_broker_type" : "speculative_sale_broker_type";
                var brokerFeeMultiplier = 0;
                if(v[localBrokerFlag] === "true") {
                    if(v[localBrokerType] === "illegal") {
                        brokerFeeMultiplier = 0.2;
                        console.log("- On change " + side + " total: Using local illegal broker: " + v[localBrokerFlag]);
                    }
                    else {
                        brokerFeeMultiplier = 0.1;
                        console.log("- On change " + side + " total: Using local broker: " + v[localBrokerFlag]);
                    }
                }
                else {
                    console.log("- On change " + side + " total: NOT Using local broker");
                }

                // Calculate fee, I used the locale string to format so need to unformat by replacing commas, hacky but safe as we specify en-US on our toLocaleString()
                // We also add a total total, e.g. supplier total plus fee showing the actual final amount the Traverllers have to pay
                console.log("- About to info.newValue.replaceAll");
                // For some reason info.newValue can be undefined occasionally so the replaceAll fails, check and zero I guess...
                var total = info.newValue ? +info.newValue.replaceAll(",", "") : 0;
                var fee = Math.round(total * brokerFeeMultiplier);

                setAttrs(isPurchase ? {
                    speculative_pg_broker_fee: fee.toLocaleString("en-US"),
                    speculative_pg_price_total: (total + fee).toLocaleString("en-US")
                } : {
                    speculative_sg_broker_fee: fee.toLocaleString("en-US"),
                    speculative_sg_price_total: (total - fee).toLocaleString("en-US")
                });
            });
        });

        // Detect changes to tons so we do not allow the max to be breached
        on('change:repeating_speculative-purchase-goods:speculative_pg_tons change:repeating_speculative-sale-goods:speculative_sg_tons', function(info) {

            //console.log("MgT2E: Buy max check:" + JSON.stringify(info));

            const displayAttr = info.sourceAttribute + "_display";
            getAttrs([displayAttr], function(v) {
                if(+info.newValue > +v[displayAttr]) {
                    setAttrs({
                        [info.sourceAttribute]: v[displayAttr]
                    });
                }
            });
        });

        // Reset everything on the speculative sheet
        on("clicked:speculative-reset", (info) => {

        	addTradeLogMessage("MgT2E: Reset speculative to defaults", true);

            var tradeCodeResetObj = {};
            purchaseTradeCodeAttrs.forEach((tc, i) => {
                tradeCodeResetObj[tc] = "";
            });
            saleTradeCodeAttrs.forEach((tc, i) => {
                tradeCodeResetObj[tc] = "";
            });

            // We use the spread operator (...) to merge the trade code attrs (checkboxes) with the various 'one-off' attrs the user has set
        	setAttrs({...{

                speculative_available_goods_info: "",
                speculative_purchase_blackmarket: "",
                speculative_purchase_broker_dm: "",
                speculative_purchase_broker_skill: "",
                speculative_purchase_broker_type: "",
                speculative_purchase_broker_type_illegal: "",
                speculative_purchase_broker_type_normal: "",
                speculative_purchase_broker_type_online: "",
                speculative_purchase_population: "",
                speculative_purchase_illegalbroker_dm: "",
                speculative_purchase_localbroker_flag: "",
                speculative_purchase_localbroker_negskill: 2,
                speculative_purchase_localbroker_skill: "",
                speculative_purchase_onlinebroker_dm: "",
                speculative_purchase_starport_dm: "",
                speculative_purchase_supplier_skill: 2,
                speculative_purchase_lawlevel: 0,
                speculative_purchase_warning: "",
                trade_purchase_uwp: "",
                speculative_sale_blackmarket: "",
                speculative_sale_broker_dm: "",
                speculative_sale_broker_skill: "",
                speculative_sale_broker_type: "",
                speculative_sale_broker_type_illegal: "",
                speculative_sale_broker_type_normal: "",
                speculative_sale_broker_type_online: "",
                speculative_sale_population: "",
                speculative_sale_illegalbroker_dm: "",
                speculative_sale_localbroker_flag: "",
                speculative_sale_localbroker_negskill: 2,
                speculative_sale_localbroker_skill: "",
                speculative_sale_onlinebroker_dm: "",
                speculative_sale_starport_dm: "",
                speculative_sale_supplier_skill: 2,
                speculative_sale_lawlevel: 0,
                speculative_sale_warning: "",
                trade_sale_uwp: "",
        	},...tradeCodeResetObj});

            // Delete our sale and purchase rows and zero the totals etc.
        	deleteRepeatingRows("repeating_speculative-purchase-goods");
        	repSpeculativePurchaseGoodsChanged
        	deleteRepeatingRows("repeating_speculative-sale-goods");
        	repSpeculativeSaleGoodsChanged();
        });

        on("clicked:find-value", (info) => {

            getAttrs(["find_value"], function(v) {
                getAttrs([v["find_value"]], function(v2) {
                    console.log("Attr Value: " + v["find_value"] + " = " + v2[v["find_value"]]);
                    setAttrs({show_value: v2[v["find_value"]]})
                });
            });
        });

        // Ag As Ba De Fl Ga Hi Ht Ic In Lo Lt Na Ni Po Ri Va Wa
        const tradeCodesShort = ["ag", "as", "ba", "de", "fl", "ga", "hi", "ht", "ic", "in", "lo", "lt", "na", "ni", "po", "ri", "va", "wa"];
        const tradeCodesLong = [
            "agricultural",
            "asteroid",
            "barren",
            "desert",
            "fluid_oceans",
            "garden",
            "high_population",
            "high_tech",
            "ice_capped",
            "industrial",
            "low_population",
            "low_tech",
            "non_agricultural",
            "non_industrial",
            "poor",
            "rich",
            "vacuum",
            "waterworld",
        ];

        on("clicked:trade-purchase-uwp clicked:trade-sale-uwp", (info) => {

            applyUWP(info);
        });

        function applyUWP(info) {

            addTradeLogMessage("MgT2E: Apply sale/purchase UWP" + JSON.stringify(info), true);

            var uwpAttr = "trade_purchase_uwp";
            var srcDest = "src";
            var isSale = false;
            if(info.triggerName === "clicked:trade-sale-uwp") {
                uwpAttr = "trade_sale_uwp";
                srcDest = "dest";
                isSale = true;
            }

            getAttrs([uwpAttr], function(v) {

                // Split our UWP
                var bits = v[uwpAttr].trim().split(" ");

                // Try and dissect, do some checks first
                if(bits[0].length !== 9) {
                    addTradeLogMessage("- Apply " + (isSale ? "Sale" : "Purchase") + " UWP: Cannot parse: " + v.trade_purchase_uwp.trim(), true);
                    return;
                }
                var chars = bits[0].split('');
                var starport = chars[0].toUpperCase();
                var population = parseInt(chars[4], 16);
                var lawLevel = parseInt(chars[6], 16);
                var techLevel = parseInt(chars[8], 16);

                var tradeCodes = [];
                var attrs = {};

                var tradeCodeAttrs = isSale ? saleTradeCodeAttrs : purchaseTradeCodeAttrs;

                for(let p=0; p<tradeCodeAttrs.length; p++) {
                    attrs[tradeCodeAttrs[p]] = 0;
                }
                for(let i=1; i<bits.length; i++) {

                    // There may be bases but we are going to do a match against our array for trade codes and discard anything else
                    addTradeLogMessage("- bits[i]: " + bits[i], true);
                    var index = tradeCodesShort.findIndex(x => x.toLowerCase() === bits[i].toLowerCase());
                    addTradeLogMessage("- index: " + index, true);
                    if(index >= 0) {
                        // Got one, build our attribute name
                        attrs[(isSale ? "sale_tc_" : "purchase_tc_") + tradeCodesLong[index]] = index+1;
                    }
                }

                // Starport special case for different trade types
                attrs["passengers_" + srcDest + "_starport"] = starport.toLowerCase();
                attrs["freight_" + srcDest + "_starport"] = starport.toLowerCase();


                var side = (isSale ? "sale" : "purchase");
                switch(starport) {
                    case "A":
                        attrs["speculative_" + side + "_starport_dm"] = 6;
                    break;
                    case "B":
                        attrs["speculative_" + side + "_starport_dm"] = 4;
                    break;
                    case "C":
                        attrs["speculative_" + side + "_starport_dm"] = 2;
                    break;
                    default:
                        attrs["speculative_" + side + "_starport_dm"] = 0;
                }

                // Population
                attrs["speculative_" + side + "_population"] = population;

                if(population <= 1) {
                    attrs["passengers_" + srcDest + "_population"] = "pop1";
                    attrs["freight_" + srcDest + "_population"] = "pop1";
                }
                else if(population >=6 && population <= 7) {
                    attrs["passengers_" + srcDest + "_population"] = "pop67";
                    attrs["freight_" + srcDest + "_population"] = "pop67";
                }
                else if(population >= 8) {
                    attrs["passengers_" + srcDest + "_population"] = "pop8";
                    attrs["freight_" + srcDest + "_population"] = "pop8";
                }
                else {
                    attrs["passengers_" + srcDest + "_population"] = "na";
                    attrs["freight_" + srcDest + "_population"] = "na";
                }


                // Law Level
                attrs["speculative_" + side + "_lawlevel"] = lawLevel;

                // Tech Level
                if(techLevel <= 5) {
                    attrs["freight_" + srcDest + "_techlevel"] = "tl5";
                }
                else if(techLevel <= 6) {
                    attrs["freight_" + srcDest + "_techlevel"] = "tl6";
                }
                else if(techLevel >= 9) {
                    attrs["freight_" + srcDest + "_techlevel"] = "tl9";
                }
                else {
                    attrs["freight_" + srcDest + "_techlevel"] = "na";
                }

                //console.log("- Setting attrs: " + JSON.stringify(attrs));
                setAttrs(attrs);
            });
        }

        on("clicked:repeating_animalskills:animalskill", (info) => {

            console.log("MgT2E: Animal skill: " + JSON.stringify(info))

            const rowId = info.sourceAttribute.split('_')[2];
            const skillName   = "repeating_animalskills" + rowId + "_name";
            const skillDM     = "repeating_animalskills" + rowId + "_mod";

            getAttrs([skillName, skillDM, "animal_name"], function(v) {
                startRoll("@{whispertoggle}&{template:skill-attrib} {{skill=" + v.animal_name + ": " + v[skillName] + "}} {{character= @{character_name} }} @{ro_default_rolltype} + " + v[skillDM] + " ]]}}  }}", (results) => {
                    finishRoll(results.rollId, {});
                });
            });
        });

        on("clicked:repeating_animalattacks:animalattack", (info) => {

            console.log("MgT2E: Animal attack: " + JSON.stringify(info))

            const rowId = info.sourceAttribute.split('_')[2];
            const name   = "repeating_animalattack" + rowId + "_name";
            const attackMod   = "repeating_animalattack" + rowId + "_attackmod";
            const damage = "repeating_animalattack" + rowId + "_damage";

            getAttrs([name, attackMod, damage, "animal_name"], function(v) {
                console.log("- Attrs: " + JSON.stringify(v));

                startRoll("@{whispertoggle}&{template:range} {{character=" + v[name] + "}} {{weapon=" + v.animal_name + "}}  @{ro_default_rolltype} + " + v[attackMod] + " @{ro_default_mod}]]}}  {{damage=[[" + v[damage] + "]]}}", (results) => {
                    const toHit = results.results.roll.result;
                    var damage = results.results.damage.result
                    if(toHit > 8) {
                        damage += (toHit - 8);
                    }

                    finishRoll(
                        results.rollId,
                        {
                            roll: toHit,
                            damage: damage
                        }
                    );
                });



                //startRoll("@{whispertoggle}&{template:skill-attrib} {{skill=" + v.animal_name + ": " + v[name] + "}} {{character= @{character_name} }} {{roll=[[" + v[damage] + "]]}}  }}", (results) => {
                //    finishRoll(results.rollId, {});
                //});
            });
        });

        on("clicked:vehicle-autopilot clicked:vehicle-navigation clicked:vehicle-sensors clicked:vehicle-camoflage clicked:vehicle-stealth", (info) => {

            console.log("MgT2E: Vehicle skill roll: " + JSON.stringify(info))

            const dmAttr = "vehicle_" + info.triggerName.replace("clicked:vehicle-", "");
            const skill = "Vehicle " + info.triggerName.replace("clicked:vehicle-", "").replace(/^./, function(str){ return str.toUpperCase(); });

            getAttrs([dmAttr], function(v) {
                startRoll("@{whispertoggle}&{template:skill-attrib} {{skill=" + skill + "}} {{character= @{character_name} }} @{ro_default_rolltype} + " + v[dmAttr] + " @{ro_default_mod}]] }}  }}", (results) => {

                    finishRoll(results.rollId, {});
                });
            });
        });

        on("change:repeating_vehiclemount:mount_name", (info) => {
            console.log("MgT2E: Mount name change: " + JSON.stringify(info));

            // Check for duplicates in name
            getSectionIDs("repeating_vehiclemount", function(idArray) {
                var attrs = [];
                idArray.forEach(id => {
                    attrs.push("repeating_vehiclemount_" + id + "_mount_name");
                });
                getAttrs(attrs, function(v) {
                    const values = Object.values(v)
                    if(values.length !== new Set(values).size) {
                        // We have duplicates
                        setAttrs({vehiclemount_error: "Duplicate mount name found!"});
                    }
                    else {
                        setAttrs({vehiclemount_error: " "});
                    }
                });
            });
        });

        on("change:repeating_vehicleweapons:mount_name", (info) => {

            console.log("MgT2E: Vehicle Weapon mount name change: " + JSON.stringify(info));

            // Validate the hardpoint name against the hardpoints
            getSectionIDs("repeating_vehiclemount", function(idArray) {
                var attrs = [];
                idArray.forEach(id => {
                    attrs.push("repeating_vehiclemount_" + id + "_mount_name");
                });
                getAttrs(attrs, function(v) {
                    // See if our mount exists
                    console.log("- Mount names: " + Object.values(v));
                    if(Object.values(v).includes(info.newValue)) {
                        // Mount is good, set the row id into the weapon. We have checked for duplicate hardpoints
                        // when the hardpoint names are set so we assume there is only one hardpoint with the
                        // name we need
                        var mountKey = Object.keys(v).find(key => v[key] === info.newValue)
                        // Strip off the name attribute to leave us with a prefix so when we fire weapons and need
                        // to pull down the hardpoint e.g. gunner skill we can do it all in one go
                        mountKey = mountKey.replace("mount_name", "");

                        console.log("- Mount key: " + mountKey);
                        var attrsToSet = {};
                        attrsToSet.vehicleweapon_error = " ";
                        attrsToSet[info.sourceAttribute.replace("mount_name", "mount_id")] = mountKey;
                        setAttrs(attrsToSet);
                    }
                    else {
                        // Mount name does not match, display error
                        //console.log("- Hardpoint NOT found: " + Object.values(v));
                        setAttrs({vehicleweapon_error: "Error: Mount: " + info.newValue + " does not exist!"})
                    }
                });
            });
        });

        on("clicked:repeating_vehicleweapons:vehicle-weapon", (info) => {

            console.log("MgT2E: Vehicle weapon click: " + JSON.stringify(info));
            const rowId = info.sourceAttribute.split('_')[2];

            // All we need first is the mount id
            var attrs = [info.sourceAttribute.replace("vehicle-weapon", "mount_id")];
            getAttrs(attrs, function(v) {

                var mountPrefix = v[attrs[0]];
                console.log("- Mount prefix: " + mountPrefix);

                // Bootstrap off the hardpoint prefix to get everything we need
                var weaponPrefix = info.sourceAttribute.replace("vehicle-weapon", "")
                attrs=[];
                ["weapon", "damage"].forEach(attr => {
                    attrs.push(weaponPrefix + attr);
                });
                ["gunner", "dexmod", "custommod", "mount_name"].forEach(attr => {
                    attrs.push(mountPrefix + attr);
                });
                getAttrs(attrs, function(v) {
                    // Now we should have everything we need, add some local vars for clarity
                    var mountName = v[mountPrefix + "mount_name"];

                    if(!mountName) {
                        setAttrs({vehicleweapon_error: "Mount is not set!"});
                        return;
                    }
                    setAttrs({vehicleweapon_error: " "});

                    var gunnerDM = v[mountPrefix + "gunner"];
                    var dexMod = v[mountPrefix + "dexmod"];
                    var customMod = v[mountPrefix + "custommod"];

                    var weaponType = v[weaponPrefix + "weapon"];
                    var weaponDamage = v[weaponPrefix + "damage"];

                    console.log("- mountName: " + mountName + ", gunnerDM: " + gunnerDM + ", dexMod: " + dexMod + ", customMod: " + customMod);
                    console.log("- weaponType: " + weaponType + ", weaponDamage: " + weaponDamage);

                    // We need to handle the weapon damage based on a) are they Destructive (DD) and b) number of weapons which adds the number of damage dice as extra damage
                    if(weaponDamage.includes("DD")) {
                        weaponDamage = weaponDamage.replace("DD", "D6*10");
                    }

                    startRoll("@{whispertoggle}&{template:range} {{character=@{character_name}}} {{weapon=" + mountName + ":" + weaponType + "}}  @{ro_default_rolltype} + " + gunnerDM + " + " + dexMod + " + " + customMod + " @{ro_default_mod}]]}} {{damage=[[" + weaponDamage + "]]}}", (results) => {
                        const toHit = results.results.roll.result;
                        var damage = results.results.damage.result

                        /*
                        if(toHit > 8) {
                            damage += (toHit - 8);
                        }
                        */

                        finishRoll(
                            results.rollId,
                            {
                                roll: toHit,
                                damage: damage,
                            }
                        );
                    });
                });
            });
        });

        // Total up power usage
        const power = ["power_manu", "power_jump", "power_basic", "power_fuel", "power_sensors", "power_weapons"];
        power.forEach(powerType => {
            on("change:" + powerType, (info) => {

                getAttrs(power, function(v) {
                    var total = 0;
                    power.forEach(p => {
                        total += +v[p];
                    });

                    setAttrs({ship_totalpower: total});
                });
            });
        });

        on("change:shiphull_tons", (info) => {

            setAttrs({
                hullpoints_max: Math.round(+info.newValue/2.5),
                ship_numhardpoints: Math.floor(+info.newValue/100)
            });
        });

        on("change:repeating_shiphardpoint:hp_name", (info) => {
            console.log("MgT2E: Hardpoint name change: " + JSON.stringify(info));

            // Check for duplicates in name
            getSectionIDs("repeating_shiphardpoint", function(idArray) {
                var attrs = [];
                idArray.forEach(id => {
                    attrs.push("repeating_shiphardpoint_" + id + "_hp_name");
                });
                getAttrs(attrs, function(v) {
                    const values = Object.values(v)
                    if(values.length !== new Set(values).size) {
                        // We have duplicates
                        setAttrs({hardpoint_error: "Duplicate hardpoint name found!"});
                    }
                    else {
                        setAttrs({hardpoint_error: " "});
                    }
                });
            });
        });

        on("change:repeating_shipweapon:w_hardpoint_name", (info) => {

            console.log("MgT2E: Weapon hardpoint name change: " + JSON.stringify(info));

            // Validate the hardpoint name against the hardpoints
            getSectionIDs("repeating_shiphardpoint", function(idArray) {
                var attrs = [];
                idArray.forEach(id => {
                    attrs.push("repeating_shiphardpoint_" + id + "_hp_name");
                });
                getAttrs(attrs, function(v) {
                    // See if our hardpoint exists
                    console.log("- Hardpoint names: " + Object.values(v));
                    if(Object.values(v).includes(info.newValue)) {
                        // Hardpoint is good, set the row id into the weapon. We have checked for duplicate hardpoints
                        // when the hardpoint names are set so we assume there is only one hardpoint with the
                        // name we need
                        var hardpointKey = Object.keys(v).find(key => v[key] === info.newValue)
                        // Strip off the name attribute to leave us with a prefix so when we fire weapons and need
                        // to pull down the hardpoint e.g. gunner skill we can do it all in one go
                        hardpointKey = hardpointKey.replace("hp_name", "");

                        console.log("- Hardpoint key: " + hardpointKey);
                        var attrsToSet = {};
                        attrsToSet.shipweapon_error = " ";
                        attrsToSet[info.sourceAttribute.replace("w_hardpoint_name", "w_hardpoint_id")] = hardpointKey;
                        setAttrs(attrsToSet);
                    }
                    else {
                        // Hardpoint name does not match, display error
                        //console.log("- Hardpoint NOT found: " + Object.values(v));
                        setAttrs({shipweapon_error: "Error: Hardpoint: " + info.newValue + " does not exist!"})
                    }
                });
            });
        });

        on("clicked:repeating_shipweapon:ship-weapon", (info) => {

            console.log("MgT2E: Ship weapon click: " + JSON.stringify(info));
            const rowId = info.sourceAttribute.split('_')[2];

            // All we need first is the hardpoint id
            var attrs = [info.sourceAttribute.replace("ship-weapon", "w_hardpoint_id")];
            getAttrs(attrs, function(v) {

                var hardpointPrefix = v[attrs[0]];
                console.log("- Hardpoint prefix: " + hardpointPrefix);

                // Bootstrap off the hardpoint prefix to get everything we need
                var weaponPrefix = info.sourceAttribute.replace("ship-weapon", "")
                attrs=[];
                ["w_type", "w_damage", "w_num"].forEach(attr => {
                    attrs.push(weaponPrefix + attr);
                });
                ["gunner", "dexmod", "custommod", "hp_name"].forEach(attr => {
                    attrs.push(hardpointPrefix + attr);
                });
                getAttrs(attrs, function(v) {
                    // Now we should have everything we need, add some local vars for clarity
                    var hpName = v[hardpointPrefix + "hp_name"];
                    var gunnerDM = v[hardpointPrefix + "gunner"];
                    var dexMod = v[hardpointPrefix + "dexmod"];
                    var customMod = v[hardpointPrefix + "custommod"];

                    var weaponType = v[weaponPrefix + "w_type"];
                    var weaponDamage = v[weaponPrefix + "w_damage"];
                    var numWeapons = v[weaponPrefix + "w_num"];

                    console.log("- hpName: " + hpName + ", gunnerDM: " + gunnerDM + ", dexMod: " + dexMod + ", customMod: " + customMod);
                    console.log("- weaponType: " + weaponType + ", weaponDamage: " + weaponDamage + ", numWeapons: " + numWeapons);

                    // We need to handle the weapon damage based on a) are they Destructive (DD) and b) number of weapons which adds the number of damage dice as extra damage
                    var numDamageDice = weaponDamage.match(/^(\d+)/)[0];
                    console.log("- numDamageDice: " + numDamageDice);
                    var damageMod = (+numWeapons - 1) * + numDamageDice;
                    console.log("- damageMod: " + damageMod);
                    if(weaponDamage.includes("DD")) {
                        weaponDamage = weaponDamage.replace("DD", "D6*10");
                        damageMod = 0;
                    }

                    // Damage mod is not applied if missiles
                    if(weaponType.toLowerCase().includes("missile")) {
                        damageMod = 0;
                        gunnerDM = 0;
                    }

                    startRoll("@{whispertoggle}&{template:range} {{character=@{character_name}}} {{weapon=" + hpName + ":" + weaponType + (+numWeapons == 1 ? "" : " x " + numWeapons) + "}}  @{ro_default_rolltype} + " + gunnerDM + " + " + dexMod + " + " + customMod + " @{ro_default_mod}]]}} {{damage=[[" + weaponDamage + " + " + damageMod + "]]}}", (results) => {
                    const toHit = results.results.roll.result;
                    var damage = results.results.damage.result

                    /*
                    if(toHit > 8) {
                        damage += (toHit - 8);
                    }
                    */

                    finishRoll(
                        results.rollId,
                        {
                            roll: toHit,
                            damage: damage,
                        }
                    );
                });
                });
            });
        });


      /*
       * Charactermancer stuff
       */

      const charmancerRollValues = ['charmancer_roll1', 'charmancer_roll2', 'charmancer_roll3',
                                    'charmancer_roll4', 'charmancer_roll5', 'charmancer_roll6'];


      const charmancerRollAssignments = ['charmancer_roll1_assignment', 'charmancer_roll2_assignment',
                                         'charmancer_roll3_assignment', 'charmancer_roll4_assignment',
                                         'charmancer_roll5_assignment', 'charmancer_roll6_assignment'];

      on('sheet:opened', function(eventInfo) {
          showOrHideRollStats();
      });

      stats.forEach(stat => {
          on(`change:base-${stat.toLowerCase()}`, showOrHideRollStats);
      });

      function showOrHideRollStats() {
          const baseStats = stats.map(stat => `base-${stat}`);
          getAttrs(baseStats, hash => {
              const sum     = Object.values(hash).reduce((a,b) => parseInt(a)+parseInt(b));
              const element = $20("button.sheet-roll_stats");
              if(sum == 0) {
                  element.removeClass('sheet-hidden');
              } else {
                  element.addClass('sheet-hidden');
              }

          });
      }

      function toggleRollStatsPanel() {
        $20('div.sheet-characteristics-wrapper,div.sheet-charmancer_stats-wrapper').toggleClass('sheet-hidden');
      }

      function ensureAge18() {
        // set age to 18 if it's unset
        getAttrs(["character_age"], (stats) => {
            if(stats.character_age == "") {
                setAttrs({"character_age": 18});
            }
        });
      }

      function resetRollAssignments() {
        var newAttrs = {};
        for(let ii=0; ii<6 ;ii++) {
          newAttrs[charmancerRollAssignments[ii]] = `base-${stats[ii]}`;
        }
        setAttrs(newAttrs);
      }

      on('clicked:roll-stats', function(eventInfo) {
        ensureAge18();
        resetRollAssignments();
        toggleRollStatsPanel();
      });

      on('clicked:generate-stats', function(eventInfo) {
          getAttrs(['charmancer_roll_method'], (generator) => {
              const method = generator['charmancer_roll_method'];

              var template = ['&{template:default}'];

              if(method == 'yolo') {
                  template.push('{{name=Generate Characteristics (YOLO)}}');
                  template.push('{{STR=[[2d6]]}}');
                  template.push('{{DEX=[[2d6]]}}');
                  template.push('{{END=[[2d6]]}}');
                  template.push('{{INT=[[2d6]]}}');
                  template.push('{{EDU=[[2d6]]}}');
                  template.push('{{SOC=[[2d6]]}}');
              } else {
                  template.push(`{{name=Generate Characteristics (${method.substring(2, method.length-2)})}}`);
                  for(let ii=1; ii < 7; ii++) {
                      template.push(`{{roll ${ii}=${method}}}`);
                  }
              }

              startRoll(template.join(' '), (results) => {
                const rolls = results.results;

                finishRoll(results.rollId, rolls);

                if(method == 'yolo') {
                  setAttrs({
                    'base-Strength':  rolls.STR.result,
                    'base-Dexterity': rolls.DEX.result,
                    'base-Endurance': rolls.END.result,
                    'base-Intellect': rolls.INT.result,
                    'base-Education': rolls.EDU.result,
                    'base-Social':    rolls.SOC.result,
                  }, toggleRollStatsPanel);

                } else {
                  setAttrs({
                    'charmancer_roll1': rolls['roll 1'].result,
                    'charmancer_roll2': rolls['roll 2'].result,
                    'charmancer_roll3': rolls['roll 3'].result,
                    'charmancer_roll4': rolls['roll 4'].result,
                    'charmancer_roll5': rolls['roll 5'].result,
                    'charmancer_roll6': rolls['roll 6'].result
                  });
                }

              });
          });
      });

      on(['change:charmancer_roll1_assignment', 'change:charmancer_roll2_assignment',
          'change:charmancer_roll3_assignment', 'change:charmancer_roll4_assignment',
          'change:charmancer_roll5_assignment', 'change:charmancer_roll6_assignment',
         ].join(' '),
        function(eventInfo) {

          // swap stat with old assignment
          getAttrs(charmancerRollAssignments, (assignments) => {
            const oldValue = eventInfo.previousValue;
            if(!oldValue) return;

            const newAttr   = eventInfo.sourceAttribute;
            const newValue  = eventInfo.newValue;
            const oldAttr   = Object.keys(assignments).find(key => {return key != newAttr && assignments[key] === newValue});

            if(!oldAttr || newAttr == oldAttr) return;

            // I don't now of another way to do this
            var ii = {};
            ii[oldAttr] = oldValue;
            setAttrs(ii);
          });


        }
      );

      on('clicked:assign-stats', function(eventInfo) {

        getAttrs(charmancerRollAssignments.concat(charmancerRollValues), (attrs) => {
          const newAttrs = {};
          for(let ii=1; ii<7 ;ii++) {
            const attr  = attrs[`charmancer_roll${ii}_assignment`];
            const value = attrs[`charmancer_roll${ii}`];
            newAttrs[attr] = value;
          }
          setAttrs(newAttrs);

        });

        toggleRollStatsPanel();
      });

      on('clicked:cancel-roll-stats', function(eventInfo) {
        toggleRollStatsPanel();
      });

    </script>
</div>
