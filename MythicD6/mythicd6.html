<div class="tab-buttons middle center">
  <input type="hidden" class="npctoggle" name="attr_npc"  value="0">
  <button class="pc" type="action" name="act_character" >Character</button>
  <button class="npc" type="action" name="act_npc" >NPC</button>
  <button type="action" name="act_notes" >Notes</button>
  <button type="action" name="act_settings" >Settings</button>
</div>

<span class="version">Sheet Version: <span name="attr_version"></span> </span>

<input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="character">
<!--  ----------------------------------------------------------------------------------------------------------------------- -->
<!--  ------------------------------------------------- CHARACTER -------------------------------------------------------------- -->
<!--  ----------------------------------------------------------------------------------------------------------------------- -->
<main class="character">
<!--  Common section -->

  <div class="common section rowflex nowrap spaced">

    <div class="columnflex nowrap namecol">

      <div class="rowflex nowrap">
        <label>Name</label>
        <input name="attr_character_name" title="@{character_name}" type="text" style="color:black;">
      </div>

      <div class="rowflex nowrap">
        <label class="playername">Player name</label>
        <input class="playername" name="attr_player_name" title="@{player_name}" type="text">
      </div>

    </div>

    <div class="columnflex nowrap">

      <div class="rowflex nowrap">
        <label style="margin-top: 4px;">Power Level</label>
        <input name="attr_power_level" title="@{power_level}" type="number" placeholder="1">
      </div>   

      <div class="rowflex nowrap">
        <label style="margin-top: 0px;">Dice bank</label>
        <input name="attr_dice_bank" title="@{dice_bank}"  type="number" placeholder="1">
      </div>
    </div>

    <div>
      <img src="https://raw.githubusercontent.com/Anduh/roll20-character-sheets/MythicPUG/MythicD6/img/mythicd6-logo.png" alt="MythicD6 logo">
    </div>

  </div>

<!--  ARCHETYPE -->

  <div class="archetype section columnflex nowrap">
    <details>
      <summary>
        <label style="margin-top: 10px;">Archetype:
          <select name="attr_archetypetemplate" title="@{archetypetemplate}">
            <option value="">Select Archetype</option>
            <option value="adventurer">The Adventurer</option>
            <option value="avenger">The Avenger</option>
            <option value="bravo">The Bravo</option>
            <option value="icon">The Icon</option>
            <option value="outsider">The Outsider</option>
            <option value="protector">The Protector</option>
            <option value="rogue">The Rogue</option>
            <option value="scholar">The Scholar</option>
            <option value="warrior">The Warrior</option>
          </select>
        </label>
        <p>(click to expand)</p>
      </summary>
      <!-- <input name="attr_archetype" title="@{archetype}" type="text" placeholder="archetype name"> -->
      <div class="rowflex nowrap">
        <textarea name="attr_archedesc" title="@{archedesc}" placeholder="archetype description" class="featuredesc"></textarea>
        <div class="columnflex nowrap">
          <textarea name="attr_feature1" title="@{feature1}" placeholder="feature 1" class="feature"></textarea>
          <textarea name="attr_feature2" title="@{feature2}" placeholder="feature 2" class="feature"></textarea>        
        </div>
      </div>
    </details>
  </div>


<!--  ATTRIBUTES -->

  <div class="attributes section columnflex nowrap">

    <label class="title">Attributes</label>

    <div class="rowflex nowrap middle center spaced">

     <div class="columnflex nowrap">
        <button name="roll_coo" title="Coordination %{coo}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Coordination}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{coordination} -1)d6>3cf0cs0 + 1d6>3cf1cs6! ]]}} {{ Pip = @{_pip_rest} }}" class="txt-btn d6-dice red">Coo</button>
        <div class="rowflex nowrap">
          <input name="attr_coordination" title="@{coordination}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_coordination_pip" title="@{coordination_pip}" type="number" placeholder="0" value="0">
        </div>
     </div>

      <div class="columnflex nowrap">
        <button name="roll_kno" title="Knowledge %{kno}" type="roll" value="@{whisper}&{template:mythicd6} {{title=knowledge}} {{subtitle=@{character_name} }} {{ Successes = [[(@{knowledge} -1)d6>3cf0cs0 + 1d6>3cf1cs6!]]}} {{ Pip = @{knowledge_pip}}}" class="txt-btn d6-dice red">Kno</button>
        <div class="rowflex nowrap">
          <input name="attr_knowledge" title="@{knowledge}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_knowledge_pip" title="@{knowledge_pip}" type="number" placeholder="0" value="0">
        </div>
      </div>

      <div class="columnflex nowrap">
        <button name="roll_per" title="Perception %{per}" type="roll" value="@{whisper}&{template:mythicd6} {{title=perception}} {{subtitle=@{character_name} }} {{ Successes = [[(@{perception} -1)d6>3cf0cs0 + 1d6>3cf1cs6!]]}} {{ Pip = @{perception_pip}}}" class="txt-btn d6-dice red">Per</button>
        <div class="rowflex nowrap">
          <input name="attr_perception" title="@{perception}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_perception_pip" title="@{perception_pip}" type="number" placeholder="0" value="0">
        </div>
      </div>

      <div class="columnflex nowrap">
        <button name="roll_phy" title="Physique %{phy}" type="roll" value="@{whisper}&{template:mythicd6} {{title=physique}} {{subtitle=@{character_name} }} {{ Successes = [[(@{physique} -1)d6>3cf0cs0 + 1d6>3cf1cs6!]]}} {{ Pip = @{physique_pip}}}" class="txt-btn d6-dice red">Phy</button>
        <div class="rowflex nowrap">
          <input name="attr_physique" title="@{physique}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_physique_pip" title="@{physique_pip}" type="number" placeholder="0" value="0">
        </div>
      </div>

      <div class="columnflex nowrap">
        <button name="roll_pre" title="Presence %{pre}" type="roll" value="@{whisper}&{template:mythicd6} {{title=presence}} {{subtitle=@{character_name} }} {{ Successes = [[(@{presence} -1)d6>3cf0cs0 + 1d6>3cf1cs6!]]}} {{ Pip = @{presence_pip}}}" class="txt-btn d6-dice red">Pre</button>
        <div class="rowflex nowrap">
          <input name="attr_presence" title="@{presence}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_presence_pip" title="@{presence_pip}" type="number" placeholder="0" value="0">
        </div>
      </div>

      <div class="columnflex nowrap">
        <button name="roll_ref" title="%{ref} Reflexes" type="roll" value="@{whisper}&{template:mythicd6} {{title=reflexes}} {{subtitle=@{character_name} }} {{ Successes = [[(@{reflexes} -1)d6>3cf0cs0 + 1d6>3cf1cs6!]]}} {{ Pip = @{reflexes_pip}}}" class="txt-btn d6-dice red">Ref</button>
        <div class="rowflex nowrap">
          <input name="attr_reflexes" title="@{reflexes}" type="number" placeholder="1">
          <span class="dice">D+</span>
          <input name="attr_reflexes_pip" title="@{reflexes_pip}" type="number" placeholder="0" value="0">
        </div>
      </div>

    </div>

  </div>

<!--  SKILLS -->

  <div class="skills section columnflex nowrap">
    
    <div class="rowflex spaced">
      <label class="title">Skills</label>
      <button name="roll_init" title="%{init} Go to Settings-page to adjust init-modifiers" type="roll" value="@{whisper}&{template:mythicd6} {{title=Initiative}} {{subtitle=@{character_name} }} {{color=@{initcolor} }} {{Successes = [[(@{perception} + @{initiative}  -1)d6>3cf0cs0[PERCEPTION] + (@{intuition} + 0)d6>3cf0cs0[INTUITION] + 1d6>3cf1cs6![WILDDIE] +@{initiative_pip_boost}d6>3cf0cs0[PIP BOOST] &{tracker} ]]}} {{ Pip = @{initiative_pip_rest} }}" class="txt-btn d6-dice red">Initiative</button>
    </div>


    <div class="skillgrid">

        <div class="rowflex nowrap">
          <button name="roll_athletics" title="%{athletics}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Athletics}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{athletics}+0)d6>3cf0cs0[SKILL] + (@{athletics_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{athletics_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = [[@{athletics_pip_rest}]] }}" class="skills">athletics</button>
          <select name="attr_athletics_attr" title="@{athletics_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]" selected="selected">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_athletics" title="@{athletics}" type="number" value="" min="0" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_athletics_pip" title="@{athletics_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_athletics_attr_pip" title="@{athletics_attr_pip}" type="hidden" value="0">
          <input name="attr_athletics_pip_boost" title="@{athletics_pip_boost}" type="hidden" value="0">
          <input name="attr_athletics_pip_rest" title="@{athletics_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_knowhow" title="%{knowhow}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Know-How}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{knowhow}+0)d6>3cf0cs0[SKILL] + (@{knowhow_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{knowhow_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{knowhow_pip_rest} }}" class="skills">know-how</button>
          <select name="attr_knowhow_attr" title="@{knowhow_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]" selected="selected">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_knowhow" title="@{knowhow}" type="number" value="" min="0" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_knowhow_pip" title="@{knowhow_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_knowhow_attr_pip" title="@{knowhow_attr_pip}" type="hidden" value="0">
          <input name="attr_knowhow_pip_boost" title="@{knowhow_pip_boost}" type="hidden" value="0">
          <input name="attr_knowhow_pip_rest" title="@{knowhow_pip_rest}" type="hidden" value="0">
        </div>

        <div class="rowflex nowrap">
          <button name="roll_resistance" title="%{resistance}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Resistance}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{resistance}+0)d6>3cf0cs0[SKILL]  + (@{resistance_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{resistance_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pips = @{resistance_pip_rest} }}" class="skills">resistance</button>
          <select name="attr_resistance_attr" title="@{resistance_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]" selected>PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_resistance" title="@{resistance}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_resistance_pip" title="@{resistance_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr__attr_pip" title="@{_attr_pip}" type="hidden" value="0">
          <input name="attr__pip_boost" title="@{_pip_boost}" type="hidden" value="0">
          <input name="attr__pip_rest" title="@{_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_evasion" title="%{evasion}" type="roll" value="@{whisper}&{template:mythicd6} {{title=evasion}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{evasion}+0)d6>3cf0cs0[SKILL] + (@{evasion_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{evasion_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{evasion_pip_rest} }}" class="skills">evasion</button>
          <select name="attr_evasion_attr" title="@{evasion_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]" selected>REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_evasion" title="@{evasion}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_evasion_pip" title="@{evasion_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_evasion_attr_pip" title="@{evasion_attr_pip}" type="hidden" value="0">
          <input name="attr_evasion_pip_boost" title="@{evasion_pip_boost}" type="hidden" value="0">
          <input name="attr_evasion_pip_rest" title="@{evasion_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_language" title="%{language}" type="roll" value="@{whisper}&{template:mythicd6} {{title=language}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{language}+0)d6>3cf0cs0[SKILL] + (@{language_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{language_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{language_pip_rest} }}" class="skills">language</button>
          <select name="attr_language_attr" title="@{language_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]" selected>KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_language" title="@{language}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_language_pip" title="@{language_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_language_attr_pip" title="@{language_attr_pip}" type="hidden" value="0">
          <input name="attr_language_pip_boost" title="@{language_pip_boost}" type="hidden" value="0">
          <input name="attr_language_pip_rest" title="@{language_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_scholar" title="%{scholar}" type="roll" value="@{whisper}&{template:mythicd6} {{title=scholar}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{scholar}+0)d6>3cf0cs0[SKILL] + (@{scholar_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{scholar_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{scholar_pip_rest} }}" class="skills">scholar</button>
          <select name="attr_scholar_attr" title="@{scholar_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]" selected>KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_scholar" title="@{scholar}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_scholar_pip" title="@{scholar_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_scholar_attr_pip" title="@{scholar_attr_pip}" type="hidden" value="0">
          <input name="attr_scholar_pip_boost" title="@{scholar_pip_boost}" type="hidden" value="0">
          <input name="attr_scholar_pip_rest" title="@{scholar_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_fighting" title="%{fighting}" type="roll" value="@{whisper}&{template:mythicd6} {{title=fighting}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{fighting}+0)d6>3cf0cs0[SKILL] + (@{fighting_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{fighting_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{fighting_pip_rest} }}" class="skills">fighting</button>
          <select name="attr_fighting_attr" title="@{fighting_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]" selected>REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_fighting" title="@{fighting}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_fighting_pip" title="@{fighting_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_fighting_attr_pip" title="@{fighting_attr_pip}" type="hidden" value="0">
          <input name="attr_fighting_pip_boost" title="@{fighting_pip_boost}" type="hidden" value="0">
          <input name="attr_fighting_pip_rest" title="@{fighting_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_movement" title="%{movement}" type="roll" value="@{whisper}&{template:mythicd6} {{title=movement}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{movement}+0)d6>3cf0cs0[SKILL] + (@{movement_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{movement_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{movement_pip_rest}} }}" class="skills">movement</button>
          <select name="attr_movement_attr" title="@{movement_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]" selected>PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_movement" title="@{movement}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_movement_pip" title="@{movement_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_movement_attr_pip" title="@{movement_attr_pip}" type="hidden" value="0">
          <input name="attr_movement_pip_boost" title="@{movement_pip_boost}" type="hidden" value="0">
          <input name="attr_movement_pip_rest" title="@{movement_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_sneak" title="%{sneak}" type="roll" value="@{whisper}&{template:mythicd6} {{title=sneak}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{sneak}+0)d6>3cf0cs0[SKILL] + (@{sneak_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{sneak_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{sneak_pip_rest} }}" class="skills">sneak</button>
          <select name="attr_sneak_attr" title="@{sneak_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]" selected>REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_sneak" title="@{sneak}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_sneak_pip" title="@{sneak_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_sneak_attr_pip" title="@{sneak_attr_pip}" type="hidden" value="0">
          <input name="attr_sneak_pip_boost" title="@{sneak_pip_boost}" type="hidden" value="0">
          <input name="attr_sneak_pip_rest" title="@{sneak_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_influence" title="%{influence}" type="roll" value="@{whisper}&{template:mythicd6} {{title=influence}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{influence}+0)d6>3cf0cs0[SKILL] + (@{influence_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{influence_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{influence_pip_rest} }}" class="skills">influence</button>
          <select name="attr_influence_attr" title="@{influence_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]" selected>PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_influence" title="@{influence}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_influence_pip" title="@{influence_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_influence_attr_pip" title="@{influence_attr_pip}" type="hidden" value="0">
          <input name="attr_influence_pip_boost" title="@{influence_pip_boost}" type="hidden" value="0">
          <input name="attr_influence_pip_rest" title="@{influence_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_perform" title="%{perform}" type="roll" value="@{whisper}&{template:mythicd6} {{title=perform}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{perform}+0)d6>3cf0cs0[SKILL] + (@{perform_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{perform_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{perform_pip_rest} }}" class="skills">perform</button>
          <select name="attr_perform_attr" title="@{perform_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]" selected>PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_perform" title="@{perform}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_perform_pip" title="@{perform_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_perform_attr_pip" title="@{perform_attr_pip}" type="hidden" value="0">
          <input name="attr_perform_pip_boost" title="@{perform_pip_boost}" type="hidden" value="0">
          <input name="attr_perform_pip_rest" title="@{perform_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_technical" title="%{technical}" type="roll" value="@{whisper}&{template:mythicd6} {{title=technical}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{technical}+0)d6>3cf0cs0[SKILL] + (@{technical_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{technical_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{technical_pip_rest} }}" class="skills">technical</button>
          <select name="attr_technical_attr" title="@{technical_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]" selected>KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_technical" title="@{technical}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_technical_pip" title="@{technical_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_technical_attr_pip" title="@{technical_attr_pip}" type="hidden" value="0">
          <input name="attr_technical_pip_boost" title="@{technical_pip_boost}" type="hidden" value="0">
          <input name="attr_technical_pip_rest" title="@{technical_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_intuition" title="%{intuition}" type="roll" value="@{whisper}&{template:mythicd6} {{title=intuition}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{intuition}+0)d6>3cf0cs0[SKILL] + (@{intuition_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{intuition_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{intuition_pip_rest} }}" class="skills">intuition</button>
          <select name="attr_intuition_attr" title="@{intuition_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]" selected>PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_intuition" title="@{intuition}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_intuition_pip" title="@{intuition_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_intuition_attr_pip" title="@{intuition_attr_pip}" type="hidden" value="0">
          <input name="attr_intuition_pip_boost" title="@{intuition_pip_boost}" type="hidden" value="0">
          <input name="attr_intuition_pip_rest" title="@{intuition_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_piloting" title="%{piloting}" type="roll" value="@{whisper}&{template:mythicd6} {{title=piloting}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{piloting}+0)d6>3cf0cs0[SKILL] + (@{piloting_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{piloting_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{piloting_pip_rest} }}" class="skills">piloting</button>
          <select name="attr_piloting_attr" title="@{piloting_attr}">
            <option value="[[@{coordination}]]" selected>COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_piloting" title="@{piloting}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_piloting_pip" title="@{piloting_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_piloting_attr_pip" title="@{piloting_attr_pip}" type="hidden" value="0">
          <input name="attr_piloting_pip_boost" title="@{piloting_pip_boost}" type="hidden" value="0">
          <input name="attr_piloting_pip_rest" title="@{piloting_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_thievery" title="%{thievery}" type="roll" value="@{whisper}&{template:mythicd6} {{title=thievery}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{thievery}+0)d6>3cf0cs0[SKILL] + (@{thievery_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{thievery_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{thievery_pip_rest} }}" class="skills">thievery</button>
          <select name="attr_thievery_attr" title="@{thievery_attr}">
            <option value="[[@{coordination}]]" selected>COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_thievery" title="@{thievery}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_thievery_pip" title="@{thievery_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_thievery_attr_pip" title="@{thievery_attr_pip}" type="hidden" value="0">
          <input name="attr_thievery_pip_boost" title="@{thievery_pip_boost}" type="hidden" value="0">
          <input name="attr_thievery_pip_rest" title="@{thievery_pip_rest}" type="hidden" value="0">
        </div>


        <div class="rowflex nowrap">
          <button name="roll_investigation" title="%{investigation}" type="roll" value="@{whisper}&{template:mythicd6} {{title=investigation}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{investigation}+0)d6>3cf0cs0[SKILL] + (@{investigation_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{investigation_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{investigation_pip_rest} }}" class="skills">investigation</button>
          <select name="attr_investigation_attr" title="@{investigation_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]" selected>PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_investigation" title="@{investigation}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_investigation_pip" title="@{investigation_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_investigation_attr_pip" title="@{investigation_attr_pip}" type="hidden" value="0">
          <input name="attr_investigation_pip_boost" title="@{investigation_pip_boost}" type="hidden" value="0">
          <input name="attr_investigation_pip_rest" title="@{investigation_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_ranged_fighting" title="%{ranged_fighting}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Ranged Fighting}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{ranged_fighting}+0)d6>3cf0cs0[SKILL] + (@{ranged_fighting_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{ranged_fighting_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{ranged_fighting_pip_rest} }}" class="skills">Rg. Fighting</button>
          <select name="attr_ranged_fighting_attr" title="@{ranged_fighting_attr}">
            <option value="[[@{coordination}]]" selected>COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_ranged_fighting" title="@{ranged_fighting}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_ranged_fighting_pip" title="@{ranged_fighting_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_ranged_fighting_attr_pip" title="@{ranged_fighting_attr_pip}" type="hidden" value="0">
          <input name="attr_ranged_fighting_pip_boost" title="@{ranged_fighting_pip_boost}" type="hidden" value="0">
          <input name="attr_ranged_fighting_pip_rest" title="@{ranged_fighting_pip_rest}" type="hidden" value="0">
        </div>
        
        <div class="rowflex nowrap">
          <button name="roll_willpower" title="%{willpower}" type="roll" value="@{whisper}&{template:mythicd6} {{title=willpower}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{willpower}+0)d6>3cf0cs0[SKILL] + (@{willpower_attr}-1)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{willpower_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{willpower_pip_rest} }}" class="skills">willpower</button>
          <select name="attr_willpower_attr" title="@{willpower_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]" selected>PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </div>
        <div class="rowflex nowrap">
          <input name="attr_willpower" title="@{willpower}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_willpower_pip" title="@{willpower_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_willpower_attr_pip" title="@{willpower_attr_pip}" type="hidden" value="0">
          <input name="attr_willpower_pip_boost" title="@{willpower_pip_boost}" type="hidden" value="0">
          <input name="attr_willpower_pip_rest" title="@{willpower_pip_rest}" type="hidden" value="0">
        </div>

    <!-- Specializations -->
        <span class="rowflex nowrap">
          <input name="attr_specialization1name" title="@{specialization1name}" type="text" placeholder="specialization">
          <button name="roll_spec1" title="%{spec1}" type="roll" value="@{whisper}&{template:mythicd6} {{title=@{specialization1name} }}  {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{spec1}-1)d6>3cf0cs0[@{specialization1name}] + (@{spec1_attr}+0)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{spec1_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{spec1_pip_rest} }}" class="skills special"></button>
          <select name="attr_spec1_attr" title="@{spec1_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
            <option value="0" selected>None</option>
          </select>
        </span>
        <div class="rowflex nowrap">
          <input name="attr_spec1" title="@{spec1}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_spec1_pip" title="@{specialization1_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_spec1_attr_pip" title="@{spec1_attr_pip}" type="hidden" value="0">
          <input name="attr_spec1_pip_boost" title="@{spec1_pip_boost}" type="hidden" value="0">
          <input name="attr_spec1_pip_rest" title="@{spec1_pip_rest}" type="hidden" value="0">
        </div>
        
        <span class="rowflex nowrap">
          <input name="attr_specialization2name" title="@{specialization2name}" type="text" placeholder="specialization">
          <button name="roll_spec2" title="%{spec2}" type="roll" value="@{whisper}&{template:mythicd6} {{title=@{specialization2name} (specialization)}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{spec2}-1)d6>3cf0cs0[@{specialization2name}] + (@{spec2_attr}+0)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{spec2_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{spec2_pip_rest} }}" class="skills special"></button>
          <select name="attr_spec2_attr" title="@{spec2_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </span>
        <div class="rowflex nowrap">
          <input name="attr_spec2" title="@{spec2}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_spec2_pip" title="@{spec2_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_spec2_attr_pip" title="@{spec2_attr_pip}" type="hidden" value="0">
          <input name="attr_spec2_pip_boost" title="@{spec2_pip_boost}" type="hidden" value="0">
          <input name="attr_spec2_pip_rest" title="@{spec2_pip_rest}" type="hidden" value="0">
        </div>
        
        <span class="rowflex nowrap">
          <input name="attr_specialization3name" title="@{specialization3name}" type="text" placeholder="specialization">
          <button name="roll_spec3" title="%{spec3}" type="roll" value="@{whisper}&{template:mythicd6} {{title=@{specialization3name} (specialization)}} {{subtitle=@{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{spec3}-1)d6>3cf0cs0[@{specialization3name}] + (@{spec3_attr}+0)d6>3cf0cs0[ATTRIBUTE]@{modquery} + @{spec3_pip_boost}d6>3cf0cs0[pip bonus] + 1d6>3cf1cs6![Wild Die] ]]}} {{ Pip = @{spec3_pip_rest} }}" class="skills special"></button>
          <select name="attr_spec3_attr" title="@{spec3_attr}">
            <option value="[[@{coordination}]]">COO</option>
            <option value="[[@{knowledge}]]">KNO</option>
            <option value="[[@{perception}]]">PER</option>
            <option value="[[@{physique}]]">PHY</option>
            <option value="[[@{presence}]]">PRE</option>
            <option value="[[@{reflexes}]]">REF</option>
          </select>
        </span>
        <div class="rowflex nowrap">
          <input name="attr_spec3" title="@{spec3}" type="number" value="" placeholder="1" class="txtfield">
          <span class="dice">D+</span>
          <input name="attr_spec3_pip" title="@{spec3_pip}" type="number" value="0" min="0" max="2" class="txtfield small">
          <input name="attr_spec3_attr_pip" title="@{spec3_attr_pip}" type="hidden" value="0">
          <input name="attr_spec3_pip_boost" title="@{spec3_pip_boost}" type="hidden" value="0">
          <input name="attr_spec3_pip_rest" title="@{spec3_pip_rest}" type="hidden" value="0">
        </div>

    </div>

  </div>

<!-- ADV & disadv -->

  <div class="advantage section halfsection columnflex nowrap">
    <label class="titel">Advantages</label>

    <div class=" rowflex nowrap">
      <input name="attr_advantage1name" title="@{advantage1name}" type="text">
      <input name="attr_advantage1" title="@{advantage1}" type="number" value="">
    </div>

    <div class=" rowflex nowrap">
      <input name="attr_advantage2name" title="@{advantage2name}" type="text">
      <input name="attr_advantage2" title="@{advantage2}" type="number" value="">
    </div>

    <div class=" rowflex nowrap">
      <input name="attr_advantage3name" title="@{advantage3name}" type="text">
      <input name="attr_advantage3" title="@{advantage3}" type="number" value="">
    </div>


    <label class="titel" style="margin-top: 10px;">Disadvantages</label>

    <div>
      <span>personal <input name="attr_personal" title="@{personal}" type="text"><input name="attr_personaldice" title="@{personaldice}" type="number" value=""></span>
    </div>
    <div>
      <span>internal <input name="attr_internal" title="@{internal}" type="text"><input name="attr_internaldice" title="@{internaldice}" type="number" value=""></span>
    </div>
    <div>
      <span>external <input name="attr_external" title="@{external}" type="text"><input name="attr_externaldice" title="@{externaldice}" type="number" value=""></span>
    </div>

  </div>


<!--  POWERS -->

  <div class="powers section columnflex nowrap">
    <div class="rowflex nowrap spaced labels">
      <label class="title">Powers</label>
      <span>Notes</span>
      <span>Rank</span>
      <span>Cost</span>
    </div>

    <div class="rowflex nowrap spaced">
      <button name="roll_power1" title="%{power1}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Power: @{power1name} }}  {{subtitle=@{character_name} }} {{color=@{powercolor} }} {{Rank:= **@{power1rank}** }} {{desc= @{power1desc} }}" class="sendtext"></button>
      <input name="attr_power1name" title="@{power1name}" placeholder="power name" type="text" class="name" list="powers">
      <input name="attr_power1desc" title="@{power1desc}" placeholder="desc" type="text">
      <input name="attr_power1rank" title="@{power1rank}" type="number" value="" placeholder="1">
      <input name="attr_power1cost" title="@{power1cost}" type="number" value="" placeholder="1">
    </div>

    <div class="rowflex nowrap spaced">
      <button name="roll_power2" title="%{power2}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Power: @{power2name} }}  {{subtitle=@{character_name} }} {{color=@{powercolor} }} {{Rank:= **@{power2rank}** }} {{desc= @{power2desc} }}" class="sendtext"></button>
      <input name="attr_power2name" title="@{power2name}" placeholder="power name" type="text" class="name" list="powers">
      <input name="attr_power2desc" title="@{power2desc}" placeholder="desc" type="text">
      <input name="attr_power2rank" title="@{power2rank}" type="number" value="" placeholder="1">
      <input name="attr_power2cost" title="@{power2cost}" type="number" value="" placeholder="1">
    </div>

    <div class="rowflex nowrap spaced">
      <button name="roll_power3" title="%{power3}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Power: @{power3name} }}  {{subtitle=@{character_name} }} {{color=@{powercolor} }} {{Rank:= **@{power3rank}** }} {{desc= @{power3desc} }}" class="sendtext"></button>
      <input name="attr_power3name" title="@{power3name}" placeholder="power name" type="text" class="name" list="powers">
      <input name="attr_power3desc" title="@{power3desc}" placeholder="desc" type="text">
      <input name="attr_power3rank" title="@{power3rank}" type="number" value="" placeholder="1">
      <input name="attr_power3cost" title="@{power3cost}" type="number" value="" placeholder="1">
    </div>

    <div class="rowflex nowrap spaced">
      <button name="roll_power4" title="%{power4}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Power: @{power4name} }}  {{subtitle=@{character_name} }} {{color=@{powercolor} }} {{Rank:= **@{power4rank}** }} {{desc= @{power4desc} }}" class="sendtext"></button>
      <input name="attr_power4name" title="@{power4name}" placeholder="power name" type="text" class="name" list="powers">
      <input name="attr_power4desc" title="@{power4desc}" placeholder="desc" type="text">
      <input name="attr_power4rank" title="@{power4rank}" type="number" value="" placeholder="1">
      <input name="attr_power4cost" title="@{power4cost}" type="number" value="" placeholder="1">
    </div>

  </div>

<!-- stress -->
  <div class="stress section halfsection columnflex wrap spaced">

    <div>
      <span title="Stress Points(SP), pg. 43 for more info.">Stress Points</span><input name="attr_sp" title="@{sp} Stress Points(SP), pg. 43 for more info." type="number" value="20" class="txtfield">/<input name="attr_sp_max" title="@{sp_max} Stress Points(SP), pg. 43 for more info." type="number" value="20" class="txtfield">
    </div>
    <div>
      <span>Hero Points</span><input name="attr_hero_points" title="@{hero_points}" type="number" value="" class="txtfield">/<input name="attr_hero_points_max" title="@{hero_points_max}" type="number" value="" class="txtfield">
    </div>

    <div><span>Renown</span><input name="attr_renown" title="@{renown}" type="number" value="" class="txtfield"></div>
    <div><span title="Physical Damage Bonus">PD</span><input name="attr_pd" title="@{pd} Physical Damage Bonus. Autocalcualted based on character's Physique." type="number" value="" class="txtfield"></div>
    <div><span title="Base Damage Value. ">BDV</span><input name="attr_bdv" title="@{bdv} Base Damage Value" type="number" value="1" class="txtfield"></div>
    <div><span title="Passive Defence Value. Autocalculated based on character's REF attribute">PDV</span><input name="attr_pdv" title="@{pdv} Passive Defence Value" type="number" value="" class="txtfield"></div>
    <div><span>wealth</span><input name="attr_wealth" title="@{wealth}" type="text" value="3d" class="txtfield"></div>
    <div><span>treasure</span><input name="attr_treasure" title="@{treasure}" type="number" value="" class="txtfield"></div>

  </div>

<!-- weapons -->
  <div class="weapons section">
    <label class="title" title="See p.144 for more info">weapons</label>
    <span title="Weapon Accuracy. Bonus dice which is added to base skill when rolling attack">Acc</span>
    <span title="Base Damage Value, for the weapon.">BDV</span>
    <span title="Range:Point Blank">PD</span>
    <span title="Range:Short">S</span>
    <span title="Range:Medium">M</span>
    <span title="Range:Long">L</span>
    <span title="Range:Extreme">EX</span>
    <span title="Ammunition Modifiers.">Ammo</span>
    <span title="Rate of Fire">RoF</span>
    <span title="The skill used in the attack roll. If using Fighting, the PD is added to the weapon BDV. If select 'None', only Accuracy is used to calculate the attack.">Skill</span>
    <span title="Rolls the weapon Attack and Damage. Attack rolls sums your selected attacking skill & weapon accuracy, while Damage is the weapon BDV + PD if using fighting, or just BDV is usig 'ranged fighting' or 'none'.">Roll</span>

    <input name="attr_weapon1" title="@{weapon1}" type="text">
    <input name="attr_weapon1acc" title="@{weapon1acc}" class="txtfield" type="number" value="">
    <input name="attr_weapon1bdv" title="@{weapon1bdv}" class="txtfield" type="number" value="">
    <input name="attr_weapon1pd" title="@{weapon1pd} Point Blank" class="txtfield" type="number" value="">
    <input name="attr_weapon1s" title="@{weapon1s}" class="txtfield" type="number" value="">
    <input name="attr_weapon1m" title="@{weapon1m}" class="txtfield" type="number" value="">
    <input name="attr_weapon1l" title="@{weapon1l}" class="txtfield" type="number" value="">
    <input name="attr_weapon1ex" title="@{weapon1ex}" class="txtfield" type="number" value="">
    <input name="attr_weapon1ammo" title="@{weapon1ammo}" class="txtfield ammo" type="number" value="">
    <input name="attr_weapon1rof" title="@{weapon1rof}" class="txtfield" type="number" value="">
    <select name="attr_weapon1skill" >
      <option value="fighting">Fighting</option>
      <option value="ranged_fighting">Rg. Fighting</option>
      <option value="0" selected>None</option>
    </select>
    <button name="roll_weapon1" title="%{weapon1}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Attack: @{weapon1} }}  {{subtitle=@{character_name} }} {{color=@{weaponcolor} }} {{Successes= [[(@{weapon1acc} +@{weapon1skilldie}-1)d6>3cf0cs0[@{weapon1skill}+weapon accuracy]@{modquery} + 1d6>3cf1cs6![Wild Die] ]]  }} {{Damage= [[@{weapon1skillpd}[pd] + @{weapon1bdv}[bdv] ]] }}" class="d6-dice"></button>

    <input name="attr_weapon2" title="@{weapon2}" type="text">
    <input name="attr_weapon2acc" title="@{weapon2acc}" class="txtfield" type="number" value="">
    <input name="attr_weapon2bdv" title="@{weapon2bdv}" class="txtfield" type="number" value="">
    <input name="attr_weapon2pd" title="@{weapon2pd} Point Blank" class="txtfield" type="number" value="">
    <input name="attr_weapon2s" title="@{weapon2s}" class="txtfield" type="number" value="">
    <input name="attr_weapon2m" title="@{weapon2m}" class="txtfield" type="number" value="">
    <input name="attr_weapon2l" title="@{weapon2l}" class="txtfield" type="number" value="">
    <input name="attr_weapon2ex" title="@{weapon2ex}" class="txtfield" type="number" value="">
    <input name="attr_weapon2ammo" title="@{weapon2ammo}" class="txtfield ammo" type="number" value="">
    <input name="attr_weapon2rof" title="@{weapon2rof}" class="txtfield" type="number" value="">
    <select name="attr_weapon2skill" >
      <option value="fighting">Fighting</option>
      <option value="ranged_fighting">Rg. Fighting</option>
      <option value="0" selected>None</option>
    </select>
    <button name="roll_weapon2" title="%{weapon2}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Attack: @{weapon2} }}  {{subtitle=@{character_name} }} {{color=@{weaponcolor} }} {{Successes= [[(@{weapon2acc} +@{weapon2skilldie}-1)d6>3cf0cs0[@{weapon2skill}+weapon accuracy]@{modquery} + 1d6>3cf1cs6![Wild Die] ]]  }} {{Damage= [[@{weapon2skillpd}[pd] + @{weapon2bdv}[bdv] ]] }}" class="d6-dice"></button>

    <input name="attr_weapon3" title="@{weapon3}" type="text">
    <input name="attr_weapon3acc" title="@{weapon3acc}" class="txtfield" type="number" value="">
    <input name="attr_weapon3bdv" title="@{weapon3bdv}" class="txtfield" type="number" value="">
    <input name="attr_weapon3pd" title="@{weapon3pd} Point Blank" class="txtfield" type="number" value="">
    <input name="attr_weapon3s" title="@{weapon3s}" class="txtfield" type="number" value="">
    <input name="attr_weapon3m" title="@{weapon3m}" class="txtfield" type="number" value="">
    <input name="attr_weapon3l" title="@{weapon3l}" class="txtfield" type="number" value="">
    <input name="attr_weapon3ex" title="@{weapon3ex}" class="txtfield" type="number" value="">
    <input name="attr_weapon3ammo" title="@{weapon3ammo}" class="txtfield ammo" type="number" value="">
    <input name="attr_weapon3rof" title="@{weapon3rof}" class="txtfield" type="number" value="">
    <select name="attr_weapon3skill" >
      <option value="fighting">Fighting</option>
      <option value="ranged_fighting">Rg. Fighting</option>
      <option value="0" selected>None</option>
    </select>
    <button name="roll_weapon3" title="%{weapon3}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Attack: @{weapon3} }}  {{subtitle=@{character_name} }} {{color=@{weaponcolor} }} {{Successes= [[(@{weapon3acc} +@{weapon3skilldie}-1)d6>3cf0cs0[@{weapon3skill}+weapon accuracy]@{modquery} + 1d6>3cf1cs6![Wild Die] ]]  }} {{Damage= [[@{weapon3skillpd}[pd] + @{weapon3bdv}[bdv] ]] }}" class="d6-dice"></button>

  </div>

<!-- armor -->
  <div class="armor section halfsection columnflex nowrap">
    
    <div class="rowflex nowrap spaced">
      <label class="title" title="Armor Name">Armor</label>
      <span title="Armor Value">AV</span>
      <span title="Effect Value">EV</span>
    </div>

    <div class="rowflex nowrap spaced">
      <input name="attr_armor1" title="@{armor1}" type="text" placeholder="armor">
      <input name="attr_armor1av" title="@{armor1av}" type="number" value="">
      <input name="attr_armor1ev" title="@{armor1ev}" type="number" value="">
    </div>

    <div class="rowflex nowrap spaced">
      <input name="attr_armor2" title="@{armor2}" type="text" placeholder="armor">
      <input name="attr_armor2av" title="@{armor2av}" type="number" value="">
      <input name="attr_armor2ev" title="@{armor2ev}" type="number" value="">
    </div>

    <div class="rowflex nowrap spaced">
      <input name="attr_armor3" title="@{armor3}" type="text" placeholder="armor">
      <input name="attr_armor3av" title="@{armor3av}" type="number" value="">
      <input name="attr_armor3ev" title="@{armor3ev}" type="number" value="">
    </div>

  </div>

<!-- equipment -->
  <div class="equipment section columnflex nowrap">
    <label class="title">equipment</label>
    <textarea name="attr_equipment" title="@{equipment}"></textarea>
  </div>

<!-- Rules -->
  <div class="rules section">
    <img src="https://raw.githubusercontent.com/Anduh/roll20-character-sheets/MythicPUG/MythicD6/img/mythicd6-rules.png" alt="Some MythicD6 rules">
  </div>

</main>

<!--  ----------------------------------------------------------------------------------------------------------------------- -->
<!--  ----------------------------------------------------- NPC ---------------------------------------------------------- -->
<!--  ----------------------------------------------------------------------------------------------------------------------- -->

<main class="npc gap">

  <section class="middle center columnflex nowrap border">
      <h2>GM Sheet</h2>
      <br>
  </section>

  <section class="mook columnflex nowrap">
    <div>
      <h3>Mook</h3>    
    </div>
    <div class="mookgrid">
      <div class="name flex-center rowflex nowrap">
        <label>Name: </label>
        <input name="attr_character_name" title="@{character_name}" type="text">
      </div>
      
      <div class="orange" title="Power Level">PL</div>
      <div><input name="attr_power_level" title="Power Level @{power_level}" type="number" value="1"></div>
      <div class="orange">
        <button name="roll_al" title="Ability Level %{al}" type="roll" value="@{whisper}&{template:mythicd6} {{title=Ability Roll}} {{subtitle=Mook: @{character_name} }} {{color=@{skillcolor} }} {{Successes = [[(@{al}-1)d6>3cf0cs0[ABILITY ROLL]@{modquery} + 1d6>3cf1cs6![Wild Die] ]]}}" class="txt-btn">AL <div class="mookdice">F</div></button>
      </div>
      <div class="al">
        <input name="attr_al" title="Ability Level @{al}" type="number" min="1"value="3">
        <span class="bold">D /</span>
        <input name="attr_al_autosuccess" title="Automatic Successes @{al_autosuccess}" type="number" min="1" value="1" >
      </div>

      <span class="orange" title="Base Damage Value">BDV</span>
      <span class="orange" title="Passive Defenisve Value">PDV</span>
      <span class="orange" title="Stress Points">SP</span>
      <span class="orange" title="Hero Points">HrP</span>
      <span class="orange" title="Renown">Ren</span>

      <div><input name="attr_bdv" title="@{bdv}" type="number" value=""></div>
      <div><input name="attr_pdv" title="@{pdv}" type="number" value=""></div>
      <div>
        <input name="attr_sp" title="@{sp}" type="number" value="">
        <span>/</span>
        <input name="attr_sp_max" title="@{sp_max}" type="number" value="">
      </div>
      <div><input name="attr_hero_points" title="Hero Points: @{hrp}" type="number" value=""></div>
      <div><input name="attr_renown" title="@{renown}" type="number" value=""></div>

      <textarea class="notes" name="attr_notes_mook"></textarea>
    </div>
  </section>

</main>

<!--  ----------------------------------------------------------------------------------------------------------------------- -->
<!--  ----------------------------------------------------- NOTES ---------------------------------------------------------- -->
<!--  ----------------------------------------------------------------------------------------------------------------------- -->

<main class="notes">-

  <div class="section columnflex nowrap">

    <div class="columnflex nowrap">
      <span class="bold">Background</span>
      <textarea name="attr_background" title="@{background}"></textarea>
    </div>

    <div class="columnflex nowrap">
      <span class="bold">Notes</span>
      <textarea name="attr_notes" title="@{notes}"></textarea>
    </div>

    <div class="columnflex nowrap">
      <span class="bold">Powers</span>
      <textarea name="attr_powers" title="@{powers}"></textarea>
    </div>
  </div>  

</main>

<!--  ----------------------------------------------------------------------------------------------------------------------- -->
<!--  ----------------------------------------------------- SETTINGS ---------------------------------------------------------- -->
<!--  ----------------------------------------------------------------------------------------------------------------------- -->

<main class="settings">-

  <div class="section columnflex nowrap">
    <span class="bold">Pregen Character Template(changing will overwrite your stats):</span>
    <input name="attr_template" title="@{template}" type="text" placeholder="no archtype template">
  </div>

  <div class="section rowflex nowrap">
    <span class="bold">Initiative bonus:</span>
    <input name="attr_initiative" title="@{initiative}" type="number" value="0">
    <span class="dice">D+</span>
    <input name="attr_initiative_pip" title="@{initiative_pip}" type="number" value="0">
    <input name="attr_initiative_pip_boost" type="hidden" value="0">
    <input name="attr_initiative_pip_rest" type="hidden" value="0">
  </div>

  <div class="section columnflex nowrap">
    <span title="@{show_name}">Ask for Roll Modifiers?</span>
    <select name="attr_modquery" title="@{modquery}" title="@{modquery}">
      <option value="+?{Extra Dice?|0}d6>3cf0cs0[EXTRA DICE]">Yes</option>
      <option value=" ">No</option>
    </select>
  </div>

  <div class="section rowflex nowrap gap">
    <span title="@{whisper}">Whisper rolls to GM?</span>
    <input name="attr_whisper" title="@{whisper}" type="checkbox" value="/w gm">
  </div>

  <div class="section rowflex nowrap gap">
    <span title="@{npc}">NPC sheet?</span>
    <input name="attr_npc" title="@{npc}" type="checkbox" value="1">
  </div>

  <div class="section columnflex nowrap">
    <span>Skill Roll color</span>
    <select name="attr_skillcolor" title="@{skillcolor}">
      <option value="">Red</option>
      <option value="blue" selected>Blue</option>
      <option value="gold">Gold</option>
      <option value="purple">Purple</option>
      <option value="black">Black</option>
      <option value="white">White</option>
    </select>
  </div>

  <div class="section columnflex nowrap">
    <span>Initiative Roll color</span>
    <select name="attr_initcolor" title="@{initcolor}">
      <option value="">Red</option>
      <option value="blue">Blue</option>
      <option value="gold">Gold</option>
      <option value="purple">Purple</option>
      <option value="black" selected>Black</option>
      <option value="white">White</option>
    </select>
  </div>

  <div class="section columnflex nowrap">
    <span>Powers Roll color</span>
    <select name="attr_powercolor" title="@{powercolor}">
      <option value="">Red</option>
      <option value="blue">Blue</option>
      <option value="gold">Gold</option>
      <option value="purple" selected>Purple</option>
      <option value="black">Black</option>
      <option value="white">White</option>
    </select>
  </div>

  <div class="section columnflex nowrap">
    <span>Weapon Roll color</span>
    <select name="attr_weaponcolor" title="@{weaponcolor}">
      <option value="">Red</option>
      <option value="blue">Blue</option>
      <option value="gold">Gold</option>
      <option value="purple">Purple</option>
      <option value="black" selected>Black</option>
      <option value="white">White</option>
    </select>
  </div>

</main>


<input type="hidden" name="attr_weapon1skillpd" value="0"/>
<input type="hidden" name="attr_weapon1skilldie" value="1"/>
<input type="hidden" name="attr_weapon2skillpd" value="0"/>
<input type="hidden" name="attr_weapon2skilldie" value="1"/>
<input type="hidden" name="attr_weapon3skillpd" value="0"/>
<input type="hidden" name="attr_weapon3skilldie" value="1"/>
<input type="hidden" name="attr_version" value="1.11"/>
<datalist id="powers">
  <option value="Accelerated Healing"></option>
  <option value="Animal Mimicry"></option>
  <option value="Aquatic"></option>
  <option value="Body Control"></option>
  <option value="Boost"></option>
  <option value="Chameleon"></option>
  <option value="Darkness"></option>
  <option value="Disease"></option>
  <option value="Drain"></option>
  <option value="Duplication"></option>
  <option value="Elemental Sheath"></option>
  <option value="Energy Constructs"></option>
  <option value="Enhanced Perception"></option>
  <option value="Enhancement"></option>
  <option value="Entangle"></option>
  <option value="Extra Limbs"></option>
  <option value="Fast Reactions"></option>
  <option value="Flash Attack"></option>
  <option value="Healing"></option>
  <option value="Intagible"></option>
  <option value="Invisibility"></option>
  <option value="Life Support"></option>
  <option value="Mimicry"></option>
  <option value="Molecular Mimic"></option>
  <option value="Natural Weaponry"></option>
  <option value="Negation"></option>
  <option value="Omnivorous"></option>
  <option value="Paralyze"></option>
  <option value="Poison Secretion"></option>
  <option value="Radio Communication"></option>
  <option value="Ranged Power Attack"></option>
  <option value="Regeneration"></option>
  <option value="Shape Shift"></option>
  <option value="Size Control"></option>
  <option value="Stretching"></option>
  <option value="Super Attribute"></option>
  <option value="Super Senses"></option>
  <option value="Super Tracking"></option>
  <option value="Sustenance"></option>
  <option value="Transmutation"></option>
  <option value="Transfer Attribute"></option>
  <option value="Vampirism"></option>
  <option value="Weather Control"></option>
  <option value="X-Ray Vision"></option>
  <option value="adaptation"></option>
  <option value="body armor"></option>
  <option value="energy absorption"></option>
  <option value="force field"></option>
  <option value="immunity"></option>
  <option value="invulnerability"></option>
  <option value="missile deflection"></option>
  <option value="resurrection"></option>
  <option value="two-dimensional"></option>
  <option value="air manipulation"></option>
  <option value="cosmic manipulation"></option>
  <option value="darkness manipulation"></option>
  <option value="density manipulation"></option>
  <option value="earth manipulation"></option>
  <option value="electricity manipulation"></option>
  <option value="energy manipulation"></option>
  <option value="flame manipulation"></option>
  <option value="gravity manipulation"></option>
  <option value="ice manipulation"></option>
  <option value="light manipulation"></option>
  <option value="magnetic manipulation"></option>
  <option value="plant manipulation"></option>
  <option value="sound manipulation"></option>
  <option value="time manipulation"></option>
  <option value="water manipulation"></option>
  <option value="animation"></option>
  <option value="animate dead"></option>
  <option value="beast calling"></option>
  <option value="beast control"></option>
  <option value="confusion "></option>
  <option value="cosmic awareness"></option>
  <option value="detect"></option>
  <option value="empathy"></option>
  <option value="esp"></option>
  <option value="hex"></option>
  <option value="illusion"></option>
  <option value="iron will"></option>
  <option value="language comprehension"></option>
  <option value="luck"></option>
  <option value="machine interface"></option>
  <option value="mind control"></option>
  <option value="mind reading"></option>
  <option value="mind field"></option>
  <option value="possession"></option>
  <option value="second sight"></option>
  <option value="summoning"></option>
  <option value="telekinesis"></option>
  <option value="telepathy"></option>
  <option value="astral projection"></option>
  <option value="burrowing"></option>
  <option value="dimensional shifting"></option>
  <option value="enhanced movement"></option>
  <option value="ftl travel"></option>
  <option value="flight"></option>
  <option value="spatial warping"></option>
  <option value="super jump"></option>
  <option value="super speed"></option>
  <option value="swinging"></option>
  <option value="teleportation"></option>
  <option value="wall-crawling"></option>
</datalist>

<rolltemplate class="sheet-rolltemplate-mythicd6">
  <div class="sheet-container sheet-color-{{color}}">
    <div class="sheet-header">
      {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
      {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#allprops() title subtitle desc color}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>
      {{/allprops() title subtitle desc color}}
      {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
    </div>
  </div>
</rolltemplate>

<script type="text/worker">

const int = score => parseInt(score, 10) || 0;

const mainattributes = ["coordination", "knowledge", "perception", "physique", "presence", "reflexes"];

const skills = ["athletics", "evasion", "fighting", "influence", "intuition", "investigation", "knowhow", "language", "movement", "perform", "piloting", "ranged_fighting", "resistance", "scholar", "sneak", "technical", "thievery", "willpower", "spec1", "spec2", "spec3"];
const cooskills = ["piloting","ranged_fighting","thievery"];
const knoskills = ["language","scholar","technical"];
const perskills = ["intuition","investigation","knowhow"];
const physkills = ["athletics","resistance","movement"];
const preskills = ["influence","perform","willpower"];
const refskills = ["evasion","fighting","sneak"];
const archtype = ["archetype", "feature1", "feature2", "archetypetemplate"];
const miscstats = ["stress_points", "stress_points_max", "hero_points", "hero_points_max", "renown", "pd", "bdv", "pdv", "wealth", "treasure"];
const mainattributesnmisc = ["coordination", "knowledge", "perception", "physique", "presence", "reflexes", "fighting"];


// tabs

const buttonlist = ["notes","settings","npc","character"];
buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {

        setAttrs({
            sheetTab: button
        });
    });
});

on("sheet:opened", function() {

  getAttrs(["npc", "sheetTab"], values => {

    let npc = int(values["npc"]);
    let sheetTab = values["sheetTab"];
    console.log("sheetTab: ", sheetTab);
    //let page = "character";

    if (sheetTab === "character"){
      npc = 0;
      console.log("sheetTab was char, set NPC=0: ", npc);
    }
    else if (sheetTab === "npc"){
      npc = 1;
      console.log("sheetTab was npc, set NPC=1: ", npc);
    }
    else if (sheetTab === "notes"){
      console.log("sheetTab was note");
    }
    else if (sheetTab === "settings"){
      console.log("sheetTab was settings");
    }
    setAttrs({
        npc: npc
    });
  });
});

// update misc stats

mainattributes.forEach(statmod => {
    on(`change:${statmod}`, eventInfo => {
        //TAS.log('attr mod change');
        //TAS.log('old mod: ' + eventInfo.previousValue);
        let temp = eventInfo.previousValue;
        if (temp === undefined){
            temp = 0;
        }else{
            temp = temp.replace('+', '');
        }
        
        let oldstatmod = int(temp);

        //TAS.log("old attr val: " + oldstatmod);

        getAttrs(mainattributes, values => {

            var update = {};

            let modnew = int(values[`${statmod}`]);
            let moddiff = modnew - oldstatmod;

            switch (`${statmod}`) {
                case "coordination":
                    
                    break;
                case "knowledge":
                    
                    break;
                case "perception":

                    break;
                case "physique":
                    if (int(values["physique"])<7)
                      update["pd"] = Math.floor(int(values["physique"]) / 2);
                    else if (int(values["physique"])<11)
                      update["pd"] = int(values["physique"]);
                    else if (int(values["physique"])<16)
                      update["pd"] = int(values["physique"])*3;
                    else
                      update["pd"] = 0;

                    setAttrs(update);
                    break;
                case "presence":
                    update["hero_points_max"] = int(values["presence"])*2;

                    setAttrs(update);
                    break;
                case "reflexes":
                    update["pdv"] = Math.floor(int(values["reflexes"]) / 2);

                    setAttrs(update);
                    break;
                default:
                    false;
            }
            //TAS.log(update);

        });
    });
});


// update skill pips when the used attribute is changed, and changes total dice and pip based on total pip from skill + attr

skills.forEach(skill => {
    on(`change:${skill}_attr change:${skill}_pip change:coordination_pip change:knowledge_pip change:perception_pip change:physique_pip change:presence_pip change:reflexes_pip`, eventInfo => {

        let newattr = eventInfo.newValue;
        let sourcename = eventInfo.sourceAttribute;
        //TAS.log(sourcename + ' changed to ' + newattr);
        //TAS.log("Skill Attribute changed, '" + skill + "' now uses " + newattr);

        let attrarray = ["coordination_pip", "knowledge_pip", "perception_pip", "physique_pip", "presence_pip", "reflexes_pip"];

        let issourcenameinarray = (attrarray.indexOf(sourcename) > -1);


        if (issourcenameinarray === true){//attribute pip changed, update relevant skill pip_rest & pip_boost 
          //TAS.log("attribute pip changed: '" + sourcename + "'");

          getAttrs([`${skill}_pip`, `${skill}_attr`, "coordination_pip", "knowledge_pip", "perception_pip", "physique_pip", "presence_pip", "reflexes_pip"], values => {

              var update = {};
              let skillpip = 0;
              let attrpip = 0;
              let pipboost = 0;

              setAttrs(update);
          });
        }

        else {//a skill attr or skill pip was changed

          //TAS.log('skill pip changed: ' + sourcename);

          getAttrs([`${skill}_pip`, `${skill}_attr`, "coordination_pip", "knowledge_pip", "perception_pip", "physique_pip", "presence_pip", "reflexes_pip"], values => {

              var update = {};

              let skillpip = int(values[`${skill}_pip`]);
              let attrpip = int(values[`${skill}_attr_pip`]);

              switch (`${newattr}`) {//when assosiated attribute for a skill changes, the skill's skill_attr_pip is updated to the new one
                  case "[[@{coordination}]]":
                      //TAS.log("skill_attr was coordination");
                      update[`${skill}_attr_pip`] = int(values["coordination_pip"]);
                      attrpip = int(values["coordination_pip"]);
                      break;
                  case "[[@{knowledge}]]":
                      //TAS.log("skill_attr was knowledge");
                      update[`${skill}_attr_pip`] = int(values["knowledge_pip"]);
                      attrpip = int(values["knowledge_pip"]);
                      break;
                  case "[[@{perception}]]":
                      update[`${skill}_attr_pip`] = int(values["perception_pip"]);
                      attrpip = int(values["perception_pip"]);
                      break;
                  case "[[@{physique}]]":
                      update[`${skill}_attr_pip`] = int(values["physique_pip"]);
                      attrpip = int(values["physique_pip"]);
                      break;
                  case "[[@{presence}]]":
                      update[`${skill}_attr_pip`] = int(values["presence_pip"]);
                      attrpip = int(values["presence_pip"]);
                      break;
                  case "[[@{reflexes}]]":
                      update[`${skill}_attr_pip`] = int(values["reflexes_pip"]);
                      attrpip = int(values["reflexes_pip"]);
                      break;
                  default:
                      //TAS.log("bad newattr");
                      false;
              }

              let pipboost = skillpip + attrpip;
              //TAS.log(`pipboost for ${skill}  is ` + pipboost);

              switch (pipboost){
                case 5:
                  update[`${skill}_pip_boost`] = 1;
                  update[`${skill}_pip_rest`] = 2;
                  break;
                case 4:
                  update[`${skill}_pip_boost`] = 1;
                  update[`${skill}_pip_rest`] = 1;
                  break;
                case 3:
                  update[`${skill}_pip_boost`] = 1;
                  update[`${skill}_pip_rest`] = 0;
                  break;
                case 2:
                  update[`${skill}_pip_boost`] = 0;
                  update[`${skill}_pip_rest`] = 2;
                  break;
                case 1:
                  update[`${skill}_pip_boost`] = 0;
                  update[`${skill}_pip_rest`] = 1;
                  break;
                case 0:
                  update[`${skill}_pip_boost`] = 0;
                  update[`${skill}_pip_rest`] = 0;
                  break;
                default:
                  false;
              }
              setAttrs(update);
          });
        }


    });
});


// adjust weapon attribute &  PD to weapon damage 
on("change:weapon1skill change:weapon2skill change:weapon3skill", eventInfo => {
    let wpnskill = eventInfo.sourceAttribute;
    let skillname = eventInfo.newValue; 
    console.log("wpnskill:" + wpnskill + " skillname:" + skillname);

  getAttrs(["pd", "fighting", "reflexes", "fighting_pip_boost", "ranged_fighting", "coordination", "ranged_fighting_pip_boost"], values => {

    let pd = int(values["pd"]);
    let fighting = int(values["fighting"]);
    let reflexes = int(values["reflexes"]);
    let fighting_pip_boost = int(values["fighting_pip_boost"]);
    let ranged_fighting = int(values["ranged_fighting"]);
    let coordination = int(values["coordination"]);
    let ranged_fighting_pip_boost = int(values["ranged_fighting_pip_boost"]);

    let update = {};

    switch (`${skillname}`) {
      case "fighting":

          console.log("fighting:" + fighting + " reflexes:" + reflexes + " fighting_pip_boost:" + fighting_pip_boost);

          update[`${wpnskill}die`] = fighting + reflexes + fighting_pip_boost;
          update[`${wpnskill}pd`] = int(values["pd"]);

          setAttrs(update);
          break;
      case "ranged_fighting":
          console.log("ranged_fighting:" + ranged_fighting + " reflexes:" + reflexes + " ranged_fighting_pip_boost:" + ranged_fighting_pip_boost);

          update[`${wpnskill}die`] = ranged_fighting + coordination + ranged_fighting_pip_boost;
          update[`${wpnskill}pd`] = 0;

          setAttrs(update);
          break;
        default:
          false;
      }
    });
 });

// calculate initiative bonus
on("change:intuition_pip change:perception_pip change:initiative_pip", eventInfo => {

  getAttrs(["intuition_pip", "perception_pip", "initiative_pip"], values => {

    let intuition_pip = int(values["intuition_pip"]);
    let perception_pip = int(values["perception_pip"]);
    let initiative_pip = int(values["initiative_pip"]);

    let pipboost = intuition_pip + perception_pip + initiative_pip;

    let update = {};

    switch (pipboost){
      case 6:
        update["initiative_pip_boost"] = 2;
        update["initiative_pip_rest"] = 0;
        break;
      case 5:
        update["initiative_pip_boost"] = 1;
        update["initiative_pip_rest"] = 2;
        break;
      case 4:
        update["initiative_pip_boost"] = 1;
        update["initiative_pip_rest"] = 1;
        break;
      case 3:
        update["initiative_pip_boost"] = 1;
        update["initiative_pip_rest"] = 0;
        break;
      case 2:
        update["initiative_pip_boost"] = 0;
        update["initiative_pip_rest"] = 2;
        break;
      case 1:
        update["initiative_pip_boost"] = 0;
        update["initiative_pip_rest"] = 1;
        break;
      case 0:
        update["initiative_pip_boost"] = 0;
        update["initiative_pip_rest"] = 0;
        break;
      default:
        false;
    }
    setAttrs(update);
 });
});

// Updates Archetype Concept Bonuses & Penalty

on("change:archetypetemplate", eventInfo => {
    //TAS.log('archetype changes');
    getAttrs(["archetypetemplate"], values => {
        let template = values["archetypetemplate"];
        //TAS.log("achetype" + template);
        let archename = "";
        let archedesc = "";
        let f1 = "";
        let f2 = "";

        switch (template) {
            case "adventurer":
                //TAS.log("Arche is adventurer");
                archename = "The Adventurer";
                archedesc = "The Adventurer is an everyday kind of person who happens to have special abilities and the will to use them. An Adventurers goals are not lofty or dark; if you are an Adventurer, you just know right from wrong and feel a responsibility to use your abilities for the common interest. Adventurers are known for flexibility and thoughtfulness. This is one of the most open and Heroic of the Archetypes, and suitable for a character whos certain he wants to be Heroic, but not sure how to be.";
                f1 = "Helping Hand. The Adventurer has seen and experienced many things and is always ready with a solution to a problem. A number of times per game equal to the Heros KNO they may augment theirs or anothers skill roll by a number of dice equal to twice their PER attribute.";
                f2 = "The Adventurer adds 2D to the Aggravation Pool when she refuses to, or through inaction, allows a person in need or dire situation go unattended.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "avenger":
                //TAS.log("Arche is Avenger");
                archename = "The Avenger";
                archedesc = "The Avenger is the character who fights the forces of evil with his rules, driven by some need to see justice being done, possibly on any terms. The character is consumed by the desire to wreak retribution on all villains, for some slight or tragedy that was committed against them in their past. To the Avengers view, the streets are full of crime, and the local law enforcement is either on the take or completely ineffectual. To take back the streets, the Avenger, and every right-thinking citizen, should get their hands dirty, making the predators the prey. However, they may destroy a lot in the process of their vengeance, and certainly arent likely to make more friends  in fact, they may drive some away.";
                f1 = "Dark Justice. The Avenger is unrelenting in his quest for vengeance or what he believes to be just and adept at impressing his will upon others in pursuits. A number of times per game equal to the Heroes PER the Hero may double the Skill Level of any PRE+ Skill roll.";
                f2 = "The Avenger adds 2D to the Aggravation Pool when she allows a grievous wrong to go unpunished.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "bravo":
                archename = "The Bravo";
                archedesc = "The Bravo has not a care in the world and lives for the moment. Shes the life of the party, the Ayatollah of Rock-n-Rolla, constantly joking, and taking everything, not with a single grain of salt, but the whole bag. Shes a high-octane joy girl (or boy) who always takes the big chances and somehow gains the big rewards, a thrill-seeker who lives life to the fullest. But she must also beware the consequences of her actions!";
                f1 = "Bravos are constantly in motion, moving from one outrageous activity to another. A number of times per game equal to the Heroes PER, the Hero may double the Skill Level of any REF+ skill roll.";
                f2 = "The Bravo adds 2D to the Aggravation Pool when she plans or takes part in planning actions before taking them.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "icon":
                archename = "The Icon";
                archedesc = "The Icon is the essence of the loftier ideals of humanity. People look up to her for what she stands for. Shes the person who tries to lead by example, putting her best foot forward in the hopes that it will inspire humanity to do the same. Sometimes the people around her think shes corny and stuffy, but its a small price to pay to achieve her goals!";
                f1 = "Inspire. The Icons can inspire those that respect her times per game equal to her PRE. The Hero must spend an action inciting the others to greatness and rolls her PRE + Influence; everyone in the Icons group receives a number of bonus successes to their next roll equal to one (1) plus the Effect Value of the roll.";
                f2 = "The Icon adds 2D to the Aggravation Pool when she, through her actions, fails to live up to the lofty ideas she espouses.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "outsider":
                archename = "The Outsider";
                archedesc = "The Outsider is different from normal society or people or so he thinks, anyway. Whether hunted for real, or by some imaginary foes, the world is a much colder place to live than normal society, because The Outsider realizes whats really going on. Hes the ultimate survivor, living by his own cunning and sharp wits. His friends consider him a pessimist if theyre not like-minded.";
                f1 = "Outsiders are excellent at reading a situation and known where the cards will fall. Because Outsiders place a high priority on self-reliance, they are also very adept at taking care of themselves. Several times per game equal to the Heros PER, the Hero may double the Skill Level of any PER + skill.";
                f2 = "The Outsider adds 2D to the Aggravation Pool when she allows herself to trust those in authority without checking all the facts and angles.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "protector":
                archename = "The Protector";
                archedesc = "The Protector is the champion of an idea or place. She might be the defender of the environment on an island or a small community anywhere or might devote herself to ideals like justice, purity, etc. She fights with an almost religious fervor when protecting her charges, and takes her duties very seriously. She feels personal pain if, by her own inaction, she allows harm to come to that which she protects.";
                f1 = "Aegis. The protector may shield others equal to his REF from any attack (physical, mental, or social). The Hero must spend an action defending others and rolls her PER + willpower; everyone under the protectors defense reduces the number of successes of the attack directed at them by one (1) plus the Effect Value of the roll (for a single attack). The Hero may do this times equal to his PER attribute per game.";
                f2 = "The Protector adds 2D to the Aggravation Pool when she refuses through action or the expressed action of those around them to protect someone/thing in his charge.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "rogue":
                archename = "The Rogue";
                archedesc = "No one has more secrets than the Rogue does. The Rogue runs the borderline of a criminal, barely Heroic character, and may have a shady past that hes trying to run away from or forget. The straight and narrow path is one littered with temptation, and he must stay strong and not falter because sometimes the unsavory deeds of the past come back to haunt you. Often, hell stumble on that path, looking for an angle that leads to personal gain. Hes not above using his status to help himself. He has an absolute disdain for authority, and will always want to do things his way. Yet with all these personal drawbacks, he still has a sense of honor and will stick with a friend to the end.";
                f1 = "Slick. The Hero is slippery and can usually find his way out of any problem. A number of times per game equal to his PER the Hero may add double his Skill Level in any COO + skill.";
                f2 = "The Rogue adds 2D to the Aggravation Pool when she gives of herself without regard to personal gain or reward.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "scholar":
                archename = "The Scholar";
                archedesc = "The Scholar seeks knowledge for the sake of knowing. She could be any type of educated figure, from a mathematician to an exotic sorcerer. The Scholar is brilliant, and oft a little quirky, always looking for the cutting edge; and she wont stop looking until shes lacerated herself on it! This is not to say that every Scholar is a goofy, wild-haired person in the basement of the science building  she could also be that astrophysicist rock star who gets anyone she wants because she has all the brains. However, most Scholars share the common trait that they must know the unknowable  and that can get them into a lot of trouble!";
                f1 = "Deductive Reasoning. Scholars excel at making leaps of deduction or thinking creatively. The Hero can double the Skill Level in any KNO skill a number of times per game equal to her PER attribute.";
                f2 = "The Scholar adds 2D to the Aggravation Pool when she fails to delves into the unknown or probe to uncover secrets.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            case "warrior":
                archename = "The Warrior";
                archedesc = "Your character lives for the fight and little else. He lives the Spartan life, always honing his abilities. He may have a social life, but this is probably by pure accident. The Warrior is always completely obsessed with the fight  his goal is to be the best, and the only way to be the best is through battle.";
                f1 = "Signature Attack. The Warrior has perfected a single attack maneuver that he is known and feared for. The move can be performed a number of times per game equal to the Heros KNO attribute. When the attack is executed, the Hero may double their Skill Level in a Fighting or Ranged Fighting skill (picked at character creation).";
                f2 = "The Warrior adds 2D to the Aggravation Pool when they refuse to settle a dispute with action rather than reason and words.";
                setAttrs({
                    "archetype": archename,
                    "archedesc": archedesc,
                    "feature1": f1,
                    "feature2": f2
                });
                break;
            default:
                    false;
        }
    });
 });


// Updates stats if template character is selected.


on("change:template", eventInfo => {

  //TAS.log('change char template');

  getAttrs(["template"], values => {
    let template = values["template"];
    let update = {};

    switch (template) {
      case "bravo":
          //TAS.log("Bravo template used");
          update["character_name"] = "Bravo";
          update["power_level"] = 3;

          update["archetype"] = "Bravo";
          update["feature1"] = "Reckless abandon. constant motion";
          update["feature2"] = "2D aggro pool if hero plans ahead.";

          update["coordination"] = 3;
          update["coordination_pip"] = 1; 
          update["knowledge"] = 2;
          update["knowledge_pip"] = 0; 
          update["perception"] = 3;
          update["perception_pip"] = 0; 
          update["physique"] = 7;
          update["physique_pip"] = 0; 
          update["presence"] = 2;
          update["presence_pip"] = 0; 
          update["reflexes"] = 4;
          update["reflexes_pip"] = 2;

          
          update["athletics"] = 9;
          update["evasion"] = 3;
          update["fighting"] = 3;
          update["influence"] = 3;
          update["intuition"] = 2;
          update["investigation"] = 1;

          update["knowhow"] = 0;
          update["language"] = 3;
          update["movement"] = 2;
          update["perform"] = 0;
          update["piloting"] = 0;
          update["ranged_fighting"] = 2;

          update["resistance"] = 2;
          update["scholar"] = 0;
          update["sneak"] = 3;
          update["technical"] = 0;
          update["thievery"] = 2;
          update["willpower"] = 1;


          update["power1name"] = "";
          update["power1desc"] = "";
          update["power1rank"] = "";
          update["power1cost"] = "";

          update["power2name"] = "";
          update["power2desc"] = "";
          update["power2rank"] = "";
          update["power2cost"] = "";

          update["power3name"] = "";
          update["power3desc"] = "";
          update["power3rank"] = "";
          update["power3cost"] = "";

          update["advantage1name"] = "Wrestler of Bulls";
          update["advantage1"] = 2;
          update["advantage2name"] = "";
          update["advantage2"] = "";
          update["advantage3name"] = "";
          update["advantage3"] = "";

          update["personal"] = "Enemy,Misery";
          update["personaldice"] = 2;
          update["internal"] = "Hot Blooded";
          update["internaldice"] = 1;
          update["external"] = "Debt to Hastur";
          update["externaldice"] = 2;

          update["stress_points"] = 0;
          update["stress_points_max"] = 52;
          update["hero_points"] = 4;
          update["hero_points_max"] = 4;
          
          update["renown"] = 25;
          update["pd"] = 7;
          update["bdv"] = 2;
          update["pdv"] = 2;
          update["wealth"] = "3";
          update["treasure"] = "";

          update["equipment"] = "adidas sneakers, blue hoodie, burner phone";

          setAttrs(update);
          break;
      case "cardinal":
          //TAS.log("Cardinal template used");
          update["character_name"] = "Cardinal";
          update["power_level"] = 3;

          update["archetypetemplate"] = "avenger";

          update["coordination"] = 2;
          update["coordination_pip"] = 0; 
          update["knowledge"] = 3;
          update["knowledge_pip"] = 0; 
          update["perception"] = 4;
          update["perception_pip"] = 0; 
          update["physique"] = 3;
          update["physique_pip"] = 0; 
          update["presence"] = 2;
          update["presence_pip"] = 0; 
          update["reflexes"] = 4;
          update["reflexes_pip"] = 0;

          update["thievery"] = 3;
          update["athletics"] = 4;

          update["power1name"] = "Beast Control";
          update["power1desc"] = "only birds";
          update["power1rank"] = 5;

          update["power2name"] = "Language Comprehension";
          update["power2desc"] = "only birds";
          update["power2rank"] = 5;

          update["advantage1name"] = "";
          update["advantage1"] = "";


          update["personal"] = 3;
          update["internal"] = 1;
          update["external"] = 1;

          update["stress_points"] = 29;

          update["equipment"] = "wings(tool/gear sp5, flight 5), claws(weapon, sp5, bdv6, armor piercing";
          setAttrs(update);
          break;
        default:
          false;
      }
    });
 });
</script>