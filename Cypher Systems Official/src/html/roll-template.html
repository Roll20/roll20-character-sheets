<!-- ROLL TEMPLATES -->
<rolltemplate class="sheet-rolltemplate-cyphsys">
    <div class="rtemplate{{sheetstyle}} {{fontstyle}}">
        <span class="charname">
            [{{charname}}](http://journal.roll20.net/character/{{charid}})
        </span>
        {{#dmgtrack}}
            {{#rollTotal() dmgtrack 1}}
                <span class="failure" data-i18n="impaired">impaired</span>
            {{/rollTotal() dmgtrack 1}}
            {{#rollTotal() dmgtrack 2}}
                <span class="failure" data-i18n="debilitated">debilitated</span>
            {{/rollTotal() dmgtrack 2}}
            {{#rollTotal() dmgtrack 3}}
                <span class="failure" data-i18n="dead">dead</span>
            {{/rollTotal() dmgtrack 3}}
        {{/dmgtrack}}
        <div class="ablock">
            <div class="line padleft">
                <span class="title">{{name}}</span>
            </div>
            <div class="line">
                {{#type}}<span class="undertitle">{{type}}</span>{{/type}}
                {{#statname}}<span class="undertitle">{{statname}}</span>{{/statname}}
            </div>
            {{#d20roll}} <!-- D20 roll -->
                {{#rollGreater() difficulty 0}} <!-- Difficulty set: success of failure -->
                    <div class="inblock">
                        {{#^rollLess() d20roll targnumroll}}
                            <div class="line">
                                <span class="subtitle success" data-i18n="success!">Success!</span>
                            </div>
                        {{/^rollLess() d20roll targnumroll}}
                        {{#rollLess() d20roll targnumroll}}
                            <div class="line">
                                <span class="subtitle failure" data-i18n="failure">Failure</span>
                            </div>
                        {{/rollLess() d20roll targnumroll}}
                    </div>
                    <div class="inblock">
                        <div class="line">
                            <span>
                                <span class="subtitle" data-i18n="difficulty">Difficulty</span>
                                <span class="pseudoroll">{{difficulty}}</span>
                            </span>
                            <span>
                                (<span data-i18n-title="target-number" title="Target Number" data-i18n="target-number-short">TN</span>
                                <span class="pseudoroll">{{targnum}}</span>)
                            </span>
                        </div>
                        {{#skilled}}
                            <div class="line left padleft">
                            {{#rollTotal() skilled -1}}
                                <span data-i18n="inability">Inability</span>
                                <span class="pseudoroll">+ 1</span>
                            {{/rollTotal() skilled -1}}
                            {{#rollTotal() skilled 1}}
                                <span data-i18n="trained">Trained</span>
                                <span class="pseudoroll">- 1</span>
                            {{/rollTotal() skilled 1}}
                            {{#rollTotal() skilled 2}}
                                <span data-i18n="specialized">Specialized</span>
                                <span class="pseudoroll">- 2</span>
                            {{/rollTotal() skilled 2}}
                            </div>
                        {{/skilled}}
                        {{#rollGreater() assets 0}}
                            <div class="line left padleft">
                                <span data-i18n="assets">Assets</span>
                                <span class="pseudoroll">- {{assets}}</span>
                            </div>
                        {{/rollGreater() assets 0}}
                        {{#atkmod}}
                            {{#rollGreater() atkmod 0}}
                                <div class="line left padleft">
                                    <span data-i18n="mod">Mod</span>
                                    <span class="pseudoroll">- {{atkmod}}</span>
                                </div>
                            {{/rollGreater() atkmod 0}}
                        {{/atkmod}}
                        {{#rollGreater() effortroll 0}}
                            <div class="line left padleft">
                                <span data-i18n="effort">Effort</span>
                                <span class="pseudoroll">- {{effortroll}}</span>
                            </div>
                        {{/rollGreater() effortroll 0}}
                        {{#^rollTotal() targnumroll targnum}}
                            <div class="line">
                                <span>
                                    <span class="subtitle"><span data-i18n="final">Final</span> =</span>
                                    <span class="pseudoroll">{{finaldiff}}</span>
                                </span>
                                <span>
                                    (<span data-i18n-title="target-number" title="Target Number" data-i18n="target-number-short">TN</span>
                                    <span class="pseudoroll">{{targnumroll}}</span>)
                                </span>
                            </div>
                        {{/^rollTotal() targnumroll targnum}}
                    </div>
                {{/rollGreater() difficulty 0}} <!-- END Difficulty SET (detailed) -->
                <div class="inblock">
                    <div class="line"> <!-- ACTUAL ROLL -->
                        <span>
                            <span class="subtitle" data-i18n="roll:">Roll:</span>
                            {{d20roll}}
                        </span>
                        <span><span data-i18n="beats-difficulty">Beats difficulty</span>
                        {{#rollLess() d20roll 3}}
                            <span class="pseudoroll">0</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">0</span>)</span>
                        {{/rollLess() d20roll 3}}
                        {{#rollBetween() d20roll 3 5}}
                            <span class="pseudoroll">1</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">3</span>)</span>
                        {{/rollBetween() d20roll 3 5}}
                        {{#rollBetween() d20roll 6 8}}
                            <span class="pseudoroll">2</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">6</span>)</span>
                        {{/rollBetween() d20roll 6 8}}
                        {{#rollBetween() d20roll 9 11}}
                            <span class="pseudoroll">3</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">9</span>)</span>
                        {{/rollBetween() d20roll 9 11}}
                        {{#rollBetween() d20roll 12 14}}
                            <span class="pseudoroll">4</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">12</span>)</span>
                        {{/rollBetween() d20roll 12 14}}
                        {{#rollBetween() d20roll 15 17}}
                            <span class="pseudoroll">5</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">15</span>)</span>
                        {{/rollBetween() d20roll 15 17}}
                        {{#rollBetween() d20roll 18 20}}
                            <span class="pseudoroll">6</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">18</span>)</span>
                        {{/rollBetween() d20roll 18 20}}
                        {{#rollBetween() d20roll 21 23}}
                            <span class="pseudoroll">7</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">21</span>)</span>
                        {{/rollBetween() d20roll 21 23}}
                        {{#rollBetween() d20roll 24 26}}
                            <span class="pseudoroll">8</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">24</span>)</span>
                        {{/rollBetween() d20roll 24 26}}
                        {{#rollBetween() d20roll 27 29}}
                            <span class="pseudoroll">9</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">27</span>)</span>
                        {{/rollBetween() d20roll 27 29}}
                        {{#rollBetween() d20roll 30 32}}
                            <span class="pseudoroll">10</span></span> <span>(<span data-i18n="target-number-short">TN</span> <span class="pseudoroll">30</span>)</span>
                        {{/rollBetween() d20roll 30 32}}
                    </div> <!-- END ACTUAL ROLL -->
                    {{#rollTotal() difficulty 0}} <!-- No difficulty set -->
                        {{#skilled}}
                            <div class="line left padleft">
                            {{#rollTotal() skilled -1}}
                                <span data-i18n="inability">Inability</span>
                                <span class="pseudoroll">+ 1</span>
                            {{/rollTotal() skilled -1}}
                            {{#rollTotal() skilled 1}}
                                <span data-i18n="trained">Trained</span>
                                <span class="pseudoroll">- 1</span>
                            {{/rollTotal() skilled 1}}
                            {{#rollTotal() skilled 2}}
                                <span data-i18n="specialized">Specialized</span>
                                <span class="pseudoroll">- 2</span>
                            {{/rollTotal() skilled 2}}
                            </div>
                        {{/skilled}}
                        {{#rollGreater() assets 0}}
                            <div class="line left padleft">
                                <span data-i18n="assets">Assets</span>
                                <span class="pseudoroll">- {{assets}}</span>
                            </div>
                        {{/rollGreater() assets 0}}
                        {{#atkmod}}
                            {{#rollGreater() atkmod 0}}
                                <div class="line left padleft">
                                    <span data-i18n="mod">Mod</span>
                                    <span class="pseudoroll">- {{atkmod}}</span>
                                </div>
                            {{/rollGreater() atkmod 0}}
                        {{/atkmod}}
                        {{#rollGreater() effortroll 0}}
                            <div class="line left padleft">
                                <span data-i18n="effort">Effort</span>
                                <span class="pseudoroll">- {{effortroll}}</span>
                            </div>
                        {{/rollGreater() effortroll 0}}
                        {{#rollLess() finaldiff 0}}
                            <div class="line">
                                <span class="subtitle">= <span data-i18n="difficulty">Difficulty</span></span>
                                <span class="pseudoroll success">{{finaldiff}}</span>
                                <span data-i18n="steps">Steps</span>
                            </div>
                        {{/rollLess() finaldiff 0}}
                        {{#rollGreater() finaldiff 0}}
                            <div class="line">
                                <span class="subtitle">= <span data-i18n="difficulty">Difficulty</span></span>
                                <span class="pseudoroll failure">+ {{finaldiff}}</span>
                                <span data-i18n="steps">Steps</span>
                            </div>
                        {{/rollGreater() finaldiff 0}}
                    {{/rollTotal() difficulty 0}} <!-- END No difficulty set -->
                </div>
                {{#rollWasCrit() d20roll}} <!-- CRIT -->
                    {{#rollLess() dmgtrack 2}}
                        <div class="inblock">
                            <div class="line">
                                <span class="subtitle success" data-i18n="special:">Special:</span>
                                {{#rollLess() dmgtrack 1}}
                                    {{#rollTotal() d20roll 17}}<span data-i18n="plus-one-damage">+1 damage</span>{{/rollTotal() d20roll 17}}
                                    {{#rollTotal() d20roll 18}}<span data-i18n="plus-two-damage">+2 damage</span>{{/rollTotal() d20roll 18}}
                                    {{#rollTotal() d20roll 19}}<span data-i18n="minor-effect">Minor effect</span>&nbsp;<span data-i18n="or">or</span>&nbsp;<span data-i18n="plus-three-damage">+3 damage</span>{{/rollTotal() d20roll 19}}
                                    {{#rollGreater() d20roll 19}}<span data-i18n="major-effect">Major effect</span>&nbsp;<span data-i18n="or">or</span>&nbsp;<span data-i18n="plus-four-damage">+4 damage</span>{{/rollGreater() d20roll 19}}
                                {{/rollLess() dmgtrack 1}}
                                {{#rollTotal() dmgtrack 1}}<span data-i18n="plus-one-damage">+1 damage</span>{{/rollTotal() dmgtrack 1}}
                            </div>
                        </div>
                    {{/rollLess() dmgtrack 2}}
                {{/rollWasCrit() d20roll}} <!-- CRIT -->
                {{#rollWasFumble() d20roll}} <!-- GM Intrusion -->
                    <div class="inblock">
                        <div class="line">
                            <span class="subtitle failure" data-i18n="gm-intrusion">GM Intrusion</span>
                        </div>
                    </div>
                {{/rollWasFumble() d20roll}} <!-- END GM Intrusion -->
            {{/d20roll}} <!-- END D20 roll -->
            {{#rollGreater() bonusdmg 0}} <!-- DAMAGE -->
                <div class="inblock">
                    <div class="line">
                        <span>
                            <span class="subtitle" data-i18n="damage">Damage</span>
                            <span class="pseudoroll">{{bonusdmg}}</span>
                        </span>
                        <span>
                            ({{effortdmg}} <span data-i18n="effort">effort</span>)
                        </span>
                    </div>
                </div>
            {{/rollGreater() bonusdmg 0}} <!-- END DAMAGE -->
            {{#rollGreater() totalcost 0}} <!-- COST -->
                <div class="inblock">
                    <div class="line">
                        <span class="subtitle" data-i18n="cost">Cost</span>
                        <span>{{effortcost}}+{{statexpense}}-{{attredge}}=</span>
                        <span class="subtitle">{{totalcost}}</span>
                    </div>
                    {{#rollTotal() useapi 1}}
                        <div class="line">
                            [<span data-i18n="apply-cost-api">Apply cost (API)</span>](!cypher-modstat {{charid}}|{{stat}}|{{totalcost}})
                        </div>
                    {{/rollTotal() useapi 1}}
                </div>
            {{/rollGreater() totalcost 0}} <!-- END COST -->
            {{#recoverpoints}} <!-- RECOVERY -->
                <div class="inblock">
                    <div class="line">
                        <span class="subtitle">{{recovery}}</span>
                        <span>{{recoverpoints}} <span data-i18n="points">Points</span></span>
                    </div>
                </div>
                <div class="inblock">
                    <div class="line">
                        <span class="subtitle" data-i18n="rest">rest</span>
                        {{#rollTotal() recovaction 0}}
                            <span data-i18n="1-action">1 action</span>
                        {{/rollTotal() recovaction 0}}
                        {{#rollTotal() recovaction 1}}
                            <span data-i18n="10-mins">10 mins</span>
                        {{/rollTotal() recovaction 1}}
                        {{#rollTotal() recovaction 2}}
                            <span data-i18n="1-hour">1 hour</span>
                        {{/rollTotal() recovaction 2}}
                        {{#rollTotal() recovaction 3}}
                            <span data-i18n="10-hours">10 hours</span>
                        {{/rollTotal() recovaction 3}}
                    </div>
                    <div class="line">
                        <span class="subtitle" data-i18n="next">next</span>
                        {{#rollTotal() recovaction 0}}
                            {{#^rollTotal() useapi 1}}
                                <span data-i18n="10-mins">10 mins</span>
                            {{/^rollTotal() useapi 1}}
                            {{#rollTotal() useapi 1}}
                                [<span data-i18n="10-mins">10 mins</span>](!cypher-modstat {{charid}}|recovery-rolls|1)
                            {{/rollTotal() useapi 1}}
                        {{/rollTotal() recovaction 0}}
                        {{#rollTotal() recovaction 1}}
                            {{#^rollTotal() useapi 1}}
                                <span data-i18n="1-hour">1 hour</span>
                            {{/^rollTotal() useapi 1}}
                            {{#rollTotal() useapi 1}}
                                [<span data-i18n="1-hour">1 hour</span>](!cypher-modstat {{charid}}|recovery-rolls|2)
                            {{/rollTotal() useapi 1}}
                        {{/rollTotal() recovaction 1}}
                        {{#rollTotal() recovaction 2}}
                            {{#^rollTotal() useapi 1}}
                                <span data-i18n="10-hours">10 hours</span>
                            {{/^rollTotal() useapi 1}}
                            {{#rollTotal() useapi 1}}
                                [<span data-i18n="10-hours">10 hours</span>](!cypher-modstat {{charid}}|recovery-rolls|3)
                            {{/rollTotal() useapi 1}}
                        {{/rollTotal() recovaction 2}}
                        {{#rollTotal() recovaction 3}}
                            {{#^rollTotal() useapi 1}}
                                <span data-i18n="1-action">1 action</span>
                            {{/^rollTotal() useapi 1}}
                            {{#rollTotal() useapi 1}}
                                [<span data-i18n="1-action">1 action</span>](!cypher-modstat {{charid}}|recovery-rolls|0)
                            {{/rollTotal() useapi 1}}
                        {{/rollTotal() recovaction 3}}
                    </div>
                </div>
            {{/recoverpoints}} <!-- END RECOVERY -->
            {{#depletionroll}} <!-- ARTIFACT DEPLETION -->
                <div class="inblock">
                    <div class="line">
                        <span class="subtitle" data-i18n="depletion-roll">Depletion roll</span>
                        <span>{{thresholddesc}}</span>
                    </div>
                </div>
                <div class="inblock">
                    <div class="line">
                        <span>
                            <span class="subtitle" data-i18n="roll:">Roll:</span>
                            <span class="pseudoroll">{{depletionroll}}</span>
                        </span>
                        {{#rollGreater() depletionroll threshold}}
                            <span class="subtitle success" data-i18n="not-depleted">Not depleted</span>
                        {{/rollGreater() depletionroll threshold}}
                        {{#rollTotal() depletionroll threshold}}
                            <span class="subtitle failure" data-i18n="last-use!">Last use!</span>
                        {{/rollTotal() depletionroll threshold}}
                        {{#rollLess() depletionroll threshold}}
                            <span class="subtitle failure" data-i18n="last-use!">Last use!</span>
                        {{/rollLess() depletionroll threshold}}
                    </div>
                </div>
            {{/depletionroll}} <!-- END ARTIFACT DEPLETION -->
            {{#description}} <!-- DESCRIPTION -->
                <div class="inblock description">
                    {{#level}}
                        <div>
                            <span style="font-weight: bold;" data-i18n="level">Level</span>
                            {{#rollTotal() level -1}}
                                <span data-i18n="inability">Inability</span>
                            {{/rollTotal() level -1}}
                            {{#rollTotal() level 0}}
                                <span data-i18n="untrained">Untrained</span>
                            {{/rollTotal() level 0}}
                            {{#rollTotal() level 1}}
                                <span data-i18n="trained">Trained</span>
                            {{/rollTotal() level 1}}
                            {{#rollTotal() level 2}}
                                <span data-i18n="specialized">Specialized</span>
                            {{/rollTotal() level 2}}
                        </div>
                    {{/level}}
                    {{description}}
                </div>
            {{/description}} <!-- END DESCRIPTION -->
            {{#used}}
                {{#rollTotal() used 1}}
                    <div class="inblock description" style="text-align: center;">
                        <span class="notable" data-i18n="used">Used</span>
                    </div>
                {{/rollTotal() used 1}}
            {{/used}}
        </div>
    </div>
</rolltemplate>
<!-- END ROLL TEMPLATES -->
