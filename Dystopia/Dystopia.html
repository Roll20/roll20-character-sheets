<!-- Version N# -->
<input type="hidden" name="attr_version" value="0.1">
<!-- AutoCalc fields for sheet worker-->
<input type="hidden" name="attr_Poids_Materiels" value="0" /> <!-- temp charge du materiel -->
<input type="hidden" name="attr_Poids_Butins" value="0" /> <!-- temp charge du butin -->
<input type="hidden" name="attr_Poids_Livres" value="0" /> <!-- temp charge des livres -->
<input type="hidden" name="attr_Poids_Bouffes" value="0" /> <!-- temp charge de la bouffe -->

<!--- night mode --->
<input type="checkbox" class="sheet-hidden sheet-nightMode" name="attr_nightMode" value="1" />
<div class="sheet-wrapper">
	<!--- Header --->
	<div class="sheet-header sheet-row">
		<div class="sheet-col-2">
			Dystopia Logo
		</div>
		<div class="sheet-col-9">
			<div class="sheet-row">
				<div class="sheet-col-2">Nom&nbsp;:</div>
				<div class="sheet-col-4">
					<input type="text" name="attr_Perso_Nom" class="sheet-noBorder">
				</div>
				<div class="sheet-col-2">Niveau&nbsp;:</div>
				<div class="sheet-col-4">
					<input type="text" name="attr_Perso_Niveau" class="sheet-noBorder">
				</div>
			</div>
			<div class="sheet-row">
				<div class="sheet-col-2">Race&nbsp;:</div>
				<div class="sheet-col-4">
					<input type="text" name="attr_Perso_Race" class="sheet-noBorder">
				</div>
				<div class="sheet-col-2">Classe&nbsp;:</div>
				<div class="sheet-col-4">
					<input type="text" name="attr_Perso_Classe" class="sheet-noBorder">
				</div>
			</div>

		</div>
		<div class="sheet-col-1">
			<input type="checkbox" class="sheet-display-pnj" name="attr_tab_pnj" value="1" title="Personnage Non Joueur" /><span class="sheet-display-pnj"></span>
		</div>
	</div>
	<!--- Repeat and hide checkbox from header to do css trick --->
	<input type="checkbox" class="sheet-display-pnj sheet-hidden" name="attr_tab_pnj" value="1" />
	<input type="checkbox" class="sheet-display-reglages sheet-hidden" name="attr_tab_reglages" value="1" />

	<br clear="all" />

	<!--- SHEET PJ --->
	<div class="sheet-body sheet-pj-and-pnj">
		<!--- checkbox disguised in Navigation tabs --->
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_caracteristiques" value="caracteristiques" title="Caractéristiques" checked="checked" /><span class="sheet-tab">Caractéristiques</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_competences" value="competences" title="Compétences" /><span class="sheet-tab">Compétences</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_inventaire" value="inventaire" title="Inventaire" /><span class="sheet-tab">Inventaire</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_bio" value="bio" title="Biographie" /><span class="sheet-tab">Biographie</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_traits" value="traits" title="Traits" /><span class="sheet-tab">Traits</span>
		<br />
		<br />

		<!-- TAB Caractéristiques -->
		<div class="sheet-tab_caracteristiques">
			<div class="sheet-row">
				<div class="sheet-col-12 sheet-stats">
					<h2>Caractéristiques</h2>
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4">Carac</div>
						<div class="sheet-col-2">Base</div>
						<div class="sheet-col-2">Modif</div>
						<div class="sheet-col-2">Temp</div>
						<div class="sheet-col-2">Total</div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">PV</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PV_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PV_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PV_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_PV" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">PM</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PM_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PM_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PM_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_PM" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">PE</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PE_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PE_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_PE_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_PE" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">Dégats de l'arme</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_DA_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_DA_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_DA_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_DA" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">Seuil de défense</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SD_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SD_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SD_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_SD" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">Armure</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_Arm_base" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_Arm_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_Arm_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_Arm" value="0" readonly></div>
					</div>
					
					<div class="sheet-col-12 sheet-stats">
						<div class="sheet-col-4 carac-title">Seuil critique</div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SCrit_base" value="20"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SCrit_mod" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="number" name="attr_Stats_SCrit_temp" value="0"></div>
						<div class="sheet-col-2 carac-title"><input type="text" class="sheet-autoCalc" name="attr_Stats_SCrit" value="0" readonly></div>
					</div>
				</div>
			</div>

		</div>


		<!-- TAB Competence -->
		<div class="sheet-tab_competences">
			<div class="sheet-row">
				<div class="sheet-col-12"  style="height: 200px;">
					<div class="sheet-col-12 sheet-bold">Compétences</div>
					<div class="sheet-col-12">
						<textarea name="attr_competences" style="width:98%;height: 200px;" data-i18n-title="competences-titre" title="Competences du joueur.">
						</textarea>
					</div>
				</div>
			</div>
			<br />
		</div>
		
		<!-- TAB Inventaire -->
		<div class="sheet-tab_inventaire">
			<div class="sheet-row">
				<div class="sheet-col-12"  style="height: 200px;">
					<div class="sheet-col-12 sheet-bold">Inventaire</div>
					<div class="sheet-col-12">
						<textarea name="attr_inventaire" style="width:98%;height: 200px;" data-i18n-title="inventaire-titre" title="Inventaire du joueur.">
						</textarea>
					</div>
				</div>
			</div>
			<br />
		</div>
		
		<!-- TAB Bio -->
		<div class="sheet-tab_bio">
			<div class="sheet-row">
				<div class="sheet-col-12"  style="height: 200px;">
					<div class="sheet-col-12 sheet-bold">Bio</div>
					<div class="sheet-col-12">
						<textarea name="attr_bio" style="width:98%;height: 200px;" data-i18n-title="bio-titre" title="Bio du joueur.">
						</textarea>
					</div>
				</div>
			</div>
			<br />
		</div>
		
		<!-- TAB Traits -->
		<div class="sheet-tab_traits">
			<div class="sheet-row">
				<div class="sheet-col-12"  style="height: 200px;">
					<div class="sheet-col-12 sheet-bold">Traits</div>
					<div class="sheet-col-12">
						<textarea name="attr_traits" style="width:98%;height: 200px;" data-i18n-title="traits-titre" title="Traits du joueur.">
						</textarea>
					</div>
				</div>
			</div>
			<br />
		</div>
	</div>
</div>

<script type="text/worker">
	var modifiablesStats = [ "stats_courage", "stats_intelligence", "stats_charisme", "stats_adresse", "stats_force", "stats_attaque", "stats_parade"];
	/*---------
		EVENTS
	----------*/
	
	on( modifiablesStats.map( stat => `change:${stat}_base change:${stat}_mod change:${stat}_temp` ).join(" "), function(e) {
		updatePrimaryStat( e.sourceAttribute.replace( "_base", "" ).replace( "_mod", "" ).replace( "_temp_total", "" ) );
	});
	
	
	
	/*---------
		FUNCTIONS
	----------*/
	// sum _base + _mod + _temp to set total
	function updatePrimaryStat( attr ) {
		getAttrs( [ `${attr}_base`, `${attr}_mod`, `${attr}_temp` ], function( v ) {
			setAttrs({
				[ `attr` ]: safeInt( v[ attr + "_base" ] ) + safeInt( v[ attr + "_mod" ] ) + safeInt( v[ attr + "_temp" ] )
			});
		});
	}

	/*------------
		FUNCTIONS
	-------------*/
	function safeInt( val ) { return parseInt( val, 10 ) || 0;	}

	function structSafeInt( v ) {
		for( var attr in v ) {
			v[ attr ] = safeInt( v[ attr ] );
		}
		return v;
	}

	function safeFloat( val ) { return parseFloat( val ) || 0;	}

	function structSafeFloat( v ) {
		for( var attr in v ) {
			v[ attr ] = safeFloat( v[ attr ] );
		}
		return v;
	}
</script>