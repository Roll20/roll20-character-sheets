<div class="sheet-BakerStreet">

		
		
		<div class='sheet-2colrow'>
			<div style="width:75%" class="sheet-col">
				<div>	
					<div class="sheet-sectionHdr">Name:</div>
					<input type="text" style="width:333px" class="sheet-text_input"  name="attr_character_name"/>
				</div>	
				<div>	
					<div class="sheet-sectionHdr">Occupation:</div>
					<input type="text" class="sheet-text_input" style="width:278px" name="attr_occupation"/>
				</div>	
				<div>	
					<div class="sheet-sectionHdr">Age:</div>
					<input type="text" class="sheet-text_input" style="width:75px;" name="attr_age"/>
					<div class="sheet-sectionHdr">Class:</div>
					<input type="text" class="sheet-text_input"  name="attr_class"/>				
				</div>	
				<div>	
					<div class="sheet-sectionHdr">Languages:</div>
					<input type="text" class="text_input" style="width:286px" name="attr_languages"/>
				</div>	
				
				
				


			</div>
			<div style="width:20%" class="sheet-col">
				<div style="position: relative;left: -62px;top: 24px;">
					<div style="margin-left:13px;">Experience</div>
					<input type="text" class="text_input" value="0" style="border:1px solid black;font-size: 48pt;width: 82px;text-align: center" name="attr_exp"/>
				</div>
			</div>
		</div>

		<div class="sheet-divider"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/divider.png"></div>
		<br />


		<div class="sheet-sectionHdr">Characteristics:</div>
		
		<div class='sheet-2colrow'>
			<div class="sheet-col">
				<div class="sheet-charHdr">Personal:</div>
				<fieldset class="repeating_persChars">
					<input type="text" class="text_input  sheet-char_input"  name="attr_persChar"/>
				</fieldset>
				<br />
				<div class="sheet-charHdr">Negative:</div>
				<fieldset class="repeating_negChars">
					<input type="text" class="text_input sheet-char_input"  name="attr_negChar"/>
				</fieldset>
				<br />
				
			</div>
			<div class="sheet-col">
				<div class="sheet-charHdr">Professional:</div>
				<fieldset class="repeating_profChars">
					<input type="text" class="text_input sheet-char_input"  name="attr_profChar"/>
				</fieldset>			
			</div>			
		</div>



		<div class="sheet-divider"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/divider.png"></div>
		<br />
		
		<div style="width:98%;text-align:center">
		<span class="sheet-label1" >Untrained Skill Roll: </span><button class="sheet-base-roll" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}} {{name=@{character_name}}} {{skill=Untrained}}{{Roll=[[2d6>@{tohit}cf<0]]}}  {{damage=[[0]]}}  {{prof=0}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}" type="roll"></button>
		<span class="sheet-label1" style="margin-left:20px" >Extra Dice</span><input type="text" value="0" class="text_input rank_input" name="attr_extraDice"  /><button class="sheet-base-roll" type="roll" value="&{template:SkillRoll} {{name=@{character_name}}}  {{damage=[[0]]}}   {{skill=@{extraDice} Extra Dice}}{{Roll=[[@{extraDice}d6>@{tohit}cs>6cf<0]]}} {{prof=0}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"></button>
		</div>
		
		<br />
		<div style="margin-bottom:5px;">
			<span class="sheet-headers">Skills:</span> 
			<span class="sheet-headers" style="margin-left:144px">Prof.:</span>
			<span class="sheet-headers" style="margin-left:1px">Rank:</span>
			<span class="sheet-headers" style="margin-left:1px">Assist:</span>
			<span class="sheet-headers"  style="margin-left:29px">Specialties:</span>	
		</div>
		<fieldset class="repeating_skills">
			<div style="margin-bottom:7px;">
				<input type="text" class="text_input skill_input"  name="attr_skillName"/>
				<!--<input type="checkbox" style="margin-left:7px;margin-right:5px" value="1" name="attr_professional" />	-->
				
				<div class="sheet-check-label"><label><input type="checkbox" name="attr_professional"    value="1" /><span></span> </label></div>			
				
				<input type="text" class="text_input rank_input"  value="3" name="attr_skillRank"/>
				<input type="text" class="text_input rank_input"  title="Assist or Advantage" value="0" name="attr_skillAssist"/>	
				<button class="sheet-base-roll"  type="roll" title="Roll Non-Specialty" value="&{template:SkillRoll}  {{shrlckDie=[[1d6]]}}  {{damage=[[0]]}}   {{name=@{character_name}}} {{skill=@{skillName}}} {{Roll=[[[[@{skillRank}+@{skillAssist}]]d6>@{tohit}cs>6cf<0]]}} {{prof=[[@{professional}]]}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				<input type="text" class="text_input specialty_input"  name="attr_specialty1"/>
				<button class="sheet-base-roll"  type="roll" title="Roll Specialty 1" value="&{template:SkillRoll}  {{shrlckDie=[[1d6]]}}  {{damage=[[0]]}}   {{name=@{character_name}}} {{skill=@{skillName}}} {{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}} {{prof=[[@{professional}]]}}  {{spc=(@{specialty1})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				<input type="text" class="text_input specialty_input"  name="attr_specialty2"/>
				<button class="sheet-base-roll"  type="roll" title="Roll Specialty 2" value="&{template:SkillRoll}  {{shrlckDie=[[1d6]]}} {{damage=[[0]]}}   {{name=@{character_name}}} {{skill=@{skillName}}}{{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}}{{prof=[[@{professional}]]}}  {{spc=(@{specialty2})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				<input type="text" class="text_input specialty_input"  name="attr_specialty3"/>
				<button type="roll" class="sheet-base-roll"  title="Roll Specialty 3" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}}  {{damage=[[0]]}}    {{name=@{character_name}}} {{skill=@{skillName}}}{{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}} {{prof=[[@{professional}]]}}  {{spc=(@{specialty3})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				
			</div>
			<div style="margin-left:322px">
				<input type="text" class="text_input specialty_input"  name="attr_specialty4"/>
				<button class="sheet-base-roll" type="roll" title="Roll Specialty 4" value="&{template:SkillRoll}  {{shrlckDie=[[1d6]]}}  {{damage=[[0]]}}  {{name=@{character_name}}} {{skill=@{skillName}}} {{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}} {{prof=[[@{professional}]]}}  {{spc=(@{specialty4})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				<input type="text" class="text_input specialty_input"  name="attr_specialty5"/>
				<button type="roll" class="sheet-base-roll" title="Roll Specialty 5" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}} {{damage=[[0]]}}  {{name=@{character_name}}} {{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}} {{prof=[[@{professional}]]}}  {{spc=(@{specialty5})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>
				<input type="text" class="text_input specialty_input"  name="attr_specialty6"/>
				<button type="roll" class="sheet-base-roll" title="Roll Specialty 6" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}} {{damage=[[0]]}}  {{name=@{character_name}}} {{Roll=[[(@{skillRank}+@{skillAssist}+2)d6>@{tohit}cs>6cf<0]]}}{{prof=[[@{professional}]]}}  {{spc=(@{specialty6})}} {{health=[[@{health}]]}} {{charmed=[[@{charmed}]]}} {{afraid=[[@{afraid}]]}} {{stunned=[[@{stunned}]]}}"> </button>				
				
			</div>
			<br />
		</fieldset>
		
		<div class="sheet-divider"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/divider.png"></div>
		<br />		
		<div class='sheet-2colrow'>
			<div class="sheet-col">		
				<div class="sheet-sectionHdr">Personal Effects:</div>
				<fieldset class="repeating_presEffects">
					<input type="text" class="text_input sheet-char_input"  name="attr_presEffect"/>
				</fieldset>
				<br />
				<div class="sheet-sectionHdr">Ranged Weapons:</div>
				<fieldset class="repeating_rngWpn">
					<input type="text" class="text_input sheet-char_input"  style="width:309px;" name="attr_weapon"/>
					<input type="text" class="text_input" style="padding-bottom:2px;width:35px;font-size:large;text-align:center"  name="attr_dr"/><button type="roll" class="sheet-base-roll" title="Roll Damage" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}} {{damage=[[1]]}} {{name=@{character_name}}} {{skill=@{weapon} Damage}}{{Roll=[[[[@{dr}]]d6>@{tohit}cs>7cf<0]]}} {{prof=0}}"> </button>
				</fieldset>				
				<br />
				<div class="sheet-sectionHdr">Melee Weapons:</div>					
				<div style="display:inline-block;margin-left:86px;">
							<span>Strength</span>
							<input type="text" class="text_input" style="border:1px solid black;font-size: 24pt;width: 48px;text-align: center" name="attr_strength" readonly value="2"/>
				</div>
				<fieldset class="repeating_meleeWpn">
					<input type="text" class="text_input sheet-char_input"  style="width:309px;" name="attr_weapon"/>
					<input type="text" class="text_input" style="padding-bottom:2px;width:35px;font-size:large;text-align:center"  name="attr_dr"/><button type="roll" class="sheet-base-roll" title="Roll Damage" value="&{template:SkillRoll} {{shrlckDie=[[1d6]]}} {{damage=[[1]]}} {{name=@{character_name}}} {{skill=@{weapon} Damage}}{{Roll=[[[[@{dr}+@{strength}]]d6>@{tohit}cs>7cf<0]]}} {{prof=0}}"> </button>
				</fieldset>				
								
			</div>
			<div class="sheet-col">	
				
				<div>
					
					<div style="display: inline-block;border:1px solid black;padding-right:10px;padding-left:10px;padding-bottom:7px">	
						<div style="display: inline-block;position: relative;top: 4px;">
							<div style="margin-left:-4px;"><button class="new_roll" type="roll" value="&{template:SkillRoll} {{name=@{character_name}}}  {{damage=[[0]]}}   {{skill=Status}}{{Roll=[[@{status}d6>4cs>6cf<0]]}} {{prof=0}}">Status</button></div>
							<input type="text" class="text_input" value="0" style="border:1px solid black;font-size: 24pt;width: 42px;text-align: center" name="attr_status"/>
						</div>	
						<div style="display:inline-block">
							<div class="sheet-checkboxOne">			
								<input type="checkbox" value="1" id="sheet-checkboxOneInput" style="margin-left: 14px;margin-top: 10px;" name="attr_status1" />
								<label for="sheet-checkboxOneInput"></label>	  
							</div>

							<div class="sheet-checkboxTwo">			
								<input type="checkbox" value="1" id="sheet-checkboxTwoInput"  style="margin-left: 14px;margin-top: 10px;" name="attr_status2" />
								<label for="sheet-checkboxTwoInput"></label>	  
							</div>
							

							<div class="sheet-checkboxThree">			
								<input type="checkbox" value="1" id="sheet-checkboxThreeInput" style="margin-left: 14px;margin-top: 10px;" name="attr_status3" />
								<label for="sheet-checkboxThreeInput"></label>	  
							</div>

							<div class="sheet-checkboxFour">			
								<input type="checkbox" value="1" id="sheet-checkboxFourInput"  style="margin-left: 14px;margin-top: 10px;" name="attr_status4" />
								<label for="sheet-checkboxFourInput"></label>	  
							</div>
								 <div class="sheet-checkboxFive">
								<input type="checkbox" value="1" id="sheet-checkboxFiveInput"  style="margin-left: 14px;margin-top: 10px;" name="attr_status5" />
								<label for="sheet-checkboxFiveInput"></label>
							</div>
						</div>
					</div>
					<div style="display:inline-block;margin-left:10px;position: relative;top: 10px;">
							<div style="margin-left:3px;">Resolve</div>
							<input type="text" class="text_input" style="border:1px solid black;font-size: 24pt;width: 48px;text-align: center" name="attr_resolve" value="0"/>
					</div>
				</div>
				<br />

				<div>
					<table>
						<tr>
							<th colspan="2"><span class="sheet-headers">Health:</span></th>
							<th><span class="sheet-headers">Healing Check:</span></th>
							<th><span class="sheet-headers">Action:</span></th>					
						</tr>
						<tbody>
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" checked name="attr_health" value="1"><span></span></label></div></td>	
								<td>Fine</td>
								<td style="text-align:center">-</td>
								<td style="text-align:center">N/A</td>
							</tr>
						</tbody>
							<tr>
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="2"><span></span></label></div></td>	
								<td>Nicked</td>
								<td style="text-align:center">2</td>
								<td style="text-align:center">Complex</td>
							</tr>
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="3"><span></span></label></div></td>	
								<td>Grazed</td>
								<td style="text-align:center">3</td>
								<td style="text-align:center">Complex</td>
							</tr>						
							<tr>
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="4"><span></span></label></div></td>	
								<td>Battered</td>
								<td style="text-align:center">4</td>
								<td style="text-align:center">Complex</td>
							</tr>
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="5"><span></span></label></div></td>	
								<td>Injured</td>
								<td style="text-align:center">5</td>
								<td style="text-align:center">Complex</td>
							</tr>			
							<tr>
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="6"><span></span></label></div></td>	
								<td>Wounded</td>
								<td style="text-align:center">4</td>
								<td style="text-align:center">Surgical Scene</td>
							</tr>			
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="7"><span></span></label></div></td>	
								<td>Badly wounded</td>
								<td style="text-align:center">5</td>
								<td style="text-align:center">Surgical Scene</td>
							</tr>			
							<tr>
								<td><div class="sheet-check-health-level"><label class="sheet-fixbox"><input type="radio" name="attr_health" value="8"><span></span></label></div></td>	
								<td>Seriously Wounded</td>
								<td style="text-align:center">6</td>
								<td style="text-align:center">Surgical Scene</td>
							</tr>			
				</table>
					<br />	
				<!--conditions-->
				<table>
						<tr>
							<th></th>
							<th><span class="sheet-headers">Condition:</span></th>
							<th><span class="sheet-headers">Effect:</span></th>
						</tr>
						
						<tbody>
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-label"><label><input type="checkbox" name="attr_charmed"    value="1" /><span></span> </label></div></td>	
								<td>Charmed</td>
								<td style="text-align:center">5's fail against Charming character</td>
							</tr>
							<tr style="">
								<td><div class="sheet-check-label"><label><input type="checkbox" name="attr_afraid"    value="1" /><span></span> </label></div></td>	
								<td>Fear</td>
								<td style="text-align:center">5's fail when resisting source of fear</td>
							</tr>
							<tr style="background-color:#f4d19d;">
								<td><div class="sheet-check-label"><label><input type="checkbox" name="attr_stunned"    value="1" /><span></span> </label></div></td>	
								<td>Stunned</td>
								<td style="text-align:center">4's do not count</td>
							</tr>						
						</tbody>
				</table>							
								
					<input type="text" style="display:none" name="attr_health" />
					<input type="number"   style="display:none" name="attr_tohit" value="4" />
				</div>
					
			
			</div>			
		</div>	
</div>
<script type="text/worker">

	on("change:health", function() {
	   getAttrs(["health"], function(values) {
			var health = parseInt(values.health);
			console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!health "+health);
			var mintoHit = 4;
			if (health > 4){
				mintoHit = 5;
			}			
			console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!mintohit "+health);
			setAttrs({tohit:mintoHit});	
		 
	   });
	});
	
		function findSkill(section,skill,stat){
			 getSectionIDs(section, function(idArray) {
				
				var found = false;
				if (idArray.length > 0) {
					var fields = [];
					_.each(idArray, function(currentID) {
						fields.push(section+"_" + currentID + "_skillName");
						fields.push(section+"_" + currentID + "_skillRank");
					});
					getAttrs(fields, function(values) {
						var update = {};
						_.each(idArray, function(currentID, i) {
							var curSkill = values[section+"_" + idArray[i] + "_skillName"];
							var curRank= parseInt(values[section+"_" + idArray[i] + "_skillRank"]);
							if (curSkill === skill){
								update[section+"_"+idArray[i]+"_skillRank"] =  parseInt(curRank);
								found = true;
							}
						});
						if (found) {
							setAttrs(update);
						} else {
							setAttrs({Strength:2});
						}
					});
				}
			});
		}	
	
	
	on("remove:repeating_skills", function(eventinfo){
	
			console.log("!!!!!! stuff removed "+JSON.stringify(eventinfo.removedInfo));
			var skill = Object.values(eventinfo.removedInfo)[0];
			skill = skill.toLowerCase();
			skill = skill.trim();			
			if (skill === "strength"){
					setAttrs({Strength:2});							
			}	
	});
	
	
			on("change:repeating_skills:skillName change:repeating_skills:skillRank", function() {
			   getAttrs(["repeating_skills_skillName","repeating_skills_skillRank"], function(values) {
					console.log(JSON.stringify(values));
					var skill = values.repeating_skills_skillName;
					skill = skill.toLowerCase();
					skill = skill.trim();
					console.log("!!!!!!!!!!!!! skill "+skill);
					if (skill === "strength"){
						var rank = parseInt(values.repeating_skills_skillRank);
						setAttrs({Strength:rank});							
					}
				 
			   });
			});		



	
</script>

<rolltemplate class="sheet-rolltemplate-SkillRoll">
<div style="background-color:#d9ba8c;">
	<div style="padding:5px;background-color:#350000;margin-bottom:10px;">
		<div style="color:white;font-size:large;margin-bottom:10px;">{{name}}</div>
		<div style="color:white;font-size:large;">Rolls {{skill}}</div>
		<div style="color:white;text-align:center;font-size:large;">{{spc}}</div>			
			<div style="color:red">
			{{#rollTotal() health 5}}	
				Injured  
			{{/rollTotal() health 5}}						
			{{#rollTotal() health 6}}	
				Wounded
			{{/rollTotal() health 6}}						
			{{#rollTotal() health 7}}	
				Bd. Wounded
			{{/rollTotal() health 7}}						
			{{#rollTotal() health 8}}	
				Sr. Wounded
			{{/rollTotal() health 8}}						
			{{#rollTotal() charmed 1}}	
				Charmed 
			{{/rollTotal() charmed 1}}	
			{{#rollTotal() afraid 1}}	
				Afraid 
			{{/rollTotal() afraid 1}}	
			{{#rollTotal() stunned 1}}	
				Stunned  
			{{/rollTotal() stunned 1}}	
			</div>
		
	</div>
	<div style="padding:10px;background-color:#d9ba8c;">
		{{#rollTotal() Roll 1}}	
			<div style="text-align:center;font-size:22pt;margin-bottom:10px;">{{Roll}} Success</div>

		{{/rollTotal() Roll 1}}	

		{{#^rollTotal() Roll 1}}	
			<div style="text-align:center;font-size:22pt;margin-bottom:10px;">{{Roll}} Successes</div>
		{{/^rollTotal() Roll 1}}	
		{{#rollWasCrit() Roll}}
			{{#rollTotal() prof 1}}	
				<br />
				<div style="text-align:center">addtional roll(s)</div>
			{{/rollTotal() prof 1}}		
		{{/rollWasCrit() Roll}}
		
		<br />
		<div>
			{{#rollTotal() shrlckDie 1}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/1.png"></div>
				<div> 1's are successes</div>
			{{/rollTotal() shrlckDie 1}}		
			{{#rollTotal() shrlckDie 2}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/2.png"></div>
				<div> 2's are successes</div>
			{{/rollTotal() shrlckDie 2}}		
			{{#rollTotal() shrlckDie 3}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/3.png"></div>
				<div> 3's are successes</div>
			{{/rollTotal() shrlckDie 3}}			
			{{#rollTotal() shrlckDie 4}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/holmes.png"></div>
				<div>Choose 1's, 2's or 3's as successes</div>
			{{/rollTotal() shrlckDie 4}}			
			{{#rollTotal() shrlckDie 5}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/watson.png"></div>
				{{#rollTotal() damage 0}}
					<div>Plus 1 success or free action Assist</div>
				{{/rollTotal() damage 0}}
				{{#rollTotal() damage 1}}
					<div>Plus 1 success</div>
				{{/rollTotal() damage 1}}
				
				
				
			{{/rollTotal() shrlckDie 5}}			
			{{#rollTotal() shrlckDie 6}}	
				<div><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/BakerStreet/moriarty.png"></div>
				<div>Each fail removes 1 success</div>
			{{/rollTotal() shrlckDie 6}}

			
		</div>	
	</div>
</div>
</rolltemplate>




