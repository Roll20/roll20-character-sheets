
<script type="text/worker">
  //# sourceURL=SWADE.js
const sheetVersionPrefix = 'Official Savage Worlds v';
const sheetVersion = '1.00.31';

// Define colors for Logs
const r20color = '#E948C9';
const buttonClick = 'goldenrod';
const sheetinit = 'lime';
const deltaColor = 'darkgoldenrod';
const derivedStatsColor = 'Salmon';

// Common Variables
const skillnamelist = [
  'fighting',
  'academics',
  'athletics',
  'battle',
  'boating',
  'commonknowledge',
  'driving',
  'electronics',
  'faith',
  'focus',
  'gambling',
  'hacking',
  'healing',
  'intimidation',
  'native-language',
  'notice',
  'occult',
  'performance',
  'persuasion',
  'piloting',
  'psionics',
  'repair',
  'research',
  'riding',
  'science',
  'shooting',
  'spellcasting',
  'stealth',
  'survival',
  'taunt',
  'thievery',
  'trade',
  'weirdscience',
];

const traits = [
  'agility',
  'smarts',
  'spirit',
  'strength',
  'vigor',
  'fighting',
  'academics',
  'athletics',
  'battle',
  'boating',
  'commonknowledge',
  'driving',
  'electronics',
  'faith',
  'focus',
  'gambling',
  'hacking',
  'healing',
  'intimidation',
  'language',
  'notice',
  'occult',
  'performance',
  'persuasion',
  'piloting',
  'psionics',
  'repair',
  'research',
  'riding',
  'science',
  'shooting',
  'spellcasting',
  'stealth',
  'survival',
  'taunt',
  'thievery',
  'trade',
  'weirdscience',
  'repeating_skills:knowledgeother',
  'pastrength',
  'rastrength',
];

// Better Logging Functionality
const log = (
  title,
  text,
  color = 'green',
  headerstyle = 'font-size:14px; font-weight:bold;',
  bodystyle = 'font-size:12px; font-weight:normal;'
) => {
  let titleStyle = `color:${color}; ${headerstyle} text-decoration:underline;`;
  let textStyle = `color:${color}; ${bodystyle}`;
  const output = `%c${title}:%c ${text}`;
  console.log(output, titleStyle, textStyle);
};

const debug = function (msg, force) {
  if (typeof msg === 'string') {
    console.log(`%cSWADE DEBUG| ${msg}`, 'background-color:tan;color:red;');
  } else if (typeof msg === 'object') {
    Object.keys(msg).forEach(m => {
      if (typeof msg[m] === 'string') {
        console.log(
          `%cSWADE DEBUG| ${m}: ${msg[m]}`,
          'background-color:tan;color:red;'
        );
      } else {
        console.log(
          `%cSWADE DEBUG| ${typeof msg[m]} ${m}`,
          'background-color:tan;color:red;font-weight:bold;'
        );
        console.table(msg[m]);
      }
    });
  }
};

// Simple Sum function for Repeating Sections
function repeatingSimpleSum(section, field, destination) {
  var repSection = 'repeating_' + section;
  log('repeatingSimpleSum', 'Made it here', 'darkorange');
  getSectionIDs(repSection, function (idArray) {
    //Construct Array of fields to get attributes for...
    var sumFields = [];
    for (var a = 0; a < idArray.length; a++) {
      sumFields[sumFields.length] = repSection + '_' + idArray[a] + '_' + field;
    }
    getAttrs(sumFields, function (v) {
      //console.log("%%% values of v: " + JSON.stringify(v) + " %%%");
      var sumTotal = 0;
      for (a = 0; a < idArray.length; a++) {
        sumTotal += parseFloat(v[sumFields[a]]) || 0;
        //console.log("$$$ sumTotal: " + sumTotal + " $$$");
      }
      var setSumValue = {};
      setSumValue[destination] = sumTotal;
      log('setting the sum', sumTotal, 'darkorange');
      setAttrs(setSumValue);
    });
  });
  //return sumTotal;
}

// Simple Sum function for Repeating Sections with Check Field
function repeatingSimpleSumWCheck(
  section,
  field,
  destination,
  checkfield,
  checkvalue
) {
  //console.log("Made it repeatingSimpleSumWCheck");
  //console.log("checkvalue: " + checkvalue);
  let repSection = 'repeating_' + section;
  getSectionIDs(repSection, function (idArray) {
    //Construct Array of fields to get attributes for...
    let sumFields = [];
    let checkFields = [];
    for (let a = 0; a < idArray.length; a++) {
      sumFields[sumFields.length] = repSection + '_' + idArray[a] + '_' + field;
      checkFields[checkFields.length] =
        repSection + '_' + idArray[a] + '_' + checkfield;
    }
    //console.log("List of IDs: " + idArray);
    //console.log("List of Sum Fields: " + sumFields);
    //console.log("List of check Fields: " + checkFields);
    getAttrs(sumFields, function (v) {
      getAttrs(checkFields, function (c) {
        /*console.log(
                    "%%% values of v: " + JSON.stringify(v) + " %%%"
                );*/
        var sumTotal = 0;
        for (a = 0; a < idArray.length; a++) {
          if (c[checkFields[a]] === checkvalue) {
            sumTotal += parseFloat(v[sumFields[a]]) || 0;
            //console.log("$$$ sumTotal: " + sumTotal + " $$$");
          }
        }
        var setSumValue = {};
        setSumValue[destination] = sumTotal;
        setAttrs(setSumValue);
      });
    });
  });
}

function fauxChange(field, fauxvalue) {
  //repeating  fields should be passed in the format: repeating_<section>:attributes
  //example: repeating_skills:skillnamerank
  log('FauxChange Reached: Field', field, r20color);
  log('Setting faux value(s) for', field, 'orangered');
  if (field.indexOf(':') > -1) {
    log('fauxChange', 'repeating section', '#CCCCFF');
    //console.log("Need to update values in a repeating section");
    let getfields = field.split(':');
    let repeatingSection = getfields[0];
    let repeatingField = getfields[1];
    let sattrs = {};
    getSectionIDs(repeatingSection, function (idArray) {
      if (idArray.length > 0) {
        log('IDs in Repeating Section', idArray, 'orangeread');
        let oldValues = [];
        let fieldArray = [];
        for (let a = 0; a < idArray.length; a++) {
          fieldArray[fieldArray.length] =
            repeatingSection + '_' + idArray[a] + '_' + repeatingField;
          log('Added field', fieldArray[a], 'orangered');
        }
        getAttrs(fieldArray, function (v) {
          for (let b = 0; b < idArray.length; b++) {
            oldValues[oldValues.length] = v[fieldArray[b]];
            log(`Setting Faux Value (${fieldArray[b]})`, fauxvalue, r20color);
            sattrs[fieldArray[b]] = fauxvalue;
          }
          log('Step', '!!! Setting Fake Value !!!', 'orangered');
          setAttrs(sattrs, null, () => {
            for (let c = 0; c < idArray.length; c++) {
              log(
                'Added Field',
                fieldArray[c] + ' = ' + oldValues[c],
                'orangered'
              );
              log(
                `Setting Previous Value (${fieldArray[c]})`,
                oldValues[c],
                r20color
              );
              sattrs[fieldArray[c]] = oldValues[c];
            }
            log('Step', '!!! Setting Real Values !!!', 'orangered');
            setAttrs(sattrs);
          });
        });
      }
    });
  } else {
    //console.log("Updating values in a Non-Repeating Section");
    log('fauxChange', 'Not Repeating Section', '#CCCCFF');
    getAttrs([field], function (v) {
      let prevValue = v[field];
      let sattrs = {};
      //console.log(`++++ Setting ${field} to ${fauxvalue} ++++`);
      //console.log("Setting " + field + " to " + fauxvalue);
      sattrs[field] = fauxvalue;
      log(`Setting Faux Value (${field})`, fauxvalue, r20color);
      setAttrs(sattrs, null, () => {
        sattrs[field] = prevValue;
        log(`Setting Previous Value (${field})`, prevValue, r20color);
        setAttrs(sattrs);
      });
    });
  }
}

//Force a change in a field to trigger a sheet worker and then reset the <fieldset>
//This may be needed when an existing field is modified that's used in a roll button (e.g. Trademark Weapon modified how the skill formula is called, resulting in each we)
const stepwiseFaux = function (section, field) {
  //only for repeating Sections
  //section = the repeating section
  //field = the field within the section to fauxily change
  //example call: stepwiseFaux("weapons","dmgbonusnum");
  //will do a faux change during each for loop
  log('stepWiseFaux', 'Entered this thing', '#CCCCFF');
  let repeatingSection = `repeating_${section}`;
  getSectionIDs(repeatingSection, function (idArray) {
    if (idArray.length > 0) {
      for (let a = 0; a < idArray.length; a++) {
        let fullField = `repeating_${section}_${idArray[a]}_${field}`;
        //("Stepwise Faux for: " + fullField);
        fauxChange(fullField, '1000');
      }
    }
  });
};

const swapAttribute = function (section, oldField, newField, silent) {
  //oldField and newField can be strings of single fields or arrays of multiple fields
  //silent should be a boolean true/false and indicates whether the setAttrs should be set silently
  log('Section', section, 'orange');
  log('oldField', oldField, 'orange');
  log('newField', newField, 'orange');
  let repeatingSection = `repeating_${section}`;
  let outputOBj = {};
  let fieldList = [];
  let sectionList = [];
  let newFieldList = [];
  //build list of fields to get the value of the field
  getSectionIDs(repeatingSection, function (idArray) {
    log(`Number of Rows in ${repeatingSection}`, idArray.length, 'orange');
    if (idArray.length > 0) {
      log('idArray', 'Not Empty, made it to the If Statement', 'orange');
      for (let a = 0; a < idArray.length; a++) {
        log('Loop Count', a, 'orange');
        let fullField;
        if (typeof oldField === 'string') {
          fullField = `${repeatingSection}_${idArray[a]}_${oldField}`;
          fieldList.push(fullField);
          sectionList.push(idArray[a]);
        } else {
          for (let b = 0; b < oldField.length; b++) {
            fullField = `${repeatingSection}_${idArray[a]}_${oldField[b]}`;
            fieldList.push(fullField);
            newFieldList.push(
              `${repeatingSection}_${idArray[a]}_${newField[b]}`
            );
            //sectionList.push(idArray[a]);
          }
        }
      }
    } else {
      log(
        `${repeatingSection} empty`,
        'Nothing to see here...move along.',
        'orange'
      );
    }
    //get the values of the "old" field
    log('Field List', fieldList, 'orange');
    getAttrs(fieldList, function (v) {
      for (let b = 0; b < fieldList.length; b++) {
        log('getAttrs Loop', b, 'orange');
        let fieldValue = v[fieldList[b]];
        log('Field Value', fieldValue, 'orange');
        log('Value Type', typeof fieldValue, 'orange');
        typeof fieldValue === 'undefined'
          ? (fieldValue = '0')
          : (fieldValue = fieldValue);
        /*output[
                    `${repeatingSection}_${sectionList[b]}_${newField}`
                ] = fieldValue;*/
        outputOBj[`${newFieldList[b]}`] = fieldValue;
      }
      log('Output', JSON.stringify(outputOBj), 'orange');

      //return outputOBj;

      if (silent) {
        log('Set Silently', 'Setting the values silently', 'orange');
        setAttrs(outputOBj, { silent: true });
      } else {
        log('Set Silently', 'NOT Setting the values silently', 'orange');
        setAttrs(outputOBj);
      }
    });
  });
};

const repeatingCount = function (repSection, countField) {
  const repeatingSection = `repeating_${repSection}`;
  let repCount = 0;
  getSectionIDs(repeatingSection, function (idArray) {
    log('repeatingCount Function', 'function called', r20color);
    log('idArray', idArray, r20color);
    repCount = idArray.length;
    const setCount = {};
    setCount[`${countField}`] = repCount;
    setAttrs(setCount);
  });
};

//Manage Background Image
const updateBackgroundImage = function (backgroundSelection) {
  let imageURL = '';
  getAttrs(['background', 'backgroundurl'], function (bgSelection) {
    switch (bgSelection.background) {
      case '1':
        imageURL =
          'https://raw.githubusercontent.com/finderski/SWT/master/Parchement_Background2.jpg';
        break;
      case '2':
        imageURL =
          'https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/backgrounds/swade-parchment-seamless.jpg';
        break;
      case '3':
        imageURL =
          'https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/backgrounds/r20-rifts-hex-pattern.png';
        break;
      case '4':
        imageURL = bgSelection.backgroundurl;
        break;
      default:
        imageURL = '';
    }
    setAttrs({
      backgroundImage: imageURL,
    });
  });
};

const calcWoundsRemaining = function () {
  getAttrs(['wounds_max', 'wounds'], function (v) {
    let maxWounds = parseInt(v.wounds_max) || 0;
    let totalWounds = parseInt(v.wounds) || 0;
    let remainingWounds = maxWounds - totalWounds;
    setAttrs({ woundsRemaining: remainingWounds });
  });
};

/* ---- Begin Sheet Version Validation & Update ---- */
const upgradeSheet = function (
  version,
  versionone,
  versiontwo,
  versionthree,
  characterName
) {
  //version format 1.00.01 (string)
  //versione format 1 (int)
  //versiontwo format 1 or 1.01 (float)
  //versionthree format 0.01 (float)
  log('Upgrade', 'Made to the upgrade path', 'Lime');
  log('Version Number', versionthree, 'lime');
  let setattrvals = {};
  let setSheetVersion = sheetVersionPrefix + sheetVersion;
  log('shetSheetVersion', setSheetVersion, 'lime');
  setattrvals['character_sheet'] = setSheetVersion;
  getAttrs(['character_sheet', 'initializeStatblock', 'wci'], function (v) {
    if (v.wci === '') {
      setattrvals['WCI'] = '✪';
    }
    //upgrade stuff goes here...
    if (versionthree < 0.03) {
      log('Version out of date', versionthree, 'lime');
      //make sure Fighting is still unhidden for existing sheets
      setattrvals['staticFighting'] = 'on';
    }
    if (versionthree < 0.04) {
      log('Upgrade Progress', 'Upgrading to version 1.00.05', 'pink');
      //setattrvals["newcontent"] = "unread";
      // setattrvals["newdocumentation"] = "unread";
    }
    if (versionthree < 0.05) {
      log('Upgrade Progress', 'Upgrading to version 1.00.05', 'pink');
    }
    if (versionthree < 0.06) {
      log('Upgrade Progress', 'Upgrading to version 1.00.06', 'cyan');
      stepwiseFaux('weapons', 'weaponAttackBonus');
    }
    if (versionthree < 0.07) {
      log('Upgrade Progress', 'Upgrding to version 1.00.07', 'goldenrod');
      stepwiseFaux('spells', 'spellbutton');
      //setattrvals["newcontent"] = "unread";
      // setattrvals["newdocumentation"] = "unread";
    }
    if (versionthree < 0.08) {
      //Start using a better field name...need to swap out the old field value into the new field...
      swapAttribute('weapons', 'minstrength', 'weaponminstrength');
      swapAttribute('armor', 'minstrength', 'armorminstrength');
      //Jiggle the buttons...
      fauxChange('repeating_weapons:weaponbutton', '3');
      fauxChange('repeating_spells:spellbutton', '3');
      //Make sure Bonus Damage Dice works for everyone (including those who may have unchecked variable bonus damage)
      fauxChange('RaiseHBRule', '3');
      setattrvals['newcontent'] = 'unread';
      setattrvals['newdocumentation'] = 'unread';
    }
    if (versionthree < 0.1) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.11) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.12) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.13) {
      setattrvals['newcontent'] = 'unread';
      setattrvals['newdocumentation'] = 'unread';
    }
    if (versionthree < 0.16) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.17) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.18) {
      //Get Old Knowledge Skills
      swapAttribute(
        'skills',
        [
          'skillnamerank_base',
          'skillnamerankmod_base',
          'skillnamerank_delta',
          'skillnamerank',
          'skillnamerankmod',
          'otherModType',
          'SkillMod',
          'linkedotherattscore',
          'whisperskillname',
          'skillnamewilddie',
          'skillnamewilddieinfo',
          'skillnamerank_rank',
          'skillnamerank_display',
        ],
        [
          'knowledgeother_base',
          'knowledgeothermod_base',
          'knowledgeother_delta',
          'knowledgeother',
          'knowledgeothermod',
          'knowledgeotherModType',
          'KnowledgeotherskillMod',
          'linkedknowledgeotheratt',
          'whisperknowledgeother',
          'knowledgeotherwilddie',
          'knowledgeotherwilddieinfo',
          'knowledgeother_rank',
          'knowledgeother_display',
        ],
        true
      );

      //Fix Weapon Skill Rolls
      stepwiseFaux('weapons', 'weaponskill');
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.19) {
      stepwiseFaux('spells', 'spellskill');
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.2) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.21) {
      setattrvals['pastrengthname'] = getTranslationByKey('pastrengthname');
      setattrvals['rastrengthname'] = getTranslationByKey('rastrengthname');
      // Will want to faux swap HBRaiseRule so the multiple dice bonus stuff works
      fauxChange('RaiseHBRule', '3');
      setattrvals['newcontent'] = 'unread';
      setattrvals['newdocumentation'] = 'unread';
    }
    if (versionthree < 0.22) {
      // Will want to faux swap HBRaiseRule so the multiple dice bonus stuff works for spells
      fauxChange('RaiseHBRule', '3');
      setattrvals['newcontent'] = 'unread';
      setattrvals['newdocumentation'] = 'unread';
    }
    if (versionthree < 0.23) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.24) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.25) {
      stepwiseFaux('weapons', 'weaponskill');
      stepwiseFaux('spells', 'spellskill');
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.26) {
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.27) {
      const nameList = [
        'faith',
        'focus',
        'performance',
        'psionics',
        'spellcasting',
      ];
      nameList.forEach(skillName => {
        fauxChange(`${skillName}name`, `${skillName}_old`);
      });
      setattrvals['newcontent'] = 'unread';
      setattrvals['newdocumentation'] = 'unread';
    }
    if (versionthree < 0.28) {
      log('Sheet Version', 'Upgrading to version 0.0.28', '#CCCCFF');
      fauxChange(`repeating_weapons:weaponskill`, 'fakeWeapon');
      //stepwiseFaux("weapons", "weaponbutton");
      setattrvals['newcontent'] = 'unread';
    } else {
      log('Upgrade', `Sheet already updgraded (${characterName})`, 'lime');
    }
    if (versionthree < 0.29) {
      updateBackgroundImage();
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.3) {
      log('Sheet Version', 'Upgrading to version 0.0.30', '#CCCCFF');
      fauxChange(`repeating_weapons:weaponskill`, 'fighting');
      setattrvals['newcontent'] = 'unread';
    }
    if (versionthree < 0.31) {
      log('Sheet Version', 'Upgrading to version 0.0.31', '#CCCCFF');
      setattrvals['newcontent'] = 'unread';
    }
    setAttrs(setattrvals);
    //setAttrs(setattrvals, { silent: true });
  });
};

// Stuff to do when the sheet is opened...

// Adjust CSS for long Character Names
on(
  'sheet:opened change:character_name change:character_avatar change:character_token change:show_token',
  function () {
    log('Name Change', 'Name was changed', r20color);
    let setValues = {};
    getAttrs(
      ['character_name', 'character_avatar', 'character_token'],
      function (v) {
        let name = v.character_name;
        let namelen = name.length;
        log('Name Size', namelen, r20color);
        let nameclass;
        namelen >= 19
          ? (nameclass = 'smallHeader')
          : (nameclass = 'normalHeader');
        log('Name Class', nameclass, r20color);
        setValues['namelength'] = nameclass;
        let avatarURL = v.character_avatar;
        let tokenURL = v.character_token;
        setValues['avatar'] = avatarURL;
        setValues['ctoken'] = tokenURL;
        if (avatarURL.length < 1 && tokenURL.length < 1) {
          //Avatar and Token is empty, so make sure show_token is set to 0
          setValues['show_token'] = '0';
        } else if (tokenURL.length > 0) {
          tokenURL.substring(tokenURL.length - 4, tokenURL.length - 3) !== '.'
            ? (tokenURL += '.png')
            : log('URL Has Extension', tokenURL, r20color);
          //use the token image for the rolltemplate
          setValues['roll_template_token'] = '{{token=[x](' + tokenURL + ')}}';
        } else {
          avatarURL.substring(avatarURL.length - 4, avatarURL.length - 3) !==
          '.'
            ? (avatarURL += '.png')
            : log('URL Has Extension', avatarURL, r20color);
          setValues['roll_template_token'] = '{{token=[x](' + avatarURL + ')}}';
        }
        /*setAttrs({
          namelength: nameclass,
          avatar: v.character_avatar,
          ctoken: v.character_token,
          roll_template_token: '{{token=[x](' + v.character_token + '.png)}}',
        });*/
        setAttrs(setValues);
      }
    );
  }
);

on('sheet:opened', function () {
  getAttrs(
    [
      'character_name',
      'character_sheet',
      'initializeStatblock',
      'wci',
      'knowledgeotherbuttonName',
    ],
    function (v) {
      // v[character_sheet] will contain the current sheet version to know if an upgrade is necessary
      let setattrvals = {};
      let characterName = v.character_name;
      if (v.wci === '') {
        setattrvals['WCI'] = '✪';
      }
      log('Character Sheet', v.character_sheet, 'lime');
      let charsheetName = v.character_sheet.substring(0, 22);
      log('Sheet Name', charsheetName, 'lime');
      let charsheetVersion = v.character_sheet.substring(24);
      log('Character Sheet Version', charsheetVersion, 'lime');
      charsheetName === 'Official Savage Worlds'
        ? log('Sheet Type', 'Official', 'lime')
        : (charsheetVersion = '1.00.00');
      let versionParts = charsheetVersion.split('.');
      log(
        'Version before Upgrade',
        parseFloat(
          parseFloat(versionParts[1]) + '.' + parseFloat(versionParts[2])
        ) + ` (${characterName})`,
        'lime'
      );
      //version format 1.00.01 (string)
      //versione format 1 (int)
      //versiontwo format 1 or 1.01 (float)
      //versionthree format 0.01 (float)
      let version = charsheetVersion;
      let versionone = parseInt(versionParts[0]);
      let versiontwo = parseFloat(versionParts[0] + '.' + versionParts[1]);
      let versionthree = parseFloat(versionParts[1] + '.' + versionParts[2]);
      log('Version Parts', versionParts, 'lime');
      log('Version', version, 'lime');
      log('Version One', versionone, 'lime');
      log('versiontwo', versiontwo, 'lime');
      log('Version Three', versionthree, 'lime');
      upgradeSheet(
        version,
        versionone,
        versiontwo,
        versionthree,
        characterName
      );
    }
  );
});
/* ---- End Sheet Version Validation & Update ---- */

// Make sure skills have names
log('Skill names', 'Make sure Skill Names have been set', sheetinit);
let newSkillList = skillnamelist;
newSkillList.push('race');
newSkillList.forEach(skillname => {
  on('sheet:opened', function () {
    getAttrs([`${skillname}name`], function (skillv) {
      log('Checking Skill Name', skillname, 'goldenrod');
      //console.debug("Skill name: " + skillv[`${skillname}`]);
      if (skillv[`${skillname}name`] === '') {
        log('Filling Skill Name', skillname, 'darkgoldenrod');
        let value = getTranslationByKey(`${skillname}`);
        let setskill = {};
        log(skillname, value, 'darkgoldenrod');
        setskill[`${skillname}name`] = value;
        setAttrs(setskill);
      }
    });
  });
});

const moneylist = ['money', 'gold', 'silver', 'electrum', 'copper'];
const moneylabels = [
  'money',
  'moneyone',
  'moneytwo',
  'moneythree',
  'moneyfour',
];
moneylabels.forEach(moneyLabel => {
  on('sheet:opened', function () {
    log('Money', 'Setting up money', 'darkgreen');
    getAttrs([`${moneyLabel}name`], function (v) {
      if (v[`${moneyLabel}name`] === '') {
        //label is empty, so fill it
        const labelIndex = moneylabels.lastIndexOf(moneyLabel);
        const moneyType = moneylist[labelIndex];
        const typeOfMoney = getTranslationByKey(`${moneyType}`);
        log('Money Type', typeOfMoney, 'darkgreen');
        const setmoney = {};
        setmoney[`${moneyLabel}name`] = typeOfMoney;
        setAttrs(setmoney);
      } else {
        log('Money', 'Already set', 'darkgreen');
      }
    });
  });
});

//If Piloting isn't visible, need to assume it's unskilled...may need to do something like this for Fighting...
on('sheet:opened', function () {
  getAttrs(['staticpiloting'], function (v) {
    v.staticpiloting === '0'
      ? setAttrs({ pilotingmod: '-2' })
      : log(
          'Piloting Skill',
          'Visible no need to adjust the mod',
          'darkorange'
        );
  });
});

//  End The Sheet Opened Stuff

/* ---- Button Bar Clicks ---- */
const buttonlist = [
  'characterprofile_1',
  'vehicletab_3',
  'journaltab_4',
  'configurationtab_2',
  'releasetab_5',
  'documentationtab_6',
  'combatoptionstab_7',
  'statblockview_8',
  'powerarmortab_9',
  'robotarmortab_10',
];
buttonlist.forEach(button => {
  on(`clicked:${button}`, function () {
    let setattr = {};
    log('Button Bar Button', `${button} button was clicked!!`, buttonClick);
    let radioval = `${button}`;
    //radioval = radioval.slice(-1);
    radioval = radioval.split('_');
    setattr['sheetTab'] = radioval[1];
    if (radioval[1] === '5') {
      setattr['newcontent'] = 'read';
    } else if (radioval[1] === '6') {
      setattr['newdocumentation'] = 'read';
    }
    setAttrs(setattr);
  });
});

//Create Trait values for rank and display hidden fields
traits.forEach(trait => {
  on(`change:${trait} change:${trait}mod`, function (eventInfo) {
    /*change:${trait}_delta*/
    log(
      'Change Detected' + ' (source type: ' + eventInfo.sourceType + ')',
      `for ${trait}`,
      'cyan'
    );
    log('Trait triggering update', eventInfo.sourceAttribute, 'cyan');
    //let trait = traits;
    //console.log("trait = " + trait);
    log('Check for repeating', trait.slice(0, 6), 'cyan');
    /*if (trait.slice(0,5) === 'repeating') {
            traitcheck = `repeating_skills_${traits}`;
        }*/
    trait = trait.replace(':', '_');
    //console.log("trait = " + trait);
    getAttrs([trait, `${trait}mod`, `${trait}_delta`], v => {
      log('Get Attrs', `${trait}, ${trait}mod, ${trait}_delta`, 'cyan');
      log('intMod', v[`${trait}mod`], 'cyan');
      log('Delta', v[`${trait}_delta`], 'cyan');
      let tDelta = v[`${trait}_delta`];
      tDelta = parseInt(tDelta) || 0;
      let tDie = parseInt(v[trait]) || 0;
      log('Values', `^^^ Delta: ${tDelta}, tDie: ${tDie} ^^^`, 'cyan');
      let tRank = '1d';
      // let tDisplay = (tDelta === 0 ? "d" : "*d");
      let tDisplay =
        tDelta === 0
          ? getTranslationByKey('dice-abbreviation')
          : '*' + getTranslationByKey('dice-abbreviation');
      let intMod = v[`${trait}mod`];
      intMod = parseInt(intMod) || 0;
      tRank += v[trait] + '!';
      tDisplay += v[trait];
      if (intMod > 0) {
        log('Message', 'Mod is > 0...use +', 'cyan');
        tRank += '+' + intMod + '[trait]';
        tDisplay += '+' + intMod;
      } else if (intMod < 0) {
        log('Message', 'Mod is < 0...use -', 'cyan');
        tRank += intMod + '[trait]';
        tDisplay += intMod;
      } else {
        log('Message', "Mod is 0...don't do anything", 'cyan');
      }
      const sAttRank = trait + '_rank',
        sAttDisplay = trait + '_display';
      const sattrs = {};
      sattrs[sAttRank] = tRank;
      sattrs[sAttDisplay] = tDisplay;
      setAttrs(sattrs);
    });
  });
});

//Set Starting Attributes to d6
on('change:attsatdsix', function (eventInfo) {
  let defaultdtype = '4';
  if (eventInfo.newValue === '1') {
    //console.log("### Set default starting Die Type to d6");
    defaultdtype = '6';
  }
  setAttrs({
    agility: defaultdtype,
    smarts: defaultdtype,
    spirit: defaultdtype,
    strength: defaultdtype,
    vigor: defaultdtype,
  });
});

const setWildDie = function () {
  getAttrs(['is_npc'], function (lvalue) {
    //console.log("<==== Updating whether to Roll the Wild Die ====>");
    //console.log("is_npc value: " + lvalue.is_npc);
    if (lvalue.is_npc === '0') {
      console.log('Is a Wild Card: Roll a Wild Die');
      setAttrs({ wdNum: 1 });
    } else {
      console.log("Is not a Wild Card: Don't roll a Wild Die");
      setAttrs({ wdNum: 0 });
    }
    //console.log("<==== Finished Identifying Mook vs Wild Card ====>");
  });
};

/*Determine if Wild Die is rolled*/
on('change:is_npc', function () {
  //'use strict';
  setWildDie();
});

//Animal Intelligence
// Animalistic Intelligence
const updateAnimalIntelligenceDisplay = function () {
  getAttrs(['animalsmarts'], function (attributesValues) {
    /*console.log(
            "Updating animal smarts " + attributesValues.animalsmarts
        );*/
    if (attributesValues.animalsmarts === 'on') {
      setAttrs({
        animalsmarts_display: getTranslationByKey('animal-smarts-abbreviation'),
      });
    } else {
      setAttrs({ animalsmarts_display: ' ' });
    }
  });
};

on('change:animalsmarts', function () {
  updateAnimalIntelligenceDisplay();
});

//Ranks and Advances Stuff
on(
  'change:repeating_edges:edge change:repeating_edges:tookat remove:repeating_edges',
  function (v) {
    log('Change in Edges', 'Look for Advances', 'yellow');
    getSectionIDs('edges', function (idArray) {
      let countOfAdvances = [];
      let listOfFields = [];
      for (let a = 0; a < idArray.length; a++) {
        listOfFields[listOfFields.length] =
          'repeating_edges_' + idArray[a] + '_tookat';
      }
      getAttrs(listOfFields, function (v) {
        let arrayOfAdvances = Object.values(v);
        log('contents of v', arrayOfAdvances, 'yellow');
        let countOfAdvances = 0;
        for (let i = 0; i < arrayOfAdvances.length; i++) {
          arrayOfAdvances[i] === 'Advance'
            ? countOfAdvances++
            : log('Not an Advance', 'True', 'yellow');
        }
        log('Number of Advances', countOfAdvances, 'yellow');
        setAttrs({ xp: countOfAdvances });
      });
    });
  }
);

//Set Rank according to the XP value
on(
  'change:xp change:manualadvance change:rank change:usexp change:setadvance change:setrank',
  function () {
    //if setadvance = 1, xp should be hidden and the person wants to manually update the number of advances the character has taken (i.e. don't rely on the count of Advances in the Edges and Advances section)
    getAttrs(
      [
        'xp',
        'manualAdvance',
        'rank',
        'class',
        'useXP',
        'setadvance',
        'setrank',
      ],
      function (value) {
        //console.log("useXP Value: " + value.useXP);
        //console.log("xp value: " + value.xp);
        //console.log("rank value: " + value.rank);
        let xpVal;
        value.setadvance === '1'
          ? (xpVal = parseInt(value.manualAdvance) || 0)
          : (xpVal = parseInt(value.xp) || 0);
        //var xpVal = parseInt(value.xp)||0;
        //console.log(xpVal);
        if (value.setrank === 'on') {
          console.log(
            "Don't set Rank at all, because there's a different structure"
          );
        } else if (value.useXP === 'on') {
          //Using XP instead of Advances
          if (xpVal >= 80) {
            //console.log("Setting rank to Legendary");
            setAttrs({ Rank: 5 });
            //console.log("Setting class to Grad Student");
            setAttrs({ Class: 5 });
          } else if (xpVal >= 60) {
            //console.log("Setting rank to Heroic");
            setAttrs({ Rank: 4 });
            //console.log("Setting class to Senior");
            setAttrs({ Class: 4 });
          } else if (xpVal >= 40) {
            //console.log("Setting rank to Veteran");
            setAttrs({ Rank: 3 });
            //console.log("Setting class to Junior");
            setAttrs({ Class: 3 });
          } else if (xpVal >= 20) {
            //console.log("Setting rank to Seasoned");
            setAttrs({ Rank: 2 });
            //console.log("Setting class to Sophomore");
            setAttrs({ Class: 2 });
          } else {
            //console.log("Setting rank to Novice");
            setAttrs({ Rank: 1 });
            //console.log("Setting class to Freshman");
            setAttrs({ Class: 1 });
          }
        } else {
          //Using Advances instead of xp
          if (xpVal < 4) {
            //console.log("Setting rank to Novice");
            setAttrs({ Rank: 1 });
            //console.log("Setting class to Freshman");
            setAttrs({ Class: 1 });
          } else if (xpVal < 8) {
            // console.log("Setting rank to Seasoned");
            setAttrs({ Rank: 2 });
            //console.log("Setting class to Sophomore");
            setAttrs({ Class: 2 });
          } else if (xpVal < 12) {
            // console.log("Setting rank to Veteran");
            setAttrs({ Rank: 3 });
            // console.log("Setting class to Junior");
            setAttrs({ Class: 3 });
          } else if (xpVal < 16) {
            // console.log("Setting rank to Heroic");
            setAttrs({ Rank: 4 });
            // console.log("Setting class to Senior");
            setAttrs({ Class: 4 });
          } else {
            //console.log("Setting rank to Legendary");
            setAttrs({ Rank: 5 });
            //console.log("Setting class to Grad Student");
            setAttrs({ Class: 5 });
          }
        }
      }
    );
  }
);

//End Rank

//Set values for Size
on('change:size change:sizemod', function () {
  getAttrs(['size', 'sizemod'], function (value) {
    let size = parseInt(value.size) || 0;
    let sizemod = parseInt(value.sizemod) || 0;
    let cursize = size + sizemod;
    let sizecat = 'Normal';
    /*console.log(
            `#### Size: ${size}, Size Mod: ${sizemod}, Current Size: ${cursize} ####`
        );*/
    switch (cursize) {
      case cursize <= -4 ? cursize : -4:
        //console.log("Tiny");
        sizecat = 'tiny';
        break;
      case cursize <= -3 ? cursize : -3:
        //console.log("Very Small");
        sizecat = 'very-small';
        break;
      case cursize <= -2 ? cursize : -2:
        //console.log("Small");
        sizecat = 'small';
        break;
      case cursize >= -1 && cursize <= 3 ? cursize : 0:
        //console.log("Normal");
        sizecat = 'normal';
        break;
      case cursize >= 4 && cursize <= 7 ? cursize : 7:
        //console.log("Large");
        sizecat = 'large';
        break;
      case cursize >= 8 && cursize <= 11 ? cursize : 8:
        //console.log("Huge");
        sizecat = 'huge';
        break;
      default:
        //console.log("Gargantuan");
        sizecat = 'gargantuan';
    }
    setAttrs({
      sizecategory: sizecat,
      sizecur: cursize,
    });
  });
});

on('change:wealth change:wealthwild', function (eventInfo) {
  let wealth =
    '&{template:roll} {{namelength=@{namelength}}} {{name=@{character_name} }} {{trait=^{wealth}}} {{skill_rank=@{wealth} }} {{skill_roll=[[@{wealth} + @{traitmods}]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[1d@{wealthwilddie}! + @{traitmods}]]}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}';
  if (eventInfo.newValue === 'd0') {
    //console.log("The character is broke");
    wealth = "/em is broke and can't make purchases.";
  }
  setAttrs({ rollwealth: wealth });
});

//Hanlde themes
on('change:sheet_theme', function (eventInfo) {
  //Make the changes
  const updatedValues = {};
  if (eventInfo.newValue === '1') {
    //Deadlands
    updatedValues.logo = 'Deadlands';
    updatedValues.background = '2';
  } else if (eventInfo.newValue === '2') {
    //Pathfinder
    updatedValues.logo = 'Pathfinder';
    updatedValues.background = '2';
  } else if (eventInfo.newValue === '3') {
    //Rifts
    updatedValues.logo = 'Rifts';
    updatedValues.background = '3';
  } else {
    //Generic
    updatedValues.logo = 'SavageWorlds';
    updatedValues.background = '1';
  }
  setAttrs(updatedValues);
});

//watch for a change in the background
on('change:background', function () {
  updateBackgroundImage();
});
  //Create Trait values for rank and display hidden fields is in the workers.js file
//Setting default Skill Names is in the workers.js file (with all the other on:opened stuff)

//Select all Skills if "All" is selected
const static = [
    "staticacademics",
    "staticathletics",
    "staticbattle",
    "staticboating",
    "staticcommonknowledge",
    "staticdriving",
    "staticelectronics",
    "staticfaith",
    "staticfighting",
    "staticfocus",
    "staticgambling",
    "statichacking",
    "statichealing",
    "staticintimidation",
    "staticlanguage",
    "staticnotice",
    "staticoccult",
    "staticperformance",
    "staticpersuasion",
    "staticpiloting",
    "staticpsionics",
    "staticrepair",
    "staticresearch",
    "staticriding",
    "staticscience",
    "staticshooting",
    "staticspellcasting",
    "staticstealth",
    "staticsurvival",
    "statictaunt",
    "staticthievery",
    "statictrade",
    "staticweirdscience",
    "staticKnowledgeOther",
];
on("change:staticall", function(eventInfo) {
    let sattr = {};
    if (eventInfo.newValue === "1") {
        //All has been checked
        for (let i = 0; i < static.length; i++) {
            //console.log("Loop 1");
            // log("setting",static[i]+" to on","goldenrod");
            sattr[static[i]] = "on";
        }
        //console.log("Set: " + JSON.stringify(sattr));
        setAttrs(sattr);
    } else {
        //All has been deselected
        for (let i = 0; i < static.length; i++) {
            //console.log("Loop 1");
            // log("setting",static[i]+" to off","goldenrod");
            sattr[static[i]] = 0;
        }
        //console.log("Set: " + JSON.stringify(sattr));
        setAttrs(sattr);
    }
});

//Select all Core Skills if "Core" is selected
on("change:staticcore", function(eventInfo) {
    if (eventInfo.newValue === "1") {
        //All has been checked
        setAttrs({
            staticathletics: "on",
            staticcommonknowledge: "on",
            staticnotice: "on",
            staticpersuasion: "on",
            staticstealth: "on",
        });
    } else {
        //All has been deselected
        setAttrs({
            staticathletics: 0,
            staticcommonknowledge: 0,
            staticnotice: 0,
            staticpersuasion: 0,
            staticstealth: 0,
        });
    }
});

//Do the Delta thing here...
//Set the actual trait and trait mod fields...this is needed so things like Vigor and Parry update if the appropriate trait is boosted/lowered
traits.forEach((trait) => {
    on(`change:${trait}_delta`, function(eventInfo) {
        log(`Change Detected (source type: ${eventInfo.sourceType})`,`for ${eventInfo.sourceAttribute}`,"cyan");
        /*if (eventInfo.sourceType === "sheetworker") {
            log("Delta Trigger","Sheetworker - don't do anything","orange");
        }
        else {*/
            // log("Delta Change Detected",`for ${trait}`,deltaColor);
            trait = trait.replace(":", "_");
            //log("Trait",trait,deltaColor);
            getAttrs(
                [trait, `${trait}mod`, `${trait}_base`, `${trait}mod_base`],
                function(v) {
                    // log("Get Attrs",`${trait}, ${trait}mod, ${trait}_base, ${trait}attr_gutsmod_base`,deltaColor);
                    let tRank = parseInt(v[`${trait}`]) || 0;
                    let tMod = parseInt(v[`${trait}mod`]) || 0;
                    let tDelta = parseInt(eventInfo.newValue) || 0;
                    let prevDelta = parseInt(eventInfo.previousValue) || 0;
                    let tRankBase = v[`${trait}_base`];
                    let tModBase = v[`${trait}mod_base`];
                    const sAttRankBase = trait + "_base",
                        sAttRankModBase = trait + "mod_base",
                        sAttRank = trait,
                        sAttMod = trait + "mod";
                    // log("Attributes to be Set",`${sAttRankBase}, ${sAttRankModBase}, ${sAttRank}, ${sAttMod}`,deltaColor);
                    const sattrs = {};
                    let counter = Math.abs(tDelta);
                    // log("Starting Values",`Rank/Base: ${tRank}/${tRankBase}, Mod/Base: ${tMod}/${tModBase}, Delta: ${tDelta}, Prev Delta: ${prevDelta}`,deltaColor);
                    //Check if previous Delta was 0, if so, will want to set base before changing anything
                    if (prevDelta === 0 || tRankBase === "") {
                        //set the base values to the current values of the trait and mod
                        // log("Message","^^^ Setting the Bases ^^^",deltaColor);
                        sattrs[sAttRankBase] = tRank;
                        sattrs[sAttRankModBase] = tMod;
                        //set tRankBase and tModBase in case needed Boosting/lowering
                        tRankBase = tRank;
                        tModBase = tMod;
                    }
                    // Boosting/Lowering Trait or resetting to base?
                    if (tDelta === 0) {
                        // log("Message","--- Resetting stats to base ---",deltaColor);
                        sattrs[sAttRank] = tRankBase;
                        sattrs[sAttMod] = tModBase;
                    } else if (tDelta > 0) {
                        //reset rank and mod back to the baseline so the boost math is correct
                        // log("Message","!!! Re-baselining Attribute !!!",deltaColor);
                        tRank = tRankBase;
                        tMod = tModBase;
                        // log("Message","+++ Boosting a Trait from Base +++",deltaColor);
                        tRank === 4 && tMod === -2 ?
                            ((tMod = 0), (counter = counter - 1)) :
                            (counter = counter);
                        //log("Delta Info",`tRank: ${tRank}, tMod: ${tMod}, counter: ${counter}`,deltaColor);
                        for (let i = counter; i > 0; i--) {
                            if (tRank === 12) {
                                // log("Message","+++ Rank is maxed...Boosting the Modifier +++",deltaColor);
                                tMod += 1;
                            } else {
                                // log("Message","+++ Boosting Die Type +++",deltaColor);
                                tRank += 2;
                            }
                        }
                        sattrs[sAttRank] = tRank;
                        sattrs[sAttMod] = tMod;
                    } else {
                        //reset rank and mod back to the baseline so the boost math is correct
                        tRank = tRankBase;
                        tMod = tModBase;
                        for (let i = counter; i > 0; i--) {
                            if (tRank === 4) {
                                break;
                            }
                            tRank === 12 && tMod > 0 ?
                                (tMod = tMod - 1) :
                                (tRank = tRank - 2);
                        }
                        sattrs[sAttRank] = tRank;
                        sattrs[sAttMod] = tMod;
                    }
                    setAttrs(sattrs);
                }
            );
        //}
        
    });
});

on("change:staticfighting change:staticpiloting", function(eventInfo) {
    let modValue;
    eventInfo.newValue === "on" ? (modValue = "0") : (modValue = "-2");
    eventInfo.sourceAttribute === "staticfighting" ? setAttrs({ fightingmod: modValue }) : setAttrs({ pilotingmod: modValue });
});

on("change:showFightingByDefault", function(eventInfo) {
    let modValue;
    eventInfo.newValue === "1" ? (modValue = "on") : (modValue = "0");
    setAttrs({ staticFighting: modValue });
});

on("change:fightingunskilled", function(eventInfo) {
    log("Fighting", "Setting to Unskilled...maybe", "pink");
    getAttrs(["fighting"], function(v) {
        log("fightingunskilled", eventInfo.newValue, "pink");
        log("Fighting", v.fighting, "pink");
        eventInfo.newValue === "1" && v.fighting === "4" ?
            setAttrs({ fightingmod: "-2" }) :
            console.log("nothign to do");
    });
});

on("change: repeating_skills", function(eventInfo) {
    getAttrs(["repeating_skills_knowledgeotherbuttonName"], function(v) {
        if (v.repeating_skills_knowledgeotherbuttonName === "Skill") {
            setAttrs({ repeating_skills_knowledgeotherbuttonName: "Skill" });
        }
    });
});

// Set Encumbrance Penalty on Skill Rolls for skills that may have a Strength or Agility linkage
const setDynamicEnc = function(field) {
    getAttrs([field], function(v) {
        let button = `${field}button`;
        let formula = `${field}formula`;
        let sattrs = {};
        if (
            v[field] === "(AGL)" ||
            v[field] === "agl-u" ||
            v[field] === "str-u" ||
            v[field] === "(STR)" ||
            v[field] === "1"
        ) {
            //console.log(`Need to set trait (${field}) to use Encumbrance`);
            sattrs[button] = `@{setmodsenc}`;
            sattrs[
                formula
            ] = `@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]`;
        } else {
            /*console.log(
                `Need to set trait (${field}) to NOT use Encumbrance`
            );*/
            sattrs[button] = `@{setmods}`;
            sattrs[formula] = `@{ModSum}[Distracted, Wounds, Fatigue]`;
        }
        /*console.log(
            "Setting the following Values: " + JSON.stringify(sattrs)
        );*/
        setAttrs(sattrs);
    });
};

const dynoTraits = [
    "unskilledencumbrance",
    "linkedathleticsatt",
    "linkedpsionicsatt",
    "linkedritualatt",
    "linkedspellcastingatt",
    "linkedweirdscienceatt",
    "repeating_skills:linkedotherattscore",
];
dynoTraits.forEach((dynoTrait) => {
    on(`change:${dynoTrait}`, function(eventInfo) {
        /*console.log(
            `###### Changed Attribute: ${eventInfo.sourceAttribute} ######`
        );*/
        setDynamicEnc(eventInfo.sourceAttribute);
    });
});const baseToughness = function () {
  getAttrs(['vigor', 'vigormod', 'sizecur'], function (vvalue) {
    log('vigor Value', vvalue.vigor, 'lime');
    log('vimod', vvalue.vigormod, 'lime');
    var Vigor = parseInt(vvalue.vigor) || 0;
    var ViMod = parseInt(vvalue.vigormod) || 0;
    log('ViMod before Math', ViMod, 'lime');
    log('ViMod with ceil', Math.ceil(ViMod / 2), 'lime');
    log('ViMod with floor', Math.floor(ViMod / 2), 'lime');
    ViMod < 0
      ? log('ViMod', 'Less than 0', 'lime')
      : log('ViMod', 'Greater than 0', 'Lime');
    ViMod < 0
      ? (ViMod = Math.ceil(ViMod / 2))
      : (ViMod = Math.floor(ViMod / 2));
    log('ViMod', ViMod, 'lime');
    var Size = parseInt(vvalue.sizecur) || 0;
    var totVigor = Math.floor(Vigor / 2) + ViMod;
    log('totVigor', totVigor, 'lime');
    log('Toughness Formula Result', totVigor + 2 + Size, 'lime');
    var toughFormulaResult = totVigor + 2 + Size;
    toughFormulaResult < 1
      ? (toughFormulaResult = 1)
      : log("Toughness doesn't need to be adjusted", 'lime');
    setAttrs({ toughness: toughFormulaResult });
    setToughness();
  });
};

//Set Base Toughness (Regular and Neural)
on(
  'sheet:opened change:vigor change:vigormod change:toughness change:ntoughness change:sizecur change:power_armor_toughness',
  function () {
    log('Sheet Opened - Calling', 'baseToughness', 'lime');
    baseToughness();
  }
);

const setToughness = function () {
  getAttrs(
    [
      'toughness',
      'tufnessMod',
      'toughnessArmor',
      'power_armor_toughness',
      'armor_embedded_toughness',
    ],
    function (value) {
      let tness = parseInt(value.toughness) || 0;
      let tnessmod = parseInt(value.tufnessMod) || 0;
      let tnessarmor = parseInt(value.toughnessArmor) || 0;
      let powerArmorToughness = parseInt(value.power_armor_toughness) || 0;
      let armorEmbeddedToughness =
        parseInt(value.armor_embedded_toughness) || 0;
      let currentToughness =
        tness +
        armorEmbeddedToughness +
        powerArmorToughness +
        tnessmod +
        tnessarmor;
      currentToughness < 1
        ? (currentToughness = 1)
        : log("Don't need to change Current Toughness", 'lime');
      setAttrs({ toughnesscur: currentToughness });
    }
  );
};

//Set Current Toughness (Regular and Neural)
on(
  'change:toughness change:power_armor_toughness change:tufnessmod change:toughnessarmor change:armor_embedded_toughness',
  function (eventInfo) {
    log('Triggering', 'setToughness', 'lime');
    setToughness();
  }
);

//Calculate embedded toughness
on(
  'change:repeating_armor:embeddedtoughness change:repeating_armor:armorworn change:repeating_armor:areaprotected change:repeating_armor:armorstack remove:repeating_armor',
  function (eventInfo) {
    //Get all rows of armor
    log('Armor Change', eventInfo.sourceAttribute, 'darkorange');
    getSectionIDs('repeating_armor', function (idArray) {
      let listOfFields = [];
      for (let a = 0; a < idArray.length; a++) {
        listOfFields.push(
          `repeating_armor_${idArray[a]}_embeddedtoughness`,
          `repeating_armor_${idArray[a]}_armorWorn`,
          `repeating_armor_${idArray[a]}_AreaProtected`,
          `repeating_armor_${idArray[a]}_armorstack`
        );
      }
      log('Values', 'Going to get them now', 'darkorange');
      log('listOfFields', typeof listOfFields, 'darkorange');
      log('listOfFields', listOfFields, 'darkorange');
      getAttrs(listOfFields, function (v) {
        log('Values', 'got them', 'darkorange');
        let embeddedToughnessTotal = 0;
        let highestNonStack = 0;
        let highestStack = 0;
        let previousHighest = 0;
        let previousStack = 0;
        let eToughness = 0;
        let stackCalc = 0;
        //cycle through each row
        log('Cycle through', 'About to start', 'darkorange');
        for (let b = 0; b < listOfFields.length; b++) {
          log('Checking it out', 'Cycling through the armor', 'darkorange');
          //Check if Armor is worn; armorworn = 1
          eToughness =
            parseInt(v[`repeating_armor_${idArray[b]}_embeddedtoughness`]) || 0;
          let eStack =
            parseInt(v[`repeating_armor_${idArray[b]}_armorstack`]) || 0;
          if (v[`repeating_armor_${idArray[b]}_armorWorn`] === '1') {
            //armor is worn, now check if it covers the Torso
            if (
              v[`repeating_armor_${idArray[b]}_AreaProtected`] !== '1' &&
              v[`repeating_armor_${idArray[b]}_AreaProtected`] !== '6' &&
              v[`repeating_armor_${idArray[b]}_AreaProtected`] !== '7'
            ) {
              //area protected is not Head, Arms, or Legs only; check if it stacks
              if (eStack === 0) {
                //armor doesn't stack
                if (eToughness > highestNonStack) {
                  previousHighest = highestNonStack;
                  highestNonStack = eToughness;
                }
              } else {
                //armor stacks
                stackCalc += Math.floor(eToughness * eStack);
              }
            } else {
              //Doesn't cover torso
              log('Armor', "Doesn't cover torso", 'darkorange');
            }
          } else {
            //armor not worn
            log('Armor', 'not worn', 'darkorange');
          }
        }
        //Done iterating
        embeddedToughnessTotal = highestNonStack + stackCalc;
        setAttrs({ armor_embedded_toughness: embeddedToughnessTotal });
      });
    });
  }
);

//Calculate Armor Modifier for Toughness (Looking at Torso only)
on(
  'change:repeating_armor:armorworn change:repeating_armor:areaprotected change:repeating_armor:armortypeprotection change:repeating_armor:armorstack change:pa_armorstate change:pa_pilotarmor remove:repeating_armor',
  function () {
    console.log('^^^ Changes in Armor...might impact Toughness ^^^');
    getSectionIDs('repeating_armor', function (idArray) {
      //Construct Array of fields to get attributes for...
      let sumFields = [];
      for (let a = 0; a < idArray.length; a++) {
        sumFields[sumFields.length] =
          'repeating_armor_' + idArray[a] + '_armorWorn';
        sumFields[sumFields.length] =
          'repeating_armor_' + idArray[a] + '_AreaProtected';
        sumFields[sumFields.length] =
          'repeating_armor_' + idArray[a] + '_ArmorTypeProtection';
        sumFields[sumFields.length] =
          'repeating_armor_' + idArray[a] + '_armorstack';
      }
      // add pa_armorState and pa_pilotarmor to the list of fields to get the values of
      sumFields.push('pa_armorState', 'pa_pilotarmor');
      //sumFields[sumFields.length] = "toughnessArmor"
      getAttrs(sumFields, function (v) {
        console.log('%%% values of v: ' + JSON.stringify(v) + ' %%%');
        let armorTotal = 0;
        let highestNonStack = 0;
        let highestStack = 0;
        let previousHighest = 0;
        let previousStack = 0;
        let stackProtection = 0;
        let stackCalc = 0;
        console.log('ARMOR VALUE: ' + armorTotal);
        console.log(
          '!!! Armor Worn Test Value: ' +
            v['repeating_armor_' + idArray[0] + '_armorWorn']
        );
        if (v.pa_armorState === '0') {
          //not wearing Power Armor
          for (a = 0; a < idArray.length; a++) {
            console.log(
              'xXxX Armor Protection Value: ' +
                v['repeating_armor_' + idArray[a] + '_ArmorTypeProtection'] +
                ' xXxX'
            );
            let aProtection =
              parseInt(
                v['repeating_armor_' + idArray[a] + '_ArmorTypeProtection']
              ) || 0;
            let aStack =
              parseFloat(v['repeating_armor_' + idArray[a] + '_armorstack']) ||
              0;
            let aCovers =
              parseInt(v['repeating_armor_' + idArray[a] + '_AreaProtected']) ||
              0;
            console.log(
              'xXxX Armor Protection Value: ' + aProtection + ' xXxX'
            );
            //cycle through the armors and see if any of the worn items are of greater protection
            console.log('Iteration Number: ' + a);
            if (v['repeating_armor_' + idArray[a] + '_armorWorn'] != '1') {
              //Armor is not worn
              console.log('Armor is not worn, moving on...');
            } else {
              //Armor is Worn, need to determine if it covers the Torso
              if (aCovers == 1 || aCovers == 6 || aCovers == 7) {
                //Not Torso
                console.log("Armor doesn't cover the Torso, moving on...");
              } else {
                //Armor covers Torso
                if (aStack === 0) {
                  //Armor doesn't stack--need to find the highest armor value and store it
                  if (aProtection > highestNonStack) {
                    //Make this new armor value the Highest Non Stack
                    console.log(
                      '!!! Worn Armor Covers Torso and protection is Higher than current highest Armor value'
                    );
                    console.log('!!! Highest Value: ' + highestNonStack);
                    console.log('!!! Current Value: ' + aProtection);
                    previousHighest = highestNonStack;
                    highestNonStack = aProtection;
                  } else {
                    console.log(
                      '!!! Current Armor value is not higher than the current highest !!!'
                    );
                  }
                } else {
                  //Armor Stacks
                  stackCalc += Math.floor(aProtection * aStack);
                }
              }
            }
          }
          console.log('Done iterating through the Armor');
          //armorTotal = highestNonStack + stackProtection;
          armorTotal = highestNonStack + stackCalc;
          console.log('___ Total Armor Protection: ' + armorTotal + ' ___');
        } else {
          //wearing Power armor
          armorTotal = v.pa_pilotarmor;
        }
        setAttrs({ toughnessArmor: armorTotal });
      });
    });
  }
);

on('change:repeating_armor:armorworn', function (eventInfo) {
  if (eventInfo.newValue === '1') {
    getAttrs(['repeating_armor_ArmorCarried'], function (v) {
      if (v.repeating_armor_ArmorCarried === 'on') {
        log('Armor', 'is already carried...', 'darkblue');
      } else {
        setAttrs({ repeating_armor_ArmorCarried: 'on' });
      }
    });
  } else {
    log('Is not worn', "Don't need to carried...", 'darkblue');
  }
});

//set power_armor_toughness if pa_embeddedtoughness changes
on('change:pa_embeddedtoughness', function () {
  getAttrs(['pa_embeddedtoughness', 'pa_armorState'], function (v) {
    let attrValues = {};
    if (v.pa_armorState === '1') {
      //is wearing the armor, so need to update power_armor_toughness
      attrValues['power_armor_toughness'] = v.pa_embeddedtoughness;
      setAttrs(attrValues);
    }
    // otherwise not wearing the power armor, so no need to update anything
  });
});

//check Parry updates for Shields
on(
  'change:repeating_shields change:repeating_shields:shieldworn change:repeating_shield:shieldparry remove:repeating_shields',
  function () {
    //get all shields
    getSectionIDs('repeating_shields', function (idArray) {
      log('Shields', 'Get Shields ID', 'green');
      //Construct Array of fields to get attributes for...
      let sumFields = [];
      for (let a = 0; a < idArray.length; a++) {
        sumFields[sumFields.length] =
          'repeating_shields_' + idArray[a] + '_shieldWorn';
        sumFields[sumFields.length] =
          'repeating_shields_' + idArray[a] + '_ShieldParry';
      }
      log('Shields ID Array Length', sumFields.length, 'green');
      getAttrs(sumFields, function (v) {
        //Find the highest Parry value that's "Worn" and use that update Parry
        let highestParry = 0;
        let repSectionID;
        let parryScore;
        log('idArray Length', idArray.length, 'green');
        if (idArray.length > 0) {
          log('Array Loop', 'Loop through the array', 'green');
          for (let a = 0; a < idArray.length; a++) {
            repSectionID = idArray[a];
            log(
              'Shield Parry',
              v[`repeating_shields_${repSectionID}_ShieldParry`],
              'green'
            );
            parryScore =
              parseInt(v[`repeating_shields_${repSectionID}_ShieldParry`]) || 0;
            log(
              'Shield Worn',
              v[`repeating_shields_${repSectionID}_shieldWorn`],
              'green'
            );
            if (
              v[`repeating_shields_${repSectionID}_shieldWorn`] === '1' &&
              parryScore > highestParry
            ) {
              highestParry = parryScore;
            }
          }
        }
        log('Highest Parry', highestParry, 'green');
        setAttrs({ shieldparry: highestParry });
      });
    });
  }
);

//Set Parry
on(
  'sheet:opened change:fighting change:fightingmod change:parry change:parryMod change:shieldparry',
  function () {
    getAttrs(
      ['fighting', 'fightingmod', 'parryMod', 'shieldparry'],
      function (pvalue) {
        log('Fighting Value', pvalue.fighting, derivedStatsColor);
        log('mod value', pvalue.FightingMod, derivedStatsColor);
        log('parry mod', pvalue.parryMod, derivedStatsColor);
        log('shield parry', pvalue.shieldparry, derivedStatsColor);
        var Fighting = parseInt(pvalue.fighting) || 0;
        var FightingMod = parseInt(pvalue.fightingmod) || 0;
        var totFighting = Fighting + FightingMod;
        switch (Fighting) {
          case 4:
            if (Fighting === 4 && FightingMod === -2) {
              //Unskilled
              totFighting = 0;
            } else {
              totFighting = Fighting;
            }
            break;
          case 6:
          case 8:
          case 10:
            totFighting = Fighting;
            break;
          case 12:
            totFighting = Fighting + FightingMod;
            break;
          default:
            totFighting = 4;
        }

        var parryMod = parseInt(pvalue.parryMod) || 0;
        let shieldParry = parseInt(pvalue.shieldparry) || 0;
        var parryCalc = Math.floor(totFighting / 2) + 2;
        setAttrs({ parry: parryCalc });
        setAttrs({ parryCur: parryCalc + parryMod + shieldParry });
      }
    );
  }
);

//Robot Armor Parry
on(
  'sheet:opened change:piloting change:pilotingmod change:ra_shield_parry change:ra_parry_mod change:ra_parryRepTotal',
  function () {
    log('Parry Change', 'Something Change', 'darkorange');
    getAttrs(
      [
        'piloting',
        'pilotingmod',
        'ra_shield_parry',
        'ra_parry_mod',
        'ra_parryRepTotal',
      ],
      function (v) {
        let pilotingSkill = parseInt(v.piloting) || 4;
        let pilotingMod = parseInt(v.pilotingmod) || 0;
        let shieldParry = parseInt(v.ra_shield_parry) || 0;
        let parryMod = parseInt(v.ra_parry_mod) || 0;
        let repParryMod = parseInt(v.ra_parryRepTotal) || 0;
        let totPiloting;
        pilotingSkill === 4 && pilotingMod === -2
          ? (totPiloting = 0)
          : (totPiloting = pilotingSkill);
        pilotingSkill === 12
          ? (totPiloting = pilotingSkill + pilotingMod)
          : (totPiloting = pilotingSkill);
        const baseParry = Math.floor(totPiloting / 2) + 2;
        const totalMods = parryMod + repParryMod;
        const totalParry = baseParry + totalMods + shieldParry;
        log('shieldParry', shieldParry, 'darkorange');
        log('parryMod', parryMod, 'darkorange');
        log('repParryMod', repParryMod, 'darkorange');
        log('totalMods', totalMods, 'darkorange');
        log('Set ra_total_parry', totalParry, 'darkorange');
        log('set ra_base_parry', baseParry, 'darkorange');
        setAttrs({
          ra_total_parry: totalParry,
          ra_base_parry: baseParry,
        });
      }
    );
  }
);
//section, field, destination
on(
  'change:repeating_raparrymods:ra_parry_mod_repeating remove:repeating_raparrymods',
  function () {
    log('Parry Mod Repeating', 'A value changed', 'darkorange');
    repeatingSimpleSum(
      'raparrymods',
      'ra_parry_mod_repeating',
      'ra_parryRepTotal'
    );
  }
);

const setPace = function () {
  getAttrs(
    ['pace', 'paceMod', 'woundsMod', 'paceignoreswounds', 'encumbrance', 'encumbrancerules'],
    function (pvalue) {
      console.log('pace value: ' + pvalue.pace);
      console.log('mod value: ' + pvalue.paceMod);
      let pace_base = parseInt(pvalue.pace) || 0;
      let pace_mod = parseInt(pvalue.paceMod) || 0;
      let wound_mod = parseInt(pvalue.woundsMod) || 0;
      let enc_mod = parseInt(pvalue.encumbrance) || 0;
      let totPace = 0;
      if (pvalue.encumbrancerules === '1' && pvalue.paceignoreswounds === 'on') {
        totPace = pace_base + pace_mod + enc_mod;
      } else if (pvalue.paceignoreswounds === 'on') {
        totPace = pace_base + pace_mod;
      } else if (pvalue.encumbrancerules === '1') {
        totPace = pace_base + pace_mod - wound_mod + enc_mod;
      } else {
        totPace = pace_base + pace_mod - wound_mod;
      } 

      if (totPace < 1) {
        totPace = 1;
      }
      setAttrs({ paceCur: totPace });
    }
  );
};

//Set Pace
on(
  'change:pace change:pacemod change:woundsmod change:paceignoreswounds change:encumbrance change:encumbrancerules',
  function () {
    setPace();
  }
);

// Configuration Action Buttons
on('clicked:paceCur', function () {
  getAttrs(['showPaceMod'], function (v) {
    let hideval = '0';
    if (v.showPaceMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showPaceMod: hideval });
  });
});

on('clicked:parryCur clicked:parryButton', function () {
  getAttrs(['showParryMod'], function (v) {
    let hideval = '0';
    if (v.showParryMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showParryMod: hideval });
  });
});

on('clicked:toughnessCur clicked:toughnessButton', function () {
  getAttrs(['showToughnessMod'], function (v) {
    let hideval = '0';
    if (v.showToughnessMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showToughnessMod: hideval });
  });
});

//Load and Encumbrance
const setEncPenalty = function () {
  getAttrs(
    [
      'loadlimit',
      'totalloadcarried',
      'strength',
      'strengthmod',
      'encumbrancerules',
      'loadlimitdietypedelta',
      'loadlimitmulitplier',
      'loadlimitmod',
      'usekg',
    ],
    function (lvalue) {
      let load = parseFloat(lvalue.totalloadcarried) || 0;
      let strength = parseInt(lvalue.strength) || 0;
      let limit = 0;
      let diedelta = parseInt(lvalue.loadlimitdietypedelta);
      let loadmulitplier = parseInt(lvalue.loadlimitmulitplier);
      let limitmod = parseFloat(lvalue.loadlimitmod);
      let stepmultiplier = 20;
      let penalty = 0;
      let base = 0;
      lvalue.usekg === 'kg' ? (stepmultiplier = 10) : (stepmultiplier = 20);
      console.log('### Encumbrance Rules: ' + lvalue.encumbrancerules + ' ###');
      //determine which rules are being Used
      if (lvalue.encumbrancerules === '1') {
        //use SWADE rules
        console.log('### Using SWADE Encumbrance Rules ###');
        lvalue.usekg === 'kg'
          ? (base = (strength - 2) * 5)
          : (base = (strength - 4) * 10 + 20);
        if (lvalue.strength == '12' && lvalue.strengthmod > 0) {
          base = base + lvalue.strengthmod * stepmultiplier;
        }
        limit = base + diedelta * stepmultiplier + limitmod;
        //determine penalty
        if (load > limit) {
          //character is encumbered
          penalty = '-2';
        } else {
          penalty = '0';
        }
      } else {
        //ignore encumbrance
        console.log('Not using Encumbrance');
        penalty = '0';
      }

      setAttrs({
        encumbrance: penalty,
        loadlimit: limit,
      });
    }
  );
};

//Calculate Load Limit and Encumbrance Penalty
on(
  'change:strength change:strengthmod change:totalloadcarried change:loadlimit change:encumbrancerules change:loadlimitdietypedelta change:loadlimitmulitplier change:loadlimitmod change:usekg',
  function () {
    setEncPenalty();
  }
);

//Calculate Encumbrance Penalty
on(
  'change:totalloadcarried change:loadlimit change:strength change:strengthmod change:encumbrancerules change:loadlimitdietypedelta change:loadlimitmulitplier change:loadlimitmod change:usekg',
  function () {
    setEncPenalty();
  }
);

on('change:useload', function (eventInfo) {
  console.log('Encumbrance Config Value: ' + eventInfo.newValue);
  if (eventInfo.newValue === 'on') {
    //Show Load and set the default value to Use Encumbrance (value 1)
    setAttrs({ encumbrancerules: '1' });
  } else {
    //Don't show load and set the default value to Ignore Encumbrance (value 0)
    setAttrs({ encumbrancerules: '0' });
  }
});

//Calculate Total Armor Weight
on(
  'change:repeating_armor:armortypeweight change:repeating_armor:armorcarried remove:repeating_armor',
  function (eventInfo) {
    repeatingSimpleSumWCheck(
      'armor',
      'ArmorTypeWeight',
      'armortotalweightcarried',
      'ArmorCarried',
      'on'
    );
  }
);

//Calculate Total Shield Weight
on(
  'change:repeating_shields:shieldtypeweight change:repeating_shields:shieldworn remove:repeating_shields',
  function (eventInfo) {
    repeatingSimpleSumWCheck(
      'shields',
      'ShieldTypeWeight',
      'shieldtotalweightcarried',
      'shieldWorn',
      '1'
    );
  }
);

//Calculate Total Weapon Weight
on(
  'change:repeating_weapons:weaponweight change:repeating_weapons:weaponcarried remove:repeating_weapons',
  function (eventInfo) {
    repeatingSimpleSumWCheck(
      'weapons',
      'weaponweight',
      'weapontotalweightcarried',
      'weaponcarried',
      'on'
    );
  }
);

//Calculate Total Gear Weight
on(
  'change:repeating_gear:itemqty change:repeating_gear:itemweight',
  function (eventInfo) {
    console.log('%%% Gear Quantity and Weight Changed %%%');
    getAttrs(
      ['repeating_gear_itemqty', 'repeating_gear_itemweight'],
      function (v) {
        let quantity = parseFloat(v.repeating_gear_itemqty) || 0;
        let itemWeight = parseFloat(v.repeating_gear_itemweight) || 0;
        let itemTotalWeight = itemWeight * quantity;
        console.log(
          'Quantity: ' +
            quantity +
            ', weight: ' +
            itemWeight +
            ', total weight: ' +
            itemTotalWeight
        );
        setAttrs({
          repeating_gear_totalItemWeight: itemTotalWeight,
        });
      }
    );
  }
);

on(
  'change:repeating_gear:totalItemWeight change:repeating_gear:itemcarried remove:repeating_gear',
  function (eventInfo) {
    repeatingSimpleSumWCheck(
      'gear',
      'totalItemWeight',
      'geartotalweightcarried',
      'itemcarried',
      'on'
    );
  }
);

//Calculate Total Load Carried
on(
  'change:armortotalweightcarried change:shieldtotalweightcarried change:weapontotalweightcarried change:rangedtotalweightcarried change:geartotalweightcarried',
  function () {
    getAttrs(
      [
        'armortotalweightcarried',
        'shieldtotalweightcarried',
        'weapontotalweightcarried',
        'geartotalweightcarried',
      ],
      function (lvalue) {
        let armor = parseFloat(lvalue.armortotalweightcarried) || 0;
        let weapon = parseFloat(lvalue.weapontotalweightcarried) || 0;
        let gear = parseFloat(lvalue.geartotalweightcarried) || 0;
        let shields = parseFloat(lvalue.shieldtotalweightcarried) || 0;
        setAttrs({
          totalloadcarried: armor + weapon + gear + shields,
        });
      }
    );
  }
);

on('change:burn_points', function (eventInfo) {
  //Check to see if we need to change the die type
  log('Burn Points', 'Change in Burn Points value', 'maroon');
  const setattrObj = {};
  const burnDieType = ['d12', 'd10', 'd8'];
  let setCheck = parseInt(eventInfo.newValue || 0);
  if (setCheck < 4 && setCheck > 0) {
    setattrObj.burn_die_type = burnDieType[setCheck - 1];
  } else if (setCheck > 3) {
    setattrObj.burn_die_type = 'd6';
  } else {
    log('Burn Points', 'No Change in Die Type', 'maroon');
  }
  setAttrs(setattrObj);
});

on('change:burn_points_mod', function (eventInfo) {
  log('Burn Points Mod', 'Clicked ' + JSON.stringify(eventInfo), 'maroon');
  getAttrs(['burn_points'], function (v) {
    let burnPointsMod = parseInt(eventInfo.newValue || 0);
    log('burnPoiuntsMod', burnPointsMod, 'maroon');
    let burnPoints = parseInt(v.burn_points || 0);
    log('burnPoints', burnPoints, 'maroon');
    setAttrs({ burn_points: burnPoints + burnPointsMod });
  });
});
  //Wound and Fatigue Configuration Pane buttons are in teh actionButtonScripts.js file

on('change:stunned', function (eventInfo) {
  if (eventInfo.newValue === '-2') {
    getAttrs(['distracted'], function (v) {
      v.distracted === '0'
        ? setAttrs({ distracted: '-2', vulnerable: '-2' })
        : log('Distracted', 'Setting distracted', 'darkblue');
    });
  } else {
    log('Distracted', "Don't need to change Distracted", 'darkblue');
  }
});

on('change:wounds', function (value) {
  //call the function
  calcWoundsRemaining();
});
  /*jshint esversion: 11, laxcomma:true, eqeqeq:true*/
/*jshint -W014,-W084,-W030,-W033*/
//Initiate a compendium lookup
/*Expansion IDs:
## SWPF ##
- main: 10864
- Bestiary: 12479

## Deadlands ##
- DLWW: 10215
- DLWWCompanion: 10712
- hahh: --
- Blood drive: --

## Rifts ##
- Savage Rifts Tomorrow Legion Player's Guide: 12396
- Savage Rifts Game Master’s Handbook: 12397
- Savage Rifts Savage Foes of North America: 12398

## SWADE ##
- Core: 8893
## Missing
*/
//These categories are the part after the data- in a bestiary entry. E.g. a monster has a data-Armors JSON, but the actual compendium category is "Armor". These are converted to the proper compendium category via the categoryLookup Proxy
const PHEGCategories = ['Powers', 'Hindrances', 'Edges', 'Gear', 'Weapons', 'Shields', 'Armors', 'Vehicle', 'SpecialAbilities'];
//Lookup Objects for using the appropriate attribute references for the lookup. These are not referenced directly, but are instead referenced through their proxies
const specialNameRefsBase = {
    hindrance: 'hindrance',
    vehicle:'vehicle'
};
const nameAttrLookupBase = {
    Weapons: 'display_name',
    Armors: 'display_name',
    Hindrances: 'hindrance',
    Edges: 'edge',
    SpecialAbilities: 'specialability',
    Vehicle:'display_name',
    Gear:'item'
};
const categoryLookupBase = {
    Armors: 'Armor',
    SpecialAbilities: 'Abilities',
    Vehicle:'Vehicles'
};
const requiredAttrLookupBase = {
    gear: 'item',
    shield: 'ArmorType',
    armor: 'ArmorType',
    vehicle: 'display_name',
};
const PHEGSingular = {
    'Powers':'Power',
    'Hindrances':'Hindrance',
    'Edges':'Edge',
    'Gear':'Gear',
    'Weapons':'Weapon',
    'Shields':'Shield',
    'Armors':'Armor',
    'Vehicle':'Vehicle',
    'SpecialAbilities':'SpecialAbility',
    'powers':'power',
    'hindrances':'hindrance',
    'edges':'edge',
    'gear':'gear',
    'weapons':'weapon',
    'shields':'shield',
    'armors':'armor',
    'vehicle':'vehicle',
    'specialabilities':'specialability'
};
//Lookup proxy handlers. These functions are used int he proxies to return an appropriate value from the lookup objects above, even when a given key does not exist in those objects.
const genericLookupHandler = {
    get: (target, prop, receiver) => target[prop] || prop
};
const nameLookupHandler = {
    get: (target, prop, receiver) => target[prop] || 'name'
};
//Lookup proxies. These create the proxies for the lookup objects with an appropriate lookup handler. They can be used as normal objects.
const categoryLookup = new Proxy(categoryLookupBase, genericLookupHandler);
const nameAttrLookup = new Proxy(nameAttrLookupBase, nameLookupHandler);
const specialNameRefs = new Proxy(specialNameRefsBase, nameLookupHandler);
const requiredAttrLookup = new Proxy(requiredAttrLookupBase, genericLookupHandler);

//Start of the actual compendium lookup functions
//Function to initiate the lookup. Parses the statblock to figure out what needs to be looked up in the compendium, and what attribute should be filtered for based on the category.
//ARGUMENTS
//statblock (object): base object dropped from the compendium
//callback (function): A function that will use the parsed compendium lookup data to finish the drag and drop of the item
//The callback function receives the parsed statblock as an argument
const compendiumLookup = function({queue, callback}) {
    getCompendiumPage(`Introduction:BookIndex`,(data)=>{
        if(data.data['data-IDPathways']){
            try{
                const IDPathways = JSON.parse(data.data['data-IDPathways']);
                compendiumDataLookup({queue,callback,IDPathways});
            }catch(err){
                debug('No IDPathways found, exiting drag and drop');
            }
        }else{
            debug(`!!! No product index page found. No valid base compendiums present !!!`);
        }
    });
};

const compendiumDataLookup = function({queue, callback, origBlock,IDPathways}){
    origBlock = origBlock || queue[0];
    let productIndex = 0;
    const productLine = Object.keys(IDPathways).find((line) => {//Find the productLine key from IDPathways that matches the expansion of the item. E.g. The SWPF Bestiary (10864) would match to 'Pathfinder'.
        let index = IDPathways[line].indexOf(+origBlock.Expansion);
        if (index >= 0) {
            productIndex = index;//store the index of the product in the productLine
            return true;
        } else {
            return false;
        }
    }) || 'SWADE';
    const productArray = IDPathways[productLine].splice(productIndex);//extract those products that the item might depend on.
    let searchArray = [];
    queue.forEach((statblock)=>{
        searchArray = PHEGCategories.reduce((m, type) => {//Construct an array of items to search for.
            if (statblock[`data-${type}`]){
                let searchNames = statblock[`data-${type}`].map((obj) => obj[specialNameRefs[obj.type]] || obj.name).join('|').replace(/\|\s*(?:\||$)/g,'');
                if(searchNames){
                    let searchString = `Category:${categoryLookup[type]} ${nameAttrLookup[type]}:${searchNames}`;
                    m.push(searchString);
                }
            }
            return m;
        }, searchArray);
        debug({searchArray});
        debugger;
        lookupBurndown(statblock, productArray, searchArray, callback, origBlock,IDPathways);
    });
};

//Actually queries the compendium to get details on the items in each category using the searchArray assembled in compendiumLookup
//ARGUMENTS
//statblock (object): the original object dropped from the compendium
//productArray (array): The array of expansion IDs that this product may rely on
//callback (function): A function that will use the parsed compendium lookup data to finish the drag and drop of the item
//The callback function receives the parsed statblock as an argument
const lookupBurndown = function(statblock, productArray, searchArray, callback, origBlock,IDPathways) {
    getCompendiumQuery(searchArray, (dataArr) => {
        debug({dataArr});
        PHEGCategories.forEach((category) => {
            if (origBlock[`data-${category}`]) {
                origBlock[`data-${category}`] = origBlock[`data-${category}`].map((obj) => {
                    obj.lookupType = obj.lookupType || category;
                    let fullPHEG = getPHEGDetails(obj, productArray, dataArr);
                    fullPHEG.datasource = fullPHEG.datasource ||
                        origBlock.subcategory || 
                        origBlock.Category;
                    return fullPHEG;
                });
            }
        });
        let queue = additionalLookups(statblock,origBlock);
        if(queue.length){
            compendiumDataLookup({queue,callback,origBlock,IDPathways});
        }else{
            debug({origBlock});
            callback(origBlock);
        }
    });
};

const additionalLookups = function(statblock,origBlock){
    return Object.entries(statblock).reduce((memo,[prop,arr])=>{
        if(prop.startsWith('data-') && Array.isArray(arr)){
            let nestedData = arr.reduce((m,obj)=>{
                obj.data && Object.entries(obj.data).forEach(([nProp,nVal])=>{
                    if(nProp.startsWith('data-')){
                        try{
                            let jArr = JSON.parse(nVal);
                            if(Array.isArray(jArr)){
                                jArr = jArr.map((o)=>{
                                    o.datasource = obj.data.subcategory || obj.data.Category;
                                    if(!o.datasource){
                                        delete o.datasource;
                                    }
                                    return o;
                                });
                                origBlock[nProp] = origBlock[nProp] ? 
                                    [...origBlock[nProp],...jArr] : 
                                    [...jArr];
                                m.data[nProp] = jArr;
                                m.nested = true;
                            }
                        }catch(err){
                            //if the parse failed, do nothing
                        }
                    }
                });
                return m;
            },{data:{},nested:false});
            if(nestedData && nestedData.nested){
                memo.push(nestedData.data);
            }
        }
        return memo;
    },[]);
};

//Finds the compendium item that most precisely matches the needs of the compendium item based on expansion ID and name property.
//If nothing matches based on expansion ID, simply returns the first item with appropriate name property.
//ARGUMENTS
//phegObj (object): the data on the PHEG to return that is included in the base statblock
//productArray (array): The array of expansion IDs that this product may rely on
//dataArr (array): The compendium items that were returned from getCompendiumQuery
const getPHEGDetails = function(phegObj, productArray, dataArr) {
    let objName = phegObj[specialNameRefs[phegObj.type]];
    phegObj.data = phegObj.data || {}; //initialize the data object of the phegObj
    Object.keys(phegObj).forEach((key) => { //Populate the data property of phegObj
        if (key !== 'data') {
            phegObj.data[key] = phegObj[key];
        }
    });
    let compendiumObj;
    const objExpansion = productArray.find((id) => {
        compendiumObj = dataArr.find((dataObj) => +dataObj.data.Expansion === id && 
            (dataObj.data[nameAttrLookup[phegObj.lookupType]] || dataObj.name) === objName);
        if (compendiumObj) {
            return true;
        } else {
            return false;
        }
    });
    
    if (!compendiumObj) { //If we didn't find an object matching the expansion pathways and the object name, just find the first item with a matching name
        compendiumObj = dataArr.find((dataObj) => (dataObj.data[nameAttrLookup[phegObj.type]] || dataObj.name) === objName);
        if (!compendiumObj) { //If there still isn't a matching compendium object, return the original PHEG
            phegObj.data[requiredAttrLookup[phegObj.type]] = phegObj.data[requiredAttrLookup[phegObj.type]] || phegObj.name;
            return phegObj;
        }
    }
    Object.keys(compendiumObj.data).forEach((key) => {
        if (phegObj.data[key] === undefined && key !== 'expansion') { //If the pheg does not already have information in place for this key, then add this key to the pheg
            phegObj.data[key] = compendiumObj.data[key];
        }
    });
    return phegObj;
};/*jshint esversion: 11, laxcomma:true, eqeqeq:true*/
/*jshint -W014,-W084,-W030,-W033*/
//Reset Compendium fields to empty
const getDropInfoCommand = (category, source) => {
  const PHEGCategoryTypes = {
    Gear: 'gear',
    Edges: 'npc_Edge',
    Hindrances: 'npc_hindrance',
    Weapons: 'weapons', //Needs handling for PA/Vehicle/RA
    Powers: 'spells',
    Armors: 'armor', //Needs handling for PA/Vehicle/RA
    Shields: 'shields', //Needs handling for PA/Vehicle/RA
    Vehicle: 'vehicle_non-repeating', //Needs handling for PA/Vehicle/RA
    SpecialAbilities: 'specialabilities',
  };
  const PHEGsourceSwitch = {
    Vehicles: {
      Weapons: 'shipweapons',
    },
    'Power Armor': {
      Weapons: 'paweapons',
    },
    'Robot Armor': {
      Weapons: 'raweapons',
    },
  };
  PHEGsourceSwitch.Vehicle = PHEGsourceSwitch.Vehicles;
  return (
    (PHEGsourceSwitch[source] && PHEGsourceSwitch[source][category]) ||
    PHEGCategoryTypes[category]
  );
};
const resetCompendiumFields = function () {
  let setObj = {};
  setObj['CompendiumName'] = '';
  setObj['CompendiumCategory'] = '';
  setObj['CompendiumContent'] = '';
  setObj['CompendiumData'] = '';
  setAttrs(setObj, { silent: true });
  //return setObj;
};
//Start Compendium Drop
const cleanCompendiumData = function (jsonData) {
  const leftRegEx = /(\"\[)/g;
  const rightRegEx = /(\]\")/g;
  const newLineRegEx = /(\\\\n)/g;
  const slashRegEx = /(\\\")/g;
  const singleQuote = /(\{')/g; //replace with {"
  const singleQuoteColonRight = /(':)/g; //replace with ":
  const doubleSingleQuote = /('')/g; //replace with ""
  const singleQuotecolonLeft = /(: ')/g; //replace with : "
  const singleQuoteCommaSeparated = /(', ')/g; //replace with ", "
  const doubleQuoteCommaSingle = /(\", ')/g; //replace with ", "
  const spaceSingleQuote = /( ')/g; //replace with , "
  const doubleComma = /(,,)/g; //replace with ,
  let newString = jsonData;
  newString = newString.replace(leftRegEx, '[');
  newString = newString.replace(rightRegEx, ']');
  newString = newString.replace(newLineRegEx, '\\n');
  log('newString Brackets Replaced', newString, r20color);
  newString = newString.replace(slashRegEx, '"');
  log('Monster String', 'newString Remove single Quotes', r20color);
  newString = newString.replace(singleQuote, '{"');
  newString = newString.replace(singleQuoteColonRight, '":');
  newString = newString.replace(doubleSingleQuote, '""');
  newString = newString.replace(singleQuotecolonLeft, ': "');
  newString = newString.replace(singleQuoteCommaSeparated, '", "');
  newString = newString.replace(doubleQuoteCommaSingle, '", "');
  newString = newString.replace(spaceSingleQuote, ', "');
  newString = newString.replace(doubleComma, ',');
  log('newString', newString, r20color);
  return newString;
};

//Special Abilities that impact other aspects of the character sheet
const specialAbiltyUpdates = {
  Construct: {
    unshakemodtype: 'Construct',
    unshakemod: '2',
    reducereason: 'Construct',
    reducewoundsby: '1',
  },
  Elemental: {
    reducereason: 'Elemental',
    reducewoundsby: '1',
  },
  Undead: {
    toughnessModReason: 'Undead',
    tufnessMod: '2',
    unshakemodtype: 'Undead',
    unshakemod: '2',
    reducereason: 'Undead',
    reducewoundsby: '1',
  },
  'Dense Body': {
    toughnessModReason: 'Dense Body',
    tufnessMod: '2',
  },
};
const sheetAttributes = [
  "character_sheet","firstInit","namelength","wdNum","dopay","dealtJoker","showFightingByDefault","initstatblock","initdesc","chardesc","charatts","initskills","charskills","initderived","charderived","initgear","chargear","inithindrances","charhindrances","initsbedges","charedges","initspecabilities","showspec","charspecabilities","initpowers","powercount","charpowers","ab1powerlist","ab2powerlist","ab3powerlist","ab4powerlist","ab5powerlist","unshakeTemplate","templateConditions","ttmod","dmgmod","ModSum","ModSumEnc","armorMinStrMod","CompendiumName","CompendiumCategory","CompendiumContent","CompendiumData","avatar","ctoken","dark_mode","sheet_theme","background","sheetTab","miniDisplay","vehicle","power_Armor","robot_Armor","is_npc","WCI","showFear","newcontent","newdocumentation","character_name","rank","rank_display","race","size","sizecategory","bennies","conviction","physdescription","worstNightmare","nightmare","showconditions","distracted","vulnerable","stunned","wounds","wounds_max","isShaken","isinc","fatigue","fatigue_max","agility_delta","agility_display","smarts_delta","animalsmarts_display","smarts_display","spirit_delta","spirit_display","strength_delta","strength_display","vigor_delta","vigor_display","parryCur","toughnesscur","toughnessArmor","runningDie","paceCur","showDominion","showadditionalderived","dominion","showBurn","burn_die_type","derivedFirstName","derivedFirstCurrent","useLoad","totalloadcarried","encumbrance","hindranceCount","specialAbilityCount","staticacademics","academicsname","academics_display","staticathletics","athleticsname","athletics_display","staticbattle","battlename","battle_display","staticboating","boatingname","boating_display","staticcommonknowledge","commonknowledgename","commonknowledge_display","staticdriving","drivingname","driving_display","staticelectronics","electronicsname","electronics_display","staticfaith","faithname","faith_display","staticfighting","fightingname","fighting_display","staticfocus","focusname","focus_display","staticgambling","gamblingname","gambling_display","statichacking","hackingname","hacking_display","statichealing","healingname","healing_display","staticintimidation","intimidationname","intimidation_display","staticlanguage","native-languagename","language_display","staticnotice","noticename","notice_display","staticoccult","occultname","occult_display","staticperformance","performancename","performance_display","staticpersuasion","persuasionname","persuasion_display","staticpiloting","pilotingname","piloting_display","staticpsionics","psionicsname","psionics_display","staticrepair","repairname","repair_display","staticresearch","researchname","research_display","staticriding","ridingname","riding_display","staticscience","sciencename","science_display","staticshooting","shootingname","shooting_display","staticspellcasting","spellcastingname","spellcasting_display","staticstealth","stealthname","stealth_display","staticsurvival","survivalname","survival_display","statictaunt","tauntname","taunt_display","staticthievery","thieveryname","thievery_display","statictrade","tradename","trade_display","staticweirdscience","weirdsciencename","weirdscience_display","staticKnowledgeOther","useAlphaNum","powerCount","powerlabelplural","NoPPRule","numberofabs","ab1color","ablabel","PowerPoints","PowerPoints_max","ppelabel","ab2color","ablabel2","powerpoints2","powerpoints2_max","pplabel2","ab3color","ablabel3","powerpoints3","powerpoints3_max","pplabel3","ab4color","ablabel4","powerpoints4","powerpoints4_max","pplabel4","ab5color","ablabel5","powerpoints5","powerpoints5_max","pplabel5","vbonusdamage","RaiseHBRule","usewealth","moneyfields","moneyonename","moneytwoname","moneythreename","moneyfourname","moneyname","money","money2","money3","money4","wealth","useWealthMod","wealthmod","rollwealth","useconsumables","edgeCount","logo","agilitybutton","agility","agilitymod","agModType","agrollMod","whisperagility","agwilddie","agwilddieinfo","agility_base","agilitymod_base","agility_rank","rolltagility","agilityRollFormula","agilityWildDieFormula","smartsbutton","smarts","smartsmod","smModType","smrollMod","whispersmarts","smwilddie","smwilddieinfo","animalsmarts","smarts_base","smartsmod_base","smarts_rank","rolltsmarts","smartsRollFormula","smartsWildDieFormula","spiritbutton","spirit","spiritmod","spModType","sprollMod","whisperspirit","spwilddie","spwilddieinfo","spirit_base","spiritmod_base","spirit_rank","rolltspirit","spiritRollFormula","spiritWildDieFormula","strengthbutton","strength","strengthmod","stModType","strollMod","whisperstrength","stwilddie","stwilddieinfo","strength_base","strengthmod_base","strength_rank","rolltstrength","strengthRollFormula","strengthWildDieFormula","vigorbutton","vigor","vigormod","viModType","virollMod","whispervigor","viwilddie","viwilddieinfo","vigor_base","vigormod_base","vigor_rank","rolltvigor","vigorRollFormula","vigorWildDieFormula","altRuleSkillSpec","staticAll","staticCore","unskilledencumbrance","whisperunskilled","unskilledwilddie","unskilledwilddieinfo","unskilled_rank","unskilled_display","unskilledSkillRollFormula","unskilledWildDieFormula","rolltUnskilled","unskilledencumbrancebutton","unskilledrollformula","academics_cla","academics_lao","academics_delta","academics_makeButton","academics_mbVarType","academicsRollValue","academics","academicsmod","academicsModType","AcademicsskillMod","linkedacademicsattbutton","linkedacademicsattformula","whisperacademics","academicswilddie","academicswilddieinfo","academics_base","academicsmod_base","academics_rank","academicsSkillRollFormula","academicsWildDieFormula","rolltAcademics","athletics_cla","athletics_lao","athletics_delta","athletics_makeButton","athletics_mbVarType","linkedathleticsatt","athleticsRollValue","athletics","athleticsmod","athleticsModType","AthleticsskillMod","linkedathleticsattbutton","linkedathleticsattformula","whisperathletics","athleticswilddie","athleticswilddieinfo","athletics_base","athleticsmod_base","athletics_rank","athleticsSkillRollFormula","athleticsWildDieFormula","rolltAthletics","battle_cla","battle_lao","battle_delta","battle_makeButton","battle_mbVarType","battleRollValue","battle","battlemod","battleModType","BattleskillMod","linkedbattleattbutton","linkedbattleattformula","whisperbattle","battlewilddie","battlewilddieinfo","battle_base","battlemod_base","battle_rank","battleSkillRollFormula","battleWildDieFormula","rolltBattle","boating_cla","boating_lao","boating_delta","boating_makeButton","boating_mbVarType","boatingRollValue","boating","boatingmod","boatingModType","BoatingskillMod","linkedboatingattbutton","linkedboatingattformula","whisperboating","boatingwilddie","boatingwilddieinfo","boating_base","boatingmod_base","boating_rank","boatingSkillRollFormula","boatingWildDieFormula","rolltBoating","commonknowledge_cla","commonknowledge_lao","commonknowledge_delta","commonknowledge_makeButton","commonknowledge_mbVarType","commonknowledgeRollValue","commonknowledge","commonknowledgemod","commonknowledgeModType","CommonknowledgeskillMod","linkedcommonknowledgeattbutton","linkedcommonknowledgeattformula","whispercommonknowledge","commonknowledgewilddie","commonknowledgewilddieinfo","commonknowledge_base","commonknowledgemod_base","commonknowledge_rank","commonknowledgeSkillRollFormula","commonknowledgeWildDieFormula","rolltCommonknowledge","driving_cla","driving_lao","driving_delta","driving_makeButton","driving_mbVarType","drivingRollValue","driving","drivingmod","drivingModType","DrivingskillMod","linkeddrivingattbutton","linkeddrivingattformula","whisperdriving","drivingwilddie","drivingwilddieinfo","driving_base","drivingmod_base","driving_rank","drivingSkillRollFormula","drivingWildDieFormula","rolltDriving","electronics_cla","electronics_lao","electronics_delta","electronics_makeButton","electronics_mbVarType","electronicsRollValue","electronics","electronicsmod","electronicsModType","ElectronicsskillMod","linkedelectronicsattbutton","linkedelectronicsattformula","whisperelectronics","electronicswilddie","electronicswilddieinfo","electronics_base","electronicsmod_base","electronics_rank","electronicsSkillRollFormula","electronicsWildDieFormula","rolltElectronics","faith_cla","faith_lao","faith_delta","faith_makeButton","faith_mbVarType","faithRollValue","faith","faithmod","faithModType","FaithskillMod","linkedfaithattbutton","linkedfaithattformula","whisperfaith","faithwilddie","faithwilddieinfo","faith_base","faithmod_base","faith_rank","faithSkillRollFormula","faithWildDieFormula","rolltFaith","fighting_cla","fighting_lao","fighting_delta","fighting_makeButton","fighting_mbVarType","fightingRollValue","fighting","fightingmod","fightingModType","FightingskillMod","linkedfightingattbutton","linkedfightingattformula","whisperfighting","fightingwilddie","fightingwilddieinfo","fighting_base","fightingmod_base","fighting_rank","fightingSkillRollFormula","fightingWildDieFormula","rolltFighting","focus_cla","focus_lao","focus_delta","focus_makeButton","focus_mbVarType","focusRollValue","focus","focusmod","focusModType","FocusskillMod","linkedfocusattbutton","linkedfocusattformula","whisperfocus","focuswilddie","focuswilddieinfo","focus_base","focusmod_base","focus_rank","focusSkillRollFormula","focusWildDieFormula","rolltFocus","gambling_cla","gambling_lao","gambling_delta","gambling_makeButton","gambling_mbVarType","gamblingRollValue","gambling","gamblingmod","gamblingModType","GamblingskillMod","linkedgamblingattbutton","linkedgamblingattformula","whispergambling","gamblingwilddie","gamblingwilddieinfo","gambling_base","gamblingmod_base","gambling_rank","gamblingSkillRollFormula","gamblingWildDieFormula","rolltGambling","hacking_cla","hacking_lao","hacking_delta","hacking_makeButton","hacking_mbVarType","hackingRollValue","hacking","hackingmod","hackingModType","HackingskillMod","linkedhackingattbutton","linkedhackingattformula","whisperhacking","hackingwilddie","hackingwilddieinfo","hacking_base","hackingmod_base","hacking_rank","hackingSkillRollFormula","hackingWildDieFormula","rolltHacking","healing_cla","healing_lao","healing_delta","healing_makeButton","healing_mbVarType","healingRollValue","healing","healingmod","healingModType","HealingskillMod","linkedhealingattbutton","linkedhealingattformula","whisperhealing","healingwilddie","healingwilddieinfo","healing_base","healingmod_base","healing_rank","healingSkillRollFormula","healingWildDieFormula","rolltHealing","intimidation_cla","intimidation_lao","intimidation_delta","intimidation_makeButton","intimidation_mbVarType","intimidationRollValue","intimidation","intimidationmod","intimidationModType","IntimidationskillMod","linkedintimidationattbutton","linkedintimidationattformula","whisperintimidation","intimidationwilddie","intimidationwilddieinfo","intimidation_base","intimidationmod_base","intimidation_rank","intimidationSkillRollFormula","intimidationWildDieFormula","rolltIntimidation","language_cla","language_lao","language_delta","language_makeButton","language_mbVarType","languageRollValue","language","languagemod","languageModType","LanguageskillMod","linkedlanguageattbutton","linkedlanguageattformula","whisperlanguage","languagewilddie","languagewilddieinfo","language_base","languagemod_base","language_rank","languageSkillRollFormula","languageWildDieFormula","rolltLanguage","notice_cla","notice_lao","notice_delta","notice_makeButton","notice_mbVarType","noticeRollValue","notice","noticemod","noticeModType","NoticeskillMod","linkednoticeattbutton","linkednoticeattformula","whispernotice","noticewilddie","noticewilddieinfo","notice_base","noticemod_base","notice_rank","noticeSkillRollFormula","noticeWildDieFormula","rolltNotice","occult_cla","occult_lao","occult_delta","occult_makeButton","occult_mbVarType","occultRollValue","occult","occultmod","occultModType","OccultskillMod","linkedoccultattbutton","linkedoccultattformula","whisperoccult","occultwilddie","occultwilddieinfo","occult_base","occultmod_base","occult_rank","occultSkillRollFormula","occultWildDieFormula","rolltOccult","performance_cla","performance_lao","performance_delta","performance_makeButton","performance_mbVarType","performanceRollValue","performance","performancemod","performanceModType","PerformanceskillMod","linkedperformanceattbutton","linkedperformanceattformula","whisperperformance","performancewilddie","performancewilddieinfo","performance_base","performancemod_base","performance_rank","performanceSkillRollFormula","performanceWildDieFormula","rolltPerformance","persuasion_cla","persuasion_lao","persuasion_delta","persuasion_makeButton","persuasion_mbVarType","persuasionRollValue","persuasion","persuasionmod","persuasionModType","PersuasionskillMod","linkedpersuasionattbutton","linkedpersuasionattformula","whisperpersuasion","persuasionwilddie","persuasionwilddieinfo","persuasion_base","persuasionmod_base","persuasion_rank","persuasionSkillRollFormula","persuasionWildDieFormula","rolltPersuasion","piloting_cla","piloting_lao","piloting_delta","piloting_makeButton","piloting_mbVarType","pilotingRollValue","piloting","pilotingmod","pilotingModType","PilotingskillMod","linkedpilotingattbutton","linkedpilotingattformula","whisperpiloting","pilotingwilddie","pilotingwilddieinfo","piloting_base","pilotingmod_base","piloting_rank","pilotingSkillRollFormula","pilotingWildDieFormula","rolltPiloting","psionics_cla","psionics_lao","psionics_delta","psionics_makeButton","psionics_mbVarType","linkedpsionicsatt","psionicsRollValue","psionics","psionicsmod","psionicsModType","PsionicsskillMod","linkedpsionicsattbutton","linkedpsionicsattformula","whisperpsionics","psionicswilddie","psionicswilddieinfo","psionics_base","psionicsmod_base","psionics_rank","psionicsSkillRollFormula","psionicsWildDieFormula","rolltPsionics","repair_cla","repair_lao","repair_delta","repair_makeButton","repair_mbVarType","repairRollValue","repair","repairmod","repairModType","RepairskillMod","linkedrepairattbutton","linkedrepairattformula","whisperrepair","repairwilddie","repairwilddieinfo","repair_base","repairmod_base","repair_rank","repairSkillRollFormula","repairWildDieFormula","rolltRepair","research_cla","research_lao","research_delta","research_makeButton","research_mbVarType","researchRollValue","research","researchmod","researchModType","ResearchskillMod","linkedresearchattbutton","linkedresearchattformula","whisperresearch","researchwilddie","researchwilddieinfo","research_base","researchmod_base","research_rank","researchSkillRollFormula","researchWildDieFormula","rolltResearch","riding_cla","riding_lao","riding_delta","riding_makeButton","riding_mbVarType","ridingRollValue","riding","ridingmod","ridingModType","RidingskillMod","linkedridingattbutton","linkedridingattformula","whisperriding","ridingwilddie","ridingwilddieinfo","riding_base","ridingmod_base","riding_rank","ridingSkillRollFormula","ridingWildDieFormula","rolltRiding","science_cla","science_lao","science_delta","science_makeButton","science_mbVarType","scienceRollValue","science","sciencemod","scienceModType","ScienceskillMod","linkedscienceattbutton","linkedscienceattformula","whisperscience","sciencewilddie","sciencewilddieinfo","science_base","sciencemod_base","science_rank","scienceSkillRollFormula","scienceWildDieFormula","rolltScience","shooting_cla","shooting_lao","shooting_delta","shooting_makeButton","shooting_mbVarType","shootingRollValue","shooting","shootingmod","shootingModType","ShootingskillMod","linkedshootingattbutton","linkedshootingattformula","whispershooting","shootingwilddie","shootingwilddieinfo","shooting_base","shootingmod_base","shooting_rank","shootingSkillRollFormula","shootingWildDieFormula","rolltShooting","spellcasting_cla","spellcasting_lao","spellcasting_delta","spellcasting_makeButton","spellcasting_mbVarType","linkedspellcastingatt","spellcastingRollValue","spellcasting","spellcastingmod","spellcastingModType","SpellcastingskillMod","linkedspellcastingattbutton","linkedspellcastingattformula","whisperspellcasting","spellcastingwilddie","spellcastingwilddieinfo","spellcasting_base","spellcastingmod_base","spellcasting_rank","spellcastingSkillRollFormula","spellcastingWildDieFormula","rolltSpellcasting","stealth_cla","stealth_lao","stealth_delta","stealth_makeButton","stealth_mbVarType","stealthRollValue","stealth","stealthmod","stealthModType","StealthskillMod","linkedstealthattbutton","linkedstealthattformula","whisperstealth","stealthwilddie","stealthwilddieinfo","stealth_base","stealthmod_base","stealth_rank","stealthSkillRollFormula","stealthWildDieFormula","rolltStealth","survival_cla","survival_lao","survival_delta","survival_makeButton","survival_mbVarType","survivalRollValue","survival","survivalmod","survivalModType","SurvivalskillMod","linkedsurvivalattbutton","linkedsurvivalattformula","whispersurvival","survivalwilddie","survivalwilddieinfo","survival_base","survivalmod_base","survival_rank","survivalSkillRollFormula","survivalWildDieFormula","rolltSurvival","taunt_cla","taunt_lao","taunt_delta","taunt_makeButton","taunt_mbVarType","tauntRollValue","taunt","tauntmod","tauntModType","TauntskillMod","linkedtauntattbutton","linkedtauntattformula","whispertaunt","tauntwilddie","tauntwilddieinfo","taunt_base","tauntmod_base","taunt_rank","tauntSkillRollFormula","tauntWildDieFormula","rolltTaunt","thievery_cla","thievery_lao","thievery_delta","thievery_makeButton","thievery_mbVarType","thieveryRollValue","thievery","thieverymod","thieveryModType","ThieveryskillMod","linkedthieveryattbutton","linkedthieveryattformula","whisperthievery","thieverywilddie","thieverywilddieinfo","thievery_base","thieverymod_base","thievery_rank","thieverySkillRollFormula","thieveryWildDieFormula","rolltThievery","trade_cla","trade_lao","trade_delta","trade_makeButton","trade_mbVarType","tradeRollValue","trade","trademod","tradeModType","TradeskillMod","linkedtradeattbutton","linkedtradeattformula","whispertrade","tradewilddie","tradewilddieinfo","trade_base","trademod_base","trade_rank","tradeSkillRollFormula","tradeWildDieFormula","rolltTrade","weirdscience_cla","weirdscience_lao","weirdscience_delta","weirdscience_makeButton","weirdscience_mbVarType","linkedweirdscienceatt","weirdscienceRollValue","weirdscience","weirdsciencemod","weirdscienceModType","WeirdscienceskillMod","linkedweirdscienceattbutton","linkedweirdscienceattformula","whisperweirdscience","weirdsciencewilddie","weirdsciencewilddieinfo","weirdscience_base","weirdsciencemod_base","weirdscience_rank","weirdscienceSkillRollFormula","weirdscienceWildDieFormula","rolltWeirdscience","gender","racename","age","character_height","character_weight","sizecur","setadvance","xp","manualAdvance","showPaceMod","running_formula","showParryMod","showToughnessMod","pace","paceModReason","paceMod","woundsMod","parry","shieldparry","parryModReason","parryMod","toughness","armor_embedded_toughness","power_armor","power_armor_toughness","toughnessModReason","tufnessMod","dominion_max","burn_points_mod","burn_points","derivedFirstBase","derivedFirstMod","derivedFirstMax","loadlimitmod","loadlimit","usekg","encumbrancerules","loadlimitdietypedelta","geartotalweightcarried","showWoundmods","showFatiguemods","fatigueMod","reducereason","reducewoundsby","increasereason","increasewoundsby","maxreason","maxwoundmods","fatiguereducereason","reducefatigueby","fatigueincreasereason","increasefatigueby","fatiguemaxreason","maxfatiguemods","showunshake","whisperunshake","unshakewilddieinfo","unshakewilddie","unshakemodtype","unshakemod","rolltunshake","showsoak","whispersoak","soakwilddieinfo","soakwilddie","soakmodtype","soakmod","rolltSoak","showSpecAbilities","hideWeapons","staticAthletics","staticShooting","staticWeirdScience","weapontotalweightcarried","ArcanumTab","hidepowers","powerconfigindicator","showpowersectionconfig","powerlabelsingular","ppabbr","staticFaith","staticFocus","staticPerformance","staticPsionics","staticSpellcasting","hideArmor","pa_armorState","armortotalweightcarried","hideShield","shieldtotalweightcarried","permInjuries","injuries","questlog","hideQL","CharNotes","vehicletype","vehiclewounds","vehiclewounds_max","vehicleisinc","vehiclesize","vehiclehandling","vehicletopspeed","vehicletoughness","vehiclecrew","vehiclecargo","vehiclenotes","pa_vehicletype","wornArmorRowIDs","pa_vehiclesize","pa_vehiclehandling","pa_vehicletopspeed","pa_run_numdice","pa_run_dietype","pa_running_formula","pa_vehiclepace","pa_image","pa_embeddedtoughness","pa_pilotarmor","pa_pilotSkillMod","pastrength_cla","pastrength_lao","staticpastrength","pastrength_delta","pastrength_makeButton","pastrength_mbVarType","pastrengthname","pastrength_display","pastrengthRollValue","pastrength","pastrengthmod","pastrengthModType","PastrengthskillMod","linkedpastrengthattbutton","linkedpastrengthattformula","whisperpastrength","pastrengthwilddie","pastrengthwilddieinfo","pastrength_base","pastrengthmod_base","pastrength_rank","pastrengthSkillRollFormula","pastrengthWildDieFormula","rolltPastrength","pa_vehiclenotes","ra_vehicletype","ra_vehiclewounds","ra_vehiclewounds_max","ra_vehicleisinc","ra_vehiclesize","ra_vehiclepace","ra_vehicletopspeed","ra_vehicletoughness","ra_run_numdice","ra_run_dietype","ra_running_formula","ra_vehiclecrew","ra_image","ra_pilotSkillMod","ra_total_parry","show_ra_parry_config","ra_base_parry","ra_shield_parry","ra_parryModReason","ra_parry_mod","ra_","rastrength_cla","rastrength_lao","staticrastrength","rastrength_delta","rastrength_makeButton","rastrength_mbVarType","rastrengthname","rastrength_display","rastrengthRollValue","rastrength","rastrengthmod","rastrengthModType","RastrengthskillMod","linkedrastrengthattbutton","linkedrastrengthattformula","whisperrastrength","rastrengthwilddie","rastrengthwilddieinfo","rastrength_base","rastrengthmod_base","rastrength_rank","rastrengthSkillRollFormula","rastrengthWildDieFormula","rolltRastrength","ra_vehiclenotes","gritty","dominion-table","injurytablename","paceignoreswounds","usexp","wealthwilddie","wealthwilddieinfo","atkxconfig","attsatdsix","autorollbonusdmg","promptmods","useBGPhysicalDesc","setrank","showmods","setmods","setmodsenc","setdmgmods","showtraitmods","showdmgmods","traitmods","damagemods","absmod","absmodenc","whisperstatblock","whisperall","InitEdges","tokenURL","avatarURL","jsonImport","releasenotes10024","releasenotes10023","releasenotes10021","releasenotes10020","releasenotes10019","releasenotes10018","releasenotes10017","releasenotes10016","releasenotes10014","releasenotes10013","releasenotes10012","releasenotes10011","releasenotes10010","releasenotes10008","releasenotes10007","releasenotes10006","releasenotes10005","releasenotes10004","releasenotes10003","releasenotes10002","releasenotes10001","releasenotes10000","iconexamples"
];
//Set attribute field names...these are all in repeating sections unless otherwise noted
const hindrancefields = ['hindrance', 'hindrancedescription', 'hindranceType'];
const edgefields = ['edge', 'edgedescription'];
const abilitiesfields = ['specialability', 'specialabilitydescription'];
const gearfields = ['item', 'itemWeight', 'description'];
const powerfields = [
  'power',
  'powerduration',
  'powerrange',
  'pp',
  'trappings',
  'spelldamageatt',
  'spelldmgnumdice',
  'spelldmgdietype',
  'spelldmgbonusnum',
  'spellsbdtnum',
  'spellsbdt',
  'spellnotes',
];
const weaponfields = [
  'weapon',
  'range',
  'rof',
  'weaponap',
  'shots_max',
  'damageatt',
  'dmgnumdice',
  'dmgdietype',
  'dmgbonusnum',
  'weaponsbdtnum',
  'weaponsbdt',
  'weaponnotes',
  'weaponweight',
  'weaponminstrength',
];
const vehicleTypePrefixBase = {
  'Power Armor': 'pa_',
  'Robot Armor': 'ra_',
};
const vehicleTypeDisplayBase = {
  'Power Armor': 'power_armor',
  'Robot Armor': 'robot_armor',
};
const vehicleRepeatingSections = {
  vehicle: {
    'data-Weapons': 'shipWeapons',
  },
  pa_: {
    'data-Weapons': 'paweapons',
  },
  ra_: {
    'data-Weapons': 'raweapons',
  },
};
const vehicleTypeDisplayLookup = new Proxy(vehicleTypeDisplayBase, {
  get: (target, prop, receiver) => target[prop] || 'vehicle',
});
const vehicleTypePrefixLookup = new Proxy(vehicleTypePrefixBase, {
  get: (target, prop, receiver) => target[prop] || '',
});
const vehicleweaponfields = [
  'ShipWeaponType',
  'ShipWeaponRange',
  'ShipWeaponRoF',
  'NoDmgDice',
  'DmgType',
  'DmgMod',
  'ShipWeaponPlacement',
  'ShipWeaponNotes',
  'ShipWeaponAP',
];
const armorWeaponFields = [
  'weapon',
  'range',
  'rof',
  'dmgnumdice',
  'dmgdietype',
  'dmgbonusnum',
  'weaponnotes',
  'weaponap',
  'showweaponconfig',
  'weaponbutton',
  'weaponroll',
  'shots',
  'shots_max',
];
const badVehicleWeaponFields = [
  'weapon',
  'range',
  'rof',
  'dmgnumdice',
  'dmgdietype',
  'dmgbonusnum',
  'placement',
  'description',
  'weaponap',
];
//vehiclefields are non-repeating fields
const vehiclefields = [
  'vehicletype',
  'vehiclewounds_max',
  'vehiclesize',
  'vehiclehandling',
  'vehicletopspeed',
  'vehicletoughness',
  'vehiclecrew',
  'vehiclecargo',
  'vehiclenotes',
  'vehiclecargo_max',
  'vehiclemods',
  'vehiclecost',
  'vehiclestrength',
  'vehiclepace',
  'run_numdice',
  'run_dietype',
  'pilotarmor',
  'embeddedtoughness',
  'image',
  'description',
];
const powerRobotArmorFields = [...vehiclefields, 'pilotarmor', 'pilotskillmod'];
const armorfields = [
  'ArmorType',
  'armorminstrength',
  'areaprotected',
  'armorTypeProtection',
  'armorstack',
  'ArmorTypeWeight',
  'ArmorNotes',
  'embeddedtoughness',
];
const shieldfields = [
  'ShieldType',
  'ShieldParry',
  'ShieldCover',
  'ShieldTypeWeight',
  'ShieldNotes',
  'shieldminstrength',
];
const badshieldfields = [
  'ArmorType',
  'parry',
  'cover',
  'ArmorTypeWeight',
  'ArmorNotes',
  'armorminstrength',
];

const convertPersonalToVehicle = function (jsonObj, convertType = 'vehicle') {
  let fieldArray;
  let badFields;
  if (convertType === 'vehicle') {
    fieldArray = vehicleweaponfields;
    badFields = badVehicleWeaponFields;
  } else {
    fieldArray = shieldfields;
    badFields = badshieldfields;
  }
  if (jsonObj) {
    //create Keys for Vehicle Weapons
    vehicleweaponfields.forEach((field, i) => {
      // jsonObj[fieldArray[i]] = jsonObj[badFields[i]];
      if (jsonObj[badFields[i]]) {
        jsonObj[fieldArray[i]] = jsonObj[badFields[i]];
      } else {
        log('Bad Field', "Doesn't exist...nothing to convert", r20color);
      }
    });
    return jsonObj;
  } else {
    log('jsonObj', 'Not Found', r20color);
  }
};

const determineWeaponOptions = function (
  jsonObj,
  targetObj,
  section,
  attributes
) {
  //check Rate of Fire to see if we need to change the Button Action
  if (jsonObj.shots) {
    targetObj[`${section}_shots`] = jsonObj.shots;
    targetObj[`${section}_shots_max`] = jsonObj.shots;
  }
  parseInt(jsonObj['rof'] || 0) > 1
    ? (targetObj[`${section}_weaponbutton`] = '2') /* Atkx+Dmg */
    : (targetObj[`${section}_weaponbutton`] = '0'); /* Atk + Dmg */
  //set skill to use
  //determine range
  let shortRange = 0;
  let rangeMatch = `${jsonObj['range']}`.match(/(\d+)\/(\d+)\/(\d+)/);
  if (rangeMatch) {
    rangeMatch.shift();
  } else {
    rangeMatch = [];
  }
  [shortRange] = rangeMatch;
  shortRange = +shortRange;
  if (jsonObj.weaponskill) {
    targetObj[`${section}_weaponskill`] = jsonObj.weaponskill;
  } else if (!Number.isNaN(shortRange)) {
    shortRange === 0
      ? /*Set Skill to Fighting*/
        (targetObj[`${section}_weaponskill`] = 'fighting')
      : shortRange < 12
      ? /*Set Skill to Athletics*/
        (targetObj[`${section}_weaponskill`] = 'athletics')
      : /*Set Skill to Shooting*/
        (targetObj[`${section}_weaponskill`] = 'shooting');
  }
  //if damageatt is not passed, set to na
  typeof jsonObj['damageatt'] === 'undefined'
    ? (targetObj[`${section}_damageatt`] = 'na')
    : log('damageatt', 'Found...will set appropriately', r20color);
  targetObj[`${section}_weaponcarried`] = 'on';
  if (jsonObj.hasOwnProperty('dmgdietype')) {
    //check if the format is correct
    typeof jsonObj['dmgdietype'] !== 'undefined' &&
    parseInt(jsonObj['dmgdietype'] || 0) > 0
      ? (jsonObj['dmgdietype'] = `d${jsonObj['dmgdietype']}!`)
      : log(
          'dmgdietype',
          "Either isn't defined or is not formatted correctly, hopefully",
          r20color
        );
  }
  weaponsskillnamelist.forEach(skill => {
    let skillName = `r${skill}`;
    targetObj[`${section}_${skillName}`] = attributes[skill];
  });
};

/**
 * A function to parse any generalized effects of the PHEG. Modifies `targetObj` in place. Uses the [destructuring argument assignment pattern](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment).
 * @param {object} argument - The object containing the arguments.
 * @param {object} argument.targetObj - The object to apply the changes from the effect field to. This is modified in place.
 * @param {string} argument.sectionName - The name of the repeating section that is being parsed.
 * @param {object} argument.jsonObj - The PHEG compendium data that is being parsed.
 * @returns {void}
 */
const applyGeneralEffects = function({targetObj,sectionName,jsonObj}){
  debug('Applying effects fields');
  const effectPrefix = PHEGSingular[sectionName];
  if (jsonObj[`${effectPrefix}effect`]) {
    //get all the different pieces
    jsonObj[`${effectPrefix}effect`]
      .split(/\s*,\s*/)
      .forEach((effectString)=>{
        effectString.replace(
          /(.+?)\s*:\s*(.+)/,
          (match,field,value)=>{
            if(targetObj.hasOwnProperty(field)){
              let numValue = +value;
              let numFieldValue = +targetObj[field];
              if(!Number.isNaN(numValue) && !Number.isNaN(numFieldValue)){
                targetObj[field] += numValue;
              }else{
                targetObj[field] += `& ${value}`;
              }
            }else{
              targetObj[field] = value;
            }
          }
        )
      });
  } else {
    log(`${sectionName} Effect(s)`, 'N/A', r20color);
  }
};

//These drop functions should really be refactored to not need so much redundant code.
const dropGear = function({repSectionID,repSection,targetObj}){
  targetObj[`repeating_${repSection}_${repSectionID}_itemcarried`] = 'on';
  return [repSection,gearfields];
};

const dropNpcHindrance = function({repSectionID,targetObj}){
  targetObj[`repeating_hindrances_${repSectionID}_whisperDeets`] = '/w gm ';
  return dropHindrances({repSectionID,targetObj})
};

const dropHindrances = function({repSectionID,targetObj}){
  targetObj[`repeating_hindrances_${repSectionID}_showHindraceDesc`] =
    '0';
  return ['hindrances',hindrancefields]
};

const dropNpcEdge = function({repSectionID,targetObj}){
  targetObj[`repeating_edges_${repSectionID}_tookat`] = 'GM';
  targetObj[`repeating_edges_${repSectionID}_whisperEdgeDeets`] =
    '/w gm ';
  //fall through to edges
  return dropEdges({repSectionID,targetObj});
};

const dropEdges = function({repSectionID,targetObj}){
  targetObj[`repeating_edges_${repSectionID}_showEdgeDesc`] = '0';
  return ['edges',edgefields];
};

const dropSpecialAbilities = function({repSectionID,repSection,targetObj}){
  //handle specialabilityeffect
  targetObj[`repeating_${repSection}_${repSectionID}_showSpecAbilityDesc`] =
    '0';
  return [repSection,abilitiesfields];
};

const dropWeapons = function({repSectionID,repSection,targetObj,jsonObj,attributes}){
  jsonObj['weaponnotes'] = jsonObj['description'] ?? '';
  targetObj[`repeating_${repSection}_${repSectionID}_showweaponconfig`] = 0;
  determineWeaponOptions(
    jsonObj,
    targetObj,
    `repeating_weapons_${repSectionID}`,
    attributes
  );
  return [repSection,weaponfields];
};

const dropSpells = function({repSectionID,repSection,targetObj,jsonObj,attributes}){
  if (
    typeof jsonObj.spelldamageatt === 'undefined' &&
    typeof jsonObj.spelldmgnumdice === 'undefined' &&
    typeof jsonObj.spelldmgdietype === 'undefined' &&
    typeof jsonObj.spelldmgbonusnum === 'undefined'
  ) {
    //Non-Damaging Power, set button to Cast instead of Damage
    targetObj[`repeating_${repSection}_${repSectionID}_spellbutton`] = '2';
    targetObj[`repeating_${repSection}_${repSectionID}_spelldmgnumdice`] =
      '0';
    targetObj[`repeating_${repSection}_${repSectionID}_showspellconfig`] = 0;
  } else {
    //Damaging Power, do nothing so button remains with Damage.
    log(
      'Power Type',
      'Att: ' +
        jsonObj.spelldamageatt +
        ', Number of Dice ' +
        jsonObj.spelldmgnumdice +
        ', Die Type: ' +
        jsonObj.spelldmgdietype +
        ',Bonus: ' +
        jsonObj.spelldmgbonusnum +
        ' ergo: Damage causing power',
      r20color
    );
  }
  return [repSection,powerfields];
};

const dropArmor = function({repSection,targetObj,repSectionID}){
  targetObj[`repeating_${repSection}_${repSectionID}_showarmorconfig`] = 0;
  return [repSection,armorfields];
};

const dropShields = function({repSectionID,repSection,targetObj,jsonObj}){
  jsonObj = convertPersonalToVehicle(jsonObj, 'shields');
  targetObj[`repeating_${repSection}_${repSectionID}_shieldWorn`] = '1';
  targetObj[`repeating_${repSection}_${repSectionID}_showshieldconfig`] = 0;
  return [repSection,shieldfields];
};

const dropVehicle = function({jsonObj}){
  log('Vehicle Info', 'Made it to getting Vehicle Fields', r20color);
  const fields = [
    ...(jsonObj.subcategory ? powerRobotArmorFields : vehiclefields),
  ];
  if (jsonObj.subcategory) {
    prefix = jsonObj.subcategory === 'Power Armor' ? 'pa_' : 'ra_';
  }
  return [false,fields];
};

const dropShipweapons = function({repSection,jsonObj}){
  log('jsonObj', 'Convert for Vehicle Weapons', r20color);
  jsonObj = convertPersonalToVehicle(jsonObj);
  return [repSection,vehicleweaponfields];
};

const dropArmorweapons = function({repSectionID,repSection,targetObj,jsonObj,attributes}){
  log('jsonObj', 'Convert for Armor Weapons', r20color);
  let section = `repeating_${repSection}_${repSectionID}`;
  jsonObj.showweaponconfig = 0;
  jsonObj.weaponbutton = +jsonObj.rof > 1 ? '2' : '0';
  jsonObj.weaponroll = '@{skillNDamage}';
  let multiAttackRef = `${section}_multiattack`;
  targetObj[multiAttackRef] = '';
  determineWeaponOptions(jsonObj, targetObj, section, attributes);
  let rof = +jsonObj.rof || 0;
  targetObj[multiAttackRef] += `{{numroll=[[1d0+${rof}]]}}`;
  let skill = targetObj[`${section}_weaponskill`];
  _.range(rof - 1).forEach(n => {
    let num = n + 2;
    targetObj[
      multiAttackRef
    ] += `{{skill_roll${num}=&{noerror} [[@{weapon${skill}Formula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}]]]}}`;
  });
  return [repSection,armorWeaponFields];
};

const dropCharacterType = function({repSectionID,repSection,targetObj,jsonObj,attributes}){
  //Character types are not directly stored in repeating sections
  debug('dropping character type');
  const retValue = [false,sheetAttributes];
  return retValue;
};


const getDropInfo = function (jsonObj, targetObj, repSection, attributes) {
  debug('Entering getDropInfo');
  let repSectionID;
  let fields;
  let prefix = '';
  repSection ? 
    (repSectionID = generateRowID()) :
    log('Repeating Section', 'Not Found', r20color);
  const dropSwitch = {
    'gear':dropGear,
    'npc_hindrance':dropNpcHindrance,
    'hindrances':dropHindrances,
    'npc_Edge':dropNpcEdge,
    'edges':dropEdges,
    'specialabilities':dropSpecialAbilities,
    'weapons':dropWeapons,
    'spells':dropSpells,
    'armor':dropArmor,
    'shields':dropShields,
    'vehicle_non-repeating':dropVehicle,
    'shipweapons':dropShipweapons,
    'paweapons':dropArmorweapons,
    'raweapons':dropArmorweapons,
    race:dropCharacterType,
    iconic_framework:dropCharacterType
  };
  [repSection,fields] = dropSwitch.hasOwnProperty(repSection) ?
    dropSwitch[repSection]({repSection,targetObj,jsonObj,attributes,fields,repSectionID}) :
    [null,[]];
  if(repSection){
    applyGeneralEffects({
      targetObj,
      sectionName:repSection,
      jsonObj,
    });
  }
  if(fields.length) {
    if (repSection) {
      log('Repeating Fields', 'Fields Found', r20color);
      if (/^(pa|ra)/.test(repSection)) {
      }
      fields.forEach(field => {
        const ref = jsonObj.hasOwnProperty(field) ?
          field :
          jsonObj.hasOwnProperty(`data-cs-${field}`) ?
            `data-cs-${field}` :
            null;
        if(!ref){
          log(`${field}`, 'Not Found', r20color);
          return;
        }
        targetObj[
          `repeating_${repSection}_${repSectionID}_${prefix}${field}`
        ] = jsonObj[ref]
      });
    } else {
      log('Non-Repeating Fields', 'Fields Found', r20color);
      fields.forEach(field => {
        jsonObj[`${field}`] !== undefined
          ? (targetObj[`${prefix}${field}`] = jsonObj[`${field}`])
          : log(`${field}`, 'Not Found', r20color);
      });
    }
  }
  return targetObj;
};
const determineVehicleWeaponType = function (activePage) {
  const vehiclePages = [];
  vehiclePages[3] = 'shipweapons';
  vehiclePages[9] = 'paweapons';
  vehiclePages[10] = 'raweapons';
  return vehiclePages[+activePage] || vehiclePages[3];
};

const prepAbilities = function({setObj,jsonObj}){
  setObj['showSpecAbilities'] = '1';
  return 'specialabilities';
};

const prepWeapons = function({attributes,setObj,jsonObj}){
  return [1, 2, 3].some(
    num => jsonObj[`category${num}`] === 'Vehicular Weapons'
  ) ?
    determineVehicleWeaponType(attributes.sheetTab)
    : 'weapons';
};

const prepVehicles = function({attributes,setObj,jsonObj}){
  //clear all character sheet vehicle fields in preparation for updated
  //This is to avoid getting mixed data if there was another vehicle on the sheet already when the drop occurred.
  const subCat = jsonObj.subcategory;
  let prefix = '';
  let vFields
  if(subCat){
    prefix = `${subCat.replace(/(\w)\w+\s*/g,(match,letter)=>letter.toLowerCase())}_`;
    vFields = powerRobotArmorFields.map((field)=>`${prefix}${field}`);
    setObj[
      jsonObj.subcategory.replace(/\s+/g, '_').toLowerCase()
    ] = 1;
  }else{
    vFields = [...vehiclefields];
    setObj['vehicle'] = 'on';
    setObj['vehiclewounds'] = '0';
  }
  vFields.forEach((field)=>{
    setObj[`${field}`] = '';
  });
  //Check if Vehicle Type is cared for; if not, will need to set it here.
  jsonObj.vehicletype ?
    log('Vehicle Type', 'Should already be cared for', r20color)
    : (setObj[`${prefix}vehicletype`] = jsonObj.name ||
      jsonObj['display_name'] ||
      '');
  if (jsonObj['data-Weapons']) {
    //if this is a vehicle with weapons, then need to add more stuff to the JSON
    log('Vehicle Weapons Array', 'Found', r20color);
    jsonObj['data-Weapons'].forEach(weapon => {
      let source = subCat || jsonObj.Category;
      let dropType = getDropInfoCommand('Weapons', source);
      log(
        'Import Vehicle Weapon',
        weapon.data && weapon.data.weapon,
        r20color
      );
      log('dropType', dropType, r20color);
      log('source', source, r20color);
      setObj = getDropInfo(
        weapon.data,
        setObj,
        dropType,
        attributes
      );
    });
  }
  return 'vehicle_non-repeating'; //Vehicles don't have a Repeating Sections for the core vehicle
};

const prepCharacterType = function({jsonObj}){
  /*
    ability bonus dice steps are going to be handled via an inc compendium attribute (e.g. agilityinc)
    straight ability references will set the ability die value directly
  */
  if(!jsonObj.subcategory){
    log('Not a droppable character aspect',`Attempted to drop ${jsonObj.Name}`, r20color);
    return null;
  }
  if(jsonObj.subcategory === 'Race'){
    jsonObj.race = jsonObj.display_name || jsonObj.Name;
  }
  return jsonObj.subcategory.toLowerCase().replace(/\s+/g,'_');
};

const prepVehicularWeapons = function({}){
  return 'shipweapons';
};

const prepPowers = function({}){
  return 'spells'
};

const compendiumDrop = function (category) {
  //do stuff
  log('Made it here', 'compendiumDrop: ' + category, r20color);
  getAttrs(sheetAttributes,
    function (v) {
      //reset the compendium drop fields
      resetCompendiumFields();
      //Set up setAttrs object variable AND add Compendium variables to be reset to blank
      let setattrvalues = {
        CompendiumName:'',
        CompendiumCategory:'',
        CompendiumContent:'',
        CompendiumData:''
      };
      //clean the data
      v.CompendiumData = cleanCompendiumData(v.CompendiumData);
      log('JSON data', v.CompendiumData, r20color);
      //parse the JSON Object
      let jObj = JSON.parse(v.CompendiumData);
      const dropSwitch = {
        Abilities:prepAbilities,
        Weapons:prepWeapons,
        Vehicles:prepVehicles,
        Characters:prepCharacterType,
        'Vehicle Weapons':prepVehicularWeapons,
        Powers:prepPowers,
        Edges:() => 'edges',
        Hindrances:() => 'hindrances',
        Gear:() => 'gear',
        Armor:() => 'armor',
        Shields:() => 'shields'
      };
      compendiumLookup({
        queue: [jObj],
        callback: jsonObj => {
          debug(`entering compendiumDrop callback`);
          let repSection = dropSwitch[jsonObj.Category] ?
            dropSwitch[jsonObj.Category]({attributes:v,setObj:setattrvalues,jsonObj}) :
            undefined;
          //If an invalid item was dropped, delete the compendium drop data and stop import.
          if(repSection === undefined){
            debug('Invalid drop category, no drop performed.');
            setAttrs(setattrvalues,{silent:true});
            return;
          }
          setattrvalues = getDropInfo(jsonObj, setattrvalues, repSection, v);
          setattrvalues = processAdditionalPHEGs(jsonObj,setattrvalues,v);
          log('setattrvalues', '', r20color);
          setAttrs(setattrvalues);
          log('Values', 'Set...character sheet is updated', r20color);
        },
      });
    }
  );
};

//Bestiary Compendium Drop
const attributeNames = ['agility', 'smarts', 'spirit', 'strength', 'vigor'];

const compendiumBestiary = function () {
  log('Compendium Drop', 'Bestiary Entry dropped to table top', r20color);
  getAttrs(
    [
      ...weaponsskillnamelist,
      'CompendiumData',
      'CompendiumContent',
      'settings_bar1value',
      'settings_bar1max',
      'settings_bar1link',
      'settings_bar2value',
      'settings_bar2max',
      'settings_bar2link',
      'settings_bar3value',
      'settings_bar3max',
      'settings_bar3link',
    ],
    function (monster) {
      log('settings_bar3max', monster['settings_bar3max'], r20color);
      debug({ jsonObj: monster.CompendiumData });
      //let monsterStats = resetCompendiumFields();
      const leftRegEx = /(\"\[)/g;
      const rightRegEx = /(\]\")/g;
      const newLineRegEx = /(\\\\n)/g;
      const slashRegEx = /(\\\")/g;
      const singleQuote = /(\{')/g; //replace with {"
      const singleQuoteColonRight = /(':)/g; //replace with ":
      const doubleSingleQuote = /('')/g; //replace with ""
      const singleQuotecolonLeft = /(: ')/g; //replace with : "
      const singleQuoteCommaSeparated = /(', ')/g; //replace with ", "
      const doubleQuoteCommaSingle = /(\", ')/g; //replace with ", "
      const spaceSingleQuote = /( ')/g; //replace with , "
      const doubleComma = /(,,)/g; //replace with ,
      let monsterString = monster.CompendiumData;
      monsterString = monsterString.replace(leftRegEx, '[');
      monsterString = monsterString.replace(rightRegEx, ']');
      monsterString = monsterString.replace(newLineRegEx, '\\n');
      log('monsterString Brackets Replaced', monsterString, r20color);
      monsterString = monsterString.replace(slashRegEx, '"');
      log('Monster String', 'monsterString Remove single Quotes', r20color);
      monsterString = monsterString.replace(singleQuote, '{"');
      monsterString = monsterString.replace(singleQuoteColonRight, '":');
      monsterString = monsterString.replace(doubleSingleQuote, '""');
      monsterString = monsterString.replace(singleQuotecolonLeft, ': "');
      monsterString = monsterString.replace(singleQuoteCommaSeparated, '", "');
      monsterString = monsterString.replace(doubleQuoteCommaSingle, '", "');
      monsterString = monsterString.replace(spaceSingleQuote, ', "');
      monsterString = monsterString.replace(doubleComma, ',');
      //monsterString = monsterString.replace("'","\"");
      log('monsterString', monsterString, r20color);
      let monsterStats = {};
      //let monsterObj = JSON.parse(monster.CompendiumData);
      let monsterObj = JSON.parse(monsterString);
      debug({ 'Monster Stats': monsterStats });
      debug({ monsterObj });
      let woundsMax = 0;
      let isWildCard = false;
      //set Wild Card Status
      if (typeof monsterObj.is_npc !== 'undefined') {
        //if is_npc = TRUE, then set as Wild Card
        monsterObj.is_npc === 'TRUE'
          ? (monsterStats['is_npc'] = '0')
          : (monsterStats['is_npc'] = '1');
        monsterObj.is_npc === 'TRUE'
          ? (isWildCard = true)
          : log('Extra', 'isWildCard false', r20color);
        monsterObj.is_npc === 'TRUE'
          ? (woundsMax = 3)
          : log('Extra', 'Leave Wounds at 0', r20color);
      }
      //set Size
      let monsterSize = '0';
      let tokenSize;
      typeof monsterObj.size !== 'undefined'
        ? (monsterSize = monsterObj.size)
        : log('Size', 'Not found', r20color);
      monsterStats['size'] = monsterSize;
      //adjust woundsMax based on Size
      switch (monsterSize) {
        case '-4':
        case '-3':
        case '-2':
        case '-1':
        case '0':
        case '1':
        case '2':
        case '3': //Removed the woundMax += 0 as it was an extraneous operation.
          tokenSize = 1;
          break;
        case '4':
        case '5':
        case '6':
        case '7':
          woundsMax += 1;
          tokenSize = 2;
          break;
        case '8':
        case '9':
        case '10':
        case '11':
          woundsMax += 2;
          tokenSize = 3;
          break;
        default:
          woundsMax += 3;
          tokenSize = 4;
          break;
      }
      const square_size = 70; // Default Roll20 square size (in px)
      let squaresize = parseInt(square_size * tokenSize);
      let default_attr = {};
      default_attr['width'] = squaresize;
      default_attr['height'] = squaresize;
      //Bar 1 (Link to parryCur)
      default_attr['bar1_link'] = 'parryCur';
      //Bar 2 (Link to toughnesscur)
      default_attr['bar2_link'] = 'toughnesscur';
      //Bar 3 (values of wounds)
      default_attr['bar3_link'] = 'wounds';
      //default_attr["bar3_max"] = woundsMax;
      log('Token Defaults', 'Setting token defaults', r20color);
      setDefaultToken(default_attr);
      compendiumLookup({
        queue: [monsterObj],
        callback: lookupObj => {
          //Look through the compendium for additional information on PHEGs. This is an asynchronous operation
          //Set Wounds Values
          monsterStats['wounds'] = 0;
          monsterStats['wounds_max'] = woundsMax;
          log('woundsMax', woundsMax, r20color);
          //set character Core Attributes
          attributeNames.forEach(coreattribute => {
            typeof lookupObj[`${coreattribute}`] !== 'undefined' &&
            lookupObj[`${coreattribute}`] !== '0'
              ? (monsterStats[`${coreattribute}`] =
                  lookupObj[`${coreattribute}`])
              : log(`${coreattribute}`, 'Not found or 0', r20color);
            typeof lookupObj[`${coreattribute}mod`] !== 'undefined'
              ? (monsterStats[`${coreattribute}mod`] =
                  lookupObj[`${coreattribute}mod`])
              : log(`${coreattribute}mod`, 'Not found', r20color);
            //Don't set the attribute if it's equal to 0, because it should be a minimum of 4.
          });
          //set Skills
          log('Skills', 'Begin setting Skills', r20color);
          skillnamelist.forEach(skillname => {
            if (
              typeof lookupObj[`${skillname}`] !== 'undefined' &&
              lookupObj[`${skillname}`] !== '0'
            ) {
              //if the skillname is defined AND not equal 0, then we need to show the skill and set the value
              log(lookupObj[`${skillname}`], 'Found this skill', r20color);
              monsterStats[`static${skillname}`] = 'on';
              monsterStats[`${skillname}`] = lookupObj[`${skillname}`];
            }
            //Set Skill Mod
            typeof lookupObj[`${skillname}mod`] !== 'undefined'
              ? (monsterStats[`${skillname}mod`] = lookupObj[`${skillname}mod`])
              : log(`${skillname}mod`, 'Not found or 0', r20color);
          });
          //Set the sheet Attributes
          log('Character Sheet', 'Setting Values', r20color);
          debug({ 'To be set': monsterStats });
          setAttrs(monsterStats, function () {
            log('Inside', 'Made it inside the setAttrs', r20color);
            //Begin Token Settings...
            //Token size: 4-7 = 2, 8-11 = 3, 12+ = 4
            log('Final Details', 'Setting final details', r20color);
            let finalCharacterDetails = {};
            //set Pace
            typeof lookupObj.pace !== 'undefined'
              ? (finalCharacterDetails['pace'] = lookupObj.pace)
              : log('Pace', 'Not found', r20color);
            //set Token  and Avatar URLs
            typeof lookupObj.Token !== 'undefined'
              ? (finalCharacterDetails['tokenURL'] = lookupObj.Token)
              : log('Token URL', 'Not found', r20color);
            typeof lookupObj.avatarURL !== 'undefined'
              ? (finalCharacterDetails['avatarURL'] = lookupObj.avatarURL)
              : typeof lookupObj.Token !== 'undefined'
              ? (finalCharacterDetails['avatarURL'] = lookupObj.Token)
              : log('Avatar URL', 'Not found', r20color);
            //set description
            typeof lookupObj.biography !== 'undefined'
              ? (finalCharacterDetails['physdescription'] = lookupObj.biography)
              : log('Biography', 'Not found', r20color);
            lookupObj.display_name
              ? (finalCharacterDetails.character_name = lookupObj.display_name)
              : log('Character Name', 'Using compendium default', r20color);
            finalCharacterDetails.sheet_theme = lookupObj['data-sheet_theme'] || 0;
            finalCharacterDetails.rolltemplate_theme = lookupObj['data-rolltemplate_theme'] || 'default';
            //switch character sheet view to mini-view
            //run dice handling
            finalCharacterDetails = processAdditionalPHEGs(lookupObj,finalCharacterDetails,monster);
            if (lookupObj.runningDie) {
              finalCharacterDetails.runningDie = `1d${lookupObj.runningDie}`;
            }
            finalCharacterDetails['miniDisplay'] = '1';
            log(
              'Finish',
              'Write PHEG data and all remaining attributes to character sheet',
              r20color
            );
            debugger;
            setAttrs(finalCharacterDetails);
          });
        },
      });
    }
  );
};

const processAdditionalPHEGs = function(lookupObj,finalCharacterDetails,monster){
  debugger;
  const PHEGCategoryExtraSets = {
    Edges: {
      edgeCount: obj => obj['data-Edges'].length,
    },
    Hindrances: {
      hindranceCount: obj => obj['data-Hindrances'].length,
    },
    Powers: {
      powerCount: obj => obj['data-Powers'].length,
    },
    Vehicle: {
      vehicle: obj =>
        obj['data-Vehicle'].some(o => !o.data.subcategory) ? 'on' : 0,
      power_armor: obj =>
        obj['data-Vehicle'].some(
          o => o.data.subcategory === 'Power Armor'
        )
          ? 1
          : 0,
      robot_armor: obj =>
        obj['data-Vehicle'].some(
          o => o.data.subcategory === 'Robot Armor'
        )
          ? 1
          : 0,
    },
    SpecialAbilities: {
      showspecabilities: obj => 1,
      specialAbilityCount: obj => obj['data-SpecialAbilities'].length,
    },
  };
  PHEGCategories.forEach(type => {
    if (Array.isArray(lookupObj[`data-${type}`])) {
      log(
        type,
        `importing ${lookupObj[`data-${type}`].length} ${type}`,
        r20color
      );
      debug({ [`data-${type}`]: lookupObj[`data-${type}`] });
      let singular = PHEGSingular[type];

      //Handle additional extraneous attribute sets
      if(PHEGCategoryExtraSets.hasOwnProperty(type)){
        Object.entries(PHEGCategoryExtraSets[type]).forEach(
          ([attr, func]) => {
            finalCharacterDetails[attr] = func(lookupObj);
          }
        );
      }
      lookupObj[`data-${type}`].forEach(phegObj => {
        log(`Import ${singular}`, phegObj.name, r20color);
        log(`Monster`, singular, r20color);
        let source = phegObj.datasource;
        let dropType = getDropInfoCommand(type, source);
        finalCharacterDetails = getDropInfo(
          phegObj.data,
          finalCharacterDetails,
          dropType,
          monster
        );
        
      });
    }
  });

  //Set Power Points if any
  if (typeof lookupObj.PowerPoints !== 'undefined') {
    finalCharacterDetails['PowerPoints'] = lookupObj.PowerPoints;
    finalCharacterDetails['PowerPoints_max'] = lookupObj.PowerPoints;
  }
  return finalCharacterDetails;
};

on('change:CompendiumCategory', function (eventInfo) {
  log('Compendium Drop', eventInfo.newValue, '#E948C9');
  log('Compendium Change Source', eventInfo.sourceType, r20color);
  debug(eventInfo);
  if (eventInfo.newValue !== '') {
    let cCategory = eventInfo.newValue;
    let resetFields;
    if(cCategory === 'Bestiary' ||cCategory === 'Archetypes' || cCategory === 'SWADE Archetypes'){
      compendiumBestiary();
    }else{
      compendiumDrop(cCategory);
    }
  } else {
    log('Compendium Drop', 'Nothing dropped', '#E948C9');
  }
});
  /*the following are in the actionButtonConfig.js file:
- powersectionconfig
- addab
*/

//Weapon Button config
const weaponlist = [
  'repeating_weapons',
  'repeating_paweapons',
  'repeating_raweapons',
];

weaponlist.forEach(weapon => {
  on(
    `change:${weapon}:weaponbutton change:${weapon}:weaponskill change:${weapon}:weaponAttackBonus`,
    function (eventInfo) {
      log(
        'Weapon Button Config Triggered',
        eventInfo.sourceAttribute,
        '#CCCCFF'
      );
      //console.log(eventInfo.sourceAttribute);
      let pa = '';
      let wbutton = 'repeating_weapons_weaponbutton';
      let wskill = 'repeating_weapons_weaponskill';
      if (eventInfo.sourceAttribute.slice(10, 12) === 'pa') {
        pa = 'pa';
        wbutton = 'repeating_paweapons_weaponbutton';
        wskill = 'repeating_paweapons_weaponskill';
      } else if (eventInfo.sourceAttribute.slice(10, 12) === 'ra') {
        pa = 'ra';
        wbutton = 'repeating_raweapons_weaponbutton';
        wskill = 'repeating_raweapons_weaponskill';
      }
      const templateCommon = `@{whisperweapon} &{template:roll} {{namelength=@{namelength}}} {{source=@{weapon}}} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~repeating_weapons_tWeapon) }} {{DmgRoll=^{roll-damage}(~repeating_${pa}weapons_dmg) }} @{setmodsenc} @{showtraitmods} @{multiattack} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`;

      const skillUn = `${templateCommon} {{name=@{character_name} }} @{rolltUnskilled} {{skill_roll=&{noerror} [[ @{weaponUnskilledFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[ @{weaponUnskilledWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{trait=^{unskilled}}} @{unskilledencumbrancebutton}`;
      const skillFi = `${templateCommon} {{trait=@{fightingname}}} @{rolltFighting} {{skill_roll=&{noerror} [[ @{weaponFightingFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponFightingWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;

      const skillAt = `${templateCommon} {{trait=@{athleticsname}}} @{rolltAthletics} {{skill_roll=&{noerror} [[ @{weaponAthleticsFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponAthleticsWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;

      const skillSh = `${templateCommon} {{trait=@{shootingname}}} @{rolltShooting} {{skill_roll=&{noerror} [[ @{weaponShootingFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponShootingWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;

      const skillWS = `${templateCommon} {{trait=@{weirdsciencename}}} @{rolltWeirdScience} {{skill_roll=&{noerror} [[ @{weaponWeirdScienceFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponWeirdScienceWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // faith
      const skillFa = `${templateCommon} {{trait=@{faithname}}} @{rolltFaith} {{skill_roll=&{noerror} [[ @{weaponfaithFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponfaithWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // Focus
      const skillFo = `${templateCommon} {{trait=@{focusname}}} @{rolltFocus} {{skill_roll=&{noerror} [[ @{weaponfocusFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponfocusWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // Performance
      const skillPe = `${templateCommon} {{trait=@{performancename}}} @{rolltPerformance} {{skill_roll=&{noerror} [[ @{weaponperformanceFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponperformanceWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // Psionics
      const skillPs = `${templateCommon} {{trait=@{psionicsname}}} @{rolltPsionics} {{skill_roll=&{noerror} [[ @{weaponpsionicsFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponpsionicsWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // Spellcasting
      const skillSp = `${templateCommon} {{trait=@{spellcastingname}}} @{rolltSpellcasting} {{skill_roll=&{noerror} [[ @{weaponspellcastingFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponspellcastingWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;
      // Spirit
      const skillSpi = `${templateCommon} {{trait=^{spirit}}} @{rolltspirit} {{skill_roll=&{noerror} [[ @{weaponspiritFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} {{wild_die=[[ @{weaponspiritWildDieFormula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}}`;

      console.log(eventInfo.sourceAttribute);
      let sid = eventInfo.sourceAttribute.slice(18, 38);
      let skillToUse = skillFi;
      console.log('sid: ' + sid);
      console.log('skillFi: ' + skillFi);
      // getAttrs used to use: `${weapon}_${pa}weaponbutton`,`${weapon}_${pa}weaponskill`,
      getAttrs(
        [`${weapon}_weaponbutton`, `${weapon}_weaponskill`],
        function (value) {
          let tWeaponFormula = '';
          if (value[wbutton] === '0' || value[wbutton] === '2') {
            //Attack + Damage Roll in One
            console.log('!! Attack + Damage !!');
            //tWeaponFormula = `@{${pa}skillNDamage}`;
            tWeaponFormula = `@{skillNDamage}`;
            switch (value[wskill]) {
              case 'fighting':
                skillToUse = skillFi;
                break;
              case 'athletics':
                skillToUse = skillAt;
                break;
              case 'shooting':
                skillToUse = skillSh;
                break;
              case 'weirdscience':
                skillToUse = skillWS;
                break;
              case 'faith':
                skillToUse = skillFa;
                break;
              case 'performance':
                skillToUse = skillPe;
                break;
              case 'psionics':
                skillToUse = skillPs;
                break;
              case 'spellcasting':
                skillToUse = skillSp;
                break;
              case 'spirit':
                skillToUse = skillSpi;
                break;
              case 'focus':
                skillToUse = skillFo;
                break;
              case 'unskilled':
                skillToUse = skillUn;
                break;
              default:
                skillToUse = skillFi;
                break;
            }
            console.log('weaponskill: ' + value[wskill]);
            console.log('skillToUse: ' + skillToUse);
          } else {
            //Damage roll only
            console.log('!! Damage Only !!');
            //tWeaponFormula = "@{repeating_weapons_"+ sid +"_damageOnly}";
            //tWeaponFormula = `@{${pa}damageOnly}`;
            tWeaponFormula = `@{damageOnly}`;
            console.log(`tWeaponFormula: ${tWeaponFormula}`);
          }
          let setattrvals = {};
          setattrvals[`repeating_${pa}weapons_weaponroll`] = tWeaponFormula;
          setattrvals[`repeating_${pa}weapons_skillNDamage`] = skillToUse;
          setAttrs(setattrvals);
          /*switch (pa) {
                        case "pa":
                            setAttrs({
                                repeating_paweapons_weaponroll: tWeaponFormula,
                                repeating_paweapons_skillNDamage: skillToUse,
                            });
                            break;
                        case "ra":
                            console.log(
                                "### Updating the Robot Button Values ###"
                            );
                            setAttrs({
                                repeating_raweapons_weaponroll: tWeaponFormula,
                                repeating_raweapons_skillNDamage: skillToUse,
                            });
                            break;
                        default:
                            setAttrs({
                                repeating_weapons_weaponroll: tWeaponFormula,
                                repeating_weapons_skillNDamage: skillToUse,
                            });
                            break;
                    }*/
        }
      );
    }
  );
});

//Multi Attack
weaponlist.forEach(weaponSection => {
  on(
    `change:${weaponSection}:rof change:${weaponSection}:weaponbutton change:${weaponSection}:weaponskill`,
    function (eventInfo) {
      /* rof > 1; need to set showmulti = 1 (show Atk^+Dmg), otherwise 0 (hide Atk^+Dmg)
                if weaponbutton === 2, then we need to build the multi attack formula (goes in multiattack variable)
            */
      log('Change Happened Here', eventInfo.sourceAttribute, 'yellow');
      getAttrs(
        [
          `${weaponSection}_rof`,
          `${weaponSection}_weaponbutton`,
          `${weaponSection}_weaponskill`,
          `${weaponSection}_multiattack`,
          `atkxconfig`,
        ],
        function (v) {
          let rof = parseInt(v[`${weaponSection}_rof`]) || 0;
          let weaponbutton = v[`${weaponSection}_weaponbutton`];
          log('Weaponbutton', weaponbutton, 'yellow');
          let weaponskill = v[`${weaponSection}_weaponskill`];
          let xconfig = v.atkxconfig;
          let multiattackformula = '';
          let setattrsvals = {};
          console.log(`*** ROF: ${rof} ***`);
          if (rof > 1) {
            console.log('Show the Atk^+Dmg button');
            setattrsvals[`${weaponSection}_showmulti`] =
              '1'; /*show Atk^+Dmg on drop down menu*/
            /*setAttrs({
                            `${weaponSection}_showmulti`: "1",
                        });*/
          }

          if (rof < 2 && weaponbutton === '2') {
            /*if ROF < 2 and Weapons Button is set to Atk^+Dmg, need set it to just Atk+Dmg*/
            console.log(
              'Hide the Atk^+Dmg Button and if it was set to Atk^+Dmg, change it to Atk+Dmg'
            );
            console.log(
              "Set multiattack to 0, so we don't get the multi attack stuff in the roll template"
            );
            setattrsvals[`${weaponSection}_showmulti`] = '0';
            setattrsvals[`${weaponSection}_weaponbutton`] = '0';
            setattrsvals[`${weaponSection}_multiattack`] = '0';
            /*setAttrs({
                            `${weaponSection}_showmulti`: "0",
                            `${weaponSection}_weaponbutton`: "0",
                            `${weaponSection}_multiattack`: "0",
                        });*/
          }
          console.log(`*** weaponbutton: ${weaponbutton} ***`);
          if (weaponbutton === '2') {
            console.log('### Constructing the multiattack formula ###');
            console.log('constructing roll query');
            let templatecalls = '';
            let a, b;
            let loopParam, loopParam2;
            //adjusting the roll query
            if (xconfig === '0') {
              a = rof;
              loopParam = `a > 0`;
              loopParam2 = `a--`;
            } else {
              a = 1;
              loopParam = `a <= ${rof}`;
              loopParam2 = `a++`;
            }
            //Create the Roll Query
            let rollquery = '?{Number of Skill Dice';
            for (a; eval(loopParam); eval(loopParam2)) {
              rollquery += `|${a}`;
              console.log(`RQ: ${rollquery}`);
            }
            rollquery += '}';
            //Create the Roll Formula
            let multiattackformula = '';
            let x;
            switch (weaponskill) {
              case 'fighting':
                x = 'Fighting';
                break;
              case 'athletics':
                x = 'Athletics';
                break;
              case 'shooting':
                x = 'Shooting';
                break;
              case 'weirdscience':
                x = 'Weirdscience';
                break;
              case 'faith':
                x = 'faith';
                break;
              case 'focus':
                x = 'focus';
                break;
              case 'performance':
                x = 'performance';
                break;
              case 'psionics':
                x = 'psionics';
                break;
              case 'spellcasting':
                x = 'spellcasting';
                break;
              case 'spirit':
                x = 'spirit';
                break;
              default:
                x = 'Unskilled';
            }
            for (b = 2; b <= rof; b++) {
              if (b === 6 && rof > 6 && xconfig !== '2') {
                console.log('!!! Using the Roll Query !!!');
                console.log(`b: ${b} || rof: ${rof} || xconfig: ${xconfig}`);
                // multiattackformula += `{{skill_rollall=^{plus-the-next} [[${rollquery}-5]]}} `;
              }
              //multiattackformula += `{{skill_roll${b}=[[@{${weaponskill}rollformula}]]}} `;
              multiattackformula += `{{skill_roll${b}=&{noerror} [[ @{weapon${x}Formula} + @{weaponAttackBonus} [@{weaponAttackBonusReason}] ]]}} `;
            }
            if (xconfig === '2') {
              multiattackformula += `{{numrolls=[[1d0+${rof}]]}}`;
            } else {
              multiattackformula += `{{numrolls=[[1d0+${rollquery}]]}} `;
            }
            multiattackformula = multiattackformula.trim();
            console.log(`||| ${multiattackformula} |||`);
            setattrsvals[`${weaponSection}_multiattack`] = multiattackformula;
            /*setAttrs({
                            repeating_weapons_multiattack: multiattackformula,
                        });*/
          } else {
            console.log(
              "Change was triggered, but Weapon Button isn't Atk^+Dmg"
            );
            setattrsvals[`${weaponSection}_multiattack`] = '0';
            /*setAttrs({
                            repeating_weapons_multiattack: "0",
                        });*/
          }
          setAttrs(setattrsvals);
        }
      );
    }
  );
});

//Spell Button config
on(
  'change:repeating_spells:spellbutton change:repeating_spells:spellskill',
  function (eventInfo) {
    console.log(eventInfo.sourceAttribute);
    let sid = eventInfo.sourceAttribute.slice(18, 38);
    const skillUn =
      '@{rolltUnskilled} @{unshakeTemplate} {{trait=^{unskilled}}} @{unskilledencumbrancebutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }} {{skill_roll=&{noerror} [[ @{spellUnskilledFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellUnskilledWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}}';
    const skillAt =
      '{{trait=@{athleticsname}}} @{rolltAthletics} {{skill_roll=&{noerror} [[ @{spellathleticsFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellathleticsWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{setmodsenc} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillFa =
      '{{trait=@{faithname}}} @{rolltFaith} {{skill_roll=&{noerror} [[ @{spellfaithFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellfaithWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{setmods} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillFo =
      '{{trait=@{focusname}}} @{rolltFocus} {{skill_roll=&{noerror} [[ @{spellfocusFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellfocusWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{setmods} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillPe =
      '{{trait=@{performancename}}} @{rolltPerformance} {{skill_roll=&{noerror} [[ @{spellperformanceFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellperformanceWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{setmods} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillPs =
      '{{trait=@{psionicsname}}} @{rolltPsionics} {{skill_roll=&{noerror} [[ @{spellpsionicsFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellpsionicsWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{linkedpsionicsattbutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillRi =
      '{{trait=@{ritualname}}} @{rolltRitual} {{skill_roll=&{noerror} [[ @{spellritualFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellritualWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{linkedritualattbutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillSp =
      '{{trait=@{spellcastingname}}} @{rolltSpellcasting} {{skill_roll=&{noerror} [[ @{spellspellcastingFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellspellcastingWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{linkedspellcastingattbutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillSpi =
      '{{trait=^{spirit}} @{rolltspirit} {{skill_roll=&{noerror} [[ @{spellspiritFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellspiritWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{linkedspellcastingattbutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    const skillWs =
      '{{trait=@{weirdsciencename}}} @{rolltWeirdScience} {{skill_roll=&{noerror} [[ @{spellWeirdScienceFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} {{wild_die=[[ @{spellWeirdScienceWildDieFormula} + @{spellAttackBonus} [@{spellAttackBonusReason}] ]]}} @{unshakeTemplate} @{linkedweirdscienceattbutton} @{showtraitmods} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }}';
    //skillWs used to have @{rolltWeirdScience} after {{trait...}}
    const skilltemp =
      '@{whisperspell} &{template:roll} {{namelength=@{namelength}}} {{source=@{power}}} {{trappings=@{trappings}}} {{PowerTemplate=y}} @{shownotes} {{button=y}} {{ReRoll=^{reroll}(~repeating_spells_tPower) }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}';

    let skillToUse = skillSp;
    console.log('sid: ' + sid);
    console.log('skillSp: ' + skillSp);
    getAttrs(
      ['repeating_spells_spellbutton', 'repeating_spells_spellskill'],
      function (value) {
        let tSpellFormula = '';
        if (
          value.repeating_spells_spellbutton === '0' ||
          value.repeating_spells_spellbutton === '2'
        ) {
          //Attack + Damage Roll in One
          console.log('!! Need to use Skills !!');
          skillToUse = skilltemp + ' ';
          switch (value.repeating_spells_spellskill) {
            case 'athletics':
              skillToUse += skillAt;
              break;
            case 'faith':
              skillToUse += skillFa;
              break;
            case 'focus':
              skillToUse += skillFo;
              break;
            case 'performance':
              skillToUse += skillPe;
              break;
            case 'psionics':
              skillToUse += skillPs;
              break;
            case 'ritual':
              skillToUse += skillRi;
              break;
            case 'spellcasting':
              skillToUse += skillSp;
              break;
            case 'spirit':
              skillToUse += skillSpi;
              break;
            case 'weirdscience':
              skillToUse += skillWs;
              break;
            case 'unskilled':
              skillToUse += skillUn;
              break;
            default:
              skillToUse += skillSp;
              break;
          }
          console.log('spellskill: ' + value.repeating_spells_spellskill);
          console.log('skillToUse: ' + skillToUse);
        }

        if (value.repeating_spells_spellbutton === '0') {
          //Atk + Damage
          tSpellFormula = '@{spellskillNDamage}';
          skillToUse +=
            ' {{DmgRoll=^{roll-damage}(~repeating_spells_spelldmg) }}';
        } else if (value.repeating_spells_spellbutton === '1') {
          //Damage roll only
          console.log('!! Damage Only !!');
          //tspellFormula = "@{repeating_spells_"+ sid +"_damageOnly}";
          tSpellFormula = '@{spelldamageOnly}';
        } else {
          //skill only roll
          tSpellFormula = '@{skillOnly}';
        }
        setAttrs({
          repeating_spells_spellroll: tSpellFormula,
          repeating_spells_spellskillNDamage: skillToUse,
          repeating_spells_skillOnly: skillToUse,
        });
      }
    );
  }
);

//Get Weapon Damage
// Used to also contain: change:repeating_paweapons:padamageatt change:repeating_paweapons:padmgnumdice change:repeating_paweapons:padmgdietype change:repeating_paweapons:padmgbonusnum change:repeating_raweapons:radamageatt change:repeating_raweapons:radmgnumdice change:repeating_raweapons:radmgdietype change:repeating_raweapons:radmgbonusnum
on(
  'change:repeating_weapons:damageatt change:repeating_weapons:dmgnumdice change:repeating_weapons:dmgdietype change:repeating_weapons:dmgbonusnum change:repeating_paweapons:damageatt change:repeating_paweapons:dmgnumdice change:repeating_paweapons:dmgdietype  change:repeating_paweapons:dmgbonusnum change:repeating_raweapons:damageatt change:repeating_raweapons:dmgnumdice change:repeating_raweapons:dmgdietype change:repeating_raweapons:dmgbonusnum',
  function (eventInfo) {
    let pa = '';
    if (eventInfo.sourceAttribute.slice(10, 12) === 'pa') {
      pa = 'pa';
    } else if (eventInfo.sourceAttribute.slice(10, 12) === 'ra') {
      pa = 'ra';
    }
    getAttrs(
      [
        'agility_display',
        'smarts_rank',
        'spirit_rank',
        'strength_rank',
        'vigor_rank',
        'pastrength_rank',
        'rastregnth_rank',
        `repeating_${pa}weapons_damageatt`,
        `repeating_${pa}weapons_dmgnumdice`,
        `repeating_${pa}weapons_dmgdietype`,
        `repeating_${pa}weapons_dmgbonusnum`,
      ],
      function (value) {
        let dmgdisplay,
          dmgformula = '';
        let strTranslation = getTranslationByKey('strength-abbr');
        let aglTranslation = getTranslationByKey('agility-abbr');
        let smaTranslation = getTranslationByKey('smarts-abbr');
        let spiTranslation = getTranslationByKey('spirit-abbr');
        let vigTranslation = getTranslationByKey('vigor-abbr');
        //Step One: Get the Attribute, if one is selected
        console.log('The Value: ' + value[`repeating_${pa}weapons_damageatt`]);
        if (value[`repeating_${pa}weapons_damageatt`] === 'strength') {
          dmgdisplay = strTranslation;
          dmgformula = `@{${pa}strength_rank}`;
        } else if (value[`repeating_${pa}weapons_damageatt`] === 'agility') {
          dmgdisplay = aglTranslation;
          dmgformula = '@{agility_rank}';
        } else if (value[`repeating_${pa}weapons_damageatt`] === 'smarts') {
          dmgdisplay = smaTranslation;
          dmgformula = '@{smarts_rank}';
        } else if (value[`repeating_${pa}weapons_damageatt`] === 'spirit') {
          dmgdisplay = spiTranslation;
          dmgformula = '@{spirit_rank}';
        } else if (value[`repeating_${pa}weapons_damageatt`] === 'vigor') {
          dmgdisplay = vigTranslation;
          dmgformula = '@{vigor_rank}';
        } else {
          console.log('No Attribute for this selection');
          dmgdisplay = '';
          dmgformula = '';
        }
        //Step Two: Determine the number of dice
        let numDice = parseInt(value[`repeating_${pa}weapons_dmgnumdice`]) || 0;
        if (numDice > 100) {
          console.log(
            'Number of Dice too great, not using it as part of the damage expression'
          );
          dmgdisplay = dmgdisplay;
          dmgformula = dmgformula;
        } else if (numDice === 0) {
          console.log('No Dice Type to roll');
          dmgdisplay = dmgdisplay;
          dmgformula = dmgformula;
        } else if (numDice < 0) {
          log('Number of Dice', 'Less than -1, use Variable', 'firebrick');
          dmgdisplay =
            '1' +
            value[`repeating_${pa}weapons_dmgnumdice`] +
            value[`repeating_${pa}weapons_dmgdietype`].replace('!', '');
          dmgformula =
            '?{' + getTranslationByKey('number-of-damage-dice-to-roll');
          let tempNum = numDice * -1;
          for (a = tempNum; a > 0; a--) {
            dmgformula += '|' + tempNum;
            tempNum -= 1;
          }
          dmgformula += '}' + value[`repeating_${pa}weapons_dmgdietype`];
        } else {
          // Means the number of dice is bettween 1 and 100
          if (value[`repeating_${pa}weapons_damageatt`] === 'na') {
            dmgdisplay =
              value[`repeating_${pa}weapons_dmgnumdice`] +
              value[`repeating_${pa}weapons_dmgdietype`].replace('!', '');
            dmgformula =
              value[`repeating_${pa}weapons_dmgnumdice`] +
              value[`repeating_${pa}weapons_dmgdietype`];
          } else {
            dmgdisplay +=
              '+' +
              value[`repeating_${pa}weapons_dmgnumdice`] +
              value[`repeating_${pa}weapons_dmgdietype`].replace('!', '');
            dmgformula +=
              '+' +
              value[`repeating_${pa}weapons_dmgnumdice`] +
              value[`repeating_${pa}weapons_dmgdietype`];
          }
        }
        console.log('___ Stuff so far: ' + dmgdisplay + ' ___');
        //Step Three:  Determine if we need to add a Modifier
        let checkString = value[`repeating_${pa}weapons_dmgbonusnum`];
        //will match anything from a single number to #d#!+/-###
        //const modFormat = /^(\d*d?\d{1,2}!)?([\+-]?\d{0,3})$/g;
        const modFormat = /^(-?\d*)((d?)(\d{1,2}))(!?)?([\+-]?)(\d{0,3})$/g;
        let modifier = checkString.match(modFormat);
        console.log('Modifier: ' + modifier);
        let names = [
          'fullExpression',
          'preNum',
          'fullDieType',
          'die',
          'dieType',
          'ace',
          'modType',
          'postNum',
        ];
        let result = modFormat.exec(checkString);
        console.log('checkString Value: ' + checkString);
        if (modifier === null) {
          if (dmgdisplay.length > 0) {
            dmgdisplay = dmgdisplay;
            dmgformula = dmgformula;
          } else {
            dmgdisplay = 'None';
            dmgformula = '1d0[None]';
          }
        } else {
          //modifier is not null
          if (dmgformula.length > 0) {
            dmgformula += '+' + modifier;
            dmgdisplay += '+' + modifier;
          } else {
            dmgformula = modifier;
            dmgdisplay = modifier;
          }
        }
        //Step Four: update the values
        console.log('!!! Damage: ' + dmgdisplay + ' !!!');
        console.log('!!! Formula: ' + dmgformula + ' !!!');
        const setweaponvals = {};
        setweaponvals[`repeating_${pa}weapons_weapondamage`] = dmgdisplay;
        setweaponvals[`repeating_${pa}weapons_weapondmg`] = dmgformula;
        setweaponvals[`repeating_${pa}weapons_highlightdamage`] = '0';
        setAttrs(setweaponvals);
        /*switch (pa) {
                    case "pa":
                        setAttrs({
                            repeating_paweapons_weapondamage: dmgdisplay,
                            repeating_paweapons_weapondmg: dmgformula,
                        });
                        break;
                    case "ra":
                        setAttrs({
                            repeating_raweapons_weapondamage: dmgdisplay,
                            repeating_raweapons_weapondmg: dmgformula,
                        });
                        break;
                    default:
                        setAttrs({
                            repeating_weapons_weapondamage: dmgdisplay,
                            repeating_weapons_weapondmg: dmgformula,
                            repeating_weapons_highlightdamage: "0",
                        });
                        break;
                }*/
      }
    );
  }
);

//Spell Damage config
on(
  'change:repeating_spells:power change:repeating_spells:spelldamageatt change:repeating_spells:spelldmgnumdice change:repeating_spells:spelldmgdietype change:repeating_spells:spelldmgbonusnum',
  function () {
    getAttrs(
      [
        'agility_display',
        'smarts_rank',
        'spirit_rank',
        'strength_rank',
        'vigor_rank',
        'repeating_spells_spelldamageatt',
        'repeating_spells_spelldmgnumdice',
        'repeating_spells_spelldmgdietype',
        'repeating_spells_spelldmgbonusnum',
      ],
      function (value) {
        let dmgdisplay,
          dmgformula = '';
        let strTranslation = getTranslationByKey('strength-abbr');
        let aglTranslation = getTranslationByKey('agility-abbr');
        let smaTranslation = getTranslationByKey('smarts-abbr');
        let spiTranslation = getTranslationByKey('spirit-abbr');
        let vigTranslation = getTranslationByKey('vigor-abbr');
        //Step One: Get the Attribute, if one is selected
        console.log('The Value: ' + value.repeating_spells_spelldamageatt);
        if (value.repeating_spells_spelldamageatt === 'strength') {
          dmgdisplay = strTranslation;
          dmgformula = '@{strength_rank}';
        } else if (value.repeating_spells_spelldamageatt === 'agility') {
          dmgdisplay = aglTranslation;
          dmgformula = '@{agility_rank}';
        } else if (value.repeating_spells_spelldamageatt === 'smarts') {
          dmgdisplay = smaTranslation;
          dmgformula = '@{smarts_rank}';
        } else if (value.repeating_spells_spelldamageatt === 'spirit') {
          dmgdisplay = spiTranslation;
          dmgformula = '@{spirit_rank}';
        } else if (value.repeating_spells_spelldamageatt === 'vigor') {
          dmgdisplay = vigTranslation;
          dmgformula = '@{vigor_rank}';
        } else {
          console.log('No Attribute for this selection');
          dmgdisplay = '';
          dmgformula = '';
        }
        //Step Two: Determine the number of dice
        let numDice = parseInt(value.repeating_spells_spelldmgnumdice) || 0;
        console.log('Number of Dice: ' + numDice);
        if (numDice > 100) {
          console.log(
            'Number of Dice too great, not using it as part of the damage expression'
          );
          dmgdisplay = dmgdisplay;
          dmgformula = dmgformula;
        } else if (numDice === 0) {
          console.log('No Dice Type to roll');
          dmgdisplay = dmgdisplay;
          dmgformula = dmgformula;
        } else if (numDice < 0) {
          log('Number of Dice', 'Less than -1, use Variable', 'firebrick');
          dmgdisplay =
            '1' +
            value.repeating_spells_spelldmgnumdice +
            value.repeating_spells_spelldmgdietype.replace('!', '');
          dmgformula =
            '?{' + getTranslationByKey('number-of-damage-dice-to-roll');
          let tempNum = numDice * -1;
          for (a = tempNum; a > 0; a--) {
            dmgformula += '|' + tempNum;
            tempNum -= 1;
          }
          dmgformula += '}' + value.repeating_spells_spelldmgdietype;
        } else {
          // Means the number of dice is bettween 1 and 100
          if (value.repeating_spells_spelldamageatt === 'na') {
            dmgdisplay =
              value.repeating_spells_spelldmgnumdice +
              value.repeating_spells_spelldmgdietype.replace('!', '');
            dmgformula =
              value.repeating_spells_spelldmgnumdice +
              value.repeating_spells_spelldmgdietype;
          } else {
            dmgdisplay +=
              '+' +
              value.repeating_spells_spelldmgnumdice +
              value.repeating_spells_spelldmgdietype.replace('!', '');
            dmgformula +=
              '+' +
              value.repeating_spells_spelldmgnumdice +
              value.repeating_spells_spelldmgdietype;
          }
        }
        console.log('___ Stuff so far: ' + dmgdisplay + ' ___');
        //Step Three:  Determine if we need to add a Modifier
        let checkString = value.repeating_spells_spelldmgbonusnum;
        //will match anything from a single number to #d#!+/-###
        //const modFormat = /^(\d*d?\d{1,2}!)?([\+-]?\d{0,3})$/g;
        const modFormat = /^(-?\d*)((d?)(\d{1,2}))(!?)?([\+-]?)(\d{0,3})$/g;
        let modifier = checkString.match(modFormat);
        console.log('Modifier: ' + modifier);
        let names = [
          'fullExpression',
          'preNum',
          'fullDieType',
          'die',
          'dieType',
          'ace',
          'modType',
          'postNum',
        ];
        let result = modFormat.exec(checkString);
        console.log('checkString Value: ' + checkString);
        if (modifier === null) {
          if (dmgdisplay.length > 0) {
            dmgdisplay = dmgdisplay;
            dmgformula = dmgformula;
          } else {
            dmgdisplay = 'None';
            dmgformula = '1d0[None]';
          }
        } else {
          //modifier is not null
          if (dmgformula.length > 0) {
            dmgformula += '+' + modifier;
            dmgdisplay += '+' + modifier;
          } else {
            dmgformula = modifier;
            dmgdisplay = modifier;
          }
        }
        //Step Four: update the values
        console.log('!!! Damage: ' + dmgdisplay + ' !!!');
        console.log('!!! Formula: ' + dmgformula + ' !!!');
        setAttrs({
          repeating_spells_powerdamage: dmgdisplay,
          repeating_spells_spelldmg: dmgformula,
          repeating_spells_shighlightdamage: '0',
        });
      }
    );
  }
);

// Handle naming of Power Labels
function powerLabel() {
  getAttrs(['magictype', 'custompowerlabel'], function (v) {
    let slabel = '';
    let plabel = '';
    switch (v.magictype) {
      case '1': //Miracles
        console.log('+x+ Setting Power Label to Miracles +x+');
        slabel = getTranslationByKey('miracle');
        plabel = getTranslationByKey('miracles');
        break;
      case '2': //Psionics
        console.log('+x+ Setting Power Label to Psionics +x+');
        slabel = getTranslationByKey('psionic-ability');
        plabel = getTranslationByKey('psionics');
        break;
      case '3': //Spells
        console.log('+x+ Setting Power Label to Spells +x+');
        slabel = getTranslationByKey('spell');
        plabel = getTranslationByKey('spells');
        break;
      case '4': //Rituals
        console.log('+x+ Setting Power Label to Rituals +x+');
        slabel = getTranslationByKey('ritual');
        plabel = getTranslationByKey('rituals');
        break;
      case '5': //Weird Science Gadgets
        console.log('+x+ Setting Power Label to Weird Science Gadgets +x+');
        slabel = getTranslationByKey('weird-science-gadget');
        plabel = getTranslationByKey('weird-science-gadgets');
        break;
      case '6':
        console.log('+x+ Setting Power Label to Custom +x+');
        if (v.custompowerlabel === '') {
          slabel = getTranslationByKey('power');
          plabel = getTranslationByKey('powers');
        } else {
          slabel = v.custompowerlabel;
          plabel = v.custompowerlabel;
        }
        break;
      default:
        //Powers
        console.log('+x+ Setting Power Label to Powers +x+');
        slabel = getTranslationByKey('power');
        plabel = getTranslationByKey('powers');
        break;
    }
    console.log(`*** Singular Label: ${slabel} ***`);
    console.log(`*** Plural Label: ${plabel} ***`);
    setAttrs({
      powerlabelsingular: slabel,
      powerlabelplural: plabel,
    });
  });
}

on('change:magictype change:custompowerlabel', function () {
  powerLabel();
});

function getBonusFields(repSection, setField) {
  //setField should = vbonusdamage || weaponsbdt || spellsbdt
  let fieldlist = {};
  let preBonusDmg;
  repSection === 'paweapons' || repSection === 'raweapons'
    ? (preBonusDmg = 'weapons')
    : (preBonusDmg = repSection);
  getSectionIDs(`repeating_${repSection}`, function (idArray) {
    for (var i = 0; i < idArray.length; i++) {
      log(
        `Key`,
        `repeating_${repSection}_${idArray[i]}_${preBonusDmg}bonusdmg`,
        'yellow'
      );
      log(`Value`, `@{${setField}}`, 'yellow');
      //Made change here on 12/17/2021
      setField === 'weaponsbdt'
        ? (fieldlist[
            `repeating_${repSection}_${idArray[i]}_${preBonusDmg}bonusdmg`
          ] = '@{weaponsbdtnum}@{' + setField + '}')
        : setField === 'spellsbdt'
        ? (fieldlist[
            `repeating_${repSection}_${idArray[i]}_${preBonusDmg}bonusdmg`
          ] = '@{spellssbdtnum}@{' + setField + '}')
        : (fieldlist[
            `repeating_${repSection}_${idArray[i]}_${preBonusDmg}bonusdmg`
          ] = '@{' + setField + '}');
    }
    log('fieldlist', JSON.stringify(fieldlist), 'yellow');
    setAttrs(fieldlist);
  });
}

function getRaiseRule(raiseRuleValue) {
  let useField;
  if (raiseRuleValue === '1') {
    //Using Variable Bonus Damage
    console.log('Using variable bonus damage: set up query...');
    let qString = getTranslationByKey('bonus-damage-die-type');
    setAttrs({
      vbonusdamage:
        `?{${qString}` +
        '|' +
        getTranslationByKey('d6') +
        '|' +
        getTranslationByKey('d8') +
        '|' +
        getTranslationByKey('d10') +
        '|' +
        getTranslationByKey('d12') +
        '|' +
        getTranslationByKey('d4') +
        '}',
    });
    useField = 'vbonusdamage';
    // getBonusFields("weapons","vbonusdamage");
    // getBonusFields("spells","vbonusdamage");
  } else {
    //Used to be an else if statement checking for raiseRuleValue === "2"
    console.log('Using static variable bonus damage: determine damage to use');
    useField = 'bdt';
    /*let fieldList = ["weapons","spells"];
        	let finalList = {};*/
    // getBonusFields("weapons","weaponsbdt");
    // getBonusFields("spells","spellsbdt");
  }
  /*else {
    		console.log("Not using using Variable Bonus Damage...");
    		setAttrs({vbonusdamage: '1d6'});
    		useField = "vbonusdamage";
    	}*/
  return useField;
}

on('change:raisehbrule', function (eventInfo) {
  log('Raise Rule', 'Changed', 'yellow');
  let useField = getRaiseRule(eventInfo.newValue);
  log('Raise uses field', useField, 'red');
  if (useField === 'vbonusdamage') {
    getBonusFields('weapons', useField);
    getBonusFields('paweapons', useField);
    getBonusFields('raweapons', useField);
    getBonusFields('spells', useField);
  } else {
    getBonusFields('weapons', `weapons${useField}`);
    getBonusFields('paweapons', `weapons${useField}`);
    getBonusFields('raweapons', `weapons${useField}`);
    getBonusFields('spells', `spells${useField}`);
  }
});

function getTemplateBonusString(autoRollSetting, repeatingSection) {
  //setField should = vbonusdamage || weaponsbdt || spellsbdt
  let valueString;
  let preBonusDmg;
  repeatingSection === 'paweapons' || repeatingSection === 'raweapons'
    ? (preBonusDmg = 'weapons')
    : (preBonusDmg = repeatingSection);
  if (autoRollSetting === '1') {
    //Auto-roll the bonus damage
    valueString = `{{bonus_die=[[@{${preBonusDmg}bonusdmg}!]]}}`;
  } else {
    //Show button to Roll Bonus Damage
    valueString = `{{bonus_die=[Roll Bonus Damage](~repeating_${repeatingSection}_${preBonusDmg}bonusDamage)}}`;
  }
  log('Bonus Die String for the Template', valueString, 'darkgoldenrod');
  return valueString;
}

function setBonusAutoroll(autoRollSetting, repSection) {
  //setField should = vbonusdamage || weaponsbdt || spellsbdt
  let fieldlist = {};
  getSectionIDs(`repeating_${repSection}`, function (idArray) {
    for (var i = 0; i < idArray.length; i++) {
      fieldlist[`repeating_${repSection}_${idArray[i]}_${repSection}bonusDie`] =
        getTemplateBonusString(autoRollSetting, repSection);
    }
    setAttrs(fieldlist);
  });
}

on(
  'change:autorollbonusdmg change:repeating_weapons:weapon change:repeating_weapons:weapondamage change:repeating_weapons:weaponsbdt change:repeating_weapons:weaponsbdtnum change:repeating_spells:power change:repeating_spells:powerdamage change:repeating_spells:spellsbdt change:repeating_spells:spellsbdtnum change:repeating_paweapons:weapon change:repeating_paweapons:weapondamage change:repeating_paweapons:weaponsbdt change:repeating_paweapons:weaponsbdtnum change:repeating_raweapons:weapon change:repeating_raweapons:weapondamage change:repeating_raweapons:weaponsbdtchange:repeating_raweapons:weaponsbdtnum',
  function (eventInfo) {
    //If a new weapon or spell is created, need to configure the Bonus Damage roll appropriately
    //Get which repeating section the change is from
    if (eventInfo.sourceAttribute === 'autorollbonusdmg') {
      //Need to change all existing Weapons and Spells
      setBonusAutoroll(eventInfo.newValue, 'weapons');
      setBonusAutoroll(eventInfo.newValue, 'paweapons');
      setBonusAutoroll(eventInfo.newValue, 'raweapons');
      setBonusAutoroll(eventInfo.newValue, 'spells');
    } else {
      //Need to change only the current row
      //get autorollbonusdmg value
      let repeatingSection = eventInfo.sourceAttribute.split('_');
      console.log('*** Bonus Damage Change Watch ***');
      log('Repeating Section', repeatingSection[1], 'red');
      getAttrs(['autorollbonusdmg', 'RaiseHBRule'], function (v) {
        let valueString = {};
        let rSection = repeatingSection[1];
        let preBonusDmg;
        rSection === 'paweapons' || rSection === 'raweapons'
          ? (preBonusDmg = 'weapons')
          : (preBonusDmg = rSection);
        valueString[`repeating_${rSection}_${rSection}bonusDie`] =
          getTemplateBonusString(v.autorollbonusdmg, rSection);
        //set the appropriate Raise Rule for this weapon
        let raiseRule = getRaiseRule(v.RaiseHBRule);
        let vbonusRoll = true;
        if (raiseRule === 'bdt') {
          raiseRule = `${preBonusDmg}bdt`;
          vbonusRoll = false;
        }
        vbonusRoll
          ? (valueString[
              `repeating_${rSection}_${preBonusDmg}bonusdmg`
            ] = `@{${raiseRule}}`)
          : // : valueString[`repeating_${rSection}_${preBonusDmg}bonusdmg`] = `@{dmgbonusnum}@{${raiseRule}}`;
            (valueString[
              `repeating_${rSection}_${preBonusDmg}bonusdmg`
            ] = `@{${preBonusDmg}bdtnum}@{${raiseRule}}`);
        console.log(valueString);
        setAttrs(valueString);
      });
    }
  }
);

on(
  'change:repeating_spells:shownotes change:repeating_spells:spellbutton',
  function () {
    /*If spellbutton is set to Atk+Dmg, then don't show notes on damage roll*/
    getAttrs(
      ['repeating_spells_shownotes', 'repeating_spells_spellbutton'],
      function (v) {
        console.log(
          `shownotes: ${v.repeating_spells_shownotes} || spellbutton: ${v.repeating_spells_spellbutton}`
        );
        if (v.repeating_spells_shownotes != '0') {
          //showing notes is checked
          console.log('Showing Notes');
          if (v.repeating_spells_spellbutton === '0') {
            //button is set to Attack + Damage...don't show notes on damage roll
            console.log('Set Damage Rolls to not show notes');
            setAttrs({ repeating_spells_dmgshownotes: '0' });
          } else {
            console.log('Set Damage to show Spell Notes');
            setAttrs({
              repeating_spells_dmgshownotes: '{{notes=@{spellnotes}}}',
            });
          }
        } else {
          //Not showing notes, don't show notes on damage rolls
          console.log('Set Damage Rolls to not show notes');
          setAttrs({ repeating_spells_dmgshownotes: '0' });
        }
      }
    );
  }
);

function setSkillDropdown(section, field, value, rowid) {
  let repsection = `repeating_${section}`;
  let setskill = {};
  if (Array.isArray(field) && value === 'get names') {
    //is Array
    console.log('Field array: ' + field);
    repsection += `_${rowid}_`;
    console.log('!!! Passed an Array !!!');
    getAttrs(field, function (v) {
      let setfield;
      let fieldprefix;
      let setvalue;
      if (
        section === 'weapons' ||
        section === 'paweapons' ||
        section === 'raweapons'
      ) {
        fieldprefix = 'r';
      } else {
        fieldprefix = 's';
      }
      for (let a = 0; a < field.length; a++) {
        console.log('iii section ID: ' + rowid + ' iii');
        setfield = repsection + fieldprefix + field[a];
        setvalue = v[field[a]]; // || "something defaulty";
        console.log(`iii setfield: ${setfield} iii`);
        console.log(`iii setvalue: ${setvalue} iii`);
        setskill[setfield] = setvalue;
      }
      /*let defaultval = field[0].split('name');
            	if (section === "weapons") { setfield = repsection + "weaponskill"; }
            	else { setfield = repsection + "spellskill"; }
            	setskill[setfield] = defaultval;*/
      console.log('Setting: ' + JSON.stringify(setskill));
      setAttrs(setskill);
    });
  } else {
    console.log(
      'iii passed a single field, so need to update that single field iii'
    );
    getSectionIDs(repsection, function (idArray) {
      //passing in a single field
      for (let i = 0; i < idArray.length; i++) {
        console.log(`${repsection}_${idArray[i]}_${field}: ${value}`);
        setskill[`${repsection}_${idArray[i]}_${field}`] = value;
      }
      setAttrs(setskill);
    });
  }
}

const weaponsskilllist = [
  'fighting',
  'athletics',
  'shooting',
  'weirdscience',
  'faith',
  'focus',
  'performance',
  'psionics',
  'spellcasting',
];
weaponsskilllist.forEach(weaponsskill => {
  on(`change:${weaponsskill}name`, function (eventInfo) {
    log('Weapon Skill List', 'Skill Name Change', 'lime');
    let field = 'r' + eventInfo.sourceAttribute;
    let value = eventInfo.newValue;
    setSkillDropdown('weapons', field, value);
    setSkillDropdown('paweapons', field, value);
    setSkillDropdown('raweapons', field, value);
  });
});

const spellskilllist = [
  'faith',
  'athletics',
  'focus',
  'performance',
  'psionics',
  'spellcasting',
  'weirdscience',
];
spellskilllist.forEach(spellskill => {
  on(`change:${spellskill}name`, function (eventInfo) {
    log('Spell Skill List', 'Skill Name Change', 'lime');
    console.log('Triggering Attribute: ' + eventInfo.sourceAttribute);
    let field = 's' + eventInfo.sourceAttribute;
    let value = eventInfo.newValue;
    setSkillDropdown('spells', field, value);
  });
});

const weaponsskillnamelist = [
  'fightingname',
  'athleticsname',
  'shootingname',
  'weirdsciencename',
  'faithname',
  'focusname',
  'performancename',
  'psionicsname',
  'spellcastingname',
]; // Considering a refactor here
const spellskillnamelist = [
  'faithname',
  'athleticsname',
  'focusname',
  'performancename',
  'psionicsname',
  'spellcastingname',
  'weirdsciencename',
]; // similarly could consider a refactor
on(
  'change:repeating_spells:spellbutton change:repeating_weapons:weaponbutton change:repeating_paweapons:weaponbutton change:repeating_raweapons:weaponbutton',
  function (eventInfo) {
    console.log('iii sourceAttribute: ' + eventInfo.sourceAttribute + ' iii');
    let parts = eventInfo.sourceAttribute.split('_');
    let field, value;
    if (
      parts[1] === 'weapons' ||
      parts[1] === 'paweapons' ||
      parts[1] === 'raweapons'
    ) {
      field = weaponsskillnamelist;
    } else {
      field = spellskillnamelist;
    }
    if (eventInfo.newValue === '2' || eventInfo.newValue === '0') {
      console.log('Make sure the drop down is populated with skill names');
      setSkillDropdown(parts[1], field, 'get names', parts[2]);
    } else {
      console.log('No need to update anything...');
    }
  }
);

on('change:numberofabs', function (eventInfo) {
  console.log('Number of ABs: ' + eventInfo.newValue);
  if (eventInfo.newValue == '1') {
    getSectionIDs('spells', function (idArray) {
      let setattrs = {};
      for (let i = 0; i < idArray.length; i++) {
        console.log(`repeating_spells_${idArray[i]}_powercolor = "white"`);
        setattrs[`repeating_spells_${idArray[i]}_powergroup`] = 'ab1';
      }
      setattrs['ab1color'] = 'white';
      setAttrs(setattrs);
    });
  } else {
    console.log('Skipped the getSectionIDs portion of things...');
  }
});

on('clicked:removeab', function () {
  getAttrs(['numberofabs'], function (v) {
    let abcount = parseInt(v.numberofabs) || 0;
    if (abcount > 1) {
      abcount -= 1;
      setAttrs({ numberofabs: abcount });
    } else {
      console.log('Min Number of ABs reached');
    }
  });
});

const powerlabels = [
  'ablabel',
  'ablabel2',
  'ablabel3',
  'ablabel4',
  'ablabel5',
  'ab1color',
  'ab2color',
  'ab3color',
  'ab4color',
  'ab5color',
];
powerlabels.forEach(powerlabel => {
  on(`change:${powerlabel}`, function (eventInfo) {
    console.log(
      'Attribute that changed was: ' + eventInfo.sourceAttribute.slice(3)
    );
    getSectionIDs('repeating_spells', function (idArray) {
      const plabels = idArray.map(
        id => `repeating_spells_${id}_rpt${powerlabel}`
      );
      let newVal = eventInfo.newValue;
      const settings = plabels.reduce(
        (obj, item) => ((obj[item] = newVal), obj),
        {}
      );
      console.log('Setting: ' + JSON.stringify(settings));
      setAttrs(settings);
    });
  });
});

on('change:repeating_spells:powergroup', function (eventInfo) {
  let groupColor = eventInfo.newValue;
  getAttrs([`repeating_spells_rpt${groupColor}color`], function (v) {
    let rowColor = v[`repeating_spells_rpt${groupColor}color`];
    console.log('New Row Color: ' + rowColor);
    setAttrs({ repeating_spells_powercolor: rowColor });
  });
});

const powerColors = [
  'rptab1color',
  'rptab2color',
  'rptab3color',
  'rptab4color',
  'rptab5color',
];
powerColors.forEach(powerColor => {
  on(`change:repeating_spells:${powerColor}`, function (eventInfo) {
    let colorNum = eventInfo.sourceAttribute;
    console.log('### Color Attribute: ' + colorNum + '####');
    console.log('### Color that changed: ' + colorNum.slice(-6, -5) + ' ###');
    console.log('New Color: ' + eventInfo.newValue);
    getAttrs(['repeating_spells_powergroup'], function (v) {
      console.log('>>> Power Group: ' + v.repeating_spells_powergroup + ' <<<');
      console.log(
        '<<< Power Group Value: ' +
          v.repeating_spells_powergroup.slice(2, 3) +
          ' >>>'
      );
      if (v.repeating_spells_powergroup.slice(2, 3) == colorNum.slice(-6, -5)) {
        console.log('Need to update the powercolor');
        setAttrs({
          repeating_spells_powercolor: eventInfo.newValue,
        });
      } else {
        console.log('No need to update color');
      }
    });
  });
});

const updateABLabels = function () {
  const powerlabels = [
    'ablabel',
    'ablabel2',
    'ablabel3',
    'ablabel4',
    'ablabel5',
    'ab1color',
    'ab2color',
    'ab3color',
    'ab4color',
    'ab5color',
  ];
  console.log('!!! Updating AB Labels and Colors !!!');
  powerlabels.forEach(powerlabel => {
    getSectionIDs('repeating_spells', function (idArray) {
      getAttrs([`${powerlabel}`], function (v) {
        console.log(`Attribute (${powerlabel}): ` + v[`${powerlabel}`]);
        const plabels = idArray.map(
          id => `repeating_spells_${id}_rpt${powerlabel}`
        );
        const settings = plabels.reduce(
          (obj, item) => ((obj[item] = v[`${powerlabel}`]), obj),
          {}
        );
        const abini = idArray.map(id2 => `repeating_spells_${id2}_ablabsinit`);
        const settings2 = abini.reduce(
          (obj, item) => ((obj[item] = '1'), obj),
          {}
        );
        console.log('Setting: ' + JSON.stringify(settings));
        setAttrs(settings);
        setAttrs(settings2);
      });
    });
  });
};

on('change:repeating_spells:power', function (eventInfo) {
  getAttrs(['repeating_spells_ablabsinit'], function (v) {
    if (v.repeating_spells_ablabsinit == '0') {
      updateABLabels();
    } else {
      console.log('Labels already initialized...');
    }
  });
});
  const setWoundsMod = function(flag) {
    console.log("<==== Updating woundsMod ====>");
    getAttrs(
        [
            "wounds",
            "reducewoundsby",
            "increasewoundsby",
            "maxwoundmods",
            "reducereason",
            "increasereason",
            "maxreason",
        ],
        function(lvalue) {
            let wound = parseInt(lvalue.wounds) || 0;
            /*let nerves = parseInt(lvalue.NoS)||0;*/
            let reduce = parseInt(lvalue.reducewoundsby) || 0;
            let increase = parseInt(lvalue.increasewoundsby) || 0;
            let max = parseInt(lvalue.maxwoundmods) || 0;

            console.log(
                `<==== Wounds: ${wound} || Reduce: ${reduce} || Increase: ${increase} || Max: ${max} ====>`
            );
            /*var wMS = wound+nerves;*/
            let wMS =
                Math.abs(wound) - Math.abs(reduce) + Math.abs(increase);
            console.log(`+++ wMS: ${wMS} +++`);
            if (wound === 0) {
                console.log("Made it wounds = 0");
                wMS = 0;
            } else {
                console.log("Made it wounds != 0");
                if (wMS < 0) {
                    console.log("Wounds are less than 0, make it 0");
                    wMS = 0;
                }
                if (wMS > Math.abs(max)) {
                    console.log(
                        "wMS is greater than the Max, make it the max"
                    );
                    wMS = Math.abs(max);
                }
            }
            if (flag === "silent") {
                console.log("Setting woundsMod silently");
                setAttrs({ woundsMod: wMS }, { silent: true });
            } else {
                setAttrs({ woundsMod: wMS });
            }
            console.log("<==== Finished updating woundsMod ====>");
        }
    );
};

on(
    "change:wounds change:NoS change:reducewoundsby change:increasewoundsby change:maxwoundmods change:reducereason change:increasereason change:maxreason",
    function() {
        setWoundsMod();
    }
);

const setFatigueMod = function(flag) {
    console.log("<==== Updating fatigueMod ====>");
    getAttrs(
        [
            "fatigue",
            "reducefatigueby",
            "increasefatigueby",
            "maxfatiguemods",
            "fatiguereducereason",
            "fatigueincreasereason",
            "fatiguemaxreason",
        ],
        function(lvalue) {
            let fatigue = parseInt(lvalue.fatigue) || 0;
            /*let nerves = parseInt(lvalue.NoS)||0;*/
            let reduce = parseInt(lvalue.reducefatigueby) || 0; //should be a positive number
            let increase = parseInt(lvalue.increasefatigueby) || 0; //should be positive, but need to make negaitve
            let max = parseInt(lvalue.maxfatiguemods) || 0; //should be negative number

            console.log(
                `<==== Fatigue: ${fatigue} || Reduce: ${reduce} || Increase: ${increase} || Max: ${max} ====>`
            );
            /*var wMS = wound+nerves;*/
            let fMS =
                Math.abs(fatigue) - Math.abs(reduce) + Math.abs(increase);
            console.log(`+++ fMS: ${fMS} +++`);
            if (fatigue === 0) {
                console.log("Made it fatigue = 0");
                fMS = 0;
            } else {
                console.log("Made it fatigue != 0");
                if (fMS < 0) {
                    console.log("Fatigue is less than 0, make it 0");
                    fMS = 0;
                }
                if (fMS > Math.abs(max)) {
                    console.log(
                        "fMS is greater than the Max, make it the max"
                    );
                    fMS = Math.abs(max);
                }
            }
            if (flag === "silent") {
                console.log("Setting faitugeMod silently");
                setAttrs({ fatigueMod: fMS }, { silent: true });
            } else {
                setAttrs({ fatigueMod: fMS });
            }
            console.log("<==== Finished updating fatigueMod ====>");
        }
    );
};

on(
    "change:fatigue change:reducefatigueby change:increasefatigueby change:maxfatiguemods change:fatiguereducereason change:fatigueincreasereason change:fatiguemaxreason",
    function() {
        setFatigueMod();
    }
);

const setModSums = function() {
    getAttrs(
        ["woundsMod", "fatigueMod", "encumbrance", "distracted"],
        function(lvalue) {
            //let tMod = parseInt(lvalue.ttmod)||0;
            let wMod = parseInt(lvalue.woundsMod) || 0;
            let fMod = parseInt(lvalue.fatigueMod) || 0;
            let eMod = parseInt(lvalue.encumbrance) || 0;
            let dMod = parseInt(lvalue.distracted) || 0;

            console.log(
                "<==== wounds:" +
                wMod +
                "||fatigue:" +
                fMod +
                "||encumbrance:" +
                eMod +
                "||distracted:" +
                dMod +
                " ====>"
            );
            let modSum = dMod - wMod - fMod;
            let modSumEnc = modSum + eMod;
            let modABS = Math.abs(wMod) + Math.abs(fMod) + Math.abs(dMod);
            let modABSEnc = modABS + Math.abs(eMod);
            console.log("!!!! modSum: " + modSum + " !!!!");
            console.log("!!!! modSumEnc: " + modSumEnc + " !!!!");
            console.log("!!!! absmod: " + modABS + " !!!!");
            setAttrs({
                ModSum: modSum,
                ModSumEnc: modSumEnc,
                absmod: modABS,
                absmodenc: modABSEnc,
            });
        }
    );
};

on(
    "change:woundsmod change:fatiguemod change:encumbrance change:distracted",
    function() {
        setModSums();
    }
);

on("change:promptmods", function(eventInfo) {
    if (eventInfo.newValue === "on") {
        //prompt for mods
        let setVal, setDmgVal;
        queryPop = getTranslationByKey(
            "miscellaneous-abbr-trait-modifier-plural-singular"
        );
        queryDmgPop = getTranslationByKey(
            "miscellaneous-abbr-damage-modifier-plural-singular"
        );
        setVal = `?{${queryPop}|0}`;
        setDmgVal = `?{${queryDmgPop}|0}`;
        setAttrs({
            traitmods: setVal,
            damagemods: setDmgVal,
        });
    } else {
        //don't prompt for modifiers
        setAttrs({
            traitmods: "@{ttmod}",
            damagemods: "@{dmgmod}",
        });
    }
});

on("change:showmods", function(eventInfo) {
    let setDamageMod, setTraitMod, setTraitModEnc;
    console.log("newValue: " + eventInfo.newValue);
    if (eventInfo.newValue == "on") {
        setTraitMod = "{{mods=[[1d0+@{absmod}+abs(@{traitmods}) ]] }}";
        setTraitModEnc =
            "{{mods=[[1d0+@{absmodenc}+abs(@{traitmods}) ]] }} {{showenc=[[1d0+@{encumbrance}]]}} {{encumbrance=@{encumbrance}}}";
        setDamageMod = "{{mods=[[1d0+[[abs(@{damagemods})]] ]] }}";
    } else {
        setTraitMod = `{{mods=[[1d0+0]]}}`;
        setTraitModEnc = `{{mods=[[1d0+0]]}}`;
        setDamageMod = `{{mods=[[1d0+0]]}}`;
    }
    console.log("setTraitMod: " + setTraitMod);
    console.log("setTraitModEnc: " + setTraitModEnc);
    setAttrs({
        setmods: setTraitMod,
        setmodsenc: setTraitModEnc,
        setdmgmods: setDamageMod,
    });
});// Button Bar Action Buttons are contained in workers.js file

on('clicked:noEditMode', function () {
  log('No edit Mode', 'Clicked', 'maroon');
  getAttrs(['rank', 'class'], function (v) {
    const rankLabel = ['novice', 'seasoned', 'veteran', 'heroic', 'legendary'];
    //const classLabel = ["freshman","sophmore","junior","senior","grad"];
    const rankDisplay = rankLabel[v.rank - 1];
    repeatingCount('hindrances', 'hindranceCount');
    repeatingCount('edges', 'edgeCount');
    repeatingCount('specialabilities', 'specialAbilityCount');
    repeatingCount('spells', 'powerCount');
    setAttrs({
      miniDisplay: 1,
      rank_display: getTranslationByKey(rankDisplay),
    });
  });
});

on('clicked:editMode', function () {
  log('Edit Mode', 'Clicked', 'maroon');
  setAttrs({
    miniDisplay: 0,
  });
});

on('clicked:repeating_weapons:wdamage', function () {
  //console.log("Damage Field clicked...show the Weapon config");
  setAttrs({
    repeating_weapons_showweaponconfig: 'on',
    repeating_weapons_highlightdamage: '1',
  });
});

on('clicked:repeating_spells:sdamage', function () {
  //console.log("Damage Field clicked...show the Weapon config");
  setAttrs({
    repeating_spells_showspellconfig: 'on',
    repeating_spells_shighlightdamage: '1',
  });
});

on('clicked:paceCur', function () {
  getAttrs(['showPaceMod'], function (v) {
    let hideval = '0';
    if (v.showPaceMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showPaceMod: hideval });
  });
});

on('clicked:parryCur clicked:parryButton', function () {
  getAttrs(['showParryMod'], function (v) {
    let hideval = '0';
    if (v.showParryMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showParryMod: hideval });
  });
});

on('clicked:toughnessCur clicked:toughnessButton', function () {
  getAttrs(['showToughnessMod'], function (v) {
    let hideval = '0';
    if (v.showToughnessMod === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showToughnessMod: hideval });
  });
});

// Show Wound Configuration Pane
on('clicked:woundButton', function () {
  getAttrs(['showWoundmods'], function (v) {
    let hideval = '0';
    if (v.showWoundmods === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showWoundmods: hideval });
  });
});

// Show Fatigue Configuration Pane
on('clicked:fatigueButton', function () {
  getAttrs(['showFatiguemods'], function (v) {
    let hideval = '0';
    if (v.showFatiguemods === 'on') {
      console.log("was hidden, but shouldn't be now");
    } else {
      console.log("Wasn't hidden, but needs to be...");
      hideval = 'on';
    }
    setAttrs({ showFatiguemods: hideval });
  });
});

on('clicked:powersectionconfig', function () {
  console.log('Do something');
  getAttrs(['showpowersectionconfig'], function (v) {
    if (v.showpowersectionconfig === '0') {
      //need to show the config
      setAttrs({
        showpowersectionconfig: 'show',
        powerconfigindicator: '2',
      });
    } else {
      //need to close config
      setAttrs({
        showpowersectionconfig: '0',
        powerconfigindicator: 'x',
      });
    }
  });
});

//Start Multiple AB Support Sheet Workers
on('clicked:addab', function () {
  getAttrs(['numberofabs'], function (v) {
    let abcount = parseInt(v.numberofabs) || 0;
    if (abcount < 5) {
      abcount += 1;
      console.log('abcount: ' + abcount);
      setAttrs({ numberofabs: abcount });
    } else {
      console.log('Max Number of ABs reached');
    }
  });
});

//Burn roll Parsing
on('clicked:BurnRoll_v1', event => {
  getAttrs(['burn_points', 'burn_die_type'], async function (v) {
    let lastCall = getTranslationByKey('burn-at-zero');
    let burnPoints = parseInt(v.burn_points || 0);
    // v.burn_die_type should be in the form of d6 already
    let dieType = v.burn_die_type;
    let rollResults = await startRoll(
      `&{template:info} {{name=@{character_name}}} {{item=Burn Roll}} {{burnroll=[[ 1${dieType} ]] }} {{lastcallroll=[[0d6]]}} {{lastcalldesc=${lastCall}}} {{theme=@{rolltemplate_theme}}}`,
      results => {
        log('results', JSON.stringify(results), 'pink');
        const rollTotal = rollResults.results.burnRoll.result;
        const computeObj = {};
        computeObj.burnroll = rollTotal;
        if (rollTotal === 1) {
          //need to reduce Burn points
          let newBurnPoints = burnPoints - 1;
          if (newBurnPoints === 0) {
            // Make sure Last Call Message displays
            computeObj.lastcallroll = 1;
          }
        }
        log('computeObj', JSON.stringify(computeObj), 'pink');
        finishRoll(results.rollId, computeObj);
        rollTotal === 1
          ? setAttrs({ burn_points: newBurnPoints })
          : log('Burn Points', "Didn't roll 1, no reduction", 'maroon');
      }
    );
  });
});

on('clicked:BurnRoll', event => {
  getAttrs(['burn_points', 'burn_die_type'], async function (v) {
    let lastCall = getTranslationByKey('burn-at-zero');
    let burnPoints = parseInt(v.burn_points || 0);
    log('Burn Points', burnPoints, 'maroon');
    // v.burn_die_type should be in the form of d6 already
    let dieType = v.burn_die_type;
    let rollResults = await startRoll(
      `&{template:info} {{name=@{character_name}}} {{item=Burn Roll}} {{burnroll=[[ 1${dieType} ]] }} {{lastcallroll=[[0d6]]}} {{lastcalldesc=${lastCall}}} {{theme=@{rolltemplate_theme}}}`
    );
    log('results', JSON.stringify(rollResults), 'pink');
    const rollTotal = rollResults.results.burnroll.result;
    const computeObj = {};
    let newBurnPoints;
    computeObj.burnroll = rollTotal;
    if (rollTotal === 1) {
      //need to reduce Burn points
      newBurnPoints = burnPoints - 1;
      log('New Burn Points Total', newBurnPoints, 'maroon');
      if (newBurnPoints === 0) {
        // Make sure Last Call Message displays
        computeObj.lastcallroll = 1;
      }
    }
    log('computeObj', JSON.stringify(computeObj), 'pink');
    finishRoll(rollResults.rollId, computeObj);
    rollTotal === 1
      ? setAttrs({ burn_points: newBurnPoints })
      : log('Burn Points', "Didn't roll 1, no reduction", 'maroon');
  });
});

on('clicked:powerArmorStateButton', event => {
  let attrsValues = {};
  let wornArmor = 'row IDs';
  //Get a list of regular Armor that is currently equipped
  getSectionIDs('armor', function (idArray) {
    let countOfAdvances = [];
    let listOfFields = [];
    for (let a = 0; a < idArray.length; a++) {
      listOfFields[listOfFields.length] =
        'repeating_armor_' + idArray[a] + '_armorWorn';
    }
    getAttrs(
      [
        'pa_armorState',
        'wornArmorRowIDs',
        ...listOfFields,
        'pa_embeddedtoughness',
        'pilotarmor',
        'power_armor_toughness',
      ],
      function (v) {
        if (v.pa_armorState === '0') {
          //clicked the button to put the armor on
          attrsValues['pa_armorState'] = '1';
          //cycle through the listOfFields to see which rows are turned on
          listOfFields.forEach(row => {
            if (v[`${row}`] === '1') {
              //it's worn add it to wornArmor
              wornArmor += `, ${row}`;
              //disable it on the sheet
              attrsValues[`${row}`] = '0';
            }
          });
          log('wornArmor', wornArmor, 'lime');
          //set wornArmorRowIDs
          attrsValues['wornArmorRowIDs'] = wornArmor;
          //set Power Armor Toughness
          attrsValues['power_armor_toughness'] = v.pa_embeddedtoughness;
        } else {
          //clicked the button to take the armor off
          attrsValues['pa_armorState'] = '0';
          //set power armor toughness to 0 (the pilot is no longer wearing it)
          attrsValues['power_armor_toughness'] = '0';
          //re-enable armor as it was before getting into the Power Armor
          let armorArray = v.wornArmorRowIDs.split(',');
          for (let b = 1; b < armorArray.length; b++) {
            let armorRow = armorArray[b].trim();
            log('armorRow', armorRow, 'lime');
            attrsValues[`${armorRow}`] = '1';
          }
          //reset wornArmorRowIDs
          attrsValues['wornArmorRowIDs'] = '';
        }
        //All the other calculations will be done by the sheetworker that handles Toughness Calculations
        log('Values to Be Set', JSON.stringify(attrsValues), 'lime');
        setAttrs(attrsValues);
      }
    );
  });
});
  const statblockCheck = function() {
    getAttrs(
        [
            "initstatblock",
            "initdesc",
            "initskills",
            "initderived",
            "initgear",
            "initspecabilities",
            "initpowers",
        ],
        function(v) {
            let statBlockvals = {};
            if (v.initstatblock === "0") {
                //stat block isn't fully initialized
                log(
                    "Stat Block",
                    "⚠⚠ Not Initilized...create it ⚠⚠",
                    "aquamarine"
                );
                if (v.initdesc === "0") {
                    log(
                        "Character Description",
                        "⚠⚠ Not Initilized...create it ⚠⚠",
                        "aquamarine"
                    );
                    descStatBlock();
                    statBlockvals["initdesc"] = "1";
                }
                if (v.initskills === "0") {
                    log(
                        "Skills",
                        "⚠⚠ Not Initilized...create them ⚠⚠",
                        "aquamarine"
                    );
                    skillsStatBlock();
                    statBlockvals["initskills"] = "1";
                }
                if (v.initderived === "0") {
                    log(
                        "Derived Stats",
                        "⚠⚠ Not Initilized...create them ⚠⚠",
                        "aquamarine"
                    );
                    derivedStatBlock();
                    statBlockvals["initderived"] = "1";
                }
                if (v.initgear === "0") {
                    log(
                        "Gear",
                        "⚠⚠ Not Initilized...create them ⚠⚠",
                        "aquamarine"
                    );
                    gearStatBlock();
                    statBlockvals["initgear"] = "1";
                }
                if (v.initspecabilities === "0") {
                    log(
                        "Hindrances, Edges, Special Abilities",
                        "⚠⚠ Not Initilized...create them ⚠⚠",
                        "aquamarine"
                    );
                    specabilityStatBlock();
                    statBlockvals["inithindrances"] = "1";
                    statBlockvals["initsbedges"] = "1";
                    statBlockvals["initspecabilities"] = "1";
                }
                if (v.initpowers === "0") {
                    log(
                        "Powers",
                        "⚠⚠ Character Powers Not Initilized...create them ⚠⚠",
                        "aquamarine"
                    );
                    spellsStatBlock();
                    statBlockvals["initpowers"] = "1";
                }
                initstatblock = "1";
                setAttrs(statBlockvals);
            }
        }
    );
};

on("sheet:opened", function() {
    statblockCheck();
});

const descStatBlock = function() {
    let chardesc = "{{name=@{character_name}}}";
    getAttrs(["is_npc", "physdescription"], function(v) {
        if (v.is_npc === "0") {
            //is Wild Card
            chardesc += " {{wci=@{WCI}}}";
        }
        let physdesc = v.physdescription;
        //console.log("Description length: " + physdesc.length);
        if (physdesc.length > 0) {
            chardesc += " {{description=@{physdescription}}}";
        }
        setAttrs({ chardesc: chardesc });
    });
};

on("change:is_npc change:physdescription", function() {
    descStatBlock();
});

const staticlist = [
    "staticAcademics",
    "staticAthletics",
    "staticBattle",
    "staticBoating",
    "staticCommonKnowledge",
    "staticDriving",
    "staticElectronics",
    "staticFaith",
    "staticFighting",
    "staticFocus",
    "staticGambling",
    "staticHacking",
    "staticHealing",
    "staticIntimidation",
    "staticLanguage",
    "staticNotice",
    "staticOccult",
    "staticPerformance",
    "staticPersuasion",
    "staticPiloting",
    "staticPsionics",
    "staticRepair",
    "staticResearch",
    "staticRiding",
    "staticScience",
    "staticShooting",
    "staticSpellcasting",
    "staticStealth",
    "staticSurvival",
    "staticTaunt",
    "staticThievery",
    "staticWeirdScience",
];
const skillsStatBlock = function() {
    /*console.log(
        "skillnamelist length: " +
        skillnamelist.length +
        " staticlist length: " +
        staticlist.length
    );*/
    getAttrs(staticlist, function(v) {
        let charskills = "";
        for (let i = 0; i < staticlist.length; i++) {
            if (v[staticlist[i]] != "0") {
                //skill is turned on
                let skillname = staticlist[i];
                let uskillname = staticlist[i];
                let skilldisplay = staticlist[i];
                skillname === "staticLanguage" ?
                    (skillname = skillname.replace("static", "native-")) :
                    (skillname = skillname.replace("static", ""));
                skilldisplay = skilldisplay.replace("static", "");
                uskillname = uskillname.replace("static", "");
                skillname = skillname.toLowerCase();
                if (charskills.length < 1) {
                    //no skills added to the list yet
                    charskills = `[@{${skillname}name} @{${skilldisplay}_display}](~t${uskillname}Roll)`;
                } else {
                    charskills += `, [@{${skillname}name} @{${skilldisplay}_display}](~t${uskillname}Roll)`;
                }
            } 
        }
        //Need to do custom skill
        getSectionIDs("repeating_skills", function(idArray) {
            for (a = 0; a < idArray.length; a++) {
                if (charskills.length < 1) {
                    charskills = `[@{repeating_skills_${idArray[a]}_custSkillName} @{repeating_skills_${idArray[a]}_knowledgeother_display}](~repeating_skills_${idArray[a]}_tKnowledgeotherRoll)`;
                } else {
                    charskills += `, [@{repeating_skills_${idArray[a]}_custSkillName} @{repeating_skills_${idArray[a]}_knowledgeother_display}](~repeating_skills_${idArray[a]}_tKnowledgeotherRoll)`;
                }
            }
            setAttrs({ charskills: charskills });
        });
    });
};

staticlist.forEach((staticitem) => {
    on(
        `change:${staticitem} change:repeating_skills:custSkillName change:repeating_skills:knowledgeother change:repeating_skills:knowledgeothermod remove:repeating_skills`,
        function() {
            skillsStatBlock();
        }
    );
});

const getCustomDerivedStats = function(charderived) {
    log("Custom Derived Stats", "Made it here...", "yellow");
    log("charderived", charderived, "yellow");
    let derivedNameRows = [];
    let derivedValsRows = [];
    let customDerivedStats = charderived;
    getSectionIDs("repeating_derivedstats", function(idArray) {
        for (a = 0; a < idArray.length; a++) {
            derivedNameRows[
                derivedNameRows.length
            ] = `repeating_derivedstats_${idArray[a]}_derivedName`;
            derivedValsRows[
                derivedValsRows.length
            ] = `repeating_derivedstats_${idArray[a]}_derivedCurrent`;
        }
        derivedNameRows.length <= 0 ?
            log(
                "Custom Derived Stats",
                "Array is empty, no repeating derived stats",
                "yellow"
            ) :
            log(
                "Custom Derived Stats",
                "Array is not empty, captured repeating derived stats",
                "yellow"
            );

        customDerivedStats += `;<br /> **@{derivedFirstName}:** @{derivedFirstCurrent}`;
        log("customDerivedStats", customDerivedStats, "yellow");
        //if the first derived state isn't blank, then check for other derived stats
        for (b = 0; b < derivedNameRows.length; b++) {
            customDerivedStats += `; **@{${derivedNameRows[b]}}:** @{${derivedValsRows[b]}}`;
            log("customDerivedStats", customDerivedStats, "yellow");
        }
        setAttrs({ charderived: customDerivedStats });
    });
};

const derivedStatBlock = function() {
    const toughnessstats = ["toughnessArmor"];
    let derivedstats = [];
    let valuelist = derivedstats.concat(toughnessstats);
    valuelist.push("showadditionalderived"); //if showadditionalderived === "on", then need to check for additional derived stats...
    let charderived =
        "[**^{pace}:** @{paceCur}](~RunningRoll); **^{parry}:** @{parryCur}; **^{toughness}:** @{toughnesscur}";
    let dstat = "";
    getAttrs(valuelist, function(v) {
        if (v.toughnessArmor != "0") {
            charderived += "(@{toughnessArmor})";
        }

        if (v.showadditionalderived === "on") {
            log(
                "Custom Derived Stats",
                "Showing Custom Derived Stats; get info",
                "yellow"
            );
            //should have custom derived stats
            getCustomDerivedStats(charderived);
        } else {
            log("setting charderived", charderived, "yellow");
            setAttrs({ charderived: charderived });
        }
    });
};

on(
    "change:toughnessarmor change:showadditionalderived change:derivedFirstName remove:repeating_derivedstats",
    function() {
        derivedStatBlock();
    }
);

const gearStatBlock = function() {
    //Includes Armor, Weapons, Gear
    //console.log("Started gearStatBlock");
    let chargear = "";
    let gearvals = [];
    let armorrows = [];
    let weaponrows = [];
    getSectionIDs(["armor"], function(armoridArray) {
        //console.log("Got Armor Section IDs");
        for (a = 0; a < armoridArray.length; a++) {
            gearvals[
                gearvals.length
            ] = `repeating_armor_${armoridArray[a]}_armorWorn`;
            armorrows[
                armorrows.length
            ] = `repeating_armor_${armoridArray[a]}_`;
            weaponrows[weaponrows.length] = "empty";
        }
        //console.log("Armor ID Array: " + armoridArray);
        getSectionIDs(["weapons"], function(weaponidArray) {
            //console.log("Got Weapon Section IDs");
            //console.log("Armor ID Array (again): " + armoridArray);
            //console.log("Weapon ID Array: " + weaponidArray);
            for (b = 0; b < weaponidArray.length; b++) {
                gearvals[
                    gearvals.length
                ] = `repeating_weapons_${weaponidArray[b]}_weaponcarried`;
                weaponrows[
                    weaponrows.length
                ] = `repeating_weapons_${weaponidArray[b]}_`;
            }
            getSectionIDs(["gear"], function(gearidArray) {
                //console.log("Got Gear Section IDs");
                //console.log("gearvals: " + gearvals);
                //console.log("Armor ID Array (again x2): " + armoridArray);
                //console.log("Weapon ID Array (again): " + weaponidArray);
                //console.log("Gear ID Array: " + gearidArray);
                getAttrs(gearvals, function(v) {
                    //console.log("Got Armor and Weapon Values");
                    for (c = 0; c < gearvals.length; c++) {
                        /*console.log(
                            "Cycling through Armor and Weapons: " + c
                        );*/
                        if (c < armoridArray.length) {
                            //getting Armor
                            let worn = gearvals[c];
                            //console.log("⍚⍚⍚ Worn: " + worn + " ⍚⍚⍚");
                            //console.log("worn value: " + v[worn]);
                            if (v[worn] !== "0") {
                                //console.log("Armor is Worn");
                                if (chargear.length < 1) {
                                    //First Item in List
                                    chargear = `@{${armorrows[c]}ArmorType} (+@{${armorrows[c]}ArmorTypeProtection})`;
                                } else {
                                    //not first item in list
                                    chargear += `, @{${armorrows[c]}ArmorType} (+@{${armorrows[c]}ArmorTypeProtection})`;
                                }
                            }
                        } else {
                            //getting weapons
                            let carried = gearvals[c];
                            /*console.log(
                                "⍚⍚⍚ carried: " + carried + " ⍚⍚⍚"
                            );*/
                            if (v[carried] !== "0") {
                                //console.log("Weapons is Carried");
                                if (chargear.length < 1) {
                                    //First Item in List
                                    chargear = `[@{${weaponrows[c]}weapon} (@{${weaponrows[c]}weapondamage})](~${weaponrows[c]}tWeapon)`;
                                } else {
                                    //not first item in list
                                    chargear += `, [@{${weaponrows[c]}weapon} (@{${weaponrows[c]}weapondamage})](~${weaponrows[c]}tWeapon)`;
                                }
                            } 
                        }
                    }
                    for (d = 0; d < gearidArray.length; d++) {
                        if (chargear.length < 1) {
                            //First Item in List
                            chargear = `@{repeating_gear_${gearidArray[d]}_item}`;
                        } else {
                            //not first item in list
                            chargear += `, @{repeating_gear_${gearidArray[d]}_item}`;
                        }
                    }
                    setAttrs({ chargear: chargear });
                });
            });
        });
    });
};

on(
    "change:repeating_armor change:repeating_weapons change:repeating_gear remove:repeating_armor remove:repeating_weapons remove:repeating_gear",
    function() {
        gearStatBlock();
    }
);

const specabilityStatBlock = function() {
    let charhindrances = "";
    let charedges = "";
    let charspecabilities = "";
    let abilityvals = [];
    let hindrancerow = [];
    let edgerow = [];
    let specAbilityrow = [];
    //Get Hindrance List of IDs
    getSectionIDs("repeating_hindrances", function(hindranceidArray) {
        for (a = 0; a < hindranceidArray.length; a++) {
            abilityvals[
                abilityvals.length
            ] = `repeating_hindrances_${hindranceidArray[a]}_hindranceType`;
            hindrancerow[
                hindrancerow.length
            ] = `repeating_hindrances_${hindranceidArray[a]}_`;
            edgerow[edgerow.length] = "empty";
        }
        //Get Edges List of IDs
        getSectionIDs("repeating_edges", function(edgeidArray) {
            for (b = 0; b < edgeidArray.length; b++) {
                abilityvals[
                    abilityvals.length
                ] = `repeating_edges_${edgeidArray[b]}_tookat`;
                edgerow[
                    edgerow.length
                ] = `repeating_edges_${edgeidArray[b]}_`;
                specAbilityrow[specAbilityrow.length] = "empty";
            }
            //Get Special Abilities List of IDs
            getSectionIDs(
                "repeating_specialabilities",
                function(specAbilityIDArray) {
                    for (b = 0; b < specAbilityIDArray.length; b++) {
                        abilityvals[
                            abilityvals.length
                        ] = `repeating_specialabilities_${specAbilityIDArray[b]}_tookat`;
                        specAbilityrow[
                            specAbilityrow.length
                        ] = `repeating_specialabilities_${specAbilityIDArray[b]}_`;
                    }
                    getAttrs(abilityvals, function(v) {
                        for (c = 0; c < abilityvals.length; c++) {
                            let evalval = "";
                            if (c < hindrancerow.length) {
                                /*console.log(
                                    "Found a Hindrance for Evaluation"
                                );*/
                                evalval =
                                    hindrancerow[c] + "hindranceType";
                                let speccheck = v[evalval];
                                //console.log("Spec Check: " + speccheck);
                                speccheck = speccheck.toLowerCase();
                                //console.log("Spec Check: " + speccheck);
                                if (speccheck === "racial") {
                                    //Special ability
                                    charspecabilities += `<li>**@{${hindrancerow[c]}hindrance}:** @{${hindrancerow[c]}hindrancedescription}</li>`;
                                } else {
                                    //hindrance
                                    if (charhindrances.length < 1) {
                                        charhindrances = `[@{${hindrancerow[c]}hindrance}](~${hindrancerow[c]}tHindrance)`;
                                    } else {
                                        charhindrances += `, [@{${hindrancerow[c]}hindrance}](~${hindrancerow[c]}tHindrance)`;
                                    }
                                }
                            } else if (c < edgerow.length) {
                                //used to just be an else statement...
                                /*console.log(
                                    "Found an Edge for evaluation"
                                );*/
                                evalval = edgerow[c] + "tookat";
                                if (
                                    v[evalval].toLowerCase() ===
                                    "racial"
                                ) {
                                    //Special ability
                                    charspecabilities += `<li>**@{${edgerow[c]}edge}:** @{${edgerow[c]}edgedescription}</li>`;
                                } else {
                                    //edge
                                    if (charedges.length > 0) {
                                        charedges += `, `;
                                    }
                                    charedges += `[@{${edgerow[c]}edge}](~${edgerow[c]}tEdge)`;
                                }
                            } else if (c < specAbilityrow.length) {
                                //didn't used to exist...
                                log(
                                    "Step",
                                    "Found a Special Ability",
                                    "yellow"
                                );
                                charspecabilities += `<li>**@{${specAbilityrow[c]}specialability}:** @{${specAbilityrow[c]}specialabilitydescription}</li>`;
                            }
                        }
                        let salength = charspecabilities.length;
                        let showspec = 0;
                        if (salength > 0) {
                            showspec = `{{showspec=[[1d0+${salength}]]}}`;
                        }
                        if (charhindrances.length < 1) {
                            charhindrances = "&mdash;";
                        }
                        if (charedges.length < 1) {
                            charedges = "&mdash;";
                        }
                        setAttrs({
                            charhindrances: charhindrances,
                            charedges: charedges,
                            showspec: showspec,
                            charspecabilities: charspecabilities,
                        });
                    });
                }
            );
        });
    });
};

on(
    "change:repeating_hindrances change:repeating_edges change:repeating_specialabilities remove:repeating_hindrances remove:repeating_edges remove:repeating_specialabilities",
    function() {
        specabilityStatBlock();
    }
);

const spellsStatBlock = function() {
    console.warn("Creating Spell Stat Block");
    let charpowers = "";
    let powercount = 0;
    getSectionIDs("spells", function(idArray) {
        if (idArray.length < 1) {
            //console.log("No spells to worry about");
            setAttrs({ powercount: "0" });
        } else {
            let getvalues = [
                "NoPPRule",
                "numberofabs",
                "powerlabelplural",
                "ablabel",
                "ppelabel",
                "ablabel2",
                "pplabel2",
                "ablabel3",
                "pplabel3",
                "ablabel4",
                "pplabel4",
                "ablabel5",
                "pplabel5",
                "PowerPoints_max",
                "powerpoints2_max",
                "powerpoints3_max",
                "powerpoints4_max",
                "powerpoints5_max",
            ];
            const powerbutton = idArray.map(
                (x) => `repeating_spells_${x}_tPower`
            );
            const actualpower = idArray.map(
                (x) => `repeating_spells_${x}_power`
            );
            const powergroup = idArray.map(
                (x) => `repeating_spells_${x}_powergroup`
            );
            getvalues = getvalues.concat(actualpower, powergroup);
            //console.log("Values I want to get: " + getvalues);
            getAttrs(getvalues, function(v) {
                let ablabels = [
                    v.ablabel,
                    v.ablabel2,
                    v.ablabel3,
                    v.ablabel4,
                    v.ablabel5,
                ];
                let pplabels = [
                    v.ppelabel,
                    v.pplabel2,
                    v.pplabel3,
                    v.pplabel4,
                    v.pplabel5,
                ];
                if (v.NoPPRule == "0") {
                    //console.log("!!! Power Points are used !!!");
                    pplabels = [
                        v.ppelabel,
                        v.pplabel2,
                        v.pplabel3,
                        v.pplabel4,
                        v.pplabel5,
                    ];
                    powerpoints = [
                        v.PowerPoints_max,
                        v.powerpoints2_max,
                        v.powerpoints3_max,
                        v.powerpoints4_max,
                        v.powerpoints5_max,
                    ];
                }
                let arcanebg = "";
                let powers = "";
                let powerlists = [
                    "not used",
                    "not used",
                    "not used",
                    "not used",
                    "not used",
                ];
                let powerpointmax = "";
                let abpowercount = 0;
                //console.log("Actual Powers: " + actualpower);
                //console.log("Power Buttons: " + powerbutton);
                //console.log("Values for v are: " + JSON.stringify(v));
                //console.info("Beginning For Loops");
                for (let i = 0; i < v.numberofabs; i++) {
                    //cycle through the number of ABs used on the character
                    //console.log("Entering the First For Loop");
                    arcanebg = `**${ablabels[i]}**`;
                    if (v.NoPPRule == "0") {
                        powerpointmax = `<ul><li>${pplabels[i]}: ${powerpoints[i]}</li>`;
                    } else {
                        powerpointmax = "";
                    }
                    abpowercount = 0;
                    for (let p = 0; p < idArray.length; p++) {
                        //console.log("Reached the Inner Loop");
                        //Check to see if any of the powers are associated the AB we are checking
                        if (v[powergroup[p]] == `ab${i + 1}`) {
                            //powergroup is associated with the AB we are currently looking for
                            if (abpowercount < 1) {
                                //console.warn("First Power found");
                                powers = `[@{${actualpower[p]}}](~${powerbutton[p]})`;
                            } else {
                                //console.log("Subsequent Power Found");
                                powers += `, [@{${actualpower[p]}}](~${powerbutton[p]})`;
                            }
                            abpowercount++;
                        }
                    }
                    powercount += abpowercount;
                    //done cycling through the list of powers
                    if (powercount > 0) {
                        //number of powers associated with the AB is 1+
                        charpowers +=
                            arcanebg +
                            powerpointmax +
                            "<li>" +
                            v.powerlabelplural +
                            ": " +
                            powers +
                            "</li></ul>";
                        powerlists[i] = powers;
                    }
                }
                //done cycling through the number of ABs
                setAttrs({
                    charpowers: charpowers,
                    powercount: powercount,
                    ab1powerlist: powerlists[0],
                    ab2powerlist: powerlists[1],
                    ab3powerlist: powerlists[2],
                    ab4powerlist: powerlists[3],
                    ab5powerlist: powerlists[4],
                });
            });
        }
    });
};

on(
    "change:NoPPRule change:numberofabs change:powerlabelplural change:ablabel change:ppelabel change:ablabel2 change:pplabel2 change:ablabel3 change:pplabel3 change:ablabel4 change:pplabel4 change:ablabel5 change:pplabel5 change:PowerPoints_max change:powerpoints2_max change:powerpoints3_max change:powerpoints4_max change:powerpoints5_max change:repeating_spells:power change:repeating_spells:powergroup remove:repeating_spells",
    function() {
        spellsStatBlock();
    }
);on("change:jsonimport", function(eventInfo) {
    console.log("Made it to the JSON Importer Sheet Worker");
    if (eventInfo.newValue !== null) {
        let jsonData = eventInfo.newValue;
        console.log(
            typeof jsonData +
            " newValue: " +
            jsonData +
            "length: " +
            jsonData.length
        );
        let jsonObj = JSON.parse(jsonData);
        let importAttrs = {};
        console.log(
            "name: " + jsonObj.name + " paceBase: " + jsonObj.paceBase
        );
        //get the basic character bio stuff
        importAttrs["character_name"] = jsonObj.name;
        importAttrs["age"] = jsonObj.age;
        jsonObj.professionOrTitle != "" ?
            (importAttrs["physdescription"] =
                jsonObj.professionOrTitle + "\n") :
            log("Profession or Title", "N/A", "darkgoldenrod");
        jsonObj.iconicFramework != "" ?
            (importAttrs["physdescription"] +=
                jsonObj.iconicFramework + "\n") :
            log("Iconic Framework", "N/A", "darkgoldenrod");
        jsonObj.description != "" ?
            (importAttrs["physdescription"] += jsonObj.description + "\n") :
            log("Description", "N/A", "darkgoldenrod");
        importAttrs["physdescription"] += jsonObj.background;
        importAttrs["fatigue"] = jsonObj.fatigue;
        importAttrs["fatigue_max"] = jsonObj.fatigueMax;
        importAttrs["gender"] = jsonObj.gender;
        importAttrs["pace"] = jsonObj.paceBase;
        importAttrs["paceMod"] = jsonObj.paceMod;
        importAttrs["parryMod"] = jsonObj.parryMod;
        importAttrs["race"] = jsonObj.race;
        importAttrs["runningDie"] = "1" + jsonObj.runningDie;
        importAttrs["size"] = jsonObj.size;
        importAttrs["tufnessMod"] = jsonObj.toughnessMod - jsonObj.size;
        importAttrs["money"] = jsonObj.wealth;
        jsonObj.wildcard ?
            (importAttrs["is_npc"] = 0) :
            (importAttrs["is_npc"] = 1);
        importAttrs["wounds"] = jsonObj.wounds;
        importAttrs["wounds_max"] = jsonObj.woundsMax;
        //get the Attributes
        for (let obj of jsonObj.attributes) {
            switch (obj.name) {
                case "agility":
                    importAttrs["agility"] = obj.dieValue;
                    importAttrs["agilitymod"] = obj.mod;
                    break;
                case "smarts":
                    importAttrs["smarts"] = obj.dieValue;
                    importAttrs["smartsmod"] = obj.mod;
                    break;
                case "spirit":
                    importAttrs["spirit"] = obj.dieValue;
                    importAttrs["spiritmod"] = obj.mod;
                    break;
                case "strength":
                    importAttrs["strength"] = obj.dieValue;
                    importAttrs["strengthmod"] = obj.mod;
                    break;
                case "vigor":
                    importAttrs["vigor"] = obj.dieValue;
                    importAttrs["vigormod"] = obj.mod;
                    break;
                default:
                    log(
                        "attributes",
                        "Unknown attribute: " + obj.name,
                        "darkgoldenrod"
                    );
            }
        }
        //get the skills
        const traits = [
            "agility",
            "smarts",
            "spirit",
            "strength",
            "vigor",
            "fighting",
            "academics",
            "athletics",
            "battle",
            "boating",
            "commonknowledge",
            "driving",
            "electronics",
            "faith",
            "focus",
            "gambling",
            "hacking",
            "healing",
            "intimidation",
            "language",
            "notice",
            "occult",
            "performance",
            "persuasion",
            "piloting",
            "psionics",
            "repair",
            "research",
            "riding",
            "science",
            "shooting",
            "spellcasting",
            "stealth",
            "survival",
            "taunt",
            "thievery",
            "weirdscience",
        ];
        let useCustomSkills = false;
        for (let skill of jsonObj.skills) {
            log("Import skills", skill.name, "goldenrod");
            let skill_name = skill.name.toLowerCase().replace(" ", "");
            let found = traits.find((skillname) => skillname === skill_name);
            log(skill_name, "is..." + found, "darkgoldenrod");
            if (skill_name === "language(native)") {
                //Native language
                log("Import Skill", "Language (Native)", "darkgoldenrod");
                importAttrs["language"] = skill.dieValue;
                importAttrs["languagemod"] = skill.mod;
                importAttrs["staticlanguage"] = "on";
            } else if (found) {
                //set the skill
                log("Import Skill", found, "darkgoldenrod");
                importAttrs[found] = skill.dieValue;
                importAttrs[`${found}mod`] = skill.mod;
                importAttrs[`static${found}`] = "on";
            } else {
                //is a custom skill
                //use a ternary to set useCustomSkills to true
                log("Import Skill", skill.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[
                    `repeating_skills_${repSectionID}_custSkillName`
                ] = skill.name;
                importAttrs[
                    `repeating_skills_${repSectionID}_skillnamerank`
                ] = skill.dieValue;
                importAttrs[
                    `repeating_skills_${repSectionID}_skillnamerankmod`
                ] = skill.mod;
                switch (skill.attribute) {
                    case "agility":
                        importAttrs[
                            `repeating_skills_${repSectionID}_linkedotherattscore`
                        ] = "agl-u";
                        break;
                    case "smarts":
                        importAttrs[
                            `repeating_skills_${repSectionID}_linkedotherattscore`
                        ] = "sma-u";
                        break;
                    case "spirit":
                        importAttrs[
                            `repeating_skills_${repSectionID}_linkedotherattscore`
                        ] = "spi-u";
                        break;
                    case "strength":
                        importAttrs[
                            `repeating_skills_${repSectionID}_linkedotherattscore`
                        ] = "str-u";
                        break;
                    default:
                        importAttrs[
                            `repeating_skills_${repSectionID}_linkedotherattscore`
                        ] = "vig-u";
                        break;
                }
                importAttrs[
                    `repeating_skills_${repSectionID}_showOtherRollMod`
                ] = "0";
                useCustomSkills
                    ?
                    log(
                        "Custom Skills",
                        "Already Set...",
                        "darkgoldenrod"
                    ) :
                    (useCustomSkills = true);
                importAttrs[`staticKnowledgeOther`] = "on";
            }
        }
        // get hindrances
        if (jsonObj.hindrances.length > 0) {
            for (let hindrance of jsonObj.hindrances) {
                log("Import Hindrances", hindrance.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                let strlen = hindrance.name.length;
                importAttrs[
                    `repeating_hindrances_${repSectionID}_hindrance`
                ] = hindrance.name.substr(0, strlen - 8);
                hindrance.major ?
                    (importAttrs[
                        `repeating_hindrances_${repSectionID}_hindranceType`
                    ] = "Major") :
                    (importAttrs[
                        `repeating_hindrances_${repSectionID}_hindranceType`
                    ] = "Minor");
                importAttrs[
                    `repeating_hindrances_${repSectionID}_hindrancedescription`
                ] = hindrance.description;
                importAttrs[
                    `repeating_hindrances_${repSectionID}_showHindraceDesc`
                ] = "0";
            }
        }

        //get Edges
        if (jsonObj.edges.length > 0) {
            for (let edge of jsonObj.edges) {
                log("Import Edges", edge.name, "darkgoldenrod");
                if (edge.note === "Advance") {
                    log(
                        "Delay Edge Import",
                        "Edge (" + edge.name + ") took as Advance",
                        "yellow"
                    );
                } else {
                    let repSectionID = generateRowID();
                    importAttrs[`repeating_edges_${repSectionID}_edge`] =
                        edge.name;
                    importAttrs[
                        `repeating_edges_${repSectionID}_edgedescription`
                    ] = edge.description;
                    importAttrs[`repeating_edges_${repSectionID}_tookat`] =
                        "Creation";
                    importAttrs[
                        `repeating_edges_${repSectionID}_showEdgeDesc`
                    ] = "0";
                }
            }
        }

        //get Advances
        if (jsonObj.advances.length > 0) {
            for (let charAdvance of jsonObj.advances) {
                log("Import Advances", charAdvance.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[`repeating_edges_${repSectionID}_edge`] =
                    charAdvance.name;
                importAttrs[
                    `repeating_edges_${repSectionID}_edgedescription`
                ] = charAdvance.description;
                importAttrs[`repeating_edges_${repSectionID}_tookat`] =
                    "Advance";
                importAttrs[
                    `repeating_edges_${repSectionID}_showEdgeDesc`
                ] = "0";
            }
        }

        //get Special Abilities
        if (jsonObj.abilities.length > 0) {
            for (let specAbility of jsonObj.abilities) {
                log(
                    "Import Special Abilities",
                    specAbility.name,
                    "darkgoldenrod"
                );
                let repSectionID = generateRowID();
                importAttrs[
                    `repeating_specialabilities_${repSectionID}_specialability`
                ] = specAbility.name;
                importAttrs[
                    `repeating_specialabilities_${repSectionID}_specialabilitydescription`
                ] = specAbility.description;
                importAttrs[
                    `repeating_specialabilities_${repSectionID}_showSpecAbilityDesc`
                ] = "0";
                //check for things like Armor
                if (specAbility.name.substr(0, 5) === "Armor") {
                    //Add stuff to Armor
                    repSectionID = generateRowID();
                    importAttrs[
                        `repeating_armor_${repSectionID}_ArmorType`
                    ] = specAbility.name; //was description
                    importAttrs[
                        `repeating_armor_${repSectionID}_ArmorNotes`
                    ] = specAbility.description; //wasn't here before...
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "8";
                    let armorValue = specAbility.name.split("+");
                    importAttrs[
                        `repeating_armor_${repSectionID}_ArmorTypeProtection`
                    ] = armorValue[1];
                    importAttrs[
                        `repeating_armor_${repSectionID}_armorWorn`
                    ] = "1";
                    importAttrs[
                        `repeating_armor_${repSectionID}_armorstack`
                    ] = "1";
                }
            }
            importAttrs["showSpecAbilities"] = "1";
        }

        //get Gear
        if (jsonObj.gear.length > 0) {
            for (let gearItem of jsonObj.gear) {
                log("Import Gear", gearItem.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[`repeating_gear_${repSectionID}_item`] =
                    gearItem.name;
                importAttrs[`repeating_gear_${repSectionID}_itemqty`] =
                    gearItem.quantity;
                importAttrs[`repeating_gear_${repSectionID}_itemWeight`] =
                    gearItem.weight;
                importAttrs[`repeating_gear_${repSectionID}_itemcarried`] =
                    "on";
                importAttrs[`repeating_gear_${repSectionID}_showGearDesc`] =
                    "0";
            }
        }

        //get Weapons
        if (jsonObj.weapons.length > 0) {
            for (let weapon of jsonObj.weapons) {
                log("Import Weapons", weapon.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[`repeating_weapons_${repSectionID}_weapon`] =
                    weapon.name;
                weapon.quantity > 1 ?
                    (importAttrs[
                        `repeating_weapons_${repSectionID}_weapon`
                    ] += " (x" + weapon.quantity + ")") :
                    log("Quantity", "1, don't add anything", "yellow");
                importAttrs[`repeating_weapons_${repSectionID}_range`] =
                    weapon.range;
                importAttrs[`repeating_weapons_${repSectionID}_weaponap`] =
                    weapon.ap;
                importAttrs[`repeating_weapons_${repSectionID}_rof`] =
                    weapon.rof;
                importAttrs[`repeating_weapons_${repSectionID}_shots`] =
                    weapon.shots;
                importAttrs[`repeating_weapons_${repSectionID}_shots_max`] =
                    weapon.shots;
                importAttrs[
                    `repeating_weapons_${repSectionID}_weaponweight`
                ] = weapon.weight;
                importAttrs[
                    `repeating_weapons_${repSectionID}_weaponcarried`
                ] = "on";
                importAttrs[
                    `repeating_weapons_${repSectionID}_weaponnotes`
                ] = weapon.notes;
                weapon.minStr.substr(0, 1) === "d" ?
                    (importAttrs[
                        `repeating_weapons_${repSectionID}_minstrength`
                    ] = weapon.minStr.substr(
                        1,
                        weapon.minStr.length - 1
                    )) :
                    (importAttrs[
                        `repeating_weapons_${repSectionID}_minstrength`
                    ] = 0);
                importAttrs[
                    `repeating_weapons_${repSectionID}_showweaponconfig`
                ] = "0";
                //determine damage...
                let damageStart = weapon.damage.substr(0, 3);
                if (
                    damageStart === "Str" ||
                    damageStart === "Agl" ||
                    damageStart === "Sma" ||
                    damageStart === "Spi" ||
                    damageStart === "Vig"
                ) {
                    //Weapon uses an Attribute
                    switch (damageStart) {
                        case "Str":
                            importAttrs[
                                `repeating_weapons_${repSectionID}_damageatt`
                            ] = "strength";
                            break;
                        case "Agl":
                            importAttrs[
                                `repeating_weapons_${repSectionID}_damageatt`
                            ] = "agility";
                            break;
                        case "Sma":
                            importAttrs[
                                `repeating_weapons_${repSectionID}_damageatt`
                            ] = "smarts";
                            break;
                        case "Spi":
                            importAttrs[
                                `repeating_weapons_${repSectionID}_damageatt`
                            ] = "spirit";
                            break;
                        default:
                            importAttrs[
                                `repeating_weapons_${repSectionID}_damageatt`
                            ] = "vigor";
                            break;
                    }
                    weapon.damage = weapon.damage.substr(
                        4,
                        weapon.damage.length - 4
                    );
                    //debugger;
                } else {
                    importAttrs[
                        `repeating_weapons_${repSectionID}_damageatt`
                    ] = "na";
                }
                //weapon damage now should include NO attributes
                let indexofDie = weapon.damage.indexOf("d");
                //debugger;
                if (indexofDie === -1) {
                    importAttrs[
                        `repeating_weapons_${repSectionID}_dmgnumdice`
                    ] = "0";
                } else {
                    indexofDie < 1 ?
                        (importAttrs[
                            `repeating_weapons_${repSectionID}_dmgnumdice`
                        ] = "1") :
                        (importAttrs[
                            `repeating_weapons_${repSectionID}_dmgnumdice`
                        ] = weapon.damage.substr(0, indexofDie));
                }
                indexofDie !== -1 ?
                    (weapon.damage = weapon.damage.substr(
                        indexofDie,
                        weapon.damage.length - indexofDie
                    )) :
                    log("indexofDie", "No Die Type exists", "yellow");
                //debugger;
                //replace all dice with exploding dice
                let regexD4 = /d4/gi;
                let regexD6 = /d6/gi;
                let regexD8 = /d8/gi;
                let regexD10 = /d10/gi;
                let regexD12 = /d12/gi;
                let regexD20 = /d20/gi;
                weapon.damage = weapon.damage
                    .replace(regexD4, "d4!")
                    .replace(regexD6, "d6!")
                    .replace(regexD8, "d8!")
                    .replace(regexD10, "d10!")
                    .replace(regexD12, "d12!")
                    .replace(regexD20, "d20!");
                //if indexofDie === -1, then we move to the next field
                let dieEnd, noMod;
                if (indexofDie !== -1) {
                    //need to determine the die type
                    weapon.damage.length > 4 ?
                        (dieEnd = weapon.damage.indexOf("!") + 1) :
                        (noMod = true);
                    noMod
                        ?
                        (importAttrs[
                            `repeating_weapons_${repSectionID}_dmgdietype`
                        ] = weapon.damage) :
                        (importAttrs[
                            `repeating_weapons_${repSectionID}_dmgdietype`
                        ] = weapon.damage.substr(0, dieEnd));
                    weapon.damage = weapon.damage.substr(
                        dieEnd,
                        weapon.damage.length - dieEnd
                    );
                }
                //fill in the Mod Field
                weapon.damage.substr(0, 1) === "+" ?
                    (importAttrs[
                        `repeating_weapons_${repSectionID}_dmgbonusnum`
                    ] = weapon.damage.substr(
                        1,
                        weapon.damage.length - 1
                    )) :
                    (importAttrs[
                        `repeating_weapons_${repSectionID}_dmgbonusnum`
                    ] = weapon.damage);
            }
        }

        // get Armor
        if (jsonObj.armor.length > 0) {
            for (let armorItem of jsonObj.armor) {
                log("Import Armor", armorItem.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[`repeating_armor_${repSectionID}_ArmorType`] =
                    armorItem.name;
                armorItem.quantity > 1 ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_ArmorType`
                    ] += `(x${armorItem.quantity})`) :
                    log(
                        "Armor Quantity",
                        "Single, don't add anything",
                        "darkgoldenrod"
                    );
                armorItem.minStr.substr(0, 1) === "d" ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_minstrength`
                    ] = armorItem.minStr.substr(
                        1,
                        armorItem.minStr.length - 1
                    )) :
                    (importAttrs[
                        `repeating_armor_${repSectionID}_minstrength`
                    ] = armorItem.minStr); //value should be integer
                if (
                    armorItem.coversTorso &&
                    armorItem.coversLegs &&
                    armorItem.coversArms
                ) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "5";
                } else if (armorItem.coversTorso && armorItem.coversArms) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "3";
                } else if (armorItem.coversTorso && armorItem.coversLegs) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "4";
                } else if (armorItem.coversFace || armorItem.coversHead) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "1";
                } else if (armorItem.coversTorso) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "2";
                } else if (armorItem.coversArms) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "6";
                } else if (armorItem.coversLegs) {
                    importAttrs[
                        `repeating_armor_${repSectionID}_AreaProtected`
                    ] = "7";
                } else
                    log("Armor Covers", "Unknown...leaving blank", "pink");
                importAttrs[
                    `repeating_armor_${repSectionID}_ArmorTypeProtection`
                ] = armorItem.armor;
                importAttrs[
                    `repeating_armor_${repSectionID}_ArmorTypeWeight`
                ] = armorItem.weight;
                armorItem.equipped ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_ArmorCarried`
                    ] = "on") :
                    console.log("amor not equipped");
                armorItem.equipped ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_armorWorn`
                    ] = "1") :
                    console.log("armor not worn");
                importAttrs[`repeating_armor_${repSectionID}_ArmorNotes`] =
                    armorItem.notes;
            }
        }

        //get Shields
        if (jsonObj.shields.length > 0) {
            for (let shield of jsonObj.shields) {
                log("Import Armor", shield.name, "darkgoldenrod");
                let repSectionID = generateRowID();
                importAttrs[`repeating_armor_${repSectionID}_ArmorType`] =
                    shield.name;
                shield.quantity > 1 ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_ArmorType`
                    ] += `(x${shield.quantity})`) :
                    log(
                        "Armor Quantity",
                        "Single, don't add anything",
                        "darkgoldenrod"
                    );
                shield.minStr.substr(0, 1) === "d" ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_minstrength`
                    ] = shield.minStr.substr(
                        1,
                        shield.minStr.length - 1
                    )) :
                    (importAttrs[
                        `repeating_armor_${repSectionID}_minstrength`
                    ] = armorItem.minStr); //value should be integer
                importAttrs[
                    `repeating_armor_${repSectionID}_ArmorTypeWeight`
                ] = shield.weight;
                shield.equipped ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_ArmorCarried`
                    ] = "on") :
                    log("Shield", "not equipped", "yellow");
                shield.equipped ?
                    (importAttrs[
                        `repeating_armor_${repSectionID}_armorWorn`
                    ] = "1") :
                    log("Shield", "not equipped", "yellow");
                importAttrs[`repeating_armor_${repSectionID}_ArmorNotes`] =
                    shield.cover +
                    " " +
                    shield.hardness +
                    " . " +
                    shield.notes;
            }
        }

        //get ABs
        if (jsonObj.abs.length > 0) {
            let numberofabs = 0;
            let arcaneSkills = [
                "athletics",
                "faith",
                "focus",
                "performance",
                "psionics",
                "spellcasting",
                "weirdscience",
                "unskilled",
            ];
            let found;
            for (let arcaneBackground of jsonObj.abs) {
                log("Import AB", arcaneBackground.name, "darkgoldenrod");
                numberofabs += 1;
                //debugger;
                if (numberofabs < 6) {
                    numberofabs === 1 ?
                        (importAttrs["ablabel"] = arcaneBackground.name) :
                        (importAttrs[`ablabel${numberofabs}`] =
                            arcaneBackground.name);
                    //importAttrs["ppelabel"] = arcaneBackground.powerPointsName;
                    //debugger;
                    numberofabs === 1 ?
                        (importAttrs["PowerPoints"] =
                            arcaneBackground.powerPointsCurrent) :
                        (importAttrs[`powerpoints${numberofabs}`] =
                            arcaneBackground.powerPointsCurrent);
                    numberofabs === 1 ?
                        (importAttrs["PowerPoints_max"] =
                            arcaneBackground.powerPointsMax) :
                        (importAttrs[`powerpoints${numberofabs}_max`] =
                            arcaneBackground.powerPointsMax);
                    numberofabs === 1 ?
                        (importAttrs["ppelabel"] =
                            arcaneBackground.powerPointsName) :
                        (importAttrs[`pplabel${numberofabs}`] =
                            arcaneBackground.powerPointsName);
                    for (let power of arcaneBackground.powers) {
                        let repSectionID = generateRowID();
                        importAttrs[
                            `repeating_spells_${repSectionID}_power`
                        ] = power.name;
                        importAttrs[
                            `repeating_spells_${repSectionID}_pp`
                        ] = power.powerPoints;
                        importAttrs[
                            `repeating_spells_${repSectionID}_powerrange`
                        ] = power.range;
                        importAttrs[
                            `repeating_spells_${repSectionID}_powerduration`
                        ] = power.duration;
                        importAttrs[
                            `repeating_spells_${repSectionID}_spellnotes`
                        ] = power.summary + "\n" + power.description;
                        importAttrs[
                            `repeating_spells_${repSectionID}_powergroup`
                        ] = `ab${numberofabs}`;
                        //debugger;
                        if (power.damage === "") {
                            //no damage => try and make button skill only
                            importAttrs[
                                `repeating_spells_${repSectionID}_spelldamageatt`
                            ] = "na";
                            importAttrs[
                                `repeating_spells_${repSectionID}_spelldmgnumdice`
                            ] = "0";
                            importAttrs[
                                `repeating_spells_${repSectionID}_spelldmgbonusnum`
                            ] = "0";
                            importAttrs[
                                `repeating_spells_${repSectionID}_spellbutton`
                            ] = "2";
                            found =
                                arcaneSkills.indexOf(
                                    arcaneBackground.arcaneSkill
                                    .toLowerCase()
                                    .replace(" ", "")
                                ) > -1 ?
                                (importAttrs[
                                        `repeating_spells_${repSectionID}_spellskill`
                                    ] = arcaneBackground.arcaneSkill
                                    .toLowerCase()
                                    .replace(" ", "")) :
                                (importAttrs[
                                    `repeating_spells_${repSectionID}_spellskill`
                                ] = "unskilled");
                        } else {
                            //power does do damage...
                            let spellDamageStart = power.damage.substr(
                                0,
                                3
                            );
                            if (
                                spellDamageStart === "Str" ||
                                spellDamageStart === "Agl" ||
                                spellDamageStart === "Sma" ||
                                spellDamageStart === "Spi" ||
                                spellDamageStart === "Vig"
                            ) {
                                //Weapon uses an Attribute
                                switch (spellDamageStart) {
                                    case "Str":
                                        importAttrs[
                                            `repeating_spells_${repSectionID}_spelldamageatt`
                                        ] = "strength";
                                        break;
                                    case "Agl":
                                        importAttrs[
                                            `repeating_spells_${repSectionID}_spelldamageatt`
                                        ] = "agility";
                                        break;
                                    case "Sma":
                                        importAttrs[
                                            `repeating_spells_${repSectionID}_spelldamageatt`
                                        ] = "smarts";
                                        break;
                                    case "Spi":
                                        importAttrs[
                                            `repeating_spells_${repSectionID}_spelldamageatt`
                                        ] = "spirit";
                                        break;
                                    default:
                                        importAttrs[
                                            `repeating_spells_${repSectionID}_spelldamageatt`
                                        ] = "vigor";
                                        break;
                                }
                                power.damage = power.damage.substr(
                                    4,
                                    power.damage.length - 4
                                );
                                //debugger;
                            } else {
                                importAttrs[
                                    `repeating_spells_${repSectionID}_spelldamageatt`
                                ] = "na";
                            }
                            //spell damage now should include NO attributes
                            let newindexofDie = power.damage.indexOf(
                                "d"
                            );
                            //debugger;
                            if (newindexofDie === -1) {
                                importAttrs[
                                    `repeating_spells_${repSectionID}_spelldmgnumdice`
                                ] = "0";
                            } else {
                                newindexofDie < 1 ?
                                    (importAttrs[
                                        `repeating_spells_${repSectionID}_spelldmgnumdice`
                                    ] = "1") :
                                    (importAttrs[
                                        `repeating_spells_${repSectionID}_spelldmgnumdice`
                                    ] = power.damage.substr(
                                        0,
                                        newindexofDie
                                    ));
                            }
                            newindexofDie !== -1 ?
                                (power.damage = power.damage.substr(
                                    newindexofDie,
                                    power.damage.length -
                                    newindexofDie
                                )) :
                                log(
                                    "indexofDie",
                                    "No Die Type exists",
                                    "yellow"
                                );
                            //debugger;
                            //replace all dice with exploding dice
                            let regexD4 = /d4/gi;
                            let regexD6 = /d6/gi;
                            let regexD8 = /d8/gi;
                            let regexD10 = /d10/gi;
                            let regexD12 = /d12/gi;
                            let regexD20 = /d20/gi;
                            power.damage = power.damage
                                .replace(regexD4, "d4!")
                                .replace(regexD6, "d6!")
                                .replace(regexD8, "d8!")
                                .replace(regexD10, "d10!")
                                .replace(regexD12, "d12!")
                                .replace(regexD20, "d20!");
                            //if indexofDie === -1, then we move to the next field
                            let dieEnd, noMod;
                            if (newindexofDie !== -1) {
                                //need to determine the die type
                                power.damage.length > 4 ?
                                    (dieEnd =
                                        power.damage.indexOf(
                                            "!"
                                        ) + 1) :
                                    (noMod = true);
                                noMod
                                    ?
                                    (importAttrs[
                                        `repeating_spells_${repSectionID}_spelldmgdietype`
                                    ] = power.damage) :
                                    (importAttrs[
                                        `repeating_spells_${repSectionID}_spelldmgdietype`
                                    ] = power.damage.substr(
                                        0,
                                        dieEnd
                                    ));
                                power.damage = power.damage.substr(
                                    dieEnd,
                                    power.damage.length - dieEnd
                                );
                            }
                            //fill in the Mod Field
                            power.damage.substr(0, 1) === "+" ?
                                (importAttrs[
                                    `repeating_spells_${repSectionID}_spelldmgbonusnum`
                                ] = power.damage.substr(
                                    1,
                                    power.damage.length - 1
                                )) :
                                (importAttrs[
                                    `repeating_spells_${repSectionID}_spelldmgbonusnum`
                                ] = power.damage);
                        }
                        importAttrs[
                            `repeating_spells_${repSectionID}_showspellconfig`
                        ] = "0";
                    }
                }
            }
            importAttrs["numberofabs"] = numberofabs;
        }
        let additionalDerivedStats = 0;
        //get Cyberware
        if (jsonObj.cyberware.length > 0) {
            let strain = 0;
            for (let implant of jsonObj.cyberware) {
                log("Import Cyberware", implant.name, "darkgoldenrod");
                strain += implant.strain;
                let repSectionID = generateRowID();
                importAttrs[`repeating_gear_${repSectionID}_item`] =
                    implant.name;
                importAttrs[`repeating_gear_${repSectionID}_itemqty`] =
                    implant.quantity;
                importAttrs[`repeating_gear_${repSectionID}_itemcarried`] =
                    "on";
                importAttrs[
                    `repeating_gear_${repSectionID}_itemdescription`
                ] = "Ranks: " + implant.ranks + "\n";
                importAttrs[
                    `repeating_gear_${repSectionID}_itemdescription`
                ] += "Strain: " + implant.strain + "\n";
                importAttrs[
                    `repeating_gear_${repSectionID}_itemdescription`
                ] += implant.notes;
                importAttrs[`repeating_gear_${repSectionID}_showGearDesc`] =
                    "0";
            }
            let repSectionID = generateRowID();
            importAttrs["showadditionalderived"] = "on";
            additionalDerivedStats === 0 ?
                (importAttrs["derivedFirstName"] = "Strain") :
                (importAttrs[
                    `repeating_derivedstats_${repSectionID}_derivedName`
                ] = "Strain");
            additionalDerivedStats === 0 ?
                (importAttrs["derivedFirstCurrent"] = strain) :
                (importAttrs[
                    `repeating_derivedstats_${repSectionID}_derivedCurrent`
                ] = strain);
        }

        //get sanity

        //set the values
        setAttrs(importAttrs);
        setAttrs({ jsonImport: "" }, { silent: true });
    } else {
        console.log("Nothing to see here");
    }
});
</script>
<!-- Necessary Mixins-->
<!-- Hidden inputs for character sheet versioning, etc-->
<input type="hidden" name="attr_character_sheet" value="Official Savage Worlds v1.00.30"/>
<input type="hidden" name="attr_firstInit" value="0"/>
<input type="hidden" name="attr_namelength" value="0"/>
<input type="hidden" name="attr_wdNum" value="1"/>
<input type="hidden" name="wilddie" value="6"/>
<input type="hidden" name="attr_dopay" value="init"/>
<input class="hiddenInput" type="checkbox" name="attr_dealtJoker" value="2"/>
<input type="checkbox" style="display: none;" name="attr_showFightingByDefault" value="1"/>
<!-- hidden inputs to build the Statblock to Chat output-->
<input type="hidden" name="attr_initstatblock" value="0"/>
<input type="hidden" name="attr_initdesc" value="0"/>
<input type="hidden" name="attr_chardesc" value="{{name=@{character_name}}}"/>
<input type="hidden" name="attr_charatts" value="[^{agility} @{agility_display}](~tAgilityRoll), [^{smarts} @{smarts_display}@{animalsmarts_display}](~tSmartsRoll), [^{spirit} @{spirit_display}](~tSpiritRoll), [^{strength} @{strength_display}](~tStrengthRoll), [^{vigor} @{vigor_display}](~tVigorRoll)"/>
<input type="hidden" name="attr_initskills" value="0"/>
<input type="hidden" name="attr_charskills"/>
<input type="hidden" name="attr_initderived" value="0"/>
<input type="hidden" name="attr_charderived"/>
<input type="hidden" name="attr_initgear" value="0"/>
<input type="hidden" name="attr_chargear"/>
<input type="hidden" name="attr_inithindrances" value="0"/>
<input type="hidden" name="attr_charhindrances"/>
<input type="hidden" name="attr_initsbedges" value="0"/>
<input type="hidden" name="attr_charedges"/>
<input type="hidden" name="attr_initspecabilities" value="0"/>
<input type="hidden" name="attr_showspec"/>
<input type="hidden" name="attr_charspecabilities"/>
<input type="hidden" name="attr_initpowers" value="0"/>
<input type="hidden" name="attr_powercount" value="0"/>
<input type="hidden" name="attr_charpowers"/>
<input type="hidden" name="attr_ab1powerlist"/>
<input type="hidden" name="attr_ab2powerlist"/>
<input type="hidden" name="attr_ab3powerlist"/>
<input type="hidden" name="attr_ab4powerlist"/>
<input type="hidden" name="attr_ab5powerlist"/>
<input type="hidden" name="attr_unshakeTemplate" value="{{shaken=[[0d6+@{isShaken}]]}} {{unshake=[&lt;span data-i18n='roll-unshake-button'&gt;&lt;/span&gt;](~unshakeroll)}}"/>
<input type="hidden" name="attr_templateConditions" value="{{wildcard=[[@{is_npc}d1]]}} {{wcicon=@{WCI}}} {{vulnerable=[[0d6+@{vulnerable}]]}} {{stunned=[[0d6+@{stunned}]]}} {{distracteds=[[0d6+@{distracted}]]}}"/>
<!-- hidden inputs for modifiers-->
<input type="hidden" name="attr_ttmod" value="0"/>
<input type="hidden" name="attr_dmgmod" value="0"/>
<!-- ttmod-woundsMod-fatigue-->
<input type="hidden" name="attr_ModSum" value="0"/>
<!-- ttmod-woundsMod-fatigue+encumbrance-->
<input type="hidden" name="attr_ModSumEnc" value="0"/>
<input type="hidden" name="attr_armorMinStrMod" value="0"/>
<input type="hidden" name="attr_unshakeTemplate" value="{{shaken=[[0d6+@{isShaken}]]}} {{unshake=[&lt;span data-i18n='roll-unshake-button'&gt;&lt;/span&gt;](~unshakeroll)}}"/>
<input type="hidden" name="attr_templateConditions" value="{{wildcard=[[@{is_npc}d1]]}} {{wcicon=@{WCI}}} {{vulnerable=[[0d6+@{vulnerable}]]}} {{stunned=[[0d6+@{stunned}]]}} {{distracteds=[[0d6+@{distracted}]]}}"/>
<div class="version"><span name="attr_character_sheet"></span></div>
<div class="maindiv compendium-drop-target bestiary swade_archetypes">
  <!--Compendium Fields-->
  <input class="hiddenInput" type="text" name="attr_CompendiumName" accept="Name"/>
  <input class="hiddenInput" type="text" name="attr_CompendiumCategory" accept="Category"/>
  <input class="hiddenInput" type="text" name="attr_CompendiumContent" accept="Content"/>
  <input class="hiddenInput" type="text" name="attr_CompendiumData" accept="data"/>
  <!-- Avatar and Token URL information-->
  <input type="hidden" name="attr_avatar"/>
  <input type="hidden" name="attr_ctoken"/>
  <input type="hidden" name="attr_roll_template_token"/>
  <input class="useDarkMode" type="hidden" name="attr_dark_mode" value="0"/>
  <input class="useTheme" type="hidden" name="attr_sheet_theme" value="0"/>
  <input class="useBackground hiddenInput" type="hidden" name="attr_background" value="1"/>
  <div class="background" name="attr_backgroundImage">
    <div class="base"> 
      <!--"sheet of paper" the character sheet is on.-->
      <div class="buttonbar">
        <div class="navbuttons">
          <!--
          button tab key: 
          1 = character profile
          2 = Configuration Pane
          3 = Vehicles
          4 = Character notes
          5 = Release Notes
          6 = Sheet Documentation
          7 = Combat Options
          8 = Statblock/Condensed View of Character profile
          9 = Power Armor
          10 = Robot Armor
          -->
          <input class="selectedTab" type="hidden" name="attr_sheetTab" value="1"/>
          <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
          <!-- value 1 = Edit Mode-->
          <button class="topbuttons noEditMode" type="action" name="act_noEditMode" data-i18n-title="go-to-statblock-view">)</button>
          <!-- Set value to 0 = Non-Edit Mode-->
          <button class="topbuttons editMode" type="action" name="act_editMode" data-i18n-title="go-to-full-edit-view">(</button>
          <!-- Tab 1 = Character Profile-->
          <button class="topbuttons characterprofile" type="action" name="act_characterprofile_1"><span class="jumpto" data-i18n-title="jump-to-character-profile-tab">U</span><span class="ontab" data-i18n-title="on-character-profile-tab">U</span></button>
          <input class="showVehicles hiddenInput" type="checkbox" name="attr_vehicle"/>
          <!-- Tab 3 = Vehicles-->
          <button class="topbuttons vehiclesT vehicletab" type="action" name="act_vehicletab_3"><span class="jumpto" data-i18n-title="jump-to-vehicle-tab">T</span><span class="ontab" data-i18n-title="on-vehicle-tab">T</span></button>
          <input class="usePowerAmor hiddenInput" type="checkbox" name="attr_power_Armor" value="1"/>
          <!-- Tab 9 = Power Armor-->
          <button class="topbuttons showPowerArmor powerArmorTab" type="action" name="act_powerarmortab_9"></button>
          <input class="useRobotAmor hiddenInput" type="checkbox" name="attr_robot_Armor" value="1"/>
          <!-- Tab 10 = Robot Armor-->
          <button class="topbuttons showRobotArmor robotArmorTab" type="action" name="act_robotarmortab_10"></button>
          <!-- Tab 4 = Journal Tab-->
          <button class="topbuttons journaltab" type="action" name="act_journaltab_4"><span class="jumpto" data-i18n-title="jump-to-journal-tab">n</span><span class="ontab" data-i18n-title="on-journal-tab">n</span></button>
          <!-- Tab 2 = Configuration Tab-->
          <button class="topbuttons configurationtab" type="action" name="act_configurationtab_2"><span class="jumpto" data-i18n-title="jump-to-configuration-tab">x</span><span class="ontab" data-i18n-title="on-configuration-tab">x</span></button>
        </div>
        <div class="functions">
          <!-- value of 0 = Wild Card-->
          <input class="isWC" type="hidden" name="attr_is_npc" value="1"/>
          <button class="statblock" type="roll" name="roll_fullstatblock" data-i18n-title="send-statblock-chatlog" value="@{whisperstatblock} &amp;{template:statblock} @{chardesc} {{charatts=@{charatts}}} {{charskills=@{charskills}}} {{charderived=@{charderived}}} {{chargear=@{chargear}}} {{charhindrances=@{charhindrances}}} {{charedges=@{charedges}}} {{showspec=@{showspec}}} {{charspecabilities=@{charspecabilities}}} {{powercount=[[1d0+@{powercount}]]}} {{charpowers=@{charpowers}}}"><span class="showWCicon" name="attr_WCI"></span><img style="height: 28px;" src="http://imgsrv.roll20.net/?src=github.com/finderski/SWT/blob/master/BackgroundImages/statblock_profile.png%3Fraw%3Dtrue"/></button>
          <input class="showFear" type="checkbox" name="attr_showFear" value="1" checked="checked"/>
          <button class="topbuttons fearButton" type="roll" name="roll_fearCheckRoll" title="@{fearCheckRoll}" value="@{spiritbutton} {{skill_roll=[[@{spiritRollFormula}]]}} {{wild_die=[[@{spiritWildDieFormula}]]}} {{ReRoll=^{reroll}(~fearCheckRoll)}}  {{DmgRoll=[Fear Result](~fearRoll)}} {{theme=@{rolltemplate_theme}}}">&#128561;</button>
          <button class="hiddenInput" type="roll" name="roll_fearRoll" data-i18n-title="fear-roll" value="&amp;{template:info} {{name=Fear Table}} {{item=Result for @{character_name}}} {{fear=[[1d20+?{Fear Roll Modifier|0}]]}} {{heartattack=[[2d6]]}}">&#128561;</button>
        </div>
        <div class="docbuttons">
          <input class="selectedTab" type="hidden" name="attr_sheetTab" value="1"/>
          <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
          <!-- Tab 7 = Combat Options-->
          <button class="topbuttons combatOptionstab" type="action" name="act_combatoptionstab_7"><span class="jumpto" data-i18n-title="jump-to-combat-options-tab">&#128481;</span><span class="ontab" data-i18n-title="on-combat-options-tab">⚔️</span></button>
          <input class="selectedTab" type="hidden" name="attr_sheetTab" value="1"/>
          <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
          <input class="newcontent" type="hidden" name="attr_newcontent" value="unread"/>
          <!-- Tab 5 = Release Notes-->
          <button class="topbuttons releasenotesbutton" type="action" name="act_releasetab_5"><span class="unreadReleaseNotes" data-i18n-title="unread-releasenotes">N</span><span class="readReleaseNotes" data-i18n-title="read-releasenotes">I</span></button>
          <input class="newdocumentation" type="hidden" name="attr_newdocumentation" value="unread"/>
          <!-- Tab 6 = Documentation-->
          <button class="topbuttons documentationbutton" type="action" name="act_documentationtab_6">i</button>
        </div>
      </div>
      <input class="selectedTab" type="hidden" name="attr_sheetTab" value="1"/>
      <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
      <input class="useTheme" type="hidden" name="attr_sheet_theme" value="0"/>
      <div class="statblockview">
        <!-- Start the Page-->
        <div class="statBlockHeader">
          <h1 class="statblockName">
            <div class="headerContainer">
              <input class="isWC hiddenInput" type="checkbox" name="attr_is_npc" value="1"/><span class="showWCI" name="attr_WCI"> </span> <span name="attr_character_name"></span>
              <input class="statBlockRank" type="hidden" name="attr_rank"/><span class="showRank">
                 &nbsp; (<span name="attr_rank_display"></span>)</span>
            </div>
            <div class="charsummary">
              <!--
              h3.groupHeading
                  span(name="attr_racename")
                  | : &nbsp;
              --><span class="sumRace" name="attr_race"></span>
              <!-- | &nbsp;-->
              <!-- h3.groupHeading--><span><span data-i18n="size"></span>: &nbsp;<span class="size" name="attr_size"></span>&nbsp;(<span class="size" name="attr_sizecategory" data-i18n-dynamic="data-i18n-dynamic"></span>)&nbsp;</span>
              <input class="sizeCat" type="hidden" name="attr_sizecategory"/><span class="reach" data-i18n="reach"></span>
              <h3 class="groupHeading">
                <button class="benny" type="roll" name="roll_use_benny" value="/em uses a benny.">
                  <div class="imagecontainer"><img src="https://gitlab.com/peginc/swade/-/raw/master/src/assets/benny/benny-chip-front.png"/><span class="hiddenInput" data-i18n="bennies"></span></div>
                </button>
                <!--
                button(type="roll", class="benny" value="/em uses a benny.") 
                    span(data-i18n="bennies") Bennies
                -->
                <input class="bennies" type="number" value="0" name="attr_bennies"/>
              </h3>
              <!--h3.groupHeading-->
              <div class="convictionDiv"><span data-i18n="conviction"></span>: &nbsp;
                <label class="conviction">
                  <input class="hasconviction" type="checkbox" name="attr_conviction" value="1"/><span class="convictiontoken"></span>
                </label>
              </div>
            </div>
          </h1>
        </div>
        <!-- Description/History/Bio -->
        <div class="characterDescription">
          <input class="showDescription" type="hidden" name="attr_physdescription"/>
          <details>
            <summary><span data-i18n="description"></span></summary>
            <div class="characterDetails"><span name="attr_physdescription"></span>
              <input class="useWorstNightmare hiddenInput" type="checkbox" name="attr_worstNightmare"/>
              <div class="WorstNightmare">
                <h3 class="groupHeading" data-i18n="worst-nightmare"></h3>: <span name="attr_nightmare"></span>
              </div>
            </div>
          </details>
          <!-- race, size, bennies, conviction, Health stuff-->
          <div class="healthAndConditions">
            <input class="showconditions hiddenInput" type="checkbox" name="attr_showconditions" checked="checked"/>
            <div class="conditions">
              <div class="distracted">
                <label class="conditionlabel">
                  <input class="isdistracted" type="checkbox" value="-2" name="attr_distracted"/><span class="uhoh"></span><span class="conditionspan" data-i18n="distracted">Distracted</span>
                </label>
              </div>
              <div class="vulnerable">
                <label class="conditionlabel">
                  <input class="isvulnerable" type="checkbox" value="-2" name="attr_vulnerable"/><span class="uhoh"></span><span class="conditionspan" data-i18n="vulnerable">Vulnerable</span>
                </label>
              </div>
              <div class="stunned">
                <label class="conditionlabel">
                  <input class="isstunned" type="checkbox" value="-2" name="attr_stunned"/><span class="uhoh"></span><span class="conditionspan" data-i18n="stunned">Stunned</span>
                </label>
              </div>
            </div><!-- End Conditions -->
            <button class="traitbutton skillflexattbutton soak" type="roll" name="roll_soakroll" title="@{soakroll}" value="@{whispersoak} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltSoak} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}">&nbsp;<span data-i18n="soak">Soak</span></button>
            <div class="health">
              <div class="baseHealthTrait characterWounds">
                <input class="standardHealth" type="number" name="attr_wounds" title="@{wounds}" value="0"/><span data-i18n="of"></span>
                <input class="standardHealth" type="number" name="attr_wounds_max" title="@{wounds_max}" value="3"/>
                <div class="woundsLabel" data-i18n="wounds">Wounds</div>
              </div>
              <div class="base characterShakenInc">
                <div class="shakenbox" title="Shaken" data-i18n-title="shaken">
                  <input class="shaken" type="checkbox" name="attr_isShaken" value="1"/><span>!</span><span class="shakeninfo" data-i18n="shaken">Shaken</span>
                </div>
                <div class="incbox" title="Incapcitated" data-i18n-title="incapacitated">
                  <input class="inc" type="checkbox" name="attr_isinc"/><span>Y</span><span class="incinfo" data-i18n="incapacitated-abbr">Inc</span>
                </div>
              </div>
              <div class="base characterFatigue">
                <input class="standardHealth" type="number" name="attr_fatigue" title="@{fatigue}" value="0"/><span data-i18n="of"></span>
                <input class="standardHealth" type="number" name="attr_fatigue_max" title="@{fatigue_max}" value="2"/>
                <div class="fatigueLabel" data-i18n="fatigue">Fatigue</div>
              </div>
            </div>
            <button class="traitbutton skillflexattbutton unshake" type="roll" name="roll_unshakeroll" title="@{unshakeroll}" value="@{whisperunshake} &amp;{template:unshake} @{rolltunshake} {{mook=[[1d0+@{wdNum}]]}}">&nbsp;<span data-i18n="unshake">Unshake</span></button>
          </div>
        </div>
        <!-- Attributes | Derived Stats | Hindrances, Edges, Special Abilities-->
        <div class="attributeStatsPlus"> 
          <div class="spacerDiv"></div>
          <div class="rowContainer">
            <div class="attributesCondensed"> 
              <h3 class="groupHeading groupBlock" data-i18n="attributes">Attributes</h3>
              <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
              <input class="deltabutton" type="hidden" name="attr_agility_delta" value="0"/>
              <!--Added skill and wild die formula for roll template.-->
              <button class="traitbutton miniButton" type="roll" name="roll_tAgilityRoll" title="@{tAgilityRoll}" value="@{agilitybutton} {{skill_roll=[[@{agilityRollFormula}]]}} {{wild_die=[[@{agilityWildDieFormula}]]}} @{unshakeTemplate}"> <span data-i18n="agility">Agility </span>&nbsp; (<span name="attr_agility_display"> </span>)</button>
              <input class="deltabutton" type="hidden" name="attr_smarts_delta" value="0"/>
              <button class="traitbutton miniButton" type="roll" name="roll_tSmartsRoll" title="@{tSmartsRoll}" value="@{smartsbutton} {{skill_roll=[[@{smartsRollFormula}]]}} {{wild_die=[[@{smartsWildDieFormula}]]}} @{unshakeTemplate}"> <span data-i18n="smarts">Smarts </span><span name="attr_animalsmarts_display"> </span>(<span name="attr_smarts_display"> </span>)</button>
              <input class="deltabutton" type="hidden" name="attr_spirit_delta" value="0"/>
              <button class="traitbutton miniButton" type="roll" name="roll_tSpiritRoll" title="@{tSpiritRoll}" value="@{spiritbutton} {{skill_roll=[[@{spiritRollFormula}]]}} {{wild_die=[[@{spiritWildDieFormula}]]}} @{unshakeTemplate}"> <span data-i18n="spirit">Spirit </span>&nbsp; (<span name="attr_spirit_display"> </span>)</button>
              <input class="deltabutton" type="hidden" name="attr_strength_delta" value="0"/>
              <button class="traitbutton miniButton" type="roll" name="roll_tStrengthRoll" title="@{tStrengthRoll}" value="@{strengthbutton} {{skill_roll=[[@{strengthRollFormula}]]}} {{wild_die=[[@{strengthWildDieFormula}]]}} @{unshakeTemplate}"> <span data-i18n="strength">Strength </span>&nbsp; (<span name="attr_strength_display"> </span>)</button>
              <input class="deltabutton" type="hidden" name="attr_vigor_delta" value="0"/>
              <button class="traitbutton miniButton" type="roll" name="roll_tVigorRoll" title="@{tVigorRoll}" value="@{vigorbutton} {{skill_roll=[[@{vigorRollFormula}]]}} {{wild_die=[[@{vigorWildDieFormula}]]}} @{unshakeTemplate}"> <span data-i18n="vigor">Vigor </span>&nbsp; (<span name="attr_vigor_display"> </span>)</button>
            </div>
            <div class="derivedCondensed"> 
              <h3 class="groupHeading groupBlock" data-i18n="derived">Derived</h3>
              <!--Parry--><span data-i18n="parry"></span>: &nbsp;<span name="attr_parryCur"></span>
              <!--Toughness--><span data-i18n="toughness"></span>: &nbsp;<span name="attr_toughnesscur"></span>&nbsp;(<span name="attr_toughnessArmor"></span>)
              <!--Pace-->
              <button class="traitbutton miniButton" type="roll" name="roll_RunningRoll" title="@{RunningRoll}" value="@{running_formula}">
                <!--| &#128095; (--><span data-i18n="running"></span>&nbsp;(<span name="attr_runningDie" data-i18n-dynamic="data-i18n-dynamic"></span>)&nbsp;
              </button>
              <div class="paceCondensed"><span data-i18n="pace">Pace</span>: &nbsp;<span name="attr_paceCur"></span></div>
              <!--Others-->
              <input class="useDominion" type="hidden" name="attr_showDominion" value="0"/>
              <input class="showadditional hiddenInput" type="checkbox" name="attr_showadditionalderived"/>
              <div class="useDominion">
                <button class="traitbutton miniButton" type="roll" name="roll_DominionRoll" value="&amp;{template:info} {{name=@{character_name}}} {{item=Dominion Roll}} {{=[[ 1t[@{dominion-table}] ]] }} {{theme=@{rolltemplate_theme}}}">&#128520; &nbsp;<span data-i18n="dominion">Dominion</span></button>: &nbsp;<span name="attr_dominion"></span>
              </div>
              <input class="useBurn" type="hidden" name="attr_showBurn" value="0"/>
              <div class="useBurn">
                <button class="traitbutton deriveflexbutton burnButton miniButton" type="action" name="act_BurnRoll"><span class="flame">&#128293; &nbsp;</span><span data-i18n="burn">Burn</span><span>&nbsp;(</span><span name="attr_burn_die_type" data-i18n-dynamic="data-i18n-dynamic"></span><span>)</span></button>
              </div>
              <div class="additionalDerivedStats"> <span name="attr_derivedFirstName"></span>: <span name="attr_derivedFirstCurrent"></span>
                <fieldset class="repeating_derivedstats">
                  <div class="basederived">
                    <div class="derivelabel">
                      <input class="derivedStatName" type="text" name="attr_derivedName" title="@{derivedName}" data-i18n-placeholder="derived-stat-name"/>
                    </div>
                    <div class="derivebase">
                      <input class="derivedStat" type="number" name="attr_derivedBase" value="0" title="@{derivedBase}"/>
                    </div>
                    <div class="derivemod">
                      <input class="derivedStat" type="number" name="attr_derivedMod" value="0" title="@{derivedMod}"/>
                    </div>
                    <div class="derivecurrent">
                      <input class="derivedStat" type="number" name="attr_derivedCurrent" value="0" title="@{derivedCurrent}"/>
                    </div>
                    <div class="derivemisc">
                      <input class="derivedStat" type="number" name="attr_derivedMax" value="0" title="@{derivedMax}"/>
                    </div>
                  </div><span class="statblock" name="attr_derivedName"></span><span class="statblock">: </span><span class="statblock" name="attr_derivedCurrent"></span>
                </fieldset>
              </div>
              <input class="useLoad" type="checkbox" name="attr_useLoad" style="display:none;"/>
              <div class="loadstuff"><span data-i18n="load"></span>: &nbsp;<span name="attr_totalloadcarried"></span>&nbsp;(<span name="attr_encumbrance"></span>)</div>
            </div>
            <div class="hindrancesEdgesSAs"> 
              <input class="hindranceCount" type="hidden" name="attr_hindranceCount" value="0"/>
              <!-- h3.groupHeading.groupBlock.hindranceBlock(data-i18n="hindrances") Hindrances-->
              <div class="hindranceBlock"> 
                <h3 class="groupHeading" data-i18n="hindrances">Hindrances</h3>&nbsp; &nbsp;
                <fieldset class="repeating_hindrances">
                  <div class="base hindrance">
                    <input class="whispercheck" type="checkbox" name="attr_whisperDeets" value="/w gm " style="display: none;"/>
                    <button class="hindranceOutput" type="roll" name="roll_tHindrance" value="@{whisperDeets} &amp;{template:info} {{name=@{character_name}}} {{type=Hindrance}} {{item=@{hindrance}}} {{description=@{hindrancedescription}}} {{theme=@{rolltemplate_theme}}}"><span class="whispericon"></span><span class="statblock hindranceName" name="attr_hindrance"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
                    <input class="hinfield" type="text" name="attr_hindrance" data-i18n-placeholder="hindrance" data-i18n-title="hindrance"/>
                    <input class="hintype" type="text" name="attr_hindranceType" data-i18n-title="hindrance-type" data-i18n-placeholder="type"/>
                    <input class="moreConfig hiddenInput" type="checkbox" name="attr_showHindraceDesc" checked="checked"/>
                    <label class="configCog">
                      <input class="moreConfig hiddenInput" type="checkbox" name="attr_showHindraceDesc" checked="checked"/>y
                    </label>
                    <div class="hindranceMods">
                      <input type="checkbox" name="attr_whisperDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-hindrance">Whisper Hindrance Description</span>
                      <textarea name="attr_hindrancedescription" title="@{repeating_hindrances_$#_hindrancedescription}" placeholder="Hindrance description/details" data-i18n-placeholder="hindrance-desc"></textarea>
                    </div>
                  </div>
                </fieldset>
              </div>
              <!--input(type="hidden" name="attr_edgeCount" class="edgeCount" value="0")-->
              <!--
              .edgeBlock
                  h3.groupHeading(data-i18n="edges") Edges 
                  | &nbsp; &nbsp;
                  include _edgesRepeating.pug
              -->
              <input class="specialAbilityCount" type="hidden" name="attr_specialAbilityCount" value="0"/>
              <div class="specialAbilitiesBlock">
                <h3 class="groupHeading" data-i18n="special-abilities">Special Abilities </h3>&nbsp; &nbsp;
                <fieldset class="repeating_specialabilities">
                  <div class="base specialAbility">
                    <input class="whispercheck" style="display: none;" type="checkbox" name="attr_whisperSpecAbilityDeets" value="/w gm "/>
                    <button class="edgeOutput" type="roll" name="roll_tSpecAbilities" value="@{whisperSpecAbilityDeets} &amp;{template:info} {{name=@{character_name}}} {{type=^{special-ability}}} {{item=@{specialability}}} {{description=@{specialabilitydescription}}} {{theme=@{rolltemplate_theme}}}"><span class="whispericon"></span><span class="statblock hindranceName" name="attr_specialability"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
                    <input class="edgefield" type="text" name="attr_specialability" data-i18n-title="special-ability" data-i18n-placeholder="special-ability"/>
                    <input class="moreConfig hiddenInput" type="checkbox" name="attr_showSpecAbilityDesc" checked="checked"/>
                    <label class="configCog">
                      <input class="moreConfig hiddenInput" type="checkbox" name="attr_showSpecAbilityDesc" checked="checked"/>y
                    </label>
                    <div class="specialAbilityMods">
                      <input type="checkbox" name="attr_whisperSpecAbilityDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-special-ability-description">Whisper Special Ability Description</span><br/>
                      <textarea name="attr_specialabilitydescription" title="@{repeating_specialabilities_$#_specialabilitydescription}" data-i18n-placeholder="special-ability-description"></textarea>
                    </div>
                  </div>
                </fieldset>
              </div>
              <div class="skillsCondensed"> 
                <h3 class="groupHeading" data-i18n="skills">Skills</h3>&nbsp; &nbsp;
                <!--Unskilled-->
                <!--Button for Statblock view--><span class="unskilled condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tUnskilledRoll" title="@{tUnskilledRoll}" value="@{unskilledRollValue} {{skill_roll=[[ @{unskilledSkillRollFormula} ]]}} {{wild_die=[[ @{unskilledWildDieFormula} ]]}}"> <span data-i18n="unskilled-d4-2">Unskilled (d4-2)</span>
                  </button></span>
                <!--static skill list-->
                <!--do stuff-->
                <input class="hiddenInput staticacademics" type="checkbox" name="attr_staticacademics"/>
                <!--Button for Statblock view--><span class="academics condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tAcademicsRoll" title="@{tAcademicsRoll}" value="@{academicsRollValue} {{skill_roll=[[ @{academicsSkillRollFormula} ]]}} {{wild_die=[[ @{academicsWildDieFormula} ]]}}"> <span name="attr_academicsname"> </span>&nbsp;(<span name="attr_academics_display"></span>)
                  </button></span>
                <fieldset class="repeating_academicsspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tAcademicsSpecRoll" title="@{tAcademicsSpecRoll}" value="@{academicsSpecRollValue} {{skill_roll=[[ @{academicsSkillRollFormula} ]]}} {{wild_die=[[ @{academicsWildDieFormula} ]]}}"><span name="attr_academicsSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_academicsSpecRollValue" value="@{whisperacademics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_academicsspec_tAcademicsSpecRoll)}} {{trait=@{academicsSpecName} }} @{rolltAcademics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_academicsSpecName" title="@{repeating_academicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_academics_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticathletics" type="checkbox" name="attr_staticathletics"/>
                <!--Button for Statblock view--><span class="athletics condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tAthleticsRoll" title="@{tAthleticsRoll}" value="@{athleticsRollValue} {{skill_roll=[[ @{athleticsSkillRollFormula} ]]}} {{wild_die=[[ @{athleticsWildDieFormula} ]]}}"> <span name="attr_athleticsname"> </span>&nbsp;(<span name="attr_athletics_display"></span>)
                  </button></span>
                <fieldset class="repeating_athleticsspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tAthleticsSpecRoll" title="@{tAthleticsSpecRoll}" value="@{athleticsSpecRollValue} {{skill_roll=[[ @{athleticsSkillRollFormula} ]]}} {{wild_die=[[ @{athleticsWildDieFormula} ]]}}"><span name="attr_athleticsSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_athleticsSpecRollValue" value="@{whisperathletics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_athleticsspec_tAthleticsSpecRoll)}} {{trait=@{athleticsSpecName} }} @{rolltAthletics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_athleticsSpecName" title="@{repeating_athleticsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_athletics_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticbattle" type="checkbox" name="attr_staticbattle"/>
                <!--Button for Statblock view--><span class="battle condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tBattleRoll" title="@{tBattleRoll}" value="@{battleRollValue} {{skill_roll=[[ @{battleSkillRollFormula} ]]}} {{wild_die=[[ @{battleWildDieFormula} ]]}}"> <span name="attr_battlename"> </span>&nbsp;(<span name="attr_battle_display"></span>)
                  </button></span>
                <fieldset class="repeating_battlespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tBattleSpecRoll" title="@{tBattleSpecRoll}" value="@{battleSpecRollValue} {{skill_roll=[[ @{battleSkillRollFormula} ]]}} {{wild_die=[[ @{battleWildDieFormula} ]]}}"><span name="attr_battleSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_battleSpecRollValue" value="@{whisperbattle} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_battlespec_tBattleSpecRoll)}} {{trait=@{battleSpecName} }} @{rolltBattle} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_battleSpecName" title="@{repeating_battleSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_battle_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticboating" type="checkbox" name="attr_staticboating"/>
                <!--Button for Statblock view--><span class="boating condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tBoatingRoll" title="@{tBoatingRoll}" value="@{boatingRollValue} {{skill_roll=[[ @{boatingSkillRollFormula} ]]}} {{wild_die=[[ @{boatingWildDieFormula} ]]}}"> <span name="attr_boatingname"> </span>&nbsp;(<span name="attr_boating_display"></span>)
                  </button></span>
                <fieldset class="repeating_boatingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tBoatingSpecRoll" title="@{tBoatingSpecRoll}" value="@{boatingSpecRollValue} {{skill_roll=[[ @{boatingSkillRollFormula} ]]}} {{wild_die=[[ @{boatingWildDieFormula} ]]}}"><span name="attr_boatingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_boatingSpecRollValue" value="@{whisperboating} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_boatingspec_tBoatingSpecRoll)}} {{trait=@{boatingSpecName} }} @{rolltBoating} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_boatingSpecName" title="@{repeating_boatingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_boating_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticcommonknowledge" type="checkbox" name="attr_staticcommonknowledge"/>
                <!--Button for Statblock view--><span class="commonknowledge condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tCommonknowledgeRoll" title="@{tCommonknowledgeRoll}" value="@{commonknowledgeRollValue} {{skill_roll=[[ @{commonknowledgeSkillRollFormula} ]]}} {{wild_die=[[ @{commonknowledgeWildDieFormula} ]]}}"> <span name="attr_commonknowledgename"> </span>&nbsp;(<span name="attr_commonknowledge_display"></span>)
                  </button></span>
                <fieldset class="repeating_commonknowledgespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tCommonknowledgeSpecRoll" title="@{tCommonknowledgeSpecRoll}" value="@{commonknowledgeSpecRollValue} {{skill_roll=[[ @{commonknowledgeSkillRollFormula} ]]}} {{wild_die=[[ @{commonknowledgeWildDieFormula} ]]}}"><span name="attr_commonknowledgeSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_commonknowledgeSpecRollValue" value="@{whispercommonknowledge} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_commonknowledgespec_tCommonknowledgeSpecRoll)}} {{trait=@{commonknowledgeSpecName} }} @{rolltCommonknowledge} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_commonknowledgeSpecName" title="@{repeating_commonknowledgeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_commonknowledge_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticdriving" type="checkbox" name="attr_staticdriving"/>
                <!--Button for Statblock view--><span class="driving condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tDrivingRoll" title="@{tDrivingRoll}" value="@{drivingRollValue} {{skill_roll=[[ @{drivingSkillRollFormula} ]]}} {{wild_die=[[ @{drivingWildDieFormula} ]]}}"> <span name="attr_drivingname"> </span>&nbsp;(<span name="attr_driving_display"></span>)
                  </button></span>
                <fieldset class="repeating_drivingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tDrivingSpecRoll" title="@{tDrivingSpecRoll}" value="@{drivingSpecRollValue} {{skill_roll=[[ @{drivingSkillRollFormula} ]]}} {{wild_die=[[ @{drivingWildDieFormula} ]]}}"><span name="attr_drivingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_drivingSpecRollValue" value="@{whisperdriving} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_drivingspec_tDrivingSpecRoll)}} {{trait=@{drivingSpecName} }} @{rolltDriving} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_drivingSpecName" title="@{repeating_drivingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_driving_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticelectronics" type="checkbox" name="attr_staticelectronics"/>
                <!--Button for Statblock view--><span class="electronics condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tElectronicsRoll" title="@{tElectronicsRoll}" value="@{electronicsRollValue} {{skill_roll=[[ @{electronicsSkillRollFormula} ]]}} {{wild_die=[[ @{electronicsWildDieFormula} ]]}}"> <span name="attr_electronicsname"> </span>&nbsp;(<span name="attr_electronics_display"></span>)
                  </button></span>
                <fieldset class="repeating_electronicsspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tElectronicsSpecRoll" title="@{tElectronicsSpecRoll}" value="@{electronicsSpecRollValue} {{skill_roll=[[ @{electronicsSkillRollFormula} ]]}} {{wild_die=[[ @{electronicsWildDieFormula} ]]}}"><span name="attr_electronicsSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_electronicsSpecRollValue" value="@{whisperelectronics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_electronicsspec_tElectronicsSpecRoll)}} {{trait=@{electronicsSpecName} }} @{rolltElectronics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_electronicsSpecName" title="@{repeating_electronicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_electronics_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticfaith" type="checkbox" name="attr_staticfaith"/>
                <!--Button for Statblock view--><span class="faith condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tFaithRoll" title="@{tFaithRoll}" value="@{faithRollValue} {{skill_roll=[[ @{faithSkillRollFormula} ]]}} {{wild_die=[[ @{faithWildDieFormula} ]]}}"> <span name="attr_faithname"> </span>&nbsp;(<span name="attr_faith_display"></span>)
                  </button></span>
                <fieldset class="repeating_faithspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tFaithSpecRoll" title="@{tFaithSpecRoll}" value="@{faithSpecRollValue} {{skill_roll=[[ @{faithSkillRollFormula} ]]}} {{wild_die=[[ @{faithWildDieFormula} ]]}}"><span name="attr_faithSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_faithSpecRollValue" value="@{whisperfaith} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_faithspec_tFaithSpecRoll)}} {{trait=@{faithSpecName} }} @{rolltFaith} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_faithSpecName" title="@{repeating_faithSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_faith_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticfighting" type="checkbox" name="attr_staticfighting"/>
                <!--Button for Statblock view--><span class="fighting condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tFightingRoll" title="@{tFightingRoll}" value="@{fightingRollValue} {{skill_roll=[[ @{fightingSkillRollFormula} ]]}} {{wild_die=[[ @{fightingWildDieFormula} ]]}}"> <span name="attr_fightingname"> </span>&nbsp;(<span name="attr_fighting_display"></span>)
                  </button></span>
                <fieldset class="repeating_fightingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tFightingSpecRoll" title="@{tFightingSpecRoll}" value="@{fightingSpecRollValue} {{skill_roll=[[ @{fightingSkillRollFormula} ]]}} {{wild_die=[[ @{fightingWildDieFormula} ]]}}"><span name="attr_fightingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_fightingSpecRollValue" value="@{whisperfighting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_fightingspec_tFightingSpecRoll)}} {{trait=@{fightingSpecName} }} @{rolltFighting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_fightingSpecName" title="@{repeating_fightingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_fighting_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticfocus" type="checkbox" name="attr_staticfocus"/>
                <!--Button for Statblock view--><span class="focus condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tFocusRoll" title="@{tFocusRoll}" value="@{focusRollValue} {{skill_roll=[[ @{focusSkillRollFormula} ]]}} {{wild_die=[[ @{focusWildDieFormula} ]]}}"> <span name="attr_focusname"> </span>&nbsp;(<span name="attr_focus_display"></span>)
                  </button></span>
                <fieldset class="repeating_focusspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tFocusSpecRoll" title="@{tFocusSpecRoll}" value="@{focusSpecRollValue} {{skill_roll=[[ @{focusSkillRollFormula} ]]}} {{wild_die=[[ @{focusWildDieFormula} ]]}}"><span name="attr_focusSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_focusSpecRollValue" value="@{whisperfocus} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_focusspec_tFocusSpecRoll)}} {{trait=@{focusSpecName} }} @{rolltFocus} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_focusSpecName" title="@{repeating_focusSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_focus_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticgambling" type="checkbox" name="attr_staticgambling"/>
                <!--Button for Statblock view--><span class="gambling condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tGamblingRoll" title="@{tGamblingRoll}" value="@{gamblingRollValue} {{skill_roll=[[ @{gamblingSkillRollFormula} ]]}} {{wild_die=[[ @{gamblingWildDieFormula} ]]}}"> <span name="attr_gamblingname"> </span>&nbsp;(<span name="attr_gambling_display"></span>)
                  </button></span>
                <fieldset class="repeating_gamblingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tGamblingSpecRoll" title="@{tGamblingSpecRoll}" value="@{gamblingSpecRollValue} {{skill_roll=[[ @{gamblingSkillRollFormula} ]]}} {{wild_die=[[ @{gamblingWildDieFormula} ]]}}"><span name="attr_gamblingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_gamblingSpecRollValue" value="@{whispergambling} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_gamblingspec_tGamblingSpecRoll)}} {{trait=@{gamblingSpecName} }} @{rolltGambling} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_gamblingSpecName" title="@{repeating_gamblingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_gambling_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput statichacking" type="checkbox" name="attr_statichacking"/>
                <!--Button for Statblock view--><span class="hacking condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tHackingRoll" title="@{tHackingRoll}" value="@{hackingRollValue} {{skill_roll=[[ @{hackingSkillRollFormula} ]]}} {{wild_die=[[ @{hackingWildDieFormula} ]]}}"> <span name="attr_hackingname"> </span>&nbsp;(<span name="attr_hacking_display"></span>)
                  </button></span>
                <fieldset class="repeating_hackingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tHackingSpecRoll" title="@{tHackingSpecRoll}" value="@{hackingSpecRollValue} {{skill_roll=[[ @{hackingSkillRollFormula} ]]}} {{wild_die=[[ @{hackingWildDieFormula} ]]}}"><span name="attr_hackingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_hackingSpecRollValue" value="@{whisperhacking} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_hackingspec_tHackingSpecRoll)}} {{trait=@{hackingSpecName} }} @{rolltHacking} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_hackingSpecName" title="@{repeating_hackingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_hacking_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput statichealing" type="checkbox" name="attr_statichealing"/>
                <!--Button for Statblock view--><span class="healing condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tHealingRoll" title="@{tHealingRoll}" value="@{healingRollValue} {{skill_roll=[[ @{healingSkillRollFormula} ]]}} {{wild_die=[[ @{healingWildDieFormula} ]]}}"> <span name="attr_healingname"> </span>&nbsp;(<span name="attr_healing_display"></span>)
                  </button></span>
                <fieldset class="repeating_healingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tHealingSpecRoll" title="@{tHealingSpecRoll}" value="@{healingSpecRollValue} {{skill_roll=[[ @{healingSkillRollFormula} ]]}} {{wild_die=[[ @{healingWildDieFormula} ]]}}"><span name="attr_healingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_healingSpecRollValue" value="@{whisperhealing} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_healingspec_tHealingSpecRoll)}} {{trait=@{healingSpecName} }} @{rolltHealing} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_healingSpecName" title="@{repeating_healingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_healing_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticintimidation" type="checkbox" name="attr_staticintimidation"/>
                <!--Button for Statblock view--><span class="intimidation condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tIntimidationRoll" title="@{tIntimidationRoll}" value="@{intimidationRollValue} {{skill_roll=[[ @{intimidationSkillRollFormula} ]]}} {{wild_die=[[ @{intimidationWildDieFormula} ]]}}"> <span name="attr_intimidationname"> </span>&nbsp;(<span name="attr_intimidation_display"></span>)
                  </button></span>
                <fieldset class="repeating_intimidationspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tIntimidationSpecRoll" title="@{tIntimidationSpecRoll}" value="@{intimidationSpecRollValue} {{skill_roll=[[ @{intimidationSkillRollFormula} ]]}} {{wild_die=[[ @{intimidationWildDieFormula} ]]}}"><span name="attr_intimidationSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_intimidationSpecRollValue" value="@{whisperintimidation} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_intimidationspec_tIntimidationSpecRoll)}} {{trait=@{intimidationSpecName} }} @{rolltIntimidation} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_intimidationSpecName" title="@{repeating_intimidationSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_intimidation_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticlanguage" type="checkbox" name="attr_staticlanguage"/>
                <!--Button for Statblock view--><span class="language condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tLanguageRoll" title="@{tLanguageRoll}" value="@{languageRollValue} {{skill_roll=[[ @{languageSkillRollFormula} ]]}} {{wild_die=[[ @{languageWildDieFormula} ]]}}"> <span name="attr_native-languagename"> </span>&nbsp;(<span name="attr_language_display"></span>)
                  </button></span>
                <fieldset class="repeating_languagespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tLanguageSpecRoll" title="@{tLanguageSpecRoll}" value="@{languageSpecRollValue} {{skill_roll=[[ @{languageSkillRollFormula} ]]}} {{wild_die=[[ @{languageWildDieFormula} ]]}}"><span name="attr_languageSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_languageSpecRollValue" value="@{whisperlanguage} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_languagespec_tLanguageSpecRoll)}} {{trait=@{languageSpecName} }} @{rolltLanguage} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_languageSpecName" title="@{repeating_languageSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_language_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticnotice" type="checkbox" name="attr_staticnotice"/>
                <!--Button for Statblock view--><span class="notice condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tNoticeRoll" title="@{tNoticeRoll}" value="@{noticeRollValue} {{skill_roll=[[ @{noticeSkillRollFormula} ]]}} {{wild_die=[[ @{noticeWildDieFormula} ]]}}"> <span name="attr_noticename"> </span>&nbsp;(<span name="attr_notice_display"></span>)
                  </button></span>
                <fieldset class="repeating_noticespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tNoticeSpecRoll" title="@{tNoticeSpecRoll}" value="@{noticeSpecRollValue} {{skill_roll=[[ @{noticeSkillRollFormula} ]]}} {{wild_die=[[ @{noticeWildDieFormula} ]]}}"><span name="attr_noticeSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_noticeSpecRollValue" value="@{whispernotice} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_noticespec_tNoticeSpecRoll)}} {{trait=@{noticeSpecName} }} @{rolltNotice} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_noticeSpecName" title="@{repeating_noticeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_notice_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticoccult" type="checkbox" name="attr_staticoccult"/>
                <!--Button for Statblock view--><span class="occult condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tOccultRoll" title="@{tOccultRoll}" value="@{occultRollValue} {{skill_roll=[[ @{occultSkillRollFormula} ]]}} {{wild_die=[[ @{occultWildDieFormula} ]]}}"> <span name="attr_occultname"> </span>&nbsp;(<span name="attr_occult_display"></span>)
                  </button></span>
                <fieldset class="repeating_occultspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tOccultSpecRoll" title="@{tOccultSpecRoll}" value="@{occultSpecRollValue} {{skill_roll=[[ @{occultSkillRollFormula} ]]}} {{wild_die=[[ @{occultWildDieFormula} ]]}}"><span name="attr_occultSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_occultSpecRollValue" value="@{whisperoccult} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_occultspec_tOccultSpecRoll)}} {{trait=@{occultSpecName} }} @{rolltOccult} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_occultSpecName" title="@{repeating_occultSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_occult_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticperformance" type="checkbox" name="attr_staticperformance"/>
                <!--Button for Statblock view--><span class="performance condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tPerformanceRoll" title="@{tPerformanceRoll}" value="@{performanceRollValue} {{skill_roll=[[ @{performanceSkillRollFormula} ]]}} {{wild_die=[[ @{performanceWildDieFormula} ]]}}"> <span name="attr_performancename"> </span>&nbsp;(<span name="attr_performance_display"></span>)
                  </button></span>
                <fieldset class="repeating_performancespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tPerformanceSpecRoll" title="@{tPerformanceSpecRoll}" value="@{performanceSpecRollValue} {{skill_roll=[[ @{performanceSkillRollFormula} ]]}} {{wild_die=[[ @{performanceWildDieFormula} ]]}}"><span name="attr_performanceSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_performanceSpecRollValue" value="@{whisperperformance} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_performancespec_tPerformanceSpecRoll)}} {{trait=@{performanceSpecName} }} @{rolltPerformance} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_performanceSpecName" title="@{repeating_performanceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_performance_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticpersuasion" type="checkbox" name="attr_staticpersuasion"/>
                <!--Button for Statblock view--><span class="persuasion condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tPersuasionRoll" title="@{tPersuasionRoll}" value="@{persuasionRollValue} {{skill_roll=[[ @{persuasionSkillRollFormula} ]]}} {{wild_die=[[ @{persuasionWildDieFormula} ]]}}"> <span name="attr_persuasionname"> </span>&nbsp;(<span name="attr_persuasion_display"></span>)
                  </button></span>
                <fieldset class="repeating_persuasionspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tPersuasionSpecRoll" title="@{tPersuasionSpecRoll}" value="@{persuasionSpecRollValue} {{skill_roll=[[ @{persuasionSkillRollFormula} ]]}} {{wild_die=[[ @{persuasionWildDieFormula} ]]}}"><span name="attr_persuasionSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_persuasionSpecRollValue" value="@{whisperpersuasion} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_persuasionspec_tPersuasionSpecRoll)}} {{trait=@{persuasionSpecName} }} @{rolltPersuasion} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_persuasionSpecName" title="@{repeating_persuasionSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_persuasion_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticpiloting" type="checkbox" name="attr_staticpiloting"/>
                <!--Button for Statblock view--><span class="piloting condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tPilotingRoll" title="@{tPilotingRoll}" value="@{pilotingRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} ]]}} {{wild_die=[[ @{pilotingWildDieFormula} ]]}}"> <span name="attr_pilotingname"> </span>&nbsp;(<span name="attr_piloting_display"></span>)
                  </button></span>
                <fieldset class="repeating_pilotingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tPilotingSpecRoll" title="@{tPilotingSpecRoll}" value="@{pilotingSpecRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} ]]}} {{wild_die=[[ @{pilotingWildDieFormula} ]]}}"><span name="attr_pilotingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_pilotingSpecRollValue" value="@{whisperpiloting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_pilotingspec_tPilotingSpecRoll)}} {{trait=@{pilotingSpecName} }} @{rolltPiloting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_pilotingSpecName" title="@{repeating_pilotingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_piloting_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticpsionics" type="checkbox" name="attr_staticpsionics"/>
                <!--Button for Statblock view--><span class="psionics condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tPsionicsRoll" title="@{tPsionicsRoll}" value="@{psionicsRollValue} {{skill_roll=[[ @{psionicsSkillRollFormula} ]]}} {{wild_die=[[ @{psionicsWildDieFormula} ]]}}"> <span name="attr_psionicsname"> </span>&nbsp;(<span name="attr_psionics_display"></span>)
                  </button></span>
                <fieldset class="repeating_psionicsspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tPsionicsSpecRoll" title="@{tPsionicsSpecRoll}" value="@{psionicsSpecRollValue} {{skill_roll=[[ @{psionicsSkillRollFormula} ]]}} {{wild_die=[[ @{psionicsWildDieFormula} ]]}}"><span name="attr_psionicsSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_psionicsSpecRollValue" value="@{whisperpsionics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_psionicsspec_tPsionicsSpecRoll)}} {{trait=@{psionicsSpecName} }} @{rolltPsionics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_psionicsSpecName" title="@{repeating_psionicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_psionics_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticrepair" type="checkbox" name="attr_staticrepair"/>
                <!--Button for Statblock view--><span class="repair condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tRepairRoll" title="@{tRepairRoll}" value="@{repairRollValue} {{skill_roll=[[ @{repairSkillRollFormula} ]]}} {{wild_die=[[ @{repairWildDieFormula} ]]}}"> <span name="attr_repairname"> </span>&nbsp;(<span name="attr_repair_display"></span>)
                  </button></span>
                <fieldset class="repeating_repairspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tRepairSpecRoll" title="@{tRepairSpecRoll}" value="@{repairSpecRollValue} {{skill_roll=[[ @{repairSkillRollFormula} ]]}} {{wild_die=[[ @{repairWildDieFormula} ]]}}"><span name="attr_repairSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_repairSpecRollValue" value="@{whisperrepair} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_repairspec_tRepairSpecRoll)}} {{trait=@{repairSpecName} }} @{rolltRepair} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_repairSpecName" title="@{repeating_repairSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_repair_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticresearch" type="checkbox" name="attr_staticresearch"/>
                <!--Button for Statblock view--><span class="research condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tResearchRoll" title="@{tResearchRoll}" value="@{researchRollValue} {{skill_roll=[[ @{researchSkillRollFormula} ]]}} {{wild_die=[[ @{researchWildDieFormula} ]]}}"> <span name="attr_researchname"> </span>&nbsp;(<span name="attr_research_display"></span>)
                  </button></span>
                <fieldset class="repeating_researchspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tResearchSpecRoll" title="@{tResearchSpecRoll}" value="@{researchSpecRollValue} {{skill_roll=[[ @{researchSkillRollFormula} ]]}} {{wild_die=[[ @{researchWildDieFormula} ]]}}"><span name="attr_researchSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_researchSpecRollValue" value="@{whisperresearch} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_researchspec_tResearchSpecRoll)}} {{trait=@{researchSpecName} }} @{rolltResearch} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_researchSpecName" title="@{repeating_researchSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_research_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticriding" type="checkbox" name="attr_staticriding"/>
                <!--Button for Statblock view--><span class="riding condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tRidingRoll" title="@{tRidingRoll}" value="@{ridingRollValue} {{skill_roll=[[ @{ridingSkillRollFormula} ]]}} {{wild_die=[[ @{ridingWildDieFormula} ]]}}"> <span name="attr_ridingname"> </span>&nbsp;(<span name="attr_riding_display"></span>)
                  </button></span>
                <fieldset class="repeating_ridingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tRidingSpecRoll" title="@{tRidingSpecRoll}" value="@{ridingSpecRollValue} {{skill_roll=[[ @{ridingSkillRollFormula} ]]}} {{wild_die=[[ @{ridingWildDieFormula} ]]}}"><span name="attr_ridingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_ridingSpecRollValue" value="@{whisperriding} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_ridingspec_tRidingSpecRoll)}} {{trait=@{ridingSpecName} }} @{rolltRiding} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_ridingSpecName" title="@{repeating_ridingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_riding_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticscience" type="checkbox" name="attr_staticscience"/>
                <!--Button for Statblock view--><span class="science condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tScienceRoll" title="@{tScienceRoll}" value="@{scienceRollValue} {{skill_roll=[[ @{scienceSkillRollFormula} ]]}} {{wild_die=[[ @{scienceWildDieFormula} ]]}}"> <span name="attr_sciencename"> </span>&nbsp;(<span name="attr_science_display"></span>)
                  </button></span>
                <fieldset class="repeating_sciencespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tScienceSpecRoll" title="@{tScienceSpecRoll}" value="@{scienceSpecRollValue} {{skill_roll=[[ @{scienceSkillRollFormula} ]]}} {{wild_die=[[ @{scienceWildDieFormula} ]]}}"><span name="attr_scienceSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_scienceSpecRollValue" value="@{whisperscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_sciencespec_tScienceSpecRoll)}} {{trait=@{scienceSpecName} }} @{rolltScience} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_scienceSpecName" title="@{repeating_scienceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_science_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticshooting" type="checkbox" name="attr_staticshooting"/>
                <!--Button for Statblock view--><span class="shooting condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tShootingRoll" title="@{tShootingRoll}" value="@{shootingRollValue} {{skill_roll=[[ @{shootingSkillRollFormula} ]]}} {{wild_die=[[ @{shootingWildDieFormula} ]]}}"> <span name="attr_shootingname"> </span>&nbsp;(<span name="attr_shooting_display"></span>)
                  </button></span>
                <fieldset class="repeating_shootingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tShootingSpecRoll" title="@{tShootingSpecRoll}" value="@{shootingSpecRollValue} {{skill_roll=[[ @{shootingSkillRollFormula} ]]}} {{wild_die=[[ @{shootingWildDieFormula} ]]}}"><span name="attr_shootingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_shootingSpecRollValue" value="@{whispershooting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_shootingspec_tShootingSpecRoll)}} {{trait=@{shootingSpecName} }} @{rolltShooting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_shootingSpecName" title="@{repeating_shootingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_shooting_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticspellcasting" type="checkbox" name="attr_staticspellcasting"/>
                <!--Button for Statblock view--><span class="spellcasting condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tSpellcastingRoll" title="@{tSpellcastingRoll}" value="@{spellcastingRollValue} {{skill_roll=[[ @{spellcastingSkillRollFormula} ]]}} {{wild_die=[[ @{spellcastingWildDieFormula} ]]}}"> <span name="attr_spellcastingname"> </span>&nbsp;(<span name="attr_spellcasting_display"></span>)
                  </button></span>
                <fieldset class="repeating_spellcastingspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tSpellcastingSpecRoll" title="@{tSpellcastingSpecRoll}" value="@{spellcastingSpecRollValue} {{skill_roll=[[ @{spellcastingSkillRollFormula} ]]}} {{wild_die=[[ @{spellcastingWildDieFormula} ]]}}"><span name="attr_spellcastingSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_spellcastingSpecRollValue" value="@{whisperspellcasting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_spellcastingspec_tSpellcastingSpecRoll)}} {{trait=@{spellcastingSpecName} }} @{rolltSpellcasting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_spellcastingSpecName" title="@{repeating_spellcastingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_spellcasting_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticstealth" type="checkbox" name="attr_staticstealth"/>
                <!--Button for Statblock view--><span class="stealth condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tStealthRoll" title="@{tStealthRoll}" value="@{stealthRollValue} {{skill_roll=[[ @{stealthSkillRollFormula} ]]}} {{wild_die=[[ @{stealthWildDieFormula} ]]}}"> <span name="attr_stealthname"> </span>&nbsp;(<span name="attr_stealth_display"></span>)
                  </button></span>
                <fieldset class="repeating_stealthspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tStealthSpecRoll" title="@{tStealthSpecRoll}" value="@{stealthSpecRollValue} {{skill_roll=[[ @{stealthSkillRollFormula} ]]}} {{wild_die=[[ @{stealthWildDieFormula} ]]}}"><span name="attr_stealthSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_stealthSpecRollValue" value="@{whisperstealth} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_stealthspec_tStealthSpecRoll)}} {{trait=@{stealthSpecName} }} @{rolltStealth} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_stealthSpecName" title="@{repeating_stealthSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_stealth_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticsurvival" type="checkbox" name="attr_staticsurvival"/>
                <!--Button for Statblock view--><span class="survival condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tSurvivalRoll" title="@{tSurvivalRoll}" value="@{survivalRollValue} {{skill_roll=[[ @{survivalSkillRollFormula} ]]}} {{wild_die=[[ @{survivalWildDieFormula} ]]}}"> <span name="attr_survivalname"> </span>&nbsp;(<span name="attr_survival_display"></span>)
                  </button></span>
                <fieldset class="repeating_survivalspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tSurvivalSpecRoll" title="@{tSurvivalSpecRoll}" value="@{survivalSpecRollValue} {{skill_roll=[[ @{survivalSkillRollFormula} ]]}} {{wild_die=[[ @{survivalWildDieFormula} ]]}}"><span name="attr_survivalSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_survivalSpecRollValue" value="@{whispersurvival} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_survivalspec_tSurvivalSpecRoll)}} {{trait=@{survivalSpecName} }} @{rolltSurvival} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_survivalSpecName" title="@{repeating_survivalSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_survival_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput statictaunt" type="checkbox" name="attr_statictaunt"/>
                <!--Button for Statblock view--><span class="taunt condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tTauntRoll" title="@{tTauntRoll}" value="@{tauntRollValue} {{skill_roll=[[ @{tauntSkillRollFormula} ]]}} {{wild_die=[[ @{tauntWildDieFormula} ]]}}"> <span name="attr_tauntname"> </span>&nbsp;(<span name="attr_taunt_display"></span>)
                  </button></span>
                <fieldset class="repeating_tauntspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tTauntSpecRoll" title="@{tTauntSpecRoll}" value="@{tauntSpecRollValue} {{skill_roll=[[ @{tauntSkillRollFormula} ]]}} {{wild_die=[[ @{tauntWildDieFormula} ]]}}"><span name="attr_tauntSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_tauntSpecRollValue" value="@{whispertaunt} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_tauntspec_tTauntSpecRoll)}} {{trait=@{tauntSpecName} }} @{rolltTaunt} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_tauntSpecName" title="@{repeating_tauntSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_taunt_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticthievery" type="checkbox" name="attr_staticthievery"/>
                <!--Button for Statblock view--><span class="thievery condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tThieveryRoll" title="@{tThieveryRoll}" value="@{thieveryRollValue} {{skill_roll=[[ @{thieverySkillRollFormula} ]]}} {{wild_die=[[ @{thieveryWildDieFormula} ]]}}"> <span name="attr_thieveryname"> </span>&nbsp;(<span name="attr_thievery_display"></span>)
                  </button></span>
                <fieldset class="repeating_thieveryspec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tThieverySpecRoll" title="@{tThieverySpecRoll}" value="@{thieverySpecRollValue} {{skill_roll=[[ @{thieverySkillRollFormula} ]]}} {{wild_die=[[ @{thieveryWildDieFormula} ]]}}"><span name="attr_thieverySpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_thieverySpecRollValue" value="@{whisperthievery} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_thieveryspec_tThieverySpecRoll)}} {{trait=@{thieverySpecName} }} @{rolltThievery} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_thieverySpecName" title="@{repeating_thieverySpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_thievery_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput statictrade" type="checkbox" name="attr_statictrade"/>
                <!--Button for Statblock view--><span class="trade condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tTradeRoll" title="@{tTradeRoll}" value="@{tradeRollValue} {{skill_roll=[[ @{tradeSkillRollFormula} ]]}} {{wild_die=[[ @{tradeWildDieFormula} ]]}}"> <span name="attr_tradename"> </span>&nbsp;(<span name="attr_trade_display"></span>)
                  </button></span>
                <fieldset class="repeating_tradespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tTradeSpecRoll" title="@{tTradeSpecRoll}" value="@{tradeSpecRollValue} {{skill_roll=[[ @{tradeSkillRollFormula} ]]}} {{wild_die=[[ @{tradeWildDieFormula} ]]}}"><span name="attr_tradeSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_tradeSpecRollValue" value="@{whispertrade} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_tradespec_tTradeSpecRoll)}} {{trait=@{tradeSpecName} }} @{rolltTrade} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_tradeSpecName" title="@{repeating_tradeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_trade_specialty_display" value="d4"/>
                </fieldset>
                <!--do stuff-->
                <input class="hiddenInput staticweirdscience" type="checkbox" name="attr_staticweirdscience"/>
                <!--Button for Statblock view--><span class="weirdscience condensedSkill">
                  <button class="traitbutton miniButton" type="roll" name="roll_tWeirdscienceRoll" title="@{tWeirdscienceRoll}" value="@{weirdscienceRollValue} {{skill_roll=[[ @{weirdscienceSkillRollFormula} ]]}} {{wild_die=[[ @{weirdscienceWildDieFormula} ]]}}"> <span name="attr_weirdsciencename"> </span>&nbsp;(<span name="attr_weirdscience_display"></span>)
                  </button></span>
                <fieldset class="repeating_weirdsciencespec">
                  <button class="traitbutton miniButton condensedSkill" type="roll" name="roll_tWeirdscienceSpecRoll" title="@{tWeirdscienceSpecRoll}" value="@{weirdscienceSpecRollValue} {{skill_roll=[[ @{weirdscienceSkillRollFormula} ]]}} {{wild_die=[[ @{weirdscienceWildDieFormula} ]]}}"><span name="attr_weirdscienceSpecName"></span>
                    <!--
                    | &nbsp;(
                    span(name=`attr_${skill}_specialty_display`)
                    | )
                    -->
                  </button>
                  <input type="hidden" name="attr_weirdscienceSpecRollValue" value="@{whisperweirdscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_weirdsciencespec_tWeirdscienceSpecRoll)}} {{trait=@{weirdscienceSpecName} }} @{rolltWeirdscience} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input class="speciality" type="text" name="attr_weirdscienceSpecName" title="@{repeating_weirdscienceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                  <input class="hiddenInput" type="text" name="attr_weirdscience_specialty_display" value="d4"/>
                </fieldset>
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticKnowledgeOther"/>
                <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                <fieldset class="repeating_skills">
                  <!--input(type="hidden", value=`${name}`)-->
                  <!--input(type="hidden", value=`${skillAbbr}`)-->
                  <input type="hidden" value="true" name="attr_knowledgeother_cla"/>
                  <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                  <input type="hidden" value="sma,agl,spi,str,vig,na" name="attr_knowledgeother_lao"/>
                  <!--input(type="hidden", value=`${vartype}`)-->
                  <!-- Begin the Actual HTML for the Character Sheet-->
                  <div class="basetrait staticKnowledgeother" data-i18n-list-item="knowledgeother">
                    <input class="deltabutton" type="hidden" name="attr_knowledgeother_delta" value="0"/>
                    <input type="hidden" value="true" name="attr_knowledgeother_makeButton"/>
                    <input type="hidden" value="string" name="attr_knowledgeother_mbVarType"/>
                    <button class="skillbutton skillflexattbutton" type="roll" name="roll_tKnowledgeotherRoll" value="@{knowledgeotherRollValue} {{skill_roll=[[ @{knowledgeotherSkillRollFormula} ]]}} {{wild_die=[[ @{knowledgeotherWildDieFormula} ]]}}" title="@{tKnowledgeotherRoll}">&nbsp;<span name="attr_custSkillName"></span>
                      <!--
                      if skill === "knowledgeother"
                          span(name=`attr_${skill}buttonName`, value="Skill")
                      else if skill === "language"
                          span(name=`attr_native-${skill}name`)
                      else
                          span(name=`attr_${skill}name`) 
                      
                      -->&nbsp;<span class="linkedAtt" name="attr_linkedknowledgeotheratt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_knowledgeother_display"></span>)</span>
                    </button>
                    <input type="hidden" name="attr_knowledgeotherRollValue" value="@{whisperknowledgeother} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_skills_tKnowledgeotherRoll)}} {{trait=@{custSkillName}}} @{rolltKnowledgeother} @{linkedknowledgeotherattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                    <div class="skillRankContainer">
                      <div class="skillRankChild">
                        <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d4">
                          <input class="traitradio" type="radio" name="attr_knowledgeother" value="4" checked="checked"/><span class="d4"></span>
                          <div class="d4a" data-i18n="d4"></div>
                        </label>
                        <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d6">
                          <input class="traitradio" type="radio" name="attr_knowledgeother" value="6"/><span class="d6"></span>
                          <div class="d6a" data-i18n="d6"></div>
                        </label>
                        <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d8">
                          <input class="traitradio" type="radio" name="attr_knowledgeother" value="8"/><span class="d8"></span>
                          <div class="d8a" data-i18n="d8"></div>
                        </label>
                        <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d10">
                          <input class="traitradio" type="radio" name="attr_knowledgeother" value="10"/><span class="d10"></span>
                          <div class="d10a" data-i18n="d10"></div>
                        </label>
                        <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d12">
                          <input class="traitradio" type="radio" name="attr_knowledgeother" value="12"/><span class="d12"></span>
                          <div class="d12a" data-i18n="d12"></div>
                        </label>
                        <input class="traitradio" type="hidden" name="attr_knowledgeother" value="4"/>
                        <div class="d4Selected"><span class="d4"></span>
                          <div class="d4a" data-i18n="d4"></div>
                        </div>
                        <div class="d6Selected"><span class="d6"></span>
                          <div class="d6a" data-i18n="d6"></div>
                        </div>
                        <div class="d8Selected"><span class="d8"></span>
                          <div class="d8a" data-i18n="d8"></div>
                        </div>
                        <div class="d10Selected"><span class="d10"> </span>
                          <div class="d10a" data-i18n="d10"></div>
                        </div>
                        <div class="d12Selected"><span class="d12"></span>
                          <div class="d12a" data-i18n="d12"></div>
                        </div>
                      </div>+
                    </div>
                    <input class="otraitmod" type="number" name="attr_knowledgeothermod" title="@{knowledgeothermod}" value="0"/>
                    <details>
                      <summary class="config">y</summary>
                      <div class="traitmodplus">
                        <input class="ModDesc" type="text" name="attr_knowledgeotherModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                        <input class="otraitmod" type="number" name="attr_KnowledgeotherskillMod" title="@{Knowledgeotherskillmod}" value="0"/><span class="ModDesc" data-i18n="skill-name">Skill Name</span>
                        <input type="text" name="attr_custSkillName" value="Skill" maxlength="25"/>
                        <!-- input(type="text", name=`attr_${skill}buttonName` value="Skill" maxlength="25")--><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                        <select class="LinkedAttSelect" name="attr_linkedknowledgeotheratt">
                          <option value="sma-u" data-i18n="smarts">Smarts</option>
                          <option value="agl-u" data-i18n="agility">Agility</option>
                          <option value="spi-u" data-i18n="spirit">Spirit</option>
                          <option value="str-u" data-i18n="strength">Strength</option>
                          <option value="vig-u" data-i18n="vigor">Vigor</option>
                          <option value="na-u" data-i18n="not-applicable-abbr-u">N/A</option>
                        </select>
                        <!-- The following IF/Else was at this indentation...-->
                        <input type="hidden" name="attr_linkedknowledgeotherattbutton" value="@{setmods}"/>
                        <input type="hidden" name="attr_linkedknowledgeotherattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                        <hr class="modsection"/>
                        <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperknowledgeother"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                        <select class="traitdie" name="attr_knowledgeotherwilddie" title="@{knowledgeotherwilddie}">
                          <option value="4" data-i18n="d4">d4</option>
                          <option value="6" selected="selected" data-i18n="d6">d6</option>
                          <option value="8" data-i18n="d8">d8</option>
                          <option value="10" data-i18n="d10">d10</option>
                          <option value="12" data-i18n="d12">d12</option>
                        </select><span data-i18n="wild-die">Wild Die</span>
                        <input class="wildDieDesc" type="text" name="attr_knowledgeotherwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                        <input class="deltamod" type="number" name="attr_knowledgeother_delta" title="@{knowledgeother_delta}" value="0"/>
                        <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                        <input type="hidden" name="attr_knowledgeother_base"/>
                        <input type="hidden" name="attr_knowledgeothermod_base"/>
                      </div>
                    </details>
                    <input type="hidden" name="attr_knowledgeother_rank" value="1d4!"/>
                    <input type="hidden" name="attr_knowledgeother_display" value="d4"/>
                    <input type="hidden" name="attr_knowledgeotherSkillRollFormula" value="@{knowledgeother_rank} + @{KnowledgeotherskillMod} [@{knowledgeotherModType}] + @{linkedknowledgeotherattformula} + @{traitmods}"/>
                    <input type="hidden" name="attr_knowledgeotherWildDieFormula" value="1d@{knowledgeotherwilddie}! + @{knowledgeothermod} + @{KnowledgeotherskillMod} [@{knowledgeotherModType}] + @{linkedknowledgeotherattformula} + @{traitmods}"/>
                    <input type="hidden" name="attr_rolltKnowledgeother" value="{{name=@{character_name} }} {{skill_rank=@{knowledgeother_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                    <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                    <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  </div>
                </fieldset>
              </div>
            </div>
          </div>
          <div class="spacerDiv"> </div>
        </div>
        <!--Powers including power points-->
        <input class="powerCount" type="hidden" name="attr_powerCount" value="0"/>
        <div class="powersCondensed"> 
          <h3 class="groupHeading"><span name="attr_powerlabelplural"></span></h3>
          <input class="NoPP" type="checkbox" name="attr_NoPPRule" style="display: none;"/>
          <div class="powerpoints">
            <input class="showmultipleabs" type="hidden" name="attr_numberofabs" value="1"/>
            <!--each ab in numberOfABs+powerPointsConfig(`${ab}`)
            -->
            <input class="abcolor" type="hidden" name="attr_ab1color" value="white"/>
            <div class="ppcontainer label1">
              <label class="ablabel"><span name="attr_ablabel"></span><span class="statblock">&nbsp;</span>
              </label>
              <div class="ppfields">
                <input class="ppvalue" type="number" name="attr_PowerPoints" title="@{PowerPoints}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                <input class="ppvalue" type="number" name="attr_PowerPoints_max" title="@{PowerPoints_max}" value="0"/>
              </div>
              <label class="abpplabel"><span name="attr_ppelabel"></span>
              </label>
            </div>
            <input class="abcolor" type="hidden" name="attr_ab2color" value="red"/>
            <div class="ppcontainer label2">
              <label class="ablabel"><span name="attr_ablabel2"></span><span class="statblock">&nbsp;</span>
              </label>
              <div class="ppfields">
                <input class="ppvalue" type="number" name="attr_powerpoints2" title="@{powerpoints2}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                <input class="ppvalue" type="number" name="attr_powerpoints2_max" title="@{powerpoints2_max}" value="0"/>
              </div>
              <label class="abpplabel"><span name="attr_pplabel2"></span>
              </label>
            </div>
            <input class="abcolor" type="hidden" name="attr_ab3color" value="blue"/>
            <div class="ppcontainer label3">
              <label class="ablabel"><span name="attr_ablabel3"></span><span class="statblock">&nbsp;</span>
              </label>
              <div class="ppfields">
                <input class="ppvalue" type="number" name="attr_powerpoints3" title="@{powerpoints3}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                <input class="ppvalue" type="number" name="attr_powerpoints3_max" title="@{powerpoints3_max}" value="0"/>
              </div>
              <label class="abpplabel"><span name="attr_pplabel3"></span>
              </label>
            </div>
            <input class="abcolor" type="hidden" name="attr_ab4color" value="green"/>
            <div class="ppcontainer label4">
              <label class="ablabel"><span name="attr_ablabel4"></span><span class="statblock">&nbsp;</span>
              </label>
              <div class="ppfields">
                <input class="ppvalue" type="number" name="attr_powerpoints4" title="@{powerpoints4}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                <input class="ppvalue" type="number" name="attr_powerpoints4_max" title="@{powerpoints4_max}" value="0"/>
              </div>
              <label class="abpplabel"><span name="attr_pplabel4"></span>
              </label>
            </div>
            <input class="abcolor" type="hidden" name="attr_ab5color" value="purple"/>
            <div class="ppcontainer label5">
              <label class="ablabel"><span name="attr_ablabel5"></span><span class="statblock">&nbsp;</span>
              </label>
              <div class="ppfields">
                <input class="ppvalue" type="number" name="attr_powerpoints5" title="@{powerpoints5}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                <input class="ppvalue" type="number" name="attr_powerpoints5_max" title="@{powerpoints5_max}" value="0"/>
              </div>
              <label class="abpplabel"><span name="attr_pplabel5"></span>
              </label>
            </div>
          </div>
          <fieldset class="repeating_spells">
            <input type="hidden" name="attr_ablabsinit" value="0"/>
            <input class="powercolor" type="hidden" name="attr_powercolor" value="white"/>
            <div class="fullrow">
              <div class="powerrow">
                <div class="spellOutput">
                  <button class="hindranceOutput" type="roll" name="roll_spellinfo" value="&amp;{template:info} {{name=@{character_name}}} {{item=@{power}}} {{trappings=@{trappings}}} {{Notes=@{spellnotes}}} {{theme=@{rolltemplate_theme}}}"> <span class="whispericon">w</span></button>
                </div>
                <div class="powerbutton">
                  <button class="actualpowerbutton" type="roll" name="roll_tPower" value="@{spellroll}">
                    <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-18n="damage">Damage</span><span class="buttonsk" data-18n="skill">Cast</span>
                  </button>
                  <button class="statblock miniButton" type="roll" name="roll_tPower" value="@{spellroll}">
                    <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/><span class="buttonand">&#9876;</span><span class="buttondo">&#128481;</span><span class="buttonsk">&#128588;</span><span class="statblock" name="attr_power"></span>
                  </button>
                  <button class="hiddenButton" type="roll" name="roll_spelldmg" value="@{spelldamageOnly}"></button>
                  <button class="hiddenButton" type="roll" name="roll_spellsbonusDamage" value="&amp;{template:info} {{name=Bonus Damage}} {{item=@{spellsbdt}}} {{description=[[@{spellsbonusdmg}!]]}} {{theme=@{rolltemplate_theme}}}"></button>
                </div>
                <!-- div(class="power")-->
                <input class="power" type="text" name="attr_power" title="@{repeating_spells_$#_power}" data-i18n-placeholder="power" placeholder="Power"/>
                <!-- div(class='pp')-->
                <input class="pp" type="text" name="attr_pp" title="@{repeating_spells_$#_pp}" data-i18n-placeholder="power-point-abbr-u" placeholder="PP"/>
                <!-- div(class="powerrange")-->
                <input class="powerrange" type="text" name="attr_powerrange" title="@{repeating_spells_$#_powerrange}" data-i18n-placeholder="range" placeholder="Range"/>
                <div class="powerdamage">
                  <input type="hidden" name="attr_powerdamage"/>
                  <button class="invisbutton" type="action" name="act_sdamage"><span name="attr_powerdamage">&nbsp;</span></button>
                </div>
                <!-- div(class="duration")-->
                <input class="duration" type="text" name="attr_powerduration" title="@{repeating_spells_$#_powerduration}" data-i18n-placeholder="duration" placeholder="Duration"/>
                <!-- div(class="invested")-->
                <input class="invested" type="text" name="attr_ppinvested" title="@{repeating_spells_$#_ppinvested}" data-i18n-placeholder="power-point-abbr-u-invested" placeholder="PP Invested"/>
              </div>
              <!-- input(class='morespell' type='checkbox' name='attr_showspellconfig' checked)-->
              <!-- span y-->
              <input class="morespell moreConfig" type="checkbox" name="attr_showspellconfig" checked="checked"/>
              <label class="configCog">
                <input class="moreConfig" type="checkbox" name="attr_showspellconfig" checked="checked"/>y
              </label>
              <textarea class="spelltrappings" name="attr_trappings" title="@{repeating_spells_$#_spelltrappings}" data-i18n-placeholder="trappings" placeholder="Trappings"></textarea>
              <textarea class="spellnotes" name="attr_spellnotes" title="@{repeating_spells_$#_spellnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
              <div class="spellconfig">
                <div class="showabindicatorselection">
                  <label class="powerconfiglabel label1">Arcane Background Indicator:
                    <input type="hidden" name="attr_rptablabel" value="AB 1"/>
                    <input type="hidden" name="attr_rptab1color" value="white"/>
                    <input type="hidden" name="attr_rptablabel2" value="AB 2"/>
                    <input type="hidden" name="attr_rptab2color" value="red"/>
                    <input type="hidden" name="attr_rptablabel3" value="AB 3"/>
                    <input type="hidden" name="attr_rptab3color" value="blue"/>
                    <input type="hidden" name="attr_rptablabel4" value="AB 4"/>
                    <input type="hidden" name="attr_rptab4color" value="green"/>
                    <input type="hidden" name="attr_rptablabel5" value="AB 5"/>
                    <input type="hidden" name="attr_rptab5color" value="purple"/>
                    <div class="container">
                      <div class="child3">
                        <!--Look at using a mixin for this...-->
                        <label class="abmenu ab1">
                          <input class="select-radio ab1" type="radio" name="attr_powergroup" value="ab1" checked="checked"/><span class="powerdisplay" name="attr_rptablabel"></span>
                        </label>
                        <label class="abmenu ab2">
                          <input class="select-radio ab2" type="radio" name="attr_powergroup" value="ab2"/><span class="powerdisplay" name="attr_rptablabel2"></span>
                        </label>
                        <label class="abmenu ab3">
                          <input class="select-radio ab3" type="radio" name="attr_powergroup" value="ab3"/><span class="powerdisplay" name="attr_rptablabel3"></span>
                        </label>
                        <label class="abmenu ab4">
                          <input class="select-radio ab4" type="radio" name="attr_powergroup" value="ab4"/><span class="powerdisplay" name="attr_rptablabel4"></span>
                        </label>
                        <label class="abmenu ab5">
                          <input class="select-radio ab5" type="radio" name="attr_powergroup" value="ab5"/><span class="powerdisplay" name="attr_rptablabel5"></span>
                        </label>
                        <input class="select-radio" type="hidden" name="attr_powergroup" value="ab1"/>
                        <div class="ab1"><span name="attr_rptablabel"></span></div>
                        <div class="ab2"><span name="attr_rptablabel2"></span></div>
                        <div class="ab3"><span name="attr_rptablabel3"></span></div>
                        <div class="ab4"><span name="attr_rptablabel4"></span></div>
                        <div class="ab5"><span name="attr_rptablabel5"></span></div>
                      </div>
                    </div>
                  </label>
                </div>
                <label class="configlabels configcheckbox">
                  <input type="checkbox" value="/w gm" name="attr_whisperspell" title="@{repeating_spells_$#_whisperspell}"/><span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                </label>
                <label class="configlabels configcheckbox">
                  <input type="checkbox" name="attr_shownotes" value="{{notes=@{spellnotes}}}"/>&nbsp;<span data-i18n="show-notes-with-roll">Show notes with roll</span>
                </label>
                <hr class="modsection"/>
                <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                <select class="spellbutton" name="attr_spellbutton" title="@{repeating_spells_$#_spellbutton}">
                  <option value="2" data-i18n="skill-only">Skill Only</option>
                  <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                  <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                </select>
                <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/>
                <div class="spellskill">
                  <label class="configlabels" data-i18n="trait">Trait</label>
                  <div class="container">
                    <div class="child">
                      <label class="ddmenu athletics">
                        <input class="select-radio athletics" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="athletics"/>&nbsp;<span name="attr_sathleticsname"></span>
                      </label>
                      <label class="ddmenu faith">
                        <input class="select-radio faith" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="faith"/>&nbsp;<span name="attr_sfaithname"></span>
                      </label>
                      <label class="ddmenu focus">
                        <input class="select-radio focus" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="focus"/>&nbsp;<span name="attr_sfocusname"></span>
                      </label>
                      <label class="ddmenu performance">
                        <input class="select-radio performance" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="performance"/>&nbsp;<span name="attr_sperformancename"></span>
                      </label>
                      <label class="ddmenu psionics">
                        <input class="select-radio psionics" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="psionics"/>&nbsp;<span name="attr_spsionicsname"></span>
                      </label>
                      <label class="ddmenu spellcasting">
                        <input class="select-radio spellcasting" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="spellcasting"/>&nbsp;<span name="attr_sspellcastingname"></span>
                      </label>
                      <label class="ddmenu spirit">
                        <input class="select-radio spirit" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="spirit"/>&nbsp;<span data-i18n="spirit"></span>
                      </label>
                      <label class="ddmenu weirdscience">
                        <input class="select-radio weirdscience" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="weirdscience"/>&nbsp;<span name="attr_sweirdsciencename"></span>
                      </label>
                      <label class="ddmenu">
                        <input class="select-radio unskilled" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="unskilled" checked="checked"/>&nbsp;<span data-i18n="unskilled">Unskilled</span>
                      </label>
                      <input class="select-radio " type="hidden" name="attr_spellskill" value="unskilled"/>
                      <div class="athletics"><span name="attr_sathleticsname"></span></div>
                      <div class="faith"><span name="attr_sfaithname"></span></div>
                      <div class="focus"><span name="attr_sfocusname"></span></div>
                      <div class="performance"><span name="attr_sperformancename"></span></div>
                      <div class="psionics"><span name="attr_spsionicsname"></span></div>
                      <div class="spellcasting"><span name="attr_sspellcastingname"></span></div>
                      <div class="spirit"><span data-i18n="spirit"></span></div>
                      <div class="weirdscience"><span name="attr_sweirdsciencename"></span></div>
                      <div class="unskilled"><span data-i18n="unskilled">Unskilled</span></div>
                    </div>
                  </div>
                  <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                  <input type="text" placeholder="Magic Item" data-i18n-placeholder="magic-item" name="attr_spellAttackBonusReason"/>)&nbsp; 
                  <input class="numberFormat" type="text" name="attr_spellAttackBonus" value="0"/>
                </div>
                <div class="spelldamage">
                  <input class="highlight" type="checkbox" name="attr_shighlightdamage" value="1" style="display:none;"/>
                  <label class="configlabels" data-i18n="damage">Damage</label>
                  <select class="spellatt" name="attr_spelldamageatt" title="@{repeating_spells_$#_spelldamageatt}">
                    <option value="na" data-i18n="not-applicable-abbr-u" selected="selected">N/A</option>
                    <option value="strength" data-i18n="strength">Strength</option>
                    <option value="agility" data-i18n="agility">Agility</option>
                    <option value="smarts" data-i18n="smarts">Smarts</option>
                    <option value="spirit" data-i18n="spirit">Spirit</option>
                    <option value="vigor" data-i18n="vigor">Vigor</option>
                  </select>+
                  <input class="spellnum" type="number" name="attr_spelldmgnumdice" title="@{repeating_spells_$#_spelldmgnumdice}" style="text-align: right;" value="2"/>
                  <select class="dtype" name="attr_spelldmgdietype" title="@{repeating_spells_$#_spelldmgdietype}">
                    <option value="d4!" data-i18n="d4">d4</option>
                    <option value="d6!" selected="selected" data-i18n="d6">d6</option>
                    <option value="d8!" data-i18n="d8">d8</option>
                    <option value="d10!" data-i18n="d10">d10</option>
                    <option value="d12!" data-i18n="d12">d12</option>
                    <option value="d20!" data-i18n="d20">d20</option>
                  </select>+
                  <input class="spellnum" type="text" name="attr_spelldmgbonusnum" title="@{repeating_spells_$#_spelldmgbonusnum}" value="0"/>
                </div>
                <div class="vbonusdamage">
                  <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                  <div class="numOfBonusDice"> 
                    <input type="number" name="attr_spellsbdtnum" value="1"/>
                    <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                  </div>
                  <select class="dtype" name="attr_spellsbdt" title="@{repeating_spells_$#_spellsbdt}">
                    <option value="d4" data-i18n="d4">d4</option>
                    <option value="d6" selected="selected" data-i18n="d6">d6</option>
                    <option value="d8" data-i18n="d8">d8</option>
                    <option value="d10" data-i18n="d10">d10</option>
                    <option value="d12" data-i18n="d12">d12</option>
                    <option value="d20" data-i18n="d20">d20</option>
                  </select>
                </div>
                <input type="hidden" name="attr_spellroll" value="@{spelldamageOnly}"/>
                <!-- Used for Skill and Damage Roll-->
                <input type="hidden" name="attr_spellskillNDamage"/>
                <!-- Used for Damage Only-->
                <input type="hidden" name="attr_spelldamageOnly" value="@{spelldmgTemplate}"/>
                <!-- Used for Skill Only-->
                <input type="hidden" name="attr_skillOnly" value="@{skTemplate}"/>
                <!-- Skill Formulae-->
                <!--Future work, collapse this into another mixin where all I need to do is supply the traits-->
                <input type="hidden" name="attr_spellUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
                <input type="hidden" name="attr_spellUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
                <input type="hidden" name="attr_spellathleticsFormula" value="@{athleticsSkillRollFormula}"/>
                <input type="hidden" name="attr_spellathleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
                <input type="hidden" name="attr_spellfaithFormula" value="@{faithSkillRollFormula}"/>
                <input type="hidden" name="attr_spellfaithWildDieFormula" value="@{faithWildDieFormula}"/>
                <input type="hidden" name="attr_spellfocusFormula" value="@{focusSkillRollFormula}"/>
                <input type="hidden" name="attr_spellfocusWildDieFormula" value="@{focusWildDieFormula}"/>
                <input type="hidden" name="attr_spellperformanceFormula" value="@{performanceSkillRollFormula}"/>
                <input type="hidden" name="attr_spellperformanceWildDieFormula" value="@{performanceWildDieFormula}"/>
                <input type="hidden" name="attr_spellpsionicsFormula" value="@{psionicsSkillRollFormula}"/>
                <input type="hidden" name="attr_spellpsionicsWildDieFormula" value="@{psionicsWildDieFormula}"/>
                <input type="hidden" name="attr_spellspellcastingFormula" value="@{spellcastingSkillRollFormula}"/>
                <input type="hidden" name="attr_spellspellcastingWildDieFormula" value="@{spellcastingWildDieFormula}"/>
                <input type="hidden" name="attr_spellspiritFormula" value="@{spiritRollFormula}"/>
                <input type="hidden" name="attr_spellspiritWildDieFormula" value="@{spiritWildDieFormula}"/>
                <input type="hidden" name="attr_spellWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
                <input type="hidden" name="attr_spellWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
                <!-- Build the Damage Roll Template Info-->
                <!--damage formula-->
                <input type="hidden" name="attr_spelldmg"/>
                <input type="hidden" name="attr_spellsbonusdmg" value="@{vbonusdamage}"/>
                <input type="hidden" name="attr_spellsbonusDie" value="{{bonus_die=[[@{spellsbonusdmg}!]]}}"/>
                <input type="text" style="display: none;" name="attr_spelldmgTemplate" value="@{whisperspell} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{power} }} {{trappings=@{trappings}}} {{dmg_rank=@{powerdamage}}} {{dmg_roll=[[@{spelldmg} + @{damagemods}]]}} @{spellsbonusDie} @{dmgshownotes} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_spells_spelldmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_spells_spellgrittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <input type="hidden" name="attr_skTemplate" value="1d6!"/>
                <input type="hidden" name="attr_dmgshownotes" value="{{notes=@{spellnotes}}}"/>
                <button type="roll" style="display: none;" name="roll_spellgrittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"></button>
              </div>
              <input class="spellconfigb" type="checkbox" name="attr_showspellconfig" style="display:none;" checked="checked"/>
            </div>
          </fieldset>
        </div>
        <!--Gear (order of display: weapons, armor, gear)-->
        <div class="gearCondensed"> 
          <h3 class="groupHeading" data-i18n="gear">Gear</h3>
          <!--Load-->
          <input class="useLoad" type="checkbox" name="attr_useLoad" style="display:none;"/><span class="statblock loadstuff"><span data-i18n="load"></span>:&nbsp;<span name="attr_totalloadcarried"></span>&nbsp;(<span name="attr_encumbrance"></span>)</span>
          <!--Weapons-->
          <input type="hidden" name="attr_vbonusdamage" value="1d6"/>
          <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
          <fieldset class="repeating_weapons" style="width: 100%;">
            <div class="weaponfull">
              <button class="weaponItem button" type="roll" name="roll_tWeapon" value="@{weaponroll}"> 
                <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-i18n="damage">Damage</span><span class="buttonma" data-i18n="multi-attack-and-damage-abbr">
                   Atk<sup>x</sup>+Dmg</span>
              </button>
              <button class="statblock miniButton" type="roll" name="roll_tWeapon2" value="@{weaponroll}"> 
                <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand crossedSwords">&#9876;&nbsp;</span><span class="buttondo dagger">&#128481;&nbsp;</span><span class="buttonma"> <span class="crossedSwords">&#9876;</span><span class="dagger">&#128481;</span>&nbsp;</span><span class="statblock" name="attr_weapon"></span><span class="statblock openParens">(</span>
                <input class="weaponRange" type="hidden" name="attr_range"/><span class="statblock showRange">Range </span><span class="statblock showRange" name="attr_range"></span><span class="statblock showRange">, </span><span class="statblock damage" data-i18n="damage">Damage</span><span class="statblock" name="attr_weapondamage"></span><span class="statblock">)</span>
              </button>
              <button class="hiddenButton" type="roll" name="roll_dmg" value="@{damageOnly}"> </button>
              <button class="hiddenButton" type="roll" name="roll_weaponsbonusDamage" value="&amp;{template:bonusDamage} {{dieType=@{weaponsbdtnum}@{weaponsbdt}}} {{bonusDamage=[[@{vbonusdamage}!]]}}"> </button>
              <input class="weaponItem weapon" type="text" name="attr_weapon" title="@{repeating_weapons_$#_weapon}" data-i18n-placeholder="weapon" placeholder="Weapon"/>
              <input class="weaponItem range" type="text" name="attr_range" title="@{repeating_weapons_$#_range}" data-i18n-placeholder="range" placeholder="Range"/>
              <button class="weaponItem damage invisbutton" type="action" name="act_wdamage"> <span name="attr_weapondamage"> </span></button>
              <input type="hidden" name="attr_weapondamage" value="Str+1d4"/>
              <input class="weaponItem weaponap" type="number" name="attr_weaponap" title="@{repeating_weapons_$#_weaponap}"/>
              <input class="weaponItem rof" type="number" name="attr_rof" title="@{repeating_weapons_$#_rof}" data-i18n-placeholder="rate-of-fire-abbr" placeholder="ROF"/>
              <div class="weaponItem shots">
                <input class="weaponshots" type="number" name="attr_shots" title="@{repeating_weapons_$#_shots}"/>&nbsp;of&nbsp;
                <input class="weaponshots" type="number" name="attr_shots_max" title="@{repeating_weapons_$#_shots_max}"/>
              </div>
              <input class="weaponItem weaponweight" type="number" step="any" name="attr_weaponweight" title="@{repeating_weapons_$#_weaponweight}" data-i18n-placeholder="weight-abbr" placeholder="Wt"/>
              <!-- div(class='weaponItem weaponcarried')-->
              <label class="weaponItem weaponcarried">
                <input class="itemCarried isCarried" type="checkbox" name="attr_weaponcarried" title="@{repeating_weapons_$#_weaponcarried}"/><span class="isCarriedIcon"> </span>
              </label>
              <input class="moreConfig hiddenInput" type="checkbox" name="attr_showweaponconfig" checked="checked"/>
              <label class="configCog">
                <input class="moreConfig" type="checkbox" name="attr_showweaponconfig" checked="checked"/>y
              </label>
              <textarea class="weaponItem weaponnotes" name="attr_weaponnotes" title="@{repeating_weapons_$#_weaponnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
              <div class="weaponconfig">
                <label class="configlabels configcheckbox"> 
                  <input type="checkbox" value="/w gm" name="attr_whisperweapon" title="@{repeating_weapons_$#_whisperweapon}"/>&nbsp;<span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span>
                </label><br/>
                <label class="configlabels" data-i18n="minimum-strength">Minimum Strength</label>
                <input type="hidden" name="attr_minstrength" value="4"/>
                <select class="dtype" name="attr_weaponminstrength" title="@{repeating_weapons_$#_minstrength}"> 
                  <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                  <option value="4" data-i18n="d4" selected="selected">d4</option>
                  <option value="6" data-i18n="d6">d6</option>
                  <option value="8" data-i18n="d8">d8</option>
                  <option value="10" data-i18n="d10">d10</option>
                  <option value="12" data-i18n="d12">d12</option>
                </select><br/>
                <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                <input class="showmultiattack" type="hidden" name="attr_showmulti" value="0"/>
                <select class="weaponbutton" name="attr_weaponbutton" title="@{repeating_weapons_$#_weaponbutton}"> 
                  <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                  <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                  <option class="multiattack" value="2" data-i18n="multi-attack-and-damage-abbr">Atk^+Dmg</option>
                </select>
                <input class="weaponbutton" type="hidden" name="attr_weaponbutton"/>
                <div class="weaponskill">
                  <label class="configlabels" data-i18n="skill">Skill</label>
                  <div class="container">
                    <div class="child">
                      <label class="ddmenu athletics"> 
                        <input class="select-radio athletics" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="athletics"/>&nbsp;<span name="attr_rathleticsname"></span>
                      </label>
                      <label class="ddmenu faith"> 
                        <input class="select-radio faith" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="faith"/>&nbsp;<span name="attr_rfaithname"></span>
                      </label>
                      <label class="ddmenu fighting"> 
                        <input class="select-radio fighting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="fighting"/>&nbsp;<span name="attr_rfightingname"></span>
                      </label>
                      <label class="ddmenu focus"> 
                        <input class="select-radio focus" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="focus"/>&nbsp;<span name="attr_rfocusname"></span>
                      </label>
                      <label class="ddmenu performance"> 
                        <input class="select-radio performance" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="performance"/>&nbsp;<span name="attr_rperformancename"></span>
                      </label>
                      <label class="ddmenu psionics"> 
                        <input class="select-radio psionics" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="psionics"/>&nbsp;<span name="attr_rpsionicsname"></span>
                      </label>
                      <label class="ddmenu shooting"> 
                        <input class="select-radio shooting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="shooting"/>&nbsp;<span name="attr_rshootingname"></span>
                      </label>
                      <label class="ddmenu spellcasting"> 
                        <input class="select-radio spellcasting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="spellcasting"/>&nbsp;<span name="attr_rspellcastingname"></span>
                      </label>
                      <label class="ddmenu weirdscience"> 
                        <input class="select-radio weirdscience" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="weirdscience"/>&nbsp;<span name="attr_rweirdsciencename"></span>
                      </label>
                      <!--
                      label(class="ddmenu") 
                           input(type="radio" class="select-radio fighting" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="fighting" checked="checked")
                           | &nbsp;
                           span(name='attr_rfightingname') 
                      label(class="ddmenu athletics") 
                           input(type="radio" class="select-radio athletics" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="athletics")
                           | &nbsp;
                           span(name='attr_rathleticsname') 
                      label(class="ddmenu shooting") 
                           input(type="radio" class="select-radio shooting" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="shooting")
                           | &nbsp;
                           span(name='attr_rshootingname') 
                      label(class="ddmenu") 
                           input(type="radio" class="select-radio unskilled" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="unskilled")
                           | &nbsp;
                           span(data-i18n='unskilled') Unskilled
                      label(class="ddmenu weirdscience") 
                           input(type="radio" class="select-radio weirdscience" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="weirdscience")
                           | &nbsp;
                           span(name='attr_rweirdsciencename') 
                      
                      -->
                      <!--Manually add the stuff for Spirit, because it doesn't follow the pattern...-->
                      <label class="ddmenu spirit"> 
                        <input class="select-radio spirit" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="spirit"/>&nbsp;<span data-i18n="spirit">Spirit</span>
                      </label>
                      <input class="select-radio" type="hidden" name="attr_weaponskill" value="fighting"/>
                      <div class="athletics"><span name="attr_rathleticsname"></span></div>
                      <div class="faith"><span name="attr_rfaithname"></span></div>
                      <div class="fighting"><span name="attr_rfightingname"></span></div>
                      <div class="focus"><span name="attr_rfocusname"></span></div>
                      <div class="performance"><span name="attr_rperformancename"></span></div>
                      <div class="psionics"><span name="attr_rpsionicsname"></span></div>
                      <div class="shooting"><span name="attr_rshootingname"></span></div>
                      <div class="spellcasting"><span name="attr_rspellcastingname"></span></div>
                      <div class="weirdscience"><span name="attr_rweirdsciencename"></span></div>
                      <div class="spirit"><span data-i18n="spirit">Spirit</span></div>
                      <!--
                      div(class="fighting")
                           span(name='attr_rfightingname') 
                      div(class="athletics")
                           span(name='attr_rathleticsname') 
                      div(class="shooting")
                           span(name='attr_rshootingname') 
                      div(class="unskilled")
                           span(data-i18n='unskilled') Unskilled
                      div(class="weirdscience")
                           span(name='attr_rweirdsciencename') 
                      -->
                    </div>
                  </div>
                  <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                  <input type="text" placeholder="Trademark Weapon" data-i18n-placeholder="trademark-weapon" name="attr_weaponAttackBonusReason"/>)&nbsp; 
                  <input type="number" name="attr_weaponAttackBonus" value="0"/>
                </div>
                <div class="weapondamage">
                  <input class="highlight" type="checkbox" name="attr_highlightdamage" value="1" style="display: none;"/>
                  <label class="configlabels" data-i18n="damage">Damage</label>
                  <select class="weaponatt" name="attr_damageatt" title="@{repeating_weapons_$#_damageatt}"> 
                    <option value="na" data-i18n="not-applicable-abbr-u">N/A</option>
                    <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                    <option value="agility" data-i18n="agility">Agility</option>
                    <option value="smarts" data-i18n="smarts">Smarts</option>
                    <option value="spirit" data-i18n="spirit">Spirit</option>
                    <option value="vigor" data-i18n="vigor">Vigor</option>
                  </select>+
                  <input class="weaponnum" type="number" name="attr_dmgnumdice" title="@{repeating_weapons_$#_dmgnumdice}" style="text-align: right;" value="1"/>
                  <select class="dtype" name="attr_dmgdietype" title="@{repeating_weapons_$#_dmgdietype}"> 
                    <option value="d4!" data-i18n="d4">d4</option>
                    <option value="d6!" data-i18n="d6">d6</option>
                    <option value="d8!" data-i18n="d8">d8</option>
                    <option value="d10!" data-i18n="d10">d10</option>
                    <option value="d12!" data-i18n="d12">d12</option>
                    <option value="d20!" data-i18n="d20">d20</option>
                  </select>+
                  <input class="weaponnum" type="text" name="attr_dmgbonusnum" title="@{repeating_weapons_$#_dmgbonusnum}"/>
                </div>
                <div class="vbonusdamage">
                  <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                  <div class="numOfBonusDice"> 
                    <input type="number" name="attr_weaponsbdtnum" value="1"/>
                    <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                  </div>
                  <select class="dtype" name="attr_weaponsbdt" title="@{repeating_weapons_$#_weaponsbdt}"> 
                    <option value="d4" data-i18n="d4">d4</option>
                    <option value="d6" selected="selected" data-i18n="d6">d6</option>
                    <option value="d8" data-i18n="d8">d8</option>
                    <option value="d10" data-i18n="d10">d10</option>
                    <option value="d12" data-i18n="d12">d12</option>
                    <option value="d20" data-i18n="d20">d20</option>
                  </select>
                </div>
              </div>
              <!-- Skill Formulae-->
              <input type="hidden" name="attr_weaponUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
              <!-- Fighting-->
              <input type="hidden" name="attr_weaponFightingFormula" value="@{fightingSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponFightingWildDieFormula" value="@{fightingWildDieFormula}"/>
              <!-- Athletics-->
              <input type="hidden" name="attr_weaponAthleticsFormula" value="@{athleticsSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponAthleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
              <!-- Shooting-->
              <input type="hidden" name="attr_weaponShootingFormula" value="@{shootingSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponShootingWildDieFormula" value="@{shootingWildDieFormula}"/>
              <!-- Weird Science-->
              <input type="hidden" name="attr_weaponWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
              <!-- Faith-->
              <input type="hidden" name="attr_weaponfaithFormula" value="@{faithSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponfaithWildDieFormula" value="@{faithWildDieFormula}"/>
              <!-- Focus-->
              <input type="hidden" name="attr_weaponfocusFormula" value="@{focusSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponfocusWildDieFormula" value="@{focusWildDieFormula}"/>
              <!-- Performance-->
              <input type="hidden" name="attr_weaponperformanceFormula" value="@{performanceSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponperformanceWildDieFormula" value="@{performanceWildDieFormula}"/>
              <!-- Psionics-->
              <input type="hidden" name="attr_weaponpsionicsFormula" value="@{psionicsSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponpsionicsWildDieFormula" value="@{psionicsWildDieFormula}"/>
              <!-- Spellcasting-->
              <input type="hidden" name="attr_weaponspellcastingFormula" value="@{spellcastingSkillRollFormula}"/>
              <input type="hidden" name="attr_weaponspellcastingWildDieFormula" value="@{spellcastingWildDieFormula}"/>
              <!-- Spirit-->
              <input type="hidden" name="attr_weaponspiritFormula" value="@{spiritRollFormula}"/>
              <input type="hidden" name="attr_weaponspiritWildDieFormula" value="@{spiritWildDieFormula}"/>
              <!-- Hidden Fields for the roll button(s), etc-->
              <input type="hidden" name="attr_weaponroll" value="@{damageOnly}"/>
              <!-- Used for Skill and Damage roll-->
              <input type="hidden" name="attr_skillNDamage" value="@{whisperweapon} &amp;{template:roll} {{namelength=@{namelength}}} {{trait=Fighting}} {{source=@{weapon}}} @{rolltFighting} {{skill_roll=&amp;{noerror} [[ @{weaponFightingFormula} ]]}} {{wild_die=[[ @{weaponFightingWildDieFormula} ]]}} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~repeating_weapons_tWeapon) }} {{DmgRoll=^{roll-damage}(~repeating_weapons_dmg) }} @{multiattack} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
              <!-- skillNDamage used to have @{rolltFighting}  right after {{source=@{weapon}}}-->
              <!-- Used for Multiattack-->
              <input type="hidden" name="attr_multiattack" value="0"/>
              <!-- Used for Damage Only-->
              <input type="hidden" name="attr_damageOnly" value="@{dmgTemplate}"/>
              <!-- Build the Damage Roll Template Info-->
              <!-- the damage formula-->
              <input type="hidden" name="attr_weapondmg" value="@{strength_rank}+1d4!"/>
              <!-- This will either equal @{vbonusdamage} (the default) or @{weaponsbdt}-->
              <input type="hidden" name="attr_weaponsbonusdmg" value="@{vbonusdamage}"/>
              <input type="hidden" name="attr_weaponsbonusDie" value="{{bonus_die=[[@{weaponsbonusdmg}!]]}}"/>
              <!-- how to call a button roll: ^{reroll-damage}(~repeating_weapons_dmg)-->
              <input type="hidden" name="attr_dmgTemplate" value="@{whisperweapon} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{weapon} }} {{dmg_rank=@{weapondamage}}} {{dmg_roll=[[@{weapondmg} + @{damagemods}]]}} @{weaponsbonusDie} {{showap=[[1d0+@{weaponap}]]}} {{ap=@{weaponap}}} {{notes=@{weaponnotes}}} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_weapons_dmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_weapons_grittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
              <button type="roll" style="display: none;" name="roll_grittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"> </button>
            </div>
          </fieldset>
          <!--Armor-->
          <fieldset class="repeating_armor">
            <div class="armor">
              <label class="armorWorn">
                <input class="isWorn" type="checkbox" name="attr_armorWorn" value="1" checked="checked"/><span class="isWornIcon"> </span>
              </label>
              <label class="paArmorWorn">
                <div class="powerArmorWorn"></div>
              </label>
              <input class="armorType" type="text" name="attr_ArmorType" title="@{repeating_armor_$#_ArmorType}" data-i18n-placeholder="leather" placeholder="Leather"/>
              <select class="armorProtected" name="attr_AreaProtected"> 
                <option value="1" data-i18n="head"> Head</option>
                <option value="2" data-i18n="torso" selected="selected">Torso</option>
                <option value="3" data-i18n="torso-plus-arms">Torso+Arms</option>
                <option value="4" data-i18n="torso-plus-legs">Torso+Legs</option>
                <option value="5" data-i18n="torso-plus-arms-plus-legs">Torso+Arms+Legs</option>
                <option value="6" data-i18n="arms">Arms</option>
                <option value="7" data-i18n="legs">Legs</option>
                <option value="8" data-i18n="full-body">Full Body</option>
              </select>
              <input class="armorProtection" type="number" name="attr_ArmorTypeProtection" title="@{repeating_armor_$#_ArmorTypeProtection}" placeholder="1"/>
              <input class="armorWeight" style="width:50px;" type="number" step="any" name="attr_ArmorTypeWeight" title="@{repeating_armor_$#_ArmorTypeWeight}"/>
              <label class="armorCarried">
                <input class="armorisCarried" type="checkbox" name="attr_ArmorCarried" title="@{repeating_armor_$#_ArmorCarried}" checked="checked"/><span class="armorisCarriedIcon"> </span>
              </label>
              <input class="showarmorconfig" type="checkbox" name="attr_showarmorconfig" checked="checked"/>
              <label class="configCog">
                <input class="showarmorconfig" type="checkbox" name="attr_showarmorconfig" checked="checked"/><span>y</span>
              </label>
              <textarea class="armorDesc" name="attr_ArmorNotes" title="@{repeating_armor_$#_ArmorNotes}" placeholder="Description/Notes" data-i18n-placeholder="description-notes"></textarea>
              <div class="armorconfig">
                <!-- Stacking-->
                <h4 class="armorStacks armorConfigHeader" data-i18n="protection-stacks">Stacks</h4>
                <select class="armorStacks" style="margin-left: -5px;" name="attr_armorstack"> 
                  <option Value="0" data-i18n="no" selected="selected">No</option>
                  <option value=".5">50%</option>
                  <option value="1">100%</option>
                </select>
                <!-- Min Strength-->
                <h4 class="armorConfigHeader armorMinStr" data-i18n="minimum-strength-abbr">Min. Str.</h4>
                <input type="hidden" name="attr_minstrength" value="4"/>
                <select class="armorMinStr dtype" name="attr_armorminstrength" title="@{repeating_weapons_$#_minstrength}"> 
                  <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                  <option value="4" data-i18n="d4" selected="selected">d4</option>
                  <option value="6" data-i18n="d6">d6</option>
                  <option value="8" data-i18n="d8">d8</option>
                  <option value="10" data-i18n="d10">d10</option>
                  <option value="12" data-i18n="d12">d12</option>
                </select>
                <!--Embedded Toughness-->
                <h4 class="armorConfigHeader armorMinStr" data-i18n="embedded-toughness"></h4>
                <input type="number" name="attr_embeddedtoughness" value="0"/>
              </div><span class="statblock" name="attr_ArmorType"></span><span class="statblock openParens">(+</span><span class="statblock" name="attr_ArmorTypeProtection"></span><span class="statblock">)</span>
            </div>
          </fieldset>
          <fieldset class="repeating_shields"> 
            <label class="shieldWornContainer">
              <input class="shieldWorn isWorn" type="checkbox" name="attr_shieldWorn" value="1" checked="checked"/><span class="isWornIcon"> </span>
            </label>
            <input class="isWorn" type="hidden" name="attr_shieldWorn" value="1"/><span class="statblockIcon statblock">&#128737;</span>
            <input class="shieldType" type="text" name="attr_ShieldType" title="@{repeating_shields_$#_ShieldType}"/>
            <input class="shieldParry" type="number" name="attr_ShieldParry" title="@{repeating_shields_$#_ShieldParry}"/>
            <input class="shieldCover" type="number" name="attr_ShieldCover" title="@{repeating_shields_$#_Cover}" placeholder="1"/>
            <input class="shieldWeight" type="number" step="any" name="attr_ShieldTypeWeight" title="@{repeating_shields_$#_ShieldTypeWeight}"/>
            <input class="showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/>
            <label class="configCog"> 
              <input class="showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/><span>y</span>
            </label>
            <input class="hiddenInput showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/>
            <textarea class="shieldDesc" name="attr_ShieldNotes" title="@{repeating_shields_$#_ShieldNotes}" placeholder="Description/Notes" data-i18n-placeholder="description-notes"> </textarea>
            <div class="shieldconfig">
              <h4 class="armorConfigHeader armorMinStr" data-i18n="minimum-strength-abbr">Min. Str.</h4>
              <input type="hidden" name="attr_shieldminstrength" value="4"/>
              <select class="shieldMinStr dtype" name="attr_shieldminstrength" title="@{repeating_shields_$#_shieldminstrength}"> 
                <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                <option value="4" data-i18n="d4" selected="selected">d4</option>
                <option value="6" data-i18n="d6">d6</option>
                <option value="8" data-i18n="d8">d8</option>
                <option value="10" data-i18n="d10">d10</option>
                <option value="12" data-i18n="d12">d12</option>
              </select>
            </div><span class="statblock" name="attr_ShieldType"></span>
          </fieldset>
          <!--Gear-->
          <fieldset class="repeating_gear">
            <div class="base gearRow gearList"><span class="statblock gearItem" name="attr_item"></span>
              <input class="itemqty" type="hidden" value="1" name="attr_itemqty"/><span class="statblock openParens showQuantity">&nbsp;(</span><span class="statblock gearItem showQuantity" name="attr_itemqty"></span><span class="statblock showQuantity">)</span>
              <input class="standard item" type="text" placeholder="Item" name="attr_item" title="@{repeating_gear_$#_item}"/>
              <input class="standard itemqty" type="number" value="1" data-i18n-title="quantity" name="attr_itemqty"/>
              <input class="itemweight" type="number" data-i18n-placeholder="weight" placeholder="weight" step="any" name="attr_itemWeight" title="@{repeating_gear_$#_itemWeight}"/>
              <div class="itemcarried">
                <label class="gearCarriedLabel">
                  <input class="gearitemCarried gearisCarried" type="checkbox" name="attr_itemcarried"/><span class="gearisCarriedIcon"></span>
                </label>
              </div>
              <input type="hidden" name="attr_totalItemWeight" value="0"/>
              <details> 
                <summary class="config">y</summary>
                <textarea name="attr_geardescription" title="@{repeating_gear_$#_itemdescription}" placeholder="Details" data-i18n-placeholder="details"></textarea>
              </details>
            </div>
          </fieldset>
          <input class="usewealth hiddenInput" type="checkbox" name="attr_usewealth"/>
          <input class="useMultiCurrency" type="hidden" name="attr_moneyfields" value="1"/>
          <div class="basederived multiMoney moneyLabels">
            <div class="derivelabel money">&nbsp;</div>
            <div class="derivebase"><span name="attr_moneyonename"></span></div>
            <div class="derivemod"> <span name="attr_moneytwoname"> </span></div>
            <div class="derivecurrent money3"> <span name="attr_moneythreename"></span></div>
            <div class="derivemisc money4"> <span name="attr_moneyfourname"></span></div>
          </div>
          <div class="basederived nonwealth multiMoney">
            <!-- Label-->
            <div class="derivelabel money"><span name="attr_moneyname"></span></div>
            <!-- Money Fields-->
            <div class="derivebase"> <span class="statblock" name="attr_moneyonename"></span><span class="statblock">:&nbsp;</span>
              <input class="derivedStat moneyfield" type="number" step="any" name="attr_money" title="@{money}" value="0"/>
            </div>
            <div class="derivemod additionalCurrency money2"><span class="statblock" name="attr_moneytwoname"></span><span class="statblock">:&nbsp;</span>
              <input class="derivedStat" type="number" step="any" name="attr_money2" title="@{money2}" value="0"/>
            </div>
            <div class="derivecurrent additionalCurrency money3"><span class="statblock" name="attr_moneythreename"></span><span class="statblock">:&nbsp;</span>
              <input class="derivedStat" type="number" step="any" name="attr_money3" title="@{money3}" value="0"/>
            </div>
            <div class="derivemisc additionalCurrency money4"><span class="statblock" name="attr_moneyfourname"></span><span class="statblock">:&nbsp;</span>
              <input class="derivedStat" type="number" step="any" name="attr_money4" title="@{money4}" value="0"/>
            </div>
          </div>
          <div class="basederived usewealth">
            <!-- Label -->
            <div class="derivelabel wealth"> 
              <button class="traitbutton deriveflexbutton" type="roll" name="roll_WealthRoll" value="@{rollwealth}"><span data-i18n="wealth"></span><span class="nonstatblock">:</span><span class="statblock">&nbsp;(</span><span class="statblock" name="attr_wealth"></span><span class="statblock">)</span></button>
            </div>
            <!-- Wealth Field-->
            <select class="derivebaseplus" name="attr_wealth">
              <option value="d0" data-i18n="has-no-money">Broke</option>
              <option value="d4" data-i18n="d4">d4</option>
              <option value="d6" selected="selected" data-i18n="d6">d6</option>
              <option value="d8" data-i18n="d8">d8</option>
              <option value="d10" data-i18n="d10">d10</option>
              <option value="d12" data-i18n="d12">d12</option>
            </select>
            <input class="useWealthMod hiddenInput" type="checkbox" name="attr_useWealthMod" value="1"/>
            <div class="derivebaseplus wealthmod">+ 
              <input type="number" name="attr_wealthmod" value="0" style="text-align: center;"/>
            </div>
            <input type="hidden" name="attr_rollwealth" value="&amp;{template:roll} {{namelength=@{namelength}}} {{name=@{character_name} }} {{trait=^{wealth}}} {{skill_rank=@{wealth} }} {{skill_roll=[[1@{wealth}! + @{wealthmod} + @{traitmods}]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[ 1d@{wealthwilddie}! + @{wealthmod}[wealth mod] + @{traitmods}]]}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
          </div>
          <input class="useConsumeables" type="hidden" name="attr_useconsumables" value="0"/>
          <div class="showconsumables">
            <h1 class="groupHeaderGear" data-i18n="consumables">Consumables</h1>
            <fieldset class="repeating_consumables">
              <div class="basederived">
                <!-- Label-->
                <div class="derivelabel consumables">
                  <button class="traitbutton smallskillflexattbutton consumablesbutton" type="roll" name="roll_ConsumbalesRoll" value="@{rollconsumables}"> <span class="statblock" name="attr_consumable"></span><span class="statblock">&nbsp;(</span><span class="statblock" name="attr_consumablestock"></span><span class="statblock">)</span></button>
                  <input class="derivedlabelinput consumableInput" type="text" name="attr_consumable" placeholder="Consumable" data-i18n-placeholder="consumable"/>
                  <input type="hidden" name="attr_consumablesmod" value="0"/>
                </div>
                <!-- Consumable Field-->
                <select class="derivebaseplus" name="attr_consumablestock">
                  <option value="d0" data-i18n="empty">Empty</option>
                  <option value="d4">d4</option>
                  <option value="d6" selected="selected">d6</option>
                  <option value="d8">d8</option>
                  <option value="d10">d10</option>
                  <option value="d12">d12</option>
                </select>
                <input type="hidden" name="attr_rollconsumables" value="&amp;{template:consumables} {{name=@{character_name} }} {{consumable=@{consumable}}} {{roll=[[1@{consumablestock} + @{consumablesmod} + @{traitmods}]]}}"/>
              </div>
            </fieldset>
          </div>
        </div>
        <!--Edges-->
        <input class="edgeCount" type="hidden" name="attr_edgeCount" value="0"/>
        <div class="edgeBlock">
          <h3 class="groupHeading" data-i18n="edges">Edges </h3>&nbsp; &nbsp;
          <fieldset class="repeating_edges">
            <div class="base edge">
              <input class="whispercheck hiddenInput" type="checkbox" name="attr_whisperEdgeDeets" value="/w gm "/>
              <button class="edgeOutput" type="roll" name="roll_tEdge" value="@{whisperEdgeDeets} &amp;{template:info} {{name=@{character_name}}} {{type=^{edge}}} {{item=@{edge}}} {{description=@{edgedescription}}} {{theme=@{rolltemplate_theme}}}"> <span class="whispericon"></span><span class="statblock hindranceName" name="attr_edge"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
              <input class="edgefield" type="text" name="attr_edge" data-i18n-title="edge"/>
              <input class="moreConfig hiddenInput" type="checkbox" name="attr_showEdgeDesc" checked="checked"/>
              <label class="configCog">
                <input class="moreConfig hiddenInput" type="checkbox" name="attr_showEdgeDesc" checked="checked"/>y
              </label>
              <div class="edgeMods">
                <input type="checkbox" name="attr_whisperEdgeDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-edge">Whisper Edge Description</span><br/>
                <div class="edgeTypeLabel"><span data-i18n="edge-acquired-from">Edge Acquired From</span></div>
                <select class="edgeTypeDropdown" name="attr_tookat">
                  <option value="Racial" data-i18n="racial">Racial</option>
                  <option value="Creation" data-i18n="creation">Creation</option>
                  <option value="Advance" selected="selected" data-i18n="advance">Advance</option>
                  <option value="GM" data-i18n="gm-fiat-slash-other">GM Fiat/Other</option>
                </select>
                <textarea name="attr_edgedescription" title="@{repeating_edges_$#_edgedescription}" placeholder="Edge description/details" data-i18n-placeholder="edge-desc"></textarea>
              </div>
            </div>
          </fieldset>
        </div>
        <div class="logoBlock"> 
          <input class="showLogo" type="hidden" value="SavageWorlds" name="attr_logo"/><img class="logo PEG" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/PEG_LOGO_White.png"/><img class="logo Deadlands" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/Deadlands.png"/><img class="logo SWADE" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/SW_Logo_AE.png"/><img class="logo SWPF" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/PFforSW_logo9_square_smaller.png"/><img class="logo Rifts" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/Savage_Rifts_Logo.png"/><img class="logo Custom" name="attr_logoURL"/>
        </div>
      </div>
      <div class="character">
        <div class="top-half">
          <div class="triFold">
            <!--Left Column (Attributes and Skills)-->
            <div class="attributes fullBorder">
              <h2 class="traitHeader" data-i18n="attributes">Attributes</h2>
              <div class="basetrait">
                <input class="deltabutton" type="hidden" name="attr_agility_delta" value="0"/>
                <button class="traitbutton traitflexattbutton" type="roll" name="roll_tagilityRoll" value="@{agilitybutton} {{skill_roll=[[@{agilityRollFormula}]]}} {{wild_die=[[@{agilityWildDieFormula}]]}} @{unshakeTemplate}" title="@{tagilityRoll}"><span data-i18n="agility"></span>
                </button>
                <input type="hidden" name="attr_agilitybutton" value="@{whisperagility} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltagility} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/><span>
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <label class="traitlabel" data-i18n-title="agility-die-type-d4">
                    <input class="traitradio" type="radio" name="attr_agility" value="4" checked="checked"/><span class="d4"></span>
                    <div class="d4a" data-i18n="d4"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="agility-die-type-d6">
                    <input class="traitradio" type="radio" name="attr_agility" value="6"/><span class="d6"></span>
                    <div class="d6a" data-i18n="d6"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="agility-die-type-d8">
                    <input class="traitradio" type="radio" name="attr_agility" value="8"/><span class="d8"></span>
                    <div class="d8a" data-i18n="d8"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="agility-die-type-d10">
                    <input class="traitradio" type="radio" name="attr_agility" value="10"/><span class="d10"></span>
                    <div class="d10a" data-i18n="d10"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="agility-die-type-d12">
                    <input class="traitradio" type="radio" name="attr_agility" value="12"/><span class="d12"></span>
                    <div class="d12a" data-i18n="d12"></div>
                  </label>+</span>
                <input class="otraitmod" type="number" name="attr_agilitymod" title="@{agilitymod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_agModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_agrollMod" title="@{agrollMod}" value="0"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" name="attr_whisperagility" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_agwilddie" title="@{agwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" data-i18n="d6" selected="selected">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_agwilddieinfo" placeholder="No modifying edges" data-i18n-placeholder="no-modifying-edges"/>
                    <input class="deltamod" type="number" name="attr_agility_delta" value="0" title="@{agility_delta}"/>
                    <label class="delta" data-i18n="die-step-delta">Boost/Lower Trait</label>
                    <input type="hidden" name="attr_agility_base"/>
                    <input type="hidden" name="attr_agilitymod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_agility_rank" value="1d4!"/>
                <input type="hidden" name="attr_agility_display" value="d4"/>
                <input type="hidden" name="attr_rolltagility" value="{{name=@{character_name} }} {{trait=^{agility}}} {{skill_rank=@{agility_display} }} {{mook=[[1d0+@{wdNum}]]}} {{button=y}} {{ReRoll=^{reroll}(~tagilityRoll)}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <input type="hidden" name="attr_agilityRollFormula" value="@{agility_rank} + @{agrollMod} [@{agModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_agilitybutton" value="@{whisperagility} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltagility} @{setmodsenc} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <input type="hidden" name="attr_agilityRollFormula" value="@{agility_rank} + @{agrollMod} [@{agModType}] + @{ModSumEnc}[Wounds, Fatigue, Encumbrance, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_agilityWildDieFormula" value="1d@{agwilddie}! + @{agilitymod} + @{agrollMod} [@{agModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_agilityWildDieFormula" value="1d@{agwilddie}! + @{agilitymod} + @{agrollMod} [@{agModType}] + @{ModSumEnc}[Wounds, Fatigue, Encumbrance, Distracted] + @{traitmods}"/>
              </div>
              <div class="basetrait">
                <input class="deltabutton" type="hidden" name="attr_smarts_delta" value="0"/>
                <button class="traitbutton traitflexattbutton" type="roll" name="roll_tsmartsRoll" value="@{smartsbutton} {{skill_roll=[[@{smartsRollFormula}]]}} {{wild_die=[[@{smartsWildDieFormula}]]}} @{unshakeTemplate}" title="@{tsmartsRoll}"><span data-i18n="smarts"></span><span class="isAnimal" name="attr_animalsmarts_display"></span>
                </button>
                <input type="hidden" name="attr_smartsbutton" value="@{whispersmarts} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltsmarts} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/><span>
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <label class="traitlabel" data-i18n-title="smarts-die-type-d4">
                    <input class="traitradio" type="radio" name="attr_smarts" value="4" checked="checked"/><span class="d4"></span>
                    <div class="d4a" data-i18n="d4"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="smarts-die-type-d6">
                    <input class="traitradio" type="radio" name="attr_smarts" value="6"/><span class="d6"></span>
                    <div class="d6a" data-i18n="d6"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="smarts-die-type-d8">
                    <input class="traitradio" type="radio" name="attr_smarts" value="8"/><span class="d8"></span>
                    <div class="d8a" data-i18n="d8"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="smarts-die-type-d10">
                    <input class="traitradio" type="radio" name="attr_smarts" value="10"/><span class="d10"></span>
                    <div class="d10a" data-i18n="d10"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="smarts-die-type-d12">
                    <input class="traitradio" type="radio" name="attr_smarts" value="12"/><span class="d12"></span>
                    <div class="d12a" data-i18n="d12"></div>
                  </label>+</span>
                <input class="otraitmod" type="number" name="attr_smartsmod" title="@{smartsmod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_smModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_smrollMod" title="@{smrollMod}" value="0"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" name="attr_whispersmarts" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_smwilddie" title="@{smwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" data-i18n="d6" selected="selected">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_smwilddieinfo" placeholder="No modifying edges" data-i18n-placeholder="no-modifying-edges"/>
                    <input class="whispercheck" type="checkbox" name="attr_animalsmarts"/><span class="ModDesc" data-i18n="animal-intelligence">Animal Intelligence</span><br/>
                    <input type="hidden" name="attr_animalsmarts_display"/>
                    <input class="deltamod" type="number" name="attr_smarts_delta" value="0" title="@{smarts_delta}"/>
                    <label class="delta" data-i18n="die-step-delta">Boost/Lower Trait</label>
                    <input type="hidden" name="attr_smarts_base"/>
                    <input type="hidden" name="attr_smartsmod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_smarts_rank" value="1d4!"/>
                <input type="hidden" name="attr_smarts_display" value="d4"/>
                <input type="hidden" name="attr_rolltsmarts" value="{{name=@{character_name} }} {{trait=^{smarts}}} {{skill_rank=@{smarts_display} }} {{mook=[[1d0+@{wdNum}]]}} {{button=y}} {{ReRoll=^{reroll}(~tsmartsRoll)}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <input type="hidden" name="attr_smartsRollFormula" value="@{smarts_rank} + @{smrollMod} [@{smModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_smartsWildDieFormula" value="1d@{smwilddie}! + @{smartsmod} + @{smrollMod} [@{smModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
              </div>
              <div class="basetrait">
                <input class="deltabutton" type="hidden" name="attr_spirit_delta" value="0"/>
                <button class="traitbutton traitflexattbutton" type="roll" name="roll_tspiritRoll" value="@{spiritbutton} {{skill_roll=[[@{spiritRollFormula}]]}} {{wild_die=[[@{spiritWildDieFormula}]]}} @{unshakeTemplate}" title="@{tspiritRoll}"><span data-i18n="spirit"></span>
                </button>
                <input type="hidden" name="attr_spiritbutton" value="@{whisperspirit} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltspirit} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/><span>
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <label class="traitlabel" data-i18n-title="spirit-die-type-d4">
                    <input class="traitradio" type="radio" name="attr_spirit" value="4" checked="checked"/><span class="d4"></span>
                    <div class="d4a" data-i18n="d4"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="spirit-die-type-d6">
                    <input class="traitradio" type="radio" name="attr_spirit" value="6"/><span class="d6"></span>
                    <div class="d6a" data-i18n="d6"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="spirit-die-type-d8">
                    <input class="traitradio" type="radio" name="attr_spirit" value="8"/><span class="d8"></span>
                    <div class="d8a" data-i18n="d8"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="spirit-die-type-d10">
                    <input class="traitradio" type="radio" name="attr_spirit" value="10"/><span class="d10"></span>
                    <div class="d10a" data-i18n="d10"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="spirit-die-type-d12">
                    <input class="traitradio" type="radio" name="attr_spirit" value="12"/><span class="d12"></span>
                    <div class="d12a" data-i18n="d12"></div>
                  </label>+</span>
                <input class="otraitmod" type="number" name="attr_spiritmod" title="@{spiritmod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_spModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_sprollMod" title="@{sprollMod}" value="0"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" name="attr_whisperspirit" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_spwilddie" title="@{spwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" data-i18n="d6" selected="selected">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_spwilddieinfo" placeholder="No modifying edges" data-i18n-placeholder="no-modifying-edges"/>
                    <input class="deltamod" type="number" name="attr_spirit_delta" value="0" title="@{spirit_delta}"/>
                    <label class="delta" data-i18n="die-step-delta">Boost/Lower Trait</label>
                    <input type="hidden" name="attr_spirit_base"/>
                    <input type="hidden" name="attr_spiritmod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_spirit_rank" value="1d4!"/>
                <input type="hidden" name="attr_spirit_display" value="d4"/>
                <input type="hidden" name="attr_rolltspirit" value="{{name=@{character_name} }} {{trait=^{spirit}}} {{skill_rank=@{spirit_display} }} {{mook=[[1d0+@{wdNum}]]}} {{button=y}} {{ReRoll=^{reroll}(~tspiritRoll)}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <input type="hidden" name="attr_spiritRollFormula" value="@{spirit_rank} + @{sprollMod} [@{spModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_spiritWildDieFormula" value="1d@{spwilddie}! + @{spiritmod} + @{sprollMod} [@{spModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
              </div>
              <div class="basetrait">
                <input class="deltabutton" type="hidden" name="attr_strength_delta" value="0"/>
                <button class="traitbutton traitflexattbutton" type="roll" name="roll_tstrengthRoll" value="@{strengthbutton} {{skill_roll=[[@{strengthRollFormula}]]}} {{wild_die=[[@{strengthWildDieFormula}]]}} @{unshakeTemplate}" title="@{tstrengthRoll}"><span data-i18n="strength"></span>
                </button>
                <input type="hidden" name="attr_strengthbutton" value="@{whisperstrength} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltstrength} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/><span>
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <label class="traitlabel" data-i18n-title="strength-die-type-d4">
                    <input class="traitradio" type="radio" name="attr_strength" value="4" checked="checked"/><span class="d4"></span>
                    <div class="d4a" data-i18n="d4"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="strength-die-type-d6">
                    <input class="traitradio" type="radio" name="attr_strength" value="6"/><span class="d6"></span>
                    <div class="d6a" data-i18n="d6"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="strength-die-type-d8">
                    <input class="traitradio" type="radio" name="attr_strength" value="8"/><span class="d8"></span>
                    <div class="d8a" data-i18n="d8"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="strength-die-type-d10">
                    <input class="traitradio" type="radio" name="attr_strength" value="10"/><span class="d10"></span>
                    <div class="d10a" data-i18n="d10"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="strength-die-type-d12">
                    <input class="traitradio" type="radio" name="attr_strength" value="12"/><span class="d12"></span>
                    <div class="d12a" data-i18n="d12"></div>
                  </label>+</span>
                <input class="otraitmod" type="number" name="attr_strengthmod" title="@{strengthmod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_stModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_strollMod" title="@{strollMod}" value="0"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" name="attr_whisperstrength" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_stwilddie" title="@{stwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" data-i18n="d6" selected="selected">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_stwilddieinfo" placeholder="No modifying edges" data-i18n-placeholder="no-modifying-edges"/>
                    <input class="deltamod" type="number" name="attr_strength_delta" value="0" title="@{strength_delta}"/>
                    <label class="delta" data-i18n="die-step-delta">Boost/Lower Trait</label>
                    <input type="hidden" name="attr_strength_base"/>
                    <input type="hidden" name="attr_strengthmod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_strength_rank" value="1d4!"/>
                <input type="hidden" name="attr_strength_display" value="d4"/>
                <input type="hidden" name="attr_rolltstrength" value="{{name=@{character_name} }} {{trait=^{strength}}} {{skill_rank=@{strength_display} }} {{mook=[[1d0+@{wdNum}]]}} {{button=y}} {{ReRoll=^{reroll}(~tstrengthRoll)}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <input type="hidden" name="attr_strengthRollFormula" value="@{strength_rank} + @{strollMod} [@{stModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_strengthWildDieFormula" value="1d@{stwilddie}! + @{strengthmod} + @{strollMod} [@{stModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
              </div>
              <div class="basetrait">
                <input class="deltabutton" type="hidden" name="attr_vigor_delta" value="0"/>
                <button class="traitbutton traitflexattbutton" type="roll" name="roll_tvigorRoll" value="@{vigorbutton} {{skill_roll=[[@{vigorRollFormula}]]}} {{wild_die=[[@{vigorWildDieFormula}]]}} @{unshakeTemplate}" title="@{tvigorRoll}"><span data-i18n="vigor"></span>
                </button>
                <input type="hidden" name="attr_vigorbutton" value="@{whispervigor} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltvigor} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/><span>
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <label class="traitlabel" data-i18n-title="vigor-die-type-d4">
                    <input class="traitradio" type="radio" name="attr_vigor" value="4" checked="checked"/><span class="d4"></span>
                    <div class="d4a" data-i18n="d4"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="vigor-die-type-d6">
                    <input class="traitradio" type="radio" name="attr_vigor" value="6"/><span class="d6"></span>
                    <div class="d6a" data-i18n="d6"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="vigor-die-type-d8">
                    <input class="traitradio" type="radio" name="attr_vigor" value="8"/><span class="d8"></span>
                    <div class="d8a" data-i18n="d8"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="vigor-die-type-d10">
                    <input class="traitradio" type="radio" name="attr_vigor" value="10"/><span class="d10"></span>
                    <div class="d10a" data-i18n="d10"></div>
                  </label>
                  <label class="traitlabel" data-i18n-title="vigor-die-type-d12">
                    <input class="traitradio" type="radio" name="attr_vigor" value="12"/><span class="d12"></span>
                    <div class="d12a" data-i18n="d12"></div>
                  </label>+</span>
                <input class="otraitmod" type="number" name="attr_vigormod" title="@{vigormod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_viModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_virollMod" title="@{virollMod}" value="0"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" name="attr_whispervigor" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_viwilddie" title="@{viwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" data-i18n="d6" selected="selected">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_viwilddieinfo" placeholder="No modifying edges" data-i18n-placeholder="no-modifying-edges"/>
                    <input class="deltamod" type="number" name="attr_vigor_delta" value="0" title="@{vigor_delta}"/>
                    <label class="delta" data-i18n="die-step-delta">Boost/Lower Trait</label>
                    <input type="hidden" name="attr_vigor_base"/>
                    <input type="hidden" name="attr_vigormod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_vigor_rank" value="1d4!"/>
                <input type="hidden" name="attr_vigor_display" value="d4"/>
                <input type="hidden" name="attr_rolltvigor" value="{{name=@{character_name} }} {{trait=^{vigor}}} {{skill_rank=@{vigor_display} }} {{mook=[[1d0+@{wdNum}]]}} {{button=y}} {{ReRoll=^{reroll}(~tvigorRoll)}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <input type="hidden" name="attr_vigorRollFormula" value="@{vigor_rank} + @{virollMod} [@{viModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_vigorbutton" value="@{whispervigor} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltvigor} @{setmodsenc} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <input type="hidden" name="attr_vigorRollFormula" value="@{vigor_rank} + @{virollMod} [@{viModType}] + @{ModSumEnc}[Wounds, Fatigue, Encumbrance, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_vigorWildDieFormula" value="1d@{viwilddie}! + @{vigormod} + @{virollMod} [@{viModType}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}"/>
                <input type="hidden" name="attr_vigorWildDieFormula" value="1d@{viwilddie}! + @{vigormod} + @{virollMod} [@{viModType}] + @{ModSumEnc}[Wounds, Fatigue, Encumbrance, Distracted] + @{traitmods}"/>
              </div>
            </div>
            <div class="skills">
              <h2 class="traitHeader">Skills</h2>
              <!-- skill configuration-->
              <details>
                <summary class="skillConfigSummary"></summary>
                <div class="base isSkillConfig"><span class="skillItem">
                    <label class="SkillListLabel">
                      <input class="StaticSkill" type="checkbox" name="attr_altRuleSkillSpec"/><span> </span><span data-i18n="use-skill-specialization">Use Skill Specialization</span>
                    </label></span>
                  <hr/>
                  <div class="isSkillList" data-i18n-list="skill-select-list"><span class="skillItem" data-i18n-list-item="all-skills">
                      <label class="SkillListLabel">
                        <input class="StaticSkill" type="checkbox" name="attr_staticAll" value="1"/><span> </span><span class="boldMaroon" data-i18n="all">ALL</span>
                      </label></span><span class="skillItem" data-i18n-list-item="core-skills">
                      <label class="SkillListLabel">
                        <input class="StaticSkill" type="checkbox" name="attr_staticCore" value="1"/><span> </span><span class="boldMaroon" data-i18n="core-skills">Core Skills</span>
                      </label></span><span class="skillItem" data-i18n-list-item="academics">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticacademics" type="checkbox" name="attr_staticacademics"/><span> </span><span name="attr_academicsname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="athletics">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticathletics" type="checkbox" name="attr_staticathletics"/><span> </span><span name="attr_athleticsname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="battle">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticbattle" type="checkbox" name="attr_staticbattle"/><span> </span><span name="attr_battlename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="boating">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticboating" type="checkbox" name="attr_staticboating"/><span> </span><span name="attr_boatingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="commonknowledge">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticcommonknowledge" type="checkbox" name="attr_staticcommonknowledge"/><span> </span><span name="attr_commonknowledgename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="driving">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticdriving" type="checkbox" name="attr_staticdriving"/><span> </span><span name="attr_drivingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="electronics">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticelectronics" type="checkbox" name="attr_staticelectronics"/><span> </span><span name="attr_electronicsname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="faith">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticfaith" type="checkbox" name="attr_staticfaith"/><span> </span><span name="attr_faithname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="fighting">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticfighting" type="checkbox" name="attr_staticfighting"/><span> </span><span name="attr_fightingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="focus">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticfocus" type="checkbox" name="attr_staticfocus"/><span> </span><span name="attr_focusname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="gambling">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticgambling" type="checkbox" name="attr_staticgambling"/><span> </span><span name="attr_gamblingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="hacking">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill statichacking" type="checkbox" name="attr_statichacking"/><span> </span><span name="attr_hackingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="healing">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill statichealing" type="checkbox" name="attr_statichealing"/><span> </span><span name="attr_healingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="intimidation">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticintimidation" type="checkbox" name="attr_staticintimidation"/><span> </span><span name="attr_intimidationname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="language">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticlanguage" type="checkbox" name="attr_staticlanguage"/><span> </span><span name="attr_native-languagename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="notice">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticnotice" type="checkbox" name="attr_staticnotice"/><span> </span><span name="attr_noticename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="occult">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticoccult" type="checkbox" name="attr_staticoccult"/><span> </span><span name="attr_occultname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="performance">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticperformance" type="checkbox" name="attr_staticperformance"/><span> </span><span name="attr_performancename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="persuasion">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticpersuasion" type="checkbox" name="attr_staticpersuasion"/><span> </span><span name="attr_persuasionname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="piloting">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticpiloting" type="checkbox" name="attr_staticpiloting"/><span> </span><span name="attr_pilotingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="psionics">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticpsionics" type="checkbox" name="attr_staticpsionics"/><span> </span><span name="attr_psionicsname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="repair">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticrepair" type="checkbox" name="attr_staticrepair"/><span> </span><span name="attr_repairname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="research">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticresearch" type="checkbox" name="attr_staticresearch"/><span> </span><span name="attr_researchname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="riding">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticriding" type="checkbox" name="attr_staticriding"/><span> </span><span name="attr_ridingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="science">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticscience" type="checkbox" name="attr_staticscience"/><span> </span><span name="attr_sciencename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="shooting">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticshooting" type="checkbox" name="attr_staticshooting"/><span> </span><span name="attr_shootingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="spellcasting">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticspellcasting" type="checkbox" name="attr_staticspellcasting"/><span> </span><span name="attr_spellcastingname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="stealth">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticstealth" type="checkbox" name="attr_staticstealth"/><span> </span><span name="attr_stealthname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="survival">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticsurvival" type="checkbox" name="attr_staticsurvival"/><span> </span><span name="attr_survivalname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="taunt">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill statictaunt" type="checkbox" name="attr_statictaunt"/><span> </span><span name="attr_tauntname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="thievery">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticthievery" type="checkbox" name="attr_staticthievery"/><span> </span><span name="attr_thieveryname"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="trade">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill statictrade" type="checkbox" name="attr_statictrade"/><span> </span><span name="attr_tradename"></span>
                      </label></span><span class="skillItem" data-i18n-list-item="weirdscience">
                      <label class="SkillListLabel">
                        <!-- input(type="checkbox", class="StaticSkill", name=`attr_static${skill}`)-->
                        <input class="StaticSkill staticweirdscience" type="checkbox" name="attr_staticweirdscience"/><span> </span><span name="attr_weirdsciencename"></span>
                      </label></span>
                    <!-- Knowledge/Other--><span class="skillItem" data-i18n-list-item="knowledge-other">
                      <label class="SkillListLabel">
                        <input class="StaticSkill" type="checkbox" name="attr_staticKnowledgeOther"/><span> </span><span data-i18n="knowledge-other">Knowledge/Other</span>
                      </label></span>
                  </div>
                </div>
              </details>
              <div class="selected-skills" data-i18n-list="character-skills">
                <!-- unskilled-->
                <div class="basetrait" data-i18n-list-item="unskilled">
                  <!-- button(type="roll", class="unskilledbutton traitflexattbutton", name="roll_tUnskilledRoll", title="@{tUnskilledRoll}", value="@{whisperunskilled} &{template:roll} {{namelength=@{namelength}}} @{rolltUnskilled} {{skill_roll=[[ @{unskilledSkillRollFormula} ]]}} {{wild_die=[[ @{unskilledWildDieFormula} ]]}} @{unskilledencumbrancebutton} @{showtraitmods} {{conviction=[[ [[@{conviction}]]d6! ]] }} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~tUnskilledRoll)}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}") -->
                  <button class="unskilledbutton traitflexattbutton" type="roll" name="roll_tUnskilledRoll" title="@{tUnskilledRoll}" value="@{unskilledRollValue} {{skill_roll=[[ @{unskilledSkillRollFormula} ]]}} {{wild_die=[[ @{unskilledWildDieFormula} ]]}}"> <span data-i18n="unskilled-d4-2">Unskilled (d4-2)</span></button><span class="unskilledOptions">
                    <label class="traitlabel" data-i18n-title="apply-encumbrance">
                      <input class="traitradio" type="checkbox" name="attr_unskilledencumbrance" title="@{unskilledencumbrance}" value="1"/><span class="joat">O</span>
                    </label></span>
                  <details> 
                    <summary class="config">y</summary>
                    <div class="basetrait traitmodplus">
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" name="attr_whisperunskilled" value="/w gm"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_unskilledwilddie" title="@{unskilledwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_unskilledwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_unskilledRollValue" value="@{whisperunskilled} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltUnskilled} @{unskilledencumbrancebutton} @{showtraitmods} {{conviction=[[ [[@{conviction}]]d6! ]] }} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~tUnskilledRoll)}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <input type="hidden" name="attr_unskilled_rank" value="1d4! -2"/>
                  <input type="hidden" name="attr_unskilled_display" value="1d4-2"/>
                  <input type="hidden" name="attr_unskilledSkillRollFormula" value="@{unskilled_rank} + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods} + [[@{UnskilledEncumbrance}*@{encumbrance}]][Encumbrance Penalty]"/>
                  <input type="hidden" name="attr_unskilledWildDieFormula" value="1d@{unskilledwilddie}! -2[Unskilled Penalty] + @{ModSum}[Modifiers] + @{traitmods} + [[@{UnskilledEncumbrance}*@{encumbrance}]][Encumbrance Penalty]"/>
                  <input type="hidden" name="attr_rolltUnskilled" value="{{name=@{character_name} }} {{trait=^{unskilled}}} {{skill_rank=@{unskilled_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions}"/>
                  <input type="hidden" name="attr_unskilledencumbrancebutton" value="@{setmods}"/>
                  <input type="hidden" name="attr_unskilledrollformula" value="@{unskilled_rank} + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods} + [[@{UnskilledEncumbrance}*@{encumbrance}]] [Encumbrance Penalty]"/>
                </div>
                <!-- Selected Skills-->
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_academics_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_academics_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticacademics"/>
                <div class="basetrait staticAcademics" data-i18n-list-item="academics">
                  <input class="deltabutton" type="hidden" name="attr_academics_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_academics_makeButton"/>
                  <input type="hidden" value="string" name="attr_academics_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tAcademicsRoll" value="@{academicsRollValue} {{skill_roll=[[ @{academicsSkillRollFormula} ]]}} {{wild_die=[[ @{academicsWildDieFormula} ]]}}" title="@{tAcademicsRoll}">&nbsp;<span name="attr_academicsname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_academics_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_academicsRollValue" value="@{whisperacademics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tAcademicsRoll)}} {{trait=@{academicsname}}} @{rolltAcademics} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="academics-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_academics" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="academics-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_academics" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="academics-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_academics" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="academics-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_academics" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="academics-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_academics" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_academics" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_academicsmod" title="@{academicsmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_academicsModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_AcademicsskillMod" title="@{Academicsskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedacademicsattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedacademicsattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperacademics"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_academicswilddie" title="@{academicswilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_academicswilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_academics_delta" title="@{academics_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_academics_base"/>
                      <input type="hidden" name="attr_academicsmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_academics_rank" value="1d4!"/>
                  <input type="hidden" name="attr_academics_display" value="d4"/>
                  <input type="hidden" name="attr_academicsSkillRollFormula" value="@{academics_rank} + @{AcademicsskillMod} [@{academicsModType}] + @{linkedacademicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_academicsWildDieFormula" value="1d@{academicswilddie}! + @{academicsmod} + @{AcademicsskillMod} [@{academicsModType}] + @{linkedacademicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltAcademics" value="{{name=@{character_name} }} {{skill_rank=@{academics_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_academicsspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tAcademicsSpecRoll" title="@{tAcademicsSpecRoll}" value="@{academicsSpecRollValue} {{skill_roll=[[ @{academicsSkillRollFormula} ]]}} {{wild_die=[[ @{academicsWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_academicsSpecRollValue" value="@{whisperacademics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_academicsspec_tAcademicsSpecRoll)}} {{trait=@{academicsSpecName} }} @{rolltAcademics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_academicsSpecName" title="@{repeating_academicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_academics_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="true" name="attr_athletics_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl,str" name="attr_athletics_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticathletics"/>
                <div class="basetrait staticAthletics" data-i18n-list-item="athletics">
                  <input class="deltabutton" type="hidden" name="attr_athletics_delta" value="0"/>
                  <input type="hidden" value="true" name="attr_athletics_makeButton"/>
                  <input type="hidden" value="string" name="attr_athletics_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tAthleticsRoll" value="@{athleticsRollValue} {{skill_roll=[[ @{athleticsSkillRollFormula} ]]}} {{wild_die=[[ @{athleticsWildDieFormula} ]]}}" title="@{tAthleticsRoll}">&nbsp;<span name="attr_athleticsname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" name="attr_linkedathleticsatt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_athletics_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_athleticsRollValue" value="@{whisperathletics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tAthleticsRoll)}} {{trait=@{athleticsname}}} @{rolltAthletics} @{linkedathleticsattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="athletics-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_athletics" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="athletics-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_athletics" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="athletics-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_athletics" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="athletics-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_athletics" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="athletics-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_athletics" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_athletics" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_athleticsmod" title="@{athleticsmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_athleticsModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_AthleticsskillMod" title="@{Athleticsskillmod}" value="0"/><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                      <select class="LinkedAttSelect" name="attr_linkedathleticsatt">
                        <option value="agl-u" data-i18n="agility">Agility</option>
                        <option value="str-u" data-i18n="strength">Strength</option>
                      </select>
                      <!-- The following IF/Else was at this indentation...-->
                      <input type="hidden" name="attr_linkedathleticsattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedathleticsattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperathletics"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_athleticswilddie" title="@{athleticswilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_athleticswilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_athletics_delta" title="@{athletics_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_athletics_base"/>
                      <input type="hidden" name="attr_athleticsmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_athletics_rank" value="1d4!"/>
                  <input type="hidden" name="attr_athletics_display" value="d4"/>
                  <input type="hidden" name="attr_athleticsSkillRollFormula" value="@{athletics_rank} + @{AthleticsskillMod} [@{athleticsModType}] + @{linkedathleticsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_athleticsWildDieFormula" value="1d@{athleticswilddie}! + @{athleticsmod} + @{AthleticsskillMod} [@{athleticsModType}] + @{linkedathleticsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltAthletics" value="{{name=@{character_name} }} {{skill_rank=@{athletics_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_athleticsspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tAthleticsSpecRoll" title="@{tAthleticsSpecRoll}" value="@{athleticsSpecRollValue} {{skill_roll=[[ @{athleticsSkillRollFormula} ]]}} {{wild_die=[[ @{athleticsWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_athleticsSpecRollValue" value="@{whisperathletics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_athleticsspec_tAthleticsSpecRoll)}} {{trait=@{athleticsSpecName} }} @{rolltAthletics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_athleticsSpecName" title="@{repeating_athleticsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_athletics_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_battle_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_battle_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticbattle"/>
                <div class="basetrait staticBattle" data-i18n-list-item="battle">
                  <input class="deltabutton" type="hidden" name="attr_battle_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_battle_makeButton"/>
                  <input type="hidden" value="string" name="attr_battle_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tBattleRoll" value="@{battleRollValue} {{skill_roll=[[ @{battleSkillRollFormula} ]]}} {{wild_die=[[ @{battleWildDieFormula} ]]}}" title="@{tBattleRoll}">&nbsp;<span name="attr_battlename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_battle_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_battleRollValue" value="@{whisperbattle} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tBattleRoll)}} {{trait=@{battlename}}} @{rolltBattle} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="battle-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_battle" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="battle-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_battle" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="battle-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_battle" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="battle-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_battle" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="battle-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_battle" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_battle" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_battlemod" title="@{battlemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_battleModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_BattleskillMod" title="@{Battleskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedbattleattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedbattleattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperbattle"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_battlewilddie" title="@{battlewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_battlewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_battle_delta" title="@{battle_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_battle_base"/>
                      <input type="hidden" name="attr_battlemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_battle_rank" value="1d4!"/>
                  <input type="hidden" name="attr_battle_display" value="d4"/>
                  <input type="hidden" name="attr_battleSkillRollFormula" value="@{battle_rank} + @{BattleskillMod} [@{battleModType}] + @{linkedbattleattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_battleWildDieFormula" value="1d@{battlewilddie}! + @{battlemod} + @{BattleskillMod} [@{battleModType}] + @{linkedbattleattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltBattle" value="{{name=@{character_name} }} {{skill_rank=@{battle_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_battlespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tBattleSpecRoll" title="@{tBattleSpecRoll}" value="@{battleSpecRollValue} {{skill_roll=[[ @{battleSkillRollFormula} ]]}} {{wild_die=[[ @{battleWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_battleSpecRollValue" value="@{whisperbattle} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_battlespec_tBattleSpecRoll)}} {{trait=@{battleSpecName} }} @{rolltBattle} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_battleSpecName" title="@{repeating_battleSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_battle_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_boating_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_boating_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticboating"/>
                <div class="basetrait staticBoating" data-i18n-list-item="boating">
                  <input class="deltabutton" type="hidden" name="attr_boating_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_boating_makeButton"/>
                  <input type="hidden" value="string" name="attr_boating_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tBoatingRoll" value="@{boatingRollValue} {{skill_roll=[[ @{boatingSkillRollFormula} ]]}} {{wild_die=[[ @{boatingWildDieFormula} ]]}}" title="@{tBoatingRoll}">&nbsp;<span name="attr_boatingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_boating_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_boatingRollValue" value="@{whisperboating} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tBoatingRoll)}} {{trait=@{boatingname}}} @{rolltBoating} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="boating-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_boating" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="boating-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_boating" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="boating-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_boating" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="boating-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_boating" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="boating-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_boating" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_boating" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_boatingmod" title="@{boatingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_boatingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_BoatingskillMod" title="@{Boatingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedboatingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedboatingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperboating"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_boatingwilddie" title="@{boatingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_boatingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_boating_delta" title="@{boating_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_boating_base"/>
                      <input type="hidden" name="attr_boatingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_boating_rank" value="1d4!"/>
                  <input type="hidden" name="attr_boating_display" value="d4"/>
                  <input type="hidden" name="attr_boatingSkillRollFormula" value="@{boating_rank} + @{BoatingskillMod} [@{boatingModType}] + @{linkedboatingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_boatingWildDieFormula" value="1d@{boatingwilddie}! + @{boatingmod} + @{BoatingskillMod} [@{boatingModType}] + @{linkedboatingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltBoating" value="{{name=@{character_name} }} {{skill_rank=@{boating_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_boatingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tBoatingSpecRoll" title="@{tBoatingSpecRoll}" value="@{boatingSpecRollValue} {{skill_roll=[[ @{boatingSkillRollFormula} ]]}} {{wild_die=[[ @{boatingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_boatingSpecRollValue" value="@{whisperboating} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_boatingspec_tBoatingSpecRoll)}} {{trait=@{boatingSpecName} }} @{rolltBoating} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_boatingSpecName" title="@{repeating_boatingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_boating_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_commonknowledge_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_commonknowledge_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticcommonknowledge"/>
                <div class="basetrait staticCommonknowledge" data-i18n-list-item="commonknowledge">
                  <input class="deltabutton" type="hidden" name="attr_commonknowledge_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_commonknowledge_makeButton"/>
                  <input type="hidden" value="string" name="attr_commonknowledge_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tCommonknowledgeRoll" value="@{commonknowledgeRollValue} {{skill_roll=[[ @{commonknowledgeSkillRollFormula} ]]}} {{wild_die=[[ @{commonknowledgeWildDieFormula} ]]}}" title="@{tCommonknowledgeRoll}">&nbsp;<span name="attr_commonknowledgename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_commonknowledge_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_commonknowledgeRollValue" value="@{whispercommonknowledge} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tCommonknowledgeRoll)}} {{trait=@{commonknowledgename}}} @{rolltCommonknowledge} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="commonknowledge-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_commonknowledge" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="commonknowledge-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_commonknowledge" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="commonknowledge-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_commonknowledge" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="commonknowledge-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_commonknowledge" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="commonknowledge-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_commonknowledge" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_commonknowledge" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_commonknowledgemod" title="@{commonknowledgemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_commonknowledgeModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_CommonknowledgeskillMod" title="@{Commonknowledgeskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedcommonknowledgeattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedcommonknowledgeattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispercommonknowledge"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_commonknowledgewilddie" title="@{commonknowledgewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_commonknowledgewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_commonknowledge_delta" title="@{commonknowledge_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_commonknowledge_base"/>
                      <input type="hidden" name="attr_commonknowledgemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_commonknowledge_rank" value="1d4!"/>
                  <input type="hidden" name="attr_commonknowledge_display" value="d4"/>
                  <input type="hidden" name="attr_commonknowledgeSkillRollFormula" value="@{commonknowledge_rank} + @{CommonknowledgeskillMod} [@{commonknowledgeModType}] + @{linkedcommonknowledgeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_commonknowledgeWildDieFormula" value="1d@{commonknowledgewilddie}! + @{commonknowledgemod} + @{CommonknowledgeskillMod} [@{commonknowledgeModType}] + @{linkedcommonknowledgeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltCommonknowledge" value="{{name=@{character_name} }} {{skill_rank=@{commonknowledge_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_commonknowledgespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tCommonknowledgeSpecRoll" title="@{tCommonknowledgeSpecRoll}" value="@{commonknowledgeSpecRollValue} {{skill_roll=[[ @{commonknowledgeSkillRollFormula} ]]}} {{wild_die=[[ @{commonknowledgeWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_commonknowledgeSpecRollValue" value="@{whispercommonknowledge} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_commonknowledgespec_tCommonknowledgeSpecRoll)}} {{trait=@{commonknowledgeSpecName} }} @{rolltCommonknowledge} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_commonknowledgeSpecName" title="@{repeating_commonknowledgeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_commonknowledge_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_driving_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_driving_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticdriving"/>
                <div class="basetrait staticDriving" data-i18n-list-item="driving">
                  <input class="deltabutton" type="hidden" name="attr_driving_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_driving_makeButton"/>
                  <input type="hidden" value="string" name="attr_driving_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tDrivingRoll" value="@{drivingRollValue} {{skill_roll=[[ @{drivingSkillRollFormula} ]]}} {{wild_die=[[ @{drivingWildDieFormula} ]]}}" title="@{tDrivingRoll}">&nbsp;<span name="attr_drivingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_driving_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_drivingRollValue" value="@{whisperdriving} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tDrivingRoll)}} {{trait=@{drivingname}}} @{rolltDriving} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="driving-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_driving" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="driving-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_driving" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="driving-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_driving" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="driving-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_driving" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="driving-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_driving" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_driving" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_drivingmod" title="@{drivingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_drivingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_DrivingskillMod" title="@{Drivingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkeddrivingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkeddrivingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperdriving"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_drivingwilddie" title="@{drivingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_drivingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_driving_delta" title="@{driving_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_driving_base"/>
                      <input type="hidden" name="attr_drivingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_driving_rank" value="1d4!"/>
                  <input type="hidden" name="attr_driving_display" value="d4"/>
                  <input type="hidden" name="attr_drivingSkillRollFormula" value="@{driving_rank} + @{DrivingskillMod} [@{drivingModType}] + @{linkeddrivingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_drivingWildDieFormula" value="1d@{drivingwilddie}! + @{drivingmod} + @{DrivingskillMod} [@{drivingModType}] + @{linkeddrivingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltDriving" value="{{name=@{character_name} }} {{skill_rank=@{driving_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_drivingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tDrivingSpecRoll" title="@{tDrivingSpecRoll}" value="@{drivingSpecRollValue} {{skill_roll=[[ @{drivingSkillRollFormula} ]]}} {{wild_die=[[ @{drivingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_drivingSpecRollValue" value="@{whisperdriving} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_drivingspec_tDrivingSpecRoll)}} {{trait=@{drivingSpecName} }} @{rolltDriving} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_drivingSpecName" title="@{repeating_drivingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_driving_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_electronics_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_electronics_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticelectronics"/>
                <div class="basetrait staticElectronics" data-i18n-list-item="electronics">
                  <input class="deltabutton" type="hidden" name="attr_electronics_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_electronics_makeButton"/>
                  <input type="hidden" value="string" name="attr_electronics_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tElectronicsRoll" value="@{electronicsRollValue} {{skill_roll=[[ @{electronicsSkillRollFormula} ]]}} {{wild_die=[[ @{electronicsWildDieFormula} ]]}}" title="@{tElectronicsRoll}">&nbsp;<span name="attr_electronicsname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_electronics_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_electronicsRollValue" value="@{whisperelectronics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tElectronicsRoll)}} {{trait=@{electronicsname}}} @{rolltElectronics} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="electronics-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_electronics" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="electronics-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_electronics" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="electronics-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_electronics" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="electronics-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_electronics" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="electronics-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_electronics" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_electronics" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_electronicsmod" title="@{electronicsmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_electronicsModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_ElectronicsskillMod" title="@{Electronicsskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedelectronicsattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedelectronicsattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperelectronics"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_electronicswilddie" title="@{electronicswilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_electronicswilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_electronics_delta" title="@{electronics_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_electronics_base"/>
                      <input type="hidden" name="attr_electronicsmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_electronics_rank" value="1d4!"/>
                  <input type="hidden" name="attr_electronics_display" value="d4"/>
                  <input type="hidden" name="attr_electronicsSkillRollFormula" value="@{electronics_rank} + @{ElectronicsskillMod} [@{electronicsModType}] + @{linkedelectronicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_electronicsWildDieFormula" value="1d@{electronicswilddie}! + @{electronicsmod} + @{ElectronicsskillMod} [@{electronicsModType}] + @{linkedelectronicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltElectronics" value="{{name=@{character_name} }} {{skill_rank=@{electronics_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_electronicsspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tElectronicsSpecRoll" title="@{tElectronicsSpecRoll}" value="@{electronicsSpecRollValue} {{skill_roll=[[ @{electronicsSkillRollFormula} ]]}} {{wild_die=[[ @{electronicsWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_electronicsSpecRollValue" value="@{whisperelectronics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_electronicsspec_tElectronicsSpecRoll)}} {{trait=@{electronicsSpecName} }} @{rolltElectronics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_electronicsSpecName" title="@{repeating_electronicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_electronics_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_faith_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="spi" name="attr_faith_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticfaith"/>
                <div class="basetrait staticFaith" data-i18n-list-item="faith">
                  <input class="deltabutton" type="hidden" name="attr_faith_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_faith_makeButton"/>
                  <input type="hidden" value="string" name="attr_faith_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tFaithRoll" value="@{faithRollValue} {{skill_roll=[[ @{faithSkillRollFormula} ]]}} {{wild_die=[[ @{faithWildDieFormula} ]]}}" title="@{tFaithRoll}">&nbsp;<span name="attr_faithname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="spi-u"></span><span class="statblock">(<span name="attr_faith_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_faithRollValue" value="@{whisperfaith} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tFaithRoll)}} {{trait=@{faithname}}} @{rolltFaith} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="faith-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_faith" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="faith-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_faith" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="faith-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_faith" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="faith-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_faith" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="faith-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_faith" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_faith" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_faithmod" title="@{faithmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_faithModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_FaithskillMod" title="@{Faithskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedfaithattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedfaithattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperfaith"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_faithwilddie" title="@{faithwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_faithwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_faith_delta" title="@{faith_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_faith_base"/>
                      <input type="hidden" name="attr_faithmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_faith_rank" value="1d4!"/>
                  <input type="hidden" name="attr_faith_display" value="d4"/>
                  <input type="hidden" name="attr_faithSkillRollFormula" value="@{faith_rank} + @{FaithskillMod} [@{faithModType}] + @{linkedfaithattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_faithWildDieFormula" value="1d@{faithwilddie}! + @{faithmod} + @{FaithskillMod} [@{faithModType}] + @{linkedfaithattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltFaith" value="{{name=@{character_name} }} {{skill_rank=@{faith_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_faithspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tFaithSpecRoll" title="@{tFaithSpecRoll}" value="@{faithSpecRollValue} {{skill_roll=[[ @{faithSkillRollFormula} ]]}} {{wild_die=[[ @{faithWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_faithSpecRollValue" value="@{whisperfaith} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_faithspec_tFaithSpecRoll)}} {{trait=@{faithSpecName} }} @{rolltFaith} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_faithSpecName" title="@{repeating_faithSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_faith_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_fighting_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_fighting_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticfighting"/>
                <div class="basetrait staticFighting" data-i18n-list-item="fighting">
                  <input class="deltabutton" type="hidden" name="attr_fighting_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_fighting_makeButton"/>
                  <input type="hidden" value="string" name="attr_fighting_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tFightingRoll" value="@{fightingRollValue} {{skill_roll=[[ @{fightingSkillRollFormula} ]]}} {{wild_die=[[ @{fightingWildDieFormula} ]]}}" title="@{tFightingRoll}">&nbsp;<span name="attr_fightingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_fighting_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_fightingRollValue" value="@{whisperfighting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tFightingRoll)}} {{trait=@{fightingname}}} @{rolltFighting} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="fighting-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_fighting" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="fighting-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_fighting" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="fighting-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_fighting" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="fighting-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_fighting" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="fighting-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_fighting" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_fighting" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_fightingmod" title="@{fightingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_fightingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_FightingskillMod" title="@{Fightingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedfightingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedfightingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperfighting"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_fightingwilddie" title="@{fightingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_fightingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_fighting_delta" title="@{fighting_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_fighting_base"/>
                      <input type="hidden" name="attr_fightingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_fighting_rank" value="1d4!"/>
                  <input type="hidden" name="attr_fighting_display" value="d4"/>
                  <input type="hidden" name="attr_fightingSkillRollFormula" value="@{fighting_rank} + @{FightingskillMod} [@{fightingModType}] + @{linkedfightingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_fightingWildDieFormula" value="1d@{fightingwilddie}! + @{fightingmod} + @{FightingskillMod} [@{fightingModType}] + @{linkedfightingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltFighting" value="{{name=@{character_name} }} {{skill_rank=@{fighting_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_fightingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tFightingSpecRoll" title="@{tFightingSpecRoll}" value="@{fightingSpecRollValue} {{skill_roll=[[ @{fightingSkillRollFormula} ]]}} {{wild_die=[[ @{fightingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_fightingSpecRollValue" value="@{whisperfighting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_fightingspec_tFightingSpecRoll)}} {{trait=@{fightingSpecName} }} @{rolltFighting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_fightingSpecName" title="@{repeating_fightingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_fighting_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_focus_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="spi" name="attr_focus_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticfocus"/>
                <div class="basetrait staticFocus" data-i18n-list-item="focus">
                  <input class="deltabutton" type="hidden" name="attr_focus_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_focus_makeButton"/>
                  <input type="hidden" value="string" name="attr_focus_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tFocusRoll" value="@{focusRollValue} {{skill_roll=[[ @{focusSkillRollFormula} ]]}} {{wild_die=[[ @{focusWildDieFormula} ]]}}" title="@{tFocusRoll}">&nbsp;<span name="attr_focusname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="spi-u"></span><span class="statblock">(<span name="attr_focus_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_focusRollValue" value="@{whisperfocus} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tFocusRoll)}} {{trait=@{focusname}}} @{rolltFocus} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="focus-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_focus" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="focus-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_focus" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="focus-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_focus" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="focus-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_focus" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="focus-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_focus" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_focus" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_focusmod" title="@{focusmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_focusModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_FocusskillMod" title="@{Focusskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedfocusattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedfocusattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperfocus"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_focuswilddie" title="@{focuswilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_focuswilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_focus_delta" title="@{focus_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_focus_base"/>
                      <input type="hidden" name="attr_focusmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_focus_rank" value="1d4!"/>
                  <input type="hidden" name="attr_focus_display" value="d4"/>
                  <input type="hidden" name="attr_focusSkillRollFormula" value="@{focus_rank} + @{FocusskillMod} [@{focusModType}] + @{linkedfocusattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_focusWildDieFormula" value="1d@{focuswilddie}! + @{focusmod} + @{FocusskillMod} [@{focusModType}] + @{linkedfocusattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltFocus" value="{{name=@{character_name} }} {{skill_rank=@{focus_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_focusspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tFocusSpecRoll" title="@{tFocusSpecRoll}" value="@{focusSpecRollValue} {{skill_roll=[[ @{focusSkillRollFormula} ]]}} {{wild_die=[[ @{focusWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_focusSpecRollValue" value="@{whisperfocus} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_focusspec_tFocusSpecRoll)}} {{trait=@{focusSpecName} }} @{rolltFocus} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_focusSpecName" title="@{repeating_focusSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_focus_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_gambling_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_gambling_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticgambling"/>
                <div class="basetrait staticGambling" data-i18n-list-item="gambling">
                  <input class="deltabutton" type="hidden" name="attr_gambling_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_gambling_makeButton"/>
                  <input type="hidden" value="string" name="attr_gambling_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tGamblingRoll" value="@{gamblingRollValue} {{skill_roll=[[ @{gamblingSkillRollFormula} ]]}} {{wild_die=[[ @{gamblingWildDieFormula} ]]}}" title="@{tGamblingRoll}">&nbsp;<span name="attr_gamblingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_gambling_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_gamblingRollValue" value="@{whispergambling} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tGamblingRoll)}} {{trait=@{gamblingname}}} @{rolltGambling} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="gambling-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_gambling" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="gambling-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_gambling" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="gambling-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_gambling" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="gambling-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_gambling" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="gambling-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_gambling" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_gambling" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_gamblingmod" title="@{gamblingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_gamblingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_GamblingskillMod" title="@{Gamblingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedgamblingattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedgamblingattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispergambling"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_gamblingwilddie" title="@{gamblingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_gamblingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_gambling_delta" title="@{gambling_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_gambling_base"/>
                      <input type="hidden" name="attr_gamblingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_gambling_rank" value="1d4!"/>
                  <input type="hidden" name="attr_gambling_display" value="d4"/>
                  <input type="hidden" name="attr_gamblingSkillRollFormula" value="@{gambling_rank} + @{GamblingskillMod} [@{gamblingModType}] + @{linkedgamblingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_gamblingWildDieFormula" value="1d@{gamblingwilddie}! + @{gamblingmod} + @{GamblingskillMod} [@{gamblingModType}] + @{linkedgamblingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltGambling" value="{{name=@{character_name} }} {{skill_rank=@{gambling_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_gamblingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tGamblingSpecRoll" title="@{tGamblingSpecRoll}" value="@{gamblingSpecRollValue} {{skill_roll=[[ @{gamblingSkillRollFormula} ]]}} {{wild_die=[[ @{gamblingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_gamblingSpecRollValue" value="@{whispergambling} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_gamblingspec_tGamblingSpecRoll)}} {{trait=@{gamblingSpecName} }} @{rolltGambling} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_gamblingSpecName" title="@{repeating_gamblingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_gambling_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_hacking_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_hacking_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_statichacking"/>
                <div class="basetrait staticHacking" data-i18n-list-item="hacking">
                  <input class="deltabutton" type="hidden" name="attr_hacking_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_hacking_makeButton"/>
                  <input type="hidden" value="string" name="attr_hacking_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tHackingRoll" value="@{hackingRollValue} {{skill_roll=[[ @{hackingSkillRollFormula} ]]}} {{wild_die=[[ @{hackingWildDieFormula} ]]}}" title="@{tHackingRoll}">&nbsp;<span name="attr_hackingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_hacking_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_hackingRollValue" value="@{whisperhacking} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tHackingRoll)}} {{trait=@{hackingname}}} @{rolltHacking} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="hacking-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_hacking" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="hacking-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_hacking" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="hacking-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_hacking" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="hacking-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_hacking" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="hacking-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_hacking" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_hacking" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_hackingmod" title="@{hackingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_hackingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_HackingskillMod" title="@{Hackingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedhackingattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedhackingattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperhacking"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_hackingwilddie" title="@{hackingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_hackingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_hacking_delta" title="@{hacking_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_hacking_base"/>
                      <input type="hidden" name="attr_hackingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_hacking_rank" value="1d4!"/>
                  <input type="hidden" name="attr_hacking_display" value="d4"/>
                  <input type="hidden" name="attr_hackingSkillRollFormula" value="@{hacking_rank} + @{HackingskillMod} [@{hackingModType}] + @{linkedhackingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_hackingWildDieFormula" value="1d@{hackingwilddie}! + @{hackingmod} + @{HackingskillMod} [@{hackingModType}] + @{linkedhackingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltHacking" value="{{name=@{character_name} }} {{skill_rank=@{hacking_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_hackingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tHackingSpecRoll" title="@{tHackingSpecRoll}" value="@{hackingSpecRollValue} {{skill_roll=[[ @{hackingSkillRollFormula} ]]}} {{wild_die=[[ @{hackingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_hackingSpecRollValue" value="@{whisperhacking} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_hackingspec_tHackingSpecRoll)}} {{trait=@{hackingSpecName} }} @{rolltHacking} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_hackingSpecName" title="@{repeating_hackingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_hacking_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_healing_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_healing_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_statichealing"/>
                <div class="basetrait staticHealing" data-i18n-list-item="healing">
                  <input class="deltabutton" type="hidden" name="attr_healing_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_healing_makeButton"/>
                  <input type="hidden" value="string" name="attr_healing_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tHealingRoll" value="@{healingRollValue} {{skill_roll=[[ @{healingSkillRollFormula} ]]}} {{wild_die=[[ @{healingWildDieFormula} ]]}}" title="@{tHealingRoll}">&nbsp;<span name="attr_healingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_healing_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_healingRollValue" value="@{whisperhealing} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tHealingRoll)}} {{trait=@{healingname}}} @{rolltHealing} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="healing-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_healing" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="healing-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_healing" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="healing-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_healing" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="healing-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_healing" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="healing-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_healing" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_healing" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_healingmod" title="@{healingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_healingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_HealingskillMod" title="@{Healingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedhealingattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedhealingattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperhealing"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_healingwilddie" title="@{healingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_healingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_healing_delta" title="@{healing_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_healing_base"/>
                      <input type="hidden" name="attr_healingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_healing_rank" value="1d4!"/>
                  <input type="hidden" name="attr_healing_display" value="d4"/>
                  <input type="hidden" name="attr_healingSkillRollFormula" value="@{healing_rank} + @{HealingskillMod} [@{healingModType}] + @{linkedhealingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_healingWildDieFormula" value="1d@{healingwilddie}! + @{healingmod} + @{HealingskillMod} [@{healingModType}] + @{linkedhealingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltHealing" value="{{name=@{character_name} }} {{skill_rank=@{healing_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_healingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tHealingSpecRoll" title="@{tHealingSpecRoll}" value="@{healingSpecRollValue} {{skill_roll=[[ @{healingSkillRollFormula} ]]}} {{wild_die=[[ @{healingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_healingSpecRollValue" value="@{whisperhealing} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_healingspec_tHealingSpecRoll)}} {{trait=@{healingSpecName} }} @{rolltHealing} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_healingSpecName" title="@{repeating_healingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_healing_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_intimidation_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="spi" name="attr_intimidation_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticintimidation"/>
                <div class="basetrait staticIntimidation" data-i18n-list-item="intimidation">
                  <input class="deltabutton" type="hidden" name="attr_intimidation_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_intimidation_makeButton"/>
                  <input type="hidden" value="string" name="attr_intimidation_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tIntimidationRoll" value="@{intimidationRollValue} {{skill_roll=[[ @{intimidationSkillRollFormula} ]]}} {{wild_die=[[ @{intimidationWildDieFormula} ]]}}" title="@{tIntimidationRoll}">&nbsp;<span name="attr_intimidationname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="spi-u"></span><span class="statblock">(<span name="attr_intimidation_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_intimidationRollValue" value="@{whisperintimidation} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tIntimidationRoll)}} {{trait=@{intimidationname}}} @{rolltIntimidation} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="intimidation-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_intimidation" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="intimidation-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_intimidation" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="intimidation-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_intimidation" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="intimidation-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_intimidation" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="intimidation-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_intimidation" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_intimidation" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_intimidationmod" title="@{intimidationmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_intimidationModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_IntimidationskillMod" title="@{Intimidationskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedintimidationattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedintimidationattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperintimidation"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_intimidationwilddie" title="@{intimidationwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_intimidationwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_intimidation_delta" title="@{intimidation_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_intimidation_base"/>
                      <input type="hidden" name="attr_intimidationmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_intimidation_rank" value="1d4!"/>
                  <input type="hidden" name="attr_intimidation_display" value="d4"/>
                  <input type="hidden" name="attr_intimidationSkillRollFormula" value="@{intimidation_rank} + @{IntimidationskillMod} [@{intimidationModType}] + @{linkedintimidationattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_intimidationWildDieFormula" value="1d@{intimidationwilddie}! + @{intimidationmod} + @{IntimidationskillMod} [@{intimidationModType}] + @{linkedintimidationattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltIntimidation" value="{{name=@{character_name} }} {{skill_rank=@{intimidation_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_intimidationspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tIntimidationSpecRoll" title="@{tIntimidationSpecRoll}" value="@{intimidationSpecRollValue} {{skill_roll=[[ @{intimidationSkillRollFormula} ]]}} {{wild_die=[[ @{intimidationWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_intimidationSpecRollValue" value="@{whisperintimidation} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_intimidationspec_tIntimidationSpecRoll)}} {{trait=@{intimidationSpecName} }} @{rolltIntimidation} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_intimidationSpecName" title="@{repeating_intimidationSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_intimidation_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_language_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_language_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticlanguage"/>
                <div class="basetrait staticLanguage" data-i18n-list-item="language">
                  <input class="deltabutton" type="hidden" name="attr_language_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_language_makeButton"/>
                  <input type="hidden" value="string" name="attr_language_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tLanguageRoll" value="@{languageRollValue} {{skill_roll=[[ @{languageSkillRollFormula} ]]}} {{wild_die=[[ @{languageWildDieFormula} ]]}}" title="@{tLanguageRoll}">&nbsp;<span name="attr_native-languagename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_language_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_languageRollValue" value="@{whisperlanguage} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tLanguageRoll)}} {{trait=@{native-languagename}}} @{rolltLanguage} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="language-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_language" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="language-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_language" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="language-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_language" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="language-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_language" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="language-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_language" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_language" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_languagemod" title="@{languagemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_languageModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_LanguageskillMod" title="@{Languageskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedlanguageattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedlanguageattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperlanguage"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_languagewilddie" title="@{languagewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_languagewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_language_delta" title="@{language_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_language_base"/>
                      <input type="hidden" name="attr_languagemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_language_rank" value="1d4!"/>
                  <input type="hidden" name="attr_language_display" value="d4"/>
                  <input type="hidden" name="attr_languageSkillRollFormula" value="@{language_rank} + @{LanguageskillMod} [@{languageModType}] + @{linkedlanguageattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_languageWildDieFormula" value="1d@{languagewilddie}! + @{languagemod} + @{LanguageskillMod} [@{languageModType}] + @{linkedlanguageattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltLanguage" value="{{name=@{character_name} }} {{skill_rank=@{language_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_languagespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tLanguageSpecRoll" title="@{tLanguageSpecRoll}" value="@{languageSpecRollValue} {{skill_roll=[[ @{languageSkillRollFormula} ]]}} {{wild_die=[[ @{languageWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_languageSpecRollValue" value="@{whisperlanguage} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_languagespec_tLanguageSpecRoll)}} {{trait=@{languageSpecName} }} @{rolltLanguage} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_languageSpecName" title="@{repeating_languageSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_language_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_notice_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_notice_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticnotice"/>
                <div class="basetrait staticNotice" data-i18n-list-item="notice">
                  <input class="deltabutton" type="hidden" name="attr_notice_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_notice_makeButton"/>
                  <input type="hidden" value="string" name="attr_notice_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tNoticeRoll" value="@{noticeRollValue} {{skill_roll=[[ @{noticeSkillRollFormula} ]]}} {{wild_die=[[ @{noticeWildDieFormula} ]]}}" title="@{tNoticeRoll}">&nbsp;<span name="attr_noticename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_notice_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_noticeRollValue" value="@{whispernotice} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tNoticeRoll)}} {{trait=@{noticename}}} @{rolltNotice} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="notice-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_notice" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="notice-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_notice" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="notice-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_notice" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="notice-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_notice" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="notice-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_notice" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_notice" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_noticemod" title="@{noticemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_noticeModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_NoticeskillMod" title="@{Noticeskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkednoticeattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkednoticeattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispernotice"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_noticewilddie" title="@{noticewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_noticewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_notice_delta" title="@{notice_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_notice_base"/>
                      <input type="hidden" name="attr_noticemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_notice_rank" value="1d4!"/>
                  <input type="hidden" name="attr_notice_display" value="d4"/>
                  <input type="hidden" name="attr_noticeSkillRollFormula" value="@{notice_rank} + @{NoticeskillMod} [@{noticeModType}] + @{linkednoticeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_noticeWildDieFormula" value="1d@{noticewilddie}! + @{noticemod} + @{NoticeskillMod} [@{noticeModType}] + @{linkednoticeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltNotice" value="{{name=@{character_name} }} {{skill_rank=@{notice_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_noticespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tNoticeSpecRoll" title="@{tNoticeSpecRoll}" value="@{noticeSpecRollValue} {{skill_roll=[[ @{noticeSkillRollFormula} ]]}} {{wild_die=[[ @{noticeWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_noticeSpecRollValue" value="@{whispernotice} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_noticespec_tNoticeSpecRoll)}} {{trait=@{noticeSpecName} }} @{rolltNotice} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_noticeSpecName" title="@{repeating_noticeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_notice_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_occult_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_occult_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticoccult"/>
                <div class="basetrait staticOccult" data-i18n-list-item="occult">
                  <input class="deltabutton" type="hidden" name="attr_occult_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_occult_makeButton"/>
                  <input type="hidden" value="string" name="attr_occult_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tOccultRoll" value="@{occultRollValue} {{skill_roll=[[ @{occultSkillRollFormula} ]]}} {{wild_die=[[ @{occultWildDieFormula} ]]}}" title="@{tOccultRoll}">&nbsp;<span name="attr_occultname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_occult_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_occultRollValue" value="@{whisperoccult} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tOccultRoll)}} {{trait=@{occultname}}} @{rolltOccult} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="occult-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_occult" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="occult-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_occult" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="occult-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_occult" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="occult-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_occult" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="occult-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_occult" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_occult" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_occultmod" title="@{occultmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_occultModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_OccultskillMod" title="@{Occultskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedoccultattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedoccultattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperoccult"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_occultwilddie" title="@{occultwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_occultwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_occult_delta" title="@{occult_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_occult_base"/>
                      <input type="hidden" name="attr_occultmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_occult_rank" value="1d4!"/>
                  <input type="hidden" name="attr_occult_display" value="d4"/>
                  <input type="hidden" name="attr_occultSkillRollFormula" value="@{occult_rank} + @{OccultskillMod} [@{occultModType}] + @{linkedoccultattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_occultWildDieFormula" value="1d@{occultwilddie}! + @{occultmod} + @{OccultskillMod} [@{occultModType}] + @{linkedoccultattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltOccult" value="{{name=@{character_name} }} {{skill_rank=@{occult_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_occultspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tOccultSpecRoll" title="@{tOccultSpecRoll}" value="@{occultSpecRollValue} {{skill_roll=[[ @{occultSkillRollFormula} ]]}} {{wild_die=[[ @{occultWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_occultSpecRollValue" value="@{whisperoccult} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_occultspec_tOccultSpecRoll)}} {{trait=@{occultSpecName} }} @{rolltOccult} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_occultSpecName" title="@{repeating_occultSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_occult_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_performance_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="spi" name="attr_performance_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticperformance"/>
                <div class="basetrait staticPerformance" data-i18n-list-item="performance">
                  <input class="deltabutton" type="hidden" name="attr_performance_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_performance_makeButton"/>
                  <input type="hidden" value="string" name="attr_performance_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tPerformanceRoll" value="@{performanceRollValue} {{skill_roll=[[ @{performanceSkillRollFormula} ]]}} {{wild_die=[[ @{performanceWildDieFormula} ]]}}" title="@{tPerformanceRoll}">&nbsp;<span name="attr_performancename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="spi-u"></span><span class="statblock">(<span name="attr_performance_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_performanceRollValue" value="@{whisperperformance} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tPerformanceRoll)}} {{trait=@{performancename}}} @{rolltPerformance} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="performance-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_performance" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="performance-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_performance" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="performance-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_performance" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="performance-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_performance" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="performance-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_performance" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_performance" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_performancemod" title="@{performancemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_performanceModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_PerformanceskillMod" title="@{Performanceskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedperformanceattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedperformanceattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperperformance"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_performancewilddie" title="@{performancewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_performancewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_performance_delta" title="@{performance_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_performance_base"/>
                      <input type="hidden" name="attr_performancemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_performance_rank" value="1d4!"/>
                  <input type="hidden" name="attr_performance_display" value="d4"/>
                  <input type="hidden" name="attr_performanceSkillRollFormula" value="@{performance_rank} + @{PerformanceskillMod} [@{performanceModType}] + @{linkedperformanceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_performanceWildDieFormula" value="1d@{performancewilddie}! + @{performancemod} + @{PerformanceskillMod} [@{performanceModType}] + @{linkedperformanceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltPerformance" value="{{name=@{character_name} }} {{skill_rank=@{performance_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_performancespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tPerformanceSpecRoll" title="@{tPerformanceSpecRoll}" value="@{performanceSpecRollValue} {{skill_roll=[[ @{performanceSkillRollFormula} ]]}} {{wild_die=[[ @{performanceWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_performanceSpecRollValue" value="@{whisperperformance} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_performancespec_tPerformanceSpecRoll)}} {{trait=@{performanceSpecName} }} @{rolltPerformance} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_performanceSpecName" title="@{repeating_performanceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_performance_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_persuasion_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="spi" name="attr_persuasion_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticpersuasion"/>
                <div class="basetrait staticPersuasion" data-i18n-list-item="persuasion">
                  <input class="deltabutton" type="hidden" name="attr_persuasion_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_persuasion_makeButton"/>
                  <input type="hidden" value="string" name="attr_persuasion_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tPersuasionRoll" value="@{persuasionRollValue} {{skill_roll=[[ @{persuasionSkillRollFormula} ]]}} {{wild_die=[[ @{persuasionWildDieFormula} ]]}}" title="@{tPersuasionRoll}">&nbsp;<span name="attr_persuasionname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="spi-u"></span><span class="statblock">(<span name="attr_persuasion_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_persuasionRollValue" value="@{whisperpersuasion} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tPersuasionRoll)}} {{trait=@{persuasionname}}} @{rolltPersuasion} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="persuasion-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_persuasion" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="persuasion-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_persuasion" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="persuasion-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_persuasion" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="persuasion-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_persuasion" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="persuasion-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_persuasion" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_persuasion" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_persuasionmod" title="@{persuasionmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_persuasionModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_PersuasionskillMod" title="@{Persuasionskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedpersuasionattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedpersuasionattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperpersuasion"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_persuasionwilddie" title="@{persuasionwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_persuasionwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_persuasion_delta" title="@{persuasion_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_persuasion_base"/>
                      <input type="hidden" name="attr_persuasionmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_persuasion_rank" value="1d4!"/>
                  <input type="hidden" name="attr_persuasion_display" value="d4"/>
                  <input type="hidden" name="attr_persuasionSkillRollFormula" value="@{persuasion_rank} + @{PersuasionskillMod} [@{persuasionModType}] + @{linkedpersuasionattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_persuasionWildDieFormula" value="1d@{persuasionwilddie}! + @{persuasionmod} + @{PersuasionskillMod} [@{persuasionModType}] + @{linkedpersuasionattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltPersuasion" value="{{name=@{character_name} }} {{skill_rank=@{persuasion_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_persuasionspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tPersuasionSpecRoll" title="@{tPersuasionSpecRoll}" value="@{persuasionSpecRollValue} {{skill_roll=[[ @{persuasionSkillRollFormula} ]]}} {{wild_die=[[ @{persuasionWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_persuasionSpecRollValue" value="@{whisperpersuasion} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_persuasionspec_tPersuasionSpecRoll)}} {{trait=@{persuasionSpecName} }} @{rolltPersuasion} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_persuasionSpecName" title="@{repeating_persuasionSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_persuasion_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_piloting_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_piloting_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticpiloting"/>
                <div class="basetrait staticPiloting" data-i18n-list-item="piloting">
                  <input class="deltabutton" type="hidden" name="attr_piloting_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_piloting_makeButton"/>
                  <input type="hidden" value="string" name="attr_piloting_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tPilotingRoll" value="@{pilotingRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} ]]}} {{wild_die=[[ @{pilotingWildDieFormula} ]]}}" title="@{tPilotingRoll}">&nbsp;<span name="attr_pilotingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_piloting_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_pilotingRollValue" value="@{whisperpiloting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tPilotingRoll)}} {{trait=@{pilotingname}}} @{rolltPiloting} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="piloting-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_piloting" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="piloting-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_piloting" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="piloting-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_piloting" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="piloting-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_piloting" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="piloting-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_piloting" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_piloting" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_pilotingmod" title="@{pilotingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_pilotingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_PilotingskillMod" title="@{Pilotingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedpilotingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedpilotingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperpiloting"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_pilotingwilddie" title="@{pilotingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_pilotingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_piloting_delta" title="@{piloting_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_piloting_base"/>
                      <input type="hidden" name="attr_pilotingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_piloting_rank" value="1d4!"/>
                  <input type="hidden" name="attr_piloting_display" value="d4"/>
                  <input type="hidden" name="attr_pilotingSkillRollFormula" value="@{piloting_rank} + @{PilotingskillMod} [@{pilotingModType}] + @{linkedpilotingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_pilotingWildDieFormula" value="1d@{pilotingwilddie}! + @{pilotingmod} + @{PilotingskillMod} [@{pilotingModType}] + @{linkedpilotingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltPiloting" value="{{name=@{character_name} }} {{skill_rank=@{piloting_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_pilotingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tPilotingSpecRoll" title="@{tPilotingSpecRoll}" value="@{pilotingSpecRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} ]]}} {{wild_die=[[ @{pilotingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_pilotingSpecRollValue" value="@{whisperpiloting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_pilotingspec_tPilotingSpecRoll)}} {{trait=@{pilotingSpecName} }} @{rolltPiloting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_pilotingSpecName" title="@{repeating_pilotingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_piloting_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="true" name="attr_psionics_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma,spi" name="attr_psionics_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticpsionics"/>
                <div class="basetrait staticPsionics" data-i18n-list-item="psionics">
                  <input class="deltabutton" type="hidden" name="attr_psionics_delta" value="0"/>
                  <input type="hidden" value="true" name="attr_psionics_makeButton"/>
                  <input type="hidden" value="string" name="attr_psionics_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tPsionicsRoll" value="@{psionicsRollValue} {{skill_roll=[[ @{psionicsSkillRollFormula} ]]}} {{wild_die=[[ @{psionicsWildDieFormula} ]]}}" title="@{tPsionicsRoll}">&nbsp;<span name="attr_psionicsname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" name="attr_linkedpsionicsatt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_psionics_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_psionicsRollValue" value="@{whisperpsionics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tPsionicsRoll)}} {{trait=@{psionicsname}}} @{rolltPsionics} @{linkedpsionicsattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="psionics-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_psionics" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="psionics-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_psionics" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="psionics-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_psionics" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="psionics-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_psionics" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="psionics-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_psionics" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_psionics" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_psionicsmod" title="@{psionicsmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_psionicsModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_PsionicsskillMod" title="@{Psionicsskillmod}" value="0"/><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                      <select class="LinkedAttSelect" name="attr_linkedpsionicsatt">
                        <option value="sma-u" data-i18n="smarts">Smarts</option>
                        <option value="spi-u" data-i18n="spirit">Spirit</option>
                      </select>
                      <!-- The following IF/Else was at this indentation...-->
                      <input type="hidden" name="attr_linkedpsionicsattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedpsionicsattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperpsionics"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_psionicswilddie" title="@{psionicswilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_psionicswilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_psionics_delta" title="@{psionics_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_psionics_base"/>
                      <input type="hidden" name="attr_psionicsmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_psionics_rank" value="1d4!"/>
                  <input type="hidden" name="attr_psionics_display" value="d4"/>
                  <input type="hidden" name="attr_psionicsSkillRollFormula" value="@{psionics_rank} + @{PsionicsskillMod} [@{psionicsModType}] + @{linkedpsionicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_psionicsWildDieFormula" value="1d@{psionicswilddie}! + @{psionicsmod} + @{PsionicsskillMod} [@{psionicsModType}] + @{linkedpsionicsattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltPsionics" value="{{name=@{character_name} }} {{skill_rank=@{psionics_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_psionicsspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tPsionicsSpecRoll" title="@{tPsionicsSpecRoll}" value="@{psionicsSpecRollValue} {{skill_roll=[[ @{psionicsSkillRollFormula} ]]}} {{wild_die=[[ @{psionicsWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_psionicsSpecRollValue" value="@{whisperpsionics} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_psionicsspec_tPsionicsSpecRoll)}} {{trait=@{psionicsSpecName} }} @{rolltPsionics} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_psionicsSpecName" title="@{repeating_psionicsSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_psionics_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_repair_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_repair_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticrepair"/>
                <div class="basetrait staticRepair" data-i18n-list-item="repair">
                  <input class="deltabutton" type="hidden" name="attr_repair_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_repair_makeButton"/>
                  <input type="hidden" value="string" name="attr_repair_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tRepairRoll" value="@{repairRollValue} {{skill_roll=[[ @{repairSkillRollFormula} ]]}} {{wild_die=[[ @{repairWildDieFormula} ]]}}" title="@{tRepairRoll}">&nbsp;<span name="attr_repairname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_repair_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_repairRollValue" value="@{whisperrepair} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tRepairRoll)}} {{trait=@{repairname}}} @{rolltRepair} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="repair-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_repair" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="repair-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_repair" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="repair-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_repair" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="repair-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_repair" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="repair-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_repair" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_repair" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_repairmod" title="@{repairmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_repairModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_RepairskillMod" title="@{Repairskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedrepairattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedrepairattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperrepair"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_repairwilddie" title="@{repairwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_repairwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_repair_delta" title="@{repair_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_repair_base"/>
                      <input type="hidden" name="attr_repairmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_repair_rank" value="1d4!"/>
                  <input type="hidden" name="attr_repair_display" value="d4"/>
                  <input type="hidden" name="attr_repairSkillRollFormula" value="@{repair_rank} + @{RepairskillMod} [@{repairModType}] + @{linkedrepairattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_repairWildDieFormula" value="1d@{repairwilddie}! + @{repairmod} + @{RepairskillMod} [@{repairModType}] + @{linkedrepairattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltRepair" value="{{name=@{character_name} }} {{skill_rank=@{repair_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_repairspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tRepairSpecRoll" title="@{tRepairSpecRoll}" value="@{repairSpecRollValue} {{skill_roll=[[ @{repairSkillRollFormula} ]]}} {{wild_die=[[ @{repairWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_repairSpecRollValue" value="@{whisperrepair} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_repairspec_tRepairSpecRoll)}} {{trait=@{repairSpecName} }} @{rolltRepair} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_repairSpecName" title="@{repeating_repairSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_repair_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_research_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_research_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticresearch"/>
                <div class="basetrait staticResearch" data-i18n-list-item="research">
                  <input class="deltabutton" type="hidden" name="attr_research_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_research_makeButton"/>
                  <input type="hidden" value="string" name="attr_research_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tResearchRoll" value="@{researchRollValue} {{skill_roll=[[ @{researchSkillRollFormula} ]]}} {{wild_die=[[ @{researchWildDieFormula} ]]}}" title="@{tResearchRoll}">&nbsp;<span name="attr_researchname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_research_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_researchRollValue" value="@{whisperresearch} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tResearchRoll)}} {{trait=@{researchname}}} @{rolltResearch} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="research-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_research" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="research-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_research" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="research-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_research" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="research-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_research" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="research-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_research" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_research" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_researchmod" title="@{researchmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_researchModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_ResearchskillMod" title="@{Researchskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedresearchattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedresearchattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperresearch"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_researchwilddie" title="@{researchwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_researchwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_research_delta" title="@{research_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_research_base"/>
                      <input type="hidden" name="attr_researchmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_research_rank" value="1d4!"/>
                  <input type="hidden" name="attr_research_display" value="d4"/>
                  <input type="hidden" name="attr_researchSkillRollFormula" value="@{research_rank} + @{ResearchskillMod} [@{researchModType}] + @{linkedresearchattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_researchWildDieFormula" value="1d@{researchwilddie}! + @{researchmod} + @{ResearchskillMod} [@{researchModType}] + @{linkedresearchattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltResearch" value="{{name=@{character_name} }} {{skill_rank=@{research_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_researchspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tResearchSpecRoll" title="@{tResearchSpecRoll}" value="@{researchSpecRollValue} {{skill_roll=[[ @{researchSkillRollFormula} ]]}} {{wild_die=[[ @{researchWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_researchSpecRollValue" value="@{whisperresearch} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_researchspec_tResearchSpecRoll)}} {{trait=@{researchSpecName} }} @{rolltResearch} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_researchSpecName" title="@{repeating_researchSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_research_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_riding_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_riding_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticriding"/>
                <div class="basetrait staticRiding" data-i18n-list-item="riding">
                  <input class="deltabutton" type="hidden" name="attr_riding_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_riding_makeButton"/>
                  <input type="hidden" value="string" name="attr_riding_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tRidingRoll" value="@{ridingRollValue} {{skill_roll=[[ @{ridingSkillRollFormula} ]]}} {{wild_die=[[ @{ridingWildDieFormula} ]]}}" title="@{tRidingRoll}">&nbsp;<span name="attr_ridingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_riding_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_ridingRollValue" value="@{whisperriding} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tRidingRoll)}} {{trait=@{ridingname}}} @{rolltRiding} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="riding-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_riding" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="riding-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_riding" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="riding-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_riding" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="riding-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_riding" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="riding-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_riding" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_riding" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_ridingmod" title="@{ridingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_ridingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_RidingskillMod" title="@{Ridingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedridingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedridingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperriding"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_ridingwilddie" title="@{ridingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_ridingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_riding_delta" title="@{riding_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_riding_base"/>
                      <input type="hidden" name="attr_ridingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_riding_rank" value="1d4!"/>
                  <input type="hidden" name="attr_riding_display" value="d4"/>
                  <input type="hidden" name="attr_ridingSkillRollFormula" value="@{riding_rank} + @{RidingskillMod} [@{ridingModType}] + @{linkedridingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_ridingWildDieFormula" value="1d@{ridingwilddie}! + @{ridingmod} + @{RidingskillMod} [@{ridingModType}] + @{linkedridingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltRiding" value="{{name=@{character_name} }} {{skill_rank=@{riding_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_ridingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tRidingSpecRoll" title="@{tRidingSpecRoll}" value="@{ridingSpecRollValue} {{skill_roll=[[ @{ridingSkillRollFormula} ]]}} {{wild_die=[[ @{ridingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_ridingSpecRollValue" value="@{whisperriding} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_ridingspec_tRidingSpecRoll)}} {{trait=@{ridingSpecName} }} @{rolltRiding} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_ridingSpecName" title="@{repeating_ridingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_riding_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_science_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_science_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticscience"/>
                <div class="basetrait staticScience" data-i18n-list-item="science">
                  <input class="deltabutton" type="hidden" name="attr_science_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_science_makeButton"/>
                  <input type="hidden" value="string" name="attr_science_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tScienceRoll" value="@{scienceRollValue} {{skill_roll=[[ @{scienceSkillRollFormula} ]]}} {{wild_die=[[ @{scienceWildDieFormula} ]]}}" title="@{tScienceRoll}">&nbsp;<span name="attr_sciencename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_science_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_scienceRollValue" value="@{whisperscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tScienceRoll)}} {{trait=@{sciencename}}} @{rolltScience} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="science-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_science" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="science-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_science" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="science-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_science" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="science-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_science" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="science-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_science" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_science" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_sciencemod" title="@{sciencemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_scienceModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_ScienceskillMod" title="@{Scienceskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedscienceattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedscienceattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperscience"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_sciencewilddie" title="@{sciencewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_sciencewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_science_delta" title="@{science_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_science_base"/>
                      <input type="hidden" name="attr_sciencemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_science_rank" value="1d4!"/>
                  <input type="hidden" name="attr_science_display" value="d4"/>
                  <input type="hidden" name="attr_scienceSkillRollFormula" value="@{science_rank} + @{ScienceskillMod} [@{scienceModType}] + @{linkedscienceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_scienceWildDieFormula" value="1d@{sciencewilddie}! + @{sciencemod} + @{ScienceskillMod} [@{scienceModType}] + @{linkedscienceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltScience" value="{{name=@{character_name} }} {{skill_rank=@{science_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_sciencespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tScienceSpecRoll" title="@{tScienceSpecRoll}" value="@{scienceSpecRollValue} {{skill_roll=[[ @{scienceSkillRollFormula} ]]}} {{wild_die=[[ @{scienceWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_scienceSpecRollValue" value="@{whisperscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_sciencespec_tScienceSpecRoll)}} {{trait=@{scienceSpecName} }} @{rolltScience} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_scienceSpecName" title="@{repeating_scienceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_science_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_shooting_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_shooting_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticshooting"/>
                <div class="basetrait staticShooting" data-i18n-list-item="shooting">
                  <input class="deltabutton" type="hidden" name="attr_shooting_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_shooting_makeButton"/>
                  <input type="hidden" value="string" name="attr_shooting_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tShootingRoll" value="@{shootingRollValue} {{skill_roll=[[ @{shootingSkillRollFormula} ]]}} {{wild_die=[[ @{shootingWildDieFormula} ]]}}" title="@{tShootingRoll}">&nbsp;<span name="attr_shootingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_shooting_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_shootingRollValue" value="@{whispershooting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tShootingRoll)}} {{trait=@{shootingname}}} @{rolltShooting} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="shooting-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_shooting" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="shooting-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_shooting" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="shooting-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_shooting" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="shooting-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_shooting" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="shooting-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_shooting" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_shooting" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_shootingmod" title="@{shootingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_shootingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_ShootingskillMod" title="@{Shootingskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedshootingattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedshootingattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispershooting"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_shootingwilddie" title="@{shootingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_shootingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_shooting_delta" title="@{shooting_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_shooting_base"/>
                      <input type="hidden" name="attr_shootingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_shooting_rank" value="1d4!"/>
                  <input type="hidden" name="attr_shooting_display" value="d4"/>
                  <input type="hidden" name="attr_shootingSkillRollFormula" value="@{shooting_rank} + @{ShootingskillMod} [@{shootingModType}] + @{linkedshootingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_shootingWildDieFormula" value="1d@{shootingwilddie}! + @{shootingmod} + @{ShootingskillMod} [@{shootingModType}] + @{linkedshootingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltShooting" value="{{name=@{character_name} }} {{skill_rank=@{shooting_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_shootingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tShootingSpecRoll" title="@{tShootingSpecRoll}" value="@{shootingSpecRollValue} {{skill_roll=[[ @{shootingSkillRollFormula} ]]}} {{wild_die=[[ @{shootingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_shootingSpecRollValue" value="@{whispershooting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_shootingspec_tShootingSpecRoll)}} {{trait=@{shootingSpecName} }} @{rolltShooting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_shootingSpecName" title="@{repeating_shootingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_shooting_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="true" name="attr_spellcasting_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma,agl,spi,str,vig" name="attr_spellcasting_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticspellcasting"/>
                <div class="basetrait staticSpellcasting" data-i18n-list-item="spellcasting">
                  <input class="deltabutton" type="hidden" name="attr_spellcasting_delta" value="0"/>
                  <input type="hidden" value="true" name="attr_spellcasting_makeButton"/>
                  <input type="hidden" value="string" name="attr_spellcasting_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tSpellcastingRoll" value="@{spellcastingRollValue} {{skill_roll=[[ @{spellcastingSkillRollFormula} ]]}} {{wild_die=[[ @{spellcastingWildDieFormula} ]]}}" title="@{tSpellcastingRoll}">&nbsp;<span name="attr_spellcastingname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" name="attr_linkedspellcastingatt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_spellcasting_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_spellcastingRollValue" value="@{whisperspellcasting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tSpellcastingRoll)}} {{trait=@{spellcastingname}}} @{rolltSpellcasting} @{linkedspellcastingattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="spellcasting-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_spellcasting" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="spellcasting-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_spellcasting" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="spellcasting-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_spellcasting" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="spellcasting-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_spellcasting" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="spellcasting-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_spellcasting" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_spellcasting" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_spellcastingmod" title="@{spellcastingmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_spellcastingModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_SpellcastingskillMod" title="@{Spellcastingskillmod}" value="0"/><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                      <select class="LinkedAttSelect" name="attr_linkedspellcastingatt">
                        <option value="sma-u" data-i18n="smarts">Smarts</option>
                        <option value="agl-u" data-i18n="agility">Agility</option>
                        <option value="spi-u" data-i18n="spirit">Spirit</option>
                        <option value="str-u" data-i18n="strength">Strength</option>
                        <option value="vig-u" data-i18n="vigor">Vigor</option>
                      </select>
                      <!-- The following IF/Else was at this indentation...-->
                      <input type="hidden" name="attr_linkedspellcastingattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedspellcastingattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperspellcasting"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_spellcastingwilddie" title="@{spellcastingwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_spellcastingwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_spellcasting_delta" title="@{spellcasting_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_spellcasting_base"/>
                      <input type="hidden" name="attr_spellcastingmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_spellcasting_rank" value="1d4!"/>
                  <input type="hidden" name="attr_spellcasting_display" value="d4"/>
                  <input type="hidden" name="attr_spellcastingSkillRollFormula" value="@{spellcasting_rank} + @{SpellcastingskillMod} [@{spellcastingModType}] + @{linkedspellcastingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_spellcastingWildDieFormula" value="1d@{spellcastingwilddie}! + @{spellcastingmod} + @{SpellcastingskillMod} [@{spellcastingModType}] + @{linkedspellcastingattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltSpellcasting" value="{{name=@{character_name} }} {{skill_rank=@{spellcasting_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_spellcastingspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tSpellcastingSpecRoll" title="@{tSpellcastingSpecRoll}" value="@{spellcastingSpecRollValue} {{skill_roll=[[ @{spellcastingSkillRollFormula} ]]}} {{wild_die=[[ @{spellcastingWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_spellcastingSpecRollValue" value="@{whisperspellcasting} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_spellcastingspec_tSpellcastingSpecRoll)}} {{trait=@{spellcastingSpecName} }} @{rolltSpellcasting} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_spellcastingSpecName" title="@{repeating_spellcastingSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_spellcasting_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_stealth_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_stealth_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticstealth"/>
                <div class="basetrait staticStealth" data-i18n-list-item="stealth">
                  <input class="deltabutton" type="hidden" name="attr_stealth_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_stealth_makeButton"/>
                  <input type="hidden" value="string" name="attr_stealth_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tStealthRoll" value="@{stealthRollValue} {{skill_roll=[[ @{stealthSkillRollFormula} ]]}} {{wild_die=[[ @{stealthWildDieFormula} ]]}}" title="@{tStealthRoll}">&nbsp;<span name="attr_stealthname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_stealth_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_stealthRollValue" value="@{whisperstealth} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tStealthRoll)}} {{trait=@{stealthname}}} @{rolltStealth} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="stealth-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_stealth" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="stealth-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_stealth" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="stealth-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_stealth" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="stealth-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_stealth" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="stealth-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_stealth" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_stealth" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_stealthmod" title="@{stealthmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_stealthModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_StealthskillMod" title="@{Stealthskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedstealthattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedstealthattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperstealth"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_stealthwilddie" title="@{stealthwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_stealthwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_stealth_delta" title="@{stealth_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_stealth_base"/>
                      <input type="hidden" name="attr_stealthmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_stealth_rank" value="1d4!"/>
                  <input type="hidden" name="attr_stealth_display" value="d4"/>
                  <input type="hidden" name="attr_stealthSkillRollFormula" value="@{stealth_rank} + @{StealthskillMod} [@{stealthModType}] + @{linkedstealthattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_stealthWildDieFormula" value="1d@{stealthwilddie}! + @{stealthmod} + @{StealthskillMod} [@{stealthModType}] + @{linkedstealthattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltStealth" value="{{name=@{character_name} }} {{skill_rank=@{stealth_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_stealthspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tStealthSpecRoll" title="@{tStealthSpecRoll}" value="@{stealthSpecRollValue} {{skill_roll=[[ @{stealthSkillRollFormula} ]]}} {{wild_die=[[ @{stealthWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_stealthSpecRollValue" value="@{whisperstealth} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_stealthspec_tStealthSpecRoll)}} {{trait=@{stealthSpecName} }} @{rolltStealth} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_stealthSpecName" title="@{repeating_stealthSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_stealth_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="true" name="attr_survival_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma,spi" name="attr_survival_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticsurvival"/>
                <div class="basetrait staticSurvival" data-i18n-list-item="survival">
                  <input class="deltabutton" type="hidden" name="attr_survival_delta" value="0"/>
                  <input type="hidden" value="true" name="attr_survival_makeButton"/>
                  <input type="hidden" value="string" name="attr_survival_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tSurvivalRoll" value="@{survivalRollValue} {{skill_roll=[[ @{survivalSkillRollFormula} ]]}} {{wild_die=[[ @{survivalWildDieFormula} ]]}}" title="@{tSurvivalRoll}">&nbsp;<span name="attr_survivalname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" name="attr_linkedsurvivalatt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_survival_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_survivalRollValue" value="@{whispersurvival} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tSurvivalRoll)}} {{trait=@{survivalname}}} @{rolltSurvival} @{linkedsurvivalattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="survival-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_survival" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="survival-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_survival" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="survival-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_survival" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="survival-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_survival" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="survival-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_survival" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_survival" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_survivalmod" title="@{survivalmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_survivalModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_SurvivalskillMod" title="@{Survivalskillmod}" value="0"/><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                      <select class="LinkedAttSelect" name="attr_linkedsurvivalatt">
                        <option value="sma-u" data-i18n="smarts">Smarts</option>
                        <option value="spi-u" data-i18n="spirit">Spirit</option>
                      </select>
                      <!-- The following IF/Else was at this indentation...-->
                      <input type="hidden" name="attr_linkedsurvivalattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedsurvivalattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispersurvival"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_survivalwilddie" title="@{survivalwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_survivalwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_survival_delta" title="@{survival_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_survival_base"/>
                      <input type="hidden" name="attr_survivalmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_survival_rank" value="1d4!"/>
                  <input type="hidden" name="attr_survival_display" value="d4"/>
                  <input type="hidden" name="attr_survivalSkillRollFormula" value="@{survival_rank} + @{SurvivalskillMod} [@{survivalModType}] + @{linkedsurvivalattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_survivalWildDieFormula" value="1d@{survivalwilddie}! + @{survivalmod} + @{SurvivalskillMod} [@{survivalModType}] + @{linkedsurvivalattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltSurvival" value="{{name=@{character_name} }} {{skill_rank=@{survival_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_survivalspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tSurvivalSpecRoll" title="@{tSurvivalSpecRoll}" value="@{survivalSpecRollValue} {{skill_roll=[[ @{survivalSkillRollFormula} ]]}} {{wild_die=[[ @{survivalWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_survivalSpecRollValue" value="@{whispersurvival} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_survivalspec_tSurvivalSpecRoll)}} {{trait=@{survivalSpecName} }} @{rolltSurvival} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_survivalSpecName" title="@{repeating_survivalSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_survival_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_taunt_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_taunt_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_statictaunt"/>
                <div class="basetrait staticTaunt" data-i18n-list-item="taunt">
                  <input class="deltabutton" type="hidden" name="attr_taunt_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_taunt_makeButton"/>
                  <input type="hidden" value="string" name="attr_taunt_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tTauntRoll" value="@{tauntRollValue} {{skill_roll=[[ @{tauntSkillRollFormula} ]]}} {{wild_die=[[ @{tauntWildDieFormula} ]]}}" title="@{tTauntRoll}">&nbsp;<span name="attr_tauntname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_taunt_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_tauntRollValue" value="@{whispertaunt} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tTauntRoll)}} {{trait=@{tauntname}}} @{rolltTaunt} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="taunt-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_taunt" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="taunt-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_taunt" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="taunt-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_taunt" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="taunt-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_taunt" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="taunt-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_taunt" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_taunt" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_tauntmod" title="@{tauntmod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_tauntModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_TauntskillMod" title="@{Tauntskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedtauntattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedtauntattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispertaunt"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_tauntwilddie" title="@{tauntwilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_tauntwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_taunt_delta" title="@{taunt_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_taunt_base"/>
                      <input type="hidden" name="attr_tauntmod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_taunt_rank" value="1d4!"/>
                  <input type="hidden" name="attr_taunt_display" value="d4"/>
                  <input type="hidden" name="attr_tauntSkillRollFormula" value="@{taunt_rank} + @{TauntskillMod} [@{tauntModType}] + @{linkedtauntattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_tauntWildDieFormula" value="1d@{tauntwilddie}! + @{tauntmod} + @{TauntskillMod} [@{tauntModType}] + @{linkedtauntattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltTaunt" value="{{name=@{character_name} }} {{skill_rank=@{taunt_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_tauntspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tTauntSpecRoll" title="@{tTauntSpecRoll}" value="@{tauntSpecRollValue} {{skill_roll=[[ @{tauntSkillRollFormula} ]]}} {{wild_die=[[ @{tauntWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_tauntSpecRollValue" value="@{whispertaunt} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_tauntspec_tTauntSpecRoll)}} {{trait=@{tauntSpecName} }} @{rolltTaunt} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_tauntSpecName" title="@{repeating_tauntSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_taunt_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_thievery_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="agl" name="attr_thievery_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticthievery"/>
                <div class="basetrait staticThievery" data-i18n-list-item="thievery">
                  <input class="deltabutton" type="hidden" name="attr_thievery_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_thievery_makeButton"/>
                  <input type="hidden" value="string" name="attr_thievery_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tThieveryRoll" value="@{thieveryRollValue} {{skill_roll=[[ @{thieverySkillRollFormula} ]]}} {{wild_die=[[ @{thieveryWildDieFormula} ]]}}" title="@{tThieveryRoll}">&nbsp;<span name="attr_thieveryname"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="agl-u"></span><span class="statblock">(<span name="attr_thievery_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_thieveryRollValue" value="@{whisperthievery} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tThieveryRoll)}} {{trait=@{thieveryname}}} @{rolltThievery} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="thievery-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_thievery" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="thievery-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_thievery" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="thievery-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_thievery" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="thievery-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_thievery" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="thievery-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_thievery" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_thievery" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_thieverymod" title="@{thieverymod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_thieveryModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_ThieveryskillMod" title="@{Thieveryskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedthieveryattbutton" value="@{setmodsenc}"/>
                      <input type="hidden" name="attr_linkedthieveryattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperthievery"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_thieverywilddie" title="@{thieverywilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_thieverywilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_thievery_delta" title="@{thievery_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_thievery_base"/>
                      <input type="hidden" name="attr_thieverymod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_thievery_rank" value="1d4!"/>
                  <input type="hidden" name="attr_thievery_display" value="d4"/>
                  <input type="hidden" name="attr_thieverySkillRollFormula" value="@{thievery_rank} + @{ThieveryskillMod} [@{thieveryModType}] + @{linkedthieveryattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_thieveryWildDieFormula" value="1d@{thieverywilddie}! + @{thieverymod} + @{ThieveryskillMod} [@{thieveryModType}] + @{linkedthieveryattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltThievery" value="{{name=@{character_name} }} {{skill_rank=@{thievery_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_thieveryspec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tThieverySpecRoll" title="@{tThieverySpecRoll}" value="@{thieverySpecRollValue} {{skill_roll=[[ @{thieverySkillRollFormula} ]]}} {{wild_die=[[ @{thieveryWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_thieverySpecRollValue" value="@{whisperthievery} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_thieveryspec_tThieverySpecRoll)}} {{trait=@{thieverySpecName} }} @{rolltThievery} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_thieverySpecName" title="@{repeating_thieverySpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_thievery_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="false" name="attr_trade_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma" name="attr_trade_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_statictrade"/>
                <div class="basetrait staticTrade" data-i18n-list-item="trade">
                  <input class="deltabutton" type="hidden" name="attr_trade_delta" value="0"/>
                  <input type="hidden" value="false" name="attr_trade_makeButton"/>
                  <input type="hidden" value="string" name="attr_trade_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tTradeRoll" value="@{tradeRollValue} {{skill_roll=[[ @{tradeSkillRollFormula} ]]}} {{wild_die=[[ @{tradeWildDieFormula} ]]}}" title="@{tTradeRoll}">&nbsp;<span name="attr_tradename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" data-i18n="sma-u"></span><span class="statblock">(<span name="attr_trade_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_tradeRollValue" value="@{whispertrade} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tTradeRoll)}} {{trait=@{tradename}}} @{rolltTrade} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="trade-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_trade" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="trade-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_trade" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="trade-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_trade" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="trade-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_trade" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="trade-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_trade" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_trade" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_trademod" title="@{trademod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_tradeModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_TradeskillMod" title="@{Tradeskillmod}" value="0"/>
                      <input type="hidden" name="attr_linkedtradeattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedtradeattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whispertrade"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_tradewilddie" title="@{tradewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_tradewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_trade_delta" title="@{trade_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_trade_base"/>
                      <input type="hidden" name="attr_trademod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_trade_rank" value="1d4!"/>
                  <input type="hidden" name="attr_trade_display" value="d4"/>
                  <input type="hidden" name="attr_tradeSkillRollFormula" value="@{trade_rank} + @{TradeskillMod} [@{tradeModType}] + @{linkedtradeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_tradeWildDieFormula" value="1d@{tradewilddie}! + @{trademod} + @{TradeskillMod} [@{tradeModType}] + @{linkedtradeattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltTrade" value="{{name=@{character_name} }} {{skill_rank=@{trade_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_tradespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tTradeSpecRoll" title="@{tTradeSpecRoll}" value="@{tradeSpecRollValue} {{skill_roll=[[ @{tradeSkillRollFormula} ]]}} {{wild_die=[[ @{tradeWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_tradeSpecRollValue" value="@{whispertrade} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_tradespec_tTradeSpecRoll)}} {{trait=@{tradeSpecName} }} @{rolltTrade} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_tradeSpecName" title="@{repeating_tradeSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_trade_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!--input(type="hidden", value=`${name}`)-->
                <!--input(type="hidden", value=`${skillAbbr}`)-->
                <input type="hidden" value="true" name="attr_weirdscience_cla"/>
                <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                <input type="hidden" value="sma,agl,spi,str,vig" name="attr_weirdscience_lao"/>
                <!--input(type="hidden", value=`${vartype}`)-->
                <!-- Begin the Actual HTML for the Character Sheet-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticweirdscience"/>
                <div class="basetrait staticWeirdscience" data-i18n-list-item="weirdscience">
                  <input class="deltabutton" type="hidden" name="attr_weirdscience_delta" value="0"/>
                  <input type="hidden" value="true" name="attr_weirdscience_makeButton"/>
                  <input type="hidden" value="string" name="attr_weirdscience_mbVarType"/>
                  <button class="skillbutton skillflexattbutton" type="roll" name="roll_tWeirdscienceRoll" value="@{weirdscienceRollValue} {{skill_roll=[[ @{weirdscienceSkillRollFormula} ]]}} {{wild_die=[[ @{weirdscienceWildDieFormula} ]]}}" title="@{tWeirdscienceRoll}">&nbsp;<span name="attr_weirdsciencename"></span>
                    <!--
                    if skill === "knowledgeother"
                        span(name=`attr_${skill}buttonName`, value="Skill")
                    else if skill === "language"
                        span(name=`attr_native-${skill}name`)
                    else
                        span(name=`attr_${skill}name`) 
                    
                    -->&nbsp;<span class="linkedAtt" name="attr_linkedweirdscienceatt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_weirdscience_display"></span>)</span>
                  </button>
                  <input type="hidden" name="attr_weirdscienceRollValue" value="@{whisperweirdscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tWeirdscienceRoll)}} {{trait=@{weirdsciencename}}} @{rolltWeirdscience} @{linkedweirdscienceattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                  <div class="skillRankContainer">
                    <div class="skillRankChild">
                      <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                      <label class="skilldielabel" data-i18n-title="weirdscience-die-type-d4">
                        <input class="traitradio" type="radio" name="attr_weirdscience" value="4" checked="checked"/><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="weirdscience-die-type-d6">
                        <input class="traitradio" type="radio" name="attr_weirdscience" value="6"/><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="weirdscience-die-type-d8">
                        <input class="traitradio" type="radio" name="attr_weirdscience" value="8"/><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="weirdscience-die-type-d10">
                        <input class="traitradio" type="radio" name="attr_weirdscience" value="10"/><span class="d10"></span>
                        <div class="d10a" data-i18n="d10"></div>
                      </label>
                      <label class="skilldielabel" data-i18n-title="weirdscience-die-type-d12">
                        <input class="traitradio" type="radio" name="attr_weirdscience" value="12"/><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </label>
                      <input class="traitradio" type="hidden" name="attr_weirdscience" value="4"/>
                      <div class="d4Selected"><span class="d4"></span>
                        <div class="d4a" data-i18n="d4"></div>
                      </div>
                      <div class="d6Selected"><span class="d6"></span>
                        <div class="d6a" data-i18n="d6"></div>
                      </div>
                      <div class="d8Selected"><span class="d8"></span>
                        <div class="d8a" data-i18n="d8"></div>
                      </div>
                      <div class="d10Selected"><span class="d10"> </span>
                        <div class="d10a" data-i18n="d10"></div>
                      </div>
                      <div class="d12Selected"><span class="d12"></span>
                        <div class="d12a" data-i18n="d12"></div>
                      </div>
                    </div>+
                  </div>
                  <input class="otraitmod" type="number" name="attr_weirdsciencemod" title="@{weirdsciencemod}" value="0"/>
                  <details>
                    <summary class="config">y</summary>
                    <div class="traitmodplus">
                      <input class="ModDesc" type="text" name="attr_weirdscienceModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                      <input class="otraitmod" type="number" name="attr_WeirdscienceskillMod" title="@{Weirdscienceskillmod}" value="0"/><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                      <select class="LinkedAttSelect" name="attr_linkedweirdscienceatt">
                        <option value="sma-u" data-i18n="smarts">Smarts</option>
                        <option value="agl-u" data-i18n="agility">Agility</option>
                        <option value="spi-u" data-i18n="spirit">Spirit</option>
                        <option value="str-u" data-i18n="strength">Strength</option>
                        <option value="vig-u" data-i18n="vigor">Vigor</option>
                      </select>
                      <!-- The following IF/Else was at this indentation...-->
                      <input type="hidden" name="attr_linkedweirdscienceattbutton" value="@{setmods}"/>
                      <input type="hidden" name="attr_linkedweirdscienceattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                      <hr class="modsection"/>
                      <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperweirdscience"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                      <select class="traitdie" name="attr_weirdsciencewilddie" title="@{weirdsciencewilddie}">
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" selected="selected" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                      </select><span data-i18n="wild-die">Wild Die</span>
                      <input class="wildDieDesc" type="text" name="attr_weirdsciencewilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                      <input class="deltamod" type="number" name="attr_weirdscience_delta" title="@{weirdscience_delta}" value="0"/>
                      <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                      <input type="hidden" name="attr_weirdscience_base"/>
                      <input type="hidden" name="attr_weirdsciencemod_base"/>
                    </div>
                  </details>
                  <input type="hidden" name="attr_weirdscience_rank" value="1d4!"/>
                  <input type="hidden" name="attr_weirdscience_display" value="d4"/>
                  <input type="hidden" name="attr_weirdscienceSkillRollFormula" value="@{weirdscience_rank} + @{WeirdscienceskillMod} [@{weirdscienceModType}] + @{linkedweirdscienceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_weirdscienceWildDieFormula" value="1d@{weirdsciencewilddie}! + @{weirdsciencemod} + @{WeirdscienceskillMod} [@{weirdscienceModType}] + @{linkedweirdscienceattformula} + @{traitmods}"/>
                  <input type="hidden" name="attr_rolltWeirdscience" value="{{name=@{character_name} }} {{skill_rank=@{weirdscience_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                  <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                  <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                  <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                  <div class="SkillSpec">
                    <fieldset class="repeating_weirdsciencespec">
                      <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tWeirdscienceSpecRoll" title="@{tWeirdscienceSpecRoll}" value="@{weirdscienceSpecRollValue} {{skill_roll=[[ @{weirdscienceSkillRollFormula} ]]}} {{wild_die=[[ @{weirdscienceWildDieFormula} ]]}}"></button>
                      <input type="hidden" name="attr_weirdscienceSpecRollValue" value="@{whisperweirdscience} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_weirdsciencespec_tWeirdscienceSpecRoll)}} {{trait=@{weirdscienceSpecName} }} @{rolltWeirdscience} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <input class="speciality" type="text" name="attr_weirdscienceSpecName" title="@{repeating_weirdscienceSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                      <input class="hiddenInput" type="text" name="attr_weirdscience_specialty_display" value="d4"/>
                    </fieldset>
                    <!--
                    fieldset(class=`repeating_${skill}spec`)
                        button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                        input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                        input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                    -->
                  </div>
                </div>
                <!-- Knowledge/Other Skill (Repeating Section)-->
                <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticKnowledgeOther"/>
                <div class="base staticOther" data-i18n-list-item="knowledge-other">
                  <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                  <fieldset class="repeating_skills">
                    <input type="hidden" name="attr_skillnamerank"/>
                    <input type="hidden" name="attr_skillnamerankmod"/>
                    <input type="hidden" name="attr_otherModType"/>
                    <input type="hidden" name="attr_SkillMod"/>
                    <input type="hidden" name="attr_linkedotherattscore"/>
                    <input type="hidden" name="attr_whisperskillname"/>
                    <input type="hidden" name="attr_skillnamewilddie"/>
                    <input type="hidden" name="attr_skillnamewilddieinfo"/>
                    <input type="hidden" name="attr_skillnamerank_delta"/>
                    <input type="hidden" name="attr_skillnamerank_base"/>
                    <input type="hidden" name="attr_skillnamerankmod_base"/>
                    <!--input(type="hidden", value=`${name}`)-->
                    <!--input(type="hidden", value=`${skillAbbr}`)-->
                    <input type="hidden" value="true" name="attr_knowledgeother_cla"/>
                    <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
                    <input type="hidden" value="sma,agl,spi,str,vig,na" name="attr_knowledgeother_lao"/>
                    <!--input(type="hidden", value=`${vartype}`)-->
                    <!-- Begin the Actual HTML for the Character Sheet-->
                    <div class="basetrait staticKnowledgeother" data-i18n-list-item="knowledgeother">
                      <input class="deltabutton" type="hidden" name="attr_knowledgeother_delta" value="0"/>
                      <input type="hidden" value="true" name="attr_knowledgeother_makeButton"/>
                      <input type="hidden" value="string" name="attr_knowledgeother_mbVarType"/>
                      <button class="skillbutton skillflexattbutton" type="roll" name="roll_tKnowledgeotherRoll" value="@{knowledgeotherRollValue} {{skill_roll=[[ @{knowledgeotherSkillRollFormula} ]]}} {{wild_die=[[ @{knowledgeotherWildDieFormula} ]]}}" title="@{tKnowledgeotherRoll}">&nbsp;<span name="attr_custSkillName"></span>
                        <!--
                        if skill === "knowledgeother"
                            span(name=`attr_${skill}buttonName`, value="Skill")
                        else if skill === "language"
                            span(name=`attr_native-${skill}name`)
                        else
                            span(name=`attr_${skill}name`) 
                        
                        -->&nbsp;<span class="linkedAtt" name="attr_linkedknowledgeotheratt" data-i18n-dynamic="data-i18n-dynamic"></span><span class="statblock">(<span name="attr_knowledgeother_display"></span>)</span>
                      </button>
                      <input type="hidden" name="attr_knowledgeotherRollValue" value="@{whisperknowledgeother} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_skills_tKnowledgeotherRoll)}} {{trait=@{custSkillName}}} @{rolltKnowledgeother} @{linkedknowledgeotherattbutton} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                      <div class="skillRankContainer">
                        <div class="skillRankChild">
                          <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d4">
                            <input class="traitradio" type="radio" name="attr_knowledgeother" value="4" checked="checked"/><span class="d4"></span>
                            <div class="d4a" data-i18n="d4"></div>
                          </label>
                          <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d6">
                            <input class="traitradio" type="radio" name="attr_knowledgeother" value="6"/><span class="d6"></span>
                            <div class="d6a" data-i18n="d6"></div>
                          </label>
                          <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d8">
                            <input class="traitradio" type="radio" name="attr_knowledgeother" value="8"/><span class="d8"></span>
                            <div class="d8a" data-i18n="d8"></div>
                          </label>
                          <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d10">
                            <input class="traitradio" type="radio" name="attr_knowledgeother" value="10"/><span class="d10"></span>
                            <div class="d10a" data-i18n="d10"></div>
                          </label>
                          <label class="skilldielabel" data-i18n-title="knowledgeother-die-type-d12">
                            <input class="traitradio" type="radio" name="attr_knowledgeother" value="12"/><span class="d12"></span>
                            <div class="d12a" data-i18n="d12"></div>
                          </label>
                          <input class="traitradio" type="hidden" name="attr_knowledgeother" value="4"/>
                          <div class="d4Selected"><span class="d4"></span>
                            <div class="d4a" data-i18n="d4"></div>
                          </div>
                          <div class="d6Selected"><span class="d6"></span>
                            <div class="d6a" data-i18n="d6"></div>
                          </div>
                          <div class="d8Selected"><span class="d8"></span>
                            <div class="d8a" data-i18n="d8"></div>
                          </div>
                          <div class="d10Selected"><span class="d10"> </span>
                            <div class="d10a" data-i18n="d10"></div>
                          </div>
                          <div class="d12Selected"><span class="d12"></span>
                            <div class="d12a" data-i18n="d12"></div>
                          </div>
                        </div>+
                      </div>
                      <input class="otraitmod" type="number" name="attr_knowledgeothermod" title="@{knowledgeothermod}" value="0"/>
                      <details>
                        <summary class="config">y</summary>
                        <div class="traitmodplus">
                          <input class="ModDesc" type="text" name="attr_knowledgeotherModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                          <input class="otraitmod" type="number" name="attr_KnowledgeotherskillMod" title="@{Knowledgeotherskillmod}" value="0"/><span class="ModDesc" data-i18n="skill-name">Skill Name</span>
                          <input type="text" name="attr_custSkillName" value="Skill" maxlength="25"/>
                          <!-- input(type="text", name=`attr_${skill}buttonName` value="Skill" maxlength="25")--><span class="ModDesc" data-i18n="linked-attribute">Linked Attribute</span>
                          <select class="LinkedAttSelect" name="attr_linkedknowledgeotheratt">
                            <option value="sma-u" data-i18n="smarts">Smarts</option>
                            <option value="agl-u" data-i18n="agility">Agility</option>
                            <option value="spi-u" data-i18n="spirit">Spirit</option>
                            <option value="str-u" data-i18n="strength">Strength</option>
                            <option value="vig-u" data-i18n="vigor">Vigor</option>
                            <option value="na-u" data-i18n="not-applicable-abbr-u">N/A</option>
                          </select>
                          <!-- The following IF/Else was at this indentation...-->
                          <input type="hidden" name="attr_linkedknowledgeotherattbutton" value="@{setmods}"/>
                          <input type="hidden" name="attr_linkedknowledgeotherattformula" value="@{ModSum}[Distracted, Wounds, Fatigue]"/>
                          <hr class="modsection"/>
                          <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperknowledgeother"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                          <select class="traitdie" name="attr_knowledgeotherwilddie" title="@{knowledgeotherwilddie}">
                            <option value="4" data-i18n="d4">d4</option>
                            <option value="6" selected="selected" data-i18n="d6">d6</option>
                            <option value="8" data-i18n="d8">d8</option>
                            <option value="10" data-i18n="d10">d10</option>
                            <option value="12" data-i18n="d12">d12</option>
                          </select><span data-i18n="wild-die">Wild Die</span>
                          <input class="wildDieDesc" type="text" name="attr_knowledgeotherwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                          <input class="deltamod" type="number" name="attr_knowledgeother_delta" title="@{knowledgeother_delta}" value="0"/>
                          <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                          <input type="hidden" name="attr_knowledgeother_base"/>
                          <input type="hidden" name="attr_knowledgeothermod_base"/>
                        </div>
                      </details>
                      <input type="hidden" name="attr_knowledgeother_rank" value="1d4!"/>
                      <input type="hidden" name="attr_knowledgeother_display" value="d4"/>
                      <input type="hidden" name="attr_knowledgeotherSkillRollFormula" value="@{knowledgeother_rank} + @{KnowledgeotherskillMod} [@{knowledgeotherModType}] + @{linkedknowledgeotherattformula} + @{traitmods}"/>
                      <input type="hidden" name="attr_knowledgeotherWildDieFormula" value="1d@{knowledgeotherwilddie}! + @{knowledgeothermod} + @{KnowledgeotherskillMod} [@{knowledgeotherModType}] + @{linkedknowledgeotherattformula} + @{traitmods}"/>
                      <input type="hidden" name="attr_rolltKnowledgeother" value="{{name=@{character_name} }} {{skill_rank=@{knowledgeother_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                      <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                      <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
          <div class="triFold"> 
            <!--Center Column (Bio, Derived Stats, Gear)-->
            <div class="charDemo">
              <div class="base charDemoStart">
                <label class="wclabel">
                  <div class="wciContainer">
                    <input class="isWC" type="checkbox" name="attr_is_npc" value="1"/><span name="attr_WCI"> </span>
                  </div>
                </label>
                <input type="hidden" name="attr_namelength" value="0"/>
                <input class="basicinputext basicCharName" type="text" name="attr_character_name" title="@{character_name}"/>
                <label class="basicinfolableleft basicCharNameLabel" data-i18n="character-name">Name</label>
              </div>
              <div class="base">
                <input class="basicinputext race" type="text" name="attr_race" title="@{race}"/>
                <input class="basicinputext gender" type="text" name="attr_gender" title="@{gender}"/>
                <label class="basicinfolableleft race"> <span name="attr_racename"></span></label>
                <label class="basicinfolableleft gender" data-i18n="gender">Gender</label>
              </div>
              <div class="base">
                <div class="characterAge">
                  <input class="basicinputext" type="text" name="attr_age" title="@{age}"/>
                  <label class="basicinfolableleft characterAge" data-i18n="age">Age</label>
                </div>
                <div class="characterHeight">
                  <input class="basicinputext" type="text" name="attr_character_height" title="@{character_height}"/>
                  <label class="basicinfolableleft characterHeight" data-i18n="character-height">height</label>
                </div>
                <div class="characterWeight">
                  <input class="basicinputext" type="text" name="attr_character_weight" title="@{character_weight}"/>
                  <label class="basicinfolableleft characterWeight" data-i18n="weight">Weight</label>
                </div>
                <div class="characterSize">
                  <input class="basicinputext" type="number" name="attr_size" title="@{size}" value="0"/>
                  <input type="hidden" name="attr_sizecategory" value="normal"/>
                  <input class="hiddenInput" type="number" name="attr_sizecur" value="0" readonly="readonly"/>
                  <label class="basicinfolableleft" data-i18n-title="size-category"><span data-i18n="size"></span>: <span name="attr_sizecategory" data-i18n-dynamic="data-i18n-dynamic"></span></label>
                </div>
              </div>
              <div class="base">
                <div class="advances">
                  <input class="manuallySetAdvance" type="checkbox" name="attr_setadvance" value="1"/>
                  <input class="autoAdvance centerText" type="number" name="attr_xp" title="@{xp}" readonly="readonly"/>
                  <input class="manualAdvance centerText" type="number" name="attr_manualAdvance" title="@{manualAdvance}"/>
                  <label class="advancesLabel" data-i18n="advances">Advances</label>
                </div>
                <div class="characterRank">
                  <select class="rank" name="attr_rank" title="@{rank}" readonly="readonly">
                    <option value="1" data-i18n="novice">Novice</option>
                    <option value="2" data-i18n="seasoned">Seasoned</option>
                    <option value="3" data-i18n="veteran">Veteran</option>
                    <option value="4" data-i18n="heroic">Heroic</option>
                    <option value="5" data-i18n="legendary">Legendary</option>
                  </select>
                  <label class="rankLabel" data-i18n="rank">Rank</label>
                </div>
                <div class="bennies">
                  <input class="bennies" type="number" name="attr_bennies" value="0"/>
                  <button class="benny" type="roll" name="roll_use_benny" value="/em uses a benny.">
                    <div class="imagecontainer"><img src="https://gitlab.com/peginc/swade/-/raw/master/src/assets/benny/benny-chip-front.png"/><span class="hiddenInput" data-i18n="bennies"></span></div>
                  </button>
                </div>
                <div class="conviction">
                  <input class="hasconviction" type="checkbox" name="attr_conviction" value="1"/><span class="convictiontoken"></span>
                  <label class="labelConviction" data-i18n="conviction"></label>
                </div>
              </div>
            </div>
            <!--Derived Stats-->
            <div class="parryPaceToughness"><!-- Pace -->
              <div class="base characterPace">
                <div class="imageContainer"><img class="statCircle" src="https://raw.githubusercontent.com/finderski/SWT/master/redCircle1.png"/>
                  <input class="derivedStat" type="hidden" name="attr_paceCur" title="@{paceCur}" value="6" readonly="readonly"/>
                  <input class="moremods hiddenInput" type="checkbox" name="attr_showPaceMod"/>
                  <button class="curPaceButton" type="action" name="act_paceCur"><span name="attr_paceCur"></span>&nbsp;<span class="cog shiftLeft">y</span></button>
                </div>
                <input type="hidden" name="attr_running_formula" value="&amp;{template:emote} {{name=@{character_name}}} {{does=^{running-text-before-number} [[@{paceCur}+@{runningDie}+@{encumbrance}]] ^{running-text-after-number} }}"/>
                <button class="traitbutton deriveflexbutton paceButton" type="roll" name="roll_RunningRoll" title="@{RunningRoll}" value="@{running_formula}">&nbsp;<span data-i18n="pace">Pace</span></button>
              </div><!-- Parry -->
              <div class="base characterParry">
                <div class="imageContainer"><img class="statCircle" src="https://raw.githubusercontent.com/finderski/SWT/master/redCircle2.png"/>
                  <input class="derivedStat" type="hidden" name="attr_parryCur" title="@{parryCur}" readonly="readonly"/>
                  <button class="curParryButton" type="action" name="act_parryCur"><span name="attr_parryCur"></span></button>
                </div>
                <input class="moremods hiddenInput" type="checkbox" name="attr_showParryMod"/>
                <button class="traitbutton deriveflexbutton parryLabelButton" type="action" name="act_parryButton"><span data-i18n="parry">Parry</span>&nbsp;<span class="cog shiftLeft">y</span></button>
              </div><!-- Toughness -->
              <div class="base characterToughness">
                <div class="imageContainer"><img class="statCircle" src="https://raw.githubusercontent.com/finderski/SWT/master/redCircle3.png"/>
                  <input class="derivedStat" type="hidden" name="attr_toughnesscur" title="@{toughnesscur}" readonly="readonly"/>
                  <button class="curToughnessButton" type="action" name="act_toughnessCur"><span name="attr_toughnesscur"></span>&nbsp;(<span name="attr_toughnessArmor"></span>)</button>
                </div>
                <input class="moremods hiddenInput" type="checkbox" name="attr_showToughnessMod"/>
                <button class="traitbutton deriveflexbutton toughnessLabelButton" type="action" name="act_toughnessButton"><span data-i18n="toughness">Toughness</span>&nbsp;<span class="cog shiftLeft">y</span></button>
              </div>
            </div>
            <!-- Pace Config-->
            <input class="moremods hiddenInput" type="checkbox" name="attr_showPaceMod"/>
            <div class="basetrait pacemodplus">
              <h4 class="derivedStats-configHeader" data-i18n="pace-configuration">Pace Configuration</h4>
              <label class="paceLabel" data-i18n="base">Base</label>
              <input class="derivedStat paceInput" type="number" name="attr_pace" title="@{pace}" value="6"/>
              <input class="paceLabelInput" type="text" name="attr_paceModReason" data-i18n-placeholder="edge-hindrance-modifier-abbr"/>
              <input class="derivedStat paceInput inputLabel" type="number" name="attr_paceMod" title="@{paceMod}" value="0"/>
              <input class="showPaceWounds" type="hidden" name="attr_woundsMod" value="0"/>
              <label class="paceLabel paceWounds" data-i18n="reduced-by-wounds">Reduced by Wounds:</label>
              <div class="paceWounds inlineDiv">—<span name="attr_woundsMod"></span></div>
              <label class="paceLabel" data-i18n="running-die-type">Running Die type:</label>
              <select class="paceDietype" name="attr_runningDie" title="@{runningDie}">
                <option value="1d4" data-i18n="d4">d4</option>
                <option value="1d6" selected="selected" data-i18n="d6">d6</option>
                <option value="1d8" data-i18n="d8">d8</option>
                <option value="1d10" data-i18n="d10">d10</option>
                <option value="1d12" data-i18n="d12">d12</option>
              </select>
            </div><!-- Parry Config -->
            <input class="moremods hiddenInput" type="checkbox" name="attr_showParryMod"/>
            <div class="basetrait parrymodplus">
              <h4 class="derivedStats-configHeader" data-i18n="parry-configuration">Parry Configuration</h4>
              <label class="parryLabel" data-i18n="base">Base:</label>
              <input class="derivedStat parryInput" type="number" name="attr_parry" title="@{parry}"/>
              <label class="parryLabel" data-i18n="shield">Shield:</label>
              <input class="derivedStat parryInput" type="number" name="attr_shieldparry" value="0" title="@{shieldparry}" readonly="readonly"/>
              <input class="parryLabelInput" type="text" name="attr_parryModReason" data-i18n-placeholder="edge-hindrance-modifier-abbr"/>
              <input class="derivedStat parryInput inputLabel" type="number" name="attr_parryMod" value="0" title="@{parryMod}"/>
            </div><!-- Toughness Config -->
            <input class="moremods" type="checkbox" name="attr_showToughnessMod" style="display: none;"/>
            <div class="basetrait toughnessmodplus">
              <h4 class="derivedStats-configHeader" data-i18n="toughness-configuration">Toughness Configuration</h4>
              <label class="toughnessLabel" data-i18n="base">Base:</label>
              <input class="derivedStat toughnessInput" type="number" name="attr_toughness" title="@{toughness}" readonly="readonly"/>
              <label class="toughnessLabel" data-i18n="size">Size:</label>
              <div class="sizeInfo"><span name="attr_sizecur"></span></div>
              <label class="toughnessLabel" data-i18n="armor-embedded-toughness">Embedded Toughness </label>
              <input class="derivedStat toughnessInput" type="number" name="attr_armor_embedded_toughness" title="@{armor_embedded_toughness}" value="0" readonly="readonly"/>
              <input class="hiddenInput usePowerArmor" type="checkbox" name="attr_power_armor" value="1"/>
              <label class="toughnessLabel powerArmorToughness" data-i18n="power-armor">Power Armor </label>
              <input class="derivedStat toughnessInput powerArmorToughness" type="number" name="attr_power_armor_toughness" title="@{power_armor_toughness" readonly="readonly"/>
              <input class="toughnessLabelInput" type="text" name="attr_toughnessModReason" data-i18n-placeholder="edge-hindrance-modifier-abbr"/>
              <input class="derivedStat toughnessInput inputLabel" type="number" name="attr_tufnessMod" value="0" title="@{tufnessMod}"/>
              <label class="toughnessLabel" data-i18n="armor">Armor:</label>
              <input class="derivedStat toughnessInput" type="number" name="attr_toughnessArmor" value="0" title="@{toughnessArmor}"/>
            </div><!-- Additional Derived Stats -->
            <input class="useDominion" type="hidden" name="attr_showDominion" value="0"/>
            <input class="useBurn" type="hidden" name="attr_showBurn" value="0"/>
            <input class="showadditional hiddenInput" type="checkbox" name="attr_showadditionalderived"/>
            <!-- h1(class='groupHeaderDerived additionalDerived', data-i18n="additional-derived-stats") Additional Derived Stats-->
            <h1 class="additionalDerived" data-i18n="additional-derived-stats">Additional Derived Stats</h1>
            <div class="base corederived additionalDerived">
              <div class="basederived derivedHeaderRow">
                <div class="derivelabel" data-i18n="stat-abbr">Stat</div>
                <div class="derivebase" data-i18n="base">Base</div>
                <div class="derivemod" data-i18n="modifier-abbr">Mod</div>
                <div class="derivecurrent" data-i18n="current">Current</div>
                <div class="derivemisc" data-i18n="maximum-abbr">Max</div>
              </div>
              <hr class="derivedhr dashed"/>
              <!-- Dominion-->
              <div class="basederived showDominion">
                <div class="derivelabel">
                  <button class="traitbutton deriveflexbutton dominionButton" type="roll" name="roll_DominionRoll" value="&amp;{template:info} {{name=@{character_name}}} {{item=Dominion Roll}} {{[[ 1t[@{dominion-table}] ]] }} {{theme=@{rolltemplate_theme}}}"><span data-i18n="dominion">Dominion</span></button>
                </div>
                <div class="derivebase doubleheight"><span class="derivedStat" data-i18n="spirit"></span></div>
                <div class="derivemod">&nbsp;</div>
                <div class="derivecurrent">
                  <input class="derivedStat" type="number" name="attr_dominion" title="@{dominion}" value="0"/>
                </div>
                <div class="derivemisc">
                  <input class="derivedStat" type="number" name="attr_dominion_max" title="@{dominion_max}" value="0"/>
                </div>
              </div>
              <!-- Burn-->
              <div class="basederived showBurn">
                <div class="derivelabel">
                  <button class="traitbutton deriveflexbutton burnButton" type="action" name="act_BurnRoll"><span class="flame">&#128293; &nbsp;</span><span data-i18n="burn">Burn</span><span>&nbsp;(</span><span name="attr_burn_die_type" data-i18n-dynamic="data-i18n-dynamic"></span><span>)</span></button>
                </div>
                <div class="derivebase doubleheight"><span>8</span></div>
                <div class="derivemod"> 
                  <input class="derivedStat" type="number" name="attr_burn_points_mod" title="@burn_points_mod" value="0"/>
                </div>
                <div class="derivecurrent">
                  <input class="derivedStat" type="number" name="attr_burn_points" title="@{burn_points}" value="8" readonly="readonly"/>
                </div>
                <div class="derivemisc">&nbsp;
                  <!--input(type="number" name="attr_burn_points_max" title="@{burn_points_max}" class="derivedStat" value="8" disabled)-->
                </div>
                <!--
                if Burn Points = 8 - 4, then Burn Die = d6
                if Burn Points = 3 then Burn Die = d8
                if Burn Points = 2 then Burn Die = d10
                if Burn Points = 1 then Burn Die = d12
                -->
                <input type="hidden" name="attr_burn_die_type" value="d6"/>
              </div>
              <!-- First Custom Derived Stat-->
              <div class="basederived otherDerived">
                <div class="derivelabel">
                  <input class="derivedStatName" type="text" name="attr_derivedFirstName" value="Custom" title="@{derivedFirstName}" data-i18n-placeholder="derived-stat-name"/>
                </div>
                <div class="derivebase">
                  <input class="derivedStat" type="number" name="attr_derivedFirstBase" value="0" title="@{derivedFirstBase}"/>
                </div>
                <div class="derivemod">
                  <input class="derivedStat" type="number" name="attr_derivedFirstMod" value="0" title="@{derivedFirstMod}"/>
                </div>
                <div class="derivecurrent">
                  <input class="derivedStat" type="number" name="attr_derivedFirstCurrent" value="0" title="@{derivedFirstCurrent}"/>
                </div>
                <div class="derivemisc">
                  <input class="derivedStat" type="number" name="attr_derivedFirstMax" value="0" title="@{derivedFirstMax}"/>
                </div>
              </div>
              <fieldset class="repeating_derivedstats">
                <div class="basederived">
                  <div class="derivelabel">
                    <input class="derivedStatName" type="text" name="attr_derivedName" title="@{derivedName}" data-i18n-placeholder="derived-stat-name"/>
                  </div>
                  <div class="derivebase">
                    <input class="derivedStat" type="number" name="attr_derivedBase" value="0" title="@{derivedBase}"/>
                  </div>
                  <div class="derivemod">
                    <input class="derivedStat" type="number" name="attr_derivedMod" value="0" title="@{derivedMod}"/>
                  </div>
                  <div class="derivecurrent">
                    <input class="derivedStat" type="number" name="attr_derivedCurrent" value="0" title="@{derivedCurrent}"/>
                  </div>
                  <div class="derivemisc">
                    <input class="derivedStat" type="number" name="attr_derivedMax" value="0" title="@{derivedMax}"/>
                  </div>
                </div><span class="statblock" name="attr_derivedName"></span><span class="statblock">: </span><span class="statblock" name="attr_derivedCurrent"></span>
              </fieldset>
            </div><!-- End Add'l Derived Stats -->
            <!--Load and Encumbrance-->
            <!-- Sheet workers for Load and Encumbrance are in derivedStats.js-->
            <hr class="mischr"/>
            <input class="useLoad" type="checkbox" name="attr_useLoad" style="display:none;"/>
            <div class="base miscderived loadstuff">
              <div class="basederived loadstuff headerRow">
                <div class="derivelabel loadstuff">&nbsp;</div>
                <div class="derivebase" data-i18n="modifier-abbr">Mod</div>
                <div class="derivemod" data-i18n="limit">Limit</div>
                <div class="derivecurrent" data-i18n="carried">Carried</div>
                <div class="derivemisc" data-i18n="penalty">Penalty</div>
              </div>
              <!-- Encumbrance-->
              <input class="useLoad hiddenInput" type="checkbox" name="attr_useLoad"/>
              <div class="basederived loadstuff">
                <div class="derivelabel" data-i18n="load">Load</div>
                <div class="derivebase">
                  <input class="derivedStat" type="number" name="attr_loadlimitmod" style="text-align:center;" title="@{loadlimitmod}" value="0"/>
                </div>
                <div class="derivemod">
                  <input class="derivedStat" type="number" name="attr_loadlimit" title="@{loadlimit}" readonly="readonly"/>
                </div>
                <div class="derivecurrent">
                  <input class="derivedStat" type="number" name="attr_totalloadcarried" title="@{totalloadcarried}" readonly="readonly"/>
                </div>
                <div class="derivemisc">
                  <input class="derivedStat" type="number" name="attr_encumbrance" title="@{encumbrance}" value="0" readonly="readonly"/>
                </div>
              </div>
              <!-- config panel-->
              <details>
                <summary class="config">y</summary>
                <div class="loadconfig basetrait">
                  <label class="normallabel">
                    <input type="checkbox" name="attr_usekg" value="kg"/>&nbsp;<span data-i18n="use-kg">Use Kg instead of Pounds</span>
                  </label>
                  <select name="attr_encumbrancerules" title="@{encumbrancerules}">
                    <option value="0" title="@{encumberancerules}" data-i18n="ignore-encumbrance" selected="selected">Ignore Encumbrance</option>
                    <option value="1" title="@{encumberancerules}" data-i18n="use-savage-worlds-adventure-edition-abbr-u-encumbrance">Use SWADE Encumbrance</option>
                  </select>
                  <input class="encrules" type="hidden" name="attr_encumbrancerules" value="0"/>
                  <div class="swadeenc"><span data-i18n="dice-singular-type-delta">Die Type Delta</span>: 
                    <input class="modifier" type="number" name="attr_loadlimitdietypedelta" title="@{loadlimitmultiplier}" value="0"/>
                  </div>
                </div>
              </details>
            </div>
            <!--Gear Stuff--><!-- Consumables -->
            <input class="useConsumeables" type="hidden" name="attr_useconsumables" value="0"/>
            <div class="showconsumables">
              <h1 class="groupHeaderGear" data-i18n="consumables">Consumables</h1>
              <fieldset class="repeating_consumables">
                <div class="basederived">
                  <!-- Label-->
                  <div class="derivelabel consumables">
                    <button class="traitbutton smallskillflexattbutton consumablesbutton" type="roll" name="roll_ConsumbalesRoll" value="@{rollconsumables}"> <span class="statblock" name="attr_consumable"></span><span class="statblock">&nbsp;(</span><span class="statblock" name="attr_consumablestock"></span><span class="statblock">)</span></button>
                    <input class="derivedlabelinput consumableInput" type="text" name="attr_consumable" placeholder="Consumable" data-i18n-placeholder="consumable"/>
                    <input type="hidden" name="attr_consumablesmod" value="0"/>
                  </div>
                  <!-- Consumable Field-->
                  <select class="derivebaseplus" name="attr_consumablestock">
                    <option value="d0" data-i18n="empty">Empty</option>
                    <option value="d4">d4</option>
                    <option value="d6" selected="selected">d6</option>
                    <option value="d8">d8</option>
                    <option value="d10">d10</option>
                    <option value="d12">d12</option>
                  </select>
                  <input type="hidden" name="attr_rollconsumables" value="&amp;{template:consumables} {{name=@{character_name} }} {{consumable=@{consumable}}} {{roll=[[1@{consumablestock} + @{consumablesmod} + @{traitmods}]]}}"/>
                </div>
              </fieldset>
            </div>
            <h1 class="groupHeaderGear" data-i18n="gear">Gear</h1>
            <div class="base miscderived">
              <!-- Money-->
              <input class="usewealth hiddenInput" type="checkbox" name="attr_usewealth"/>
              <input class="useMultiCurrency" type="hidden" name="attr_moneyfields" value="1"/>
              <div class="basederived multiMoney moneyLabels">
                <div class="derivelabel money">&nbsp;</div>
                <div class="derivebase"><span name="attr_moneyonename"></span></div>
                <div class="derivemod"> <span name="attr_moneytwoname"> </span></div>
                <div class="derivecurrent money3"> <span name="attr_moneythreename"></span></div>
                <div class="derivemisc money4"> <span name="attr_moneyfourname"></span></div>
              </div>
              <div class="basederived nonwealth multiMoney">
                <!-- Label-->
                <div class="derivelabel money"><span name="attr_moneyname"></span></div>
                <!-- Money Fields-->
                <div class="derivebase"> <span class="statblock" name="attr_moneyonename"></span><span class="statblock">:&nbsp;</span>
                  <input class="derivedStat moneyfield" type="number" step="any" name="attr_money" title="@{money}" value="0"/>
                </div>
                <div class="derivemod additionalCurrency money2"><span class="statblock" name="attr_moneytwoname"></span><span class="statblock">:&nbsp;</span>
                  <input class="derivedStat" type="number" step="any" name="attr_money2" title="@{money2}" value="0"/>
                </div>
                <div class="derivecurrent additionalCurrency money3"><span class="statblock" name="attr_moneythreename"></span><span class="statblock">:&nbsp;</span>
                  <input class="derivedStat" type="number" step="any" name="attr_money3" title="@{money3}" value="0"/>
                </div>
                <div class="derivemisc additionalCurrency money4"><span class="statblock" name="attr_moneyfourname"></span><span class="statblock">:&nbsp;</span>
                  <input class="derivedStat" type="number" step="any" name="attr_money4" title="@{money4}" value="0"/>
                </div>
              </div>
              <div class="basederived usewealth">
                <!-- Label -->
                <div class="derivelabel wealth"> 
                  <button class="traitbutton deriveflexbutton" type="roll" name="roll_WealthRoll" value="@{rollwealth}"><span data-i18n="wealth"></span><span class="nonstatblock">:</span><span class="statblock">&nbsp;(</span><span class="statblock" name="attr_wealth"></span><span class="statblock">)</span></button>
                </div>
                <!-- Wealth Field-->
                <select class="derivebaseplus" name="attr_wealth">
                  <option value="d0" data-i18n="has-no-money">Broke</option>
                  <option value="d4" data-i18n="d4">d4</option>
                  <option value="d6" selected="selected" data-i18n="d6">d6</option>
                  <option value="d8" data-i18n="d8">d8</option>
                  <option value="d10" data-i18n="d10">d10</option>
                  <option value="d12" data-i18n="d12">d12</option>
                </select>
                <input class="useWealthMod hiddenInput" type="checkbox" name="attr_useWealthMod" value="1"/>
                <div class="derivebaseplus wealthmod">+ 
                  <input type="number" name="attr_wealthmod" value="0" style="text-align: center;"/>
                </div>
                <input type="hidden" name="attr_rollwealth" value="&amp;{template:roll} {{namelength=@{namelength}}} {{name=@{character_name} }} {{trait=^{wealth}}} {{skill_rank=@{wealth} }} {{skill_roll=[[1@{wealth}! + @{wealthmod} + @{traitmods}]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[ 1d@{wealthwilddie}! + @{wealthmod}[wealth mod] + @{traitmods}]]}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
              </div>
            </div>
            <div class="gear">
              <h4 class="item" data-i18n="item">Item</h4>
              <h4 class="itemqty" data-i18n="quantity-abbr">Qty</h4>
              <h4 class="itemweight" data-i18n="weight-abbr">Wt</h4>
              <h4 class="itemcarried" data-i18n="carried">Carried</h4>
              <fieldset class="repeating_gear">
                <div class="base gearRow gearList"><span class="statblock gearItem" name="attr_item"></span>
                  <input class="itemqty" type="hidden" value="1" name="attr_itemqty"/><span class="statblock openParens showQuantity">&nbsp;(</span><span class="statblock gearItem showQuantity" name="attr_itemqty"></span><span class="statblock showQuantity">)</span>
                  <input class="standard item" type="text" placeholder="Item" name="attr_item" title="@{repeating_gear_$#_item}"/>
                  <input class="standard itemqty" type="number" value="1" data-i18n-title="quantity" name="attr_itemqty"/>
                  <input class="itemweight" type="number" data-i18n-placeholder="weight" placeholder="weight" step="any" name="attr_itemWeight" title="@{repeating_gear_$#_itemWeight}"/>
                  <div class="itemcarried">
                    <label class="gearCarriedLabel">
                      <input class="gearitemCarried gearisCarried" type="checkbox" name="attr_itemcarried"/><span class="gearisCarriedIcon"></span>
                    </label>
                  </div>
                  <input type="hidden" name="attr_totalItemWeight" value="0"/>
                  <details> 
                    <summary class="config">y</summary>
                    <textarea name="attr_geardescription" title="@{repeating_gear_$#_itemdescription}" placeholder="Details" data-i18n-placeholder="details"></textarea>
                  </details>
                </div>
              </fieldset>
              <!--
              fieldset(class="repeating_gear")
                  div(class="base gearRow gearList")
                      input(type="text" class="standard item" placeholder="Item" name="attr_item" title="@{repeating_gear_$#_item}" ) 
                      input(type="number" class="standard itemqty" value="1" data-i18n-title="quantity" name="attr_itemqty" ) 
                      input(type="number" class="itemweight" data-i18n-placeholder="weight" placeholder="weight" step="any" name="attr_itemWeight" title="@{repeating_gear_$#_itemWeight}" ) 
                      div(class='itemcarried')
                          label(class="gearCarriedLabel")
                              input(type='checkbox' class='gearitemCarried gearisCarried' name='attr_itemcarried' ) 
                              span(class="gearisCarriedIcon")
                      input(type='hidden' name='attr_totalItemWeight' value='0' ) 
                      // input(class='moremods' type='checkbox' name='attr_showGearDesc' ) 
                      // span y 
                      details 
                          summary.config y
                          //div(class='basetrait traitmodplus')
                          textarea(name='attr_geardescription' title="@{repeating_gear_$#_itemdescription}" placeholder="Details" data-i18n-placeholder="details")
              --><!-- input(class="useLoad" type="checkbox" name="attr_useLoad" style="display:none;" checked )  -->
              <div class="gearTotalWeight loadstuff"><!-- Set up the Total Weight Carried box -->
                <h4 class="gearweightTotal"><span data-i18n="total-gear-weight-carried">Total Gear Weight Carried</span>:
                  <input class="gearitemweight" type="text" name="attr_geartotalweightcarried" title="@{geartotalweightcarried}" value="0" readonly="readonly"/>
                </h4>
              </div>
            </div><!-- End Load, Money, and Gear -->
          </div>
          <div class="triFold">
            <!--Logos-->
            <!--
            input(type="hidden" class="showLogo" value="SavageWorlds" name="attr_logo")
            img(class="logo PEG" src="https://raw.githubusercontent.com/finderski/SWT/master/PEG_LOGO_White.png")
            img(class="logo Deadlands" src="http://www.geeksville.us/roll20/Deadlands.png")
            img(class="logo SWADE" src="http://www.geeksville.us/roll20/SW_Logo_AE.png")
            -->
            <input class="showLogo" type="hidden" value="SavageWorlds" name="attr_logo"/><img class="logo PEG" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/PEG_LOGO_White.png"/><img class="logo Deadlands" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/Deadlands.png"/><img class="logo SWADE" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/SW_Logo_AE.png"/><img class="logo SWPF" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/PFforSW_logo9_square_smaller.png"/><img class="logo Rifts" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Official%20Savage%20Worlds/images/logos/Savage_Rifts_Logo.png"/><img class="logo Custom" name="attr_logoURL"/>
            <!--Right Column (Hindrances, Ancestry Abilities, Special Abilties, Edges/Advances)-->
            <input class="showconditions hiddenInput" type="checkbox" name="attr_showconditions" checked="checked"/>
            <div class="conditions">
              <div class="distracted">
                <label class="conditionlabel">
                  <input class="isdistracted" type="checkbox" value="-2" name="attr_distracted"/><span class="uhoh"></span><span class="conditionspan" data-i18n="distracted">Distracted</span>
                </label>
              </div>
              <div class="vulnerable">
                <label class="conditionlabel">
                  <input class="isvulnerable" type="checkbox" value="-2" name="attr_vulnerable"/><span class="uhoh"></span><span class="conditionspan" data-i18n="vulnerable">Vulnerable</span>
                </label>
              </div>
              <div class="stunned">
                <label class="conditionlabel">
                  <input class="isstunned" type="checkbox" value="-2" name="attr_stunned"/><span class="uhoh"></span><span class="conditionspan" data-i18n="stunned">Stunned</span>
                </label>
              </div>
            </div><!-- End Conditions -->
            <div class="health"><!-- Wounds -->
              <input class="hidden" type="number" name="attr_woundsRemaining"/>
              <div class="baseHealthTrait characterWounds">
                <input class="standardHealth" type="number" name="attr_wounds" title="@{wounds}" value="0"/>||
                <input class="standardHealth" type="number" name="attr_wounds_max" title="@{wounds_max}" value="3"/>
                <input class="showWoundmodCheck" type="checkbox" name="attr_showWoundmods" style="display: none;"/>
                <input type="hidden" name="attr_woundsMod" value="0"/>
                <button class="traitbutton deriveflexbutton woundLabelButton" type="action" name="act_woundButton"><span data-i18n="wounds">Wounds</span>&nbsp;<span class="cog">y</span></button>
              </div><!-- Shaken & Incapacitated -->
              <div class="base characterShakenInc">
                <div class="shakenbox" title="Shaken" data-i18n-title="shaken">
                  <input class="shaken" type="checkbox" name="attr_isShaken" value="1"/><span>!</span><span class="shakeninfo" data-i18n="shaken">Shaken</span>
                </div>
                <div class="incbox" title="Incapcitated" data-i18n-title="incapacitated">
                  <input class="inc" type="checkbox" name="attr_isinc"/><span>Y</span><span class="incinfo" data-i18n="incapacitated-abbr">Inc</span>
                </div>
              </div><!-- Fatigue -->
              <div class="base characterFatigue">
                <input class="standardHealth" type="number" name="attr_fatigue" title="@{fatigue}" value="0"/>||
                <input class="standardHealth" type="number" name="attr_fatigue_max" title="@{fatigue_max}" value="2"/>
                <input class="showFatiguemodCheck" type="checkbox" name="attr_showFatiguemods" style="display: none;"/>
                <input type="hidden" name="attr_fatigueMod" value="0"/>
                <button class="traitbutton deriveflexbutton fatigueLabelButton" type="action" name="act_fatigueButton"><span data-i18n="fatigue">Fatigue</span>&nbsp;<span class="cog">y</span></button>
              </div>
            </div><!-- Wound Config -->
            <input class="showWoundmod hiddenInput" type="checkbox" name="attr_showWoundmods"/>
            <div class="basetrait woundmod">
              <h4 class="configHeader" data-i18n="wounds-configuration">Wounds Configuration</h4>
              <div class="nerves">
                <label class="healthlabel" data-i18n="reduce" data-i18n-title="reduce-wound-penalty">Reduce</label>: 
                <input class="standardHealthInfo" type="text" name="attr_reducereason" data-i18n-title="edges-abilities-that-reduce-wound-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="amount-to-reduce-penalty-by" name="attr_reducewoundsby" value="0"/><br/>
                <label class="healthlabel" data-i18n="increase" data-i18n-title="increase-wound-penalty">Increase</label>: 
                <input class="standardHealthInfo" type="text" name="attr_increasereason" data-i18n-title="edges-abilities-that-increase-wound-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="amount-to-increase-penalty-by" name="attr_increasewoundsby" value="0"/><br/>
                <label class="healthlabel" data-i18n="maximum" data-i18n-title="maximum-wound-penalty">Maximum</label>: 
                <input class="standardHealthInfo" type="text" name="attr_maxreason" data-i18n-title="edges-abilities-that-cap-maximum-wound-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="maximum-wound-penalty-suffered" name="attr_maxwoundmods" value="-3"/>
              </div>
            </div><!-- Fatigue Config -->
            <input class="showFatiguemod" type="checkbox" name="attr_showFatiguemods" style="display: none;"/>
            <div class="basetrait fatiguemod">
              <h4 class="configHeader" data-i18n="fatigue-configuration">Fatigue Configuration</h4>
              <div class="nerves">
                <label class="healthlabel" data-i18n="reduce" data-i18n-title="reduce-fatigue-penalty">Reduce</label>: 
                <input class="standardHealthInfo" type="text" name="attr_fatiguereducereason" data-i18n-title="edges-abilities-that-reduce-fatigue-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="amount-to-reduce-penalty-by" name="attr_reducefatigueby" value="0"/><br/>
                <label class="healthlabel" data-i18n="increase" data-i18n-title="increase-fatigue-penalty">Increase</label>: 
                <input class="standardHealthInfo" type="text" name="attr_fatigueincreasereason" data-i18n-title="edges-abilities-that-increase-fatigue-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="amount-to-increase-penalty-by" name="attr_increasefatigueby" value="0"/><br/>
                <label class="healthlabel" data-i18n="maximum" data-i18n-title="maximum-fatigue-penalty">Maximum</label>: 
                <input class="standardHealthInfo" type="text" name="attr_fatiguemaxreason" data-i18n-title="edges-abilities-that-cap-maximum-fatigue-penalties" data-i18n-placeholder="edges-or-abilities"/>
                <input class="standardHealthMod" type="number" data-i18n-title="maximum-fatigue-penalty-suffered" name="attr_maxfatiguemods" value="-2"/>
              </div>
            </div><!-- Soak and Unshake Buttons -->
            <div class="recovery"><!-- Unshake Button -->
              <input class="useunshakebutton hiddenInput" type="checkbox" name="attr_showunshake" checked="checked"/>
              <div class="recovertrait unshakebutton">
                <button class="traitbutton skillflexattbutton unshake" type="roll" name="roll_unshakeroll" title="@{unshakeroll}" value="@{whisperunshake} &amp;{template:unshake} @{rolltunshake} {{mook=[[1d0+@{wdNum}]]}}">&nbsp;<span data-i18n="unshake">Unshake</span></button>
                <details>
                  <summary class="recoveryConfig">y</summary>
                  <div class="unshakemodplus">
                    <label class="whisperGM">
                      <input class="whispercheck" type="checkbox" name="attr_whisperunshake" value="/w gm"/>&nbsp;<span class="ModDesc" data-i18n="whisper-to-gm">Whisper to GM</span>
                    </label>
                    <input class="shortLabelInput" type="text" data-i18n-placeholder="standard-wild-die-type" name="attr_unshakewilddieinfo"/>
                    <select class="traitdie" name="attr_unshakewilddie" title="@{unshakewilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" selected="selected" data-i18n="d6">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select>
                    <input class="shortLabelInput" type="text" name="attr_unshakemodtype" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="recoveryMod" type="number" name="attr_unshakemod" value="0" title="@{unshakemod}"/><br/>
                  </div>
                </details>
                <input type="hidden" name="attr_rolltunshake" value="{{name=@{character_name} }} {{skill_roll=[[@{spirit_rank} [Spirit] + @{sprollMod} + @{unshakemod} [@{unshakemodtype}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods} + [[@{conviction}]]d6! [Conviction] ]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[ 1d@{unshakewilddie}! [Wild Die] + @{spiritmod} + @{sprollMod} + @{unshakemod} [@{unshakemodtype}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods} + [[@{conviction}]]d6! [Conviction] ]]}}"/>
              </div><!-- Soak Button -->
              <input class="usesoakbutton hiddenInput" type="checkbox" name="attr_showsoak" checked="checked"/>
              <div class="recovertrait soakbutton">
                <button class="traitbutton skillflexattbutton soak" type="roll" name="roll_soakroll" title="@{soakroll}" value="@{whispersoak} &amp;{template:roll} {{namelength=@{namelength}}} @{rolltSoak} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}">&nbsp;<span data-i18n="soak">Soak</span></button>
                <!--
                button(class="traitbutton skillflexattbutton soak" type='roll' name='roll_soakroll' title="@{soakroll}" value='@{whispersoak} &{template:roll} {{namelength=@{namelength}}} @{rolltSoak} @{setmods} @{showtraitmods} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}')
                    | &nbsp;
                    span(data-i18n="soak") Soak
                -->
                <details>
                  <summary class="recoveryConfig">y</summary>
                  <div class="soakmodplus">
                    <label class="whisperGM">
                      <input class="whispercheck" type="checkbox" name="attr_whispersoak" value="/w gm"/>&nbsp;<span class="ModDesc" data-i18n="whisper-to-gm">Whisper to GM</span>
                    </label>
                    <input class="shortLabelInput" type="text" name="attr_soakwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="standard-wild-die-type"/>
                    <select class="traitdie" name="attr_soakwilddie" title="@{soakwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" selected="selected" data-i18n="d6">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select>
                    <input class="shortLabelInput" type="text" name="attr_soakmodtype" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="recoveryMod" type="number" name="attr_soakmod" title="@{soakmod}" value="0"/><br/>
                  </div>
                </details>
                <input type="hidden" name="attr_rolltSoak" value="{{name=@{character_name} }} {{trait=^{soak}}} {{skill_rank=@{vigor_display}+@{soakmod} }} {{skill_roll=[[@{vigor_rank} [Vigor] + @{virollMod} + @{soakmod} [@{soakmodtype}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}]]}} {{mook=[[1d0+@{wdNum}]]}} {{wild_die=[[ 1d@{soakwilddie}! [Wild Die] + @{vigormod} + @{virollMod} + @{soakmod} [@{soakmodtype}] + @{ModSum}[Wounds, Fatigue, Distracted] + @{traitmods}]]}} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
              </div><!-- End Soak Button -->
            </div><!-- End Recover Section --><!-- Hindrances and Edges -->
            <h2 class="traitHeader" data-i18n="hindrances">Hindrances</h2>
            <div class="base hindrances">
              <input class="showMiniDisplay" type="checkbox" name="attr_miniDisplay" value="1"/>
              <fieldset class="repeating_hindrances">
                <div class="base hindrance">
                  <input class="whispercheck" type="checkbox" name="attr_whisperDeets" value="/w gm " style="display: none;"/>
                  <button class="hindranceOutput" type="roll" name="roll_tHindrance" value="@{whisperDeets} &amp;{template:info} {{name=@{character_name}}} {{type=Hindrance}} {{item=@{hindrance}}} {{description=@{hindrancedescription}}} {{theme=@{rolltemplate_theme}}}"><span class="whispericon"></span><span class="statblock hindranceName" name="attr_hindrance"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
                  <input class="hinfield" type="text" name="attr_hindrance" data-i18n-placeholder="hindrance" data-i18n-title="hindrance"/>
                  <input class="hintype" type="text" name="attr_hindranceType" data-i18n-title="hindrance-type" data-i18n-placeholder="type"/>
                  <input class="moreConfig hiddenInput" type="checkbox" name="attr_showHindraceDesc" checked="checked"/>
                  <label class="configCog">
                    <input class="moreConfig hiddenInput" type="checkbox" name="attr_showHindraceDesc" checked="checked"/>y
                  </label>
                  <div class="hindranceMods">
                    <input type="checkbox" name="attr_whisperDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-hindrance">Whisper Hindrance Description</span>
                    <textarea name="attr_hindrancedescription" title="@{repeating_hindrances_$#_hindrancedescription}" placeholder="Hindrance description/details" data-i18n-placeholder="hindrance-desc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <h2 class="traitHeader" data-i18n="edges-and-advances">Edges & Advances</h2>
            <div class="base edges">
              <fieldset class="repeating_edges">
                <div class="base edge">
                  <input class="whispercheck hiddenInput" type="checkbox" name="attr_whisperEdgeDeets" value="/w gm "/>
                  <button class="edgeOutput" type="roll" name="roll_tEdge" value="@{whisperEdgeDeets} &amp;{template:info} {{name=@{character_name}}} {{type=^{edge}}} {{item=@{edge}}} {{description=@{edgedescription}}} {{theme=@{rolltemplate_theme}}}"> <span class="whispericon"></span><span class="statblock hindranceName" name="attr_edge"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
                  <input class="edgefield" type="text" name="attr_edge" data-i18n-title="edge"/>
                  <input class="moreConfig hiddenInput" type="checkbox" name="attr_showEdgeDesc" checked="checked"/>
                  <label class="configCog">
                    <input class="moreConfig hiddenInput" type="checkbox" name="attr_showEdgeDesc" checked="checked"/>y
                  </label>
                  <div class="edgeMods">
                    <input type="checkbox" name="attr_whisperEdgeDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-edge">Whisper Edge Description</span><br/>
                    <div class="edgeTypeLabel"><span data-i18n="edge-acquired-from">Edge Acquired From</span></div>
                    <select class="edgeTypeDropdown" name="attr_tookat">
                      <option value="Racial" data-i18n="racial">Racial</option>
                      <option value="Creation" data-i18n="creation">Creation</option>
                      <option value="Advance" selected="selected" data-i18n="advance">Advance</option>
                      <option value="GM" data-i18n="gm-fiat-slash-other">GM Fiat/Other</option>
                    </select>
                    <textarea name="attr_edgedescription" title="@{repeating_edges_$#_edgedescription}" placeholder="Edge description/details" data-i18n-placeholder="edge-desc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <input class="showSpecAbilities" type="hidden" value="0" name="attr_showSpecAbilities"/>
            <h2 class="traitHeader specAbilities" data-i18n="special-abilities">Special Abilities </h2>
            <div class="base specAbilities">
              <fieldset class="repeating_specialabilities">
                <div class="base specialAbility">
                  <input class="whispercheck" style="display: none;" type="checkbox" name="attr_whisperSpecAbilityDeets" value="/w gm "/>
                  <button class="edgeOutput" type="roll" name="roll_tSpecAbilities" value="@{whisperSpecAbilityDeets} &amp;{template:info} {{name=@{character_name}}} {{type=^{special-ability}}} {{item=@{specialability}}} {{description=@{specialabilitydescription}}} {{theme=@{rolltemplate_theme}}}"><span class="whispericon"></span><span class="statblock hindranceName" name="attr_specialability"></span><span class="statblock hindranceComma">&nbsp;&nbsp;</span></button>
                  <input class="edgefield" type="text" name="attr_specialability" data-i18n-title="special-ability" data-i18n-placeholder="special-ability"/>
                  <input class="moreConfig hiddenInput" type="checkbox" name="attr_showSpecAbilityDesc" checked="checked"/>
                  <label class="configCog">
                    <input class="moreConfig hiddenInput" type="checkbox" name="attr_showSpecAbilityDesc" checked="checked"/>y
                  </label>
                  <div class="specialAbilityMods">
                    <input type="checkbox" name="attr_whisperSpecAbilityDeets" value="/w gm "/>&nbsp;<span data-i18n="whisper-special-ability-description">Whisper Special Ability Description</span><br/>
                    <textarea name="attr_specialabilitydescription" title="@{repeating_specialabilities_$#_specialabilitydescription}" data-i18n-placeholder="special-ability-description"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
          <!--Bottom "half" (span all three columns)-->
        </div>
        <div class="base bottomHalf">
          <label class="hideBtn">
            <input class="showHideBtn" type="checkbox" name="attr_hideWeapons" value="1"/><span class="showHideIcon"></span>
          </label>
          <h1 class="groupHeader weaponsSection" data-i18n="weapons">Weapons</h1>
          <input class="hideWeapons" type="hidden" name="attr_hideWeapons" value="0"/>
          <div class="weapons"><span class="weaponHeader weaponItem button">&nbsp;</span><span class="weaponHeader weaponItem weapon" data-i18n="weapon">Weapon</span><span class="weaponHeader weaponItem range" data-i18n="range">Range</span><span class="weaponHeader weaponItem damage" data-i18n="damage">Damage</span><span class="weaponHeader weaponItem weaponap" data-i18n="armor-piercing-abbr-u">AP</span><span class="weaponHeader weaponItem rof" data-i18n="rate-of-fire-abbr">ROF</span><span class="weaponHeader weaponItem shots" data-i18n="number-of-shots-shortened">Shots</span><span class="weaponHeader weaponItem weaponweight" data-i18n="weight-abbr">Wt</span><span class="weaponHeader weaponItem weaponcarried" data-i18n="carried">Carried</span>
            <hr class="weaponItem weapon-hr"/>
            <input type="hidden" name="attr_vbonusdamage" value="1d6"/>
            <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
            <!--
            input(class="AthleticsStaticSkill hiddenButton" type="checkbox" name="attr_staticAthletics")
            input(class="ShootingStaticSkill hiddenButton" type="checkbox" name="attr_staticShooting")
            input(class="WSStaticSkill hiddenButton" type="checkbox" name="attr_staticWeirdScience")
            
            -->
            <!--do stuff-->
            <input class="hiddenInput staticathletics" type="checkbox" name="attr_staticathletics"/>
            <!--do stuff-->
            <input class="hiddenInput staticfaith" type="checkbox" name="attr_staticfaith"/>
            <!--do stuff-->
            <input class="hiddenInput staticfighting" type="checkbox" name="attr_staticfighting"/>
            <!--do stuff-->
            <input class="hiddenInput staticfocus" type="checkbox" name="attr_staticfocus"/>
            <!--do stuff-->
            <input class="hiddenInput staticperformance" type="checkbox" name="attr_staticperformance"/>
            <!--do stuff-->
            <input class="hiddenInput staticpsionics" type="checkbox" name="attr_staticpsionics"/>
            <!--do stuff-->
            <input class="hiddenInput staticshooting" type="checkbox" name="attr_staticshooting"/>
            <!--do stuff-->
            <input class="hiddenInput staticspellcasting" type="checkbox" name="attr_staticspellcasting"/>
            <!--do stuff-->
            <input class="hiddenInput staticweirdscience" type="checkbox" name="attr_staticweirdscience"/>
            <input type="hidden" name="attr_vbonusdamage" value="1d6"/>
            <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
            <fieldset class="repeating_weapons" style="width: 100%;">
              <div class="weaponfull">
                <button class="weaponItem button" type="roll" name="roll_tWeapon" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-i18n="damage">Damage</span><span class="buttonma" data-i18n="multi-attack-and-damage-abbr">
                     Atk<sup>x</sup>+Dmg</span>
                </button>
                <button class="statblock miniButton" type="roll" name="roll_tWeapon2" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand crossedSwords">&#9876;&nbsp;</span><span class="buttondo dagger">&#128481;&nbsp;</span><span class="buttonma"> <span class="crossedSwords">&#9876;</span><span class="dagger">&#128481;</span>&nbsp;</span><span class="statblock" name="attr_weapon"></span><span class="statblock openParens">(</span>
                  <input class="weaponRange" type="hidden" name="attr_range"/><span class="statblock showRange">Range </span><span class="statblock showRange" name="attr_range"></span><span class="statblock showRange">, </span><span class="statblock damage" data-i18n="damage">Damage</span><span class="statblock" name="attr_weapondamage"></span><span class="statblock">)</span>
                </button>
                <button class="hiddenButton" type="roll" name="roll_dmg" value="@{damageOnly}"> </button>
                <button class="hiddenButton" type="roll" name="roll_weaponsbonusDamage" value="&amp;{template:bonusDamage} {{dieType=@{weaponsbdtnum}@{weaponsbdt}}} {{bonusDamage=[[@{vbonusdamage}!]]}}"> </button>
                <input class="weaponItem weapon" type="text" name="attr_weapon" title="@{repeating_weapons_$#_weapon}" data-i18n-placeholder="weapon" placeholder="Weapon"/>
                <input class="weaponItem range" type="text" name="attr_range" title="@{repeating_weapons_$#_range}" data-i18n-placeholder="range" placeholder="Range"/>
                <button class="weaponItem damage invisbutton" type="action" name="act_wdamage"> <span name="attr_weapondamage"> </span></button>
                <input type="hidden" name="attr_weapondamage" value="Str+1d4"/>
                <input class="weaponItem weaponap" type="number" name="attr_weaponap" title="@{repeating_weapons_$#_weaponap}"/>
                <input class="weaponItem rof" type="number" name="attr_rof" title="@{repeating_weapons_$#_rof}" data-i18n-placeholder="rate-of-fire-abbr" placeholder="ROF"/>
                <div class="weaponItem shots">
                  <input class="weaponshots" type="number" name="attr_shots" title="@{repeating_weapons_$#_shots}"/>&nbsp;of&nbsp;
                  <input class="weaponshots" type="number" name="attr_shots_max" title="@{repeating_weapons_$#_shots_max}"/>
                </div>
                <input class="weaponItem weaponweight" type="number" step="any" name="attr_weaponweight" title="@{repeating_weapons_$#_weaponweight}" data-i18n-placeholder="weight-abbr" placeholder="Wt"/>
                <!-- div(class='weaponItem weaponcarried')-->
                <label class="weaponItem weaponcarried">
                  <input class="itemCarried isCarried" type="checkbox" name="attr_weaponcarried" title="@{repeating_weapons_$#_weaponcarried}"/><span class="isCarriedIcon"> </span>
                </label>
                <input class="moreConfig hiddenInput" type="checkbox" name="attr_showweaponconfig" checked="checked"/>
                <label class="configCog">
                  <input class="moreConfig" type="checkbox" name="attr_showweaponconfig" checked="checked"/>y
                </label>
                <textarea class="weaponItem weaponnotes" name="attr_weaponnotes" title="@{repeating_weapons_$#_weaponnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
                <div class="weaponconfig">
                  <label class="configlabels configcheckbox"> 
                    <input type="checkbox" value="/w gm" name="attr_whisperweapon" title="@{repeating_weapons_$#_whisperweapon}"/>&nbsp;<span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span>
                  </label><br/>
                  <label class="configlabels" data-i18n="minimum-strength">Minimum Strength</label>
                  <input type="hidden" name="attr_minstrength" value="4"/>
                  <select class="dtype" name="attr_weaponminstrength" title="@{repeating_weapons_$#_minstrength}"> 
                    <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                    <option value="4" data-i18n="d4" selected="selected">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                  </select><br/>
                  <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                  <input class="showmultiattack" type="hidden" name="attr_showmulti" value="0"/>
                  <select class="weaponbutton" name="attr_weaponbutton" title="@{repeating_weapons_$#_weaponbutton}"> 
                    <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                    <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                    <option class="multiattack" value="2" data-i18n="multi-attack-and-damage-abbr">Atk^+Dmg</option>
                  </select>
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton"/>
                  <div class="weaponskill">
                    <label class="configlabels" data-i18n="skill">Skill</label>
                    <div class="container">
                      <div class="child">
                        <label class="ddmenu athletics"> 
                          <input class="select-radio athletics" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="athletics"/>&nbsp;<span name="attr_rathleticsname"></span>
                        </label>
                        <label class="ddmenu faith"> 
                          <input class="select-radio faith" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="faith"/>&nbsp;<span name="attr_rfaithname"></span>
                        </label>
                        <label class="ddmenu fighting"> 
                          <input class="select-radio fighting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="fighting"/>&nbsp;<span name="attr_rfightingname"></span>
                        </label>
                        <label class="ddmenu focus"> 
                          <input class="select-radio focus" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="focus"/>&nbsp;<span name="attr_rfocusname"></span>
                        </label>
                        <label class="ddmenu performance"> 
                          <input class="select-radio performance" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="performance"/>&nbsp;<span name="attr_rperformancename"></span>
                        </label>
                        <label class="ddmenu psionics"> 
                          <input class="select-radio psionics" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="psionics"/>&nbsp;<span name="attr_rpsionicsname"></span>
                        </label>
                        <label class="ddmenu shooting"> 
                          <input class="select-radio shooting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="shooting"/>&nbsp;<span name="attr_rshootingname"></span>
                        </label>
                        <label class="ddmenu spellcasting"> 
                          <input class="select-radio spellcasting" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="spellcasting"/>&nbsp;<span name="attr_rspellcastingname"></span>
                        </label>
                        <label class="ddmenu weirdscience"> 
                          <input class="select-radio weirdscience" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="weirdscience"/>&nbsp;<span name="attr_rweirdsciencename"></span>
                        </label>
                        <!--
                        label(class="ddmenu") 
                             input(type="radio" class="select-radio fighting" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="fighting" checked="checked")
                             | &nbsp;
                             span(name='attr_rfightingname') 
                        label(class="ddmenu athletics") 
                             input(type="radio" class="select-radio athletics" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="athletics")
                             | &nbsp;
                             span(name='attr_rathleticsname') 
                        label(class="ddmenu shooting") 
                             input(type="radio" class="select-radio shooting" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="shooting")
                             | &nbsp;
                             span(name='attr_rshootingname') 
                        label(class="ddmenu") 
                             input(type="radio" class="select-radio unskilled" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="unskilled")
                             | &nbsp;
                             span(data-i18n='unskilled') Unskilled
                        label(class="ddmenu weirdscience") 
                             input(type="radio" class="select-radio weirdscience" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="weirdscience")
                             | &nbsp;
                             span(name='attr_rweirdsciencename') 
                        
                        -->
                        <!--Manually add the stuff for Spirit, because it doesn't follow the pattern...-->
                        <label class="ddmenu spirit"> 
                          <input class="select-radio spirit" type="radio" name="attr_weaponskill" title="@{repeating_weapons_$#_weaponskill}" value="spirit"/>&nbsp;<span data-i18n="spirit">Spirit</span>
                        </label>
                        <input class="select-radio" type="hidden" name="attr_weaponskill" value="fighting"/>
                        <div class="athletics"><span name="attr_rathleticsname"></span></div>
                        <div class="faith"><span name="attr_rfaithname"></span></div>
                        <div class="fighting"><span name="attr_rfightingname"></span></div>
                        <div class="focus"><span name="attr_rfocusname"></span></div>
                        <div class="performance"><span name="attr_rperformancename"></span></div>
                        <div class="psionics"><span name="attr_rpsionicsname"></span></div>
                        <div class="shooting"><span name="attr_rshootingname"></span></div>
                        <div class="spellcasting"><span name="attr_rspellcastingname"></span></div>
                        <div class="weirdscience"><span name="attr_rweirdsciencename"></span></div>
                        <div class="spirit"><span data-i18n="spirit">Spirit</span></div>
                        <!--
                        div(class="fighting")
                             span(name='attr_rfightingname') 
                        div(class="athletics")
                             span(name='attr_rathleticsname') 
                        div(class="shooting")
                             span(name='attr_rshootingname') 
                        div(class="unskilled")
                             span(data-i18n='unskilled') Unskilled
                        div(class="weirdscience")
                             span(name='attr_rweirdsciencename') 
                        -->
                      </div>
                    </div>
                    <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                    <input type="text" placeholder="Trademark Weapon" data-i18n-placeholder="trademark-weapon" name="attr_weaponAttackBonusReason"/>)&nbsp; 
                    <input type="number" name="attr_weaponAttackBonus" value="0"/>
                  </div>
                  <div class="weapondamage">
                    <input class="highlight" type="checkbox" name="attr_highlightdamage" value="1" style="display: none;"/>
                    <label class="configlabels" data-i18n="damage">Damage</label>
                    <select class="weaponatt" name="attr_damageatt" title="@{repeating_weapons_$#_damageatt}"> 
                      <option value="na" data-i18n="not-applicable-abbr-u">N/A</option>
                      <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                      <option value="agility" data-i18n="agility">Agility</option>
                      <option value="smarts" data-i18n="smarts">Smarts</option>
                      <option value="spirit" data-i18n="spirit">Spirit</option>
                      <option value="vigor" data-i18n="vigor">Vigor</option>
                    </select>+
                    <input class="weaponnum" type="number" name="attr_dmgnumdice" title="@{repeating_weapons_$#_dmgnumdice}" style="text-align: right;" value="1"/>
                    <select class="dtype" name="attr_dmgdietype" title="@{repeating_weapons_$#_dmgdietype}"> 
                      <option value="d4!" data-i18n="d4">d4</option>
                      <option value="d6!" data-i18n="d6">d6</option>
                      <option value="d8!" data-i18n="d8">d8</option>
                      <option value="d10!" data-i18n="d10">d10</option>
                      <option value="d12!" data-i18n="d12">d12</option>
                      <option value="d20!" data-i18n="d20">d20</option>
                    </select>+
                    <input class="weaponnum" type="text" name="attr_dmgbonusnum" title="@{repeating_weapons_$#_dmgbonusnum}"/>
                  </div>
                  <div class="vbonusdamage">
                    <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                    <div class="numOfBonusDice"> 
                      <input type="number" name="attr_weaponsbdtnum" value="1"/>
                      <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                    </div>
                    <select class="dtype" name="attr_weaponsbdt" title="@{repeating_weapons_$#_weaponsbdt}"> 
                      <option value="d4" data-i18n="d4">d4</option>
                      <option value="d6" selected="selected" data-i18n="d6">d6</option>
                      <option value="d8" data-i18n="d8">d8</option>
                      <option value="d10" data-i18n="d10">d10</option>
                      <option value="d12" data-i18n="d12">d12</option>
                      <option value="d20" data-i18n="d20">d20</option>
                    </select>
                  </div>
                </div>
                <!-- Skill Formulae-->
                <input type="hidden" name="attr_weaponUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
                <!-- Fighting-->
                <input type="hidden" name="attr_weaponFightingFormula" value="@{fightingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponFightingWildDieFormula" value="@{fightingWildDieFormula}"/>
                <!-- Athletics-->
                <input type="hidden" name="attr_weaponAthleticsFormula" value="@{athleticsSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponAthleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
                <!-- Shooting-->
                <input type="hidden" name="attr_weaponShootingFormula" value="@{shootingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponShootingWildDieFormula" value="@{shootingWildDieFormula}"/>
                <!-- Weird Science-->
                <input type="hidden" name="attr_weaponWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
                <!-- Faith-->
                <input type="hidden" name="attr_weaponfaithFormula" value="@{faithSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponfaithWildDieFormula" value="@{faithWildDieFormula}"/>
                <!-- Focus-->
                <input type="hidden" name="attr_weaponfocusFormula" value="@{focusSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponfocusWildDieFormula" value="@{focusWildDieFormula}"/>
                <!-- Performance-->
                <input type="hidden" name="attr_weaponperformanceFormula" value="@{performanceSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponperformanceWildDieFormula" value="@{performanceWildDieFormula}"/>
                <!-- Psionics-->
                <input type="hidden" name="attr_weaponpsionicsFormula" value="@{psionicsSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponpsionicsWildDieFormula" value="@{psionicsWildDieFormula}"/>
                <!-- Spellcasting-->
                <input type="hidden" name="attr_weaponspellcastingFormula" value="@{spellcastingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponspellcastingWildDieFormula" value="@{spellcastingWildDieFormula}"/>
                <!-- Spirit-->
                <input type="hidden" name="attr_weaponspiritFormula" value="@{spiritRollFormula}"/>
                <input type="hidden" name="attr_weaponspiritWildDieFormula" value="@{spiritWildDieFormula}"/>
                <!-- Hidden Fields for the roll button(s), etc-->
                <input type="hidden" name="attr_weaponroll" value="@{damageOnly}"/>
                <!-- Used for Skill and Damage roll-->
                <input type="hidden" name="attr_skillNDamage" value="@{whisperweapon} &amp;{template:roll} {{namelength=@{namelength}}} {{trait=Fighting}} {{source=@{weapon}}} @{rolltFighting} {{skill_roll=&amp;{noerror} [[ @{weaponFightingFormula} ]]}} {{wild_die=[[ @{weaponFightingWildDieFormula} ]]}} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~repeating_weapons_tWeapon) }} {{DmgRoll=^{roll-damage}(~repeating_weapons_dmg) }} @{multiattack} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <!-- skillNDamage used to have @{rolltFighting}  right after {{source=@{weapon}}}-->
                <!-- Used for Multiattack-->
                <input type="hidden" name="attr_multiattack" value="0"/>
                <!-- Used for Damage Only-->
                <input type="hidden" name="attr_damageOnly" value="@{dmgTemplate}"/>
                <!-- Build the Damage Roll Template Info-->
                <!-- the damage formula-->
                <input type="hidden" name="attr_weapondmg" value="@{strength_rank}+1d4!"/>
                <!-- This will either equal @{vbonusdamage} (the default) or @{weaponsbdt}-->
                <input type="hidden" name="attr_weaponsbonusdmg" value="@{vbonusdamage}"/>
                <input type="hidden" name="attr_weaponsbonusDie" value="{{bonus_die=[[@{weaponsbonusdmg}!]]}}"/>
                <!-- how to call a button roll: ^{reroll-damage}(~repeating_weapons_dmg)-->
                <input type="hidden" name="attr_dmgTemplate" value="@{whisperweapon} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{weapon} }} {{dmg_rank=@{weapondamage}}} {{dmg_roll=[[@{weapondmg} + @{damagemods}]]}} @{weaponsbonusDie} {{showap=[[1d0+@{weaponap}]]}} {{ap=@{weaponap}}} {{notes=@{weaponnotes}}} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_weapons_dmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_weapons_grittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <button type="roll" style="display: none;" name="roll_grittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"> </button>
              </div>
            </fieldset>
            <!-- Set up the Total Weight Carried box-->
            <div class="weaponTotalWeight loadstuff">
              <!-- Protection (240px)-->
              <div class="weaponWeightCarried">
                 <h4 class="weight"><span data-i18n="total-weapon-weight-carried">Total Weapon Weight Carried</span>:</h4></div>
              <!--  Weight (60px)-->
              <div class="totalWeightBox"> 
                <input class="weaponweight" type="number" style="width:65px;" name="attr_weapontotalweightcarried" title="@{weapontotalweightcarried}" value="0" readonly="readonly"/>
              </div>
            </div>
          </div>
          <!-- End Weapons-->
          <hr class="sectionSeperator"/>
          <input class="hideArcanum" type="checkbox" name="attr_ArcanumTab" style="display: none;"/>
          <div class="arcanum">
            <label class="hideBtn">
              <input class="showHideBtn" type="checkbox" name="attr_hidepowers" value="1"/><span class="showHideIcon"></span>
            </label>
            <h1 class="groupHeader powerSection"><span name="attr_powerlabelplural"></span></h1>
            <div class="buttonright">
              <input type="hidden" name="attr_powerconfigindicator" value="x"/>
              <button class="configbutton" type="action" name="act_powersectionconfig"><span name="attr_powerconfigindicator"></span></button>
            </div>
            <!-- Config stuff-->
            <input class="showpowerconfig hiddenInput" type="checkbox" name="attr_showpowersectionconfig" value="show"/>
            <div class="powerconfig">
              <label class="powerconfiglabel"><span data-i18n="ab-section-header">Section Header: </span>
                <input type="text" name="attr_powerlabelplural" value="Powers"/>
              </label>
              <label class="powerconfiglabel"><span data-i18n="ab-column-header">Column Header: </span>
                <input type="text" name="attr_powerlabelsingular" value="Power"/>
              </label>
              <label class="powerconfiglabel"><span data-i18n="ab-pp">Power Points Abbreviation: </span>
                <input type="text" name="attr_ppabbr" value="PP" maxlength="8"/>
              </label>
              <hr/>
              <input class="showmultipleabs" type="hidden" name="attr_numberofabs" value="1"/>
              <label class="powerconfiglabel label1"><span data-i18n="ab-name">Arcane Background: </span>
                <input type="text" name="attr_ablabel" value="AB 1" maxlength="25"/>
              </label>
              <label class="powerconfiglabel label1"><span data-i18n="ab-pp-name">Power Points Label: </span>
                <input type="text" name="attr_ppelabel" value="Power Points" maxlength="30"/>
              </label>
              <label class="powerconfiglabel label2"><span data-i18n="ab-color-indicator">Arcane Background Indicator:</span>
                <div class="container">
                  <div class="child2">
                    <label class="abmenu white">
                      <input class="select-radio white" type="radio" name="attr_ab1color" value="white" checked="checked"/>&nbsp;
                    </label>
                    <label class="abmenu red">
                      <input class="select-radio red" type="radio" name="attr_ab1color" value="red"/>&nbsp;
                    </label>
                    <label class="abmenu blue">
                      <input class="select-radio blue" type="radio" name="attr_ab1color" value="blue"/>&nbsp;
                    </label>
                    <label class="abmenu green">
                      <input class="select-radio green" type="radio" name="attr_ab1color" value="green"/>&nbsp;
                    </label>
                    <label class="abmenu purple">
                      <input class="select-radio purple" type="radio" name="attr_ab1color" value="purple"/>&nbsp;
                    </label>
                    <input class="select-radio" type="hidden" name="attr_ab1color" value="white"/>
                    <div class="white">&nbsp;</div>
                    <div class="red">&nbsp;</div>
                    <div class="blue">&nbsp;</div>
                    <div class="green">&nbsp;</div>
                    <div class="purple">&nbsp;</div>
                  </div>
                </div>
              </label>
              <hr class="label2"/>
              <label class="powerconfiglabel label2"><span data-i18n="ab-name">Arcane Background: </span>
                <input type="text" name="attr_ablabel2" value="AB 2" maxlength="25"/>
              </label>
              <label class="powerconfiglabel label2"><span data-i18n="ab-pp-name">Power Points Label: </span>
                <input type="text" name="attr_pplabel2" value="Power Points" maxlength="30"/>
              </label>
              <label class="powerconfiglabel label2"><span data-i18n="ab-color-indicator">Arcane Background Indicator:</span>
                <div class="container">
                  <div class="child2">
                    <label class="abmenu white">
                      <input class="select-radio white" type="radio" name="attr_ab2color" value="white"/>&nbsp;
                    </label>
                    <label class="abmenu red">
                      <input class="select-radio red" type="radio" name="attr_ab2color" value="red" checked="checked"/>&nbsp;
                    </label>
                    <label class="abmenu blue">
                      <input class="select-radio blue" type="radio" name="attr_ab2color" value="blue"/>&nbsp;
                    </label>
                    <label class="abmenu green">
                      <input class="select-radio green" type="radio" name="attr_ab2color" value="green"/>&nbsp;
                    </label>
                    <label class="abmenu purple">
                      <input class="select-radio purple" type="radio" name="attr_ab2color" value="purple"/>&nbsp;
                    </label>
                    <input class="select-radio" type="hidden" name="attr_ab2color" value="red"/>
                    <div class="white">&nbsp;</div>
                    <div class="red">&nbsp;</div>
                    <div class="blue">&nbsp;</div>
                    <div class="green">&nbsp;</div>
                    <div class="purple">&nbsp;</div>
                  </div>
                </div>
                <!-- rest of the stuff in the label - won't work for the first one, though...-->
              </label>
              <hr class="label3"/>
              <label class="powerconfiglabel label3"><span data-i18n="ab-name">Arcane Background: </span>
                <input type="text" name="attr_ablabel3" value="AB 3" maxlength="25"/>
              </label>
              <label class="powerconfiglabel label3"><span data-i18n="ab-pp-name">Power Points Label: </span>
                <input type="text" name="attr_pplabel3" value="Power Points" maxlength="30"/>
              </label>
              <label class="powerconfiglabel label3"><span data-i18n="ab-color-indicator">Arcane Background Indicator:</span>
                <div class="container">
                  <div class="child2">
                    <label class="abmenu white">
                      <input class="select-radio white" type="radio" name="attr_ab3color" value="white"/>&nbsp;
                    </label>
                    <label class="abmenu red">
                      <input class="select-radio red" type="radio" name="attr_ab3color" value="red"/>&nbsp;
                    </label>
                    <label class="abmenu blue">
                      <input class="select-radio blue" type="radio" name="attr_ab3color" value="blue" checked="checked"/>&nbsp;
                    </label>
                    <label class="abmenu green">
                      <input class="select-radio green" type="radio" name="attr_ab3color" value="green"/>&nbsp;
                    </label>
                    <label class="abmenu purple">
                      <input class="select-radio purple" type="radio" name="attr_ab3color" value="purple"/>&nbsp;
                    </label>
                    <input class="select-radio" type="hidden" name="attr_ab3color" value="blue"/>
                    <div class="white">&nbsp;</div>
                    <div class="red">&nbsp;</div>
                    <div class="blue">&nbsp;</div>
                    <div class="green">&nbsp;</div>
                    <div class="purple">&nbsp;</div>
                  </div>
                </div>
                <!-- rest of the stuff in the label - won't work for the first one, though...-->
              </label>
              <hr class="label4"/>
              <label class="powerconfiglabel label4"><span data-i18n="ab-name">Arcane Background: </span>
                <input type="text" name="attr_ablabel4" value="AB 4" maxlength="25"/>
              </label>
              <label class="powerconfiglabel label4"><span data-i18n="ab-pp-name">Power Points Label: </span>
                <input type="text" name="attr_pplabel4" value="Power Points" maxlength="30"/>
              </label>
              <label class="powerconfiglabel label4"><span data-i18n="ab-color-indicator">Arcane Background Indicator:</span>
                <div class="container">
                  <div class="child2">
                    <label class="abmenu white">
                      <input class="select-radio white" type="radio" name="attr_ab4color" value="white"/>&nbsp;
                    </label>
                    <label class="abmenu red">
                      <input class="select-radio red" type="radio" name="attr_ab4color" value="red"/>&nbsp;
                    </label>
                    <label class="abmenu blue">
                      <input class="select-radio blue" type="radio" name="attr_ab4color" value="blue"/>&nbsp;
                    </label>
                    <label class="abmenu green">
                      <input class="select-radio green" type="radio" name="attr_ab4color" value="green" checked="checked"/>&nbsp;
                    </label>
                    <label class="abmenu purple">
                      <input class="select-radio purple" type="radio" name="attr_ab4color" value="purple"/>&nbsp;
                    </label>
                    <input class="select-radio" type="hidden" name="attr_ab4color" value="green"/>
                    <div class="white">&nbsp;</div>
                    <div class="red">&nbsp;</div>
                    <div class="blue">&nbsp;</div>
                    <div class="green">&nbsp;</div>
                    <div class="purple">&nbsp;</div>
                  </div>
                </div>
                <!-- rest of the stuff in the label - won't work for the first one, though...-->
              </label>
              <hr class="label5"/>
              <label class="powerconfiglabel label5"><span data-i18n="ab-name">Arcane Background: </span>
                <input type="text" name="attr_ablabel5" value="AB 5" maxlength="25"/>
              </label>
              <label class="powerconfiglabel label5"><span data-i18n="ab-pp-name">Power Points Label: </span>
                <input type="text" name="attr_pplabel5" value="Power Points" maxlength="30"/>
              </label>
              <label class="powerconfiglabel label5"><span data-i18n="ab-color-indicator">Arcane Background Indicator:</span>
                <div class="container">
                  <div class="child2">
                    <label class="abmenu white">
                      <input class="select-radio white" type="radio" name="attr_ab5color" value="white"/>&nbsp;
                    </label>
                    <label class="abmenu red">
                      <input class="select-radio red" type="radio" name="attr_ab5color" value="red"/>&nbsp;
                    </label>
                    <label class="abmenu blue">
                      <input class="select-radio blue" type="radio" name="attr_ab5color" value="blue"/>&nbsp;
                    </label>
                    <label class="abmenu green">
                      <input class="select-radio green" type="radio" name="attr_ab5color" value="green"/>&nbsp;
                    </label>
                    <label class="abmenu purple">
                      <input class="select-radio purple" type="radio" name="attr_ab5color" value="purple" checked="checked"/>&nbsp;
                    </label>
                    <input class="select-radio" type="hidden" name="attr_ab5color" value="purple"/>
                    <div class="white">&nbsp;</div>
                    <div class="red">&nbsp;</div>
                    <div class="blue">&nbsp;</div>
                    <div class="green">&nbsp;</div>
                    <div class="purple">&nbsp;</div>
                  </div>
                </div>
                <!-- rest of the stuff in the label - won't work for the first one, though...-->
              </label>
              <button class="addab" type="action" name="act_addab">+</button>
              <button class="removeab" type="action" name="act_removeab">#</button>
            </div>
            <input class="hidePowers" type="checkbox" name="attr_hidepowers" value="1"/>
            <div class="arcane">
              <input class="NoPP" type="checkbox" name="attr_NoPPRule" style="display: none;"/>
              <div class="powerpoints">
                <input class="showmultipleabs" type="hidden" name="attr_numberofabs" value="1"/>
                <!--each ab in numberOfABs+powerPointsConfig(`${ab}`)
                -->
                <input class="abcolor" type="hidden" name="attr_ab1color" value="white"/>
                <div class="ppcontainer label1">
                  <label class="ablabel"><span name="attr_ablabel"></span><span class="statblock">&nbsp;</span>
                  </label>
                  <div class="ppfields">
                    <input class="ppvalue" type="number" name="attr_PowerPoints" title="@{PowerPoints}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                    <input class="ppvalue" type="number" name="attr_PowerPoints_max" title="@{PowerPoints_max}" value="0"/>
                  </div>
                  <label class="abpplabel"><span name="attr_ppelabel"></span>
                  </label>
                </div>
                <input class="abcolor" type="hidden" name="attr_ab2color" value="red"/>
                <div class="ppcontainer label2">
                  <label class="ablabel"><span name="attr_ablabel2"></span><span class="statblock">&nbsp;</span>
                  </label>
                  <div class="ppfields">
                    <input class="ppvalue" type="number" name="attr_powerpoints2" title="@{powerpoints2}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                    <input class="ppvalue" type="number" name="attr_powerpoints2_max" title="@{powerpoints2_max}" value="0"/>
                  </div>
                  <label class="abpplabel"><span name="attr_pplabel2"></span>
                  </label>
                </div>
                <input class="abcolor" type="hidden" name="attr_ab3color" value="blue"/>
                <div class="ppcontainer label3">
                  <label class="ablabel"><span name="attr_ablabel3"></span><span class="statblock">&nbsp;</span>
                  </label>
                  <div class="ppfields">
                    <input class="ppvalue" type="number" name="attr_powerpoints3" title="@{powerpoints3}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                    <input class="ppvalue" type="number" name="attr_powerpoints3_max" title="@{powerpoints3_max}" value="0"/>
                  </div>
                  <label class="abpplabel"><span name="attr_pplabel3"></span>
                  </label>
                </div>
                <input class="abcolor" type="hidden" name="attr_ab4color" value="green"/>
                <div class="ppcontainer label4">
                  <label class="ablabel"><span name="attr_ablabel4"></span><span class="statblock">&nbsp;</span>
                  </label>
                  <div class="ppfields">
                    <input class="ppvalue" type="number" name="attr_powerpoints4" title="@{powerpoints4}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                    <input class="ppvalue" type="number" name="attr_powerpoints4_max" title="@{powerpoints4_max}" value="0"/>
                  </div>
                  <label class="abpplabel"><span name="attr_pplabel4"></span>
                  </label>
                </div>
                <input class="abcolor" type="hidden" name="attr_ab5color" value="purple"/>
                <div class="ppcontainer label5">
                  <label class="ablabel"><span name="attr_ablabel5"></span><span class="statblock">&nbsp;</span>
                  </label>
                  <div class="ppfields">
                    <input class="ppvalue" type="number" name="attr_powerpoints5" title="@{powerpoints5}" value="0"/><span data-i18n="of">&nbsp;of&nbsp;</span>
                    <input class="ppvalue" type="number" name="attr_powerpoints5_max" title="@{powerpoints5_max}" value="0"/>
                  </div>
                  <label class="abpplabel"><span name="attr_pplabel5"></span>
                  </label>
                </div>
              </div>
              <div class="powerrow">
                <h4 class="repeatingHeader spellOutput">&nbsp;</h4>
                <h4 class="repeatingHeader powerbutton">&nbsp;</h4>
                <h4 class="repeatingHeader power"><span name="attr_powerlabelsingular"></span></h4>
                <h4 class="repeatingHeader pp"><span name="attr_ppabbr"></span></h4>
                <h4 class="repeatingHeader powerrange" data-i18n="range">Range</h4>
                <h4 class="repeatingHeader powerdamage" data-i18n="damage">Damage</h4>
                <h4 class="repeatingHeader duration" data-i18n="duration">Duration</h4>
                <h4 class="repeatingHeader invested"><span name="attr_ppabbr"> </span> <span data-18n="invested">Invested</span></h4>
              </div>
              <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
              <input class="showmultipleabs" type="hidden" name="attr_numberofabs" value="1"/>
              <input class="AthleticsStaticSkill hiddenButton" type="checkbox" name="attr_staticAthletics"/>
              <input class="WSStaticSkill hiddenButton" type="checkbox" name="attr_staticWeirdScience"/>
              <input class="FaithStaticSkill hiddenButton" type="checkbox" name="attr_staticFaith"/>
              <input class="FocusStaticSkill hiddenButton" type="checkbox" name="attr_staticFocus"/>
              <input class="PerformanceStaticSkill hiddenButton" type="checkbox" name="attr_staticPerformance"/>
              <input class="PsionicsStaticSkill hiddenButton" type="checkbox" name="attr_staticPsionics"/>
              <input class="SpellcastingStaticSkill hiddenButton" type="checkbox" name="attr_staticSpellcasting"/>
              <input class="ab1color" type="hidden" name="attr_ab1color" value="white"/>
              <input class="ab2color" type="hidden" name="attr_ab2color" value="red"/>
              <input class="ab3color" type="hidden" name="attr_ab3color" value="blue"/>
              <input class="ab4color" type="hidden" name="attr_ab4color" value="green"/>
              <input class="ab5color" type="hidden" name="attr_ab5color" value="purple"/>
              <fieldset class="repeating_spells">
                <input type="hidden" name="attr_ablabsinit" value="0"/>
                <input class="powercolor" type="hidden" name="attr_powercolor" value="white"/>
                <div class="fullrow">
                  <div class="powerrow">
                    <div class="spellOutput">
                      <button class="hindranceOutput" type="roll" name="roll_spellinfo" value="&amp;{template:info} {{name=@{character_name}}} {{item=@{power}}} {{trappings=@{trappings}}} {{Notes=@{spellnotes}}} {{theme=@{rolltemplate_theme}}}"> <span class="whispericon">w</span></button>
                    </div>
                    <div class="powerbutton">
                      <button class="actualpowerbutton" type="roll" name="roll_tPower" value="@{spellroll}">
                        <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-18n="damage">Damage</span><span class="buttonsk" data-18n="skill">Cast</span>
                      </button>
                      <button class="statblock miniButton" type="roll" name="roll_tPower" value="@{spellroll}">
                        <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/><span class="buttonand">&#9876;</span><span class="buttondo">&#128481;</span><span class="buttonsk">&#128588;</span><span class="statblock" name="attr_power"></span>
                      </button>
                      <button class="hiddenButton" type="roll" name="roll_spelldmg" value="@{spelldamageOnly}"></button>
                      <button class="hiddenButton" type="roll" name="roll_spellsbonusDamage" value="&amp;{template:info} {{name=Bonus Damage}} {{item=@{spellsbdt}}} {{description=[[@{spellsbonusdmg}!]]}} {{theme=@{rolltemplate_theme}}}"></button>
                    </div>
                    <!-- div(class="power")-->
                    <input class="power" type="text" name="attr_power" title="@{repeating_spells_$#_power}" data-i18n-placeholder="power" placeholder="Power"/>
                    <!-- div(class='pp')-->
                    <input class="pp" type="text" name="attr_pp" title="@{repeating_spells_$#_pp}" data-i18n-placeholder="power-point-abbr-u" placeholder="PP"/>
                    <!-- div(class="powerrange")-->
                    <input class="powerrange" type="text" name="attr_powerrange" title="@{repeating_spells_$#_powerrange}" data-i18n-placeholder="range" placeholder="Range"/>
                    <div class="powerdamage">
                      <input type="hidden" name="attr_powerdamage"/>
                      <button class="invisbutton" type="action" name="act_sdamage"><span name="attr_powerdamage">&nbsp;</span></button>
                    </div>
                    <!-- div(class="duration")-->
                    <input class="duration" type="text" name="attr_powerduration" title="@{repeating_spells_$#_powerduration}" data-i18n-placeholder="duration" placeholder="Duration"/>
                    <!-- div(class="invested")-->
                    <input class="invested" type="text" name="attr_ppinvested" title="@{repeating_spells_$#_ppinvested}" data-i18n-placeholder="power-point-abbr-u-invested" placeholder="PP Invested"/>
                  </div>
                  <!-- input(class='morespell' type='checkbox' name='attr_showspellconfig' checked)-->
                  <!-- span y-->
                  <input class="morespell moreConfig" type="checkbox" name="attr_showspellconfig" checked="checked"/>
                  <label class="configCog">
                    <input class="moreConfig" type="checkbox" name="attr_showspellconfig" checked="checked"/>y
                  </label>
                  <textarea class="spelltrappings" name="attr_trappings" title="@{repeating_spells_$#_spelltrappings}" data-i18n-placeholder="trappings" placeholder="Trappings"></textarea>
                  <textarea class="spellnotes" name="attr_spellnotes" title="@{repeating_spells_$#_spellnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
                  <div class="spellconfig">
                    <div class="showabindicatorselection">
                      <label class="powerconfiglabel label1">Arcane Background Indicator:
                        <input type="hidden" name="attr_rptablabel" value="AB 1"/>
                        <input type="hidden" name="attr_rptab1color" value="white"/>
                        <input type="hidden" name="attr_rptablabel2" value="AB 2"/>
                        <input type="hidden" name="attr_rptab2color" value="red"/>
                        <input type="hidden" name="attr_rptablabel3" value="AB 3"/>
                        <input type="hidden" name="attr_rptab3color" value="blue"/>
                        <input type="hidden" name="attr_rptablabel4" value="AB 4"/>
                        <input type="hidden" name="attr_rptab4color" value="green"/>
                        <input type="hidden" name="attr_rptablabel5" value="AB 5"/>
                        <input type="hidden" name="attr_rptab5color" value="purple"/>
                        <div class="container">
                          <div class="child3">
                            <!--Look at using a mixin for this...-->
                            <label class="abmenu ab1">
                              <input class="select-radio ab1" type="radio" name="attr_powergroup" value="ab1" checked="checked"/><span class="powerdisplay" name="attr_rptablabel"></span>
                            </label>
                            <label class="abmenu ab2">
                              <input class="select-radio ab2" type="radio" name="attr_powergroup" value="ab2"/><span class="powerdisplay" name="attr_rptablabel2"></span>
                            </label>
                            <label class="abmenu ab3">
                              <input class="select-radio ab3" type="radio" name="attr_powergroup" value="ab3"/><span class="powerdisplay" name="attr_rptablabel3"></span>
                            </label>
                            <label class="abmenu ab4">
                              <input class="select-radio ab4" type="radio" name="attr_powergroup" value="ab4"/><span class="powerdisplay" name="attr_rptablabel4"></span>
                            </label>
                            <label class="abmenu ab5">
                              <input class="select-radio ab5" type="radio" name="attr_powergroup" value="ab5"/><span class="powerdisplay" name="attr_rptablabel5"></span>
                            </label>
                            <input class="select-radio" type="hidden" name="attr_powergroup" value="ab1"/>
                            <div class="ab1"><span name="attr_rptablabel"></span></div>
                            <div class="ab2"><span name="attr_rptablabel2"></span></div>
                            <div class="ab3"><span name="attr_rptablabel3"></span></div>
                            <div class="ab4"><span name="attr_rptablabel4"></span></div>
                            <div class="ab5"><span name="attr_rptablabel5"></span></div>
                          </div>
                        </div>
                      </label>
                    </div>
                    <label class="configlabels configcheckbox">
                      <input type="checkbox" value="/w gm" name="attr_whisperspell" title="@{repeating_spells_$#_whisperspell}"/><span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    </label>
                    <label class="configlabels configcheckbox">
                      <input type="checkbox" name="attr_shownotes" value="{{notes=@{spellnotes}}}"/>&nbsp;<span data-i18n="show-notes-with-roll">Show notes with roll</span>
                    </label>
                    <hr class="modsection"/>
                    <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                    <select class="spellbutton" name="attr_spellbutton" title="@{repeating_spells_$#_spellbutton}">
                      <option value="2" data-i18n="skill-only">Skill Only</option>
                      <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                      <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                    </select>
                    <input class="spellbutton" type="hidden" name="attr_spellbutton" value="1"/>
                    <div class="spellskill">
                      <label class="configlabels" data-i18n="trait">Trait</label>
                      <div class="container">
                        <div class="child">
                          <label class="ddmenu athletics">
                            <input class="select-radio athletics" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="athletics"/>&nbsp;<span name="attr_sathleticsname"></span>
                          </label>
                          <label class="ddmenu faith">
                            <input class="select-radio faith" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="faith"/>&nbsp;<span name="attr_sfaithname"></span>
                          </label>
                          <label class="ddmenu focus">
                            <input class="select-radio focus" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="focus"/>&nbsp;<span name="attr_sfocusname"></span>
                          </label>
                          <label class="ddmenu performance">
                            <input class="select-radio performance" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="performance"/>&nbsp;<span name="attr_sperformancename"></span>
                          </label>
                          <label class="ddmenu psionics">
                            <input class="select-radio psionics" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="psionics"/>&nbsp;<span name="attr_spsionicsname"></span>
                          </label>
                          <label class="ddmenu spellcasting">
                            <input class="select-radio spellcasting" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="spellcasting"/>&nbsp;<span name="attr_sspellcastingname"></span>
                          </label>
                          <label class="ddmenu spirit">
                            <input class="select-radio spirit" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="spirit"/>&nbsp;<span data-i18n="spirit"></span>
                          </label>
                          <label class="ddmenu weirdscience">
                            <input class="select-radio weirdscience" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="weirdscience"/>&nbsp;<span name="attr_sweirdsciencename"></span>
                          </label>
                          <label class="ddmenu">
                            <input class="select-radio unskilled" type="radio" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="unskilled" checked="checked"/>&nbsp;<span data-i18n="unskilled">Unskilled</span>
                          </label>
                          <input class="select-radio " type="hidden" name="attr_spellskill" value="unskilled"/>
                          <div class="athletics"><span name="attr_sathleticsname"></span></div>
                          <div class="faith"><span name="attr_sfaithname"></span></div>
                          <div class="focus"><span name="attr_sfocusname"></span></div>
                          <div class="performance"><span name="attr_sperformancename"></span></div>
                          <div class="psionics"><span name="attr_spsionicsname"></span></div>
                          <div class="spellcasting"><span name="attr_sspellcastingname"></span></div>
                          <div class="spirit"><span data-i18n="spirit"></span></div>
                          <div class="weirdscience"><span name="attr_sweirdsciencename"></span></div>
                          <div class="unskilled"><span data-i18n="unskilled">Unskilled</span></div>
                        </div>
                      </div>
                      <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                      <input type="text" placeholder="Magic Item" data-i18n-placeholder="magic-item" name="attr_spellAttackBonusReason"/>)&nbsp; 
                      <input class="numberFormat" type="text" name="attr_spellAttackBonus" value="0"/>
                    </div>
                    <div class="spelldamage">
                      <input class="highlight" type="checkbox" name="attr_shighlightdamage" value="1" style="display:none;"/>
                      <label class="configlabels" data-i18n="damage">Damage</label>
                      <select class="spellatt" name="attr_spelldamageatt" title="@{repeating_spells_$#_spelldamageatt}">
                        <option value="na" data-i18n="not-applicable-abbr-u" selected="selected">N/A</option>
                        <option value="strength" data-i18n="strength">Strength</option>
                        <option value="agility" data-i18n="agility">Agility</option>
                        <option value="smarts" data-i18n="smarts">Smarts</option>
                        <option value="spirit" data-i18n="spirit">Spirit</option>
                        <option value="vigor" data-i18n="vigor">Vigor</option>
                      </select>+
                      <input class="spellnum" type="number" name="attr_spelldmgnumdice" title="@{repeating_spells_$#_spelldmgnumdice}" style="text-align: right;" value="2"/>
                      <select class="dtype" name="attr_spelldmgdietype" title="@{repeating_spells_$#_spelldmgdietype}">
                        <option value="d4!" data-i18n="d4">d4</option>
                        <option value="d6!" selected="selected" data-i18n="d6">d6</option>
                        <option value="d8!" data-i18n="d8">d8</option>
                        <option value="d10!" data-i18n="d10">d10</option>
                        <option value="d12!" data-i18n="d12">d12</option>
                        <option value="d20!" data-i18n="d20">d20</option>
                      </select>+
                      <input class="spellnum" type="text" name="attr_spelldmgbonusnum" title="@{repeating_spells_$#_spelldmgbonusnum}" value="0"/>
                    </div>
                    <div class="vbonusdamage">
                      <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                      <div class="numOfBonusDice"> 
                        <input type="number" name="attr_spellsbdtnum" value="1"/>
                        <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                      </div>
                      <select class="dtype" name="attr_spellsbdt" title="@{repeating_spells_$#_spellsbdt}">
                        <option value="d4" data-i18n="d4">d4</option>
                        <option value="d6" selected="selected" data-i18n="d6">d6</option>
                        <option value="d8" data-i18n="d8">d8</option>
                        <option value="d10" data-i18n="d10">d10</option>
                        <option value="d12" data-i18n="d12">d12</option>
                        <option value="d20" data-i18n="d20">d20</option>
                      </select>
                    </div>
                    <input type="hidden" name="attr_spellroll" value="@{spelldamageOnly}"/>
                    <!-- Used for Skill and Damage Roll-->
                    <input type="hidden" name="attr_spellskillNDamage"/>
                    <!-- Used for Damage Only-->
                    <input type="hidden" name="attr_spelldamageOnly" value="@{spelldmgTemplate}"/>
                    <!-- Used for Skill Only-->
                    <input type="hidden" name="attr_skillOnly" value="@{skTemplate}"/>
                    <!-- Skill Formulae-->
                    <!--Future work, collapse this into another mixin where all I need to do is supply the traits-->
                    <input type="hidden" name="attr_spellUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
                    <input type="hidden" name="attr_spellathleticsFormula" value="@{athleticsSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellathleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
                    <input type="hidden" name="attr_spellfaithFormula" value="@{faithSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellfaithWildDieFormula" value="@{faithWildDieFormula}"/>
                    <input type="hidden" name="attr_spellfocusFormula" value="@{focusSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellfocusWildDieFormula" value="@{focusWildDieFormula}"/>
                    <input type="hidden" name="attr_spellperformanceFormula" value="@{performanceSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellperformanceWildDieFormula" value="@{performanceWildDieFormula}"/>
                    <input type="hidden" name="attr_spellpsionicsFormula" value="@{psionicsSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellpsionicsWildDieFormula" value="@{psionicsWildDieFormula}"/>
                    <input type="hidden" name="attr_spellspellcastingFormula" value="@{spellcastingSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellspellcastingWildDieFormula" value="@{spellcastingWildDieFormula}"/>
                    <input type="hidden" name="attr_spellspiritFormula" value="@{spiritRollFormula}"/>
                    <input type="hidden" name="attr_spellspiritWildDieFormula" value="@{spiritWildDieFormula}"/>
                    <input type="hidden" name="attr_spellWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
                    <input type="hidden" name="attr_spellWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
                    <!-- Build the Damage Roll Template Info-->
                    <!--damage formula-->
                    <input type="hidden" name="attr_spelldmg"/>
                    <input type="hidden" name="attr_spellsbonusdmg" value="@{vbonusdamage}"/>
                    <input type="hidden" name="attr_spellsbonusDie" value="{{bonus_die=[[@{spellsbonusdmg}!]]}}"/>
                    <input type="text" style="display: none;" name="attr_spelldmgTemplate" value="@{whisperspell} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{power} }} {{trappings=@{trappings}}} {{dmg_rank=@{powerdamage}}} {{dmg_roll=[[@{spelldmg} + @{damagemods}]]}} @{spellsbonusDie} @{dmgshownotes} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_spells_spelldmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_spells_spellgrittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                    <input type="hidden" name="attr_skTemplate" value="1d6!"/>
                    <input type="hidden" name="attr_dmgshownotes" value="{{notes=@{spellnotes}}}"/>
                    <button type="roll" style="display: none;" name="roll_spellgrittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"></button>
                  </div>
                  <input class="spellconfigb" type="checkbox" name="attr_showspellconfig" style="display:none;" checked="checked"/>
                </div>
              </fieldset>
              <!--
              fieldset(class='repeating_spells')
                  input(type="hidden" name="attr_ablabsinit" value="0")
                  input(type="hidden" class="powercolor" name="attr_powercolor" value="white")
                  div(class='fullrow')
                      div(class='powerrow')
                          div(class="spellOutput")
                              button(type="roll" name="roll_spellinfo" class="hindranceOutput" value="&{template:info} {{name=@{character_name}}} {{item=@{power}}} {{trappings=@{trappings}}} {{Notes=@{spellnotes}}} {{theme=@{rolltemplate_theme}}}") w
                          
                          div(class="powerbutton")
                              button(class="actualpowerbutton" type='roll' name='roll_tPower' value="@{spellroll}")
                                  input(type="hidden" name="attr_spellbutton" class="spellbutton" value="1")
                                  span(class="buttonand" data-i18n="attack-and-damage-abbr") Atk+Dmg
                                  span(class="buttondo" data-18n="damage") Damage
                                  span(class="buttonsk" data-18n="skill") Cast
                              button(type='roll' class='hiddenButton' name='roll_spelldmg' value='@{spelldamageOnly}')
                              button(type='roll' class='hiddenButton' name='roll_spellsbonusDamage' value='&{template:info} {{name=Bonus Damage}} {{item=@{spellsbdt}}} {{description=[[@{spellsbonusdmg}!]]}} {{theme=@{rolltemplate_theme}}}')
                          
                          // div(class="power")
                          input(class='power' type='text' name='attr_power' title="@{repeating_spells_$#_power}" data-i18n-placeholder='power' placeholder="Power")
                          
                          // div(class='pp')
                          input(class='pp' type='text' name='attr_pp' title="@{repeating_spells_$#_pp}" data-i18n-placeholder='power-point-abbr-u' placeholder="PP")
                          
                          // div(class="powerrange")
                          input(class='powerrange' type='text' name='attr_powerrange' title="@{repeating_spells_$#_powerrange}" data-i18n-placeholder='range' placeholder="Range")
                          
                          div(class="powerdamage")
                              input(type='hidden' name='attr_powerdamage')
                              button(type="action" name="act_sdamage" class="invisbutton")
                                  span(name="attr_powerdamage")
                                      | &nbsp;
                          
                          // div(class="duration")
                          input(class='duration' type='text' name='attr_powerduration' title="@{repeating_spells_$#_powerduration}" data-i18n-placeholder='duration' placeholder="Duration")
                          
                          // div(class="invested")
                          input(class='invested' type='text' name='attr_ppinvested' title="@{repeating_spells_$#_ppinvested}" data-i18n-placeholder='power-point-abbr-u-invested' placeholder="PP Invested")
                          
                      // input(class='morespell' type='checkbox' name='attr_showspellconfig' checked)
                      // span y
                      input(type='checkbox' class='morespell moreConfig' name='attr_showspellconfig' checked)
                      label.configCog
                          input(class='moreConfig' type='checkbox' name='attr_showspellconfig' checked)
                          | y
                      textarea(name="attr_trappings" class='spelltrappings' title="@{repeating_spells_$#_spelltrappings}" data-i18n-placeholder="trappings" placeholder="Trappings")
                      textarea(name='attr_spellnotes' class='spellnotes' title="@{repeating_spells_$#_spellnotes}" data-i18n-placeholder="notes" placeholder="Notes")
                      div(class="spellconfig")
                          div(class="showabindicatorselection")
                              label(class="powerconfiglabel label1") Arcane Background Indicator:
                                  input(type="hidden" name="attr_rptablabel" value="AB 1")
                                  input(type="hidden" name="attr_rptab1color" value="white")
                                  input(type="hidden" name="attr_rptablabel2" value="AB 2")
                                  input(type="hidden" name="attr_rptab2color" value="red")
                                  input(type="hidden" name="attr_rptablabel3" value="AB 3")
                                  input(type="hidden" name="attr_rptab3color" value="blue")
                                  input(type="hidden" name="attr_rptablabel4" value="AB 4")
                                  input(type="hidden" name="attr_rptab4color" value="green")
                                  input(type="hidden" name="attr_rptablabel5" value="AB 5")
                                  input(type="hidden" name="attr_rptab5color" value="purple")
                                  div(class="container")
                                      div(class="child3")
                                          //Look at using a mixin for this...
                                          label(class="abmenu ab1")
                                              input(type="radio" class="select-radio ab1" name="attr_powergroup" value="ab1" checked="checked")
                                              span(class="powerdisplay" name="attr_rptablabel")
                                          label(class="abmenu ab2")
                                              input(type="radio" class="select-radio ab2" name="attr_powergroup" value="ab2")
                                              span(class="powerdisplay" name="attr_rptablabel2")
                                          label(class="abmenu ab3")
                                              input(type="radio" class="select-radio ab3" name="attr_powergroup" value="ab3")
                                              span(class="powerdisplay" name="attr_rptablabel3")
                                          label(class="abmenu ab4")
                                              input(type="radio" class="select-radio ab4" name="attr_powergroup" value="ab4")
                                              span(class="powerdisplay" name="attr_rptablabel4")
                                          label(class="abmenu ab5")
                                              input(type="radio" class="select-radio ab5" name="attr_powergroup" value="ab5")
                                              span(class="powerdisplay" name="attr_rptablabel5")
                                          input(type="hidden" class="select-radio" name="attr_powergroup" value="ab1")
                                          div(class="ab1")
                                              span(name="attr_rptablabel")
                                          div(class="ab2")
                                              span(name="attr_rptablabel2")
                                          div(class="ab3")
                                              span(name="attr_rptablabel3")
                                          div(class="ab4")
                                              span(name="attr_rptablabel4")
                                          div(class="ab5")
                                              span(name="attr_rptablabel5")
                          
                          label(class="configlabels configcheckbox")
                              input(type='checkbox' value='/w gm' name='attr_whisperspell' title="@{repeating_spells_$#_whisperspell}") 
                              span(data-i18n="whisper-roll-to-gm") Whisper roll to GM
                              br
                          label(class="configlabels configcheckbox")
                              input(type="checkbox" name="attr_shownotes" value="{{notes=@{spellnotes}}}") 
                              | &nbsp;
                              span(data-i18n="show-notes-with-roll") Show notes with roll
                          hr.modsection
                          label(class="configlabels" data-i18n="button-behavior") Button Behavior
                          select(name="attr_spellbutton" title="@{repeating_spells_$#_spellbutton}" class="spellbutton")
                              option(value="2" data-i18n="skill-only") Skill Only
                              option(value="0" data-i18n="attack-and-damage-abbr") Atk + Dmg
                              option(value="1" data-i18n="damage-only" selected) Damage Only
                          input(class="spellbutton" type="hidden" name="attr_spellbutton" value="1")
                          div(class='spellskill')
                              label(class="configlabels" data-i18n="skill") Skill
                              div(class="container")
                                  div(class="child")
                                      label(class="ddmenu athletics")
                                          input(type="radio" class="select-radio athletics" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="athletics") 
                                          | &nbsp;
                                          span(name='attr_sathleticsname')
                                      label(class="ddmenu faith")
                                          input(type="radio" class="select-radio faith" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="faith") 
                                          | &nbsp;
                                          span(name='attr_sfaithname')
                                      label(class="ddmenu focus")
                                          input(type="radio" class="select-radio focus" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="focus") 
                                          | &nbsp;
                                          span(name='attr_sfocusname')
                                      label(class="ddmenu performance")
                                          input(type="radio" class="select-radio performance" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="performance") 
                                          | &nbsp;
                                          span(name='attr_sperformancename')
                                      label(class="ddmenu psionics")
                                          input(type="radio" class="select-radio psionics" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="psionics") 
                                          | &nbsp;
                                          span(name='attr_spsionicsname')
                                      label(class="ddmenu spellcasting")
                                          input(type="radio" class="select-radio spellcasting" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="spellcasting") 
                                          | &nbsp;
                                          span(name='attr_sspellcastingname')
                                      label(class="ddmenu weirdscience")
                                          input(type="radio" class="select-radio weirdscience" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="weirdscience") 
                                          | &nbsp;
                                          span(name='attr_sweirdsciencename')
                                      label(class="ddmenu")
                                          input(type="radio" class="select-radio unskilled" name="attr_spellskill" title="@{repeating_spells_$#_spellskill}" value="unskilled" checked) 
                                          | &nbsp;
                                          span(data-i18n='unskilled') Unskilled
                                      input(type="hidden" class="select-radio " name="attr_spellskill" value="unskilled")
                                      div(class="athletics")
                                          span(name='attr_sathleticsname')
                                      div(class="faith")
                                          span(name='attr_sfaithname')
                                      div(class="focus")
                                          span(name='attr_sfocusname')
                                      div(class="performance")
                                          span(name='attr_sperformancename')
                                      div(class="psionics")
                                          span(name='attr_spsionicsname')
                                      div(class="spellcasting")
                                          span(name='attr_sspellcastingname')
                                      div(class="weirdscience")
                                          span(name='attr_sweirdsciencename')
                                      div(class="unskilled")
                                          span(data-i18n='unskilled') Unskilled
                          div(class='spelldamage')
                              input(type="checkbox" name="attr_shighlightdamage" class="highlight" value="1" style="display:none;")
                              label(class='configlabels' data-i18n="damage") Damage
                              select(class='spellatt' name="attr_spelldamageatt" title="@{repeating_spells_$#_spelldamageatt}")
                                  option(value="na" data-i18n="not-applicable-abbr-u" selected) N/A
                                  option(value="strength" data-i18n="strength") Strength
                                  option(value="agility" data-i18n="agility") Agility
                                  option(value="smarts" data-i18n="smarts") Smarts
                                  option(value="spirit" data-i18n="spirit") Spirit
                                  option(value="vigor" data-i18n="vigor") Vigor
                              | +
                              input(type="number" class="spellnum" name="attr_spelldmgnumdice" title="@{repeating_spells_$#_spelldmgnumdice}" style="text-align: right;" value="2")
                              select(name="attr_spelldmgdietype" title="@{repeating_spells_$#_spelldmgdietype}" class="dtype")
                                  option(value="d4!" data-i18n="d4") d4
                                  option(value="d6!" selected data-i18n="d6") d6
                                  option(value="d8!" data-i18n="d8") d8
                                  option(value="d10!" data-i18n="d10") d10
                                  option(value="d12!" data-i18n="d12") d12
                                  option(value="d20!" data-i18n="d20") d20
                              | +
                              input(type="text" class="spellnum" name="attr_spelldmgbonusnum" title="@{repeating_spells_$#_spelldmgbonusnum}" value="0")
                          
                          div(class="vbonusdamage")
                              label(class='configlabels' data-i18n="bonus-damage-die-type") Bonus Damage Die Type
                              select(name="attr_spellsbdt" title="@{repeating_spells_$#_spellsbdt}" class="dtype")
                                  option(value="d4" data-i18n="d4") d4
                                  option(value="d6" selected data-i18n="d6") d6
                                  option(value="d8" data-i18n="d8") d8
                                  option(value="d10" data-i18n="d10") d10
                                  option(value="d12" data-i18n="d12") d12
                                  option(value="d20" data-i18n="d20") d20
                          input(type='hidden' name='attr_spellroll' value='@{spelldamageOnly}')
                          // Used for Skill and Damage Roll
                          input(type='hidden' name='attr_spellskillNDamage')
                          // Used for Damage Only
                          input(type='hidden' name='attr_spelldamageOnly' value='@{spelldmgTemplate}')
                          // Used for Skill Only
                          input(type='hidden' name='attr_skillOnly' value='@{skTemplate}') 
              
                          // Skill Formulae
                          input(type="hidden" name="attr_spellWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}")
                          input(type="hidden" name="attr_spellWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}")
              
                          input(type="hidden" placeholder="Trademark Weapon" data-i18n-placeholder="trademark-weapon" name="attr_spellAttackBonusReason" value="Placeholder")
                          input(type="hidden" name="attr_spellAttackBonus" value="0")
              
                          // Build the Damage Roll Template Info
                          //damage formula
                          input(type='hidden' name='attr_spelldmg')
                          input(type='hidden' name='attr_spellsbonusdmg' value='@{vbonusdamage}')
                          input(type='hidden' name='attr_spellsbonusDie' value='{{bonus_die=[[@{spellsbonusdmg}!]]}}') 
                          input(type='text' style='display: none;' name='attr_spelldmgTemplate' value='@{whisperspell} &{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{power} }} {{trappings=@{trappings}}} {{dmg_rank=@{powerdamage}}} {{dmg_roll=[[@{spelldmg} + @{damagemods}]]}} @{spellsbonusDie} @{dmgshownotes} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_spells_spelldmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_spells_spellgrittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}')
                          input(type='hidden' name='attr_skTemplate' value='1d6!') 
                          input(type='hidden' name='attr_dmgshownotes' value='{{notes=@{spellnotes}}}')
                          button(type='roll' style='display: none;' name='roll_spellgrittyroll' value='&{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}')
                      
                      input(class='spellconfigb' type='checkbox' name='attr_showspellconfig' style="display:none;" checked)
              -->
            </div>
          </div>
        </div>
        <div class="base bottomArmorAndShields">
          <!--Armor and Shields-->
          <div class="armorHalf">
            <label class="hideBtn armorHideBtn">
              <input class="showHideBtn" type="checkbox" name="attr_hideArmor"/><span class="showHideIcon"> </span>
            </label>
            <h1 class="groupHeader armorSection" data-i18n="armor">Armor</h1>
            <input class="hiddenInput hideArmor" type="checkbox" name="attr_hideArmor"/>
            <div class="armor">
              <h4 class="repeatingHeader armorWorn" data-i18n="worn">Worn</h4>
              <h4 class="repeatingHeader armorType alignLeft" data-i18n="armor-type">Armor Type</h4>
              <h4 class="repeatingHeader armorProtected" data-i18n="area-protected">Area Protected</h4>
              <h4 class="repeatingHeader armorProtection" data-i18n="armor">Armor </h4>
              <h4 class="repeatingHeader armorWeight" data-i18n="weight">Weight</h4>
              <h4 class="repeatingHeader armorCarried" data-i18n="carried">Carried</h4>
              <input class="hiddenInput powerArmorState" type="hidden" name="attr_pa_armorState" value="0"/>
              <fieldset class="repeating_armor">
                <div class="armor">
                  <label class="armorWorn">
                    <input class="isWorn" type="checkbox" name="attr_armorWorn" value="1" checked="checked"/><span class="isWornIcon"> </span>
                  </label>
                  <label class="paArmorWorn">
                    <div class="powerArmorWorn"></div>
                  </label>
                  <input class="armorType" type="text" name="attr_ArmorType" title="@{repeating_armor_$#_ArmorType}" data-i18n-placeholder="leather" placeholder="Leather"/>
                  <select class="armorProtected" name="attr_AreaProtected"> 
                    <option value="1" data-i18n="head"> Head</option>
                    <option value="2" data-i18n="torso" selected="selected">Torso</option>
                    <option value="3" data-i18n="torso-plus-arms">Torso+Arms</option>
                    <option value="4" data-i18n="torso-plus-legs">Torso+Legs</option>
                    <option value="5" data-i18n="torso-plus-arms-plus-legs">Torso+Arms+Legs</option>
                    <option value="6" data-i18n="arms">Arms</option>
                    <option value="7" data-i18n="legs">Legs</option>
                    <option value="8" data-i18n="full-body">Full Body</option>
                  </select>
                  <input class="armorProtection" type="number" name="attr_ArmorTypeProtection" title="@{repeating_armor_$#_ArmorTypeProtection}" placeholder="1"/>
                  <input class="armorWeight" style="width:50px;" type="number" step="any" name="attr_ArmorTypeWeight" title="@{repeating_armor_$#_ArmorTypeWeight}"/>
                  <label class="armorCarried">
                    <input class="armorisCarried" type="checkbox" name="attr_ArmorCarried" title="@{repeating_armor_$#_ArmorCarried}" checked="checked"/><span class="armorisCarriedIcon"> </span>
                  </label>
                  <input class="showarmorconfig" type="checkbox" name="attr_showarmorconfig" checked="checked"/>
                  <label class="configCog">
                    <input class="showarmorconfig" type="checkbox" name="attr_showarmorconfig" checked="checked"/><span>y</span>
                  </label>
                  <textarea class="armorDesc" name="attr_ArmorNotes" title="@{repeating_armor_$#_ArmorNotes}" placeholder="Description/Notes" data-i18n-placeholder="description-notes"></textarea>
                  <div class="armorconfig">
                    <!-- Stacking-->
                    <h4 class="armorStacks armorConfigHeader" data-i18n="protection-stacks">Stacks</h4>
                    <select class="armorStacks" style="margin-left: -5px;" name="attr_armorstack"> 
                      <option Value="0" data-i18n="no" selected="selected">No</option>
                      <option value=".5">50%</option>
                      <option value="1">100%</option>
                    </select>
                    <!-- Min Strength-->
                    <h4 class="armorConfigHeader armorMinStr" data-i18n="minimum-strength-abbr">Min. Str.</h4>
                    <input type="hidden" name="attr_minstrength" value="4"/>
                    <select class="armorMinStr dtype" name="attr_armorminstrength" title="@{repeating_weapons_$#_minstrength}"> 
                      <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                      <option value="4" data-i18n="d4" selected="selected">d4</option>
                      <option value="6" data-i18n="d6">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select>
                    <!--Embedded Toughness-->
                    <h4 class="armorConfigHeader armorMinStr" data-i18n="embedded-toughness"></h4>
                    <input type="number" name="attr_embeddedtoughness" value="0"/>
                  </div><span class="statblock" name="attr_ArmorType"></span><span class="statblock openParens">(+</span><span class="statblock" name="attr_ArmorTypeProtection"></span><span class="statblock">)</span>
                </div>
              </fieldset>
              <!-- Set up the Total Weight Carried Box-->
              <div class="armorTotalWeight loadstuff">
                <h4 class="armorweight"> <span data-i18n="total-armor-weight-carried">Total Armor Weight Carried</span>:</h4>
                <input class="armorWeight" type="number" name="attr_armortotalweightcarried" title="@{armortotalweightcarried}" value="0" readonly="readonly"/>
              </div>
            </div>
          </div>
          <div class="shieldHalf">
            <label class="hideBtn armorHideBtn">
              <input class="showHideBtn" type="checkbox" name="attr_hideShield"/><span class="showHideIcon"></span>
            </label>
            <h1 class="groupHeader shieldSection" data-i18n="shields">Shields</h1>
            <input class="hiddenInput hideShields" type="checkbox" name="attr_hideShield"/>
            <div class="shield">
              <h4 class="repeatingHeader shieldWorn" data-i18n="worn">Worn</h4>
              <h4 class="repeatingHeader shieldType" style="text-align: left;" data-i18n="shield-type">Shield Type</h4>
              <h4 class="repeatingHeader shieldParry" data-i18n="parry">Parry</h4>
              <h4 class="repeatingHeader shieldCover" data-i18n="cover">Cover</h4>
              <h4 class="repeatingHeader shieldWeight" data-i18n="weight">Weight</h4>
              <fieldset class="repeating_shields"> 
                <label class="shieldWornContainer">
                  <input class="shieldWorn isWorn" type="checkbox" name="attr_shieldWorn" value="1" checked="checked"/><span class="isWornIcon"> </span>
                </label>
                <input class="isWorn" type="hidden" name="attr_shieldWorn" value="1"/><span class="statblockIcon statblock">&#128737;</span>
                <input class="shieldType" type="text" name="attr_ShieldType" title="@{repeating_shields_$#_ShieldType}"/>
                <input class="shieldParry" type="number" name="attr_ShieldParry" title="@{repeating_shields_$#_ShieldParry}"/>
                <input class="shieldCover" type="number" name="attr_ShieldCover" title="@{repeating_shields_$#_Cover}" placeholder="1"/>
                <input class="shieldWeight" type="number" step="any" name="attr_ShieldTypeWeight" title="@{repeating_shields_$#_ShieldTypeWeight}"/>
                <input class="showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/>
                <label class="configCog"> 
                  <input class="showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/><span>y</span>
                </label>
                <input class="hiddenInput showshieldconfig" type="checkbox" name="attr_showshieldconfig" checked="checked"/>
                <textarea class="shieldDesc" name="attr_ShieldNotes" title="@{repeating_shields_$#_ShieldNotes}" placeholder="Description/Notes" data-i18n-placeholder="description-notes"> </textarea>
                <div class="shieldconfig">
                  <h4 class="armorConfigHeader armorMinStr" data-i18n="minimum-strength-abbr">Min. Str.</h4>
                  <input type="hidden" name="attr_shieldminstrength" value="4"/>
                  <select class="shieldMinStr dtype" name="attr_shieldminstrength" title="@{repeating_shields_$#_shieldminstrength}"> 
                    <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                    <option value="4" data-i18n="d4" selected="selected">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                  </select>
                </div><span class="statblock" name="attr_ShieldType"></span>
              </fieldset>
              <!--
              fieldset(class="repeating_shields") 
                  div(class="shieldWornContainer")
                      input(class="shieldWorn isWorn" type="checkbox" name="attr_shieldWorn" value="1" checked)
                      span(class="isWornIcon") 
                  input(class="shieldType" type="text" name="attr_ShieldType" title="@{repeating_shields_$#_ShieldType}")
                  input(class="shieldParry" type="number" name="attr_ShieldParry" title="@{repeating_shields_$#_ShieldParry}")
                  input(class="shieldCover" type="number" name="attr_ShieldCover" title="@{repeating_shields_$#_Cover}" placeholder="1")
                  input(class="shieldWeight" type="number" step="any" name="attr_ShieldTypeWeight" title="@{repeating_shields_$#_ShieldTypeWeight}")
                  label(class="moreshields") 
                      input(class='showshieldconfig' type='checkbox' name='attr_showshieldconfig' checked)
                      span y
                  input(class='hiddenInput showshieldconfig' type='checkbox' name='attr_showshieldconfig' checked)
                  textarea(class="shieldDesc" name="attr_ShieldNotes" title="@{repeating_shields_$#_ShieldNotes}" placeholder="Description/Notes" data-i18n-placeholder="description-notes") 
                  div(class="shieldconfig")
                      h4(class="armorConfigHeader armorMinStr" data-i18n="minimum-strength-abbr") Min. Str.
                      input(type='hidden' name='attr_shieldminstrength' value="4")
                      select(class="shieldMinStr dtype" name="attr_shieldminstrength" title="@{repeating_shields_$#_shieldminstrength}") 
                          option(value="0" data-i18n="not-applicable-abbr-u") N/A
                          option(value="4" data-i18n="d4" selected) d4
                          option(value="6" data-i18n="d6") d6
                          option(value="8" data-i18n="d8") d8
                          option(value="10" data-i18n="d10") d10
                          option(value="12" data-i18n="d12") d12
              -->
              <div class="shieldTotalWeight loadstuff">
                <h4 class="shieldweight"> <span data-i18n="total-shield-weight-carried">Total Shield Weight Carried</span>:</h4>
                <input class="shieldWeight" type="number" name="attr_shieldtotalweightcarried" title="@{shieldtotalweightcarried}" value="0" readonly="readonly"/>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="characternotes">
        <!-- Physical Appearance/History/Orgin of Powers-->
        <div class="BGDesc standardDiv">
          <h1 class="CharacterHistory groupHeader" data-i18n="physical-appearance-personal-history">Physical Appearance + Personal History</h1>
          <textarea class="standardTextArea" name="attr_physdescription"></textarea>
        </div>
        <!-- End Physical Appearance, etc.-->
        <!-- Permanent Injuries-->
        <input class="useInjuries hiddenInput" type="checkbox" name="attr_permInjuries"/>
        <div class="Injuries standardDiv">
          <h1 class="groupHeader" data-i18n="permanent-injuries">Permanent Injuries</h1>
          <textarea class="standardTextArea" name="attr_injuries"></textarea>
        </div>
        <!-- End Permanent Injuries-->
        <!-- Worst Nightmare-->
        <input class="useWorstNightmare hiddenInput" type="checkbox" name="attr_worstNightmare"/>
        <div class="WorstNightmare standardDiv">
          <h1 class="groupHeader" data-i18n="worst-nightmare">Worst Nightmare</h1>
          <textarea class="standardTextArea" name="attr_nightmare"> </textarea>
        </div>
        <!-- End Worst Nightmare-->
        <!-- Quest Log-->
        <input class="useQuestLog hiddenInput" type="checkbox" name="attr_questlog"/>
        <div class="QuestLog standardDiv">
          <div class="showhidebox">
            <input class="hideQL" type="checkbox" name="attr_hideQL"/><span class="showQL"> </span>
          </div>
          <h1 class="groupHeader questlogHeader" data-i18n="quest-log">Quest Log</h1>
          <input class="hideQL hiddenInput" type="checkbox" name="attr_hideQL"/>
          <div class="QL">
            <h3 class="qlItem title">Title</h3>
            <h3 class="qlItem boss">Boss</h3>
            <h3 class="qlItem goal">Goal</h3>
            <h3 class="qlItem qlComplete alignCenter">Done</h3>
            <fieldset class="repeating_quests">
              <div class="QL">
                <input class="qlItem title" type="text" data-i18n-placeholder="quest-title" placeholder="Quest Title" name="attr_Quest"/>
                <input class="qlItem boss" data-i18n-placeholder="who-hired-you" placeholder="Who Hired You?" type="text" name="attr_QuestBoss"/>
                <input class="qlItem goal" type="text" data-i18n-placeholder="whats-the-goal-of-the-quest" placeholder="What's the goal of the quest?" name="attr_QuestGoal"/>
                <label class="qlItem qlComplete">
                  <input class="goalDone" type="checkbox" name="attr_QuestComplete"/><span class="goalCheck"></span>
                </label>
                <textarea class="qlItem qlNotes" data-i18n-placeholder="notes-about-the-quest" placeholder="Notes about the quest..." name="attr_questLog"></textarea>
              </div>
            </fieldset>
          </div>
        </div>
        <!-- Notes-->
        <div class="flexdiv">
          <div class="charnotes">
            <h1 class="groupHeader" data-i18n="notes">Notes</h1>
            <textarea class="standardTextArea" name="attr_CharNotes" title="@{CharNotes}"></textarea>
          </div>
        </div>
      </div>
      <div class="vehicles">
        <!-- input(class="useRobotArmor hiddenInput" type="checkbox" name="attr_RobotArmor")-->
        <!-- div(class="ship-RobotArmor") -->
        <h1 class="groupHeader"> 
          <input class="headerInput" type="text" name="attr_vehicletype" data-i18n-placeholder="vehicle-type"/>
        </h1>
        <div class="ship"> 
          <div class="shipMainSection"> 
            <div class="shipMainColumn1"> 
              <div class="shipMainItem"> 
                <label class="shipMainLabel" data-i18n="wounds">Wounds:</label>
                <input class="shipWound" type="number" name="attr_vehiclewounds" value="0"/>&nbsp;<span data-i18n="of">of </span>
                <input class="shipWound" type="number" name="attr_vehiclewounds_max" value="3"/>
                <div class="vehicle-incbox" title="Incapcitated" data-i18n-title="incapacitated"> 
                  <label class="vehicle-incbox"> 
                    <input class="vehicle-inc" type="checkbox" name="attr_vehicleisinc"/>
                    <div>&nbsp;</div>
                  </label>
                </div>
              </div>
              <div class="shipMainSubColumn"> 
                <div class="vehicleStatContainer"> 
                  <div class="vehicleSizeBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_vehiclesize"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="size">Size:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleHandlingBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_vehiclehandling"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="handling">Handling:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleTopSpeedBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_vehicletopspeed"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="top-speed">Top Speed (MPH):</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleToughnessBox"> 
                    <input class="shipMainStatsInput" type="text" name="attr_vehicletoughness"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="toughness">Toughness:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleCrewBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_vehiclecrew"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="crew">Crew:</label>
                </div>
              </div>
            </div>
            <div class="shipMainColumn2"> 
              <h4 class="subsectionHeader panotesheader" data-i18n="cargo">Cargo</h4>
              <textarea class="vtext panotes" name="attr_vehiclecargo"></textarea>
            </div>
            <div class="shipMainColumn3"> 
              <h4 class="subsectionHeader panotesheader" data-i18n="notes-and-upgrades">Notes and Upgrades</h4>
              <textarea class="vtext panotes" name="attr_vehiclenotes"></textarea>
            </div>
          </div>
          <!--Armaments-->
          <div class="shipArmaments"> 
            <h1 class="groupHeader" data-i18n="armaments">Armaments</h1>
            <div class="shipWeapons"> 
              <h4 class="weaponItem shipbutton">&nbsp;</h4>
              <h4 class="weaponItem shipweapon" data-i18n="weapon">Weapon</h4>
              <h4 class="weaponItem shiprange alignCenter" data-i18n="range">Range</h4>
              <h4 class="weaponItem shiprof" data-i18n="rate-of-fire-abbr">ROF</h4>
              <h4 class="weaponItem shipdamage" data-i18n="damage">Damage</h4>
              <h4 class="weaponItom shipAP" data-i18n="armor-piercing-abbr">AP</h4>
              <h4 class="weaponItem shipplacement" data-i18n="placement">Placement</h4>
              <fieldset class="repeating_shipweapons"> 
                <div class="shipWeapons"> 
                  <button class="weaponItem shipbutton" type="roll" name="roll_tShipWeaponDamage" value="@{rolltShipWeaponDamageFormula}">Damage </button>
                  <input class="weaponItem shipweapon" type="text" name="attr_ShipWeaponType" data-i18n-placeholder="weapon" placeholder="Weapon"/>
                  <input class="weaponItem shiprange" type="text" name="attr_ShipWeaponRange" data-i18n-placeholder="range" placeholder="Range"/>
                  <input class="weaponItem shiprof" type="number" name="attr_ShipWeaponRoF" data-i18n-placeholder="rate-of-fire-abbr" placeholder="RoF"/>
                  <div class="weaponItem shipdamage"> 
                    <input class="short" type="number" name="attr_NoDmgDice" value="2"/>
                    <select class="dtype" name="attr_DmgType"> 
                      <option value="d4!" data-i18n="d4">d4</option>
                      <option value="d6!" data-i18n="d6">d6</option>
                      <option value="d8!" data-i18n="d8">d8</option>
                      <option value="d10!" data-i18n="d10">d10</option>
                      <option value="d12!" data-i18n="d12">d12</option>
                    </select>+
                    <input class="shipDamageMod" type="text" name="attr_DmgMod" value="0"/>
                  </div>
                  <input class="weaonItem weaponAP" type="number" name="attr_ShipWeaponAP" value="0"/>
                  <input class="weaponItem shipplacement" type="text" name="attr_ShipWeaponPlacement" data-i18n-placeholder="placement" placeholder="Placement"/>
                  <textarea class="weaponItem shipweaponnotes" name="attr_ShipWeaponNotes"></textarea>
                </div>
                <input type="hidden" name="attr_rolltShipWeaponDamageFormula" value="&amp;{template:damage} {{namelength=@{namelength}}} {{name=@{vehicletype}}} {{source=@{ShipWeaponType}}} {{dmg_rank=@{NoDmgDice}@{DmgType}+@{DmgMod}}} {{dmg_roll=@{ShipWeaponDamage}}} {{bonus_die=[[@{vbonusdamage}]]}} {{notes=@{ShipWeaponNotes}}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <input type="hidden" name="attr_ShipWeaponDamage" value="[[@{NoDmgDice}@{DmgType}+@{DmgMod} + @{damagemods}]]"/>
              </fieldset>
            </div>
          </div>
        </div>
      </div>
      <div class="powerArmor">
        <!--
        *************************************************************
        The CSS for Power Armor is located in the _vehicles.scss file
        *************************************************************
        -->
        <h1 class="groupHeader"> 
          <input class="headerInput" type="text" name="attr_pa_vehicletype" data-i18n-placeholder="power-armor-type"/>
          <input class="hiddenInput powerArmorState" type="checkbox" name="attr_pa_armorState" value="1"/>
          <button class="powerArmorButton" type="action" name="act_powerArmorStateButton"><span class="putArmorOn" data-i18n="put-power-armor-on"></span><span class="takeArmorOff" data-i18n="take-power-armor-off"></span></button>
        </h1>
        <input type="hidden" name="attr_wornArmorRowIDs"/>
        <div class="ship"> 
          <div class="shipMainSection"> 
            <div class="shipMainColumn1"> 
              <!--
              div(class="shipMainItem") 
                  label(class="shipMainLabel" data-i18n="wounds") Wounds:
                  input(type="number" class="shipWound" name="attr_pa_vehiclewounds" value="0")
                  | &nbsp;
                  span(data-i18n="of") of 
                  input(type="number" class="shipWound" name="attr_pa_vehiclewounds_max" value="3")
                  div(class='vehicle-incbox' title="Incapcitated" data-i18n-title="incapacitated") 
                      label(class='vehicle-incbox') 
                          input(class="vehicle-inc" type='checkbox' name='attr_pa_vehicleisinc')
                          div &nbsp;
              -->
              <div class="shipMainSubColumn"> 
                <div class="vehicleStatContainer"> 
                  <div class="vehicleSizeBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_pa_vehiclesize"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="size">Size:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleHandlingBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_pa_vehiclehandling"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="handling">Handling:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleTopSpeedBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_pa_vehicletopspeed"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="top-speed">Top Speed (MPH):</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleToughnessBox"> 
                    <!-- input(type="text" class="shipMainStatsInput" name="attr_pa_vehicletoughness")-->
                    <div class="pilotToughness"><span name="attr_toughnesscur"></span><span>(</span><span name="attr_toughnessArmor"></span><span>)</span></div>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="toughness">Toughness:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleRunningBox"> 
                    <input class="vehicleRunNum" type="number" name="attr_pa_run_numdice" value="1"/>
                    <select class="vehicleRunDie" name="attr_pa_run_dietype">
                      <option value="d4">d4 </option>
                      <option value="d6">d6 </option>
                      <option value="d8" selected="selected">d8 </option>
                      <option value="d10">d10 </option>
                      <option value="d12">d12 </option>
                      <option value="d20">d20 </option>
                    </select>
                  </div>
                  <input type="hidden" name="attr_pa_running_formula" value="&amp;{template:emote} {{name=@{character_name}}} {{does=^{running-text-before-number} [[@{pa_vehiclepace}+@{pa_run_numdice}@{pa_run_dietype}]] ^{running-text-after-number} }}"/>
                  <button class="runbutton" type="roll" name="roll_pa_running_roll" value="@{pa_running_formula}">&nbsp;<span data-i18n="running">Running</span></button>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleCrewBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_pa_vehiclepace" value="0"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="pace">Pace:</label>
                </div>
              </div>
            </div>
            <div class="shipMainColumn2"> 
              <input class="hiddenInput" type="text" name="attr_pa_image" value="https://raw.githubusercontent.com/finderski/SWT/master/Icons/PowerArmor.png"/><img name="attr_pa_image" src="https://raw.githubusercontent.com/finderski/SWT/master/Icons/PowerArmor.png"/>
              <!--img(src="https://raw.githubusercontent.com/finderski/SWT/master/Icons/PowerArmor.png")-->
            </div>
            <div class="shipMainColumn3"> 
              <h4 class="subsectionHeader panotesheader" data-i18n="additional-info">Additional Info</h4>
              <!--embedded toughness (pilot toughness mod)-->
              <label data-i18n="pilot-toughness-mod" data-i18n-title="adds-directly-to-pilot-toughness-is-not-armor"></label>
              <input type="number" name="attr_pa_embeddedtoughness" title="@{embeddedtoughness}" value="0"/>
              <!--pilot armor-->
              <label data-i18n="pilot-armor-mod" data-i18n-title="adds-to-pilot-toughness-as-armor"></label>
              <input type="number" name="attr_pa_pilotarmor" title="@{pa_pilotarmor}" value="0"/>
              <!--pilot skill-->
              <button class="skillbutton" type="roll" name="rolltPilotingRoll" value="@{pilotingRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} + @{pa_pilotSkillMod} [Power Armor Enhancement]]]}} {{wild_die=[[ @{pilotingWildDieFormula} + @{pa_pilotSkillMod} [Power Armor Enhancement]]]}}" title="tPilotingRoll}">&nbsp;<span name="attr_pilotingname"></span>&nbsp;(<span name="attr_piloting_display"></span>)</button>
              <div class="skillMod">
                <input type="number" name="attr_pa_pilotSkillMod" data-i18n-title="modifier-applied-to-pilotskill" value="0"/><span class="modLabel" data-i18n="skill-mod" data-i18n-title="mod-added-due-to-power-armor"></span>
              </div>
              <!--Power Armor Strength-->
              <!-- +attribute(`${attribute}`)-->
              <!--input(type="hidden", value=`${name}`)-->
              <!--input(type="hidden", value=`${skillAbbr}`)-->
              <input type="hidden" value="false" name="attr_pastrength_cla"/>
              <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
              <input type="hidden" value="str" name="attr_pastrength_lao"/>
              <!--input(type="hidden", value=`${vartype}`)-->
              <!-- Begin the Actual HTML for the Character Sheet-->
              <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticpastrength"/>
              <div class="basetrait staticPastrength" data-i18n-list-item="pastrength">
                <input class="deltabutton" type="hidden" name="attr_pastrength_delta" value="0"/>
                <input type="hidden" value="false" name="attr_pastrength_makeButton"/>
                <input type="hidden" value="string" name="attr_pastrength_mbVarType"/>
                <button class="skillbutton skillflexattbutton" type="roll" name="roll_tPastrengthRoll" value="@{pastrengthRollValue} {{skill_roll=[[ @{pastrengthSkillRollFormula} ]]}} {{wild_die=[[ @{pastrengthWildDieFormula} ]]}}" title="@{tPastrengthRoll}">&nbsp;<span name="attr_pastrengthname"></span>
                  <!--
                  if skill === "knowledgeother"
                      span(name=`attr_${skill}buttonName`, value="Skill")
                  else if skill === "language"
                      span(name=`attr_native-${skill}name`)
                  else
                      span(name=`attr_${skill}name`) 
                  
                  -->&nbsp;<span class="linkedAtt" data-i18n="str-u"></span><span class="statblock">(<span name="attr_pastrength_display"></span>)</span>
                </button>
                <input type="hidden" name="attr_pastrengthRollValue" value="@{whisperpastrength} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tPastrengthRoll)}} {{trait=@{pastrengthname}}} @{rolltPastrength} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <div class="skillRankContainer">
                  <div class="skillRankChild">
                    <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                    <label class="skilldielabel" data-i18n-title="pastrength-die-type-d4">
                      <input class="traitradio" type="radio" name="attr_pastrength" value="4" checked="checked"/><span class="d4"></span>
                      <div class="d4a" data-i18n="d4"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="pastrength-die-type-d6">
                      <input class="traitradio" type="radio" name="attr_pastrength" value="6"/><span class="d6"></span>
                      <div class="d6a" data-i18n="d6"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="pastrength-die-type-d8">
                      <input class="traitradio" type="radio" name="attr_pastrength" value="8"/><span class="d8"></span>
                      <div class="d8a" data-i18n="d8"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="pastrength-die-type-d10">
                      <input class="traitradio" type="radio" name="attr_pastrength" value="10"/><span class="d10"></span>
                      <div class="d10a" data-i18n="d10"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="pastrength-die-type-d12">
                      <input class="traitradio" type="radio" name="attr_pastrength" value="12"/><span class="d12"></span>
                      <div class="d12a" data-i18n="d12"></div>
                    </label>
                    <input class="traitradio" type="hidden" name="attr_pastrength" value="4"/>
                    <div class="d4Selected"><span class="d4"></span>
                      <div class="d4a" data-i18n="d4"></div>
                    </div>
                    <div class="d6Selected"><span class="d6"></span>
                      <div class="d6a" data-i18n="d6"></div>
                    </div>
                    <div class="d8Selected"><span class="d8"></span>
                      <div class="d8a" data-i18n="d8"></div>
                    </div>
                    <div class="d10Selected"><span class="d10"> </span>
                      <div class="d10a" data-i18n="d10"></div>
                    </div>
                    <div class="d12Selected"><span class="d12"></span>
                      <div class="d12a" data-i18n="d12"></div>
                    </div>
                  </div>+
                </div>
                <input class="otraitmod" type="number" name="attr_pastrengthmod" title="@{pastrengthmod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_pastrengthModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_PastrengthskillMod" title="@{Pastrengthskillmod}" value="0"/>
                    <input type="hidden" name="attr_linkedpastrengthattbutton" value="@{setmodsenc}"/>
                    <input type="hidden" name="attr_linkedpastrengthattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperpastrength"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_pastrengthwilddie" title="@{pastrengthwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" selected="selected" data-i18n="d6">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_pastrengthwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                    <input class="deltamod" type="number" name="attr_pastrength_delta" title="@{pastrength_delta}" value="0"/>
                    <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                    <input type="hidden" name="attr_pastrength_base"/>
                    <input type="hidden" name="attr_pastrengthmod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_pastrength_rank" value="1d4!"/>
                <input type="hidden" name="attr_pastrength_display" value="d4"/>
                <input type="hidden" name="attr_pastrengthSkillRollFormula" value="@{pastrength_rank} + @{PastrengthskillMod} [@{pastrengthModType}] + @{linkedpastrengthattformula} + @{traitmods}"/>
                <input type="hidden" name="attr_pastrengthWildDieFormula" value="1d@{pastrengthwilddie}! + @{pastrengthmod} + @{PastrengthskillMod} [@{pastrengthModType}] + @{linkedpastrengthattformula} + @{traitmods}"/>
                <input type="hidden" name="attr_rolltPastrength" value="{{name=@{character_name} }} {{skill_rank=@{pastrength_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                <div class="SkillSpec">
                  <fieldset class="repeating_pastrengthspec">
                    <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tPastrengthSpecRoll" title="@{tPastrengthSpecRoll}" value="@{pastrengthSpecRollValue} {{skill_roll=[[ @{pastrengthSkillRollFormula} ]]}} {{wild_die=[[ @{pastrengthWildDieFormula} ]]}}"></button>
                    <input type="hidden" name="attr_pastrengthSpecRollValue" value="@{whisperpastrength} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_pastrengthspec_tPastrengthSpecRoll)}} {{trait=@{pastrengthSpecName} }} @{rolltPastrength} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                    <input class="speciality" type="text" name="attr_pastrengthSpecName" title="@{repeating_pastrengthSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                    <input class="hiddenInput" type="text" name="attr_pastrength_specialty_display" value="d4"/>
                  </fieldset>
                  <!--
                  fieldset(class=`repeating_${skill}spec`)
                      button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                      input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                      input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                  -->
                </div>
              </div>
            </div>
          </div>
          <!-- Armaments-->
          <label class="hideBtn">
            <input class="showHideBtn" type="checkbox" name="attr_hideWeapons" value="1"/><span class="showHideIcon"></span>
          </label>
          <h1 class="groupHeader weaponsSection" data-i18n="weapons">Weapons</h1>
          <input class="hideWeapons" type="hidden" name="attr_hideWeapons" value="0"/>
          <div class="weapons"><span class="weaponHeader weaponItem button">&nbsp;</span><span class="weaponHeader weaponItem weapon" data-i18n="weapon">Weapon</span><span class="weaponHeader weaponItem range" data-i18n="range">Range</span><span class="weaponHeader weaponItem damage" data-i18n="damage">Damage</span><span class="weaponHeader weaponItem weaponap" data-i18n="armor-piercing-abbr-u">AP</span><span class="weaponHeader weaponItem rof" data-i18n="rate-of-fire-abbr">ROF</span><span class="weaponHeader weaponItem shots" data-i18n="number-of-shots-shortened">Shots</span><span class="weaponHeader weaponItem weaponweight" data-i18n="weight-abbr">Wt</span><span class="weaponHeader weaponItem weaponcarried" data-i18n="carried">Carried</span>
            <hr class="weaponItem weapon-hr"/>
            <input type="hidden" name="attr_vbonusdamage" value="1d6"/>
            <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
            <input class="AthleticsStaticSkill hiddenButton" type="checkbox" name="attr_staticAthletics"/>
            <input class="ShootingStaticSkill hiddenButton" type="checkbox" name="attr_staticShooting"/>
            <input class="WSStaticSkill hiddenButton" type="checkbox" name="attr_staticWeirdScience"/>
            <fieldset class="repeating_paweapons">
              <!--include vehicleweaponsrepeating mixin-->
              <!-- - const section = section;-->
              <div class="weaponfull">
                <button class="weaponItem button" type="roll" name="roll_tWeapon" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-i18n="damage">Damage</span><span class="buttonma" data-i18n="multi-attack-and-damage-abbr">
                     Atk<sup>x</sup>+Dmg</span>
                </button>
                <button class="statblock miniButton" type="roll" name="roll_tWeapon2" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand crossedSwords">&#9876;&nbsp;</span><span class="buttondo dagger">&#128481;&nbsp;</span><span class="buttonma"> <span class="crossedSwords">&#9876;</span><span class="dagger">&#128481;</span>&nbsp;</span><span class="statblock" name="attr_weapon"></span><span class="statblock openParens">(</span>
                  <input class="weaponRange" type="hidden" name="attr_range"/><span class="statblock showRange">Range </span><span class="statblock showRange" name="attr_range"></span><span class="statblock showRange">, </span><span class="statblock damage" data-i18n="damage">Damage</span><span class="statblock" name="attr_weapondamage"></span><span class="statblock">)</span>
                </button>
                <button class="hiddenButton" type="roll" name="roll_dmg" value="@{damageOnly}"> </button>
                <button class="hiddenButton" type="roll" name="roll_weaponsbonusDamage" value="&amp;{template:bonusDamage} {{dieType=@{weaponsbdt}}} {{bonusDamage=[[@{vbonusdamage}!]]}}"> </button>
                <input class="weaponItem weapon" type="text" name="attr_weapon" title="@{repeating_paweapons_$#_weapon}" data-i18n-placeholder="weapon" placeholder="Weapon"/>
                <input class="weaponItem range" type="text" name="attr_range" title="@{repeating_paweapons_$#_range}" data-i18n-placeholder="range" placeholder="Range"/>
                <button class="weaponItem damage invisbutton" type="action" name="act_wdamage"> <span name="attr_weapondamage"> </span></button>
                <input type="hidden" name="attr_weapondamage" value="Str+1d4"/>
                <input class="weaponItem weaponap" type="number" name="attr_weaponap" title="@{repeating_paweapons_$#_weaponap}"/>
                <input class="weaponItem rof" type="number" name="attr_rof" title="@{repeating_paweapons_$#_rof}" data-i18n-placeholder="rate-of-fire-abbr" placeholder="ROF"/>
                <div class="weaponItem shots">
                  <input class="weaponshots" type="number" name="attr_shots" title="@{repeating_paweapons_$#_shots}"/>&nbsp;of&nbsp;
                  <input class="weaponshots" type="number" name="attr_shots_max" title="@{repeating_paweapons_$#_shots_max}"/>
                </div>
                <input class="weaponItem weaponweight" type="number" step="any" name="attr_weaponweight" title="@{repeating_paweapons_$#_weaponweight}" data-i18n-placeholder="weight-abbr" placeholder="Wt"/>
                <!-- div(class='weaponItem weaponcarried')-->
                <label class="weaponItem weaponcarried">
                  <input class="itemCarried isCarried" type="checkbox" name="attr_weaponcarried" title="@{repeating_paweapons_$#_weaponcarried}"/><span class="isCarriedIcon"> </span>
                </label>
                <input class="moreConfig hiddenInput" type="checkbox" name="attr_showweaponconfig" checked="checked"/>
                <label class="configCog">
                  <input class="moreConfig" type="checkbox" name="attr_showweaponconfig" checked="checked"/>y
                </label>
                <textarea class="weaponItem weaponnotes" name="attr_weaponnotes" title="@{repeating_paweapons_$#_weaponnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
                <div class="weaponconfig">
                  <label class="configlabels configcheckbox"> 
                    <input type="checkbox" value="/w gm" name="attr_whisperweapon" title="@{repeating_paweapons_$#_whisperweapon}"/>&nbsp;<span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span>
                  </label><br/>
                  <label class="configlabels" data-i18n="minimum-strength">Minimum Strength</label>
                  <input type="hidden" name="attr_minstrength" value="4"/>
                  <select class="dtype" name="attr_weaponminstrength" title="@{repeating_paweapons_$#_minstrength}"> 
                    <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                    <option value="4" data-i18n="d4" selected="selected">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                  </select><br/>
                  <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                  <input class="showmultiattack" type="hidden" name="attr_showmulti" value="0"/>
                  <select class="weaponbutton" name="attr_weaponbutton" title="@{repeating_paweapons_$#_weaponbutton}"> 
                    <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                    <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                    <option class="multiattack" value="2" data-i18n="multi-attack-and-damage-abbr">Atk^+Dmg</option>
                  </select>
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton"/>
                  <div class="weaponskill">
                    <label class="configlabels" data-i18n="skill">Skill</label>
                    <div class="container">
                      <div class="child">
                        <label class="ddmenu"> 
                          <input class="select-radio fighting" type="radio" name="attr_weaponskill" title="@{repeating_paweapons_$#_weaponskill}" value="fighting" checked="checked"/>&nbsp;<span name="attr_rfightingname"> </span>
                        </label>
                        <label class="ddmenu athletics"> 
                          <input class="select-radio athletics" type="radio" name="attr_weaponskill" title="@{repeating_paweapons_$#_weaponskill}" value="athletics"/>&nbsp;<span name="attr_rathleticsname"> </span>
                        </label>
                        <label class="ddmenu shooting"> 
                          <input class="select-radio shooting" type="radio" name="attr_weaponskill" title="@{repeating_paweapons_$#_weaponskill}" value="shooting"/>&nbsp;<span name="attr_rshootingname"> </span>
                        </label>
                        <label class="ddmenu"> 
                          <input class="select-radio unskilled" type="radio" name="attr_weaponskill" title="@{repeating_paweapons_$#_weaponskill}" value="unskilled"/>&nbsp;<span data-i18n="unskilled">Unskilled</span>
                        </label>
                        <label class="ddmenu weirdscience"> 
                          <input class="select-radio weirdscience" type="radio" name="attr_weaponskill" title="@{repeating_paweapons_$#_weaponskill}" value="weirdscience"/>&nbsp;<span name="attr_rweirdsciencename"> </span>
                        </label>
                        <input class="select-radio" type="hidden" name="attr_weaponskill" value="fighting"/>
                        <div class="fighting"><span name="attr_rfightingname"> </span></div>
                        <div class="athletics"><span name="attr_rathleticsname"> </span></div>
                        <div class="shooting"><span name="attr_rshootingname"> </span></div>
                        <div class="unskilled"><span data-i18n="unskilled">Unskilled</span></div>
                        <div class="weirdscience"><span name="attr_rweirdsciencename"> </span></div>
                      </div>
                    </div>
                    <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                    <input type="text" placeholder="Trademark Weapon" data-i18n-placeholder="trademark-weapon" name="attr_weaponAttackBonusReason"/>)&nbsp; 
                    <input type="number" name="attr_weaponAttackBonus" value="0"/>
                  </div>
                  <div class="weapondamage">
                    <input class="highlight" type="checkbox" name="attr_highlightdamage" value="1" style="display: none;"/>
                    <label class="configlabels" data-i18n="damage">Damage</label>
                    <select class="weaponatt" name="attr_damageatt" title="@{repeating_paweapons_$#_damageatt}"> 
                      <option value="na" data-i18n="not-applicable-abbr-u">N/A</option>
                      <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                      <option value="agility" data-i18n="agility">Agility</option>
                      <option value="smarts" data-i18n="smarts">Smarts</option>
                      <option value="spirit" data-i18n="spirit">Spirit</option>
                      <option value="vigor" data-i18n="vigor">Vigor</option>
                    </select>+
                    <input class="weaponnum" type="number" name="attr_dmgnumdice" title="@{repeating_paweapons_$#_dmgnumdice}" style="text-align: right;" value="1"/>
                    <select class="dtype" name="attr_dmgdietype" title="@{repeating_paweapons_$#_dmgdietype}"> 
                      <option value="d4!" data-i18n="d4">d4</option>
                      <option value="d6!" data-i18n="d6">d6</option>
                      <option value="d8!" data-i18n="d8">d8</option>
                      <option value="d10!" data-i18n="d10">d10</option>
                      <option value="d12!" data-i18n="d12">d12</option>
                      <option value="d20!" data-i18n="d20">d20</option>
                    </select>+
                    <input class="weaponnum" type="text" name="attr_dmgbonusnum" title="@{repeating_paweapons_$#_dmgbonusnum}"/>
                  </div>
                  <div class="vbonusdamage">
                    <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                    <div class="numOfBonusDice"> 
                      <input type="number" name="attr_weaponsbdtnum" value="1"/>
                      <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                    </div>
                    <select class="dtype" name="attr_weaponsbdt" title="@{repeating_paweapons_$#_weaponsbdt}"> 
                      <option value="d4" data-i18n="d4">d4</option>
                      <option value="d6" selected="selected" data-i18n="d6">d6</option>
                      <option value="d8" data-i18n="d8">d8</option>
                      <option value="d10" data-i18n="d10">d10</option>
                      <option value="d12" data-i18n="d12">d12</option>
                      <option value="d20" data-i18n="d20">d20</option>
                    </select>
                  </div>
                </div>
                <!-- Skill Formulae-->
                <input type="hidden" name="attr_weaponUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
                <input type="hidden" name="attr_weaponFightingFormula" value="@{fightingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponFightingWildDieFormula" value="@{fightingWildDieFormula}"/>
                <input type="hidden" name="attr_weaponAthleticsFormula" value="@{athleticsSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponAthleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
                <input type="hidden" name="attr_weaponShootingFormula" value="@{shootingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponShootingWildDieFormula" value="@{shootingWildDieFormula}"/>
                <input type="hidden" name="attr_weaponWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
                <!-- Hidden Fields for the roll button(s), etc-->
                <input type="hidden" name="attr_weaponroll" value="@{damageOnly}"/>
                <!-- Used for Skill and Damage roll-->
                <input type="hidden" name="attr_skillNDamage" value="@{whisperweapon} &amp;{template:roll} {{namelength=@{namelength}}} {{trait=Fighting}} {{source=@{weapon}}} @{rolltFighting} {{skill_roll=&amp;{noerror} [[ @{weaponFightingFormula} ]]}} {{wild_die=[[ @{weaponFightingWildDieFormula} ]]}} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~repeating_paweapons_tWeapon) }} {{DmgRoll=^{roll-damage}(~repeating_paweapons_dmg) }} @{multiattack} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <!-- skillNDamage used to have @{rolltFighting}  right after {{source=@{weapon}}}-->
                <!-- Used for Multiattack-->
                <input type="hidden" name="attr_multiattack" value="0"/>
                <!-- Used for Damage Only-->
                <input type="hidden" name="attr_damageOnly" value="@{dmgTemplate}"/>
                <!-- Build the Damage Roll Template Info-->
                <!-- the damage formula-->
                <input type="hidden" name="attr_weapondmg" value="@{strength_rank}+1d4!"/>
                <!-- This will either equal @{vbonusdamage} (the default) or @{weaponsbdt}-->
                <input type="hidden" name="attr_weaponsbonusdmg" value="@{vbonusdamage}"/>
                <input type="hidden" name="attr_weaponsbonusDie" value="{{bonus_die=[[@{weaponsbonusdmg}!]]}}"/>
                <!-- how to call a button roll: ^{reroll-damage}(~repeating_${section}_dmg)-->
                <input type="hidden" name="attr_dmgTemplate" value="@{whisperweapon} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{weapon} }} {{dmg_rank=@{weapondamage}}} {{dmg_roll=[[@{weapondmg} + @{damagemods}]]}} @{weaponsbonusDie} {{showap=[[1d0+@{weaponap}]]}} {{ap=@{weaponap}}} {{notes=@{weaponnotes}}} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_paweapons_dmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_paweapons_grittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <button type="roll" style="display: none;" name="roll_grittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"> </button>
              </div>
            </fieldset>
          </div>
          <!-- Old Armaments
          div(class="shipArmaments") 
              h1(class="groupHeader" data-i18n="armaments") Armaments
              div(class="shipWeapons") 
                  h4(class="weaponItem shipbutton") &nbsp;
                  h4(class="weaponItem shipweapon" data-i18n="weapon") Weapon
                  h4(class="weaponItem shiprange alignCenter" data-i18n="range") Range
                  h4(class="weaponItem shiprof" data-i18n="rate-of-fire-abbr") ROF
                  h4(class="weaponItem shipdamage" data-i18n="damage") Damage
                  h4(class="weaponItom shipAP" data-i18n="armor-piercing-abbr") AP
                  h4(class="weaponItem shipplacement" data-i18n="placement") Placement
                  fieldset(class='repeating_pa_shipweapons') 
                      div(class="shipWeapons") 
                          button(class='weaponItem shipbutton' type='roll' name='roll_tShipWeaponDamage' value='@{rolltShipWeaponDamageFormula}') Damage 
                          input(type="text" class="weaponItem shipweapon" name="attr_ShipWeaponType" data-i18n-placeholder="weapon"  placeholder="Weapon")
                          input(type="text" class="weaponItem shiprange" name="attr_ShipWeaponRange" data-i18n-placeholder="range"  placeholder="Range")
                          input(type="number" class="weaponItem shiprof" name="attr_ShipWeaponRoF" data-i18n-placeholder="rate-of-fire-abbr" placeholder="RoF")
                          div(class="weaponItem shipdamage") 
                              input(type="number" name="attr_NoDmgDice" class="short" value="2")
                              select(name="attr_DmgType" class="dtype") 
                                  option(value="d4!" data-i18n="d4") d4
                                  option(value="d6!" data-i18n="d6") d6
                                  option(value="d8!" data-i18n="d8") d8
                                  option(value="d10!" data-i18n="d10") d10
                                  option(value="d12!" data-i18n="d12") d12
                              | +
                              input(class="shipDamageMod" type="text" name="attr_DmgMod" value="0")
                          input(type="number" class="weaonItem weaponAP" name="attr_ShipWeaponAP" value="0")
                          input(type="text" class="weaponItem shipplacement" name="attr_ShipWeaponPlacement" data-i18n-placeholder="placement" placeholder="Placement")
                          textarea(class="weaponItem shipweaponnotes" name="attr_ShipWeaponNotes")
                      input(type='hidden' name='attr_rolltShipWeaponDamageFormula' value="&{template:damage} {{namelength=@{namelength}}} {{name=@{vehicletype}}} {{source=@{ShipWeaponType}}} {{dmg_rank=@{NoDmgDice}@{DmgType}+@{DmgMod}}} {{dmg_roll=@{ShipWeaponDamage}}} {{bonus_die=[[@{vbonusdamage}]]}} {{notes=@{ShipWeaponNotes}}} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}")
                      input(type="hidden" name="attr_ShipWeaponDamage" value="[[@{NoDmgDice}@{DmgType}+@{DmgMod} + @{damagemods}]]")
          -->
          <div class="shipNotes">
            <h4 class="subsectionHeader panotesheader" data-i18n="notes-and-upgrades">Notes and Upgrades</h4>
            <textarea class="vtext panotes" name="attr_pa_vehiclenotes"></textarea>
          </div>
        </div>
      </div>
      <div class="robotArmor">
        <!--input(class="usePowerArmor hiddenInput" type="checkbox" name="attr_power_Armor")-->
        <!-- div(class="ship-RobotArmor") -->
        <h1 class="groupHeader"> 
          <input class="headerInput" type="text" name="attr_ra_vehicletype" data-i18n-placeholder="robot-armor-type"/>
        </h1>
        <div class="ship"> 
          <div class="shipMainSection"> 
            <div class="shipMainColumn1"> 
              <div class="shipMainItem"> 
                <label class="shipMainLabel" data-i18n="wounds">Wounds:</label>
                <input class="shipWound" type="number" name="attr_ra_vehiclewounds" value="0"/>&nbsp;<span data-i18n="of">of </span>
                <input class="shipWound" type="number" name="attr_ra_vehiclewounds_max" value="3"/>
                <div class="vehicle-incbox" title="Incapcitated" data-i18n-title="incapacitated"> 
                  <label class="vehicle-incbox"> 
                    <input class="vehicle-inc" type="checkbox" name="attr_ra_vehicleisinc"/>
                    <div>&nbsp;</div>
                  </label>
                </div>
              </div>
              <div class="shipMainSubColumn"> 
                <div class="vehicleStatContainer"> 
                  <div class="vehicleSizeBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_ra_vehiclesize"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="size">Size:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleHandlingBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_ra_vehiclepace" value="0"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="pace">Pace</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleTopSpeedBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_ra_vehicletopspeed"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="top-speed">Top Speed (MPH):</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleToughnessBox"> 
                    <input class="shipMainStatsInput" type="text" name="attr_ra_vehicletoughness"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="toughness">Toughness:</label>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleRunningBox"> 
                    <input class="vehicleRunNum" type="number" name="attr_ra_run_numdice" value="1"/>
                    <select class="vehicleRunDie" name="attr_ra_run_dietype">
                      <option value="d4">d4 </option>
                      <option value="d6">d6 </option>
                      <option value="d8" selected="selected">d8 </option>
                      <option value="d10">d10 </option>
                      <option value="d12">d12 </option>
                      <option value="d20">d20 </option>
                    </select>
                  </div>
                  <input type="hidden" name="attr_ra_running_formula" value="&amp;{template:emote} {{name=@{character_name}}} {{does=^{running-text-before-number} [[@{ra_vehiclepace}+@{ra_run_numdice}@{ra_run_dietype}]] ^{running-text-after-number} }}"/>
                  <button class="runbutton" type="roll" name="roll_ra_running_roll" value="@{ra_running_formula}">&nbsp;<span data-i18n="running">Running</span></button>
                </div>
                <div class="vehicleStatContainer"> 
                  <div class="vehicleCrewBox"> 
                    <input class="shipMainStatsInput" type="number" name="attr_ra_vehiclecrew"/>
                  </div>
                  <label class="shipMainStatLabel" data-i18n="crew">Crew:</label>
                </div>
              </div>
            </div>
            <div class="shipMainColumn2">
              <input class="hiddenInput" type="text" name="attr_ra_image" value="https://raw.githubusercontent.com/finderski/SWT/master/Icons/RobotArmor.png"/><img name="attr_ra_image" src="https://raw.githubusercontent.com/finderski/SWT/master/Icons/RobotArmor.png"/>
            </div>
            <div class="shipMainColumn3"> 
              <h4 class="subsectionHeader panotesheader" data-i18n="additional-info">Additional Info</h4>
              <!--embedded toughness (pilot toughness mod)
              label(data-i18n="pilot-toughness-mod" data-i18n-title="adds-directly-to-pilot-toughness-is-not-armor")
              input(type="number" name="attr_ra_embeddedtoughness" title="@{ra_embeddedtoughness}" value="0")
              -->
              <!--pilot armor
              label(data-i18n="pilot-armor-mod" data-i18n-title="adds-to-pilot-toughness-as-armor")
              input(type="number" name="attr_ra_pilotarmor" title="@{ra_pilotarmor}" value="0")
              -->
              <!--pilot skill-->
              <button class="skillbutton" type="roll" name="rolltPilotingRoll" value="@{pilotingRollValue} {{skill_roll=[[ @{pilotingSkillRollFormula} + @{ra_pilotSkillMod} [Robot Armor Enhancement]]]}} {{wild_die=[[ @{pilotingWildDieFormula} + @{ra_pilotSkillMod} [Robot Armor Enhancement]]]}}" title="tPilotingRoll}">&nbsp;<span name="attr_pilotingname"></span>&nbsp;(<span name="attr_piloting_display"></span>)</button>
              <div class="skillMod">
                <input type="number" name="attr_ra_pilotSkillMod" data-i18n-title="modifier-applied-to-pilotskill" value="0"/><span class="modLabel" data-i18n="skill-mod" data-i18n-title="mod-added-due-to-robot-armor"></span>
              </div>
              <!--Parry-->
              <div class="robotArmorParry">
                <label data-i18n="robot-armor-parry"></label>
                <input type="number" name="attr_ra_total_parry" title="@{ra_total_parry}" value="2" readonly="readonly"/>
                <!-- Robot Armor Parry Config-->
                <input class="moreConfig hiddenInput" type="checkbox" name="attr_show_ra_parry_config"/>
                <label class="configCog">
                  <input class="moreConfig" type="checkbox" name="attr_show_ra_parry_config"/>y
                </label>
                <div class="basetrait parrymodplus">
                  <h4 class="derivedStats-configHeader" data-i18n="parry-configuration">Parry Configuration</h4>
                  <label class="parryLabel" data-i18n="base">Base:</label>
                  <input class="derivedStat parryInput" type="number" name="attr_ra_base_parry" title="@{ra_parry}"/>
                  <label class="parryLabel" data-i18n="shield">Shield:</label>
                  <input class="derivedStat parryInput" type="number" name="attr_ra_shield_parry" value="0" title="@{ra_shield_parry}"/>
                  <input class="parryLabelInput" type="text" name="attr_ra_parryModReason" data-i18n-placeholder="edge-hindrance-modifier-abbr"/>
                  <input class="derivedStat parryInput inputLabel" type="number" name="attr_ra_parry_mod" value="0" title="@{ra_parryMod}"/>
                  <input class="hiddenInput" type="number" name="attr_ra_" value="0"/>
                  <fieldset class="repeating_raparrymods">
                    <div class="modifierRow">
                      <input class="parryLabelInput" type="text" name="attr_ra_parry_mod_reason_repeating" data-i18n-placeholder="edge-hindrance-modifier-abbr"/>
                      <input class="derivedStat parryInput inputLabel" type="number" name="attr_ra_parry_mod_repeating" value="0" title="@{ra_parry_mod_repeating}"/>
                    </div>
                  </fieldset>
                </div>
              </div>
              <!--Power Armor Strength-->
              <!-- +attribute(`${attribute}`)-->
              <!--input(type="hidden", value=`${name}`)-->
              <!--input(type="hidden", value=`${skillAbbr}`)-->
              <input type="hidden" value="false" name="attr_rastrength_cla"/>
              <!--input(type="hidden", value=`${chooseLinkedAttribute}`)-->
              <input type="hidden" value="str" name="attr_rastrength_lao"/>
              <!--input(type="hidden", value=`${vartype}`)-->
              <!-- Begin the Actual HTML for the Character Sheet-->
              <input class="StaticSkill hiddenInput" type="checkbox" name="attr_staticrastrength"/>
              <div class="basetrait staticRastrength" data-i18n-list-item="rastrength">
                <input class="deltabutton" type="hidden" name="attr_rastrength_delta" value="0"/>
                <input type="hidden" value="false" name="attr_rastrength_makeButton"/>
                <input type="hidden" value="string" name="attr_rastrength_mbVarType"/>
                <button class="skillbutton skillflexattbutton" type="roll" name="roll_tRastrengthRoll" value="@{rastrengthRollValue} {{skill_roll=[[ @{rastrengthSkillRollFormula} ]]}} {{wild_die=[[ @{rastrengthWildDieFormula} ]]}}" title="@{tRastrengthRoll}">&nbsp;<span name="attr_rastrengthname"></span>
                  <!--
                  if skill === "knowledgeother"
                      span(name=`attr_${skill}buttonName`, value="Skill")
                  else if skill === "language"
                      span(name=`attr_native-${skill}name`)
                  else
                      span(name=`attr_${skill}name`) 
                  
                  -->&nbsp;<span class="linkedAtt" data-i18n="str-u"></span><span class="statblock">(<span name="attr_rastrength_display"></span>)</span>
                </button>
                <input type="hidden" name="attr_rastrengthRollValue" value="@{whisperrastrength} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~tRastrengthRoll)}} {{trait=@{rastrengthname}}} @{rolltRastrength} @{setmods} @{showtraitmods} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <div class="skillRankContainer">
                  <div class="skillRankChild">
                    <input class="useAlphaNum" type="checkbox" name="attr_useAlphaNum" value="1"/>
                    <label class="skilldielabel" data-i18n-title="rastrength-die-type-d4">
                      <input class="traitradio" type="radio" name="attr_rastrength" value="4" checked="checked"/><span class="d4"></span>
                      <div class="d4a" data-i18n="d4"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="rastrength-die-type-d6">
                      <input class="traitradio" type="radio" name="attr_rastrength" value="6"/><span class="d6"></span>
                      <div class="d6a" data-i18n="d6"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="rastrength-die-type-d8">
                      <input class="traitradio" type="radio" name="attr_rastrength" value="8"/><span class="d8"></span>
                      <div class="d8a" data-i18n="d8"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="rastrength-die-type-d10">
                      <input class="traitradio" type="radio" name="attr_rastrength" value="10"/><span class="d10"></span>
                      <div class="d10a" data-i18n="d10"></div>
                    </label>
                    <label class="skilldielabel" data-i18n-title="rastrength-die-type-d12">
                      <input class="traitradio" type="radio" name="attr_rastrength" value="12"/><span class="d12"></span>
                      <div class="d12a" data-i18n="d12"></div>
                    </label>
                    <input class="traitradio" type="hidden" name="attr_rastrength" value="4"/>
                    <div class="d4Selected"><span class="d4"></span>
                      <div class="d4a" data-i18n="d4"></div>
                    </div>
                    <div class="d6Selected"><span class="d6"></span>
                      <div class="d6a" data-i18n="d6"></div>
                    </div>
                    <div class="d8Selected"><span class="d8"></span>
                      <div class="d8a" data-i18n="d8"></div>
                    </div>
                    <div class="d10Selected"><span class="d10"> </span>
                      <div class="d10a" data-i18n="d10"></div>
                    </div>
                    <div class="d12Selected"><span class="d12"></span>
                      <div class="d12a" data-i18n="d12"></div>
                    </div>
                  </div>+
                </div>
                <input class="otraitmod" type="number" name="attr_rastrengthmod" title="@{rastrengthmod}" value="0"/>
                <details>
                  <summary class="config">y</summary>
                  <div class="traitmodplus">
                    <input class="ModDesc" type="text" name="attr_rastrengthModType" placeholder="Modifier due to edges, hindrances, etc" data-i18n-placeholder="att-mod-description"/>+
                    <input class="otraitmod" type="number" name="attr_RastrengthskillMod" title="@{Rastrengthskillmod}" value="0"/>
                    <input type="hidden" name="attr_linkedrastrengthattbutton" value="@{setmodsenc}"/>
                    <input type="hidden" name="attr_linkedrastrengthattformula" value="@{ModSumEnc}[Distracted, Wounds, Fatigue, Encumbrance]"/>
                    <hr class="modsection"/>
                    <input class="whispercheck" type="checkbox" value="/w gm" name="attr_whisperrastrength"/><span class="ModDesc" data-i18n="whisper-roll-to-gm">Whisper roll to GM</span><br/>
                    <select class="traitdie" name="attr_rastrengthwilddie" title="@{rastrengthwilddie}">
                      <option value="4" data-i18n="d4">d4</option>
                      <option value="6" selected="selected" data-i18n="d6">d6</option>
                      <option value="8" data-i18n="d8">d8</option>
                      <option value="10" data-i18n="d10">d10</option>
                      <option value="12" data-i18n="d12">d12</option>
                    </select><span data-i18n="wild-die">Wild Die</span>
                    <input class="wildDieDesc" type="text" name="attr_rastrengthwilddieinfo" placeholder="Standard Wild Die die type" data-i18n-placeholder="no-modifying-edges"/><br/>
                    <input class="deltamod" type="number" name="attr_rastrength_delta" title="@{rastrength_delta}" value="0"/>
                    <label class="delta" data-i18n="die-step-delta">steps boosted/lowered from Base</label>
                    <input type="hidden" name="attr_rastrength_base"/>
                    <input type="hidden" name="attr_rastrengthmod_base"/>
                  </div>
                </details>
                <input type="hidden" name="attr_rastrength_rank" value="1d4!"/>
                <input type="hidden" name="attr_rastrength_display" value="d4"/>
                <input type="hidden" name="attr_rastrengthSkillRollFormula" value="@{rastrength_rank} + @{RastrengthskillMod} [@{rastrengthModType}] + @{linkedrastrengthattformula} + @{traitmods}"/>
                <input type="hidden" name="attr_rastrengthWildDieFormula" value="1d@{rastrengthwilddie}! + @{rastrengthmod} + @{RastrengthskillMod} [@{rastrengthModType}] + @{linkedrastrengthattformula} + @{traitmods}"/>
                <input type="hidden" name="attr_rolltRastrength" value="{{name=@{character_name} }} {{skill_rank=@{rastrength_display} }} {{mook=[[1d0+@{wdNum}]]}} @{templateConditions} {{conviction=[[ [[@{conviction}]]d6! ]] }}"/>
                <!-- attr_rollt${skillName} used to have this in the value: {{skill_roll=[[ @{${skill}SkillRollFormula} ]]}} {{wild_die=[[ @{${skill}WildDieFormula} ]]}}-->
                <!-- input(type="hidden", name="attr_athleticsrollformula", value="@{athletics_rank} + @{AthleticsskillMod}+ @{linkedathleticsattformula} + @{traitmods}")-->
                <input class="useSkillSpec hiddenInput" type="checkbox" name="attr_altRuleSkillSpec"/>
                <div class="SkillSpec">
                  <fieldset class="repeating_rastrengthspec">
                    <button class="skillbutton smallskillflexattbutton specbutton" type="roll" name="roll_tRastrengthSpecRoll" title="@{tRastrengthSpecRoll}" value="@{rastrengthSpecRollValue} {{skill_roll=[[ @{rastrengthSkillRollFormula} ]]}} {{wild_die=[[ @{rastrengthWildDieFormula} ]]}}"></button>
                    <input type="hidden" name="attr_rastrengthSpecRollValue" value="@{whisperrastrength} &amp;{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_rastrengthspec_tRastrengthSpecRoll)}} {{trait=@{rastrengthSpecName} }} @{rolltRastrength} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                    <input class="speciality" type="text" name="attr_rastrengthSpecName" title="@{repeating_rastrengthSpec_$#_SpecName}" placeholder="Specialization" data-i18n-placeholder="specialization"/>
                    <input class="hiddenInput" type="text" name="attr_rastrength_specialty_display" value="d4"/>
                  </fieldset>
                  <!--
                  fieldset(class=`repeating_${skill}spec`)
                      button(type=`roll`, class=`skillbutton smallskillflexattbutton specbutton`, name=`roll_t${skillName}SpecRoll`, title=`@{t${skillName}SpecRoll}`, value=`@{${skill}SpecRollValue}`)
                      input(type=`hidden`, name=`attr_${skill}SpecRollValue`, value=`@{whisper${skill}} &{template:roll} {{namelength=@{namelength}}} {{button=y}} {{ReRoll=^{reroll}(~repeating_${skill}spec_t${skillName}SpecRoll)}} {{trait=@{${skill}SpecName} }} @{rollt${skillName}} @{unshakeTemplate} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}`)
                      input(type=`text`, class=`speciality`, name=`attr_${skill}SpecName`, title=`@{repeating_${skill}Spec_$#_SpecName}`, placeholder=`Specialization`, data-i18n-placeholder=`specialization`)
                  -->
                </div>
              </div>
            </div>
          </div>
          <!--Armaments-->
          <label class="hideBtn">
            <input class="showHideBtn" type="checkbox" name="attr_hideWeapons" value="1"/><span class="showHideIcon"></span>
          </label>
          <h1 class="groupHeader weaponsSection" data-i18n="weapons">Weapons</h1>
          <input class="hideWeapons" type="hidden" name="attr_hideWeapons" value="0"/>
          <div class="weapons"><span class="weaponHeader weaponItem button">&nbsp;</span><span class="weaponHeader weaponItem weapon" data-i18n="weapon">Weapon</span><span class="weaponHeader weaponItem range" data-i18n="range">Range</span><span class="weaponHeader weaponItem damage" data-i18n="damage">Damage</span><span class="weaponHeader weaponItem weaponap" data-i18n="armor-piercing-abbr-u">AP</span><span class="weaponHeader weaponItem rof" data-i18n="rate-of-fire-abbr">ROF</span><span class="weaponHeader weaponItem shots" data-i18n="number-of-shots-shortened">Shots</span><span class="weaponHeader weaponItem weaponweight" data-i18n="weight-abbr">Wt</span><span class="weaponHeader weaponItem weaponcarried" data-i18n="carried">Carried</span>
            <hr class="weaponItem weapon-hr"/>
            <input type="hidden" name="attr_vbonusdamage" value="1d6"/>
            <input class="vdamage" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
            <input class="AthleticsStaticSkill hiddenButton" type="checkbox" name="attr_staticAthletics"/>
            <input class="ShootingStaticSkill hiddenButton" type="checkbox" name="attr_staticShooting"/>
            <input class="WSStaticSkill hiddenButton" type="checkbox" name="attr_staticWeirdScience"/>
            <fieldset class="repeating_raweapons">
              <!--include vehicleweaponsrepeating mixin-->
              <!-- - const section = section;-->
              <div class="weaponfull">
                <button class="weaponItem button" type="roll" name="roll_tWeapon" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand" data-i18n="attack-and-damage-abbr">Atk+Dmg</span><span class="buttondo" data-i18n="damage">Damage</span><span class="buttonma" data-i18n="multi-attack-and-damage-abbr">
                     Atk<sup>x</sup>+Dmg</span>
                </button>
                <button class="statblock miniButton" type="roll" name="roll_tWeapon2" value="@{weaponroll}"> 
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton" value="1"/><span class="buttonand crossedSwords">&#9876;&nbsp;</span><span class="buttondo dagger">&#128481;&nbsp;</span><span class="buttonma"> <span class="crossedSwords">&#9876;</span><span class="dagger">&#128481;</span>&nbsp;</span><span class="statblock" name="attr_weapon"></span><span class="statblock openParens">(</span>
                  <input class="weaponRange" type="hidden" name="attr_range"/><span class="statblock showRange">Range </span><span class="statblock showRange" name="attr_range"></span><span class="statblock showRange">, </span><span class="statblock damage" data-i18n="damage">Damage</span><span class="statblock" name="attr_weapondamage"></span><span class="statblock">)</span>
                </button>
                <button class="hiddenButton" type="roll" name="roll_dmg" value="@{damageOnly}"> </button>
                <button class="hiddenButton" type="roll" name="roll_weaponsbonusDamage" value="&amp;{template:bonusDamage} {{dieType=@{weaponsbdt}}} {{bonusDamage=[[@{vbonusdamage}!]]}}"> </button>
                <input class="weaponItem weapon" type="text" name="attr_weapon" title="@{repeating_raweapons_$#_weapon}" data-i18n-placeholder="weapon" placeholder="Weapon"/>
                <input class="weaponItem range" type="text" name="attr_range" title="@{repeating_raweapons_$#_range}" data-i18n-placeholder="range" placeholder="Range"/>
                <button class="weaponItem damage invisbutton" type="action" name="act_wdamage"> <span name="attr_weapondamage"> </span></button>
                <input type="hidden" name="attr_weapondamage" value="Str+1d4"/>
                <input class="weaponItem weaponap" type="number" name="attr_weaponap" title="@{repeating_raweapons_$#_weaponap}"/>
                <input class="weaponItem rof" type="number" name="attr_rof" title="@{repeating_raweapons_$#_rof}" data-i18n-placeholder="rate-of-fire-abbr" placeholder="ROF"/>
                <div class="weaponItem shots">
                  <input class="weaponshots" type="number" name="attr_shots" title="@{repeating_raweapons_$#_shots}"/>&nbsp;of&nbsp;
                  <input class="weaponshots" type="number" name="attr_shots_max" title="@{repeating_raweapons_$#_shots_max}"/>
                </div>
                <input class="weaponItem weaponweight" type="number" step="any" name="attr_weaponweight" title="@{repeating_raweapons_$#_weaponweight}" data-i18n-placeholder="weight-abbr" placeholder="Wt"/>
                <!-- div(class='weaponItem weaponcarried')-->
                <label class="weaponItem weaponcarried">
                  <input class="itemCarried isCarried" type="checkbox" name="attr_weaponcarried" title="@{repeating_raweapons_$#_weaponcarried}"/><span class="isCarriedIcon"> </span>
                </label>
                <input class="moreConfig hiddenInput" type="checkbox" name="attr_showweaponconfig" checked="checked"/>
                <label class="configCog">
                  <input class="moreConfig" type="checkbox" name="attr_showweaponconfig" checked="checked"/>y
                </label>
                <textarea class="weaponItem weaponnotes" name="attr_weaponnotes" title="@{repeating_raweapons_$#_weaponnotes}" data-i18n-placeholder="notes" placeholder="Notes"></textarea>
                <div class="weaponconfig">
                  <label class="configlabels configcheckbox"> 
                    <input type="checkbox" value="/w gm" name="attr_whisperweapon" title="@{repeating_raweapons_$#_whisperweapon}"/>&nbsp;<span data-i18n="whisper-roll-to-gm">Whisper roll to GM</span>
                  </label><br/>
                  <label class="configlabels" data-i18n="minimum-strength">Minimum Strength</label>
                  <input type="hidden" name="attr_minstrength" value="4"/>
                  <select class="dtype" name="attr_weaponminstrength" title="@{repeating_raweapons_$#_minstrength}"> 
                    <option value="0" data-i18n="not-applicable-abbr-u">N/A</option>
                    <option value="4" data-i18n="d4" selected="selected">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                  </select><br/>
                  <label class="configlabels" data-i18n="button-behavior">Button Behavior</label>
                  <input class="showmultiattack" type="hidden" name="attr_showmulti" value="0"/>
                  <select class="weaponbutton" name="attr_weaponbutton" title="@{repeating_raweapons_$#_weaponbutton}"> 
                    <option value="0" data-i18n="attack-and-damage-abbr">Atk + Dmg</option>
                    <option value="1" data-i18n="damage-only" selected="selected">Damage Only</option>
                    <option class="multiattack" value="2" data-i18n="multi-attack-and-damage-abbr">Atk^+Dmg</option>
                  </select>
                  <input class="weaponbutton" type="hidden" name="attr_weaponbutton"/>
                  <div class="weaponskill">
                    <label class="configlabels" data-i18n="skill">Skill</label>
                    <div class="container">
                      <div class="child">
                        <label class="ddmenu"> 
                          <input class="select-radio fighting" type="radio" name="attr_weaponskill" title="@{repeating_raweapons_$#_weaponskill}" value="fighting" checked="checked"/>&nbsp;<span name="attr_rfightingname"> </span>
                        </label>
                        <label class="ddmenu athletics"> 
                          <input class="select-radio athletics" type="radio" name="attr_weaponskill" title="@{repeating_raweapons_$#_weaponskill}" value="athletics"/>&nbsp;<span name="attr_rathleticsname"> </span>
                        </label>
                        <label class="ddmenu shooting"> 
                          <input class="select-radio shooting" type="radio" name="attr_weaponskill" title="@{repeating_raweapons_$#_weaponskill}" value="shooting"/>&nbsp;<span name="attr_rshootingname"> </span>
                        </label>
                        <label class="ddmenu"> 
                          <input class="select-radio unskilled" type="radio" name="attr_weaponskill" title="@{repeating_raweapons_$#_weaponskill}" value="unskilled"/>&nbsp;<span data-i18n="unskilled">Unskilled</span>
                        </label>
                        <label class="ddmenu weirdscience"> 
                          <input class="select-radio weirdscience" type="radio" name="attr_weaponskill" title="@{repeating_raweapons_$#_weaponskill}" value="weirdscience"/>&nbsp;<span name="attr_rweirdsciencename"> </span>
                        </label>
                        <input class="select-radio" type="hidden" name="attr_weaponskill" value="fighting"/>
                        <div class="fighting"><span name="attr_rfightingname"> </span></div>
                        <div class="athletics"><span name="attr_rathleticsname"> </span></div>
                        <div class="shooting"><span name="attr_rshootingname"> </span></div>
                        <div class="unskilled"><span data-i18n="unskilled">Unskilled</span></div>
                        <div class="weirdscience"><span name="attr_rweirdsciencename"> </span></div>
                      </div>
                    </div>
                    <label class="configlabels" data-i18n="skill-modifier">Skill Modifier</label>(
                    <input type="text" placeholder="Trademark Weapon" data-i18n-placeholder="trademark-weapon" name="attr_weaponAttackBonusReason"/>)&nbsp; 
                    <input type="number" name="attr_weaponAttackBonus" value="0"/>
                  </div>
                  <div class="weapondamage">
                    <input class="highlight" type="checkbox" name="attr_highlightdamage" value="1" style="display: none;"/>
                    <label class="configlabels" data-i18n="damage">Damage</label>
                    <select class="weaponatt" name="attr_damageatt" title="@{repeating_raweapons_$#_damageatt}"> 
                      <option value="na" data-i18n="not-applicable-abbr-u">N/A</option>
                      <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                      <option value="agility" data-i18n="agility">Agility</option>
                      <option value="smarts" data-i18n="smarts">Smarts</option>
                      <option value="spirit" data-i18n="spirit">Spirit</option>
                      <option value="vigor" data-i18n="vigor">Vigor</option>
                    </select>+
                    <input class="weaponnum" type="number" name="attr_dmgnumdice" title="@{repeating_raweapons_$#_dmgnumdice}" style="text-align: right;" value="1"/>
                    <select class="dtype" name="attr_dmgdietype" title="@{repeating_raweapons_$#_dmgdietype}"> 
                      <option value="d4!" data-i18n="d4">d4</option>
                      <option value="d6!" data-i18n="d6">d6</option>
                      <option value="d8!" data-i18n="d8">d8</option>
                      <option value="d10!" data-i18n="d10">d10</option>
                      <option value="d12!" data-i18n="d12">d12</option>
                      <option value="d20!" data-i18n="d20">d20</option>
                    </select>+
                    <input class="weaponnum" type="text" name="attr_dmgbonusnum" title="@{repeating_raweapons_$#_dmgbonusnum}"/>
                  </div>
                  <div class="vbonusdamage">
                    <label class="configlabels" data-i18n="bonus-damage-die-type">Bonus Damage Die Type</label>
                    <div class="numOfBonusDice"> 
                      <input type="number" name="attr_weaponsbdtnum" value="1"/>
                      <label class="underLabel" data-i18n="number-of-dice-abbr"># of dice</label>
                    </div>
                    <select class="dtype" name="attr_weaponsbdt" title="@{repeating_raweapons_$#_weaponsbdt}"> 
                      <option value="d4" data-i18n="d4">d4</option>
                      <option value="d6" selected="selected" data-i18n="d6">d6</option>
                      <option value="d8" data-i18n="d8">d8</option>
                      <option value="d10" data-i18n="d10">d10</option>
                      <option value="d12" data-i18n="d12">d12</option>
                      <option value="d20" data-i18n="d20">d20</option>
                    </select>
                  </div>
                </div>
                <!-- Skill Formulae-->
                <input type="hidden" name="attr_weaponUnskilledFormula" value="@{unskilledSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponUnskilledWildDieFormula" value="@{unskilledWildDieFormula}"/>
                <input type="hidden" name="attr_weaponFightingFormula" value="@{fightingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponFightingWildDieFormula" value="@{fightingWildDieFormula}"/>
                <input type="hidden" name="attr_weaponAthleticsFormula" value="@{athleticsSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponAthleticsWildDieFormula" value="@{athleticsWildDieFormula}"/>
                <input type="hidden" name="attr_weaponShootingFormula" value="@{shootingSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponShootingWildDieFormula" value="@{shootingWildDieFormula}"/>
                <input type="hidden" name="attr_weaponWeirdScienceFormula" value="@{weirdscienceSkillRollFormula}"/>
                <input type="hidden" name="attr_weaponWeirdScienceWildDieFormula" value="@{weirdscienceWildDieFormula}"/>
                <!-- Hidden Fields for the roll button(s), etc-->
                <input type="hidden" name="attr_weaponroll" value="@{damageOnly}"/>
                <!-- Used for Skill and Damage roll-->
                <input type="hidden" name="attr_skillNDamage" value="@{whisperweapon} &amp;{template:roll} {{namelength=@{namelength}}} {{trait=Fighting}} {{source=@{weapon}}} @{rolltFighting} {{skill_roll=&amp;{noerror} [[ @{weaponFightingFormula} ]]}} {{wild_die=[[ @{weaponFightingWildDieFormula} ]]}} @{unshakeTemplate} {{button=y}} {{ReRoll=^{reroll}(~repeating_raweapons_tWeapon) }} {{DmgRoll=^{roll-damage}(~repeating_raweapons_dmg) }} @{multiattack} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <!-- skillNDamage used to have @{rolltFighting}  right after {{source=@{weapon}}}-->
                <!-- Used for Multiattack-->
                <input type="hidden" name="attr_multiattack" value="0"/>
                <!-- Used for Damage Only-->
                <input type="hidden" name="attr_damageOnly" value="@{dmgTemplate}"/>
                <!-- Build the Damage Roll Template Info-->
                <!-- the damage formula-->
                <input type="hidden" name="attr_weapondmg" value="@{strength_rank}+1d4!"/>
                <!-- This will either equal @{vbonusdamage} (the default) or @{weaponsbdt}-->
                <input type="hidden" name="attr_weaponsbonusdmg" value="@{vbonusdamage}"/>
                <input type="hidden" name="attr_weaponsbonusDie" value="{{bonus_die=[[@{weaponsbonusdmg}!]]}}"/>
                <!-- how to call a button roll: ^{reroll-damage}(~repeating_${section}_dmg)-->
                <input type="hidden" name="attr_dmgTemplate" value="@{whisperweapon} &amp;{template:damage} {{namelength=@{namelength}}} {{name=@{character_name}}} {{source=@{weapon} }} {{dmg_rank=@{weapondamage}}} {{dmg_roll=[[@{weapondmg} + @{damagemods}]]}} @{weaponsbonusDie} {{showap=[[1d0+@{weaponap}]]}} {{ap=@{weaponap}}} {{notes=@{weaponnotes}}} {{button=y}} {{DmgRoll=^{reroll-damage}(~repeating_raweapons_dmg) }} @{gritty} {{GrittyRoll=[Roll Injury](~repeating_raweapons_grittyroll)}} {{conviction=[[ [[@{conviction}]]d6! ]] }} {{theme=@{rolltemplate_theme}}} {{showToken=[[0d6+@{show_token}]]}} @{roll_template_token}"/>
                <button type="roll" style="display: none;" name="roll_grittyroll" value="&amp;{template:gritty} {{name=Injury Result}} {{result=[[1t[@{injurytablename}]]]}}"> </button>
              </div>
            </fieldset>
          </div>
          <div class="shipNotes">
            <h4 class="subsectionHeader panotesheader" data-i18n="notes-and-upgrades">Notes and Upgrades</h4>
            <textarea class="vtext ranotes" name="attr_ra_vehiclenotes"></textarea>
          </div>
        </div>
      </div>
      <div class="combatoptions">
        <h1 class="groupHeader" data-i18n="combat-options-and-situational-rules">Combat Options & Situational Rules</h1>
        <div class="combatOptionDetails">
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="aim">Aim</span>: <span class="optionDescription" data-i18n="aim-description">Ignore up to 4 points of penalties from Range, Cover, Called Shot, Scale, or Speed; or add +2 to the roll. Character may not move or take other actions.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="area-of-effect">Area of Effect</span>: <span class="optionDescription" data-i18n="area-of-effect-desciption">Targets touching template suffer damage. Treat cover as Armor. Missed attack rolls may deviate.</span>
            <ul>
              <li><span class="optionSubLabel" data-i18n="without-miniatures-abbr">Without Minis</span>: <span class="optionDescription" data-i18n="without-miniatures-description">SBT affects 2 targets, MBT or Cone 3, LBT 4.</span></li>
            </ul>
          </div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="bound-and-entangled">Bound & Entangled</span>: <span class="optionDescription" data-i18n="bound-and-entangled-description">Entangled characters can’t move and are Distracted until free. Bound characters are also Vulnerable, and cannot take physical actions other than trying to break free.</span>
            <ul>
              <li><span class="optionSubLabel" data-i18n="breaking-free">Breaking Free</span>: <span class="optionDescription" data-i18n="breaking-free-description">Victim makes Athletics (or Str–2) roll as an action (an opposed roll if held by a foe). Success improves Bound to Entangled, or Entangled to free. A raise frees the victim. Either may roll Str–2 instead.</span></li>
            </ul>
          </div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="breaking-things">Breaking Things</span>: <span class="optionDescription" data-i18n="breaking-things-description">See Obstacle Hardness Table; Stationary items are Parry 2. No bonus damage or Aces are possible.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="called-shots">Called Shots</span>: <span class="optionDescription" data-i18n="called-shots-description">Limb is −2 / Hand –4 and may disarm. Head or vitals is −4 and +4 Damage.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="cover">Cover</span>: <span class="optionDescription" data-i18n="cover-description">Light −2, Medium −4, Heavy −6, Near Total −8.</span>
            <ul>
              <li><span class="optionSubLabel" data-i18n="obstacles">Obstacles</span>: <span class="optionDescription" data-i18n="obstacles-description">Obstacles add to Armor if attack misses by cover penalty. Sample values: heavy glass, doors (+2), sheet metal, heavy car door (+4), oak door, cinder block wall (+6), brick wall (+8), stone wall, tree (+10).</span></li>
            </ul>
          </div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="defend">Defend</span>: <span class="optionDescription" data-i18n="defend-description">+4 Parry. Takes entire turn and character may not run.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="disarm">Disarm</span>: <span class="optionDescription" data-i18n="disarm-description">Called shot to limb or weapon. If weapon, roll as object and target must make a Str roll ≥ than the damage or drop it. If a limb, a Shaken or Wounded defender must make a Str roll at –2 (limb) or (–4) hand or drop the item.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="distracted">Distracted</span>: <span class="optionDescription" data-i18n="distracted-description">–2 to all Trait rolls until the end of the character’s next turn.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="the-drop">The Drop</span>: <span class="optionDescription" data-i18n="the-drop-description">+4 to attack and damage if target is defenseless. If Shaken or Wounded, victim must make a Vigor roll (at –2 versus attacks to the head) or be KO’ed.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="evasion">Evasion</span>: <span class="optionDescription" data-i18n="evasion-description">Characters may avoid attacks that specifically say they may be evaded, by making an Agility roll at –2.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="fatigue">Fatigue</span>: <span class="optionDescription" data-i18n="fatigue-description">–1 to all actions (–2 if Exhausted). Fatigue improves one level every hour unless the source says otherwise. Incapacitated victims fall unconscious for 2d6 hours.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="finishing-move">Finishing Move</span>: <span class="optionDescription" data-i18n="finishing-move-description">Instant kill to helpless foe with a lethal weapon.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="free-attacks">Free Attacks</span>: <span class="optionDescription" data-i18n="free-attacks-description">The character gets to make an attack with no special maneuvers or optional combat Edges such as Frenzy or Sweep.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="ganging-up">Ganging Up</span>: <span class="optionDescription" data-i18n="ganging-up-description">+1 Fighting per additional adjacent attacker to a maximum of +4.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="grappling">Grappling</span>: <span class="optionDescription" data-i18n="grappling-description">If the attacker succeeds at an opposed Athletics roll, the victim is Entangled if successful, or Bound with a raise and the grappler is also Vulnerable.<br/><br/>Characters can't grapple creatures more than two sizes larger than themselves.</span>
            <ul>
              <li><span class="optionSubLabel" data-i18n="crush">Crush</span>: <span class="optionDescription" data-i18n="crush-description">Once grappled, the attacker may take an action to make an opposed Strength roll, causing his Strength in damage if successful (those with the Bite Special Ability may bite instead).</span></li>
            </ul>
          </div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="hold">Hold</span>: <span class="optionDescription" data-i18n="hold-description">The character “Holds” her Action Card to go later in the current or later round. She loses her Hold status if Shaken or Stunned. She may interrupt foe’s actions with an opposed Athletics roll.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="illumination">Illumination</span>: <span class="optionDescription" data-i18n="illumination-description">Dim –2; Dark –4; Pitch Darkness –6.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="improvised-weapons">Improvised Weapons</span>: <span class="optionDescription" data-i18n="improvised-weapons-description">–2 to attacks.</span>
            <ul>
              <li><span class="optionSubLabel" data-i18n="light">Light</span>: <span class="optionDescription" data-i18n="light-description">Range 3/6/12, Damage Str+d4, Min Str d4;</span></li>
              <li><span class="optionSubLabel" data-i18n="medium">Medium</span>: <span class="optionDescription" data-i18n="medium-description">Range 2/4/8, Damage Str+d6, Min Str d6;</span></li>
              <li><span class="optionSubLabel" data-i18n="heavy">Heavy</span>: <span class="optionDescription" data-i18n="heavy-description">Range 1/2/4, Damage Str+d8, Min Str d8</span></li>
            </ul>
          </div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="innocent-bystanders">Innocent Bystanders</span>: <span class="optionDescription" data-i18n="innocent-bystanders-description">Missed Athletics (throwing) / Shooting rolls with a 1 (1 or 2 for shotgun or automatic fire) on the skill die hits a random adjacent target.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="mounted-combat">Mounted Combat</span>: <span class="optionDescription" data-i18n="mounted-combat-description">Mount and rider act on same Action Card; Rider attacks with lower of Fighting or Riding; Shooting incurs –2 Unstable Platform penalty; Charging is +4 Damage but requires 6′′ of straight movement.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="multi-actions">Multi-Actions</span>: <span class="optionDescription" data-i18n="multi-actions-description">Subtract 2 from all actions for each additional action attempted beyond the first (maximum of 3).</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="natural-weapons">Natural Weapons</span>: <span class="optionDescription" data-i18n="natural-weapons-description">Creatures with fangs, claws, horns, etc, are considered armed. Bite can be performed while grappling, claws add +2 to Athletics (climbing), and horns add +4 damage if the creature Runs at least 5′′.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="nonlethal-damage">Nonlethal Damage</span>: <span class="optionDescription" data-i18n="nonlethal-damage-description">Declare prior to making an attack roll; Targets are knocked out for 1d6 hours instead of potentially killed when Incapacitated. Edged weapons suffer −1 to attack rolls.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="off-hand-attack">Off Hand Attack</span>: <span class="optionDescription" data-i18n="off-hand-attack-description">−2 to attack rolls with off hand.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="prone">Prone</span>: <span class="optionDescription" data-i18n="prone-description">Medium Cover from ranged attacks 3′′ or greater; −2 Fighting and −2 Parry. Standing cost 2” of movement.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="push">Push</span>: <span class="optionDescription" data-i18n="push-description">Attacker and defender make opposed Strength rolls (+2 if attacker moved more than 2′′). Defender is knocked back 1′′ (2′′ with raise). Pushed victims make Athletics test (−2 if Pushed with raise) or be knocked prone. Both add their shield’s Parry bonus.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="range">Range</span>: <span class="optionDescription" data-i18n="range-description">Short 0, Medium −2, Long −4, Extreme –8.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="ranged-attacks-in-melee">Ranged Attacks in Melee</span>: <span class="optionDescription" data-i18n="ranged-attacks-in-melee-description">Attacker may use power or weapon no larger than a pistol; Target Number is defender’s Parry.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="readying-weapons">Readying Weapons</span>: <span class="optionDescription" data-i18n="readying-weapons-description">May ready up to two easily available items per turn as a free action. Additional items are actions.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="recoil">Recoil</span>: <span class="optionDescription" data-i18n="recoil-description">−2 Shooting if RoF is 2 or higher.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="reload">Reload</span>: <span class="optionDescription" data-i18n="reload-description">Nocking arrow or loading sling stone is a free action once per action. Loading bolts, clips, magazine, or single bullets is an action.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="shotguns">Shotguns</span>: <span class="optionDescription" data-i18n="shotguns-description">+2 to Shooting. Damage is 3d6 at Short Range, 2d6 at Medium, and 1d6 at Long.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="size-scale">Size/Scale</span>: <span class="optionDescription" data-i18n="size-scale-description">Tiny –6, Very Small –4, Small –2, Large +2, Huge +4, Gargantuan +6. Add difference vs larger targets; Subtract difference against smaller targets.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="speed">Speed</span>: <span class="optionDescription" data-i18n="speed-description">–1 (60 MPH+), –2 (120 MPH+), –4 (240 MPH+), –6 (Mach 1+), –8 (Mach 2+), –10 (near light speed)</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="stunned">Stunned</span>: <span class="optionDescription" data-i18n="stunned-description">Victims are Distracted until they recover, fall prone, can’t move or take actions, don’t count toward the Gang Up bonus, and are subject to the Drop.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="support">Support</span>: <span class="optionDescription" data-i18n="support-description">Character describes using a skill in some way that helps an ally and adds +1 to his total with success and +2 with a raise. Critical Failure subtracts 2.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="suppressive-fire">Suppressive Fire</span>: <span class="optionDescription" data-i18n="suppressive-fire-description">Attacker places Medium Blast Template and makes Shooting roll. Each target hit by the attack total is Distracted, or hit for damage with a raise (up to the weapon’s Rate of Fire).</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="surprise">Surprise</span>: <span class="optionDescription" data-i18n="surprise-description">Ambushers start on Hold, victims make Notice roll or get no Action Card on first round.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="tests"> Tests</span>: <span class="optionDescription" data-i18n="tests-description">Describe action and make opposed skill test versus foe’s linked attribute. If successful, foe is Distracted or Vulnerable (attacker’s choice), and Shaken with a raise.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="touch-attack">Touch Attack</span>: <span class="optionDescription" data-i18n="touch-attack-description">+2 to Fighting roll.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="two-weapons">Two Weapons</span>: <span class="optionDescription" data-i18n="two-weapons-description">+1 to Fighting if foe has a single weapon, no shield, or is unarmed.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="unstable-platform">Unstable Platform</span>: <span class="optionDescription" data-i18n="unstable-platform-description">−2 Shooting from a moving vehicle, animal, or other unstable surface.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="vulnerable">Vulnerable</span>: <span class="optionDescription" data-i18n="vulnerable-description">Actions against the character are made at +2 until the end of their next turn. (Does not stack with The Drop.)</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="wild-attack">Wild Attack</span>: <span class="optionDescription" data-i18n="wild-attack-description">+2 Fighting, +2 Damage, but Vulnerable until the end of the attacker’s next turn.</span></div>
          <div class="combatoptionItem"><span class="optionLabel" data-i18n="withdrawing-from-combat">Withdrawing from Combat</span>: <span class="optionDescription" data-i18n="withdrawing-from-combat-description">Adjacent foes get one free attack at retreating character as long as they are not Shaken or Stunned.</span></div>
        </div>
      </div>
      <div class="configurationpane">
        <!-- Setting Rules-->
        <div class="configSection">
          <h3 class="configSectionTitle" data-i18n="setting-rules">Setting Rules</h3>
          <input class="usegritty hiddenInput" type="checkbox" name="attr_gritty" value="{{getgritty=gritty}}"/>
          <div class="srmconfig">
            <label class="srmItem" data-i18n-title="additional-derived-stats">
              <input type="checkbox" name="attr_showadditionalderived"/>&nbsp;<span data-i18n="additional-derived-stats">Additional Derived Stats</span>
            </label>
            <label class="srmItem" data-i18n-title="additional-derived-stats">
              <input type="checkbox" name="attr_showBurn" value="1"/>&nbsp;<span data-i18n="use-burn">Use Burn</span>
            </label>
            <label class="srmItem" data-i18n-title="additional-derived-stats">
              <input type="checkbox" name="attr_showDominion" value="1"/>&nbsp;<span data-i18n="use-dominion">Use Dominion</span>
            </label>
            <input class="useDominion" type="hidden" name="attr_showDominion" value="0"/>
            <label class="srmItem dominiontable" data-i18n-title="dominion-table-name"> <span data-i18n-title="dominion-table-name">Dominion Table Name:</span>&nbsp;
              <input class="injury" type="text" name="attr_dominion-table"/>
            </label>
            <label class="srmItem" data-i18n-title="power-pointless">
              <input class="NoPP" type="checkbox" name="attr_NoPPRule"/>&nbsp;<span data-i18n="no-power-points">No Power Points</span>
            </label>
            <label class="srmItem" data-i18n-title="gritty-damage"> 
              <input class="usegritty" type="checkbox" name="attr_gritty" value="{{getgritty=gritty}}"/>&nbsp;<span data-i18n="use-gritty-damage">Use Gritty Damage</span>
            </label>
            <input class="usegritty hiddenInput" type="checkbox" name="attr_gritty" value="{{getgritty=gritty}}"/>
            <label class="srmItem injurytable" data-i18n-title="injury-table-name">Injury Table Name: 
              <input class="injury" type="text" name="attr_injurytablename"/>
            </label>
            <label class="srmItem">
              <input class="useCharisma" type="checkbox" name="attr_paceignoreswounds"/>&nbsp;<span data-i18n="pace-ignores-wounds">Pace Ignores Wounds</span>
            </label>
            <label class="srmItem"><span data-i18n="race-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_racename"/>
            </label>
            <input class="usexp hiddenInput" type="checkbox" name="attr_usexp" value="1" checked="checked"/>
            <label class="srmItem" data-i18n-title="variable-bonus-damage-die">
              <input class="useRaiseHB" type="checkbox" name="attr_RaiseHBRule" value="1"/>&nbsp;<span data-i18n="variable-bonus-damage-raise-based">Variable Bonus Damage (Raise based)</span>
            </label>
            <input class="hiddenInput" type="checkbox" name="attr_RaiseHBRule" value="2" checked="checked"/>
            <label class="srmItem">
              <input type="checkbox" name="attr_usewealth"/>&nbsp;<span data-i18n="use-the-wealth-system">Use the Wealth System</span>
            </label>
            <input class="optional usewealth" type="checkbox" name="attr_usewealth"/>
            <div class="srmItem showwealthwilddie">
              <select class="traitdie" name="attr_wealthwilddie" title="@{wealthwilddie}">
                <option value="4" data-i18n="d4">d4</option>
                <option value="6" selected="selected" data-i18n="d6">d6</option>
                <option value="8" data-i18n="d8">d8</option>
                <option value="10" data-i18n="d10">d10</option>
                <option value="12" data-i18n="d12">d12</option>
              </select>
              <input class="ModDesc" type="text" name="attr_wealthwilddieinfo" placeholder="Wealth Wild Die die type" data-i18n-placeholder="wealth-wild-die-type"/>
            </div>
            <label class="srmItem showwealthwilddie">
              <input type="checkbox" name="attr_useWealthMod" value="1"/>&nbsp;<span data-i18n="use-wealth-modifier-field">Use the Wealth Modifier field</span>
            </label>
            <label class="srmItem multiMoney"><span data-i18n="money-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_moneyname"/>
            </label>
            <div class="srmItem multiMoney">
              <select class="traitdie" name="attr_moneyfields" title="@{wealthwilddie}">
                <option value="1" selected="selected">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
              <label class="moneycountlabel" data-i18n="number-of-money-fields">Number of money fields </label>
            </div>
            <input class="moneycount" type="hidden" name="attr_moneyfields" value="1"/>
            <label class="srmItem multiMoney money1"><span data-i18n="currency1-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_moneyonename"/>
            </label>
            <label class="srmItem multiMoney money2"><span data-i18n="currency2-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_moneytwoname"/>
            </label>
            <label class="srmItem multiMoney money3"><span data-i18n="currency3-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_moneythreename"/>
            </label>
            <label class="srmItem multiMoney money4"><span data-i18n="currency4-label">:</span>&nbsp;
              <input class="injury" type="text" name="attr_moneyfourname"/>
            </label>
            <label class="srmItem">
              <input class="useWorstNightmare" type="checkbox" name="attr_worstNightmare"/>&nbsp;<span data-i18n="show-worst-nightmare">Show Worst Nightmare</span>
            </label>
          </div>
        </div>
        <!-- Other Sheet Tweaks-->
        <div class="configSection">
          <h3 class="configSectionTitle" data-i18n="other-tweaks">Other Sheet Tweaks</h3>
          <div class="miscconfig">
            <select name="attr_atkxconfig" title="May need to change your ROF for changes to take affect.">
              <option value="0" selected="selected" data-i18n="attack-abbr-roll-query-sorted-high-to-low">Atk^ roll query sorted High to Low</option>
              <option value="1" data-i18n="attack-abbr-roll-query-sorted-low-to-high">Atk^ roll query sorted Low to High</option>
              <option value="2" data-i18n="attack-abbr-always-roll-max-no-roll-query">Atk^ always roll max (no roll query)</option>
            </select>
            <label class="miscItem">
              <input type="checkbox" name="attr_useAlphaNum" value="1"/>&nbsp;<span data-i18n="use-alphanumeric-for-traits">Use Alphanumeric lables for Trait Ranks (instead of dice icons)</span>
            </label>
            <label class="miscItem hiddenInput">
              <input class="attsatdsix" type="checkbox" name="attr_attsatdsix" value="1"/>&nbsp; <span data-i18n="attributes-start-at-d6">Attributes start at d6</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_showFear" value="1" checked="checked"/>&nbsp;<span data-i18n="show-fear-roll-button">Show Fear Roll Button</span>
            </label>
            <label class="miscItem">
              <input class="autorollbonusdmg" type="checkbox" name="attr_autorollbonusdmg" value="1" checked="checked"/>&nbsp;<span data-i18n="auto-roll-bonus-damage">Auto-roll bonus damage</span>
            </label>
            <label class="miscItem">
              <input class="hideArcanum" type="checkbox" name="attr_ArcanumTab"/>&nbsp;<span data-i18n="hide-powers-section">Hide Powers Section</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_promptmods" title="Wounds, Fatigue, Distracted, and Encumbrance are not part of Misc. Modifiers and are accounted for automatically"/>&nbsp;<span data-i18n="prompt-modifiers-text">Prompt for Misc. Modifiers</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_useBGPhysicalDesc" checked="checked"/>&nbsp;<span data-i18n="show-background-description">Show Background and Description</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_useLoad"/>&nbsp;<span data-i18n="show-load-and-encumbrance">Show Load and Encumberance</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_setrank"/>&nbsp;<span data-i18n="manually-set-rank">Manually set Rank</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_setadvance" value="1"/>&nbsp;<span data-i18n="manually-set-advances">Manually set Advances</span>
            </label>
            <label class="miscItem">
              <input type="checkbox" name="attr_showmods" checked="checked"/>&nbsp;<span data-i18n="show-modifiers">Show Modifiers For Trait Rolls</span>
            </label><!-- Hidden Fields to set whether to show mods in the Roll Template or not -->
            <input type="hidden" name="attr_setmods" value="{{mods=[[1d0+@{absmod}+abs(@{traitmods}) ]] }}"/>
            <input type="hidden" name="attr_setmodsenc" value="{{mods=[[1d0+@{absmodenc}+abs(@{traitmods}) ]] }} {{showenc=[[1d0+@{encumbrance}]]}} {{encumbrance=@{encumbrance}}}"/>
            <input type="hidden" name="attr_setdmgmods" value="{{mods=[[1d0+[[abs(@{damagemods})]] ]] }}"/><!-- Hidden Fields to set the rest of the Roll Template Information -->
            <input type="hidden" name="attr_showtraitmods" value="{{showtt=[[1d0+@{traitmods}]]}} {{ttmod=@{traitmods}}} {{showwounds=[[1d0+@{woundsMod}]]}} {{wounds=-@{woundsMod} }} {{showfatigue=[[1d0+@{fatigue}]]}} {{fatigue=-@{fatigueMod}}} {{showdistracted=[[1d0+@{distracted}]]}} {{distracted=@{distracted}}}"/>
            <input type="hidden" name="attr_showdmgmods" value="{{showdmg=[[1d0+@{damagemods}]]}} {{ttmod=@{traitmods}}}"/><!-- Hidden Fields to make Dice Rolling easier -->
            <input type="hidden" name="attr_traitmods" value="@{ttmod}"/>
            <input type="hidden" name="attr_damagemods" value="@{dmgmod}"/><!-- Absolute Values of all the different Modifier fields -->
            <input type="hidden" name="attr_absmod" value="0"/>
            <input type="hidden" name="attr_absmodenc" value="0"/><!-- End Hidden Fields -->
            <label class="miscItem">
              <input class="usePowerArmor" type="checkbox" name="attr_power_armor" value="1"/>&nbsp; <span data-i18n="show-power-armor">Show Power Armor</span>
            </label>
            <label class="miscItem">
              <input class="useQuestLog" type="checkbox" name="attr_questlog"/>&nbsp; <span data-i18n="show-quest-log">Show Quest Log</span>
            </label>
            <label class="miscItem">
              <input class="useRobotArmor" type="checkbox" name="attr_robot_Armor" value="1"/>&nbsp; <span data-i18n="show-robot-armor">Show Robot Armor</span>
            </label>
            <label class="miscItem">
              <input class="usesoakbutton" type="checkbox" name="attr_showsoak" checked="checked"/>&nbsp;<span data-i18n="show-soak-button">Show Soak Button</span>
            </label>
            <label class="miscItem">
              <input class="showSpecAbilities" type="checkbox" name="attr_showSpecAbilities" value="1"/>&nbsp;<span data-i18n="show-special-abilities">Show Special Abilities</span>
            </label>
            <label class="miscItem">
              <input class="useunshakebutton" type="checkbox" name="attr_showunshake" checked="checked"/>&nbsp;<span data-i18n="show-unshake-button">Show Unshake Button</span>
            </label>
            <label class="miscItem">
              <input class="showVehicles useVehicles" type="checkbox" name="attr_vehicle"/>&nbsp;<span data-i18n="show-the-vehicles-tab">Show the Vehicles Tab</span>
            </label>
            <input class="showVehicles hiddenInput" type="checkbox" name="attr_vehicle"/>
            <label class="miscItem">
              <input type="checkbox" name="attr_whisperstatblock" value="/w gm" checked="checked"/>&nbsp;<span data-i18n="whisper-stat-block">Whisper Stat Block</span>
            </label>
            <input type="hidden" name="attr_whisperall"/>
            <label class="miscItem"><span data-i18n="wild-card-icon">Wild Card Icon</span>: 
              <input class="wci" type="text" name="attr_WCI" maxlength="2" value="✪"/>
            </label>
            <label class="miscItem">
              <button class="APIOutput" type="roll" name="roll_apifield" value="!deal-init --help">i</button><span data-i18n="api-initiative-edge">API Iniative Edges</span>
              <input class="standard" type="text" name="attr_InitEdges" title="@{InitEdges}" style="width:140px;"/>
            </label>
            <label class="miscItem"><span data-i18n="token-url"></span>: 
              <input class="standard" type="text" name="attr_tokenURL" style="width:200px;"/>
            </label>
            <label class="miscItem"><span data-i18n="avatar-url"></span>: 
              <input class="standard" type="text" name="attr_avatarURL" style="width:200px;"/>
            </label>
            <label class="miscItem"><span data-i18n="sheet-theme">Sheet Theme </span>
              <select name="attr_sheet_theme">
                <option value="0" data-i18n="generic" selected="selected">Generic </option>
                <option value="1" data-i18n="deadlands">Deadlands</option>
                <option value="2" data-i18n="pathfinder">Pathfinder</option>
                <option value="3" data-18n="rifts">Rifts</option>
              </select>
            </label>
            <label class="miscItem"> <span data-i18n="rolltemplate-theme">Roll Template Theme </span>
              <select name="attr_rolltemplate_theme"> 
                <option value="default" data-i18n="default">Default</option>
                <option value="dlww" data-i18n="deadlands">Deadlands</option>
                <option value="swpf" data-i18n="pathfinder">Pathfinder</option>
                <option value="rifts" data-18n="rifts">Rifts</option>
                <option value="generic" data-18n="generic">Generic</option>
              </select>
            </label>
            <label class="miscItem"> 
              <input type="checkbox" name="attr_show_token" value="1"/>&nbsp;<span data-i18n="show-token-with-roll-template"></span>
            </label>
            <label class="miscItem"><span data-i18n="logo-to-show">Logo to show</span>
              <select class="gamelogo" name="attr_logo" title="@{logo}">
                <option value="SavageWorlds" data-i18n="savage-worlds" checked="checked">Savage Worlds</option>
                <option value="Deadlands" data-i18n="deadlands">Deadlands</option>
                <option value="Pathfinder" data-i18n="pathfinder-for-savage-worlds">Pathfinder for Savage Worlds</option>
                <option value="Rifts" data-i18n="rifts">Rifts</option>
                <option value="Custom" data-i18n="custom">Custom </option>
              </select>
            </label>
            <input class="showCustomLogo" type="hidden" name="attr_logo" value="SavageWorlds"/>
            <label class="miscItem customLogo"><span data-i18n="logo-url">Logo URL </span>
              <input type="text" name="attr_logoURL"/>
            </label>
            <label class="miscItem"><span data-i18n="sheet-background">Sheet Background</span>
              <select class="sheet-background" name="attr_background">
                <option class="noBackground" value="0" data-i18n="no-background-image">No Background Image</option>
                <option value="1" selected="selected" data-i18n="swade-parchment">SWADE Parchment</option>
                <option value="2" data-i18n="seamless-parchment">Seamless Parchment</option>
                <option value="3" data-i18n="gray-hex">Gray Hex </option>
                <option value="4" data-i18n="custom">Custom</option>
              </select>
            </label>
            <input class="showCustomBackground" type="hidden" name="attr_background" value="1"/>
            <label class="miscItem customBackground"><span data-i18n="background-url">Background URL </span>
              <input type="text" name="attr_backgroundurl"/>
            </label>
            <label class="miscItem darkMode">
              <input type="checkbox" name="attr_dark_mode" value="1"/>&nbsp; <span data-i18n="dark-mode-invert-colors">Dark Mode</span>
            </label>
          </div>
        </div>
        <!-- Change/Modify Skill Names-->
        <div class="configSection">
          <h3 class="configSectionTitle" data-i18n="change-slash-modify-skill-names">Change Skill Names</h3>
          <div class="csnconfig">
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="academics"> </label>= 
              <input class="csnInput" type="text" name="attr_academicsname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="athletics"> </label>= 
              <input class="csnInput" type="text" name="attr_athleticsname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="battle"> </label>= 
              <input class="csnInput" type="text" name="attr_battlename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="boating"> </label>= 
              <input class="csnInput" type="text" name="attr_boatingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="commonknowledge"> </label>= 
              <input class="csnInput" type="text" name="attr_commonknowledgename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="driving"> </label>= 
              <input class="csnInput" type="text" name="attr_drivingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="electronics"> </label>= 
              <input class="csnInput" type="text" name="attr_electronicsname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="faith"> </label>= 
              <input class="csnInput" type="text" name="attr_faithname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="fighting"> </label>= 
              <input class="csnInput" type="text" name="attr_fightingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="focus"> </label>= 
              <input class="csnInput" type="text" name="attr_focusname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="gambling"> </label>= 
              <input class="csnInput" type="text" name="attr_gamblingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="hacking"> </label>= 
              <input class="csnInput" type="text" name="attr_hackingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="healing"> </label>= 
              <input class="csnInput" type="text" name="attr_healingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="intimidation"> </label>= 
              <input class="csnInput" type="text" name="attr_intimidationname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="native-language"> </label>= 
              <input class="csnInput" type="text" name="attr_native-languagename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="notice"> </label>= 
              <input class="csnInput" type="text" name="attr_noticename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="occult"> </label>= 
              <input class="csnInput" type="text" name="attr_occultname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="performance"> </label>= 
              <input class="csnInput" type="text" name="attr_performancename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="persuasion"> </label>= 
              <input class="csnInput" type="text" name="attr_persuasionname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="piloting"> </label>= 
              <input class="csnInput" type="text" name="attr_pilotingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="psionics"> </label>= 
              <input class="csnInput" type="text" name="attr_psionicsname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="repair"> </label>= 
              <input class="csnInput" type="text" name="attr_repairname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="research"> </label>= 
              <input class="csnInput" type="text" name="attr_researchname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="riding"> </label>= 
              <input class="csnInput" type="text" name="attr_ridingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="science"> </label>= 
              <input class="csnInput" type="text" name="attr_sciencename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="shooting"> </label>= 
              <input class="csnInput" type="text" name="attr_shootingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="spellcasting"> </label>= 
              <input class="csnInput" type="text" name="attr_spellcastingname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="stealth"> </label>= 
              <input class="csnInput" type="text" name="attr_stealthname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="survival"> </label>= 
              <input class="csnInput" type="text" name="attr_survivalname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="taunt"> </label>= 
              <input class="csnInput" type="text" name="attr_tauntname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="thievery"> </label>= 
              <input class="csnInput" type="text" name="attr_thieveryname" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="trade"> </label>= 
              <input class="csnInput" type="text" name="attr_tradename" value=""/>
            </div>
            <div class="csnItem">
              <!-- .csnItem-->
              <label class="csnLabel" data-i18n="weirdscience"> </label>= 
              <input class="csnInput" type="text" name="attr_weirdsciencename" value=""/>
            </div>
            <input class="hiddenInput" type="text" name="pastrengthname" value=""/>
            <input class="hiddenInput" type="text" name="rastrengthname" value=""/>
          </div>
        </div>
        <!-- JSON Importer-->
        <div class="configSection">
          <h3 class="configSectionTitle">JSON Importer</h3>
          <textarea class="savagedUSImporter" name="attr_jsonImport" data-i18n-placeholder="savaged-us-json-format"></textarea>
        </div>
      </div>
      <div class="releasenotesTab">
        <h1 class="groupHeader documentationHeader" data-i18n="release-notes">Release Notes</h1>
        <!-- Release 1.00.31-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10031" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.31</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10031" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="encumbrance-penalty-fixes">Fixed encumbrance issues. The encumbrance penalty is no longer applied to all attributes and it now automatically subracts 2 from Pace and running rolls.</span></li>
            <li> <span class="black" data-i18n="specialization-roll">Fixed an issue where dice rolls for skill specialization were not appearing.</span></li>
            <li> <span class="black" data-i18n="token-display">Fixed a bug that showed the token on damage rolls when "Show Token with Roll Template" was unchecked.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.30-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10030" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.30</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10030" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="nature-sense">Added support for Druid Ability <em>Nature Sense</em> from Pathfinder for Savage Worlds; Survival can now be linked with Spirit instead of Smarts only.</span></li>
            <li> <span class="black" data-i18n="weapon-rate-of-fire-for-spellcasters">Fixed an issue with Rates of Fire greater than 2 for spellcasting skills (e.g. Faith, Focus, Spellcasting, etc). You may need to change the skill and change it back again for the change to take effect.</span></li>
            <li> <span class="black" data-i18n="firefox-alphanumer-trait-display">Fixed a bug in Firefox when using the Alphanumeric labels that caused the trait modifier box to wrap to the next line.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.29-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10029" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.29</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10029" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="custom-logo">Added the ability to assign your own custom logo to the sheet </span></li>
            <li> <span class="black" data-i18n="custom-background">Added the ability to assign your own custom background to the sheet </span></li>
            <li> <span class="black" data-i18n="wounds-remaining">Added a field that calculates the number of wounds remaining  </span></li>
          </ul>
        </div>
        <!-- Release 1.00.28-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10028" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.28</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10028" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="weapon-shooting-not-rolling-wild-die">Fixed an issue where rolling Shooting (or Weird Science) from a weapon was not including the Wild Die roll. This fix should automatically fix any broken skills on the sheet, but if for some reason it doesn't, simply change the skill to a different one and then switch it back.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.27-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10027" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.27</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10027" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList">
            <li><span class="black" data-i18n="add-artificer-support">Added support for the Artificer Edge and Arcane Devices; sometimes the user needs to use the Caster's arcane skill, it is now possible to designate an Arcane skill for a weapon. The skill must be checked and configured properly for it to show up in the list of options.  Because the user may be using another character's Arcane skill, it's recommended that you add that skill and configure it as temporarily boosted to get the appropriate rank. </span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="hide-arcane-skills-in-weapons">Fixed an issue where the arcane skill (Weird Science) wasn't hidden if the user didn't have Weird Science.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.26-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10026" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.26</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10026" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="statblock-view-skill-spillover">Fixed an issue where the if one had a lot of custom skills, it would not wrap properly and the skills (and potentially Hindrances and Special Abilities) would flow off the character sheet.</span></li>
            <li> <span class="black" data-i18n="unskilled-button-on-statblock-view">Fixed an issue where the Unskilled roll button was not present on the Statblock (locked) view of the character sheet.</span></li>
            <li><span class="black" data-i18n="token-in-rolltemplate-not-showing">Fixed an issue where if the character sheet didn't have a token assigned, the roll template would still attempt to show the image. Now, if a token is not assigned, the sheet will look to see if an Avatar is assigned for the character and if so, it will use that; if neither a token nor an avatar are assigned, the sheet will uncheck the setting to display the token on the roll template.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.25-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10025" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.25</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10025" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList">
            <li><span class="black" data-i18n="dark-mode-support">Added support for Darkmode in the rolltemplates </span></li>
            <li> <span class="black" data-i18n="rolltemplate-themes">Added the ability to theme the rolltemplates to match the character sheet theme</span></li>
          </ul>
        </div>
        <!-- Release 1.00.24-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10024" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.24</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10024" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="fixed-typo-wild-die">Fixed a type on the Skill Wild Die Modifier description.</span></li>
            <li> <span class="black" data-i18n="empty-rolls-when-using-statblock-view">Fixed an issue where rolls were empty if made when the sheet was in statblock view.</span></li>
            <li><span class="black" data-i18n="fixed-fear-check-roll-button">Fixed an issue with the Fear Check button was making an empty roll.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.23-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10023" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.23</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10023" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList">
            <li><span class="black" data-i18n="spirit-as-trait-for-using-powers">Added Spirit as an available Trait to select for using/casting Powers.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="attributes-roll-mods-pointed-to-agility">Fixed an issue where all attribute roll mods (associated with Edges/Hindrances) pointed to the agility roll mod.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.21-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10021" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.21</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10021" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList">
            <li><span class="black" data-i18n="sheet-themeing">Added the ability to select a theme for the character sheet.</span></li>
            <li><span class="black" data-i18n="enable-dark-mode">Added the ability to set the sheet to dark mode. This isn't a true dark mode, but merely an inversion of colors. With the current sheet themes, but can function as a quick and dirty dark mode.</span></li>
            <li> <span class="black" data-i18n="rifts-support">Added support for Rifts.</span>
              <ul> 
                <li><span class="black" data-i18n="added-power-and-robot-armor">Added support for Power and Robot Armor</span></li>
                <li><span class="black" data-i18n="added-ability-for-multiple-bonus-dice">Added the ability to roll multiple bonus dice for weapons</span></li>
                <li> <span class="black" data-i18n="added-burn">Added Burn under the Derived Stats section.</span></li>
              </ul>
            </li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="attributes-resetting-to-d6">Some have reported an issue with skills resetting to d6. While I don't believe this is related to the sheet function to start attributes at d6, to help avoid people accidentally resetting things, I've hidden the option to start attributes at d6 on the character sheet; this capability must now be done via the Sheet Settings only.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.20-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10020" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.20</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10020" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="unskilled-trait-roll-not-subtracting-two">Fixed an issue where the Unskilled "skill" roll was not subtracting 2 from the final result.</span></li>
            <li> <span class="black" data-i18n="info-template-button-formatting">Fixed an "issue" where the info rolltemplate was showing all buttons as links. By design, all buttons in this template should be links, but there may be times when you desire to use this template for a chat menu of buttons. In this case, adding {{buttonstyle=y}} to the macro will format buttons as buttons. This fix includes other, minor stying corrections for the info rolltemplate.</span></li>
            <li><span class="black" data-i18n="animalsmarts-and-statblock-to-chat-output">Fixed an issue where, when clicking the statblock to chat button, an error returns for animalsmarts_display.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.19-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10019" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.19</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10019" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNoteList">
            <li><span class="black" data-i18n="skill-modifier-in-powers">Added a skill roll modifier to the power section. This functions similar the to the Trademark Weapon field found in the Weapons section.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="custom-skills-not-showing-alphanumeric-style">Fixed an issue where the custom skill section wasn't showing the alphanumeric style for the skill rank.</span></li>
            <li> <span class="black" data-i18n="skills-not-rolling-from-powers-section">Fixed an issue where skills and Wild Die rolling from the power section wasn't working. The character sheet would output results to the chat window, but the die rolls never happened and no die results were displayed.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.18-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10018" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.18</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10018" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="multiple-3d-dice">Fixed an issue where the Skill die and the Wild/Group Die were rolling multiple 3D dice.</span></li>
            <li> <span class="black" data-i18n="missing-custom-skills">Fixed an issue Custom/Knowledge skills were missing.<br/><br/><span style='font-weight:bold;color:red;'>Warning</span>: Due to some limitations I couldn't figure out, if any of these skills were &quot;Boosted&quot; or &quot;Lowered&quot; at the time they went missing, the skill rank will reflect the boosted/lowered die type plus/minus one additional level. For example, if the skill base was d8 and it was boosed 1 level (to a d10), the skill will now reflect a d12; likewise, if the skill was a d8 and lowered 1 step, the skill will not reflect a d4 (instead of the d6). You'll know this occurred when you roll that skill (you'll see an asterisk next to the rank in the chat output). I apologize I wasn't able to care for this, but I figured it was a fringe case and I was running out of time to meet the next release window; I made the decision to deploy his patch without trying further to fix that aspect of the patch, because I figured getting the skills back on the sheet was more important. I apologize if this causes any problems for your games.<br/><br/>One other issue you may notice is the linked attribute for the skill may show 0; this a bug a that I have raised with Roll20 and nothing I can fix.</span></li>
            <li> <span class="black" data-i18n="chat-statblock-output">Fixed the issue with sending the statblock to the Chat window where fields/error were missing; clicking the statblock button at the top of the sheet should now send the statblock to chat properly.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="known-issues">Known Issues</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="custom-skill-alphanumeric">The styling for Custom/Knowledge skills when using the alphanumeric visual instead of the die type visuals is still not working; since this purely a comesmetic thing, I prioritized other issues above this one. I'll get this fixed with the next update.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.17-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10017" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.17</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10017" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="special-abilities-not-auto-showing">Fixed the issue of Special Abilities not automatically being set to show when a Special Ability is dragged and dropped onto the character sheet.</span></li>
            <li> <span class="black" data-i18n="wild-card-icon-misplaced">Fixed the issue of the Wild Card icon not being placed correctly.</span></li>
          </ul>
        </div>
        <!-- Release 1.00.16-->
        <label class="rowlabel">
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10016" value="1"/><span class="releasenotesVersion">
            <h4 class="rnversion"><span data-i18n="version"></span>1.00.16</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display:none;" name="attr_releasenotes10016" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="reworked-code-base">Re-worked the code base making it easier to maintain.</span></li>
            <li> <span class="black" data-i18n="updated-statblock-view">Updated the statblock view, making it more comprehensive and streamlined.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="statblock-view-supports-skill-specialization">Skill specializations should now work while in statblock view.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
        </div>
        <!--  Release 1.00.14 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10014" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version</span>1.00.14</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10014" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="additional-support-for-deadlands-compendium">Added additional support for the Deadlands: The Weird West compendium.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="pace-encumbrance-bug">Pace currently doesn't take into account penalties due to encumbrance; this is being worked on and will be corrected soon.</span></li>
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.13 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10013" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.13</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10013" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info"> This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="additional-support-for-deadlands-compendium">Added additional support for the Deadlands: The Weird West compendium.</span></li>
            <li> <span class="black" data-i18n="added-support-for-dominion">Added support for Dominion, including support for a rollable table</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="pace-encumbrance-bug">Pace currently doesn't take into account penalties due to encumbrance; this is being worked on and will be corrected soon.</span></li>
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.12 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10012" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.12</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10012" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="support-for-deadlands-compendium">Added support for the Deadlands: The Weird West compendium.</span></li>
            <li> <span class="black" data-i18n="additional-currency">Support for additional money/currency fields. These labels are customizeable.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="bestiary-drag-and-drop-fix">Fixed a drag and drop issue where some bestiary entries didn't have all the necessary updates. For example, Zombies Undead special ability didn't update/change the creatures Toughness, etc.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="pace-encumbrance-bug">Pace currently doesn't take into account penalties due to encumbrance; this is being worked on and will be corrected soon.</span></li>
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.11 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10011" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.11</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10011" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="avatar-url-for-compendium-macro">Fixed the issue of the missing avatar URL for the target-pic macro included with the the Savage Worlds Core Rules Bundle Compendium.</span></li>
            <li> <span class="black" data-i18n="agility-linked-skills-not-applying-encumbrance-penalty">Fixed an issue where some Agility linked skills (and all Agility-linked custom skills) weren't applying the encumbrance penalty.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="pace-encumbrance-bug">Pace currently doesn't take into account penalties due to encumbrance; this is being worked on and will be corrected soon.</span></li>
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.10 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10010" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.10</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10010" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="support-for-shields">Added support for shields.</span></li>
            <li> <span class="black" data-i18n="compendium-support">Support for Compendium drag and drop</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="encumbrance-bug">Invetigating a bug where encumbrance isn't accurately applied to Agility-linked skills (except for Fighting); in some cases, the penalty shows in the list of modifiers, though it wasn't applied to the roll.</span></li>
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.08 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10008" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.08</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10008" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Minor Enhancements and Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="token-image-url">Added an input box to capture the token image URL so it can be used in macros and the such.</span></li>
            <li> <span class="black" data-i18n="roll-template-font-improvements">Updated to the roll templates to better accomodate long names.</span></li>
            <li> <span class="black" data-i18n="variable-base-damage-dice-weapons">Entering a negative number in the base damage dice for weapons will prompt for how many dice to roll (e.g. -3 in the base damage dice will ask how many dice to roll with 3-1 being the options).</span></li>
            <li> <span class="black" data-i18n="kg-support-for-encumbrance">The encumbrance section has been updated to include the ability to calcuate based on kilograms instead of pounds.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="special-abilities-in-stat-block-macro-button">The statblock macro button has been updated to include the output of items in the Special Abilities section of the character sheet.</span></li>
            <li> <span class="black" data-i18n="custom-derived-stats-in-stat-block-macro-button">The statblock macro button has been updated to include the output of custom derived stats.</span></li>
            <li> <span class="black" data-i18n="custom-skill-rolls-in-statblock-view-fixed">Custom skill rolls were broken when trying to roll from the condensed/statblock view of the character sheet; this has been corrected.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="min-strength-enhancement">Take into account minimium strength for Armor and weapons and have modifiers automatically apply to the roll.</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
          </ul>
        </div>
        <!--  Release 1.007 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10007" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.07</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10007" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="bug-fix-release">Bug Fix Release</h2>
          <p data-i18n="bug-fix-release-info">This release focuses on Bug Fixes</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="weird-science-not-rolling">When attempting to roll Weird Science from the Power's section, the roll was empty; this has been fixed.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.06 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10006" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.06</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10006" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and minor enhancements.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="conviction-rolls">When the conviction icon is checked, all Trait and Damage rolls will include a row for Conviction with the d6 roll. This is not automatically added to the roll totals, so you will need to add that yourself.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="vigor-reroll-now-rolls-vigor">When re-rolling Vigor from the rolltemplate Agility was being rolled; this has been corrected to roll Vigor.</span></li>
            <li> <span class="black" data-i18n="unskilled-athletics-shooting-dice-in-miniview">Fixed the styling for the Unskilled, Athletics, and Shooting buttons when the sheet was in summary/statblock view.</span></li>
            <li> <span class="black" data-i18n="trademark-weapon-patch">Added a patch for weapons that stopped working with the Trademark Weapon update. While the broken weapons could be \"fixed\" by simply changing how the weapon's button works and changing it back, this patch will do that automatically for all characters so the GM and players don't have to.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.05 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10005" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.05</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10005" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and minor enhancements.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="hindrance-edge-chat-icons">Made a change to the button icons for Hindrances and Edges to make it clear whether the description will output to everyone or just a whisper to the GM. When the icon is span(class="pictos") q, the output will be to everyone. When the icon is span(class="pictos") w, the output will be a whisper to the GM.</span></li>
            <li> <span class="black" data-i18n="fear-button-enhancement">Enhanced the Fear button to roll Spirit (Fear Check) first and provide a button to roll on the Fear Table if the Spirit roll is failed.</span></li>
            <li> <span class="black" data-i18n="trademark-weapon-enhancement">Added two fields under Weapons to allow the skill roll to be modified. This would most commonly be used for Trademark Weapon, but can be used for other things, such as magic (or cursed) items that modify the attack roll, etc.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="fighting-focus-not-showing-in-statblock-view">Fixed a bug where the Fighting and Focus skills weren't showing up when the character sheet was in collapsed or "Statblock View".</span></li>
            <li> <span class="black" data-i18n="weapons-spells-damage-only-error-message">Fixed a bug for weapons and spells giving an error when they were set to roll Damage Only and the sheet was in collapsed or "Statblock View".</span></li>
            <li> <span class="black" data-i18n="athletics-electronics-not-showing-linked-attribute">Fixed a bug where the Athletics and Electronics skills weren't showing the linked attribute.</span></li>
            <li> <span class="black" data-i18n="stunned-setting-variable-type-number">Fixed a bug when selecting Stunned would set a varialbe as a Number instead of a String. It now sets it to a String to be consistent with the other variable types.</span></li>
            <li> <span class="black" data-i18n="selecting-all-wouldnt-select-core-skills">Fixed a bug where selecting All (skills) wouldn't select (or would unselect) the Core skills.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.04 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10004" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.04</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10004" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and a minor enhancement.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="stealth-rerolling-spellcasting">Fixed a bug where re-rolling Stealth tried to re-roll Spellcasting.</span></li>
            <li> <span class="black" data-i18n="fixed-styling-issues-roll-templates">Fixed some styling issues for Roll Templates.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="support-for-trademark-weapon">Support for Trademark Weapon</span></li>
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <p data-i18n="be-aware-info1">This is the initial release of this sheet. If you are coming from a different sheet, you may experience some "data loss." This data loss should be minimal if you are coming from the Savage Worlds Tabbed sheet, but will is still possible (and, in some cases, likely).</p>
          <p data-i18n="be-aware-info2">In the interest of getting this sheet out there so everyone can benefit from some of the enhanced features, we realize there are some things still missing, and some that aren't functioning exaclty right. These should be fringe cases, but wanted to make you aware. Here are some potential problems you may experience:</p>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.03 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10003" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.03</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10003" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and a minor enhancement.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="swap-swade-logo-for-deadlands-logo">Added Added the ability to swap out the Savage Worlds logo for the Deadlands logo.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="skill-selection-list-firefox">Fixed a bug where the skill selection list spilled over into a third column on Firefox.</span></li>
            <li> <span class="black" data-i18n="fighting-skill-on-older-sheets">Fighting skill should auto-show for sheets version lower than 1.00.03.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="trademark-weapon">Support for Trademark Weapon</span></li>
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <p data-i18n="be-aware-info1">This is the initial release of this sheet. If you are coming from a different sheet, you may experience some "data loss." This data loss should be minimal if you are coming from the Savage Worlds Tabbed sheet, but will is still possible (and, in some cases, likely).</p>
          <p data-i18n="be-aware-info2">In the interest of getting this sheet out there so everyone can benefit from some of the enhanced features, we realize there are some things still missing, and some that aren't functioning exaclty right. These should be fringe cases, but wanted to make you aware. Here are some potential problems you may experience:</p>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.02 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10002" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.02</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10002" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and a minor enhancement.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="fear-table-support">Added a button to roll on the Fear Table. If you don't want this button showing, it can be hidden by unchecking the box on the Configuration page, under the 'Other Sheet Tweaks' setion.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="armor-expansion-icon">Armor expansion (unhide) icon - this icon was misplaced and overlapped with the Armor heading. This has been corrected.</span></li>
            <li> <span class="black" data-i18n="toughness-going-lower-than-1">Toughness going lower than 1 - if Size (or other modifiers) could cause Toughness to go lower than one (1). This has been corrected and the lowest Toughness will go is 1.</span></li>
            <li> <span class="black" data-i18n="variable-bonus-damage-die-type-not-working">Variable bonus damage die type not working - while not strictly a bug, it was confusing, because the die type selection was always visible. Using the variable bonus die type is now selected by default so that field will always work.</span></li>
            <li> <span class="black" data-i18n="fighting-skill-visibility">Fighting skill always showing - having this skill always showing was causing confusion, the skill is now hidden by default. The character sheet has an Sheet Settings option to show this skill by default.</span></li>
            <li> <span class="black" data-i18n="rof-greater-than-six">Rate of Fire 6+ - when using the Atk^x button option with a ROF greater than 6 odd things were being displayed. This has been corrected.</span></li>
            <li> <span class="black" data-i18n="unskilled-rolls-missing-misc-modifiers">Unskilled Wild Die Rolls missing the Misc. Modifiers - when making an unskilled roll with additional modifiers, those modifiers were not being applied to the Wild Die roll. This has been corrected.</span></li>
            <li> <span class="black" data-i18n="bonus-damage-roll-not-exploding">Bonus damage not exploding - the additional d6 bonus damage was not exploding if a 6 was rolled. This has been corrected.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="trademark-weapon">Support for Trademark Weapon</span></li>
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <p data-i18n="be-aware-info1">This is the initial release of this sheet. If you are coming from a different sheet, you may experience some "data loss." This data loss should be minimal if you are coming from the Savage Worlds Tabbed sheet, but will is still possible (and, in some cases, likely).</p>
          <p data-i18n="be-aware-info2">In the interest of getting this sheet out there so everyone can benefit from some of the enhanced features, we realize there are some things still missing, and some that aren't functioning exaclty right. These should be fringe cases, but wanted to make you aware. Here are some potential problems you may experience:</p>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.01 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10001" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.01</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10001" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="minor-release">Minor Release</h2>
          <p data-i18n="minor-release-info">This release focuses on Bug Fixes and a minor enhancement.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="enhancements">enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="option-to-for-alphanumeric-rank-display-for-traits">An option has been added under Other Sheet Tweaks to allow one to use the alphanumeric rank designation (e.g. d4, d6, d8, etc.) instead of the die type icons.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="bugs-fixed">Bugs Fixed</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="manual-tracking-advances">Previously one couldn't manually enter the number of Advances; an option has been added to the Other Sheet Tweaks section to allow one to 'Manually set Advances'.</span></li>
            <li> <span class="black" data-i18n="documentation-button-works">Documentation button now works and outputs the URL to the documentation wiki.</span></li>
            <li> <span class="black" data-i18n="weird-science-now-appears-in-powers-skill-drop-down">Weird Science didn't always show as an available skill to use for casting spells when Weird Science was selected as a skill on th character sheet. This has been corrected, so if Weird Science is selected in the skills section, it will show as an option for casting powers.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="trademark-weapon">Support for Trademark Weapon</span></li>
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <p data-i18n="be-aware-info1">This is the initial release of this sheet. If you are coming from a different sheet, you may experience some "data loss." This data loss should be minimal if you are coming from the Savage Worlds Tabbed sheet, but will is still possible (and, in some cases, likely).</p>
          <p data-i18n="be-aware-info2">In the interest of getting this sheet out there so everyone can benefit from some of the enhanced features, we realize there are some things still missing, and some that aren't functioning exaclty right. These should be fringe cases, but wanted to make you aware. Here are some potential problems you may experience:</p>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
        <!--  Release 1.00.00 -->
        <label class="rowlabel"> 
          <input class="releasenotes" type="checkbox" name="attr_releasenotes10000" value="1"/><span class="releasenotesVersion"> 
            <h4 class="rnversion"> <span data-i18n="version">Version </span>1.00.00</h4></span>
        </label>
        <input class="releasenotes" type="checkbox" style="display: none;" name="attr_releasenotes10000" value="1"/>
        <div class="releasenotes"> 
          <h2 class="releaseNotesSubHeader" data-i18n="initial-release">Initial Release</h2>
          <p data-i18n="initial-release-info">This is the intial release of the Official Savage Worlds Character Sheet for Roll20. This sheet includes a lot of automation for things like Pace, Parry, and Toughness. It also keeps track of the weight carried by your character, etc.</p>
          <h2 class="releaseNotesSubHeader" data-i18n="highlights">Highlights</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="single-click-trait-assignmet">A single click will set a Trait's rank; for skills, juts hover over the Rank die type to auto-expand the selection.</span></li>
            <li> <span class="black" data-i18n="dice-rolling">All Traits can be rolled directly from the character sheet.</span></li>
            <li> <span class="black" data-i18n="bonus-dice-control">Control over whether the sheet automatically rolls bonus dice or not.</span></li>
            <li> <span class="black" data-i18n="condensed-view-of-character-sheet">A condensed view of the character sheet, making it easier to see your key Traits, weapons, and powers.</span></li>
            <li> <span class="black" data-i18n="condensed-view-of-derived-stats">A condensed view of the Derived stats (Pace, Parry, Toughness) shows only the relevant info with the ability to configure and fine-tune them.</span></li>
            <li> <span class="black" data-i18n="encumbrance-tracking">Auto-calculate Encumbrance penalties with the ability to turn Encumbrance off.</span></li>
            <li> <span class="black" data-i18n="setting-rules">The ability handle various setting rules, like Gritty Damage.</span></li>
            <li> <span class="black" data-i18n="temporary-boost-lower-traits">The ability to temporarily boost or lower traits. This is useful for things like Jack-of-All-Trades or the Boost/Lower Trait power.</span></li>
            <li> <span class="black" data-i18n="json-importer-info">A JSON importer to automate importing characters. See the documentation tab for details.</span></li>
            <li> <span class="black" data-i18n="combat-options-info">A Combat Options & Situations Rules tab; this can remind you of what your options are when your combat seems to be lagging.</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="planned-enhancements">Planned Enhancements</h2>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="trademark-weapon">Support for Trademark Weapon</span></li>
            <li> <span class="black" data-i18n="variable-base-damage">Support for variable base damage for things such as Shotguns</span></li>
            <li> <span class="black" data-i18n="multiple-vehicles">Ability to have multiple vehicles.</span></li>
            <li> <span class="black" data-i18n="character-update-via-json">Ability to update character progession via the JSON importer</span></li>
          </ul>
          <h2 class="releaseNotesSubHeader" data-i18n="things-to-be-aware-of">Things to be aware of</h2>
          <p data-i18n="be-aware-info1">This is the initial release of this sheet. If you are coming from a different sheet, you may experience some "data loss." This data loss should be minimal if you are coming from the Savage Worlds Tabbed sheet, but will is still possible (and, in some cases, likely).</p>
          <p data-i18n="be-aware-info2">In the interest of getting this sheet out there so everyone can benefit from some of the enhanced features, we realize there are some things still missing, and some that aren't functioning exaclty right. These should be fringe cases, but wanted to make you aware. Here are some potential problems you may experience:</p>
          <ul class="releaseNotesList"> 
            <li> <span class="black" data-i18n="condensed-view-and-skill-specialization">The condensed view of the character sheet has problems if you are using skill specialization. In most situations it should be fine, however, you may experience odd display issues if specializations are used.</span></li>
            <li> <span class="black" data-i18n="statblock-to-chat-log">The stat block to chat output currently doesn't support custom/additional Derived Stats, or the Special Abilities container.</span></li>
          </ul>
        </div>
      </div>
      <div class="sheetdocumentation">
        <h1 class="groupHeader documentationHeader" data-i18n="documentation">Documentation</h1>
        <h2 class="docHeading" data-i18n="introduction-shortened-u">INTRO</h2>
        <p class="docparagraph"><span data-i18n="intro-paragraph">This “in-sheet” documentation is not meant to be comprehensive, but rather highlight some features that may be less understood, but play a bigger part during a game session. For full documentation you should visit the </span>
          <button class="linkButton" type="roll" name="roll_wikiLink" value="/w @{character_name} https://wiki.roll20.net/Official_Savage_Worlds"><span data-i18n="roll20-wiki-link">Roll20 Character Sheet documentation wiki</span><span class="pictos">R</span></button>
        </p>
        <h2 class="docHeading" data-i18n="top-bar-u">TOP BAR</h2>
        <p class="docparagraph"><span data-i18n="top-bar-paragraph">This contains the buttons that allow you to navigate to different aspects/views of the character sheet.  The buttons are (from left to right):</span>
          <ul class="docList"> 
            <li class="docList" data-i18n="edit-mode-character-profile"> </li>
            <li class="docList" data-i18n="character-profile"> </li>
            <li class="docList" data-i18n="vehicle-page"> </li>
            <li class="docList" data-i18n="character-journal-notes"> </li>
            <li class="docList" data-i18n="configuration-page"> </li>
            <li class="docList" data-i18n="stat-block-ouput"> </li>
            <li class="docList" data-i18n="fear-button"> </li>
            <li class="docList" data-i18n="combat-options-and-situational-rules"> </li>
            <li class="docList" data-i18n="release-notes"> </li>
            <li class="docList" data-i18n="documentation-this-page"> </li>
          </ul>
        </p>
        <h2 class="docHeading" data-i18n="configuration-u">CONFIGURATION</h2>
        <h3 class="docSubHeading" data-i18n="setting-rules">Setting Rules</h3>
        <p class="docparagraph"><span data-i18n="setting-rules-paragraph">This section has options for various setting rules (such as Gritty Damage, No Power Points, etc).</span></p>
        <p class="docparagraph"><strong><span data-i18n="additional-derived-stats">Additional Derived Stats</span></strong>: <span data-i18n="derived-stats-paragraph">While this sheet focuses on Core Savage Worlds compliance and doesn't include any additional/custom derived stats be default, the sheet does offer an option configure your own custom derived stats. Checking the 
            <emAdditional>Derived Stats </emAdditional>checkbox, the sheet will add a section for additional derived stats. Here you can give your derived stat(s) a name and set the details for the derived stat(s). Given that various systems ahve various rules for how derived stats are calculated, none of these fields are automated, so you have maximum flexibility in tracking those stats.</span></p>
        <p class="docparagraph"><strong><span data-i18n="dominion"> </span></strong>: <span data-i18n="dominion-paragraph">Dominion will appear under the Additional Derived Stats, but the two are independent of one another. Selecting Dominion will show the Header for Additional Derived Stats, but it won't show the fields for additional derived. If you need to an additional derived stat in addition to Dominio you need to check both boxes. Selecting Dominion will also show a field for the Dominion Table Name; this is necessary for the Dominion roll button to know which rollable table to use for a Dominion roll.  This does require the GM to set up a dominion rollable to begin with.  This table name can also be identified in the game Settings as a default so the GM doesn't need to enter the table name on every inidivual character sheet.</span></p>
        <p class="docparagraph"><strong><span data-i18n="gritty-damage">Gritty Damage</span></strong>: <span data-i18n="gritty-damage-paragraph">If Gritty Damage is turned on, the GM must create a Rollable table for the Injury rolls. If this rollable table is not created and the exact name of the table entered in the Gritting Damage field for the table name, this functionality will not work.</span></p>
        <table class="infotable"> 
          <tr>
            <th class="titleLeft" colspan="3" data-i18n="injury-table">Injury Table</th>
            <th class="titleRight" colspan="2" data-i18n="rollable-table-configuration">Rollable Table Configuration</th>
          </tr>
          <tr>
            <th class="colLabels results" data-i18n="result-2d6">Result (2d6)</th>
            <th class="colLabels" data-i18n="description">Description</th>
            <th class="colLabels subeffect" data-i18n="sub-effect">Sub-effect</th>
            <th class="colLabels" data-i18n="table-entry-name">Table Entry Name</th>
            <th class="colLabels tableweight" data-i18n="table-entry-weight">Table Entry Weight</th>
          </tr>
          <tr>
            <td>2</td>
            <td data-i18n="unmentionables">Unmentionables</td>
            <td data-i18n="not-applicable-abbr-u">N/A</td>
            <td data-i18n="unmentionables-description">If the injury is permanent, reproduction is out of the question without miracle surgery or magic. There is no other effect from this result.</td>
            <td class="tableweight">12</td>
          </tr>
          <tr>
            <td>3-4</td>
            <td data-i18n="arm">Arm</td>
            <td data-i18n="left-arm">Left Arm</td>
            <td data-i18n="left-arm-description">The victim can no longer use his left arm.</td>
            <td class="tableweight">30</td>
          </tr>
          <tr>
            <td>3-4</td>
            <td data-i18n="arm">Arm</td>
            <td data-i18n="right-arm">Right Arm</td>
            <td data-i18n="right-arm-description">The victim can no longer use his right arm.</td>
            <td class="tableweight">30</td>
          </tr>
          <tr>
            <td>5-9</td>
            <td data-i18n="guts">Guts</td>
            <td data-i18n="broken">Broken</td>
            <td data-i18n="broken-description">Your hero catches one in the core. Agility reduced a die type (minimum d4).</td>
            <td class="tableweight">96</td>
          </tr>
          <tr>
            <td>5-9</td>
            <td data-i18n="guts">Guts</td>
            <td data-i18n="battered">Battered</td>
            <td data-i18n="battered-description">Your hero catches one in the core. Vigor reduced a die type (minimum d4).</td>
            <td class="tableweight">96</td>
          </tr>
          <tr>
            <td>5-9</td>
            <td data-i18n="guts">Guts</td>
            <td data-i18n="busted">Busted</td>
            <td data-i18n="busted-description">Your hero catches one in the core. Strength reduced a die type (minimum d4).</td>
            <td class="tableweight">96</td>
          </tr>
          <tr>
            <td>10-11</td>
            <td data-i18n="leg">Leg</td>
            <td data-i18n="left-leg">Left Leg</td>
            <td data-i18n="left-leg-description">Gain the Slow Hindrance (Minor), or Major if already Slow or injured in either leg.</td>
            <td class="tableweight">30</td>
          </tr>
          <tr>
            <td>10-11</td>
            <td data-i18n="leg">Leg</td>
            <td data-i18n="right-leg">Right Leg</td>
            <td data-i18n="right-leg-description">Gain the Slow Hindrance (Minor), or Major if already Slow or injured in either leg.</td>
            <td class="tableweight">30</td>
          </tr>
          <tr>
            <td>12</td>
            <td data-i18n="head">Head</td>
            <td data-i18n="hideous-scar">Hideous Scar</td>
            <td data-i18n="hideous-scar-description">A grievous injury to the head. Your hero now has the Ugly (Major) Hindrance.</td>
            <td class="tableweight">6</td>
          </tr>
          <tr>
            <td>12</td>
            <td data-i18n="head">Head</td>
            <td data-i18n="blinded">Blinded</td>
            <td data-i18n="blinded-description">A grievous injury to the head. An eye is damaged. Gain the One Eye Hindrance (or the Blind Hindrance if he only had one good eye).</td>
            <td class="tableweight">4</td>
          </tr>
          <tr>
            <td>12</td>
            <td data-i18n="head">Head</td>
            <td data-i18n="brain-damage">Brain Damage</td>
            <td data-i18n="brain-damage-description">A grievous injury to the head. Massive trauma to the head. Smarts reduced one die type (min d4).</td>
            <td class="tableweight">2</td>
          </tr>
        </table>
        <p class="docparagraph"><strong><span data-i18n="variable-bonus-damage">Variable Bonus Damage</span></strong>: <span data-i18n="variable-bonus-damage-paragraph">If a character has an Edge that alters the bonus damage die when a Raise is scored, you’ll want to select one of the Variable Bonus Damage check boxes.  The Raise Based check box will have a pop-up appear asking what Bonus Die Type to use.  If you select the Edge based one, the weapon will have a drop down for you to select the appropriate die type for that given weapon</span></p>
        <h3 class="docSubHeading" data-i18n="other-sheet-tweaks">Other Sheet Tweaks</h3>
        <p class="docparagraph"><span data-i18n="other-tweaks-paragraph">This section has options for changing how the sheet works and some of its capabilities.</span></p>
        <p class="docparagraph"><strong><span data-i18n="atk-roll-query">Atk^ roll query</span></strong>: <span data-i18n="atk-roll-paragraph1">Under weapons, if the Rate of Fire is greater than 1, you have the option of setting the weapon roll button to do auto-fire (roll multiple skill dice). This drop down menu configures the roll query to make it easier for you to do your auto-rolls.</span></p>
        <p class="docparagraph"><span data-i18n="atk-roll-paragraph2">If you have it sorted High to Low, the number of shots prompted for in the query will start at the maximum rate of fire.</span></p>
        <p class="docparagraph"><span data-i18n="atk-roll-paragraph3">If you have it sorted Low to High, the number of shots prompted for in the query will start at 1.</span></p>
        <p class="docparagraph"><strong><span data-i18n="wild-card-icon">Wild Card Icon</span></strong>: <span data-i18n="wild-card-icon-paragraph">This field can take Unicode characters and make them the Wild Card icon that appears next to the character’s name and the Stat Block Output button. Here are some unicode characters you can</span>: 
          <textarea class="configtextarea" readonly="readonly" name="attr_iconexamples">⊛ ✪ ♕ † ༒</textarea>
        </p>
        <p class="docparagraph"><strong><span data-i18n="api-initiative-edges">API Initiative Edges</span></strong>: <span data-i18n="api-edges-paragraph">For Pro subscribers, the sheet supports the Deal-Init API script. If the Script is installed, clicking the <span class="pictos">i</span>icon will output the help file to chat for that script and what to use for the Edge codes.</span></p>
        <p class="docparagraph"> <strong> <span data-i18n="sheet-theme">Sheet Theme </span></strong>:<span data-i18n="sheet-theme-paragraph">Selecting a sheet theme will set the background image, logo displayed, and any special styling associated with the theme. The theme options are: Generic (the default), Deadlands (an Old West styled theme), Pathfinder (a theme to match the Pathfinder for Savage Worlds books), and Rifts&reg; (a more sci-fi type of theme). Even if a theme is selected, you can still change the packground or logo if desired.</span></p>
        <p class="docparagraph"> <strong> <span data-i18n="dark-mode-invert-colors">"Dark" Mode (invert colors) </span></strong>:<span data-i18n="dark-mode-paragraph">This check box will invert the colors of the character sheet, making a quasi-Dark Mode. This only affects the Character Sheet tab of the character journal (Bio & Info, and Atttributes & Abilities are unaffected, unfortunately).</span></p>
        <h3 class="docSubHeading" data-i18n="json-importer">JSON Importer</h3>
        <p class="docparagraph"><span data-i18n="api-edges-paragraph1">The sheet supports importing of JSON data to pre-fill a character sheet. Currently, the sheet supports the generic VTT JSON as exported from savaged.us</span></p>
        <p class="docparagraph"><span data-i18n="api-edges-paragraph2">To import your character copy the JSON text and paste it in the JSON Importer field. Once you click out of the field, the importer will begin working. When the text disappears from the input box, the import is complete.</span></p>
        <p class="docparagraph"><strong><em><span data-i18n="note-u">NOTE</span></em></strong>: <span data-i18n="api-edges-paragraph3">Currently, the sheet only supports an initial import. If you import a second JSON (even for the same character) you will get duplication of any data in repeating sections (e.g. Hindrances, Edges, Weapons, etc).</span></p>
        <h2 class="docHeading" data-i18n="character-profile-u">CHARACTER PROFILE</h2>
        <p class="docparagraph"><span data-i18n="character-profile-paragraph">This page contains all the core stats for your character, including your character’s health.</span></p>
        <h3 class="docSubHeading" data-i18n="top-bar">Top Bar</h3>
        <p class="docparagraph"><strong><span data-i18n="edit-mode">Edit Mode </span>(<span class="pictos forestgreen">)</span>)</strong>: <span data-i18n="edit-mode-paragraph">While in “Edit” mode, the padlock icon will turn to a green and show as unlocked; all character sections are displayed so Ranks can be set, weapons and Spells configured, etc. While in this mode, each item can be expanded for customization and configuration (more on this below).</span></p>
        <p class="docparagraph"><strong><span data-i18n="stat-block-mode">Stat Block Mode </span>(<span class="pictos maroon">(</span>)</strong>: <span data-i18n="stat-block-mode-paragraph">Conversely, while in “Stat Block” mode, Attributes, Skills, Weapons, and Powers/Spells are collapsed and visible in the Left-hand column of the sheet. Each of these sections becomes a series of buttons that can be pressed to make the various rolls without all the extra space required if these sections were show in their full, editable state.</span></p>
        <p class="docparagraph"><span data-i18n="edit-stat-block-paragraph1">The “Edit/Stat Block” button is only visible while the Character Profile tab is active.</span></p>
        <p class="docparagraph"><strong><span data-i18n="important-note">Important Note</span></strong>: <span data-i18n="edit-stat-block-paragraph2">The Stat Block mode is only useful when Skill Specialization is not being used. If you are using Skill Specialization, the layout may be funky and show inconsistently. You can still use it, just know the display might not be ideal.</span></p>
        <h3 class="docSubHeading" data-i18n="hindrances-edges-special-abilities">Hindrances, Edges, and Special Abilities</h3>
        <p class="docparagraph"><strong><span data-i18n="output-buttons">Output Buttons</span></strong>: <span data-i18n="output-button-styles">The button for these three sections will ouput the description of the Hindrance, Edge, or Special Ability to the chat panel. The icon on the button serves as a visual queue as to what type of message will be sent. A double speech bubble (<span class="pictos">q</span>) indicates the output will be visible to everyone. A single speech bubble (<span class="pictos">w</span>) indicates the output will be whispered to the GM.</span></p>
        <h3 class="docSubHeading" data-i18n="weapons">Weapons</h3>
        <p class="docparagraph"><strong><span data-i18n="roll-button">Roll Button</span></strong>: <span data-i18n="roll-button-paragraph">The roll button can be configured to roll Damage Only, or Attack and Damage; if the Rate of Fire (RoF) is greater than one, an additional option can be configured for this button, denoted by Atkx + Dmg—this option will roll more than one skill die and a single Wild Die (for Wild Cards).</span></p>
        <p class="docparagraph"><em><span data-i18n="pro-tip-rate-of-fire-abbr">Pro Tip for using RoF</span></em>: <span data-i18n="pro-tip-rof-paragraph">While RoF is generally only used for automatic weapons, it can be used for melee weapons as well. This can be useful for characters how have Frenzy, or if you have a group of Extras all making the same attack roll.</span></p>
        <p class="docparagraph"><strong><span data-i18n="damage">Damage</span></strong>: <span data-i18n="damage-paragraph-updated">This consists of 4 fields.</span></p>
        <ul class="docList"> 
          <li class="docList"> <span data-i18n="attribute-field">The first can be used to configure an Attribute (generally Strength); if the weapon doesn’t use any Attributes as part of the damage formula, select N/A.</span></li>
          <li class="docList"> <span data-i18n="number-of-base-damage-dice">The second field allows you to configure the number of dice to be rolled; if a weapon does 2d6 damage, you’d enter a 2 in this field. If the weapon has a range of base damage (e.g. a shotgun has a range of 1-3d6, with the range determining the number of base damage dice to roll), enter a high end of the range as a negative number in this field. For example that shotgun base damage would be -3. When this field is populated with a negative number, the system will prompt you to confirm the number of dice to roll.</span></li>
          <li class="docList"> <span data-i18n="base-damage-die-type">The third field is where you configure the die type associated with the damage.</span></li>
          <li class="docList"> <span data-i18n="damage-modifier-field">The fourth field is a “wild card” field of sorts, you can enter any valid Roll20 entry here—not just numbers.</span></li>
        </ul>
        <p class="docparagraph"><em><span data-i18n="pro-tip-punches">Pro Tip for setting up Punches</span></em>: <span data-i18n="pro-tip-punches-paragraph">Since punches only do Strength damage and do not get the Wild Die, you can set up a Fist as a weapon and configure the damage to do Strength + 0 d6 + 0. This will roll a Strength die only.</span></p>
        <p class="docparagraph"><em><span data-i18n="pro-tip-complex-damage">Pro Tip for setting up Complex Damage</span></em>: <span data-i18n="pro-tip-complex-damage-paragraph">Some settings like Rifts do odd types of damage like 2d6 + d8. To accomplish this you would have N/A + 2d6 + 1d8! The exclamation mark tells the Roll20 dice engine to explode the die roll if the maximum number is rolled on the die. Because that field is a text field you can do any formula notation including notes for the roll. For example, the 1d8! could be written as: 1d8! [magic enchantment to do an addition d8 damage against vampires], and while that won’t all be visible, the tool tip on the roll itself would indicate what that additional d8 damage was for.</span></p>
        <h3 class="docSubHeading" data-i18n="powers">Powers</h3>
        <p class="docparagraph"><span data-i18n="powers-paragraph">This sheet allows more than Arcane Background to be configured (see below), you may have more than one set of Power Points displayed.  If you are using the No Power Points setting rule (and that option is checked on the Configuration Page), these power point fields will be hidden.</span></p>
        <p class="docparagraph"><strong><span data-i18n="powers-section-configuration-pane">Powers Section Configuration Pane</span></strong>: <span data-i18n="powers-section-config-paragraph1">The section configuration pane is accessed by clicking the crossed hammer + wrench icon (which will turn into a checkmark, and clicking the checkmark will close the configuration pane).</span></p>
        <p class="docparagraph"><span data-i18n="powers-section-config-paragraph2">This pane has two types of sections; the first configures the section headers and labels, and the second configures arcane background labels (and distinguishing colors if your character has more than one AB).</span></p>
        <p class="docparagraph"><span data-i18n="powers-section-config-paragraph3">If you have more than one arcane background and need to delete one, click the red trashcan icon under the list of ABs. The bottom most AB will be hidden.</span></p>
        <p class="docparagraph"><span data-i18n="powers-section-config-paragraph4">The sheet only allows a maximum of five (5) different Arcane Backgrounds.</span></p>
        <h2 class="docHeading" data-i18n="combat-options-page-u">COMBAT OPTIONS PAGE</h2>
        <p class="docparagraph"><span data-i18n="combat-options-paragraph1">This page contains a cheat sheet of things to try in combat to mix things up. It explains any bonuses or negative modifiers associated with the option.</span></p>
        <p class="docparagraph"><span data-i18n="combat-options-paragraph2">It also contains information on situational rules (such as Unstable platform). It’s a handy place to look if you want quick access to rules without having to jump to the rule book.</span></p>
      </div>
    </div>
  </div>
</div>
<!--rolltemplates--><rolltemplate class="sheet-rolltemplate-roll">
	{{#rollGreater() showToken 0}}
		{{#token}}
			<div class="sheet-tokenImage">
				{{token}}
			</div>
		{{/token}}
	{{/rollGreater() showToken 0}}
	<div class="sheet-templateMain{{#PowerTemplate}} sheet-powerTemplate{{/PowerTemplate}} sheet-{{theme}}">
		<div class="sheet-templateHeader">
			<h2 class="sheet-templateBlack{{#namelength}} sheet-{{namelength}}{{/namelength}}">
                {{#rollTotal() wildcard 0}}{{#wcicon}}{{wcicon}} {{/wcicon}}{{/rollTotal() wildcard 0}}{{name}}{{#rollTotal() distracteds -2}}<span class="sheet-templateCondition" data-i18n-title="distracted"> ♦</span>{{/rollTotal() distracteds -2}}{{#rollTotal() vulnerable -2}}<span class="sheet-templateCondition" data-i18n-title="vulnerable"> ♠</span>{{/rollTotal() vulnerable -2}}{{#rollTotal() stunned -2}}<span class="sheet-templateCondition" data-i18n-title="stunned"> ♣</span>{{/rollTotal() stunned -2}}
            </h2>
			<h3 class="sheet-templateBlack">({{trait}}{{#source}}: {{source}}{{/source}})</h3>
		</div>
		{{#trappings}}<h4 class="sheet-templateBlue">Trappings: {{trappings}}</h4>{{/trappings}}
		{{#rollGreater() shaken 0}}
		<div class="sheet-unshakeRow">
	       <!--[<span data-i18n="roll-unshake-button"></span>](~unshakeroll)-->
	       {{unshake}}
	    </div>
		{{/rollGreater() shaken 0}}
		<div class="sheet-templateBody">
			<div class="sheet-templateRoll sheet-trollLeft">
				<span class="sheet-rollLabel">{{skill_rank}}</span>
				<span class="sheet-rollContainer">{{skill_roll}}</span>
				{{#rollGreater() numrolls 1}}
					{{#skill_roll2}}<span class="sheet-rollContainer">{{skill_roll2}}</span>{{/skill_roll2}}
				{{/rollGreater() numrolls 1}}
				{{#rollGreater() numrolls 2}}
					{{#skill_roll3}}<span class="sheet-rollContainer">{{skill_roll3}}</span>{{/skill_roll3}}
				{{/rollGreater() numrolls 2}}
				{{#rollGreater() numrolls 3}}
					{{#skill_roll4}}<span class="sheet-rollContainer">{{skill_roll4}}</span>{{/skill_roll4}}
				{{/rollGreater() numrolls 3}}
				{{#rollGreater() numrolls 4}}
					{{#skill_roll5}}<span class="sheet-rollContainer">{{skill_roll5}}</span>{{/skill_roll5}}
				{{/rollGreater() numrolls 4}}
				{{#rollGreater() numrolls 5}}
					{{#allprops() theme skill_rank mook showtt showwounds showfatigue showdistracted showenc skill_roll skill_roll2 skill_roll3 skill_roll4 skill_roll5 name trait source PowerTemplate wild_die wild_die2 wild_die3 wild_die4 wild_die5 mods ttmod wounds fatigue distracted encumbrance notes button DmgRoll numrolls wcicon distracteds vulnerable stunned unshake ReRoll vigorStunned unshakeTemplate ap getgritty GrittyRoll skill_rollall trappings bonus_die wci showspec showap wildcard shaken namelength conviction ignoremaxheight}}<span class="sheet-rollContainer">{{value}}</span>{{/allprops() theme skill_rank mook showtt showwounds showfatigue showdistracted showenc skill_roll skill_roll2 skill_roll3 skill_roll4 skill_roll5 name trait source PowerTemplate wild_die wild_die2 wild_die3 wild_die4 wild_die5 mods ttmod wounds fatigue distracted encumbrance notes button DmgRoll numrolls wcicon distracteds vulnerable stunned unshake ReRoll vigorStunned unshakeTemplate ap getgritty GrittyRoll skill_rollall trappings bonus_die wci showspec showap wildcard shaken namelength conviction ignoremaxheight}}
				{{/rollGreater() numrolls 5}}
			</div>
			<div class="sheet-templateRoll sheet-trollRight">
				{{#^rollTotal() mook 0}}<span class="sheet-rollLabel">Wild Die</span>{{/^rollTotal() mook 0}}<!--Is a Wild Card-->
				{{#rollTotal() mook 0}}<span class="sheet-rollLabel">Group/Crit Check</span>{{/rollTotal() mook 0}}<!--Is an Extra-->
				<span class="sheet-rollContainer">{{wild_die}} </span>
				{{#wild_die2}}<span class="sheet-rollContainer">{{wild_die2}}</span>{{/wild_die2}}
				{{#wild_die3}}<span class="sheet-rollContainer">{{wild_die3}}</span>{{/wild_die3}}
				{{#wild_die4}}<span class="sheet-rollContainer">{{wild_die4}}</span>{{/wild_die4}}
				{{#wild_die5}}<span class="sheet-rollContainer">{{wild_die5}}</span>{{/wild_die5}}
			</div>
		</div>
        {{#rollGreater() conviction 0}}
        <div class="sheet-convictionRoll">
            <span class="sheet-rollLabel" data-i18n="conviction"></span>
            <span class="sheet-rollContainer">{{conviction}}</span>
        </div>
        {{/rollGreater() conviction 0}}
		<div class="sheet-buttonsnsuch">
			{{#^rollTotal() mods 0}}
			<div class="sheet-templateModifiers{{#ignoremaxheight}} nomaxheight{{/ignoremaxheight}}">
				{{#^rollTotal() showtt 0}}Misc. Modifers: {{ttmod}}{{/^rollTotal() showtt 0}}{{#^rollTotal() showwounds 0}} Wounds: {{wounds}}{{/^rollTotal() showwounds 0}}{{#^rollTotal() showfatigue 0}} Fatigue: {{fatigue}}{{/^rollTotal() showfatigue 0}}{{#^rollTotal() showdistracted 0}} Distracted: {{distracted}}{{/^rollTotal() showdistracted 0}}{{#^rollTotal() showenc 0}} Enc: {{encumbrance}}{{/^rollTotal() showenc 0}}{{#^rollTotal() actpenalty 0}} Activation Penalty: {{actpenalty}}{{/^rollTotal() actpenalty 0}}
			</div>
			{{/^rollTotal() mods 0}}
			{{#notes}}
			<div class="sheet-templateModifiers{{#ignoremaxheight}} nomaxheight{{/ignoremaxheight}}">
				{{notes}}
			</div>
			{{/notes}}
			{{#button}}
			<div class="sheet-templateButton sheet-blackButtons">
				{{ReRoll}}
				{{DmgRoll}}
			</div>
			{{/button}}
		</div>
	</div>
	{{#rollTotal() stunned -2}}
	{{#vigorStunned}}
	<div class="sheet-vigormessage">
		<span data-i18n="unstun-roll">If rolling to become unstunned, remember: A success removes the Stunned condition, but leaves the character Distracted and Vulnerable; a raise removes all conditions.</span>
	</div>
	{{/vigorStunned}}
	{{/rollTotal() stunned -2}}
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
	{{#rollGreater() showToken 0}}
		{{#token}}
			<div class="sheet-tokenImage">
				{{token}}
			</div>
		{{/token}}
	{{/rollGreater() showToken 0}}
	<div class="sheet-templateMain sheet-{{theme}}">
		<div class="sheet-templateHeader">
            {{#namelength}}
			<h2 class="sheet-{{namelength}}">
            {{/namelength}}
            {{^namelength}}
            <h2>
            {{/namelength}}
                {{#rollTotal() wildcard 0}}{{#wcicon}}{{wcicon}} {{/wcicon}}{{/rollTotal() wildcard 0}}{{name}}
            </h2>
			<h3>{{source}}{{#rollGreater() showap 0}} (<span data-i18n="armor-piercing-abbr-u">AP</span>: {{ap}}){{/rollGreater() showap 0}}</h3>
		</div>
		<div class="sheet-templateBody">
			<div class="sheet-templateRoll sheet-trollLeft">
				<span class="sheet-rollLabel">{{dmg_rank}}</span>
				<span class="sheet-rollContainer">{{dmg_roll}} </span>
				{{#dmg_roll2}}<span class="sheet-rollContainer">{{dmg_roll2}}</span>{{/dmg_roll2}}
				{{#dmg_roll3}}<span class="sheet-rollContainer">{{dmg_roll3}}</span>{{/dmg_roll3}}
				{{#dmg_roll4}}<span class="sheet-rollContainer">{{dmg_roll4}}</span>{{/dmg_roll4}}
				{{#dmg_roll5}}<span class="sheet-rollContainer">{{dmg_roll5}}</span>{{/dmg_roll5}}
			</div>
			<div class="sheet-templateRoll sheet-trollRight">
				{{#rollGreater() bonus_die 0}}
				<span class="sheet-rollLabel" data-i18n="bonus-damage">Bonus Damage</span>
				{{/rollGreater() bonus_die 0}}
				<span class="sheet-rollContainer">{{bonus_die}} </span>
				{{#bonus_die2}}<span class="sheet-rollContainer">{{bonus_die2}}</span>{{/bonus_die2}}
				{{#bonus_die3}}<span class="sheet-rollContainer">{{bonus_die3}}</span>{{/bonus_die3}}
				{{#bonus_die4}}<span class="sheet-rollContainer">{{bonus_die4}}</span>{{/bonus_die4}}
				{{#bonus_die5}}<span class="sheet-rollContainer">{{bonus_die5}}</span>{{/bonus_die5}}
			</div>
		</div>
        {{#rollGreater() conviction 0}}
        <div class="sheet-convictionRoll">
            <span class="sheet-rollLabel" data-i18n="conviction"></span>
            <span class="sheet-rollContainer">{{conviction}}</span>
        </div>
        {{/rollGreater() conviction 0}}
		<div class="sheet-buttonsnsuch">
			{{#notes}}
			<div class="sheet-templateModifiers">
				{{notes}}
			</div>
			{{/notes}}
			{{#button}}
			<div class="sheet-templateButton">
				{{DmgRoll}}
			</div>
			{{/button}}
	        {{#getgritty}}
	        <div class="sheet-templateButton">
				{{GrittyRoll}}
			</div>
	        {{/getgritty}}
	    </div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-info">
    <div class="sheet-templateMain sheet-{{theme}}">
        <div class="sheet-templateHeaderRow">
            <h2 class="sheet-templateheader">{{#rollTotal() wildcard 0}}{{#wcicon}}{{wcicon}}{{/wcicon}}{{/rollTotal() wildcard 0}}{{name}}</h2>
        </div>
        {{#item}}<h3 class="sheet-templatesubheader">{{item}}{{#type}} ({{type}}){{/type}}</h3>{{/item}}
        <div class="sheet-templatedescription{{#ignoremaxheight}} nomaxheight{{/ignoremaxheight}}">
            {{#description}}{{description}}{{/description}}
            {{#fear}}
                {{#rollLess() fear 4}}<span data-i18n="fear-table-adrenaline-surge-description" data-i18n-vars="{{fear}}"><strong>Adrenaline Surge</strong> ({{0}}): The hero’s "fight" response takes over. He acts as if he had a Joker this action!</span>{{/rollLess() fear 4}}
                {{#rollBetween() fear 4 6}}<span data-i18n="fear-table-distracted-description" data-i18n-vars="{{fear}}"><strong>Distracted</strong> ({{0}}): The hero is Distracted until the end of his next turn.</span>{{/rollBetween() fear 4 6}}
                {{#rollBetween() fear 7 9}}<span data-i18n="fear-table-vulnerable-description" data-i18n-vars="{{fear}}"><strong>Vulnerable</strong> ({{0}}): The target is Vulnerable until the end of his next turn.</span>{{/rollBetween() fear 7 9}}
                {{#rollBetween() fear 10 12}}<span data-i18n="fear-table-shaken-description" data-i18n-vars="{{fear}}"><strong>Shaken</strong> ({{0}}): The character is Shaken.</span>{{/rollBetween() fear 10 12}}
                {{#rollTotal() fear 13}}<span data-i18n="fear-table-mark-of-fear-description" data-i18n-vars="{{fear}}"><strong>The Mark of Fear</strong> ({{0}}): The hero is Stunned and suffers some cosmetic physical alteration—a white streak forms in his hair, his eyes twitch constantly, or some other minor physical alteration manifests.</span>{{/rollTotal() fear 13}}
                {{#rollBetween() fear 14 15}}<span data-i18n="fear-table-frightened-description" data-i18n-vars="{{fear}}"><strong>Frightened</strong> ({{0}}): The character gains the Hesitant Hindrance for the remainder of the encounter. If he already has it, he’s Panicked instead.</span>{{/rollBetween() fear 14 15}}
                {{#rollBetween() fear 16 17}}<span data-i18n="fear-table-panicked-description" data-i18n-vars="{{fear}}"><strong>Panicked</strong> ({{0}}): The character immediately moves his full Pace plus running die away from the danger and is Shaken.</span>{{/rollBetween() fear 16 17}}
                {{#rollBetween() fear 18 19}}<span data-i18n="fear-table-minor-phobia-description" data-i18n-vars="{{fear}}"><strong>Minor Phobia</strong> ({{0}}): The character gains a Minor Phobia Hindrance somehow associated with the trauma.</span>{{/rollBetween() fear 18 19}}
                {{#rollBetween() fear 20 21}}<span data-i18n="fear-table-major-phobia-description" data-i18n-vars="{{fear}}"><strong>Major Phobia</strong> ({{0}}): The character gains the Major Phobia Hindrance.</span>{{/rollBetween() fear 20 21}}
                {{#rollGreater() fear 21}}<span data-i18n="fear-table-heart-attack-description" data-i18n-vars="{{fear}}|{{heartattack}}"><strong>Heart Attack</strong> ({{0}}): The hero is so overwhelmed with fear that his heart stutters. He must make an immediate Vigor roll at –2. If successful, he's Stunned. If he fails, he's Incapacitated and dies in {{1}} rounds. In the latter case, a Healing roll at –4 saves his life, but he remains Incapacitated. He may be treated normally thereafter.</span>{{/rollGreater() fear 21}}
            {{/fear}}
			{{#burnroll}}
				<div class="burnroll">
					{{computed::burnroll}}
				</div>
				{{#rollGreater() computed::lastcallroll 0}}
					<div class="burnrolldesc">
						&#128128; {{lastcalldesc}} &#128128;
					</div>
				{{/rollGreater() computed::lastcallroll 0}}
			{{/burnroll}}
			{{#buttonstyle}}<div class="sheet-buttonstyle">{{/buttonstyle}}
			{{#allprops() theme description item type wildcard fear heartattack ignoremaxheight buttonstyle burnroll lastcallroll lastcalldesc}}<p><strong>{{key}}</strong><span>{{value}}</span></p>{{/allprops() theme description item type wildcard fear heartattack ignoremaxheight buttonstyle burnroll lastcallroll lastcalldesc}}
			{{#buttonstyle}}</div>{{/buttonstyle}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-description">
    <table class="sheet-templatetable">
        <tr>
            <td class="sheet-theader">
                <span style="display:block;">{{#rollTotal() wildcard 0}}{{#wcicon}}{{wcicon}}{{/wcicon}}{{/rollTotal() wildcard 0}}{{name}}</span>
                <span style="display:block;">{{item}} {{#type}}({{type}}){{/type}}</span>
            </td>
        </tr>
        <tr>
            <td>{{description}}</td>
        </tr>
    </table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-unshake">
	<div class="sheet-emoteish">
		{{name}} <span data-i18n="unshake-desc1">attempts to unshake (Spi</span>: {{skill_roll}}{{#^rollTotal() mook 0}} / <span data-i18n="unshake-desc2">Wild</span>: {{wild_die}}{{/^rollTotal() mook 0}}) <span data-i18n="unshake-desc3">and</span>
		
		
		<!-- If A Wild Card -->
		{{#^rollTotal() mook 0}}
			{{#rollGreater() skill_roll wild_die}}
				{{#rollGreater() skill_roll 3}}<span data-i18n="unshake-desc4">succeeds</span>! {{name}} <span data-i18n="unshake-desc5">can now act</span>.{{/rollGreater() skill_roll 3}}
				{{#^rollGreater() skill_roll 3}}<span data-i18n="unshake-desc6">fails</span>!{{/^rollGreater() skill_roll 3}}
			{{/rollGreater() skill_roll wild_die}}
			{{#^rollGreater() skill_roll wild_die}}
				{{#rollGreater() wild_die 3}}<span data-i18n="unshake-desc4">succeeds</span>! {{name}} <span data-i18n="unshake-desc5">can now act</span>.{{/rollGreater() wild_die 3}}
				{{#^rollGreater() wild_die 3}}<span data-i18n="unshake-desc6">fails</span>!{{/^rollGreater() wild_die 3}}
			{{/^rollGreater() skill_roll wild_die}}
		{{/^rollTotal() mook 0}}
		<!-- If an Extra -->
		{{#rollTotal() mook 0}}
			{{#rollGreater() skill_roll 3}}<span data-i18n="unshake-desc4">succeeds</span>! {{name}} <span data-i18n="unshake-desc5">can now act</span>.{{/rollGreater() skill_roll 3}}
			{{#^rollGreater() skill_roll 3}}<span data-i18n="unshake-desc6">fails</span>!{{/^rollGreater() skill_roll 3}}
		{{/rollTotal() mook 0}}
		
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-running">
	<div class="sheet-emoteish">
		{{name}} <span data-i18n="runs">runs for</span> {{roll}} <span data-i18n="inches">inches</span>.
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-consumables">
    <div class="sheet-emoteish">
		{{name}} <span data-i18n="consumable-roll-text" data-i18n-vars="{{consumable}}">rolls for {{0}} consumption and gets a</span> {{roll}}.
	</div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-emote">
	<div class="sheet-emoteish">
		{{name}} {{does}}
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-gritty">
    <div class="sheet-card">
        <h2 data-i18n="injury-roll">Injury Roll</h2>
        <div class='sheet-injuryresult'>{{result}}</div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-statblock">
    <div class="sheet-statblockheader">
        <h2 class="sheet-fullwidth">{{#rollTotal() wildcard 0}}{{#wcicon}}{{wcicon}}{{/wcicon}}{{/rollTotal() wildcard 0}}{{name}}</h2>
    </div>
    <div class="sheet-statblockbod">
        {{#description}}<div class="sheet-justify">{{description}}</div>{{/description}}
        {{#charatts}}<div class="sheet-bodsection">**<span data-i18n="attributes">Attributes</span>**: {{charatts}}</div>{{/charatts}}
        {{#charskills}}<div class="sheet-bodsection">**<span data-i18n="skills">Skills</span>**: {{charskills}}</div>{{/charskills}}
        {{#charderived}}<div class="sheet-bodsection">{{charderived}}</div>{{/charderived}}
        {{#chargear}}<div class="sheet-bodsection">**<span data-i18n="gear">Gear</span>**: {{chargear}}</div>{{/chargear}}
        {{#charhindrances}}<div class="sheet-bodsection">**<span data-i18n="hindrances">Hindrances</span>**: {{charhindrances}}</div>{{/charhindrances}}
        {{#charedges}}<div class="sheet-bodsection">**<span data-i18n="edges">Edges</span>**: {{charedges}}</div>{{/charedges}}
		{{#rollGreater() showspec 0}}{{#charspecabilities}}<div class="sheet-bodsection">**<span data-i18n="special-abilities">Special Abilities</span>**:<!--<br />--><ul>{{charspecabilities}}</ul></div>{{/charspecabilities}}{{/rollGreater() showspec 0}}
		{{#rollGreater() powercount 0}}<div class="sheet-bodsection">{{charpowers}}</div>{{/rollGreater() powercount 0}}
    </div>
</rolltemplate>

<!-- {{name=Bonus Damage}} {{dieType=@{weaponsbdt}}} {{bonusDamage=[[@{vbonusdamage}!]]}} -->
<rolltemplate class="sheet-rolltemplate-bonusDamage">
    <div class="sheet-templateMain">
        <span class="sheet-rollDieType" data-i18n="bonus-damage">Bonus Damage</span> <span class="sheet-rollDieType">({{dieType}}):</span> <span class="sheet-rollContainer">{{bonusDamage}}</span>
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-debug">
	{{#rollLess() distracted -1}}<span class="sheet-templateCondition" data-i18n-title="distracted">♦</span>{{/rollLess() distracted -1}}{{#rollTotal() vulnerable -2}}<span class="sheet-templateCondition" data-i18n-title="vulnerable">♠</span>{{/rollTotal() vulnerable -2}}{{#rollTotal() stunned -2}}<span class="sheet-templateCondition" data-i18n-title="stunned">♣</span>{{/rollTotal() stunned -2}}
</rolltemplate>
