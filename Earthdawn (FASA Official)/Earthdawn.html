
<!DOCTYPE html>
<meta charset="UTF-8">

<!--
v2.07

Character Sheet For Earthdawn Developped by JBF (Discord/Facebook Jiboux Faure) v2.
Largerly using material from the work on the Official FASA version of Chris Dickey
Whenever possible I kept the original comments of Chris, prefixing them with CD to identify pieces of code that were unchanged
Version of my code are prefixed JBF, usually with YYMMDD for me to remember the versioning
Comments JBF@JBF are actions/reminder to myself
Comments JBF@CD are action/reminders to Chris
-->

<!--  Note, this is a generic roll that can be pasted into a macro. Store it here to be handy.
&{template:default} {{name=Misc Roll}} {{Step: [[?{Step|8}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}
-->


<div class="sheet-user-root">
  <div class="sheet-user-root-in" >

              <!-- These are all defined elsewhere, but tested here at the start of the file so that anywhere in the file one can mearly add a HideIfNotHuman tag to any element -->
    <input name="attr_API"              class="sheet-testAPI"         type="hidden" value="0">
    <input name="attr_CreationMode"     class="sheet-testCreation"    type="hidden" value="0">
    <input name="attr_edition"          class="sheet-testEdition"     type="hidden" value="4">
    <input name="attr_IsPath"           class="sheet-testPath"        type="hidden" value="0">
    <input name="attr_IsQuestor"        class="sheet-testQuest"       type="hidden" value="0">
    <input name="attr_NbDisc"           class="sheet-testNbDisc"      type="hidden" value="0">      <!-- NbDisc is Number of Disciplines -->
    <input name="attr_NPC"              class="sheet-testNPC"         type="hidden" value="1">
    <input name="attr_Race"             class="sheet-testRace"        type="hidden" value="None">
    <input name="attr_show_karma_auto"  class="sheet-testKarmaAuto"   type="hidden" value="1">
    <input name="attr_StepDisplayFinal" class="sheet-testStepDisplay" type="hidden" value="1">
    <input name="attr_tab"              class="sheet-tabMain"         type="hidden" value="11">


    <!--***********************************Start of Header***************************-->

    <div class="sheet-header-flex-container">
      <div class="sheet-flex-container sheet-w100p">
        <!--Header - Karma Box-->
        <input type="hidden" name="attr_KarmaRitual-Rank" value="0"><!-- This is only used for the NewDay button if the Karma Ritual mode is used-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
            <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont sheet-button-nodice" name="roll_KarmaOnlyNoAPI" type="roll"
            value="@{RollType} &amp;{template:default} {{name=Karma Only}} {{Step: [[@{KarmaStep}]]}} {{Result: [[ [[floor({@{KarmaStep}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{@{KarmaStep}, 0}kh1]] ]]d4! - [[{1, 2}=[[{@{KarmaStep}, 0}kh1]] * (3 - [[{@{KarmaStep}, 0}kh1]])]] ]]}}"
            title="%{selected|KarmaOnlyNoAPI}   Roll a single Karma Die only." > &nbsp;Karma</button>

            <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont sheet-button-nodice" name="roll_KarmaOnly"
            type="roll"
            value="!Earthdawn~ charID: @{character_id}~ Reason: 1 Karma Only~ foreach~ Karma: 1~ Roll: 0"
            title="%{selected|KarmaOnly}   Roll a single Karma Die only.">&nbsp;Karma</button>

            <!-- <label title="@{show-karma-parameters}   Parametrize the way Karma behaves" >
              <input type="checkbox" name="attr_show-karma-parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white sheet-iconpaddedright" ></span>
            </label> -->
          </div>

          <div class="sheet-flex-container" >
            <div style="max-width:50px;">
              <div class="sheet-imgbox sheet-icon-karma-background" >
                <div class="sheet-imgbox-content">
                  <input name="attr_Karma" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Karma}:   How many karma points the character currently has left unspent.">
                </div>
                <div class="sheet-undernumber">
                  <span class="sheet-label-flex"> / </span>
                  <input name="attr_Karma_max"
                  value="0" min="0" readonly="readonly"       class="sheet-numShorter sheet-small"
                  title="@{Karma_max}:   Maximum Karma. It is your races karma modifier times your circle, plus any leftover Attribute points from character creation."
                  type="number">
                  <input name="attr_Karma_Modifier"  type="hidden">
                </div>
              </div>
            </div>

            <div style="max-width:32px;" class="sheet-api">
              <!--KarmaGlobalMode controls (with API) how Karma is spent on rolls. When KarmaGlobalMode is in Auto, every roll will automatically spend Karma as per its local Karma selector stored in XXX_Karma
              When KarmaGlobalMode is Ask, a pop up window will ask how many Karma to add to the Roll up to XXX_Karma-Limit_max-->
              <label style="padding-top:0px;margin-top:-4px;" title="@{KarmaGlobalMode} ASK : Toggle Karma Ask mode, where on every Test where Karma can be used, a prompt will ask for number of Karma Points">
                <input type="checkbox" name="attr_KarmaGlobalMode" value="?" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-karma-ask"></span>
              </label>
              <br>
              <input type="checkbox" name="attr_show_karma_auto" value="1" class="sheet-testCloseChecked" hidden>
              <label class="sheet-HideIfNotCloseChecked" title="@{KarmaGlobalMode} AUTO :Toggle Automatic Use of Karma on all Tests Parametrized for Auto-Karma">
                <input type="checkbox" name="attr_KarmaGlobalMode" value="x" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-karma-on"></span>
              </label>
            </div>

          </div>
        </div>
        <!--End of Karma Box-->

        <!--Header - Devotion Box-->
        <div class="sheet-header-box sheet-HideIfNotQuest sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
            <button class="sheet-text-button-header ui-draggable sheet-api sheet-button-nodice sheet-fancyfont"
                name="roll_DevotionOnly"
                type="roll"
                value="!Earthdawn~ charID: @{character_id}~ Reason: 1 Devotion Point Only~ foreach~ DP: 1~ Roll: 0"
            title="%{selected|DevotionOnly}   Roll a single Devotion Point Die only.">&nbsp;Devotion</button>

            <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_DevotionOnlyNoAPI"
                type="roll"
                value="@{RollType} &amp;{template:default} {{name=Dev Pnt only}} {{Step: [[@{DevotionStep}]]}} {{Result: [[ [[floor({@{DevotionStep}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{@{DevotionStep}, 0}kh1]] ]]d4! - [[{1, 2}=[[{@{DevotionStep}, 0}kh1]] * (3 - [[{@{DevotionStep}, 0}kh1]])]] ]]}}"
            title="%{selected|DevotionOnlyNoAPI}   Roll a single Devotion Point Die only.">&nbsp;Devotion</button>
            <!-- <label title="@{show-DP-parameters}   Parametrize the way devotion behaves" >
              <input type="checkbox" name="attr_show-DP-parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white sheet-iconpaddedright"></span>
            </label> -->
          </div>

          <div class="sheet-flex-container">
            <div style="max-width:50px;">
              <div class="sheet-imgbox sheet-icon-devotion-background" >
                <div class="sheet-imgbox-content">
                  <input name="attr_DP" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{DP}:   How many DP (Questor Devotion Points) the character currently has left unspent.">
                </div>
                <div class="sheet-undernumber" title="@{DP_max}:   Maximum DP (Devotion Points). It is 10 times you Questor Rank. Questor Rank is recorded under 'Circle' in Discipline/Questor.">
                  <span class="sheet-label-flex"> / </span>
                  <input name="attr_DP_max"
                      value="0"
                      min="0"
                      readonly="readonly"
                      class="sheet-numShorter sheet-small"
                  type="number">
                </div>
              </div>
            </div>
            <div style="max-width:32px;" class="sheet-api">
              <label title="@{DPGlobalMode} ASK:  Toggle Devotion Points use to Ask mode, where on every Test where DP can be used, a prompt will ask for number of DP">
                <input type="checkbox" name="attr_DPGlobalMode" value="?" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-devotion-ask"></span>
              </label>
              <br>
              <input type="checkbox" name="attr_show_karma_auto" value="1" class="sheet-testCloseChecked" hidden>
              <label class="sheet-HideIfNotCloseChecked" title="@{DPGlobalMode} AUTO :  Toggle Automatic Use of Devotion Points on all Tests Parametrized for Auto-DP">
                <input type="checkbox" name="attr_DPGlobalMode" value="x" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-devotion-on"></span>
              </label>
            </div>
            <!-- <input type="checkbox" name="attr_show-DP-parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked sheet-small" style="flex:1;">
              <div>
                Max-Adj:
                <input name="attr_Misc-DP_max-Adjust" type="number" value="0" class="sheet-numShort sheet-small" title="@{Misc-DP_max-Adjust}:   Adjustment to Devotion Max.">
              </div>
              <div>

                <select name="attr_DevotionStep" class="sheet-small" style="width:5.5em;" title="@{DevotionStep}   What devotion dice does this character roll">
                  <option value="3" selected="selected" title="D4 - Step 3.">S3: D4</option>
                  <option value="4" title="D6 - Step 4.">S4:  D6</option>
                  <option value="5" title="D8 - Step 5.">S5: D8</option>
                  <option value="6" title="D10 - Step 6.">S6: D10</option>
                  <option value="7" title="D12 - Step 7.">S7: D12</option>
                  <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                  <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                  <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                  <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                  <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                  <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                  <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                  <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                  <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                  <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                  <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                  <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                  <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                </select>
              </div>
            </div> -->
          </div>
        </div>
        <!--End of Devotion Box-->

        <!--Header - Recovery Box-->
        <div>
          <div class="sheet-header-box sheet-background-frame6 sheet-frame">
            <div class="sheet-headerbar">
              <button class="sheet-text-button-header sheet-api sheet-fancyfont sheet-button-nodice"
                  name="roll_Recovery"
                  type="roll"
                  value="!Earthdawn~ charID: @{character_id}~  foreach~ mod: -?{How many wounds not treated by Physician|@{Wounds}} ~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Recovery-Karma-Ask}: @{DPGlobalMode}@{Recovery-DP-Ask} ~Value: Recovery-Step  ~ Roll "
              title="%{selected|Recovery} Roll a Recovery Test for this Character.">  Rec: <input name="attr_Recovery-Step" class="sheet-numShorter" type="number" value="5" style="color:white; height: 16px; margin:0px;" readonly title="@{Recovery-Step}  Recovery Step." ></button>

              <button class="sheet-text-button-header sheet-NoAPI sheet-fancyfont sheet-button-nodice" name="roll_Recovery-NoAPI" type="roll"
                  value="@{RollType} &amp;{template:default} {{name=Recovery Test}} {{Step: [[?{Step|@{Recovery-Step}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] -@{Wounds} ]]}}"
                  title="%{selected|Recovery-NoAPI} Roll a Recovery Test for this Character.">Rec:
                  <input name="attr_Recovery-Step" class="sheet-numShorter" style="color:white; height: 16px; margin:0px;"
                  type="number" value="5" readonly title="@{Recovery-Step}  Recovery Step."></button>
            </div>

            <div class="sheet-flex-container">
              <div class="sheet-flex1">
                <div class="sheet-imgbox sheet-icon-recovery-background" >
                  <div class="sheet-imgbox-content">
                    <input name="attr_Recovery-Tests" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Recovery-Tests}:   Number of Remaining Recovery Tests for today.">
                  </div>
                  <div class="sheet-undernumber">
                    <span class="sheet-label-flex"> /</span>
                    <input name="attr_Recovery-Tests_max" readonly="readonly" value="2"
                        class="sheet-numShorter sheet-small"
                        title="@{Recovery-Tests_max}  Number of Recovery Tests that can be used per day."
                        type="number">
                  </div>
                </div>
              </div>
              <div class="sheet-flex1">
                <!--JBF Karma Toggle-Simple-->
                <input type="checkbox" name="attr_Recovery-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                  <input type="hidden" name="attr_Recovery-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Recovery-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Recovery-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On" >
                        <input type="checkbox" name="attr_Recovery-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Recovery-Karma} : Number of Karma Points to be spent when Karma is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Recovery-Karma} Don't Spend any Karma when Karma is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                        </span>
                        <input type="hidden" name="attr_Recovery-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                        <input type="hidden" name="attr_Recovery-Karma-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Recovery-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Recovery-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>

                      </span>
                    </span>
                  </span>
                </span>
                <!--JBF End Of Karma Toggle-Simple-->
                <br>
                <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                  <input type="hidden" name="attr_Recovery-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Recovery-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Recovery-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Recovery-DP}   Automatically Spends One Devotion when Devotion is On" >
                        <input type="checkbox" name="attr_Recovery-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Recovery-DP} : Number of Devotion Points to be spent when Devotion is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Recovery-DP} Don't Spend any Dp when Dp is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On"></span>
                        </span>
                        <input type="hidden" name="attr_Recovery-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                        <input type="hidden" name="attr_Recovery-DP-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Recovery-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Recovery-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>
                <!--JBF End Of DP Toggle-->
              </div>
            </div>
          </div>
        </div>
        <!--JBF End of Recovery Box-->

        <!--Header - Wounds Box-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame">
          <div>
            <div class="sheet-headerbar" style="font-size:130%;"> Wounds </div>
          </div>
          <div class="sheet-imgbox sheet-icon-wounds-background" >
            <div class="sheet-imgbox-content">
              <input name="attr_Wounds" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Wounds}:  Number of Wounds character currently has.">
              <input name="attr_Wounds_max" class="sheet-hidden" value="8" title="@{Wounds_max}:  Made up number to give something for the Wounds bar (bar2) to measure against."
              type="number">
            </div>
            <div class="sheet-undernumber">
              <span class="sheet-label-flex">Tr: </span>  <input name="attr_Wound-Threshold" readonly="readonly" value="7" class="sheet-numShorter sheet-small"
              title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test."
              type="number">
            </div>
          </div>
        </div>
        <!--JBF End of Wounds Box-->


        <!--Header - Wounds Treshold Box-->
        <input type="checkbox" name="attr_show_wound_treshold" class="sheet-hidden sheet-testCloseChecked" value="1">
        <div class="sheet-header-box sheet-background-frame6 sheet-frame sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar" style="font-size:130%;"> Wnd Tres </div>
            <div class="sheet-imgbox-content">
              <span class="sheet-stepSpan sheet-bordered-bottom">
                <input name="attr_Wound-Threshold" readonly class="sheet-Bigger sheet-numHighlight sheet-StepBig sheet-StepBase" value="5" type="number" title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test.">
                <input name="attr_Wound-Threshold" readonly class="sheet-Bigger sheet-numHighlight sheet-StepBig sheet-StepTotal" value="5" type="number" title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test."  >
                <span title="@{Misc_Wound_Threshold-Buff}:  Manual modifications to Wound Treshold.">
                  <input name="attr_Wound-Threshold-Buff" type="hidden" class="sheet-redGreen" value="0">
                  <b class="sheet-buffSignRight sheet-buffSmall" style="margin-left:-12px;">+</b>
                  <input name="attr_Wound-Threshold-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                </span>
              </span>
          </div>
        </div>
        <!--JBF End of Wounds Treshold Box-->


        <!--Header - Damage Box-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
            <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Take-Damage" type="roll"
            title="%{selected|Take-Damage} Apply Damage to this Character."
            value="!Earthdawn~ charID: @{character_id}~ ForEach~ Damage : ?{Damage to be applied : |1} : ?{Armor| None,NA| Physical,PA| Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat} : ?{Apply Damage - Type of damage |Damage|Stun|Strain}" >Damage</button>
            <span class="sheet-headerbar sheet-NoAPI sheet-fancyfont" style="font-size:130%;"> Damage </span>
          </div>
          <div class="sheet-flex-container" >
            <div style="flex:1;" class="sheet-text-center">
              <span class="sheet-icon-stun sheet-iconstaticsmall"></span>
              <br>
              <input name="attr_Damage-Unc-Rating" readonly="readonly" value="20"
              class="sheet-numShorter sheet-small"
              title="@{Damage-Unc-Rating}:   Unconscious Rating. If take more damage (Stun or Normal) than this, character is unconscious."
              type="number">
            </div>
            <div class="sheet-imgbox sheet-icon-damage-background" >
              <div class="sheet-imgbox-content">
                <input name="attr_Damage" value="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Damage}   Number of points of regular damage this character has taken.">
              </div>
            </div>
            <div class="sheet-text-center" style="flex:1;">
              <span class="sheet-icon-death sheet-iconstaticsmall"></span>
              <br>
              <input name="attr_Damage-Death-Rating" readonly="readonly" value="25"
              class="sheet-numShorter sheet-small"
              title="@{Damage-Death-Rating}:   Death Rating. If take more (non-stun) damage than this, character dies."
              type="number">
            </div>
          </div>
        </div>
        <!--JBF End Damage Box-->

        <!--Header - Stun Box-->
        <input type="checkbox" name="attr_show_damage_stun" hidden value="1" class="sheet-testCloseChecked">
        <div class="sheet-header-box sheet-HideIfNotCloseChecked sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
          <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Take-Damage-Stun" type="roll"
          title="%{selected|Take-Damage-Stun} Apply Damage to this Character."
          value="!Earthdawn~ charID: @{character_id}~ ForEach~ Damage : ?{Damage to be applied : |1} : ?{Armor| None,NA| Physical,PA| Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat} : Stun" >Stun</button>
          <span class="sheet-headerbar sheet-NoAPI sheet-fancyfont" style="font-size:130%;"> Stun </span></div>
          <div class="sheet-imgbox sheet-icon-stun-background" >
            <div class="sheet-imgbox-content">
              <input name="attr_Damage-Stun" value="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Damage-Stun}   Number of points of Stun damage this character has taken.">
              <br>
              <button class="sheet-text-button sheet-api sheet-fancyfont sheet-button-nodice"
              name="roll_RecoveryStun"
              type="roll"
              value="!Earthdawn~ charID: @{character_id}~  foreach~ mod: -?{Stun Damage Recovery Test - How many Wounds not treated by Physician|@{Wounds}} ~modValue : ?{Modification|0}  ~ K-ask: @{KarmaGlobalMode}@{Recovery-Karma-Ask}: @{DPGlobalMode}@{Recovery-DP-Ask}~ Value: Recovery-Step: Wil-Step~  Roll "
              title="%{selected|RecoveryStun} Roll a Recovery Test for this Character that heals Stun damage only.">
              <span class="sheet-iconstatic sheet-icon-recovery"></span>  </button>
              <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_RecoveryStun-NoAPI"
              type="roll"
              value="@{RollType} &amp;{template:default} {{name=Recovery Test}} {{Step: [[?{Step|@{Recovery-Step}+@{Wil-Step}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] -@{Wounds} ]]}}"
              title="%{selected|RecoveryStun-NoAPI} Roll a Recovery Test for this Character that heals Stun damage only."><span class="sheet-iconstatic sheet-icon-recovery"></span>  </button>
            </div>
          </div>
        </div>
        <!--JBF End of Stun Box-->

        <!--JBF Logo-->
        <div class="sheet-header-logo-Earthdawn sheet-HideIf1879"></div>
        <div class="sheet-header-logo-1879 sheet-HideIfNot1879"></div>

        <!--JBF Header Name Box-->
        <div class="sheet-header-name sheet-background-frame6 sheet-frame" style="padding-left:15px; padding-right: 15px;">
          <div class="sheet-floatRight sheet-HideIfPrint">

            <!-- <label title="@{StepDisplayFinal} Parameter to decide between displaying the Base Value (without modifiers) or Final Value (after all Modifiers) in each of the steps. If Checked displays the Final Step">
              <input type="checkbox" name="attr_StepDisplayFinal" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-sum"></span>
            </label> -->
            <span class="sheet-label-flex sheet-api">API</span>
            <span class="sheet-label-flex sheet-NoAPI">NoAPI</span>

            <button class="sheet-text-button sheet-button-nodice" name="roll_Standard-Step-Roll" type="roll"
            title="%{Standard-Step-Roll}   Just click this button to enter a step and roll it... As easy as this."
            value="@{RollType} &{template:default} {{header=@{charName}: Roll }}  {{Step=[[?{Step|0}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
            <span class="sheet-iconstatic sheet-icon-dice"></span></button>

            <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-NoAPI" name="act_newday" type="action"
            title="act_newday:   Clicking this button will set characters recovery tests to max and perform karma ritual.">
            <span class="sheet-iconstatic sheet-icon-newday"></span> </button>

            <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-api" name="button_NewDay" type="roll"
            value="!Earthdawn~ charID: @{character_id}~ ForEach: c~ Misc: NewDay"
            title="button_NewDay:   Clicking this button will set characters recovery to max and perform karma ritual.">
            <span class="sheet-iconstatic sheet-icon-newday"></span> </button>

            <button class="sheet-button-nodice sheet-api sheet-helpbutton" name="button_WikiHelp_API"
            type="roll"
            value="!Earthdawn~ ChatMenu: Help"
            title="button_WikiHelp_API:   Click this button to open this character sheets Wiki Documentation in another tab.">
            <span class="sheet-helpbutton">?</span></button>

            <button class="sheet-button-nodice sheet-NoAPI sheet-helpbutton"
            name="button_WikiHelp_NoAPI"
            type="roll"
            value="For help look in https://wiki.roll20.net/Earthdawn_-_FASA_Official"
            title="button_WikiHelp_NoAPI:   This sheets Wiki Documentation is at https://wiki.roll20.net/Earthdawn_-_FASA_Official.">
            <span class="sheet-helpbutton">?</span> </button>
          </div>

          <div class="sheet-floatRight sheet-HideIfPrint">

            <span class="sheet-nowrap0" title="@{RollType}   Should rolls made from this sheet be public, gm, or hidden?">
              <!-- <span class="sheet-iconstatic sheet-icon-dice"></span>: -->
              <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
              <span class="sheet-iconselect-span">
                <span class="sheet-iconselect-icon">
                  <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                </span>
                <select name="attr_RollType" class="sheet-api sheet-text-center sheet-iconselect-select sheet-w25px">
                  <option value=" " selected  title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                  <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                  <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                  <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                  title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                </select>
                <select name="attr_RollType" class="sheet-NoAPI sheet-iconselect-select sheet-w25px">
                  <option value=" " selected title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                  <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                  <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                  title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                </select>
              </span>
            </span>

            <button class="sheet-text-button sheet-api sheet-button-nodice"  type="roll"
            value="!Earthdawn~ charID: @{character_id}~  TargetNum: ?{Knockdown Test, Difficulty Number|6}: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str-Step: Str-Mods: Knockdown-Adjust: Adjust-All-Tests-Total: Defensive: Resistance~ Roll"
            title="%{selected|Knockdown} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice"  type="roll"
            value="@{RollType} &amp;{template:default} {{name=Knockdown Test}} {{Step: [[?{Step|@{Str-Step}+@{Str-Mods}+@{Knockdown-Adjust}+@{Adjust-All-Tests-Total}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
            title="%{selected|Knockdown-CheckNoAPI} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span></button>

            <button class="sheet-text-button sheet-api sheet-button-nodice"  type="roll"
                title="%{JumpUp}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: 6: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Strain: 2~ calculateValue: JumpUp~ Roll">
            <span class="sheet-iconstatic sheet-icon-jumpup"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice"  type="roll"
                title="%{JumpUp-NoAPI}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="@{RollType} &{template:rolltargetnumber} {{header=@{charName}: Jump Up}} {{target_number=[[6]]}} {{Step=[[?{Step|@{Dex}+(@{condition-KnockedDown}*3)-@{Armor-IP}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
            <span class="sheet-iconstatic sheet-icon-jumpup"></span></button>

            <button class="sheet-text-button sheet-api sheet-button-nodice"  type="roll" title="%{selected|Dex-Initiative-Check} Click to Roll Initiative. It is important that you select your token"
                value="!Earthdawn~ charID: @{character_id}~ foreach~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Initiative-Karma-Ask}: @{DPGlobalMode}@{Initiative-DP-Ask}~ Value : Initiative~ Init">
            <span class="sheet-iconstatic sheet-icon-initiative"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice"  type="roll" title="%{selected|Dex-Initiative-CheckNoAPI} Click to Roll Initiative. It is important that you select your token" value="@{RollType} &amp;{template:default} {{name=Initiative}} {{Step: [[?{Step|@{Initiative}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] &amp;{tracker}]]}}"><span class="sheet-iconstatic sheet-icon-initiative"></span>  </button>
          </div>



          <div title="@{charName}   Name of character." style="overflow:hidden;">
            <span class="sheet-autoexpand-wrap sheet-bordered-bottom sheet-autoexpand-min">
              <input name="attr_charName"
              placeholder="Character Name"
              type="text"
              class="sheet-text-left sheet-Big sheet-fancyfont">
              <span name="attr_charName" class="sheet-autoexpand sheet-autoexpand-min sheet-Big">
              </span>
            </span>
          </div>

          <div class="sheet-nowrap" style="overflow:hidden;">
            <span class="sheet-autoexpand-wrap sheet-autoexpand-min" title="@{player-name}   Name of player whose character this is.">
              <input name="attr_player-name" class="sheet-text-left sheet-fancyfont sheet-bordered-bottom"
              placeholder="Player Name or Tagline"
              type="text">
              <span name="attr_player-name" class="sheet-autoexpand sheet-autoexpand-min">
              </span>
            </span>
          </div>
        </div>    <!--End of Header-Name-->
      </div>    <!-- end sheet-flex-container -->

      <!--Header -  Start of Status and Combat Option Icons-->
      <input type="checkbox" name="attr_show_options_status" value="1" class="sheet-hidden sheet-testChecked">
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
          <input type="checkbox" name="attr_combatOption-AggressiveAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-agressive"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384)">
          <input type="checkbox" name="attr_combatOption-DefensiveStance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-defensive"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-CalledShot}   Take one Strain and -3 penalty to Attack test; if successful, attack hits designated area.">
          <input type="checkbox" name="attr_combatOption-CalledShot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-calledshot"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{combatOption-SplitMovement}   Take 1 Strain and be Harried to attack during movement. (PG p.386)">
          <input type="checkbox" name="attr_combatOption-SplitMovement" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-split"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-Reserved}   +2 to all Target Numbers. Specify an event to interrupt. (PG p.376)">
          <input type="checkbox" name="attr_combatOption-Reserved" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-reserved"></span>
        </label>
        <label class="sheet-iconlabel2 sheet-HideIfNotTskrang" title="@{combatOption-TailAttack}   T'Skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
          <input type="checkbox" name="attr_combatOption-TailAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-tail"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Blindsiding" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-blindsiding"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-TargetPartialCover}   Target has +2 Bonus to Physical and Mystic defenses due to cover from this attacker. (PG p.386)">
          <input type="checkbox" name="attr_condition-TargetPartialCover" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-partialcover"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
          <input type="checkbox" name="attr_condition-KnockedDown" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-knockeddown"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
          <input type="checkbox" name="attr_condition-Harried" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmed : -3 Penalty to all tests and to Physical and Mystic defenses due to 2 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="3" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried3"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmedx2 : -4 Penalty to all tests and to Physical and Mystic defenses due to 3 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried4"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmedx3 : -5 Penalty to all tests and to Physical and Mystic defenses due to 4 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried5"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-blindsided"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
          <input type="checkbox" name="attr_condition-Surprised" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-surprised"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-NoShield}   Am not using shield at present. Forgo benefits and IP.">
          <input type="checkbox" name="attr_condition-NoShield" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-noshield"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
          <input type="checkbox" name="attr_condition-ImpairedMovement" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-impaired"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Heavy Impaired Movement : -10 to Movement Rate (1 min). -4 Penalty to movement based texts due to footing, cramping, or vision impairments. Dex test to avoid tripping or halting.">
          <input type="checkbox" name="attr_condition-ImpairedMovement" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-impaired4"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
          <input type="checkbox" name="attr_condition-Flying" value="-1" class="sheet-iconcheckbox" checked> <span class="sheet-iconlabel-header-invert sheet-icon-flying"></span>
        </label>
        <!-- <label class="sheet-iconlabel2" title="@{attr_condition-Entangled-Grappled} Character is Entangled or Grappled.  This condition is for information only and has no sheet effect. (PG p.391)">
        <input type="checkbox" name="attr_condition-Entangled-Grappled" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-entangled"></span>  </label> -->
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-RangeLong}   -2 Penalty to Attack and Damage Tests. (PG p.389)">
          <input type="checkbox" name="attr_condition-RangeLong" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-rangelong"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Cover} Partial Cover : +2 Bonus to Physical and Mystical defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Cover" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-cover"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Cover} Full Cover : Can not be targeted by Physical or Mystic attacks.">
          <input type="checkbox" name="attr_condition-Cover" value="99" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-cover99"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{attr_condition-Darkness} Partial Darkness -2 Penalty to all sight based tests due to Darkness, Blindness or Dazzling. (PG p.387)">
          <input type="checkbox" name="attr_condition-Darkness" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-vision"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Darkness} Full Darkness : -4 Penalty to all sight based tests due to Darkness, Blindness or Dazzling. (PG p.387)">
          <input type="checkbox" name="attr_condition-Darkness" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-vision4"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
          <input type="checkbox" name="attr_condition-Health" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-stun"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
          <input type="checkbox" name="attr_condition-Health" value="-5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-death"></span>
        </label>
        <!-- <label class="sheet-iconlabel2" title="@{condition-Poisoned}  Character is Poisoned.  This condition is for information only and has no sheet effect.">
        <input type="checkbox" name="attr_condition-Poisoned" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header-invert sheet-icon-poisoned"></span>  </label> -->
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 1.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain1"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 2.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain2"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 3.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="3" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain3"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <input name="attr_Creature-DiveCharge" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <label class="sheet-iconlabel2 sheet-HideIfCloseChecked" title="@{Creature-DivingCharging}    When this status is ON,then the creature is Ether Diving or Charging. Make sure to turn OFF when creature is not Diving or Charging. (GMG p.250)">
          <input type="checkbox" name="attr_Creature-DivingCharging" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-charging"></span>
        </label>
        <input name="attr_Creature-Ambush" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <label class="sheet-iconlabel2 sheet-HideIfCloseChecked" title="@{Creature-Ambushing}     When this status is ON,then the creature is ambushing. Make sure to turn OFF when creature is not ambushing. (GMG p.250)">
          <input type="checkbox" name="attr_Creature-Ambushing" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-ambush"></span>
        </label>
      </div>

      <div class="sheet-NotCreation sheet-HideIfChecked">
        <span class="sheet-nowrap sheet-label"> Aggr. :
         <label class="sheet-iconlabel2" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
          <input type="checkbox" name="attr_combatOption-AggressiveAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-agressive"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Def. :
          <label class="sheet-iconlabel2" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384)">
            <input type="checkbox" name="attr_combatOption-DefensiveStance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Called Shot :
          <label class="sheet-iconlabel2" title="@{combatOption-CalledShot}   Take one Strain; 3 penalty to Attack test; if successful, attack hits designated area.">
            <input type="checkbox" name="attr_combatOption-CalledShot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-calledshot"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label sheet-HideIfNotTskrang"> Tail Atk :
          <label class="sheet-iconlabel2" title="@{combatOption-TailAttack}   T'Skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
            <input type="checkbox" name="attr_combatOption-TailAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-tail"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Blindsiding :
          <label class="sheet-iconlabel2" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
            <input type="checkbox" name="attr_condition-Blindsiding" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-blindsiding"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> KndDown :
          <label class="sheet-iconlabel2" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
            <input type="checkbox" name="attr_condition-KnockedDown" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-knockeddown"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Harried :
          <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
            <input type="checkbox" name="attr_condition-Harried" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-harried"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Blindsided :
          <label class="sheet-iconlabel2" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
            <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-blindsided"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Surprised :
          <label class="sheet-iconlabel2" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
            <input type="checkbox" name="attr_condition-Surprised" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-surprised"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Uncon. :
          <label class="sheet-iconlabel2" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
            <input type="checkbox" name="attr_condition-Health" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-stun"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Dead :
          <label class="sheet-iconlabel2" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
            <input type="checkbox" name="attr_condition-Health" value="-5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-death"></span>
          </label>
        </span>
        <input name="attr_Creature-DiveCharge" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <span class="sheet-nowrap sheet-label sheet-HideIfCloseChecked"> Diving/Charging :
          <label class="sheet-iconlabel2" title="@{Creature-DivingCharging}    When this status is ON,then the creature is Ether Diving or Charging. Despite being here and not with the other Combat Options, this is a combat option checkbox. Make sure to uncheck this box when creature is not Diving or Charging. (GMG p.250)">
            <input type="checkbox" name="attr_Creature-DivingCharging" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-charging"></span>
          </label>
        </span>
        <input name="attr_Creature-Ambush" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <span class="sheet-nowrap sheet-label sheet-HideIfCloseChecked"> Ambushing :
          <label class="sheet-iconlabel2" title="@{Creature-Ambushing}     When this status is ON,then the creature is ambushing. Make sure to turn OFF this box when creature is not ambushing. (GMG p.250)">
            <input type="checkbox" name="attr_Creature-Ambushing" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-ambush"></span>
          </label>
        </span>
      </div>
    </div>    <!-- end sheet-header-flex-container -->
    <!--**********************************************End of the header-flex-container-div******************************-->

    <!--API Watchdog-->
    <div class="sheet-NoAPI">
      <input type="checkbox" name="attr_API" value="2" class="sheet-hidden sheet-testCloseChecked" >
      <div class="sheet-HideIfNotCloseChecked sheet-text-center sheet-NoAPI">
        Warning - Sheet was in API mode, but API not responding. Sheet is in NoAPI Mode until API is restarted.<br>
        If you still use the API, restart it.<br>
        If you stopped using the API, click the following button.
        <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_stop-using-api" type="action"
        title="Click this button if you definitely stopped using the API.">Stop Using API</button>
      </div>
    </div>



    <!-- **********************************************Start of Radio Selector for Sections*****************************-->
    <div class="sheet-HideIfPrint">
      <input type="radio" name="attr_tab" class="sheet-tabMain" value="1" title="Overview" checked><span>Overview</span>
      <span class="sheet-NotCreation"><input type="radio" name="attr_tab" class="sheet-tabMain" value="2" title="Combat"><span>Combat</span></span>
      <input type="radio" name="attr_tab" class="sheet-tabMain" value="3" title="Talents or Powers">
      <span class="sheet-tabSpan">
        <span class="sheet-HideIfCreature"   >Talents</span>
        <span class="sheet-HideIfNotCreature">Powers</span>
      </span>
      <span class="sheet-api sheet-NotCreation sheet-api"><input type="radio" name="attr_tab" class="sheet-tabMain" value="4" title="Knacks"><span>Knacks</span></span>
      <input type="radio" name="attr_tab" class="sheet-tabMain" value="5" title="Skills"><span>Skills</span>
      <input class="sheet-testCloseChecked sheet-hidden" name="attr_Hide-Spells-Tab" type="checkbox" checked value="1">
      <span class="sheet-HideIfCloseChecked"><input type="radio" name="attr_tab" class="sheet-tabMain" value="6" title="Spell"><span>Spell</span></span>
      <input type="radio" name="attr_tab" class="sheet-tabMain" value="7" title="Equipment"><span>Equipment</span>
      <input type="radio" name="attr_tab" class="sheet-tabMain sheet-tab8 sheet-hidden" value="8" title="Gear">
      <input type="radio" name="attr_tab" class="sheet-tabMain" value="9" title="Notes"><span>Notes</span>
      <span class="sheet-NotCreation sheet-HideIfNotPC"><input type="radio" name="attr_tab" class="sheet-tabMain sheet-tab10" value="10" title="Legend"><span class>Legend</span></span>
      <input type="radio" name="attr_tab" class="sheet-tabMain sheet-tab11" value="11" title="Adjustments"><span>Parameters</span>
    </div>
    <!-- <div class="sheet-sec-border-line"></div> -->

    <input type="hidden" name="attr_tab1-attrib-view" value="1" class="sheet-show-leftpane-tab1">
    <input type="hidden" name="attr_tab1-defense-view" value="1" class="sheet-show-middlepane-tab1">
    <input type="hidden" name="attr_tab1-mods-view" value="0" class="sheet-show-rightpane-tab1">
    <input type="hidden" name="attr_tab2-attrib-view" value="0" class="sheet-show-leftpane-tab2">
    <input type="hidden" name="attr_tab2-defense-view" value="1" class="sheet-show-middlepane-tab2">
    <input type="hidden" name="attr_tab2-mods-view" value="1" class="sheet-show-rightpane-tab2">
    <input type="hidden" name="attr_tab3-attrib-view" value="0" class="sheet-show-leftpane-tab3">
    <input type="hidden" name="attr_tab3-defense-view" value="0" class="sheet-show-middlepane-tab3">
    <input type="hidden" name="attr_tab3-mods-view" value="0" class="sheet-show-rightpane-tab3">
    <input type="hidden" name="attr_tab4-attrib-view" value="0" class="sheet-show-leftpane-tab4">
    <input type="hidden" name="attr_tab4-defense-view" value="0" class="sheet-show-middlepane-tab4">
    <input type="hidden" name="attr_tab4-mods-view" value="0" class="sheet-show-rightpane-tab4">
    <input type="hidden" name="attr_tab5-attrib-view" value="0" class="sheet-show-leftpane-tab5">
    <input type="hidden" name="attr_tab5-defense-view" value="0" class="sheet-show-middlepane-tab5">
    <input type="hidden" name="attr_tab5-mods-view" value="0" class="sheet-show-rightpane-tab5">
    <input type="hidden" name="attr_tab6-attrib-view" value="0" class="sheet-show-leftpane-tab6">
    <input type="hidden" name="attr_tab6-defense-view" value="0" class="sheet-show-middlepane-tab6">
    <input type="hidden" name="attr_tab6-mods-view" value="0" class="sheet-show-rightpane-tab6">
    <input type="hidden" name="attr_tab7-attrib-view" value="0" class="sheet-show-leftpane-tab7">
    <input type="hidden" name="attr_tab7-defense-view" value="0" class="sheet-show-middlepane-tab7">
    <input type="hidden" name="attr_tab7-mods-view" value="0" class="sheet-show-rightpane-tab7">
    <input type="hidden" name="attr_tab8-attrib-view" value="0" class="sheet-show-leftpane-tab8">
    <input type="hidden" name="attr_tab8-defense-view" value="0" class="sheet-show-middlepane-tab8">
    <input type="hidden" name="attr_tab8-mods-view" value="0" class="sheet-show-rightpane-tab8">
    <input type="hidden" name="attr_tab9-attrib-view" value="0" class="sheet-show-leftpane-tab9">
    <input type="hidden" name="attr_tab9-defense-view" value="0" class="sheet-show-middlepane-tab9">
    <input type="hidden" name="attr_tab9-mods-view" value="0" class="sheet-show-rightpane-tab9">
    <input type="hidden" name="attr_tab10-attrib-view" value="0" class="sheet-show-leftpane-tab10">
    <input type="hidden" name="attr_tab10-defense-view" value="0" class="sheet-show-middlepane-tab10">
    <input type="hidden" name="attr_tab10-mods-view" value="0" class="sheet-show-rightpane-tab10">
    <input type="hidden" name="attr_tab11-attrib-view" value="0" class="sheet-show-leftpane-tab11">
    <input type="hidden" name="attr_tab11-defense-view" value="0" class="sheet-show-middlepane-tab11">
    <input type="hidden" name="attr_tab11-mods-view" value="0" class="sheet-show-rightpane-tab11">
    <div class="sheet-sec-border-top"></div>
    <!-- ********************************JBF:End of Radio Selector for Sections********************************************* -->



              <!--*********************************JBF: Overall flex-container Start********************************************* -->
    <div class="sheet-flex-container">    <!-- this goes to bottom of html  -->
      <div>   <!-- this goes to end of side panes plus step table -->
        <div class="sheet-flex-container">    <!-- start of the three side panes -->
                    <!--*********************************JBF: Left Pane Attribute Start********************************************* -->
          <div class="sheet-bordered sheet-leftpane">
            <div class="sheet-headerbar sheet-NotCreation">
              Attributes
              <div class="sheet-floatRight sheet-NotCreation">
                <label title="@{attributes-edit-mode} : Toggles the edit mode ." >
                  <input type="checkbox" name="attr_attributes-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label>
              </div>
            </div>
            <input class="sheet-testAttrCosts" name="attr_Attr-Costs" value="25" type="hidden">
            <div class="sheet-Creation sheet-headerbar" >
              <b class="sheet-creation-order" title="Refer to Player Guide Edition 4 p.59. Assign your 25 Attribute Points.">2-</b> Generate Attributes.
            </div>
            <div class="sheet-content sheet-Creation" style="width:250px;">
              Attribute Points:  <input name="attr_Attr-Costs" class="sheet-numShort sheet-attrCostsRed"
              readonly="readonly"
              title="@{Attr-Costs}   Number of Attribute points remaining from the starting 25, after raising Racial attributes to Orig values."
              type="number">  <br>
              Karma Points : &nbsp;&nbsp;<input name="attr_Attrib-Karma-Orig" min="0" value="0" class="sheet-numShort sheet-attrCostsRed" title="@{Attrib-Karma-Orig}   Number of remaining creation points to be transferred to Karma Pool."  type="number"><br>
              Spend Attributes points or set the Step
            </div>

            <div class="sheet-content" >    <!-- Everything except header of attributes sidepane -->
              <input type="checkbox" name="attr_attributes-edit-mode" value="1" hidden class="sheet-testRepEditMode">

              <!--Left Pane - DEX box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Dex-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Dex-Race}   Base Racial Dexterity attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Dex-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Dex-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Dex-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Dex-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Dex-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Dex-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Dex}~  foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Value: Dex~ Roll"
                        title="%{selected|Dex-Check}   Roll a Dexterity Action check for this Character - Modified for wounds and conditions.">DEX </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Dex-CheckNoAPI" type="roll"
                        value="@{RollType-Dex} &{template:default} {{name=Dexterity}} {{Step: [[?{Step|@{Dex}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Dex-CheckNoAPI}   Roll a Dexterity Action check for this Character - Modified for wounds and conditions.">&nbsp;DEX</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Dex-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Dex}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Value: Dex-Effect~ Roll"
                        title="%{selected|Dex-Effect-Check}   Roll a Dexterity Effect Check (Using 'Dex-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">DEX-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Dex-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Dex} &{template:default} {{name=Dexterity Effect Test}} {{Step: [[?{Step|@{Dex-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Dex-Effect-CheckNoAPI}   Roll a Dexterity Effect Check (Using 'Dex-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">DEX-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Dex-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Dex-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Dex-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Dex-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Dex-Step}   Dex Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Dex" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Dex}   Dex Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Dex-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Dex-Effect}   Dex step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >

                        <span title="@{Dex-Mods}   Misc Dex step mods.">
                          <input name="attr_Dex-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Dex-Mods" type="number" class="sheet-buffRight">
                        </span>


                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Dex-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Dex-Step}   Dex Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Dex-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Dex-Curr}   Current Dexterity Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Dex-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Dex-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->

                      <input type="checkbox" name="attr_Dex-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >

                        <input type="checkbox" name="attr_Dex-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Dex-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Dex-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Dex-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Dex-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Dex-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Dex-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Dex-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Dex-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Dex-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Dex-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Dex-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Dex-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Dex-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Dex-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Dex-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Dex-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Dex-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Dex-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Dex-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Dex-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Dex Box-->

              <!--Left Pane - STR box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Str-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Str-Race}   Base Racial Strength attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Str-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Str-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Str-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Str-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Str-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Str-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Str}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str~ Roll"
                        title="%{selected|Str-Check}   Roll a Strength Action check for this Character - Modified for wounds and conditions.">STR </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Str-CheckNoAPI" type="roll"
                        value="@{RollType-Str} &{template:default} {{name=Strength}} {{Step: [[?{Step|@{Str}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Str-CheckNoAPI}   Roll a Strength Action check for this Character - Modified for wounds and conditions.">&nbsp;STR</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Str-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Str}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str-Effect~ Roll"
                        title="%{selected|Str-Effect-Check}   Roll a Strength Effect Check (Using 'Str-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">STR-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Str-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Str} &{template:default} {{name=Strength Effect Test}} {{Step: [[?{Step|@{Str-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Str-Effect-CheckNoAPI}   Roll a Strength Effect Check (Using 'Str-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">STR-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Str-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Str-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Str-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Str-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Str-Step}   Str Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Str" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Str}   Str Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Str-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Str-Effect}   Str step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Str-Mods}   Misc Str step mods.">
                          <input name="attr_Str-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Str-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Str-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Str-Step}   Str Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Str-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Str-Curr}   Current Strength Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Str-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Str-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Str-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Str-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Str-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Str-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Str-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Str-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Str-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Str-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Str-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Str-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Str-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Str-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Str-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Str-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Str-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Str-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Str-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Str-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Str-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Str-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Str-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Str-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Str-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Str-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Str Box-->

              <!--Left Pane - Tou box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Tou-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Tou-Race}   Base Racial Toughness attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Tou-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Tou-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Tou-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Tou-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Tou-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Tou-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Tou}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Tou-Karma-Ask}: @{DPGlobalMode}@{Tou-DP-Ask}~ Value: Tou~ Roll"
                        title="%{selected|Tou-Check}   Roll a Toughness Action check for this Character - Modified for wounds and conditions.">TOU </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Tou-CheckNoAPI" type="roll"
                        value="@{RollType-Tou} &{template:default} {{name=Toughness}} {{Step: [[?{Step|@{Tou}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Tou-CheckNoAPI}   Roll a Toughness Action check for this Character - Modified for wounds and conditions.">&nbsp;TOU</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Tou-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Tou}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Tou-Karma-Ask}: @{DPGlobalMode}@{Tou-DP-Ask}~ Value: Tou-Effect~ Roll"
                        title="%{selected|Tou-Effect-Check}   Roll a Toughness Effect Check (Using 'Tou-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">TOU-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Tou-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Tou} &{template:default} {{name=Toughness Effect Test}} {{Step: [[?{Step|@{Tou-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Tou-Effect-CheckNoAPI}   Roll a Toughness Effect Check (Using 'Tou-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">TOU-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Tou-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Tou-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Tou-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Tou-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Tou-Step}   Tou Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Tou" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Tou}   Tou Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Tou-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Tou-Effect}   Tou step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Tou-Mods}   Misc Tou step mods.">
                          <input name="attr_Tou-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Tou-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Tou-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Tou-Step}   Tou Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Tou-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Tou-Curr}   Current Toughness Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">

                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Tou-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Tou-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Tou-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Tou-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Tou-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Tou-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Tou-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Tou-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Tou-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Tou-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Tou-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Tou-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Tou-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Tou-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Tou-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Tou-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Tou-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Tou-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Tou-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Tou-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Tou-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Tou-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div> <!--LP Increases-->
                      <div><b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Tou-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Tou-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Tou Box-->

              <!--Left Pane - Per box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Per-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Per-Race}   Base Racial Perception attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Per-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Per-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Per-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Per-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Per-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Per-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Per}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Per-Karma-Ask}: @{DPGlobalMode}@{Per-DP-Ask}~ Value: Per~ Roll"
                        title="%{selected|Per-Check}   Roll a Perception Action check for this Character - Modified for wounds and conditions.">PER</button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Per-CheckNoAPI" type="roll"
                        value="@{RollType-Per} &{template:default} {{name=Perception}} {{Step: [[?{Step|@{Per}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Per-CheckNoAPI}   Roll a Perception Action check for this Character - Modified for wounds and conditions.">&nbsp;PER</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Per-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Per}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Per-Karma-Ask}: @{DPGlobalMode}@{Per-DP-Ask}~ Value: Per-Effect~ Roll"
                        title="%{selected|Per-Effect-Check}   Roll a Perception Effect Check (Using 'Per-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">PER-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Per-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Per} &{template:default} {{name=Perception Effect Test}} {{Step: [[?{Step|@{Per-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Per-Effect-CheckNoAPI}   Roll a Perception Effect Check (Using 'Per-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">PER-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Per-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Per-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Per-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Per-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Per-Step}   Per Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Per" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Per}   Per Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Per-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Per-Effect}   Per step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Per-Mods}   Misc Per step mods.">
                          <input name="attr_Per-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Per-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Per-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Per-Step}   Per Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>
                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Per-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Per-Curr}   Current Perception Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Per-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Per-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Per-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Per-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Per-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Per-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Per-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Per-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Per-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Per-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Per-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Per-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Per-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Per-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Per-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Per-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Per-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Per-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Per-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Per-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Per-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Per-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Per-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Per-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Per-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Per-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Per Box-->

              <!--Left Pane - Wil box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Wil-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Wil-Race}   Base Racial Willpower attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Wil-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Wil-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Wil-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Wil-ActnEfct"  value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Wil-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Wil-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Wil}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Wil-Karma-Ask}: @{DPGlobalMode}@{Wil-DP-Ask}~ Value: Wil~ Roll"
                        title="%{selected|Wil-Check}   Roll a Willpower Action check for this Character - Modified for wounds and conditions.">WIL </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Wil-CheckNoAPI" type="roll"
                        value="@{RollType-Wil} &{template:default} {{name=Willpower}} {{Step: [[?{Step|@{Wil}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Wil-CheckNoAPI}   Roll a Willpower Action check for this Character - Modified for wounds and conditions.">&nbsp;WIL</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Wil-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Wil}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Wil-Karma-Ask}: @{DPGlobalMode}@{Wil-DP-Ask}~ Value: Wil-Effect~ Roll"
                        title="%{selected|Wil-Effect-Check}   Roll a Willpower Effect Check (Using 'Wil-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">WIL-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Wil-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Wil} &{template:default} {{name=Willpower Effect Test}} {{Step: [[?{Step|@{Wil-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Wil-Effect-CheckNoAPI}   Roll a Willpower Effect Check (Using 'Wil-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">WIL-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Wil-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Wil-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Wil-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Wil-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Wil-Step}   Wil Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Wil" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Wil}   Wil Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Wil-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Wil-Effect}   Wil step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Wil-Mods}   Misc Wil step mods.">
                          <input name="attr_Wil-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Wil-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Wil-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Wil-Step}   Wil Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Wil-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Wil-Curr}   Current Willpower Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Wil-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Wil-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Wil-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Wil-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Wil-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Wil-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Wil-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Wil-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Wil-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Wil-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Wil-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Wil-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Wil-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Wil-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Wil-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Wil-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Wil-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Wil-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Wil-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Wil-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Wil-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Wil-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Wil-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Wil-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>    <!--JBF End of Wil Box-->

                    <!--Left Pane - Cha box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Cha-Race"
                    value="10"
                    class="sheet-numShort"
                    title="@{Attrib-Cha-Race}   Base Racial Charisma attribute."
                    readonly="readonly"
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation Pts:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Cha-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Cha-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>=</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Cha-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Cha-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Cha-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Cha-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Cha}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Cha-Karma-Ask}: @{DPGlobalMode}@{Cha-DP-Ask}~ Value: Cha~ Roll"
                        title="%{selected|Cha-Check}   Roll a Charisma Action check for this Character - Modified for wounds and conditions.">CHA </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Cha-CheckNoAPI" type="roll"
                        value="@{RollType-Cha} &{template:default} {{name=Charisma}} {{Step: [[?{Step|@{Cha}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Cha-CheckNoAPI}   Roll a Charisma Action check for this Character - Modified for wounds and conditions.">&nbsp;CHA</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Cha-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Cha}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Cha-Karma-Ask}: @{DPGlobalMode}@{Cha-DP-Ask}~ Value: Cha-Effect~ Roll"
                        title="%{selected|Cha-Effect-Check}   Roll a Charisma Effect Check (Using 'Cha-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">CHA-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Cha-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Cha} &{template:default} {{name=Charisma Effect Test}} {{Step: [[?{Step|@{Cha-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Cha-Effect-CheckNoAPI}   Roll a Charisma Effect Check (Using 'Cha-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">CHA-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{Cha-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Cha-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Cha-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Cha-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Cha-Step}   Cha Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Cha" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Cha}   Cha Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Cha-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Cha-Effect}   Cha step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Cha-Mods}   Misc Cha step mods.">
                          <input name="attr_Cha-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Cha-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Cha-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Cha-Step}   Cha Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv">
                      <input name="attr_Attrib-Cha-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Cha-Curr}   Current Charisma Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Cha-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Cha-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Cha-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Cha-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Cha-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Cha-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Cha-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Cha-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Cha-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Cha-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Cha-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                          <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_Cha-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Cha-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Cha-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Cha-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Cha-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Cha-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Cha-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Cha-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Cha-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Cha-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Cha-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation" >
                    <div>   <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Cha-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Cha-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>    <!--JBF End of Cha Box-->
            </div>    <!-- end of everything except header of attribute sidepane -->
          </div>    <!--************************************************JBF end of Left Pane : attribute*****************************-->


                    <!--**************JBF start of Middle side Pane :defenses, Armor and Misc***************-->
          <div class="sheet-bordered sheet-middlepane">
            <div class="sheet-Creation sheet-headerbar" >
              <b class="sheet-creation-order" title="Refer to Player Guide Edition 4 p.62.">3-</b> Characteristics.
            </div>
            <div class="sheet-content sheet-Creation">
              Automatically Calculated
            </div>
            <div class="sheet-headerbar">Defenses
              <input name="attr_show_natural_toggle" class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="1">
              <div class="sheet-floatRight sheet-HideIfNotCloseChecked">
                <label title="@{attr_natural_value_show} : Toggles the display of natural values, where all armor and object bonus/penalties to defenses, armor and objects are ignored. Natural values are displayed .">
                  <input type="checkbox" name="attr_natural_value_show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-naked-white"></span>
                </label>
              </div>
            </div>

            <!--Middle Pane - Defenses-->
            <div class="sheet-content">
              <input type="checkbox" name="attr_natural_value_show" value="1" hidden class="sheet-testChecked">

              <!-- Middle Pane - Start of PD Box-->
              <div class="sheet-flex-container">
                <div class="sheet-Defense-box sheet-background-frame3 sheet-frame">
                  <div class="sheet-headerbar" > Phys. Def. </div>
                  <div class="sheet-imgbox-defense sheet-icon-PD-background sheet-flexCenter" >
                    <div class="sheet-imgbox-content">
                      <span class="sheet-stepSpan">
                        <span title="@{PD-Mod-Auto}   This is the automatic adjustment to Physical Defense from Wounds, Conditions, Combat Options and in ED4 Shield Adjustments.">
                          <input name="attr_PD-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_PD-Mod-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span>
                          <input name="attr_PD-UnMod" readonly
                          value="5"
                          class="sheet-AttribStep sheet-numHighlight sheet-StepBase sheet-HideIfChecked"
                          title="@{PD-UnMod}   Permanent Physical Defense excluding any temporary modifier."
                          type="number"
                          >
                          <input name="attr_PD" readonly
                          value="5"
                          class="sheet-AttribStep sheet-numHighlight sheet-StepTotal sheet-HideIfChecked"
                          title="@{PD}   Physical Defense."
                          type="number"
                          >
                        </span>

                        <span title="@{PD-Buff}   Buffs or other temporary modifications to Physical Defense." >
                          <input name="attr_PD-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_PD-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_PD-Nat" readonly
                value="5"
                class="sheet-numShorter sheet-small"
                title="@{PD-Nat}   Natural Physical Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{PD-Base}   Physical Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> PD-B:
                <input name="attr_PD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_PD-Nat" readonly type="number" value="6"
                title="@{PD-Nat}   Natural PD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <!--JBF End of PD Box-->

              <!-- Middle Pane - Start of MD Box-->
              <div class="sheet-flex-container">
                <div class="sheet-Defense-box sheet-background-frame2 sheet-frame">
                  <div class="sheet-headerbar" > Myst. Def. </div>
                  <div class="sheet-imgbox-defense sheet-icon-MD-background sheet-flexCenter" >
                    <div class="sheet-imgbox-content">
                      <span class="sheet-stepSpan">
                        <span title="@{MD-Mod-Auto}   This is the automatic adjustment to Mystic Defense from Wounds, Conditions, Shield (ED4) and Combat Options Adjustments.">
                          <input name="attr_MD-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_MD-Mod-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_MD-UnMod" readonly
                        value="5"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{MD-UnMod}   Permanent Mystic Defense excluding any temporary modifier."
                        type="number"
                        >
                        <input name="attr_MD" readonly
                        value="5"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{MD}   Mystic Defense."
                        type="number"
                        >
                        <span title="@{MD-Buff}   Buffs or other temporary modifications to Mystic Defense." >
                          <input name="attr_MD-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_MD-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_MD-Nat" readonly
                value="5"
                class="sheet-numShorter sheet-small"
                title="@{MD-Nat}   Natural Mystic Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{MD-Base}   Mystic Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> MD-B:
                <input name="attr_MD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_MD-Nat" readonly type="number" value="6"
                title="@{MD-Nat}   Natural MD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <span class="sheet-hidden"><input name="attr_MD" type="number" readonly value="6" title="@{MD}   Mystic Defense.">
              </span>
              <!--JBF End of MD Box-->

              <!--Middle Pane -  Start of SD Box-->
              <!--JBF : Adjust-All-Defenses does not apply to SD-->
              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame">
                <div class="sheet-headerbar" > Soc. Def. </div>
                <div class="sheet-imgbox-defense sheet-icon-SD-background sheet-flexCenter" >
                  <div class="sheet-imgbox-content">
                    <span class="sheet-stepSpan">
                      <span title="No Automatic Adjustment for Social Defense.">
                        <input  type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft">+</b>
                        <input  type="number" readonly value="0" class="sheet-buffLeft">
                      </span>
                      <span class="sheet-StepBase" style="display:inline-block;" title="@{SD-Unmod}   Permanent Social Defense excluding any temporary modifier.">
                        <input name="attr_SD-Unmod"   disabled
                        value="(@{SD-Base} + @{Defense-Soc-Nat-Adjust} + @{Defense-Soc-Adjust} + @{Defense-Soc-Nat-Auto-Adjust})"
                        class="sheet-StepBase sheet-numHighlight sheet-AttribStep "
                        title="@{SD-Unmod}   Permanent Social Defense excluding any temporary modifier."
                        type="number">
                      </span>
                      <input name="attr_SD" readonly
                      value="5"
                      class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                      title="@{SD}   Social Defense."
                      type="number"
                      >
                      <span title="@{SD-Buff}   Buffs or other temporary modifications to Social Defense." >
                        <input name="attr_SD-Buff" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight">+</b>
                        <input name="attr_SD-Buff" type="number" class="sheet-buffRight">
                      </span>
                    </span>
                  </div>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_SD-Nat" readonly
                value="5"
                class="sheet-numShorter sheet-small"
                title="@{SD-Nat}   Natural Social Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{SD-Base}   Social Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> SD-B:
                <input name="attr_SD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_SD-Nat" readonly type="number" value="6"
                title="@{SD-Nat}   Natural SD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <span class="sheet-hidden"><input name="attr_SD" type="number" readonly value="6" title="@{SD}   Social Defense.">
              </span>
              <!--JBF End of SD Box-->
            </div>

            <!--Middle Pane - Armors-->
            <div class="sheet-headerbar">Armor </div>
            <div class="sheet-content">
              <input type="checkbox" name="attr_natural_value_show" value="1" hidden class="sheet-testChecked">

              <!--Middle Pane -  Start of PA Box-->
              <div class="sheet-flex-container">
                <div class="sheet-Defense-box sheet-background-frame8 sheet-frame">
                  <div class="sheet-headerbar" > Phys. Arm. </div>
                  <div class="sheet-imgbox-defense sheet-icon-PA-background sheet-flexCenter" >
                    <div class="sheet-imgbox-content">
                      <span class="sheet-stepSpan">
                        <span title="No Automatic Adjustment on Armor">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Physical-Armor" readonly
                        value="0"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{Physical-Armor}   Physical Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <input name="attr_Physical-Armor" readonly
                        value="5"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{Physical-Armor}   Physical Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <span title="@{PA-Buff}   Buffs or other temporary modifications to Physical Armor." >
                          <input name="attr_PA-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_PA-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_PA-Nat" readonly
                value="0"
                class="sheet-numShorter sheet-small"
                title="@{PA-Nat}   Natural Physical Armor excluding equipment."
                type="number"
                >
              </span>
              <!--JBF End of PA Box-->

              <!--Middle Pane -  Start of MA Box-->
              <div class="sheet-flex-container">
                <div class="sheet-Defense-box sheet-background-frame9 sheet-frame">
                  <div class="sheet-headerbar" > Myst. Arm. </div>
                  <div class="sheet-imgbox-defense sheet-icon-MA-background sheet-flexCenter" >
                    <div class="sheet-imgbox-content">
                      <span class="sheet-stepSpan">
                        <span title="No Automatic Adjustment on Armor">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Mystic-Armor" readonly
                        value="2"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{Mystic-Armor}   Mystic Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <input name="attr_Mystic-Armor" readonly
                        value="2"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{Mystic-Armor}   Mystic Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <span title="@{MA-Buff}   Buffs or other temporary modifications to Mystic Armor." >
                          <input name="attr_MA-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_MA-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_MA-Nat" readonly
                value="2"
                class="sheet-numShorter sheet-small"
                title="@{MA-Nat}   Natural Mystic Armor excluding equipment."
                type="number"
                >
              </span>
              <!--JBF End of MA Box-->
            </div>
            <!--JBF End of Armors-->


            <!--Middle Pane -  start of Others -->
            <div class="sheet-headerbar"> Others</div>
            <div class="sheet-content">

              <!--Middle Pane -  Start of Init Box-->
              <div class="sheet-flex-container">
                <div class="sheet-Defense-box sheet-background-frame3 sheet-frame">
                  <div class="sheet-headerbar" >
                    <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Dex-Initiative-Check"
                    type="roll"
                    title="%{selected|Dex-Initiative-Check} Click to Roll Initiative. It is important that you select your token"
                    value="!Earthdawn~ charID: @{character_id}~ foreach~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Initiative-Karma-Ask}: @{DPGlobalMode}@{Initiative-DP-Ask}~ Value : Initiative~ Init">
                    Initiative</button>
                    <button class="sheet-text-button-header sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_Dex-Initiative-CheckNoAPI"
                    type="roll"
                    title="%{selected|Dex-Initiative-CheckNoAPI} Click to Roll Initiative. It is important that you select your token"
                    value="@{RollType} &amp;{template:default} {{name=Initiative}} {{Step: [[?{Step|@{Initiative}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] &amp;{tracker}]]}}">Initiative  </button>
                  </div>
                  <div class="sheet-imgbox-defense sheet-icon-initiative-background sheet-flexCenter" >
                    <div class="sheet-imgbox-content">
                      <span class="sheet-stepSpan">
                        <span title="@{Initiative-Mods-Auto}:   Initiative modifiers from wounds and equipment.">
                          <input name="attr_Initiative-Mods-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Initiative-Mods-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Initiative" readonly value="5" class="sheet-AttribStep sheet-numHighlight sheet-StepTotal" title="@{Initiative}:   Final Initiative Step including modifiers and equipment." type="number">
                        <input name="attr_Initiative-Base" readonly value="5" class="sheet-AttribStep sheet-numHighlight sheet-StepBase" title="@{Initiative-Base}:   Base Initiative Step before modifiers and equipment." type="number">
                        <span title="@{Initiative-Mods}:   Misc Initiative Modification." >
                          <input name="attr_Initiative-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Initiative-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF Karma Toggle-Simple-->
              <div>
                <!--JBF Karma Toggle-Simple-->
                <input type="checkbox" name="attr_Initiative-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                  <input type="hidden" name="attr_Initiative-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Initiative-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Initiative-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On" >
                        <input type="checkbox" name="attr_Initiative-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Initiative-Karma} : Number of Karma Points to be spent when Karma is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Initiative-Karma} Don't Spend any Karma when Karma is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                        </span>
                        <input type="hidden" name="attr_Initiative-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                        <input type="hidden" name="attr_Initiative-Karma-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Initiative-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Initiative-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>   <!--JBF End Of Karma Toggle-Simple-->
                      <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                  <input type="hidden" name="attr_Initiative-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Initiative-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Initiative-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Initiative-DP}   Automatically Spends One Devotion when Devotion is On" >
                        <input type="checkbox" name="attr_Initiative-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Initiative-DP} : Number of Devotion Points to be spent when Devotion is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Initiative-DP} Don't Spend any Dp when Dp is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On"></span>
                        </span>
                        <input type="hidden" name="attr_Initiative-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                        <input type="hidden" name="attr_Initiative-DP-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Initiative-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Initiative-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>   <!--JBF End Of DP Toggle-->
              </div>
                    <!-- JBF All Init related attributes-->
              <input name="attr_IP" type="hidden" value="0">   <!--JBF End of Init Box-->

                    <!--Middle Pane - Start of Buttons, Knockdown, JumpUp-->
              <div class="sheet-HideIfPrint">
                <button class="sheet-text-button sheet-api sheet-button-nodice" name="roll_JumpUp" type="roll"
                title="%{JumpUp}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: 6: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Strain: 2~ calculateValue: JumpUp~ Roll">
                <span class="sheet-iconstatic sheet-icon-jumpup"></span>Jump Up</button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_JumpUp-NoAPI" type="roll"
                title="%{JumpUp-NoAPI}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="@{RollType} &{template:rolltargetnumber} {{header=@{charName}: Jump Up}} {{target_number=[[6]]}} {{Step=[[?{Step|@{Dex}+(@{condition-KnockedDown}*3)-@{Armor-IP}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
                <span class="sheet-iconstatic sheet-icon-jumpup"></span>Jump Up</button>
              </div>
              <div class="sheet-HideIfPrint">
                <button class="sheet-text-button sheet-api sheet-button-nodice" name="roll_Knockdown" type="roll"
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: ?{Knockdown Test, Difficulty Number|6}: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str-Step: Str-Mods: Knockdown-Adjust: Adjust-All-Tests-Total: Defensive: Resistance~ Roll"
                title="%{selected|Knockdown} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span>KnockD
                <input name="attr_Knockdown" type="number" disabled value="(@{Str-Step}+@{Knockdown-Adjust})" class="sheet-numShorter sheet-HideIfPC" readonly="readonly"></button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_KnockdownNoAPI" type="roll"
                value="@{RollType} &amp;{template:default} {{name=Knockdown Test}} {{Step: [[?{Step|@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{Knockdown-Adjust}+@{Adjust-All-Tests-Total}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                title="%{selected|Knockdown-NoAPI} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span>KnockD
                <input name="attr_Knockdown" type="number" disabled value="(@{Str-Step}+@{Knockdown-Adjust})" class="sheet-numShorter sheet-HideIfPC" readonly="readonly"></button>
              </div>    <!--End of Buttons, KnockDown JumpUp-->
            </div>    <!--End of Others-->
          </div>    <!-- *********End of Middle side Pane (defenses armor and misc) ******** -->


                <!-- *****************Start of Right Pane (modifiers) ******** -->
          <div class="sheet-bordered sheet-rightpane sheet-HideIfPrint">
            <div class="sheet-headerbar">
              <span title="This are the global Modifiers per type that apply on any roll">Modifiers</span>
              <div class="sheet-floatRight">
                <label title="@{attr_modifiers_parameters} : Toggles the display of parameters for the Global Modifiers.">
                  <input type="checkbox" name="attr_modifiers_parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
                </label>
              </div>
            </div>

                <!--Header - Start of Action-Mod Box-->
            <input name="attr_Adjust-All-Tests-Total" type="hidden" value="0"><!--just as placeholder-->
            <!-- <input name="attr_Adjust-All-Tests-Misc" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-All-Tests-Auto" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame9 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Actions</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-All-Tests-Auto}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                    <input name="attr_Adjust-All-Tests-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-All-Tests-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-action sheet-iconstaticBig" title="@{Adjust-All-Tests-Auto} and @{Adjust-All-Tests-Misc}   These are the total adjustment to all Actions Test from Situation Modifiers, Combat Options, Wounds and Misc Adjustments."></span>
                  <span title="@{Adjust-All-Tests-Misc}:   Enter any Misc Adjustments to all Action Tests here.">
                    <input name="attr_Adjust-All-Tests-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-All-Tests-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>    <!--End of Action Box-->

                <!--Header - Start of Effect-Mod Box-->
            <input name="attr_Adjust-Effect-Tests-Total" type="hidden" value="0"><!--just as placeholder-->
            <!-- <input name="attr_Adjust-Effect-Tests-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Effect-Tests-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <input class="sheet-testCloseChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation sheet-HideIfCloseChecked">
              <div class="sheet-headerbar sheet-w100p">Effects</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-Effect-Tests-Auto}   This is the automatic adjustment to Effect Tests from Wounds.">
                    <input name="attr_Adjust-Effect-Tests-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Effect-Tests-Auto" type="number" readonly class="sheet-buffLeft" value="0">
                  </span>
                  <span class="sheet-icon-effect sheet-iconstaticBig" title="@{Adjust-Effect-Tests-Auto} and @{Adjust-Effect-Tests-Misc}   These are the total adjustment to all Effect Test from Wounds and Misc Adjustments."></span>
                  <span title="@{Adjust-Effect-Tests-Misc}:   Enter any Misc Adjustments to Effect Tests here.">
                    <input name="attr_Adjust-Effect-Tests-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Effect-Tests-Misc" type="number" class="sheet-buffRight" value="0">
                  </span>
                </span>
              </div>
            </div>
            <!--End of Effect Box-->

            <!--Header -  Start of Defense-Mod Box-->
            <input name="attr_Adjust-Defenses-Total" type="hidden" value="0"> <!--just as placeholder-->
            <!-- <input name="attr_Adjust-Defenses-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Defenses-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Defenses</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-Defenses-Auto}   This is the automatic adjustment to Physical and Mystic Defenses from Conditions and Combat Options.">
                    <input name="attr_Adjust-Defenses-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Defenses-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-defenses sheet-iconstaticBig" title="@{Adjust-Defenses-Auto} and @{Adjust-Defenses-Misc}   This is the total adjustment to Physical and Mystic Defenses from Conditions, Combat Options and Misc Adjustments."></span>
                  <span title="@{Adjust-Defenses-Misc}:   Enter any Misc Adjustments to Defenses here.">
                    <input name="attr_Adjust-Defenses-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Defenses-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>
            <!--End of Defense Box-->

            <!--Header -  Start of Attacks-Mod Box-->
            <input name="attr_Adjust-Attacks-Total" type="hidden" value="0"> <!--Just as a placeholder-->
            <input name="attr_Adjust-Attacks-Total-CC" type="hidden" value="0"> <!--Just as a placeholder-->
            <!-- <input name="attr_Adjust-Attacks-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Attacks-Auto-CC" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation">
              <input name="attr_show-CC" type="checkbox" class="sheet-testChecked" checked hidden value="1">
              <div class="sheet-headerbar sheet-w100p sheet-HideIfChecked">Attacks</div>
              <div class="sheet-headerbar sheet-w100p sheet-HideIfNotChecked">Attacks-CC</div>
              <div class="sheet-header-modbox">
                <!--Range Mode-->
                <span class="sheet-stepSpan sheet-HideIfChecked">
                  <span title="@{Adjust-Attacks-Auto}   This is the total automatic adjustment to Attacks from Wounds, Conditions and Combat Options.">
                    <input name="attr_Adjust-Attacks-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Attacks-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Attacks-Auto} and @{Adjust-Attacks-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Attacks from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-attacks"></span>
                  </label>
                  <span title="@{Adjust-Attacks-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Attacks-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
                <!--CC Mode-->
                <span class="sheet-stepSpan sheet-HideIfNotChecked">
                  <span title="@{Adjust-Attacks-Auto-CC}   This is the total automatic adjustment to Close Combat Attacks from Wounds, Conditions and Combat Options (Including Agressive Attack).">
                    <input name="attr_Adjust-Attacks-Auto-CC" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Attacks-Auto-CC" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Attacks-Auto} and @{Adjust-Attacks-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Attacks from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-attacks-cc"></span>
                  </label>
                  <span title="@{Adjust-Attacks-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Attacks-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>

            <input type="checkbox" name="attr_modifiers_parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked sheet-content">
              Atk Bonus die:
              <input name="attr_Adjust-Attacks-Bonus"
              value="0"
              min="0"
              title="@{Adjust-Attacks-Bonus}:   Enter the Step number of any Bonus Die (other than karma) here."
              type="number">
            </div>    <!--End of Attacks Box-->

                <!--Header -  Start of Damage-Mod Box-->
            <input name="attr_Adjust-Damage-Total" type="hidden" value="0"> <!--just as a placeholder-->
            <input name="attr_Adjust-Damage-Total-CC" type="hidden" value="0"> <!--just as a placeholder-->
            <!-- <input name="attr_Adjust-Damage-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Damage-Auto-CC" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-header-hidden sheet-background-frame2 sheet-frame sheet-NotCreation">
              <input name="attr_show-CC" type="checkbox" class="sheet-testChecked" checked hidden value="1">
              <div class="sheet-headerbar sheet-w100p sheet-HideIfChecked">Damage</div>
              <div class="sheet-headerbar sheet-w100p sheet-HideIfNotChecked">Damage-CC</div>
              <div class="sheet-header-modbox">
                <!--Range Mode-->
                <span class="sheet-stepSpan sheet-HideIfChecked">
                  <span title="@{Adjust-Damage-Auto}   This is the total automatic adjustment to Damage from Wounds, Conditions and Combat Options.">
                    <input name="attr_Adjust-Damage-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Damage-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Damage-Auto} and @{Adjust-Damage-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Damage from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-damage"></span>
                  </label>
                  <span title="@{Adjust-Damage-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Damage-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
                <!--CC Mode-->
                <span class="sheet-stepSpan sheet-HideIfNotChecked">
                  <span title="@{Adjust-Damage-Auto-CC}   This is the total automatic adjustment to Close Combat Damage from Wounds, Conditions and Combat Options (Including Agressive Attack).">
                    <input name="attr_Adjust-Damage-Auto-CC" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Damage-Auto-CC" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Damage-Auto} and @{Adjust-Damage-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Damage from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-damage-cc"></span>
                  </label>
                  <span title="@{Adjust-Damage-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Damage-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>
            <input type="checkbox" name="attr_modifiers_parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked">
              Dmg Bonus die:
              <input name="attr_Adjust-Damage-Bonus"
              value="0"
              min="0"
              title="@{Adjust-Damage-Bonus}:   Enter the Step number of any Bonus Die (other than karma) here."
              type="number">
            </div>    <!--End of Damage Box-->


                <!--Header - Start of TN-Mod Box-->
            <input name="attr_Adjust-TN-Total" type="hidden" value="0">
            <!-- <input name="attr_Adjust-TN-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-TN-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-header-hidden sheet-background-frame8 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Target #s</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-TN-Auto}   This is the automatic adjustment to all target numbers from Delayed Actions.">
                    <input name="attr_Adjust-TN-Auto" type="hidden" class="sheet-greenRed" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-TN-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-TN sheet-iconstaticBig" title="@{Adjust-TN-Auto} and @{Adjust-TN-Misc}   These are the total adjustment to all target numbers from Delayed Actions and Misc Adjustments."></span>
                  <span title="@{Adjust-TN-Misc}:   Enter any Misc Adjustments to all Target Numbers here.">
                    <input name="attr_Adjust-TN-Misc" type="hidden" class="sheet-greenRed" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-TN-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>    <!-- End of TN Box -->
          </div>    <!-- ********* End of Right Pane (modifiers)  ******** -->
        </div>    <!-- end of the three side panes.  -->


        <!-- ************************** This is a step table to be shown when printing -->
        <div class="sheet-hidden sheet-ShowIfPrint">
          <div class="sheet-headerbar">
            Steps
          </div>
          <div class="sheet-content">
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;1&nbsp;</b></div><div class="sheet-table-data"> D4-2</div><div class="sheet-table-data"><b>&nbsp;16&nbsp;</b></div><div class="sheet-table-data"> D12+D8+D6</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;2&nbsp;</b></div><div class="sheet-table-data"> D4-1</div><div class="sheet-table-data"><b>&nbsp;17&nbsp;</b></div><div class="sheet-table-data"> D12+2D8</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;3&nbsp;</b></div><div class="sheet-table-data"> D4</div><div class="sheet-table-data"><b>&nbsp;18&nbsp;</b></div><div class="sheet-table-data"> D12+D10+D8</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;4&nbsp;</b></div><div class="sheet-table-data"> D6</div><div class="sheet-table-data"><b>&nbsp;19&nbsp;</b></div><div class="sheet-table-data"> D20+2D6</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;5&nbsp;</b></div><div class="sheet-table-data"> D8</div><div class="sheet-table-data"><b>&nbsp;20&nbsp;</b></div><div class="sheet-table-data"> D20+D8+D6</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;6&nbsp;</b></div><div class="sheet-table-data"> D10</div><div class="sheet-table-data"><b>&nbsp; 21&nbsp;</b></div><div class="sheet-table-data"> D20+2D8 </div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;7&nbsp;</b></div><div class="sheet-table-data"> D12</div><div class="sheet-table-data"><b>&nbsp; 22&nbsp;</b></div><div class="sheet-table-data"> D20+D10+D8</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;8&nbsp;</b></div><div class="sheet-table-data"> 2D6</div><div class="sheet-table-data"><b>&nbsp; 23&nbsp;</b></div><div class="sheet-table-data"> D20+2D10</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;9&nbsp;</b></div><div class="sheet-table-data"> D8+D6</div><div class="sheet-table-data"><b>&nbsp; 24&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D10</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;10&nbsp;</b></div><div class="sheet-table-data"> 2D8</div><div class="sheet-table-data"><b>&nbsp; 25&nbsp;</b></div><div class="sheet-table-data"> D20+2D12</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;11&nbsp;</b></div><div class="sheet-table-data"> D10+D8</div><div class="sheet-table-data"><b>&nbsp; 26&nbsp;</b></div><div class="sheet-table-data"> D20+D12+2D6</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;12&nbsp;</b></div><div class="sheet-table-data"> 2D10</div><div class="sheet-table-data"><b>&nbsp; 27&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D8+D6</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;13&nbsp;</b></div><div class="sheet-table-data"> D12+D10</div><div class="sheet-table-data"><b>&nbsp; 28&nbsp;</b></div><div class="sheet-table-data"> D20+D12+2D8</div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;14&nbsp;</b></div><div class="sheet-table-data"> 2D12</div><div class="sheet-table-data"><b>&nbsp; 29&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D10+D8 </div></div>
            <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;15&nbsp;</b></div><div class="sheet-table-data"> D12+2D6</div><div class="sheet-table-data"><b>&nbsp; 30&nbsp;</b></div><div class="sheet-table-data"> 2D20+2D6</div></div>
          </div>
        </div>    <!--***************End of Step Table****************************-->
      </div>    <!-- end of side panes plus step table -->



            <!--*********************************JBF:Start of Main Pane - Contineus until end of html *************************-->
      <div class="sheet-w100p sheet-bordered">
              <!--**************************  Start of Section Core Title***Other Sections are also labelled section-core to display in the overview -->
              <!--**************************  Sections are split between title and Content to allow for Parameter Div -->
        <div class="sheet-section sheet-section-core">

                <!--Section Core - Creation Title-->
          <div class="sheet-Creation sheet-headerbar"><b class="sheet-creation-order">0-</b> Choose between Building a Hero (Select PC) / or creating a Foe (Select NPC, or Mook)</div>
          <div class="sheet-content sheet-Creation">
            <span class="sheet-nowrap3" title="@{NPC}   Is this character a PC, NPC, Mook, or Object?   (Mook means more than one token shares one character sheet) (Object means it is not really a character at all)">PC?
              <select name="attr_NPC" class="sheet-selShort">
                <option value="0"  title="PC"  > PC</option>
                <option value="1"  title="NPC" selected> NPC</option>
                <option value="2"  title="Mook"> Mook</option>
                <option value="-1" title="Object - The token is not really a character at all, but is an object such as a campfire or a torch."> Object</option>
              </select>
            </span>
            <span class="sheet-api sheet-HideIfPC" >
              <br>To Import a <i>Creature</i> and/or a <i>Mask</i> from Book copy and Paste  description (starting with name) into this tiny text box. Note that for Spirits, it is important to set the Discipline to Spirit and Circle to the SR first.<br>
              Creature : <textarea name="attr_textImportCreature" placeholder="text import"  class="sheet-textimport" title="Into this little text box, Copy and Paste whatever huge block of text describes the Creature in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import the creature."></textarea>
              <br>
              Mask: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <textarea name="attr_textImportMask" placeholder="text import" class="sheet-textimport" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Important Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'."></textarea>
            </span>
          </div>

                <!--Section Core - Title-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex">
            <div>
              <label title="@{attr_tab1-attrib-view} : Toggles the view of Attribute in the left pane .">
                <input type="checkbox" name="attr_tab1-attrib-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab1-defense-view} : Toggles the view of Defenses in the left pane .">
                <input type="checkbox" name="attr_tab1-defense-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab1-mods-view} : Toggles the view of Modifiers in the left pane .">
                <input type="checkbox" name="attr_tab1-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Overview
            <div>
              <label title="@{attr_overview-combat-param-mode} : Toggles the parameters mode .">
                <input type="checkbox" name="attr_overview-combat-param-mode" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_DSP-Race-edit-mode} : Toggles the edit mode .">
                <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>
        </div>    <!-- ***********  End of Section Core title -->


              <!--**************************  Start of Section Combat, Title***-->
        <div class="sheet-section sheet-section-combat sheet-w100p">
          <!--Section Combat - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex">
            <div>
              <label title="@{attr_tab2-attrib-view} : Toggles the view of Attributes in the left pane .">
                <input type="checkbox" name="attr_tab2-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab2-defense-view} : Toggles the view of Defenses in the left pane .">
                <input type="checkbox" name="attr_tab2-defense-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab2-mods-view} : Toggles the view of Modifiers in the left pane .">
                <input type="checkbox" name="attr_tab2-mods-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Combat
            <div>
              <label title="@{attr_overview-combat-param-mode} : Toggles the parameters mode .">
                <input type="checkbox" name="attr_overview-combat-param-mode" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
            </div>
          </div>
        </div>    <!-- End combat Header-->


              <!--**************************  Start of Section Core & Combat parameters -->
        <input type="checkbox" name="attr_overview-combat-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
        <div class="sheet-section sheet-section-core sheet-section-combat sheet-HideIfNotCloseChecked sheet-bordered">
          <div class="sheet-text-centered"><b class="sheet-heading"> Header Parameters</b></div>
          <div>
            <span class="sheet-nowrap sheet-label sheet-api"> Karma: Auto Mode :
              <select name="attr_show_karma_auto" class="sheet-selShort" title="@{show_karma_auto}   Enables the selection of the Karma Auto Mode, where each individual action can be set to automatically spend Karma or not." >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
          </div>
          <div>
            <span class="sheet-nowrap sheet-label">
              Damage - Stun: <select name="attr_show_damage_stun" class="sheet-selShort" title="@{show_damage_stun}   Show or Hide the Stun Damage and other Damage Details." >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
            <span class="sheet-nowrap sheet-label">
              Wound Treshold :<select name="attr_show_wound_treshold" class="sheet-selShort" title="Show a Wound Treshold Box in the header together with a Modifier" >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
          </div>
          <div>
            <span class="sheet-nowrap sheet-label" title="@{show_options_status}   Toggles the display of the options and statuses in the header, either just the basic ones, or all of them">
              Combat Options and Situation Modifiers : <select name="attr_show_options_status" class="sheet-selShort"  >
                <option value="0" selected title="Show the most common Combat Options and Statuses, with labels">Basic </option>
                <option value="1" title="Show the most common Combat Options and Statuses, with labels">All </option>
              </select>
            </span>
          </div>
          <div class="sheet-text-centered"><b class="sheet-heading"> Left Panes Parameters</b></div>
          <div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_natural_toggle}   Show or Hide the Action/Effect Toggles for the Attributes. These allows to select between rolling an Action or an Effect tets, that have different modifiers applying to them.">
                Attributes - Effect and Action Toggle:
                <select name="attr_show_actnefct_toggle" class="sheet-selShort" title="@{show_actnefct_toggle}   Show or Hide the Natural Defenses Toggle." >
                  <option value="0" selected>Hide </option>
                  <option value="1">Show </option>
                </select>
              </span>
            </div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_natural_toggle}   Show or Hide the Natural Defenses Toggle. Natural Defenses are the value of PD, MD, SD, PA, and MA, independantly from any equipment, but taking into account Discipline bonuses">
                Defenses - Natural Value toggle <select name="attr_show_natural_toggle" class="sheet-selShort"  >
                  <option value="0" selected>Hide </option>
                  <option value="1">Show </option>
                </select>
              </span>
            </div>
          </div>

          <div class="sheet-text-centered"><b class="sheet-heading"> Overview Combat Section Parameters</b></div>
          <div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_overview_miscpool}   Show or Hide the Miscellaneous Pools and Movement in the Overview">
                Overview - Misc Pools and Movement  <select name="attr_show_overview_miscpool" class="sheet-selShort"  >
                  <option selected value="0" >Hide </option>
                  <option  value="1" >Show </option>
                </select>
              </span>
            </div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_combat_miscpool}   Show or Hide the Miscellaneous Pools and Movement in the Overview">
                Combat - Misc Pools and Movement  <select name="attr_show_combat_miscpool" class="sheet-selShort"  >
                  <option selected value="0" >Hide </option>
                  <option  value="1" >Show</option>
                </select>
              </span>
            </div>
          </div>
        </div>    <!-- end Core and Combat parameters -->


                <!--**************************  Start of Section Core Content***Other Sections are also labelled section-core to display in the overview -->
                <!--**************************  Sections are split between title and Content to allow for Parameter Div -->
        <div class="sheet-section sheet-section-core">    <!--Section Core - Discipline and Race-->
          <div class="sheet-Creation sheet-headerbar" title="Refer to Player Guide Edition 4 p.58."> <b class="sheet-creation-order">1-</b> Choose a Race and Discipline </div>
          <div class="sheet-Creation"> Racial Abilities will be automatically added</div>
          <div class="sheet-content sheet-flex-container sheet-flexwrap">
            <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked hidden class="sheet-testChecked sheet-testLocked">
                  <!-- Section Core- First DSP Fieldset-->
            <div class="sheet-HideIfNotChecked sheet-nowrap">
              <span>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-txtMed">  &nbsp;Discipline / Other&nbsp;</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-numShort" title="This might be Spirit Rating, Creature Challenge Rating, Devotion Rating, etc.">&nbsp;Circle&nbsp;</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-numShort">Durability</b>
              </span><br>
              <datalist id="path">
                <option value="Brother of Stone"></option>
                <option value="Fire Eater"></option>
                <option value="Horror Stalker"></option>
                <option value="Journeyman"></option>
                <option value="Liberator"></option>
                <option value="Messenger"></option>
                <option value="Outcast"></option>
                <option value="Purifier"></option>
                <option value="Scholar"></option>
                <option value="Tail Dancer"></option>
                <option value="Windmaster"></option>
                <option value="Woodsmen"></option>
              </datalist>

              <!--Section Core - First fieldset-->
              <fieldset class="repeating_discipline" style="display:block;">
                <input class="sheet-testDSPPath sheet-hidden" name="attr_DSP_Code" type="hidden"> <!--Tests for DSP=Path -->
                <div>
                  <input name="attr_DSP_RowID" type="text" class="sheet-hidden">
                  <select name="attr_DSP_Code" class="sheet-nowrap sheet-txtMed sheet-text-left" title="@{repeating_discipline_X_DSP_Code}   Discipline.">
                    <option value="0.0"  selected="selected" title="Durability 5">None</option>
                    <option value="1.5"  title="Durability 5">Air Sailor</option>
                    <option value="2.5"  title="Durability 5">Archer </option>
                    <option value="3.7"  title="Durability 7">Beastmaster </option>
                    <option value="20.5" title="Durability 5">Boatman</option>
                    <option value="4.7"  title="Durability 7">Cavalryman </option>
                    <option value="5.3"  title="Durability 3">Elementalist </option>
                    <option value="21.7" title="Durability 7">Gauntlet</option>
                    <option value="6.3"  title="Durability 3">Illusionist </option>
                    <option value="7.3"  title="Durability 3">Nethermancer </option>
                    <option value="23.5" title="Durability 5">Sailor</option>
                    <option value="8.5"  title="Durability 5">Scout </option>
                    <option value="22.3" title="Durability 3">Shaman</option>
                    <option value="9.7"  title="Durability 7">Sky Raider </option>
                    <option value="10.7" title="Durability 7">Swordmaster </option>
                    <option value="11.5" title="Durability 5">Thief </option>
                    <option value="12.5" title="Durability 5">Troubadour </option>
                    <option value="13.7" title="Durability 7">Warrior </option>
                    <option value="14.5" title="Durability 5">Weaponsmith </option>
                    <option value="16.3" title="Durability 3">Wizard </option>
                    <option value="0.5"  title="Durability 5">Other/Misc. </option>
                    <option value="81.0" title="Path.">Path - Journeyman</option>
                    <option value="83.0" title="Path.">Path - Master</option>
                    <option value="89.0" title="Questors start at zero Durability, but may gain it.">Questor</option>
                    <option value="98.5" title="Use Circle to record Spirit Rating.">Spirit</option>
                    <option value="99.5" title="Use Circle to record Challenge Rating.">Creature</option>
                  </select>
                  <input name="attr_DSP_Name" class="sheet-hidden" type="text">&nbsp;
                  <input name="attr_DSP_Circle" class="sheet-numShorter sheet-Big" value="0" min="0" title="@{repeating_discipline_X_DSP_Circle}:   Characters Circle in this Discipline, Rank in their 'Questor Devotion' or Path, or Creature Challenge Rating or Spirit Rank." type="number">&nbsp;
                  <span title="@{repeating_discipline_X_DSP_Durability}:   Durability value for this Discipline. How much the unconsciousness rating is raised for each circle.">
                    <input class="sheet-testLocked sheet-hidden" name="attr_DSP_Code" value="0.5"
                    type="checkbox">
                    <input class="sheet-testLocked sheet-hidden" name="attr_DSP_Code" value="89.0"
                    type="checkbox">
                    <input class="sheet-testLocked sheet-hidden" name="attr_DSP_Code" value="98.5"
                    type="checkbox">
                    <input class="sheet-testLocked sheet-hidden" name="attr_DSP_Code" value="99.5"
                    type="checkbox">
                    <input name="attr_DSP_Durability" class="sheet-Locked sheet-UnlockIfChecked sheet-numShort"
                    value="0"
                    title="@{repeating_discipline_X_DSP_Durability}:   Durability value for this Discipline. How much the unconsciousness rating is raised for each circle."
                    type="number">
                  </span>
                  <span>
                    <input name="attr_DSP_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                    <input name="attr_DSP_LinksProvideValue_max" type="hidden" value="">
                    <input name="attr_DSP_LinksProvideValue" type="hidden" value="">
                  </span>
                  <input class="sheet-testCloseChecked sheet-hidden" name="attr_DSP_Code" value="0.5"   type="checkbox">
                  <span class="sheet-hidden sheet-UnHideIfDSPPath sheet-UnHideIfCloseChecked"> <!--Path Name-->
                    <input type="text" class="sheet-txtMed sheet-HideIf1879" list="path" name="attr_DSP_PathName" title="@{DSP_PathName} : Name of the followed Path or Custom Discipline" placeholder="Path/Disc Name">
                    <input type="text" class="sheet-txtMed sheet-HideIfNot1879" name="attr_DSP_PathName" title="@{DSP_PathName} : Name of the followed Path or Custom Discipline" placeholder="Path/Disc Name">
                  </span>

                  <input type="checkbox" value="1" name="attr_DSP_show-createbutton" class="sheet-hidden sheet-testCloseChecked">
                  <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-HideIfNotCloseChecked" name="act_createtalents" type="action"
                  title="act_createtalents:   Clicking this button will create the Circle 1 Talents for this discipline, and record for the LP calculation the costs of multi-disciplining if it is a second discipline .">
                  Add C1-Talents </button>
                </div>

                <div>
                  <span class="sheet-UnHideIfDSPPath sheet-hidden">
                  <b class="sheet-label">Base Discipline :</b>
                  <select name="attr_DSP_BaseDisc" class="sheet-nowrap sheet-txtMed sheet-text-left" title="@{repeating_discipline_X_DSP_BaseDisc}  For pathes, this is the base Discipline, to which Thread Weaving the Discipline Knack was attached, and that will benefit from the paths modifiers.">
                    <option value="0.0"  selected="selected" title="Durability 5">None</option>
                    <option value="1.5"  title="Durability 5">Air Sailor</option>
                    <option value="2.5"  title="Durability 5">Archer </option>
                    <option value="3.7"  title="Durability 7">Beastmaster </option>
                    <option value="20.5" title="Durability 5">Boatman</option>
                    <option value="4.7"  title="Durability 7">Cavalryman </option>
                    <option value="5.3"  title="Durability 3">Elementalist </option>
                    <option value="21.7" title="Durability 7">Gauntlet</option>
                    <option value="6.3"  title="Durability 3">Illusionist </option>
                    <option value="7.3"  title="Durability 3">Nethermancer </option>
                    <option value="23.5" title="Durability 5">Sailor</option>
                    <option value="8.5"  title="Durability 5">Scout </option>
                    <option value="22.3" title="Durability 3">Shaman</option>
                    <option value="9.7"  title="Durability 7">Sky Raider </option>
                    <option value="10.7" title="Durability 7">Swordmaster </option>
                    <option value="11.5" title="Durability 5">Thief </option>
                    <option value="12.5" title="Durability 5">Troubadour </option>
                    <option value="13.7" title="Durability 7">Warrior </option>
                    <option value="14.5" title="Durability 5">Weaponsmith </option>
                    <option value="16.3" title="Durability 3">Wizard </option>
                    <option value="0.5"  title="Durability 5">Other/Misc. </option>
                  </select>
                </span>
                </div>

              </fieldset>
            </div>

                  <!-- Section Core - Second DSP Fieldset -->
            <div class="sheet-HideIfChecked sheet-nowrap0">
              <span> <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-txtMed">
                &nbsp;Discipline / Other&nbsp;</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-numShort" title="This might be Spirit Rating, Creature Challenge Rating, Devotion Rating, etc.">Circle</b>
                <!-- <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-txtShort api">&nbsp;Half Magic&nbsp;</b> -->
              </span><br>
              <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked hidden class="sheet-testRepEditMode">
              <fieldset class="repeating_discipline">
                <input name="attr_DSP_RowID" type="text" class="sheet-hidden">
                <span>    <!--Path Name-->
                  <input name="attr_DSP_Name" type="text" class="sheet-txtMed" title="@{repeating_discipline_X_DSP_Name}   Discipline." readonly="readonly">
                </span>

                <input
                name="attr_DSP_Circle"
                class="sheet-numShorter sheet-Big"
                value="0"
                min="0"
                title="@{repeating_discipline_X_DSP_Circle}:   Characters Circle in this Discipline, Rank in their 'Questor Devotion' or Path, or Creature Challenge Rating or Spirit Rank."
                type="number"
                readonly="readonly">&nbsp;
                <span>
                  <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Code"
                  value="81.0"
                  type="checkbox">
                  <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Code" value="83.0"
                  type="checkbox">
                  <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Code" value="89.0"
                  type="checkbox">
                  <!--  1 / 2 is & # 189 ; -->
                  <button class="sheet-text-button ui-draggable sheet-HideIfChecked sheet-api"
                  name="roll_DSP_halfMagic"
                  type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ foreach:sct:c~ modValue : ?{Modification|0} ~ K-ask: ?{How many Karma to spend on this test|0} : 0 ~ Value: ?{What Attribute|Dex|Str|Tou|Per|Wil|Cha}~ Reason: @{DSP_Name} @{DSP_Circle} Half-Magic ?{What Attribute} test~ Roll: @{DSP_Circle}"
                  title="%{selected|DSP_halfMagic}   Roll a half magic check for this Character.">Half Magic
                 </button>
                </span>
                <span>
                  <input class="sheet-testChecked sheet-hidden"
                  name="attr_DSP_Code"
                  value="89.0"
                  type="checkbox">
                  <button class="sheet-text-button ui-draggable sheet-HideIfNotChecked sheet-api"
                  name="roll_DSP_Questor"
                  type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ foreach:sct:c~ modValue: ?{Modification|0} ~ K-ask: 0: ?{How many DP to spend on this test|0}~ Value: Cha~ Reason: @{DSP_Name} Devotion Rank @{DSP_Circle}~ Roll: @{DSP_Circle}"
                  title="%{selected|DSP_Questor}   Roll a Questor Devotion test.">Devote  </button>
                  <button class="sheet-text-button ui-draggable sheet-HideIfNotChecked sheet-NoAPI"
                  name="roll_DSP_QuestorNoAPI"
                  type="roll"
                  value="@{RollType} &amp;{template:default} {{name=Devotion}} {{Step: [[?{Step|@{Cha}+@{DSP_Circle}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                  title="%{selected|DSP_QuestorNoAPI}   Roll a Questor Devotion test.">Devote  </button>
                </span>

                <input name="attr_DSP_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfCloseChecked sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                <input name="attr_DSP_LinksProvideValue_max" type="hidden" value="">
              </fieldset>
            </div>

                  <!--Section Core - Race-->
            <div>
              <span>
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-txtShort" title="@{Race}   Character Race">   Race   </b>
              </span>
              <span class="sheet-HideIfNotChecked">
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-numShort" title="@{Karma-Modifier}:   Races Karma Modifier.">   Karma    </b>
              </span>
              <br>
              <select name="attr_Race" class="sheet-txtShort sheet-LockIfNotChecked" title="@{Race}   Character Race">
                <option value="None" title="Choose a race from the list." selected="selected"> Choose One...</option>
                <option value="Dwarf" title="Movement Rate 10, Karma Modifier 4, Heat Sight, Strong Back."> Dwarf</option>
                <option value="Elf" title="Movement Rate 14, Karma Modifier 4, Low Light Vision."> Elf</option>
                <option value="Human" title="Movement Rate 12, Karma Modifier 5, Versatility."> Human</option>
                <option value="Obsidiman" title="Movement Rate 10, Karma Modifier 3, Increased Wound Threshold +3, Natural Armor +3.">    Obsidiman</option>
                <option value="Ork" title="Movement Rate 12, Karma Modifier 5, Gahad, Low Light Vision."> Ork</option>
                <option value="Troll" title="Movement Rate 14, Karma Modifier 3, Heat Sight."> Troll</option>
                <option value="Tskrang" title="Movement Rate 12, Karma Modifier 4, Tail Combat."> T'skrang</option>
                <option value="Windling" title="Movement Rate 6/16, Karma Modifier 6, Astral Sight, Flight, Increased Physical Defense +2.">  Windling</option>
                <option value="Blood Elf" title="Movement Rate 14, Karma Modifier 4, Low Light Vision, Longing, Protected, Thorned.">  Blood Elf</option>
                <!--            <option value="9" title="Movement Rate 12, Karma Modifier 5, Versatility."> Human - Vorst</option>-->
                <option value="Other" title="Not a standard name-giver. Might be creature, spirit or Horror.">    Other</option>
              </select>
              <input name="attr_Karma-Modifier" class="sheet-numShort sheet-HideIfNotChecked" type="number" value="0" readonly title="@{Karma-Modifier}:   Races Karma Modifier.">
            </div>

            <span class="sheet-nowrap3 sheet-HideIfNotChecked" title="@{Flight}   Is the character able to fly">
              Flight: <input name="attr_Flight" type="checkbox" value="1" >
            </span>

                  <!--Section Core - Movement-->
            <div class="sheet-titlespan sheet-text-centered sheet-fixed-width sheet-txtShort sheet-HideIfNotChecked" title="Movement">
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-selShort" title="@{Movement}:   Current Movement Rate. If conditions would lower it less than one, value is set to '1*'">
                Movement
              </b><br>
              <input name="attr_Flight" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
              <label class="sheet-iconlabel2 sheet-HideIfNotCloseChecked" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
                <input type="checkbox" name="attr_condition-Flying" value="-1" class="sheet-iconcheckbox" checked> <span class="sheet-iconlabel-invert sheet-icon-flying"></span>
              </label>

              <span class="sheet-stepSpan sheet-bordered-bottom">
                <input type="checkbox" name="attr_condition-Flying" value="-1" class="sheet-hidden sheet-testCloseChecked" checked>
                <input name="attr_Fly-Movement-Race" value="16"  type="number" class="sheet-numShort sheet-StepBig sheet-HideIfCloseChecked" title="@{Fly-Movement-Race}:   Natural Fly Movement Rate determined by race (unmodified)"  >
                <input name="attr_Movement-Race" value="10" readonly type="number" class="sheet-numShort sheet-StepBig sheet-HideIfNotCloseChecked" title="@{Movement-Race}:   Natural Movement Rate determined by race (unmodified)"  >
              </span>
            </div>

            <!--JBF The Passion field is duplicated to allow an editable version and a non-editable version-->
            <div class="sheet-titlespan sheet-text-centered sheet-fixed-width sheet-txtShort sheet-HideIfChecked sheet-HideIfNotQuest sheet-NotCreation" >
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-txtShort">
                Passion:&nbsp;
              </b>
              <br>
              <input name="attr_Questor" class="sheet-txtShort" readonly type="text" title="@{Questor}   If this character is Questor, which Passion?">
            </div>

            <div class="sheet-titlespan sheet-text-centered sheet-fixed-width sheet-txtShort sheet-HideIfNotChecked sheet-NotCreation" >
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-txtShort">
                Passion:&nbsp;
              </b>
              <br>
              <select name="attr_Questor" class="sheet-txtShort" title="@{Questor}   If this character is Questor, which Passion?">
                <option value="None" selected="selected" title="None."> None</option>
                <option value="Astendar" title="Love, Arts, Music.">Astendar </option>
                <option value="Chorrolis" title="Wealth, Trade, Envy, Desire.">Chorrolis</option>
                <option value="Dis" title="Confusion, Unnecessary Work, Complex Bureaucratic Hierarchies, Slavery and Mastery. (Mad version of Erendis: Order, Bureaucracy and Work)">Dis (Mad) </option>
                <option value="Floranuus" title="Revelry, Energy, Victory, Motion.">Floranuus </option>
                <option value="Garlen" title="Hearth and Healing.">Garlen </option>
                <option value="Jaspree" title="Growth, Care of the Land, Love of the Wilderness.">Jaspree</option>
                <option value="Lochost" title="Rebellion, Change, Freedom.">Lochost</option>
                <option value="Mynbruje" title="Justice, Compassion, Empathy, Truth.">Mynbruje</option>
                <option value="Raggok" title="Vengeance, Bitterness, Jealousy. (Mad version of Rashomon: Leadership, Endurance, Tolerance, and Perseverance)">Raggok (Mad) </option>
                <option value="Thystonius" title="Physical Competition, Valor.">Thystonius</option>
                <option value="Upandal" title="Building, Construction, Planning.">Upandal</option>
                <option value="Vestrial" title="Manipulation, Deceit. (Mad version of Trickster Prankster)">Vestrial  (Mad) </option>
                <option value="Death" title="(Optional)">Death </option>
                <option value="Other" title="Other not listed.">Other / Misc. </option>
              </select>
            </div>
          </div>    <!-- end core Discipline and Race -->

                <!--Section Core - Health Rating edit-->
          <div class="sheet-Creation sheet-HideIfPC">
            <div class="sheet-headerbar"> Health Adjustments </div>
            <div class="sheet-content">
              <div class="sheet-small">For NPCs, you can here set some adjustment to the health values - Note that to manually set attributes, you can enter a temporary buff and use the function "Set Adjustments" that will transfer the temporary buff as permanent adjustment</div>
              <div class="">
                <div class="sheet-table-row">
                  <span class="sheet-table-data" title="@{Damage-Unconscious-Adjust}:   Adjustment to the calculated Unconscious Rating.">Unconscious Rating:</span>
                  <span class="sheet-table-data"><input name="attr_Damage-Unconscious-Adjust" type="number" value="0" class="sheet-numShort" title="@{Damage-Unconscious-Adjust}:   Adjustment to the calculated Unconscious Rating."></span>
                  <span class="sheet-table-data" title="@{Damage-Death-Rating-Adjust}:   Adjustment to the calculated Death Rating.">Death Rating:</span>
                  <span class="sheet-table-data"><input name="attr_Damage-Death-Rating-Adjust" type="number" value="0" class="sheet-numShort" title="@{Damage-Death-Rating-Adjust}:   Adjustment to the calculated Death Rating."></span>
                  <span class="sheet-table-data" title="@{Wound-Threshold-Adjust}:   Adjustment to the calculated Wound Threshold.">Wound Threshold:</span>
                  <span class="sheet-table-data"><input name="attr_Wound-Threshold-Adjust" type="number" value="0" class="sheet-numShort" title="@{Wound-Threshold-Adjust}:   Adjustment to the calculated Wound Threshold."></span>
                  <!--<span class="sheet-table-data" title="@{Durability-Rating-Adjust}:   Adjustment to the Durability Rating of your highest Discipline.">Durability Rating:</span>
                  <span class="sheet-table-data"><input name="attr_Durability-Rating-Adjust" type="number" value="0" class="sheet-numShort" title="@{Durability-Rating-Adjust}:   Adjustment to the Durability Rating of all Disciplines."></span></div><div class="sheet-table-row">-->
                  <span class="sheet-table-data" title="@{Recovery-Tests-Misc-Adjust}:   Adjustment to the number of Recovery Tests per day.">Recovery Tests/day:&nbsp;</span>
                  <span class="sheet-table-data"><input name="attr_Recovery-Tests-Misc-Adjust" type="number" value="0" class="sheet-numShort" title="@{Recovery-Tests-Misc-Adjust}:   Adjustment to the number of Recovery Tests per day."></span>
                  <span class="sheet-table-data" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step.">Recovery Step: </span>
                  <span class="sheet-table-data"><input name="attr_Recovery-Adjust" type="number" value="0" class="sheet-numShort" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step."></span>
                </div>
              </div>
            </div>
          </div>
        </div>    <!-- **************************  End of Section Core ***Some other Sections are also labelled section-core to display in the overview -->



              <!-- **************************  Start of Section Combat Content ***Other Sections are also labelled section-combat to display in the overview -->
              <!--JBF There is here a duplicate of the repeating_weapons fieldset, because displaying it directly from the Equipment section made a
                      very complex CSS. This is more or less the only fieldset that is duplicated instead of showing it in various sections -->
        <div class="sheet-section sheet-section-combat sheet-w100p">
                <!--JBF copy of the miscellaneous-->
          <div class="sheet-content">   <!--Misc - Maneuvers-->
            <div class="sheet-content sheet-HideIfNotCreature">
              <div>
                <b class="sheet-heading">Creature & Opponent Maneuvers : </b>
              </div>
              <div>
                <input name="attr_Creature-HardenedArmor" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-HardenedArmor}   Hardened Armor: Bonus damage resulting from additional successes on Attack tests is reduced by one per success. Typically, this means that instead of +2 damage per additional success, the attacker only gets +1 damage per additional success">
                  Hardened Armor
                </span>
                <input name="attr_Creature-GrabAndBite" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-GrabAndBite}   Grab and Bite: The creature may spend an additional success from an Attack test to automatically grapple an opponent. Grappled opponents automatically take bite damage each round until the grapple is broken.">
                  Grab and Bite
                </span>
                <input name="attr_Creature-Hamstring" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-Hamstring}   Hamstring: The creature may spend an additional success from an Attack test to halve the opponents Movement until the end of the next round. If the attack causes a Wound, the penalty lasts until the Wound is healed.">
                  Hamstring
                </span>
                <input name="attr_Creature-Overrun" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-Overrun}   Overrun: The creature may spend an additional success from an Attack test to force an opponent with a lower Strength Step to make a Knockdown test against a DN equal to the Attack test result.">
                  Overrun
                </span>
                <input name="attr_Creature-Pounce" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-Pounce}   Pounce: If the creature reaches its opponent with a leap and the opponent isnt too much larger, the creature may spend an additional success from the Attack test to force the opponent to make a Knockdown test against a DN equal to the Attack test result.">
                  Pounce
                </span>
                <input name="attr_Creature-SqueezeTheLife" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap3 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Creature-SqueezeTheLife}   Squeeze the Life: The creature may spend two additional successes from an Attack test to automatically grapple an opponent. Grappled opponents automatically take claw damage each round until the grapple is broken">
                  Squeeze the Life
                </span>
                <input name="attr_Creature-Fury" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
                <span class="sheet-nowrap2 sheet-HideIfCloseChecked sheet-fancyfont" title="@{Creature-Fury}   Fury threshold - If non-zero, instead of suffering penalties, Wounds grant this creature a bonus to tests. Once the creature has more Wounds than indicated by the Step of this ability, the bonuses are lost and the creature suffers normal penalties for Wounds.">
                  Fury <input name="attr_Creature-Fury" type="number" value="0" min="0" readonly>
                </span>
                <input name="attr_Creature-ResistPain" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
                <span class="sheet-nowrap2 sheet-HideIfCloseChecked sheet-fancyfont" title="@{Creature-ResistPain}   Resist Pain threshold - If non-zero, the creature ignores penalties for Wounds equal to this ability. For example, a creature with Resist Pain (2) ignores the penalties from the first two Wounds suffered.">
                  Resist Pain <input name="attr_Creature-ResistPain" type="number" value="0" min="0" readonly>
                </span>
                <input name="attr_Creature-Willful" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
                <span class="sheet-nowrap2 sheet-HideIfCloseChecked sheet-fancyfont" title="@{Creature-Willful}   Willful threshold - If non-zero, Talents and abilities used to dominate, control, tame or train the creature require additional successes equal to the Step of this ability.">
                  Willful <input name="attr_Creature-Willful" type="number" value="0" min="0" readonly>
                </span>
                <input name="attr_Creature-Ambush" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
                <span class="sheet-nowrap2 sheet-HideIfCloseChecked sheet-fancyfont" title="@{Creature-Ambush}   If the 'Ambushing' status in the header is turned ON, this is the amount that is added to Initiative, Attack, and Damage.">
                  <span class="sheet-iconstatic sheet-icon-ambush"></span> Ambush <input name="attr_Creature-Ambush" type="number" value="0" min="0" readonly >
                </span>
                <input name="attr_Creature-DiveCharge"  type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
                <span class="sheet-nowrap2 sheet-HideIfCloseChecked sheet-fancyfont" title="@{Creature-DiveCharge}   If the 'Diving/Charging' box is checked, this is the amount that is added to Attack, and Damage. Use this for ether Diving or Charging creature powers.">
                  <span class="sheet-iconstatic sheet-icon-charging"></span>Dive/Charge <input name="attr_Creature-DiveCharge" type="number" value="0" min="0" readonly>
                </span>
              </div>
              <div>
                <input name="attr_Opponent-ClipTheWing" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-ClipTheWing}   Clip the Wing: The attacker may spend two additional successes from an Attack test to remove the creatures ability to fly until the end of the next round. If the attack causes a Wound, the creature cannot fly until the Wound is healed. If the creature is in flight, it falls and suffers falling damage for half the distance fallen.">
                  Clip the Wing
                </span>
                <input name="attr_Opponent-CrackTheShell" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-CrackTheShell}   Crack the Shell: The attacker may spend extra successes from physical attacks (not spells) to reduce the creatures Physical Armor by 1 per success spent. This reduction takes place after damage is assessed, and lasts until the end of combat.">
                  Crack the Shell
                </span>
                <input name="attr_Opponent-Defang" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-Defang}   Defang: The opponent may spend additional successes to affect the creatures ability to use its poison. Each success spent reduces the Poisons Step by 2. If the attack causes a Wound, the creature cannot use its Poison power at all until the Wound is healed">
                  Defang
                </span>
                <input name="attr_Opponent-Enrage" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-Enrage}   Enrage: An opponent may spend additional successes from an Attack test to give a -1 penalty to the creatures Attack tests and Physical Defense until the end of the next round. Multiple successes may be spent for a cumulative effect.">
                  Enrage
                </span>
                <input name="attr_Opponent-Provoke" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap2 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-Provoke}   Provoke: The attacker may spend two additional successes from an Attack test to enrage the creature and guarantee he will be the sole target of the creatures next set of attacks. Only the most recent application of this maneuver has any effect.">
                  Provoke
                </span>
                <input name="Opponent-PryLoose" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
                <span class="sheet-nowrap3 sheet-HideIfNotCloseChecked sheet-fancyfont" title="@{Opponent-PryLoose}   Pry Loose: The attacker may spend additional successes from an Attack test to allow a grappled ally to immediately make an escape attempt with a +2 bonus per success spent on this maneuver">
                  Pry Loose
                </span>
              </div>
              <input value="1" class="sheet-hidden sheet-testRepEditMode" type="checkbox">
              <fieldset class="repeating_maneuvers">
                <div>
                  <input name="attr_MAN_RowID" type="text" class="sheet-hidden">
                  <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-testChecked sheet-hidden">
                  <span class="sheet-nowrap0" >
                    <label class="sheet-HideIfNotChecked" >
                      <!-- Man_Type : 1 - CREATURE
                                      -1 - Opponent
                                      Don't get mixed up : The checkboxes are "inverted" because clicking on the checkbox will put the appropriate value in MAN_Type-->

                      <input type="checkbox" name="attr_MAN_Type" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-creature" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                    <label class="sheet-HideIfChecked">
                      <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-opponent" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-titlespan sheet-txtLong sheet-bordered-bottom">
                    <input name="attr_MAN_Name" type="text" class="sheet-fixed-width sheet-txtLong" placeholder="name" title="@{repeating_maneuvers_MAN_Name} Use these fields to specify a custom Maneuvers (Opponent or Creature). ">
                  </span>
                  <label title="@{repeating_maneuvers_X_MAN_ShowNotes}   Show description of Maneuver">
                    <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <label class="sheet-HideIfChecked" title="@{repeating_maneuvers_MAN_Show} Use these field to hide/show Opponent maneuvers. It will not be offered up to the user as a way to spend extra successes unless the 'Show' field is checked. This allows the GM to get the opponent maneuvers all setup but not let the players see them until they have passed a knowledge test.">
                    <input type="checkbox" name="attr_MAN_Show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-maneuver-show"></span>
                  </label>
                </div>
                <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                <div class="sheet-HideIfNotChecked">
                  <textarea name="attr_MAN_Desc" class="sheet-details-small" title="@{repeating_maneuvers_MAN_Desc} Use these fields to specify a custom Maneuvers (Opponent or Creature). A text description of the maneuver." placeholder="Description of the Maneuver and how it works."></textarea>
                </div>
              </fieldset>
            </div>    <!-- end Misc - Movement & Misc Pools-->

            <input type="checkbox" name="attr_show_combat_miscpool" class="sheet-hidden sheet-testCloseChecked" value="1">
            <div class="sheet-content sheet-flex-container sheet-NotCreation sheet-HideIfNotCloseChecked">
                    <!--Misc -Movement-->
              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="@{Movement}:   Current Movement Rate. If conditions would lower it less than one, value is set to '1*'">
                <div class="sheet-headerbar" >Movement      </div>
                <div>
                  <span class="sheet-stepSpan sheet-bordered-bottom">
                    <span title="@{Movement-Mod-Auto}: Automatic Adjustments to Movement.">
                      <input name="attr_Movement-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                      <input name="attr_Movement-Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                    </span>
                    <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-hidden sheet-testCloseChecked">
                    <span class="sheet-HideIfCloseChecked">
                      <input name="attr_Fly-Movement-Base" readonly value="0" class="sheet-StepBig sheet-StepBase" title="@{Fly-Movement-Base}:   Permanent Flying Movement Rate from Race and permanent Adjustments."  type="number">
                      <input name="attr_Fly-Movement" readonly value="0" class="sheet-StepBig sheet-StepTotal" title="@{Fly-Movement}: Current Flying Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                    </span>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_Movement-Base" readonly class="sheet-StepBig sheet-StepBase" title="@{Movement-Base}:   Permanent Movement Rate from Race and permanent Adjustments."  type="number">
                      <input name="attr_Movement" readonly class="sheet-StepBig sheet-StepTotal" title="@{Movement}:    Current Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                    </span>
                    <span title="@{Movement-Buff}   Buffs or other temporary modifications to Movement Rating.">
                      <input name="attr_Movement-Buff" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                      <input name="attr_Movement-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                    </span>
                  </span>
                </div>
                <div>
                  <input name="attr_Flight" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                  <label class="sheet-iconlabel2 sheet-HideIfNotCloseChecked" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
                    <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-invert sheet-icon-flying"></span>
                  </label>
                  <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
                    <input type="checkbox" name="attr_condition-ImpairedMovement" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired"></span>
                  </label>
                  <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Heavy Impaired Movement : -10 to Movement Rate (1 min). -4 Penalty to movement based texts due to footing, cramping, or vision impairments. Dex test to avoid tripping or halting.">
                    <input type="checkbox" name="attr_condition-ImpairedMovement" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired4"></span>
                  </label>
                </div>
              </div>
              <input name="attr_condition-Flying" type="checkbox" value="-1" checked class="sheet-hidden sheet-testCloseChecked" >
              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-HideIfCloseChecked">
                <div class="sheet-headerbar" >Flying Alt.      </div>
                <div>
                  <input name="attr_condition-Flying" type="number" value="0" min="0" max="9" class="sheet-Big sheet-HideSpinners sheet-bordered-bottom" title="@{condition-Flying}:   Altitude at which the character is flying (as displayed in Token). This is between 0 and 9 because it is what the Token Marker can show. Discuss units with your GM." >
                </div>
                <div style="padding-bottom:6px">
                  &nbsp;
                </div>
              </div>

              <!--Misc - Shield-->
              <input name="attr_Shield-Name" class="sheet-hidden sheet-testPlaceholder" type="text" placeholder="Shield type">
              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-hideIfPlaceholder sheet-HideIfNotCombat sheet-HideIfPrint">
                <input type="checkbox" name="attr_condition-NoShield" value="1" class="sheet-testChecked sheet-hidden">
                <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-testChecked sheet-hidden">
                <span class="sheet-iconstatic sheet-icon-shield sheet-HideIfChecked"></span>
                <span class="sheet-iconstatic sheet-icon-noshield sheet-hidden sheet-UnHideIfChecked"></span>
                <div>
                  <span class="sheet-iconstatic sheet-icon-PD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-PA sheet-HideIfEdition4"></span>
                  <span class="sheet-stepSpan">
                    <input name="attr_Shield-Phys" type="number" value="0" class="sheet-StepBig" readonly title="@{Shield-Phys}:   Physical protection shield provides.">
                    <span title="@{Shield-Phys-Buff}   Buff or other temporary modification to PD (ED3 PA) specifically associated with their shield, and that they lose when Blindsided.">
                      <input name="attr_Shield-Phys-Buff" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                      <input name="attr_Shield-Phys-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                    </span>
                  </span>
                </div>
                <div>
                  <span class="sheet-iconstatic sheet-icon-MD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-MA sheet-HideIfEdition4"></span>
                  <span class="sheet-stepSpan">
                    <input name="attr_Shield-Myst" type="number" value="0" class="sheet-StepBig" readonly title="@
                    {Shield-Myst}:   Mystic protection shield provides.">
                    <span title="@{Shield-Myst-Buff}   Buff or other temporary modification to MD (ED3 MA) specifically associated with their shield, and that they lose when Blindsided.">
                      <input name="attr_Shield-Myst-Buff" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                      <input name="attr_Shield-Myst-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                    </span>
                  </span>
                </div>
              </div>

                    <!--Misc - Misc-Pools-->
              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
                <div class="sheet-headerbar" >
                  <input name="attr_Misc-PoolName-1" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-1}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
                </div>
                <div>
                  <input name="attr_Misc-PoolValue-1" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-1}:   You can use this number to keep track of anything you want." >
                </div>
                <div>
                  <input name="attr_Misc-PoolMax-1" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-1}:   You can use this number to keep track of anything you want." >
                </div>
              </div>

              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
                <div class="sheet-headerbar" >
                  <input name="attr_Misc-PoolName-2" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-2}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
                </div>
                <div>
                  <input name="attr_Misc-PoolValue-2" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-2}:   You can use this number to keep track of anything you want." >
                </div>
                <div>
                  <input name="attr_Misc-PoolMax-2" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-2}:   You can use this number to keep track of anything you want." >
                </div>
              </div>

              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
                <div class="sheet-headerbar" >
                  <input name="attr_Misc-PoolName-3" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-3}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
                </div>
                <div>
                  <input name="attr_Misc-PoolValue-3" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-3}:   You can use this number to keep track of anything you want." >
                </div>
                <div>
                  <input name="attr_Misc-PoolMax-3" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-3}:   You can use this number to keep track of anything you want." >
                </div>
              </div>
            </div>    <!-- end Misc (optional section) -->
          </div>    <!-- end Misc and Manuvers -->

          <input type="checkbox" name="attr_show_overview_miscpool" class="sheet-hidden sheet-testCloseChecked" value="1">
          <div class="sheet-headerbar sheet-headerbar sheet-HideIfNotCloseChecked">Weapons and Attacks</div>

                <!--Section Combat - Content-->
          <div class="sheet-content sheet-w100p sheet-bordered">
            <div class="sheet-api sheet-floatRight sheet-content">
              <button class="sheet-text-button" name="roll_Damage-Target" type="roll"
              title="@{Damage-Target}   Apply damage to all targeted tokens with a dropdown selection of the applicable armor."
              value="!Earthdawn~ setToken: @{target|token_id}~ Damage : ?{Damage)|1} : ?{Armor| Physical,PA | Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat| None,NA } : ?{Type of damage|Damage|Stun|Strain}" ><span class="sheet-buttonlabel">Dmg Target</span></button>
            </div>
            <div class="sheet-HideIfPC">
              <span class="sheet-nowrap0"><b>Nb Actions:</b>
                <input name="attr_Actions" type="number" value="1" title="@{Actions}:   Number of Standard Actions character/creature has per round." >
              </span>
              <span class="sheet-nowrap0">
                <button class="sheet-text-button sheet-api" name="roll_Attack" type="roll"
                value="!Earthdawn~ charID: @{character_id}~ Target: PD~ foreach~ Value: Attack-Step~ Roll: ?{Modification|0}"
                title="@{Attack}   Roll a generic Dex vs PD Attack modified by combat options and conditions."><span class="sheet-buttonlabel">Attack</span></button>
                <button class="sheet-text-button sheet-NoAPI" name="roll_Attack-NoAPI" type="roll"
                value="@{RollType} &{template:rolltargetnumber} {{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}} {{header=@{character_name}: Attack}} {{Step=[[?{Step|@{Attack-Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                title="@{Attack-NoAPI}   Roll a generic Dex Attack modified by combat options and conditions."><span class="sheet-buttonlabel">Attack</span></button>
              </span>
              <span class="sheet-nowrap0">
                <input name="attr_Attack-Rank" class="sheet-StepBig sheet-numShort sheet-bordered-bottom" type="number" value="0" title="@{Attack-Rank}   Rank of the generic Attack vs PD. This can be used for unarmed attacks, attacks where the character does not have the appropraite skill, or any situation when you need a generic attack." >
                <span class="sheet-stepSpan sheet-bordered-bottom" title="@{Attack-BaseStep} & @{Attack-Step} Base and Final Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting.">
                  <span title="@{Adjust-Attacks-Total-CC}: Automatic Attacks Modifiers for Close Combatcoming from Combat Options, Wounds, Situation Modifiers.">
                    <input name="attr_Adjust-Attacks-Total-CC" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                    <input name="attr_Adjust-Attacks-Total-CC" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                  </span>
                  <input name="attr_Attack-BaseStep" readonly type="number" class="sheet-StepBig sheet-StepBase" disabled
                  value="(@{Attack-Rank}+@{Dex-Step}+@{Dex-Mods})"
                  title="@{Attack-BaseStep}  Base Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting.">
                  <input name="attr_Attack-Step" readonly class="sheet-StepBig sheet-StepTotal"    type="number" disabled
                  value="(@{Attack-Rank}+@{Dex-Step}+@{Dex-Mods}+@{Adjust-Attacks-Total-CC}+@{Attack-Step-Mod})"
                  title="@{Attack-Step}   Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting." >
                  <span title="@{Attack-Step-Mod}:  Manual modifications to the Generic Attack.">
                    <input name="attr_Attack-Step-Mod" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Attack-Step-Mod" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </span>
            </div>
            <input class="sheet-testRepEditMode sheet-hidden" type="checkbox" > <!--JBF Necessary so that it doesn't show ADD/MODIFY-->
                  <!--Section Combat - WPN fieldset-->
            <fieldset class="repeating_weapons">
              <input name="attr_WPN_CombatSlot" type="checkbox" checked value="1" class="sheet-combattab sheet-hidden" >
              <div class="sheet-filter-box">
                <span class="sheet-hidden"><input name="attr_WPN_RowID" type="text" >
                </span>
                <span class="sheet-nowrap0" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                        <!--Toggle Range/CC Mode-->
                  <input type="checkbox" name="attr_WPN_CloseCombat" value="1" checked class="sheet-testChecked sheet-hidden">
                  <span class="sheet-iconstatic sheet-HideIfNotChecked sheet-icon-attacks-cc" title="@{repeating_weapons_X_WPN_CloseCombat}   This is a range weapon - Toggle in Equipment Tab."></span>
                  <span class="sheet-iconstatic sheet-HideIfChecked sheet-icon-attacks" title="@{repeating_weapons_X_WPN_CloseCombat}   This is a close combat weapon - Toggle in Equipment Tab."></span>
                </span>
                <span class="sheet-nowrap0">
                  <button class="sheet-text-button sheet-api"  type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ @{RollType} ~ foreach:sct:ust:c~ modValue: ?{Modification|0} ~K-ask: @{KarmaGlobalMode}@{WPN_Karma-Ask}: @{DPGlobalMode}@{WPN_DP-Ask} ~Action: WPN: @{WPN_RowID}"
                  title="@{repeating_weapons_X_WPN_Roll}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-buttonlabel" placeholder="Weapon type" ></button>
                  <button class="sheet-text-button sheet-NoAPI"  type="roll"
                  value="@{RollType} &{template:default} {{name=@{WPN_Name} Dmg}} {{Step=[[?{Step|@{WPN_Damage}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                  title="@{repeating_weapons_X_WPN_Roll-NoAPI}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-buttonlabel" placeholder="Weapon type" ></button>
                </span>
                <span class="sheet-nowrap0 sheet-hidden"><input name="attr_WPN_Base" type="number" value="0" min="0" class="sheet-numShort sheet-hidden" title="@{repeating_weapons_X_WPN_Base}   Base damage the weapon does." >
                </span>
                <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon respectively excluding or including  all modifiers .">
                  <span class="sheet-stepSpan sheet-bordered-bottom">
                    <span title="@{repeating_weapons_X_WPN_Mod-Auto}   This is the Total adjustment to Damage from Conditions and Combat Options.">
                      <input name="attr_WPN_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                      <input name="attr_WPN_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                    </span>
                    <input name="attr_WPN_Damage" type="number" disabled class="sheet-StepBig sheet-StepTotal" readonly
                    value="(@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{WPN_Effective-Rank}+@{WPN_Mods}+(@{Adjust-Damage-Total-CC}*(@{WPN_CloseCombat}+1)/2)+(@{Adjust-Damage-Total}*abs(@{WPN_CloseCombat}-1)/2))"
                    title="@{repeating_weapons_X_WPN_Damage}   Final Damage Step this weapon does including all modifiers .">
                    <input name="attr_WPN_BaseDamage" type="number" disabled class="sheet-StepBig sheet-StepBase" readonly
                    value="(@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{WPN_Effective-Rank})"
                    title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
                    <span title="@{repeating_weapons_X_WPN_Mods}   Modifications to the base damage.">
                      <input name="attr_WPN_Mods" type="hidden" class="sheet-redGreen" value="0">
                      <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                      <input name="attr_WPN_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                    </span>
                  </span>
                </span>

                <span>    <!--JBF Karma Toggle-Simple-->
                  <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                    <input type="hidden" name="attr_WPN_Karma-Ask" value="0">   <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                    <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-HideIfCloseChecked" >
                      <input type="checkbox" name="attr_WPN_Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                      <span class="sheet-HideIfNotChecked">
                        <label class="sheet-labelcheckbox" hidden title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On" >
                          <input type="checkbox" name="attr_WPN_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                        </label>
                      </span>
                      <span class="sheet-HideIfChecked">
                        <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_Karma} : Number of Karma Points to be spent when Karma is On">
                          <span class="sheet-iconselect-icon-noedit">
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma} Don't Spend any Karma when Karma is On."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                          </span>
                          <input type="hidden" name="attr_WPN_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                          <input type="hidden" name="attr_WPN_Karma-Limit_max" class="sheet-testKarMax">
                          <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                            <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                            <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                            <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                          </select>
                          <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                            <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                            <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                          </select>
                          <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                            <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                            <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          </select>
                          <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                            <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                            <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                            <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          </select>
                        </span>
                      </span>
                    </span>
                  </span>   <!--JBF End Of Karma Toggle-Simple-->
                        <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                  <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                    <input type="hidden" name="attr_WPN_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                    <input type="checkbox" name="attr_WPN_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-HideIfCloseChecked" >
                      <input type="checkbox" name="attr_WPN_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                      <span class="sheet-HideIfNotChecked">
                        <label class="sheet-labelcheckbox" hidden title="@{WPN_DP}   Automatically Spends One Devotion when Devotion is On" >
                          <input type="checkbox" name="attr_WPN_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                        </label>
                      </span>
                      <span class="sheet-HideIfChecked">
                        <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_DP} : Number of Devotion Points to be spent when Devotion is On">
                          <span class="sheet-iconselect-icon-noedit">
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP} Don't Spend any Dp when Dp is On."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On"></span>
                          </span>
                          <input type="hidden" name="attr_WPN_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                          <input type="hidden" name="attr_WPN_DP-Limit_max" class="sheet-testKarMax">
                          <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                            <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                            <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                            <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                          </select>
                          <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                            <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                            <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                          </select>
                          <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                            <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                            <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          </select>
                          <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                            <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                            <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                            <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          </select>
                        </span>
                      </span>
                    </span>
                  </span>   <!--JBF End Of DP Toggle-->
                </span>
                <span class="sheet-fixed-width sheet-w25px"></span>   <!--Spacer Span, just for alignment-->
              </div>
            </fieldset>
          </div>    <!-- end combat weapons and attacks content -->
        </div>    <!--  End of Section Combat***Other Sections are also labelled section-combat to display in the overview  -->



              <!-- ************Mini section - Title  Talent/Knacks/Skills are shown on the overview/Combat, instead of having one title line for each-->
        <div class="sheet-section sheet-section-combat sheet-section-core sheet-HideIfPrint">
          <div class="sheet-headerbar sheet-NotCreation">
            <span class="sheet-HideIfCreature">Talents, Knacks and Skills</span>
            <span class="sheet-HideIfNotCreature">Powers</span>
          </div>
        </div>



              <!-- **************************Start of the Talents section - Title.**********************
              It is also labelled core and combat so that the talents can be shown directly in the overview and combat.
              In Talents all Talents are shown without exception.
              In Overview all the talents are shown, except the spellcasting talents, because they are also shown in a duplicated repeating_talents fieldset located in the section-Spells
              In Combat, only the talents with the CombatSlot checked are shown, and spellcasting talents are not shown for the same reason as overview -->
        <div class="sheet-section sheet-section-talents sheet-section-combat sheet-section-core">
                <!--Section Talents - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab3-attrib-view} : Toggles the view of Attributes in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab3-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab3-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>

            <div class="sheet-HideIfCreature">Talents</div>
            <div class="sheet-HideIfNotCreature">Powers</div>

            <div class="sheet-HideIfPrint">
              <span class="sheet-info" title="Instructions: This tab is for recording all Talents EXCEPT Matrix Talents that are recorded on the Spell Tab and should NOT be duplicated here.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_talents-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">
                <input type="checkbox" name="attr_talents-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>

          <div class="sheet-Creation sheet-headerbar" title="Refer to Player Guide Edition 4 p.67"> <b class="sheet-creation-order">4-</b> Assign Talent Ranks</div>
          <input class="sheet-testAttrCosts" name="attr_Talents-Costs" value="8" type="hidden">
          <div class="sheet-Creation" title="Refer to Player Guide Edition 4 p.67"> Add below the Talents of your discipline, and spend 8 Ranks. Remaining Points :
            <input name="attr_Talents-Costs" class="sheet-numShort sheet-attrCostsRed"
                readonly="readonly" value="8"
                title="@{Talents-Costs}   Number of Talent points remaining from the starting 8."
                type="number">
          </div>
        </div>    <!--End of Talents - Header-->

              <!-- ********************************* Start of Section Knacks Header **************** -->
        <div class="sheet-section sheet-section-knacks sheet-section-combat sheet-section-core sheet-NotCreation">

          <!--Section Knacks - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab4-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab4-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab4-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Knacks
            <div class="sheet-floatRight sheet-HideIfPrint">
              <span class="sheet-info"
              title="Instructions: This tab is for recording Knacks, but can also be used to create combos, by linking to several other properties like Talents.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_knacks-edit-mode} : Toggles the Knack view to edit mode where the main attributes of each Knacks can be changed.">
                <input type="checkbox" name="attr_knacks-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>
        </div>    <!-- ******** End of Knacks Header ******* -->

              <!-- ****************************************** Start of Section Skills -Header *********************************** -->
        <div class="sheet-section sheet-section-skills sheet-section-core sheet-section-combat">
          <!--Section Skills - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfCombat sheet-HideIfOverview">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab5-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab5-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab5-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Skills
            <div class="sheet-floatRight sheet-HideIfPrint">
              <span class="sheet-info"
              title="Instructions: This tab is for recording all Skills EXCEPT spellcasting Skills: Spellcasting, Patterncraft, Willforce, Spell weaving, and Matrix Skills are all recorded on the Spell Tab and should NOT be duplicated here.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_skills-edit-mode} : Toggles the Skill view to edit mode where the main attributes of each Skills can be changed.">
                <input type="checkbox" name="attr_skills-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>

        </div>    <!-- ******** End of Skills Header ******* -->


              <!-- ************************ Start of Repeating Sections Parameters *********************** -->
        <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
        <div class="sheet-section sheet-section-talents sheet-section-knacks sheet-section-skills sheet-HideIfNotCloseChecked sheet-bordered">
          <div class="sheet-text-centered"><b class="sheet-heading"> Repeating Sections Parameters</b></div>
          <div>
            <span class="sheet-nowrap sheet-label"> Modifier Exceptions :
              <select name="attr_show_repeating_mod_exc" class="sheet-selShort" title="@{show_repeating_mod_exc}   In the Talents, Skills and Knacks, shows the advanced parameters for modifier exceptions. These parameters allow fine tuning of the modifiers that applies to a certain test (for example, active defenses are not affected by Defensive Stance -3 on all Action Tests). Note that the sheet has a database of the main Talents and their modifier exceptions, so you need this option only if you want to override the system." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
            <span class="sheet-nowrap sheet-label"> After roll parameters :
              <select name="attr_show_repeating_success" class="sheet-selShort" title="@{show_repeating_success}   Show all the parameters that affect the behaviour of the system after rolling. This includes special Effects, Displaying a Text, and Visibility." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
            <span class="sheet-nowrap sheet-label"> Links :
              <select name="attr_show_repeating_links" class="sheet-selShort" title="@{show_repeating_links}   Show all the parameters related to links." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
          <span class="sheet-nowrap sheet-label"> Special :
            <select name="attr_show_repeating_special" class="sheet-selShort" title="@{show_repeating_special}   Shows the Special field, that allows to declare to the system some specific Talents, such as Spellcasting, Initiative, Knockdown or Recovery Replacement." >
              <option selected value="0" >Hide </option>
              <option value="1" >Show </option>
            </select>
          </span>
          <div>
          <span class="sheet-nowrap sheet-label"> Use All Talents to Advance (PG p453) :
            <select name="attr_uatta" class="sheet-txtMed" title="@{uatta}   Specifies if the optional Use All Talents To Advance Option is to be used to recommend Circle Advancement in the Talent Summary." >
              <option selected value="0" >Core - Disabled </option>
              <option value="1" >Option - Enabled </option>
            </select>
          </span>
          </div>
          </div>
        </div>      <!-- **** End of repeating sections parameters ************ -->


              <!-- **************************Start of the Talents section - Content.**********************
                It is also labelled core and combat so that the talents can be shown directly in the overview and combat.
                In Talents all Talents are shown without exception.
                In Overview all the talents are shown, except the spellcasting talents, because they are also shown in a duplicated repeating_talents fieldset located in the section-Spells
                In Combat, only the talents with the CombatSlot checked are shown, and spellcasting talents are not shown for the same reason as overview -->
        <div class="sheet-section sheet-section-talents sheet-section-combat sheet-section-core">
                <!--Section Talents - Content-->
          <div class="sheet-content">
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">

            <input type="checkbox" hidden value="1" name="attr_talents-edit-mode" class="sheet-testRepEditMode" title="@{attr_talents-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">
            <div class="sheet-HideIfPrint sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfNotEditMode sheet-NotCreation" style="width: 95%" title="@{TalentSummary}   Count of all talents base ranks broken down by source category. Includes all Talents on this tab and Matrix.">
              <textarea name="attr_TalentSummary" class="sheet-details-small sheet-text-center" placeholder="Talent Count" readonly> </textarea>
            </div>
            <div>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-HideIfCreature">&nbsp;Talent Name&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-HideIfNotCreature">&nbsp;Power Name&nbsp;&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <!-- <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode sheet-hidden" title="Exceptions from General Modifiers. Active Defenses or Resistance are respectively immune to Defensive Stance or Knocked Down penalties">Exc.</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode sheet-hidden" title="Special Modifiers in addition to General Modifiers. Darkness or Movement Impaired respectively apply penalties to Tests based on Vision or Movement">Sp. Mod</b> -->
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan ">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest">DP</b>
            </div>

            <datalist id="talents">
              <option value="Acrobatic Defense"></option>
              <option value="Air Dance"></option>
              <option value="Air Sailing"></option>
              <option value="Air Speaking"></option>
              <option value="Ancient Bonds"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Applied Knowledge"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Arrow Weaving"></option>
              <option value="Astral Interference"></option>
              <option value="Astral Sight"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Bane Strike"></option>
              <option value="Battle Shout"></option>
              <option value="Bear Mark"></option>
              <option value="Beast Weaving"></option>
              <option value="Blood Share"></option>
              <option value="Body Control"></option>
              <option value="Book Memory"></option>
              <option value="Borrow Sense"></option>
              <option value="Call Animal Companion"></option>
              <option value="Call Missile"></option>
              <option value="Call of Harrow"></option>
              <option value="Ch'tard Dance"></option>
              <option value="Ch'tard Pierce"></option>
              <option value="Charge"></option>
              <option value="Claw Shape"></option>
              <option value="Climbing"></option>
              <option value="Command Nightflyer"></option>
              <option value="Conversation"></option>
              <option value="Craftsman"></option>
              <option value="Creature Analysis"></option>
              <option value="Dance Partner"></option>
              <option value="Danger Sense"></option>
              <option value="Dead Fall"></option>
              <option value="Delibarate Assault"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm Trap"></option>
              <option value="Disguise Self"></option>
              <option value="Dispel Magic"></option>
              <option value="Distract"></option>
              <option value="Dive Attack"></option>
              <option value="Dominate Beast"></option>
              <option value="Earth bond"></option>
              <option value="Earth Speak"></option>
              <option value="Earth Walk"></option>
              <option value="Edo Dance"></option>
              <option value="Edo Sweep"></option>
              <option value="Elemental Hold"></option>
              <option value="Elemental Tongues"></option>
              <option value="Elementalism"></option>
              <option value="Emotion Song"></option>
              <option value="Empathic Sense"></option>
              <option value="Engaging Banter"></option>
              <option value="Engaging Dance"></option>
              <option value="Enhance Animal Companion"></option>
              <option value="Etiquette"></option>
              <option value="Expansive Expertise"></option>
              <option value="False Sight"></option>
              <option value="Fire Heal"></option>
              <option value="Fireblood"></option>
              <option value="Fires of Gahad"></option>
              <option value="First Impression"></option>
              <option value="Focused Strike"></option>
              <option value="Forest Sense"></option>
              <option value="Forge Weapon"></option>
              <option value="Frighten"></option>
              <option value="Gauntlet Weaving"></option>
              <option value="Gaze into the Abyss"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Guardian's Service"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Illusionism"></option>
              <option value="Item History"></option>
              <option value="Liberation"></option>
              <option value="Lock Picking"></option>
              <option value="Long Shot"></option>
              <option value="Maneuver"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Morphism"></option>
              <option value="Mystic Aim"></option>
              <option value="Mystic Pursuit"></option>
              <option value="Navigation"></option>
              <option value="Nethermancy"></option>
              <option value="Patient Resilience"></option>
              <option value="Patterncraft"></option>
              <option value="Picking Pockets"></option>
              <option value="Pilot Boat"></option>
              <option value="Purge Karma"></option>
              <option value="Purification"></option>
              <option value="Read and Write Language"></option>
              <option value="Read River"></option>
              <option value="Research"></option>
              <option value="Rider Weaving"></option>
              <option value="Riposte"></option>
              <option value="Rite of Kho'Pesh"></option>
              <option value="River Weaving"></option>
              <option value="Sailing"></option>
              <option value="Scout Weaving"></option>
              <option value="Sea Weaving"></option>
              <option value="Sense Captive"></option>
              <option value="Sense Horrorspawn"></option>
              <option value="Shamanism"></option>
              <option value="Shatter Will"></option>
              <option value="Shield Bash"></option>
              <option value="Shivoavara Dance"></option>
              <option value="Shivoavara Escalation"></option>
              <option value="Shout of Justice"></option>
              <option value="Skora Dance"></option>
              <option value="Skora Slam"></option>
              <option value="Sky Weaving"></option>
              <option value="Speak Language"></option>
              <option value="Spell Weaving"></option>
              <option value="Spellcasting"></option>
              <option value="Spirit Covenant"></option>
              <option value="Spirit Hold"></option>
              <option value="Spirit Talk"></option>
              <option value="Sprint"></option>
              <option value="Stealthy Stride"></option>
              <option value="Steel Thought"></option>
              <option value="Story Weaving"></option>
              <option value="Studied Counter"></option>
              <option value="Suppress Curse"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Swimming"></option>
              <option value="Tail Dance"></option>
              <option value="Tail Spike"></option>
              <option value="Taunt"></option>
              <option value="Tenacious Weave"></option>
              <option value="Thief Weaving"></option>
              <option value="Thread Smithing"></option>
              <option value="Thread Weaving"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tiger Spring"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="True Shot"></option>
              <option value="True Sight"></option>
              <option value="Tyranny's Ruin"></option>
              <option value="Unarmed Combat"></option>
              <option value="Versatility"></option>
              <option value="Waterfall Slam"></option>
              <option value="Weapon Weaving"></option>
              <option value="Wil"></option>
              <option value="Wilderness Survival"></option>
              <option value="Wind Catcher"></option>
              <option value="Wing Blitz"></option>
              <option value="Winning Smile"></option>
              <option value="Wisdom of Ages"></option>
              <option value="Wizardry"></option>
              <option value="Wood Skin"></option>
              <option value="Wood Speak"></option>
              <option value="Wood Walk"></option>
              <option value="Wound Balance"></option>
              <option value="Animal Companion Durability"></option>
              <option value="Animal Possession"></option>
              <option value="Animal Talk"></option>
              <option value="Armor Mount"></option>
              <option value="Banish"></option>
              <option value="Bank Shot"></option>
              <option value="Battle Bellow"></option>
              <option value="Blade Juggle"></option>
              <option value="Claw Frenzy"></option>
              <option value="Cobra Strike"></option>
              <option value="Cold Purify"></option>
              <option value="Conceal Object"></option>
              <option value="Crushing Blow"></option>
              <option value="Disarm"></option>
              <option value="Double Charge"></option>
              <option value="Down Strike"></option>
              <option value="Earth Skin"></option>
              <option value="Evidence Analysis"></option>
              <option value="Fast Hand"></option>
              <option value="Fearsome Charge"></option>
              <option value="Flame Arrow"></option>
              <option value="Forge Armor"></option>
              <option value="Gliding Stride"></option>
              <option value="Hold Thread"></option>
              <option value="Hypnotize"></option>
              <option value="Impressive Display"></option>
              <option value="Inspire Others"></option>
              <option value="Iron Constitution"></option>
              <option value="Lasting Impression"></option>
              <option value="Leadership"></option>
              <option value="Life Check"></option>
              <option value="Lifesight"></option>
              <option value="Lion Heart"></option>
              <option value="Momentum Attack"></option>
              <option value="Mount Attack"></option>
              <option value="Orbiting Spy"></option>
              <option value="Power Mask"></option>
              <option value="Resist Taunt"></option>
              <option value="Safe Path"></option>
              <option value="Second Attack"></option>
              <option value="Second Shot"></option>
              <option value="Second Weapon"></option>
              <option value="Slough Blame"></option>
              <option value="Spirit Mount"></option>
              <option value="Spot Armor Flaw"></option>
              <option value="Steely Stare"></option>
              <option value="Stopping Aim"></option>
              <option value="Summon"></option>
              <option value="Tactics"></option>
              <option value="Temper Flesh"></option>
              <option value="Wheeling Attack"></option>
              <option value="Wheeling Defense"></option>
              <option value="Willforce"></option>
              <option value="Astral Pocket"></option>
              <option value="Bardic Voice"></option>
              <option value="Beguiling Blade"></option>
              <option value="Blind Fire"></option>
              <option value="Blood Insight"></option>
              <option value="Bloodhound Form"></option>
              <option value="Burning Vigor"></option>
              <option value="Chameleon"></option>
              <option value="Champion Challenge"></option>
              <option value="Chilling Strike"></option>
              <option value="Concise Casting"></option>
              <option value="Contest of Will"></option>
              <option value="Critical Hit"></option>
              <option value="Defensive Posture"></option>
              <option value="Disarming Smile"></option>
              <option value="Eagle Eye"></option>
              <option value="Eidetic Memory"></option>
              <option value="Elemental Mastery"></option>
              <option value="Escape Plan"></option>
              <option value="Fluid Movement"></option>
              <option value="Forge Flesh"></option>
              <option value="Glyph of Shielding"></option>
              <option value="Glyph of Unweaving"></option>
              <option value="Goring Attack"></option>
              <option value="Infuse Memory"></option>
              <option value="Lion Spirit"></option>
              <option value="Living Weapon"></option>
              <option value="Matrix Sight"></option>
              <option value="Missile Lock"></option>
              <option value="Netherwalk"></option>
              <option value="Perfect Focus"></option>
              <option value="Plant Talk"></option>
              <option value="Rally"></option>
              <option value="Range Pattern"></option>
              <option value="Relentless Recovery"></option>
              <option value="Resist Pain"></option>
              <option value="Storm Shield"></option>
              <option value="Summoning Circle"></option>
              <option value="Thought Link"></option>
              <option value="Thunderous Resolve"></option>
              <option value="Truth Through Lies"></option>
              <option value="Undermine"></option>
              <option value="Unflinching Fortitude"></option>
              <option value="Vine Armor"></option>
              <option value="Witty Repartee"></option>
              <option value="Alley Cat Approach"></option>
              <option value="Animal Leadership"></option>
              <option value="Astral Domain"></option>
              <option value="Aura Armor"></option>
              <option value="Blood of Death's Sea"></option>
              <option value="Casting Pattern"></option>
              <option value="Concentrated Assault"></option>
              <option value="Confront Horror"></option>
              <option value="Cutting Words"></option>
              <option value="Dream Thief"></option>
              <option value="Echolocation"></option>
              <option value="Effect Pattern"></option>
              <option value="Elemental Walk"></option>
              <option value="Enthralling Visions"></option>
              <option value="Ethereal Weapon"></option>
              <option value="Glyph of Attunement"></option>
              <option value="Glyph of Reversal"></option>
              <option value="Howl"></option>
              <option value="Impossible Hide"></option>
              <option value="Influence Missile"></option>
              <option value="Memory Probe"></option>
              <option value="Multi-Charge"></option>
              <option value="Multi-Shot"></option>
              <option value="Multi-Strike"></option>
              <option value="Nethersoul"></option>
              <option value="Safe Thought"></option>
              <option value="Second Chance"></option>
              <option value="Shared Matrix"></option>
              <option value="Shock Treatment"></option>
              <option value="Snapshot"></option>
              <option value="Snatch Talent"></option>
              <option value="Song of Battle"></option>
              <option value="Song of Deflection"></option>
              <option value="Soul Aegis"></option>
              <option value="Spirit Strike"></option>
              <option value="Spliced Weave"></option>
              <option value="Stone Skin"></option>
              <option value="Thunderstruck"></option>
              <option value="Venom"></option>
              <option value="Vicious Wound"></option>
              <option value="Vital Strike"></option>
              <option value="Vital Ward"></option>
              <option value="Weapon Breaker"></option>
              <option value="World Pulse"></option>
              <option value="Adaptability"></option>
              <option value="Aid Summoner"></option>
              <option value="Animate Dead"></option>
              <option value="Armored Scales"></option>
              <option value="Astral Camouflage"></option>
              <option value="Astral Portal"></option>
              <option value="Atk"></option>
              <option value="Aura of Awe"></option>
              <option value="Bite"></option>
              <option value="Claws"></option>
              <option value="Confusion"></option>
              <option value="Corrupt Compromise"></option>
              <option value="Corrupt Karma"></option>
              <option value="Corrupt Reality"></option>
              <option value="Curse"></option>
              <option value="Cursed Luck"></option>
              <option value="Damage Shift"></option>
              <option value="Destroy Weapon"></option>
              <option value="Detect True Element"></option>
              <option value="Displace"></option>
              <option value="Disrupt Fate"></option>
              <option value="Disrupt Magic"></option>
              <option value="Dmg"></option>
              <option value="Dragonbreath"></option>
              <option value="Dragonsight"></option>
              <option value="Dragonspeech"></option>
              <option value="Elemental Aura"></option>
              <option value="Engulf"></option>
              <option value="Enhance Summoner"></option>
              <option value="Enrage Element"></option>
              <option value="Fear"></option>
              <option value="Find"></option>
              <option value="Forge Construct"></option>
              <option value="Forge Trap"></option>
              <option value="Harvest Energy"></option>
              <option value="Horror Mark"></option>
              <option value="Horror Power"></option>
              <option value="Horror Thread"></option>
              <option value="Insubstantial"></option>
              <option value="Invisibility"></option>
              <option value="Karma Boost"></option>
              <option value="Karma Cancel"></option>
              <option value="Karma Drain"></option>
              <option value="Lair Sense"></option>
              <option value="Manifest"></option>
              <option value="Manipulate Element"></option>
              <option value="Poison"></option>
              <option value="Regeneration"></option>
              <option value="Remove Element"></option>
              <option value="Share Knowledge"></option>
              <option value="Skin Shift"></option>
              <option value="Soothe"></option>
              <option value="Spear"></option>
              <option value="Suppress Magic"></option>
              <option value="Suppress Mark"></option>
              <option value="Temperature"></option>
              <option value="Terror"></option>
              <option value="Unnatural Life"></option>
              <option value="Wingbeat"></option>
              <option value="Acting"></option>
              <option value="Alchemy"></option>
              <option value="Animal Handling"></option>
              <option value="Artist"></option>
              <option value="Bribery"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Disguise"></option>
              <option value="Entertainer"></option>
              <option value="Flirting"></option>
              <option value="Forgery"></option>
              <option value="Mapmaking"></option>
              <option value="Physician"></option>
              <option value="Seduction"></option>
              <option value="Streetwise"></option>
              <option value="Collaborate"></option>
              <option value="Create Projectile"></option>
              <option value="Cat's Grace"></option>
              <option value="One Soul Two Bodies"></option>
              <option value="Fire and Ice"></option>
              <option value="Glamour"></option>
              <option value="Blood Summon"></option>
              <option value="Enhanced Senses"></option>
              <option value="Overwhelming Force"></option>
              <option value="Size Up"></option>
              <option value="Shadowcloak"></option>
              <option value="One Last Word"></option>
              <option value="Battle Rites"></option>
              <option value="Travelling Smithy"></option>
              <option value="Book Mage"></option>
              <option value="Coordinate Attacks"></option>
              <option value="Windborne Speed"></option>
              <option value="Blood Bound Bow"></option>
              <option value="Perfect Shot"></option>
              <option value="Tough Hide"></option>
              <option value="Bestial War Form"></option>
              <option value="Shared Strength"></option>
              <option value="Shared Spirit"></option>
              <option value="Earth and Wind"></option>
              <option value="Elemental Form"></option>
              <option value="Hide Matrix"></option>
              <option value="Manipulate Reality"></option>
              <option value="Otherworldly Willpower"></option>
              <option value="Astral Face"></option>
              <option value="Supernal Awareness"></option>
              <option value="One With the World"></option>
              <option value="Strength of the Sky"></option>
              <option value="Stormcall"></option>
              <option value="Blood Bound Blades"></option>
              <option value="Audacious Bravado"></option>
              <option value="Shadow Sight"></option>
              <option value="Shadowmeld"></option>
              <option value="Unnatural Charm"></option>
              <option value="Encore"></option>
              <option value="Battlefield Awareness"></option>
              <option value="Elemental Warrior"></option>
              <option value="Blood Bound Forge"></option>
              <option value="Mystic Grounding"></option>
              <option value="Matrix Split"></option>
              <option value="Mystic Triangle"></option>
              <option value="Elemental Stance"></option>
              <option value="Pattern Infusion"></option>
              <option value="Pattern Manifestation"></option>
              <option value="Pack Leadership"></option>
              <option value="Spirit Pact"></option>
              <option value="Spirit Fuse"></option>
              <option value="Armor of Thystonius"></option>
              <option value="Astendar's Muse"></option>
              <option value="Astendar's Voice"></option>
              <option value="Awaken the Wood"></option>
              <option value="Bloom and Flourish"></option>
              <option value="Break Shackles"></option>
              <option value="Buttress Armor"></option>
              <option value="Chains of Obedience"></option>
              <option value="Challenge of Dis"></option>
              <option value="Cold Reminder"></option>
              <option value="Compel"></option>
              <option value="Desolate"></option>
              <option value="Detail Oriented"></option>
              <option value="Enchanted Gift"></option>
              <option value="Encouraging Oratory"></option>
              <option value="Energy in Motion"></option>
              <option value="Fertility's Season"></option>
              <option value="Fortify"></option>
              <option value="Friend of the Land"></option>
              <option value="Garlen's Relief"></option>
              <option value="Garlen's Solace"></option>
              <option value="Garlen's Touch"></option>
              <option value="Gift of Life"></option>
              <option value="Grave Commands"></option>
              <option value="Grave Empowerment"></option>
              <option value="Grip of Chorrolis"></option>
              <option value="Heart's wish"></option>
              <option value="Hone Weapon"></option>
              <option value="Incite Obsession"></option>
              <option value="Incite Rage"></option>
              <option value="Incite Rebellion"></option>
              <option value="Inspired Endurance"></option>
              <option value="Inspired Might"></option>
              <option value="Inspired Tenacity"></option>
              <option value="Invigorate"></option>
              <option value="Jaspree's Solace"></option>
              <option value="Jury Rig"></option>
              <option value="Let's Make a Deal"></option>
              <option value="Living Death"></option>
              <option value="Love in Bloom"></option>
              <option value="Mynbruje's Eye"></option>
              <option value="Open Mind"></option>
              <option value="Passion's Comfort"></option>
              <option value="Passion's Empowerment"></option>
              <option value="Passion's Insight"></option>
              <option value="Passion's Inspiration"></option>
              <option value="Pidgin"></option>
              <option value="Project Management"></option>
              <option value="Resist Influence"></option>
              <option value="Seal Home"></option>
              <option value="Shield the Innocent"></option>
              <option value="Silence Influence"></option>
              <option value="Stride of Floranuus"></option>
              <option value="Submit"></option>
              <option value="Taste of Power"></option>
              <option value="Torment"></option>
              <option value="Upandal's Armory"></option>
              <option value="Upandal's Palisade"></option>
              <option value="Vestrial's Tongue"></option>

            </datalist>


                  <!--Section Talents - Fieldset-->
            <fieldset class="repeating_talents">
              <input name="attr_T_Special" type="hidden" value="1" class="sheet-spelltab" >
              <input name="attr_T_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" >
              <div class="sheet-filter-box">
                <span class="sheet-hidden"><input name="attr_T_RowID" type="text">  <input name="attr_T_Target-TA" type="text"> <input name="attr_T_RollType" type="text"><input name="attr_T_ModPrefix" type="hidden" value="?"> </span>
                      <!--Talent Fieldset - Main Line-->
                <div style="margin:0px; ">    <!--Talents Fieldset - Button & Name-->
                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_T_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target}~  @{T_RollType}~  foreach:sct:ust:c~ modValue : @{T_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~ Action: T: @{T_RowID} "
                    title="%{selected|Roll_T_Roll-fromSheet} Roll this Talent Test.">
                    <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_T_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target-TA}~  @{T_RollType}~  foreach:sct:ust:c~ modValue : @{T_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~ Action: T: @{T_RowID}"
                    title="%{selected|Roll_T_Roll} Roll this Talent Test.   This version uses T_Target-TA instead of T_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>

                    <button class="sheet-text-button sheet-NoAPI" name="roll_T_Roll-NoAPI" type="roll"
                    value="@{T_RollType} &{template:rolltargetnumber} @{T_Target-NoAPI} {{header=@{charName}: @{T_Name}}} {{Step=[[?{Step|@{T_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{T_SuccessText}}}"
                    title="%{selected|Roll_T_Roll-NoAPI} Roll this Talent Test.">
                    <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <input name="attr_T_Name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <input name="attr_T_Name" type="text" list="talents" class="sheet-HideIfNotEditMode sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom sheet-HideIf1879" placeholder="Name">
                    <input name="attr_T_Name" type="text" list="talents" class="sheet-HideIfNotEditMode sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom sheet-HideIf1879" placeholder="Name">
                    <input name="attr_T_Name" type="text"  class="sheet-HideIfNotEditMode sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name">
                    <input name="attr_T_Name" type="text"  class="sheet-HideIfNotEditMode sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name">
                  </span>
                  <input name="attr_T_Name" type="text"  hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 100px;" title="@{repeating_talents_X_T_textImport}:   Talent Text import: This only shows up if Name is empty.">
                    <textarea type="text" name="attr_T_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">                        If you have a PDF copy of the book, you can copy an entire Talent or Questor Devotion description (starting with the name,
                      and including everything) and paste it into this tiny text box. It will be parsed and whatever fields
                      can be set based upon the text will be. You will still need to manually set some of the fields, most importantly "Modifiers".
                      You can also just type the Talent Name, and it will just be Autofilled with settings from the database.
                    </span>
                  </span>

                        <!--Talents Fieldset - Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" title="@{repeating_talents_X_T_Mod-Type}  What modifiers does this Talent apply.">
                    <span class="sheet-iconselect-icon">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Armor IP"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests with no Armor Penalty."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="(0)"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                    </span>
                    <select name="attr_T_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                      <option value="0" title="No modifiers at all."> None</option>
                      <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                      <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                      <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                      <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                      <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                      <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                      <option value="Init" title="All Initiative Penalties apply as modifiers to this test."> Initiative Penalty</option>
                      <option value="Armor IP" title="Initiative Penalties to Armor Only apply as modifiers to this Test."> Armor Init penalty</option>
                      <option value="(0)" title="This Talent does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                    </select>
                    <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->
                    <input class="sheet-testCloseChecked" name="attr_T_Special" hidden value="Initiative" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-initiative"></span>
                    <input class="sheet-testCloseChecked" name="attr_T_Special" hidden value="Recovery" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                    <input class="sheet-testCloseChecked" name="attr_T_Special" hidden value="Knockdown" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                  </span>

                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry fields -->
                  <input type="hidden" name="attr_T_Mod-Type" class="sheet-testModType"   >
                        <!--Talents Fieldset - Rank-->
                  <span class="sheet-titlespan sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                        <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_T_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <input name="attr_T_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_talents_X_T_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                      <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                      </span>
                    </span>
                  </span>

                    <span class="sheet-titlespan sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit">
                    <span class="sheet-stepSpan sheet-bordered-bottom sheet-NoAPI">
                      <input name="attr_T_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                      </span>
                    </span>

                          <!--With api, Free Talents have no editable Rank, managed through a link to discipline-->
                    <span class="sheet-HideIfNotEditMode sheet-api">
                      <input name="attr_T_Type" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Free">
                      <span class="sheet-HideIfCloseChecked sheet-stepSpan sheet-bordered-bottom"> <!--Not a Free Talent, Normal Edit-->
                        <span title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                          <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_T_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                        <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                          <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                        </span>
                      </span>

                      <span class="sheet-HideIfNotCloseChecked">
                        <input name="attr_T_LinksGetValue" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                        <span class="sheet-HideIfCloseChecked sheet-stepSpan sheet-bordered-bottom"> <!--Free Talent, Link Existing, Rank is readonly-->
                          <input name="attr_T_Rank" readonly value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                          <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                            <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                            <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                            <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                          </span>
                        </span>
                        <span class="sheet-HideIfNotCloseChecked"><!--Free Talent, No Link Existing, Link Button-->
                          <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                          value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: T : @{T_RowID}"
                          title="@{repeating_talents_X_T_btnSetLink} Set the Links for this Talent. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        </span>
                      </span>
                    </span>
                  </span>

                        <!--Talents Fieldset -  Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_talents_X_T_Attribute}  What attribute is associated with this talent.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_talents_X_T_Attribute}  What attribute is associated with this talent.">
                      <select name="attr_T_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This talent does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                      </select>
                    </span>
                  </span>

                        <!--Talents Fieldset - Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-bordered-bottom">
                      <span title="@{repeating_talents_X_T_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_T_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_T_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_T_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_T_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_talents_X_T_Step}:   Final action Step for this talent."  type="number"  >
                      <span title="@{repeating_talents_X_T_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                        <input name="attr_T_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                          <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode">
                      <input name="attr_T_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>

                        <!--Talents Fieldset -  Targets
                        Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_T_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">

                      <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Talent does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Talent targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Talent targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Talent targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_T_Target" title="@{repeating_talents_X_T_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 10.">10</option>
                      </select>
                    </span>

                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_talents_X_T_Target-NoAPI}  What does this talent target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Talent does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Talent targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Talent targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Talent targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_T_Target-NoAPI">
                        <option selected value=" " title="This Talent does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Talent targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Talent targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Talent targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>

                    <!-- JBF Target Armor when Damage-->
                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">
                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Talent does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_T_ArmorType" title="@{repeating_talents_X_T_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Talent does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>

                        <!--Talents Fieldset - Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_talents_X_T_Type}  How does the Adept know this talent.">
                    <select name="attr_T_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option disabled class="sheet-HideIfZeroDisc" >-- Discipline 1 --</option>
                      <option value="D1-Novice" class="sheet-HideIfZeroDisc" selected title="This is a Novice Discipline Talent for this character.">Novice</option>
                      <option value="D1-Journeyman" class="sheet-HideIfZeroDisc" title="This is a Journeyman Discipline Talent for this character." >Journeyman</option>
                      <option value="D1-Warden" class="sheet-HideIfZeroDisc" title="This is a Warden Discipline Talent for this character." >Warden</option>
                      <option value="D1-Master" class="sheet-HideIfZeroDisc" title="This is a Master Discipline Talent for this character." >Master</option>
                      <option value="TO1-Novice" class="sheet-HideIfZeroDisc" title="This is a Novice Talent Option for this character." >TO-Novice</option>
                      <option value="TO1-Journeyman" class="sheet-HideIfZeroDisc" title="This is a Journeyman Talent Option for this character." >TO-Journeyman</option>
                      <option value="TO1-Warden" class="sheet-HideIfZeroDisc" title="This is a Warden Talent Option for this character." >TO-Warden</option>
                      <option value="TO1-Master" class="sheet-HideIfZeroDisc" title="This is a Master Talent Option for this character." >TO-Master</option>
                      <option disabled class="sheet-HideIfNotQuest" >-- Questor --</option>
                      <option value="QD-Follower" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Follower</option>
                      <option value="QD-Adherent" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Adherent</option>
                      <option value="QD-Exemplar" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Exemplar</option>
                      <option disabled class="sheet-HideIfNotPath">-- Path --</option>
                      <option value="PA-Journeyman" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Journeyman Talent.">Path-Journeyman</option>
                      <option value="PA-Warden" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Warden Talent.">Path-Warden</option>
                      <option value="PA-Master" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Master Talent.">Path-Master</option>
                      <option disabled class="sheet-HideIfNotHuman">-- Versatility --</option>
                      <option value="V-Novice" class="sheet-HideIfNotHuman" title="This is a Novice Versatility Talent for this character.">Versatility Novice</option>
                      <option value="V-Journeyman" class="sheet-HideIfNotHuman" title="This is a Journeyman Versatility Talent for this character.">Versatility Journeyman</option>
                      <option value="V-Warden" class="sheet-HideIfNotHuman" title="This is a Warden Versatility Talent for this character.">Versatility Warden</option>
                      <option value="V-Master" class="sheet-HideIfNotHuman" title="This is a Master Versatility Talent for this character.">Versatility Master</option>
                      <option disabled >-- Others --</option>
                      <option value="Free" title="This is a Free Talent for one of the characters disciplines, and it's rank is always equal to his circle in that discipline.">Free</option>
                      <option value="Racial" title="This Talent is available because of the characters Race.">Racial</option>
                      <option value="Power" class="sheet-HideIfNotCreature" title="This is not really a Talent, it is really a Creature/Horror/Spirit/Dragon, Etc. Power.">Creature Power</option>
                      <option value="Item" title="This talent is granted by an Item such as a Thread Item.">Item</option>
                      <option value="Dummy" title="This is not really a Talent in and of itself, it is a placeholder for a talent-like effect or a combination of multiple talents. For example a warrior with both air dance and tiger spring might create a dummy entry for using both talents at the same time.">Dummy</option>
                      <option value="Special" title="This talent is available due to some special reason.">Special</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">-- Discipline 2 --</option>
                      <option value="D2-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Novice Discipline Talent for this characters 2nd Discipline.">D2-Novice</option>
                      <option value="D2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Journeyman Discipline Talent for this characters 2nd Discipline." >D2-Journeyman</option>
                      <option value="D2-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Warden Discipline Talent for this characters 2nd Discipline." >D2-Warden</option>
                      <option value="D2-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Master Discipline Talent for this characters 2nd Discipline." >D2-Master</option>
                      <option value="TO2-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Novice Talent Option for this characters 2nd Discipline." >TO2-Novice</option>
                      <option value="TO2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Journeyman Talent Option for this characters 2nd Discipline." >TO2-Journeyman</option>
                      <option value="TO2-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Warden Talent Option for this characters 2nd Discipline." >TO2-Warden</option>
                      <option value="TO2-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Master Talent Option for this characters 2nd Discipline." >TO2-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">-- Discipline 3 --</option>
                      <option value="D3-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Novice Discipline Talent for this characters 3rd Discipline.">D3-Novice</option>
                      <option value="D3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Journeyman Discipline Talent for this characters 3rd Discipline." >D3-Journeyman</option>
                      <option value="D3-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Warden Discipline Talent for this characters 3rd Discipline." >D3-Warden</option>
                      <option value="D3-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Master Discipline Talent for this characters 3rd Discipline." >D3-Master</option>
                      <option value="TO3-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Novice Talent Option for this characters 3rd Discipline." >TO3-Novice</option>
                      <option value="TO3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Journeyman Talent Option for this characters 3rd Discipline." >TO3-Journeyman</option>
                      <option value="TO3-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Warden Talent Option for this characters 3rd Discipline." >TO3-Warden</option>
                      <option value="TO3-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Master Talent Option for this characters 3rd Discipline." >TO3-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">-- Discipline 4 --</option>
                      <option value="D4-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Novice Discipline Talent for this characters 4th Discipline.">D4-Novice</option>
                      <option value="D4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Journeyman Discipline Talent for this characters 4th Discipline." >D4-Journeyman</option>
                      <option value="D4-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Warden Discipline Talent for this characters 4th Discipline." >D4-Warden</option>
                      <option value="D4-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Master Discipline Talent for this characters 4th Discipline." >D4-Master</option>
                      <option value="TO4-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Novice Talent Option for this characters 4th Discipline." >TO4-Novice</option>
                      <option value="TO4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Journeyman Talent Option for this characters 4th Discipline." >TO4-Journeyman</option>
                      <option value="TO4-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Warden Talent Option for this characters 4th Discipline." >TO4-Warden</option>
                      <option value="TO4-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Master Talent Option for this characters 4th Discipline." >TO4-Master</option>
                    </select>
                  </span>

                  <!--Talents Fieldset - Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder" title="{repeating_talents_X_T_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Talents"></span>
                    </span>
                    <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_T_Action" >
                      <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                      <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                      <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                      <option value="Sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                      <option value="NA" title="No Action for certain Talents">NA</option>
                    </select>
                  </span>

                  <!--Talents Fieldset -  Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder" title="@{repeating_talents_X_T_Strain}: number of strain points per use">
                    <input name="attr_T_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_T_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_T_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                  </span>

                  <!--Talents Fieldset - Karma & DP-->
                  <span class="sheet-hideIfPlaceholder">
                    <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_T_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_T_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{T_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_T_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_lessthan3" title="@{T_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_T_Karma" value="0"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{T_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_T_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3 ">
                              <option value="0" selected title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3 ">
                              <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>

                          </span>
                          <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_morethan3">
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_4" min="0" max="4" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_5" min="0" max="5" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_6" min="0" max="6" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_7" min="0" max="7" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_8" min="0" max="8" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_9" min="0" max="9" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_10" min="0" max="10" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_11" min="0" max="11" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_12" min="0" max="12" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_13" min="0" max="13" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_14" min="0" max="14" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_15" min="0" max="15" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_T_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_T_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_T_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_T_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{T_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_T_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{T_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{T_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_T_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_T_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </span>

                        <!--Talents Fieldset - Corrupt Karma-->
                  <span class="sheet-wrap0 sheet-hideIfPlaceholder" >
                    <input class="sheet-testCloseChecked" name="attr_T_Special" value="CorruptKarma" hidden type="checkbox">
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked sheet-api" name="roll_T_btnCorruptKarma" type="roll"
                    value="!Earthdawn~ SetToken: @{target|to have Karma Corrupted|token_id}~ Misc: CorruptKarma: ?{How many karma to corrupt|1}"
                    title="@{repeating_talents_X_T_btnCorruptKarma} Use this button to 'Corrupt Karma' during the next dice roll. It will transfer some successes from the CK pool to the CK action where it will effect the next rolls that use karma.">Corrupt Karma</button>
                  </span>

                        <!--Talents Fieldset -  Magnifier Icon to show the notes-->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_talents_X_T_ShowNotes}   Show description of Talent/Power">
                      <input type="checkbox" name="attr_T_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_talents_X_T_CombatSlot}  Should this Talent be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_T_CombatSlot" value="1" class="sheet-iconcheckbox">
                      <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_talents_X_T_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_T_Parameters" value="1" class="sheet-iconcheckbox">
                      <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                    <input name="attr_T_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-HideIfCloseChecked">
                      <input name="attr_T_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                      <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                    </span>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_T_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                    </span>
                  </span>
                </div>    <!--End of Play Visalization of the Talents, i.e. when all details are collapsed -->

                <input type="checkbox" hidden name="attr_T_Name" value="Talent Option"  class="sheet-testCloseChecked">
                <div class="sheet-HideIfNotCloseChecked sheet-titlespan sheet-text-left"title="@{repeating_talents_X_T_textImport}:   Talent Text import: This only shows up if Name is empty.">
                  <span class="sheet-label">Import :
                  </span>
                  <textarea type="text" name="attr_T_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>

                </div>





                      <!--Talents Fieldset -  Start of Parameter Visalization of the Talents, Where parameters are set-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_T_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom">
                        <!--Talent Fieldset - Karma & DP-->
                  <div class="sheet-floatRight sheet-content" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_talents_X_T_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed<span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_T_Karma-Limit_max" value="1" min="0" max="15" class="sheet-numShort" title="@{repeating_talents_X_T_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_talents_X_T_Karma-Limit} : Does this Talent require Karma Points to be spent every time it is used">
                      Karma Required:
                      <input type="checkbox" name="attr_T_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_talents_X_T_Karma-Limit} : Does this Talent require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label">
                      <span title="@{repeating_talents_X_T_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed<span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_T_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_talents_X_T_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>

                      <!--Talents Fieldset -  Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_T_Type" type="hidden">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_talents_X_T_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required:
                        <input type="checkbox"  name="attr_T_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_talents_X_T_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                    <!-- <span class="sheet-nowrap0 sheet-HideIfNoRoll" title="@{repeating_talents_X_T_CombatSlot}:   Should this Talent be summarized on the combat tab and placed in a Token Action?">
                    <span class="sheet-api">Tkn Actn</span><span class="sheet-NoAPI">Combat Tab</span>
                    <input name="attr_T_CombatSlot" type="checkbox" value="1" ></span> -->
                  </div>

                        <!--Talent Fieldset - Parameters -->
                  <div class="sheet-content">
                    <!-- <input name="attr_T_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value=""> -->

                    <input type="hidden" hidden name="attr_T_Mod-Type" class="sheet-testModType"  >
                          <!--Talent Fieldset - Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-nowrap sheet-label" title="@{repeating_talents_X_T_RollType}   Rolls should be made: public, gm, or hidden?">
                        <!-- <span class="sheet-iconstatic sheet-icon-dice"></span> : -->
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_T_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>

                          <select name="attr_T_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" "       title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm"     title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm"   title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>

                          <select name="attr_T_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_T_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_talents_X_T_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Talent Fieldset - Modifier exceptions-->
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_talents_X_T_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_T_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>
                      <span class="sheet-label">Vision Based :
                        <label title="@{repeating_talents_X_T_VisionBased}   If checked then this is a vision based action or effect, and suffers penalties from darkness and blindness.">
                          <input type="checkbox" name="attr_T_VisionBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-vision-based"></span>
                        </label>
                      </span>
                      <input class="sheet-testChecked sheet-hidden" name="attr_T_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_talents_X_T_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_T_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>
                      <span class="sheet-HideIfNotChecked sheet-label">Resistance :
                        <label title="@{repeating_talents_X_T_Resistance}   If checked then this action or effect serves as a Resistance test and does not suffer the normal penalty if the character is Knocked Down. ">
                          <input type="checkbox" name="attr_T_Resistance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-resistance"></span>
                        </label>
                      </span>
                    </div>

                            <!--Talent Fieldset - Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_talents_X_T_Special}  Certain talents or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_T_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Talent (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Talent (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                          <option value="Karma Ritual" title="This is the Karma Ritual in Older editions. Set the Karma Ritual in Adjustment to Talent, and this is the amount that will refill on new day.">Karma Ritual</option>
                          <option value="Speak Language" title="This is the Speak Language Talent, to be used in the Skills Section for the maximum number of Languages known.">Speak Language</option>
                          <option value="RW Language" title="This is the Read & Write Language Talent, to be used in the Skills Section for the maximum number of Languages known.">R/W Language</option>
                          <option disabled>-- Spellcasting --</option>
                          <option value="SPL-Spellcasting" title="This is a Spellcasting Talent, i.e. SpellCasting or Concise Casting.">SpellCasting</option>
                          <option value="SPL-Patterncraft" title="This is the Patterncraft Talent.">Patterncraft</option>
                          <option value="SPL-Willforce" title="This is the a Will Effect Talent, i.e. either WillForce, or a Dummy Talent for Willpower.">Will Effect</option>
                          <option value="SPL-Elementalism" title="This is an Elementalism Talent (Thread Weaving), i.e. Elementalism or a replacement talent like Elemental Mastery.">Elementalism</option>
                          <option value="SPL-Illusionism" title="This is the Illusionism Talent(Thread Weaving).">Illusionism</option>
                          <option value="SPL-Wizardry" title="This is the Wizardry Talent(Thread Weaving).">Wizardry</option>
                          <option value="SPL-Nethermancy" title="This is the Nethermancy Talent(Thread Weaving).">Nethermancy</option>
                          <option value="SPL-Shamanism" title="This is the Shamanism Talent(Thread Weaving).">Shamanism</option>
                          <option value="SPL-Power" title="This is the Weaving for Creature Power.">Power</option>
                          <option disabled>-- Powers --</option>
                          <option value="CorruptKarma" title="This is the Corrupt Karma Horror Power. Use this power to make note of how many karma you can corrupt on this target, but use the Token Action associated with the following button to spend these successes.">Corrupt Karma</option>
                          <option value="CursedLuck" title="This is the Cursed Luck Horror Power. Use of this power will set a value into @{Creature-CursedLuck}, and that number of dice will be 'cursed' for the next roll.">Cursed Luck</option>
                        </select>
                      </span>
                    </div>

                          <!--Talent Fieldset - Link Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <span class="sheet-nowrap sheet-api sheet-label">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_T_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: T : @{T_RowID}"
                        title="@{repeating_talents_X_T_btnSetLink} Set the Links for this Talent. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_talents_X_T_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap sheet-api">
                            <input name="attr_T_LinksGetValue" readonly type="text" class="sheet-bordered">
                            <span name="attr_T_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                        </span>
                      </span>
                    </div>

                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_T_sayTotalSuccess" class="selLong" title="@{repeating_talents_X_T_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_talents_X_T_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_talents_X_T_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>

                            <!--Talent Fieldset - SFX-->
                      <span class="sheet-nowrap0 sheet-api">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_T_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: T: @{T_RowID}"
                        title="@{repeating_talents_X_T_btnSetFX} Set the Special Effects for this Talent.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_talents_X_T_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_T_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_T_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>

                            <!--Talent Fieldset - Success Text-->
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_T_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_T_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_T_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                    </div>
                  </div>    <!-- end Talent Fieldset - Parameters -->
                </div>    <!--JBF 210106 : End of Parameter  of the Talents, Where parameters are set-->

                      <!--Talent Fieldset - Start of Detail  of the Talents, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_T_ShowNotes" value="1"
                type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <textarea name="attr_T_Notes" class="sheet-details" title="@{repeating_talents_X_T_Notes}   Description of Talent and how it works." placeholder="Description of the Talent and how it works."></textarea>
                </div>
                      <!--JBF 210106 : End of Detail  of the Talents, Where secundary information during play is displayed, but not parametrization-->
              </div>    <!-- end filterbox -->
            </fieldset>
          </div>    <!-- end of section content -->
        </div>    <!-- ********************************** End of Section Talents ************************* -->



              <!-- ********************************* Start of Section Knacks Content ******************** -->
        <div class="sheet-section sheet-section-knacks sheet-section-combat sheet-section-core sheet-NotCreation">
          <div class="sheet-content">   <!--Section Knacks - Content-->
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">
            <input type="checkbox" hidden value="1" name="attr_knacks-edit-mode" class="sheet-testRepEditMode" title="@{attr_knacks-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">

            <div class="sheet-HideIfNotEditMode">
              <input type="hidden" name="attr_Knack-Summary-Param" class="sheet-testNum" value="0">
              <div>
              <b class="sheet-label"> Knack Summary Report - </b>
              <b class="sheet-label">Hide :
                <input type="radio" name="attr_Knack-Summary-Param" value="0" checked title="@{Knack-Summary-Param} : Hide completely the report">
              </b>
              <b class="sheet-label">Use Current Ranks and Circle :
                <input type="radio" name="attr_Knack-Summary-Param" value="1"  title="@{Knack-Summary-Param} : Report will be generated showing only the Knacks where the conditions are already met">
              </b>
              <b class="sheet-label">Use Substitution Ranks and Circle :
                <input type="radio" name="attr_Knack-Summary-Param" value="2"  title="@{Knack-Summary-Param} : Report will be generated as if the Rank and Discipline Circle had reach a declared level, in order to plan future development">
                <input type="number" class="sheet-NumShort sheet-HideIfZero sheet-HideIfOne" name="attr_Knack-Summary-SubRank" value="15" min="0" max="21" title="@{Knack-Summary-SubRank} : This value will be used for Requirement evalutation instead of actual values">
              </b>
              <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-HideIfZero" name="act_knacksummary" type="action"
              title="act_knacksummary:   Click to generate the Knack Summary."> Generate </button>
            </div>
            <div class="sheet-HideIfZero">
              <textarea name="attr_Knack-Summary" class="sheet-text-left sheet-HideIfPrint sheet-details" title="@{Knack-Summary}   Shows a Report of the Knacks accessible to the character according to his current progress."></textarea>
            </div>

            </div>




            <div style="height: 30px;" class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint">
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Knack Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan ">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest">DP</b>
            </div>

            <!--Section Knacks - Fieldset-->
            <fieldset class="repeating_knacks">
              <input name="attr_NAC_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab">
              <div class="sheet-filter-box">
                <span class="sheet-hidden"><input name="attr_NAC_RowID" type="text">  <input name="attr_NAC_Target-TA" type="text"> <input name="attr_NAC_ModPrefix" type="hidden" value="?"></span>
                <div style="margin:0px;">      <!--Knacks Fieldset - Main Line-->
                        <!--Knacks Fieldset- Button & Name-->
                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_NAC_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~   Target: @{NAC_Target}~ @{NAC_RollType}~ foreach:sct:ust:c~ modValue : @{NAC_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{NAC_Karma-Ask}: @{DPGlobalMode}@{NAC_DP-Ask} ~Action: NAC: @{NAC_RowID}"
                    title="%{selected|Roll_NAC_Roll-fromSheet} Roll this Knack Test.">
                    <input name="attr_NAC_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_NAC_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~   Target: @{NAC_Target-TA}~ @{NAC_RollType}~ foreach:sct:ust:c~ modValue : @{NAC_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{NAC_Karma-Ask}: @{DPGlobalMode}@{NAC_DP-Ask} ~Action: NAC: @{NAC_RowID}"
                    title="%{selected|Roll_NAC_Roll} Roll this Knack Test.   This version uses NAC_Target-TA instead of NAC_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>
                    <button class="sheet-text-button sheet-NoAPI" name="roll_NAC_Roll-NoAPI" type="roll"
                    value="@{NAC_RollType} &{template:rolltargetnumber} @{NAC_Target-NoAPI} {{header=@{charName}: @{NAC_Name}}} {{Step=[[?{Step|@{NAC_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{NAC_SuccessText}}}"
                    title="%{selected|Roll_NAC_Roll-NoAPI} Roll this Knack Test.">
                    <input name="attr_NAC_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <input name="attr_NAC_Name" type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-testPlaceholder sheet-bordered-bottom" placeholder="Name">
                    <!--JBF 210115 : In Edit mode, the name is out of the button to be editable-->
                  </span>
                  <input name="attr_NAC_Name" type="text" hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 25px;" title="@{repeating_knacks_X_NAC_textImport}:   Knack Text import: This only shows up if Name is empty.">
                    <textarea name="attr_NAC_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">
                      If you have a PDF copy of the book, you can copy an entire Knack or Questor Devotion description (starting with the name, and including everything) and paste it into this tiny text box. It will be parsed and whatever fields can be set based upon the text will be. You will still need to manually set some of the fields, most importaintly "Modifiers".
                    </span>
                  </span>

                        <!--Knacks Fieldset- Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Mod-Type}  What modifiers does this Knack apply.">
                    <span class="sheet-iconselect-icon">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Armor IP"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests with no Armor Penalty."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="(0)"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                    </span>

                    <select name="attr_NAC_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                      <option value="0" title="No modifiers at all."> None</option>
                      <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                      <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                      <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                      <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                      <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                      <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                      <option value="Init" title="All Initiative Penalties apply as modifiers to this test."> Initiative Penalty</option>
                      <option value="Armor IP" title="Initiative Penalties to Armor Only apply as modifiers to this Test."> Armor Init penalty</option>
                      <option value="(0)" title="This Knack does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                    </select>
                    <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" hidden value="Initiative" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-initiative"></span>
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" hidden value="Recovery" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" hidden value="Knockdown" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                  </span>
                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry felds -->
                  <input type="hidden" name="attr_NAC_Mod-Type" class="sheet-testModType"   >
                        <!--Knacks Fieldset- Rank-->
                  <input name="attr_NAC_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                  <!--Links initialized, show the value-->
                  <span class="sheet-hideIfPlaceholder sheet-HideIfCloseChecked sheet-HideIfOverviewNoEdit">
                    <span class="sheet-HideIfNotEditMode sheet-fixed-width sheet-w100px sheet-titlespan">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <input name="attr_NAC_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-api" readonly title="@{repeating_knacks_X_NAC_LinkValue}: Knack Rank is to be calculated via a Link. Go to Parameter to Link the Knack to its Base Talent, so that Base Talent Rank can be used in Knacks Step Calculation."  type="number"  >
                        <input name="attr_NAC_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners sheet-NoAPI" title="@{repeating_knacks_X_NAC_Rank}:   Characters Base Rank in this knack."  type="number"  >
                        <input name="attr_NAC_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_knacks_X_NAC_Effective-Rank}:   Characters effective Rank in this knack counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_knacks_X_NAC_Rank-Adjust}:   Adjustments to the use of this knack that increases effective rank like Thread Items.">
                          <input name="attr_NAC_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_NAC_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                        </span>
                      </span>
                    </span>

                    <span class="sheet-HideIfEditMode sheet-fixed-width sheet-w75px sheet-titlespan ">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="" title="">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>

                        <input name="attr_NAC_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-api" readonly title="@{repeating_knacks_X_NAC_LinkValue}: Knack Rank is to be calculated via a Link. Go to Parameter to Link the Knack to its Base Talent, so that Base Talent Rank can be used in Knacks Step Calculation."  type="number"  >
                        <input name="attr_NAC_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-NoAPI" readonly title="@{repeating_knacks_X_NAC_Rank}:   Characters Base Rank in this knack."  type="number"  >
                        <input name="attr_NAC_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_knacks_X_NAC_Effective-Rank}:   Characters effective Rank in this knack counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_knacks_X_NAC_Rank-Adjust}:   Adjustments to the use of this knack that increases effective rank like Thread Items.">
                          <input name="attr_NAC_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_NAC_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                        </span>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-hideIfPlaceholder sheet-HideIfNotCloseChecked sheet-HideIfOverviewNoEdit">
                  <span class="sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-titlespan ">
                    <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                    title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                  </span>

                  <span class="sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-titlespan">
                    <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                    title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                  </span>
                </span>

                        <!--Knacks Fieldset- Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Attribute}  What attribute is associated with this knack.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_knacks_X_NAC_Attribute}  What attribute is associated with this knack.">
                      <select name="attr_NAC_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This knack does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                      </select>
                    </span>
                  </span>

                        <!--Knacks Fieldset-Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-HideIfNoRoll sheet-bordered-bottom">
                      <span title="@{repeating_knacks_X_NAC_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_NAC_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_NAC_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_NAC_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_knacks_X_NAC_BaseStep}:   Permanent Step of the Knack before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_NAC_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_knacks_X_NAC_Step}:   Final action Step for this knack."  type="number"  >
                      <span title="@{repeating_knacks_X_NAC_Mods}:  Manual modifications to the use of this knack that do NOT increase effective rank.">
                        <input name="attr_NAC_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_NAC_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                    <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode sheet-HideIfNoRoll">
                      <input name="attr_NAC_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_knacks_X_NAC_BaseStep}:   Permanent Step of the Knack before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>

                        <!--Knacks Fieldset- Targets Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_NAC_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">
                            <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Knack does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Knack targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Knack targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Knack targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_NAC_Target" title="@{repeating_knacks_X_NAC_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 6.">10</option>
                      </select>
                    </span>

                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_knacks_X_NAC_Target-NoAPI}  What does this knack target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Knack does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Knack targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Knack targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Knack targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_NAC_Target-NoAPI">
                        <option selected value=" " title="This Knack does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Knack targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Knack targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Knack targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>

                          <!-- JBF Target Armor when Damage-->
                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">
                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Knack does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_NAC_ArmorType" title="@{repeating_knacks_X_NAC_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Knack does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>

                        <!--Knacks Fieldset- Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Type}  How does the Adept know this knack.">
                    <select name="attr_NAC_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option value="Knack" selected title="This is a standard Talent Knack.">Knack</option>
                      <option value="Creature" title="This is not really a Knack, it is really a Creature/Horror/Spirit/Dragon, Etc. Power.">Creature Power</option>
                      <option value="Item" title="This Knack is granted by an Item such as a Thread Item.">Item</option>
                      <option value="Dummy" title="This is not really a Knack in and of itself, it is a placeholder for a Knack-like effect or a combination of multiple talents. For example a warrior with both air dance and tiger spring might create a dummy entry for using both talents at the same time.">Dummy</option>
                      <option value="Special" title="This Knack is available due to some special reason.">Special</option>
                    </select>
                  </span>

                        <!--Knacks Fieldset- 210106 Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder" title="{repeating_knacks_X_NAC_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a knack or skill usually requires the character to spend more than one round before a test is made."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Knacks"></span>
                    </span>
                    <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_NAC_Action" >
                      <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                      <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                      <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                      <option value="Sustained" title="A Sustained action for a knack or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                      <option value="NA" title="No Action for certain Knacks">NA</option>
                    </select>
                  </span>

                        <!--Knacks Fieldset- Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Strain}: number of strain points per use">
                    <input name="attr_NAC_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_NAC_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_NAC_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                  </span>

                        <!--Knacks Fieldset- Karma & DP-->
                  <span class="sheet-hideIfPlaceholder">
                          <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_NAC_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_NAC_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_NAC_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_NAC_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_NAC_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{NAC_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{NAC_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_NAC_Karma" value="0"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{NAC_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_NAC_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_NAC_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{NAC_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{NAC_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of Karma Toggle-Simple-->
                        <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_NAC_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_NAC_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_NAC_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_NAC_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{NAC_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_NAC_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{NAC_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{NAC_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{NAC_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_NAC_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_NAC_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{NAC_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{NAC_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </span>
                        <!--Knacks Fieldset- Corrupt Karma-->
                  <span class="sheet-wrap0 sheet-hideIfPlaceholder" >
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" value="CorruptKarma" hidden type="checkbox">
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked sheet-api" name="roll_NAC_btnCorruptKarma" type="roll"
                    value="!Earthdawn~ SetToken: @{target|to have Karma Corrupted|token_id}~ Misc: CorruptKarma: ?{How many karma to corrupt|1}"
                    title="@{repeating_knacks_X_NAC_btnCorruptKarma} Use this button to 'Corrupt Karma' during the next dice roll. It will transfer some successes from the CK pool to the CK action where it will effect the next rolls that use karma.">Corrupt Karma</button>
                  </span>

                        <!--Knacks Fieldset- Notes Icon-->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_knacks_X_NAC_ShowNotes}   Show description of Knack/Power">
                      <input type="checkbox" name="attr_NAC_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_knacks_X_NAC_CombatSlot}  Should this Knack be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_NAC_CombatSlot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_knacks_X_NAC_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_NAC_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                    <span class="sheet-iconstatic sheet-icon-link sheet-hidden" title="This icon indicates this Knack/Knack is linked to another, meaning that the Rank of the other Knack is added to its Effective Rank"></span>
                    <!-- NOT APPLICABLE TO KNACKS just placeholder-->
                    <input name="attr_NAC_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Knack, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                    <input name="attr_NAC_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfCloseChecked" title="This icon indicates that this ability (Knack, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                  </span>
                </div>    <!--JBF 210106 : End of Play Visalization of the Knacks, i.e. when all details are collapsed-->

                      <!--Knacks Fieldset- Start of Parameter Visalization of the Knacks, Where parameters are set-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_NAC_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom">
                        <!--Knacks Fieldset- Karma and DP Parameters-->
                  <div class="sheet-floatRight sheet-content" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_knacks_X_NAC_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed : <span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_NAC_Karma-Limit_max" value="1" min="0" max="3" class="sheet-numShorter" title="@{repeating_knacks_X_NAC_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_knacks_X_NAC_Karma-Limit} : Does this Knack require Karma Points to be spent every time it is used">
                      Karma Required :
                      <input type="checkbox" name="attr_NAC_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_knacks_X_NAC_Karma-Limit} : Does this Knack require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label">
                      <span title="@{repeating_knacks_X_NAC_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed :  : <span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_NAC_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_knacks_X_NAC_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>
                      <!--JBF Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_NAC_Type" type="hidden">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_knacks_X_NAC_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required :
                        <input type="checkbox" name="attr_NAC_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_knacks_X_NAC_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                  </div>

                        <!--Knacks Fieldset- Parameters -->
                  <div class="sheet-content">
                    <!-- <input name="attr_NAC_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value=""> -->
                    <input type="hidden" hidden name="attr_NAC_Mod-Type" class="sheet-testModType"  >

                    <!--Knacks Fieldset-Knack Requirement-->
                    <span class="sheet-nowrap" title="@{repeating_knacks_X_NAC_Requirements}:   Rank Base Talent must be in order to learn this Knack.">Requirements Rank:
                      <input name="attr_NAC_Requirements" type="number" value="0" class="sheet-numShort">
                    </span>
                    <label class="" title="@{repeating_knacks_X_NAC_Restrictions}:   Any restrictions that need to be fulfilled in order to learn this Knack. For information only.">
                      Restrictions:&nbsp;<span class="sheet-autoexpand-wrap ">
                        <input name="attr_NAC_Restrictions" type="text" class="sheet-bordered">
                        <span name="attr_NAC_Restrictions" class="sheet-autoexpand "></span>
                      </span>
                    </label>
                    <br>
                          <!--Knacks Fieldset- Link Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <span class="sheet-nowrap">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                        title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_knacks_X_NAC_LinksGetValue} : List of Names of properties (Knacks, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Knack, for a Free Knack to get the Circle of the Discipline, or for a combination of Knacks/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap">
                            <input name="attr_NAC_LinksGetValue" type="text" readonly class="sheet-bordered">
                            <span name="attr_NAC_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                          <input name="attr_NAC_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_knacks_X_NAC_LinksGetValue_max} : List of RowIds of properties (Knacks, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Knack, for a Free Knack to get the Circle of the Discipline, or for a combination of Knacks/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                        </span>
                      </span>
                    </div>

                          <!--Knacks Fieldset- Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-label" title="@{repeating_knacks_X_NAC_RollType}   Rolls should be made: public, gm, or hidden?">
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_NAC_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>

                          <select name="attr_NAC_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>

                          <select name="attr_NAC_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_NAC_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_knacks_X_NAC_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Knacks Fieldset-Modifier exceptions-->
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_knacks_X_NAC_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_NAC_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>
                      <span class="sheet-label">Vision Based :
                        <label title="@{repeating_knacks_X_NAC_VisionBased}   If checked then this is a vision based action or effect, and suffers penalties from darkness and blindness.">
                          <input type="checkbox" name="attr_NAC_VisionBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-vision-based"></span>
                        </label>
                      </span>
                      <input class="sheet-testChecked sheet-hidden" name="attr_NAC_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_knacks_X_NAC_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_NAC_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>
                      <span class="sheet-HideIfNotChecked sheet-label">Resistance :
                        <label title="@{repeating_knacks_X_NAC_Resistance}   If checked then this action or effect serves as a Resistance test and does not suffer the normal penalty if the character is Knocked Down. ">
                          <input type="checkbox" name="attr_NAC_Resistance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-resistance"></span>
                        </label>
                      </span>
                    </div>

                          <!--Knacks Fieldset- Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_knacks_X_NAC_Special}  Certain knacks or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_NAC_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Knack (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Knack (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                          <option value="">-- Powers --</option>
                          <option value="CorruptKarma" title="This is the Corrupt Karma Horror Power. Use this power to make note of how many karma you can corrupt on this target, but use the Token Action associated with the following button to spend these successes.">Corrupt Karma</option>
                          <option value="CursedLuck" title="This is the Cursed Luck Horror Power. Use of this power will set a value into @{Creature-CursedLuck}, and that number of dice will be 'cursed' for the next roll.">Cursed Luck</option>
                        </select>
                      </span>
                    </div>

                            <!--Knacks Fieldset- SFX-->
                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_NAC_sayTotalSuccess" class="selLong" title="@{repeating_knacks_X_NAC_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_knacks_X_NAC_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_knacks_X_NAC_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>
                      <span class="sheet-nowrap0">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: NAC: @{NAC_RowID}"
                        title="@{repeating_knacks_X_NAC_btnSetFX} Set the Special Effects for this Knack.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_knacks_X_NAC_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_NAC_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_NAC_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_knacks_X_NAC_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_NAC_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_NAC_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                    </div>
                  </div>    <!--end Knacks Fieldset- Parameters -->
                </div>    <!-- end Knacks Fieldset- End of Parameter  of the Knacks, Where parameters are set -->
                      <!--Knacks Fieldset- Start of Detail  of the Knacks, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_NAC_ShowNotes" value="1" type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <textarea name="attr_NAC_Notes" class="sheet-details" title="@{repeating_knacks_X_NAC_Notes}   Description of Knack and how it works." placeholder="Description of the Knack and how it works."></textarea>
                </div>
                <!--JBF 210106 : End of Detail  of the Knacks, Where secundary information during play is displayed, but not parametrization-->
              </div>
            </fieldset>
          </div>   <!-- end of Knacks content -->
        </div>    <!--****************************************** End of Section Knacks ****************************************-->



              <!--****************************************** Start of Section Skills - Content ***********************************-->
        <div class="sheet-section sheet-section-skills sheet-section-core sheet-section-combat">

          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">5-</b> Assign Skill Ranks</div>
          <input class="sheet-testAttrCosts" name="attr_Skills-Costs" value="14" type="hidden">
          <div class="sheet-Creation"> 2 Rks Knowledge, 1 Rk Artisan, 2 Rks Speak Language, 1Rk R/W Language, 8 Rks Others . Remaining :
            <input name="attr_Skills-Costs" class="sheet-numShort sheet-attrCostsRed"
            readonly="readonly" value="14"
            title="@{Skills-Costs}   Number of Skill points remaining from the starting 13."
            type="number">
          </div>



          <div class="sheet-content">   <!-- Section Skills - Content -->
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links"   type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">

            <input type="checkbox" hidden value="1" name="attr_skills-edit-mode" class="sheet-testRepEditMode" title="@{attr_skills-edit-mode} : Toggles the Skill view to edit mode where the main attributes of each Skills can be changed.">
            <div style="height: 30px;" class="sheet-HideIfCombatNoEdit sheet-HideIfOverviewNoEdit">
              <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Type</b>
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Skill Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan ">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest">DP</b>
            </div>

            <!--According to the Type of Skill, the Skill Name will be a free text with dropdown of selected options.-->
            <datalist id="general_skill">
              <option value="Acting"></option>
              <option value="Alchemy"></option>
              <option value="Animal Handling"></option>
              <option value="Artist"></option>
              <option value="Bribery"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Disguise"></option>
              <option value="Entertainer"></option>
              <option value="Flirting"></option>
              <option value="Forgery"></option>
              <option value="Mapmaking"></option>
              <option value="Physician"></option>
              <option value="Pilot Boat"></option>
              <option value="Sailing"></option>
              <option value="Seduction"></option>
              <option value="Streetwise"></option>
              <option value="Swimming"></option>
              <option value="Acrobatic Defense"></option>
              <option value="Air Sailing"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Battle Shout"></option>
              <option value="Charge"></option>
              <option value="Climbing"></option>
              <option value="Conversation"></option>
              <option value="Craftsman"></option>
              <option value="Danger Sense"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm Trap"></option>
              <option value="Distract"></option>
              <option value="Emotion Song"></option>
              <option value="Engaging Banter"></option>
              <option value="Etiquette"></option>
              <option value="First Impression"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Lock Picking"></option>
              <option value="Maneuver"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Navigation"></option>
              <option value="Picking Pockets"></option>
              <option value="Research"></option>
              <option value="Shield Bash"></option>
              <option value="Stealthy Stride"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Taunt"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="Unarmed Combat"></option>
              <option value="Wilderness Survival"></option>
              <option value="Wound Balance"></option>
              <option value="Riposte"></option>
              <option value="Sprint"></option>
              <option value="Battle Bellow"></option>
              <option value="Blade Juggle"></option>
              <option value="Conceal Object"></option>
              <option value="Disarm"></option>
              <option value="Down Strike"></option>
              <option value="Evidence Analysis"></option>
              <option value="Fast Hand"></option>
              <option value="Hypnotize"></option>
              <option value="Impressive Display"></option>
              <option value="Leadership"></option>
              <option value="Mount Attack"></option>
              <option value="Resist Taunt"></option>
              <option value="Second Attack"></option>
              <option value="Second Shot"></option>
              <option value="Second Weapon"></option>
              <option value="Slough Blame"></option>
              <option value="Tactics"></option>
              <option value="Wheeling Attack"></option>
              <option value="Wheeling Defense"></option>
              <option value="Critical Hit"></option>
              <option value="Defensive Posture"></option>
              <option value="Resist Pain"></option>
              <option value="Witty Repartee"></option>
              <option value="Vicious Wound"></option>
              <option value="Weapon Breaker"></option>
            </datalist>

            <datalist id="general_skill_creation">
              <option value="Acting"></option>
              <option value="Alchemy"></option>
              <option value="Animal Handling"></option>
              <option value="Artist"></option>
              <option value="Bribery"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Craftsman"></option>
              <option value="Disguise"></option>
              <option value="Entertainer"></option>
              <option value="Flirting"></option>
              <option value="Forgery"></option>
              <option value="Mapmaking"></option>
              <option value="Physician"></option>
              <option value="Pilot Boat"></option>
              <option value="Sailing"></option>
              <option value="Seduction"></option>
              <option value="Streetwise"></option>
              <option value="Swimming"></option>
              <option value="Acrobatic Defense"></option>
              <option value="Air Sailing"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Battle Shout"></option>
              <option value="Charge"></option>
              <option value="Climbing"></option>
              <option value="Conversation"></option>
              <option value="Danger Sense"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm Trap"></option>
              <option value="Distract"></option>
              <option value="Emotion Song"></option>
              <option value="Engaging Banter"></option>
              <option value="Etiquette"></option>
              <option value="First Impression"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Lock Picking"></option>
              <option value="Maneuver"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Navigation"></option>
              <option value="Picking Pockets"></option>
              <option value="Research"></option>
              <option value="Shield Bash"></option>
              <option value="Stealthy Stride"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Taunt"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="Unarmed Combat"></option>
              <option value="Wilderness Survival"></option>
              <option value="Wound Balance"></option>
            </datalist>

            <datalist id="artisan_skill">
              <option value="Acting"></option>
              <option value="Baking"></option>
              <option value="Basket Weaving"></option>
              <option value="Body Painting"></option>
              <option value="Carving"></option>
              <option value="Cooking"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Dancing"></option>
              <option value="Embroidery"></option>
              <option value="Juggling"></option>
              <option value="Mapmaking"></option>
              <option value="Musician"></option>
              <option value="Poetry"></option>
              <option value="Rune Carving"></option>
              <option value="Sculpting"></option>
              <option value="Singing"></option>
              <option value="Storytelling"></option>
              <option value="Tattooing"></option>
              <option value="Wardrobe and Style"></option>
              <option value="Armors Runic Carving"></option>
              <option value="Beadwork"></option>
              <option value="Calligraphy"></option>
              <option value="Canvas Painting"></option>
              <option value="Carpentry"></option>
              <option value="Cat's Cradle"></option>
              <option value="Clay Sculpting"></option>
              <option value="Cloth Dyeing"></option>
              <option value="Comedy"></option>
              <option value="Composing"></option>
              <option value="Cooperage"></option>
              <option value="Costume Design"></option>
              <option value="Craftsman"></option>
              <option value="Crochet"></option>
              <option value="Crystal Carving"></option>
              <option value="Crystal Sculpting"></option>
              <option value="Decoupage"></option>
              <option value="Drawing"></option>
              <option value="Enamelling"></option>
              <option value="Felting"></option>
              <option value="Flintknapping"></option>
              <option value="Flower Arrangement"></option>
              <option value="Fretwork"></option>
              <option value="Glass beadmaking"></option>
              <option value="Glass Blowing"></option>
              <option value="Glass etching"></option>
              <option value="Goldsmithing"></option>
              <option value="Humor"></option>
              <option value="Iris folding"></option>
              <option value="Jewellery"></option>
              <option value="Knitting"></option>
              <option value="Knotting"></option>
              <option value="Lace-making"></option>
              <option value="Leather carving"></option>
              <option value="Leatherworking"></option>
              <option value="Makeup"></option>
              <option value="Metal Carving"></option>
              <option value="Metal Casting"></option>
              <option value="Mosaic"></option>
              <option value="Musical Instrument"></option>
              <option value="Needlepoint"></option>
              <option value="Oratory"></option>
              <option value="Origami"></option>
              <option value="Painting"></option>
              <option value="Papercutting"></option>
              <option value="Paper embossing"></option>
              <option value="Paper-mache"></option>
              <option value="Party like a madman"></option>
              <option value="Patchwork"></option>
              <option value="Plaster Casting"></option>
              <option value="Pottery"></option>
              <option value="Quilling"></option>
              <option value="Robe Weaving"></option>
              <option value="Rug making"></option>
              <option value="Scarification"></option>
              <option value="Smithing"></option>
              <option value="Stained glass"></option>
              <option value="Stone Carving"></option>
              <option value="Stone Sculpting"></option>
              <option value="Tailor"></option>
              <option value="Tatting"></option>
              <option value="Tinsmithing"></option>
              <option value="Weapons Runic Carving"></option>
              <option value="Weaving"></option>
              <option value="Wigmaking"></option>
              <option value="Wood Carving"></option>
              <option value="Wood Sculpting"></option>
              <option value="Wood Turning"></option>
            </datalist>
                  <!--JBF Lists from the Second Step Website with approval of Lars Gottlieb-->
            <datalist id="knowledge_skill">
              <option value="Knowledge"></option>
              <option value="Alchemy and Potions"></option>
              <option value="Ancient Weapons"></option>
              <option value="Baking"></option>
              <option value="Barsaive History"></option>
              <option value="Botany"></option>
              <option value="Court Dancing"></option>
              <option value="Creature Lore"></option>
              <option value="Discipline Lore"></option>
              <option value="Farming"></option>
              <option value="Horror Lore"></option>
              <option value="Legends and Heroes"></option>
              <option value="Military Organizations"></option>
              <option value="Province History"></option>
              <option value="Racial Lore"></option>
              <option value="Scourge History"></option>
              <option value="Trade Routes"></option>
              <option value="Wild Animals"></option>
              <option value="Accounting"></option>
              <option value="Airships"></option>
              <option value="Anatomy"></option>
              <option value="Ancient Tactics"></option>
              <option value="Bureaucracy"></option>
              <option value="Business Contacts"></option>
              <option value="Caravans"></option>
              <option value="Conspiracy"></option>
              <option value="Dwarven Trade Routes"></option>
              <option value="Dwarven Military Organization"></option>
              <option value="Economics"></option>
              <option value="Elven Ballads"></option>
              <option value="Elven LoveSongs"></option>
              <option value="Gambling"></option>
              <option value="Geography Barsaive"></option>
              <option value="Geography Vivane"></option>
              <option value="History: Air Sailing"></option>
              <option value="History: Barsaive"></option>
              <option value="History: CaraFahd"></option>
              <option value="History: Grim Legion"></option>
              <option value="History: Human"></option>
              <option value="History: Living Legend Cults"></option>
              <option value="History: Ork"></option>
              <option value="History: Political"></option>
              <option value="History: Scourge"></option>
              <option value="History: Shosara"></option>
              <option value="History: Thera"></option>
              <option value="History: Throal"></option>
              <option value="Hunting"></option>
              <option value="Law"></option>
              <option value="Legends and Heroes: Orks"></option>
              <option value="Local Geography"></option>
              <option value="Local Lore"></option>
              <option value="Blood Elf Lore"></option>
              <option value="Dwarf Lore"></option>
              <option value="Elf Lore"></option>
              <option value="Human Lore"></option>
              <option value="Obsidiman Lore"></option>
              <option value="Ork Lore"></option>
              <option value="Pale One Lore"></option>
              <option value="T'skrang Lore"></option>
              <option value="Troll Lore"></option>
              <option value="Windling Lore"></option>
              <option value="Lore: Beasts"></option>
              <option value="Lore: Blood Magic"></option>
              <option value="Lore: Creatures"></option>
              <option value="Lore: Death Magic"></option>
              <option value="Lore: Horrors"></option>
              <option value="Lore: Magic"></option>
              <option value="Lore: Scourge"></option>
              <option value="Lore: Treasures"></option>
              <option value="Lore: Verjigorm"></option>
              <option value="Lore: Weapons"></option>
              <option value="Magical Theory"></option>
              <option value="Military History"></option>
              <option value="Military Procedures"></option>
              <option value="Nature"></option>
              <option value="Obsidiman Weapons"></option>
              <option value="Old Wives' Tales"></option>
              <option value="The Passions"></option>
              <option value="Politics"></option>
              <option value="Politics: Ork"></option>
              <option value="Politics: Thera"></option>
              <option value="The Scourge"></option>
              <option value="Subterranean Throal"></option>
              <option value="The Mob"></option>
              <option value="Throalic Poetry"></option>
              <option value="Underworld Rumors"></option>
              <option value="Vivane Geography"></option>
              <option value="Rockwise"></option>
              <option value="Spiritwise"></option>
              <option value="Art History"></option>
              <option value="Plantwise"></option>
              <option value="Cats"></option>
            </datalist>

                  <!--Section Skills - Start of Fieldset-->
            <fieldset class="repeating_skills">
              <input name="attr_SK_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" >
              <div class="sheet-filter-box">
                <span class="sheet-hidden"><input name="attr_SK_RowID" type="text">  <input name="attr_SK_Target-TA" type="text"> <input name="attr_SK_ModPrefix" type="hidden" value="?"></span>
                      <!--Skills Fieldset - Play/Edit Visalization of the Skills, Parameters and Notes will appear in separate div-->
                <div style="margin:0px; ">
                        <!--Skill Fieldset - Category-->
                  <input name="attr_SK_Name" type="text" hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <select class="sheet-selShort sheet-HideIfNotEditMode" name="attr_SK_Category" title="@{SK_Category} : Select between General, Artisan and Knowledge to select name from appropriate dropdown list">
                    <option value="General" selected>General</option>
                    <option value="Knowledge" >Knowledge</option>
                    <option value="Artisan" >Artisan</option>
                  </select>

                        <!--Skill Fieldset - Button & Name-->
                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_SK_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : @{SK_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask} ~ Action: SK: @{SK_RowID} "
                    title="%{selected|Roll_SK_Roll-fromSheet} Roll this Skill Test.">
                    <input name="attr_SK_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_SK_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target-TA}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : @{SK_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask} ~ Action: SK: @{SK_RowID} "
                    title="%{selected|Roll_SK_Roll} Roll this Skill Test.   This version uses T_Target-TA instead of T_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>
                    <button class="sheet-text-button sheet-NoAPI" name="roll_SK_Roll-NoAPI" type="roll"
                    value="@{SK_RollType} &{template:rolltargetnumber} @{SK_Target-NoAPI} {{header=@{charName}: @{SK_Name}}} {{Step=[[?{Step|@{SK_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{SK_SuccessText}}}"
                    title="%{selected|Roll_SK_Roll-NoAPI} Roll this Skill Test.">
                    <input name="attr_SK_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <!-- <input name="attr_SK_Name"  type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-bordered-bottom" placeholder="Name"> -->
                    <span class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_Name}:   Skill Name - This is an knowledge skill. Select a Skill or type your own.">
                    <input name="attr_SK_Name"  type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Knowledge" name="attr_SK_Category" >
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" list="knowledge_skill" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom" placeholder="Name">
                      <input name="attr_SK_Name" list="knowledge_skill" type="text" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom" placeholder="Name">
                    </span>
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Artisan" name="attr_SK_Category" >
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" list="artisan_skill" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom" placeholder="Name">
                      <input name="attr_SK_Name" list="artisan_skill" type="text" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom" placeholder="Name">
                    </span>
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" name="attr_SK_Category" checked>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" type="text" list="general_skill" class="sheet-txtMed sheet-hideIfPlaceholder sheet-NotCreation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-NotCreation  sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill_creation" class="sheet-txtMed sheet-hideIfPlaceholder sheet-Creation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill_creation" class="sheet-txtLong sheet-hideIfNotPlaceholder  sheet-Creation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >

                      <input name="attr_SK_Name" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-NotCreation sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name" >

                    </span>
                  </span>

                    <!--JBF 210115 : In Edit mode, the name is out of the button to be editable-->
                  </span>
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 100px;" title="@{repeating_skills_X_SK_textImport}:   Skill Text import: This only shows up if Name is empty.">
                    <textarea type="text" name="attr_SK_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">
                      If you have a PDF copy of the book, you can copy an entire Skill or Questor Devotion description (starting with the name, and including everything) and paste it into this tiny text box. It will be parsed and whatever fields can be set based upon the text will be. You will still need to manually set some of the fields, most importaintly "Modifiers".
                      You can also just type the Skill Name, and it will just be Autofilled with settings from the database.

                    </span>
                  </span>

                        <!--Skills Fieldset - Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" >
                    <span>
                      <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Artisan" name="attr_SK_Category" >
                      <span class="sheet-HideIfNotCloseChecked">
                        <input name="attr_SK_Attribute" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Cha">
                        <span class="sheet-HideIfCloseChecked">
                          <button class="sheet-text-button sheet-api sheet-fancyfont sheet-button-nodice" name="roll_SK_Roll-Cha-fromSheet" type="roll"
                          value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask} ~ Action: SKc: @{SK_RowID} "
                          title="%{selected|Roll_SK_Roll-Cha-fromSheet} Roll this Artisan Skill Test using Cha (specific to non Charisma based Artisan Skills).">
                          Cha</button>
                          <button class="sheet-text-button sheet-NoAPI" name="roll_SK_Roll-Cha-NoAPI" type="roll"
                          value="@{SK_RollType} &{template:rolltargetnumber} @{SK_Target-NoAPI} {{header=@{charName}: @{SK_Name}}} {{Step=[[?{Step|@{SK_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{SK_SuccessText}}}"
                          title="%{selected|Roll_SK_Roll-NoAPI} Roll this Artisan Skill Test using Charisma as Attrbute (specific to non Charisma based Artisan Skills).">
                          Cha  </button>
                        </span>
                      </span>
                    </span>
                    <span>
                      <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Category" >
                      <span class="sheet-fixed-width sheet-w50px sheet-HideIfNotCloseChecked sheet-iconselect-span sheet-titlespan" title="@{repeating_skills_X_SK_Mod-Type}  What modifiers does this Skill apply.">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Armor IP"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-armor" title="Modifiers that apply to Initiative Tests with no Armor Penalty."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="(0)"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                        </span>
                        <select name="attr_SK_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                          <option value="0" title="No modifiers at all."> None</option>
                          <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                          <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                          <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                          <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                          <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                          <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                          <option value="Init" title="All Initiative Penalties apply as modifiers to this test."> Initiative Penalty</option>
                          <option value="Armor IP" title="Initiative Penalties to Armor Only apply as modifiers to this Test."> Armor Init penalty</option>
                          <option value="(0)" title="This Skill does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                        </select>
                        <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->
                        <input class="sheet-testCloseChecked" name="attr_SK_Special" hidden value="Initiative" type="checkbox">
                        <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-initiative"></span>
                        <input class="sheet-testCloseChecked" name="attr_SK_Special" hidden value="Recovery" type="checkbox">
                        <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                        <input class="sheet-testCloseChecked" name="attr_SK_Special" hidden value="Knockdown" type="checkbox">
                        <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                      </span>
                    </span>
                  </span>

                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry fields -->
                  <input type="hidden" name="attr_SK_Mod-Type" class="sheet-testModType"   >

                        <!--Skills Fieldset - Rank-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_skills_X_SK_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Skill, like using Air Dance and Tiger Spring together.">
                        <input name="attr_SK_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_SK_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_skills_X_SK_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <input name="attr_SK_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_skills_X_SK_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Rank-Adjust}: Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_SK_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                      </span>
                    </span>
                  </span>
                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_skills_X_SK_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Skill, like using Air Dance and Tiger Spring together.">
                        <input name="attr_SK_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_SK_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_skills_X_SK_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_SK_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                      </span>
                    </span>
                  </span>

                        <!--Skills Fieldset - Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Attribute}  What attribute is associated with this talent.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_skills_X_SK_Attribute}  What attribute is associated with this talent.">
                      <select name="attr_SK_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This talent does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                      </select>
                    </span>
                  </span>

                        <!--Skills Fieldset - Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-bordered-bottom">
                      <span title="@{repeating_skills_X_SK_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_SK_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_SK_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_skills_X_SK_BaseStep}:   Permanent Step of the Skill before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_SK_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_skills_X_SK_Step}:   Final action Step for this talent."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                        <input name="attr_SK_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                          <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode ">
                      <input name="attr_SK_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_skills_X_SK_BaseStep}:   Permanent Step of the Skill before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>

                        <!--Skills Fieldset - 210106 Targets Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_SK_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">
                            <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Skill does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Skill targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Skill targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Skill targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_SK_Target" title="@{repeating_skills_X_SK_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 10.">10</option>
                      </select>
                    </span>
                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_skills_X_SK_Target-NoAPI}  What does this talent target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Skill does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Skill targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Skill targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Skill targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_SK_Target-NoAPI">
                        <option selected value=" " title="This Skill does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Skill targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Skill targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Skill targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>
                          <!-- JBF Target Armor when Damage-->
                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">
                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Skill does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_SK_ArmorType" title="@{repeating_skills_X_SK_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Skill does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>
                        <!--Skills Fieldset - Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Type}  How does the Adept know this talent.">
                    <select name="attr_SK_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option value="Novice" selected title="This is a Novice skill." >Novice</option>
                      <option value="Journeyman" title="This is a Journeyman skill.">Journeyman</option>
                      <option value="Warden" title="This is a Warden skill." >Warden</option>
                      <option value="Master" title="This is a Master skill." >Master</option>
                    </select>
                  </span>

                        <!--Skills Fieldset - Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder" title="{repeating_skills_X_SK_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Category" >
                    <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfNotCloseChecked" title="{repeating_skills_X_SK_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                      <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Skills"></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_SK_Action" >
                        <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                        <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                        <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                        <option value="Sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                        <option value="NA" title="No Action for certain Skills">NA</option>
                      </select>
                    </span>
                  </span>

                        <!--Skills Fieldset - Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Strain}: number of strain points per use">
                    <input name="attr_SK_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_SK_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_SK_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                  </span>

                        <!--Skills Fieldset - Karma & DP-->
                  <span class="sheet-hideIfPlaceholder">
                          <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_SK_Karma-Ask" value="0">  <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_SK_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_SK_Karma-Limit_max" hidden value="1" class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{SK_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_SK_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_SK_Karma-Limit_max" hidden value="1" class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{SK_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{SK_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_SK_Karma" value="0"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{SK_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_SK_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_SK_Karma-Limit_max" value="0" class="sheet-testKarMax">
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{SK_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{SK_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                          <!--JBF End Of Karma Toggle-Simple-->
                          <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_SK_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_SK_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_SK_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_SK_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{SK_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_SK_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{SK_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{SK_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{SK_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{SK_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_SK_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_SK_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{SK_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{SK_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!-- JBF End Of DP Toggle -->
                  </span>   <!-- end skills Karma and DP -->

                        <!-- Skills Fieldset -Show Notes/Parameters -->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_skills_X_SK_ShowNotes}   Show description of Skill/Power">
                      <input type="checkbox" name="attr_SK_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_CombatSlot}  Should this Skill be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_SK_CombatSlot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_SK_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint">
                    <input name="attr_SK_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked sheet-HideIfNotEditMode">
                      <input name="attr_SK_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                      <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                    </span>
                    <span class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                    </span>
                  </span>
                </div>    <!--JBF 210106 : End of Play Visalization of the Skills, i.e. when all details are collapsed-->


                      <!--Skills Fieldset - Start of Parameter Visalization of the Skills, Where parameters are set -->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SK_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom">
                        <!--Skills Fieldset - Karma & DP Parameters-->
                  <div class="sheet-floatRight sheet-content" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_skills_X_SK_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed :<span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_SK_Karma-Limit_max" value="0" min="0" max="3" class="sheet-numShorter" title="@{repeating_skills_X_SK_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_skills_X_SK_Karma-Limit} : Does this Skill require Karma Points to be spent every time it is used">
                      Karma Required :
                      <input type="checkbox"  name="attr_SK_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_skills_X_SK_Karma-Limit} : Does this Skill require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label">
                      <span title="@{repeating_skills_X_SK_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed : <span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_SK_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_skills_X_SK_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>
                      <!--JBF Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_SK_Type" type="hidden">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_skills_X_SK_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required :
                        <input type="checkbox"  name="attr_SK_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_skills_X_SK_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                    <!-- <span class="sheet-nowrap0 sheet-HideIfNoRoll" title="@{repeating_skills_X_SK_CombatSlot}:   Should this Skill be summarized on the combat tab and placed in a Token Action?">
                    <span class="sheet-api">Tkn Actn</span><span class="sheet-NoAPI">Combat Tab</span>
                    <input name="attr_SK_CombatSlot" type="checkbox" value="1" ></span> -->
                  </div>

                        <!-- Skills Fieldset - Parameters -->
                  <div class="sheet-content">
                    <input type="hidden" hidden name="attr_SK_Mod-Type" class="sheet-testModType"  >
                          <!--Skills Fieldset - Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-nowrap sheet-label" title="@{repeating_skills_X_SK_RollType}   Rolls should be made: public, gm, or hidden?">
                        <!-- <span class="sheet-iconstatic sheet-icon-dice"></span> : -->
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_SK_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>
                          <select name="attr_SK_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                          <select name="attr_SK_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_SK_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_skills_X_SK_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Skills Fieldset -Modifier exceptions-->
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Category" >
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll sheet-HideIfNotCloseChecked">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_skills_X_SK_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_SK_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>
                      <span class="sheet-label">Vision Based :
                        <label title="@{repeating_skills_X_SK_VisionBased}   If checked then this is a vision based action or effect, and suffers penalties from darkness and blindness.">
                          <input type="checkbox" name="attr_SK_VisionBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-vision-based"></span>
                        </label>
                      </span>
                      <input class="sheet-testChecked sheet-hidden" name="attr_SK_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_skills_X_SK_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_SK_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>
                      <span class="sheet-HideIfNotChecked sheet-label">Resistance :
                        <label title="@{repeating_skills_X_SK_Resistance}   If checked then this action or effect serves as a Resistance test and does not suffer the normal penalty if the character is Knocked Down. ">
                          <input type="checkbox" name="attr_SK_Resistance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-resistance"></span>
                        </label>
                      </span>
                    </div>

                          <!--Skills Fieldset - Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_skills_X_SK_Special}  Certain talents or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_SK_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Skill (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Skill (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                        </select>
                      </span>
                    </div>

                          <!--Skills Fieldset - Links Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <input name="attr_SK_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-nowrap sheet-HideIfNotCloseChecked sheet-api sheet-label">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SK_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SK : @{SK_RowID}"
                        title="@{repeating_skills_X_SK_btnSetLink} Set the Links for this Skill. Links allow to automatically add the Rank of another Skill, Knack, Thread Item or Other to the Effective Rank of this Skill"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_skills_X_SK_LinksGetValue} : List of Names of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Skill, for a Free Skill to get the Circle of the Discipline, or for a combination of Skills/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap">
                            <input name="attr_SK_LinksGetValue" type="text" readonly class="sheet-bordered">
                            <span name="attr_SK_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                          <input name="attr_SK_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksGetValue_max} : List of RowIds of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Skill, for a Free Skill to get the Circle of the Discipline, or for a combination of Skills/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties"> <!--JBF@JBF to be hidden, temporary for testing-->
                          <input name="attr_SK_LinksProvideValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksProvideValue_max} : List of RowIds of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Skill to provide its Rank to a linked Knack."> <!--JBF@JBF to be hidden, temporary for testing-->
                          <input name="attr_SK_LinksProvideValue" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksProvideValue} : List of Names of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Skill to provide its Rank to a linked Knack."> <!--JBF@JBF to be hidden, temporary for testing-->
                        </span>
                      </span>
                    </div>

                          <!--Skills Fieldset - SFX-->
                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_SK_sayTotalSuccess" class="selLong" title="@{repeating_skills_X_SK_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_skills_X_SK_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_skills_X_SK_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>
                      <span class="sheet-nowrap0 sheet-api">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SK_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: SK: @{SK_RowID}"
                        title="@{repeating_skills_X_SK_btnSetFX} Set the Special Effects for this Skill.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_skills_X_SK_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_SK_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_SK_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>
                            <!--Skills Fieldset - Success Text-->
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_skills_X_SK_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_SK_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_SK_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                    </div>
                  </div>    <!-- end Skills Fieldset - Parameters -->
                </div>    <!--JBF 210106 : End of Parameter  of the Skills, Where parameters are set-->

                      <!--Skills Fieldset - Start of Detail  of the Skills, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SK_ShowNotes" value="1"
                type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <textarea name="attr_SK_Notes" class="sheet-details" title="@{repeating_skills_X_SK_Notes}   Description of Skill and how it works." placeholder="Description of the Skill and how it works."></textarea>
                </div>
                      <!--JBF 210106 : End of Detail  of the Skills, Where secundary information during play is displayed, but not parametrization-->
              </div>    <!-- end filterbox -->
            </fieldset>
          </div>    <!-- end  Section Skills - Content -->


                <!-- Skills Section - Languages Header
                Skills and Talents are treated differently due to the difference in learning time mechanics. For Skills, this section directly lists the Skill Rank automatically calculated from the languages Known
                For Talents, it just calculates the number of languages known but the talent will still have to be created in the Language section-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverviewNoCreation sheet-HideIfCombat">
            <div></div>
            Languages Known
            <div class="sheet-floatRight">
              <span class="sheet-info"
              title="Instructions: Speak and Read/Write Skills Ranks are entered here, and with API the LPs are calculated automatically. The equivalent Talents are entered in the Talents Section. Languages known are to be recorded here, to a maximum of the Rank">i</span>
            </div>
          </div>

                <!--Skills Section - Languages-->
          <div class="sheet-content sheet-HideIfOverviewNoCreation sheet-HideIfCombat">
            <div>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap"></span>
              <b class="sheet-fixed-width sheet-nowrap sheet-titlespan sheet-heading sheet-text-center" style="width:19em;">Skill</b>
              <b class="sheet-fixed-width sheet-nowrap sheet-titlespan sheet-heading sheet-text-center" style="width:19em;">Talent  </b>
            </div>
            <div>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap"></span>
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-titlespan" >
                <button class="sheet-text-button sheet-api sheet-button-nodice sheet-fancyfont" name="roll_LS-Speak-Check"
                type="roll"
                title="%{selected|LS-Speak-Check} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="!Earthdawn~ charID: @{character_id}~  foreach~ Value: LS-Speak-Rank~ Roll: ?{Modification|0}">
                Speak</button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_LS-Speak-CheckNoAPI"
                type="roll"
                title="%{selected|LS-Speak-CheckNoAPI} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="@{RollType} &{template:default} {{name=Speak Language Skill}} {{Step=[[?{Step|@{Per}+@{LS-Speak-Rank}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">Speak  </button>
                &nbsp;&nbsp;<input name="attr_LS-Speak-Rank" type="number"  value="0" readonly class="sheet-numShorter sheet-Big" title="@{LS-Speak-Rank} : This is the Rank in the Speak Language Skill. Note the difference with the Speak Language Talent that is entered in the Talent section.">
              </span>

              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap" >
                <button class="sheet-text-button sheet-api sheet-button-nodice sheet-fancyfont" name="roll_LS-ReadWrite-Check"
                type="roll"
                title="%{selected|LS-ReadWrite-Check} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="!Earthdawn~ charID: @{character_id}~  foreach~ Value: LS-ReadWrite-Rank~ Roll: ?{Modification|0}">
                Read/Write</button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_LS-ReadWrite-CheckNoAPI"
                type="roll"
                title="%{selected|LS-ReadWrite-CheckNoAPI} : : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="@{RollType} &{template:default} {{name=Read Write Language Skill}} {{Step=[[?{Step|@{Per}+@{LS-ReadWrite-Rank}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">Read/Write </button>
                <input name="attr_LS-ReadWrite-Rank" type="number" value="0" readonly class="sheet-numShorter sheet-Big" title="@{LS-ReadWrite-Rank} : This is the Rank in the Read Write Language Skill. Note the difference with the Read Write Language Talent that is entered in the Talent section.">
              </span>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" >
                Speak :
                &nbsp;<input name="attr_LT-Speak-Known" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-Speak-Known}:   Total languages spoken as Talents. Note that you need at least one Talent Rank per spoken language. Talent is entered in the Talents Section"> /
                <input name="attr_LT-Speak-Rank" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-Speak-Rank}:   Rank in the Speak Language Talent as defined in the Talents Section (Must fill in Special field o identify the right Talent)">
              </span>
              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap sheet-label" >
                Read/Write :
                <input name="attr_LT-ReadWrite-Known" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-ReadWrite-Known}:   Total languages read and written as Talents. Note that you need at least one Talent Rank per  language. Talent is entered in the Talents Section">/
                <input name="attr_LT-ReadWrite-Rank" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-ReadWrite-Rank}:   Rank in the Read Write Language Talent as defined in the Talents Section (Must fill in Special field o identify the right Talent)">
              </span>
            </div>

            <input type="checkbox" checked value="1" name="attr_languages-edit-mode" class="sheet-testRepEditMode sheet-hidden" >
            <!--This is the list of Panda Gaming Grove with approval of Morgan Weeks.-->
            <datalist id="languages">
              <option value="Dwarf: (Throalic)"></option>
              <option value="Elf: (Sperethiel)"></option>
              <option value="Human"></option>
              <option value="Obsidiman"></option>
              <option value="Orc: (Or'zet)"></option>
              <option value="Troll"></option>
              <option value="T'Skrang"></option>
              <option value="Windling"></option>
              <option value="Theran"></option>
              <option value="Dwarf"></option>
              <option value="Dwarf-Scythan"></option>
              <option value="Dwarf-Scythan (Throalic)"></option>
              <option value="Dwarf-Scythan (Kratan)"></option>
              <option value="Elf"></option>
              <option value="Elf-Sperethiel"></option>
              <option value="Elf-Sperethiel (Theran)"></option>
              <option value="Elf-Sperethiel (Queen's)"></option>
              <option value="Elf-Sperethiel(Shosaran) "></option>
              <option value="Elf-Sperethiel(Sereathan)"></option>
              <option value="Human"></option>
              <option value="Human-Cathan"></option>
              <option value="Human-Landisian(Jerran)"></option>
              <option value="Human-Landisian(Scavian)"></option>
              <option value="Human-Landisian(Travaran)"></option>
              <option value="Human-Landisian(Urupan)"></option>
              <option value="Obsidiman"></option>
              <option value="Obsidiman-Marellyawenkhurtectl"></option>
              <option value="Orc"></option>
              <option value="Orc-Or'Zat"></option>
              <option value="Orc-Or'Zet"></option>
              <option value="T'Skrang"></option>
              <option value="T'Skrang-Shivarrotal"></option>
              <option value="T'Skrang-Shivarrotal(Ishkarat)"></option>
              <option value="T'Skrang-Shivarrotal(Syrtis)"></option>
              <option value="T'Skrang-Shivarrotal(V'Strimon)"></option>
              <option value="T'Skrang-Shivarrotal(K'Tenshin)"></option>
              <option value="T'Skrang-Shivarrotal(T'Kambras)"></option>
              <option value="T'Skrang-Shivarrotal(Hengryoke)"></option>
              <option value="T'Skrang-Spirit Wind"></option>
              <option value="Troll"></option>
              <option value="Troll-Ustrectish"></option>
              <option value="Troll(per mountain and clan)"></option>
              <option value="Troll-Ustrectish B"></option>
              <option value="Windling"></option>
              <option value="Windling-Saheerys"></option>
              <option value="Elemental-Air"></option>
              <option value="Elemental-Earth"></option>
              <option value="Elemental-Fire"></option>
              <option value="Elemental-Water"></option>
              <option value="Elemental-Wood"></option>
            </datalist>

            <!--Skills Section - Languages Fieldset-->
            <fieldset class="repeating_skilll">
              <span class="sheet-hidden"><input name="attr_SKL_RowID" type="text" ></span>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap" title="@{repeating_skilll_X_SKL_Name}:   Name of language - If you want to keep it simple, just use the races... If you want to go deeper in the settings, refer to the Panda Gaming Grove Blog, used to build this list.">
                <input list="languages" name="attr_SKL_Name" type="text" class="sheet-txtLong sheet-bordered-bottom" placeholder="Race - Language - (Dialect)" title="@{repeating_skilll_X_SKL_Name}:   Language Name - This is an Language. Select a Language or type your own.">
              </span>
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_Speak}   Does the character Speak this language as a skill.">&nbsp;&nbsp;Speak :
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="attr_SKL_Speak" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_ReadWrite}   Does the character Read and Write this language as a skill.">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read/Write : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input name="attr_SKL_ReadWrite" type="checkbox" value="1" >
              </span>

              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_Speak-T}   Does the character Speak this language as a Talent (from the Talents tab).">Speak :
                &nbsp;&nbsp;&nbsp;&nbsp;<input name="attr_SKL_Speak-T" type="checkbox" value="1" >
              </span>
              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_ReadWrite-T}   Does the character Read and Write this language as a Talent (from the Talents tab).">
                &nbsp;&nbsp;&nbsp;Read/Write :&nbsp;&nbsp;&nbsp;<input name="attr_SKL_ReadWrite-T" type="checkbox" value="1" >
              </span>
            </fieldset>
          </div>    <!-- end of skills languages -->
        </div>    <!-- ******************************************* End of Section Skills ******************************************* -->



                <!-- ******************************************* Start of Section Spells ******************************************* -->
        <input name="attr_Hide-Spells-Tab" hidden class="sheet-testCloseChecked" checked type="checkbox" value="1">
        <div class="sheet-section sheet-section-spells sheet-section-core sheet-section-combat sheet-HideIfCloseChecked">
                <!--Section Spells - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-NotCreation">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab6-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab6-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab6-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            <input class="sheet-testCloseChecked sheet-hidden" name="attr_tab" type="checkbox" value="6">
            <div class="sheet-HideIfCloseChecked"> Spells </div>
            <div class="sheet-HideIfNotCloseChecked">Spellcasting Talents</div>
            <div class="sheet-HideIfPrint">
              <span class=" sheet-HideIfOverview sheet-HideIfCombat">
                <span class="sheet-info" title="Instructions: In this tab are filtered spellcasting talents. Toggle edit to delete or re-create.">i</span>
                <!-- <label title="@{attr_spells-talents-edit-mode} : Toggles the spells talent view to edit mode where the talents can be deleted and recreated.">
                  <input type="checkbox" name="attr_spells-talents-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label> -->
              </span>
            </div>
          </div>    <!-- end Spells - Header -->
          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">4b-</b> Spells, Spell Talents, and Matrixes</div>
          <input class="sheet-testAttrCosts" name="attr_Spells-Costs" value="5" type="hidden">
          <div class="sheet-Creation"> As a spellcaster, you have 2 Free Matrixes that do not count for your 8 Talent points. Go to your Grimoire (click Spell Tab, and then Grimoire subtab), choose
            <input name="attr_Spells-Costs" class="sheet-numShort sheet-attrCostsRed"
            readonly="readonly" value="5"
            title="@{Spells-Costs}   Number of Spell points remaining from the starting Per Step."
            type="number">
            Spells of Circle 1 and 2
          </div>

                <!--Section Spells - Talents - Content-->
          <div class="sheet-content">
            <input hidden  type="checkbox" value="1" class="sheet-testRepEditMode">
                  <!--Section Spells - Talents - Creation Buttons-->
            <!-- <div class="sheet-HideIfNotEditMode sheet-NotCreation">
              <b>Create SpellCasting Talents :</b><br>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-spellcasting" type="action"
              title="act_create-spellcasting:   Clicking this button will allow to create the Spellcasting Talent."> SpellCasting </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-patterncraft" type="action"
              title="act_create-patterncraft:   Clicking this button will allow to create the Patterncraft Talent."> Patterncraft </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-wil" type="action"
              title="act_create-wil:   Clicking this button will allow to create the dummy Wil Talent used for Spell Effects."> Wil </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-elementalism" type="action"
              title="act_create-elementalism:   Clicking this button will allow to create the Elementalism Talent."> Elementalism </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-illusionism" type="action"
              title="act_create-Illusionism:   Clicking this button will allow to create the Illusionism Talent."> Illusionism </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-nethermancy" type="action"
              title="act_create-Nethermancy:   Clicking this button will allow to create the Nethermancy Talent."> Nethermancy </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-wizardry" type="action"
              title="act_create-wizardry:   Clicking this button will allow to create the Wizardry Talent."> Wizardry </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-shamanism" type="action"
              title="act_create-shamanism:   Clicking this button will allow to create the Shamanism Talent."> Shamanism </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-willforce" type="action"
              title="act_create-willforcr:   Clicking this button will allow to create the Willforce Talent."> Willforce </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-concise-casting" type="action"
              title="act_create-concise casting:   Clicking this button will allow to create the Concise Casting Talent."> Concise Casting </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-elemental-mastery" type="action"
              title="act_create-elemental-mastery:   Clicking this button will allow to create the Elemental Mastery Talent."> Elemental Mastery </button>
              <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_create-power" type="action"
              title="act_create-power:   Clicking this button will allow to create the Creature Power of Weaving spells."> Power </button>
            </div> -->

                  <!--Section Spells - Talents - Titles-->
            <div class="sheet-HideIfOverview sheet-HideIfCombat">
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Talent Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan ">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest">DP</b>
            </div>

                  <!-- Section Spells - Talents - Fieldset -->
            <div class="sheet-NotCreation">
              <input hidden  type="checkbox" value="1" class="sheet-testRepEditMode">
                    <!--This is a duplicate of the repeating_talents fieldset, that only displays the spellcasting talents. Note that the Target is editable so that it is easy to make quick out of sequence rolls-->
              <fieldset class="repeating_talents">
                <input name="attr_T_Special"   type="hidden" class="sheet-spelltab" >
                <div class="sheet-filter-box">
                  <span class="sheet-hidden"><input name="attr_T_RowID" type="text">  <input name="attr_T_Target-TA" type="text"> <input name="attr_T_RollType" type="text"> <input name="attr_T_SuccessText" type="text"></span>
                  <div style="margin:0px; ">    <!--Spells - Talent Fieldset - Button & Name-->
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                      <button class="sheet-text-button sheet-api"  type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target}~  @{T_RollType}~ foreach:sct:ust:c~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~Action: T: @{T_RowID}"
                      title="%{selected|Roll_T_Roll-fromSheet} Roll this Talent Test.">
                      <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed" placeholder="Name">  </button>
                      <button class="sheet-text-button sheet-NoAPI"  type="roll"
                      value="@{T_RollType} &{template:rolltargetnumber} @{T_Target-NoAPI} {{header=@{charName}: @{T_Name}}} {{Step=[[?{Step|@{T_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{T_SuccessText}}}"
                      title="%{selected|Roll_T_Roll-NoAPI} Roll this Talent Test.">
                      <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed" placeholder="Name">  </button>
                    </span>

                          <!--Spells - Talent Fieldset - Rank-->
                    <span class="sheet-fixed-width sheet-w75px sheet-titlespan">
                      <input name="attr_T_Type" class="sheet-hidden sheet-testChecked" type="checkbox" value="Free">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="sheet-HideIfChecked" title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                          <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_T_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-HideIfNotChecked" readonly title="@{repeating_talents_X_T_LinkValue}: This Talent has been set as Free Talent, so Characters Base Rank in this talent is to be calculated via a Link. Go in Parameters of this Talent to Link to the Discipline."  type="number"  >
                        <input name="attr_T_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-HideIfChecked" readonly title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                        <input name="attr_T_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_talents_X_T_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                          <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                        </span>
                      </span>
                    </span>

                          <!--Spells - Talent Fieldset - Step-->
                    <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span title="@{repeating_talents_X_T_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                          <input name="attr_T_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                        </span>
                        <input name="attr_T_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                        <input name="attr_T_Step" readonly class="sheet-StepBig sheet-StepTotal"  title="@{repeating_talents_X_T_Step}:   Final action Step for this talent."  type="number"  >
                        <span title="@{repeating_talents_X_T_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                          <input name="attr_T_Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                        </span>
                      </span>
                    </span>
                          <!--Spells - Talent Fieldset -Target-->
                    <span class="sheet-fixed-width sheet-w50px sheet-text-center">
                      <span class="sheet-iconselect-span sheet-api">
                        <!--Target API-->
                        <span class="sheet-iconselect-icon-noedit">
                          <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Talent does not target a defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Talent targets Physical Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Talent targets Mystic Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Talent targets Social Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                        </span>

                        <select class="sheet-iconselect-select-noedit sheet-w50px" name="attr_T_Target" title="@{repeating_talents_X_T_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                          <option selected value="None" title="No Target Number">None</option>
                          <option hidden value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                          <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                          <option hidden value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                          <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                          <option hidden value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                          <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                          <option hidden value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                          <option hidden value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                          <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                          <option hidden value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                          <option hidden value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                          <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                          <option hidden value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                          <option hidden value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                          <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                          <option hidden value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                          <option hidden value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                          <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                          <option hidden value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                          <option hidden value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                          <option value="2" title="The target number is 2." >2</option>
                          <option value="5" title="The target number is 5.">5</option>
                          <option value="6" title="The target number is 6.">6</option>
                          <option value="10" title="The target number is 10.">10</option>
                        </select>
                      </span>
                      <!--Target NoAPI-->
                      <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_talents_X_T_Target-NoAPI}  What does this talent target.">
                        <span class="sheet-iconselect-icon-noedit">
                          <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value=" " ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Talent does not target a defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Talent targets Physical Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Talent targets Mystic Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Talent targets Social Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                        </span>
                        <select class="sheet-iconselect-select-noedit" name="attr_T_Target-NoAPI">
                          <option selected value=" " title="This Talent does not target a defense.">None</option>
                          <option disabled value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Talent targets Physical Defense.">PD</option>
                          <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Talent targets Mystic Defense.">MD</option>
                          <option disabled value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Talent targets Social Defense.">SD</option>
                          <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                        </select>
                      </span>
                    </span>

                          <!-- Spells - Talent Fieldset - Strain -->
                    <span class="sheet-fixed-width sheet-w25px sheet-titlespan" title="@{repeating_talents_X_T_Strain}: number of strain points per use">
                      <input name="attr_T_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                      <input name="attr_T_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked " readonly="readonly" >
                    </span>

                          <!-- Spells - Talent Fieldset -Karma & DP -->
                    <span class="">
                            <!--JBF Karma Toggle-Simple-->
                      <span class="sheet-Karma-ControlBox">
                        <input type="hidden" name="attr_T_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_T_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                          <span class="sheet-HideIfNotCloseChecked">
                            <label class="sheet-labelcheckbox" hidden title="@{T_Karma}   Automatically Spends One Karma when Karma is On" >
                              <input type="checkbox" name="attr_T_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                            </label>
                          </span>
                          <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                          <span class="sheet-HideIfCloseChecked">
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_lessthan3" title="@{T_Karma} : Number of Karma Points to be spent when Karma is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma} Don't Spend any Karma when Karma is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma}   Automatically Spends One Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                                <input class="sheet-testNum" type="hidden" name="attr_T_Karma" value="0"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{T_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                              </span>
                              <input type="hidden" name="attr_T_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                              <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3 ">
                                <option value="0" selected title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3 ">
                                <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                                <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                                <option value="0" selected title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>

                            </span>
                            <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_morethan3">
                              <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_4" min="0" max="4" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_5" min="0" max="5" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_6" min="0" max="6" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_7" min="0" max="7" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_8" min="0" max="8" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_9" min="0" max="9" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_10" min="0" max="10" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_11" min="0" max="11" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_12" min="0" max="12" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_13" min="0" max="13" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_14" min="0" max="14" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_15" min="0" max="15" value="0" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            </span>
                          </span>
                        </span>
                      </span>
                            <!--JBF End Of Karma Toggle-Simple-->
                            <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                      <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                        <input type="hidden" name="attr_T_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_T_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_T_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                          <span class="sheet-HideIfNotChecked">
                            <input type="checkbox" name="attr_T_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                            <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{T_DP}   Automatically Spends One Devotion when Devotion is On" >
                              <input type="checkbox" name="attr_T_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                            </label>
                            <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{T_DP}   This Devotion requires one DP at each use."></span>
                          </span>
                          <span class="sheet-HideIfChecked">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{T_DP} : Number of Devotion Points to be spent when Devotion is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP} Don't Spend any Dp when Dp is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP}   Automatically Spends One Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On"></span>
                              </span>
                              <input type="hidden" name="attr_T_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                              <input type="hidden" name="attr_T_DP-Limit_max" class="sheet-testKarMax">
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                                <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                                <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>
                            </span>
                          </span>
                        </span>
                      </span>   <!--  JBF End Of DP Toggle  -->
                    </span>   <!--  Spells - Talent Fieldset -Karma & DP  -->
                          <!--Dummy fieldset to be hidden in edit mode to avoid overlapping the trash can-->
                    <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode"></span>
                  </div>    <!-- end Talent Fieldset -->
                </div>    <!-- end filterbox -->
              </fieldset>
            </div>    <!-- end Section Spells - Talents - Fieldset -->
          </div>    <!-- end Spells - Talents -->

                <!-- Spells - Spell Sequence -->
          <input type="checkbox" class="sheet-testCloseChecked sheet-hidden" name="attr_SS-Active" checked value="0">
                <!-- Spells - Spell Sequence - Header -->
          <div class="sheet-HideIfCloseChecked sheet-api">
            <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheer-HideIfCombat">
              <div></div>
              Active Spell Sequence
              <div>
                <span class="sheet-info" title="This sub-section gathers information of spells currently cast">i</span>
              </div>
            </div>
                  <!-- Spells - Spell Sequence - Content -->
            <div class="sheet-content">
                    <!-- Spells - Spell Sequence - Titles -->
              <div>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan">Type</b>
                <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"> <span class="sheet-iconstatic sheet-icon-weave"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">Spell Name</b>
                <b class="sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan">Sequence</b>
                <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Range</b>
                <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan">Duration</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Description</b>
              </div>
                    <!-- Spells - Spell Sequence - Content -->
              <div class="sheet-content">
                      <!-- Spells - Spell Sequence - Type -->
                <span class="sheet-fixed-width sheet-w50px sheet-text-center">
                  <input name="attr_SS-Type" type=checkbox value="M" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Matrix casting.">Mat.</b>
                  <input name="attr_SS-Type" type=checkbox value="G" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Could be Grimoire or Raw. Attune Grimoire to avoid Raw casting.">G/R</b>
                  <input name="attr_SS-Type" type=checkbox value="GA" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Casting from Attuned Grimoire. An additional success will be added.">Grim.</b>
                  <input name="attr_SS-Type" type=checkbox value="GR" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Casting Raw Magic.">Raw</b>
                </span>
                      <!--Spells - Spell Sequence - Remaining Threads-->
                <span class="sheet-fixed-width sheet-w30px sheet-hidden">
                  <input type="text" readonly value="/" class="sheet-numShorter" name="attr_SS-CurThreads" title="@{SS-CurThreads} : Number of threads woven vs to be Woven.">
                </span>
                      <!--Spells - Spell Sequence - Name and Master Button-->
                <span class="sheet-nowrap0">
                  <button class="sheet-text-button sheet-api" name="roll_SS-Roll" type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell:  @{SS-Active} : Sequence : @{SS-Type}"
                  title="{selected|SS-Roll} : This is the master button for the spell sequence. Click to select the next step in the spell sequence">
                  <input type="text" readonly value="" class="sheet-txtMed sheet-buttonlabel" name="attr_SS-Name"></button>
                </span>
                      <!--Spells - Spell Sequence - Effect-->
                <span class="sheet-nowrap0 sheet-titlespan sheet-fixed-width sheet-selShort" title="@{SS-WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                  <input class="sheet-testChecked sheet-hidden" name="attr_SS-WilSelect" value="None" type="checkbox">
                  <span class="sheet-HideIfChecked">
                    <input name="attr_SS-WilSelect" type="text" readonly value="Wil" class="sheet-numShorter" title="@{SS-WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                    <span class="sheet-middle">+</span>
                    <span class="sheet-nowrap0" title="@{SS-WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                      <input name="attr_SS-WilEffect" type="number" readonly value="0" class="sheet-numShorter">
                    </span>
                  </span>
                </span>
                      <!-- Spells - Spell Sequence - Current Step-->
                <span class="sheet-fixed-width sheet-selShort sheet-text-center">
                  <input name="attr_SS-SeqStep" type="checkbox" value="0" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Starting Sequence: Chosing Extra Threads.">Starting</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="1" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Started Weaving the threads necessary.">Weaving</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="2" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - All the threads have been woven.">Woven</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="3" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Spellcasting attempted but failed.">Cast. Fail.</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="4" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Spellcasting Successful.">Cast</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="5" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Sequence is finished, Effect, if any, has been rolled.">Finished</b>
                </span>
                      <!--Spells - Spell Sequence - Range-->
                <span class="sheet-titlespan sheet-fixed-width sheet-numShort" title="@{SS-Range}:   Range spell can be cast, Usually in Yards though it may be Touch or Self. Select a predefined Range, or type your own">
                  <input name="attr_SS-Range" readonly type="text" class="sheet-numShort sheet-bordered-bottom">
                </span>
                      <!--Spells - Spell Sequence - Duration Effect and Description-->
                <span class="sheet-titlespan sheet-fixed-width sheet-selShort" title="@{SS-Duration}:   Duration of Spell.">
                  <input type="text" name="attr_SS-Duration" value="" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom" readonly>
                </span>
                <span class="sheet-txtMedplus sheet-titlespan sheet-fixed-width" title="@{SS-Effect}:   Effect of Spell.">
                  <input type="text" name="attr_SS-Effect" readonly value="" class="sheet-txtMedplus sheet-text-left sheet-bordered-bottom" >
                </span>
                <label class="sheet-api" title="@{SS-ShowNotes}   Show description of Spell currently cast">
                  <input type="checkbox" name="attr_SS-ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                </label>
                      <!--Spells - Spell Sequence - Extra Threads-->
                <input name="attr_SS-EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                <div class="sheet-HideIfCloseChecked">
                  <b class="sheet-label"> Extra Threads :</b>
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_SS-EnhThread" type="text" readonly class="sheet-bordered-bottom" title="@{SS-EnhThread} : Description of the effects any extra thread selected for this spell.">
                    <span name="attr_SS-EnhThread" class="sheet-autoexpand" ></span>
                  </span>
                </div>
                      <!--Spells - Spell Sequence - Spell Details-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SS-ShowNotes" value="1" type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <!--Spells Fieldset - Attuning Difficutlies-->
                  <!-- <span class="sheet-nowrap">
                    <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfEdition3" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                      <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom">
                      <span name="attr_SS-Numbers" class="sheet-autoexpand"></span>
                      <span>Wv/Ratn/Dspl/Sns</span>
                    </label>
                    <label class="sheet-label-under sheet-autoexpand-wrap sheet-HideIfNotEdition3" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                      <input name="attr_SS-Numbers" type="text" class="sheet-bordered-bottom">
                      <span name="attr_SS-Numbers" class="sheet-autoexpand"></span>
                      <span>Wv/Ratn/Dspl/Dblf/Sns</span>
                    </label>
                  </span> -->
                  <span class="sheet-nowrap sheet-HideIfEdition3 sheet-label" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                    Difficulties - Weave/Reattune/Dispell/Sense:
                      <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom sheet-txtShort">
                  </span>
                  <span class="sheet-nowrap sheet-HideIfNotEdition3 sheet-label" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                      Difficulties - Weave/Reattune/Dispell/Disbelieve/Sense
                        <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom sheet-txtShort">
                  </span>
                  <textarea name="attr_SS-Notes" readonly class="sheet-details" title="@{SS-Notes}   Description of spell currently cast and how it works." placeholder="Description of the spell currently cast and how it works."></textarea>
                </div>
              </div>
            </div>    <!-- Spells - Spell Sequence - Content -->
          </div>    <!-- end Spells - Spell Sequence - Header -->


                <!--Section-Spells - Tab Selector-->
          <div class="sheet-HideIfOverview sheet-HideIfCombat">
            <!-- <input type="radio" name="attr_tab-spells" class="sheet-tabSpell sheet-hidden" value="1" title="Spellcasting Talents."  ><span>Talents</span> -->
            <input type="radio" checked name="attr_tab-spells" class="sheet-tabSpell" value="2" title="Spell Matrices and what is In them."><span>Matrix</span>
            <input type="radio" name="attr_tab-spells" class="sheet-tabSpell" value="3" title="Grimoire."><span>Grimoire</span>
          </div>
          <input type="hidden" name="attr_tab-spells" class="sheet-tabSpell" value="2">
          <!-- <div class="sheet-sec-border-line"></div> -->
          <div class="sheet-section-spells-talents sheet-content"></div> <!--End of Spells Talents--><!--UNUSED-->


                <!--Section Spells- Matrix Subsection-->
          <div class="sheet-section-spells-matrices sheet-repeat-counter-reset">
            <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheer-HideIfCombat">
              <div></div>
              Spell Matrices
              <div>
                <label title="@{attr_spellmatrix-edit-mode} : Toggles the matrix view to edit mode where the main attributes of each talents can be changed.">
                  <input type="checkbox" name="attr_spellmatrix-edit-mode" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label>
                <span class="sheet-info" title="Instructions: This tab is for recording only Matrixes. Spellcasting Talents are in another Spell Tab; and all other Talents are in the main Talents tab. Record here each of your Matrix with its Rank and Origin">i</span>
              </div>
            </div>

                  <!-- Section Spells- Matrix Subsection -Content -->
            <div class="sheet-content">
              <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
              <input type="checkbox" name="attr_spellmatrix-edit-mode" value="1" hidden class="sheet-testRepEditMode">

                    <!--Section Spells- Matrix Subsection - Titles-->
              <div class="sheet-HideIfNotEditMode">
                <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-nowrap sheet-titlespan">Matrix</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-titlespan">Origin</b>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan"> Rank </b>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan">D.Rat.</b>
              </div>
              <div class="sheet-HideIfEditMode">
                <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">Mat.</b>
                <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-weave"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">Spell Name</b>
              </div>
                    <!--Section Spells- Matrix Subsection - Spell Matrix Fieldset-->
              <fieldset class="repeating_matrix" >
                <input name="attr_SPM_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" checked>

                <div class="sheet-bordered sheet-matrix sheet-filter-box" >
                  <span class="sheet-hidden">
                    <input name="attr_SPM_RowID" type="text" >
                    <input name="attr_SPM_spRowID" type="text" >      <!-- This is the Grimoire row ID -->
                    <input name="attr_SPM_EnhThread" type="text" >    <!-- This is the description of any extra thread woven during attuning -->
                  </span>
                        <!-- Matrix Fieldset - Type-->

                  <span class="sheet-repeat-count sheet-HideIfEditMode sheet-fixed-width sheet-w75px sheet-text-center">
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" checked value="-10" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix sheet-HideIfNotCloseChecked" title="Standard Matrix:  Death Rating 10, Can not hold threads."></span>
                    <input type="checkbox"  name="attr_SPM_Type" class="sheet-testCloseChecked" value="15" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-enhanced sheet-HideIfNotCloseChecked" title="Enhanced Matrix:  Death Rating 15, Can hold one thread."></span>
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" value="25" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-armored sheet-HideIfNotCloseChecked" title="Armored Matrix:   Death Rating 25, Can hold one thread."></span>
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" value="-20" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-shared sheet-HideIfNotCloseChecked" title="Shared Matrix:    Death Rating 20, Can not hold threads, May hold several spells as long as their combined circles do not exceed the rating."></span>
                    <input name="attr_SPM_Origin" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Pseudo">
                    <b class="sheet-HideIfNotCloseChecked sheet-small" title="This is not an actual separate matrix within the game, It merely represents a spell sharing a matrix with other spells, ether because it is a shared matrix, or the spells are designed such that different spells can share the same matrix. Obviously, these 'pseudo' matrices can only be used if the correct other spells are located within the correct real matrices.">(p)</b>
                  </span>
                  <span class="sheet-nowrap sheet-repeat-count sheet-HideIfNotEditMode sheet-fixed-width sheet-txtMed">
                    <select name="attr_SPM_Type" class="sheet-nowrap sheet-txtShort" title="@{repeating_matrix_X_SPM_Type}   Type of Spell Matrix">
                      <option value="-10" selected title="Standard Matrix:  Death Rating 10, Can not hold threads.">Standard</option>
                      <option value="15" title="Enhanced Matrix:  Death Rating 15, Can hold one thread.">Enhanced</option>
                      <option value="25" title="Armored Matrix:   Death Rating 25, Can hold one thread.">Armored</option>
                      <option value="-20" title="Shared Matrix:    Death Rating 20, Can not hold threads, May hold several spells as long as their combined circles do not exceed the rating.">Shared</option>
                    </select>
                  </span>
                        <!-- Matrix Fieldset -Origin-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-txtShort">
                    <select name="attr_SPM_Origin" class="sheet-txtShort" title="@{repeating_matrix_X_SPM_Origin}   Origin of Matrix">
                      <option value="Free-link"  title="Free:  This is a free matrix granted by the spellcasters first spellcasting discipline.">Free</option>
                      <option disabled  >-- Discipline 1 --</option>
                      <option value="TO1-Novice"  selected  title="Talent Option - Novice:  This is Talent Option Matrix.">TO-Novice</option>
                      <option value="TO1-Journeyman" title="Talent Option - Journeyman:  This is Talent Option Matrix.">TO-Journeyman</option>
                      <option value="TO1-Warden"     title="Talent Option - Warden:  This is Talent Option Matrix.">TO-Warden</option>
                      <option value="TO1-Master"     title="Talent Option - Master:  This is Talent Option Matrix.">TO-Master</option>
                      <option disabled class="sheet-HideIfNotHuman">-- Versatility --</option>
                      <option value="V-Novice"     class="sheet-HideIfNotHuman" title="This is a Novice Versatility Talent for this character.">Versatility Novice</option>
                      <option value="V-Journeyman" class="sheet-HideIfNotHuman" title="This is a Journeyman Versatility Talent for this character.">Versatility Journeyman</option>
                      <option value="V-Warden"     class="sheet-HideIfNotHuman" title="This is a Warden Versatility Talent for this character.">Versatility Warden</option>
                      <option value="V-Master"     class="sheet-HideIfNotHuman" title="This is a Master Versatility Talent for this character.">Versatility Master</option>
                      <option disabled >-- Others --</option>
                      <option value="Other"          title="Other:.">Other</option>
                      <option value="Pseudo"         title="Pseudo Matrix: This is not an actual separate matrix within the game, It merely represents a spell sharing a matrix with other spells, ether because it is a shared matrix, or the spells are designed such that different spells can share the same matrix. Obviously, these 'pseudo' matrices can only be used if the correct other spells are located within the correct real matrices.">Pseudo</option>
                      <option value="Item-link"           title="Item:   This is from a matrix item.">Item</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">-- Discipline 2 --</option>
                      <option value="TO2-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Novice Talent Option for this characters 2nd Discipline." >TO2-Novice</option>
                      <option value="TO2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Journeyman Talent Option for this characters 2nd Discipline." >TO2-Journeyman</option>
                      <option value="TO2-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Warden Talent Option for this characters 2nd Discipline." >TO2-Warden</option>
                      <option value="TO2-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Master Talent Option for this characters 2nd Discipline." >TO2-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">-- Discipline 3 --</option>
                      <option value="TO3-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"  title="This is a Novice Talent Option for this characters 3rd Discipline." >TO3-Novice</option>
                      <option value="TO3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Journeyman Talent Option for this characters 3rd Discipline." >TO3-Journeyman</option>
                      <option value="TO3-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Warden Talent Option for this characters 3rd Discipline." >TO3-Warden</option>
                      <option value="TO3-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Master Talent Option for this characters 3rd Discipline." >TO3-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">-- Discipline 4 --</option>
                      <option value="TO4-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Novice Talent Option for this characters 4th Discipline." >TO4-Novice</option>
                      <option value="TO4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Journeyman Talent Option for this characters 4th Discipline." >TO4-Journeyman</option>
                      <option value="TO4-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Warden Talent Option for this characters 4th Discipline." >TO4-Warden</option>
                      <option value="TO4-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Master Talent Option for this characters 4th Discipline." >TO4-Master</option>
                    </select>
                  </span>
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-w50px sheet-text-center sheet-api">
                    <input name="attr_SPM_Origin" type="hidden" class="sheet-testFreeOrThread" value="TO1-Novice" >
                    <span class="sheet-HideIfFreeOrThread">
                      <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                    </span>
                    <span class="sheet-HideIfNotFreeOrThread">
                      <input name="attr_SPM_LinksGetValue" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="" checked >
                      <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-HideIfCloseChecked sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" readonly title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                      <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" name="roll_SPM_btnSetLink" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SPM : @{SPM_RowID}"
                      title="@{repeating_matrix_X_SPM_btnSetLink} Set the Links for this Matrix. Links allow to automatically add a Discipline Circle (i.e. for Free Matrixes) or an Item Rank"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                    </span>
                  </span>
                                          <!-- Matrix Fieldset -Rank-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-w75px sheet-text-center sheet-NoAPI">
                    <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                  </span>

                        <!-- Matrix Fieldset -DR-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-text-center sheet-w50px">
                    <input name="attr_SPM_DR" type="number" value="" class="sheet-w50px sheet-text-center" readonly
                    title="@{repeating_matrix_X_SPM_DR}:  Death Rating of this Matrix." >
                  </span>
                        <!-- Matrix Fieldset -Threads-->
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfEditMode">
                    <input type="number" value="0" class="sheet-numShorter sheet-NoAPI" name="attr_SPM_Threads" title="@{repeating_matrix_X_SPM_Threads}:  Threads to be woven to cast the spell in the Matrix, taking into account the base Threads of the spell and the threads held in the Matrix itself.">
                    <input name="attr_SPM_EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                    <input type="text" readonly value="+" class="sheet-numShorter sheet-api sheet-HideIfCloseChecked" title="This is an Enhanced Matrix holding a 0 Thread spell. There is an Extra Thread held by the matrix. Click on the notes icon to get details">
                    <input type="number" readonly value="0" class="sheet-numShorter sheet-api sheet-HideIfNotCloseChecked" name="attr_SPM_Threads" title="@{repeating_matrix_X_SPM_Threads}:  Threads to be woven to cast the spell in the Matrix, taking into account the base Threads of the spell and the threads held in the Matrix itself.">
                  </span>
                        <!-- Matrix Fieldset -Master Button-->
                  <button class="sheet-text-button sheet-label-under sheet-api sheet-HideIfEditMode" name="roll_SPM_Roll" type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell: @{SPM_RowID}: Sequence : M"
                  title="%{selected|SPM_Roll} Start a new Spell, or Roll to Weave Threads, Spellcasting, or an Effect test for this spell.">
                        <!-- Matrix Fieldset -Contains-->
                  <input type="text" name="attr_SPM_Contains" class="sheet-txtMed sheet-buttonlabel" title="@{repeating_matrix_X_SPM_Contains}:   Name of the Spell currently in this Matrix."></button>
                  <input type="text" name="attr_SPM_Contains" class="sheet-txtMed sheet-NoAPI sheet-HideIfEditMode" title="@{repeating_matrix_X_SPM_Contains}:   Name of the Spell currently in this Matrix.">

                        <!-- Matrix Fieldset - Details, Links and CombatSlot Icon-->
                  <label class="sheet-api sheet-HideIfEditMode sheet-HideIfPrint" title="@{repeating_matrix_X_SPM_ShowNotes}   Show description of Spell contained in Matrix">
                    <input type="checkbox" name="attr_SPM_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode sheet-HideIfPrint">
                    <input name="attr_SPM_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                  </span>
                  <label class="sheet-HideIfNotEditMode sheet-NoAPI" title="@{repeating_matrix_X_SPM_CombatSlot}  Should this Matrix be summarized on the combat tab?"> <!--Note that this is NoAPI only because with API the SP_CombatSlot will be copied in SP_CombatSlot during Attuning-->
                    <input type="checkbox" name="attr_SPM_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                  </label>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_matrix_X_SPM_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_SPM_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                  </span>
                        <!-- Matrix Fieldset - Parameters-->
                  <input class="sheet-testCloseChecked sheet-hidden" name="attr_SPM_Parameters"  type="checkbox" value="1">
                  <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                          <!-- Matrix Fieldset -Link Button-->
                    Link :<button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SPM_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SPM : @{SPM_RowID}"
                    title="@{repeating_matrix_X_SPM_btnSetLink} Set the Links for this Matrix. Links allow to automatically add a Discipline Circle (i.e. for Free Matrixes) or an Item Rank"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                    <span title="@{repeating_matrix_X_SPM_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties"></span>
                      <span class="sheet-autoexpand-wrap">
                        <input name="attr_SPM_LinksGetValue" type="text" class="sheet-bordered">
                        <span name="attr_SPM_LinksGetValue" class="sheet-autoexpand"></span>
                      </span>
                  </div>
                        <!-- Matrix Fieldset -EnhThread and Notes-->
                  <input class="sheet-testCloseChecked sheet-hidden" name="attr_SPM_ShowNotes" value="1" type="checkbox">
                  <div class="sheet-HideIfNotCloseChecked sheet-HideIfEditMode">
                    <input name="attr_SPM_EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                    <input name="attr_SPM_EnhThread" type="text" readonly class="sheet-HideIfCloseChecked sheet-txtLong">
                  </div>
                  <!-- <div class="sheet-HideIfNotCloseChecked"> -->
                  <div class="sheet-hidden">
                    <!--Temporary disabled, because now the notes are displayed out of the fieldset. A SheetWorker routine copies the Notes to an external field-->
                    <textarea name="attr_SPM_Notes" readonly class="sheet-details" title="@{repeating_matrix_X_SPM_Notes}   Description of spell currently in the Matrix and how it works." placeholder="Description of the spell currently in the Matrix and how it works."></textarea>
                  </div>
                  <!--Dummy fieldset to be hidden in edit mode to avoid overlapping the trash can-->
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode"></span>
                </div>    <!-- end filterbox -->
              </fieldset>
                    <!-- Matrix Fieldset - Notes-->
              <input class="sheet-testCloseChecked sheet-hidden" name="attr_Matrix-ShowNotes" value="1" type="checkbox">
              <div class="sheet-HideIfNotCloseChecked">
                <textarea name="attr_Matrix-Notes" readonly class="sheet-details" title="@{repeating_Matrix-Notes}   Description of spell currently in the Matrix and how it works." placeholder="Description of the spell currently in the Matrix and how it works."></textarea>
              </div>
            </div>    <!-- end Section Spells- Matrix Subsection -Content -->
          </div>    <!-- ********************************** End Spell Matrix section ****************************-->



                  <!-- Section Spells - Grimoire Subsection -->
          <div class="sheet-section-spells-grimoire sheet-content">
                  <!--Section Spells - Grimoire Subsection- Header & Selector-->
            <div class="sheet-repeat-counter-reset">
              <div></div>
              <div class="sheet-headerbar sheet-headerbar-flex">
                <div></div> Grimoire
                <div class="sheet-floatRight">
                  <label title="@{attr_spells-edit-mode} : Toggles the grimoire view to edit mode where the main attributes  can be changed.">
                    <input type="checkbox" name="attr_spells-edit-mode" checked value="1" class="sheet-iconcheckbox">&nbsp;&nbsp;&nbsp;&nbsp; <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                </div>
              </div>
              <div class="sheet-sec-spacer"></div>
              <div class="sheet-NotCreation">
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim" value="0" title="All circles" checked ><span>All</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim " value="11" title="In Matrix" ><span>In Matrix</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="1" title="Circle 1"><span>Cir. 1</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="2" title="Circle 2"><span>Cir. 2</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="3" title="Circle 3"><span>Cir. 3</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="4" title="Circle 4"><span>Cir. 4</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="5" title="Circle 5"><span>Cir. 5</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="6" title="Circle 6"><span>Cir. 6</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="7" title="Circle 7"><span>Cir. 7</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim sheet-tabshort" value="8" title="Circle 8"><span>Cir. 8</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim" value="9" title="Warden Tier Spells"><span>Warden</span>
                <input type="radio" name="attr_tab-grim" class="sheet-tabGrim" value="10" title="Master Tier Spells"><span>Master</span>
              </div>
              <input type="hidden" name="attr_tab-grim" class="sheet-tabGrim" value="0">
              <!-- <div class="sheet-sec-border-line"></div> -->

                    <!-- Section Spells - Grimoire Subsection-Titles -->
              <input type="checkbox" hidden checked value="1" name="attr_spells-edit-mode" class="sheet-testRepEditMode" >
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">Matrix</b>
              <!-- <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">Grim</b> -->
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Circle</b>
              <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Disc.</b>
              <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-weave"></span></b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Name</b>
              <b class="sheet-fixed-width sheet-txtShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
              <b class="sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-HideIfEditMode"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode">Target</b>
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Range</b>
              <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-NoAPI">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Description</b>

                    <!-- Section Spells - Grimoire Subsection- Fieldset -->
              <fieldset class="repeating_spell">
                <div>
                  <span class="sheet-hidden">
                    <input name="attr_SP_RowID" type="text" >
                    <input name="attr_SP_spmRowID" type="text" value="0">   <!-- This is the Matrix row ID for spells that are in Matrix-->
                  </span>
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab0" value="0" checked >
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab1" value="1">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab2" value="2">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab3" value="3">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab4" value="4">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab5" value="5">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab6" value="6">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab7" value="7">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab8" value="8">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="9">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="10">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="11">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="12">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="13">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="14">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="15">
                  <input type="checkbox" name="attr_SP_spmRowID" class="sheet-hidden sheet-grim-tab11 sheet-api" checked value="0"> <!--This is an exception where checked means NOT displayed-->

                  <div class="sheet-filter-box">    <!--Spells Fieldset - Matrix&Attune-->
                    <span class="sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">
                      <input type="checkbox" name="attr_SP_spmRowID" class="sheet-hidden sheet-testChecked" value="0" checked>
                      <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-HideIfNotChecked" name="roll_SP_AttuneButton" type="roll"
                       value="!Earthdawn~ charID: @{character_id}~ ?{What Function|Attune,TuneMatrix: Spell|Create a pseudo matrix &amp; Attune,TuneMatrix: Share: ?{What type of Pseudo Matrix&amp;#124;Standard&amp;#44;Std&amp;#124;Enhanced&amp;#44;Enh&amp;#124;Armored&amp;#44;Arm&amp;#124;Shared&amp;#44;Sha&amp;rbrace;}: @{SP_RowID}"
                      title="%{selected|SP_AttuneButton}    Attune spell into a Spell Matrix. Note that creating a spell matrix and moving a spell into it is a quick way to do creature powers as well as spells that can share a matrix.">
                      <span class="sheet-iconstatic sheet-icon-matrix-attune"></span></button>
                      <span class="sheet-iconstatic sheet-icon-matrix sheet-HideIfChecked"></span>
                    </span>
                          <!--Spells Fieldset - Circle-->
                    <span class="sheet-LockIfNotEditMode sheet-numShort sheet-fixed-width sheet-titlespan sheet-HideIfNotEditMode">
                      <select name="attr_SP_Circle" class="sheet-HideIfNotEditMode sheet-numShort" title="@{repeating_spell_X_SP_Circle}   What is the spell circle?">
                        <option value="0" selected title="Please choose the circle for this spell.">-</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                      </select>
                    </span>
                          <!--Spells Fieldset - Discipline-->
                    <select name="attr_SP_Discipline" class="sheet-HideIfNotEditMode sheet-numLong sheet-titlespan" title="@{repeating_spell_X_SP_Discipline}   What Discipline does this spell belong to.">
                      <option value="0" selected>-</option>
                      <option value="5.3" >El </option>
                      <option value="6.3" >Il </option>
                      <option value="7.3" >Ne </option>
                      <option value="22.3">Sh </option>
                      <option value="16.3">Wz </option>
                      <option value="81">Other </option>
                      <option value="80">Power </option>
                    </select>
                          <!--Spells Fieldset - Threads-->
                    <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfEditMode" title="@{repeating_spell_X_SP_sThreads}:   Number of Threads required for this spell.">
                      <input name="attr_SP_sThreads" type="hidden" class="sheet-testNum" value="0" >
                      <input name="attr_SP_sThreads" type="number" readonly class="sheet-HideIfZero sheet-numShorter sheet-bordered-bottom" value="0" min="0">
                    </span>
                    <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_sThreads}:   Number of Threads required for this spell.">
                      <input name="attr_SP_sThreads" type="number" class="sheet-numShorter sheet-bordered-bottom" value="0" min="0">
                    </span>
                          <!--Spells Fieldset - Name & Master Button-->
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-api">
                      <button class="sheet-text-button sheet-label-under sheet-api" name="roll_SP_Roll" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell: @{SP_RowID}: Sequence : G"
                      title="%{selected|SP_Roll} Start a new Spell, or Roll to Weave Threads, Spellcasting, or an Effect test for this spell.">
                      <input name="attr_SP_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                      </button>
                      <input name="attr_SP_Name" type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-testPlaceholder sheet-bordered-bottom" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                    </span>
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-NoAPI">
                      <input name="attr_SP_Name" type="text" class="sheet-LockIfNotEditMode sheet-txtMedplus sheet-bordered-bottom" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                    </span>
                    <input name="attr_SP_Name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <span class="sheet-hideIfNotPlaceholder" title="@{SP_textImport}:   Spell Text import: This only shows up if Name is empty.">
                      <textarea name="attr_SP_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                      If you have a PDF copy of the book, you can copy an entire Spell description (starting with the name,
                      and including everything) and paste it into this tiny text box. It will be parsed and whatever fields
                      can be set based upon the text will be. You will still need to manually set some of the fields.
                    </span>
                          <!--Spells Fieldset - Effect-->
                    <span class="sheet-fixed-width sheet-txtShort sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder">
                      <input name="attr_SP_WilSelect" class="sheet-testChecked sheet-hidden" checked value="None" type="checkbox">
                      <select name="attr_SP_WilSelect" class="sheet-txtShort sheet-HideIfNotChecked" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <option value="None" selected>None</option>
                        <option value="Wil">Wil</option>
                        <option value="Rank">Rk</option>
                        <option value="Circle">Cir</option>
                      </select>
                      <select name="attr_SP_WilSelect" class="sheet-numLong sheet-HideIfChecked" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <option value="None" selected>None</option>
                        <option value="Wil">Wil</option>
                        <option value="Rank">Rk</option>
                        <option value="Circle">Cir</option>
                      </select>
                      <span class="sheet-middle sheet-HideIfChecked">+</span>
                      <span class="sheet-nowrap0 sheet-HideIfChecked" title="@{repeating_spell_X_SP_WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                        <input name="attr_SP_WilEffect" type="number" value="0" class="sheet-numShort sheet-LockIfNotChecked">
                      </span>
                    </span>
                    <span class="sheet-nowrap0 sheet-HideIfEditMode sheet-titlespan sheet-fixed-width sheet-selShort sheet-hideIfPlaceholder" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                      <input class="sheet-testChecked sheet-hidden" checked name="attr_SP_WilSelect" value="None" type="checkbox">
                      <span class="sheet-HideIfChecked">
                        <input name="attr_SP_WilSelect" type="text" readonly class="sheet-numShorter" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <span class="sheet-middle">+</span>
                        <span class="sheet-nowrap0" title="@{repeating_spell_X_SP_WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                          <input name="attr_SP_WilEffect" type="number" readonly value="0" class="sheet-numShorter">
                        </span>
                      </span>
                    </span>
                          <!--Spells Fieldset - Target-->
                          <!--JBF@JBF : Non-Api to be checked-->
                    <span class=" sheet-hideIfPlaceholder sheet-iconselect-span sheet-fixed-width sheet-text-center sheet-w50px sheet-titlespan sheet-api sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_Casting}    How is the Target Number arrived at? What attribute is targeted and how?">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target."> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="Targets Mystic Defense. There is always exactly one Target."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MDh" title="Targets highest Mystic Defense among all targets." > <span class="sheet-HideIfNotCloseChecked" title="Targets highest Mystic Defense among all targets."> h<span class="sheet-iconstatic sheet-icon-MD"></span></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target."> <span class="sheet-HideIfNotCloseChecked" title="Targets highest Mystic Defense, +1 for each additional target."> h<span class="sheet-iconstatic sheet-icon-MD"></span>+1</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made."> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="2" title="The target number is 2."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 2."> <span class="sheet-iconstatic sheet-icon-TN"></span>2</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="3" title="The target number is 3."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 3."> <span class="sheet-iconstatic sheet-icon-TN"></span>3</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="4" title="The target number is 4."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 4."> <span class="sheet-iconstatic sheet-icon-TN"></span>4</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="5" title="The target number is 5."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 5."> <span class="sheet-iconstatic sheet-icon-TN"></span>5</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="6" title="The target number is 6."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 6."> <span class="sheet-iconstatic sheet-icon-TN"></span>6</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="7" title="The target number is 7."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 7."> <span class="sheet-iconstatic sheet-icon-TN"></span>7</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="8" title="The target number is 8."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 8."> <span class="sheet-iconstatic sheet-icon-TN"></span>8</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="9" title="The target number is 9."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 9."> <span class="sheet-iconstatic sheet-icon-TN"></span>9</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="10" title="The target number is 10."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 10."> <span class="sheet-iconstatic sheet-icon-TN"></span>10</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="11" title="The target number is 11."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 11."> <span class="sheet-iconstatic sheet-icon-TN"></span>11</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="12" title="The target number is 12."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 12."> <span class="sheet-iconstatic sheet-icon-TN"></span>12</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="13" title="The target number is 13."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 13."> <span class="sheet-iconstatic sheet-icon-TN"></span>13</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="14" title="The target number is 14."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 14."> <span class="sheet-iconstatic sheet-icon-TN"></span>14</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="15" title="The target number is 15."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 15."> <span class="sheet-iconstatic sheet-icon-TN"></span>15</span>
                      </span>
                      <select name="attr_SP_Casting" class="sheet-iconselect-select sheet-w50px">
                        <option selected value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target."> MD-1</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets."> h-MD</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target."> h-MD+1p</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made."> Ask</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="3" title="The target number is 3.">3</option>
                        <option value="4" title="The target number is 4."> 4</option>
                        <option value="5" title="The target number is 5."> 5</option>
                        <option value="6" title="The target number is 6."> 6</option>
                        <option value="7" title="The target number is 7."> 7</option>
                        <option value="8" title="The target number is 8."> 8</option>
                        <option value="9" title="The target number is 9."> 9</option>
                        <option value="10" title="The target number is 10."> 10</option>
                        <option value="11" title="The target number is 11."> 11</option>
                        <option value="12" title="The target number is 12."> 12</option>
                        <option value="13" title="The target number is 13."> 13</option>
                        <option value="14" title="The target number is 14."> 14</option>
                        <option value="15" title="The target number is 15."> 15</option>
                      </select>
                    </span>

                          <!--Spells Fieldset - Range-->
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-numShort" title="@{repeating_spell_X_SP_Range}:   Range spell can be cast, Usually in Yards though it may be Touch or Self. Select a predefined Range, or type your own">
                      <input name="attr_SP_Range" type="text" class="sheet-numShort sheet-bordered-bottom sheet-LockIfNotEditMode sheet-hidden">
                      <input list="spell_range" name="attr_SP_Range" type="text" class="sheet-numShort sheet-bordered-bottom sheet-LockIfNotEditMode text-center" >
                      <datalist id="spell_range">
                        <option value="S">Self</option>
                        <option value="T">Touch</option>
                        <option value="10y">10y</option>
                        <option value="20y">20y</option>
                        <option value="30y">30y</option>
                        <option value="40y">40y</option>
                        <option value="50y">50y</option>
                        <option value="100y">100y</option>
                        <option value="1 mi">1 mile</option>
                        <option value="2 mi">2 mile</option>
                        <option value="3 mi">3 mile</option>
                        <option value="4 mi">4 mile</option>
                      </datalist>
                    </span>
                          <!--Spells Fieldset - Duration-->
                    <span class=" sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-selShort sheet-api sheet-HideIfEditMode" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Edit' button to edit this field.">
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom" readonly>
                    </span>
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-txtShort sheet-api sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Edit' button to edit this field.">
                      <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditDurationButton" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ chatMenu: editSpell2: @{SP_RowID}: Dur: ?{Duration|Nothing,|Rank,Rk|Circle,Cir}: ?{Duration plus|0}: ?{Duration increment|Rounds,Rd|Minutes,Min|Hours,hr|Days,d|Months,mth}"
                      title="%{selected|SP_EditDurationButton}   Edit this spell duration.">
                      <span class="sheet-iconstatic sheet-icon-edit"></span></button>
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom" readonly>
                    </span>
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-selShort sheet-NoAPI" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Do Stuff' button to edit this field.">
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom sheet-LockIfNotEditMode">
                    </span>
                          <!--Spells Fieldset - Effect-->
                    <span class="sheet-hideIfPlaceholder sheet-txtMedplus sheet-titlespan sheet-fixed-width " title="@{repeating_spell_X_SP_Effect}:   Effect of Spell.">
                      <input type="text" name="attr_SP_Effect" class="sheet-txtMedplus sheet-text-left sheet-bordered-bottom sheet-LockIfNotEditMode" >
                    </span>

                          <!--Spells Fieldset -  Details and Parameters-->
                    <span class="sheet-hideIfPlaceholder sheet-nowrap">
                      <label title="@{repeating_spell_X_SP_Details}   Show details of Spell">
                        <input type="checkbox" name="attr_SP_Details" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                      </label>
                      <label class="sheet-HideIfNotEditMode sheet-api" title="@{repeating_spells_X_SP_CombatSlot}  Should this Spell be summarized on the combat tab and placed in a Token Action?. Note that this will only happen if the spell is attuned in Matrix">
                        <input type="checkbox" name="attr_SP_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                      </label>
                      <label title="@{repeating_spell_X_SP_Parameters}   Show detailed parameters" class="sheet-HideIfNotEditMode">
                        <input type="checkbox" name="attr_SP_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                      </label>
                    </span>
                          <!--Spells Fieldset -  Spell Details-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Details" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked">
                            <!--Spells Fieldset - Attuning Difficutlies-->
                      <span class="sheet-nowrap">
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfEdition3" title="@{repeating_spell_X_SP_Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                          <input name="attr_SP_Numbers" type="text" readonly class="sheet-bordered-bottom">
                          <span name="attr_SP_Numbers" class="sheet-autoexpand"></span>
                          <span>Wv/Ratn/Dspl/Sns</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfNotEdition3" title="@{repeating_spell_X_SP_Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                          <input name="attr_SP_Numbers" type="text" class="sheet-bordered-bottom">
                          <span name="attr_SP_Numbers" class="sheet-autoexpand"></span>
                          <span>Wv/Ratn/Dspl/Dblf/Sns</span>
                        </label>
                        <!--Spells Fieldset - AoE-->
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-fixed-width sheet-numLong" title="@{repeating_spell_X_SP_AoE}:   Area of Effect - Usually in Yards.">
                          <input name="attr_SP_AoE" type="text" value=" " class="sheet-bordered-bottom" >
                          <span name="attr_SP_AoE" class="sheet-autoexpand"></span>
                          <span>AoE</span>
                        </label>
                      </span>
                            <!--Spells Fieldset - Armor-->
                      <span class="sheet-nowrap sheet-label-under" title="@{repeating_spell_X_SP_EffectArmor}:   If there is a will effect, what armor protects against it?">
                        <select name="attr_SP_EffectArmor" class="sheet-selLong">
                          <option value="N/A" selected>N/A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Not Applicable: There is no Will Effect</option>
                          <option value="NoDmg"       >No Dmg &nbsp;&nbsp; Not Applicable: The Will Effect does no damage</option>
                          <option value="MA"          >MA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mystic Armor protects against this Will Effect</option>
                          <option value="PA"          >PA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Physical Armor protects against this Will Effect</option>
                          <option value="PA-Nat"      >PA-Nat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only Natural Physical Armor protects against this Will Effect</option>
                          <option value="MA-Nat"      >MA-Nat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only Natural Mystic Armor protects against this Will Effect</option>
                          <option value="NoArmor"     >No Armor &nbsp;No Armor protects against this Will Effect damage</option>
                        </select>
                        <span>Efct Armor</span>
                      </span>
                            <!--Spells Fieldset - Extra successes-->
                      <span class="sheet-nowrap sheet-label-under" title="@{repeating_spell_X_SP_SuccessLevels}:   Effect of Extra Success Levels.">
                        <select name="attr_SP_SuccessLevels" class="sheet-txtShort">
                          <option value="None" selected >None</option>
                          <option value="Inc Efct Step (+2)">Efct +2 Step Increase</option>
                          <option value="Inc Efct (Other)"  >Efct Other Increase</option>
                          <option value="Inc Dur (+2)"      >Dur +2 Increase</option>
                          <option value="Inc Dur (Other)"   >Dur Other Increase</option>
                          <option value="Inc Area (+2)"     >Area +2 yards Increase</option>
                          <option value="Inc Area (Other)"  >Area Other Increase</option>
                          <option value="Inc Rng (+20)"     >Range +20 yards Increase</option>
                          <option value="Add Tgt (+1)"      >Target +1 Additional</option>
                          <option value="Special"           >Special</option>
                        </select>
                        <span>Extra Success</span>
                      </span>
                            <!--Spells Fieldset - Extra Thread-->
                      <span class="sheet-nowrap">
                        <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditExtraThreadsButton" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ ?{What Function|Add Extra Thread,chatMenu: editSpell2: @{SP_RowID}: MenuAddExtraThread|Remove Extra Thread,chatMenu: editSpell2: @{SP_RowID}: MenuRemoveExtraThread}"
                        title="%{selected|SP_EditExtraThreadsButton}   Edit this spell extraThreads.">
                        <span class="sheet-iconstatic sheet-icon-edit"></span></button>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_spell_X_SP_ExtraThreads}:   Effect of weaving extra threads to the spell.  Press 'Do Stuff' button to edit this field.">
                          <input type="text" name="attr_SP_ExtraThreads" class="sheet-bordered-bottom" readonly >
                          <span name="attr_SP_ExtraThreads" class="sheet-autoexpand"></span>
                          <span>Extra Threads</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-NoAPI" title="@{repeating_spell_X_SP_ExtraThreads}:   Effect of weaving extra threads to the spell.  Press 'Do Stuff' button to edit this field.">
                          <input type="text" name="attr_SP_ExtraThreads" class="sheet-bordered-bottom" >
                          <span name="attr_SP_ExtraThreads" class="sheet-autoexpand"></span>
                          <span>Extra Threads</span>
                        </label>
                      </span>
                    </div>    <!-- end spell details -->
                          <!--Spells Fieldset -  Spell Parameters-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Parameters" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode">
                            <!--Spells Fieldset - Options affecting result-->
                      <div class="sheet-HideIfNotOption2 sheet-api">
                        <span class="sheet-label"> After roll parameters - </span>
                        <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                          <select name="attr_SP_sayTotalSuccess" class="selLong" title="@{repeating_spells_X_SP_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                            <option value="0" selected title="@{repeating_spells_X_SP_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                            <option value="1" title="@{repeating_spells_X_SP_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                          </select>
                        </span>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_spell_X_SP_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the spell works.">
                          <input name="attr_SP_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                          <span name="attr_SP_SuccessText" class="sheet-autoexpand"></span>
                          <span>Success Text</span>
                        </label>
                              <!--Spells Fieldset - FX-->
                        <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditSFXButton" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: SP: @{SP_RowID}"
                        title="%{selected|SP_EditSFXButton}   Edit this spell Special Effects.">
                        SFX</button>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_spell_X_SP_FX}:   Special Effects command. FX command to be performed when this spell is used. Press 'Do Stuff' button to edit this field.">
                          <input name="attr_SP_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_SP_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </div>
                    </div>
                          <!--Spells Fieldset - Notes-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Details" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked">
                      <textarea name="attr_SP_Notes" class="sheet-details" title="@{repeating_spell_X_SP_Notes}   Description of Spell and how it works." placeholder="Description of the Spell and how it works."></textarea>
                    </div>
                  </div>    <!-- End Filtered box   -->
                </div>    <!-- end misc right inside fieldset -->
              </fieldset>
            </div>    <!-- end matrix counter -->
          </div>    <!-- end Section Spells - Grimoire Subsection -->
        </div>    <!-- ***************************************** End of Section Spells*************************************  -->


        <div class="sheet-section sheet-section-grimoire"></div>    <!--  Unused  -->


        <!-- ***************************************** Section Equipment*************************************  -->
        <div class="sheet-section sheet-section-equipment">
          <div class="sheet-flex-container">
                  <!--Equipment - Left Pane - Inventory-->
            <div class="sheet-bordered" style="flex: 1 1 auto;">
              <input type="checkbox" name="attr_show_container" value="1" class="sheet-testChecked sheet-testRepOption1 sheet-hidden">
                    <!--Equipment - Left Pane - Header-->
              <div class="sheet-headerbar sheet-headerbar-flex" style="max-width:400px;">
                <div>
                  <label title="@{attr_tab7-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                    <input type="checkbox" name="attr_tab7-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab7-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                    <input type="checkbox" name="attr_tab7-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab7-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                    <input type="checkbox" name="attr_tab7-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                </div>
                Inventory
                <div></div>
              </div>
                    <!-- Equipment - Inventory - Pre-filled -->
              <div class="sheet-content" style="max-width:400px;">
                <div>
                  <span class="sheet-nowrap sheet-label">Carried/Capacity:</span>
                  <input name="attr_Carrying-Carried" readonly="readonly"
                      value="0"
                      title="@{Carrying-Carried}  Number of pounds Equipment and Gear carried ."
                      type="number"> /
                      <input name="attr_Carrying-Capacity" class="sheet-nowrap" readonly="readonly"
                      value="80"
                      title="@{Carrying-Capacity}  Number of pounds that may be carried without penalty."
                  type="number">
                </div>
                <div>
                  <span class="sheet-iconstatic sheet-icon-coin-gold" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers"></span>:
                  <input name="attr_Wealth_Gold" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers">
                  <span class="sheet-iconstatic sheet-icon-coin-silver" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers"></span>:
                  <input name="attr_Wealth_Silver" type="number" value="100" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers. New Characters start with 100.">
                  <span class="sheet-iconstatic sheet-icon-coin-copper" title="@{Wealth_Copper}:   Number of Copper pieces owned."></span>:
                  <input name="attr_Wealth_Copper" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Copper}:   Number of Copper pieces owned.">
                </div>
                <div title="@{Wealth_Other}:   Elemental Coins and Gems.">
                  <!-- <span class="sheet-iconstatic sheet-icon-wealth"></span> : -->
                  <textarea name="attr_Wealth_Other" class="sheet-details-small"  placeholder="Other Valuables" >
                </div>
                <div class="sheet-table-left">
                  <div class="sheet-table-row">
                    <span class="sheet-table-data" >
                      <span class="sheet-iconstatic sheet-icon-potion"></span>
                      <b class="sheet-label ">Booster P: </b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Booster" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Booster}:   Number of Booster Potions owned. - Booster Potions grant + 8 to next recovery test">
                    </span>
                    <span class="sheet-table-data" >
                      <b class="sheet-label ">S.of Closure:</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Closure" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Closure}:   Number of Salve's of Closure owned. - Heals One Wound - COnsumes one recovery test">
                    </span>
                  </div>
                  <div class="sheet-table-row ">
                    <span class="sheet-table-data" >
                        <span class="sheet-iconstatic sheet-icon-potion"></span>
                      <b class="sheet-label ">Healing P:</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Healing" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Healing}:   Number of Healing Potions owned. - Healing Potions heals one Wound and grant +8 to next Recovery Test. If No recovery Test, heals Step 8">
                    </span>
                    <span class="sheet-table-data" >
                      <b class="sheet-label ">Last Chance:</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Last_Chance" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Last_Chance}:   Number of Last Chance Salves owned. - Last chance can be applied to character dead for less than its TOU/WIL Step. The character gets all his recovery tests (min 1) with a chance to resurrect.">
                    </span>
                  </div>
                  <div class="sheet-table-row ">
                    <span class="sheet-table-data" >
                      <span class="sheet-iconstatic sheet-icon-kit"></span>
                      <b class="sheet-label "> Healing:</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Kit" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Kit}:   Number of uses in Healing Kit and all refills. - Grants +1 to next recovery Test">
                    </span>
                    <span class="sheet-table-data" >
                      <b class="sheet-label ">Physician: </b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Healing_Physician_Kit" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Physician_Kit}:   Number of uses in Physician's Kit and all refills. - To be used with physician kit - Removes Wound Penalty on Recovery Tests">
                    </span>
                  </div>
                  <div class="sheet-table-row ">
                    <span class="sheet-table-data" >
                      <span class="sheet-iconstatic sheet-icon-ration"></span>
                      <b class="sheet-label "> Trail :</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Gear_Rations_Trail" type="number" value="7" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Gear_Rations_Trail}:   Number of person/days of Trail Rations owned. New characters start with 7">
                    </span>
                    <span class="sheet-table-data" >
                      <b class="sheet-label "> Mine:</b>
                    </span>
                    <span class="sheet-table-data" >
                      <input name="attr_Gear_Rations_Mine" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Gear_Rations_Mine}:   Number of person/days of Dwarvish Mine Rations owned. - Gives +1 to next recovery test">
                    </span>
                  </div>
                </div>
                        <!--Equipment - Inventory - Containers -->
                <div class="sheet-HideIfNotChecked">
                  <div>
                    <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Container</b>
                    <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Wght</b>
                    <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">1</b>
                    <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">2</b>
                    <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">3</b>
                  </div>

                  <div>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont1-Name" placeholder="Self" title="@{Cont1-Name} Name of first Container"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont1-Weight" value="0" title="@{Cont1-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont1-Carried" value="1" checked title="@{Cont1-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                  </div>
                  <div>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont2-Name"  placeholder="Backpack" title="@{Cont2-Name} Name of first Container"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont2-Weight" value="0" title="@{Cont2-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont2-Carried" value="1" checked title="@{Cont2-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                  </div>
                  <div>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont3-Name"  placeholder="Mount" title="@{Cont3-Name} Name of first Container"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont3-Weight" value="0" title="@{Cont3-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                    <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont3-Carried" value="1" checked title="@{Cont3-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                  </div>
                </div>
                      <!--Equipment - Inventory - Title Bars-->
                <div class="sheet-HideIfChecked">
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Item</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Qty</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">Car.</b>
                </div>

                <div class="sheet-HideIfNotChecked">
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Item</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Qty</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">1</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">2</b>
                  <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">3</b>
                </div>
                      <!--Equipment - Inventory - Fieldset-->
                <input type="checkbox" name="attr_show_container" value="1" class="sheet-testRepOption1 sheet-hidden">
                <fieldset class="repeating_inventory">
                  <input name="attr_INV_RowID" type="text" class="sheet-hidden" >
                  <input class="sheet-testLocked sheet-hidden" name="attr_INV_showDetails" type="checkbox" value="3">
                  <span class="sheet-fixed-width sheet-txtShort sheet-notbordered">
                    <input name="attr_INV_Name" type="text" class="sheet-nowrap sheet-txtMed sheet-label-flex" placeholder="Name"
                    title="@{repeating_inventory_X_INV_Name}:   Name of Item.">
                  </span>
                  <span class="sheet-fixed-width sheet-numShort">
                    <input name="attr_INV_Qty" type="number" value="0" class="sheet-numShort sheet-HideSpinners"
                    title="@{repeating_inventory_X_INV_Qty}:   Quantity of the item possessed" >
                  </span>
                  <span class="sheet-fixed-width sheet-w25px sheet-text-center">
                    <input name="attr_INV_Carried1" type="checkbox" value="1" checked
                    title="@{repeating_inventory_X_INV_Carried1}:   Is item Carried in the referenced container" >
                  </span>
                  <span class="sheet-fixed-width sheet-w25px sheet-text-center sheet-HideIfNotOption1">
                    <input name="attr_INV_Carried2" type="checkbox" value="1"
                    title="@{repeating_inventory_X_INV_Carried2}:   Is item Carried in the referenced container" >
                  </span>
                  <span class="sheet-fixed-width sheet-w25px sheet-text-center sheet-HideIfNotOption1">
                    <input name="attr_INV_Carried3" type="checkbox" value="1"
                    title="@{repeating_inventory_X_INV_Carried3}:   Is item Carried in the referenced container" >
                  </span>
                  <label title="@{repeating_inventory_X_INV_ShowNotes}   Show or Hide the details of item">
                    <input type="checkbox" checked="checked" name="attr_INV_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <input type="checkbox" checked="checked" name="attr_INV_ShowNotes" value="1" class="sheet-testChecked sheet-hidden">
                  <div class="sheet-HideIfNotChecked">
                    <span class="sheet-nowrap" title="@{repeating_inventory_X_INV_UnitWeight}:   Unit Weight in Pounds.">Un.Wgt.
                      <input name="attr_INV_UnitWeight" type="number" value="0" min="0" class="sheet-numShort">
                    </span>
                    <span class="sheet-nowrap" title="@{repeating_inventory_X_INV_TotalWeight}:   Total Weight in Pounds.">Tot.Wgt.
                      <input name="attr_INV_TotalWeight" type="number" value="(@{INV_UnitWeight}*@{INV_Qty})"  disabled class="sheet-numShort" readonly>
                    </span>
                    <textarea name="attr_INV_Notes" class="sheet-details-small" title="@{repeating_inventory_X_INV_Notes}   Detail of Item" placeholder="Detail of Item"></textarea>
                  </div>
                </fieldset>
                      <!--Equipment - Inventory - Notes-->
                <div class="sheet-headerbar">Notes</div>
                <div class="sheet-content">
                  <span class="sheet-nowrap3 sheet-label" title="@{Weight-Gear}:   Approximate weight of all gear listed on Gear tab that your character routinly carries on his person (as opposed to saddlebags, packhorses, Etc.)" >Est. other weight:
                    <input name="attr_Weight-Gear" type="number" value="0" min="0" class="sheet-selShort">
                  </span>
                  <textarea name="attr_gear-Inventory" class="sheet-text-left sheet-autoexpand sheet-details" style="height: 300px;" title="@{gear-Inventory}" placeholder="Inventory Gear here." ></textarea>
                </div>
              </div>
            </div>    <!-- end of leftpane inventory -->

                  <!-- Equipment - Right Pane -Sub-Section Equipment -->
            <div class="sheet-bordered sheet-w100p" style="flex: 1 1 auto;">
                    <!--Equipment - Right Pane - Header-->
              <div class="sheet-headerbar sheet-headerbar-flex">
                <div></div>Equipment
                <div class="sheet-floatRight">
                  <label title="@{attr_equipment-param-mode} : Toggles the view of parameters that affect the Equipment Section.">
                    <input type="checkbox" name="attr_equipment-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
                  </label>
                  <label title="@{attr_equipment-edit-mode} : Toggles the edit mode .">
                    <input type="checkbox" name="attr_equipment-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                </div>
              </div>

                    <!--**************************  Start of Section Core & Combat parameters -->
              <input type="checkbox" name="attr_equipment-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
              <div class="sheet-section sheet-section-equipment sheet-section-combat sheet-HideIfNotCloseChecked sheet-bordered">
                <div class="sheet-text-centered"><b class="sheet-heading"> Equipment and Inventory Parameters</b></div>
                <div>
                  <span class="sheet-nowrap sheet-label"> Container Management :
                    <select name="attr_show_container" class="sheet-selShort" title="@{show_container}   Enables the Management of the Inventory per container." >
                      <option selected value="0" >Hide </option>
                      <option value="1" >Show </option>
                    </select>
                  </span>
                </div>
                <div>
                  <span class="sheet-nowrap sheet-label"> Blood Magic :
                    <select name="attr_show_blood" class="sheet-selShort" title="@{show_blood}   Enables the Management of Blood Charms." >
                      <option selected value="0" >Hide </option>
                      <option value="1" >Show </option>
                    </select>
                  </span>
                </div>
                <div>
                  <span class="sheet-nowrap sheet-label"> Mounts & Companions :
                    <select name="attr_show_mounts" class="sheet-selShort" title="@{show_mounts}   Enables the Management of Mounts and Companions." >
                      <option selected value="0" >Hide </option>
                      <option value="1" >Show </option>
                    </select>
                  </span>
                </div>
                <div>
                  <span class="sheet-nowrap sheet-label"> LifeStyle :
                    <select name="attr_show_lifestyle" class="sheet-selShort" title="@{show_lifestyle}   Enables the Management of Lifestyle." >
                      <option selected value="0" >Hide </option>
                      <option value="1" >Show </option>
                    </select>
                  </span>
                </div>
              </div>    <!--end Core & Combat parameters -->

                    <!--Equipment - Right Pane - Armor & Weapons-->
              <div class="sheet-content">
                <datalist id="armor">
                  <option value="Blood Pebble"></option>
                  <option value="Chain Mail"></option>
                  <option value="Crystal Plate"></option>
                  <option value="Crystal Ringlet"></option>
                  <option value="Espagra Cloak"></option>
                  <option value="Fernweave"></option>
                  <option value="Hardened Leather"></option>
                  <option value="Hide Armor"></option>
                  <option value="Leather"></option>
                  <option value="Living Crystal"></option>
                  <option value="Obsidiman Skin"></option>
                  <option value="Padded Cloth"></option>
                  <option value="Padded Leather"></option>
                  <option value="Plate Armor"></option>
                  <option value="Ring Mail"></option>
                  <option value="Wyvern Skin"></option>
                  <option value="Bark"></option>
                  <option value="CrystalWeave"></option>
                  <option value="Stone Disk"></option>
                  <option value="Stone Net"></option>
                  <option value="Trim Wood"></option>
                  <option value="Wood Tile"></option>
                  <option value="Living Metal"></option>
                  <option value="Oathshar"></option>
                </datalist>
                <datalist id="shield">
                  <option value="Body"></option>
                  <option value="Buckler"></option>
                  <option value="Crystal Buckler"></option>
                  <option value="Crystal Raider"></option>
                  <option value="Ferndask"></option>
                  <option value="Footmans"></option>
                  <option value="Riders"></option>
                </datalist>
                <datalist id="weapons">
                  <option value="Barbed Net"></option>
                  <option value="Barbed Throwing Net"></option>
                  <option value="Battle Axe"></option>
                  <option value="Blowgun"></option>
                  <option value="Bola"></option>
                  <option value="Broadsword"></option>
                  <option value="Casting Net"></option>
                  <option value="Chtard Thorn"></option>
                  <option value="Club"></option>
                  <option value="Dagger"></option>
                  <option value="Dart"></option>
                  <option value="Dwarf Sword"></option>
                  <option value="Elven Warbow"></option>
                  <option value="Flail"></option>
                  <option value="Flight Dagger"></option>
                  <option value="Hand Axe"></option>
                  <option value="Hawk Hatchet"></option>
                  <option value="Knife"></option>
                  <option value="Lance"></option>
                  <option value="Light Crossbow"></option>
                  <option value="Long Spear"></option>
                  <option value="Longbow"></option>
                  <option value="Mace"></option>
                  <option value="Medium Crossbow"></option>
                  <option value="Net, Large"></option>
                  <option value="Net, Small"></option>
                  <option value="Pole Arm"></option>
                  <option value="Pole Axe"></option>
                  <option value="Quarterstaff"></option>
                  <option value="Raid Spear"></option>
                  <option value="Sap"></option>
                  <option value="Scythan Axe"></option>
                  <option value="Short Sword"></option>
                  <option value="Shortbow"></option>
                  <option value="Sling"></option>
                  <option value="Spear"></option>
                  <option value="Spiked Mace"></option>
                  <option value="Stone Maul"></option>
                  <option value="Tail Dancer Blade"></option>
                  <option value="Throwing Axe"></option>
                  <option value="Throwing Dagger"></option>
                  <option value="Throwing Net"></option>
                  <option value="Trispear"></option>
                  <option value="Troll Axe"></option>
                  <option value="Troll BattleAxe"></option>
                  <option value="Troll Bola"></option>
                  <option value="Troll Dagger"></option>
                  <option value="Troll Flail"></option>
                  <option value="Troll Mace"></option>
                  <option value="Troll PoleAxe"></option>
                  <option value="Troll Quarterstaff"></option>
                  <option value="Troll Sling"></option>
                  <option value="Troll Spear"></option>
                  <option value="Troll Sword"></option>
                  <option value="Troll Throwing Axe"></option>
                  <option value="Troll TwoHanded Sword"></option>
                  <option value="Troll Warhammer"></option>
                  <option value="Two-handed Sword"></option>
                  <option value="Warhammer"></option>
                  <option value="Whip"></option>
                  <option value="Windling Bow"></option>
                  <option value="Windling Dagger"></option>
                  <option value="Windling Net"></option>
                  <option value="Windling Polearm"></option>
                  <option value="Windling Quarterstaff"></option>
                  <option value="Windling Short Sword"></option>
                  <option value="Windling Spear"></option>
                  <option value="Windling Sword"></option>
                  <option value="Windling TwoHanded Sword"></option>
                </datalist>


                <input type="checkbox" name="attr_equipment-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                      <!--Equipment - Right Pane - Armor Titles-->
                <span class="sheet-fixed-width sheet-w25px"></span>
                <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-text-center sheet-titlespan">Name</b>
                <span class="sheet-iconstatic sheet-icon-PA" style="opacity:0;"></span>

                <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">Phys</b>
                <span class="sheet-iconstatic sheet-icon-MA" style="opacity:0;"></span>
                <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">Myst</b>
                <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">IP</b>
                      <!--Equipment - Right Pane - Armor-->
                <div>
                  <span class="sheet-nowrap" title="@{Armor-Name}:   Type of Armor worn.">
                    <span class="sheet-iconstatic sheet-icon-armor"></span>
                    <input name="attr_Armor-Name" list="armor" type="text" class="sheet-txtMed sheet-LockIfNotEditMode" placeholder="Armor type" >
                  </span>
                  <span class="sheet-nowrap" title="@{Armor-Phys}:   Physical protection armor provides.">
                    <span class="sheet-iconstatic sheet-icon-PA"></span>
                    <input name="attr_Armor-Phys" type="number" value="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap" title="@{Armor-Myst}:   Mystic protection armor provides.">
                    <span class="sheet-iconstatic sheet-icon-MA"></span>
                    <input name="attr_Armor-Myst" type="number" value="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap" title="@{Armor-IP}:   Initiative Penalty of wearing armor.">
                    <input name="attr_Armor-IP" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <label title="@{show-Armor-details}   Show or Hide the details of item">
                    <input type="checkbox"          name="attr_show-Armor-details" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <input type="checkbox"     name="attr_show-Armor-details" value="1" class="sheet-hidden sheet-testChecked">
                  <br>
                  <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{Armor-Weight}:   Weight of armor.">Weight :
                    <input name="attr_Armor-Weight" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{Armor-Date}:   Enhancements and Date(s) Armor was last enchanted/forged.">Notes :
                    <br>
                    <textarea name="attr_Armor-Date" class="sheet-details-small sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{Armor-Date}   Date Armor was last forged." placeholder="Date forged" ></textarea>
                  </span>
                </div>
                      <!--Equipment - Right Pane - Shield-->
                <div>
                  <span class="sheet-nowrap" title="@{Shield-Name}:   Type of Shield Used.">
                    <span class="sheet-iconstatic sheet-icon-shield"></span>
                    <input name="attr_Shield-Name" list="shield" type="text" class="sheet-txtMed sheet-LockIfNotEditMode" placeholder="Shield type" >
                  </span>
                  <span class="sheet-nowrap" title="@{Shield-Phys}:   Physical protection shield provides.">
                    <span class="sheet-iconstatic sheet-icon-PA sheet-HideIfEdition4"></span>
                    <span class="sheet-iconstatic sheet-icon-PD sheet-HideIfNotEdition4"></span>
                    <input name="attr_Shield-Phys" type="number" value="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap" title="@{Shield-Myst}:   Mystic protection shield provides.">
                    <span class="sheet-iconstatic sheet-icon-MA sheet-HideIfEdition4"></span>
                    <span class="sheet-iconstatic sheet-icon-MD sheet-HideIfNotEdition4"></span>
                    <input name="attr_Shield-Myst" type="number" value="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap" title="@{Shield-IP}:   Initiative Penalty of using Shield.">
                    <input name="attr_Shield-IP" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <label title="@{show-Shield-details}   Show or Hide the details of item">
                    <input type="checkbox"    name="attr_show-Shield-details" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <input type="checkbox" name="attr_show-Shield-details" value="1" class="sheet-hidden sheet-testChecked">
                  <br>
                  <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{Shield-Weight}:   Weight of Shield.">Weight :
                    <input name="attr_Shield-Weight" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>

                  <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{Shield-Shatter}:   Shatter Threshold of Shield.">Shatter :
                    <input name="attr_Shield-Shatter" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                  </span>
                  <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{Shield-Date}:   Enhancements and Date(s) Shield was last enchanted/forged.">Notes :
                    <br>
                    <textarea name="attr_Shield-Date" class="sheet-details-small sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{Shield-Date}   Date Shield was last forged." placeholder="Date forged" ></textarea>
                  </span>
                </div>

                <div class="sheet-HideIfNotEditMode">
                  <input name="attr_SizeRestriction" type="checkbox" value="" checked class="sheet-hidden sheet-testCloseChecked">
                  <span class="sheet-label sheet-HideIfCloseChecked">
                    Size Restrictions:
                    <input name="attr_SizeRestriction" type="text" value=""  class="sheet-txtMedplus" readonly title="@{SizeRestriction} : Size Restrictions to Weapons linked to Race (ED4 PG403)">
                  </span>
                </div>

                      <!--Equipment - Right Pane - Weapon Titles-->
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-text-center sheet-titlespan sheet-HideIfEditMode">Weapon</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Weapon</b>
                <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-text-center sheet-titlespan">Dmg</b>
                <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-text-center sheet-titlespan">Dmg</b>
                <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan">Step</b>
                <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Size</b>
                <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan">Stn</b>
                <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan ">Kma</b>
                <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest">DP</b>
                      <!--Equipment - Right Pane - Weapon Fieldset-->
                <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">

                <br>
                <fieldset class="repeating_weapons">
                  <span class="sheet-hidden"><input name="attr_WPN_RowID" type="text" ></span>
                        <!--Weapon Fieldset - Close Combat-->
                  <span class="sheet-nowrap0" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                    <!--Toggle Range/CC Mode-->
                    <input type="checkbox" name="attr_WPN_CloseCombat" checked value="1" class="sheet-testChecked sheet-hidden">
                    <label class="sheet-HideIfNotChecked" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                      <input type="checkbox" name="attr_WPN_CloseCombat" value="-1" class="sheet-iconcheckbox sheet-LockIfNotEditMode"> <span class="sheet-iconlabelCC sheet-icon-attacks-cc"></span>
                    </label>
                    <label class="sheet-HideIfChecked" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                      <input type="checkbox" name="attr_WPN_CloseCombat" value="1" class="sheet-iconcheckbox sheet-LockIfNotEditMode"> <span class="sheet-iconlabelCC sheet-icon-attacks"></span>
                    </label>
                  </span>
                  <input type="hidden" name="attr_WPN_CloseCombat" value="1"> <!--Necessary for proper initialization-->
                        <!--Weapon Fieldset - Name & Button-->
                  <span class="sheet-nowrap0 sheet-HideIfEditMode">
                    <button class="sheet-text-button sheet-api" name="roll_WPN_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ @{RollType} ~ foreach:sct:ust:c~ modValue: ?{Modification|0} ~K-ask: @{KarmaGlobalMode}@{WPN_Karma-Ask}: @{DPGlobalMode}@{WPN_DP-Ask}~ Action: WPN: @{WPN_RowID} "
                    title="@{repeating_weapons_X_WPN_Roll}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
                    <button class="sheet-text-button sheet-NoAPI" name="roll_WPN_Roll-NoAPI" type="roll"
                    value="@{RollType} &{template:default} {{name=@{WPN_Name} Dmg}} {{Step=[[?{Step|@{WPN_Damage}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                    title="@{repeating_weapons_X_WPN_Roll-NoAPI}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
                  </span>
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_Name}:   Type of Weapon used.">
                    &nbsp;&nbsp;&nbsp;<input name="attr_WPN_Name" list="weapons"  type="text" class="sheet-txtLong sheet-bordered-bottom" placeholder="Weapon type" >
                  </span>
                        <!--Weapon Fieldset - Rank-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfEditMode">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_weapons_X_WPN_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of a Talent, like using Surprise Strike or Down Strike.">
                        <input name="attr_WPN_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_WPN_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_WPN_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_weapons_X_WPN_Rank}:   This is the Base Damage of this Weapon."  type="number"  >
                      <input name="attr_WPN_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_weapons_X_WPN_Effective-Rank}:   Weapons effective Rank of Damage in this weapon counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                      <span title="@{repeating_weapons_X_WPN_Rank-Adjust}:   Adjustments to the damage of this weapon as for example with Forge Weapon.">
                        <input name="attr_WPN_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_WPN_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                      </span>
                    </span>
                  </span>
                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-HideIfNotEditMode">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_weapons_X_WPN_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of a Talent, like using Surprise Strike or Down Strike.">
                        <input name="attr_WPN_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_WPN_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_WPN_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Rank}:   Weapon Base Rank of damage."  type="number"  >
                      <span title="@{repeating_weapons_X_WPN_Rank-Adjust}:  Adjustments to the damage of this weapon as for example with Forge Weapon.">
                        <input name="attr_WPN_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_WPN_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                      </span>
                    </span>
                  </span>
                  <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span title="@{repeating_weapons_X_WPN_Mod-Auto}   This is the Total adjustment to Damage from Conditions and Combat Options.">
                        <input name="attr_WPN_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_WPN_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_WPN_Damage" type="number" disabled class="sheet-StepBig sheet-StepTotal" readonly
                      value="(@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{WPN_Effective-Rank}+@{WPN_Mods}+(@{Adjust-Damage-Total-CC}*(@{WPN_CloseCombat}+1)/2)+(@{Adjust-Damage-Total}*abs(@{WPN_CloseCombat}-1)/2))"
                      title="@{repeating_weapons_X_WPN_Damage}   Final Damage Step this weapon does including all modifiers .">
                      <input name="attr_WPN_BaseDamage" type="number" disabled class="sheet-StepBig sheet-StepBase" readonly
                      value="(@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{WPN_Effective-Rank})"
                      title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
                      <span title="@{repeating_weapons_X_WPN_Mods}   Modifications to the base damage.">
                        <input name="attr_WPN_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_WPN_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                  </span>

                  <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <input name="attr_WPN_BaseDamage" type="number" disabled class="sheet-StepBig" readonly
                      value="(@{Str-Step}+@{Str-Adjust}+@{Str-Mods}+@{WPN_Effective-Rank})"
                      title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
                      </span>
                    </span>
                  <!--Weapon Fieldset - Size-->
            <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_Size}: Weapon Size">
              <input name="attr_WPN_Size" type="number" value="0" class="sheet-numShorter" >
            </span>
                        <!--Weapon Fieldset - Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan" title="@{repeating_weapons_X_WPN_Strain}: number of strain points per use (mostly to be used for weapons linked to talents)">
                    <input name="attr_WPN_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_WPN_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_WPN_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                  </span>
                        <!-- Weapon Fieldset- Karma & DP -->
                  <span class="sheet-fixed-width sheet-w30px">
                          <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_WPN_Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_WPN_Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_WPN_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_WPN_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_WPN_Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>

                          </span>
                        </span>
                      </span>
                    </span>
                          <!--JBF End Of Karma Toggle-Simple-->
                          <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-Karma-ControlBox sheet-HideIfNotQuest">
                      <input type="hidden" name="attr_WPN_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_WPN_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_WPN_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{WPN_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_WPN_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_WPN_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_WPN_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>

                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </span>   <!-- end Weapon Fieldset- Karma & DP -->
                  <label title="@{repeating_weapons_X_WPN_ShowNotes}   Show or Hide the details of item">
                    <input type="checkbox" name="attr_WPN_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <label class="sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_CombatSlot}  Should this Weapon be summarized on the combat tab and placed in a Token Action?">
                    <input type="checkbox" name="attr_WPN_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                  </label>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                    <input name="attr_WPN_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-HideIfCloseChecked">
                      <input name="attr_WPN_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                      <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                    </span>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_WPN_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                    </span>
                  </span>

                        <!--Weapon Fieldset - Detail Icons-->
                  <input type="checkbox" name="attr_WPN_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
                  <div class="sheet-HideIfNotCloseChecked">
                  <div>
                        <!--Weapon Fieldset - Details-->
                  <span class="sheet-nowrap0 sheet-label">Weight :<input name="attr_WPN_Weight" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Weight}   Weight of Weapon." ></span>
                  <!-- <span class="sheet-nowrap0 sheet-label">Min Str :<input name="attr_WPN_Str" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Str}   Min Str to use the weapon (for info only)." ></span>
                  <span class="sheet-nowrap0 sheet-label">Min Dex :<input name="attr_WPN_Dex" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Dex}   Min Dex to use the weapon (for info only." ></span> -->
                  <span class=" sheet-api sheet-label">Max Karma :</span>
                  <input name="attr_WPN_Karma-Limit_max" type="number" class="sheet-numShorter sheet-LockIfNotEditMode sheet-HideSpinners" min="0" max="3" title="@{repeating_weapons_X_WPN_Karma-Limit_max} Maximum allowed Karma Points that can be added to tests with this Weapon ">
                  <span class="sheet-nowrap sheet-HideIfNotQuest sheet-api sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_DP-Limit_max} Maximum allowed Devotion Points that can be added to tests with this Weapon">
                    <span class="sheet-label">Max DP :</span>
                    <input name="attr_WPN_DP-Limit_max" type="number" class="sheet-numShorter sheet-LockIfNotEditMode" min="0" max="3" >
                  </span>
                </div>
                <input type="checkbox" name="attr_WPN_CloseCombat" checked value="1" class="sheet-testCloseChecked sheet-hidden">
                <div class=sheet-HideIfCloseChecked>
                  <span class="sheet-nowrap0 sheet-label">Ammo Qty : <input name="attr_WPN_AmmoQty" type="number" class="sheet-numLong " value="0" title="@{repeating_weapons_X_WPN_AmmoQty}   number of ammunition carried." ></span>
                  <span class="sheet-nowrap0 sheet-label">Un Wgt  : <input name="attr_WPN_AmmoWeight" type="number" class="sheet-numLong sheet-LockIfNotEditMode" value="0" title="@{repeating_weapons_X_WPN_AmmoQty}   number of ammunition carried." ></span>
                  <span class="sheet-nowrap0 sheet-label">Range : <input name="attr_WPN_Range" type="text" class="sheet-selLong sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_Range}   Short and Long range of weapon if applicable." placeholder="shrt/Lng" ></span>

                </div>
                        <!--Weapon Fieldset - Link Button-->
                  <div class="sheet-nowrap sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                    <span class="sheet-label"> Link :</span>
                    <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_WPN_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: WPN : @{WPN_RowID}"
                    title="@{repeating_weapons_X_WPN_btnSetLink} Set the Links for this Weapon. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Weapon"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                    <span title="@{repeating_weapons_X_WPN_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                      <span class="sheet-autoexpand-wrap">
                        <input name="attr_WPN_LinksGetValue" type="text" readonly class="sheet-bordered">
                        <span name="attr_WPN_LinksGetValue" class="sheet-autoexpand"></span>
                      </span>
                      <input name="attr_WPN_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksGetValue_max} : List of RowIds of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties"> <!--JBF@JBF to be hidden, temporary for testing-->
                      <input name="attr_WPN_LinksProvideValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksProvideValue_max} : List of RowIds of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Talent to provide its Rank to a linked Knack."> <!--JBF@JBF to be hidden, temporary for testing-->
                      <input name="attr_WPN_LinksProvideValue" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksProvideValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Talent to provide its Rank to a linked Knack."> <!--JBF@JBF to be hidden, temporary for testing-->
                    </span>
                  </div>
                  <div>
                    <textarea name="attr_WPN_Date" class="sheet-details-small sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_Date}   Date weapon was last forged." placeholder="Date Forged" ></textarea>
                  </div>
                  <div>
                </fieldset>
              </div>    <!-- end Equipment - Right Pane - Armor & Weapons -->


                    <!-- Equipment - Right Pane - Thread Items -->
              <div class="sheet-headerbar sheet-headerbar-flex">
                <div></div>
                Thread Items and Woven Threads
                <div class="sheet-floatRight">
                  <label title="@{attr_thread-edit-mode} : Toggles the edit mode .">
                    <input type="checkbox" name="attr_thread-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                </div>
              </div>
              <div class="sheet-content">
                <input type="checkbox" name="attr_thread-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                <p class="sheet-HideIfPrint">Note that most of these will require adjusting entries either in stats, talents, or miscellaneous adjustments on the last tab.</p>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center">&nbsp;Items&nbsp;</b>
                <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center">&nbsp;Rank&nbsp;</b>
                <b class="sheet-heading sheet-fixed-width sheet-selLong sheet-text-center">&nbsp;Tier&nbsp;</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center">&nbsp;Effects&nbsp;</b>
                <fieldset class="repeating_threads">
                  <span class="sheet-fixed-width sheet-txtMedplus " title="@{repeating_threads_X_TI_Name}:   Name of Item, Person, or Group thread is attached to.">
                    <input name="attr_TI_Name" type="text" class="sheet-text-left sheet-txtMedplus sheet-LockIfNotEditMode"  placeholder="Item" >
                  </span>
                  <span class="sheet-fixed-width sheet-numShort" title="@{repeating_threads_X_TI_Rank}:   Rank of thread attached to Thread Item.">
                    <input name="attr_TI_Rank" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners" >
                  </span>
                  <span class="sheet-fixed-width sheet-selLong" title="@{repeating_threads_X_TI_Type}  What LP cost progression tier does this Thread Item use.">
                    <select name="attr_TI_Type" class="sheet-LockIfNotEditMode sheet-selLong">
                      <option value="Novice" selected title="This item has a Novice cost progression meaning it costs as much to advance the thread rank as it does to advance a Novice Talent.">Novice</option>
                      <option value="Journeyman" title="This item has a Journeyman cost progression meaning it costs as much to advance the thread rank as it does to advance a Journeyman Talent." >Journeyman</option>
                      <option value="Warden"     title="This item has a Warden cost progression meaning it costs as much to advance the thread rank as it does to advance a Warden Talent." >Warden</option>
                      <option value="Master"     title="This item has a Master cost progression meaning it costs as much to advance the thread rank as it does to advance a Master Talent." >Master</option>
                      <option value="Free"       title="This item does not cost LP to advance.">Free</option>
                      <option value="Special"    title="This item has LP costs that are special for some reason.">Special</option>
                      <option value="Dummy"      title="This is not really a standard Thread Item in and of itself, it is a placeholder for a something else.">Dummy</option>
                    </select>
                  </span>
                  <input type="checkbox" name="attr_TI_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                  <span class="sheet-fixed-width sheet-txtLong" >
                    <input type="text" name="attr_TI_Effects" placeholder="Effect"  class="sheet-txtLong sheet-LockIfNotEditMode" title="@{repeating_threads_X_TI_Effects}:   Thread Effects." >
                  </span>
                  <label title="@{repeating_threads_X_TI_ShowNotes}   Show or Hide the details of item">
                    <input type="checkbox" name="attr_TI_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes">
                    </span>
                  </label>
                  <input name="attr_TI_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                  <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked sheet-HideIfNotEditMode" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                  <input name="attr_TI_LinksProvideValue_max" type="hidden" value="">

                        <!--JBF@CD : Start of optional Thread Item Development-->
                  <div class="sheet-nowrap sheet-HideIfNotChecked" title="@{repeating_threads_X_TI_RankKnown}:   Number of Ranks discovered via Item History including power and Test Knowledges.">
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-nowrap sheet-label" >Ranks known (Item History) : </span>
                    <span class="sheet-nowrap" >
                      <input name="attr_TI_RankKnown" type="number" value="0" min="0" max="15" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners" >
                    </span>
                  </div>

                  <input name="attr_TI_RankKnown" type="hidden" value="0" class="sheet-testNum" >
                  <input name="attr_TI_Rank" type="hidden" value="0" class="sheet-testNum2" >

                  <div class="sheet-HideIfNotChecked sheet-HideIfLessThan1">
                    <div>
                      <span class="sheet-fixed-width sheet-numShorter" >
                      </span>
                      <b class="sheet-heading sheet-fixed-width sheet-numShorter sheet-text-center sheet-titlespan">#</b>
                      <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan">Key/Test Knowledge</b>
                      <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Done</b>
                      <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan">Rank Effect</b>
                      <br>
                    </div>

                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                    <div>
                      <span class="sheet-fixed-width sheet-numShorter">
                        <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf1"></span>
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">1-</span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank1TestKnowledge} - Test Knowledge for this Rank">
                        <input name="attr_TI_Rank1TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank1KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                        <input name="attr_TI_Rank1KeyKnowledgeComplete" type="checkbox" value="1">
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank1Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                        <input name="attr_TI_Rank1Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                      </span>
                    </div>
                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                    <div class="sheet-HideIfLessThan2">
                      <span class="sheet-fixed-width sheet-numShorter">
                        <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf2"></span>
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">2-</span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank2TestKnowledge} - Test Knowledge for this Rank">
                        <input name="attr_TI_Rank2TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank2KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                        <input name="attr_TI_Rank2KeyKnowledgeComplete" type="checkbox" value="2">
                      </span>
                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank2Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                        <input name="attr_TI_Rank2Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                      </span>
                      <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                      <div class="sheet-HideIfLessThan3">
                        <span class="sheet-fixed-width sheet-numShorter">
                          <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf3"></span>
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">3-</span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank3TestKnowledge} - Test Knowledge for this Rank">
                          <input name="attr_TI_Rank3TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank3KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                          <input name="attr_TI_Rank3KeyKnowledgeComplete" type="checkbox" value="3">
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank3Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                          <input name="attr_TI_Rank3Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                        </span>
                        <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                        <div class="sheet-HideIfLessThan4">
                          <span class="sheet-fixed-width sheet-numShorter">
                            <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf4"></span>
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">4-</span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank4TestKnowledge} - Test Knowledge for this Rank">
                            <input name="attr_TI_Rank4TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank4KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                            <input name="attr_TI_Rank4KeyKnowledgeComplete" type="checkbox" value="4">
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank4Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                            <input name="attr_TI_Rank4Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                          </span>
                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                          <div class="sheet-HideIfLessThan5">
                            <span class="sheet-fixed-width sheet-numShorter">
                              <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf5"></span>
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">5-</span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank5TestKnowledge} - Test Knowledge for this Rank">
                              <input name="attr_TI_Rank5TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank5KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                              <input name="attr_TI_Rank5KeyKnowledgeComplete" type="checkbox" value="5">
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank5Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                              <input name="attr_TI_Rank5Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                            </span>
                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                            <div class="sheet-HideIfLessThan6">
                              <span class="sheet-fixed-width sheet-numShorter">
                                <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf6"></span>
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">6-</span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank6TestKnowledge} - Test Knowledge for this Rank">
                                <input name="attr_TI_Rank6TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank6KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                <input name="attr_TI_Rank6KeyKnowledgeComplete" type="checkbox" value="6">
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank6Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                <input name="attr_TI_Rank6Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                              </span>
                              <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                              <div class="sheet-HideIfLessThan7">
                                <span class="sheet-fixed-width sheet-numShorter">
                                  <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf7"></span>
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">7-</span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank7TestKnowledge} - Test Knowledge for this Rank">
                                  <input name="attr_TI_Rank7TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank7KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                  <input name="attr_TI_Rank7KeyKnowledgeComplete" type="checkbox" value="7">
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank7Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                  <input name="attr_TI_Rank7Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                </span>
                                <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                <div class="sheet-HideIfLessThan8">
                                  <span class="sheet-fixed-width sheet-numShorter">
                                    <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf8"></span>
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">8-</span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank8TestKnowledge} - Test Knowledge for this Rank">
                                    <input name="attr_TI_Rank8TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank8KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                    <input name="attr_TI_Rank8KeyKnowledgeComplete" type="checkbox" value="8">
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank8Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                    <input name="attr_TI_Rank8Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                  </span>
                                  <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                  <div class="sheet-HideIfLessThan9">
                                    <span class="sheet-fixed-width sheet-numShorter">
                                      <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf9"></span>
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">9-</span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank9TestKnowledge} - Test Knowledge for this Rank">
                                      <input name="attr_TI_Rank9TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank9KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                      <input name="attr_TI_Rank9KeyKnowledgeComplete" type="checkbox" value="9">
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank9Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                      <input name="attr_TI_Rank9Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                    </span>
                                    <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                    <div class="sheet-HideIfLessThan10">
                                      <span class="sheet-fixed-width sheet-numShorter">
                                        <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf10"></span>
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">10-</span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank10TestKnowledge} - Test Knowledge for this Rank">
                                        <input name="attr_TI_Rank10TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank10KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                        <input name="attr_TI_Rank10KeyKnowledgeComplete" type="checkbox" value="10">
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank10Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                        <input name="attr_TI_Rank10Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                      </span>
                                      <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                      <div class="sheet-HideIfLessThan11">
                                        <span class="sheet-fixed-width sheet-numShorter">
                                          <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf11"></span>
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">11-</span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank11TestKnowledge} - Test Knowledge for this Rank">
                                          <input name="attr_TI_Rank11TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank11KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                          <input name="attr_TI_Rank11KeyKnowledgeComplete" type="checkbox" value="11">
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank11Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                          <input name="attr_TI_Rank11Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                        </span>
                                        <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                        <div class="sheet-HideIfLessThan12">
                                          <span class="sheet-fixed-width sheet-numShorter">
                                            <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf12"></span>
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">12-</span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank12TestKnowledge} - Test Knowledge for this Rank">
                                            <input name="attr_TI_Rank12TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank12KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                            <input name="attr_TI_Rank12KeyKnowledgeComplete" type="checkbox" value="12">
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank12Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                            <input name="attr_TI_Rank12Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                          </span>
                                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                          <div class="sheet-HideIfLessThan13">
                                            <span class="sheet-fixed-width sheet-numShorter">
                                              <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf13"></span>
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">13-</span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank13TestKnowledge} - Test Knowledge for this Rank">
                                              <input name="attr_TI_Rank13TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank13KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                              <input name="attr_TI_Rank13KeyKnowledgeComplete" type="checkbox" value="13">
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank13Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                              <input name="attr_TI_Rank13Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                            </span>
                                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                            <div class="sheet-HideIfLessThan14">
                                              <span class="sheet-fixed-width sheet-numShorter">
                                                <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf14"></span>
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">14-</span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank14TestKnowledge} - Test Knowledge for this Rank">
                                                <input name="attr_TI_Rank14TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank14KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                                <input name="attr_TI_Rank14KeyKnowledgeComplete" type="checkbox" value="14">
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank14Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                                <input name="attr_TI_Rank14Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                              </span>
                                              <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                              <div class="sheet-HideIfLessThan15">
                                                <span class="sheet-fixed-width sheet-numShorter">
                                                  <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf15"></span>
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">15-</span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank15TestKnowledge} - Test Knowledge for this Rank">
                                                  <input name="attr_TI_Rank15TestKnowledge" type="text" value="" class=" sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank15KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                                  <input name="attr_TI_Rank15KeyKnowledgeComplete" type="checkbox" value="15">
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank15Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                                  <input name="attr_TI_Rank15Effect" type="text" value="" class="sheet-text-left sheet-txtLong sheet-LockIfNotEditMode" >
                                                </span>
                                              </div>
                                              <!--End Rank-->
                                            </div>
                                            <!--End Rank-->
                                          </div>
                                          <!--End Rank-->
                                        </div>
                                        <!--End Rank-->
                                      </div>
                                      <!--End Rank-->
                                    </div>
                                    <!--End Rank-->
                                  </div>
                                  <!--End Rank-->
                                </div>
                                <!--End Rank-->
                              </div>
                              <!--End Rank-->
                            </div>
                            <!--End Rank-->
                          </div>
                          <!--End Rank-->
                        </div>
                        <!--End Rank-->
                      </div>
                      <!--End Rank-->
                    </div>
                    <!--End Rank-->
                  </div>
                  <!--JBF@CD End of optional Thread Item development-->
                  <textarea name="attr_TI_Description" class="sheet-details sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_threads_X_TI_Description}:   Thread Item Description." ></textarea>
                </fieldset>
              </div>    <!-- end Equipment - Right Pane - Thread Items -->

                    <!--Equipment - Right Pane - Blood Magic-->
              <input type="checkbox" name="attr_show_blood" value="1" class="sheet-testCloseChecked sheet-hidden">
              <div class="sheet-HideIfNotCloseChecked">
                <div class="sheet-headerbar sheet-headerbar-flex">
                  <div></div>
                  Blood Magic : <input name="attr_Damage-Blood" readonly style="color:white;" type="number" value="0" min="0" class="sheet-numShort sheet-fancyfont" title="@{Damage-Blood}:  Blood Magic damage.">
                  <div class="sheet-floatRight">
                    <label title="@{attr_blood-edit-mode} : Toggles the edit mode .">
                      <input type="checkbox" name="attr_blood-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                    </label>
                  </div>
                </div>
                <div class="sheet-content">
                  <input type="checkbox" name="attr_blood-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                  <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">&nbsp;Items&nbsp;</b>&nbsp;&nbsp;&nbsp;
                  <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center">&nbsp;Dmg&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  <b class="sheet-heading sheet-fixed-width sheet-txtEvenLonger sheet-text-center">&nbsp;Effects&nbsp;</b>
                  <fieldset class="repeating_blood">
                    <input name="attr_BL_RowID" type="text" class="sheet-hidden">
                    <span class="sheet-nowrap">
                      <input name="attr_BL_Name" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Name}:   Name of Blood Charm." placeholder="Item" >
                    </span>
                  <span class="sheet-nowrap">
                    <input name="attr_BL_Damage-Blood-Magic" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Damage-Blood-Magic}:   Number of Blood Damage" ></span>
                    <input type="checkbox" name="attr_BL_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                    <span class="sheet-nowrap sheet-fixed-width sheet-txtEvenLonger" style="height:25px; vertical-align:middle;">
                      <textarea name="attr_BL_Effects" class="sheet-details-oneline sheet-bordered-bottom sheet-txtEvenLonger sheet-HideIfChecked" title="@{repeating_blood_X_BL_Effects}:   Charm Effects." ></textarea>
                    </span>
                    <label title="@{repeating_blood_X_BL_ShowNotes}   Show or Hide the details of item">
                      <input type="checkbox" checked="checked" name="attr_BL_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <textarea name="attr_BL_Effects" class="sheet-details sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Effects}:   Charm Effects." ></textarea>
                  </fieldset>
                </div>
              </div>

                    <!-- Equipment - Right Pane - Mounts -->
              <input type="checkbox" name="attr_show_mounts" value="1" class="sheet-testCloseChecked sheet-hidden">
              <div class="sheet-HideIfNotCloseChecked">
                <div class="sheet-headerbar sheet-headerbar-flex"><div></div>Mounts and other Animals
                  <div class="sheet-floatRight">
                    <label title="@{attr_mount-edit-mode} : Toggles the edit mode .">
                      <input type="checkbox" name="attr_mount-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                    </label>
                  </div>
                </div>
                <div class="sheet-content">
                  <input type="checkbox" name="attr_mount-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                  <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">Name</b>
                  <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">Animal</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Speed</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Carry</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Feed</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Stable</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Weight</b>
                  <fieldset class="repeating_mount">
                    <input name="attr_MNT_RowID" type="text" class="sheet-hidden">
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_NickName" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_NickName}:   Nickname of Mount or Animal." placeholder="Nickname" >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Name" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Name}:   Type of Mount or Animal." placeholder="Type" >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Speed" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Speed}:   Speed of Mount or Animal." >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Carry" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Carry}:   How much can the Mount or Animal carry." >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Feed" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Feed}:   How much does it cost to feed the Animal per day." >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Stable" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Stable}:   How much does it usually cost to stable the Mount or Animal." >
                    </span>
                    <span class="sheet-nowrap0">
                      <input name="attr_MNT_Weight" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Weight}:   Weight." >
                    </span>
                  </fieldset>
                </div>
              </div>    <!-- end Equipment - Right Pane - Mounts -->

                    <!--Equipment - Right Pane - LifeStyle-->
              <input type="checkbox" name="attr_show_lifestyle" value="1" class="sheet-testCloseChecked sheet-hidden">
              <div class="sheet-HideIfNotCloseChecked">
                <span class="sheet-nowrap sheet-hidden">Equipment Weight:
                  <input name="attr_Weight-Mod" type="number" value="0" min="0" class="sheet-selShort" title="@{Weight-Mod}:   Approximate weight of all carried equipment listed on Equipment tab that does not have a seperate weight field.">
                  <input name="attr_Weight-Equipment" type="number" readonly class="sheet-selShort"
                  title="@{Weight-Equipment}:   Approximate weight of all equipment listed on this tab." value="0" >
                </span>
                <div class="sheet-headerbar"> Lifestyle</div>
                <span class="sheet-nowrap sheet-label" title="@{Lifestyle}  (House Rule) What Lifestyle does the character maintain. Part of your lifestyle is spent in cleaning/maintaining/repairing/replacing your possessions when they wear out.">Lifestyle
                  <select name="attr_Lifestyle" style="width:12em;">
                    <option value="Cash" selected title="Character does not use lifestyle rules and pays cash for everything.">Cash</option>
                    <option value="Destitute" title="A destitute character must track every purchase, and may need to resort to Survival checks or theft to feed himself. Most of your gear and equipment needs to be replaced after 6 months due to mold, mildew, rust, and lack of basic maintenance." >Destitute</option>
                    <option value="Squalid" title="5sp per month - Squalid. Minimum needed to avoid survival checks. You are homeless, having at most a nook, cave, or burrow. You suffer interaction penalties in social situations. Much of your gear and equipment needs to be replaced after 6 months due to mold, mildew, rust, and lack of basic maintenance.">Squalid - 5 sp/month</option>
                    <option value="Poor" title="25sp per month - Poor. You sleep on the floor of a flophouse. You buy your clothes secondhand. Meat is a luxury. You usually drink water that you fetch yourself, splurging on ale only two or three times a month. You have no funds for nonessential expenses.  All your gear and equipment is maintained in poor condition and a random piece must be lost/replaced monthly.">Poor - 25 sp/month</option>
                    <option value="Lower-Class" title="50sp per month - Lower-Class. Your bed is a straw tick or a frame with a rope net, your room has no lock. You eat sausage or fried meat with ale every three days, and you can afford warm clothes. You get a full bath monthly and wash every week. You have very little funds for discretionary expenses. Some of your gear and equipment is in poor condition and a random piecer must be replaced quarterly.">Lower-Class - 50 sp/month</option>
                    <option value="Middle-Class" title="75sp per Month - Middle-Class. You have a room with a bed, and you can bar the door when you're there. You eat meat or fish every day and drink ale or wine instead of water. Your clothes may be plain, but you bought them new, and you get a bath every week. You have modest funds to engage in discretionary expenses, vices, and hobbies. Your basic and standard gear and mount are kept in good condition.">Middle-Class - 75 sp/month</option>
                    <option value="Wealthy" title="250sp per month - Wealthy. You eat vegetables and either lean meat or fine fish every day. You drink good wine and ale. You probably have at least one servant">Wealthy - 250 sp/month</option>
                    <option value="Very Wealthy" title="1000sp per month - Very Wealthy. Your home is large and has magic locks on the doors, and you have at least several servants. You own a very fine mount and/or a coach. You wear quite a bit of distinctive or enchanted clothing, some of which is very luxurious, and about four times a month, you indulge in a sumptuous, nine-course feast.">Very Wealthy - 1000 sp/month</option>
                    <option value="Filthy Rich" title="5000sp per month or more - Filthy Rich. Your home is very large and abounds with magical amenities: heat stones, light crystals, massaging baths, as well as a staff and a stable. Unless otherwise noted, your clothing is distinctive and enchanted, and often luxurious. You enjoy sumptuous feasts every three days or so.">Filthy Rich - 5000+ sp/month</option>
                    <option value="Adept" title="50sp/circle/month. This is the lifestyle of a 'typical' adept of your circle. You never run out of basic supplies and all your gear and (common) animals are kept in very good condition. Your living conditions improve to the level that you are spending. IE: at 4th circle, you are maintaining a lifestyle that is just short of wealthy. ">Adept - 50 sp/circle/month</option>
                    <!-- Note: Barsiave boxed set gives comfortable at 150/circle/month and Wealthy at 300/circle/month    -->
                  </select>
                </span>
                <span class="sheet-nowrap sheet-label" title="@{Lifestyle-Adjust}:   Monthly adjustment to lifestyle for extra or exotic mounts, animals, and other extraordinary repeating expenses not normally covered by your lifestyle.">LS Adjust:
                  <input name="attr_Lifestyle-Adjust" type="number" Value="0" class="sheet-selShort">
                </span>
                <span class="sheet-nowrap sheet-label" title="@{Lifestyle-Prepaid}:   Date through which the lifestyle is prepaid, or alternativly a running total of the number of days you have prepaid.">Prepaid Through:
                  <input name="attr_Lifestyle-Prepaid" type="text" class="sheet-txtShort" placeholder = "yyyy/mm/dd">
                </span>
              </div>    <!-- end Equipment - Right Pane - LifeStyle -->
            </div>    <!-- end of right pane inventory -->
          </div>
        </div>    <!-- ********************************** End of Section Equipment  ****************************-->



              <!-- ***************************************** Mini Section for Miscellaneous*************************************  -->
        <div class="sheet-section sheet-section-core sheet-w100p">
          <div class="sheet-headerbar sheet-NotCreation"> Miscellaneous </div>
                <!--Misc - Racial-->
          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">6-</b> Racial Abilities </div>
          <div class="sheet-Creation sheet-text-center"> Automatically Determined by your Race. </div>
          <div class="sheet-content sheet-HideIfCreature sheet-HideIfNotOverview">
            <span class="sheet-autoexpand-wrap" title="@{RacialAbilities}  Racial Abilities.">
              <input name="attr_RacialAbilities" class="sheet-text-left"
              placeholder="Racial Abilities"
              type="text" readonly>
              <span name="attr_RacialAbilities" class="sheet-autoexpand">
              </span>
            </span>
            <br>
            <textarea name="attr_Karma-Ability" readonly class="sheet-details-small"  title="@{Karma-Ability : Automatically Lists all Karma Ability as per your Discipline (at this stage doesn't include Questor or Path)}">
          </div>
                <!--Misc - Maneuvers-->
          <div class="sheet-content sheet-HideIfNotCreature">
            <div>
              <b class="sheet-heading">Creature & Opponent Maneuvers : </b>
            </div>
            <div>
              <input name="attr_Creature-HardenedArmor" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-HardenedArmor}   Hardened Armor: Bonus damage resulting from additional successes on Attack tests is reduced by one per success. Typically, this means that instead of +2 damage per additional success, the attacker only gets +1 damage per additional success">
                Hardened Armor
              </span>
              <input name="attr_Creature-GrabAndBite" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-GrabAndBite}   Grab and Bite: The creature may spend an additional success from an Attack test to automatically grapple an opponent. Grappled opponents automatically take bite damage each round until the grapple is broken.">
                Grab and Bite
              </span>
              <input name="attr_Creature-Hamstring" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Hamstring}   Hamstring: The creature may spend an additional success from an Attack test to halve the opponents Movement until the end of the next round. If the attack causes a Wound, the penalty lasts until the Wound is healed.">
                Hamstring
              </span>
              <input name="attr_Creature-Overrun" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Overrun}   Overrun: The creature may spend an additional success from an Attack test to force an opponent with a lower Strength Step to make a Knockdown test against a DN equal to the Attack test result.">
                Overrun
              </span>
              <input name="attr_Creature-Pounce" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Pounce}   Pounce: If the creature reaches its opponent with a leap and the opponent isnt too much larger, the creature may spend an additional success from the Attack test to force the opponent to make a Knockdown test against a DN equal to the Attack test result.">
                Pounce
              </span>
              <input name="attr_Creature-SqueezeTheLife" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap3 sheet-HideIfNotCloseChecked" title="@{Creature-SqueezeTheLife}   Squeeze the Life: The creature may spend two additional successes from an Attack test to automatically grapple an opponent. Grappled opponents automatically take claw damage each round until the grapple is broken">
                Squeeze the Life
              </span>
              <input name="attr_Creature-Fury" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Fury}   Fury threshold - If non-zero, instead of suffering penalties, Wounds grant this creature a bonus to tests. Once the creature has more Wounds than indicated by the Step of this ability, the bonuses are lost and the creature suffers normal penalties for Wounds.">
                Fury <input name="attr_Creature-Fury" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-ResistPain" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-ResistPain}   Resist Pain threshold - If non-zero, the creature ignores penalties for Wounds equal to this ability. For example, a creature with Resist Pain (2) ignores the penalties from the first two Wounds suffered.">
                Resist Pain <input name="attr_Creature-ResistPain" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-Willful" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Willful}   Willful threshold - If non-zero, Talents and abilities used to dominate, control, tame or train the creature require additional successes equal to the Step of this ability.">
                Willful <input name="attr_Creature-Willful" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-Ambush" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Ambush}   If the 'Ambushing' status is ON, this is the amount that is added to Initiative, Attack, and Damage.">
                <span class="sheet-iconstatic sheet-icon-ambush"></span> Ambush <input name="attr_Creature-Ambush" type="number" value="0" min="0" readonly >
              </span>
              <input name="attr_Creature-DiveCharge"  type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-DiveCharge}   If the 'Diving/Charging' box is checked, this is the amount that is added to Attack, and Damage. Use this for ether Diving or Charging creature powers.">
                <span class="sheet-iconstatic sheet-icon-charging"></span>Dive/Charge <input name="attr_Creature-DiveCharge" type="number" value="0" min="0" readonly>
              </span>
            </div>
            <div>
              <input name="attr_Opponent-ClipTheWing" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-ClipTheWing}   Clip the Wing: The attacker may spend two additional successes from an Attack test to remove the creatures ability to fly until the end of the next round. If the attack causes a Wound, the creature cannot fly until the Wound is healed. If the creature is in flight, it falls and suffers falling damage for half the distance fallen.">
                Clip the Wing
              </span>
              <input name="attr_Opponent-CrackTheShell" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-CrackTheShell}   Crack the Shell: The attacker may spend extra successes from physical attacks (not spells) to reduce the creatures Physical Armor by 1 per success spent. This reduction takes place after damage is assessed, and lasts until the end of combat.">
                Crack the Shell
              </span>
              <input name="attr_Opponent-Defang" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Defang}   Defang: The opponent may spend additional successes to affect the creatures ability to use its poison. Each success spent reduces the Poisons Step by 2. If the attack causes a Wound, the creature cannot use its Poison power at all until the Wound is healed">
                Defang
              </span>
              <input name="attr_Opponent-Enrage" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Enrage}   Enrage: An opponent may spend additional successes from an Attack test to give a -1 penalty to the creatures Attack tests and Physical Defense until the end of the next round. Multiple successes may be spent for a cumulative effect.">
                Enrage
              </span>
              <input name="attr_Opponent-Provoke" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Provoke}   Provoke: The attacker may spend two additional successes from an Attack test to enrage the creature and guarantee he will be the sole target of the creatures next set of attacks. Only the most recent application of this maneuver has any effect.">
                Provoke
              </span>
              <input name="Opponent-PryLoose" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap3 sheet-HideIfNotCloseChecked" title="@{Opponent-PryLoose}   Pry Loose: The attacker may spend additional successes from an Attack test to allow a grappled ally to immediately make an escape attempt with a +2 bonus per success spent on this maneuver">
                Pry Loose
              </span>
            </div>
            <input value="1" class="sheet-hidden sheet-testRepEditMode" type="checkbox">
            <fieldset class="repeating_maneuvers">
              <div>
                <input name="attr_MAN_RowID" type="text" class="sheet-hidden">
                <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-testChecked sheet-hidden">
                <span class="sheet-nowrap0" >
                  <label class="sheet-HideIfNotChecked" >
                    <!-- Man_Type : 1 - CREATURE
                                    -1 - Opponent
                                    Don't get mixed up : The checkboxes are "inverted" because clicking on the checkbox will put the appropriate value in MAN_Type -->

                    <input type="checkbox" name="attr_MAN_Type" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-creature" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                  </label>
                  <label class="sheet-HideIfChecked">
                    <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-opponent" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                  </label>
                </span>
                <span class="sheet-fixed-width sheet-titlespan sheet-txtLong sheet-bordered-bottom">
                  <input name="attr_MAN_Name" type="text" class="sheet-fixed-width sheet-txtLong" placeholder="name" title="@{repeating_maneuvers_MAN_Name} Use these fields to specify a custom Maneuvers (Opponent or Creature). ">
                </span>
                <label title="@{repeating_maneuvers_X_MAN_ShowNotes}   Show description of Maneuver">
                  <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                </label>
                <label class="sheet-HideIfChecked" title="@{repeating_maneuvers_MAN_Show} Use these field to hide/show Opponent maneuvers. It will not be offered up to the user as a way to spend extra successes unless the 'Show' field is checked. This allows the GM to get the opponent maneuvers all setup but not let the players see them until they have passed a knowledge test.">
                  <input type="checkbox" name="attr_MAN_Show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-maneuver-show"></span>
                </label>
              </div>
              <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
              <div class="sheet-HideIfNotChecked">
                <textarea name="attr_MAN_Desc" class="sheet-details-small" title="@{repeating_maneuvers_MAN_Desc} Use these fields to specify a custom Maneuvers (Opponent or Creature). A text description of the maneuver." placeholder="Description of the Maneuver and how it works."></textarea>
              </div>
            </fieldset>
          </div>    <!-- end Misc - Maneuvers -->

                <!--Misc - Creation Equip-->
          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">7-</b> Equip Your Character </div>
          <div class="sheet-Creation sheet-text-center"> Basic Equipment and silver as per the Player Guide p72 has been initialized in the Equipment tab. Don't forget to pick Artisan's kit per your artisan skill</div>
          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">8-</b> Flesh Out your character </div>
          <div class="sheet-Creation sheet-text-center"> Describe how he looks, and his personally traits</div>
                <!-- Misc - Movement & Misc Pools-->
          <input type="checkbox" name="attr_show_overview_miscpool" class="sheet-hidden sheet-testCloseChecked" value="1">
          <div class="sheet-content sheet-flex-container sheet-NotCreation sheet-HideIfNotCloseChecked">
                  <!--Misc -Movement-->
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="@{Movement}:   Current Movement Rate. If conditions would lower it less than one, value is set to '1*'">
              <div class="sheet-headerbar" >Movement</div>
              <div>
                <span class="sheet-stepSpan sheet-bordered-bottom">
                  <span title="@{Movement-Mod-Auto}: Automatic Adjustments to Movement.">
                    <input name="attr_Movement-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                    <input name="attr_Movement-Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                  </span>
                  <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-hidden sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked">
                    <input name="attr_Fly-Movement-Base" readonly value="0" class="sheet-StepBig sheet-StepBase" title="@{Fly-Movement-Base}:   Permanent Flying Movement Rate from Race and permanent Adjustments."  type="number">
                    <input name="attr_Fly-Movement" readonly value="0" class="sheet-StepBig sheet-StepTotal" title="@{Fly-Movement}: Current Flying Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                  </span>
                  <span class="sheet-HideIfNotCloseChecked">
                    <input name="attr_Movement-Base" readonly class="sheet-StepBig sheet-StepBase" title="@{Movement-Base}:   Permanent Movement Rate from Race and permanent Adjustments."  type="number">
                    <input name="attr_Movement" readonly class="sheet-StepBig sheet-StepTotal" title="@{Movement}:    Current Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                  </span>
                  <span title="@{Movement-Buff}   Buffs or other temporary modifications to Movement Rating.">
                    <input name="attr_Movement-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Movement-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
              <div>
                <input name="attr_Flight" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                <label class="sheet-iconlabel2 sheet-HideIfNotCloseChecked" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
                  <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-invert sheet-icon-flying"></span>
                </label>
                <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
                  <input type="checkbox" name="attr_condition-ImpairedMovement" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired"></span>
                </label>
                <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Heavy Impaired Movement : -10 to Movement Rate (1 min). -4 Penalty to movement based texts due to footing, cramping, or vision impairments. Dex test to avoid tripping or halting.">
                  <input type="checkbox" name="attr_condition-ImpairedMovement" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired4"></span>
                </label>
              </div>
            </div>
            <input name="attr_condition-Flying" type="checkbox" value="-1" checked class="sheet-hidden sheet-testCloseChecked" >
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-HideIfCloseChecked">
              <div class="sheet-headerbar" >Flying Alt.      </div>
              <div>
                <input name="attr_condition-Flying" type="number" value="0" min="0" max="9" class="sheet-Big sheet-HideSpinners sheet-bordered-bottom" title="@{condition-Flying}:   Altitude at which the character is flying (as displayed in Token). This is between 0 and 9 because it is what the Token Marker can show. Discuss units with your GM." >
              </div>
              <div style="padding-bottom:6px">
                &nbsp;
              </div>
            </div>

                  <!--Misc - Shield-->
            <input name="attr_Shield-Name" class="sheet-hidden sheet-testPlaceholder" type="text" placeholder="Shield type">
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-hideIfPlaceholder sheet-HideIfNotCombat sheet-HideIfPrint">
              <input type="checkbox" name="attr_condition-NoShield" value="1" class="sheet-testChecked sheet-hidden">
              <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-testChecked sheet-hidden">
              <span class="sheet-iconstatic sheet-icon-shield sheet-HideIfChecked"></span>
              <span class="sheet-iconstatic sheet-icon-noshield sheet-hidden sheet-UnHideIfChecked"></span>
              <div>
                <span class="sheet-iconstatic sheet-icon-PD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-PA sheet-HideIfEdition4"></span>
                <span class="sheet-stepSpan">
                  <input name="attr_Shield-Phys" type="number" value="0" class="sheet-StepBig" readonly title="@{Shield-Phys}:   Physical protection shield provides.">
                  <span title="@{Shield-Phys-Buff}   Buff or other temporary modification to PD (ED3 PA) specifically associated with their shield, and that they lose when Blindsided.">
                    <input name="attr_Shield-Phys-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Shield-Phys-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
              <div>
                <span class="sheet-iconstatic sheet-icon-MD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-MA sheet-HideIfEdition4"></span>
                <span class="sheet-stepSpan">
                  <input name="attr_Shield-Myst" type="number" value="0" class="sheet-StepBig" readonly title="@
                  {Shield-Myst}:   Mystic protection shield provides.">
                  <span title="@{Shield-Myst-Buff}   Buff or other temporary modification to MD (ED3 MA) specifically associated with their shield, and that they lose when Blindsided.">
                    <input name="attr_Shield-Myst-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Shield-Myst-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
            </div>
                  <!--Misc - Misc-Pools-->
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-1" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-1}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-1" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-1}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-1" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-1}:   You can use this number to keep track of anything you want." >
              </div>
            </div>

            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-2" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-2}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-2" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-2}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-2" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-2}:   You can use this number to keep track of anything you want." >
              </div>
            </div>

            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-3" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-3}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-3" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-3}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-3" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-3}:   You can use this number to keep track of anything you want." >
              </div>
            </div>
          </div>    <!-- end Misc - Movement & Misc Pools-->
        </div>    <!--************************** End of Miscellaneous Section **********************-->

        <div class="sheet-section sheet-section-gear"></div>    <!--  End of Section Gear  -->



              <!-- ****************************** Start of Notes Section ******************************* -->
        <div class="sheet-section sheet-section-notes sheet-section-core sheet-section-combat">
                <!--Notes Header-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab9-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-attrib-view" value="1" class="sheet-iconcheckbox" ><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab9-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab9-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>  Notes <div></div>
          </div>
                <!-- Notes - Age and Stuff-->
          <div class="sheet-content sheet-HideIfCombat">
            <span class="sheet-label sheet-nowrap"> Age:&nbsp;
              <label title="@{Age}:   Characters Age.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Age" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Age" class="sheet-autoexpand">
                  </span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Sex:&nbsp;
              <label title="@{Sex}:   Characters Sex.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Sex" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Sex" class="sheet-autoexpand"></span>
                </span>
              </label>

              <label title="@{Height}:   Characters Height.">Height:&nbsp;
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Height" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Height" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Weight:&nbsp;
              <label title="@{Weight}:   Characters Weight.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Weight" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Weight" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Hair:&nbsp;
              <label title="@{Hair}:   Characters Hair color and style.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Hair" type="text" class="sheet-bordered-bottom"> <span name="attr_Hair" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Eyes:&nbsp;
              <label title="@{Eyes}:   Characters Eye color and shape.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Eyes" type="text" class="sheet-bordered-bottom"> <span name="attr_Eyes" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Skin:&nbsp;
              <label title="@{Skin}:   Characters Skin description.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Skin" type="text" class="sheet-bordered-bottom"> <span name="attr_Skin" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
                  <!-- Notes - Status -->
            <div class="sheet-HideIfNotPC sheet-NotCreation">
              <span class="sheet-label sheet-nowrap"> Lgd Status:&nbsp;
                <label title="@{LP-Status}:   Legendary Status level.">
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Status" value="LP up to 10,000" readonly="readonly"
                    type="text">
                    <span name="attr_LP-Status" class="sheet-autoexpand">
                    </span>
                  </span>
                </label>
              </span>
              <span class="sheet-label sheet-nowrap"> Renown:&nbsp;
                <label title="@{LP-Renown}:   Base Difficulty Number on knowledge tests to recognize name.">
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Renown" value="16" readonly="readonly" type="text">
                    <span name="attr_LP-Renown" class="sheet-autoexpand"></span>
                  </span>
                </label>
              </span>
              <span class="sheet-label sheet-nowrap"> Reputation:&nbsp;
                <label title="@{LP-Reputation}:   Bonus on some Interaction tests.">
                  <span
                    class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Reputation" value="NA" readonly="readonly" type="text">
                    <span name="attr_LP-Reputation" class="sheet-autoexpand">
                    </span>
                  </span>
                </label>
              </span>
            </div>
          </div>    <!-- end Notes - Age and Stuff-->

                <!--Notes - Personality-->
          <div class="sheet-HideIfCombat sheet-flex-container sheet-HideIfNotPC sheet-content"> <!--JBF@JBF to be put back in creation-->
            <datalist id="personality_traits">
              <option value="Aggressive"></option>
              <option value="Aloof"></option>
              <option value="Altruistic"></option>
              <option value="Ambitious"></option>
              <option value="Amoral"></option>
              <option value="Apprehensive"></option>
              <option value="Argumentative"></option>
              <option value="Astute"></option>
              <option value="Attentive"></option>
              <option value="Bloodthirsty"></option>
              <option value="Bold"></option>
              <option value="Charismatic"></option>
              <option value="Chivalrous"></option>
              <option value="Cold"></option>
              <option value="Compassionate"></option>
              <option value="Compassionless"></option>
              <option value="Condescending"></option>
              <option value="Confident"></option>
              <option value="Conniving"></option>
              <option value="Conservative"></option>
              <option value="Courageous"></option>
              <option value="Courteous"></option>
              <option value="Cowardly"></option>
              <option value="Creative"></option>
              <option value="Cruel"></option>
              <option value="Cunning"></option>
              <option value="Curious"></option>
              <option value="Cynical"></option>
              <option value="Depraved"></option>
              <option value="Dignified"></option>
              <option value="Disciplined"></option>
              <option value="Dishonest"></option>
              <option value="Drunkard"></option>
              <option value="Easy-going"></option>
              <option value="Eloquent"></option>
              <option value="Energetic"></option>
              <option value="Extroverted"></option>
              <option value="Fanatical"></option>
              <option value="Follower"></option>
              <option value="Forgiving"></option>
              <option value="Friendly"></option>
              <option value="Generous"></option>
              <option value="Good-humored"></option>
              <option value="Gracious"></option>
              <option value="Greedy"></option>
              <option value="Gullible"></option>
              <option value="Honorable"></option>
              <option value="Humorless"></option>
              <option value="Idealistic"></option>
              <option value="Immature"></option>
              <option value="Immoral"></option>
              <option value="Insightful"></option>
              <option value="Insulting"></option>
              <option value="Intellectual"></option>
              <option value="Intense"></option>
              <option value="Intimidating"></option>
              <option value="Intolerant"></option>
              <option value="Introverted"></option>
              <option value="Intuitive"></option>
              <option value="Irrational"></option>
              <option value="Jealous"></option>
              <option value="Judgmental"></option>
              <option value="Kind"></option>
              <option value="Lazy"></option>
              <option value="Liar"></option>
              <option value="Logical"></option>
              <option value="Loner"></option>
              <option value="Loyal"></option>
              <option value="Lustful"></option>
              <option value="Malcontent"></option>
              <option value="Manipulative"></option>
              <option value="Militant"></option>
              <option value="Miserly"></option>
              <option value="Mocking"></option>
              <option value="Moral"></option>
              <option value="Naive"></option>
              <option value="Obsessive"></option>
              <option value="Opinionated"></option>
              <option value="Optimistic"></option>
              <option value="Overbearing"></option>
              <option value="Paranoid"></option>
              <option value="Passionate"></option>
              <option value="Patient"></option>
              <option value="Persuasive"></option>
              <option value="Pragmatic"></option>
              <option value="Protective"></option>
              <option value="Proud"></option>
              <option value="Rational"></option>
              <option value="Reactionary"></option>
              <option value="Realistic"></option>
              <option value="Reasonable"></option>
              <option value="Rebellious"></option>
              <option value="Reserved"></option>
              <option value="Resourceful"></option>
              <option value="Rude"></option>
              <option value="Sadistic"></option>
              <option value="Sarcastic"></option>
              <option value="Selfish"></option>
              <option value="Sensitive"></option>
              <option value="Sentimental"></option>
              <option value="Shrewd"></option>
              <option value="Spontaneous"></option>
              <option value="Superstitious"></option>
              <option value="Suspicious"></option>
              <option value="Sympathetic"></option>
              <option value="Treacherous"></option>
              <option value="Vengeful"></option>
              <option value="Witty"></option>
            </datalist>
            <div>
              <b class="sheet-label"> Personality traits :</b>
            </div>
            <fieldset class="repeating_personality">
              <span class="sheet-nowrap">
                <input list="personality_traits" type="text" name="attr_PER_personality" class="sheet-txtShort sheet-bordered-bottom text-left" title="@{repeating_personality_X_T_traits}: Flesh Out your character by chosing (or definind your own) one or several personality traits to play upon. Consult ED4 PG p.74. Traits can be Hidden and Surface Traits. GM may award additional LP if you roleplay your traits.">
              </span>
            </fieldset>
          </div>

                <!--Notes - NPC Attitude-->
          <div class="sheet-HideIfPC">
            <b class="sheet-label"> Attitude :</b>
            <select name="attr_NPC_Attitude" class="sheet-txtMed" title="@{NPC_Attitude}   Attitude of the NPC towards the players">
              <option value="0.0" title="Enemy">Enemy</option>
              <option value="1.0" title="Hostile">Hostile</option>
              <option value="2.0" title="Unfriendly">Unfriendly </option>
              <option value="3.0" selected="selected" title="Neutral">Neutral </option>
              <option value="4.0" title="Friendly">Friendly</option>
              <option value="5.0" title="Loyal">Loyal</option>
              <option value="6.0" title="Awestruck">Awestruck</option>
            </select>
          </div>

                <!--Notes - Custom Notes-->
          <div class="sheet-HideIfOverview sheet-HideIfCombat"> <!--JBF@JBF to be managed for Creation-->
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center"> <!--sheet-background-frame6 sheet-frameBig deleted-->
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes_max" placeholder="Notes" type="text"></div>
              <div><textarea name="attr_general-notes" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"   placeholder="Your notes here. Customize the title (loot, bio, description, allies...). Also displayed in Overview and Combat Tab." title="@{general-notes} : Your notes here. Customize the title (loot, bio, description, allies...). Also displayed in Overview and Combat Tab."></textarea></div>
            </span>
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center">
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes-2_max" placeholder="Description" type="text" ></div>
              <div><textarea name="attr_general-notes-2" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"  placeholder="Your notes here. Customize the title (loot, bio, description, allies...)" title="@{general-notes-2} : Your notes here. Customize the title (loot, bio, description, allies...)."></textarea></div>
            </span>
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center">
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes-3_max" placeholder="General" type="text"></div>
              <div><textarea name="attr_general-notes-3" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"  placeholder="Your notes here. Customize the title (loot, bio, description, allies...)" title="@{general-notes-3} : Your notes here. Customize the title (loot, bio, description, allies...)."></textarea></div>
            </span>
          </div>

          <!--Notes -Copyright-->
          <div style="font-size: xx-small;" class="sheet-HideIfOverview sheet-HideIfCombat">
            <em>Earthdawn&reg; by FASA</em> Character sheet and associated API.<br>
            Earthdawn&reg; is the sole property of FASA Corporation, and is protected by copyright, trademark, and other intellectual property laws.
            You are granted a limited, revocable, non-sub-licensable right to access and use this character sheet and associated API solely for personal and non-commercial use.
            This character sheet is compatible with the Earthdawn&reg; game from FASA Games, Inc. and the Roll20 Earthdawn&reg; Compendium (Forthcoming).
            Any information copied into this character sheet maintains its original sources copyright, whether it was copied from the Compendium, or copied or typed in by the user, or by any other means.<br>
            Any use of FASA Games, Inc.s Intellectual Property other than as specifically authorized by FASA Games, Inc. is strictly prohibited and will terminate the rights granted herein.<br>
            Earthdawn&reg; is a registered trademark of FASA Corporation. Earthdawn&reg; and all associated trademarks, copyrights, and logos are used under license from FASA Corporation.  Copyright &copy; 1993-2020 FASA Corporation<br>
            Roll20 character sheet & API by Christopher D. Dickey and Jean-Baptiste Faure. Approved by FASA.
          </div>
        </div>    <!-- ***************** End of Section Notes *************** -->



              <!-- *************************************** Mini Section Notes for Overview ********************** -->
        <div class="sheet-section sheet-section-core sheet-section-combat sheet-w100p">
          <div class="sheet-nowrap0 sheet-w100p sheet-text-center sheet-HideIfPrint" >
            <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes_max" placeholder="General" type="text"></div>
            <div class=""><textarea name="attr_general-notes" class="sheet-text-left sheet-bordered sheet-content sheet-details"  title="@{general-notes} Your notes here. Customize the title (loot, bio, description, allies...)" placeholder="Notes 1"></textarea></div>
          </div>
          <div class="sheet-Creation sheet-headerbar sheet-api"> <b class="sheet-creation-order">9-</b> Link your Token </div>
          <div class="sheet-Creation sheet-text-center sheet-api">
            With the API, most of the functions of the sheet can be accessed directly from the Token on the map. Karma, Damage and Wounds appear as bars, status and options, and general modifiers appear as markers icons on the token, and your most common actions appear as Token Action buttons when the token is selected.
            In order for those functions to work properly, you need to link the character sheet with a token on the map, by selecting this token, and pressing the button below
            <br>
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="roll_TokenLink" type="roll"
            value="!Earthdawn~ charID: @{character_id}~ LinkToken: ?{Standard both sets the token to display in the standard way and links the token|Standard|SetTokenOnly|LinkOnly}"
            title="Clicking this button will Link this Character with the selected Token on the map."> Link Token</button>
          </div>
          <div class="sheet-Creation sheet-headerbar">
             <b class="sheet-creation-order sheet-NoAPI">9-</b>
             <b class="sheet-creation-order sheet-api">10-</b>
              Play the Game !
          </div>
          <div class="sheet-Creation sheet-text-center">
            If you created the character per the Rules, click here to exit creation and store the Free Ranks for Legend Point Tracking.
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_endcreation_post" type="action"
            title="act_endcreation_post:   Clicking this button will end the creation and set the Legend Points to 0."> Exit and Post</button>
            <br>
            Or Here if you just want to exit without saving the LP Offset (you will have to set it manually)
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_endcreation_nopost" type="action"
            title="act_endcreation_post:   Clicking this button will end the creation. It will not set the LP to 0, so you need to manually set the LP-CreationOffset in the Journal so that you start with the right amount of LP.">Exit No Post</button>
          </div>
        </div>    <!-- ************** End Mini Section ************** -->



              <!-- ****************************** Start of Section Record (renamed Legend) ********************************* -->
        <div class="sheet-section sheet-section-record">
                <!--Record - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex">
            <div>
              <label title="@{attr_tab10-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab10-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab10-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Legend
             <div>
              <label title="@{attr_legend-param-mode} : Toggles the view of parameters that affect the Legend Section.">
                <input type="checkbox" name="attr_legend-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <span class="sheet-info" title="Instructions: This section is for your Legend Points and Silver Pieces Journal. The sheet offers you 2 options to record the LP in your Journal. You can use one or the other or a combination of both. In the CALCULATED MODE, you only have to record your Career Legend Points @{LP-Total}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information. In the TRANSACTION MODE, your Career and Current points can be edited. The Current is stored in a separated @{LP-Current} field. You track your LP/SP by Posting transactions in your journal. Transaction can be a Legend Award at the end of an Adventure, or the cost of increasing a Talent Rank. The API will automatically propose you to post some of the transactions. Refer to the tooltip in the TRANSACTION MODE.">i</span>
            </div>
          </div>

                <!-- Record - Mode Selection -->
          <input type="checkbox" name="attr_legend-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
          <div class="sheet-HideIfNotCloseChecked sheet-bordered">
            <div class="sheet-text-centered"><b class="sheet-heading"> Legend Parameters</b></div>
            <span class="sheet-nowrap sheet-label">
              Display - Calculated Mode :
              <input type="checkbox" name="attr_legend-calc-mode" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
            </span>
            <span class="sheet-nowrap sheet-label">
              Transaction Mode :
              <input type="checkbox" name="attr_legend-transaction-mode" checked value="1" title="@{legend-transaction-mode} : Toggle to display TRANSACTION Mode LP Tracking. In the TRANSACTION MODE, your Career and Current points can be edited. The Current is stored in a separated @{LP-Current} field. You track your LP/SP by Posting transactions in your journal. Transaction can be a Legend Award at the end of an Adventure, or the cost of increasing a Talent Rank. The API will automatically propose you to post some of the transactions. Refer to the tooltip in the TRANSACTION MODE.">
            </span>
          </div>
          <div>
            <span class="sheet-nowrap" >
              <span class="sheet-iconstatic sheet-icon-coin-gold" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers"></span>:
              <input name="attr_Wealth_Gold"   type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers">
              <span class="sheet-iconstatic sheet-icon-coin-silver" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers"></span>:
              <input name="attr_Wealth_Silver" type="number" value="100" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers. New Characters start with 100.">
              <span class="sheet-iconstatic sheet-icon-coin-copper" title="@{Wealth_Copper}:   Number of Copper pieces owned."></span>:
              <input name="attr_Wealth_Copper" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Copper}:   Number of Copper pieces owned.">
            </span>
          </div>

                <!--Record - Calculated Mode-->
          <input type="checkbox" name="attr_legend-calc-mode" class="sheet-hidden sheet-testCloseChecked" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
          <div class="sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar"> Calculated Legend Point Tracking </div>
            <div class="sheet-content">
              <span class="sheet-nowrap1" title="@{LP-Total}:   Accumulated sum of all Legend Points ever earned."> <b class="sheet-label">Legend Points - Career :</b>
                <input name="attr_LP-Total" value="0" class="sheet-selLong" type="number">
              </span>
              <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
              <span class="sheet-HideIfNotCloseChecked">
                <span class="sheet-nowrap1" title="@{LP-CreationOffset}:  Free Legend Points for Creation, i.e. corresponding to the 8 Talents Ranks, 13 Skill Ranks and Free Spells Granted at Creation. Value should range somewhere between between 3000 and 6000 LP depending on initial spread of Ranks. An advice to quickly calculate the value, if you didn't spend any LP on skills, is to take the skills LP total from the checksum below and add 1000. You can also just set the value once to have your checksum correct, and then verify that the checksum remains correct">  <b class="sheet-label">+ Creation :</b>
                  <input name="attr_LP-CreationOffset" type="number" value="0" class="sheet-selShort"  >
                </span>
                <input name="attr_LP-SpellsOption" type="checkbox" value="1" checked class="sheet-hidden sheet-testCloseChecked">
                <span class="sheet-nowrap1 sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{LP-CreationOffset-Spells}:  Free Legend Points for Creation only for Free Spells Granted at Creation.">  <b class="sheet-label">+ Spells :</b>
                  <input name="attr_LP-CreationOffset-Spells" type="number" value="0" class="sheet-selShort"  >
                </span>
                <span class="sheet-nowrap1" title="@{LP-Calc}:  Automatically calculated LP Cost taking into account all the purchased ranks as per the rules.">
                  <b class="sheet-label">- Cost :</b>
                  <input name="attr_LP-Calc" type="number" value="0" readonly class="sheet-selShort"  >
                  <b class="sheet-label">=</b>
                </span>
              </span>
              <span class="sheet-nowrap1 sheet-label" title="@{LP-Current-Calc}: Automatically calculated total of all legend points taking into account all the purchased ranks as per the rules, current LPs, and offset for the creation. If you initialized the LP-Creation correctly, and always recorded your talents, this should always show your current career total">
                Current Calc :
                <input name="attr_LP-Current-Calc" type="number" value="0" class="sheet-selShort" readonly >
              </span>
              <label title="@{LP_ShowNotes}   Shows the details of the calculation of the LP-Summary-Value">
                <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
              </label>
              <span class="sheet-info" title="In the CALCULATED MODE, you only have to record your Career Legend Points @{LP-Total}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. If the character was created via a sheet of version 2.0 and later, at the end of the creation mode, the @{LP-CreationOffset} will be stored automatically. For a character that was not created at Circle 1 via the sheet, you can just set @{LP-CreationOffset} to get the Current LP that you have been tracking up to now. Note that even if using Calculated Mode, you could still use the transaction posting for your Legend Awards">i</span>
              <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
              <div class="sheet-HideIfNotCloseChecked">
                <div class="sheet-small">
                  The Calculated Mode needs to offset the calculation by the LP equivalent of the free Talents, Skills and Spells at creation. If the character has been imported from older version or if there has been an issue at creation, you may need to set manually the Offset. Click the following button to reset the Creation offset so that Current calculated value matches the Current value from Transaction modes. Note that for Spellcaster this will be dependant on the option for Spells Costs. Set the option first.
                </div>
                <div>
                <span class="sheet-nowrap1" title="@{LP-AttribOption}:  Toggle this value for Houserule where Attributes do not cost LP.">
                  <b class="sheet-label">Attributes
                  <select name="attr_LP-AttribOption" class="sheet-selShort">
                    <option value="1" selected title="Core Rule - Spells do cost LP"> do </option>
                    <option value="0" title="Homerule - Spells do not cost LP"> don't </option>
                  </select>
                    cost LP
                  </b>
                </span>
                <input name="attr_Hide-Spells-Tab" type="checkbox" value="1" checked class="sheet-hidden sheet-testCloseChecked">
                <span class="sheet-nowrap1 sheet-HideIfCloseChecked" title="@{LP-SpellsOption}:  Toggle this value for Houserule where Spells do not cost LP.">
                  <b class="sheet-label">Spells
                  <select name="attr_LP-SpellsOption" class="sheet-selShort">
                    <option value="1" selected title="Core Rule - Spells do cost LP"> do </option>
                    <option value="0" title="Homerule - Spells do not cost LP"> don't </option>
                  </select>
                    cost LP
                  </b>
                </span>
              </div>
              <div class="sheet-nowrap1">
                <b class="sheet-label">Extra Cost :
                <input name="attr_LP-Extra-Cost" type="number" class="sheet-numLong" value="0" title="@{LP-Extra-Cost}:  Manual Cost to the Automatic Calculation. Can be used in partical for an edge case not taken into account by the calculation : a Talent Option in a first discipline that becomes a Discipline Talent in a second, will free the talent option slot, and the costs for increasing this talent will become the one of the second discipline... The Automatic Calculation will calculate as if all rank had been bought as per declared Origin, so there may be need for manual offset to correct this case. ">

                </b>
              </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc">
                  <b class="sheet-label">2nd Discipline was started when lowest circle was
                  <input name="attr_LP-D2-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D2-Circle}:  Lowest Circle when the character joined a 2nd discipline. PG456">
                  </b><b class="sheet-label">and
                    <input name="attr_LP-D2-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D2-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">
                  <b class="sheet-label">3rd Discipline was started when lowest circle was
                  <input name="attr_LP-D3-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D3-Circle}:  Lowest Circle when the character joined a 3rd discipline. PG456">
                    </b><b class="sheet-label">and
                    <input name="attr_LP-D3-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D3-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">
                  <b class="sheet-label">4th Discipline was started when lowest circle was
                  <input name="attr_LP-D4-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D4-Circle}:  Lowest Circle when the character joined a 4th discipline. PG456">
                    </b><b class="sheet-label">and
                    <input name="attr_LP-D4-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D4-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <button class="sheet-text-button sheet-button-nodice sheet-hideIfPlaceholder" name="act_set_lp_offset" type="action" title="Set Creation Offset so that Current calculated matches the Transactions mode">Set Creation Offset</button>
                <textarea name="attr_LP-Summary"  class="sheet-text-left sheet-HideIfPrint sheet-details-big" title="@{LP-Summary}   Automatically Calculated Report of your LP Costs."></textarea>
              </div>
            </div>
          </div>    <!-- end Record - Calculated Mode -->

                <!-- Record - Transaction Mode -->
          <input type="checkbox" name="attr_legend-transaction-mode" class="sheet-hidden sheet-testCloseChecked" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
          <div class="sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar"> Transaction Legend Point Tracking </div>
            <div class="sheet-content">
              <span class="sheet-nowrap1" title="@{LP-Total}:   Accumulated sum of all Legend Points ever earned."><b class="sheet-label">Legend Points - Career :</b>
                <input name="attr_LP-Total" value="0" class="sheet-selLong" type="number">
              </span>
              <span class="sheet-nowrap1 sheet-label" title="@{LP-Current}:   Unspent Legend Points.">  Current :
                <input name="attr_LP-Current" type="number" value="0" class="sheet-selShort"  >
              </span>
              <span class="sheet-info" title="Instructions: In the TRANSACTION MODE, you use journal entries to record any transaction such as Legend Awards at the end of a Game, or the costs for increasing a Talent Rank. Note that standard Building Your Legend transactions, such as increasing Talent Ranks, Attributes, or Weaving Threads to items will be automatically detected by the API and sent to Roll20 chat to Record the transaction. Note that you can use the CALCULATED Mode, as a checksum to be sure that no transaction was forgotten in your journal">i</span>
            </div>
          </div>    <!-- end Record - Transaction Mode -->

                <!-- Record - Journal -->
          <div>
            <div class="sheet-headerbar"> Journal Entries </div>
            <div class="sheet-content">
              <input class="sheet-testRecord" name="attr_record-item" value="LPSP" type="hidden">
              <span class="sheet-info" title="Instructions: This section is for your Legend Points and Silver Pieces Journal. Record here any transaction such as Legend Awards at the end of a Game. Record the transaction by chosing LP/SP, filling the amount, type of transaction, and filling the reason and date.
              Due to restrictions in Roll20 be sure to click outside of the Reason text box before clicking on Post. Note that standard Building Your Legend transactions, such as increasing Talent Ranks, Attributes, or Weaving Threads to items will be automatically detected and sent to Roll20 chat to Record the transaction..">i</span>
              <span class="sheet-nowrap2" title="@{record-date-throalic}:   Throalic date."><b class="sheet-label">Date Throalic: </b>
                <input name="attr_record-date-throalic" type="text" value="" class="sheet-txtShort" >
              </span>
              <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_update_dates" type="roll"
              value="!Earthdawn~ charID: @{character_id}~ updateDates : @{Party|record-date-throalic}" >Update Dates</button>
              <br>
              <b class="sheet-label">Transaction</b>
              <span class="sheet-nowrap" title="@{record-item}  Are we journaling a silver or LP transaction?">
                <select name="attr_record-item" class="sheet-selShort">
                  <option value="LPSP" selected title="Legend Points and Silver Pieces at the same time."> LP&amp;SP</option>
                  <option value="LP" title="Legend Points."> LP</option>
                  <option value="SP" title="Silver Pieces."> SP</option>
                  <option value="Other" title="Other."> Other</option>
                </select>
              </span>
              <b class="sheet-HideIfOther sheet-label">Amount :</b>
              <span class="sheet-nowrap sheet-HideIfSP sheet-HideIfOther sheet-label" title="@{record-amount-LP}:   Amount of Legend Points in this transaction.">LP:
                <input name="attr_record-amount-LP" type="number" value="0" class="sheet-selShort" >
              </span>
              <span class="sheet-nowrap sheet-HideIfLP sheet-HideIfOther sheet-label" title="@{record-amount-SP}:   Amount of Silver Pieces in this transaction.">SP:
                <input name="attr_record-amount-SP" type="number" value="0" class="sheet-selShort" >
              </span>
              <span class="sheet-nowrap sheet-HideIfOther" title="@{record-type}  Are we journaling a gain or a expenditure?">
                <select name="attr_record-type" class="sheet-selShort">
                  <option value="Gain" selected title="Gain. For LP will apply to both Career and Current."> Gain</option>
                  <option value="Spend"         title="Spend. For LP will apply only to Current without affecting Career."> Spend</option>
                  <option value="Decrease"      title="Decrease: Use this to undo a mistaken Gain .For LP will apply to both Career and Current."> Decrease</option>
                  <option value="Refund"        title="Refund: Use this to undo a mistaken Spend.For LP will apply only to Current without affecting Career."> Refund</option>
                </select>
              </span>
              <span class="sheet-nowrap2">
                <input name="attr_record-reason" type="text" style="width:20em;" class="sheet-text-left"
                title="@{record-reason}:   Detailed description of the transaction."
                placeholder="Description of transaction or other notes." >
              </span>
              <input name="attr_record-reason" type="text" class="sheet-hidden sheet-testPlaceholder"
              placeholder="Description of transaction or other notes." >
              <button class="sheet-text-button sheet-button-nodice sheet-hideIfPlaceholder" name="act_post_update" type="action" title="Post a transaction">Post</button>

              <textarea name="attr_record-journal"  class="sheet-text-left sheet-HideIfPrint sheet-details-big" title="@{record-journal}   Record things here such as LP and Silver awards and expenditures."></textarea>
            </div>
          </div>    <!-- end Record - Journal -->
        </div>    <!-- ************************  End of Section Record ******************  -->



              <!-- *********************************************** Start of Section Adjustment (renamed Parameter) **************************** -->
        <div class="sheet-section sheet-section-adjustments">
                <!--Adjust - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex">
            <div>
              <label title="@{attr_tab11-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab11-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab11-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Parameters <div></div>
          </div>
          <div class="sheet-sec-spacer"></div>
          <div>
            <input type="radio" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab1" value="1" title="Character Adjustments." checked ><span>Character</span>
            <input type="radio" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab2" value="2" title="Creature."><span>Maneuvers</span>
            <input type="radio" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab3" value="3" title="Sheet Adjustments."><span>Sheet</span>
            <input type="radio" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab4" value="4" title="Relese Notes."><span>R.Notes</span>
            <input type="radio" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab5" value="5" title="Help."><span>Help</span>
          </div>
          <!-- <div class="sheet-sec-border-line"></div> -->

          <input type="hidden" name="attr_tab-adjust" class="sheet-tabAdjust" value="1">

                  <!--Adjust - Common Subsection-->
          <div class="sheet-section-adjustments-common">
            <div class="sheet-headerbar">Character Adjustments</div>
            <span class="sheet-info" title="Everything here is calculated or entered on other tabs. This is a place where more or less permanent adjustments can be made. For example: If you tie a thread to an item that gives you a +2 to Physical Defense, you should add the +2 on this tab.  Buffs and other temporary modifications to Defenses and Armor should be made on the Combat Tab. It is a very good idea to use the notes field at the bottom to document the reason for each adjustment.">i</span>
            <div class="sheet-content">
              <span class="sheet-nowrap3 sheet-label" title="@{NPC}   Is this character a PC, NPC, Mook, or Object?   (Mook means more than one token shares one character sheet) (Object means it is not really a character at all)">PC / NPC?
                <select name="attr_NPC" class="sheet-selShort">
                  <option value="0" title="PC"> PC</option>
                  <option value="1" selected title="NPC" > NPC</option>
                  <option value="2" title="Mook"> Mook</option>
                  <option value="-1" title="Object - The token is not really a character at all, but is an object such as a campfire or a torch."> Object</option>
                </select>
              </span>
              <br>

                    <!--Adjust - Common - Attributes-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort sheet-table-left">Attributes :</span>
                  <span class="sheet-table-data sheet-numLong">Dex</span>
                  <span class="sheet-table-data sheet-numLong">Str</span>
                  <span class="sheet-table-data sheet-numLong">Tou</span>
                  <span class="sheet-table-data sheet-numLong">Per</span>
                  <span class="sheet-table-data sheet-numLong">Wil</span>
                  <span class="sheet-table-data sheet-numLong">Cha</span>
                  <span class="sheet-table-data sheet-numLong">Init.</span>
                  <span class="sheet-table-data sheet-numLong">Recov.</span>
                  <span class="sheet-table-data sheet-numLong">Knockd.</span>
                </div>
                      <!--Adjust - Common - Attributes - Value-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Value: </span>
                  <span class="sheet-table-data" title="@{Dex-Adjust-attr}:   Adjustment to the Dex attribute."> <input name="attr_Dex-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Str-Adjust-attr}:   Adjustment to the Str attribute."> <input name="attr_Str-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Tou-Adjust-attr}:   Adjustment to the Tou attribute."> <input name="attr_Tou-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Per-Adjust-attr}:   Adjustment to the Per attribute."> <input name="attr_Per-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Wil-Adjust-attr}:   Adjustment to the Wil attribute."> <input name="attr_Wil-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Cha-Adjust-attr}:   Adjustment to the Cha attribute."> <input name="attr_Cha-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                </div>
                      <!--Adjust - Common - Attributes - Step-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Step: </span>
                  <span class="sheet-table-data" title="@{Dex-Adjust}:   Adjustment to the Dex step."> <input name="attr_Dex-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Str-Adjust}:   Adjustment to the Str step."> <input name="attr_Str-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Tou-Adjust}:   Adjustment to the Tou step."> <input name="attr_Tou-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Per-Adjust}:   Adjustment to the Per step."> <input name="attr_Per-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Wil-Adjust}:   Adjustment to the Wil step."> <input name="attr_Wil-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Cha-Adjust}:   Adjustment to the Cha step."> <input name="attr_Cha-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Misc-Initiative-Adjust}:   Adjustment to the Dex Initiative step."><input name="attr_Misc-Initiative-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Initiative-Adjust}:   Misc Initiative adjustment."> </span>
                  <span class="sheet-table-data" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step."><input name="attr_Recovery-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step."></span>
                  <span class="sheet-table-data" title="@{Knockdown-Adjust}:   Adjustment to the Strenght Knockdown step."><input name="attr_Knockdown-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Knockdown-Adjust}:   Misc Knockdown test adjustment."></span>
                </div>
                      <!--Adjust - Common - Attributes - Karma-Max-->
                <div class="sheet-table-row sheet-api">
                  <span class="sheet-table-data sheet-label sheet-table-left">Maximum Karma Allowed : </span>
                  <span class="sheet-table-data" title="@{Dex-Karma-Limit_max}:   Adjustment to the Dex step."> <input name="attr_Dex-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Str-Karma-Limit_max}:   Adjustment to the Str step."> <input name="attr_Str-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Tou-Karma-Limit_max}:   Adjustment to the Tou step."> <input name="attr_Tou-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Per-Karma-Limit_max}:   Adjustment to the Per step."> <input name="attr_Per-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Wil-Karma-Limit_max}:   Adjustment to the Wil step."> <input name="attr_Wil-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Cha-Karma-Limit_max}:   Adjustment to the Cha step."> <input name="attr_Cha-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Initiative-Karma-Limit_max}   What is the maximum number of Karma that can be used on Initiative test?">      <input type="number" min="0" max="3" value="0" name="attr_Initiative-Karma-Limit_max" class="sheet-numShort sheet-HideSpinners">            </span>
                  <span class="sheet-table-data" title="@{Recovery-Karma-Limit_max}   What is the maximum number of Karma that can be used on Recovery test?">                <input type="number" min="0" max="3" value="0" name="attr_Recovery-Karma-Limit_max" class="sheet-numShort sheet-HideSpinners">              </span>
                </div>
                      <!--Adjust - Common - Attributes - DP-Max-->
                <div class="sheet-table-row sheet-HideIfNotQuest sheet-api sheet-table-left"><span class="sheet-table-data sheet-label">Maximum DP Allowed: </span>
                  <span class="sheet-table-data" title="@{Dex-DP-Limit_max}:   Adjustment to the Dex step."> <input name="attr_Dex-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Str-DP-Limit_max}:   Adjustment to the Str step."> <input name="attr_Str-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Tou-DP-Limit_max}:   Adjustment to the Tou step."> <input name="attr_Tou-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Per-DP-Limit_max}:   Adjustment to the Per step."> <input name="attr_Per-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Wil-DP-Limit_max}:   Adjustment to the Wil step."> <input name="attr_Wil-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Cha-DP-Limit_max}:   Adjustment to the Cha step."> <input name="attr_Cha-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Initiative-DP-Limit_max}   What is the maximum number of Devotion Points that can be used on Initiative test?">            <input type="number" value="0" min="0" max="3" name="attr_Initiative-DP-Limit_max" class="sheet-numShort sheet-HideSpinners">          </span>
                  <span class="sheet-table-data" title="@{Recovery-DP-Limit_max}   What is the maximum number of Devotion Points that can be used on Recovery test?">            <input type="number" value="0" min="0" max="3" name="attr_Recovery-DP-Limit_max" class="sheet-numShort sheet-HideSpinners">          </span>
                </div>
                      <!--Adjust - Common - Attributes - Roll Type-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Visibility :</span>
                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Dex}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Dex" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>
                        <select name="attr_RollType-Dex" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                        <select name="attr_RollType-Dex" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Str}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Str" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Str" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Str" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Tou}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Tou" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Tou" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Tou" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Per}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Per" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Per" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Per" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Wil}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Wil" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Wil" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Wil" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Cha}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Cha" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Cha" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Cha" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </div>
              </div>
              <br>

                    <!--Adjust - Common - Defense & Armor-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-selLong">Defense&Armor:</span>
                  <span class="sheet-table-data sheet-numLong">PD</span>
                  <span class="sheet-table-data sheet-numLong">MD</span>
                  <span class="sheet-table-data sheet-numLong">SD</span>
                  <span class="sheet-table-data sheet-numLong">PA</span>
                  <span class="sheet-table-data sheet-numLong">MA</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Natural</span>
                  <span class="sheet-table-data"><input name="attr_Defense-Phys-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Phys-Nat-Adjust}:   Misc adjustment to Natural Physical Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Myst-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Myst-Nat-Adjust}:   Misc adjustment to Natural Mystical Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Soc-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Soc-Nat-Adjust}:   Misc adjustment to Natural Social Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Phys-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Phys-Nat-Adjust}:   Misc adjustment to Natural Physical Armor. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Myst-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Myst-Nat-Adjust}:   Misc adjustment to Natural Mystic Armor. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Normal</span>
                  <span class="sheet-table-data"><input name="attr_Defense-Phys-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Phys-Adjust}:   Misc Physical Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Myst-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Myst-Adjust}:   Misc Mystical Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Soc-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Soc-Adjust}:   Misc Social Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Phys-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Phys-Adjust}:   Misc Physical Armor adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Myst-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Myst-Adjust}:   Misc Mystic Armor adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                </div>
              </div>
              <br>
                    <!--Adjust - Common - Health Ratings-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort">Health Ratings :</span>
                  <span class="sheet-table-data sheet-numLong">Unc.</span>
                  <span class="sheet-table-data sheet-numLong">Death.</span>
                  <span class="sheet-table-data sheet-nowrap">Wound Tr.</span>
                  <span class="sheet-table-data sheet-nowrap">Recov./day</span>
                  <span class="sheet-table-data sheet-nowrap">Durability</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data" ></span>
                  <span class="sheet-table-data"><input name="attr_Damage-Unconscious-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Damage-Unconscious-Adjust}:   Adjustment to the calculated Unconscious Rating."></span>
                  <span class="sheet-table-data"><input name="attr_Damage-Death-Rating-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Damage-Death-Rating-Adjust}:   Adjustment to the calculated Death Rating."></span>
                  <span class="sheet-table-data"><input name="attr_Wound-Threshold-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Wound-Threshold-Adjust}:   Adjustment to the calculated Wound Threshold."></span>
                  <span class="sheet-table-data"><input name="attr_Recovery-Tests-Misc-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Tests-Misc-Adjust}:   Adjustment to the number of Recovery Tests per day."></span>
                  <span class="sheet-table-data"><input name="attr_Durability-Rating-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Durability-Rating-Adjust}:   Adjustment to the Durability Rating of all Disciplines."></span>
                </div>
              </div>
              <br>
                    <!--Adjust - Common - Discipline Adjust-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtMed">Discipline Adjust :</span>
                  <span class="sheet-table-data sheet-numLong">PD</span>
                  <span class="sheet-table-data sheet-numLong">MD</span>
                  <span class="sheet-table-data sheet-numLong">SD</span>
                  <span class="sheet-table-data sheet-numLong">PA</span>
                  <span class="sheet-table-data sheet-numLong">MA</span>
                  <span class="sheet-table-data sheet-numLong">Init.</span>
                  <span class="sheet-table-data sheet-numLong">Recov.</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data"></span>
                  <span class="sheet-table-data" title="@{Defense-Phys-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Physical Defense"><input readonly name="attr_Defense-Phys-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Defense-Myst-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Mystical Defense"><input readonly name="attr_Defense-Myst-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Defense-Soc-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Social Defense"><input readonly name="attr_Defense-Soc-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Armor-Phys-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Physical Armor"><input readonly name="attr_Armor-Phys-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Armor-Myst-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Mystic Armor"><input readonly name="attr_Armor-Myst-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Initiative-Auto-Adjust}:   Adjustment to the Dex Initiative step."><input name="attr_Initiative-Auto-Adjust" type="number" value="0" readonly class="sheet-numShort sheet-HideSpinners" title="@{Misc-Initiative-Auto-Adjust}:   Automatic adjustment from Discipline to Initiative."> </span>
                  <span class="sheet-table-data" title="@{Recovery-Tests-Auto-Adjust}:   Adjustment to the Toughness Recovery step."><input name="attr_Recovery-Tests-Auto-Adjust" readonly type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Auto-Adjust}:   Automatic adjustment from Discipline to Number of Recovery Tests."></span>
                </div>
              </div>
              <div>
                <b class="sheet-label"> Custom Karma Ablities</b>
                <br>
                <textarea name="attr_Custom-Karma-Ability" class="sheet-details-small" style="width:50%" title="@{Custom-Karma-Ability}   Note here any specific Karma or Devotion Ability not automatically detected." placeholder="Custom Karma Ability. Document Here any specific Karma or Devotion Ability in addition to the ones automatically detected."></textarea>
              </div>

              <br>

                    <!--Adjust - Common - Misc-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort">Misc :</span>
                  <span class="sheet-table-data sheet-numLong">IP</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Pool</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Mod Adjust</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Step</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Ritual</span>
                  <span class="sheet-table-data sheet-nowrap sheet-HideIfNotQuest">DP Step</span>
                  <span class="sheet-table-data sheet-nowrap">Carry</span>
                  <span class="sheet-table-data sheet-nowrap">Movement</span>
                  <input name="attr_Flight" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                  <span class="sheet-table-data sheet-nowrap sheet-HideIfNotCloseChecked">Fly Mov</span>
                  <span class="sheet-table-data sheet-nowrap">Reknown</span>
                  <span class="sheet-table-data sheet-nowrap">Reputation</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data "></span>
                  <span class="sheet-table-data"><input name="attr_Misc-IP-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-IP-Adjust}:   Misc Initiative Penalty adjustment."></span>
                  <span class="sheet-table-data">
                    <input name="attr_Misc-Karma-max-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Karma-max-Adjust}:   Adjustment to Karma Max.">
                  </span>
                  <span class="sheet-table-data">
                    <input name="attr_Karma-Modifier-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Karma-Modifier-Adjust}:   Adjustment to the Racial Karma Modifier.">
                  </span>
                  <span class="sheet-table-data">
                    <select name="attr_KarmaStep" class="sheet-selLong" title="@{KarmaStep}   What karma dice does this character roll">
                      <option value="3" title="D4 - Step 3.">S3: D4</option>
                      <option value="4" selected="selected" title="D6 - Step 4. Standard.">S4:  D6</option>
                      <option value="5" title="D8 - Step 5.">S5: D8</option>
                      <option value="6" title="D10 - Step 6.">S6: D10</option>
                      <option value="7" title="D12 - Step 7.">S7: D12</option>
                      <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                      <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                      <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                      <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                      <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                      <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                      <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                      <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                      <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                      <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                      <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                      <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                      <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                    </select>
                  </span>
                  <span class="sheet-table-data">
                    <select class="sheet-selShort" name="attr_Misc-KarmaRitual" title="@{Misc-KarmaRitual}:   Effect of Karma Ritual (used for the NewDay button)">
                      <option selected value="-1" title="Default Setting for ED4 - Karma Ritual refills the Karma Pool"> Fill</option>
                      <option value="-2" title="Homerule Setting - Karma Ritual refills Circle Karma Points per Day to the Karma Pool"> Circle </option>
                      <option value="-3" title="Homerule Setting- Karma Ritual refills Racial Modifier Karma Points per Day to the Karma Pool"> Mod </option>
                      <option value="-4" title="Setting for older editions (API only) - Declare a Talent as Special : Karma Ritual, and it will refills its Rank per day"> Talent </option>
                      <option value="0" title="Homerule Setting - No Karma Ritual on New Day">0</option>
                      <option value="1" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">1</option>
                      <option value="2" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">2</option>
                      <option value="3" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">3</option>
                      <option value="4" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">4</option>
                      <option value="5" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">5</option>
                      <option value="6" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">6</option>
                      <option value="7" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">7</option>
                      <option value="8" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">8</option>
                      <option value="9" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">9</option>
                      <option value="10" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">10</option>
                    </select>
                  </span>

                  <span class="sheet-table-data sheet-HideIfNotQuest">
                    <select name="attr_DevotionStep" class="sheet-selLong" title="@{DevotionStep}   What DP dice does this character roll">
                      <option value="3" selected="selected" title="D4 - Step 3.">S3: D4</option>
                      <option value="4" title="D6 - Step 4. Standard.">S4:  D6</option>
                      <option value="5" title="D8 - Step 5.">S5: D8</option>
                      <option value="6" title="D10 - Step 6.">S6: D10</option>
                      <option value="7" title="D12 - Step 7.">S7: D12</option>
                      <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                      <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                      <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                      <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                      <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                      <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                      <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                      <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                      <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                      <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                      <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                      <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                      <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                    </select>
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-Carry-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Carry-Adjust}:   Adjustment to Carrying Capacity."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Movement-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Movement-Adjust}:   Adjustment to unmounted movement."></span>
                  <input name="attr_Flight" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                  <span class="sheet-table-data sheet-HideIfNotCloseChecked"><input name="attr_Misc-Fly-Movement-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Fly-Movement-Adjust}:   Adjustment to  Fly movement."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Renown-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Renown-Adjust}:   Adjustment to Renown."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Reputation-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Reputation-Adjust}:   Adjustment to Reputation."></span>
                </div>
              </div>
              <br>

                    <!--Adjust - Common - Parameters-->
              <div class="sheet-table-left">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShortShort">Parameters :</span>
                  <span class="sheet-table-data sheet-numLong">Bonus</span>
                  <span class="sheet-table-data sheet-numLong">Penalty</span>
                  <span class="sheet-table-data sheet-numLong">Strain</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Defensive Stance</span>
                  <span class="sheet-table-data"><input name="attr_Misc-DefStance-Bonus" type="number" value="3" min="0" max="9"
                  class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-DefStance-Bonus}:   When in Defensive Stance, what is bonus to the characters PD and MD? This is usually three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-DefStance-Penalty" type="number" value="-3" min="-9" max="0"
                    class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-DefStance-Penalty}:   When in Defensive Stance, what is penalty to the characters Action Tests? This is usually minus three.">
                   </span>
                </div>
                <div class="sheet-table-row sheet-api">
                  <span class="sheet-table-data sheet-label sheet-table-left">Agressive Attack</span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Bonus" type="number" value="3" min="0" max="9" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Bonus}:   When Aggressively Attacking, what is the bonus to attacks and damage? This is usually three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Penalty" type="number" value="-3" min="-9" max="0" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Penalty}:   When Aggressively Attacking, what is the Penalty to the characters PD and MD? This is usually minus three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Strain" type="number" value="1" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Strain}:   How much Strain does this character take with each Aggressive Attack. This is usually one except for Journeyman or higher Sky Raiders.">
                  </span>
                </div>
              </div>
                    <!--Adjust - Common - Masks-->
              <input class="sheet-testNum" name="attr_MaskList" value="0" type="hidden">
              <div class="sheet-HideIfZero">
                Masks:
                <label class="sheet-autoexpand-wrap" title="@{MaskList}   Names of Masks applied to this character.">
                  <input name="attr_MaskList" type="text" value="0" readonly>
                  <span name="attr_MaskList" class="sheet-autoexpand" ></span>
                </label><br>
                <textarea name="attr_MaskDetail" class="sheet-details" readonly title="@{MaskDetail}   Mask text detailing the Mask Template."></textarea>
              </div>

                    <!--Adjust - Common - Notes-->
              <div style="font-size: x-small;">
                Document every permanent or semi-permanent adjustment here. You or your GM should be able to glance at these notes and know why every adjustment has been made. Example typical entry might be "MD +3: +1 Wiz 2nd, +2 Group thread".
              </div>
              <textarea name="attr_Adjustment-Notes" class="sheet-details-big"  title="@{Adjustment-Notes}   Notes on why certain things are adjusted here." placeholder="Notes on why certain things are adjusted here."></textarea>
            </div>
          </div>    <!-- end Adjust - Common Subsection -->


                <!-- Adjust - Maneuvers -->
          <div class="sheet-section-adjustments-maneuvers">
            <div class="sheet-headerbar">Special Maneuvers</div>

            <div style="font-size: x-small;">
              For creatures, document here the special maneuvers that the creature have. This will control how control icons will be displayed, and how maneuver options are offered in combat
            </div>

                  <!--Adjust - Maneuvers - Creature-->
            <b class="sheet-heading sheet-text-center">Creature Maneuvers</b>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-HardenedArmor}   Hardened Armor: Bonus damage resulting from additional successes on Attack tests is reduced by one per success. Typically, this means that instead of +2 damage per additional success, the attacker only gets +1 damage per additional success">
                <input name="attr_Creature-HardenedArmor" type="checkbox" value="1" > Hardened Armor
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-GrabAndBite}   Grab and Bite: The creature may spend an additional success from an Attack test to automatically grapple an opponent. Grappled opponents automatically take bite damage each round until the grapple is broken.">
                <input name="attr_Creature-GrabAndBite" type="checkbox" value="1" > Grab and Bite
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Hamstring}   Hamstring: The creature may spend an additional success from an Attack test to halve the opponents Movement until the end of the next round. If the attack causes a Wound, the penalty lasts until the Wound is healed.">
                <input name="attr_Creature-Hamstring" type="checkbox" value="1" > Hamstring
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Overrun}   Overrun: The creature may spend an additional success from an Attack test to force an opponent with a lower Strength Step to make a Knockdown test against a DN equal to the Attack test result.">
                <input name="attr_Creature-Overrun" type="checkbox" value="1" > Overrun
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Pounce}   Pounce: If the creature reaches its opponent with a leap and the opponent isnt too much larger, the creature may spend an additional success from the Attack test to force the opponent to make a Knockdown test against a DN equal to the Attack test result.">
                <input name="attr_Creature-Pounce" type="checkbox" value="1" > Pounce
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{Creature-SqueezeTheLife}   Squeeze the Life: The creature may spend two additional successes from an Attack test to automatically grapple an opponent. Grappled opponents automatically take claw damage each round until the grapple is broken">
                <input name="attr_Creature-SqueezeTheLife" type="checkbox" value="1" > Squeeze the Life
              </span>
            </div>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Fury}   Fury threshold - If non-zero, instead of suffering penalties, Wounds grant this creature a bonus to tests. Once the creature has more Wounds than indicated by the Step of this ability, the bonuses are lost and the creature suffers normal penalties for Wounds.">
                Fury <input name="attr_Creature-Fury" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-ResistPain}   Resist Pain threshold - If non-zero, the creature ignores penalties for Wounds equal to this ability. For example, a creature with Resist Pain (2) ignores the penalties from the first two Wounds suffered.">
                Resist Pain <input name="attr_Creature-ResistPain" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Willful}   Willful threshold - If non-zero, Talents and abilities used to dominate, control, tame or train the creature require additional successes equal to the Step of this ability.">
                Willful <input name="attr_Creature-Willful" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Ambush}   If the 'Ambushing' status is ON, this is the amount that is added to Initiative, Attack, and Damage.">
                <span class="sheet-iconstatic sheet-icon-ambush"></span> Ambush <input name="attr_Creature-Ambush" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-DiveCharge}   If the 'Diving/Charging' box is checked, this is the amount that is added to Attack, and Damage. Use this for ether Diving or Charging creature powers.">
                <span class="sheet-iconstatic sheet-icon-charging"></span>Dive/Charge <input name="attr_Creature-DiveCharge" type="number" value="0" min="0" >
              </span>
            </div>

                  <!--Adjust - Maneuvers - Opponent-->
            <b class="sheet-heading sheet-text-center">Opponent Maneuvers</b>
            <div class="sheet-content">
              <div class="sheet-content">
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-ClipTheWing}   Clip the Wing: The attacker may spend two additional successes from an Attack test to remove the creatures ability to fly until the end of the next round. If the attack causes a Wound, the creature cannot fly until the Wound is healed. If the creature is in flight, it falls and suffers falling damage for half the distance fallen.">
                  <input name="attr_Opponent-ClipTheWing" type="checkbox" value="1" > Clip the Wing
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-CrackTheShell}   Crack the Shell: The attacker may spend extra successes from physical attacks (not spells) to reduce the creatures Physical Armor by 1 per success spent. This reduction takes place after damage is assessed, and lasts until the end of combat.">
                  <input name="attr_Opponent-CrackTheShell" type="checkbox" value="1" > Crack the Shell
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Defang}   Defang: The opponent may spend additional successes to affect the creatures ability to use its poison. Each success spent reduces the Poisons Step by 2. If the attack causes a Wound, the creature cannot use its Poison power at all until the Wound is healed">
                  <input name="attr_Opponent-Defang" type="checkbox" value="1" > Defang
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Enrage}   Enrage: An opponent may spend additional successes from an Attack test to give a -1 penalty to the creatures Attack tests and Physical Defense until the end of the next round. Multiple successes may be spent for a cumulative effect.">
                  <input name="attr_Opponent-Enrage" type="checkbox" value="1" > Enrage
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Provoke}   Provoke: The attacker may spend two additional successes from an Attack test to enrage the creature and guarantee he will be the sole target of the creatures next set of attacks. Only the most recent application of this maneuver has any effect.">
                  <input name="attr_Opponent-Provoke" type="checkbox" value="1" > Provoke
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-PryLoose}   Pry Loose: The attacker may spend additional successes from an Attack test to allow a grappled ally to immediately make an escape attempt with a +2 bonus per success spent on this maneuver">
                  <input name="attr_Opponent-PryLoose" type="checkbox" value="1" > Pry Loose
                </span>
              </div>
            </div>

                  <!--Adjust - Maneuvers - Custom-->
            <b class="sheet-heading sheet-text-center"> Custom Maneuvers </b>
            <div class="sheet-content">
              <input name="attr_ManRowIdList" type="hidden" > <!-- Keep a list of RowIDs for this fieldset, so we can process though them quicker  -->
              <fieldset class="repeating_maneuvers">
                <div>
                  <input name="attr_MAN_RowID" type="text" class="sheet-hidden">
                  <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-testChecked sheet-hidden">
                  <span class="sheet-nowrap0">
                    <label class="sheet-HideIfNotChecked" >
                      <input type="checkbox" name="attr_MAN_Type" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-creature" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                    <label class="sheet-HideIfChecked">
                      <input type="checkbox" name="attr_MAN_Type" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-opponent" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-titlespan sheet-txtLong sheet-bordered-bottom">
                    <input name="attr_MAN_Name" type="text" class="sheet-fixed-width sheet-txtLong" placeholder="name" title="@{repeating_maneuvers_MAN_Name} Use these fields to specify a custom Maneuvers (Opponent or Creature). ">
                  </span>
                  <label title="@{repeating_maneuvers_X_MAN_ShowNotes}   Show description of Maneuver">
                    <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <label class="sheet-HideIfChecked" title="@{repeating_maneuvers_MAN_Show} Use these field to hide/show Opponent maneuvers. It will not be offered up to the user as a way to spend extra successes unless the 'Show' field is checked. This allows the GM to get the opponent maneuvers all setup but not let the players see them until they have passed a knowledge test.">
                    <input type="checkbox" name="attr_MAN_Show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-maneuver-show"></span>
                  </label>
                </div>
                <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                <div class="sheet-HideIfNotChecked">
                  <textarea name="attr_MAN_Desc" class="sheet-details" title="@{repeating_maneuvers_MAN_Desc} Use these fields to specify a custom Maneuvers (Opponent or Creature). A text description of the maneuver." placeholder="Description of the Maneuver and how it works."></textarea>
                </div>
              </fieldset>
            </div>

                  <!--Adjust - Maneuvers - Misc-->
            <b class="sheet-heading sheet-text-center">    Horror Powers  </b>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title='@{Creature-CorruptKarmaBank}   This is the bank of &#34;Corrupt Karma&#34; points that horrors have accumulated against this character. Then these points are transfered to the follow field is when they actually affect the character. This will usually not be set directly using this field, instead, a Talent named &#34;Corrupt Karma&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Corrupt Karma&#34; will be run and the resulting number of successes will automatically be added to this field.'>
                Corrupt Karma <input name="attr_Creature-CorruptKarmaBank" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2" title='@{Creature-CorruptKarma}   This is the number of Karma Dice that will be negated in the next rolls. This will usually not be set directly using this field, instead, a Talent named &#34;Corrupt Karma&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Corrupt Karma&#34; will have next to it a button (and a Token Action) that when run will transfer &#34;Corrupt Karma Points&#34; from the bank (previous field) to this field. IE: when the &#34;Corrupt Karma&#34; power is to be used, the GM should tell the players to check with them before making rolls, and when the player is making a roll with karma that the GM wishes to have corrupted, the GM should use the provided Token Action to set a value in this field.'>
                <input name="attr_Creature-CorruptKarma" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title='@{Creature-CursedLuck}   This is the number of Dice that will be &#34;cursed&#34; (set to 1) during the next roll. This will usually not be set directly using this field. Instead, a Talent named &#34;Cursed Luck&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Cursed Luck&#34; will be run, and it will automatically set this field to the number of successes rolled.'>
                Cursed Luck <input name="attr_Creature-CursedLuck" type="number" value="0" min="0" >
              </span>

              <span class="sheet-hidden">                           <!-- Use these to store misc stuff that does not logically go anywhere else. -->
                <input name="attr_APIflag" type="hidden" value="">  <!-- Global value defined here, used by this files sheetworkers to pass messages to the API -->
                <input name="attr_SWflag"  type="hidden" value="">  <!-- Global value defined here, used by the API to pass messages to this files sheetworkers -->
                <input name="attr_effectIsAction" type="number">    <!-- Global value that the API will copy into each individual sheet saying whether effect tests are action tests or not. -->
                <input name="attr_CreatureFlags" type="number">     <!-- Convert all the checkboxes above to one handy Earthdawn.flagsCreature bitfield and store it here.  -->
                <input name="attr_pseudoToken" type="text">         <!-- If we can't figure out the token being used, Use this field to store stuff that should by rights be stored with a token  -->
              </span>
            </div>
          </div>    <!-- end Adjust - Maneuvers -->

                <!-- Adjust - Advanced -->
          <div class="sheet-section-adjustments-advanced">
            <div class="sheet-headerbar">Sheet and API parameters</div>
            <div class="sheet-content">
              <b class="sheet-heading">Sheet Options</b>
              <br>

              <!-- <span class="sheet-nowrap3 sheet-label" title="@{show_tips_startup}  Toggle to show back the tips & tricks at each opening of the sheet for PC sheets.">
              Show tips at Startup :
              <input name="attr_show_tips_startup" checked type="checkbox" value="1">
              <br>
            </span> -->

              <span class="sheet-nowrap3" title="@{StepDisplayFinal}   Parameter to decide between displaying the Base Value (without modifiers) or Final Value (after all Modifiers) in each of the steps. .">
                <select name="attr_StepDisplayFinal" class="sheet-txtLong">
                  <option value="0" title="@{StepDisplayFinal} : Show Base Value for each of the Steps, i.e. the permanent step independantly from any temporary modifier"> Show Base Values</option>
                  <option value="1" selected title="@{StepDisplayFinal} Show Final Value for each of the Steps, i.e. the current step as it will be rolled including all temporary modifier"> Show Final Values</option>
                </select>
              </span>

              <br>
                    <!-- Adjust - Advanced - Line 1 -->
              <span class="sheet-nowrap3" title="@{Hide-Spells-Tab}   Hide the Spell tabs?   If the character is not a spellcaster, might as well.">
                <select name="attr_Hide-Spells-Tab" class="sheet-txtMed" title="Show/Hide Spell Tab and Parameters">
                  <option value="0" title="Show Spells tab and parameter"> Show Spells</option>
                  <option selected value="1" title="Hide Spells tab and parameter"> Hide Spells</option>
                </select>
              </span>
              <span class="sheet-nowrap" title="@{API}   This checkbox allows to switch this particular character sheet from using the API or not. Please note that if you want to change all sheets, a special GM function in the dropdown below allows to do it if you have the API running and are in API Mode. Please also note that the checkbox doesn't disable the API, that will likely still run and detect stuff in the background. It just changes the display to hide/show some stuff that are meant to work with the API">
                <select name="attr_API" class="sheet-txtMed" title="Is API installed and running">
                  <option selected value="0" title="Sheet is running without API, API functionalities are disabled"> No API mode</option>
                  <option value="1" title="Sheet is running with API, API functionalities are enabled"> API Mode</option>
                  <option value="2" title="Sheet was running with API, but API has stopped responding. API functionalities are temporarily disabled"> Link to API nonresponsive</option>
                </select>
              </span>
              <span class="sheet-nowrap" title="@{CreationMode} To be unchecked at the end of creation to hide fields that are only used during PC creation. Check back to revert to creation Mode">
                <select name="attr_CreationMode" class="sheet-txtLong" title="Is API installed and running">
                  <option selected value="0" title="Sheet is running in normal mode"> Creation Mode - Off</option>
                  <option value="1" title="Sheet is running in Creation Mode - Tips for Character Creation will be shown"> Creation Mode - On</option>
                </select>
              </span>

              <br>
              <br>
                    <!-- Adjust -Advanced - Line 2 -->
              <b class="sheet-heading"> Special Functions </b>
              <br>
              <!-- Adjust -Advanced - Line 3 -->
              <span class="sheet-nowrap5 sheet-api" title="@{SpecialFunction}   Select a special function?">
                <select name="attr_SpecialFunction" class="sheet-txtLong">
                  <option value="!Earthdawn~ charID: @{character_id}~ LinkToken: ?{Standard both sets the token to display in the standard way and links the token|Standard|SetTokenOnly|LinkOnly}" title="Selecting this and pressing Do SF will cause selected tokens to link to this character. Standard processing both sets Token to display in a standard way, and Links the token. The next two options do one or the other.">
                    Link Token
                  </option>     <!-- Note: if link token value ever gets changed, change .js newCharacter to exact match. -->
                  <option value="Recalc" selected title="Simply setting to this value will cause workers to recalculate all calculated values.">
                    Recalc
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Misc: SetAdjust: " title="Copy the buffs from the Combat Tab to the Adjustments Tab. This makes it easier for the GM to create monsters. He can set the values directly on the combat tab, then copy them to be on the Adjustments tab instead.">
                    Set Adjustments
                  </option>
                  <option value="!Earthdawn~ ChatMenu: gmState: ED" title="GM can set several State Variables that change how all sheets act.">
                    GM: Special Commands
                  </option>
                  <option value="!Earthdawn~ Misc: MacroCreate : ?{Macros|Refresh|Create|Delete}" title="Selecting this and pressing Do SF will create all macros used by this sheet. Option to delete them and refresh them (delete followed by create).">
                    Macros
                  </option>
                  <option value="Creature" title="This option allows a creature to be imported as a Text Block formated as the GM guild, companion, etc.">
                    Import Creature
                  </option>
                  <option value="MaskApply" title="This option allows a Mask to be applied to the character.">
                    Import Mask
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ ChatMenu: Mask" title="This option allows a Mask to be removed from the character.">
                    Mask Remove
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: RepSecFix" title="This will run API code that will look for and fix any problems with repeating sections RowID's">
                    Verify/Fix Repeating Sections
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Inspect" title="Allows you to inspect various variables, repeating sections, etc.">
                    Inspect
                  </option>
                  <option value="!Earthdawn~ foreach~ StatusToToken" title="Set the Token to have the same conditions and status set as its associated character.">
                    Status to Token
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: test" title="This will run API code under edParse Test">
                    Test routine run
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: Showeach : API" title="Test code to cause whatever attributes the API is currently set to display to appear in the API Output Console.">
                    showEach API
                  </option>
                  <option value="!Earthdawn~ Debug: SheetWorkerTest" title="Simply setting to this value (no need to press Do SF button) will cause Sheetworker test to run.">
                    Sheet Worker Test
                  </option>
                </select>
              </span>
              <span class="sheet-nowrap5 sheet-NoAPI" title="@{SpecialFunction}   Select a special function?">
                <select name="attr_SpecialFunction" class="sheet-txtMed">
                  <option value="Recalc" title="Simply setting to this value will cause workers to recalculate all calculated values.">  Recalc</option>
                  <option value="!Earthdawn~ Debug: SheetWorkerTest" title="Simply setting to this value (no need to press Do SF button) will cause Sheetworker test to run.">  Sheet Worker Test</option>
                </select>
              </span>
              <span>
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Recalc">
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Creature">
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="MaskApply">
                <span class="sheet-nowrap5 sheet-api sheet-HideIfChecked" title="This button will run whatever code is specified by the Special Function drop down menu to the left.">
                  <button class="sheet-text-button sheet-button-nodice" name="roll_SpecialFunct" type="roll"
                  value="@{SpecialFunction}" >Do SF</button>
                </span>
              </span>
              <input class="sheet-testCloseChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Creature">
              <span class="sheet-nowrap5 sheet-api sheet-HideIfNotCloseChecked" title="Into this little text box, Copy and Paste whatever huge block of text describes the Creature in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import the creature.">
                <br>Copy and Paste <i>creature</i> description (starting with name) into this tiny text box.
                <textarea name="attr_textImportCreature" placeholder="text import" class="sheet-textimport"></textarea>
                <br>
              </span>
              <input class="sheet-testCloseChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="MaskApply">
              <span class="sheet-nowrap5 sheet-api sheet-HideIfNotCloseChecked" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Importaint Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'.">
                <br>Copy and Paste <i>mask</i> (starting with mask name) into this tiny text box.
                <textarea name="attr_textImportMask" placeholder="text import" class="sheet-textimport"></textarea>
                <br>
              </span>
              <br>
              <span class="sheet-nowrap"><b>Test worker thread -</b> Change this one.
                <input name="attr_wt-test1" type="number" value="0" class="sheet-numShort" title="test1:   Worker Thread test - change this and see if the following one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">
              </span>
              <span class="sheet-nowrap"> See if this one changes.
                <input name="attr_wt-test2" type="number" value="0" class="sheet-numShort" title="test2:   See if this one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">
              </span>
              <span class="sheet-nowrap" title="@{TestText}   Test code might put something in here to be displayed.">
                <input name="attr_TestText" type="text" >
              </span>
              <br>
              <br>
              <b class="sheet-heading"> General Information </b>
              <br>
              <span class="sheet-nowrap3 sheet-label" title="@{PlayerWho}   This is the last player who pressed a button on this sheet, and sometimes the API's best guess as to who owns this sheet. It is displayed for information and debugging purposes.">
                Last User :
                <input name="attr_playerWho" type="text" class="sheet-txtMed" value="" readonly>  <!-- Contains "/w " and the name of the last person who did a roll on this sheet. It is used so the API can with acceptable accuracy whisper messages to the person most likely to be editing the sheet. -->
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{edition}   Earthdawn Edition on which the sheet is set.">
                Edition :
                <select name="attr_edition" class="sheet-selShort">
                  <option value="1" >ED1</option>
                  <option value="2" >ED2</option>
                  <option value="3" >ED3</option>
                  <option value="4" selected>ED4</option>
                  <option value="-1">1879</option>
                </select>
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{edition_max}   Current version of the character sheet.">
                Sheet Version : <input name="attr_edition_max" type="text" class="sheet-numShort" value="0" readonly>
              </span>
            </div>
          </div>    <!-- end Adjust - Advanced -->

          <!-- Adjust - Release Notes -->
          <div class="sheet-section-adjustments-release">
            <div class="sheet-headerbar">Release Notes </div>
            <div class="sheet-content sheet-HideIfPrint" style="font-size: small;">
              This section will sometimes give important instructions about actions that must be taken to keep the character sheet working correctly with the new version.<br>
              <textarea name="attr_Release-notes" style="height: 250px;" class="sheet-details" title="@{Release-notes}" placeholder="Release Notes here." readonly></textarea>
            </div>
          </div>


                <!-- Adjust - Help -->
          <div class="sheet-section-adjustments-help">
            <div class="sheet-headerbar">Help and Tips</div>
            <div class="sheet-content">
              <div class="sheet-content sheet-bordered sheet-small">
                There is a Wiki for this character sheet. Press the red question mark in the upper right of the header and then open the  wiki in a new tab.
                The section below shows tutorial videos of some basic operation with the Character sheet.
              </div>
              <div class="sheet-header-flex-container w100p sheet-flex-container sheet-content">
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="hover your pointer on any field for a couple of seconds to get a tooltip description" > Show Tooltips </div>
                  <div>
                    <span class="sheet-tips-tooltip" ></span>          </div>
                </div>
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="Most of the values can be modified locally via a modifier box floating on its upper right corner. If another modifier applies automatically it will appear on the upper left corner">
                   Add Modifiers
                 </div>
                  <div>
                        <span class="sheet-tips-mods"></span>
                  </div>
                </div>
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="Many semi-permanent fields can only be edited if the local edit mode toggle has been selected."> Edit Fields</div>
                  <div>
                    <span class="sheet-tips-edit"></span>
                  </div>
                </div>
              </div>
            </div>

                  <!--Adjust - Help - General Icons-->
            <div class="sheet-headerbar">General Icons</div>
            <div class="sheet-glossary sheet-content">
              <span class="sheet-info" title="This section is a glossary of the icons used on the sheet and some basic explanation on some of the functions. Hover over the icons for some more information">i
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button in the header toggles between Base Step Display of Final Step Display. In Base Step Display, the center value of each step excludes all the temporary modifiers, i.e. it is the permanent value, but the next roll will have to include the displayed modifiers. In Final Step display, the value displayed already includes all the modifiers.">
                <span class="sheet-iconstatic sheet-icon-sum"></span> : Base/Final Step
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit a certain section.">
                <span class="sheet-iconstatic sheet-icon-edit"></span> : Edit
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to show notes or details.">
                <span class="sheet-iconstatic sheet-icon-notes"></span> : Details
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit advanced parameters of a certain section.">
                <span class="sheet-iconstatic sheet-icon-parameter"></span> : Parameters
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit links. Links are an advanced function that allow to include the Rank of a given property (Talent, Knacks ...) into the total Step of another property (Talent, Knacks ...). They can be used for Combos, like using Tiger Spring and Air Dance, to link to the Circle in order to make the Free Talents, or to calculate the total Damage with certain Talents like Surprise Strike or Down Strike by linking the Talent with the Weapon. See Wiki for more details">
                <span class="sheet-iconstatic sheet-icon-link"></span> : Links
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Karma. In Header you will find your Karma Pool. If the API, for each Talent or Ability, there is a Karma_max parameter that specifies how many Karma in maximum can be spent in a single roll. Next to the ability will appear a Karma icon to specify if you want to automatically spend Karmas on the next roll and how many. The overall decision to spend Karma or not is a toggle next to the Karma Pool in the header.">
                <span class="sheet-iconstatic sheet-icon-karma"></span> : Karma
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Devotion Points (DP) that Questor get. In Header you will find your DP Pool. If the API, for each Talent or Ability, there is a DP_max parameter that specifies how many DP in maximum can be spent in a single roll. Next to the ability will appear a DP icon to specify if you want to automatically spend DPs on the next roll and how many. The overall decision to spend DP or not is a toggle next to the DP Pool in the header.">
                <span class="sheet-iconstatic sheet-icon-devotion"></span> : Devotion
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Physical Defense.">
                <span class="sheet-iconstatic sheet-icon-PD"></span> : Physical Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Physical Armor.">
                <span class="sheet-iconstatic sheet-icon-PA"></span> : Physical Armor
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Mystic Defense.">
                <span class="sheet-iconstatic sheet-icon-MD"></span> : Mystic Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Mystic Armor.">
                <span class="sheet-iconstatic sheet-icon-MA"></span> : Mystic Armor
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Social Defense.">
                <span class="sheet-iconstatic sheet-icon-SD"></span> : Social Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Initiative.">
                <span class="sheet-iconstatic sheet-icon-initiative"></span> : Initiative
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Target Numbers for tests.">
                <span class="sheet-iconstatic sheet-icon-TN"></span> : Target Number
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Action Tests. It is defining if a Talent for example is an action, compared to being an attack, damage or initiative to interprete what modifiers should apply to its tests.">
                <span class="sheet-iconstatic sheet-icon-action"></span> : Action Test
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Effects. It is defining if a Talent for example is an Effect, compared to being an attack, damage or initiative to interprete what modifiers should apply to its tests.">
                <span class="sheet-iconstatic sheet-icon-effect"></span> : Effect Test
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for all Defenses. It is grouping the modifications that apply to both Physical Defense (PD) and Mystic Defense (MD).">
                <span class="sheet-iconstatic sheet-icon-defenses"></span> : Defenses
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Ranged Attack. It is used to identify modifiers specific to Attacks, to identify if a weapon is ranged or close combat or if a Talent is an Attack Test.">
                <span class="sheet-iconstatic sheet-icon-attacks"></span> : Attack
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Ranged Attack. It is used to identify modifiers specific to Attacks, to identify if a weapon is ranged or close combat or if a Talent is an Attack Test.">
                <span class="sheet-iconstatic sheet-icon-attacks-cc"></span> : Attack Close Combat
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Damage Tests. It is used to identify modifiers specific to Damage.">
                <span class="sheet-iconstatic sheet-icon-damage"></span> : Damage
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Damage in Close Combat Tests. It is used to identify modifiers specific to Damage.">
                <span class="sheet-iconstatic sheet-icon-damage-cc"></span> : Damage Close Combat
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-simple"></span> : Action - Simple
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-standard"></span> : Action - Standard
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-free"></span> : Action - Free
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-sustained"></span> : Action - Sustained
              </span>
              <!-- <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to set who has access to the roll results of a certain ability (can be only the GM, the GM + the player that rolled, or public to all players). A general parameter is available at the top of the sheet near the character name, and specific abilities can have in their parameters (locally or in the adjustment tab) a specific setting.">
                <span class="sheet-iconstatic sheet-icon-dice"></span> : Roll Type
              </span> -->
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to describe a spell Matrix. It is marked with a letter according to the type of Matrix">
                <span class="sheet-iconstatic sheet-icon-matrix"></span> : Spell Matrix
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to describe the threads that have to be woven to cast a spell.">
                <span class="sheet-iconstatic sheet-icon-weave"></span> : Spell Thread
              </span>
            </div>

                  <!--Adjust - Help - Option icons-->
            <div class="sheet-headerbar">Combat Options, Status, and Modifiers</div>
            <span class="sheet-info" title="Hover on the header of the sheet to make a appear the Combat Options, Status Modifiers, and Global Modifiers. Each of the combat options (PG p.382) and Situation Modifier (PG. p 386), as well as some creature Maneuvers (GMG p.251) are represented by icons. Except oherwise specified, the status applies to the character, in some cases applies to his target. Select one in the sheet, or from the Token Markers on the Token to toggle this option. Global Modifiers to all Actions, Attacks, Damage will be calculated as per the rules and applied to relevant Talents, Skills and Knacks automatically as per the declared Type">i</span>
            <div class="sheet-glossary sheet-content">
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
                <span class="sheet-iconstatic sheet-icon-agressive"></span>: Option Agressive Attack
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384) ">
                <span class="sheet-iconstatic sheet-icon-defensive"></span>: Option Defensive Stance
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-CalledShot}   Take one Strain and -3 penalty to Attack test; if successful, attack hits designated area.">
                <span class="sheet-iconstatic sheet-icon-calledshot"></span>: Option Called Shot
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-SplitMovement}   Take 1 Strain and be Harried to attack during movement. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-split"></span>: Option Split Movement
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-TargetPartialCover}   Target has +2 Bonus to Physical and Mystic defenses due to cover from this attacker. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-partialcover"></span> : Target in Partial Cover
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-Reserved}   +2 to all Target Numbers. Specify an event to interrupt. (PG p.376)">
                <span class="sheet-iconstatic sheet-icon-reserved"></span> : Option Reserved Action
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-knockeddown"></span> : Character Knocked Down
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-RangeLong}   -2 Penalty to Attack and Damage Tests. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-rangelong"></span> : Range - Long
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-NoShield}   Am not using shield at present. Forgo benefits and IP.">
                <span class="sheet-iconstatic sheet-icon-noshield"></span> : No Shield
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-blindsided"></span> : Blindsided
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
                <span class="sheet-iconstatic sheet-icon-surprised"></span> Surprised
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-blindsiding"></span> : Blindsiding(Target Blindsided)
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-impaired"></span> : Movement Impaired
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Entangled-Grappled} Character is Entangled or Grappled.  This condition is for information only and has no sheet effect. (PG p.391)">
                <span class="sheet-iconstatic sheet-icon-entangled"></span> : Entangled - Grappled
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Darkness} Partial Darkness -2 Penalty to all sight based tests due to Darkness, Blindness or Dazzling. (PG p.387)">
                <span class="sheet-iconstatic sheet-icon-vision"></span> : Darkness
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
                <span class="sheet-iconstatic sheet-icon-harried"></span> : Harried
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Cover} Partial Cover : +2 Bonus to Physical and Mystical defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-cover"></span> : Cover
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-TailAttack}   T'Skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-tail"></span> : Option Tail Attack (T'Skrang)
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Poisoned}  Character is Poisoned.  This condition is for information only and has no sheet effect.">
                <span class="sheet-iconstatic sheet-icon-poisoned"></span> : Poisoned
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
                <span class="sheet-iconstatic sheet-icon-stun"></span> : Unconscious
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
                <span class="sheet-iconstatic sheet-icon-death"></span> : Dying
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Misc-StrainPerTurn}: Set to 1.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
                <span class="sheet-iconstatic sheet-icon-strain1"></span> : Strain per turn
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Creature-Ambushing}    This is the Ambush Creature Power. If Race of the Sheet is other, and this Power is set in the ajdustment, clicking on the header will activate the maneuver modifiers (GMG p.250)">
                <span class="sheet-iconstatic sheet-icon-ambush"></span> : Creature Ambushing
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Creature-DivingCharging}    This is the Diving/Charging Creature Power. If Race of the Sheet is other, and this Power is set in the ajdustment, clicking on the header will activate the maneuver modifiers (GMG p.250)">
                <span class="sheet-iconstatic sheet-icon-charging"></span> : Creature Diving/Charging
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver.">
                <span class="sheet-iconstatic sheet-icon-maneuver-creature"></span> : Creature Maneuver
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver.">
                <span class="sheet-iconstatic sheet-icon-maneuver-opponent"></span> : Opponent Maneuver
              </span>
            </div>

          </div>    <!-- end Adjustments - Help -->
        </div>    <!-- End of section Adjustments    -->

      </div>    <!-- end of main pane -->
    </div>    <!-- end of MAIN BODY sheet-flex-container that starts right after header and includes side panes and main pane -->
  </div>    <!-- end sheet-user-root-in -->
</div>    <!-- end sheet-user-root -->







<!-- rolltemplates -->

<rolltemplate class="sheet-rolltemplate-chatrecord">
  <table>
    {{#header}}<thead><tr><th colspan="2">{{header}}</th></tr></thead>{{/header}}
    <tbody>
      {{#miscval}}<tr><td>{{misclabel}}:</td><td>{{miscval}}</td></tr>{{/miscval}}
      {{#refund}}<tr><td colspan="2" style="text-align: center; background-color: Orange;">Refund</td></tr>{{/refund}}
      {{#throalic}}<tr><td>Throalic Date:</td><td>{{throalic}}</td></tr>{{/throalic}}
      {{#lp}}<tr><td>LP:</td><td>{{lp}}</td></tr>{{/lp}}
      {{#sp}}<tr><td>Silver:</td><td>{{sp}}</td></tr>{{/sp}}
      {{#time}}<tr><td>Time:</td><td>{{time}}</td></tr>{{/time}}
      {{#note}}<tr><td>Note:</td><td>{{note}}</td></tr>{{/note}}
    </tbody>
  </table>
  {{#button1}}&nbsp;&nbsp;&nbsp;&nbsp;To record {{button1}}{{/button1}}
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-rolltargetnumber">
  <table>
    {{#header}}<thead><tr><th colspan="2">{{header}}</th></tr></thead>{{/header}}
    <tbody>
      {{#Step}}<tr><td>Step + bonus:</td><td>{{Step}}</td></tr>{{/Step}}
      {{#target_number}}<tr><td>
        Target
        {{#target_name}}'{{target_name}}'{{/target_name}}
        {{#target_defense}}{{target_defense}}{{/target_defense}}
      </td><td>TN# {{target_number}}</td></tr>{{/target_number}}
      <tr><td>Result:</td><td>{{Result}}
        {{#target_number}}
        {{#rollLess() Result target_number}}<span style="color: red;">Failed</span>{{/rollLess() Result target_number}}
        {{#^rollLess() Result target_number}}<span style="color: green;">Success</span>{{/^rollLess() Result target_number}}
        {{/target_number}}
      </td></tr>
      {{#Text}}<tr><td>Text:</td><td>{{Text}}</td></tr>{{/Text}}
    </tbody>
  </table>
</rolltemplate>


<!-- WORKERS -->
<script type="text/worker">

var SheetVersion=2.07;

// This is Test code to see if worker threads are active (working).   If wt-test1 changes, change wt-test2. if wt-test2 does not update, sheetworkers are not working.
on("change:wt-test1", function ocwttest1() {
  'use strict';
  getAttrs([ "wt-test1", "wt-test2" ], function(values) {
    'use strict';
    setAttrs({  "wt-test2": values[ "wt-test1" ]   });
  });
});   // End on change wt-test1



// This is a wrapper for parseInt.
// If you set lg to true it will write a log entry.
// vals = values.
// fld = feild within values to get and convert to an int with a default of zero.
var getInt = function fnGetInt( vals, fld, lg ) {
  'use strict';
  if( lg )        // Note: For debugging purposes, merely comment out this line to log everything.
  console.log( "Got " +  fld + " = " + vals[ fld ]  );
  return parseInt( vals[ fld ] ) || 0;
};  // End getInt()



// If Edition has not been set (probably because we are running without the API) then default to 4th edition. Sheetworker is supposed to initialize it, but it could fail
var getEdition = function fnGetInt( vals ) {
  'use strict';
  if (isNaN(vals[ "edition" ])||  parseInt( vals[ "edition" ] )===0 ) return 4; else return parseInt( vals[ "edition" ] );
  // return parseInt( vals[ "edition" ] ) || 4;
};  // End getEdition()





// This is a wrapper for call backs that log when callback is entered and exited.
// The console.log lines should be commented out when not actively  debugging.
var fn = function fnfn(cb){
  'use strict';
  return function fnfn2(){
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)') + "(" + JSON.stringify(arguments) +" )");//uncomment this line if you want the entry of the function with timestamp & arguments
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)'));//uncomment this line if you want the entry of the function with timestamps but not arguments
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)') + "(" + JSON.stringify(arguments) +" )");//uncomment this line if you want the entry of the function with arguments but no timestamp
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)'));//uncomment this line if you want the entry of the function without timestamp nor arguments
    cb.apply({},arguments);
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)' ) + " - End "); //uncomment this line if you want the exit of the function with timestamp
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)' ) + " - End "); //uncomment this line if you want the exit of the function without timestamp
  };
};



// This will generate a log entry with the name of the function that called it.
var callstack = function fncallstack(){
  var e = new Error('dummy');
  var stack = e.stack.replace(/^[^\(]+?[\n$]/gm, '')
  .replace(/^\s+at\s+/gm, '')
  .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
  .split('\n');
  stack.shift();
  console.log(stack);
};  //end callstack



// Takes a list of values, such as gotten from getAtters and logs them.
// Note that when not activly debugging, this whole routine can be commeneted out.
var logvalues = function fnlogvalues( vals ) {
  'use strict';
  //        var txt = "getAttrs -";
  //        for(var key in vals)
  //            txt += " " + key + ": " + vals[ key ] ;
  //        console.log( txt );
};  //end logvalues



// This is just like setAttrs(), except that before it sets the attrs, it writes net new values to the console log.
// NOTE That when not actively debugging, all lines except the last can/should be commented out.
var setAttrsLog = function fnlogvalues( vals, opt, cb ) {
  // var txt = "setAttrs -";
  // for(var key in vals)
  // txt += " " + key + ": " + vals[ key ] ;
  // console.log( txt );
  setAttrs( vals, opt, cb );
};  //end setAttrsLog



// Takes a list of values, such as gotten from getAtters and logs them.
// Note that by changing specific instances of logvalues to logvalues2, you can easily turn debugging on and off for specific sections.
var logvalues2 = function fnlogvalues( vals ) {
  'use strict';
  var txt = "getAttrs -";
  for(var key in vals)
  txt += " " + key + ": " + vals[ key ] ;
  console.log( txt );
};  //end logvalues2



// This is just like setAttrs(), except that before it sets the attrs, it writes net new values to the console log.
// NOTE That by changing specific instances of setAttrsLog to setAttrsLog2, you can easily turn debugging on and off for specific sections.
var setAttrsLog2 = function fnlogvalues( vals, opt, cb ) {
  var txt = "setAttrs -";
  for(var key in vals)
  txt += " " + key + ": " + vals[ key ] ;
  console.log( txt );
  setAttrs( vals, opt, cb );
};  //end setAttrsLog2



// Get a Parameter.   IE: getParm( "1,2,3,4,5", 2, ","); will return 2. IE the 2nd item in the list.
// str:     List to scan.
// num:     Number of the parameter to return.
// delim:   Character to treat as the delimiter.
var getParam = function ( str, num, delim ) {
  'use strict';
  try {
  var found;
  var count = 0;
  var j;
  let i = -1;
  do {
    j = i + 1;
    i = str.indexOf( delim, i+1);
  } while ( (++count < num) && (i !== -1) );
  if( count === num) {
    if( i < 0)
    i = str.length;
    found = str.slice( j, i).trim();
  }
  return found;
  } catch(err) {
  log("Earthdawn:getParam() error caught: " + err + " str: " + str + " num: " + num + " delim: "+delim);
}
};  // end getParam()



var buildPre = function ( code, rowID ) {
  'use strict';
  try {
    let ret="";
    code = code.toUpperCase();
    if ((_.isString( rowID ) && rowID.length<4)) {log("Earthdawn:buildPre() error. rowId wrong format: " + rowID + "   code: " + code); rowID = "xYz";}
    if( !rowID )
    rowID = "xYz";
    switch ( code ) {
      case "DSP": ret = "repeating_discipline_" + rowID + "_" + code + "_"; break;
      case "T":   ret = "repeating_talents_"    + rowID + "_" + code + "_"; break;
      case "NAC": ret = "repeating_knacks_"     + rowID + "_" + code + "_"; break;
      case "SK":  ret = "repeating_skills_"     + rowID + "_" + code + "_"; break;
      case "SKK": ret = "repeating_skillk_"     + rowID + "_" + code + "_"; break;
      case "SKAC":
      case "SKA": ret = "repeating_skilla_"     + rowID + "_" + code + "_"; break;
      case "SKL": ret = "repeating_skilll_"     + rowID + "_" + code + "_"; break;
      case "SPM": ret = "repeating_matrix_"     + rowID + "_" + code + "_"; break;
      case "SP":  ret = "repeating_spell_"      + rowID + "_" + code + "_"; break;
      case "WPN": ret = "repeating_weapons_"    + rowID + "_" + code + "_"; break;
      case "MNT": ret = "repeating_mount_"      + rowID + "_" + code + "_"; break;
      case "TI":  ret = "repeating_threads_"    + rowID + "_" + code + "_"; break;
      case "INV": ret = "repeating_inventory_"  + rowID + "_" + code + "_"; break;
      case "I":   ret = "repeating_inventory_"  + rowID + "_" + code + "_"; break;      //JBF@CD : this is only to be able to import my own game. Can be deleted afterwards
      case "BL":  ret = "repeating_blood_"      + rowID + "_" + code + "_"; break;
      case "MAN": ret = "repeating_maneuvers_"  + rowID + "_" + code + "_"; break;
      default: log("Earthdawn:buildPre() error. Unknown code: " + code + "   RowID: " + rowID );
    }
    return ret.replace( /_xYz_/g, "_");
  } catch(err) {
    log("Earthdawn:buildPre() error caught: " + err );
  }
};  // end buildPre



//buildShortPre will get an eventinfo (either a collection issued by the roll20 system, or a string if a subfunction was called directly), and return a prefix to build variable names.
//In the case of a string, the accepted substitute for an eventinfo is the rowid, and the system needs a full name, so buildPre will be Used
//In the case of a collection, the function was triggered through a repeating section so a short prefix (with no row id) is sufficient.
//If the code was determined during the call of buildshortpre, there is no need to get data from the eventinfo, buildPre can build the prefix from the Code
//if no code was supplied, there is no choice than to get the code from the eventinfo collection
var buildShortPre = function ( ei, code ) {
  'use strict';
  try {
  if ( !ei || (_.isString( ei ) && ei.length<4)) {log("Earthdawn:buildShortPre() error. Unknown eventinfo: " + ei + "   code: " + code); return ;}
  else if( _.isString( ei )) {
    if( code ) return buildPre( code, ei );
    else return buildPre( repeatSection( 3, ei ), repeatSection( 2, ei ));
  }
  else if ( code ) return buildPre(code);
  else if ( ei["sourceAttribute"] )  return buildPre(repeatSection(3,ei["sourceAttribute"]));
  log("Earthdawn:buildShortPre() error. Unknown eventinfo: " + JSON.stringify(ei));
  return;
  } catch(err) {
    log("Earthdawn:buildShortPre() error caught: " + err);
}
};  // end buildShortPre



// This routine returns just one section of a repeating section name.
// section: 0 = repeating. 1 = talents, knacks, weapons, etc. 2 = rowID, 3 = code (SP, WPN, etc.), 4 is the attribute name.
// Note that this assumes that the attribute name does NOT contain an underscore, but allows for the rowID to contain one.
var repeatSection = function ( section, str ) {
  'use strict';
  try {
    let x = str.split("_");
    if( x[ x.length -1] === "max" ) { //values with _max are the only exception where it is allowed to have an underscore in the attribute name
      x.pop();
      x[ x.length -1 ] += "_max";
    };
    if( section < 2 )
    return x[ section ];
    else if (section == 3 )
    return x[ x.length -2 ].toUpperCase();
    else if (section == 4 )
    return x[ x.length -1 ];
    else { // There is a possibility that the RowID might contain an underscore. So this is if they want section 2.
      x.pop();
      x.pop();
      if(str.startsWith("repeating")) x.shift();
      if(str.startsWith("repeating")) x.shift();
      return x.join("_");
    }
  } catch(err) {
    log("Earthdawn:repeatSection() error caught: " + err + " section: " + section+ " str: " + str);
  }
}; // end repeatSection



// a version of getSectionIDs that returns the IDs in the order that they are displayed.
// getSectionIDs returns in the order the repeating section lines were created. The user has the ability to reorder the lines.
// getAttrs( [ "_reporderrepeating_" + section_name] , ... ) returns an empty object if the lines were not reordered,
// and may return an incomplete list or a list with items that were since deleted.
// This returns a complete and accurate list in the order that they are displayed.
var getSectionIDsOrdered = function (sectionName, callback) {
  'use strict';
  try{
  getAttrs([`_reporder_${sectionName}`], function (values) {
    let reporder = values[`_reporder_${sectionName}`];
    if( !reporder )
    getSectionIDs( sectionName, callback );     // There is no ordering, so just call the standard getSectionIDs and tell it to run the callback passed to us.
    else
    getSectionIDs( sectionName, function (idArray) {
      callback([...new Set(reporder.toLowerCase().split(",").filter(x => idArray.includes(x)).concat(idArray))]);
    });
  });
  } catch(err) {
    log("Earthdawn:getSectionIDsOrdered() error caught: " + err + " sectionName: " + sectionName);
  }


};  // end getSectionIDsOrdered()



// This is a helper function. It is useful to routines that may be called as part of a repeating section,
// or as part of an iteration through a repeating section.
// In ether case it will return a standardized name of the attribute.
var fullName = function fnfullName( name, ei ) {
  'use strict';
  try{
  if( _.isString( ei )) {
    var u = name.indexOf( "_", name.indexOf( "_")+1);       // Find the 2nd underscore.
    return name.slice( 0, u+1) + ei + name.slice( u);       // If ei is a string, then insert the RowID contained within eventInfo into name and return that.
  } else
  return name;                // If ei is an actual eventInfo object, then simply return name, since the system does not need the rowID if it came from a repeating section.
  } catch(err) {
    log("Earthdawn:fullName() error caught: " + err + " name: " + name+ " ei: " + JSON.stringify(ei));
  }
};  // End fullName



// Figure out the attribute name from eventInfo.
function getAttrib ( ei ) {
  try{
  if ( !ei ) return "";
  else if( _.isString( ei )) return ei;
  else if ( ei["eventname"] ) {
    let x = ei["eventname"].split("_");
    if( x.length < 5 )
    return; // this is the event for the repeating section, not any specific attribute, so we don't have an attribute to work with.
  }
  if ( ei["sourceAttribute"] )
    return ei["sourceAttribute"];
  return ei["eventname"];
  } catch(err) {
    log("Earthdawn:getAttrib() error caught: " + err + " ei: " + JSON.stringify(ei));
  }
}; //end getAttrib


//
//                      This section has the routines that are called by the "on change" routines.
//



var ConditionHealth = function fnConditionHealth() { // If Health is anything other than OK, make sure both blindsided and knocked down are set.
  'use strict';
  try{
  getAttrs([ "condition-Health", "condition-Blindsided", "condition-KnockedDown" ], function gaConditionHealth(values) {
    'use strict';
    // log ( "EarthDawn : ConditionHealth()");
    logvalues( values);
    if ( values[ "condition-Health" ] != "0" ) {
      let vals = {};
      if( values[ "condition-Blindsided" ] != "1" )
      vals[ "condition-Blindsided" ] = "1";
      if( values[ "condition-KnockedDown" ] != "1" )
      vals[ "condition-KnockedDown" ] = "1";
      if( Object.keys(vals).length > 0)
      setAttrsLog( vals );
    }
  });
  } catch(err) {
  log("Earthdawn:ConditionHealth() error caught: " + err );
  }
}; //End ConditionHealth
on("change:condition-health", fn(ConditionHealth) );



var UpdateAdjustGlobalModifiers = function fnUpdateAdjustGlobalModifiers(eventInfo) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAdjustGlobalModifiers()");
  getAttrs([ "Adjust-Effect-Tests-Auto", "effectIsAction", "Wounds",
  "Creature-Fury", "Creature-ResistPain", "Adjust-Effect-Tests-Misc" , "Adjust-Effect-Tests-Total", "combatOption-TailAttack", "condition-Harried",
  "combatOption-DefensiveStance", "Misc-DefStance-Penalty", "Misc-DefStance-Bonus", "condition-KnockedDown", "Adjust-All-Tests-Auto",
  "Adjust-All-Tests-Misc" , "Adjust-All-Tests-Total", "combatOption-AggressiveAttack", "Misc-AggStance-Bonus", "Misc-AggStance-Penalty",  "combatOption-CalledShot", "condition-RangeLong",
  "Creature-Ambush", "Creature-Ambushing", "Creature-DiveCharge", "Creature-DivingCharging" ,"Adjust-Attacks-Misc" , "Adjust-Attacks-Total" , "Adjust-Attacks-Total-CC",
  "Adjust-Attacks-Auto", "Adjust-Attacks-Auto-CC", "Adjust-Damage-Misc", "condition-Cover","condition-Surprised",
  "condition-Blindsided", "Adjust-Defenses-Misc" , "Adjust-Defenses-Total" ], function gaUpdateAdjustGlobalModifiers(values) {
    'use strict';
    logvalues( values);
    let vals={};
    //first deal with not having Aggressive Attack and Defensive Stance active at the same time
    let agg=values[ "combatOption-AggressiveAttack" ];
    let def=values[ "combatOption-DefensiveStance" ];

    //Effect & Action
    // My interpretation of the rules (unclear) is that effect tests are adjusted for little except wounds.
    let effectauto = (getInt( values, "Wounds") * ((getInt( values, "Wounds") <= getInt( values, "Creature-Fury" )) ? 1 : -1 ))
    + Math.min( getInt( values, "Wounds"), getInt( values, "Creature-ResistPain" ));
    let effecttotal = effectauto + getInt( values, "Adjust-Effect-Tests-Misc");

    //Action

    let actionauto= effectauto + (def * getInt( values, "Misc-DefStance-Penalty"))
    - (getInt( values, "condition-Harried") + (getInt( values, "combatOption-TailAttack") * 2)
    + (getInt( values, "condition-KnockedDown") * 3));

    let actiontotal = actionauto + getInt( values, "Adjust-All-Tests-Misc");

    //Attacks

    let attauto = actiontotal + ( getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambush"))
    + ( getInt( values, "Creature-DivingCharging") * getInt( values, "Creature-DiveCharge"))
    - ((getInt( values, "combatOption-CalledShot") * 3)
    + (getInt( values, "condition-RangeLong") *2) );

    let attautocc = attauto +  agg * getInt( values, "Misc-AggStance-Bonus");
    let atttotal = attauto + (getInt( values, "Adjust-Attacks-Misc"));
    let atttotalcc = attautocc + (getInt( values, "Adjust-Attacks-Misc"));

    //Damage

    let dmgauto = effecttotal + ( getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambush"))
    + ( getInt( values, "Creature-DivingCharging") * getInt( values, "Creature-DiveCharge"))
    +  def * getInt( values, "Misc-DefStance-Penalty")
    - (getInt( values, "condition-RangeLong") *2);

    let  dmgautocc = dmgauto + agg * getInt( values, "Misc-AggStance-Bonus");
    let dmgtotal = (dmgauto + (getInt( values, "Adjust-Damage-Misc")));
    let dmgtotalcc = (dmgautocc + (getInt( values, "Adjust-Damage-Misc")));

    //Defenses

    let defauto = getInt( values, "condition-Cover")
    + ( getInt( values, "condition-Blindsided") ? 0 : def    * getInt( values, "Misc-DefStance-Bonus"))     // If blindsided, not only take the -2 below, but also lose Def stance.
    +  agg * ( getInt( values, "Misc-AggStance-Penalty" ))
    - ( getInt( values, "condition-Harried") + (getInt( values, "condition-Surprised") * 3)
    + ( getInt( values, "condition-Blindsided") *2) + (getInt( values, "condition-KnockedDown") *3));
    let deftotal = defauto + getInt( values, "Adjust-Defenses-Misc");

    //Log values for update

    if (actionauto!==values[ "Adjust-All-Tests-Auto" ]) vals[ "Adjust-All-Tests-Auto" ]=actionauto;
    if (actiontotal!==values[ "Adjust-All-Tests-Total" ]) vals[ "Adjust-All-Tests-Total" ]=actiontotal;

    if( values[ "effectIsAction" ] ){
      effectauto=actionauto;
      if (effectauto!==values[ "Adjust-Effect-Tests-Auto" ]) vals[ "Adjust-Effect-Tests-Auto" ]=effectauto;
      effecttotal = effecttotal + getInt( values, "Adjust-Effect-Tests-Misc");
      if (effecttotal!==values[ "Adjust-Effect-Tests-Total" ]) vals[ "Adjust-Effect-Tests-Total" ]=effecttotal;
    } else
    {
      if (effectauto!==values[ "Adjust-Effect-Tests-Auto" ]) vals[ "Adjust-Effect-Tests-Auto" ]=effectauto;
      if (effecttotal!==values[ "Adjust-Effect-Tests-Total" ]) vals[ "Adjust-Effect-Tests-Total" ]=effecttotal;
    };

    if (attauto!==values[ "Adjust-Attacks-Auto" ]) vals[ "Adjust-Attacks-Auto" ]=attauto;
    if (atttotal!==values[ "Adjust-Attacks-Total" ]) vals[ "Adjust-Attacks-Total" ]=atttotal;
    if (attautocc!==values[ "Adjust-Attacks-Auto-CC" ]) vals[ "Adjust-Attacks-Auto-CC" ]=attautocc;
    if (atttotalcc!==values[ "Adjust-Attacks-Total-CC" ]) vals[ "Adjust-Attacks-Total-CC" ]=atttotalcc;

    if (dmgauto!==values[ "Adjust-Damage-Auto" ]) vals[ "Adjust-Damage-Auto" ]=dmgauto;
    if (dmgtotal!==values[ "Adjust-Damage-Total" ]) vals[ "Adjust-Damage-Total" ]=dmgtotal;
    if (dmgautocc!==values[ "Adjust-Damage-Auto-CC" ]) vals[ "Adjust-Damage-Auto-CC" ]=dmgautocc;
    if (dmgtotalcc!==values[ "Adjust-Damage-Total-CC" ]) vals[ "Adjust-Damage-Total-CC" ]=dmgtotalcc;

    if (defauto!==values[ "Adjust-Defenses-Auto" ]) vals[ "Adjust-Defenses-Auto" ]=defauto;
    if (deftotal!==values[ "Adjust-Defenses-Total" ]) vals[ "Adjust-Defenses-Total" ]=deftotal;

    setAttrsLog( vals );
    updateRepStep();

  });
  } catch(err) {
    log("Earthdawn:UpdateAdjustGlobalModifiers() error caught: " + err + " ei: " + JSON.stringify(eventInfo));
  }
}; // End UpdateAdjustGlobalModifiers()
on( "change:effectisaction change:wounds  change:creature-fury   change:creature-resistpain   change:adjust-effect-tests-misc change:combatoption-tailattack   change:condition-harried     change:misc-defstance-penalty change:condition-knockeddown  change:adjust-all-tests-misc     change:misc-aggstance-bonus    change:combatoption-calledshot   change:condition-rangelong  change:creature-ambush   change:creature-ambushing   change:creature-divecharge   change:creature-divingcharging  change:adjust-attacks-misc  change:adjust-damage-misc   change:condition-cover  change:condition-surprised  change:condition-blindsided   change:adjust-defenses-misc ",  fn(UpdateAdjustGlobalModifiers) );



on("change:combatoption-aggressiveattack change:combatoption-defensivestance", fn(function ocCoAggDef( eventInfo) {
  'use strict';
  try{
  let att =getAttrib(eventInfo).toLowerCase();
  getAttrs([ "combatOption-AggressiveAttack", "combatOption-DefensiveStance" ], function gaAggDef(values) {
    'use strict';
    logvalues( values);
    let vals={};
    //first deal with not having Aggressive Attack and Defensive Stance active at the same time
    let agg=values[ "combatOption-AggressiveAttack" ];
    let def=values[ "combatOption-DefensiveStance" ];
    let silent =(  (agg===1 && def===0 && att==="combatoption-defensivestance") ||  (agg===0 && def===1 && att==="combatoption-aggressiveattack"));// In these case, we just arrived here by a double trigger... Ignore the rest

    if (silent) return;
    if ( agg == "1" &&  def== "1"){
      switch(att){
        case "combatoption-defensivestance" : vals[ "combatOption-AggressiveAttack" ]=0; break;
        case "combatoption-aggressiveattack" : vals[ "combatOption-DefensiveStance" ]=0; break;
        default: vals[ "combatOption-AggressiveAttack" ]=0; vals[ "combatOption-DefensiveStance" ]=0;
      }
      setAttrsLog(vals);
    };
    UpdateAdjustGlobalModifiers();
  });
  } catch(err) {
    log("Earthdawn:ocCoAggDef() error caught: " + err + " ei: " + JSON.stringify(eventInfo));
  }
}));  //end ocAggDef



var updateAdjustTN = function fnUpdateAdjustTN() {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAdjustTN()");
  getAttrs([ "combatOption-Reserved", "Adjust-TN-Misc" ], function gaUpdateAdjustTN(values) {
    'use strict';
    logvalues( values);
    let vals={};
    vals["Adjust-TN-Auto"] = getInt( values, "combatOption-Reserved") * 2;
    vals["Adjust-TN-Total"] = getInt( values, "combatOption-Reserved") * 2 + getInt( values, "Adjust-TN-Misc");
    setAttrsLog(vals);
  });
  } catch(err) {
    log("Earthdawn:updateAdjustTN() error caught: " + err);
  }
};  // End updateAdjustTN()
on("change:combatoption-reserved change:adjust-tn-misc", fn(updateAdjustTN) );



// When EffectIsAction is changed, set all the attributes to make all their tests as action tests.
var updateEffectIsAction = function fnUpdateEffectIsAction( eventInfo ) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateEffectIsAction()");
  setAttrsLog({ "Dex-ActnEfct": "1", "Str-ActnEfct": "1", "Tou-ActnEfct": "1", "Per-ActnEfct": "1", "Wil-ActnEfct": "1", "Cha-ActnEfct": "1", "Test-Trigger-3": "1" });
  } catch(err) {
    log("Earthdawn:updateEffectIsAction() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));
  }
}; // End updateEffectIsAction()
on("change:effectisaction", fn(updateEffectIsAction) );



var calculateAttribCosts = function fnCalculateAttribCosts(orig) {  // calculate a single attribute cost depending on the original modifier bought by the player at character creation
  'use strict';
  try{
  var diff = parseInt( orig );
  var cost = Math.max( diff, -2 );
  while ( diff > 3 ) {
    diff -= 3;
    cost += (diff);
  }
  return cost;
  } catch(err) {
    log("Earthdawn:calculateAttribCosts() error caught: " + err + " orig: " + orig);
  }
};  //end calculateAttribCosts



var updateAttribCosts = function fnUpdateAttribCosts() { // At character creation, everybody starts with 25 attribute points to spend
  'use strict';
  try{
  getAttrs( [ "Attrib-Dex-Orig", "Attrib-Str-Orig", "Attrib-Tou-Orig", "Attrib-Per-Orig", "Attrib-Wil-Orig", "Attrib-Cha-Orig", "Attrib-Karma-Orig", "Attr-Costs" ], function gaUpdateAttribCosts(values) {
    'use strict';
    logvalues( values);
    let val = 25;
    val -= calculateAttribCosts( values[ "Attrib-Dex-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Str-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Tou-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Per-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Wil-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Cha-Orig" ]);
    val -= values[ "Attrib-Karma-Orig" ];
    setAttrsLog({ "Attr-Costs": val });
  });
  } catch(err) {
    log("Earthdawn:updateAttribCosts() error caught: " + err);
  }
}; // End updateAttribCosts()
on("change:attrib-dex-orig change:attrib-str-orig change:attrib-tou-orig change:attrib-per-orig change:attrib-wil-orig change:attrib-cha-orig change:attrib-karma-orig", fn(updateAttribCosts));
//JBF : Trigger via Recalc or updateAttribCurr




// calculate the final Value for the @attrib attribute
// This function together with backfillOrigAttrib have to be treated carefully as they have the potential of circular loop. This is prevented by checking eventInfo["sourceType"] at the triggering funciton
// the silent mode of setAttrs would have been another option, but is considered unreliable
var updateAttribCurr = function fnUpdateAttribCurr( attrib) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAttribCurr( " + attrib +" ) "  );
  var curr = "Attrib-" + attrib + "-Curr";
  var orig = "Attrib-" + attrib + "-Orig";
  var race = "Attrib-" + attrib + "-Race";
  let inc = "Attrib-" + attrib + "-Increases";
  var adjust = attrib + "-Adjust-attr";
  getAttrs( [ curr, race, orig, inc, adjust ], function gaUpdateAttribCurr(values) {
    'use strict';
    logvalues( values);
    let vals = {};
    vals[ curr ] = getInt( values, race) + getInt( values, orig) + getInt( values, inc) + getInt( values, adjust );
    if( vals[ curr ] != getInt( values, curr) ) {
      setAttrsLog( vals ); //Silent mode unreliable, so deleted, and replaced by eventInfo["sourceType"] checks at the appropriate places
    }
  });
  } catch(err) {
    log("Earthdawn:updateAttribCurr() error caught: " + err + " attrib: " + attrib);
  }
}; // End updateAttribCurr()
on("change:attrib-dex-orig change:attrib-dex-race change:attrib-dex-increases change:dex-adjust-attr", fn(_.partial(updateAttribCurr, "Dex")));
on("change:attrib-str-orig change:attrib-str-race change:attrib-str-increases change:str-adjust-attr", fn(_.partial(updateAttribCurr, "Str")));
on("change:attrib-tou-orig change:attrib-tou-race change:attrib-tou-increases change:tou-adjust-attr", fn(_.partial(updateAttribCurr, "Tou")));
on("change:attrib-per-orig change:attrib-per-race change:attrib-per-increases change:per-adjust-attr", fn(_.partial(updateAttribCurr, "Per")));
on("change:attrib-wil-orig change:attrib-wil-race change:attrib-wil-increases change:wil-adjust-attr", fn(_.partial(updateAttribCurr, "Wil")));
on("change:attrib-cha-orig change:attrib-cha-race change:attrib-cha-increases change:cha-adjust-attr", fn(_.partial(updateAttribCurr, "Cha")));
//JBF other triggers backfillOrigAttrib and Recalc



// If somebody has changed the attribute step, go back and change the orig to match,
// Note: if you change this code, make sure that updateAttribStep() is also updated and tested to not make an infinite loop due to circular reference does not result.
// IE: make sure that this produces a correct value that updateAttribStep() will not attempt to "correct" and visa versa.
// Also, to ensure no circular loop, backfillOrigAttrib won't be triggered by the API. the API Routine modify() in textImport() will have to be in sync with backfillOrigAttrib and updateAttribStep
var backfillOrigAttrib = function fnBackfillOrigAttrib( attrib ) {
  'use strict';
  try{
  // log ( "EarthDawn : BackfillOrigAttrib( "+ attrib + " )");
  var step = attrib + "-Step";
  var orig = "Attrib-" + attrib + "-Orig";
  var race = "Attrib-" + attrib + "-Race";
  let inc = "Attrib-" + attrib + "-Increases";
  var adjust = attrib + "-Adjust-attr";
  var adjuststep = attrib + "-Adjust";
  getAttrs( [ step, orig, race, inc, adjust, adjuststep ], function gabackfillOrigAttrib(values) {
    'use strict';
    logvalues( values);
    var t = ((getInt( values, step) - getInt( values, adjuststep) -2) * 3) + 1 - (getInt( values, inc) + getInt( values, race) + getInt( values, adjust));
    var cval = getInt( values, orig);
    if( cval < (t - 1) || (t + 1) < cval) {
      let vals = {};
      vals [ orig ] = t;
      setAttrsLog( vals);
      // updateAttribCurr( attrib, true); As the silent mode is unreliable there is no need any more to do manual calls
    }
  });
  } catch(err) {
    log("Earthdawn:backfillOrigAttrib() error caught: " + err + " attrib: " + attrib);
  }
}; // End backfillOrigAttrib()



// Calculate Step from Value for the @attrib attribute
var updateAttribStep = function fnUpdateAttribStep( attrib ) {
  'use strict';
  try{
  // log ( "EarthDawn : updateAttribStep( "+ attrib + " )");
  var step = attrib + "-Step";
  var curr = "Attrib-" + attrib + "-Curr";
  var adjust= attrib + "-Adjust";
  getAttrs( [ step, curr, adjust], function gaUpdateAttribStep(values) {
    'use strict';
    logvalues( values);
    let vals = {};
    vals[ step ] = Math.floor(( getInt( values, curr) - 1) / 3 ) + 2 + getInt( values, adjust);
    if( vals[ step ] != getInt( values, step) )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateAttribStep() error caught: " + err + " attrib: " + attrib);
  }
}; // End updateAttribStep()
//trigger by curr or adjust



var updateAttribFinal = function fnUpdateAttribFinal( base ) {    //calculate Action Test Step for the attribute
  'use strict';
  try{
  // log ( "EarthDawn : updateAttribFinal( "+ base + " )");
  let bs = _.isString( base ) ? base : (base[ "sourceAttribute"].slice(0, 1).toUpperCase() + base[ "sourceAttribute"].slice(1, 3)),
  efct = bs + "-Effect";
  getAttrs( [ bs + "-Step", bs + "-Mods", efct, bs,  "Adjust-Effect-Tests-Total",
  "Adjust-All-Tests-Total"], function gaUpdateAttribFinal(values) {
    'use strict';
    logvalues( values);
    let vals = {},
    both = getInt( values, bs + "-Step")  + getInt( values, bs + "-Mods");
    let e = both + getInt( values, "Adjust-Effect-Tests-Total") ,
    a = both + getInt( values, "Adjust-All-Tests-Total") ;
    if( e != getInt( values, efct) )
    vals[ efct ] = e;
    if( a != getInt( values, bs) )
    vals[ bs ] = a;
    if( _.size( vals ) > 0 )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateAttribFinal() error caught: " + err + " base: " + base);
  }
}; // End updateAttribFinal()
on("change:adjust-all-tests-total change:adjust-effect-tests-total", fn(function ocAdjustAllAttribFinal() {
  'use strict';
  updateAttribFinal( "Dex" );
  updateAttribFinal( "Str" );
  updateAttribFinal( "Tou" );
  updateAttribFinal( "Per" );
  updateAttribFinal( "Wil" );
  updateAttribFinal( "Cha" );
}));
on("change:dex-mods change:str-mods change:tou-mods change:per-mods change:wil-mods change:cha-mods", fn(updateAttribFinal));
//JBF : Other trigger via ocXXXStep



//JBF20201211Inventory Management
/* ===== PARAMETERS ==========
destinations = the name of the attribute that stores the total quantity
can be a single attribute, or an array: ['total_cost', 'total_weight']
If more than one, the matching fields must be in the same order.
section = name of repeating fieldset, without the repeating_
fields = the name of the attribute field to be summed
destination and fields both can be a single attribute: 'weight'
or an array of attributes: ['weight','number','equipped']
*/
const repeatingSum = (destinations, section, fields) => {
  try{
  if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
  if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
  getSectionIDs(`repeating_${section}`, idArray => {
    const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
    getAttrs([...attrArray], v => {
      const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
      const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
      const output = {};
      destinations.forEach((destination, index) => {
        output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
      });
      setAttrs(output);
    });
  });
  } catch(err) {
    log("Earthdawn:repeatingSum() error caught: " + err + " destination: " + destination + " section: " + section);
  }
};//end repeatingSum
on('change:repeating_inventory remove:repeating_inventory', fn(function ocInventoryWeight() {
  repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
  repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
  repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
}));
on('change:repeating_blood remove:repeating_blood', fn(function ocBlood() {
  repeatingSum("Damage-Blood", "blood","BL_Damage-Blood-Magic"  );
}));



on("change:repeating_inventory:inv_carried1 change:repeating_inventory:inv_carried2 change:repeating_inventory:inv_carried3", fn(function ocCarried(eventInfo) {
  'use strict';
  try{
  let att =repeatSection(4,getAttrib(eventInfo)).toLowerCase();
  let pre=buildShortPre(eventInfo,"INV");
  getAttrs([ pre+ "Carried1", pre+"Carried2" , pre+"Carried3"], function gaCarried(values) {
    'use strict';
    logvalues( values);
    if(getInt(values,pre+ "Carried1")+getInt(values,pre+ "Carried2")+getInt(values,pre+ "Carried3")<=1) return; //Only one is set, do nothing
    let vals={};
    switch(att){
      case "carried1" : vals[ pre+"Carried2" ]=0; vals[ pre+"Carried3" ]=0;break;
      case "carried2" : vals[ pre+"Carried1" ]=0; vals[ pre+"Carried3" ]=0;break;
      case "carried3" : vals[ pre+"Carried1" ]=0; vals[ pre+"Carried2" ]=0;break;
      default: log("EarthDawn Mutual Exclusion between inventory containers failed");  vals[ pre+"Carried1" ]=0; vals[ pre+"Carried2" ]=0;vals[ pre+"Carried2" ]=3;
    };
    setAttrsLog(vals, {silent:true});
  });
  } catch(err) {
    log("Earthdawn:ocCarried() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));
  }
})); //End ocCarried


var UpdateCarried = function fnUpdateCarried() {
  'use strict';
  try{
  getAttrs([ "Weight-Equipment","Weight-Gear", "Weight-Supply", "Cont1-Weight","Cont2-Weight","Cont3-Weight","Cont1-Carried", "Cont2-Carried", "Cont3-Carried", "Weight-Coin" ], function gaUpdateCarried(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Weight-Equipment") + getInt( values, "Weight-Supply") + getInt( values, "Weight-Gear") +  getInt( values, "Cont1-Weight")*getInt( values, "Cont1-Carried") + getInt( values, "Cont2-Weight")*getInt( values, "Cont2-Carried") +getInt( values, "Cont3-Weight")*getInt( values, "Cont3-Carried") +getInt( values, "Weight-Coin");

    setAttrsLog({ "Carrying-Carried": val });
  });
  } catch(err) {
    log("Earthdawn:UpdateCarried() error caught: " + err);
  }
};
on("change:weight-equipment change:weight-supply change:weight-gear change:cont1-weight change:cont2-weight change:cont2-weight  change:cont1-carried change:cont2-carried change:cont3-carried change:weight-coin", fn(UpdateCarried) );



var updateCarry = function fnUpdateCarry() {
  'use strict';
  try{
  getAttrs(["Attrib-Str-Curr", "Race", "Misc-Carry-Adjust", "Carrying-Capacity" ], function gaUpdateCarry(values) {
    'use strict';
    logvalues( values);
    var str = getInt( values, "Attrib-Str-Curr") + (( values["Race"] == "Dwarf" ) ? 2 : 0);
    var carry = 5 + getInt( values, "Misc-Carry-Adjust");
    while ( str > 0 ) {
      carry += (str * 5);
      str -= 5;
    }
    if( carry != values[ "Carrying-Capacity" ])
    setAttrsLog({ "Carrying-Capacity": carry });
  });
  } catch(err) {
    log("Earthdawn:updateCarry() error caught: " + err);
  }
}; // End updateCarry()
on("change:misc-carry-adjust", fn(updateCarry) );



var calcED3Death = function fnCalcED3Death(value) { // function used to calculate 3rd edition Death Rating from Tou value
  'use strict';
  try{
  if ( value == 0 ) {
    return 18;
  } else if ( value == 1 ) {
    return 19;
  } else if ( value == 2 ){
    return 20;
  } else {
    return 4 + calcED3Death( value-3 );
  }
  } catch(err) {
    log("Earthdawn:calcED3Death() error caught: " + err);
  }
}; // End calcED3Death()



var updateHealth = function fnUpdateHealth() {
  'use strict';
  try{
  // log ( "EarthDawn : updateHealth() ");
  getAttrs([ "Damage-Unconscious-Adjust", "Attrib-Tou-Curr", "working-Durability", "Damage-Blood", "Damage-Unc-Rating",
  "Damage-Death-Rating", "Damage-Death-Rating-Adjust",  "Tou-Step", "working-Circle", "Durability-Rating-Adjust",
  "Recovery-Tests_max", "Recovery-Tests-Misc-Adjust","Recovery-Tests-Auto-Adjust", "Wound-Threshold-Buff", "Wound-Threshold", "Wound-Threshold-Adjust",
  "Race", "edition" ], function gaUpdateHealth(values) {
    'use strict';
    logvalues( values);
    let vals = {};
    var unc = getInt( values, "Damage-Unconscious-Adjust")  - getInt( values, "Damage-Blood");
    if ( getEdition( values ) == 3 ) {  // 3rd edition Unconsciousness rating
      //Below are the tables of Unconsciousness rates and Wound thresholds for 3rd edition. (Toughness Value - 1) is used as the index to find the corresponding value.
      let ED3Uncon = [10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 24, 26, 27, 28, 30, 31, 32, 34, 35, 36, 39, 40, 41, 43, 44, 45, 47, 48, 49, 51, 52, 53, 55, 56, 57, 59, 60, 61, 63, 64, 65, 67, 68, 69, 71, 72, 73, 75, 76, 77, 80, 81, 82, 84, 85, 86, 88, 89, 90, 92, 93, 94, 96, 97, 98, 100, 101, 102, 104, 105, 106, 108, 109, 110, 112, 113, 114, 116, 117, 118, 120, 121, 122, 124, 125, 126, 128, 129, 130, 132, 133, 134, 136, 137, 138, 140, 141, 142, 144, 145,];
      unc += ED3Uncon[ ((getInt( values, "Attrib-Tou-Curr")>100)?100:getInt( values, "Attrib-Tou-Curr")) -1 ];
    }
    else  // 4th edition Unconsciousness rating
    unc += (getInt( values, "Attrib-Tou-Curr") * 2) + getInt( values, "working-Durability");
    if( unc != values[ "Damage-Unc-Rating" ])
    vals[ "Damage-Unc-Rating" ] = unc;
    let val = getInt( values, "Damage-Death-Rating-Adjust");
    if ( getEdition( values ) == 3 ) { // 3rd edition Death rating
      val += calcED3Death(getInt( values, "Attrib-Tou-Curr"));
    } else  // 4th edition Death rating
    val += unc + getInt( values, "Tou-Step") + getInt( values, "working-Circle") + getInt( values, "Durability-Rating-Adjust")
    - getInt( values, "Damage-Unconscious-Adjust");
    if( val < unc )
    val = unc;      // To simplify entering monsters, if unc has been set to higher than death rating, set death rating to unc.
    if( val != values[ "Damage-Death-Rating" ])
    vals[ "Damage-Death-Rating" ] = val;
    val = getInt( values, "Wound-Threshold-Buff") + getInt( values, "Wound-Threshold-Adjust") + (( values[ "Race" ] == "Obsidiman") ? 3 : 0);
    if ( getEdition( values ) == 3 ) { // 3rd edition Wound threshold
      //Below are the tables of Unconsciousness rates and Wound thresholds for 3rd edition. (Toughness Value - 1) is used as the index to find the corresponding value.
      var ED3WndTreshold = [3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 16, 16, 17, 17, 17, 18, 18, 19, 19, 19, 20, 20, 21, 21, 21, 21, 22, 22, 22, 23, 23, 23, 23, 24, 24, 24, 25, 25, 25, 25, 26, 26, 26, 27, 27, 27, 27, 27, 28, 28, 28, 28, 29, 29, 29, 29, 29, 30, 30, 30, 30, 31, 31, 31, 31, 31, 32, 32, 32, 32, 33, 33, 33, 33, 33, 34, 34, 34, 34, 35, 35, 35, 35];
      val += ED3WndTreshold[ ((getInt( values, "Attrib-Tou-Curr")>100)?100:getInt( values, "Attrib-Tou-Curr")) -1 ];
    } else { // 4th edition Wound threshold
      val += Math.floor((getInt( values, "Attrib-Tou-Curr") +1) / 2 ) +2;
    };
    if( val != values[ "Wound-Threshold" ])
    vals[ "Wound-Threshold" ] = val;
    val = getInt( values, "Recovery-Tests-Misc-Adjust")+getInt( values, "Recovery-Tests-Auto-Adjust")+(( values[ "Race" ] == "Blood Elf") ? -1 : 0);
    if ( getEdition( values ) == 3 ) {    // 3rd edition numbers of Recovery tests NB : here Tou values of 1 and 2 will produce 1 instead of "1/2", due to present version of character sheet not handling non Int values in this field
      val += Math.max( Math.ceil( ( getInt( values, "Attrib-Tou-Curr")-1 ) / 6 ) ,1 );
    } else { // 4th edition numbers of Recovery tests
      val += Math.floor((getInt( values, "Attrib-Tou-Curr") -1) / 6 ) +1;
    };
    if( val != values[ "Recovery-Tests_max" ])
    vals[ "Recovery-Tests_max" ] = val;
    if( Object.keys(vals).length > 0 )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateHealth() error caught: " + err);
  }
}; // End updateHealth()
on("change:working-durability change:damage-unconscious-adjust change:damage-death-rating-adjust change:damage-blood change:wound-threshold-adjust change:wound-threshold-buff change:recovery-tests-misc-adjust change:recovery-tests-auto-adjust", fn(updateHealth) );



var updateInitiative = function fnUpdateInitiative() {
  'use strict';
  try{
  // log ( "EarthDawn : updateInitiative() ");
  getAttrs([ "Initiative", "Initiative-Base", "Initiative-Mods-Auto", "Dex-Step", "Dex-Mods", "Adjust-Effect-Tests-Total", "Misc-Initiative-Adjust","Initiative-Auto-Adjust", "Initiative-Mods", "IP", "Creature-Ambush", "Creature-Ambushing" ], function gaUpdateInitiative(values) {
    'use strict';
    logvalues( values);
    let vals = {},
    modauto = getInt( values, "Adjust-Effect-Tests-Total") - getInt( values, "IP") + getInt( values, "Dex-Mods")
    + (getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambush" )),
    base = getInt( values, "Dex-Step") + getInt( values, "Misc-Initiative-Adjust")  + getInt( values, "Initiative-Auto-Adjust")  ,
    init = base + modauto + getInt( values, "Initiative-Mods") ;
    if( modauto != values[ "Initiative-Mods-Auto" ])
    vals[ "Initiative-Mods-Auto" ] = modauto;
    if( base != values[ "Initiative-Base" ])
    vals[ "Initiative-Base" ] = base;
    if( init != values[ "Initiative" ])
    vals[ "Initiative" ] = init;
    if( Object.keys(vals).length > 0 )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateInitiative() error caught: " + err);
  }
}; // End updateInitiative()
on("change:dex-step change:adjust-effect-tests-total change:misc-initiative-adjust change:initiative-auto-adjust change:initiative-mods change:dex-mods change:ip change:creature-ambush change:creature-ambushing", fn(updateInitiative) );



var updateIP = function fnUpdateIP() {
  'use strict';
  try{
  // log ( "EarthDawn : updateIP() ");
  getAttrs([ "Armor-IP", "Shield-IP", "Misc-IP-Mod", "Misc-IP-Adjust", "condition-NoShield" ], function gaUpdateIP(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Armor-IP") + ((values[ "condition-NoShield" ] == "1") ? 0 : getInt( values, "Shield-IP"))
    + getInt( values, "Misc-IP-Mod") + getInt( values, "Misc-IP-Adjust");
    setAttrsLog({ "IP": val });
  });
  } catch(err) {
    log("Earthdawn:updateIP() error caught: " + err);
  }
};  //end updateIP
on("change:armor-ip change:shield-ip change:misc-ip-mod change:misc-ip-adjust change:condition-noshield", fn(updateIP) );



var updateKarma = function fnUpdateKarma() {
  'use strict';
  try{
  getAttrs([ "Karma-Modifier","Karma-Modifier-Adjust", "working-Circle", "Misc-Karma-max-Adjust", "Attrib-Karma-Orig", "Karma_max",  "edition" ], function gaUpdateKarma(values) {
    'use strict';
    logvalues( values);
    // if ( getEdition( values ) == 4 && getInt( values, "Karma-Modifier" ) != 0) {     // NB : Prior to 4th edition, Karma depends on Karmic Ritual rank, so is entered manually in those versions of the sheet.   Also, if karma modifier is zero (because race is not selected or is "Other", don't set anything since for Dragons we directly enter values we don't want overwritten.
    let val = ((getInt( values, "Karma-Modifier")+getInt( values, "Karma-Modifier-Adjust")) * getInt( values, "working-Circle")) + getInt( values, "Misc-Karma-max-Adjust")  + getInt( values, "Attrib-Karma-Orig") ;
    if( val < 0 )
    val = 0;
    if( val != values[ "Karma_max" ])
    setAttrsLog({ "Karma_max": val });
    // };
  });
  } catch(err) {
    log("Earthdawn:updateKarma() error caught: " + err);
  }
}; // End updateKarma()
on("change:karma-modifier change:karma-modifier-adjust change:working-circle change:misc-karma-max-adjust change:attrib-karma-orig ", fn(updateKarma) );
//Race : via Karma-Modifier -- edition : No Trigger: In editions different than 4 Karma is readonly



var updateLpStatus = function fnUpdateLpStatus() {
  'use strict';
  try{
  // log ( "EarthDawn : updateLpStatus() ");
  getAttrs([ "LP-Total", "LP-Status" ], function gaUpdateLpStatus(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "LP-Total");
    let vals;
    if( val < 10000 )
    vals = { "LP-Status": "LP up to 10,000", "LP-Renown": "16", "LP-Reputation": "NA" };
    else if ( val < 100000 )
    vals = { "LP-Status": "LP 10K to 100K", "LP-Renown": "12", "LP-Reputation": "+2" };
    else if ( val < 1000000 )
    vals = { "LP-Status": "LP 100K to 1M", "LP-Renown": "9", "LP-Reputation": "+4" };
    else
    vals = { "LP-Status": "LP over 1M", "LP-Renown": "7", "LP-Reputation": "+6" };
    if( vals[ "LP-Status" ] != values[ "LP-Status" ])
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateLPStatus() error caught: " + err);
  }
};//end updateLPStatus
on("change:lp-total", fn(updateLpStatus) );



var updateMaBase = function fnupdateMaBase() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMaBase() ");
  getAttrs([ "Attrib-Wil-Curr", "MA-Base", "edition" ], function gaupdateMaBase(values) {
    'use strict';
    logvalues( values);
    let val = 0;
    if ( getEdition( values ) == 3 ) { // 3rd edition MA-Base
      if ( getInt( values, "Attrib-Wil-Curr") > 10)
        val += Math.ceil( ( getInt( values, "Attrib-Wil-Curr") - 10 ) /3 );
    } else    // 4th edition MA-Base
    val += Math.floor( getInt( values, "Attrib-Wil-Curr") / 5 );
    if( val != values[ "MA-Base" ])
      setAttrsLog({ "MA-Base": val });
  });
  } catch(err) {
    log("Earthdawn:updateMaBase() error caught: " + err);
  }
}; // End updateMA()



var calcED3Defense = function fnCalcED3Defense(value) { // function used to calculate 3rd edition Defense value from an Attribute value
  'use strict';
  try{
  if ( value < 6) {
    return Math.floor(value/2)+2;
  } else if (value == 6) {
    return 4 ;
  } else {
    return 3 + calcED3Defense( value-7 );
  };
  } catch(err) {log("Earthdawn:calcED3Defense() error caught: " + err);}
}; // End calcED3Defense()



var updateMD = function fnUpdateMD() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMD() ");
  getAttrs([ "MD-Nat", "MD-Buff", "Defense-Myst-Adjust", "Shield-Myst", "Shield-Myst-Buff", "condition-Blindsided", "condition-NoShield", "Adjust-Defenses-Total", "edition", "MD" ], function gaUpdateMD(values) {
    'use strict';
    logvalues( values);
    let vals={};
    let val = getInt( values, "MD-Nat") + getInt( values, "MD-Buff") + getInt( values, "Defense-Myst-Adjust" );
    let valauto = getInt(values, "Adjust-Defenses-Total");
    if((getEdition( values ) === 4) && (values[ "condition-Blindsided" ] != "1") && (values[ "condition-NoShield" ] != "1")){
      let shield = getInt( values, "Shield-Myst" ) + getInt( values, "Shield-Myst-Buff" );
      val += shield;
      valauto += shield;
    };
    let valunmod= val - valauto - getInt(values, "MD-Buff");
    vals[ "MD" ]=val;
    vals[ "MD-Mod-Auto" ]=valauto;
    vals[ "MD-UnMod" ]=valunmod;
    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:updateMD() error caught: " + err);}
}; // End updateMD()
on("change:md-nat change:defense-myst-adjust change:md-buff change:shield-myst change:shield-myst-buff change:condition-noshield", fn(updateMD) );
//edition via recalc, Adjust-Defenses-Total via md-nat



var updateMovement = function fnUpdateMovement() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMovement() ");
  getAttrs([  "Fly-Movement", "Fly-Movement-Race", "Misc-Fly-Movement-Adjust", "Movement", "Movement-Race", "Misc-Movement-Adjust", "Movement-Buff", "condition-ImpairedMovement",
  "condition-KnockedDown" ], function gaUpdateMovement(values) {
    'use strict';
    logvalues( values);
    let val,fval;
    let auto;
    let base = getInt(values, "Movement-Race") + getInt(values,"Misc-Movement-Adjust");
    let fbase = getInt(values, "Fly-Movement-Race") + getInt(values,"Misc-Fly-Movement-Adjust");
    let vals = {};
    if( values[ "condition-KnockedDown" ] == "1" ) val = 2
    else
    val = base + getInt( values, "Movement-Buff");
    fval = fbase + getInt( values, "Movement-Buff");
    val -= Math.ceil( getInt( values, "condition-ImpairedMovement") * 2.45);
    fval -= Math.ceil( getInt( values, "condition-ImpairedMovement") * 2.45);
    auto = val - base - getInt( values, "Movement-Buff");
    if ( val < 1 )
    val = "1*";
    if ( fval < 1 )
    fval = "1*";
    vals[ "Movement" ] = val;
    vals[ "Movement-Base" ] = base;
    vals[ "Movement-Mod-auto" ] = auto;
    vals[ "Fly-Movement" ] = fval;
    vals[ "Fly-Movement-Base" ] = fbase;
    setAttrsLog( vals );
  });
  } catch(err) {log("Earthdawn:updateMovement() error caught: " + err);}
};  //end updateMovement
on("change:fly-movement-race change:misc-fly-movement-adjust change:movement-race change:misc-movement-adjust change:movement-buff change:condition-impairedmovement change:condition-knockeddown", fn(updateMovement) );



var updateMysticArmor = function fnUpdateMysticArmor() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMysticArmor() ");
  getAttrs([ "Armor-Myst", "MA-Buff", "Armor-Myst-Adjust", "MA-Nat", "condition-Blindsided", "Shield-Myst", "edition" , "Mystic-Armor", "Shield-Myst-Buff", "condition-NoShield"], function gaUpdateMysticArmor(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Armor-Myst") + getInt( values, "Armor-Myst-Adjust") + getInt( values, "MA-Nat") +
    getInt( values, "MA-Buff");
    if((getEdition( values ) != 4) && (values[ "condition-Blindsided" ] != "1") && (values[ "condition-NoShield" ] != "1"))
    val += getInt( values, "Shield-Myst" ) + getInt( values, "Shield-Myst-Buff" ) ;
    if( val != values[ "Mystic-Armor" ])
    setAttrsLog({ "Mystic-Armor": val });
  });
  } catch(err) {log("Earthdawn:updateMysticArmor() error caught: " + err);}
}; // End updateMysticArmor()
on("change:armor-myst change:ma-buff change:armor-myst-adjust change:ma-nat change:condition-blindsided change:shield-myst change:shield-myst-buff change:condition-noshield", fn(updateMysticArmor) );
//edition in recalc



var updateDefensebase = function fnUpdateDefensebase( attr, def) {
  'use strict';
  try{
  // log ( "EarthDawn : updateDefensebase( " + attr + " , " + def + " )");
  let attrib = "Attrib-" + attr + "-Curr",
  defense = def + "-Base";
  getAttrs([ attrib, defense, "edition" ], function gaUpdateDefensebase(values) {
    'use strict';
    logvalues( values);
    let val = 0;
    if ( getEdition( values ) == 3 )  // 3rd edition defense Base
    val += calcED3Defense( getInt( values, attrib) );
    else // 4th edition defense Base
    val += Math.floor(( getInt( values, attrib) +1 ) / 2 ) + 1;
    if( val != values[ defense ]) {
      let vals = {};
      vals[ defense ] = val;
      setAttrsLog( vals );
    }
  });
} catch(err) {log("Earthdawn:updateDefensebase() error caught: " + err + " attr: "+attr + " def: "+def);}
}; // End updateDefensebase()
//Directly triggered in UpdateCurr



// Natural attributes, adjusted only for things specific to Natural values, and combat options and conditions.
var updateDefenseNatural = function fnUpdateDefenseNatural( eventInfo ) {
  'use strict';
  try{
  let att =getAttrib(eventInfo).toLowerCase();
  // log ( "EarthDawn : updateDefenseNatural( " + att + " )");
  let att2, att3, att4, att5, defAdjust = 0;
  if( att.startsWith( "defense-" ) )    // Defense-Phys/Myst/Soc-Nat-Adjust
  att2 = getParam( att, 2, "-").slice( 0,1 ) + "d";
  else if( att.startsWith( "armor-" ) )     // Armor-Phys/Myst-Nat-Adjust
  att2 = getParam( att, 2, "-").slice( 0,1 ) + "a";
  else                          // PD/MD/SD/MA-Base
  att2 = getParam( att, 1, "-");
  switch ( att2 ) {
    case "pd":      att3 = "PD";    att4 = "Defense-Phys-Nat-Adjust"; att5 = "Defense-Phys-Nat-Auto-Adjust";  defAdjust = 1;    break;
    case "md":      att3 = "MD";    att4 = "Defense-Myst-Nat-Adjust"; att5 = "Defense-Myst-Nat-Auto-Adjust";  defAdjust = 1;    break;
    case "sd":      att3 = "SD";    att4 = "Defense-Soc-Nat-Adjust";  att5 = "Defense-Soc-Nat-Auto-Adjust";           break;
    case "pa":      att3 = "PA";    att4 = "Armor-Phys-Nat-Adjust";   att5 = "Armor-Phys-Nat-Auto-Adjust";            break;
    case "ma":      att3 = "MA";    att4 = "Armor-Myst-Nat-Adjust";   att5 = "Armor-Myst-Nat-Auto-Adjust";            break;
    default:
    log("Earthdawn sheetworker error, updateDefenseNatural found " + att );
    return;
  }
  // There is no PA-Base, but this should default gracefully.
  getAttrs([ att3 + "-Base", att4, att5 , att3 + "-Nat", "Race", "Adjust-Defenses-Total"], function gaUpdateDefenseNatural(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, att3 + "-Base") + getInt( values, att4) + Math.max(0,getInt( values, att5))
    + ((getInt( values, "Adjust-Defenses-Total") ) * defAdjust);
    if( att3 === "PD" && values[ "Race" ] == "Windling")   // Windlings get 2 extra PD.
    val += 2;
    if( att3 === "PA" && values[ "Race" ] == "Obsidiman")   // Obsidimen get 3 extra PA.
    val += 3;
    if( val != values[ att3 + "-Nat" ]) {
      let vals = {};
      vals[ att3 + "-Nat" ] = val;
      setAttrsLog( vals );
    }
  });
} catch(err) {log("Earthdawn:updateDefenseNatural() error caught: " + err + " aeventInfottr: "+JSON.stringify(eventInfo));}
}; // End updateDefenseNatural()
on("change:pd-base change:md-base change:sd-base change:defense-phys-nat-adjust change:defense-myst-nat-adjust change:defense-soc-nat-adjust change:armor-phys-nat-adjust change:armor-myst-nat-adjust change:defense-phys-nat-auto-adjust change:defense-myst-nat-auto-adjust change:defense-soc-nat-auto-adjust change:ma-base change:armor-phys-nat-auto-adjust change:armor-myst-nat-auto-adjust", fn(updateDefenseNatural) );
on("change:adjust-defenses-total ", fn(function ocAdjustDefensesTotal() {
  'use strict';
  updateDefenseNatural( "PD" );
  updateDefenseNatural( "MD" );
}));



var updatePD = function fnUpdatePD() {
  'use strict';
  try{
  // log ( "EarthDawn : updatePD() ");
  getAttrs([ "PD-Nat", "PD-Buff","Adjust-Defenses-Total", "Defense-Phys-Adjust", "Shield-Phys", "Shield-Phys-Buff", "condition-Blindsided", "condition-NoShield", "edition", "PD" ], function gaUpdatePD(values) {
    'use strict';
    logvalues( values);
    let vals={};
    let val = getInt( values, "PD-Nat") + getInt( values, "PD-Buff") + getInt( values, "Defense-Phys-Adjust" );
    let valauto= getInt (values, "Adjust-Defenses-Total");
    if((getEdition( values ) === 4) && (values[ "condition-Blindsided" ] != "1") && (values[ "condition-NoShield" ] != "1")){
      let shield = getInt( values, "Shield-Phys" ) + getInt( values, "Shield-Phys-Buff" );
      val+=shield;
      valauto+=shield;
    };
    let valunmod= val - valauto - getInt (values, "PD-Buff");
    vals[ "PD" ] =val;
    vals[ "PD-Mod-Auto" ]=valauto;
    vals[ "PD-UnMod" ]=valunmod;
    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:updatePD() error caught: " + err);}
}; // End updatePD()
on("change:pd-nat change:pd-buff change:defense-phys-adjust change:shield-phys change:shield-phys-buff change:condition-blindsided change:condition-noshield ", fn(updatePD) );
//edition is in recalc. Adjust-Defenses-Total changes the PD-Nat



var updatePhysicalArmor = function fnUpdatePhysicalArmor() {
  'use strict';
  try{
  // log ( "EarthDawn : updatePhysicalArmor() ");
  getAttrs([ "Armor-Phys", "PA-Buff", "Armor-Phys-Adjust", "PA-Nat", "condition-Blindsided", "Shield-Phys", "Shield-Phys-Buff", "edition", "Physical-Armor" , "condition-NoShield"], function gaUpdatePhysicalArmor(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "PA-Nat" ) + getInt( values, "Armor-Phys") + getInt( values, "Armor-Phys-Adjust") + getInt( values, "PA-Buff" );
    if((getEdition( values ) != 4) && (values[ "condition-Blindsided" ] != "1") && (values[ "condition-NoShield" ] != "1"))
    val += getInt( values, "Shield-Phys" ) + getInt( values, "Shield-Phys-Buff" ) ;
    if( val != values[ "Physical-Armor" ])
    setAttrsLog({ "Physical-Armor": val });
  });
  } catch(err) {log("Earthdawn:updatePhysicalArmor() error caught: " + err);}
}; // End updatePhysicalArmor()
on("change:armor-phys change:pa-buff change:armor-phys-adjust change:pa-nat change:condition-blindsided change:condition-noshield change:shield-phys change:shield-phys-buff", fn(updatePhysicalArmor) );
//edition is in recalc



var updateRace = function fnUpdateRace(eventInfo) { // Race based modifiers/characteristics to Attributes
  'use strict';
  try{
  // log ( "EarthDawn : updateRace() ");
  getAttrs(["Race", "edition"], function gaUpdateRace(values) {
    'use strict';
    logvalues( values);
    var race = values["Race"];
    let edition= getEdition( values );
    let trigger = _.isString( eventInfo ); // trigger will confirm if the function was actually triggered by an actual change of the discipline code
    let vals={};
    let rjson;

    function generateRowIdNoUnderscore() {
      return generateRowID().replace(/_/g, "-")
    }

    if(edition==3)
    switch(race){
      case "Dwarf" : rjson={dex: 10, str: 12, tou:13, per:10, wil:10, cha:8, mov:10, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 5, abilities:"Strong Back, Heat Sight"}; break;
      case "Elf" : rjson={dex: 12, str: 10, tou:8, per:11, wil:11, cha:11, mov:14, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Low-Light Vision"}; break;
      case "Human" : rjson={dex: 10, str: 10, tou:10, per:10, wil:10, cha:10, mov:12, karma:5,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Versatility"}; break;
      case "Obsidiman" : rjson={dex: 8, str: 18, tou:13, per:9, wil:10, cha:9, mov:10, karma:3,pain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,abilities:"Natural Armor, Increased Wound Treshold"}; break;
      case "Ork" : rjson={dex: 10, str: 13, tou:11, per:10, wil:8, cha:9, mov:12, karma:5,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Gahad, Low Light Vision"}; break;
      case "Troll" : rjson={dex: 10, str: 14, tou:12, per:9, wil:11, cha:10, mov:14, karma:3,pain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,abilities:"Heat Sight"}; break;
      case "Tskrang" : rjson={dex: 11, str: 10, tou:11, per:10, wil:10, cha:11, mov:12, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Tail Combat"}; break;
      case "Windling" : rjson={dex: 11, str: 4, tou:8, per:11, wil:10, cha:12, mov:6, karma:6,pain:0, onehandmin:1, onehandmax:1, twohandmax: 2 ,abilities:"Flight, Increased PD, Astral Sight"}; break;
      case "Blood Elf" : rjson={dex: 11, str: 10, tou:8, per:11, wil:12, cha:11, mov:14, karma:4,pain:1, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Low-Light Vision, Longing, Pain Resistance, Protected, Thorned"}; break;
      default: rjson={dex: 10, str: 10, tou:10, per:10, wil:10, cha:10, mov:10, karma:0, abilities:""};
    }
    else switch(race){
      case "Dwarf" : rjson={dex: 9, str: 10, tou:12, per:11, wil:11, cha:10, mov:10, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 5 ,abilities:"Strong Back, Heat Sight"}; break;
      case "Elf" : rjson={dex: 12, str: 10, tou:8, per:11, wil:11, cha:11, mov:14, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Low-Light Vision"}; break;
      case "Human" : rjson={dex: 10, str: 10, tou:10, per:10, wil:10, cha:10, mov:12, karma:5,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Versatility"}; break;
      case "Obsidiman" : rjson={dex: 8, str: 18, tou:13, per:9, wil:10, cha:9, mov:10, karma:3,pain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,abilities:"Natural Armor, Increased Wound Treshold"}; break;
      case "Ork" : rjson={dex: 10, str: 13, tou:11, per:10, wil:8, cha:9, mov:12, karma:5,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Gahad, Low Light Vision"}; break;
      case "Troll" : rjson={dex: 10, str: 14, tou:12, per:9, wil:11, cha:10, mov:14, karma:3,pain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,abilities:"Heat Sight"}; break;
      case "Tskrang" : rjson={dex: 11, str: 10, tou:11, per:10, wil:10, cha:11, mov:12, karma:4,pain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Tail Combat"}; break;
      case "Windling" : rjson={dex: 11, str: 4, tou:8, per:11, wil:10, cha:12, mov:6, karma:6,pain:0, onehandmin:1, onehandmax:1, twohandmax: 2 ,abilities:"Flight, Increased PD, Astral Sight"}; break;
      case "Blood Elf" : rjson={dex: 11, str: 10, tou:8, per:11, wil:12, cha:11, mov:14, karma:4,pain:1, onehandmin:1, onehandmax:3, twohandmax: 6 ,abilities:"Low-Light Vision, Longing, Pain Resistance, Protected, Thorned"}; break;
      default: rjson={dex: 10, str: 10, tou:10, per:10, wil:10, cha:10, mov:10, karma:0 ,abilities:""};
    }
    vals["Attrib-Dex-Race"]=rjson.dex;
    vals["Attrib-Str-Race"]=rjson.str;
    vals["Attrib-Tou-Race"]=rjson.tou;
    vals["Attrib-Per-Race"]=rjson.per;
    vals["Attrib-Wil-Race"]=rjson.wil;
    vals["Attrib-Cha-Race"]=rjson.cha;
    vals["Movement-Race"]=rjson.mov;
    vals["Karma-Modifier"]=rjson.karma;
    vals["RacialAbilities"]=rjson.abilities;
    if(rjson.onehandmin) vals["SizeRestriction"]="One Hand : " + rjson.onehandmin +(rjson.onehandmin==rjson.onehandmax? "" : ("-"+rjson.onehandmax))
    +" ,Two Hands : " + (rjson.onehandmax+1) +((rjson.onehandmax+1)==rjson.twohandmax? "" : ("-"+rjson.twohandmax));
    if(rjson.pain) vals["Creature-ResistPain"]=rjson.pain;

    if (race==="Human" && !trigger) {
      let newId = generateRowIdNoUnderscore();
      let newInfo = buildPre( "T", newId );
      vals[newInfo+"RowID"]=newId;
      vals[newInfo+"Type"]="Racial";
      vals[newInfo+"Name"]="Versatility";
    }

    if (race==="Windling") {
      vals["Flight"]= "1";
      vals["Fly-Movement-Race"]= "16";
      if(!trigger){
        let newId = generateRowIdNoUnderscore();
        let newInfo = buildPre( "T", newId );
        vals[newInfo+"RowID"]=newId;
        vals[newInfo+"Type"]="Racial";
        vals[newInfo+"Name"]="Astral Sight";
        vals[newInfo+"Karma-Limit_max"]="0"; //Racial Astral Sight does not allow Karma
      }
    }
    setAttrsLog(vals);
    updateDefenseNatural( "PD");
    updateDefenseNatural( "PA" );
    updateCarry();
    updateHealth();
    updateKarma();
  });
  } catch(err) {log("Earthdawn:updateRace() error caught: " + err);}
}; // End on change Race()
on("change:race", fn(updateRace) );



var updateRecovery = function fnUpdateRecovery() {
  'use strict';
  try{
  // log ( "EarthDawn : updateRecovery() ");
  getAttrs([ "Recovery-Step", "Tou-Effect", "Recovery-Adjust", "Recovery-Buff", "Wounds", "Creature-Fury", "Creature-ResistPain"  ], function gaUpdateRecovery(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Tou-Effect" ) + getInt( values, "Recovery-Adjust") + getInt( values, "Recovery-Buff" )
    - (getInt( values, "Wounds") * (getInt( values, "Wounds") <= getInt( values, "Creature-Fury" ) ? 0 : -1 ))
    - Math.min( getInt( values, "Wounds"), getInt( values, "Creature-ResistPain" ));
    if( val != values[ "Recovery-Step" ])
    setAttrsLog({ "Recovery-Step": val });
  });
} catch(err) {log("Earthdawn:updateRecovery() error caught: " + err);}
}; // End updateRecovery()
on("change:tou-effect change:recovery-adjust change:recovery-buff", fn(updateRecovery) );
//on("change:adjust-all-tests-auto change:adjust-all-tests-misc change:adjust-effect-tests-auto change:adjust-effect-tests-misc change:combatoption-tailattack", fn(function ocConAdjustAllTestsMisc() {
//  'use strict';
//  updateRecovery();
//}));



var updateSD = function fnUpdateSD() {
  'use strict';
  try{
  // log ( "EarthDawn : updateSD() ");
  getAttrs([ "SD-Nat","Defense-Soc-Adjust", "SD-Buff", "SD" ], function gaUpdateSD(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "SD-Nat") + getInt( values, "Defense-Soc-Adjust" ) + getInt( values, "SD-Buff");
    // In most cases SD does not get adjusted with the other ones.
    //  + getInt( values, "Adjust-Defenses-Total" )
    if( val != values[ "SD" ])
    setAttrsLog({ "SD": val });
  });
} catch(err) {log("Earthdawn:updateSD() error caught: " + err);}
}; // End updateSD()
on("change:sd-nat change:defense-soc-adjust change:sd-buff", fn(updateSD) );



var updateWeightCoin = function fnUpdateWeightCoin() {
  'use strict';
  try{
  getAttrs([ "Wealth_Gold", "Wealth_Silver", "Wealth_Copper", "Weight-Coin" ], function gaUpdateWeightCoin(values) {
    'use strict';
    logvalues( values);
    let gold = getInt( values, "Wealth_Gold"), silver = getInt( values, "Wealth_Silver"), copper = getInt( values, "Wealth_Copper"),
    gchanged = false, schanged = false, cchanged = false, loop,
    vals = {};
    do {
      loop = false;   // If a coin is negative, try making change until everything is positive.
      if( gold > 0 && silver < 0 ) { --gold; silver += 10; gchanged = schanged = loop = true;}
      if( (gold > 0 || silver > 0) && copper < 0 ) { --silver; copper += 10; schanged = cchanged = loop = true;}
      if( copper > 99 || silver > 9 && gold < 0 ) { ++gold;   silver -= 10; gchanged = schanged = loop = true;}
      if( copper > 9 && silver < 0 ) { ++silver; copper -= 10; schanged = cchanged = loop = true;}
    } while ( loop );
    let val = Math.round((gold / 80) + (silver / 64 ) + (copper / 48));
    if( val != values[ "Weight-Coin" ])   vals[ "Weight-Coin" ] = val;
    if( gchanged )              vals[ "Wealth_Gold" ] = gold;
    if( schanged )              vals[ "Wealth_Silver" ] = silver;
    if( cchanged )              vals[ "Wealth_Copper" ] = copper;
    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
  } catch(err) {log("Earthdawn:updateWeightCoin() error caught: " + err);}
};
on("change:wealth_gold change:wealth_silver change:wealth_copper", fn(updateWeightCoin) );



var updateWeightEquipment = function fnUpdateWeightEquipment() {
  try{
  'use strict';
  let inArray = [];
  inArray.push( "Weight-Equipment" );
  inArray.push( "Armor-Weight" );
  inArray.push( "Shield-Weight" );
  inArray.push( "Weight-Mod" );
  getSectionIDs("weapons", function(idarray) {
    for(let i=0; i < idarray.length; i++){
      inArray.push( buildPre( "WPN", idarray[ i ]) + "Weight" );
      inArray.push( buildPre( "WPN", idarray[ i ]) + "AmmoQty" );
      inArray.push( buildPre( "WPN", idarray[ i ]) + "AmmoWeight" );
  }
    getAttrs( inArray, function gaUpateWeightEquipment(values) {
      'use strict';
      logvalues( values);
      let val = 0;
      val += getInt( values, "Armor-Weight");
      val += getInt( values, "Shield-Weight");
      val += getInt( values, "Weight-Mod");
      for( let i=0; i < idarray.length; i++ ){
        val += parseFloat( (values[ buildPre( "WPN", idarray[ i ]) + "Weight"])||"0");
        val += getInt( values, buildPre( "WPN", idarray[ i ]) + "AmmoQty")*parseFloat( (values[ buildPre( "WPN", idarray[ i ]) + "AmmoWeight"])||"0");
      }
      if( val !== getInt( values, "Weight-Equipment" ))
      setAttrsLog({ "Weight-Equipment": val });
    });
  });
  } catch(err) {log("Earthdawn:updateWeightEquipment() error caught: " + err);}
}; //end updateWeightEquipment
on("change:armor-weight change:shield-weight change:weight-mod change:repeating_weapons:wpn_weight change:repeating_weapons:wpn_ammoweight change:repeating_weapons:wpn_ammoqty", fn(updateWeightEquipment) );



var updateWeightSupply = function fnUpdateWeightSupply() {
  try{
  'use strict';
  getAttrs([ "Healing_Booster", "Healing_Healing", "Healing_Last_Chance", "Healing_Closure", "Healing_Kit", "Healing_Physician_Kit", "Gear_Rations_Trail", "Gear_Rations_Mine", "Weight-Supply" ], function gaUpdateWeightSupply(values) {
    'use strict';
    logvalues( values);
    let val = Math.round((getInt( values, "Healing_Booster") * 2) + (getInt( values, "Healing_Healing") * 2 ) + getInt( values, "Healing_Last_Chance") +
    getInt( values, "Healing_Closure") + (getInt( values, "Gear_Rations_Trail") * 1.428 ) + (getInt( values, "Gear_Rations_Mine") * 0.8571));
    if( getInt( values, "Healing_Kit") > 0)
    val += 5;
    if( getInt( values, "Healing_Physician_Kit") > 0)
    val += Math.floor((getInt( values, "Healing_Physician_Kit") + 8) / 3);
    if( val != values[ "Weight-Supply" ])
    setAttrsLog({ "Weight-Supply": val });
  });
  } catch(err) {log("Earthdawn:updateWeightSupply() error caught: " + err);}
};  // end updateWeightSupply
on("change:healing_booster change:healing_healing change:healing_last_chance change:healing_closure change:healing_kit change:healing_physician_kit change:gear_rations_trail change:gear_rations_mine", fn(updateWeightSupply) );



var updateTalentSummary = function fnupdateTalentSummary() {
  'use strict';
  try{
    var attarray = ["uatta","edition"];
    // log ( "EarthDawn : updateTalentSummary() ");
    getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(marray) {
      for( let i = 0; i < marray.length; i++) {
        attarray.push( buildPre( "SPM", marray[ i ] ) + "Rank");
        attarray.push( buildPre( "SPM", marray[ i ] ) + "Origin");
      }
      getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
        for( let i = 0; i < tarray.length; i++) {
          attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
          attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
          attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
        }
        getSectionIDsOrdered("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
          for( let i = 0; i < darray.length; i++){
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Code");
            attarray.push( buildPre( "DSP", darray[ i ] ) + "PathName");
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
          }
          getAttrs( attarray , function gaTalentSummary(values) {
            'use strict';
            logvalues( values);
            var s = "",
            nbDisc = 0,
            arr = [],
            circle, ddata,
            vrnk=0,
            uatta=(values["uatta"]=="1"),
            tmp, rnk,val="",nbtalent=0;

            for( let i = 0; i < marray.length; i++) {
              rnk = values[ buildPre( "SPM", marray[ i ] ) + "Rank" ];
              tmp = values[ buildPre( "SPM", marray[ i ] ) + "Origin" ];
              if( tmp.indexOf( "-" ) !== -1 && tmp !== "Item-link" && tmp !== "Free-link")
              arr.push( { type: getParam( tmp, 1, "-"), level: getParam( tmp, 2, "-"), rank: rnk} );
            }

            for( let i = 0; i < tarray.length; i++) {
              rnk = values[ buildPre( "T", tarray[ i ] ) + "Rank" ];
              if(values[ buildPre( "T", tarray[ i ] ) + "Name" ].toLowerCase().startsWith("versatility")) vrnk=rnk; //We have versatility
              tmp = values[ buildPre( "T", tarray[ i ] ) + "Type" ];
              if( !tmp || tmp=="" || tmp=="0")
              tmp= "D1-Novice";
              if( tmp.indexOf( "-" ) != -1)
              arr.push( { type: getParam( tmp, 1, "-"), level: getParam( tmp, 2, "-"), rank: rnk} ); //We're only interested in values with - as they are either Versatility or Discipline or Path or QD
            }

            var artype = _.groupBy( arr, "type");       // Now artype is an object whose named properties are objects (groups) that contain arrays of objects.
            // var artype2 = _.sortBy( artype, x => x[0].type);  // artype2 is an array of arrays of objects.

            // log("artype " + JSON.stringify(artype));
            // log("artype2 " + JSON.stringify(artype2));

            if(vrnk>0 || (artype["V"])){
              val+="Versatility " + (artype["V"] ? artype["V"].length : 0) + " of " + vrnk + "\n";
              artype["V"]=[];
            }

            for( let i = 0; i < darray.length; i++) {
              s = values[ buildPre( "DSP", darray[ i ] ) + "Code" ];
              ddata=DiscData(s,values["edition"], values[ buildPre( "DSP", darray[ i ] ) + "PathName" ],"");
              // log("json " +JSON.stringify(ddata));
              if( ddata.isdisc) { //Discipline D1 - (name) - C5 - Novice DT 8 of 8 TO: 3 of 4, Journeyman DT 1 of 1, TO 0 of 1.   5 of 8 at rank 6+
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                ++nbDisc; // nbDisc is now the number of disciplines

                if(nbDisc<=4){

                  val+="D" + nbDisc + "- " + ddata.name + " - C" + circle
                  + " - Novice DT: " + (artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Novice"}).length) : 0)+ " of " + ( Math.min(8, circle+4))
                  + ", TO: " + (artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Novice"}).length) : 0) + " of " + ( Math.min(4, circle));
                  if(circle > 4 ||  (artype["D"+nbDisc] &&(_.where(artype["D"+nbDisc],{level: "Journeyman"}).length>0)) ||  (artype["TO"+nbDisc] &&(_.where(artype["TO"+nbDisc],{level: "Journeyman"}).length>0)) )
                  val+=" - Journeyman DT: " + (artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Journeyman"}).length) : 0)+ " of " + ( Math.min(4, Math.max(0,circle-4)))
                  + ", TO: " + (artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Journeyman"}).length) : 0) + " of " + ( Math.min(4, Math.max(0,circle-4)));
                  if(circle > 8 ||  (artype["D"+nbDisc] &&(_.where(artype["D"+nbDisc],{level: "Warden"}).length>0)) ||  (artype["TO"+nbDisc] &&(_.where(artype["TO"+nbDisc],{level: "Warden"}).length>0)))
                  val+=" - Warden DT: " + (artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Warden"}).length) : 0)+ " of " + ( Math.min(4, Math.max(0,circle-8)))
                  + ", TO: " + (artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Warden"}).length) : 0) + " of " + ( Math.min(4, Math.max(0,circle-8)));
                  if(circle > 12 ||  (artype["D"+nbDisc] &&(_.where(artype["D"+nbDisc],{level: "Master"}).length>0)) ||  (artype["TO"+nbDisc] &&(_.where(artype["TO"+nbDisc],{level: "Master"}).length>0)))
                  val+=" - Master DT: " + (artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Master"}).length) : 0)+ " of " + ( Math.min(4, Math.max(0,circle-12)))
                  + ", TO: " + (artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Master"}).length) : 0) + " of " + ( Math.min(4, Math.max(0,circle-12)));
                  //Counting Talents
                  nbtalent=0;
                  if(artype["D"+nbDisc])
                  for(let j=0;j<artype["D"+nbDisc].length;j++)
                  if(artype["D"+nbDisc][j]["rank"]>circle) nbtalent++;
                  if(uatta && artype["TO"+nbDisc])
                  for(let j=0;j<artype["TO"+nbDisc].length;j++)
                  if(artype["TO"+nbDisc][j]["rank"]>circle) nbtalent++;

                  val+=" - " + nbtalent + " of " + (circle+4) + " at rank "+(circle+1)+ (nbtalent>=(circle+4) ? (" - Ready for Next Circle " +(uatta ? " (UATTA: you need 1 talent from last circle)":"")) : "") + "\n";
                }
                else val+="D" + nbDisc + "- " + ddata.name +" - The 4th disipline and all the next are counted together. Refer above for the count of Talents \n";
              }
              else if(ddata.ispath){ //Path Path - (name) - Rk5 - Journeyman 4 of 4 , Master  1 of 1
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                val+="Path" + "- " + ddata.name + " - Rk" + circle
                + " - Journeyman : " + (artype["PA"] ? (_.where(artype["PA"],{level: "Journeyman"}).length) : 0)+ " of " + ( Math.min(4, circle));
                if(circle > 4 ||  (artype["PA"] &&(_.where(artype["PA"],{level: "Warden"}).length>0)))
                val+=" - Warden: " + (artype["PA"] ? (_.where(artype["PA"],{level: "Warden"}).length) : 0)+ " of " + ( Math.min(4, Math.max(0,circle-4)));
                if(circle > 8 ||  (artype["PA"] &&(_.where(artype["PA"],{level: "Master"}).length>0)))
                val+=" - Master: " + (artype["PA"] ? (_.where(artype["PA"],{level: "Master"}).length) : 0)+ " of " + ( Math.min(8, Math.max(0,circle-8)));
                val+="\n";
              }
              else if(ddata.isquest){ //QD - (name) - Rk5 - Wollower 4 of 4 , Adherant  1 of 1
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                val+="Questor- Rk" + circle
                + " - Follower : " + (artype["QD"] ? (_.where(artype["QD"],{level: "Follower"}).length) : 0)+ " of " + ( Math.min(4, circle));
                if(circle > 4 ||  (artype["QD"] &&(_.where(artype["QD"],{level: "Adherent"}).length>0)))
                val+=" - Adherent: " + (artype["QD"] ? (_.where(artype["QD"],{level: "Adherent"}).length) : 0)+ " of " + ( Math.min(4, Math.max(0,circle-4)));
                if(circle > 8 ||  (artype["QD"] &&(_.where(artype["QD"],{level: "Exemplar"}).length>0)))
                val+=" - Exemplar: " + (artype["QD"] ? (_.where(artype["QD"],{level: "Exemplar"}).length) : 0)+ " of " + ( Math.min(8, Math.max(0,circle-8)));
                val+="\n";
              }
            }
          setAttrsLog({ "TalentSummary": val });
        });
      });
    });
  });
  } catch(err) {log("Earthdawn:updateTalentSummary() error caught: " + err);}
}; // End updateTalentSummary()
on("change:uatta change:repeating_discipline change:repeating_matrix:spm_rank change:repeating_matrix:spm_origin change:repeating_talents:t_rank change:repeating_talents:t_type remove:repeating_talents remove:repeating_matrix", fn(updateTalentSummary) );



// Split movement can only have two values, checked or . So if it is checked, it must have been  a second ago and visa versa.
// So adjust the value of Harried, assuming that SM used to be in its other state.
var CoSplitMovement = function fnCoSplitMovement() {
  'use strict';
  try{
  getAttrs([ "combatOption-SplitMovement", "condition-Harried" ], function gaCoSplitMovement(values) {
    'use strict';
    logvalues( values);
    var harr = getInt( values, "condition-Harried");
    if( getInt( values, "combatOption-SplitMovement" ))
    harr += (( harr == 0) ? 2 : 1);
    else
    harr -= (( harr == 2) ? 2 : 1);
    harr = Math.max( harr, 0);
    setAttrsLog({ "condition-Harried": harr });
  });
} catch(err) {log("Earthdawn:CoSplitMovement() error caught: " + err);}
};
on("change:combatoption-splitmovement", fn(CoSplitMovement) );



// Note: this routine just sets two hidden values, working-durability and working-circle. These are used in other calculations
//JBF it also sets the Circle for Free Talents and Matrixes, if the appropriate links have been created
// It also sets durability if durability-rating-adjust changed.
var updateDurability = function fnupdateDurability(eventInfo) {
  'use strict';
  try{
   // log ( "EarthDawn : updateDurability() " + JSON.stringify(eventInfo));
  // Go through all the discipline ranks and calculate durability.
  getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
    let i;
    var attarray = [];
    attarray.push("working-Durability");
    attarray.push("working-Circle");
    attarray.push("Durability-Rating-Adjust");
    attarray.push("DP_max");
    attarray.push("DevotionStep");
    for( i = 0; i < darray.length; i++) {
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Code");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Durability");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "LinksProvideValue_max");
    }
    getAttrs( attarray , function gaRdAttarray(values) {
      'use strict';
      logvalues( values);
      let i;
      var resarray = [],
      res2 = [];;
      let vals = {};
      var linkOutList;
      for( i = 0; i < darray.length; i++) {
        linkOutList= values[buildPre( "DSP", darray[ i ] ) + "LinksProvideValue_max"];
        if( linkOutList.length > 2  ) UpdateLinkValue( linkOutList );
        var str1 = buildPre( "DSP", darray[ i ] ) + "Durability";
        var str2 = buildPre( "DSP", darray[ i ] ) + "Circle";
        var str3 = buildPre( "DSP", darray[ i ] ) + "Code"
        var durStored = values[ str1 ] || "-1";
        var tmp = values[ str3 ] || "0";
        var durCalc = parseInt(tmp.slice( tmp.indexOf( ".") +1));
        let sCircle = values[ str2 ] || "0";
        if (tmp === "89.0" ) {    // Questor - make sure devotion points and devotion step are right.
          let circle = parseInt( sCircle );
          let calc = circle * 10;
          if( parseInt( values[ "DP_max" ] ) != calc )
          vals[ "DP_max" ] = calc;
          calc = Math.floor((circle + 11) / 4);
          if( calc != values[ "DevotionStep" ])
          vals[ "DevotionStep" ] = calc.toString();
        } else if( durStored != durCalc && tmp != "0.5" && tmp != "89.0" && tmp != "98.5" && tmp != "99.5") {     // Don't do this if Discipline is Other/Misc or Questor as then the user enters durability manually.
          durStored = durCalc.toString();
          vals[ str1 ] = durCalc;
        }
        if( parseInt( durStored ) > 0  ) {      // Skip questor ranks that don't have durability.
          resarray.push( ("000" + durStored).slice(-3) + ("000" + sCircle).slice(-3) );   // This gives 0DD0CC   Where DD is durability and CC is circle.
          res2.push( ("000" + sCircle).slice(-3) + ("000" + durStored).slice(-3));        // This gives 0CC0DD
        }
      }
      resarray.sort();    // Sorted by Durability followed by Circle.
      var dur = 0,
      cir = 0;
      for( i = resarray.length - 1; i > -1; i--) {      // Go through backwards so starting at highest durability
        var rank = parseInt( resarray[ i ].slice( -3 ));
        if( rank > cir ) {
          dur += (rank - cir) * parseInt(resarray[ i ].slice(0, 3));
          cir = rank;
        }
      }
      res2.sort();
      if( res2.length > 0 )   // Now do Durability Rank Adjust for whatever discipline has the highest rank.
      dur += getInt( values, "Durability-Rating-Adjust") * parseInt( res2[ res2.length -1 ].slice(4));
      // console.log( "Durability: " + dur + " Circle: " + cir);
      if( dur != values[ "working-Durability" ])
      vals[ "working-Durability" ] = dur;
      if( cir != values[ "working-Circle" ])
      vals[ "working-Circle" ] = cir;
      if( Object.keys(vals).length > 0)
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:updateDurability() error caught: " + err);}
}; // End updateDurability
on("change:repeating_discipline change:durability-rating-adjust", fn(updateDurability) );



//JBF@CD This section is for routines used for the management of the links
//LinksProvideValue format is as follows
// Code;RowId,another link
var UpdateLinkValue = function fnUpdateLinkValue( linkOutList ) {
  'use strict';
  try{
    // log("Earthdawn UpdateLinkValue " + JSON.stringify(linkOutList));
  let linkout, i, linkoutlist2;
  let linkOutArray=[];
  let code,rowid;
  if(linkOutList.length>2){
    linkoutlist2=linkOutList.replace("+" , ",")
    linkOutArray = linkOutList.split(",");
  };
  for(i = 0; i <linkOutArray.length; i++ )
  {
    linkout=linkOutArray[ i ];
    code=getParam(linkout, 1 , ";" ) ;
    rowid=getParam(linkout, 2 , ";" );
    switch ( code ) {//Extract the code
      case "NAC":
      case "WPN":
      case "SK":
      case "T":   repRanks(rowid, code , true); break;
      case "SPM": repMatrixType(rowid); break;
      // case "DSP":
      // case "SKK":
      // case "SKAC":
      // case "SKA":
      // case "SKL":
      // case "TI":
      default: log("Earthdawn : Error in UpdateLinkValue : Not a Valid Link" + linkout);
    };
  };
} catch(err) {log("Earthdawn:UpdateLinkValue() error caught: " + err + " linkOutList: "+ linkOutList);}
};//end UpdateLinkValue



// This section has routines that might be called directly by an on change event,
// but could also be called by recalc() as part of an iteration through all their repeating sections.
var repRanks = function fnrepRanks( eventInfo ,code, sil) {
  'use strict';
  try{
    // log("repRanks " + JSON.stringify(eventInfo));
  if ( !eventInfo ) return;
  let att = getAttrib(eventInfo);
  if( !_.isString( eventInfo )) {
    let nm= repeatSection(4,getAttrib(eventInfo)).toLowerCase();
    switch(nm) {
      case "linksgetvalue":
      case "type":
      case "linksgetvalue_max":
      case "linksprovidevalue":
      case "linksprovidevalue_max":
      case "rank":
      case "rank-adjust":
      case "special":break;
      default : return;
    }
  }; //JBF This is code to deal with the fact that API SetWithWorkers doesn't trigger correctly on captialized repeating_section. Could be deleted if roll20 gets its stuff together :)
  let pre=buildShortPre(eventInfo,code);
  let strT = pre + "Effective-Rank",
    strK = pre + "Karma_max",
    strS1 = pre + "Rank",
    strS2 = pre + "Rank-Adjust",
    strS3 = pre + "Special",
    strN  = pre + "Name",
    strli = pre + "LinksGetValue_max",
    strlo = pre + "LinksProvideValue_max",
    strlv = pre + "LinkValue",
    strog = pre + "Type";
  getAttrs([ strS1, strS2, strS3, strT, strK , strli, strlv, strlo, strN, strog ], function gaRepRank(values) {
    'use strict';
    logvalues( values);
    var linkInList= values[strli] || "";
    var linkOutList= values[strlo] || "";
    var linkInArray =[];
    if(linkInList.length>2) linkInArray = linkInList.split(",");
    getAttrs(linkInArray, function gaRepRank2(values2) {
      'use strict';
      let i, link=0, link2=0;
      let vals = {};
      let val;
      for( i = 0; i <linkInArray.length; i++ ) {
        if( repeatSection(3,linkInArray [ i ]).toLowerCase()=="dsp" && values[strog]=="Free" ) link2 += getInt(values2, linkInArray [ i ]);  //for Free Talents Discipline links are summed in the Rank, not in the LinkedValue
        else link += getInt(values2, linkInArray [ i ]);
        };
        if (getInt( values, strlv) != link)   vals[ strlv ] = link;
        if (linkInArray.length>0 && getInt( values, strS1) != link2 && values[strog]=="Free")  { vals[ strS1 ] = link2; val=link2;} //If we are dealing with a free Talent, that is initialized (i.e. has already a link) use link2 as Rank
        else val=getInt( values, strS1);
        val +=  getInt( values, strS2) + link;
        if(values[ strS3 ] === "Karma Ritual")      vals[ "KarmaRitual-Rank" ] = val;
        if(values[ strS3 ] === "Speak Language")      vals[ "LT-Speak-Rank" ] = val;
        if(values[ strS3 ] === "RW Language")      vals[ "LT-ReadWrite-Rank" ] = val;
        // if( val != values[ strT ])
        vals[ strT ] = val;
        // if( vals.length > 0 )
        setAttrsLog( vals );
        if( linkOutList.length > 2  && !sil ) UpdateLinkValue( linkOutList );

        if( att.toLowerCase().includes( "getvalue" ))
          {updateRepStep( att );}   // too much unnecessary calls. Another way have to be found to update after creating a link
    });
  });
} catch(err) {log("Earthdawn:repRanks() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repRanks
// on("change:repeating_talents:t_rank change:repeating_talents:t_rank-adjust change:repeating_talents:t_special change:repeating_talents:t_LinksGetValue change:repeating_talents:t_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_weapons:wpn_rank change:repeating_weapons:wpn_rank-adjust change:repeating_weapons:wpn_special change:repeating_weapons:wpn_LinksGetValue change:repeating_weapons:wpn_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_knacks:nac_rank change:repeating_knacks:nac_rank-adjust change:repeating_knacks:nac_special change:repeating_knacks:nac_LinksGetValue change:repeating_knacks:nac_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_skills:sk_rank change:repeating_skills:sk_rank-adjust change:repeating_skills:sk_special change:repeating_skills:sk_LinksGetValue change:repeating_skills:sk_LinksProvidevalue", fn(repRanks) );
//JBF This is commented out code to deal with the fact that API SetWithWorkers doesn't trigger correctly on captialized repeating_section. Could be deleted if roll20 gets its stuff together :)
on("change:repeating_skills change:repeating_weapons change:repeating_talents change:repeating_knacks", fn(repRanks) );



var repThreadRanks = function fnrepThreadRanks( eventInfo) {
  'use strict';
  try{
  //eventInfo can only be either an automatic eventInfo format generated by a sheetworker change(on trigger, or a string substitute in the format of a full name attribute type repeating_talents_-kgfjghfsdjgsdf-_T_Name. Beware that the name must not contain any underscore
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let code = repeatSection(3,att);
  let rowid = repeatSection(2,att);
  if(rowid && rowid.length<4) log("repThreadRanks incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
  let pre = buildPre(code,rowid);
  let strlo = pre + "LinksProvideValue_max";
  getAttrs([strlo], function gaRepThreadRank(values) {
    'use strict';
    logvalues( values);
    var linkOutList= values[strlo];
    if( linkOutList.length > 2 ) UpdateLinkValue( linkOutList );
  });
} catch(err) {log("Earthdawn:repThreadRanks() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repThreadRanks
on("change:repeating_threads:ti_rank", fn(repThreadRanks) );



var repMatrixType = function fnrepMatrixType( eventInfo ) {
  'use strict';
  try{
    // log("Earthdawn repMatrixType " + JSON.stringify(eventInfo));
  let pre=buildShortPre(eventInfo,"SPM");
  let strS1 = pre + "Type",
  strT1 = pre + "DR",
  strO1 = pre + "Origin",
  strL1 = pre + "LinksGetValue",
  strLM = pre + "LinksGetValue_max",
  strR1 = pre + "Rank";
  getAttrs([ strS1, strO1, strLM ], function gaRmTMatrixType(values) {
    'use strict';
    logvalues( values);
    let val = values[ strS1 ];
    let orig = values[ strO1 ]
    let linkInList= values[strLM];
    let linkInArray =[];
    if(linkInList && linkInList.length>2) linkInArray = linkInList.split(",");
    getAttrs(linkInArray , function gaRmTMatrixType2(values2) {
      if( val === undefined )
      val = -10;
      let vals = {};
      vals[ strT1 ] = Math.abs(val);
      // vals[ strT2 ] = ((val > 0) ? 1 : 0);
      if(orig!=="Free-link" && orig!=="Item-link"){
        vals[ strL1 ] = "";
        vals[ strLM ] = ""; //only Free Matrix and Item Matrix are allowed for a link... Reset Links
      } else{
        let i, link=0;
        for( i = 0; i <linkInArray.length; i++ ) { link += getInt(values2, linkInArray [ i ]); };
        if(link>0) vals[ strR1 ] = link;
      };
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:repMatrixType() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repMatrixType
on("change:repeating_matrix", fn(repMatrixType) );



var DiscData = function fnDiscData(code,edition,pathName,questor){

let vals={name:"" , isdisc:false, ispath:false, isquest:false, issc:false, bonus:[]};
let ed4= (!edition || edition==4);

  switch( code ) {
    case "0.0":  vals.name = "None"; break;
    case "1.5":  vals.name = "Air Sailor"; vals.isdisc=true;
    if(ed4){
       vals.free="Air Sailing"; vals.c1={dt:"Avoid Blow,Climbing,Melee Weapons,Air Weaving,Wind Catcher", to:"Acrobatic Defense,Distract,First Impression,Great Leap,Haggle,Maneuver,Navigation,Speak Language,Taunt,Throwing Weapons" };
       vals.bonus=["","Karma: The adept may spend Karma once per round on any action taken while on board an airship.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1SD","Karma: The adept may spend a Karma Point on Interaction tests.","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "2.5":  vals.name = "Archer"; vals.isdisc=true;
    if(ed4){
        vals.free="Call Missile"; vals.c1={dt:"Avoid Blow,Missile Weapons,Mystic Aim,Arrow Weaving,True Shot", to:"Awareness,Climbing,Creature Analysis,First Impression,Impressive Display,Navigation,Stealthy Stride,Throwing Weapons,Tracking,Wilderness Survival"  };
        vals.bonus=["","Karma: The adept may spend a Karma Point on Perception tests that rely on sight.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1MD","Karma: The adept may spend a Karma Point on Damage tests made with ranged weapons.","+2PD","+1Init","+3PD","Karma: The adept may spend a Karma Point on Recovery tests.","+2MD|+1MA","+1SD|Karma: The adept may spend a Karma Point once per round on a Perception-based test against an opponent they have damaged since the beginning of the previous round.","+4PD|+2Init","+3MD|+1Rec","+5PD|+2MA","+2SD|+3Init"];
    } break;
    case "3.7":  vals.name = "Beastmaster"; vals.isdisc=true;
    if(ed4){
        vals.c1={dt:"Avoid Blow,Claw Shape,Beast Weaving,Unarmed Combat,Wilderness Survival", to:"Acrobatic Defense,Animal Bond,Animal Training,Borrow Sense,Climbing,Creature Analysis,Danger Sense,Enhance Animal Companion,Stealthy Stride,Tracking" };
        vals.bonus=["","","+1PD","Karma: The adept may spend a Karma Point on Recovery tests.","+1SD","Karma: The adept may spend a point of Karma on any unarmed Damage test.","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point per round on any noncombat test made while in the wilderness.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point on an Attack test made against a target they have previously damaged.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "4.7":  vals.name = "Cavalryman"; vals.isdisc=true;
    if(ed4){
        vals.c1={dt:"Animal Bond,Charge,Melee Weapons,Rider Weaving,Trick Riding", to:"Avoid Blow,Battle Shout,Blood Share,Conversation,Creature Analysis,Dominate Beast,First Impression,Heartening Laugh,Speak Language,Sure Mount" };
        vals.bonus=["","","+1PD","Karma: The adept may spend a Karma Point on Attack tests made while charging.","+1SD","Karma: The adept may spend a Karma Point on any Damage tests made while mounted.","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point on a Recovery test.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point on Damage tests made by their mount.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "5.3":  vals.name = "Elementalist"; vals.isdisc=true; vals.issc=true;
    if(ed4){
        vals.c1={dt:"Awareness,Patterncraft,Spellcasting,Elementalism,Wood Skin", to:"Air Speaking,Arcane Mutterings,Astral Sight,Avoid Blow,Climbing,Item History,Standard Matrix,Tracking,Wilderness Survival,Wind Catcher" };
        vals.bonus=["","","+1MD","Karma: The adept may spend a Karma Point on Recovery tests.","+1PD","Karma: The adept may spend a Karma Point to target an additional ally with a spell he is casting.","+2MD","+1Rec","+3MD","Karma: The adept may spend a Karma Point when designing or crafting an item.","+2PD|+1MA","+1SD|Karma: The adept may spend a Karma Point to improve one bonus from a spell they cast on an ally by +2.","+4MD|+2Rec","+3PD|+1Init","+5MD|+2MA","+2SD|+3Rec"];
    } break;
    case "6.3":  vals.name = "Illusionist"; vals.isdisc=true; vals.issc=true;
    if(ed4){
        vals.c1={dt:"False Sight,First Impression,Patterncraft,Spellcasting,Illusionism", to:"Arcane Mutterings,Astral Sight,Awareness,Dead Fall,Mimic Voice,Speak Language,Standard Matrix,Stealthy Stride,Taunt,Winning Smile"  };
        vals.bonus=["","","+1MD","Karma: The adept may spend a Karma Point on Interaction tests.","+1SD","Karma: The adept may spend a Karma Point to add a +2 bonus to a spells Effect Step. The bonus lasts for the full spell duration, even if the spell has multiple Effect tests.","+2MD","+1Init","+3MD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1MA","+1PD|Karma: The adept may spend a Karma Point to target an additional opponent with a spell they are casting. The duplicate spell is an illusion (whether or not the original was), allowing for disbelief or Sensing tests as appropriate.","+4MD|+2Init","+3SD|+1Rec","+5MD|+2MA","+2PD|+3Init"];
    } break;
    case "7.3":  vals.name = "Nethermancer"; vals.isdisc=true; vals.issc=true;
    if(ed4){
        vals.c1={dt:"Astral Sight,Frighten,Patterncraft,Spellcasting,Nethermancy", to:"Arcane Mutterings,Avoid Blow,Awareness,Command Nightflyer,Dispel Magic,Read and Write Language,Speak Language,Standard Matrix,Stealthy Stride,Suppress Curse" };
        vals.bonus=["","","+1MD","Karma: The adept may spend a Karma Point once per round on any test against a Horror, Horror Construct, or undead target.","+1SD","Karma: The adept may spend a Karma Point to increase the targets penalty from a spell he is casting by 2.","+2MD","+1MA","+3MD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Rec","+1PD|Karma: The adept may spend a Karma Point on a Summon or Binding spell they are casting to improve a bonus or Effect Step from the spell by 2, or reduce a penalty from the spell by 2.","+4MD|+2MA","+3SD|+1Init","+5MD|+2Rec","+2PD|+3MA"];
    } break;
    case "8.5":  vals.name = "Scout"; vals.isdisc=true;
    if(ed4){
        vals.free="Navigation"; vals.c1={dt:"Awareness,Climbing,Scout Weaving,Tracking,Wilderness Survival", to:"Anticipate Blow,Avoid Blow,Creature Analysis,Disarm Trap,Great Leap,Lock Picking,Melee Weapons,Missile Weapons,Read and Write Language,Speak Language" };
        vals.bonus=["","Karma: The adept may spend a Karma Point on tests made to find something.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1MD","Karma: The adept may spend a Karma Point on Recovery tests.","+2PD","+1Init","+3PD","Karma: The adept may spend a Karma Point on any test made to escape detection","+2MD|+1Rec","+1SD|Karma: The adept may spend a Karma Point on Attack tests made against opponents who have not yet attacked the adept in that encounter.","+4PD|+2Init","+3MD|+1MA","+5PD|+2Rec","+2SD|+3Init"];
    } break;
    case "9.7":  vals.name = "Sky Raider"; vals.isdisc=true;
    if(ed4){
        vals.c1={dt:"Battle Shout,Climbing,Fireblood,Melee Weapons,Sky Weaving", to:"Air Sailing,Air Speaking,Avoid Blow,Danger Sense,Navigation,Shield Bash,Throwing Weapons,Unarmed Combat,Wilderness Survival,Wind Catcher" };
        vals.bonus=["","","+1PD","Karma: The adept may spend a Karma Point on Recovery tests.","+1SD","Karma: The adept may spend a Karma Point on Damage tests made with melee or throwing weapons at or above the characters one-handed Size limit.","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point on tests to intimidate or cause fear.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point on Attack tests made against an opponent suffering from a fear or intimidation effect.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "10.7": vals.name = "Swordmaster"; vals.isdisc=true;
    if(ed4){
        vals.c1={dt:"Avoid Blow,Maneuver,Melee Weapons,Taunt,Weapon Weaving", to:"Acrobatic Defense,Anticipate Blow,Danger Sense,Distract,Impressive Display,Speak Language,Tiger Spring,Unarmed Combat,Winning Smile,Wound Balance" };
        vals.bonus=["","","+1SD","Karma: The adept may spend a Karma Point on Interaction tests.","+1PD","Karma: The adept may spend a Karma Point on Damage tests made with a melee weapon.","+2SD","+1Init","+2PD","Karma: The adept may spend a Karma Point on Recovery tests.","+3SD|+1Rec","+1MD|Karma: The adept may spend a Karma Point on an Attack test made against an opponent currently affected by Taunt.","+3PD|+2Init","+4SD|+1MA","+4PD|+2Rec","+2MD|+3Init"];
    } break;
    case "11.5": vals.name = "Thief"; vals.isdisc=true;
    if(ed4){
        vals.free="Danger Sense"; vals.c1={dt:"Awareness,Lock Picking,Picking Pockets,Stealthy Stride,Thief Weaving", to:"Avoid Blow,Climbing,First Impression,Great Leap,Melee Weapons,Missile Weapons,Sprint,Surprise Strike,Taunt,Throwing Weapons" };
        vals.bonus=["","Karma: The adept may spend a Karma Point on any Charisma-based test when the adept is attempting to deceive a target.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1SD","Karma: The adept may spend a Karma Point on Attack tests against a Surprised or Blindsided opponent.","+2PD","+1Init","+3PD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Rec","+1MD|Karma: The adept may spend a Karma Point on Damage tests made against targets suffering a penalty to their Physical Defense.","+4PD|+2Init","+3SD|+1MA","+5PD|+2Rec","+2MD|+3Init"];
    } break;
    case "12.5": vals.name = "Troubadour"; vals.isdisc=true;
    if(ed4){
        vals.free="Entertainer"; vals.c1={dt:"Emotion Song,First Impression,Heartening Laugh,Item History,Story Weaving", to:"Avoid Blow,Conversation,Haggle,Impressive Display,Melee Weapons,Read and Write Language,Speak Language,Taunt,Throwing Weapons,Winning Smile" };
        vals.bonus=["","Karma: The adept may spend a Karma Point on Interaction tests.","+1SD","Karma: The adept may spend a Karma Point on any test to gain or recall information, including Knowledge skill tests.","+1MD","Karma: Once per round the adept may spend a Karma Point to add to another characters test by offering encouragement. The target must be able to hear and/or see the Troubadour.","+2SD","+1Init","+3SD","Karma: The adept may spend a Karma Point on Recovery tests.","+2MD|+1MA","+1PD|Karma: The adept may spend a Karma Point once per turn on any test made while adjacent to an ally.","+4SD|+2Init","+3MD|+1Rec","+5SD|+2MA","+2PD|+3Init"];
    } break;
    case "13.7": vals.name = "Warrior"; vals.isdisc=true;
    if(ed4){
         vals.c1={dt:"Avoid Blow,Melee Weapons,War Weaving,Tiger Spring,Wood Skin", to:"Acrobatic Defense,Anticipate Blow,Danger Sense,Distract,Fireblood,Maneuver,Missile Weapons,Shield Bash,Tactics,Unarmed Combat" };
         vals.bonus=["","","+1PD","Karma: The adept may spend a Karma Point on a Recovery test.","+1MD","Karma: The adept may spend a Karma Point on any Damage test made in close combat.","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point once per round on any test made when adjacent to an ally in combat.","+2MD|+1Init","+1SD|Karma: The adept may spend a Karma Point on an Attack test made against an opponent that has attacked the adept since the start of the previous round.","+4PD|+2Rec","+3MD|+1MA","+5PD|+2Init","+2SD|+3Rec"];
    } break;
    case "14.5": vals.name = "Weaponsmith"; vals.isdisc=true;
    if(ed4){
        vals.free="Craftsman"; vals.c1={dt:"Forge Weapon,Item History,Melee Weapons,Steel Thought,Thread Smithing", to:"Avoid Blow,Awareness,Danger Sense,Disarm Trap,Fireblood,First Impression,Haggle,Read and Write Language,Shield Bash,Speak Language" };
        vals.bonus=["","Karma: The adept can spend a Karma Point on any test to craft or repair an item.","+1MD","Karma: The adept may spend a Karma Point on a Recovery test.","+1PD","Karma: The adept can spend a Karma Point on Damage tests he makes with a weapon he crafted.","+2MD","+1MA","+3MD","Karma: The adept may spend a Karma Point once per round on any test being performed by an adjacent ally.","+2PD|+1Rec","+1SD|Karma: The adept may spend a Karma Point on any test to resist the effects of a spell or Horror power.","+4MD|+2MA","+3PD|+1Init","+5MD|+2Rec","+2SD|+3MA"];
    } break;
    case "16.3": vals.name = "Wizard"; vals.isdisc=true;
    if(ed4){
        vals.issc=true; vals.c1={dt:"Dispel Magic,Patterncraft,Research,Spellcasting,Wizardry", to:"Arcane Mutterings,Awareness,Book Memory,Conversation,Creature Analysis,Etiquette,Item History,Read and Write Language,Speak Language,Standard Matrix" };
        vals.bonus=["","","+1MD","Karma: The adept may spend a Karma Point on any test to recall information (including Knowledge tests).","+1SD","Karma: The adept may spend a Karma Point to change the range of a spell from Self to Touch.","+2MD","+1MA","+3MD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Init","+1PD|Karma: The adept may spend a Karma Point to allow an additional extra thread on a spell they are casting. The normal requirements for extra threads still apply; it must be declared in advance and woven as normal. This ability does allow an extra thread when it would otherwise not apply.","+4MD|+2MA","+3SD|+1Rec","+5MD|+2Init","+2PD|+3MA"];
    } break;
    case "20.5": vals.name = "Boatman"; vals.isdisc=true;
    if(ed4){
        vals.free="Pilot Boat"; vals.c1={dt:"Avoid Blow,Climbing,Melee Weapons,River Weaving,Swimming", to:"Acrobatic Defense,Read River,First Impression,Great Leap,Haggle,Maneuver,Unarmed Combat,Speak Language,Taunt,Throwing Weapons" };
        vals.bonus=["","Karma: The adept may spend a Karma Point once per round on any action while on board a riverboat.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1SD","Karma: The adept may spend a Karma Point on Interaction tests","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "23.5": vals.name = "Sailor"; vals.isdisc=true;
    if(ed4){
        vals.free="Sailing"; vals.c1={dt:"Avoid Blow,Climbing,Melee Weapons,Sea Weaving,Swimming", to:"Acrobatic Defense,DIstract,First Impression,Great Leap,Haggle,Maneuver,Navigation,Speak Language,Taunt,Throwing Weapons" };
        vals.bonus=["","Karma: The adept may spend a Karma Point once per round on any action while on board a boat.","+1PD","Karma: The adept may spend a Karma Point on Initiative tests.","+1SD","Karma: The adept may spend a Karma Point on Interaction tests","+2PD","+1Rec","+3PD","Karma: The adept may spend a Karma Point on Recovery tests.","+2SD|+1Init","+1MD|Karma: The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","+4PD|+2Rec","+3SD|+1MA","+5PD|+2Init","+2MD|+3Rec"];
    } break;
    case "21.7": vals.name = "Gauntlet"; vals.isdisc=true;
    if(ed4){
         vals.c1={dt:"Avoid Blow,Body Control,Gauntlet Weaving,Unarmed Combat,Wound Balance", to:"Awareness,Battle Shout,Danger Sense,Etiquette,Fireblood,Item History,Maneuver,Mystic Pursuit,Wilderness Survival,Wood Skin" };
         vals.bonus=["","","+1PD","Karma: The adept may spend a Karma Point on a Recovery test.","+1MD","Karma: The adept may spend a Karma Point on any unarmed Damage test.","+2PD","+1Rec","+2MD","Karma: The adept may spend a Karma Point on any active defense test (e.g.,Avoid Blow, Resist Taunt, Steel Thought, etc.)","+3PD|+1MA","+1SD|Karma: The adept may spend a Karma Point on any unarmed Attack test once per round.","+3MD|+2Rec","+4PD|+1Init","+4MD|+2MA","+2SD|+3Rec"];
    } break;
    case "22.3": vals.name = "Shaman"; vals.isdisc=true;
    if(ed4){
        vals.issc=true; vals.c1={dt:"Awareness,Patterncraft,Shamanism,Spellcasting,Wilderness Survival", to:"Animal Bond,Animal Training,Avoid Blow,Climbing,Creature Analysis,Enhance Animal Companion,Navigation,Standard Matrix,Stealthy Stride,Tracking" };
        vals.bonus=["","","+1MD","Karma: The adept may spend a Karma Point on a test to Summon or interact with a spirit.","+1PD","Karma: The adept may spend a Karma Point to gain the benefit of an extra thread woven for Increased Effect on a spell with the Binding or Spirit keyword. This does not require weaving an extra thread or count against the adepts limits for extra threads.","+2MD","+1Init","+3MD","Karma: The adept may spend a Karma Point on Recovery tests.","+2PD|+1MA","+1SD|Karma: The adept may spend a Karma Point to gain the benefit of an extra thread woven for Increased Range on a spell with the Pack or Spirit keyword. This does not require weaving an extra thread or count against the adepts limits for extra threads.","+4MD|+2Init","+3PD|+1Rec","+5MD|+2MA","+2SD|+3Init"];
    } break;
    case "0.5":  vals.name = (pathName!=undefined && pathName!="") ? pathName : "Other/Misc."; vals.isdisc=true; break;
    case "81.0":
    case "83.0": vals.name = (pathName!=undefined && pathName!="") ? pathName : "Path";  vals.ispath=true;
    if(ed4){
      switch(pathName){
        case "Brother of Stone" : vals.bonus=["","","+1MD","","+1PD","","","+2MD","+1Rec","+2PD","+2Rec","","","","",""]; break;
        case "Fire Eater" : vals.bonus=["","","+1SD","","+1PD","","","","","","","","","","",""]; break;
        case "Horror Stalker" : vals.bonus=["","","+1MD","","+1PD","","+2MD","","+1MA","+2PD","+1Rec","","","","",""]; break;
        case "Liberator" : vals.bonus=["","","+1PD","","+1SD","","+2PD","","+1Rec","+2SD","+2Rec","","","","",""]; break;
        case "Messenger" : vals.bonus=["","","+1SD","","+1MD","","+1PD","","+1Rec","+2SD","+1Init","","","","",""]; break;
        case "Outcast" : vals.bonus=["","","+1SD","","+2SD","","","","","","","","","","",""]; break;
        case "Messenger" : vals.bonus=["","","+1SD","","+1MD","","+1PD","","+1Rec","+2SD","+1Init","","","","",""]; break;
        case "Purifier" : vals.bonus=["","","+1MD","","+2MD","","","","","","","","","","",""]; break;
        case "Scholar" : vals.bonus=["","","+1SD","","+1MD","","","","","","","","","","",""]; break;
        case "Tail Dancer" : vals.bonus=["","","+1PD","","+1SD","","+2PD","","+1Init","+2SD","+2Init","","","","",""]; break;
        case "Windmaster" : vals.bonus=["","","+1SD","","+1MD","","+2PD","","+1Rec","+3PD","+1Init","","","","",""]; break;
        case "Woodsmen" : vals.bonus=["","","+1PD","","+1MD","","+2PD","","+1Init","+2MD","+1Rec","","","","",""]; break;
        default : log("Earthdawn - DiscData - Path - Unknown or undefined Path " + pathName);
      }
    } break;
    case "89.0": vals.name = "Questor";  vals.isquest=true;
    if(ed4){
      switch(questor){
        case "Astendar" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1SD","","Karma: Devotion Ability to be chosen","+2SD","+1MA","+1MD","Karma: Devotion Ability to be chosen","+3SD","+1Rec","+2MD|+2MA","","",""]; break;
        case "Chorrolis" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1SD","","Karma: Devotion Ability to be chosen","+2SD","+1MA","+1MD","Karma: Devotion Ability to be chosen","+3SD","+1Rec","+2MD|+1Init","","",""]; break;
        case "Dis" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+2MD","+1MA","+1SD","Karma: Devotion Ability to be chosen","+3MD","+1Rec","+2SD|+2MA","","",""]; break;
        case "Floranuss" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1PD","","Karma: Devotion Ability to be chosen","+2PD","+1Init","+1SD","Karma: Devotion Ability to be chosen","+3PD","+1Rec","+2SD|+2Init","","",""]; break;
        case "Garlen" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+2MD","+1MA","+1SD","Karma: Devotion Ability to be chosen","+3MD","+1Rec","+2SD|+2MA","","",""]; break;
        case "Jaspree" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+1PD","+1Rec","+2MD","Karma: Devotion Ability to be chosen","+2PD","+1Init","+2SD|+1Rec","","",""]; break;
        case "Lochost" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1SD","","Karma: Devotion Ability to be chosen","+1PD","+1Rec","+2SD","Karma: Devotion Ability to be chosen","+2PD","+1Init","+1MD|+2Rec","","",""]; break;
        case "Mynbruje" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+2MD","+1MA","+1SD","Karma: Devotion Ability to be chosen","+3MD","+2MA","+2SD|+3MA","","",""]; break;
        case "Raggok" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+1PD","+1Rec","+2MD","Karma: Devotion Ability to be chosen","+2PD","+1MA","+3MD|+2Rec","","",""]; break;
        case "Thystonius" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1PD","","Karma: Devotion Ability to be chosen","+2PD","+1Rec","+1SD","Karma: Devotion Ability to be chosen","+3PD","+1Init","+1MD|+1Rec","","",""]; break;
        case "Upandal" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1MD","","Karma: Devotion Ability to be chosen","+2MD","+1MA","+1SD","Karma: Devotion Ability to be chosen","+3MD","+1Rec","+2SD|+2MA","","",""]; break;
        case "Vestrial" : vals.bonus=["","Karma: Devotion Ability to be chosen","","+1SD","","Karma: Devotion Ability to be chosen","+2SD","+1Init","+1PD","Karma: Devotion Ability to be chosen","+3SD","+1MA","+1MD|+2Init","","",""]; break;
        case "Death" : vals.bonus=["","","","","","","","","","","","","","","",""]; break;
        case "Other" : vals.bonus=["","","","","","","","","","","","","","","",""]; break;
        default : log("Earthdawn - DiscData - Questor - Unknown or undefined Passion for Questor " + questor);
      }
    } break;
    case "98.5": vals.name = "Spirit"; break;
    case "99.5": vals.name = "Creature"; break;
    default : log("Earthdawn DiscData unknown code "+code); return vals;
}
return vals;
}; // End DiscData



// With a new discipline, we need a new durability
var repDisciplineCode = function fnrepDisciplineCode( eventInfo ) {
  'use strict';
  try{
  let pre=buildShortPre(eventInfo,"DSP"),
   strT= pre +"Durability",
   strS1= pre + "Code",
   nm = pre + "Name",
   circle = pre + "Circle",
   path = pre + "PathName",
   newflags="",
   trigger = _.isString( eventInfo ); // trigger will confirm if the function was actually triggered by an actual change of the discipline code
  getAttrs([ "edition",strS1, "Durability-Rating-Adjust",circle,"Questor",path], function gaRDisciplineCode(values) {
    'use strict';
    logvalues( values);
    let tmp = values[ strS1 ],
      ddata= DiscData(tmp,values["edition"],values[pre+"PathName"],values["Questor"]),
     val = parseInt(tmp.slice( tmp.indexOf( ".") +1)) + getInt( values, "Durability-Rating-Adjust" ),
     vals = {};

     //Set Name
    vals[nm]=ddata.name;
    if(ddata.issc){
      vals[ "SP-" + ddata.name ] = 1;
      vals["Hide-Spells-Tab"]=0;
    }

    //Set Durability
    if( val != values[ strT ] && tmp !== "0.5" && tmp !== "89.0")   // Never update for Discipline Other/Misc or Questors. They have user set Durability.
      vals[ strT ] = val;
    //Display Talent Creation Button
    vals[ pre+"show-createbutton" ] = ( ddata.c1  && !trigger && getInt( values, circle )===1)  ? 1 :0; //trigger is important to not put back the button on a recalc

    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:repDisciplineCode() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repDisciplineCode
on("change:repeating_discipline:dsp_code change:repeating_discipline:dsp_pathname change:repeating_discipline:dsp_circle", fn(repDisciplineCode) );



// Count Disciplines
 var countDiscipline = function fncountDiscipline() {
   'use strict';
  try{
  let getV=["edition","Defense-Phys-Nat-Auto-Adjust","Defense-Phys-Nat-Adjust","Defense-Myst-Nat-Adjust","Defense-Soc-Nat-Adjust","Armor-Phys-Nat-Adjust","Armor-Myst-Nat-Adjust","Misc-Initiative-Auto-Adjust","Recovery-Tests-Misc-Adjust","Questor","Custom-Karma-Ability"];
  let pre,pre2,i,j,k,l;
  let pd=[0,0,0],md=[0,0,0],sd=[0,0,0],pa=[0,0,0],ma=[0,0,0],rec=[0,0,0],ini=[0,0,0]; //[0] is the global, [1] is current discipline, [2] is Path
  let array=[],array2=[],ddata,ddata2;
  let s="";
  getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(tarray) {
    for( i = 0; i < tarray.length; i++){
      pre = buildPre( "DSP", tarray[ i ]);
      getV = _.union( getV, [ pre + "Code", pre+"Circle",pre+"PathName", pre+"BaseDisc" ]);
    }
    getAttrs( getV , function gacountDiscipline(values) {
      'use strict';
      let disc=0,path=0,quest=0,el=0,il=0,ne=0,wi=0,sh=0;
      let ed=getEdition(values)==4,
          vals ={};
      for( i = 0; i < tarray.length; i++ ){
        pre = buildPre( "DSP", tarray[ i ]);
        array=[],
        array2=[];
        ddata=DiscData(values[pre+"Code"],values["edition"],values[pre+"PathName"],values["Questor"])
        array=ddata.bonus;
        if(ddata.isdisc) disc++;
        if(ddata.isquest) quest++;
        if(ddata.ispath) path++;
        //process array
        if(array && array.length>0) for(j=0;j<=getInt(values,pre+"Circle");j++){
          array2=array[j].split("|");
          for( k=0 ;k<array2.length ; k++ ) {
            if(array2[k].startsWith("Karma:") && !s.includes(array2[k])) s+=(array2[k].substring(array2[k].search("Karma:")+6) + "\n");
            else if(array2[k].endsWith("PD")) pd[1]=Math.max(pd[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("MD")) md[1]=Math.max(md[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("SD")) sd[1]=Math.max(sd[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("PA")) pa[1]=Math.max(pa[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("MA")) ma[1]=Math.max(ma[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("Init")) ini[1]=Math.max(ini[1],parseInt(array2[k].charAt(1)));
            else if(array2[k].endsWith("Rec")) rec[1]=Math.max(rec[1],parseInt(array2[k].charAt(1)));
          };
        }
        //reprocess all DSP to detect attached paths
        for( l = 0; l < tarray.length; l++ ){
          pre2 = buildPre( "DSP", tarray[ l ]);
          array=[],
          array2=[];
          if(( values[pre2 + "Code"] == "81.0" || values[pre2 + "Code"] == "83.0" ) && values[pre2 + "BaseDisc"]==values[pre + "Code"]) {
            ddata2=DiscData(values[pre2 + "Code"],values["edition"],values[pre2+"PathName"],values["Questor"])
            array=ddata2.bonus;
            //process array
          if(array && array.length>0) for(j=0;j<=getInt(values,pre2+"Circle");j++){
            array2=array[j].split("|");
            for( k=0 ;k<array2.length ; k++ ) {
              if(array2[k].startsWith("Karma:") && !s.includes(array2[k])) s+=(array2[k].substring(array2[k].search("Karma:")+6) + "\n");
              else if(array2[k].endsWith("PD")) pd[2]=Math.max(pd[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("MD")) md[2]=Math.max(md[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("SD")) sd[2]=Math.max(sd[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("PA")) pa[2]=Math.max(pa[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("MA")) ma[2]=Math.max(ma[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("Init")) ini[2]=Math.max(ini[2],parseInt(array2[k].charAt(1)));
              else if(array2[k].endsWith("Rec")) rec[2]=Math.max(rec[2],parseInt(array2[k].charAt(1)));
            };
          }
        }
      }
        //Copy discipline & path result in the global var
        pd[0]=Math.max(pd[1]+pd[2],pd[0]);
        md[0]=Math.max(md[1]+md[2],md[0]);
        sd[0]=Math.max(sd[1]+sd[2],sd[0]);
        pa[0]=Math.max(pa[1]+pa[2],pa[0]);
        ma[0]=Math.max(ma[1]+ma[2],ma[0]);
        ini[0]=Math.max(ini[1]+ini[2],ini[0]);
        rec[0]=Math.max(rec[1]+rec[2],rec[0]);
        //reset discipline & path
        pd[1]=0;
        md[1]=0;
        sd[1]=0;
        pa[1]=0;
        ma[1]=0;
        ini[1]=0;
        rec[1]=0;
        pd[2]=0;
        md[2]=0;
        sd[2]=0;
        pa[2]=0;
        ma[2]=0;
        ini[2]=0;
        rec[2]=0;
        if( ddata.isdisc && getInt(values,pre+"Circle")>=13)
         vals["KarmaStep"]="5";

         if(ddata.issc)
          vals["SP-"+ddata.name]=1;

      };

      vals["IsQuestor"]=quest;
      vals["IsPath"]=path;
      vals["NbDisc"]=disc;


      vals["Defense-Phys-Nat-Auto-Adjust"]=pd[0];
      vals["Defense-Myst-Nat-Auto-Adjust"]=md[0];
      vals["Defense-Soc-Nat-Auto-Adjust"]=sd[0];
      vals["Armor-Phys-Nat-Auto-Adjust"]=pa[0];
      vals["Armor-Myst-Nat-Auto-Adjust"]=ma[0];
      vals["Initiative-Auto-Adjust"]=ini[0];
      vals["Recovery-Tests-Auto-Adjust"]=rec[0];
      vals["Karma-Ability"]=s + (values["Custom-Karma-Ability"]||"");
      if(getInt(values,"Defense-Phys-Nat-Auto-Adjust")==-1){ //JBF@CD : Dirty trick : this means this that this just came out of the importer to v2. Offset the adjustments to avoid double accounting
        vals["Defense-Phys-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Phys-Nat-Auto-Adjust")-pd[0]);
        vals["Defense-Myst-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Myst-Nat-Adjust")-md[0]);
        vals["Defense-Soc-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Soc-Nat-Adjust")-sd[0]);
        vals["Armor-Phys-Nat-Adjust"]=Math.max(0,getInt(values,"Armor-Phys-Nat-Adjust")-pa[0]);
        vals["Armor-Myst-Nat-Adjust"]=Math.max(0,getInt(values,"Armor-Myst-Nat-Adjust")-ma[0]);
        vals["Misc-Initiative-Adjust"]=Math.max(0,getInt(values,"Misc-Initiative-Adjust")-ini[0]);
        vals["Recovery-Tests-Misc-Adjust"]=Math.max(0,getInt(values,"Recovery-Tests-Misc-Adjust")-rec[0]);
      }
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:countDiscipline() error caught: " + err );}
 }; // End countDiscipline
on("change:repeating_discipline remove:repeating_discipline change:questor change:custom-karma-ability", fn(countDiscipline) );



// New spell name, See if brand new record that needs a circle and type.
var repSpellName = function fnrepSpellName( eventInfo ) {
  'use strict';
  try{
  let pre=buildShortPre(eventInfo,"SP");
  var rowID = _.isString( eventInfo ) ? eventInfo : eventInfo["sourceAttribute"].slice(16, eventInfo["sourceAttribute"].lastIndexOf("_") -3);
  var strS1 = pre+"Circle";
  var strS2 = pre+"Discipline";
  getAttrs([ strS1, "tab-grim", strS2, "SP-Elementalist", "SP-Illusionist", "SP-Nethermancer", "SP-Shaman", "SP-Wizard", "SP-Power", "edition", "API" ], function gaRsSpellName(values) {
    'use strict';
    logvalues( values);
    var circle = getInt( values, strS1);
    let vals = {};
    if( getInt( values, "API" ) == 0 )    // If the API is not already doing this correctly, then do what you can (store the lowercased variable)
    vals[ pre+"RowID"] = rowID;
    // if( getInt( values, "edition") == 0 ) {     // Due to a bug in Welcome Package, sometimes the api does not run "on add character" and edition ends up being blank. If it is blank, just assign it to 4th edition and hope it is correct. Note that this is also the case if the API is not installed.
    //   values[ "edition" ] = "4";
    //   //   vals[ "edition" ] = "4";
    // }
    var t = getInt( values, "tab-grim");
    if(( circle  == 0) && (t != 0) && (t != 11)) {
      circle = t;
      vals[ strS1 ] = circle;
    }
    if( !(getInt( values, strS2) > 0)) {    // If this record still has SP_Discipline of "-".
      let d1 = getInt( values, "SP-Elementalist"),
      d2 = getInt( values, "SP-Illusionist"),
      d3 = getInt( values, "SP-Nethermancer"),
      d4 = getInt( values, "SP-Wizard"),
      d5 = getInt( values, "SP-Shaman"),
      d6 = getInt( values, "SP-Power");
      if( (d1 + d2 + d3 + d4 + d5 + d6) == 1) {     // If the character only has Talent in one magical art, use that one.
        if( d1 == 1)
        vals[ strS2 ] = "5.3";
        else if( d2 == 1)
        vals[ strS2 ] = "6.3";
        else if( d3 == 1)
        vals[ strS2 ] = "7.3";
        else if( d4 == 1)
        vals[ strS2 ] = "16.3";
        else if( d5 == 1)
        vals[ strS2 ] = "22.3";
        else if( d6 == 1)
        vals[ strS2 ] = "80";
      } else if ((d1 + d2 + d3 + d4 + d5) == 0 )
      vals[ strS2 ] = "80";
    }
    if ( circle != 0 )
    if ( getEdition( values ) == 4 )
    vals[ pre+"Numbers"] = circle + 4 + " / " + (circle + 9) + " / " + (circle + 10) + " / " + (circle + 15);
    else if ( getEdition( values ) == 3 )     // Note: Dispelling, Disbelief, and Sensing Difficulty numbers are real 3rd edition numbers.
    // Weaving and Attuning number are just made up as there was no formula I could find, so I just
    // slapped some numbers in. When in 3rd edition the field is editable, so user can change to the real numbers.
    vals[ pre+"Numbers" ] = ( circle + 4 ) + " / " + (circle + 9)
    + " / " + [ "9", "9", "11", "13", "15", "16", "17", "18", "20", "21", "23", "24", "25", "26", "28", "29"][circle]     // Dispel Difficulty
    + " / " + (circle + 5)      // Disbelief Difficulty
    + " / " + [ "13", "13", "15", "16", "18", "20", "21", "23", "25", "26", "27", "28", "30", "31", "33", "34"][circle];    //  Sensing Difficulty.
    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:repSpellName() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repSpellName
on("change:repeating_spell:sp_name change:repeating_spell:sp_circle", fn(repSpellName ) );



// Copies the spell Effect of the current spell in all talents
var updateSSWillEffect = function fnupdateSSWillEffect(  ) {
  'use strict';
  try{
  let vals =[];
  getSectionIDs("repeating_talents", function gsIdRepeatingTalent(tarray) {
    getAttrs([ "SS-WilEffect"], function gaupdateSSWillEffect(values) {
      'use strict';
      logvalues( values);
      let w = getInt(values,"SS-WilEffect");
      for( let i = 0; i < tarray.length; i++) {
        vals[buildPre("T",tarray[i]) + "WilEffect"]=w;
      }
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:updateSSWillEffect() error caught: " + err );}
}; // End updateSSWillEffect
on("change:ss-wileffect", fn(updateSSWillEffect) );



// If a modification type changes, see if we should hide or reveal the armor type field and the defensive/resistance fields.
//    ModType-ArmorType determines if field asking what type of armor resists the damage shows up. 1 if damage modifiers are used.
//    ActnEfct determines if defensive/resistance fields are displayed.    1 if Action, -1 if Effect. 0 if no Roll.
// Also takes care of updating ModPrefix, that enables/disables Modifiers "?" will trigger a rightly formated query while "x" will make an unvalid query
var repModType = function fnrepModType( eventInfo,code ) {
  try{
  let pre=buildShortPre(eventInfo,code);
  getAttrs([ pre + "Mod-Type", pre + "ModType-ArmorType", pre + "Target", pre + "RowID" ], function gaRModType(values) {
    'use strict';
    logvalues( values);
    let mt = values[ pre + "Mod-Type" ];
    if ( !mt )
    mt = "Action";
    let dmg = mt.startsWith( "Damage" ) ? "1" : "0",
    vals = {};
    if ( dmg === "1" && values[ pre + "Target" ] !== "None" )
      vals[ pre + "Target" ] = "None";
    if( values[ pre + "ModType-ArmorType" ] !== dmg )
      vals[ pre + "ModType-ArmorType" ] = dmg;
    if( mt === "Action" || mt === "Init" || mt == "Armor IP" || mt.startsWith( "Attack" ) )
      vals[ pre + "ActnEfct" ] = "1";
    else {
      vals[ pre + "Defensive" ] = "0";
      vals[ pre + "Resistance" ] = "0";
      if( values[ pre + "Mod-Type" ] === "0" || values[ pre + "Mod-Type" ] === "(0)" )
      {vals[ pre + "ActnEfct" ] = "0";
      vals [pre+"Target"]= "None";
      vals [pre+"ArmorType"]= "N/A";
      }
      else
      vals[ pre + "ActnEfct" ] = "-1";
    }
    vals[pre+"ModPrefix"]= vals[ pre + "ActnEfct" ]=="0" ? "x" :"?";

    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:repModType() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End repModType
on("change:repeating_talents:t_mod-type change:repeating_knacks:nac_mod-type change:repeating_skills:sk_mod-type", fn(repModType) );



// updateRepStep
// When anything changes that a repeating section (talents, knacks, skills, weapons) step number is based upon,
// Go through all the step numbers and recalculate them!
//
// If it is within a repeating section, just need to get the values to calculate one thing.
// If it is an attribute step or a condition that changed, then get all values for all rows, and
//    go through each row and see if it has than attribute or condition and recalculate mods and steps.
var updateRepStep = function fnupdateRepStep( eventInfo ) {
  'use strict';
  try{
     // log("updaterepstep " + JSON.stringify(eventInfo))
      //eventInfo can only be either an automatic eventInfo format generated by a sheetworker change(on trigger, or a string substitute in the format of a full name attribute type repeating_talents_-kgfjghfsdjgsdf-_T_Name. Beware that the name must not contain any underscore
  let att =getAttrib(eventInfo);
  let vals = {}, getV = [ "condition-ImpairedMovement", "condition-Darkness", "combatOption-DefensiveStance",
  "Misc-DefStance-Bonus", "condition-KnockedDown",
  "Adjust-All-Tests-Total", "Adjust-Effect-Tests-Total", "Adjust-Attacks-Total", "Adjust-Attacks-Total-CC",
  "Adjust-Damage-Total", "Adjust-Damage-Total-CC", "Initiative-Mods", "Armor-IP",
  "Dex-Step",  "Dex-Mods", "Str-Step",  "Str-Mods", "Tou-Step",  "Tou-Mods",
  "Per-Step",  "Per-Mods", "Wil-Step",  "Wil-Mods", "Cha-Step",  "Cha-Mods", "Initiative-Mods-Auto" ];

  // this calculates the values for one row, and puts them into val
  // rid is rowID all lower-cased as it is in values.
  function doRow( code, rid, values )  {
    try{
      if(rid && rid.length<4) log("updateRepStep-Dorow incorrect rowid : " + rid + "    code: "+code);
    let pre = buildPre( code, rid),
    preWrite = buildPre( code, values[ pre + "RowID" ] || rid),
    workingMods = ((values[ pre + "ActnEfct" ] !== "1" ) ? 0
    : ((getInt( values, pre + "Defensive" )  * getInt( values, "combatOption-DefensiveStance") * getInt( values, "Misc-DefStance-Bonus"))
    + ( getInt( values, pre + "Resistance" ) * 3 * getInt( values, "condition-KnockedDown" ))))
    - ((getInt( values, pre + "MoveBased" )  * getInt( values, "condition-ImpairedMovement" ))
    + ( getInt( values, pre + "VisionBased" )* getInt( values, "condition-Darkness" ))),
    attribMods = 0,
    modType = 0,
    att = "";
    switch ( values[ pre + "Mod-Type" ] ) {
      case "Action":    modType = getInt( values,  "Adjust-All-Tests-Total" );    break;
      case "Effect":    modType = getInt( values,  "Adjust-Effect-Tests-Total" ); break;
      case "Attack":    modType = getInt( values,  "Adjust-Attacks-Total" );      break;
      case "Attack CC": modType = getInt( values,  "Adjust-Attacks-Total-CC" );   break;
      case "Damage":    modType = getInt( values,  "Adjust-Damage-Total" );       break;
      case "Damage CC": modType = getInt( values,  "Adjust-Damage-Total-CC" );    break;
      case "Init":      modType = getInt( values,  "Initiative-Mods-Auto" ) + getInt( values,  "Initiative-Mods" ) - getInt( values,  "Dex-Mods" ); break; //have to substract Dex-Mods to avoid double counting
      case "Armor IP":  modType = getInt( values,  "Adjust-All-Tests-Total" ) - getInt( values,  "Armor-IP" );    break;
      default: modType = 0;
    }
    att = values[ pre + "Attribute" ];
    if( att && att !=="0")
    attribMods =  getInt( values, att + "-Mods" );
    let modAuto = attribMods + workingMods + modType;
    if( modAuto !== getInt( values, pre + "Mod-Auto" ))
    vals[ preWrite + "Mod-Auto" ] = modAuto;
    let baseStep = getInt( values, pre + "Effective-Rank" ) + ((att && att !=="0")? getInt( values, att + "-Step" ) : 0);
    // if( baseStep !== getInt( values, pre + "BaseStep" ))
    vals[ preWrite + "BaseStep" ] = baseStep;
    let step = baseStep + getInt( values, pre + "Mods" ) + modAuto;
    // if( step !== getInt( values, pre + "Step" ))
    vals[ preWrite + "Step" ] = step;

  } catch(err) {log("Earthdawn:updateRepStep-doRow() error caught: " + err);}

  } // end of function doRow()

  if ( att.startsWith( "repeating_" )) {    // Since the attribute that changed is in a repeating section, all we need to get are the values inside this specific repeating section, and all the outside values.
    let direct=_.isString(eventInfo), //If it is a direct call we will need full names
    code,
    rid=direct? repeatSection(2, att) : undefined;

    switch(repeatSection(1,att)){
      case "talents" : code="T"; break;
      case "skills" : code="SK"; break;
      case "knacks" : code="NAC"; break;
      default: log("Earthdawn : Error illegal att in updateRepStep: " + att);
    }
    let     pre=buildPre(code,rid);


    if ( att.startsWith( "repeating_talents" ) || att.startsWith( "repeating_skills" ) || att.startsWith( "repeating_knacks" )) {

      getV = _.union(getV, [ pre+"RowID", pre+"MoveBased", pre+"VisionBased",
      pre+"Resistance", pre+"Defensive", pre+"ActnEfct",
      pre+"Mod-Auto", pre+"Mod-Type", pre+"Attribute" , pre+"BaseStep",
      pre+"Step", pre+"Mods", pre+"Effective-Rank" ]);
    } else log("Earthdawn : Error illegal att in updateRepStep: " + att);
    getAttrs( getV, function gaUpdateRepStepRepeating(values) {
      'use strict';

      doRow( code, rid, values );

      if( Object.keys(vals).length )
      setAttrsLog( vals );
    });
  } else {      // Since the value that changed is not inside a repeating section, we need to get all the  values needed for our calculations outside the repeating section, plus ALL the repeating sections and their values!
    let i = 0, pre;
    getSectionIDs("repeating_talents", function gsRepStepIdTalents(tarray) {
      for( i = 0; i < tarray.length; i++ ) {
        pre = buildPre( "T", tarray[ i ]);
        getV = _.union( getV, [ pre + "RowID", pre + "MoveBased", pre + "VisionBased", pre + "Resistance", pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto", pre + "Mod-Type", pre + "Attribute" , pre + "BaseStep",
        pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
      }
      getSectionIDs("repeating_knacks", function gsRepStepIdKnacks(karray) {
        for( i = 0; i < karray.length; i++ ) {
          pre = buildPre( "NAC", karray[ i ]);
          getV = _.union( getV, [ pre + "RowID", pre + "MoveBased", pre + "VisionBased", pre + "Resistance", pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto", pre + "Mod-Type", pre + "Attribute" , pre + "BaseStep",
          pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
        }
        getSectionIDs("repeating_skills", function gsRepStepIdSkills(skarray) {
          for( i = 0; i < skarray.length; i++ ) {
            pre = buildPre( "SK", skarray[ i ]);
            getV = _.union( getV, [ pre + "RowID", pre + "MoveBased", pre + "VisionBased", pre + "Resistance", pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto", pre + "Mod-Type", pre + "Attribute" , pre + "BaseStep",
            pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
          }
          getAttrs( getV , function gaUpdateRepStepRepeating(values) {
            'use strict';
            for( i = 0; i < tarray.length; i++ ){
              doRow( "T", tarray[ i ], values );
            };
            for( i = 0; i < karray.length; i++ ){
              doRow( "NAC", karray[ i ], values );
            };
            for( i = 0; i < skarray.length; i++ ){
              doRow( "SK", skarray[ i ], values );
            };
            //if( Object.keys(vals).length )
            setAttrsLog( vals );
          });
        });
      });
    });
  } // end not repeating.
} catch(err) {log("Earthdawn:updateRepStep() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateRepStep()
on("change:repeating_talents:t_movebased change:repeating_talents:t_visionbased change:repeating_talents:t_actnefct change:repeating_talents:t_defensive change:repeating_talents:t_resistance change:repeating_talents:t_mod-type change:repeating_talents:t_attribute change:repeating_talents:t_mods change:repeating_talents:t_effective-rank", fn( updateRepStep ));
on("change:repeating_skills:sk_movebased change:repeating_skills:sk_visionbased change:repeating_skills:sk_actnefct change:repeating_skills:sk_defensive change:repeating_skills:sk_resistance change:repeating_skills:sk_mod-type change:repeating_skills:sk_attribute change:repeating_skills:sk_mods change:repeating_skills:sk_effective-rank", fn( updateRepStep ));
on("change:repeating_knacks:nac_movebased change:repeating_knacks:nac_visionbased change:repeating_knacks:nac_actnefct change:repeating_knacks:nac_defensive change:repeating_knacks:nac_resistance change:repeating_knacks:nac_mod-type change:repeating_knacks:nac_attribute change:repeating_knacks:nac_mods change:repeating_knacks:nac_effective-rank", fn( updateRepStep ));
on("change:condition-impairedmovement change:condition-darkness change:initiative-mods change:initiative-mods-auto  change:dex-step change:dex-mods change:str-step change:str-mods change:tou-step  change:tou-mods change:per-step  change:per-mods change:wil-step change:wil-mods change:cha-step change:cha-mods", fn( updateRepStep ));



    /*        // If an NPC or Mook, default is GM only. If PC or Item, default is public.
    var updateNPC = function fnUpdateNPC() {
    'use strict';

    getAttrs([ "NPC", "RollType" ], function gaUpdateNPC(values) {
    'use strict';
    logvalues( values);

    if ( parseInt( values[ "NPC" ] ) > 0 )    // NPC or Mook
    var x = "/w gm";
    else
    var x = " ";
    if( values[ "RollType"] != x )
    setAttrsLog({ "RollType": x });
  });
};
*/



var updateLanguage = function fnUpdateLangauge( code ) {
  'use strict';
  try{
  getSectionIDs("repeating_skilll", function(idArray) {
    var toGet = [];
    for( let i = 0; i < idArray.length; ++i) {
      toGet.push( buildPre( "SKL", idArray[ i ] ) + (code.endsWith( "S" ) ? "Speak" : "ReadWrite" )
      + (code.startsWith( "T" ) ? "-T" : ""));
    }
    getAttrs( toGet, function gaUpdateLangauge(values) {
      'use strict';
      logvalues( values);
      var cnt = 0, t;
      for( let l = 0; l < toGet.length; ++l){
        t = parseInt( values[ toGet[ l ]] );
        if( t )
        cnt += 1;
      }
      let vals = {};
      // vals[ "SKL_Total" + code.slice( 0, 1) + ( code.endsWith( "S" ) ? "-Speak" : "-ReadWrite") ] = cnt;
      vals[ ( code.startsWith( "S" ) ? "LS" :   "LT") + ( code.endsWith( "S" ) ? "-Speak" : "-ReadWrite") +  ( code.startsWith( "S" ) ? "-Rank" :   "-Known") ] = cnt;
      setAttrsLog( vals );
    });
  });
  } catch(err) {log("Earthdawn:updateLanguage() error caught: " + err +" code: " +code);}
}; // End updateLanguage()

on("change:repeating_skilll:skl_speak", fn(_.partial(updateLanguage, "SS")));
on("change:repeating_skilll:skl_readwrite", fn(_.partial(updateLanguage, "SR")));
on("change:repeating_skilll:skl_speak-t", fn(_.partial(updateLanguage, "TS")));
on("change:repeating_skilll:skl_readwrite-t", fn(_.partial(updateLanguage, "TR")));



var updateSkillType = function fnupdateSkillType( eventInfo ) {
  'use strict';
  try{
  let pre=buildShortPre(eventInfo,"SK");
  let vals={};
  getAttrs( [pre+"Category"], function gaupdateSkillType(values) {
    'use strict';
    logvalues(values);
    switch (values[pre+"Category"]){
      case "Knowledge" :
      vals[pre+"Attribute"]="Per";
      vals[pre+"Target"]="None";
      vals[pre+"Target-NoAPI"]="None";
      break;
      case "Artisan" :
      vals[pre+"Attribute"]="Cha";
      vals[pre+"Target"]="None";
      vals[pre+"Target-NoAPI"]="None";
      break;
      default:
      vals[pre+"Attribute"]="0";
    }
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:updateSkillType() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateSkillType()
on("change:repeating_skills:sk_category", fn(updateSkillType));



var updateCreatureFlags = function fnUpdateCreatureFlags() {
  'use strict';
  try{
  getAttrs([ "Creature-ResistPain", "Creature-Fury", "Creature-HardenedArmor", "Creature-GrabAndBite", "Creature-Hamstring", "Creature-Overrun",
  "Creature-Pounce", "Creature-SqueezeTheLife",  "Opponent-ClipTheWing", "Opponent-CrackTheShell", "Opponent-Defang", "Opponent-Enrage", "Opponent-Provoke", "Opponent-PryLoose","CreatureFlags" ], function gaUpdateCreatureFlags(values) {
    'use strict';
    logvalues( values);
    let flagsCreature = {         // Note: If you change this, also change in .js file.
      Fury:           0x0001,
      ResistPain:     0x0002,
      HardenedArmor:  0x0004,
      GrabAndBite:    0x0100,
      Hamstring:      0x0200,
      Overrun:        0x0400,
      Pounce:         0x0800,
      SqueezeTheLife: 0x1000,
      CreatureMask:   0xffff,
      ClipTheWing:    0x00100000,
      CrackTheShell:  0x00200000,
      Defang:         0x00400000,
      Enrage:         0x00800000,
      Provoke:        0x01000000,
      PryLoose:       0x02000000,
      OpponentMask:   0x1ff00000
    };
    let val = 0;
    if( values[ "Creature-Fury" ] === "1" )           val += flagsCreature.Fury;
    if( values[ "Creature-ResistPain" ] === "1" )     val += flagsCreature.ResistPain;
    if( values[ "Creature-HardenedArmor" ] === "1" )  val += flagsCreature.HardenedArmor;
    if( values[ "Creature-GrabAndBite" ] === "1" )    val += flagsCreature.GrabAndBite;
    if( values[ "Creature-Hamstring" ] === "1" )      val += flagsCreature.Hamstring;
    if( values[ "Creature-Overrun" ] === "1" )        val += flagsCreature.Overrun;
    if( values[ "Creature-Pounce" ] === "1" )         val += flagsCreature.Pounce;
    if( values[ "Creature-SqueezeTheLife" ] === "1" ) val += flagsCreature.SqueezeTheLife;
    if( values[ "Opponent-ClipTheWing" ] === "1" )    val += flagsCreature.ClipTheWing;
    if( values[ "Opponent-CrackTheShell" ] === "1" )  val += flagsCreature.CrackTheShell;
    if( values[ "Opponent-Defang" ] === "1" )         val += flagsCreature.Defang;
    if( values[ "Opponent-Enrage" ] === "1" )         val += flagsCreature.Enrage;
    if( values[ "Opponent-Provoke" ] === "1" )        val += flagsCreature.Provoke;
    if( values[ "Opponent-PryLoose" ] === "1" )       val += flagsCreature.PryLoose;
    if( val != values[ "CreatureFlags" ])
    setAttrsLog({ "CreatureFlags": val });
  });
} catch(err) {log("Earthdawn:updateCreatureFlags() error caught: " + err);}
}; // End updateCreatureFlags()
on("change:creature-resistpain change:creature-fury change:creature-hardenedarmor change:creature-grabandbite change:creature-hamstring change:creature-overrun change:creature-pounce change:creature-squeezethelife change:opponent-clipthewing change:opponent-cracktheshell change:opponent-defang change:opponent-enrage change:opponent-provoke change:opponent-pryloose", fn(updateCreatureFlags));



// When rolling from a sheet, button can use:   @{target|Target|token_id}
// When called from a token action:             @{selected|token_id}
// is much better. If the target has the first, put the second into another variable.
var updateTarget = function fnupdateTarget( eventInfo ) {
  'use strict';
  try{
  let x = (_.isString( eventInfo ) ? eventInfo : eventInfo[ "sourceAttribute"]).split("_");
  x[ x.length -2 ] = x[ x.length -2 ].toUpperCase();
  x.pop();
  x.splice( 2, 1 );   // eventInfo is vandalized by the system. It has been all lowercased, Easiest to just strip the RowID out and let system figure it out (which it does).
  let sa = x.join("_") + "_Target-TA",
  val = eventInfo[ "newValue" ],
  vals = {};
  if( val.slice( 1, 13) == "D1: @{target" )
  val += ": @{selected|token_id}";
  vals[ sa ] = val;
  setAttrsLog( vals );
} catch(err) {log("Earthdawn:updateTarget() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateTarget()
on("change:repeating_talents:t_target change:repeating_knacks:nac_target change:repeating_skills:sk_target", fn( updateTarget ));



// Given an attribute name and value, look at the value and see if it is problematic (has double brackets, quotes, etc) and if so remove the problematic characters.
var sanitize = function fnsanitize( name, value) {
  'use strict';
  try{
  let newVal = value.replace( /[\'|\"|\,|\;|\:\~\\+]/gi, "") // Remove all single and double quotes, commas, colons, semicolons or tildas and charcter #192 which we use as a flag to trigger this routine.
  .replace( /\@\{/gi, "{")        // and all @ signs followed by {
    .replace( /\[+/gi, "[" ).replace( /\]+/gi, "]" ).replace( /\{+/gi, "{" ).replace( /\}+/gi, "}" ).replace( /\(+/gi, "(" ).replace( /\)+/gi, ")" );   // All sequances of more than one [] {} () get replaced by a single one.
    // log("sanitize " + value +" into "+newVal + " for " + name);
    if ( value !== newVal ) {
      let vals = {};
      vals[ name ] = newVal;
      setAttrsLog( vals );
    }
  } catch(err) {log("Earthdawn:sanitize() error caught: " + err );}
}; // End sanitize()



  // Given an attribute name and value, look at the value and shortens Range, Duration ...etc
  var spellsanitize = function fnspellsanitize( name, value) {
    'use strict';
    try{
      log("spellsanitize "+name + " "+value);
    let newVal = value.replace( /yards/gi, " y").replace( /Touch/gi, "T").replace( /Self/gi, "S").replace( / /gi, "").replace( /Rank/gi, "Rk").replace( /Rnd/gi, " rd")
    .replace( /hours/gi, " hr").replace( /Min/gi, " min").replace( /miles/gi, " mi").replace( /Circle/gi, "Cir").replace( /square-yard/gi, " sq-y").replace( /area/gi, "");     // Replace yards by y, Touch by T, Self by S, remove space
    if ( value !== newVal ) {
      let vals = {};
      vals[ name ] = newVal;
      setAttrsLog( vals );
    }
  } catch(err) {log("Earthdawn:spellsanitize() error caught: " + err );}
}; // End spellsanitize()



// Triggered directly by the change of the value
var spellsanitize2 = function fnspellsanitize2( eventInfo ) {
  'use strict';
  try{
    let isStr = _.isString( eventInfo ),
    att, newAtt;
    if( isStr )
    att = eventInfo;
    else {
      att = eventInfo["sourceAttribute"];
    }
    if(!att) return;
    getAttrs([ att ], function gaspellSanitize(values) {
      if(values[att]) spellsanitize(att,values[att]);
  });
} catch(err) {log("Earthdawn:spellsanitize2() error caught: " + err );}
}; // End spellsanitize2()
  on("change:repeating_spells:sp_aoe change:repeating_spells:sp_duration change:repeating_spells:sp_range", fn( spellsanitize2 ));



  // Often Sanitize is called by other routines which are doing other work on that attribute anyway. This routine if for those values that have no other work to be done. It just calls sanitize.
  var preSanitize = function fnpreSanitize( eventInfo ) {
    'use strict';
    try{
    let isStr = _.isString( eventInfo ),
    att, newAtt;
    if( isStr )
    att = eventInfo;
    else {
      // if( eventInfo[ "sourceType" ] !== "player" ) //Deleted these lines to be able to trigger preSanitize during updatecharactersheet
      // return;
      att = eventInfo["sourceAttribute"];
    }
    // log("presanitize " + att);
    // Clumsily deal the the name vandalism.
    if( att.startsWith( "repeating_" ))
    {
      // let ar = att.split( "_" );
      // let pre = buildPre( ar[ ar.length - 2 ] );
      let pre= buildPre( repeatSection( 3, att ), repeatSection( 2, att ));

      if( att.search( /_name$/gi ) !== -1)
      newAtt = pre + "Name";
      else if( att.search( /successtext/gi ) !== -1)
      newAtt = pre + "SuccessText";
      else if( att.search( /basetalent/gi ) !== -1)
      newAtt = pre + "BaseTalent";
      else if( att.search( /restrictuions/gi ) !== -1)
      newAtt = pre + "Restrictions";
      else if( att.search( /range/gi ) !== -1)
      newAtt = pre + "Range";
      else if( att.search( /date/gi ) !== -1)
      newAtt = pre + "Date";
      else if( att.search( /aoe/gi ) !== -1)
      newAtt = pre + "AoE";
      else if( att.search( /man_desc/gi ) !== -1)
      newAtt = pre + "Desc";
    } else {
      newAtt = att.replace( /misc-poolname/gi, "Misc-PoolName" );
      newAtt = att.replace( /armor-name/gi, "Armor-Name" );
      newAtt = att.replace( /armor-date/gi, "Armor-Date" );
      newAtt = att.replace( /shield-name/gi, "Shield-Name" );
      newAtt = att.replace( /shield-date/gi, "Shield-Date" );
      newAtt = att.replace( /wealth_other/gi, "Wealth_Other" );
    }
    if( !isStr && "newValue" in eventInfo)
    sanitize( newAtt, eventInfo[ "newValue"] );
    else
    getAttrs([ newAtt ], function gapreSanitize(values) {
      'use strict';
      sanitize( newAtt, values[ newAtt ] );
    });
  } catch(err) {log("Earthdawn:preSanitize() error caught: " + err );}
}; // End preSanitize()
  on("change:player-name change:charname change:misc-poolname-1 change:misc-poolname-2 change:misc-poolname-3 change:armor-name change:shield-name change:record-date-real change:record-date-throalic change:record-reason change:wealth_other  change:repeating_talents:t_name change:repeating_talents:t_successtext change:repeating_knacks:nac_name change:repeating_knacks:nac_successtext change:repeating_knacks:nac_basetalent change:repeating_knacks:nac_restrictions change:repeating_skills:sk_name change:repeating_skills:sk_successtext change:repeating_skilll:skl_name ", fn( preSanitize ));
  on("change:repeating_spell:sp_name change:repeating_spell:sp_successtext change:repeating_spell:sp_range change:repeating_spell:sp_aoe change:repeating_matrix:spm_successtext change:repeating_weapons:wpn_name change:repeating_weapons:wpn_range change:repeating_weapons:wpn_date change:repeating_mount:mnt_name change:repeating_threads:ti_name change:repeating_maneuvers:man_name change:repeating_maneuvers:man_desc", fn( preSanitize ));



  //JBF  Step Display for Damage of repeating_weapons
  var updateAllWeaponDamage = function fnupdateAllWeaponDamage( eventInfo ) {
    'use strict';
    try{
    let i;
    getSectionIDs("repeating_weapons", function gsupdateAllWeaponDamage(tarray) {
      for( i = 0; i < tarray.length; i++)
      UpdateWeaponDamage( tarray[ i ]);
    });
  } catch(err) {log("Earthdawn:updateAllWeaponDamage() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateAllWeaponDamage
  on("change:adjust-damage-total-cc change:str-mods", fn(updateAllWeaponDamage) );



  var UpdateWeaponDamage = function fnUpdateWeaponDamage( eventInfo ) {
    'use strict';
    try{
    let pre = buildShortPre(eventInfo,"WPN");
    var strCC  = pre +"CloseCombat";
    var strMA  = pre + "Mod-Auto";
    getAttrs([ "Adjust-Damage-Total", "Adjust-Damage-Total-CC", "Str-Mods", strCC, strMA], function gaUpdateWeaponDamage(values) {
      'use strict';
      logvalues( values);
      var closecombat=getInt(values,strCC);
      let vals={};
      if (closecombat !==1 && closecombat!==-1) {closecombat=1; vals[strCC]=1;}; //This is an abnormal case where closecombat didn't initialize. Let's default to close combat
      var AutoMod= getInt(values,"Str-Mods");
      if (closecombat==1){
        AutoMod +=getInt(values,"Adjust-Damage-Total-CC")
      }
      else {
        AutoMod +=getInt(values,"Adjust-Damage-Total")
      };
      vals[ strMA ] =AutoMod
      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:updateWeaponDamage() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End UpdateWeaponDamage
  on("change:repeating_weapons:wpn_closecombat", fn(UpdateWeaponDamage) );



  // This sets the unc rating (minus stun damage taken) into Damage_max, where token bars use it.
  on("change:damage-stun change:damage-unc-rating", fn(function ocDamageStun( eventInfo ) {
    'use strict';
    try{
    getAttrs([ "Damage-Unc-Rating", "Damage-Stun" ], function gaDamageStun(values) {
      'use strict';
      logvalues( values);
      let vals = {};
      vals[ "Damage_max" ] = getInt( values, "Damage-Unc-Rating" ) - getInt( values, "Damage-Stun" );
      setAttrsLog( vals );
    });
  } catch(err) {log("Earthdawn:ocDamageStun() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}));//end ocDamageStun



  on("change:attrib-dex-curr change:dex-adjust", fn(function ocDexCurr() {
    'use strict';
    updateAttribStep("Dex");
    updateDefensebase( "Dex", "PD");
  }));

  on("change:attrib-str-curr change:str-adjust", fn(function ocStrCurr() {
    'use strict';
    updateAttribStep("Str");
    updateCarry();
  }));

  on("change:attrib-tou-curr change:tou-adjust", fn(function ocTouCurr() {
    'use strict';
    updateAttribStep("Tou");
    updateHealth();
  }));

  on("change:attrib-per-curr change:per-adjust", fn(function ocPerCurr() {
    'use strict';
    updateAttribStep("Per");
    updateDefensebase( "Per", "MD");
  }));

  on("change:attrib-wil-curr change:wil-adjust", fn(function ocWilCurr() {
    'use strict';
    updateAttribStep("Wil");
    updateMaBase();
  }));

  on("change:attrib-cha-curr change:cha-adjust", fn(function ocCharCurr() {
    'use strict';
    updateAttribStep("Cha");
    updateDefensebase( "Cha", "SD");
  }));

  on("change:dex-step", fn(function ocDexStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Dex" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Dex" );
  }));

  on("change:str-step", fn(function ocStrStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Str" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Str" );
  }));

  on("change:tou-step", fn(function ocTouStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Tou" );
    updateHealth();
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Tou" )
  }));

  on("change:per-step", fn(function ocPerStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Per" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Per" );
  }));

  on("change:wil-step", fn(function ocWilStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Wil" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Wil" );
  }));

  on("change:cha-step", fn(function ocChaStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Cha" );
    if( eventInfo.sourceType === "player")
    backfillOrigAttrib( "Cha" );
  }));



  var recalc = function fnrecalc(eventInfo){     // Recalculate all calculated fields.
    'use strict';
    try{
    getAttrs([ "wt-test1", "wt-test2", "edition" ], function(values) {         // This is just an event to let the user know that recalculatin has started.
      'use strict';
      log("EarthDawn : Start Recalc( " + JSON.stringify(eventInfo) + " )");
      let v = {},
      x = parseInt( values[ "wt-test1" ]) + 7;
      if(!values["edition"]) {
        log("Earthdawn-Recalc : defaulting new character to Ed.4")
        v["edition"]=4;
        }
      v[ "wt-test2" ] = x;
      setAttrsLog( v );
    });
    let timer = Date.now();
    updateEffectIsAction("True");
    updateRace( "recalc" );
    updateAttribCurr( "Dex" );
    updateAttribCurr( "Str" );
    updateAttribCurr( "Tou" );
    updateAttribCurr( "Per" );
    updateAttribCurr( "Wil" );
    updateAttribCurr( "Cha" );
    updateAttribStep( "Dex" );
    updateAttribStep( "Str" );
    updateAttribStep( "Tou" );
    updateAttribStep( "Per" );
    updateAttribStep( "Wil" );
    updateAttribStep( "Cha" );
    updateAttribFinal( "Dex" );
    updateAttribFinal( "Str" );
    updateAttribFinal( "Tou" );
    updateAttribFinal( "Per" );
    updateAttribFinal( "Wil" );
    updateAttribFinal( "Cha" );
    UpdateKask("Dex-Karma");
    UpdateKask("Str-Karma");
    UpdateKask("Tou-Karma");
    UpdateKask("Per-Karma");
    UpdateKask("Wil-Karma");
    UpdateKask("Cha-Karma");
    UpdateKask("Initiative-Karma");
    UpdateKask("Recovery-Karma");
    UpdateKask("Dex-DP");
    UpdateKask("Str-DP");
    UpdateKask("Tou-DP");
    UpdateKask("Per-DP");
    UpdateKask("Wil-DP");
    UpdateKask("Cha-DP");
    UpdateKask("Initiative-DP");
    UpdateKask("Recovery-DP");
    updateDurability();
    updateAttribCosts();
    updateCarry();
    updateHealth();
    updateInitiative();
    updateIP();
    updateKarma();
    updateLpStatus();
    updateMovement();
    updateDefensebase( "Dex", "PD");
    updateDefensebase( "Per", "MD");
    updateDefensebase( "Cha", "SD");
    updateMaBase();
    updateDefenseNatural( "PD" );
    updateDefenseNatural( "MD" );
    updateDefenseNatural( "SD" );
    updateDefenseNatural( "PA" );
    updateDefenseNatural( "MA" );
    updatePD();
    updateMD();
    updateSD();
    updatePhysicalArmor();
    updateMysticArmor();
    updateRecovery();
    UpdateAdjustGlobalModifiers();
    updateAdjustTN();
    updateWeightCoin();
    updateWeightEquipment();
    updateWeightSupply();
    UpdateCarried();
    ConditionHealth();
    updateCreatureFlags();
    repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
    repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
    repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
    repeatingSum("Damage-Blood", "blood","BL_Damage-Blood-Magic");
    updateRepStep();
    countDiscipline();
    let i;
    getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(tarray) {
      for( i = 0; i < tarray.length; i++)
      repDisciplineCode(tarray[ i ]);
    });
    getSectionIDs("repeating_spell", function gsIdRepeatingSpellName(tarray) {
      for( i = 0; i < tarray.length; i++){
        repSpellName( tarray[ i ]);
        let pre = buildPre( "SP", tarray[ i ]);
        spellsanitize2(pre+"Range");
        spellsanitize2(pre+"AoE");
        spellsanitize2(pre+"Duration");
      }
    });
    getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(tarray) {
      for( i = 0; i < tarray.length; i++)
      repMatrixType( tarray[ i ]);
    });
    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( i = 0; i < tarray.length; i++) {
        preSanitize(buildPre("T",tarray[ i ])+"Name")
        repRanks( tarray[ i ],"T");
        repModType(tarray[ i ],"T");
        UpdateKask(buildPre("T",tarray[ i ])+"Karma");
        UpdateKask(buildPre("T",tarray[ i ])+"DP");
      }
    });
    getSectionIDs("repeating_knacks", function gsIdRepeatingKnacks(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("NAC",tarray[ i ])+"Name")
        repRanks(tarray[ i ],"NAC");
        repModType(tarray[ i ],"NAC");
        UpdateKask(buildPre("NAC",tarray[ i ])+"Karma");
        UpdateKask(buildPre("NAC",tarray[ i ])+"DP");
      }
    });
    getSectionIDs("repeating_skills", function gsIdRepeatingSkills(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("SK",tarray[ i ])+"Name")
        repRanks(tarray[ i ],"SK");
        repModType(tarray[ i ],"SK");
        UpdateKask(buildPre("SK",tarray[ i ])+"Karma");
        UpdateKask(buildPre("SK",tarray[ i ])+"DP");
      }
    });
    getSectionIDs("repeating_weapons", function gsIdRepeatingWeapons(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("WPN",tarray[ i ])+"Name")
        UpdateKask(buildPre("WPN",tarray[ i ])+"Karma");
        UpdateKask(buildPre("WPN",tarray[ i ])+"DP");
        repRanks(tarray[ i ],"WPN");
        UpdateWeaponDamage(tarray[ i ]);
      }
    });
    updateTalentSummary();
    getAttrs([ "wt-test1", "wt-test2" ], function(values) {         // This is just an event to let the user know that recalculation has finished.
      'use strict';
      var x = parseInt( values[ "wt-test1" ]) + 1;
      setAttrsLog({  "wt-test2": x });
    });
    log("Ending recalc() after " + (Date.now() - timer) + " ms.");
  } catch(err) {log("Earthdawn:recalc() error caught: " + err );}
} // end recalc()
  on("change:edition", fn(recalc));



  on("change:specialfunction", fn(function ocSpecialFunction() {
    'use strict';
    try{
    getAttrs(["SpecialFunction" ], function gaSpecialFunction(values) {
      'use strict';
      logvalues( values);
      if( values[ "SpecialFunction" ].trim().endsWith( "Recalc" ))
      recalc();                   // If SpecialFunction has been set to Recalc - Recalculate all calculated fields.
      else if (values[ "SpecialFunction" ].trim().endsWith( "SheetWorkerTest")) {
        log("Earhdawn : SpecialFunction SheetWorkerTest");
      } // End SheetWrokerTest code
    });
  } catch(err) {log("Earthdawn:ocSpecialFunct() error caught: " + err );}
})); // End ocSpecialFunct



  on("clicked:newday", fn(function ocNewDay() {
    'use strict';
    try{
    getAttrs([ "Karma_max","Karma", "Recovery-Tests","Recovery-Tests_max", "Misc-KarmaRitual", "working-Circle","Karma-Modifier" ,"KarmaRitual-Rank"], function(values) {
      let vals = {};
      let ritual =getInt(values, "Misc-KarmaRitual");
      //Function Refills Recovery Tests to Max
      vals["Recovery-Tests"] =  Math.max (getInt(values,"Recovery-Tests"),getInt(values,"Recovery-Tests_max"));
      //vals["Karma"] =  Math.max (getInt(values,"Karma"),getInt(values,"Karma_max"));
      //Function Refills Karma Pool according to settings
      switch( ritual )
      {
        case 0 : return; // 0 : No Karma Ritual
        case -1 : vals["Karma"] = getInt(values,"Karma_max"); break; //Default : Ed4 rule
        case -2 : vals["Karma"] =Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"working-Circle")); break; //Homerule option: refill circle per day
        case -3 : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"Karma-Modifier")); break; //Homerule option : Refill as per race modifier
        case -4 : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"KarmaRitual-Rank")); break; //For ED3, Create a Karma Ritual Talent (with T_Type)
        default : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"Misc-KarmaRitual")); //Homerule : refill fixed per day
      }
      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:ocNewDay() error caught: " + err );}
}));//end ocNewDay



  // If this is a brand new PC character sheet (as tested by no languages existing)
  // then create standard skills and inventory
  var checkIfNewPC = function fncheckIfNewPC() {
    'use strict';
    try{
    function generateRowIdNoUnderscore() {
      return generateRowID().replace(/_/g, "-")
    }
    getAttrs([ "NPC"], function gacheckIfNewPC(values) {
      'use strict';
      if ( values[ "NPC" ] === "0" ) { //Check If PC was selected
        getSectionIDs("repeating_skilll", function(idArray) {
          if( idArray.length === 0 ) {
            var newRow = {};
            newRow["LS-Speak-Rank"] = "2";
            newRow["LS-ReadWrite-Rank"] = "1";
            let newId = generateRowIdNoUnderscore();
            let newInfo = buildPre( "SKL", newId );
            newRow[newInfo + "Name"] = "Dwarf: (Throalic)";
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Speak"] = "1";
            newRow[newInfo + "ReadWrite"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "SKL", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Speak"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Adventurer's Kit";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "14";
            newRow[newInfo + "Notes"] = "backpack, bedroll,flint & steel, torch, waterskin, large sack";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Artisan's Tool";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "3";
            newRow[newInfo + "Notes"] = "relevant to characters Artisan skill; needs gamemaster approval";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Traveller's Garb";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "3";
            newRow[newInfo + "Notes"] = "soft boots, shirt, belt,robe or breeches, travelers cloak";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "WPN", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Dagger";
            newRow[newInfo + "Rank"] = "2";
            newRow[newInfo + "Effective-Rank"] = "2";
            newRow[newInfo + "Weight"] = "1";
            newRow["Wealth_Silver"] = "100";
            newRow["LS-Speak-Rank"] = "2";
            newRow["LS-ReadWrite-Rank"] = "1";
            setAttrsLog(newRow, undefined,function fnAfterNewPC(tarray) {
              repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
              repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
              repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
              UpdateCarried();
            });
          }
        });
      };
    });
  } catch(err) {log("Earthdawn:checkIfNewPC() error caught: " + err );}
}; // End checkIfNewPC()
  //called on change of NPC
  on("change:npc", fn(checkIfNewPC));



  // Update character sheet from a previous version to the current version.
  // showNotes -1: new sheet so show welcome message, 0: Nothing, 1: show latest version notes.
  var updateCharactersheet = function fnUpdateCharactersheet( newSheetVersion, fromSheetVersion, origSheetVersion, recurse, values, showNotes, notes , flags) {
    'use strict';
    try{
    log("EarthDawn : UpdateCharacterSheet : Conversion to: " + newSheetVersion + " from: " + fromSheetVersion + " orig: " + origSheetVersion + " recurse: " +recurse );
    let vals = [];
    let newflags=flags;
    let toSheetVersion;

    if( isNaN( fromSheetVersion) || fromSheetVersion === 0 ) {  // v0 This is a blank new sheet. We want to initialize a certain number of stuff
      function generateRowIdNoUnderscore() {
        return generateRowID().replace(/_/g, "-")
      }
      let newId = generateRowIdNoUnderscore();
      let newInfo = buildPre( "DSP", newId );
      vals[newInfo + "Code"] = "0.0";
      vals[newInfo + "Name"] = "None";
      vals[newInfo + "Durability" ] = "0";
      vals[newInfo + "Circle"] = "1";
      vals["CreationMode"] = "1";

      var newNotes = "Earthdawn by FASA Character Sheet version: " + newSheetVersion + " by Chris Dickey and JB Faure.\n\n"
      + "Welcome to the Earthdawn character sheet.\n"
      + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
      + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n\n"
      + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set(WIKI Section 4.1.2).\n"
      + "Go to the Overview tab to first set the Name of your character and whether it is a PC or NPC \n"
      + "you can then create it step by step, or for NPC import its statistics directly from the SourceBooks.\n"
      +" Be sure to provide a Token and link it using the character sheet functions in Adjust. "
      + "See the help file for more details. \n\n";
      // Comment this line out if not to change tab to force release notes visible.
      //      showNotes = (showNotes === -1) ? -1 : 1;

      setAttrsLog( vals, undefined, function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, newSheetVersion, origSheetVersion, recurse + 1, values, -1, newNotes, newflags);        // Recursively call this routine to finalize, but will end the recursion
      });
    } // End ver 0.000 New Character
    /*
    */
    // There is currently nothing to update in the 1.0002 version, so this would just skip
    else if( fromSheetVersion < 1.0002 ) {
      toSheetVersion = 1.0002;
      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n\n"
      // Note: Put update stuff here.
      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
      setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      });
      else
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    } // End ver 1.002
    /*
    */
    else {
      if( fromSheetVersion < 2.0 ) {
        toSheetVersion = 2.0;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "This is a complete New Version with some new design and features. Read the Wiki:\n\n"
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- A new Legend Point tracking is available. It inspects all your ranks and increases and calculates your LP Total. For an imported character, you need to set the offset corresponding to your creation Free Ranks (See Wiki Section 2.8.1)\n"
        + "- Display of Steps and temporary modifiers has been improved. There is now an imporant difference between temporary modifiers (that will be highlighted in the Step) and permanent adjustments (that will be blended in the value)\n"
        + "  Think about reviewing them to better differentiate temporary effects of spells, potions, situations ...etc\n"
        + "- Automatic filling of Discipline parameters (PD, MD, SD, MA), and most Talent parameters as per the Ed4 PG. No need to edit manually anymore\n"
        + "- Inventory Management is now via a reperating list instead of a text field, and offers container management\n"
        + "- Spell Sequence was completely redesigned. It now suggests the next step, but let's you bypass any of the steps of the sequence\n"
        + "  It also supports Grimoire Casting, Attuning on the Fly, and Raw Magic (including Warp damage and Horror Mark tests)\n"
        + "- 2 different modes for Legend Tracking. See the Wiki\n"
        + "- Sheet is now PRINTABLE (with compatible browsers like Chrome). Pop-out the character sheet (Roll20 button with the 2 squares), and print.\n"
        + "- Blood Magic is now via a reperating list instead of a number field. A dummy bloodcharm has been created for you\n"
        + "- Give a Name to your Mounts and Companions !\n"
        + "- New Day Button refills your recovery Tests, and Makes your Karma Ritual. Selector for Homerule in Adjustment\n"
        + "- Creature/Opponent Custom Maneuver are now a repeating list. No limit to 3 anymore. Old ones are imported\n"
        + "- SpellCasting Talents are now directly in the list of other Talents\n"
        + "- LINKS function has been extended. Links allow to automatically add another value to the Rank of A Talent, Knack, Skill or Weapon\n"
        + "- You can now link also from Talents and Matrix, and link to a discipline. Use links to Disciplines for Free Talents and Matrix\n"
        + "  They are practical for Knacks, Talent combos, Free Talents (linking to Circle), Thread Items special properties...\n"
        + "- Your existing links have been converted EXCEPT links from KNACK to KNACK\n"
        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = ["Misc-IP-Buff","Wound-Threshold-Buff", "Wound-Threshold-Adjust","Damage-Death-Rating-Adjust","Health-Buff", "Damage-Unconscious-Adjust","Armor-Weight","Description-notes", "Misc-Aggressive-Penalty","Misc-Aggressive-Strain", "character_name", "Damage-Blood-Magic", "Misc-Initiative-Buff", "Creature-Custom1Name", "Creature-Custom1Desc", "Creature-Custom2Name", "Creature-Custom2Desc", "Creature-Custom3Name", "Creature-Custom3Desc", "Opponent-Custom1Name", "Opponent-Custom1Desc", "Opponent-Custom2Name", "Opponent-Custom2Desc", "Opponent-Custom3Name", "Opponent-Custom3Desc", "Opponent-Custom1Show", "Opponent-Custom2Show","Opponent-Custom3Show", "SKL_TotalS-Speak", "SKL_TotalT-Speak", "SKL_TotalS-ReadWrite", "SKL_TotalT-ReadWrite","Karma_max","Race","Misc-PoolName-1","Misc-PoolValue-1","Misc-Pool-Name-2","Misc-Pool-Value-2","Misc-Pool-Name-3","Misc-Pool-Value-3","LifeStyle","LifeStyle-Adjust","LifeStyle-Prepaid"];

        let i = 0, j=0, pre,newId,newInfo,linkArray;
        let sp = ["Spellcasting", "Patterncraft", "Elementalism", "Illusionism", "Nethermancy", "Shamanism", "Wizardry", "Power", "Willforce"];
        let spsuff=["Rank", "Rank-Mods", "Type", "Mods"];
        let sprid ={};
        let rowflags;

        for( i = 0; i < sp.length; i++ ) {
          for   ( j = 0; j < spsuff.length; j++ )
          getV.push( "SP-" + sp[i ] + "-" + spsuff[j]);
        }
        getSectionIDs("repeating_talents", function gsUpdateCharacterSheetIdTalents(tarray) {
          'use strict';
          for( i = 0; i < tarray.length; i++ ) {
            pre = buildPre( "T", tarray[ i ]);
            getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods", pre + "Parameters", pre+"Type", pre+"Karma-Control"]);
          }
          getSectionIDs("repeating_knacks", function gsUpdateCharacterSheetIdKnacks(karray) {
            'use strict';
            for( i = 0; i < karray.length; i++ ) {
              pre = buildPre( "NAC", karray[ i ]);
              getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods" , pre + "Parameters", pre+"Type", pre+ "Linked", pre+"Karma-Control"]);
            }
            getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
              'use strict';
              for( i = 0; i < skarray.length; i++ ) {
                pre = buildPre( "SK", skarray[ i ]);
                getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods", pre + "Parameters", pre+"Type", pre+"Karma-Control"]);
              }
              getSectionIDs("repeating_skilla", function gsUpdateCharacterSheetIdSkillsArtisan(skaarray) {
                'use strict';
                for( i = 0; i < skaarray.length; i++ ) {
                  pre = buildPre( "SKA", skaarray[ i ]);
                  getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Mods", pre + "Rank", pre + "Attribute", pre + "RollType", pre + "RollType", pre + "CombatSlot", pre + "Parameters"]);
                }
                getSectionIDs("repeating_skillk", function gsUpdateCharacterSheetIdSkillsKnow(skkarray) {
                  'use strict';
                  for( i = 0; i < skkarray.length; i++ ) {
                    pre = buildPre( "SKK", skkarray[ i ]);
                    getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Mods", pre + "Rank",  pre + "RollType", pre + "RollType", pre + "CombatSlot", pre + "Parameters"]);
                  }
                  getSectionIDs("repeating_inventory", function gsUpdateCharacterSheetIdInventory(iarray) {
                    'use strict';
                    for( i = 0; i < iarray.length; i++ ) {
                      pre = buildPre( "I", iarray[ i ]);
                      getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Qty", pre + "Carried", pre + "UnitWeight", pre + "Notes"]);
                    }
                    getSectionIDs("repeating_weapons", function gsUpdateCharacterSheetIdInventory(warray) {
                      'use strict';
                      for( i = 0; i < warray.length; i++ ) {
                        pre = buildPre( "WPN", warray[ i ]);
                        getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Base"]);
                      }
                      getSectionIDs("repeating_spell", function gsUpdateCharacterSheetIdSpell(sarray) {
                        'use strict';
                        for( i = 0; i < sarray.length; i++ ) {
                          pre = buildPre( "SP", sarray[ i ]);
                          getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Range", pre + "AoE", pre + "Duration"]);
                        }
                        getSectionIDs("repeating_matrix", function gsUpdateCharacterSheetIdMatrix(marray) {
                          'use strict';
                          for( i = 0; i < marray.length; i++ ) {
                            pre = buildPre( "SPM", marray[ i ]);
                            getV = _.union( getV, [ pre + "RowID", pre + "Origin", pre+"Type"]);
                          }
                          getSectionIDs("repeating_threads", function gsUpdateCharacterSheetIdThreads(tiarray) {
                            'use strict';
                            for( i = 0; i < tiarray.length; i++ ) {
                              pre = buildPre( "TI", tiarray[ i ]);
                              getV = _.union( getV, [ pre + "Effects"]);
                            }

                            getSectionIDs("repeating_mount", function gsUpdateCharacterSheetIdMounts(mntarray) {
                              'use strict';
                              for( i = 0; i < mntarray.length; i++ ) {
                                pre = buildPre( "MNT", mntarray[ i ]);
                                getV = _.union( getV, [ pre + "Name"]);
                              }

                          getAttrs( getV , function gaUpdateCharacterSheet(values) {
                            'use strict';

                            function updateRow( code, rid, flags)  {
                              if(rid && rid.length<4) log("updateCharacterSheet incorrect rowid: " +rid+ "     code: "+code);
                              pre = buildPre( code, rid);
                              rowflags=flags;
                              vals[pre + "Name"]= values[pre + "Name"]+"";     //Name is overwritten to trigger Autofill. Adding a charcter 192 will trigger a change, and the sanitize should do the rest
                              vals[pre + "MoveBased"]= 1-getInt(values, pre + "NotMoveBased");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"NotMoveBased" );
                              vals[pre + "VisionBased"]= 1-getInt(values, pre + "NotVisionBased");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"NotVisionBased" );
                              vals[pre + "Rank-Adjust"]= getInt(values, pre + "Rank-Mods");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"Rank-Mods" );
                              if(values[pre+"Karma-Control"]=="-1") vals[pre+"Karma-Limit_max"]=0;
                              vals[pre + "Parameters"]= "0";
                              if (values[pre + "Type"]==="Versatility") vals[pre + "Type"] = "V-Novice";
                              if (values[pre + "Type"].startsWith("F1-")) vals[pre + "Type"] = "Novice"; //Correct bug created by API
                              switch (values[pre + "Attribute"]){
                                case "(@{Dex-Step}+@{Dex-Adjust}+@{Dex-Mods})" : vals[pre + "Attribute"] = "Dex"; break ;
                                case "(@{Str-Step}+@{Str-Adjust}+@{Str-Mods})" : vals[pre + "Attribute"] = "Str"; break ;
                                case "(@{Tou-Step}+@{Tou-Adjust}+@{Tou-Mods})" : vals[pre + "Attribute"] = "Tou"; break ;
                                case "(@{Per-Step}+@{Per-Adjust}+@{Per-Mods})" : vals[pre + "Attribute"]= "Per"; break ;
                                case "(@{Wil-Step}+@{Wil-Adjust}+@{Wil-Mods})" : vals[pre + "Attribute"]= "Wil"; break ;
                                case "(@{Cha-Step}+@{Cha-Adjust}+@{Cha-Mods})" : vals[pre + "Attribute"]= "Cha"; break ;
                                default: vals[pre + "Attribute"]= "0";
                              }
                              switch (values[pre + "Mod-Type"]){
                                case "0"                                          : vals[pre + "Mod-Type"] = "0"; break ;
                                case "@{Adjust-All-Tests-Total}"                  : vals[pre + "Mod-Type"] = "Action"; break ;
                                case "@{Adjust-Effect-Tests-Total}"               : vals[pre + "Mod-Type"] = "Effect"; break ;
                                case "@{Adjust-Attacks-Total}"                    : vals[pre + "Mod-Type"] = "Attack"; break ;
                                case "@{Adjust-Attacks-Total-CC}"                 : vals[pre + "Mod-Type"] = "Attack CC"; break ;
                                case "@{Adjust-Damage-Total}"                     : vals[pre + "Mod-Type"] = "Damage"; break ;
                                case "@{Adjust-Damage-Total-CC}"                  : vals[pre + "Mod-Type"] = "Damage CC"; break ;
                                case "@{Adjust-All-Tests-Total}+(-1*@{IP})"       : vals[pre + "Mod-Type"] = "Init"; break ;
                                case "@{Adjust-All-Tests-Total}+(-1*@{Armor-IP})" : vals[pre + "Mod-Type"] = "Armor IP"; break ;
                                case "(0)"                                        : vals[pre + "Mod-Type"] = "(0)"; break ;
                                default : vals[pre + "Mod-Type"]= "Action"; //If never set, it remained as Action
                              }
                              return rowflags;
                            };
                            //Other changes that need to be done
                            function generateRowIdNoUnderscore() {
                              return generateRowID().replace(/_/g, "-")
                            }

                            //Spell Talents
                            for( i = 0; i < sp.length; i++ ) if(getInt(values,"SP-" + sp[i] + "-Rank")>0 || getInt(values,"SP-" + sp[i] + "-Rank-Mods")>0 || getInt(values,"SP-" + sp[i] + "-Mods")>0)  {
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "T", newId );
                              vals[newInfo + "RowID"] = newId;
                              sprid[sp[i]]=newId;
                              pre="SP-" + sp[i] + "-";
                              vals[newInfo + "CombatSlot"] = 1;
                              vals[newInfo + "Name"] = sp[i];
                              vals[newInfo + "Parameters"]= "0";
                              if( sp[i]=="Willforce") vals[newInfo + "Mod-Type"]= "Effect"; else vals[newInfo + "Mod-Type"]= "Action";
                              if (values[pre + "Rank"]) vals[newInfo + "Rank"] = values[pre + "Rank"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Rank" );
                              if (values[pre + "Rank-Mods"]) vals[newInfo + "Rank-Adjust"] = values[pre + "Rank-Mods"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Rank-Mods" );
                              if (values[pre + "Mods"]) vals[newInfo + "Mods"] = values[pre + "Mods"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Mods" );
                              if( sp[i]=="Willforce") vals[newInfo + "Attribute"]= "Wil"; else vals[newInfo + "Attribute"]= "Per";
                              if( sp[i]=="Willforce") vals[newInfo + "Target"]= "None";;
                              if (values[pre + "Type"]) vals[newInfo + "Type"] = "D1"+values[pre + "Type"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Type" );
                              if( sp[i]=="Willforce") vals[newInfo + "Action"]= "Free"; else vals[newInfo + "Action"]= "Standard";
                              if( sp[i]=="Willforce") vals[newInfo + "Strain"]= "1"; else vals[newInfo + "Strain"]= "0";
                              vals[newInfo + "Special"]= "SPL-" + sp[i];
                              if( sp[i]=="Spellcasting") vals[newInfo + "VisionBased"]= "1"; else vals[newInfo + "VisionBased"]= "0";
                              if( sp[i]=="Spellcasting")
                              {
                                newId = generateRowIdNoUnderscore();
                                newInfo = buildPre( "T", newId );
                                vals[newInfo + "RowID"] = newId;
                                vals[newInfo + "Name"] = "WIL";
                                vals[newInfo + "Mod-Type"]= "Effect";
                                vals[newInfo + "Attribute"]= "Wil";
                                vals[newInfo + "Action"]= "Free";
                                vals[newInfo + "Special"]= "SPL-Willforce";
                                vals[newInfo + "Type"] ="Special";
                                vals[newInfo + "Target"] ="None";
                                vals[newInfo + "Karma-Limit_max"] ="0";
                                vals[newInfo + "Karma"] ="0";
                                vals[newInfo + "Parameters"]= "0";
                                vals[newInfo + "Notes"]= "This is a dummy Talent, that holds the willpower value that will be used for Spell Effect Tests. Do Not delete except if character is a non-spellcaster";
                              }
                            }

                            //Talents
                            for( i = 0; i < tarray.length; i++ ){
                              newflags=updateRow( "T", tarray[i],newflags);
                            };

                            //Knacks
                            for( i = 0; i < karray.length; i++ ){
                              newflags=updateRow( "NAC", karray[i],newflags);

                              let prev=buildPre("NAC", karray[i]), //vandalized
                              pre=buildPre("NAC",values[prev+"RowID"]); //non vandalized
                              let links = values[prev+"Linked"];
                              if (links){ // This section is for importing links. Up to v2, only Knacks had links and links were unidirectional
                                 log ("links before sanitizing" + links) ;
                                links = links.replace( /[\{|\(|\)|\@|\}]/gi, ""); //Sanitizing.links if it exists is in the form of an autocalc i.e (@{fully_qualifiedname}+@{fully_qualifiedname}). After sanitizing they will be fully_qualifiedname+fully_qualifiedname
                                linkArray=links.split("+");// Now we split the list by +, so we get an array [ fully_qualifiedname,fully_qualifiedname]
                                for(j=0;j<linkArray.length;j++){
                                  if(linkArray[j].startsWith("SP-")){ //Spellcasting Talents were SP-Spellcasting-Effective-Rank
                                    let tal= getParam(linkArray[j],2,"-");
                                    let rid= sprid[tal]; //In v1 Spellcasting talents were hardcoded. We converted them to newly repeating_talents. The rowid was conveniently stored above
                                    if (rid){
                                      newflags=addAPIflag( newflags, "LinkAdd2", "NAC : " + values[prev+"RowID"] + " : T : " + rid); //APIFlag syntax is LinkAdd2,code,rowid,code,rid, the first set being the attribute Getting the value, and the second the one providing

                                    }
                                    else log("EarthDawn UpdateCharacterSheet() Tried to create a link to a non existing spellcasting talent : " + tal);
                                  } else if(linkArray[j].startsWith("repeating")){ //Non Spellcasting Talents are on the repeating_XXX-RowId format
                                    let rid= repeatSection(2,linkArray[j]);
                                    let pre2v=buildPre(repeatSection(3,linkArray[j]),rid.toLowerCase()), // Really don't know why, but we need a vandalized rowid
                                    pre2=buildPre(repeatSection(3,linkArray[j]),rid)
                                    let tal= values[pre2v+"Name"];

                                    if(! tal)  log ("Earthdawn: UpdateCharacterSheet - Tried to create a link to an ability that doesn't exist: " + rid); // This line is to get rid of dead links...
                                    else {if (!linkArray[j].endsWith("Mods") && tal!==undefined && repeatSection(3,linkArray[j])!=="NAC"){ //Links with Talents and Weapons have 2 entries, so one of them has to be skipped

                                      newflags=addAPIflag( newflags, "LinkAdd2", "NAC : " + values[prev+"RowID"] + " :" +repeatSection(3,linkArray[j]) + " : " + values[pre2v+"RowID"]); //APIFlag syntax is LinkAdd2,code,rowid,code,rid, the first set being the attribute Getting the value, and the second the one providing

                                    }
                                  }
                                }
                              }
                            }
                            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Linked" );
                            newflags=addAPIflag( newflags, "RemoveAttr", pre+"LinkDisplay" );
                          };
                          if(i>0) vals["show_repeating_links"]="1"; //If there was a Knack, we need links, so we want to display them

                          //Skills
                          for( i = 0; i < skarray.length; i++ ){
                            newflags=updateRow( "SK", skarray[i],newflags);
                            if (values[pre + "Type"]!=="Journeyman" && values[pre + "Type"]!=="Warden" && values[pre + "Type"]!=="Master")
                              vals[pre + "Type"] = "Novice"; //Corrects a bug in the API that put invalid values in SK_Type
                          };
                          for( i = 0; i < skaarray.length; i++ ){
                            pre = buildPre( "SKA", skaarray[ i ]);
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "SK", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Category"] = "Artisan";
                            vals[newInfo + "Parameters"]= "0";
                            if(values[pre +"Name"]) vals[newInfo + "Name"]=values[pre+ "Name"];
                            if(values[pre +"Mods"]) vals[newInfo + "Rank-Adjust"]=values[pre+ "Mods"];
                            if(values[pre +"Rank"]) vals[newInfo + "Rank"]=values[pre+ "Rank"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"CombatSlot"]) vals[newInfo + "CombatSlot"]=values[pre+ "CombatSlot"];
                            switch (values[pre + "Attribute"]){
                              case "(@{Dex-Step}+@{Dex-Adjust}+@{Dex-Mods})" : vals[newInfo + "Attribute"] = "Dex"; break ;
                              case "(@{Str-Step}+@{Str-Adjust}+@{Str-Mods})" : vals[newInfo + "Attribute"] = "Str"; break ;
                              case "(@{Tou-Step}+@{Tou-Adjust}+@{Tou-Mods})" : vals[newInfo + "Attribute"] = "Tou"; break ;
                              case "(@{Per-Step}+@{Per-Adjust}+@{Per-Mods})" : vals[newInfo + "Attribute"]= "Per"; break ;
                              case "(@{Wil-Step}+@{Wil-Adjust}+@{Wil-Mods})" : vals[newInfo + "Attribute"]= "Wil"; break ;
                              case "(@{Cha-Step}+@{Cha-Adjust}+@{Cha-Mods})" : vals[newInfo + "Attribute"]= "Cha"; break ;
                              default: vals[pre + "Attribute"]= "Cha";
                            }
                            newflags=addAPIflag( newflags, "RemoveRow", "SKA,"+skaarray[ i ] );
                          };

                          for( i = 0; i < skkarray.length; i++ ){
                            pre = buildPre( "SKK", skkarray[ i ]);
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "SK", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Category"] = "Knowledge";
                            vals[newInfo + "Parameters"]= "0";
                            if(values[pre +"Name"]) vals[newInfo + "Name"]=values[pre+ "Name"];
                            if(values[pre +"Mods"]) vals[newInfo + "Rank-Adjust"]=values[pre+ "Mods"];
                            if(values[pre +"Rank"]) vals[newInfo + "Rank"]=values[pre+ "Rank"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"CombatSlot"]) vals[newInfo + "CombatSlot"]=values[pre+ "CombatSlot"];
                            vals[newInfo + "Attribute"] = "Per";
                            newflags=addAPIflag( newflags, "RemoveRow", "SKK,"+skkarray[ i ] );
                          };

                          // Thread Items
                          for( i = 0; i < tiarray.length; i++ ){
                            pre = buildPre( "TI", tiarray[ i ]);
                            if(values[pre +"Effects"]){
                             vals[pre + "Description"]=values[pre+ "Effects"];
                             vals[pre + "Effects"]="";}
                           };


                          //Misc
                          if(values["character_name"]) vals["charName"]=values["character_name"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "character_name" );

                          if(values["Description-notes"]) vals["general-notes-2"]=values["Description-notes"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Description-notes" );

                          if(values["Armor-Weight"]) vals["Armor-Wght"]=values["Armor-Weight"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Armor-Weight" );

                          if(getInt(values,"Race")>9) vals["Misc-Karma-max-Adjust"]=getInt(values,"Karma_max");

                          vals["KarmaGlobalMode"]="?";

                          if(values["Misc-PoolName-1"]!==undefined||values["Misc-PoolValue-1"]!==undefined||values["Misc-Pool-Name-2"]!==undefined||values["Misc-Pool-Value-2"]!==undefined||values["Misc-Pool-Name-3"]!==undefined||values["Misc-Pool-Value-3"]!==undefined){
                            vals["show_overview_miscpool"]="1";
                            vals["show_combat_miscpool"]="1";
                          }
                          if(values["LifeStyle"]!==undefined||values["LifeStyle-Adjust"]!==undefined||values["LifeStyle-Prepaid"]!==undefined) vals["show_lifestyle"]="1";

                          if(mntarray.length>0) vals["show_mounts"]="1";


                          //Blood Magic
                          if (getInt(values, "Damage-Blood-Magic") !="0"){
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "BL", newId );
                            vals[newInfo + "Name"] = "Misc Blood Charm";
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Damage-Blood-Magic"] = getInt(values, "Damage-Blood-Magic");
                            vals[newInfo + "Effects"] = "Line created automatically during import to sheet rev2";
                            vals["show_blood"]="1";
                          };
                          if(values["Misc-Initiative-Buff"]) vals["Initiative-Mods"]=values["Misc-Initiative-Buff"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Initiative-Buff" );

                          if(values["Misc-Aggressive-Penalty"]) vals["Misc-AggStance-Penalty"]=values["Misc-Aggressive-Penalty"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Aggressive-Penalty" );

                          if(values["Misc-Aggressive-Strain"]) vals["Misc-AggStance-Strain"]=values["Misc-Aggressive-Strain"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Aggressive-Strain" );

                          vals["Damage-Unconscious-Adjust"]=getInt(values,"Damage-Unconscious-Adjust")+getInt(values,"Health-Buff");
                          vals["Damage-Death-Rating-Adjust"]=getInt(values,"Damage-Death-Rating-Adjust")+getInt(values,"Health-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Health-Buff" );

                          vals["Recovery-Adjust"]=getInt(values,"Recovery-Adjust")+getInt(values,"Recovery-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Recovery-Buff" );

                          vals["Wound-Threshold-Adjust"]=getInt(values,"Wound-Threshold-Adjust");

                          vals["Misc-IP-Mod"]=getInt(values,"Misc-IP-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-IP-Buff" );

                          //Maneuvers
                          for( i = 1; i < 4; i++ ){
                            if(values["Creature-Custom"+ i.toString() + "Name"]   || values["Creature-Custom"+ i.toString() + "Desc"]  ){
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "MAN", newId );
                              vals[newInfo + "RowID"] = newId;
                              if (values["Creature-Custom"+ i.toString() + "Name"]) vals[newInfo + "Name"] = values["Creature-Custom"+ i.toString() + "Name"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Creature-Custom"+ i.toString() + "Name" );
                              if (values["Creature-Custom"+ i.toString() + "Desc"]) vals[newInfo + "Desc"] = values["Creature-Custom"+ i.toString() + "Desc"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Creature-Custom"+ i.toString() + "Desc" );
                              vals[newInfo + "Type"] = "1";
                            }
                            if(values["Opponent-Custom"+ i.toString() + "Name"]   || values["Opponent-Custom"+ i.toString() + "Desc"]  ){
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "MAN", newId );
                              vals[newInfo + "RowID"] = newId;
                              if (values["Opponent-Custom"+ i.toString() + "Name"]) vals[newInfo + "Name"] = values["Opponent-Custom"+ i.toString() + "Name"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Opponent-Custom"+ i.toString() + "Name" );
                              if (values["Opponent-Custom"+ i.toString() + "Desc"]) vals[newInfo + "Desc"] = values["Opponent-Custom"+ i.toString() + "Desc"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Opponent-Custom"+ i.toString() + "Desc" );
                              vals[newInfo + "Type"] = "-1";
                            }
                          };


                          //JBF@CD : this is only to be able to import my own game. Can be deleted afterwards
                          for( i = 0; i < iarray.length; i++ ){
                            pre = buildPre( "I", iarray[ i ]);
                            let pre2 = buildPre( "INV", iarray[ i ]);
                            if(values[pre + "Name"]) vals[pre2 + "Name"]= values[pre + "Name"];
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Name" );
                            if (getInt(values, pre + "Qty")) vals[pre2 + "Qty"]= getInt(values, pre + "Qty");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Qty" );
                            if(getInt(values, pre + "Carried")) vals[pre2 + "Carried"]= getInt(values, pre + "Carried");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Carried" );
                            if(getInt(values, pre + "UnitWeight")) vals[pre2 + "UnitWeight"]= getInt(values, pre + "UnitWeight");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "UnitWeight" );
                            if(values[pre + "Notes"])  vals[pre2 + "Notes"]= values[pre + "Notes"];
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Notes" );
                          };

                          //Spells
                          for( i = 0; i < sarray.length; i++ ){
                            pre = buildPre( "SP", sarray[ i ]);
                            if (values[pre+"Range"]) spellsanitize(pre+"Range", values[pre+"Range"]);
                            if (values[pre+"AoE"]) spellsanitize(pre+"AoE", values[pre+"AoE"]);
                            if (values[pre+"Duration"]) spellsanitize(pre+"Duration", values[pre+"Duration"]);
                            if (! values[pre+"Casting"] || values[pre+"Casting"]==="MDh") vals[pre + "Casting"]= "MD1: @{target|Target|token_id}"; //JBF Spells default now to MD1 and not hMD
                          };

                          //Matrix
                          for( i = 0; i < marray.length; i++ ){
                            pre = buildPre( "SPM", marray[ i ]);
                            if (values[pre+"Origin"]==="Free") vals[pre + "Origin"]="Free-link";
                            if (values[pre+"Origin"]==="Item") vals[pre + "Origin"]="Item-link";
                            if (values[pre + "Type"]==="Versatility") vals[pre + "Type"] = "V-Novice";
                          };

                          //Weapon
                          for( i = 0; i < warray.length; i++ ){
                            pre = buildPre( "WPN", warray[ i ]);
                            if (getInt(values, pre + "Base")) vals[pre + "Rank"]= getInt(values, pre + "Base");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Base" );
                          };

                          //Languages
                          if(getInt(values,"SKL_TotalS-Speak")>0) vals["LS-Speak-Rank"]=getInt(values,"SKL_TotalS-Speak");
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalS-Speak" );
                          if(getInt(values,"SKL_TotalS-ReadWrite")>0) vals["LS-ReadWrite-Rank"]=getInt(values,"SKL_TotalS-ReadWrite");
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalS-ReadWrite" );
                          if(getInt(values,"SKL_TotalT-Speak")>0) {
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "T", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Name"] = "Speak Language";
                            vals[newInfo + "Rank"] = getInt(values,"SKL_TotalT-Speak");
                            vals[newInfo + "Attribute"] = "Per";
                            vals[newInfo + "Target"] = "None";
                            vals[newInfo + "Strain"] = "1";
                          };
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalT-Speak" );
                          if(getInt(values,"SKL_TotalT-ReadWrite")>0) {
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "T", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Name"] = "Read Write Language";
                            vals[newInfo + "Rank"] = getInt(values,"SKL_TotalT-ReadWrite");
                            vals[newInfo + "Attribute"] = "Per";
                            vals[newInfo + "Target"] = "None";
                            vals[newInfo + "Strain"] = "1";
                          };
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalT-ReadWrite" );

                          vals["Defense-Phys-Nat-Auto-Adjust"] = "-1"; //Dirty trick to tell to CountDiscipline it needs to offset the various -Adjust values from the -Auto-Adjust due to import

                          newflags=addAPIflag( newflags, "WipeMatrix",""); //This is used o Wipe all the Matrix to get rid of obsolete Token Actions

                          // setAttrsLog( vals );

                          if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
                          setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
                            'use strict';
                            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
                          });
                          else{
                            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
                          }
                        });
                      });
                    });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    } // End ver 2.000

    else  if( fromSheetVersion < 2.03 ) {
      toSheetVersion = 2.03;
      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
      // Note: Put update stuff here.
      + "- Data entry for Talents and Skills just got easier ! You can still import by pasting extract from the PDFs, but you can now type the first letters of the name, and a dropdown list will appear. Autofill will then fill all except the description (for obvious I.P. reasons)\n"
      + "- Knacks-Report !! Go to the Knack Tab, and edit, and you will be able to generate a report of the Knacks you can presently buy, or set a value for the rank/circle of all your Disciplines and Talents, and check the knacks available when you reach it\n"
      + "- Default value for sheet parameters can now be set from your roll20 Game Settings. This allows you to set campaign wide parameters for sheet display or some homerules. See roll20 documentation on how to extend parameters to existing sheets.\n"
      + "- LP Summary now calculates the costs of joining a path or becoming a questor, and offers fields for multi-disciplining costs (when joining before Circle 5)\n"
      + "- Questors and Path now also benefit from automatic calculation of their adjustments... Note that if you had some existing adjustments you may need to remove them to avoid double counting!!\n"
      + "- Various Bug Fixes\n"

      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
      setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      });
      else
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    } // End ver 2.03


    else  if( fromSheetVersion < 2.04 ) {
      toSheetVersion = 2.04;

      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
      // Note: Put update stuff here.
      + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
      + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
      + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
      + "- Character Creation and multi-disciplining got easier. Click the Add C1 Talents button and get your starting talents prefilled\n"
      + "   Multidisciplining LP Costs will be posted in the automatic calculation\n"
      + "- Set the default values for various visualization and Optional/Home Rules from the roll20 Game Settings\n"
      + "- Blood Elves added as playable race as per Elven Nation Game Information\n"
      + "- Added Karma Modifier Adjustment in order to give all tool to implement DragonKin\n"
      + "- Various Bug Fixes\n"
      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      let getV = ["Race","Armor-Wght"];
      let i,pre;


      getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
        'use strict';
        for( i = 0; i < skarray.length; i++ ) {
          pre = buildPre( "SK", skarray[ i ]);
          getV = _.union( getV, [pre+"Type",pre+"Name"]);
        }
        getSectionIDs("repeating_discipline", function gsUpdateCharacterSheetIdDiscipline(darray) {
          'use strict';
          for( i = 0; i < darray.length; i++ ) {
            pre = buildPre( "DSP", darray[ i ]);
            getV = _.union( getV, []);
          }

          getAttrs( getV , function gaUpdateCharacterSheet(values) {
            'use strict';
            //Races
            switch(values["Race"]){
              case "1" : vals["Race"]= "Dwarf"; break;
              case "2" : vals["Race"]= "Elf";break;
              case "3" : vals["Race"]= "Human";break;
              case "4" : vals["Race"]= "Obsidiman";break;
              case "5" : vals["Race"]= "Ork";break;
              case "6" : vals["Race"]= "Troll";break;
              case "7" : vals["Race"]= "Tskrang";break;
              case "8" : vals["Race"]= "Windling";break;
              case "99" : vals["Race"]= "Other";break;
              default : vals["Race"]="None";
            }

            if(values["Armor-Wght"]) vals["Armor-Weight"]=values["Armor-Wght"];
            newflags=addAPIflag( newflags, "RemoveAttr", "Armor-Wght" );


            //Skills
            for( i = 0; i < skarray.length; i++ ){
              pre = buildPre( "SK", skarray[ i ]);
              if (values[pre + "Type"]!=="Journeyman" && values[pre + "Type"]!=="Warden" && values[pre + "Type"]!=="Master"){
                vals[pre + "Type"] = "Novice"; //Corrects a bug in the API that put invalid values in SK_Type
              }
            };

            for( i = 0; i < darray.length; i++ ){
              pre = buildPre( "DSP",darray[ i ]);
              vals[pre + "show-createbutton"] = 0;
            };

              if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
              setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
                'use strict';
                updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
              });
              else{
                updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
              }
            });
          });
        });
      } // End ver 2.04

      else  if( fromSheetVersion < 2.05 ) {
        toSheetVersion = 2.05;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- Autofill database has now the Questor Devotions\n"
        + "- Bug fix : Autofill will not set the attribute for creatures because ib the book format for importing the Rank is directly the Step\n"

        + "- Various Bug Fixes\n"
        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = ["Hide-Spells-tab"];
        let i,pre;



            getAttrs( getV , function gaUpdateCharacterSheet(values) {
              'use strict';

              // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
              // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
              // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
              // log("corrected Hide-Spells-Tab bug ");




        if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
        setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
          'use strict';
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        });
        else{
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        }

      });
        } // End ver 2.05

        else  if( fromSheetVersion < 2.06 ) {
          toSheetVersion = 2.06;

          var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
          // Note: Put update stuff here.
          + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
          + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
          + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
          + "- Added Support for Ammo Weight and Quantity\n"
          + "- Corrected Range of the ShortBow\n"
          + "- Corrected the LP Calculation for Versatility \n"
          + "- Various Bug Fixes\n"
          + notes;
          // Comment this line out if not to change tab to force release notes visible.
          showNotes = (showNotes === -1) ? -1 : 1;

          let getV = [""];
          let i,pre;



              getAttrs( getV , function gaUpdateCharacterSheet(values) {
                'use strict';

                // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
                // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
                // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
                // log("corrected Hide-Spells-Tab bug ");




          if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
          setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
            'use strict';
            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
          });
          else{
            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
          }

        });
      } // End ver 2.06

      else  if( fromSheetVersion < 2.07 ) {
        toSheetVersion = 2.07;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- Reviewed the Autofill database for movement based and vision based... Note that these are no official ruling though, so up to GM interpretation\n"

        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = [""];
        let i,pre;



            getAttrs( getV , function gaUpdateCharacterSheet(values) {
              'use strict';

              // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
              // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
              // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
              // log("corrected Hide-Spells-Tab bug ");




        if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
        setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
          'use strict';
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        });
        else{
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        }

      });
    } // End ver 2.07

    else if( recurse > 0) {

      vals[ "edition_max" ] = newSheetVersion.toString();
      // vals[ "edition" ] = 4;
      vals[ "APIflag" ] =addAPIflag( newflags, "SheetUpdate", origSheetVersion.toString() + "," + newSheetVersion.toString() + ", ED" );
      vals[ "Release-notes" ] = notes;
      if( showNotes ) {
        // vals[ "show-release-notes" ] = "1";
        // vals[ "tab" ] = "9";
         vals[ "tab" ] = "11";
         vals[ "tab-adjust" ] = "4";
      }
      setAttrsLog( vals );
      recalc();       // If we actually updated something, recalculate every field.
    }
  }
} catch(err) {log("Earthdawn:updatecharactersheet() error caught: " + err );}
}; // End updatecharactersheet()



// When a sheet is first opened, see if it needs to be updated from a previous version.
on('sheet:opened',function fnOnSheetOpened(){
  'use strict';
  try{
  // edition_max is character sheet version
  // getAttrs(["edition_max", "NPC", "show_tips_startup" ], function gaSheetOpened(values) {
    getAttrs(["edition_max", "NPC", "API", "API_max"], function gaSheetOpened(values) {
    'use strict';
    logvalues( values);
          //API Watchdog - Set to NoAPI no matter what, if the API is active it will reset to API.
          //Temporarly disabled until API is released
    // let vals={};
    // switch( values[ "API" ] ) {
    //   case undefined :
    //     vals["API"]="0";
    //   case "0": case 0:
    //     if( values[ "API_max" ] == "10" )
    //       vals[ "API_max" ] = "0";
    //     else
    //       vals[ "API_max" ] = "10";
    //   break;
    //   case "1": case 1:
    //     vals[ "API" ] = "2";
    //     vals[ "API_max" ] = "2";
    //     break;
    //   case "2": case 2:
    //     if( values[ "API_max" ] == "2" )
    //       vals[ "API_max" ] = "12";
    //     else
    //       vals[ "API_max" ] = "2";
    // }
    // setAttrsLog( vals );

    var newSheetVersion = SheetVersion;          // The Version number is set as a global variable at the beginning of the sheet-worker. It is changed with every revision of the sheet that needs to call this routine. Also updated twice above and in .js file.
    var oldSheetVersion = parseFloat( values[ "edition_max" ] );
    if( oldSheetVersion != newSheetVersion ) {
      updateCharactersheet( newSheetVersion, oldSheetVersion, oldSheetVersion, 0, values, 0, "" );
    } // End there are updates to perform
  });
} catch(err) {log("Earthdawn:OnSheetOpened() error caught: " + err );}
});//end OnSheetOpened



// addAPIflag() This routine builds a list of commands for the API to process.
// The list is newline delimited.
// Each item on the list has a command, a comma, and some data for the command. Each command has its own requirements for format.
// cmd tells the API what exact type of communication this is.
// line is the details needed to process this command.
// The flag eventually needs to be written in attr_APIflag
// RemoveRow, (code), (rowID) // remove everything with this rowID.
// RemoveAttr, (fully qualified attribute name). Remove this attribute.
var addAPIflag = function fnaddAPIflag( flag, cmd, line ) {
  'use strict';
  try{
  let newflag = !flag ? "" : flag;
  newflag += cmd + "," + line + "\n";
  return newflag;
} catch(err) {log("Earthdawn:addAPIflag() error caught: " + err );}
}; // End addAPIflag()



// fnprocessSWflag() This routine receives a list of commands from the API to process.
// The list is newline delimited.
// Each item on the list has a command, a comma, and some data for the command. Each command has its own requirements for format.
// cmd tells  what exact type of communication this is.
// line is the details needed to process this command.
// accepted commands are
// recalc, that will trigger recalc()
// trigger,fully qualified attribute name,value that will use setAttrsLog to write the value in the attribute (triggering any sheetworker routine necessary)
// The flag eventually has been written in attr_SWflag
var processSWflag = function fnprocessSWflag(eventInfo) {
  'use strict';
  try{
  if( eventInfo[ "sourceType" ].toLowerCase() !== "api" || !( "newValue" in eventInfo  )) return;   //The routine resets the value of SWflag at the end, and the silent mode of setAttrs is erratic. We want to avoid circular loop
  let flags = eventInfo[ "newValue" ];
  log("Earthdawn SWflag :" + flags);
  if( flags ) flags = flags.trim();
  if( !flags ) { log("Earhdawn:processSWflag() error : SWflag is undefined"); return;};
  let cmdArray = flags.split("\n") ;
  let i, cmdLine;
  let vals={};
  for( i = 0; i < cmdArray.length; i++ ) {
    cmdLine = cmdArray[ i ];
    switch(getParam( cmdLine, 1, ",").toLowerCase()) {
      case "recalc" : recalc(); break;
      case "trigger" :{     // Trigger, (attribute name to trigger) (: colon) (data to be written to activate the trigger). (newline).
        let comma = cmdLine.indexOf(",");
        let colon = cmdLine.indexOf(":");
        if( comma === -1 || colon <= comma ) {log("Earthdawn:processSWflag() error. cmd trigger, cmdLine improperly formatted: " + cmdLine); break;}
        vals[ cmdLine.substring(comma +1, colon).trim() ] = cmdLine.substring( colon +1 ).trim();
      };
      break;
      case "trigger2" :  {   // Trigger2, routine to call, fully qualified attribute name to be passed as eventInfo. (newline).
          let trig2 = getParam( cmdLine, 2, ",").toLowerCase();
          if( trig2 === "autofill" )
              AutoFill( getParam( cmdLine, 3, "," ));
          else if( trig2.endsWith( "getvalue" ))     // LinksProvideValue or LinksGetValue
            switch(  repeatSection( 3, getParam( cmdLine, 2, ",")).toUpperCase() ){ //code Let's make sure after a link or an Autofill that we locally recalculate
              case "NAC":
              case "SK" :
              case "WPN" :
              case "T" : repRanks( getParam( cmdLine, 2, ",") ); break;
              case "SPM" : repMatrixType( repeatSection( 2, getParam( cmdLine, 2, ","))); break; //rowid
              default :   log("Earthdawn:processSWflag() error : invalid trigger2 getvalue: " + cmdLine );
            }

          else
            log("Earthdawn:processSWflag() error : invalid trigger2: " + cmdLine );
        }
      break;
      default: log("Earthdawn:processSWflag() error. Unknown cmd: " + cmdLine);
    };
  };
  vals[ "SWflag" ] = "";
  //API Watchdog - If any flag is received, the API must be running
  vals["API"]="1";

  setAttrsLog( vals );
} catch(err) {log("Earthdawn:processSWflag() error caught: " + err );}
}; // End processSWflag()
on("change:swflag", fn(processSWflag));




// resetEditMode : whenever leaving a section, all the edit modes are reset
// While in Creation mode, everything is in edit mode
var resetEditMode = function fnresetEditMode() {
  'use strict';
  try{
  getAttrs( [ "CreationMode","tab" ] , function garesetEditMode(values) {
    let i=getInt(values,"CreationMode");
    let vals={};
    if(values["tab"]=="1" || values["tab"]=="2"){
    vals["attributes-edit-mode"]=i;
    vals["DSP-Race-edit-mode"]=i;
    vals["talents-edit-mode"]=i;
    vals["knacks-edit-mode"]=i;
    vals["skills-edit-mode"]=i;
    vals["spells-talents-edit-mode"]=i;
    vals["spellmatrix-edit-mode"]=i;
    vals["spells-edit-mode"]=i;
    vals["equipment-edit-mode"]=i;
    vals["thread-edit-mode"]=i;
    vals["blood-edit-mode"]=i;
    vals["mount-edit-mode"]=i;
    setAttrsLog(vals);
  }
  });
} catch(err) {log("Earthdawn:resetEditMode() error caught: " + err );}
}; // End resetEditMode()
on("change:tab change:creationmode", fn(resetEditMode));



//UpdateKask() : Karma mode works with 2 modes
//In AUTO KarmaGlobalMode-Auto==1, any roll of an ability ABC will be done with exactly ABC_Karma Karma points
//In ASK, KarmaGlobalMode-Ask==1, any roll will trigger a query asking how many Karma to spend between ABC_Karma-Limit and ABC_Karma-Limit_max
// This routine ensures the attribute ABC_Karma-Ask is filled with {How many karma to spend between "Karma_req" and "Karma_max"| "Karma" } with the appropriate values
// This is achieved by having the following syntax in the button : ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}
// When KarmaGlobalMode is not ask, the string ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: will be invalid and ignored
// When KarmaGlobalMode is ask, the string will make an appropriate query
var UpdateKask = function fnUpdateKask(eventInfo) {
  'use strict';
  try{
  //Start by splitting the eventInfo to find what we are working with
  let rec= _.isString(eventInfo); //records if we got called by the recalc function, in which case we will have a complete rowid
  let att =getAttrib(eventInfo);
  let kdp = ( att.toLowerCase().includes("karma")  ? "Karma" : ( att.toLowerCase().includes( "dp" )  ? "DP" : undefined));
  if (!kdp) {log("Earthdawn: UpdateKask() error. Invalid eventInfo:" + att); return;};
  let att2 = att.substring(0, att.toLowerCase().lastIndexOf(kdp.toLowerCase()));
  let pre;
  if (att.startsWith( "repeating") && !rec){ // we got called locally by the trigger repeating sections are vandalized, we have to go back through buildPre
    let code= repeatSection(3,att2);
    pre=buildPre(code); // BuildPre based with no RowId as it is anyways vandalized, and we could only get called locally
  }
  else if (att.startsWith( "repeating") && rec){ // we got called by recalc with a complete name
    let code= repeatSection(3,att2);
    let rid= repeatSection(2,att2);
    if(rid && rid.length<4) log("updateKask incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
    pre=buildPre(code,rid); // BuildPre complete as we got called via the recalc with a complete name
  }
  else{
    pre=att2.charAt(0).toUpperCase()+ att2.substring(1); // Devandalize by re-adding the upper case
  }
  getAttrs( [ pre + kdp, pre+kdp+"-Limit_max", pre+kdp+"-Limit" ] , function gaUpdateKask(values) {
    'use strict';
    let min =  getInt(values,pre+kdp+"-Limit");
    let max=  getInt(values,pre+kdp+"-Limit_max");
    let def=  Math.max(getInt(values,pre+kdp),min);
    let vals={};
    if (min<max) vals[pre+kdp+"-Ask"]="{ " + kdp + " mode is ASK. Choose number of " + kdp + " between " + min + " and " + max +" |"+ def+ "}";
    else vals[pre+kdp+"-Ask"]="0";
    //We only want to offer a choice if min<max
    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:UpdateKask() error caught: " + err );}
}; //end UpdateKask()
on("change:dex-karma-limit_max change:dex-karma change:dex-karma-limit", fn(UpdateKask));
on("change:str-karma-limit_max change:str-karma change:str-karma-limit", fn(UpdateKask));
on("change:tou-karma-limit_max change:tou-karma change:tou-karma-limit", fn(UpdateKask));
on("change:per-karma-limit_max change:per-karma change:per-karma-limit", fn(UpdateKask));
on("change:wil-karma-limit_max change:wil-karma change:wil-karma-limit", fn(UpdateKask));
on("change:cha-karma-limit_max change:cha-karma change:cha-karma-limit", fn(UpdateKask));
on("change:initiative-karma-limit_max change:initiative-karma change:initiative-karma-limit", fn(UpdateKask));
on("change:recovery-karma-limit_max change:recovery-karma change:recovery-karma-limit", fn(UpdateKask));
on("change:dex-dp-limit_max change:dex-dp change:dex-dp-limit", fn(UpdateKask));
on("change:str-dp-limit_max change:str-dp change:str-dp-limit", fn(UpdateKask));
on("change:tou-dp-limit_max change:tou-dp change:tou-dp-limit", fn(UpdateKask));
on("change:per-dp-limit_max change:per-dp change:per-dp-limit", fn(UpdateKask));
on("change:wil-dp-limit_max change:wil-dp change:wil-dp-limit", fn(UpdateKask));
on("change:cha-dp-limit_max change:cha-dp change:cha-dp-limit", fn(UpdateKask));
on("change:initiative-dp-limit_max change:initiative-dp change:initiative-dp-limit", fn(UpdateKask));
on("change:recovery-dp-limit_max change:recovery-dp change:recovery-dp-limit", fn(UpdateKask));
on("change:repeating_talents:t_karma-limit_max change:repeating_talents:t_karma change:repeating_talents:t_karma-limit", fn(UpdateKask));
on("change:repeating_talents:t_dp-limit_max change:repeating_talents:t_dp change:repeating_talents:t_dp-limit", fn(UpdateKask));
on("change:repeating_knacks:nac_karma-limit_max change:repeating_knacks:nac_karma change:repeating_knacks:nac_karma-limit", fn(UpdateKask));
on("change:repeating_knacks:nac_dp-limit_max change:repeating_knacks:nac_dp change:repeating_knacks:nac_dp-limit", fn(UpdateKask));
on("change:repeating_skills:sk_karma-limit_max change:repeating_skills:sk_karma change:repeating_skills:sk_karma-limit", fn(UpdateKask));
on("change:repeating_skills:sk_dp-limit_max change:repeating_skills:sk_dp change:repeating_skills:sk_dp-limit", fn(UpdateKask));
on("change:repeating_weapons:wpn_karma-limit_max change:repeating_weapons:wpn_karma change:repeating_weapons:wpn_karma-limit", fn(UpdateKask));
on("change:repeating_weapons:wpn_dp-limit_max change:repeating_weapons:wpn_dp change:repeating_weapons:wpn_dp-limit", fn(UpdateKask));



var repMatrixNotes = function fnrepMatrixNotes( eventInfo) {
  'use strict';
  try{
  //Start by splitting the eventInfo to find what we are working with
  let att =getAttrib(eventInfo);
  if (att==="" || eventInfo["sourceType"] !=="player") return;
  let show=eventInfo["newValue"];
  let rowid = repeatSection(2,att);
  if(rowid && rowid.length<4) log("repMatrixNotes incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
  let pre = buildPre("SPM",rowid);
  let vals={};
  getSectionIDs("repeating_matrix", function gsUpdateCharacterSheetIdMatrix(marray) {
    getAttrs( [pre+"spRowID"] , function garepMatrixNotes(values) {
      let pre2=buildPre("SP",values[pre+"spRowID"])
      getAttrs( [pre2+"Notes"] , function garepMatrixNotes2(values2) {
        for(let i=0; i < marray.length; i++) if(marray[i].toLowerCase()!== rowid.toLowerCase()) vals[buildPre("SPM", marray[i]) + "ShowNotes"]=0;
        vals["Matrix-ShowNotes"]=show;
        vals["Matrix-Notes"]=values2[pre2 + "Notes"] ||"";
        setAttrsLog(vals, {silent:true});
      });
    });
  });
} catch(err) {log("Earthdawn:repMatrixNotes() error caught: " + err );}
}; //end repMatrixNotes()
on("change:repeating_matrix:spm_shownotes", fn(repMatrixNotes));


// When a Spell combat slot changes, see if the spell is in a matrix, and if so change the SPM_CombatSlot
var repSpellCombatSlot = function fnrepSpellCombatSlot( eventInfo) {
  'use strict';
  try{
  let att =getAttrib(eventInfo);
  if (att==="" || eventInfo["sourceType"] !=="player") return;
  let spAtt = buildPre("SP", repeatSection(2, att)) + "spmRowID";
  let vals={};
  getAttrs( [ spAtt ] , function gaSpellCombatSlot(values) {
    let spmrID = values[ spAtt ];
    if( spmrID && spmrID.length > 2 ) {
      vals[ buildPre( "SPM", spmrID ) + "CombatSlot" ] = eventInfo[ "newValue" ];
      setAttrsLog(vals, {silent:true});
    }
  });
} catch(err) {log("Earthdawn:repSpellCombatSlot() error caught: " + err );}
}; //end repSpellCombatSlot()
on("change:repeating_spell:sp_combatslot", fn(repSpellCombatSlot));



//This function creates brand new spellcasting Talents
on("clicked:repeating_discipline:createtalents", fn(function ocCreateTalents(eventInfo) {
  'use strict';
  try{
    //Important Comment : Action Buttons in repeating sections DO NOT WORK, if there is an underscore, so it can't follow the usual repeating_section_rowid_code_name syntax. The button itself will have no code
    let att = getAttrib(eventInfo),
    rid= att.split("_")[2],
    pre= buildPre("DSP",rid)
    function generateRowIdNoUnderscore() {
      return generateRowID().replace(/_/g, "-")
    }

    let vals={},
    attarray=[pre+"Code",pre+"Circle","edition","Questor"]; //Need to have them also directly because pre will be normally cased, while darray will be loweredcased


    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++){
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
      }

    getSectionIDsOrdered("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
      for( let i = 0; i < darray.length; i++){
        attarray.push( buildPre( "DSP", darray[ i ] ) + "Code");
        attarray.push( buildPre( "DSP", darray[ i ] ) + "PathName");
        attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
      }
      getAttrs( attarray , function gaCreateTalents(values) {
        let ddata=DiscData(values[pre+"Code"],values["edition"],values[pre+"PathName"],values["Questor"]);

        if(!ddata.isdisc || values[pre+"Code"] =="0.5"){
          log("Earthdawn CreateTalent error. Tried to create for uneligible discipline " + values[pre+"Code"]);
          return;
        }
        let tnamearray=[];
        let nbdisc=0,
          nbsc=0,
          ddatatmp,newId,newInfo,flags="",dtarr,mincircle=15,multinb=0;

        for( let i = 0; i < tarray.length; i++) //Create an array of all pre-existing Talents to detected duplicates
          tnamearray.push( values[buildPre( "T", tarray[ i ] ) + "Name"].toLowerCase());

          log("tnamearray "+JSON.stringify(tnamearray))
        for( let i = 0; i < darray.length; i++){ //Count the number of disciplines and spellcasting
          ddatatmp=DiscData( values [buildPre( "DSP", darray[ i ] ) + "Code"],values["edition"],"","");
          if(ddatatmp.isdisc) nbdisc++;
          if(ddatatmp.issc) nbsc++;
          if(ddatatmp.isdisc && values [buildPre( "DSP", darray[ i ] ) + "Code"] !== values [pre + "Code"])
            mincircle=Math.min(mincircle, getInt(values,buildPre( "DSP", darray[ i ] ) + "Circle"));
        }
        nbdisc=Math.min(nbdisc,4);

        //Free Talent
        if(ddata.free){
        newId = generateRowIdNoUnderscore();
        newInfo = buildPre( "T", newId );
        vals[newInfo+"RowID"]=newId;
        vals[newInfo+"Name"]=ddata.free;
        vals[newInfo+"Type"]="Free";
        flags=addAPIflag( flags, "LinkAdd1", "T : " + newId + " : DSP : " + ddata.name); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing
        }

        //Discipline Talents
        if(ddata.c1 && ddata.c1.dt){
        dtarr=ddata.c1.dt.split(",");
        for( let i = 0; i < dtarr.length; i++){
          if( tnamearray.indexOf(dtarr[i].toLowerCase()) ==-1){ //process only if the talent doesn't already exist
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "T", newId );
            vals[newInfo+"RowID"]=newId;
            vals[newInfo+"Name"]=dtarr[i];
            vals[newInfo+"Type"]="D"+nbdisc+"-Novice";
            multinb++;
          }
        }
      }

        //Talent Options
        if(ddata.c1 && ddata.c1.to){
        newId = generateRowIdNoUnderscore();
        newInfo = buildPre( "T", newId );
        vals[newInfo+"RowID"]=newId;
        vals[newInfo+"Name"]="Talent Option";
        vals[newInfo+"Type"]="TO"+nbdisc+"-Novice";
        vals[newInfo+"Notes"]="List of Talent Options :" + ddata.c1.to + " - Enter Talent Name Above" + (ddata.issc ? " - For Matrix Talent Option, delete this line, and create a Matrix in the Spells Tab " :"") + ";;;"; //the ;;; will be the marker of end of list for AutoFill
        vals[newInfo+"ShowNotes"]="1";
        }
        //Spellcaster - Matrix and WIL

        if(ddatatmp.issc && nbsc==1){
          for( let i = 0; i < 2; i++ ) {
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "SPM", newId );
            vals[newInfo + "RowID"] = newId;
            vals[newInfo + "Type"] = "-10";
            vals[newInfo + "Origin"] = "Free-link";
            flags=addAPIflag( flags, "LinkAdd1", "SPM : " + newId + " : DSP : " + ddata.name); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing
          }

          newId = generateRowIdNoUnderscore();
          newInfo = buildPre( "T", newId );
          vals[newInfo + "Name"] = "WIL";
          vals[newInfo + "RowID"] = newId;
          vals[newInfo + "Type"] = "Special";
          vals[newInfo + "Notes"] = "This is a dummy Talent, that holds the willpower value that will be used for Spell Effect Tests. Do Not delete except if character is a non-spellcaster";
        }

        if(nbdisc>=2){
          vals["LP-D"+nbdisc+"-Talents"]=multinb;
          vals["LP-D"+nbdisc+"-Circle"]=mincircle;
        }


        if(flags!=="") vals[ "APIflag" ]=flags;
        vals[pre+"show-createbutton"]=0;
        setAttrsLog(vals);
      });
      });
      });
    } catch(err) {log("Earthdawn:ocCreateTalents() error caught: " + err );}
  })); //End ocCreateTalents()





var updateLPSummary = function fnupdateLPSummary() {
  'use strict';
  try{
  let statarray = ["Dex","Str","Tou","Per","Wil","Cha"];
  let attarray = ["Attrib-Dex-Increases","Attrib-Str-Increases","Attrib-Tou-Increases","Attrib-Per-Increases","Attrib-Wil-Increases","Attrib-Cha-Increases","LP-CreationOffset","LP-CreationOffset-Spells","LS-Speak-Rank","LS-ReadWrite-Rank","LP-Current","LP-Total", "LP-SpellsOption","Per-Step","NbDisc","LP-AttribOption","LP-Extra-Cost","LP-D2-Circle","LP-D3-Circle","LP-D4-Circle","LP-D2-Talents","LP-D3-Talents","LP-D4-Talents"];

  // log ( "EarthDawn : updateLPSummary() ");
  getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(marray) {
    for( let i = 0; i < marray.length; i++) {
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Rank");
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Origin");
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Type");
    }
    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
      }
      getSectionIDs("repeating_discipline", function gsIdRepeatingTalents(darray) {
        for( let i = 0; i < darray.length; i++) {
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Code");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "PathName");
        }
        getSectionIDsOrdered("repeating_knacks", function gsIdRepeatingKnack(karray) {
          for( let i = 0; i < karray.length; i++){
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Requirements");
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Type");
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Name");
          }
          getSectionIDsOrdered("repeating_spell", function gsIdRepeatingSpells(sparray) {
            for( let i = 0; i < sparray.length; i++){
              attarray.push( buildPre( "SP", sparray[ i ] ) + "Circle");
              attarray.push( buildPre( "SP", sparray[ i ] ) + "Name");
            }
            getSectionIDsOrdered("repeating_threads", function gsIdRepeatingThreads(tiarray) {
              for( let i = 0; i < tiarray.length; i++){
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Rank");
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Type");
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Name");
              }
              getSectionIDsOrdered("repeating_skills", function gsIdRepeatingSkills(skarray) {
                for( let i = 0; i < skarray.length; i++){
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Rank");
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Type");
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Name");
                }
                getAttrs( attarray , function gaTalentSummary(values) {
                  'use strict';
                  logvalues( values);
                  var CalcOffset = function(t,d,n) { //calcoffset to be determined depending on the discipline and the tier
                    'use strict';
                    let o;
                    switch(t.toLowerCase()){
                      case "follower":
                      case "novice" : o=0; break;
                      case "adherant":
                      case "journeyman" : o=1; break;
                      case "exemplar" :
                      case "warden" : o=2; break;
                      case "master" : o=3; break;
                      default : log("EarthDawn LPSummary - CalcOffset - Unknown discipline Tier for "+ n +" : "+ JSON.stringify(t)); return 0;
                    }
                    if(!d) return o; //If no discipline number specified, calculate just with the offset due to tier
                    if( isNaN(parseInt(d[d.length-1]))) {log("EarthDawn LPSummary - CalcOffset - Unknown discipline number : "+ JSON.stringify(d)); return o;}
                    else return (Math.min(3,o+parseInt(d[d.length-1])-1)); //1st discipline, no offset, each subsequent discipline counts as 1 rank higher in the Fibonacci
                  };
                  let fibocost= [0,100,200,300,500,800,1300,2100,3400,5500,8900,14400,23300,37700,61000,98700,159700,258400,418100];
                  let rnk=0,off=0,orig=0,inc=0,st=0;
                  let trnk=8, skrnk=14;
                  let sprnk=getInt(values,"Per-Step")
                  let s="";
                  let val=0;
                  let spval=0;
                  let vals={};
                  s+="*************************************************************** LEGEND POINTS REPORT ***************************************************************\n";
                  // s+="Free LP (corresponding to character creation) : " + getInt(values,"LP-CreationOffset") +"\n";
                  // s+="Current available LP" + getInt(values,"LP-Current") +"\n";
                  // s+=((getInt(values,"LP-SpellsOption")===1) ? "Spells Cost LP \n" : "Spells Cost no LP \n");
                  //LP Cost Attribute
                  if(getInt(values,"LP-AttribOption")==1)
                  for( let i = 0; i < statarray.length; i++) {
                    rnk = getInt( values, "Attrib-" + statarray[ i ]  + "-Increases" );
                    if(rnk>0)  {
                      inc=0;
                      for(let j=1; j<=rnk; j++)   inc+=fibocost[j+4]; //Attributes : Increase 1 is 800, like Rank 5 novice
                      val+=inc;
                      s+= statarray[ i ] + " increased by " + rnk + " LP-Cost : " + inc + "\n";
                    }
                  };

                  //Path and Questor
                  for(let i = 0; i < darray.length; i++) {
                    let pre=buildPre( "DSP", darray[ i ] );
                    rnk = getInt( values, pre + "Circle" );
                    let disc= values[pre+"Code"];
                    switch(disc){
                      case "81.0" : off=1; s+= "Path " + (values[pre+"PathName"] || "" ) + " costing like Journeyman :"; break;
                      case "83.0" : off=3; s+= "Path " + (values[pre+"PathName"] || "" ) + " costing like Master :";break;
                      case "89.0" : off=1; s+= "Questor devotion costing like Journeyman :";break;
                      default : off=-1;
                    }
                    if (off !==-1){ //other cases don't cost anything.
                      inc=0;
                      for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                      val+=inc;
                      s+= " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };

                  //Multi-Discipline Extra costs
                  val+=getInt(values,"LP-Extra-Cost");
                  s+= "Extra Cost : " + getInt(values,"LP-Extra-Cost") +"\n";
                  if(getInt(values,"NbDisc")>=2){
                    off=1;
                    inc= getInt(values,"LP-D2-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D2-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 2nd Discipline " + getInt(values,"LP-D2-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D2-Circle") + " extra LP-Cost: " +  inc +"\n";
                  }
                  if(getInt(values,"NbDisc")>=3){
                    off=2;
                    inc= getInt(values,"LP-D3-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D3-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 3rd Discipline " + getInt(values,"LP-D3-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D3-Circle") + " extra LP-Cost: " +  inc +"\n";
                  }
                  if(getInt(values,"NbDisc")>=4){
                    off=3;
                    inc= getInt(values,"LP-D4-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D4-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 4th Discipline " + getInt(values,"LP-D4-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D4-Circle") + " extra LP-Cost: " +  inc +"\n";
                  }

                  //LP Cost Talents
                  for( let i = 0; i < tarray.length; i++) {
                    let pre=buildPre( "T", tarray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="D1-Novice";
                    if(rnk>0){
                      off=-1;
                      if(orig==="Racial")
                      off=0; //Racial talents like Novice
                      if(orig.startsWith("D") && orig!=="Dummy") //Discipline Talent. This is the default
                      off=CalcOffset(orig.substring(3),orig.substring(0,2),values[pre+"Name"]);
                      else if(orig.startsWith("TO")) //Talent Option
                      off=CalcOffset(orig.substring(4),orig.substring(0,3),values[pre+"Name"]);
                      else if (orig.startsWith("PA"))  //Path
                      off=CalcOffset(orig.substring(3),undefined,values[pre+"Name"]);
                      else if (orig.startsWith("QD"))  //Questor
                      off=CalcOffset(orig.substring(3),undefined,values[pre+"Name"]);
                      else if (orig.startsWith("V-"))  //Versatility
                      off=CalcOffset(orig.substring(2),undefined,values[pre+"Name"])+1;
                      if (off !==-1){ //other cases don't cost anything.
                        trnk-=rnk;
                        inc=0;
                        for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                        val+=inc;
                        st+=inc;
                        s+= "Talent " + values[buildPre( "T", tarray[ i ] ) + "Name"] +" with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                      }
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL TALENTS : " + st +"\n";
                  st=0;
                  //LP Cost Matrix
                  for( let i = 0; i < marray.length; i++) {
                    let pre=buildPre( "SPM", marray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Origin" ];
                    inc=0;
                    if(rnk>0){
                      switch (orig.charAt(0)){
                        case "V" : off=CalcOffset(orig.substring(2),undefined,values[pre+"Name"]); //Versatility No break, we want to go through the rest
                        case "T" : off=CalcOffset(orig.substring(4),orig.substring(0,3),values[pre+"Name"]); // Talent Options
                        for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                        val+=inc;
                        st+=inc;
                        trnk-=rnk;
                        s+= "Matrix " + " with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                        break;
                        default:  ;
                      };
                    };
                  };
                  s+= "************************************************************************************ SUBTOTAL MATRIX : " + st +"\n";
                  st=0;
                  //LP Cost Knacks
                  for( let i = 0; i < karray.length; i++) {
                    rnk = getInt( values, buildPre( "NAC", karray[ i ] ) + "Requirements" );
                    orig=values[buildPre( "NAC", karray[ i ] ) + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Knack";
                    if(rnk>0 && orig=="Knack")   {
                      inc=fibocost[rnk]; //Knacks cost like Novice Talents, no offset
                      val+=inc;
                      st+=inc;
                      s+= "Knack " + values[buildPre( "NAC", karray[ i ] ) + "Name"] + " with required Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL KNACKS : " + st +"\n";
                  st=0;
                  //LP Cost Skills
                  for( let i = 0; i < skarray.length; i++) {
                    let pre=buildPre( "SK", skarray[ i ] );
                    rnk = getInt( values,  pre+ "Rank" );
                    orig=values[pre + "Type"];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Novice";
                    if(rnk>0){
                      inc=0;
                      skrnk-=rnk;
                      off=CalcOffset(orig,undefined,values[pre+"Name"])+1; //Novice Skills count like Journeyman Talent
                      for(let j=1; j<=rnk; j++) inc+=fibocost[j+off];
                      val+=inc;
                      st+=inc;
                      s+= "Skill " + values[buildPre( "SK", skarray[ i ] ) + "Name"] +" with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  //ReadWrite and Speak are novice Skills, that count like Journeyman Talents
                  if(getInt(values,"LS-Speak-Rank")>0){
                    skrnk-=getInt(values,"LS-Speak-Rank");
                    inc=0
                    for(let j=1; j<=getInt(values,"LS-Speak-Rank"); j++) inc+=fibocost[j+1];
                    val+=inc;
                    st+=inc;
                    s+= "Skill Speak Languages (that counts as Novice) at Rank " + getInt(values,"LS-Speak-Rank") + " LP-Cost : " + inc +"\n";
                  }
                  if(getInt(values,"LS-ReadWrite-Rank")>0){
                    skrnk-=getInt(values,"LS-ReadWrite-Rank");
                    inc=0
                    for(let j=1; j<=getInt(values,"LS-ReadWrite-Rank"); j++) inc+=fibocost[j+1];
                    val+=inc;
                    st+=inc;
                    s+= "Skill R/W Languages (that counts as Novice) at Rank " + getInt(values,"LS-ReadWrite-Rank") + " LP-Cost : " + inc +"\n";
                  }
                  s+= "************************************************************************************ SUBTOTAL SKILLS & LANGUAGES : " + st +"\n";
                  st=0;
                  //Thread Items
                  for( let i = 0; i < tiarray.length; i++) {
                    let pre=buildPre( "TI", tiarray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Novice";
                    off=CalcOffset(orig,undefined,values[pre+"Name"]); //Will return undefined if not one of the Tiers
                    if(rnk>0 &&(orig=="Novice"|| orig=="Journeyman"|| orig=="Warden"|| orig=="Master"))
                    {
                      inc=0
                      for(let j=1; j<=rnk; j++) inc+=fibocost[j+off];  //Thread Items like Talents
                      val+=inc;
                      st+=inc;
                      s+= "Thread Item " + values[buildPre( "TI", tiarray[ i ] ) + "Name"] +" with Tier " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL THREADS : " + st +"\n";
                  st=0;
                  //LP Cost Spells
                  for( let i = 0; i < sparray.length; i++) {
                    rnk = getInt( values, buildPre( "SP", sparray[ i ] ) + "Circle" );
                    if(rnk>0)  {
                      sprnk-=rnk;
                      inc=fibocost[rnk]; //Spells cost like Novice Talents, no offset
                      spval+=inc;
                      st+=inc
                      if(getInt(values,"LP-SpellsOption")===1)
                      s+= "Spell " + values[buildPre( "SP", sparray[ i ] ) + "Name"]  + " of Circle" + rnk + " LP-Cost : " + inc +"\n";
                    };
                  }
                  if(getInt(values,"LP-SpellsOption")===1) {s+= "SUBTOTAL SPELLS : " + st +"\n"; val+=spval}
                  st=0;
                  vals["LP-Summary"]=s;
                  vals["LP-Calc"]=val;
                  vals["Talents-Costs"]=trnk;
                  vals["Skills-Costs"]=skrnk;
                  vals["Spells-Costs"]=sprnk;
                  vals["LP-Current-Calc"]=getInt(values,"LP-Total") + getInt(values,"LP-CreationOffset") + ((getInt(values,"LP-SpellsOption")===1)? getInt(values,"LP-CreationOffset-Spells"): 0) -val;
                  setAttrsLog(vals);
                });
              });
            });
          });
        });
      });
    });
  });
} catch(err) {log("Earthdawn:updateLPSummary() error caught: " + err );}
}; // End updateLPSummary()
on("change:repeating_skills:sk_rank change:repeating_skills:sk_type change:repeating_threads:ti_rank change:repeating_threads:ti_type change:repeating_matrix:spm_rank change:repeating_matrix:spm_origin change:repeating_talents:t_rank change:repeating_talents:t_type change:repeating_knacks:nac_requirements change:repeating_knacks:nac_type change:repeating_spell remove:repeating_talents remove:repeating_matrix remove:repeating_spell remove:repeating_knacks remove:repeating_threads remove:repeating_skills change:repeating_discipline remove:repeating_discipline", fn(updateLPSummary) );
on("change:attrib-dex-increases change:attrib-str-increases change:attrib-tou-increases change:attrib-per-increases change:attrib-wil-increases change:attrib-cha-increases change:lp-creationoffset change:lp-creationoffset-spells change:lp-current change:lp-total change:lp-spellsoption change:per-step change:ls-speak-rank change:ls-readwrite-rank change:lp-attriboption change:lp-extra-cost change:nbdisc change:lp-d2-circle change:lp-d3-circle change:lp-d4-circle change:lp-d2-talents change:lp-d3-talents change:lp-d4-talents", fn(updateLPSummary) );



on("clicked:post_update", fn(function ocPost_Update() {
  'use strict';
  try{
  getAttrs([ "record-type","record-reason", "record-item","record-journal", "record-amount-LP" , "record-amount-SP","record-date-throalic","LP-Total","LP-Current","Wealth_Silver"], function(values) {
    let vals = {};
    let d = new Date(),
     n = d.getFullYear()+"-"+(d.getMonth() +1)+"-"+d.getDate(),
     i=(values["record-item"] || "SP"),
     lp= i.startsWith("LP"),
     sp= i.endsWith("SP");

     if(sp) switch((values["record-type"] || "Gain")){
       case "Spend" :
       case "Decrease" : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") - getInt(values,"record-amount-SP"); break;
       case "Gain" :
       case "Refund" : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") + getInt(values,"record-amount-SP"); break;
       default : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") + getInt(values,"record-amount-SP");
     }

     if(lp) switch((values["record-type"] || "Gain")){
       case "Decrease" :   vals["LP-Total"]=getInt(values,"LP-Total") - getInt(values,"record-amount-LP");
       case "Spend" : vals["LP-Current"]=getInt(values,"LP-Current") - getInt(values,"record-amount-LP"); break;
       case "Gain" : vals["LP-Total"]=getInt(values,"LP-Total") + getInt(values,"record-amount-LP");
       case "Refund" : vals["LP-Current"]=getInt(values,"LP-Current") + getInt(values,"record-amount-LP"); break;
       default :
       vals["LP-Total"]=getInt(values,"LP-Total") + getInt(values,"record-amount-LP");
       vals["LP-Current"]=getInt(values,"LP-Current") + getInt(values,"record-amount-LP");
     }

     vals["record-journal"]= n + "   " + (values["record-date-throalic"] ||"")+ " "
      + ((lp || sp ) ? (values["record-type"] ||"") : "")
      + " "
      + (lp ? (getInt(values,"record-amount-LP") + " LP (New Total " + vals["LP-Current"] + " LP)  ") :"")
      + (lp &&sp ? " & " :"")
      + (sp ? (getInt(values,"record-amount-SP") + " SP (New Total " + vals["Wealth_Silver"] + " SP)  ") :"")
      + " : " + (values["record-reason"] ||"") + "\n" + (values["record-journal"] ||"");
     vals["record-reason"]="";
    setAttrsLog(vals);
  });
} catch(err) {log("Earthdawn:ocPost_Update() error caught: " + err );}
})); //End ocPost_Update




on("clicked:endcreation_post", fn(function ocEndAndPost() {
  'use strict';
  getAttrs([ "Per-Step","LP-Calc", "Spells-Costs", "NPC" ], function(values) {
    let vals = {};
    // vals["show_tips"] = values["NPC"]=="0"? "1" :"0";
    vals[ "tab" ] = values["NPC"]=="0"? "11" :"1";
    vals[ "tab-adjust" ] = "4";

    vals["CreationMode"]=0;
    vals["LP-CreationOffset-Spells"]=100*(getInt(values,"Per-Step")-getInt(values,"Spells-Costs")); //Spells at creation are level 1 or level 2, so 100 per Rank. Store separately the offset for the number of spells known
    vals["LP-CreationOffset"]=getInt(values,"LP-Calc")-vals["LP-CreationOffset-Spells"]; //Store only the current LP-Cost as the offset
    setAttrsLog(vals);
  });
})); //End ocEndCreationAndPost


on("clicked:set_lp_offset", fn(function ocSetLPOffset() {
  'use strict';
  getAttrs([ "LP-Current","LP-Total", "LP-Calc" ], function(values) {
    let vals = {};

    vals["LP-CreationOffset"]=getInt(values,"LP-Current")-getInt(values,"LP-Total")+getInt(values,"LP-Calc");
    vals["LP-CreationOffset-Spells"]=0;
    setAttrsLog(vals);
  });
})); //End ocEndCreationAndPost




on("clicked:endcreation_nopost", fn(function ocEndAndNoPost() {
  'use strict';
  let vals = {};
  getAttrs([ "NPC" ], function(values) {
  // vals["show_tips"] = values["NPC"]=="0"? "1" :"0";
  vals[ "tab" ] = values["NPC"]=="0"? "11" :"1";
  vals[ "tab-adjust" ] = "4";
  vals["CreationMode"]=0;
  setAttrsLog(vals);
});
})); //End ocEndCreationAndNpoPost




var AutoFill = function fnAutoFill(eventInfo) {
  'use strict';
  try{
    // log("AutoFill " + JSON.stringify(eventInfo));
  //Start by splitting the eventInfo to find what we are working with
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let code = repeatSection(3,att);
  let rowid = repeatSection(2,att);
  let pre = buildPre(code,rowid);
  getAttrs( [pre+"Name",pre+"Notes",pre+"Rank",pre+"Attribute",pre+"RowID","edition","APIflag","Race","Dex-Step","Str-Step","Tou-Step","Per-Step","Wil-Step","Cha-Step"], function gaAutoFill(values) {

    function singleAttr( key, val) {
      let vals={};
      vals[ pre + key ] = val;
      setAttrsLog( vals );
    }

    let entry,
    names=[],
    notes="",
    exactmatch,tname;
    // if (att==="" || eventInfo["sourceType"] !=="player") return;
    // To populate database from the Excel, Copy all the lines in the Excel, paste within the [], remove the last ,, and search and replace ""(0)"" by "(0)"
    let database;
    if(values["edition"]=="-1")
      database=[]; //1879
    else database=[  //ED All editions. Done for ED4, but close enough for other editions

      {names: "Acrobatic Defense"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"PDh"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG124"}	,
      {names: "Air Dance"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Init"	,target:"None"		,special:"Initiative"				,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG124"}	,
      {names: "Air Sailing"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"		,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on PG125"}	,
      {names: "Air Speaking"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG125"}	,
      {names: "Ancient Bonds"	,attribute:"Per"	,action:"NA"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP191"}	,
      {names: "Animal Bond"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG125"}	,
      {names: "Animal Training"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG127"}	,
      {names: "Anticipate Blow"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG128"}	,
      {names: "Applied Knowledge"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on MP191"}	,
      {names: "Arcane Mutterings"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG128"}	,
      {names: "Arrow Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Astral Interference"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG129"}	,
      {names: "Astral Sight"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on PG129"}	,
      {names: "Avoid Blow"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"Ask: PD: ?{Target Number, maybe relative to PD|0}"				,defensive:"1"		,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG129"}	,
      {names: "Awareness"	,attribute:"Per"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"									,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG129"}	,
      {names: "Bane Strike"		,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP192 - Use Talents to spend the Strain, Manually enter the bonus to appropriate Test, or create an appropriate link"}	,
      {names: "Battle Shout"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG131"}	,
      {names: "Bear Mark"	,attribute:"Wil"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP192"}	,
      {names: "Beast Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Blood Share"	,attribute:"Tou"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on PG132"}	,
      {names: "Body Control"	,attribute:"Str"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Damage"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP192 - Add Weapon Size Limit as Rank-Adjust"}	,
      {names: "Book Memory"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"				,target:"5"													,notes: "Talent Autofilled - Description of ability can be found on PG132"}	,
      {names: "Borrow Sense"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG132"}	,
      {names: "Call Animal Companion"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG133"}	,
      {names: "Call Missile"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"		,armortype:"N/A"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG133"}	,
      {names: "Call of Harrow"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"								,visionbased:"1"						,notes: "Talent Autofilled - Description of ability can be found on MP193"}	,
      {names: "Ch'tard Dance,Ch tard Dance,Chtard Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDhp1p"						,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP193 - 1 Strain per target"}	,
      {names: "Ch'tard Pierce,Ch tard Pierce,Chtard Pierce"	,attribute:"Dex"	,action:"Simple"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP194"}	,
      {names: "Charge"	,attribute:"Str"	,action:"Free"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG133 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Claw Shape"	,attribute:"Str"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"	,rankadjust:"3"				,notes: "Talent Autofilled - Description of ability can be found on PG134"}	,
      {names: "Climbing"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"								,movebased:"1"	,visionbased:"1"						,notes: "Talent Autofilled - Description of ability can be found on PG134"}	,
      {names: "Command Nightflyer"	,attribute:"Wil"	,action:"Sustained"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG135"}	,
      {names: "Conversation"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG136"}	,
      {names: "Craftsman"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG195"}	,
      {names: "Creature Analysis"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG136"}	,
      {names: "Dance Partner"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP194"}	,
      {names: "Danger Sense"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG137"}	,
      {names: "Dead Fall"	,attribute:"Wil"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"						,resistance:"1"								,notes: "Talent Autofilled - Description of ability can be found on PG137"}	,
      {names: "Delibarate Assault"		,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP194"}	,
      {names: "Diplomacy"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG138"}	,
      {names: "Disarm Trap"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"							,visionbased:"1"	,combatslot:"0"					,notes: "Talent Autofilled - Description of ability can be found on PG138"}	,
      {names: "Disguise Self"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on PG138"}	,
      {names: "Dispel Magic"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG139"}	,
      {names: "Distract"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG139"}	,
      {names: "Dive Attack"	,attribute:"Str"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Damage CC"		,armortype:"PA"					,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP195 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Dominate Beast"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG140"}	,
      {names: "Earth bond"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"5"													,notes: "Talent Autofilled - Description of ability can be found on MP195"}	,
      {names: "Earth Speak"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP195"}	,
      {names: "Earth Walk"		,action:"Sustained"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on MP196"}	,
      {names: "Edo Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDhp1p"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP196 - 1 Strain per target"}	,
      {names: "Edo Sweep"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP197"}	,
      {names: "Elemental Hold"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG141"}	,
      {names: "Elemental Tongues"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG141"}	,
      {names: "Elementalism"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Elementalism"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Emotion Song"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG141"}	,
      {names: "Empathic Sense"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG142"}	,
      {names: "Engaging Banter"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG143"}	,
      {names: "Engaging Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP198"}	,
      {names: "Enhance Animal Companion"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG143"}	,
      {names: "Etiquette"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG144"}	,
      {names: "Expansive Expertise"		,action:"NA"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP198"}	,
      {names: "False Sight"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG145"}	,
      {names: "Fire Heal"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG147"}	,
      {names: "Fireblood"	,attribute:"Tou"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"		,armortype:"N/A"	,special:"Recovery"			,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG146"}	,
      {names: "Fires of Gahad"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"					,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP199"}	,
      {names: "First Impression"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG147"}	,
      {names: "Focused Strike"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP199 - Added to a Damage Test Note that links don't apply because it doesn't count double attribute (likely STR and WIL)"}	,
      {names: "Forest Sense"	,attribute:"Per"	,action:"Sustained"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP199"}	,
      {names: "Forge Weapon"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG148"}	,
      {names: "Frighten"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG149"}	,
      {names: "Gauntlet Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Gaze into the Abyss"		,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP200 - Use Talents to spend the Strain, Manually enter the bonus to appropriate Test, or create an appropriate link"}	,
      {names: "Graceful Exit"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG151"}	,
      {names: "Great Leap"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Effect"		,armortype:"N/A"					,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG151"}	,
      {names: "Guardian's Service"		,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP200"}	,
      {names: "Haggle"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG152"}	,
      {names: "Heartening Laugh"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG152"}	,
      {names: "Illusionism"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Illusionism"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Item History"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG155"}	,
      {names: "Liberation"	,attribute:"Cha"	,action:"Simple"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP200"}	,
      {names: "Lock Picking"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG157"}	,
      {names: "Long Shot"		,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG157"}	,
      {names: "Maneuver"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG158"}	,
      {names: "Melee Weapons,Melee Weapon"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG158"}	,
      {names: "Mimic Voice"	,attribute:"Cha"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on PG158"}	,
      {names: "Missile Weapons"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Attack"	,target:"PD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG158"}	,
      {names: "Morphism"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP201"}	,
      {names: "Mystic Aim"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG159"}	,
      {names: "Mystic Pursuit"	,attribute:"Per"	,action:"Standard"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG159"}	,
      {names: "Navigation"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG160"}	,
      {names: "Nethermancy"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Nethermancy"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Patient Resilience"		,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP201"}	,
      {names: "Patterncraft"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Patterncraft"											,notes: "Talent Autofilled - Description of ability can be found on PG161"}	,
      {names: "Picking Pockets"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on PG161"}	,
      {names: "Pilot Boat"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG199"}	,
      {names: "Purge Karma"	,attribute:"Wil"	,action:"Simple"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP203"}	,
      {names: "Purification"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP203"}	,
      {names: "Read and Write Language,RW Language,Read & Write Language,Read&Write Language,R/W Language,Read/Write Language"	,attribute:"Per"	,action:"Sustained"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"RW Language"											,notes: "Talent Autofilled - Description of ability can be found on PG162"}	,
      {names: "Read River"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on MP204"}	,
      {names: "Research"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG163"}	,
      {names: "Rider Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Riposte"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"				,defensive:"1"		,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG165"}	,
      {names: "Rite of Kho'Pesh,Rite of Kho Pesh,Rite of KhoPesh"		,action:"Sustained"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP204"}	,
      {names: "River Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Sailing"	,attribute:"Dex"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG199"}	,
      {names: "Scout Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Sea Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Sense Captive"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP205"}	,
      {names: "Sense Horrorspawn"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on MP205"}	,
      {names: "Shamanism"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Shamanism"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Shatter Will"	,attribute:"Wil"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP206"}	,
      {names: "Shield Bash"	,attribute:"Str"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG166"}	,
      {names: "Shivoavara Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDhp1p"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP206 - 1 Strain per target"}	,
      {names: "Shivoavara Escalation"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"10"						,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP206"}	,
      {names: "Shout of Justice"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP207"}	,
      {names: "Skora Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SDhp1p"													,notes: "Talent Autofilled - Description of ability can be found on MP207"}	,
      {names: "Skora Slam"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP208"}	,
      {names: "Sky Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Speak Language"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"Speak Language"											,notes: "Talent Autofilled - Description of ability can be found on PG167"}	,
      {names: "Spell Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Power"						,combatslot:"1"					,notes: "Talent Autofilled - Used for Thread Weaving for Creatures and Spirits"}	,
      {names: "Spellcasting"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"		,special:"SPL-Spellcasting"					,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG168"}	,
      {names: "Spirit Covenant"	,attribute:"Cha"	,action:"Standard"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"														,notes: "Talent Autofilled - Description of ability can be found on MP208"}	,
      {names: "Spirit Hold"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG168"}	,
      {names: "Spirit Talk"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG169"}	,
      {names: "Sprint"		,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG170"}	,
      {names: "Stealthy Stride"	,attribute:"Dex"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG170"}	,
      {names: "Steel Thought"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"				,defensive:"1"	,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG170"}	,
      {names: "Story Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Studied Counter"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP209"}	,
      {names: "Suppress Curse"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG171"}	,
      {names: "Sure Mount"	,attribute:"Str"	,action:"Free"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"Knockdown"		,defensive:"1"	,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG172"}	,
      {names: "Surprise Strike"	,attribute:"Str"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG172 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Swift Kick"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG172"}	,
      {names: "Swimming"	,attribute:"Str"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG201"}	,
      {names: "Tail Dance"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"Action"	,target:"10"						,movebased:"1"		,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on MP209"}	,
      {names: "Tail Spike"	,attribute:"Str"	,action:"Simple"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"	,rankadjust:"3"				,notes: "Talent Autofilled - Description of ability can be found on MP209"}	,
      {names: "Taunt"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG173"}	,
      {names: "Tenacious Weave"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG173"}	,
      {names: "Thief Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Thread Smithing"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Thread Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Throwing Weapons"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Attack"	,target:"PD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG175"}	,
      {names: "Tiger Spring"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Init"	,target:"None"		,special:"Initiative"	,karma:"0"			,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG175 - Talent filled in as Rank +Dex and not just Rank. Use Talent instead of Initiative"}	,
      {names: "Tracking"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG175"}	,
      {names: "Trick Riding"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"						,defensive:"1"				,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG176"}	,
      {names: "True Shot"		,action:"Free"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG176"}	,
      {names: "True Sight"		,action:"NA"		,talenttype:"Novice"	,talentrank:"1"											,visionbased:"1"						,notes: "Talent Autofilled - Description of ability can be found on PG176"}	,
      {names: "Tyranny's Ruin,Tyrannys Ruin,Tyranny Ruin"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP210"}	,
      {names: "Unarmed Combat"	,attribute:"Dex"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG177"}	,
      {names: "Versatility"		,action:"NA"		,talenttype:"Racial"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on PG177"}	,
      {names: "Waterfall Slam"		,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG178"}	,
      {names: "Weapon Weaving"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Wil"	,attribute:"Wil"	,action:"Free"		,talenttype:"Special"	,talentrank:"1"			,modtype:"Effect"			,special:"SPL-Willforce"	,karma:"0"					,combatslot:"0"		,exactmatch:"1"			,notes: "Talent Autofilled - This is a dummy Talent, that holds the willpower value that will be used for Spell Effect Tests. Do Not delete except if character is a non-spellcaster"}	,
      {names: "Wilderness Survival"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG179"}	,
      {names: "Wind Catcher"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG180"}	,
      {names: "Wing Blitz"	,attribute:"Dex"	,action:"Free"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Init"	,target:"None"		,special:"Initiative"	,karma:"0"			,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on MP210 - Talent filled in as Rank +Dex and not just Rank. Use Talent instead of Initiative"}	,
      {names: "Winning Smile"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on PG180"}	,
      {names: "Wisdom of Ages"	,attribute:"Wil"	,action:"Sustained"	,strain:"2"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"													,notes: "Talent Autofilled - Description of ability can be found on MP210"}	,
      {names: "Wizardry"	,attribute:"Per"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"SPL-Wizardry"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG174"}	,
      {names: "Wood Skin"	,attribute:"Tou"	,action:"Standard"		,talenttype:"Novice"	,talentrank:"1"			,modtype:"Effect"		,armortype:"N/A"	,special:"Recovery"			,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG180"}	,
      {names: "Wood Speak"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"																	,notes: "Talent Autofilled - Description of ability can be found on MP211"}	,
      {names: "Wood Walk"		,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP212"}	,
      {names: "Wound Balance"	,attribute:"Str"	,action:"Free"		,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Novice"	,skillrank:"1"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"		,special:"Knockdown"		,defensive:"1"	,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG181"}	,
      {names: "Animal Companion Durability"		,action:"NA"		,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG126"}	,
      {names: "Animal Possession"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG126"}	,
      {names: "Animal Talk"	,attribute:"Per"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG127"}	,
      {names: "Armor Mount"	,attribute:"Wil"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG128"}	,
      {names: "Banish"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG130"}	,
      {names: "Bank Shot"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG130"}	,
      {names: "Battle Bellow"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"SDhp1p"													,notes: "Talent Autofilled - Description of ability can be found on PG130"}	,
      {names: "Blade Juggle"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG131"}	,
      {names: "Claw Frenzy"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG134"}	,
      {names: "Cobra Strike"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Init"	,target:"None"		,special:"Initiative"				,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG135"}	,
      {names: "Cold Purify"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG135"}	,
      {names: "Conceal Object"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Effect"		,armortype:"N/A"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG135"}	,
      {names: "Crushing Blow"	,attribute:"Str"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG137 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Disarm"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on PG138"}	,
      {names: "Double Charge"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG140"}	,
      {names: "Down Strike"	,attribute:"Str"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG140 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Earth Skin"	,attribute:"Tou"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG140"}	,
      {names: "Evidence Analysis"	,attribute:"Per"	,action:"Sustained"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"															,notes: "Talent Autofilled - Description of ability can be found on PG144"}	,
      {names: "Fast Hand"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on PG145"}	,
      {names: "Fearsome Charge"	,attribute:"Cha"	,action:"Simple"	,strain:"2"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG146"}	,
      {names: "Flame Arrow"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Damage"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG147 - If you use API, please link to your Weapon of choice to get the appropriate final step"}	,
      {names: "Forge Armor"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG148"}	,
      {names: "Gliding Stride"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Effect"		,armortype:"N/A"					,movebased:"1"		,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG149"}	,
      {names: "Hold Thread"	,attribute:"Wil"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG152"}	,
      {names: "Hypnotize"	,attribute:"Cha"	,action:"Sustained"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"															,notes: "Talent Autofilled - Description of ability can be found on PG153"}	,
      {names: "Impressive Display"		,action:"Simple"	,strain:"1"	,talenttype:"Novice"	,talentrank:"1"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG154"}	,
      {names: "Inspire Others"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"SDhp1p"													,notes: "Talent Autofilled - Description of ability can be found on PG154"}	,
      {names: "Iron Constitution"	,attribute:"Tou"	,action:"Free"		,talenttype:"Journeyman"	,talentrank:"2"									,resistance:"1"								,notes: "Talent Autofilled - Description of ability can be found on PG154"}	,
      {names: "Lasting Impression"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG155"}	,
      {names: "Leadership"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"															,notes: "Talent Autofilled - Description of ability can be found on PG156"}	,
      {names: "Life Check"	,attribute:"Tou"	,action:"Free"		,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Effect"			,special:"Recovery"			,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG156"}	,
      {names: "Lifesight"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"											,visionbased:"1"						,notes: "Talent Autofilled - Description of ability can be found on PG156"}	,
      {names: "Lion Heart"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"									,resistance:"1"								,notes: "Talent Autofilled - Description of ability can be found on PG157"}	,
      {names: "Momentum Attack"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG158"}	,
      {names: "Mount Attack"		,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG159"}	,
      {names: "Orbiting Spy"	,attribute:"Per"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"				,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on PG160"}	,
      {names: "Power Mask"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"									,resistance:"1"								,notes: "Talent Autofilled - Description of ability can be found on PG162"}	,
      {names: "Resist Taunt"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"				,defensive:"1"	,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG164"}	,
      {names: "Safe Path"	,attribute:"Per"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG165"}	,
      {names: "Second Attack"	,attribute:"Dex"	,action:"Simple"	,strain:"2"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG166"}	,
      {names: "Second Shot"	,attribute:"Dex"	,action:"Simple"	,strain:"2"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack"	,target:"PD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG166"}	,
      {names: "Second Weapon"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG166"}	,
      {names: "Slough Blame"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"															,notes: "Talent Autofilled - Description of ability can be found on PG167"}	,
      {names: "Spirit Mount"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"				,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on PG168"}	,
      {names: "Spot Armor Flaw"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG169"}	,
      {names: "Steely Stare"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on PG171"}	,
      {names: "Stopping Aim"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG171"}	,
      {names: "Summon"	,attribute:"Per"	,action:"Sustained"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG171"}	,
      {names: "Tactics"	,attribute:"Per"	,action:"Standard"		,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"															,notes: "Talent Autofilled - Description of ability can be found on PG172"}	,
      {names: "Temper Flesh"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"Journeyman"	,talentrank:"2"																	,notes: "Talent Autofilled - Description of ability can be found on PG173"}	,
      {names: "Wheeling Attack"	,attribute:"Dex"	,action:"Standard"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG178"}	,
      {names: "Wheeling Defense"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"	,skilltype:"Journeyman"	,skillrank:"2"	,modtype:"Action"	,target:"PDh"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG178"}	,
      {names: "Willforce"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Journeyman"	,talentrank:"2"			,modtype:"Effect"			,special:"SPL-Willforce"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on PG180"}	,
      {names: "Astral Pocket"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C47"}	,
      {names: "Bardic Voice"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C48 - Use Talents to spend the Strain, Manually enter the bonus to appropriate Test"}	,
      {names: "Beguiling Blade"	,attribute:"Dex"	,action:"Simple"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"															,linkadd:"Conceal Weapon"		,notes: "Talent Autofilled - Description of ability can be found on C48 - Used in combination with Conceal Weapon. Link to Conceal Weapon for Total Step. Total Strain is already taken into account"}	,
      {names: "Blind Fire"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C48"}	,
      {names: "Blood Insight"	,attribute:"Per"	,action:"Sustained"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C48"}	,
      {names: "Bloodhound Form"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"															,linkadd:"Tracking"		,notes: "Talent Autofilled - Description of ability can be found on C49 - Used in combination with Tracking. Link to Tracking for Total Step."}	,
      {names: "Burning Vigor"	,attribute:"Str"	,action:"Free"		,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C49"}	,
      {names: "Chameleon"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"															,linkadd:"Stealthy Stride"		,notes: "Talent Autofilled - Description of ability can be found on C50 - Use Talents to spend the Strain, Manually enter the bonus to appropriate Test. Can also be linked to a Talent (Stealthy Stride for example)"}	,
      {names: "Champion Challenge"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on C50"}	,
      {names: "Chilling Strike"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C50"}	,
      {names: "Concise Casting"	,attribute:"Per"	,action:"Simple"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"			,special:"SPL-Spellcasting"					,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C51"}	,
      {names: "Contest of Will"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C52"}	,
      {names: "Critical Hit"		,action:"Free"		,talenttype:"Warden"	,talentrank:"3"	,skilltype:"Warden"	,skillrank:"3"															,notes: "Talent Autofilled - Description of ability can be found on C52"}	,
      {names: "Defensive Posture"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C52"}	,
      {names: "Disarming Smile"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C52"}	,
      {names: "Eagle Eye"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"								,visionbased:"1"	,combatslot:"1"			,linkadd:"Awareness"		,notes: "Talent Autofilled - Description of ability can be found on C53 - Used in combination with Awareness . Link to Awareness for Total Step."}	,
      {names: "Eidetic Memory"	,attribute:"Wil"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C54"}	,
      {names: "Elemental Mastery"	,attribute:"Per"	,action:"Free"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"			,special:"SPL-Elementalism"						,combatslot:"1"			,linkadd:"Elemetalism"		,notes: "Talent Autofilled - Description of ability can be found on C54 - If you use API, please link to Elementalism to get the appropriate final step"}	,
      {names: "Escape Plan"	,attribute:"Per"	,action:"Sustained"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C55"}	,
      {names: "Fluid Movement"		,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C56 - Extra Attacks cost 1 strain"}	,
      {names: "Forge Flesh"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C56"}	,
      {names: "Glyph of Shielding"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C57"}	,
      {names: "Glyph of Unweaving"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C58"}	,
      {names: "Goring Attack"		,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C58 - Add the Companion Damage step as Rank-Adjustment"}	,
      {names: "Infuse Memory"		,action:"Free"		,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C59"}	,
      {names: "Lion Spirit"		,action:"NA"		,talenttype:"Warden"	,talentrank:"3"			,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C59"}	,
      {names: "Living Weapon"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C59"}	,
      {names: "Matrix Sight"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C60"}	,
      {names: "Missile Lock"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C60"}	,
      {names: "Netherwalk"	,attribute:"Wil"	,action:"Standard"	,strain:"5"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C62"}	,
      {names: "Perfect Focus"	,attribute:"Wil"	,action:"Simple"		,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C63"}	,
      {names: "Plant Talk"	,attribute:"Per"	,action:"Standard"		,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C63"}	,
      {names: "Rally"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"SDh"								,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on C64"}	,
      {names: "Range Pattern"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C64"}	,
      {names: "Relentless Recovery"	,attribute:"Tou"	,action:"Free"		,talenttype:"Warden"	,talentrank:"3"			,modtype:"Effect"		,armortype:"N/A"	,special:"Recovery"			,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C64"}	,
      {names: "Resist Pain"		,action:"NA"		,talenttype:"Warden"	,talentrank:"3"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"(0)"				,karma:"0"					,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C64"}	,
      {names: "Storm Shield"		,action:"Standard"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"(0)"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C68 - It is recommended to duplicate the talent with dummies, 1 for the strain activation, 1 for the bonus to Shield Bash (linked with Shield Bash, no strain), and 1 for the electricity damage"}	,
      {names: "Summoning Circle"		,action:"Sustained"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C69 - 1 strain per circle"}	,
      {names: "Thought Link"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on PG173"}	,
      {names: "Thunderous Resolve"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C69"}	,
      {names: "Truth Through Lies"	,attribute:"Cha"	,action:"Standard"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C69"}	,
      {names: "Undermine"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"Warden"	,talentrank:"3"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on C70"}	,
      {names: "Unflinching Fortitude"		,action:"NA"		,talenttype:"Warden"	,talentrank:"3"																	,notes: "Talent Autofilled - Description of ability can be found on C70"}	,
      {names: "Vine Armor"	,attribute:"Tou"	,action:"Standard"		,talenttype:"Warden"	,talentrank:"3"			,modtype:"N/A"	,target:"Recovery"		,special:"Recovery"			,resistance:"1"			,combatslot:"1"			,linkadd:"Wood Skin"		,notes: "Talent Autofilled - Description of ability can be found on C71 - Used in combination with Wood Skin . Link to Wood Skin for Total Step."}	,
      {names: "Witty Repartee"	,attribute:"Cha"	,action:"Free"	,strain:"2"	,talenttype:"Warden"	,talentrank:"3"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"Action"	,target:"Ask: ?{Target Number|0}"				,defensive:"1"	,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C72"}	,
      {names: "Alley Cat Approach"	,attribute:"Per"	,action:"Standard"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C46"}	,
      {names: "Animal Leadership"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C46"}	,
      {names: "Astral Domain"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C46"}	,
      {names: "Aura Armor"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Effect"		,armortype:"N/A"												,notes: "Talent Autofilled - Description of ability can be found on C47"}	,
      {names: "Blood of Death's Sea"		,action:"Free"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C49"}	,
      {names: "Casting Pattern"	,attribute:"Per"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C49"}	,
      {names: "Concentrated Assault"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"SDhp1p"													,notes: "Talent Autofilled - Description of ability can be found on C50"}	,
      {names: "Confront Horror"	,attribute:"Per"	,action:"Standard"	,strain:"5"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on C51"}	,
      {names: "Cutting Words"	,attribute:"Cha"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on C52"}	,
      {names: "Dream Thief"	,attribute:"Per"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C53"}	,
      {names: "Echolocation"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"									,combatslot:"1"			,linkadd:"Awareness"		,notes: "Talent Autofilled - Description of ability can be found on C53 - Used in combination with Awareness . Link to Awareness for Total Step."}	,
      {names: "Effect Pattern"	,attribute:"Per"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C54"}	,
      {names: "Elemental Walk"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C54"}	,
      {names: "Enthralling Visions"	,attribute:"Wil"	,action:"Free"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C55"}	,
      {names: "Ethereal Weapon"	,attribute:"Wil"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C56"}	,
      {names: "Glyph of Attunement"	,attribute:"Per"	,action:"Simple"	,strain:"3"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C57"}	,
      {names: "Glyph of Reversal"	,attribute:"Per"	,action:"Free"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C57"}	,
      {names: "Howl"	,attribute:"Cha"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"SDhp1p"										,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on C58"}	,
      {names: "Impossible Hide"	,attribute:"Dex"	,action:"Standard"	,strain:"3"	,talenttype:"Master"	,talentrank:"4"															,linkadd:"Stealthy Stride"		,notes: "Talent Autofilled - Description of ability can be found on C58 - Used in combination with Stealthy Stride . Link to Stealthy Stride for Total Step."}	,
      {names: "Influence Missile"	,attribute:"Wil"	,action:"Free"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"				,defensive:"1"			,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C58"}	,
      {names: "Memory Probe"	,attribute:"Cha"	,action:"Sustained"	,strain:"3"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C60"}	,
      {names: "Multi-Charge"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"PDh"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C61"}	,
      {names: "Multi-Shot"	,attribute:"Per"	,action:"Simple"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"PDh"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C61"}	,
      {names: "Multi-Strike"	,attribute:"Dex"	,action:"Simple"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"PDh"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C61"}	,
      {names: "Nethersoul"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C62"}	,
      {names: "Safe Thought"		,action:"Free"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C64"}	,
      {names: "Second Chance"	,attribute:"Cha"	,action:"Free"	,strain:"3"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C65"}	,
      {names: "Shared Matrix"		,action:"NA"		,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C65"}	,
      {names: "Shock Treatment"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C65"}	,
      {names: "Snapshot"	,attribute:"Dex"	,action:"Free"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Attack"	,target:"PD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C66"}	,
      {names: "Snatch Talent"	,attribute:"Wil"	,action:"Standard"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C66"}	,
      {names: "Song of Battle"		,action:"Free"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C66"}	,
      {names: "Song of Deflection"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Action"	,target:"SDhp1p"													,notes: "Talent Autofilled - Description of ability can be found on C66"}	,
      {names: "Soul Aegis"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C67"}	,
      {names: "Spirit Strike"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Attack CC"	,target:"MD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C67"}	,
      {names: "Spliced Weave"		,action:"Simple"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C67 - 1 strain per test"}	,
      {names: "Stone Skin"		,action:"Standard"		,talenttype:"Master"	,talentrank:"4"			,modtype:"Effect"		,armortype:"N/A"	,special:"Recovery"			,resistance:"1"			,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C68"}	,
      {names: "Thunderstruck"	,attribute:"Str"	,action:"Free"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C69 - Add size as an Rank Adjustment (Step is Rank + Str + Size)"}	,
      {names: "Venom"	,attribute:"Tou"	,action:"Free"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C70"}	,
      {names: "Vicious Wound"	,attribute:"Per"	,action:"Simple"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"							,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C70"}	,
      {names: "Vital Strike"	,attribute:"Tou"	,action:"Free"	,strain:"2"	,talenttype:"Master"	,talentrank:"4"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C71"}	,
      {names: "Vital Ward"		,action:"Free"	,strain:"1"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C72"}	,
      {names: "Weapon Breaker"		,action:"Free"		,talenttype:"Master"	,talentrank:"4"	,skilltype:"Warden"	,skillrank:"3"	,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on C72"}	,
      {names: "World Pulse"	,attribute:"Per"	,action:"Sustained"	,strain:"3"	,talenttype:"Master"	,talentrank:"4"																	,notes: "Talent Autofilled - Description of ability can be found on C73"}	,
      {names: "Adaptability"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM369"}	,
      {names: "Aid Summoner"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on GM369"}	,
      {names: "Animate Dead"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM458"}	,
      {names: "Armored Scales"		,action:"NA"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on GM424"}	,
      {names: "Astral Camouflage"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM458"}	,
      {names: "Astral Portal"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"6"													,notes: "Talent Autofilled - Description of ability can be found on GM370"}	,
      {names: "Atk"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Attack CC"	,target:"PD1: @{target|Target|token_id}"						,movebased:"1"	,visionbased:"1"	,combatslot:"1"					,notes: "Talent Autofilled"}	,
      {names: "Aura of Awe"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"SDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM458"}	,
      {names: "Bite"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled"}	,
      {names: "Claws"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled"}	,
      {names: "Confusion"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM370"}	,
      {names: "Corrupt Compromise"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM459"}	,
      {names: "Corrupt Karma"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"		,special:"CorruptKarma"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM459"}	,
      {names: "Corrupt Reality"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MDh"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM459"}	,
      {names: "Curse"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM370"}	,
      {names: "Cursed Luck"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"		,special:"CursedLuck"						,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM460"}	,
      {names: "Damage Shift"		,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM460"}	,
      {names: "Destroy Weapon"		,action:"NA"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM370"}	,
      {names: "Detect True Element"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM370"}	,
      {names: "Displace"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM460"}	,
      {names: "Disrupt Fate"	,attribute:"Wil"	,action:"Free"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM424"}	,
      {names: "Disrupt Magic"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM460"}	,
      {names: "Dmg"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage CC"		,armortype:"PA"							,combatslot:"1"					,notes: "Talent Autofilled"}	,
      {names: "Dragonbreath"		,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage"		,armortype:"PA"							,combatslot:"1"	,rankadjust:"15"				,notes: "Talent Autofilled - Description of ability can be found on GM425"}	,
      {names: "Dragonsight"	,attribute:"Per"	,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM425"}	,
      {names: "Dragonspeech"	,attribute:"Cha"	,action:"Free"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM426"}	,
      {names: "Elemental Aura"		,action:"NA"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM371"}	,
      {names: "Engulf"	,attribute:"Str"	,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage"		,armortype:"PA"									,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM371"}	,
      {names: "Enhance Summoner"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on GM371"}	,
      {names: "Enrage Element"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM372"}	,
      {names: "Fear"	,attribute:"Cha"	,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"				,target:"MDh"								,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM426"}	,
      {names: "Find"	,attribute:"Per"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"														,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM372"}	,
      {names: "Forge Construct"		,action:"Sustained"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM461"}	,
      {names: "Forge Trap"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM462"}	,
      {names: "Harvest Energy"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Action"	,target:"SD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM460"}	,
      {names: "Horror Mark"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Action"	,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM461"}	,
      {names: "Horror Power"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM461"}	,
      {names: "Horror Thread"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM464"}	,
      {names: "Insubstantial"		,action:"NA"		,talenttype:"Creature"	,talentrank:"5"														,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM372"}	,
      {names: "Invisibility"	,attribute:"Dex"	,action:"NA"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Effect"														,notes: "Talent Autofilled - Description of ability can be found on GM373"}	,
      {names: "Karma Boost"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM465"}	,
      {names: "Karma Cancel"	,attribute:"Wil"	,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"								,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM426"}	,
      {names: "Karma Drain"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on GM465"}	,
      {names: "Lair Sense"	,attribute:"Per"	,action:"Free"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM427"}	,
      {names: "Manifest"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"														,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM373"}	,
      {names: "Manipulate Element"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM373"}	,
      {names: "Poison"		,action:"Free"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage CC"		,armortype:"None"							,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM171"}	,
      {names: "Regeneration"	,attribute:"Tou"	,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM427"}	,
      {names: "Remove Element"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM373"}	,
      {names: "Share Knowledge"	,attribute:"Per"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM374"}	,
      {names: "Skin Shift"		,action:"Simple"		,talenttype:"Creature"	,talentrank:"5"				,target:"MD1: @{target|Target|token_id}"													,notes: "Talent Autofilled - Description of ability can be found on GM466"}	,
      {names: "Soothe"	,attribute:"Cha"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"														,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM374"}	,
      {names: "Spear"	,attribute:"Str"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Damage"		,armortype:"PA"							,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM374"}	,
      {names: "Suppress Magic"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM428"}	,
      {names: "Suppress Mark"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM466"}	,
      {names: "Temperature"	,attribute:"Wil"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"														,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM375"}	,
      {names: "Terror"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"												,combatslot:"1"		,exactmatch:"1"			,notes: "Talent Autofilled - Description of ability can be found on GM466"}	,
      {names: "Unnatural Life"		,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"																	,notes: "Talent Autofilled - Description of ability can be found on GM467"}	,
      {names: "Wingbeat"	,attribute:"Str"	,action:"Standard"		,talenttype:"Creature"	,talentrank:"5"			,modtype:"Effect"									,combatslot:"1"					,notes: "Talent Autofilled - Description of ability can be found on GM429"}	,
      {names: "Acting"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG191"}	,
      {names: "Alchemy"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG191"}	,
      {names: "Animal Handling"	,attribute:"Wil"	,action:"Standard"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG192"}	,
      {names: "Artist"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG193"}	,
      {names: "Bribery"	,attribute:"Cha"	,action:"Standard"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG194"}	,
      {names: "Craft Armor"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG194"}	,
      {names: "Craft Weapon"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG195"}	,
      {names: "Disguise"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG196"}	,
      {names: "Entertainer"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG196"}	,
      {names: "Flirting"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG196"}	,
      {names: "Forgery"	,attribute:"Dex"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG197"}	,
      {names: "Mapmaking"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG197"}	,
      {names: "Physician"	,attribute:"Per"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG198"}	,
      {names: "Seduction"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG200"}	,
      {names: "Streetwise"	,attribute:"Cha"	,action:"Sustained"				,skilltype:"Novice"	,skillrank:"1"															,notes: "Talent Autofilled - Description of ability can be found on PG201"}	,
      {names: "Collaborate"		,action:"Simple"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG89 - Air Sailor Circle 5 Ability"}	,
      {names: "Create Projectile"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Arrow Weaving"		,notes: "Talent Autofilled - Description of ability can be found on PG91 - Archer Circle 5 Ability - Link to Arrow Weaving"}	,
      {names: "Cat's Grace"		,action:"Simple"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG93 - Beastmaster Circle 5 Ability"}	,
      {names: "One Soul Two Bodies"		,action:"Sustained"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG95 - Cavalryman Circle 5 ability"}	,
      {names: "Fire and Ice"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Elementalism"		,notes: "Talent Autofilled - Description of ability can be found on PG97 - Elementalist Circle 5 Ability - Link to Elementalism"}	,
      {names: "Glamour"	,attribute:"Per"	,action:"Standard"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Illusionism"		,notes: "Talent Autofilled - Description of ability can be found on PG99 - Illusionist Circle 5 Ability - Link to Illusionism"}	,
      {names: "Blood Summon"		,action:"Sustained"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG101 - Nethermancer Circle 5 Ability - Strain equal to Spirit CR"}	,
      {names: "Enhanced Senses"		,action:"Simple"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG103 - Scout Circle 5 Ability"}	,
      {names: "Overwhelming Force"		,action:"Sustained"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG105 - Skyraider Circle 5 Ability"}	,
      {names: "Size Up"	,attribute:"Per"	,action:"Simple"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"				,target:"MD1: @{target|Target|token_id}"											,linkadd:"Weapon Weaving"		,notes: "Talent Autofilled - Description of ability can be found on PG107 - Swordmaster Circle 5 Ability - Link to Weapon Weaving"}	,
      {names: "Shadowcloak"		,action:"Simple"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG109 - Thief Circle 5 Ability"}	,
      {names: "One Last Word"		,action:"Simple"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG111 - Troubadour Circle 5 Ability"}	,
      {names: "Battle Rites"		,action:"Simple"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"				,karma:"1"										,notes: "Talent Autofilled - Description of ability can be found on PG113 - Warrior Circle 5 Ability"}	,
      {names: "Travelling Smithy"		,action:"Sustained"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG115 - Weaponsmith Circle 5 Ability"}	,
      {names: "Book Mage"		,action:"Simple"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on PG117 - Wizard Circle 5 Ability"}	,
      {names: "Coordinate Attacks"		,action:"NA"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C21 - Air Sailor Circle 9 Ability"}	,
      {names: "Windborne Speed"	,attribute:"Per"	,action:"Standard"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Air Weaving"		,notes: "Talent Autofilled - Description of ability can be found on C22 - Air Sailor Circle 13 Ability - Link to Air Weaving"}	,
      {names: "Blood Bound Bow"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C22 - Archer Circle 9 Ability"}	,
      {names: "Perfect Shot"		,action:"Simple"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C23 - Archer Circle 13 Ability - Variable Strain"}	,
      {names: "Tough Hide"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C24 - Beastmaster Circle 9 Ability"}	,
      {names: "Bestial War Form"		,action:"Simple"	,strain:"5"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C25 - Beastmaster Circle 13 Ability"}	,
      {names: "Shared Strength"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C25 - Cavalryman Circle 9 Ability"}	,
      {names: "Shared Spirit"	,attribute:"Per"	,action:"Standard"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Mount Weaving"		,notes: "Talent Autofilled - Description of ability can be found on C26 - Cavalryman Circle 13 Ability - Link to Mount Weaving"}	,
      {names: "Earth and Wind"	,attribute:"Per"	,action:"Standard"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Elementalism"		,notes: "Talent Autofilled - Description of ability can be found on C27 - Elementalist Circle 9 Ability - Link to Elementalism"}	,
      {names: "Elemental Form"		,action:"Simple"	,strain:"5"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C28 - Elementalist Circle 13 Ability"}	,
      {names: "Hide Matrix"		,action:"Free"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C28 - Illusionist Circle 9 Ability"}	,
      {names: "Manipulate Reality"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C29 - Illusionist Circle 13 Ability"}	,
      {names: "Otherworldly Willpower"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C30 - Nethermancer Circle 9 Ability"}	,
      {names: "Astral Face"		,action:"Simple"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C31 - Nethermancer Circle 13 Ability"}	,
      {names: "Supernal Awareness"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C32 - Scout Circle 9 Ability"}	,
      {names: "One With the World"	,attribute:"Per"	,action:"Standard"	,strain:"3"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Scout Weaving"		,notes: "Talent Autofilled - Description of ability can be found on C32 - Scout Circle 13 Ability - Link to Scout Weaving"}	,
      {names: "Strength of the Sky"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C33 - Skyraider Circle 9 Ability"}	,
      {names: "Stormcall"		,action:"Free"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"												,linkadd:"Sky Weaving"		,notes: "Talent Autofilled - Description of ability can be found on C34 - Skyraider Circle 13 Ability - Link to Sky Weaving - Enter value of Wound Treshold as Strain"}	,
      {names: "Blood Bound Blades"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C35 - Swordmaster Circle 9 Ability"}	,
      {names: "Audacious Bravado"		,action:"Free"	,strain:"3"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C35 - Swordmaster Circle 13 Ability"}	,
      {names: "Shadow Sight"		,action:"NA"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C36 - Thief Circle 9 Ability"}	,
      {names: "Shadowmeld"		,action:"Simple"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"															,linkadd:"Thief Weaving"		,notes: "Talent Autofilled - Description of ability can be found on C37 - Thief Circle 13 Ability - Link to Thief Weaving"}	,
      {names: "Unnatural Charm"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C38 - Troubadour Circle 9 Ability"}	,
      {names: "Encore"		,action:"Simple"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C39 - Troubadour Circle 13 Ability"}	,
      {names: "Battlefield Awareness"		,action:"NA"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C39 - Warrior Circle 9 Ability"}	,
      {names: "Elemental Warrior"		,action:"NA"		,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C40 - Warrior Circle 13 Ability"}	,
      {names: "Blood Bound Forge"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C41 - Weaponsmith Circle 9 Ability"}	,
      {names: "Mystic Grounding"		,action:"Free"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C41 - Weaponsmith Circle 13 Ability"}	,
      {names: "Matrix Split"		,action:"NA"	,strain:"2"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C42 - Wizard Circle 9 Ability"}	,
      {names: "Mystic Triangle"		,action:"Standard"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on C43 - Wizard Circle 13 Ability"}	,
      {names: "Elemental Stance"		,action:"Free"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP175 - Gauntlet Circle 5 Ability"}	,
      {names: "Pattern Infusion"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP176 - Gauntlet Circle 9 Ability"}	,
      {names: "Pattern Manifestation"		,action:"Simple"	,strain:"4"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP177 - Gauntlet Circle 13 Ability"}	,
      {names: "Pack Leadership"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP187 - Shaman Circle 5 Ability"}	,
      {names: "Spirit Pact"		,action:"NA"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP187 - Shaman Circle 9 Ability"}	,
      {names: "Spirit Fuse"		,action:"Free"	,strain:"1"	,talenttype:"Special"	,talentrank:"6"			,modtype:"(0)"														,notes: "Talent Autofilled - Description of ability can be found on MP189 - Shaman Circle 13 Ability"}	,
      {names: "Armor of Thystonius"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"					,combatslot:"1"				,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q152 - 1 strain per ally up to Rank"}	,
      {names: "Astendar's Muse,Astendars Muse,Astendar Muse,Astendar s muse"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q153"}	,
      {names: "Astendar's Voice,Astendar Voice,Astendars Voice,Astendar s Voice"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q153"}	,
      {names: "Awaken the Wood"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q154"}	,
      {names: "Bloom and Flourish"	,attribute:"Wil"	,action:"Sustained"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q155"}	,
      {names: "Break Shackles"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q156"}	,
      {names: "Buttress Armor"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q157"}	,
      {names: "Chains of Obedience"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q157"}	,
      {names: "Challenge of Dis"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q158"}	,
      {names: "Cold Reminder"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q159"}	,
      {names: "Compel"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"SDh"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q159"}	,
      {names: "Desolate"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q160"}	,
      {names: "Detail Oriented"	,attribute:"Wil"	,action:"Free"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q160"}	,
      {names: "Enchanted Gift"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q162"}	,
      {names: "Encouraging Oratory"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q162"}	,
      {names: "Energy in Motion"		,action:"Simple"		,talenttype:"QD-Exemplar"	,talentrank:"7"			,modtype:"(0)"				,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q162"}	,
      {names: "Fertility's Season,Fertitlity s Season,Fertility Season"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q163"}	,
      {names: "Fortify"	,attribute:"Wil"	,action:"Sustained"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"							,exactmatch:"1"		,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q164"}	,
      {names: "Friend of the Land"	,attribute:"Cha"	,action:"Free"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q165"}	,
      {names: "Garlen's Relief,Garlen s Relief,Garlens Relief,Garlen Relief"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Follower"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q166"}	,
      {names: "Garlen's Solace,Garlen s Solace,Garlens Solace, Garlen Solace"		,action:"Sustained"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q165"}	,
      {names: "Garlen's Touch,Garlen s Touch,Garlens Touch,Garlen Touch"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q166"}	,
      {names: "Gift of Life"		,action:"Free"		,talenttype:"QD-Exemplar"	,talentrank:"7"			,modtype:"(0)"				,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q166"}	,
      {names: "Grave Commands"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"hMD"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q166 - 1 strain per target"}	,
      {names: "Grave Empowerment"	,attribute:"Cha"	,action:"Simple"	,strain:"2"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q167"}	,
      {names: "Grip of Chorrolis"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"hMD"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q167"}	,
      {names: "Heart's wish,Heart s,Wish,Hearts Wish,Heart Wish"	,attribute:"Per"	,action:"Standard"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q168"}	,
      {names: "Hone Weapon"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q168"}	,
      {names: "Incite Obsession"	,attribute:"Wil"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q169"}	,
      {names: "Incite Rage"	,attribute:"Cha"	,action:"Standard"	,strain:"3"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q169"}	,
      {names: "Incite Rebellion"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"							,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q169"}	,
      {names: "Inspired Endurance"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q170"}	,
      {names: "Inspired Might"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q170"}	,
      {names: "Inspired Tenacity"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q171 - 1 strain per target"}	,
      {names: "Invigorate"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q171 - 1 strain per target"}	,
      {names: "Jaspree's Solace,Jaspree Solace,Jasprees Solace,Jaspree s Solace"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q172"}	,
      {names: "Jury Rig,Jury-Rig,JuryRig"	,attribute:"Per"	,action:"Sustained"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q172"}	,
      {names: "Let's Make a Deal,Let s Make a Deal,Lets Make a Deal"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Exemplar"	,talentrank:"7"							,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q173"}	,
      {names: "Living Death"	,attribute:"Wil"	,action:"Standard"		,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q174"}	,
      {names: "Love in Bloom"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Exemplar"	,talentrank:"7"							,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q175"}	,
      {names: "Mynbruje's Eye,Mynbruje Eye,Mynbrujes Eye,Mynbruje s Eye"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q175"}	,
      {names: "Open Mind"	,attribute:"Cha"	,action:"Standard"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q176"}	,
      {names: "Passion's Comfort,Passion s Comfort,Passion Comfort,Passions Comfort"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q176"}	,
      {names: "Passion's Empowerment,Passion s Empowerment,Passion Empowerment,Passions Empowerment"		,action:"Standard"		,talenttype:"QD-Follower"	,talentrank:"7"			,modtype:"(0)"				,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q176"}	,
      {names: "Passion's Insight,Passion s Insight,Passion Insight,Passions Insight"	,attribute:"Per"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q177"}	,
      {names: "Passion's Inspiration,Passion s Inspiration,Passion Inspiration,Passions Inspiration"	,attribute:"Cha"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q178"}	,
      {names: "Pidgin"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q178"}	,
      {names: "Project Management"	,attribute:"Per"	,action:"Simple"		,talenttype:"QD-Follower"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q179"}	,
      {names: "Resist Influence"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q179"}	,
      {names: "Seal Home"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"							,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q181"}	,
      {names: "Shield the Innocent"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"							,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q181"}	,
      {names: "Silence Influence"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q181"}	,
      {names: "Stride of Floranuus"	,attribute:"Cha"	,action:"Standard"	,strain:"3"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"6"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q183"}	,
      {names: "Submit"	,attribute:"Wil"	,action:"Sustained"	,strain:"2"	,talenttype:"QD-Adherent"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q183"}	,
      {names: "Taste of Power"	,attribute:"Cha"	,action:"Sustained"	,strain:"2"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q184"}	,
      {names: "Torment"	,attribute:"Wil"	,action:"Standard"	,strain:"1"	,talenttype:"QD-Follower"	,talentrank:"7"				,target:"SD1: @{target|Target|token_id}"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q185"}	,
      {names: "Upandal's Armory,Upandal s Armory,Upandals Armory,Upandal Armory"	,attribute:"Wil"	,action:"Sustained"		,talenttype:"QD-Follower"	,talentrank:"7"				,target:"Ask: ?{Target Number|0}"			,karma:"0"									,devotionrequired:"1"	,notes: "Talent Autofilled - Description of ability can be found on Q186"}	,
      {names: "Upandal's Palisade,Upandal s Palisade,Upandals Palisade,Upandal Palisade"	,attribute:"Cha"	,action:"Sustained"		,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q186"}	,
      {names: "Vestrial's Tongue,Vestrial s Tongue,Vestrial Tongue,VestrialsTongue"	,attribute:"Cha"	,action:"Simple"	,strain:"1"	,talenttype:"QD-Exemplar"	,talentrank:"7"				,target:"6"			,karma:"0"										,notes: "Talent Autofilled - Description of ability can be found on Q186"}

    ];

    tname=values[pre+"Name"].toLowerCase().replace(/\s/g, '');

    if(["climbing","swimming","greatleap"].includes(tname) && values["Race"] == "Other")
    { singleAttr( "Mod-Type",         "(0)" );
      singleAttr( "Notes", "Autofilled - Note that those are creature Powers that have the same name as a Talent, but have a different mechanics. Check GMG p.250");
      return; //These entries are special for Creatures and do not work as the Skill/Talent. Skip Autofill
    }

    for(let i=0; i< database.length;i++){
      entry=database[i];
      names=entry.names.toLowerCase().replace(/\s/g, '').split(","); //Array of possible names for the database entry
      exactmatch=entry.exactmatch; //If true we want an exact match, if not an include is sufficient
      if(names.find(element => ((tname == element) || ( !exactmatch && tname.includes(element))))){

        if(entry.attribute)     {
          if(values["Race"]=="Other" && getInt(values,pre+"Rank")>0 && values[pre+"Attribute"]!==entry.attribute &&  tname !=="surprisestrike"   )
            singleAttr("Rank",getInt(values,pre+"Rank")-getInt(values,entry.attribute +"-Step"));
          singleAttr( "Attribute",         entry.attribute );
        } //Creatures are entered as a direct step in the book, so when imported, their Rank is equal to the step. If an attribute is set by Autofill it is important to offset the Rank to maintain the steps
        //Surprise Strike is a bit of an exception : In the book it is "Rank" but we deal with it as a "Rank+Str", so the offset should not appear...

        if(entry.action)     singleAttr( "Action",         entry.action );
        if(entry.strain)     singleAttr( "Strain",         entry.strain );
        if(entry.modtype)     singleAttr( "Mod-Type",         entry.modtype );
        if(entry.target)      singleAttr( "Target",           entry.target );
        if(entry.armortype)   singleAttr( "ArmorType",        entry.armortype );
        if(entry.karma)       singleAttr( "Karma-Limit_max",  entry.karma );
        if(entry.special)     singleAttr( "Special",          entry.special );
        if(entry.defensive)   singleAttr( "Defensive",        entry.defensive );
        if(entry.resistance)  singleAttr( "Resistance",       entry.resistance );
        if(entry.movebased)   singleAttr( "MoveBased",        entry.movebased );
        if(entry.visionbased) singleAttr( "VisionBased",      entry.visionbased );
        if(entry.combatslot) singleAttr( "CombatSlot",      entry.combatslot );
        if(entry.rankadjust) singleAttr( "Rank-Adjust",      entry.rankadjust );
        if(entry.linkadd)
          setAttrsLog( { "APIflag" : addAPIflag( values["APIflag"], "LinkAdd1", code + " : " + values[pre+"RowID"] + " : T : " + entry.linkadd) }); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing

        if(code=="SK" && entry.skilltype) singleAttr( "Type",      entry.skilltype );

        if(code=="T" && entry.talenttype && !(["Novice","Journeyman","Warden","Master"].includes(entry.talenttype))) singleAttr( "Type",      entry.talenttype );
        if(code=="T" && entry.talenttype && entry.talenttype.startsWith("QD-")) singleAttr( "DP-Limit_max", "1" );
        if(entry.devotionrequired) singleAttr( "DP-Limit",      entry.devotionrequired );

        notes=values[pre+"Notes"] || "";
        let cstart=notes.search("List of Talent Options"),
        d = new Date(),
        cend=notes.search(";;;");
          notes= notes.substring(0,(cstart==-1 ? notes.length-1 :cstart)) + notes.substring((cend==-1 ? notes.length-1 :cend+3),notes.length);//remove everything in notes between list of Talent Options until ;;;
          notes = notes + (notes.includes(entry.notes) ? "" : ( "\n" + entry.notes) ) + " - " +d.getFullYear()+"-"+(d.getMonth() +1)+"-"+d.getDate();
        singleAttr( "Notes", notes);
        log("Earthdawn : Entry " + values[ pre + "Name" ] + " Updated Automatically");
        return;
      }
    }
  });
} catch(err) {log("Earthdawn:AutoFill() error caught: " + err );}
}; //end AutoFill()
on("change:repeating_talents:t_name change:repeating_skills:sk_name", fn(AutoFill));
//In updateCharacterSheet, Autofill is triggered by rewriting the name



var updateKnackSummary = function fnupdateKnackSummary() {
  'use strict';
  try{
    let attarray = ["Race","Attrib-Str-Curr","Knack-Summary-Param","Knack-Summary-SubRank"];
    let charray=[],
    s="",ss="",
    pre,
    vals=[],
    dfltrk,dflt,
    maxvalue=0,filtered,knackn,knacklist;
    // log ( "EarthDawn : updateKnackSummary() ");

    let database=[

      {"talent":"Acrobatic Defense","knacks":[ 	{"knackname":"Acrobatic Recovery"	,"requirement":"Rank 4"		,"page":"C77"}	,
      	{"knackname":"Acrobatic Strike"	,"requirement":"Rank 6"		,"page":"C78"}	,
      	{"knackname":"Control the Tempo"	,"requirement":"Rank 5"		,"page":"C78"}	,
      	{"knackname":"Deny Terrain"	,"requirement":"Rank 3"		,"page":"C78"}	]},
      {"talent":"Air Dance","knacks":[ 	{"knackname":"Can't Catch Me [Special Maneuver]"	,"requirement":"Rank 10"	,"restrictions":"Windmaster 7"	,"page":"AJMP"}	,
      	{"knackname":"I'm Not Done with You Yet"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 2,any Discipline 8"	,"page":"AJMP"}	,
      	{"knackname":"Speed Freak [Special Maneuver]"	,"requirement":"Rank 8"	,"restrictions":"Windmaster 5"	,"page":"AJMP"}	,
      	{"knackname":"Speed Kills [Special Maneuver]"	,"requirement":"Rank 9"	,"restrictions":"Windmaster 6"	,"page":"AJMP"}	]},
      {"talent":"Air Sailing","knacks":[ 	{"knackname":"Air Legs"	,"requirement":"Rank 3"		,"page":"C79"}	,
      	{"knackname":"Pilot Boat"	,"requirement":"Rank 5"		,"page":"C79"}	,
      	{"knackname":"Sailing"	,"requirement":"Rank 4"		,"page":"C79"}	,
      	{"knackname":"Sweeping Current"	,"requirement":"Rank 7"	,"restrictions":"Air Sailor 7, Boatman 7, Sailor 7"	,"page":"AJMP"}	]},
      {"talent":"Air Speaking","knacks":[ 	{"knackname":"Wind Dance"	,"requirement":"Rank 4"		,"page":"AJMP"}	]},
      {"talent":"Animal Bond","knacks":[ 	{"knackname":"Heal Animal Companion"	,"requirement":"Rank 7"		,"page":"C79"}	]},
      {"talent":"Animal Training","knacks":[ 	{"knackname":"Animal Handling"	,"requirement":"Rank 4"		,"page":"C79"}	]},
      {"talent":"Anticipate Blow","knacks":[ 	{"knackname":"Aerial Ace"	,"requirement":"Rank 10,Air Dance rank 5"	,"restrictions":"Windmaster 7"	,"page":"AJMP"}	,
      	{"knackname":"Anticipate Movement"	,"requirement":"Rank 7"		,"page":"C80"}	,
      	{"knackname":"Anticipate Spell"	,"requirement":"Rank 5"		,"page":"C80"}	,
      	{"knackname":"Foresee Aggression"	,"requirement":"Rank 7"		,"page":"C80"}	,
      	{"knackname":"Take the Hit"	,"requirement":"Rank 6"		,"page":"C81"}	]},
      {"talent":"Applied Knowledge","knacks":[ 	{"knackname":"Lector [Special Maneuver]"	,"requirement":"Rank 6"	,"restrictions":"Scholar 5"	,"page":"AJMP"}	]},
      {"talent":"Arcane Mutterings","knacks":[ 	{"knackname":"Arcane Curses [Special Maneuver]"	,"requirement":"Rank 7"		,"page":"C81"}	,
      	{"knackname":"Jinx"	,"requirement":"Rank 5"		,"page":"C81"}	]},
      {"talent":"Astral Interference","knacks":[ 	{"knackname":"Mobile Interference"	,"requirement":"Rank 6"		,"page":"C82"}	,
      	{"knackname":"Push Against the Horror"	,"requirement":"Rank 7"	,"restrictions":"Nethermancer 7, Horror Stalker 5"	,"page":"C82"}	]},
      {"talent":"Avoid Blow","knacks":[ 	{"knackname":"Arrow Cutting [Special Maneuver]"	,"requirement":"Rank 5"	,"restrictions":"Melee Weapons Rank 5, Unarmed Combat Rank 5"	,"page":"C82"}	,
      	{"knackname":"Redirect Attack [Special Maneuver]"	,"requirement":"Rank 8"		,"page":"C83"}	,
      	{"knackname":"Roll With the Punches"	,"requirement":"Rank 6"		,"page":"C82"}	]},
      {"talent":"Awareness","knacks":[ 	{"knackname":"Clear View"	,"requirement":"Rank 9"	,"restrictions":"Messenger 7, Scout 9, Thief 9"	,"page":"C82"}	,
      	{"knackname":"Eavesdrop"	,"requirement":"Rank 6"	,"restrictions":"Messenger 3, Scout 6, Thief 6"	,"page":"AJMP"}	,
      	{"knackname":"Lip Reading"	,"requirement":"Rank 3"		,"page":"C83"}	,
      	{"knackname":"Voices Carry"	,"requirement":"Rank 8"	,"restrictions":"Messenger 5, Scout 6, Thief 6"	,"page":"AJMP"}	]},
      {"talent":"Banish","knacks":[ 	{"knackname":"Expel Horror"	,"requirement":"Rank 9"	,"restrictions":"Horror Stalker 9, Nethermancer 12"	,"page":"AJMP"}	]},
      {"talent":"Battle Bellow","knacks":[ 	{"knackname":"Intimidating Bellow"	,"requirement":"Rank 5"		,"page":"C83"}	]},
      {"talent":"Battle Shout","knacks":[ 	{"knackname":"Defiant Shout"	,"requirement":"Rank 7"		,"page":"C84"}	,
      	{"knackname":"Destructive Shout"	,"requirement":"Rank 6"		,"page":"C84"}	,
      	{"knackname":"Flames of Battle"	,"requirement":"Rank 6, Fires of Gahad rank 4"	,"restrictions":"Fire Eater 2"	,"page":"AJMP"}	,
      	{"knackname":"Ka'tosh's Challenge"	,"requirement":"Rank 5, Rite of Kho'pesh rank 5"	,"restrictions":"Outcast 1"	,"page":"AJMP"}	,
      	{"knackname":"Scorching Breath"	,"requirement":"Rank 9, Fires of Gahad rank 7"	,"restrictions":"Fire Eater 5"	,"page":"AJMP"}	]},
      {"talent":"Bear Mark","knacks":[ 	{"knackname":"Bear Corruption"	,"requirement":"Rank 3"	,"restrictions":"Horror Stalker 4"	,"page":"AJMP"}	,
      	{"knackname":"Bitter Taste"	,"requirement":"Rank 4"	,"restrictions":"Horror Stalker 4"	,"page":"AJMP"}	,
      	{"knackname":"Debilitating Harvest"	,"requirement":"Rank 7, Bitter Taste"	,"restrictions":"Horror Stalker 7"	,"page":"AJMP"}	,
      	{"knackname":"Poisoned Harvest"	,"requirement":"Rank 9, Bitter Taste,Debilitating Harvest"	,"restrictions":"Horror Stalker 9"	,"page":"AJMP"}	,
      	{"knackname":"Trace Horror"	,"requirement":"Rank 5"	,"restrictions":"Horror Stalker 5"	,"page":"AJMP"}	]},
      {"talent":"Book Memory","knacks":[ 	{"knackname":"Font of Knowledge"	,"requirement":"Rank 5, Expansive Expertise rank 3"	,"restrictions":"Scholar 2"	,"page":"AJMP"}	,
      	{"knackname":"Photographic Memory"	,"requirement":"Rank 4"		,"page":"C84"}	,
      	{"knackname":"Remember Conversation"	,"requirement":"Rank 3"		,"page":"C84"}	,
      	{"knackname":"Transcribe Document"	,"requirement":"Rank 5"	,"restrictions":"Messenger 1"	,"page":"AJMP"}	]},
      {"talent":"Borrow Sense","knacks":[ 	{"knackname":"One Eye Open"	,"requirement":"Rank 4"		,"page":"C85"}	,
      	{"knackname":"Other Sense"	,"requirement":"Rank 8"		,"page":"C85"}	]},
      {"talent":"Brother of Stone","knacks":[ 	{"knackname":"Earth Brother [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Earth Brother [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Earth Cloak [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Earth Elemental Affinity [Karma]"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Earth Sense [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Force of Stone [Karma]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Resilience of Stone [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Stability of Stone [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Stone Flesh [Karma]"	,"requirement":"Rank 9"		,"page":"AJMP"}	]},
      {"talent":"Burning Vigor","knacks":[ 	{"knackname":"Burning Strength"	,"requirement":"Rank 5, Fires of Gahad Rank 3"	,"restrictions":"Fire Eater 1"	,"page":"AJMP"}	]},
      {"talent":"Call Animal Companion","knacks":[ 	{"knackname":"Beast Summons"	,"requirement":"Rank 5"		,"page":"C85"}	,
      	{"knackname":"Empathic Command"	,"requirement":"Rank 8"		,"page":"C86"}	]},
      {"talent":"Call Missile","knacks":[ 	{"knackname":"Call Any Missile"	,"requirement":"Rank 6"		,"page":"C86"}	]},
      {"talent":"Call of Harrow","knacks":[ 	{"knackname":"All Tied Up [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Beautiful Assault [Special Maneuver]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Dispersing Strike [Special Maneuver]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Exploit Corruption"	,"requirement":"Rank 5"	,"restrictions":"Horror Stalker 5"	,"page":"AJMP"}	,
      	{"knackname":"Lance Bloatform [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Mold Baggi [Special Maneuver]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Never Deceived [Special Maneuver]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Pattern Recognition [Special Maneuver]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Trap Horror"	,"requirement":"Rank 7"	,"restrictions":"Horror Stalker 7"	,"page":"AJMP"}	]},
      {"talent":"Charge","knacks":[ 	{"knackname":"Overrun [Special Maneuver]"	,"requirement":"Rank 7"		,"page":"C86"}	]},
      {"talent":"Ch'tard Dance","knacks":[ 	{"knackname":"Ch'tard Heel Turn [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Ch'tard Sting"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Ch'tard Strike [Special Maneuver]"	,"requirement":"Rank 1, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Double Cut [Special Maneuver]"	,"requirement":"Rank 9, Unarmed Combat rank 9"	,"restrictions":"Tail Dancer 9"	,"page":"AJMP"}	]},
      {"talent":"Claw Shape","knacks":[ 	{"knackname":"Claw Tool"	,"requirement":"Rank 5"		,"page":"C86"}	,
      	{"knackname":"Savage Limbs"	,"requirement":"Rank 5"		,"page":"C87"}	,
      	{"knackname":"Wrecking Claws"	,"requirement":"Rank 6"		,"page":"C87"}	]},
      {"talent":"Climbing","knacks":[ 	{"knackname":"Light as a Leaf"	,"requirement":"Rank 8, Race Through the Canopy"	,"restrictions":"Woodsman 6, any Discipline 10"	,"page":"AJMP"}	,
      	{"knackname":"Race Through the Canopy"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 5, any Discipline 9"	,"page":"AJMP"}	,
      	{"knackname":"Spider Climb"	,"requirement":"Rank 8"		,"page":"C88"}	,
      	{"knackname":"Swinging Move"	,"requirement":"Rank 3"		,"page":"C88"}	]},
      {"talent":"Cold Purify","knacks":[ 	{"knackname":"Cleansing Chill"	,"requirement":"Rank 5"	,"restrictions":"Purifier 2, any Discipline Circle 8"	,"page":"AJMP"}	,
      	{"knackname":"Halt Disease"	,"requirement":"Rank 6"		,"page":"C88"}	,
      	{"knackname":"Mending Frost"	,"requirement":"Rank 9"	,"restrictions":"Purifier 5"	,"page":"AJMP"}	]},
      {"talent":"Conceal Object","knacks":[ 	{"knackname":"One with the Message"	,"requirement":"Rank 10"	,"restrictions":"Messenger 9"	,"page":"AJMP"}	]},
      {"talent":"Conversation","knacks":[ 	{"knackname":"Getting to Know You [Special Maneuver]"	,"requirement":"Rank 7"		,"page":"C88"}	]},
      {"talent":"Danger Sense","knacks":[ 	{"knackname":"Detect Poison"	,"requirement":"Rank 7"		,"page":"C89"}	,
      	{"knackname":"Detect Weapon"	,"requirement":"Rank 3"		,"page":"C89"}	]},
      {"talent":"Deliberate Assault","knacks":[ 	{"knackname":"Deliberate Spellcasting"	,"requirement":"Rank 5"	,"restrictions":"Brother of Stone 1"	,"page":"AJMP"}	]},
      {"talent":"Diplomacy","knacks":[ 	{"knackname":"Assess Intentions"	,"requirement":"Rank 8"		,"page":"C89"}	,
      	{"knackname":"Poisoned Influence"	,"requirement":"Rank 7"		,"page":"C90"}	]},
      {"talent":"Disarm","knacks":[ 	{"knackname":"I'll Take That [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"C90"}	]},
      {"talent":"Disguise Self","knacks":[ 	{"knackname":"Ideal Appearance"	,"requirement":"Rank 8"		,"page":"C90"}	]},
      {"talent":"Dispel Magic","knacks":[ 	{"knackname":"Disrupt Horror Power"	,"requirement":"Rank 7"	,"restrictions":"Horror Stalker 7, Nethermancer Circle 9"	,"page":"AJMP"}	]},
      {"talent":"Distract","knacks":[ 	{"knackname":"Aggravating Assault"	,"requirement":"Rank 10"	,"restrictions":"Windmaster 7"	,"page":"AJMP"}	,
      	{"knackname":"Buzz"	,"requirement":"Rank 6"	,"restrictions":"Windmaster 3"	,"page":"AJMP"}	,
      	{"knackname":"Incite [Special Maneuver]"	,"requirement":"Rank 6"	,"restrictions":"Windmaster 3"	,"page":"AJMP"}	,
      	{"knackname":"Infuriate [Special Maneuver]"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 2"	,"page":"AJMP"}	,
      	{"knackname":"Mosquito Bite"	,"requirement":"Rank 9"	,"restrictions":"Windmaster rank 6"	,"page":"AJMP"}	]},
      {"talent":"Dive Attack","knacks":[ 	{"knackname":"Bluffing Dive"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Fearsome Dive"	,"requirement":"Rank 8"	,"restrictions":"Windmaster 8"	,"page":"AJMP"}	]},
      {"talent":"Dominate Beast","knacks":[ 	{"knackname":"Tame Animal"	,"requirement":"Rank 8"	,"restrictions":"Beastmaster 7, Cavalryman 8"	,"page":"C91"}	]},
      {"talent":"Earth Bond","knacks":[ 	{"knackname":"Connect with Earth's Pattern"	,"requirement":"Rank 9"	,"restrictions":"Brother of Stone 5, Purifier 5"	,"page":"AJMP"}	,
      	{"knackname":"Earth Mending"	,"requirement":"Rank 6, Earth Slumber"	,"restrictions":"Brother of Stone 3"	,"page":"AJMP"}	,
      	{"knackname":"Earth Slumber"	,"requirement":"Rank 5"	,"restrictions":"Brother of Stone 2"	,"page":"AJMP"}	,
      	{"knackname":"Earth's Avenger"	,"requirement":"Rank 8"	,"restrictions":"Brother of Stone 6, Purifier 5"	,"page":"AJMP"}	,
      	{"knackname":"Earth's Bounty"	,"requirement":"Rank 6, Wild Growth"	,"restrictions":"Purifier 3"	,"page":"AJMP"}	,
      	{"knackname":"Empower Purify"	,"requirement":"Rank 5, Patterncraft rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Shared Bond, Shared Blood"	,"requirement":"Rank 7"	,"restrictions":"Brother of Stone 4, Purifier 4"	,"page":"AJMP"}	,
      	{"knackname":"Wild Growth"	,"requirement":"Rank 5"	,"restrictions":"Purifier 2"	,"page":"AJMP"}	]},
      {"talent":"Earth Skin","knacks":[ 	{"knackname":"Earth Armor"	,"requirement":"Rank 7"	,"restrictions":"Brother of Stone 4"	,"page":"AJMP"}	,
      	{"knackname":"Stillness of Stone"	,"requirement":"Rank 5"	,"restrictions":"Brother of Stone 1"	,"page":"AJMP"}	]},
      {"talent":"Earth Walk","knacks":[ 	{"knackname":"Earth Awareness"	,"requirement":"Rank 6"	,"restrictions":"Brother of Stone 6"	,"page":"AJMP"}	,
      	{"knackname":"Earth Dash"	,"requirement":"Rank 7"	,"restrictions":"Brother of Stone 7"	,"page":"AJMP"}	,
      	{"knackname":"Earth Excursion"	,"requirement":"Rank 9"	,"restrictions":"Brother of Stone 9"	,"page":"AJMP"}	,
      	{"knackname":"Stone Walk"	,"requirement":"Rank 8"	,"restrictions":"Brother of Stone 8"	,"page":"AJMP"}	,
      	{"knackname":"Travel Through the Earth"	,"requirement":"Rank 10"	,"restrictions":"Brother of Stone 10"	,"page":"AJMP"}	,
      	{"knackname":"Tremorsense"	,"requirement":"Rank 9, Stone Walk"	,"restrictions":"Brother of Stone 9"	,"page":"AJMP"}	]},
      {"talent":"Edo Dance","knacks":[ 	{"knackname":"Edo Feather Step [Special Maneuver]"	,"requirement":"Rank 1, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Edo Trip [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Leading the Dance [Special Maneuver]"	,"requirement":"Rank 7"	,"restrictions":"Tail Dancer 7"	,"page":"AJMP"}	,
      	{"knackname":"Prehensil Tail"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Quick Step"	,"requirement":"Rank 9, Unarmed Combat rank 7"	,"restrictions":"Tail Dancer 7"	,"page":"AJMP"}	,
      	{"knackname":"Slow Dance"	,"requirement":"Rank 6, Unarmed Combat rank 4"	,"restrictions":"Tail Dancer 4"	,"page":"AJMP"}	]},
      {"talent":"Emotion Song","knacks":[ 	{"knackname":"Accompaniment"	,"requirement":"Rank 6"		,"page":"C91"}	,
      	{"knackname":"Inflame Passion"	,"requirement":"Rank 6, Fires of Gahad rank 4"	,"restrictions":"Fire Eater 2"	,"page":"AJMP"}	,
      	{"knackname":"Telling the Tale"	,"requirement":"Rank 1"		,"page":"C91"}	]},
      {"talent":"Empathic Sense","knacks":[ 	{"knackname":"Captivity's Mark"	,"requirement":"Rank 6"	,"restrictions":"Liberator 3"	,"page":"AJMP"}	,
      	{"knackname":"Sense Allegiance"	,"requirement":"Rank 7"	,"restrictions":"Liberator 4"	,"page":"AJMP"}	,
      	{"knackname":"Sense Passion"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Set Aside Your Bias"	,"requirement":"Rank 8"	,"restrictions":"Liberator 6"	,"page":"AJMP"}	,
      	{"knackname":"Slavery's Mark"	,"requirement":"Rank 5"	,"restrictions":"Liberator 2"	,"page":"AJMP"}	]},
      {"talent":"Engaging Banter","knacks":[ 	{"knackname":"Bribery"	,"requirement":"Rank 5"		,"page":"C92"}	]},
      {"talent":"Engaging Dance","knacks":[ 	{"knackname":"Take the Lead [Special Maneuver]"	,"requirement":"Rank 5"		,"page":"AJMP"}	]},
      {"talent":"Enhance Animal Companion","knacks":[ 	{"knackname":"Augment Ally's Form"	,"requirement":"Rank 5"	,"restrictions":"Beastmaster 5,Cavalryman 5, Shaman 5"	,"page":"C92"}	,
      	{"knackname":"Mold Ally's Form"	,"requirement":"Rank 9,Augment Ally's Form"	,"restrictions":"Beastmaster 9, Cavalryman 9, Shaman 9"	,"page":"C93"}	,
      	{"knackname":"Sculpt Ally's Form"	,"requirement":"Rank 13,Mold Ally's Form"	,"restrictions":"Beastmaster 13, Cavalryman 13, Shaman 13"	,"page":"C93"}	]},
      {"talent":"Etiquette","knacks":[ 	{"knackname":"Courtesy Lessons"	,"requirement":"Rank 6"	,"restrictions":"Messenger 3, Troubadour 6"	,"page":"AJMP"}	,
      	{"knackname":"Group Alibi"	,"requirement":"Rank 10, Improvised Alibi"	,"restrictions":"Messenger 8"	,"page":"AJMP"}	,
      	{"knackname":"Improvised Alibi"	,"requirement":"Rank 9"	,"restrictions":"Messenger 6"	,"page":"AJMP"}	,
      	{"knackname":"Well Connected"	,"requirement":"Rank 8"	,"restrictions":"Messenger 5, Air Sailor 7"	,"page":"AJMP"}	]},
      {"talent":"Evidence Analysis","knacks":[ 	{"knackname":"Astral Survey"	,"requirement":"Rank 6"		,"page":"C93"}	,
      	{"knackname":"Cold Case"	,"requirement":"Rank 7"		,"page":"C93"}	,
      	{"knackname":"Investigation Expertise"	,"requirement":"Rank 7, Expansive Expertise rank 6"	,"restrictions":"Scholar 5"	,"page":"AJMP"}	,
      	{"knackname":"Peer Review"	,"requirement":"Rank 7"	,"restrictions":"Scholar 5"	,"page":"AJMP"}	]},
      {"talent":"Fire Eater","knacks":[ 	{"knackname":"Communal Gahad [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Control Gahad [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Harmony with Gahad [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Harness Gahad [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Restrain Gahad [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	]},
      {"talent":"Fireblood","knacks":[ 	{"knackname":"Burning Intimidation"	,"requirement":"Rank 5"	,"restrictions":"Fire Eater 1, Outcast 1, Sky Raider 6"	,"page":"AJMP"}	,
      	{"knackname":"Heart Burn"	,"requirement":"Rank 6, Fires of Gahad rank 4"	,"restrictions":"Fire Eater 2"	,"page":"AJMP"}	]},
      {"talent":"Fires of Gahad","knacks":[ 	{"knackname":"Blazing Gahad"	,"requirement":"Rank 8"	,"restrictions":"Fire Eater 4"	,"page":"AJMP"}	,
      	{"knackname":"Burning for You"	,"requirement":"Rank 8"	,"restrictions":"Fire Eater 4"	,"page":"AJMP"}	,
      	{"knackname":"I'm Always Angry"	,"requirement":"Rank 10"	,"restrictions":"Fire Eater 5"	,"page":"AJMP"}	,
      	{"knackname":"Sense Passion"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Share Gahad"	,"requirement":"Rank 8"	,"restrictions":"Fire Eater 4"	,"page":"AJMP"}	,
      	{"knackname":"Slow Burn"	,"requirement":"Rank 6"	,"restrictions":"Fire Eater 2"	,"page":"AJMP"}	,
      	{"knackname":"Stoking the Flames"	,"requirement":"Rank 1"	,"restrictions":"Fire Eater 1"	,"page":"AJMP"}	,
      	{"knackname":"Towering Inferno"	,"requirement":"Rank 3"		,"page":"AJMP"}	]},
      {"talent":"First Impression","knacks":[ 	{"knackname":"Grand Entrance"	,"requirement":"Rank 7"		,"page":"C94"}	]},
      {"talent":"Forest Sense","knacks":[ 	{"knackname":"Foliage Harassment [Special Maneuver]"	,"requirement":"Rank 10"	,"restrictions":"Woodsman 10"	,"page":"AJMP"}	,
      	{"knackname":"The Forest is My Sense"	,"requirement":"Rank 10"	,"restrictions":"Woodsman 10"	,"page":"AJMP"}	,
      	{"knackname":"The Forest's Grasp [Special Maneuver]"	,"requirement":"Rank 9"		,"page":"AJMP"}	]},
      {"talent":"Forge Armor","knacks":[ 	{"knackname":"Efficient Armor Forging"	,"requirement":"Rank 5"	,"restrictions":"Weaponsmith 5"	,"page":"C94"}	,
      	{"knackname":"Rapid Armor Forging"	,"requirement":"Rank 6"	,"restrictions":"Weaponsmith 6"	,"page":"C94"}	]},
      {"talent":"Forge Weapon","knacks":[ 	{"knackname":"Efficient Weapon Forging"	,"requirement":"Rank 5"	,"restrictions":"Weaponsmith 5"	,"page":"C94"}	,
      	{"knackname":"Rapid Weapon Forging"	,"requirement":"Rank 6"	,"restrictions":"Weaponsmith 6"	,"page":"C95"}	]},
      {"talent":"Gaze into the Abyss","knacks":[ 	{"knackname":"Abyss Gazes Back"	,"requirement":"Rank 6"	,"restrictions":"Horror Stalker 6"	,"page":"AJMP"}	]},
      {"talent":"Great Leap","knacks":[ 	{"knackname":"Pounce [Special Maneuver]"	,"requirement":"Rank 7"		,"page":"C95"}	,
      	{"knackname":"Vault Opponent"	,"requirement":"Rank 6"		,"page":"C95"}	]},
      {"talent":"Haggle","knacks":[ 	{"knackname":"Evaluate"	,"requirement":"Rank 1"		,"page":"C95"}	]},
      {"talent":"Heartening Laugh","knacks":[ 	{"knackname":"Shared Anger"	,"requirement":"Rank 7, Fires of Gahad rank 5"	,"restrictions":"Fire Eater 3"	,"page":"AJMP"}	,
      	{"knackname":"Warming Laughter"	,"requirement":"Rank 5, Fires of Gahad Rank 3"	,"restrictions":"Fire Eater 1"	,"page":"AJMP"}	]},
      {"talent":"Horror Stalker","knacks":[ 	{"knackname":"All Tied Up [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Beautiful Assault [Special Maneuver]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Defend Against the Darkness [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Dispersing Strike [Special Maneuver]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Hunter Hunted [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Knowledge is Power"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Lance Bloatform [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Mold Baggi [Special Maneuver]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Never Deceived [Special Maneuver]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Pattern Recognition [Special Maneuver]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Stab at the Spawn"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Strike the Darkness [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Their Weakness is My Strength "	,"requirement":"Rank 5"	,"restrictions":"Horror Stalker 5"	,"page":"AJMP"}	]},
      {"talent":"Impressive Display","knacks":[ 	{"knackname":"Fiery Display"	,"requirement":"Rank 5, Fires of Gahad Rank 3"	,"restrictions":"Fire Eater 1"	,"page":"AJMP"}	]},
      {"talent":"Iron Constitution","knacks":[ 	{"knackname":"Altitude Inclined"	,"requirement":"Rank 5"	,"restrictions":"Outcast 2, any Discipline 7"	,"page":"AJMP"}	,
      	{"knackname":"Energy Reserves"	,"requirement":"Rank 9"	,"restrictions":"Outcast 5, any Discipline 11"	,"page":"AJMP"}	,
      	{"knackname":"Exposure Resistance"	,"requirement":"Rank 5"	,"restrictions":"Outcast 1"	,"page":"AJMP"}	,
      	{"knackname":"Iron Fortitude"	,"requirement":"Rank 8, Iron Perseverance"	,"restrictions":"Outcast 5, any Discipline 10"	,"page":"AJMP"}	,
      	{"knackname":"Iron Perseverance"	,"requirement":"Rank 7"	,"restrictions":"Outcast rank 4, any Discipline 9"	,"page":"AJMP"}	,
      	{"knackname":"Tireless Spirit"	,"requirement":"Rank 6, Unflagging Endurance"	,"restrictions":"Outcast 3"	,"page":"AJMP"}	,
      	{"knackname":"Unflagging Endurance"	,"requirement":"Rank 5"		,"page":"AJMP"}	]},
      {"talent":"Item History","knacks":[ 	{"knackname":"Historian [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Psychometry"	,"requirement":"Rank 6"		,"page":"C96"}	,
      	{"knackname":"Touching the Past"	,"requirement":"Rank 8"		,"page":"C96"}	]},
      {"talent":"Journeyman","knacks":[ 	{"knackname":"Applied Versatility [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Practiced Versatility [Karma]"	,"requirement":"Rank 3, Versatility rank 8"		,"page":"AJMP"}	,
      	{"knackname":"Skilled Versatility [Karma]"	,"requirement":"Rank 5, Versatility rank 10"		,"page":"AJMP"}	]},
      {"talent":"Leadership","knacks":[ 	{"knackname":"Free Mind"	,"requirement":"Rank 9"	,"restrictions":"Liberator 8"	,"page":"AJMP"}	,
      	{"knackname":"It Starts with a Spark"	,"requirement":"Rank 8"	,"restrictions":"Liberator 6"	,"page":"AJMP"}	]},
      {"talent":"Liberator","knacks":[ 	{"knackname":"Blending In [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Freedom Crusade"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Inquisition of Tyrants [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Insurgency [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Liberator's Reprisal [Karma]"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Liberator's Vengeance [Karma]"	,"requirement":"Rank 9"		,"page":"AJMP"}	,
      	{"knackname":"Sowing Dissent [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	]},
      {"talent":"Lifesight","knacks":[ 	{"knackname":"Dreadsight"	,"requirement":"Rank 7"	,"restrictions":"Horror Stalker 5, Nethermancer 8,"	,"page":"AJMP"}	,
      	{"knackname":"Lay of the Land"	,"requirement":"Rank 5"	,"restrictions":"Purifier 1, any Discipline 7"	,"page":"AJMP"}	]},
      {"talent":"Lion Heart","knacks":[ 	{"knackname":"Blazing Glory [Special Maneuver]"	,"requirement":"Rank 10, Fires of Gahad rank 8"	,"restrictions":"Fire Eater 5"	,"page":"AJMP"}	,
      	{"knackname":"Crewmate's Courage"	,"requirement":"Rank 9"	,"restrictions":"Air Sailor 9, Boatman 9, Sailor 9"	,"page":"AJMP"}	,
      	{"knackname":"Fuel My Fire [Special Maneuver]"	,"requirement":"Rank 8, Fires of Gahad 6"	,"restrictions":"Fire Eater 4"	,"page":"AJMP"}	,
      	{"knackname":"Outcast Stoicism"	,"requirement":"Rank 8"	,"restrictions":"Outcast 4"	,"page":"AJMP"}	]},
      {"talent":"Lock Picking","knacks":[ 	{"knackname":"False Shackles"	,"requirement":"Rank 6"	,"restrictions":"Liberator 4, Any Discipline 8"	,"page":"AJMP"}	,
      	{"knackname":"Hidden Uprising"	,"requirement":"Rank 8, False Shackles"	,"restrictions":"Liberator 7, Any Discipline 12"	,"page":"AJMP"}	,
      	{"knackname":"Shackle Shrug"	,"requirement":"Rank 3"		,"page":"C96"}	,
      	{"knackname":"Unchained Gang"	,"requirement":"Rank 7, Shackle Shrug"	,"restrictions":"Liberator 6, any Discipline 11"	,"page":"AJMP"}	]},
      {"talent":"Long Shot","knacks":[ 	{"knackname":"Extend Range"	,"requirement":"Rank 5"		,"page":"C97"}	]},
      {"talent":"Maneuver","knacks":[ 	{"knackname":"Aerial Maneuver"	,"requirement":"Rank 7, Air Dance rank 5"	,"restrictions":"Windmaster 4"	,"page":"AJMP"}	,
      	{"knackname":"Aggressive Maneuver"	,"requirement":"Rank 5"		,"page":"C97"}	,
      	{"knackname":"Feint"	,"requirement":"Rank 7"		,"page":"C98"}	,
      	{"knackname":"Hamstring [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"C98"}	,
      	{"knackname":"Patient Maneuver"	,"requirement":"Rank 5"		,"page":"C98"}	,
      	{"knackname":"Setup"	,"requirement":"Rank 8"		,"page":"C98"}	,
      	{"knackname":"Slippery Little Devil"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 1"	,"page":"AJMP"}	,
      	{"knackname":"Wind Dodge"	,"requirement":"Rank 10"	,"restrictions":"Windmaster 7"	,"page":"AJMP"}	]},
      {"talent":"Melee Weapons","knacks":[ 	{"knackname":"Deflect Blow"	,"requirement":"Rank 7"		,"page":"C99"}	,
      	{"knackname":"Give Ground [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"C100"}	,
      	{"knackname":"Harrying Attack [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"C100"}	,
      	{"knackname":"Improved Improvised Weapon"	,"requirement":"Rank 7,Improvised Weapon"		,"page":"C99"}	,
      	{"knackname":"Improvised Weapon"	,"requirement":"Rank 4"		,"page":"C99"}	,
      	{"knackname":"Mind Blade"	,"requirement":"Rank 8"		,"page":"C99"}	,
      	{"knackname":"Overpower [Special Maneuver]"	,"requirement":"Rank 7"	,"restrictions":"Strength 14"	,"page":"C101"}	,
      	{"knackname":"Swing Attack"	,"requirement":"Rank 6"		,"page":"C100"}	,
      	{"knackname":"Tail Weapon"	,"requirement":"Rank 4, T'Skrang"		,"page":"C100"}	,
      	{"knackname":"Wind Slash"	,"requirement":"Rank 10"	,"restrictions":"Windmaster 8, any Discipline 12"	,"page":"AJMP"}	]},
      {"talent":"Messenger","knacks":[ 	{"knackname":"Bland Pleasantries [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Faceless Messenger [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Making the Rounds [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Messenger's Duty [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Messenger's Encouragement [Karma]"	,"requirement":"Rank 8, Messenger's Perseverance"		,"page":"AJMP"}	,
      	{"knackname":"Messenger's Endurance [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Messenger's Perseverance [Karma]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Messenger's Vow"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"See the Message [Karma]"	,"requirement":"Rank 7"		,"page":"AJMP"}	]},
      {"talent":"Missile Weapons","knacks":[ 	{"knackname":"Flare"	,"requirement":"Rank 7"		,"page":"C101"}	,
      	{"knackname":"Point-Blank Shot"	,"requirement":"Rank 3"		,"page":"C101"}	,
      	{"knackname":"Wind Bow"	,"requirement":"Rank 8"		,"page":"C101"}	]},
      {"talent":"Morphism","knacks":[ 	{"knackname":"Adaptive Form [Special Maneuver]"	,"requirement":"Rank 4"	,"restrictions":"Journeyman 5"	,"page":"AJMP"}	,
      	{"knackname":"Divergent Form"	,"requirement":"Rank 7, Adaptive Form"	,"restrictions":"Journeyman 5"	,"page":"AJMP"}	,
      	{"knackname":"Metamorphosis"	,"requirement":"Rank 10, Divergent Form"	,"restrictions":"Journeyman 5"	,"page":"AJMP"}	,
      	{"knackname":"Quick Shift"	,"requirement":"Rank 6"	,"restrictions":"Journeyman 5"	,"page":"AJMP"}	,
      	{"knackname":"Versatile Form"	,"requirement":"Rank 5"	,"restrictions":"Journeyman 5"	,"page":"AJMP"}	]},
      {"talent":"Mystic Aim","knacks":[ 	{"knackname":"Missile Path"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 4"	,"page":"AJMP"}	,
      	{"knackname":"Precise Shot"	,"requirement":"Rank 7"		,"page":"C102"}	,
      	{"knackname":"Trail Blaze"	,"requirement":"Rank 7, Fires of Gahad rank 5"	,"restrictions":"Fire Eater 3"	,"page":"AJMP"}	]},
      {"talent":"Navigation","knacks":[ 	{"knackname":"Mapmaking"	,"requirement":"Rank 2"		,"page":"C102"}	,
      	{"knackname":"Navigate Through the Earth"	,"requirement":"Rank 5"	,"restrictions":"Brother of Stone 1"	,"page":"AJMP"}	,
      	{"knackname":"Read River"	,"requirement":"Rank 5"		,"page":"C102"}	]},
      {"talent":"Orbiting Spy","knacks":[ 	{"knackname":"Horror Seeker"	,"requirement":"Rank 6"	,"restrictions":"Horror Stalker 6"	,"page":"AJMP"}	,
      	{"knackname":"Orbiting Watcher"	,"requirement":"Rank 10"	,"restrictions":"Messenger 7, any Discipline 12"	,"page":"AJMP"}	]},
      {"talent":"Outcast","knacks":[ 	{"knackname":"Outcast's Honor [Karma]"	,"requirement":"Rank 3, Rite of Kho'pesh rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Outcast's Redemption [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Relentless Outcast [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Unbent Outcast [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Unyielding Outcast [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Brother of Stone Spells"	,"requirement":"Rank 7"	,"restrictions":"Brother of Stone 4"	,"page":"AJMP"}	,
      	{"knackname":"Channel Fire"	,"requirement":"Rank 9, Fires of Gahad rank 7"	,"restrictions":"Fire Eater 5"	,"page":"AJMP"}	,
      	{"knackname":"Improvised Pattern"	,"requirement":"Rank 8"		,"page":"C102"}	,
      	{"knackname":"Learn Improved Spells"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Liberator Spells"	,"requirement":"Rank 7"	,"restrictions":"Liberator 4"	,"page":"AJMP"}	,
      	{"knackname":"Messenger Spells"	,"requirement":"Rank 7"	,"restrictions":"Messenger 4"	,"page":"AJMP"}	,
      	{"knackname":"Purifier Spells"	,"requirement":"Rank 7"	,"restrictions":"Purifier 4"	,"page":"AJMP"}	,
      	{"knackname":"Scholar Spells"	,"requirement":"Rank 7"	,"restrictions":"Scholar 4"	,"page":"AJMP"}	,
      	{"knackname":"Woodsman Spells"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 4"	,"page":"AJMP"}	]},
      {"talent":"Picking Pockets","knacks":[ 	{"knackname":"Streetwise"	,"requirement":"Rank 4"		,"page":"C103"}	]},
      {"talent":"Pilot Boat","knacks":[ 	{"knackname":"Air Sailing"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"River Legs"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Sweeping Current"	,"requirement":"Rank 7"	,"restrictions":"Air Sailor 7, Boatman 7, Sailor 7"	,"page":"AJMP"}	]},
      {"talent":"Purification","knacks":[ 	{"knackname":"Focused Purification"	,"requirement":"Rank 9"	,"restrictions":"Purifier 5"	,"page":"AJMP"}	,
      	{"knackname":"Purigying Touch"	,"requirement":"Rank 5"		,"page":"AJMP"}	]},
      {"talent":"Purifier","knacks":[ 	{"knackname":"Purifier's Auspices [Karma]"	,"requirement":"Rank 2, Purifier's Touch"		,"page":"AJMP"}	,
      	{"knackname":"Purifier's Retaliation [Karma]"	,"requirement":"Rank 4, Purifier's Vengeance"		,"page":"AJMP"}	,
      	{"knackname":"Purifier's Touch [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Purifier's Vengeance [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Tear Out the Root [Karma]"	,"requirement":"Rank 5, Earth's Retaliation"		,"page":"AJMP"}	]},
      {"talent":"Read and Write Language","knacks":[ 	{"knackname":"Cryptic Cipher"	,"requirement":"Rank 5"	,"restrictions":"Messenger 1, any Discipline 7"	,"page":"AJMP"}	,
      	{"knackname":"Decipher message"	,"requirement":"Rank 7, Cryptic Message, Hidden Message,Veiled Message"	,"restrictions":"Messenger 4"	,"page":"AJMP"}	,
      	{"knackname":"Empower Encrypt"	,"requirement":"Rank 5, Patterncraft rank 5, Veiled Cipher"	,"restrictions":"Messenger 1"	,"page":"AJMP"}	,
      	{"knackname":"Evocative Message"	,"requirement":"Rank 9"	,"restrictions":"Messenger 5"	,"page":"AJMP"}	,
      	{"knackname":"Hidden Message"	,"requirement":"Rank 6"	,"restrictions":"Messenger 3"	,"page":"AJMP"}	,
      	{"knackname":"Unbreakable Cipher"	,"requirement":"Rank 8, Cryptic Cipher"	,"restrictions":"Messenger 5"	,"page":"AJMP"}	,
      	{"knackname":"Undetectable Cipher"	,"requirement":"Rank 9, Hidden Message, Veiled Cipher"	,"restrictions":"Messenger 6"	,"page":"AJMP"}	,
      	{"knackname":"Veiled Cipher"	,"requirement":"Rank 5"	,"restrictions":"Messenger 2"	,"page":"AJMP"}	]},
      {"talent":"Read River","knacks":[ 	{"knackname":"Navigation"	,"requirement":"Rank 5"		,"page":"AJMP"}	]},
      {"talent":"Research","knacks":[ 	{"knackname":"Consult with Colleagues"	,"requirement":"Rank 5"	,"restrictions":"Scholar 1, any Discipline 7"	,"page":"AJMP"}	,
      	{"knackname":"Librarian [Special Maneuver]"	,"requirement":"Rank 5"	,"restrictions":"Scholar 1, any Discipline 7"	,"page":"AJMP"}	,
      	{"knackname":"Research Expertise"	,"requirement":"Rank 6, Expansive Expertise rank 4"	,"restrictions":"Scholar 2"	,"page":"AJMP"}	]},
      {"talent":"Resist Taunt","knacks":[ 	{"knackname":"Make Concession"	,"requirement":"Rank 6"		,"page":"C103"}	]},
      {"talent":"Riposte","knacks":[ 	{"knackname":"Claw Riposte"	,"requirement":"Rank 5"		,"page":"C103"}	]},
      {"talent":"Rite of Kho'pesh","knacks":[ 	{"knackname":"Embody Ka'tosh"	,"requirement":"Rank 7"	,"restrictions":"Outcast 3"	,"page":"AJMP"}	,
      	{"knackname":"Embracing Ka'tosh"	,"requirement":"Rank 9"	,"restrictions":"Outcast 5"	,"page":"AJMP"}	,
      	{"knackname":"Ka'tosh's Rebuke"	,"requirement":"Rank 6"	,"restrictions":"Outcast 2"	,"page":"AJMP"}	,
      	{"knackname":"Tenacity of Ka'tosh"	,"requirement":"Rank 10"	,"restrictions":"Outcast 5"	,"page":"AJMP"}	,
      	{"knackname":"What Ka'tosh Demands"	,"requirement":"Rank 8"	,"restrictions":"Outcast 4"	,"page":"AJMP"}	]},
      {"talent":"Sailing","knacks":[ 	{"knackname":"Air Sailing"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Sea Legs"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Sweeping Current"	,"requirement":"Rank 7"	,"restrictions":"Air Sailor 7, Boatman 7, Sailor 7"	,"page":"AJMP"}	]},
      {"talent":"Scholar","knacks":[ 	{"knackname":"Critical Thinking"	,"requirement":"Rank 2, Expansive Expertise rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Mnemonics Master [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Practical Learning [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Sage's Insight [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	]},
      {"talent":"Second Weapon","knacks":[ 	{"knackname":"Cast Net"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Dragging Parry"	,"requirement":"Rank 8, Cast Net"		,"page":"AJMP"}	,
      	{"knackname":"Entangling Cloak"	,"requirement":"Rank 9, Cast Net"		,"page":"AJMP"}	,
      	{"knackname":"Tail Attack"	,"requirement":"Rank 5"	,"restrictions":"Tail Dancer 2"	,"page":"AJMP"}	]},
      {"talent":"Sense Captive","knacks":[ 	{"knackname":"Captivity's Mark"	,"requirement":"Rank 6"	,"restrictions":"Liberator 3"	,"page":"AJMP"}	,
      	{"knackname":"Sense Allegiance"	,"requirement":"Rank 7"	,"restrictions":"Liberator 4"	,"page":"AJMP"}	,
      	{"knackname":"Sense Chattel"	,"requirement":"Rank 5"	,"restrictions":"Liberator 2"	,"page":"AJMP"}	,
      	{"knackname":"Slavery's Mark"	,"requirement":"Rank 5"	,"restrictions":"Liberator 2"	,"page":"AJMP"}	]},
      {"talent":"Sense Horrorspawn","knacks":[ 	{"knackname":"Sense Corruption"	,"requirement":"Rank 5"	,"restrictions":"Horror Stalker 5"	,"page":"AJMP"}	]},
      {"talent":"Shield Bash","knacks":[ 	{"knackname":"Shield Drive"	,"requirement":"Rank 6"		,"page":"C103"}	]},
      {"talent":"Shivoavara Dance","knacks":[ 	{"knackname":"Dancing in the Dark [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Elusive Dancer [Special Maneuver]"	,"requirement":"Rank 7, Unarmed Combat rank 7"	,"restrictions":"Tail Dancer 7"	,"page":"AJMP"}	,
      	{"knackname":"Shivoavara Spring [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Shivoavara Strike [Special Maneuver]"	,"requirement":"Rank 6, Unarmed Combat rank 6"	,"restrictions":"Tail Dancer 6"	,"page":"AJMP"}	,
      	{"knackname":"Shivoavara Swiftness [Special Maneuver]"	,"requirement":"Rank 1, Unarmed Combat rank 5"		,"page":"AJMP"}	]},
      {"talent":"Skora Dance","knacks":[ 	{"knackname":"Cutting In"	,"requirement":"Rank 8, Unarmed Combat rank 8"	,"restrictions":"Tail Dancer 8"	,"page":"AJMP"}	,
      	{"knackname":"Iron Tail"	,"requirement":"Rank 7, Unarmed Combat rank 7"	,"restrictions":"Tail Dancer 7"	,"page":"AJMP"}	,
      	{"knackname":"Skora Defense [Special Maneuver]"	,"requirement":"Rank 1, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Skora Parry [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Skora Slide [Special Maneuver]"	,"requirement":"Rank 7, Unarmed Combat rank 6"	,"restrictions":"Tail Dancer 6"	,"page":"AJMP"}	,
      	{"knackname":"Steel Dance"	,"requirement":"Rank 6, Unarmed Combat rank 6"	,"restrictions":"Tail Dancer 6"	,"page":"AJMP"}	]},
      {"talent":"Skora Slam","knacks":[ 	{"knackname":"Skora Stagger [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Tail Sweep [Special Maneuver]"	,"requirement":"Rank 9, Unarmed Combat rank 9"	,"restrictions":"Tail Dancer 9"	,"page":"AJMP"}	]},
      {"talent":"Slough Blame","knacks":[ 	{"knackname":"Forgery"	,"requirement":"Rank 6"		,"page":"C104"}	]},
      {"talent":"Speak Language","knacks":[ 	{"knackname":"Doublespeak"	,"requirement":"Rank 7"	,"restrictions":"Messenger 5"	,"page":"AJMP"}	,
      	{"knackname":"Doublethink"	,"requirement":"Rank 8, Doublespeak"	,"restrictions":"Messenger 6"	,"page":"AJMP"}	]},
      {"talent":"Spellcasting","knacks":[ 	{"knackname":"Acid Splash"	,"requirement":"Rank 2"	,"restrictions":"Elementalist 2"	,"page":"C105"}	,
      	{"knackname":"Arcane Accuracy"	,"requirement":"Rank 2"	,"restrictions":"Wizard 2"	,"page":"C104"}	,
      	{"knackname":"Arcane Edge"	,"requirement":"Rank 3"	,"restrictions":"Wizard 3"	,"page":"C105"}	,
      	{"knackname":"Astral Strain"	,"requirement":"Rank 2"	,"restrictions":"Nethermancer 2"	,"page":"C105"}	,
      	{"knackname":"Astral Ward"	,"requirement":"Rank 2"	,"restrictions":"Wizard 2"	,"page":"C105"}	,
      	{"knackname":"Befuddle"	,"requirement":"Rank 2"	,"restrictions":"Illusionist 2"	,"page":"C106"}	,
      	{"knackname":"Bleed"	,"requirement":"Rank 3"	,"restrictions":"Nethermancer 3"	,"page":"C106"}	,
      	{"knackname":"Burst of Speed"	,"requirement":"Rank 3"	,"restrictions":"Elementalist 3"	,"page":"C106"}	,
      	{"knackname":"Courage"	,"requirement":"Rank 2"	,"restrictions":"Illusionist 2"	,"page":"C106"}	,
      	{"knackname":"Deflection"	,"requirement":"Rank 4"	,"restrictions":"Wizard 4"	,"page":"C107"}	,
      	{"knackname":"Doupt"	,"requirement":"Rank 4"	,"restrictions":"Illusionist 4"	,"page":"C107"}	,
      	{"knackname":"Fire Attunement"	,"requirement":"Rank 8, Fires of Gahad rank 6"	,"restrictions":"Fire Eater 4"	,"page":"AJMP"}	,
      	{"knackname":"Fluster"	,"requirement":"Rank 5"	,"restrictions":"Illusionist 5"	,"page":"C107"}	,
      	{"knackname":"Fortify Armor"	,"requirement":"Rank 2"	,"restrictions":"Elementalist 2"	,"page":"C107"}	,
      	{"knackname":"Fortify Pattern"	,"requirement":"Rank 5"	,"restrictions":"Wizard 5"	,"page":"C108"}	,
      	{"knackname":"Grasping Vines"	,"requirement":"Rank 5"	,"restrictions":"Elementalist 5"	,"page":"C108"}	,
      	{"knackname":"Lick Wounds"	,"requirement":"Rank 3"	,"restrictions":"Shaman 3"	,"page":"AJMP"}	,
      	{"knackname":"Pack Cover"	,"requirement":"Rank 4"	,"restrictions":"Shaman 4"	,"page":"AJMP"}	,
      	{"knackname":"Pack Strike"	,"requirement":"Rank 2"	,"restrictions":"Shaman 2"	,"page":"AJMP"}	,
      	{"knackname":"Pattern Stress"	,"requirement":"Rank 4"	,"restrictions":"Nethermancer 4"	,"page":"C108"}	,
      	{"knackname":"Shutter"	,"requirement":"Rank 3"	,"restrictions":"Illusionist 3"	,"page":"C109"}	,
      	{"knackname":"Soothe Venom"	,"requirement":"Rank 4"	,"restrictions":"Elementalist 4"	,"page":"C108"}	,
      	{"knackname":"Sprain"	,"requirement":"Rank 5"	,"restrictions":"Nethermancer 5"	,"page":"C109"}	,
      	{"knackname":"Sure-Footed"	,"requirement":"Rank 5"	,"restrictions":"Shaman 5"	,"page":"AJMP"}	,
      	{"knackname":"Unsettle"	,"requirement":"Rank 2"	,"restrictions":"Nethermancer 2"	,"page":"C109"}	,
      	{"knackname":"Wriggle"	,"requirement":"Rank 2"	,"restrictions":"Shaman 2"	,"page":"AJMP"}	]},
      {"talent":"Spirit Mount","knacks":[ 	{"knackname":"Spirit Team"	,"requirement":"Rank 9"	,"restrictions":"Messenger rank 6, any Discipline 11"	,"page":"AJMP"}	]},
      {"talent":"Spirit Talk","knacks":[ 	{"knackname":"Horror Tongue"	,"requirement":"Rank 5"	,"restrictions":"Horror Stalker 5"	,"page":"AJMP"}	]},
      {"talent":"Stealthy Stride","knacks":[ 	{"knackname":"Ambush Tactics"	,"requirement":"Rank 8, Hidden Allies"	,"restrictions":"Woodsman 5, Scout 8"	,"page":"AJMP"}	,
      	{"knackname":"Astral Stealth"	,"requirement":"Rank 7"		,"page":"C110"}	,
      	{"knackname":"Bland Stride"	,"requirement":"Rank 5"	,"restrictions":"Messenger 1"	,"page":"AJMP"}	,
      	{"knackname":"Hidden Allies"	,"requirement":"Rank 5"	,"restrictions":"Woodsman 1, Scout 5"	,"page":"AJMP"}	,
      	{"knackname":"Subtle Casting"	,"requirement":"Rank 6"		,"page":"C110"}	,
      	{"knackname":"Traceless Stride"	,"requirement":"Rank 8"		,"page":"C110"}	]},
      {"talent":"Steel Thought","knacks":[ 	{"knackname":"Absorb Spell"	,"requirement":"Rank 6"		,"page":"C110"}	,
      	{"knackname":"Harden Heart"	,"requirement":"Rank 7"	,"restrictions":"Outcast 3"	,"page":"AJMP"}	]},
      {"talent":"Summon","knacks":[ 	{"knackname":"Bind Named Spirit"	,"requirement":"Rank 6"		,"page":"AJMP"}	]},
      {"talent":"Surprise Strike","knacks":[ 	{"knackname":"Dirty Fighting"	,"requirement":"Rank 7"		,"page":"C111"}	]},
      {"talent":"Swift Kick","knacks":[ 	{"knackname":"Quick Tail"	,"requirement":"Rank 5"	,"restrictions":"Tail Dancer 1"	,"page":"AJMP"}	]},
      {"talent":"Swimming","knacks":[ 	{"knackname":"Deep Diver"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Improved Gills"	,"requirement":"Rank 9, Deep Diver"	,"restrictions":"T'skrang"	,"page":"AJMP"}	]},
      {"talent":"Tactics","knacks":[ 	{"knackname":"Opening [Special Maneuver]"	,"requirement":"Rank 8"		,"page":"C111"}	]},
      {"talent":"Tail Dance","knacks":[ 	{"knackname":"Balaced Dance [Special Maneuver]"	,"requirement":"Rank 3, Unarmed Combat 5"	,"restrictions":"Tail Dancer 3"	,"page":"AJMP"}	,
      	{"knackname":"Clear the Floor [Special Maneuver]"	,"requirement":"Rank 7, Unarmed Combat 7"	,"restrictions":"Tail Dancer 7"	,"page":"AJMP"}	,
      	{"knackname":"Set the Tempo [Special Maneuver]"	,"requirement":"Rank 5, Unarmed Combat rank 5"	,"restrictions":"Tail Dancer 5"	,"page":"AJMP"}	,
      	{"knackname":"Unfettered Dance [Special Maneuver]"	,"requirement":"Rank 1, Unarmed Combat rank 5"		,"page":"AJMP"}	]},
      {"talent":"Tail Dancer","knacks":[ 	{"knackname":"Ch'tard Pierce [Karma]"	,"requirement":"Rank 6, Ch'tard Dance rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Course of the River [Karma]"	,"requirement":"Rank 8"		,"page":"AJMP"}	,
      	{"knackname":"Edo Flick [Karma]"	,"requirement":"Rank 6, Edo Dance rank 5"		,"page":"AJMP"}	,
      	{"knackname":"River Dance [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Shivoavara Advance [Karma]"	,"requirement":"Rank 6, Shivoavara Dance rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Skora Twist [Karma]"	,"requirement":"Rank 6, Skora Dance rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Tail Defense [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Tail Rush [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	]},
      {"talent":"Taunt","knacks":[ 	{"knackname":"Incite [Special Maneuver]"	,"requirement":"Rank 6"	,"restrictions":"Windmaster 3"	,"page":"AJMP"}	,
      	{"knackname":"Infuriate [Special Maneuver]"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 2"	,"page":"AJMP"}	]},
      {"talent":"Temper Flesh","knacks":[ 	{"knackname":"Temper Spirit"	,"requirement":"Rank 8"	,"restrictions":"Outcast 4, any Discipline 10"	,"page":"AJMP"}	]},
      {"talent":"Thread Weaving","knacks":[ 	{"knackname":"Bribery"		,"restrictions":"Liberator 5"	,"page":"AJMP"}	,
      	{"knackname":"Brother of Stone [Path]"	,"requirement":"Rank 5, Speak Obsidiman, ReadWrite Obsidiman, Obsidiman Lore 5, "	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Dive Mastery"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 1"	,"page":"AJMP"}	,
      	{"knackname":"Falling Rocks [Special Maneuver]"	,"requirement":"Rank 7"	,"restrictions":"Brother of Stone 4"	,"page":"AJMP"}	,
      	{"knackname":"Fire Eater [Path]"	,"requirement":"Rank 5, Ork"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Ghost Master Ritual"	,"requirement":"Rank 5"		,"page":"C113"}	,
      	{"knackname":"Horror Stalker [Path]"	,"requirement":"Rank 5,"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Journeyman [Path]"	,"requirement":"Rank 5, Versatility 5, Human,"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Liberator [Path]"	,"requirement":"Rank 5, "	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Messenger [Path]"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Mind Armor"	,"requirement":"Rank 8"		,"page":"C113"}	,
      	{"knackname":"Outcast [Path]"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Purifier [Path]"	,"requirement":"Rank 5, Knowledge skill rank 5"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Shifting Earth [Special Maneuver]"	,"requirement":"Rank 10"	,"restrictions":"Brother of Stone 8"	,"page":"AJMP"}	,
      	{"knackname":"Stone Shudder [Special Maneuver]"	,"requirement":"Rank 12"	,"restrictions":"Brother of Stone 10"	,"page":"AJMP"}	,
      	{"knackname":"Stone Strike [Special Maneuver]"	,"requirement":"Rank 9"	,"restrictions":"Brother of Stone 6"	,"page":"AJMP"}	,
      	{"knackname":"Streetwise"		,"restrictions":"Messenger 5"	,"page":"C103"}	,
      	{"knackname":"Strength of Bronze"	,"requirement":"Rank 5"	,"restrictions":"Strength 14, Dwarf, Windmaster 3"	,"page":"C114"}	,
      	{"knackname":"Strength of Iron"	,"requirement":"Rank 9,Strength of Bronze"	,"restrictions":"Strength 16, Dwarf, Windmaster 6"	,"page":"C114"}	,
      	{"knackname":"Strength of Steel"	,"requirement":"Rank 13,Strength of Iron"	,"restrictions":"Strength 18, Dwarf, Windmaster 10"	,"page":"C114"}	,
      	{"knackname":"Tail Dancer [Path]"	,"requirement":"Rank 5, Dancing rank 5, Melee Weapons Rank 5, T'skrang"	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Tail Defense [Karma]"	,"requirement":"Rank 1"	,"restrictions":"T'skrang"	,"page":"AJMP"}	,
      	{"knackname":"Wind Mastery"	,"requirement":"Rank 10"	,"restrictions":"Windmaster 10"	,"page":"AJMP"}	,
      	{"knackname":"Windmaster [Path]"	,"requirement":"Rank 5, Melee Weapons rank 5, Windling, "	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	,
      	{"knackname":"Wing Mastery"	,"requirement":"Rank 8"	,"restrictions":"Windmaster 5"	,"page":"AJMP"}	,
      	{"knackname":"Woodsman [Path]"	,"requirement":"Rank 5, Speak Elf, ReadWrite Elf, Elf Lore rank 5, "	,"restrictions":"Any Discipline 5"	,"page":"AJMP"}	]},
      {"talent":"Elementalism","knacks":[ 	{"knackname":"Detect Spirit"	,"requirement":"Rank 5"		,"page":"C111"}	,
      	{"knackname":"Detect True Element"	,"requirement":"Rank 4"		,"page":"C111"}	,
      	{"knackname":"Harvest True Element"	,"requirement":"Rank 5"		,"page":"C113"}	]},
      {"talent":"Nethermancy","knacks":[ 	{"knackname":"Detect Spirit"	,"requirement":"Rank 5"		,"page":"C111"}	]},
      {"talent":"Scout Weaving","knacks":[ 	{"knackname":"Detect Spirit"	,"requirement":"Rank 5"		,"page":"C111"}	,
      	{"knackname":"Detect True Element"	,"requirement":"Rank 4"		,"page":"C111"}	]},
      {"talent":"Shamanism","knacks":[ 	{"knackname":"Detect Spirit"	,"requirement":"Rank 5"		,"page":"C111"}	]},
      {"talent":"Thread Smithing","knacks":[ 	{"knackname":"Detect True Element"	,"requirement":"Rank 4"		,"page":"C111"}	]},
      {"talent":"Throwing Weapons","knacks":[ 	{"knackname":"Flare"	,"requirement":"Rank 7"		,"page":"C101"}	,
      	{"knackname":"Point Blank Shot"			,"page":"C101"}	,
      	{"knackname":"Returning"	,"requirement":"Rank 4"		,"page":"C114"}	,
      	{"knackname":"Throw Anything"	,"requirement":"Rank 4"		,"page":"C115"}	]},
      {"talent":"Tiger Spring","knacks":[ 	{"knackname":"Greased Lightning [Special Maneuver]"	,"requirement":"Rank 7"	,"restrictions":"Windmaster 4"	,"page":"AJMP"}	]},
      {"talent":"Tracking","knacks":[ 	{"knackname":"Hunter's Strike"	,"requirement":"Rank 5"	,"restrictions":"Woodsman 2, any Discipline 7"	,"page":"AJMP"}	,
      	{"knackname":"Track Astral Form"	,"requirement":"Rank 8"	,"restrictions":"Horror Stalker 8,Scout 10"	,"page":"AJMP"}	]},
      {"talent":"Tyranny's Ruin","knacks":[ 	{"knackname":"Hoard Blows"	,"requirement":"Rank 8"	,"restrictions":"Liberator 8"	,"page":"AJMP"}	]},
      {"talent":"Tyranny's Ruin","knacks":[ 	{"knackname":"Shared Pain"	,"requirement":"Rank 6, Empathic Sense 5"	,"restrictions":"Liberator 6"	,"page":"AJMP"}	]},
      {"talent":"Unarmed Combat","knacks":[ 	{"knackname":"Backslash"	,"requirement":"Rank 6"	,"restrictions":"Tail Dancer 8,Ch'tard Dance 6"	,"page":"AJMP"}	,
      	{"knackname":"Body Blade"	,"requirement":"Rank 5"		,"page":"C115"}	,
      	{"knackname":"Eye Gouge [Special Maneuver]"	,"requirement":"Rank 7"		,"page":"C115"}	,
      	{"knackname":"Give Ground [Special Maneuver]"	,"requirement":"Rank 6"		,"page":"C100"}	]},
      {"talent":"Wilderness Survival","knacks":[ 	{"knackname":"Wastelander"	,"requirement":"Rank 6"	,"restrictions":"Horror Stalker 3, Purifier 3, Scout 8"	,"page":"AJMP"}	]},
      {"talent":"Wind Catcher","knacks":[ 	{"knackname":"Glide"	,"requirement":"Rank 6"		,"page":"C115"}	]},
      {"talent":"Windmaster","knacks":[ 	{"knackname":"Annoying Little [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	,
      	{"knackname":"Maz-Shyera-tis [Karma]"	,"requirement":"Rank 10, Sherya-tis"		,"page":"AJMP"}	,
      	{"knackname":"Never Alone [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Shyer-tis [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Windmaster Technique [Karma]"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Windmaster Training [Karma]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Windmaster's Advantage [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Windmaster's Dance [Karma]"	,"requirement":"Rank 9"		,"page":"AJMP"}	,
      	{"knackname":"Windmaster's Resilience [Karma]"	,"requirement":"Rank 8"		,"page":"AJMP"}	]},
      {"talent":"Winning Smile","knacks":[ 	{"knackname":"Flirting"	,"requirement":"Rank 4"		,"page":"C116"}	,
      	{"knackname":"Seduction"	,"requirement":"Rank 5"		,"page":"C116"}	]},
      {"talent":"Wood Skin","knacks":[ 	{"knackname":"Share Wood Skin"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 4"	,"page":"AJMP"}	,
      	{"knackname":"Wood Blend"	,"requirement":"Rank 6"	,"restrictions":"Woodsman 3"	,"page":"AJMP"}	,
      	{"knackname":"Wood Wings"	,"requirement":"Rank 5"		,"page":"AJMP"}	]},
      {"talent":"Wood Walk","knacks":[ 	{"knackname":"Enemy of the Court"	,"requirement":"Rank 9, Wood Excursion"	,"restrictions":"Woodsman 9"	,"page":"AJMP"}	,
      	{"knackname":"Leaf on the Wind"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 7"	,"page":"AJMP"}	,
      	{"knackname":"Light as a Leaf"	,"requirement":"Rank 8, Race Through the Canopy"	,"restrictions":"Woodsman 6, any Discipline 10"	,"page":"AJMP"}	,
      	{"knackname":"Race Through the Canopy"	,"requirement":"Rank 7"	,"restrictions":"Woodsman 5, any Discipline 9"	,"page":"AJMP"}	,
      	{"knackname":"The Forest Knows My Feet"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"The Forest Knows My Friends"	,"requirement":"Rank 7, The forest knows my feet"	,"restrictions":"Woodsman 7"	,"page":"AJMP"}	,
      	{"knackname":"Travers Forest"	,"requirement":"Rank 9"	,"restrictions":"Woodsman 9"	,"page":"AJMP"}	,
      	{"knackname":"Wood Dash"	,"requirement":"Rank 8"	,"restrictions":"Woodsman 8"	,"page":"AJMP"}	,
      	{"knackname":"Wood Excursion"	,"requirement":"Rank 6"	,"restrictions":"Woodsman 6"	,"page":"AJMP"}	]},
      {"talent":"Woodsman","knacks":[ 	{"knackname":"Nordal Defender [Karma]"	,"requirement":"Rank 8"		,"page":"AJMP"}	,
      	{"knackname":"Resp ke Felyat [Karma]"	,"requirement":"Rank 3"		,"page":"AJMP"}	,
      	{"knackname":"Resp ke Lavota [Karma]"	,"requirement":"Rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Resp ke Thiel [Karma]"	,"requirement":"Rank 9, Forest Sense rank 5"		,"page":"AJMP"}	,
      	{"knackname":"Resp ke Vardan [Karma]"	,"requirement":"Rank 6"		,"page":"AJMP"}	,
      	{"knackname":"Restishay [Karma]"	,"requirement":"Rank 4"		,"page":"AJMP"}	,
      	{"knackname":"Wood Elemental Affinity [Karma]"	,"requirement":"Rank 7"		,"page":"AJMP"}	,
      	{"knackname":"Woodsman's Home [Karma]"	,"requirement":"Rank 1"		,"page":"AJMP"}	,
      	{"knackname":"Woodsman's Hunt [Karma]"	,"requirement":"Rank 2"		,"page":"AJMP"}	]},
      {"talent":"Wound Balance","knacks":[ 	{"knackname":"Earth Rise"	,"requirement":"Rank 8, Earth Walk rank 5"	,"restrictions":"Brother of Stone 5"	,"page":"AJMP"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Craft Blood Charm"	,"requirement":"Rank 5"	,"restrictions":"Nethermancer 5"	,"page":"C116"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Craft Common Magic Item"	,"requirement":"Rank 5"	,"restrictions":"Elementalist 4, Wizard 5"	,"page":"C116"}	]},
      {"talent":"Scout Weaving","knacks":[ 	{"knackname":"Craft Poison"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C116"}	]},
      {"talent":"Shamanism","knacks":[ 	{"knackname":"Craft Poison"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C116"}	]},
      {"talent":"Thief Weaving","knacks":[ 	{"knackname":"Craft Poison"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C116"}	]},
      {"talent":"Thread Weaving","knacks":[ 	{"knackname":"Craft Poison"	,"requirement":"Rank 5"	,"restrictions":"Windmaster 5, Woodsman 5"	,"page":"C116"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Craft True Pattern"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C116"}	]},
      {"talent":"Thread Smithing","knacks":[ 	{"knackname":"Craft True Pattern"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C116"}	]},
      {"talent":"Elementalism","knacks":[ 	{"knackname":"Create Orichalcum"	,"requirement":"Rank 10"	,"restrictions":"Elementalist 9, Weaponsmith 10"	,"page":"C117"}	]},
      {"talent":"Thread Smithing","knacks":[ 	{"knackname":"Create Orichalcum"	,"requirement":"Rank 10"	,"restrictions":"Elementalist 9, Weaponsmith 10"	,"page":"C117"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Design Enchanting Pattern"	,"requirement":"Rank 8"		,"page":"C117"}	]},
      {"talent":"Thread Smithing","knacks":[ 	{"knackname":"Design Enchanting Pattern"	,"requirement":"Rank 8"		,"page":"C117"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Handle Elements"	,"requirement":"Rank 5"	,"restrictions":"Elementalist 4, Weaponsmith 5"	,"page":"C117"}	]},
      {"talent":"Thread Smithing","knacks":[ 	{"knackname":"Handle Elements"	,"requirement":"Rank 5"	,"restrictions":"Elementalist 4, Weaponsmith 5"	,"page":"C117"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Incorporate Bound Spirit"	,"requirement":"Rank 6"	,"restrictions":"Elementalist 6, Nethermancer 5"	,"page":"C117"}	]},
      {"talent":"Patterncraft","knacks":[ 	{"knackname":"Incorporate Glyph"	,"requirement":"Rank 5"	,"restrictions":"Any Discipline 5"	,"page":"C117"}	]}
    ];

    var printKnack =function(knack){
      let s="         ";
      if("knackname" in knack ) s+=" KnackName : " + knack.knackname ;
      if("requirement" in knack ) s+="   Requirement : " + knack.requirement;
      if("restriction" in knack ) s+="   Restriction : " + knack.restriction;
      if("page" in knack ) s+="   cf. " + knack.page;
      return s;
    };



    var checkRequirement =function(req,trk ){
      let req2,nork,rk,meet=false;
      if(!req || req.length <=3 ) return true;
      req2=req.toLowerCase().trim();
      nork= isNaN(req2[req2.length-1]);
      rk= nork? 0 : parseInt(req2.substring(req2.length-2).trim()); //Requirement end with a one or 2 digit number, separated by a space
      req2=nork ? req2 : req2.substring(0,req2.length-2).trim();            //Removed the found rank if any
      if(req2=="rank") {
        return ((dflt ? dfltrk : trk)>=rk); //Case of just Rank X, referring directly to the rank of the tested talent
      }
      req2=req2.replace("rank","").trim(); //We have a requirement on another entry to test... we will have to find this entry in chararray
      let filtered = _.where(charray, {name: req2});
      for(let j=0; j<filtered.length;j++){
        let rrk =  ("rank" in filtered[j]) ? parseInt(filtered[j].rank) : 0;
        meet= meet || ( (dflt ? dfltrk : rrk)>=rk  );
      }
      return meet;
    };

    var meetsRequirement =function(req,op,trk ){
      let req2,meet;
      meet = (op=="and"); //When op is and, we test requirement, with "and", if not, we test restrictions with "or"
      if(!req || req.length <=3 ) return true;
      else req2=req.split(",");
      for(let l=0;l<req2.length;l++){
        meet=(op=="and") ? (meet && checkRequirement(req2[l],trk) ) : (meet || checkRequirement(req2[l],trk));
      }
      return meet;
    };


    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
        attarray.push( buildPre( "T", tarray[ i ] ) + "LinkedValue");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
      }
      getSectionIDs("repeating_discipline", function gsIdRepeatingTalents(darray) {
        for( let i = 0; i < darray.length; i++) {
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "PathName");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
        }
        getSectionIDsOrdered("repeating_knacks", function gsIdRepeatingKnack(karray) {
          for( let i = 0; i < karray.length; i++){
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Name");
          }

          getSectionIDsOrdered("repeating_skills", function gsIdRepeatingSkills(skarray) {
            for( let i = 0; i < skarray.length; i++){
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Rank");
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Name");
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Category");
            }

            getSectionIDsOrdered("repeating_language", function gsIdRepeatingLanguage(larray) {
              for( let i = 0; i < larray.length; i++){
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Name");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Speak");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Speak-T");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "ReadWrite");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "ReadWrite-T");
              }
              getAttrs( attarray , function gaTalentSummary(values) {
                'use strict';
                logvalues( values);
                dfltrk=getInt(values,"Knack-Summary-SubRank");
                dflt=(values["Knack-Summary-Param"]==2); //If true, the defltrk will be used to calculated the criterias

                //building the character array with everything that defines the character
                charray.push({"name": values["Race"].toLowerCase()});
                charray.push({"name": "strength", "rank" : getInt(values,"Attrib-Str-Curr")});
                for( let i = 0; i < tarray.length; i++){
                  let rk= ((values[ buildPre( "T", tarray[ i ] ) + "Type"] =="Free") ? values[ buildPre( "T", tarray[ i ] ) + "LinkedValue"] :  values[ buildPre( "T", tarray[ i ] ) + "Rank"])||"0"
                charray.push({ "name": values[buildPre( "T", tarray[ i ] ) + "Name"].toLowerCase()||"" , "rank" : rk });
              }
                maxvalue=0
                for( let i = 0; i < darray.length; i++){
                  pre=buildPre( "DSP", darray[ i ] );
                  charray.push({ "name": values[pre + "Name"].toLowerCase()||"" , "rank" : values[pre + "Circle"]||"0" });
                  if(["0.0","81.0","83.0","89.0","98.5","99.5"].indexOf(values[pre + "Code"])==-1)
                  maxvalue= Math.max(maxvalue,parseInt(values[pre + "Circle"]||"0"));
                }
                charray.push({ "name": "any discipline", "rank" : maxvalue });

                for( let i = 0; i < karray.length; i++)
                charray.push({ "name": values[buildPre( "NAC", karray[ i ] ) + "Name"].toLowerCase()||""});
                maxvalue=0;
                for( let i = 0; i < skarray.length; i++) {
                  pre=buildPre( "SK", skarray[ i ] );
                  let name = values[pre + "Name"]||"";
                  if(values[pre + "Category"] =="Knowledge" && (name.includes("Elven")  || name.includes("Elf"))) name="Elf Lore";
                  if(values[pre + "Category"] =="Knowledge" && name.includes("Obsidi")) name="Obsidiman Lore"; //A bit of extra specificity is needed to help with brother of stones and Woodsmen
                  charray.push({ "name": values[pre + "Name"].toLowerCase()||"" , "rank" : values[pre + "Rank"]||"0" });
                  if(values[pre + "Category"] =="Knowledge")
                  maxvalue= Math.max(maxvalue,parseInt(values[pre + "Rank"]||"0"));
                }
                charray.push({ "name": "knowledge skill" , "rank" : maxvalue });
                for( let i = 0; i < larray.length; i++){
                  pre=buildPre( "SKL", larray[ i ] );
                  let name = values[pre + "Name"]||"";
                  if(name.includes("Elven") || name.includes("Spere") || name.includes("Elf")) name="Elf";
                  if(name.includes("Obsidi")) name="Obsidiman"; //A bit of extra specificity is needed to help with brother of stones and Woodsmen
                  if(values[pre+"Speak"]=="1" || values[pre+"Speak-T"]=="1")
                  charray.push({ "name": "speak "+ name.toLowerCase()||"" });
                  if(values[pre+"ReadWrite"]=="1" || values[pre+"ReadWrite-T"]=="1")
                  charray.push({ "name": "readwrite "+ name.toLowerCase()||"" });
                }
                //end of character array creation

                //Testing all Talents
                for( let i = 0; i < tarray.length; i++){
                  ss="";
                  pre=buildPre( "T", tarray[ i ] );
                  let nm=values[pre+"Name"];
                  let rk=getInt(values,pre+"Rank");
                  filtered = _.where(database, {talent: nm});
                  if((nm!=="Thread Weaving" && nm.includes("Thread Weaving")) ||
                  ["Arrow Weaving","Beast Weaving","Elementalism","Gauntlet Weaving","Illusionism","Nethermancy","Rider Weaving","River Weaving","Scout Weaving","Sea Weaving","Shamanism","Sky Weaving","Story Weaving","Thief Weaving","Thread Smithing","Weapon Weaving","Wizardry"].indexOf(nm)!==-1    )
                  filtered =filtered.concat(_.where(database, {talent: "Thread Weaving"}));
                  if(filtered.length>0){

                    for(let j=0; j<filtered.length;j++){
                      knacklist=filtered[j].knacks;
                      for(let k=0; k<knacklist.length;k++){
                        if(meetsRequirement (knacklist[k].requirement,"and",rk) && ( !("restrictions" in knacklist[k]) || meetsRequirement (knacklist[k].restrictions,"or",rk)))
                        ss+="      "+ printKnack(knacklist[k]) + "\n";
                      }
                    }
                  }
                  if(ss.length>0) s+= "List of Knacks for " + nm +" : \n" +ss;
                }

                //Testing Disciplines, because Path Talents are recorded as DSP
                for( let i = 0; i < darray.length; i++){
                  ss="";
                  pre=buildPre( "DSP", darray[ i ] );
                  let nm=values[pre+"PathName"]||"";
                  let rk=getInt(values,pre+"Circle");
                  log("Testing for " +nm);
                  if(nm!=""){
                    filtered = _.where(database, {talent: nm});
                    //need to join thread weaving too
                    log("filtered "+ JSON.stringify(filtered));
                    if(filtered.length>0){
                      for(let j=0; j<filtered.length;j++){
                        knacklist=filtered[j].knacks;
                        // s+= "    " +JSON.stringify(filtered[j])+" \n";
                        for(let k=0; k<knacklist.length;k++){
                          if(meetsRequirement (knacklist[k].requirement,"and",rk) && ( !("restrictions" in knacklist[k]) || meetsRequirement (knacklist[k].restrictions,"or",rk)))
                          ss+="      "+ printKnack(knacklist[k]) + "\n";
                        }
                      }
                    }
                  }
                  if(ss.length>0) s+= "List of Knacks for " + nm +" : \n" +ss;
                }
                // log("charray "+ JSON.stringify(charray))
                // s+=JSON.stringify(charray);
                vals["Knack-Summary"]=s;
                setAttrsLog(vals);
              });
            });
          });
        });
      });
    });

  } catch(err) {log("Earthdawn:updateKnackSummary() error caught: " + err );}
}; // End updateLPSummary()
on("clicked:knacksummary", fn(updateKnackSummary) );



var AutoFillWeapon = function fnAutoFillWeapon(eventInfo) {
  'use strict';
  try{
  //Start by splitting the eventInfo to find what we are working with
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let code = repeatSection(3,att);
  let rowid = repeatSection(2,att);
  let pre = buildPre(code,rowid);
  getAttrs( [pre+"Name",pre+"Date","Race"], function gaAutoFill(values) {

    function singleAttr( key, val) {
      let vals={};
      vals[ pre + key ] = val;
      setAttrsLog( vals );
    }

    let entry,
    names=[],
    notes="",
    tname;
    let database;
    if(values["edition"]=="-1")
      database=[]; //1879
    else database=[  //ED All editions. Done for ED4, but close enough for other editions
      {names: "Barbed Net"	,dmg:"2"	,str:"9"	,dex:"9"	,size:"3"		,weight:"3"			},
      {names: "Barbed Throwing Net"	,dmg:"2"	,str:"10"	,dex:"9"	,size:"3"	,range:"SR8,LR16"		,weightammo:"2"	,notes:"Entangle on one Extra Success, Entangling Difficulty 12"	},
      {names: "Battle Axe"	,dmg:"7"	,str:"13"		,size:"5"		,weight:"6"			},
      {names: "Blowgun"	,dmg:"1"	,str:"3"		,size:"1"	,range:"SR8,LR16"	,weight:"0.625"	,weightammo:"0.05"		},
      {names: "Bola"	,dmg:"3"	,str:"6"		,size:"2"	,range:"SR12,LR24"		,weightammo:"2"	,notes:"Entangle on one Extra Success, Entangling Difficulty 9"	},
      {names: "Broadsword"	,dmg:"5"	,str:"12"		,size:"3"		,weight:"4"			},
      {names: "Casting Net"		,str:"5"		,size:"2"		,weight:"2"			},
      {names: "Chtard Thorn"	,dmg:"3"	,str:"7"		,size:"1"		,weight:"2"			},
      {names: "Club"	,dmg:"3"	,str:"7"		,size:"2"		,weight:"3"			},
      {names: "Dagger"	,dmg:"2"	,str:"4"		,size:"1"	,range:"SR10,LR20"	,weight:"1"	,weightammo:"1"		},
      {names: "Dart"	,dmg:"1"	,str:"4"		,size:"1"	,range:"SR18,LR36"		,weightammo:"0.5"		},
      {names: "Dwarf Sword"	,dmg:"4"	,str:"12"		,size:"2"		,weight:"2"			},
      {names: "Elven Warbow"	,dmg:"5"	,str:"12"	,dex:"15"	,size:"5"	,range:"SR48,LR96"	,weight:"4"	,weightammo:"0.16"		},
      {names: "Flail"	,dmg:"5"	,str:"10"	,dex:"7"	,size:"3"		,weight:"5"			},
      {names: "Flight Dagger"	,dmg:"2"	,str:"4"		,size:"1"	,range:"SR20,LR40"		,weightammo:"0.75"		},
      {names: "Hand Axe"	,dmg:"4"	,str:"8"		,size:"2"		,weight:"3"			},
      {names: "Hawk Hatchet"	,dmg:"4"	,str:"8"		,size:"3"	,range:"SR24,LR48"		,weightammo:"2"		},
      {names: "Knife"	,dmg:"1"	,str:"3"		,size:"1"	,range:"SR8,LR16"	,weight:"0.625"	,weightammo:"0.625"		},
      {names: "Lance"	,dmg:"6"	,str:"14"		,size:"6"		,weight:"10"			},
      {names: "Light Crossbow"	,dmg:"4"	,str:"9"		,size:"3"	,range:"SR32,LR64"	,weight:"5"	,weightammo:"0.2"		},
      {names: "Long Spear"	,dmg:"5"	,str:"13"		,size:"5"		,weight:"7"			},
      {names: "Longbow"	,dmg:"4"	,str:"11"	,dex:"13"	,size:"5"	,range:"SR40,LR80"	,weight:"4"	,weightammo:"0.15"		},
      {names: "Mace"	,dmg:"4"	,str:"13"		,size:"3"		,weight:"5"			},
      {names: "Medium Crossbow"	,dmg:"5"	,str:"12"		,size:"4"	,range:"SR40,LR80"	,weight:"7"	,weightammo:"0.266666666666667"		},
      {names: "Net, Large"	,dmg:"NA"	,str:"8"		,size:"6"	,range:"SR6,LR12"	,weight:"5"	,weightammo:"5"	,notes:"Entangle on one Extra Success, Entangling Difficulty 12"	},
      {names: "Net, Small"	,dmg:"NA"	,str:"4"		,size:"3"	,range:"SR6,LR12"	,weight:"5"	,weightammo:"5"	,notes:"Entangle on one Extra Success, Entangling Difficulty 12"	},
      {names: "Pole Arm"	,dmg:"7"	,str:"14"		,size:"5"		,weight:"8"			},
      {names: "Pole Axe"	,dmg:"8"	,str:"16"		,size:"6"		,weight:"10"			},
      {names: "Quarterstaff"	,dmg:"4"	,str:"6"	,dex:"7"	,size:"5"		,weight:"4"			},
      {names: "Raid Spear"	,dmg:"7"	,str:"16"		,size:"7"		,weight:"12"			},
      {names: "Sap"	,dmg:"1"	,str:"3"	,dex:"7"	,size:"1"		,weight:"2"			},
      {names: "Scythan Axe"	,dmg:"5"	,str:"12"		,size:"3"		,weight:"3"			},
      {names: "Short Sword"	,dmg:"4"	,str:"8"		,size:"2"		,weight:"4"			},
      {names: "Shortbow"	,dmg:"3"	,str:"8"		,size:"3"		,weight:"3"	,range:"SR30,LR60"	,weightammo:"0.1"		},
      {names: "Sling"	,dmg:"2"	,str:"5"		,size:"2"	,range:"SR20,LR40"	,weight:"1"	,weightammo:"0.5"		},
      {names: "Spear"	,dmg:"4"	,str:"9"		,size:"3"	,range:"SR10,LR20"	,weight:"3"	,weightammo:"3"		},
      {names: "Spiked Mace"	,dmg:"6"	,str:"13"		,size:"4"		,weight:"7"			},
      {names: "Stone Maul"	,dmg:"8"	,str:"21"		,size:"7"		,weight:"13"			},
      {names: "Tail Dancer Blade"	,dmg:"4"	,str:"10"		,size:"2"		,weight:"3"			},
      {names: "Throwing Axe"	,dmg:"3"	,str:"7"		,size:"3"	,range:"SR12,LR24"	,weight:"2"	,weightammo:"2"		},
      {names: "Throwing Dagger"	,dmg:"2"	,str:"4"		,size:"1"	,range:"SR16,LR32"	,weight:"0.75"	,weightammo:"0.75"		},
      {names: "Throwing Net"		,str:"9"		,size:"3"	,range:"SR10,LR20"	,weight:"1"	,weightammo:"1"	,notes:"Entangle on one Extra Success, Entangling Difficulty 12"	},
      {names: "Trispear"	,dmg:"5"	,str:"11"		,size:"4"		,weight:"4"			},
      {names: "Troll Axe"	,dmg:"8"	,str:"17"		,size:"6"		,weight:"8"			},
      {names: "Troll BattleAxe"	,dmg:"8"	,str:"17"		,size:"6"		,weight:"8"			},
      {names: "Troll Bola"	,dmg:"4"	,str:"9"	,dex:"9"	,size:"3"	,range:"SR12,LR24"	,weight:"3"	,weightammo:"3"	,notes:"Entangle on one Extra Success, Entangling Difficulty 9"	},
      {names: "Troll Dagger"	,dmg:"3"	,str:"7"		,size:"2"	,range:"SR10,LR20"	,weight:"2"	,weightammo:"2"		},
      {names: "Troll Flail"	,dmg:"6"	,str:"13"	,dex:"7"	,size:"4"		,weight:"7"			},
      {names: "Troll Mace"	,dmg:"5"	,str:"16"		,size:"4"		,weight:"7"			},
      {names: "Troll PoleAxe"	,dmg:"9"	,str:"19"		,size:"7"		,weight:"13"			},
      {names: "Troll Quarterstaff"	,dmg:"5"	,str:"9"	,dex:"7"	,size:"6"		,weight:"5"			},
      {names: "Troll Sling"	,dmg:"4"	,str:"10"		,size:"4"	,range:"SR30,LR60"	,weight:"4"	,weightammo:"1"		},
      {names: "Troll Spear"	,dmg:"5"	,str:"12"		,size:"4"	,range:"SR10,LR20"	,weight:"4"	,weightammo:"4"		},
      {names: "Troll Sword"	,dmg:"6"	,str:"13"		,size:"4"		,weight:"6"			},
      {names: "Troll Throwing Axe"	,dmg:"4"	,str:"10"		,size:"4"	,range:"SR12,LR24"	,weight:"3"	,weightammo:"3"		},
      {names: "Troll TwoHanded Sword"	,dmg:"9"	,str:"18"		,size:"7"		,weight:"9"			},
      {names: "Troll Warhammer"	,dmg:"8"	,str:"18"		,size:"6"		,weight:"10"			},
      {names: "Two-handed Sword"	,dmg:"8"	,str:"15"		,size:"6"		,weight:"7"			},
      {names: "Warhammer"	,dmg:"7"	,str:"15"		,size:"5"		,weight:"8"			},
      {names: "Whip"	,dmg:"3"	,str:"7"	,dex:"7"	,size:"3"		,weight:"2"		,notes:"Entangle on one Extra Success, Entangling Difficulty 9"	},
      {names: "Windling Bow"	,dmg:"3"	,str:"5"		,size:"2"	,range:"SR24,LR48"	,weight:"0.875"	,weightammo:"0.025"		},
      {names: "Windling Dagger"	,dmg:"1"	,str:"2"		,size:"1"		,weight:"0.125"			},
      {names: "Windling Net"	,dmg:"NA"	,str:"3"		,size:"2"	,range:"SR6,LR12"	,weight:"0.75"	,weightammo:"0.75"		},
      {names: "Windling Polearm"	,dmg:"4"	,str:"7"		,size:"2"		,weight:"2"			},
      {names: "Windling Quarterstaff"	,dmg:"2"	,str:"7"		,size:"2"		,weight:"1"			},
      {names: "Windling Short Sword"	,dmg:"2"	,str:"4"		,size:"1"		,weight:"0.5"			},
      {names: "Windling Spear"	,dmg:"2"	,str:"4"		,size:"1"	,range:"SR8,LR16"	,weight:"0.5"	,weightammo:"0.5"		},
      {names: "Windling Sword"	,dmg:"3"	,str:"6"		,size:"1"		,weight:"1"			},
      {names: "Windling TwoHanded Sword"	,dmg:"4"	,str:"7"		,size:"2"		,weight:"2"			}

        ];

    for(let i=0; i< database.length;i++){
      entry=database[i];
      names=entry.names.toLowerCase().replace(/\s/g, '').split(","); //Array of possible names for the database entry
      tname=values[pre+"Name"].toLowerCase().replace(/\s/g, '');
      if(names.find(element => ((tname == element) )))
      {

        if(entry.dmg)     singleAttr( "Rank",         entry.dmg );
        // if(entry.str)     singleAttr( "Str",         entry.str );
        // if(entry.dex)     singleAttr( "Dex",         entry.dex );
        if(entry.size)     singleAttr( "Size",         entry.size );
        if(entry.range)      singleAttr( "Range",           entry.range );
        if(entry.weight)      singleAttr( "Weight",           entry.weight );
        if(entry.weightammo)      singleAttr( "AmmoWeight",           entry.weightammo );
        singleAttr( "CombatSlot", "1");

        notes=values[pre+"Date"] || "";
        singleAttr( "Date", ((entry.str ? ("Min Str: " + entry.str) : "") + (entry.dex ? ("Min Dex: " + entry.dex): "") + "\n" +
          (notes=="" ? "" : notes + "\n" ) + (entry.notes||"") + "\nAutofilled "));
        log("Earthdawn : Entry " + values[ pre + "Name" ] + " Updated Automatically");
        repRanks( pre+"Rank");
        return;
      }
    }
  });
} catch(err) {log("Earthdawn:AutoFillWeapons() error caught: " + err );}
}; //end AutoFillWeapons()
on("change:repeating_weapons:wpn_name", fn(AutoFillWeapon));



var AutoFillArmor = function fnAutoFillArmor(eventInfo) {
  'use strict';
  try{
  //Start by splitting the eventInfo to find what we are working with
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let pre= (att.toLowerCase()=="shield-name") ? "Shield-" :"Armor-";
  getAttrs( [pre+"Name",pre+"Date","Race"], function gaAutoFill(values) {

    function singleAttr( key, val) {
      let vals={};
      vals[ pre + key ] = val;
      setAttrsLog( vals );
    }

    let entry,
    names=[],
    notes="",
    tname;
    let ratio; //ratio to be applied on the weight according to the race
    switch(values["Race"]){
      case "Windling" : ratio=0.2; break;
      case "Troll":
      case "Obsidiman": ratio=1.25; break;
      case "Tskrang" : ratio= pre=="Armor-" ? 1.1 : 1;
      default : ratio=1;
    }



    let database;
    if(values["edition"]=="-1")
      database=[]; //1879
    else database=[  //ED All editions. Done for ED4, but close enough for other editions
      {names: "Blood Pebble"	,type:"Armor"	,phys:"5"	,myst:"3"	,ip:"1"	,weight:"0"		},
{names: "Chain Mail"	,type:"Armor"	,phys:"7"	,myst:"0"	,ip:"3"	,weight:"40"		},
{names: "Crystal Plate"	,type:"Armor"	,phys:"7"	,myst:"7"	,ip:"5"	,weight:"90"		},
{names: "Crystal Ringlet"	,type:"Armor"	,phys:"4"	,myst:"4"	,ip:"2"	,weight:"45"		},
{names: "Espagra Cloak"	,type:"Armor"	,phys:"3"	,myst:"1"	,ip:"0"	,weight:"10"		},
{names: "Fernweave"	,type:"Armor"	,phys:"2"	,myst:"3"	,ip:"0"	,weight:"15"		},
{names: "Hardened Leather"	,type:"Armor"	,phys:"5"	,myst:"0"	,ip:"1"	,weight:"20"		},
{names: "Hide Armor"	,type:"Armor"	,phys:"5"	,myst:"1"	,ip:"1"	,weight:"25"		},
{names: "Leather"	,type:"Armor"	,phys:"3"	,myst:"0"	,ip:"0"	,weight:"15"		},
{names: "Living Crystal"	,type:"Armor"	,phys:"6"	,myst:"3"	,ip:"2"	,weight:"0"		},
{names: "Obsidiman Skin"	,type:"Armor"	,phys:"3"	,myst:"1"	,ip:"0"	,weight:"20"		},
{names: "Padded Cloth"	,type:"Armor"	,phys:"2"	,myst:"0"	,ip:"0"	,weight:"5"		},
{names: "Padded Leather"	,type:"Armor"	,phys:"4"	,myst:"0"	,ip:"0"	,weight:"20"		},
{names: "Plate Armor"	,type:"Armor"	,phys:"9"	,myst:"0"	,ip:"4"	,weight:"60"		},
{names: "Ring Mail"	,type:"Armor"	,phys:"6"	,myst:"0"	,ip:"2"	,weight:"30"		},
{names: "Wyvern Skin"	,type:"Armor"	,phys:"8"	,myst:"1"	,ip:"3"	,weight:"50"		},
{names: "Bark"	,type:"Armor"	,phys:"3"	,myst:"3"	,ip:"1"	,weight:"20"		},
{names: "CrystalWeave"	,type:"Armor"	,phys:"3"	,myst:"4"	,ip:"1"	,weight:"25"		},
{names: "Stone Disk"	,type:"Armor"	,phys:"6"	,myst:"0"	,ip:"3"	,weight:"60"		},
{names: "Stone Net"	,type:"Armor"	,phys:"7"	,myst:"0"	,ip:"4"	,weight:"80"		},
{names: "Trim Wood"	,type:"Armor"	,phys:"5"	,myst:"0"	,ip:"2"	,weight:"30"		},
{names: "Wood Tile"	,type:"Armor"	,phys:"6"	,myst:"0"	,ip:"3"	,weight:"40"		},
{names: "Living Metal"	,type:"Armor"	,phys:"9"	,myst:"6"	,ip:"2"	,weight:"50"		},
{names: "Oathshar"	,type:"Armor"	,phys:"4"	,myst:"2"	,ip:"1"	,weight:"25"		},
{names: "Body"	,type:"Shield"	,phys:"3"	,myst:"0"	,ip:"2"	,weight:"15"	,shatter:"21"	},
{names: "Buckler"	,type:"Shield"	,phys:"1"	,myst:"0"	,ip:"0"	,weight:"3"	,shatter:"17"	},
{names: "Crystal Buckler"	,type:"Shield"	,phys:"1"	,myst:"1"	,ip:"0"	,weight:"5"	,shatter:"17"	},
{names: "Crystal Raider"	,type:"Shield"	,phys:"2"	,myst:"2"	,ip:"2"	,weight:"15"	,shatter:"18"	},
{names: "Ferndask"	,type:"Shield"	,phys:"1"	,myst:"2"	,ip:"2"	,weight:"5"	,shatter:"16"	},
{names: "Footmans"	,type:"Shield"	,phys:"2"	,myst:"0"	,ip:"1"	,weight:"10"	,shatter:"19"	},
{names: "Riders"	,type:"Shield"	,phys:"2"	,myst:"0"	,ip:"1"	,weight:"8"	,shatter:"19"	}
        ];

    for(let i=0; i< database.length;i++){
      entry=database[i];
      names=entry.names.toLowerCase().replace(/\s/g, '').split(","); //Array of possible names for the database entry
      tname=values[pre+"Name"].toLowerCase().replace(/\s/g, '');
      if(names.find(element => ((tname == element) )) && ((pre=="Shield-" && entry.type=="Shield")||(pre=="Armor-" && entry.type=="Armor")))
      {
        if(tname.search("windling") !==-1 ||tname.search("troll") !==-1) ratio=1; //If the armor or shield was windling/troll sized already don'tchange its weight


        if(entry.phys)     singleAttr( "Phys",         entry.phys );
        if(entry.myst)     singleAttr( "Myst",         entry.myst );
        if(entry.ip)     singleAttr( "IP",         entry.ip );
        if(entry.shatter)      singleAttr( "Shatter",           entry.shatter );
        if(entry.weight)      singleAttr( "Weight",  (ratio*parseInt(entry.weight)) );
        notes=values[pre+"Date"] || "";
        singleAttr( "Date", (notes + "\n"  + (entry.notes||"") + "\n  Autofilled "));
        log("Earthdawn : Entry " + values[ pre + "Name" ] + " Updated Automatically");
        return;
      }
    }
  });
} catch(err) {log("Earthdawn:AutoFillArmor() error caught: " + err );}
}; //end AutoFillArmor()
on("change:shield-name change:armor-name", fn(AutoFillArmor));

//API Watchdog

on("clicked:stop-using-api", fn(function ocStopUsingApi() {
  'use strict';
  setAttrsLog({ "API": "0", "API_max": "0"});
})); //end AutoFillArmor()

</script>
