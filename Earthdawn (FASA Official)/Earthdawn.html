
<!DOCTYPE html>
<meta charset="UTF-8">

<!--
v3.13 released 23 04 23

Character Sheet For Earthdawn Developped by JBF (Discord/Facebook Jiboux Faure) v2.
Largerly using material from the work on the Official FASA version of Chris Dickey
Whenever possible I kept the original comments of Chris, prefixing them with CD to identify pieces of code that were unchanged
Version of my code are prefixed JBF, usually with YYMMDD for me to remember the versioning
Comments JBF@JBF are actions/reminder to myself
Comments JBF@CD are action/reminders to Chris
-->

<!--  Note, this is a generic roll that can be pasted into a macro. Store it here to be handy.
&{template:default} {{name=Misc Roll}} {{Step: [[?{Step|8}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}
-->


<div class="sheet-user-root compendium-drop-target npcs creatures horrors dragons spirits traps">
  <div class="sheet-user-root-in">

              <!-- These are all defined elsewhere, but tested here at the start of the file so that anywhere in the file one can mearly add a HideIfNotHuman tag to any element -->
    <input name="attr_API"              class="sheet-testAPI"         type="hidden" value="0">      <!--For Global testing if API is Active. classes are API and NoAPI-->
    <input name="attr_CreationMode"     class="sheet-testCreation"    type="hidden" value="0">      <!--For Global testing if the creation mode is active. Classes are NotCreation -->
    <input name="attr_edition"          class="sheet-testEdition"     type="hidden" value="4">      <!--For Global testing of the edition. Classes are HideIf1879 sheet-HideIfNot1879 HideIfEdition3 heet-HideIfNotEdition3 HideIfEdition4 HideIfNotEdition4 -->
    <input name="attr_IsPath"           class="sheet-testPath"        type="hidden" value="0">      <!--For Global testing if the character has a Path. Class HideIfNotPath-->
    <input name="attr_IsQuestor"        class="sheet-testQuest"       type="hidden" value="0">      <!--For Global testing if character is a questor. Classes HideIfNotQuest-->
    <input name="attr_NbDisc"           class="sheet-testNbDisc"      type="hidden" value="0">      <!-- NbDisc is Number of Disciplines. Classes .sheet-HideIfZeroDisc .sheet-HideIfOneDisc .sheet-HideIfTwoDisc .sheet-HideIfThreeDisc-->
    <input name="attr_NPC"              class="sheet-testNPC"         type="hidden" value="1">      <!--For Global testing if character is an NPC. classes sheet-HideIfPC sheet-HideIfNotPC-->
    <input name="attr_isNamegiver"      class="sheet-testCreature"    type="hidden" value="1">      <!--For Global testing if characetr is a Namegiver. Classes shee-HideIfCreature sheet-HideIfNotCreature-->
    <input name="attr_Race"             class="sheet-testRace"        type="hidden" value="">       <!--For Global testing if Race is Homebrew. Also tests for Spirits-->
    <input name="attr_Race_max"         class="sheet-testRaceMax"     type="hidden" value="">       <!--For Global testing if Race is Homebrew. Also tests for Spirits-->
    <input name="attr_TailAttack_max"   class="sheet-testTail"        type="hidden" value="0">      <!--For Global testing if Charcater has tail combat-->
    <input name="attr_show_karma_auto"  class="sheet-testKarmaAuto"   type="hidden" value="1">      <!--Global Testing of the Karma mode-->
    <input name="attr_StepDisplayFinal" class="sheet-testStepDisplay" type="hidden" value="1">      <!--Global Testing for Step Display as Final Value or Base-->
    <input name="attr_tab"              class="sheet-tabMain"         type="hidden" value="11">     <!--Global testing of the tab selector-->
    <input name="attr_Karma_max"        class="sheet-testKarma"       type="hidden" value="0">     <!--Global testing of Karma, to hide Karma related stuff if character has no Karma-->

    <div class="sheet-hidden">                           <!-- Use these to store misc stuff that does not logically go anywhere else. -->
      <input name="attr_APIflag" type="hidden" value="">  <!-- Global value defined here, used by this files sheetworkers to pass messages to the API -->
      <input name="attr_SWflag"  type="hidden" value="">  <!-- Global value defined here, used by the API to pass messages to this files sheetworkers -->
      <input name="attr_effectIsAction" type="number">    <!-- Global value that the API will copy into each individual sheet saying whether effect tests are action tests or not. -->
      <input name="attr_CreatureFlags" type="number">     <!-- Convert all the checkboxes above to one handy Earthdawn.flagsCreature bitfield and store it here.  -->
      <input name="attr_pseudoToken" type="text">         <!-- If we can't figure out the token being used, Use this field to store stuff that should by rights be stored with a token  -->
      <input name="Armor-Phys" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->
      <input name="Armor-Myst" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->
      <input name="Armor-IP" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->
      <input name="Shield-Phys" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->
      <input name="Shield-Myst" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->
      <input name="Shield-IP" type="hidden">           <!--The value is not displayed anymore, but is still used as an hidden subtotal-->

    </div>



    <div class="sheet-hidden">
      <!-- COMPENDIUM DROP CATCHERS -->
      <input type="text" name="attr_drop_category" accept="Category">
      <input type="text" name="attr_drop_name" accept="Name">
      <input type="text" name="attr_drop_data" accept="data">
      <input type="text" name="attr_drop_unique_name" accept="uniqueName">
      <input type="text" name="attr_drop_type" accept="Type">
    </div>

    <div class="sheet-drop-message">
      <!-- COMPENDIUM DROP INFO -->
      <b>Dropping entry from Compendium:</b> <br>
      <br>Creatures/Spirits/NPCs/Dragons : Drop directly to the VTT to create new character.
      <br>Discipline : Will update the Discipline (if already exist) or add it.
      <br>Powers : Will update (if name already exists) or create a new Power. Don't forget to update max number of Karma.
      <br>Goods and Services : Will add to the inventory (increase quantity if name already exists). Will also create secondary entries (Weapon, Armor, Blood charm ...etc).
      <br>Magic : Will add Matrix or Thread Items.
      <br>Masks  : Will Apply the Mask.
      <br>Races : Will update the Race.
      <br>Skills : Will update (if name already exists) or create a new Talent. Don't forget to update max number of Karma.
      <br>Spells : Will update (if name already exists) or create a new Spell.
      <br>Talents : Will update (if name already exists) or create a new Talent. Don't forget to update Origin, and max number of Karma.
      <br>Weapon : Will create a new Weapon (if Weapon is both Melee and Range, will create both). Don't forget to update max number of Karma.
    </div>


    <!--***********************************Start of Header***************************-->

    <div class="sheet-header-flex-container sheet-ShowIfObject">
      <div class="sheet-flex-container sheet-w100p sheet-ShowIfObject">
        <div style="display:flex;" class="sheet-header-name sheet-ShowIfObject">
        <!--Header - Karma Box Creation-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame sheet-Creation">
          <div class="sheet-headerbar">
            Karma
          </div>
          <div class="sheet-flex-container" >
              <div style="width:90px;" class="sheet-Creation">
              <div class="sheet-imgbox sheet-icon-karma-background sheet-Creation" >
                <div class="sheet-imgbox-content">
                  <div class="sheet-nowrap">
                  <span class="sheet-label"> Max:
                  <input name="attr_Karma_max" value="0" min="0" class="sheet-Big sheet-HideSpinners sheet-LockIfNotCreature" type="number" title="@{Karma_max}:   Maximum Karma. It is your races karma modifier times your circle, plus any leftover Attribute points from character creation.">
                  </span>
                </div>
                  <div class="sheet-nowrap">
                  <span class="sheet-label"> Step:
                    <select name="attr_KarmaStep" class="sheet-selLong sheet-LockIfNotCreature" title="@{KarmaStep}   What karma dice does this character roll">
                      <option value="3" title="D4 - Step 3.">S3: D4</option>
                      <option value="4" selected="selected" title="D6 - Step 4. Standard.">S4:  D6</option>
                      <option value="5" title="D8 - Step 5.">S5: D8</option>
                      <option value="6" title="D10 - Step 6.">S6: D10</option>
                      <option value="7" title="D12 - Step 7.">S7: D12</option>
                      <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                      <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                      <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                      <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                      <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                      <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                      <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                      <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                      <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                      <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                      <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                      <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                      <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                    </select>
                    </span>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
        <!--End of Karma Box creation-->


        <!--Header - Karma Box NotCreation-->
        <input type="hidden" name="attr_KarmaRitual-Rank" value="0"><!-- This is only used for the NewDay button if the Karma Ritual mode is used-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame sheet-NotCreation sheet-HideIfNoKarma">
          <div class="sheet-headerbar">
            <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont sheet-button-nodice" name="roll_KarmaOnlyNoAPI" type="roll"
            value="@{RollType} &amp;{template:default} {{name=Karma Only}} {{Step: [[@{KarmaStep}]]}} {{Result: [[ [[floor({@{KarmaStep}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{@{KarmaStep}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((@{KarmaStep}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{@{KarmaStep}, 0}kh1]] ]]d4! - [[{1, 2}=[[{@{KarmaStep}, 0}kh1]] * (3 - [[{@{KarmaStep}, 0}kh1]])]] ]]}}"
            title="%{selected|KarmaOnlyNoAPI}   Roll a single Karma Die only." > &nbsp;Karma</button>

            <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont sheet-button-nodice" name="roll_KarmaOnly"
            type="roll"
            value="!Earthdawn~ charID: @{character_id}~ Reason: 1 Karma Only~ foreach~ Karma: 1~ Roll: 0"
            title="%{selected|KarmaOnly}   Roll a single Karma Die only.">&nbsp;Karma</button>

            <!-- <label title="@{show-karma-parameters}   Parametrize the way Karma behaves" >
              <input type="checkbox" name="attr_show-karma-parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white sheet-iconpaddedright" ></span>
            </label> -->
          </div>

          <div class="sheet-flex-container" >
            <div style="max-width:50px;">
              <div class="sheet-imgbox sheet-icon-karma-background" >
                <div class="sheet-imgbox-content">
                  <input name="attr_Karma" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Karma}:   How many karma points the character currently has left unspent.">
                </div>
                <div class="sheet-undernumber">
                  <span class="sheet-label-flex"> / </span>
                  <input name="attr_Karma_max"
                  value="0" min="0" readonly="readonly"       class="sheet-numShorter sheet-small"
                  title="@{Karma_max}:   Maximum Karma. It is your races karma modifier times your circle, plus any leftover Attribute points from character creation."
                  type="number">
                  <input name="attr_Karma_Modifier"  type="hidden">
                </div>
              </div>
            </div>
            <div style="max-width:32px;" class="sheet-api">
              <!--KarmaGlobalMode controls (with API) how Karma is spent on rolls. When KarmaGlobalMode is in Auto, every roll will automatically spend Karma as per its local Karma selector stored in XXX_Karma
              When KarmaGlobalMode is Ask, a pop up window will ask how many Karma to add to the Roll up to XXX_Karma-Limit_max-->
              <label style="padding-top:0px;margin-top:-4px;" title="@{KarmaGlobalMode} ASK : Toggle Karma Ask mode, where on every Test where Karma can be used, a prompt will ask for number of Karma Points">
                <input type="checkbox" name="attr_KarmaGlobalMode" value="?" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-karma-ask"></span>
              </label>
              <br>
              <input type="checkbox" name="attr_show_karma_auto" value="1" class="sheet-testCloseChecked" hidden>
              <label class="sheet-HideIfNotCloseChecked" title="@{KarmaGlobalMode} AUTO :Toggle Automatic Use of Karma on all Tests Parametrized for Auto-Karma">
                <input type="checkbox" name="attr_KarmaGlobalMode" value="x" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-karma-on"></span>
              </label>
            </div>
          </div>
        </div>
        <!--End of Karma Box-->

        <!--Header - Devotion Box-->
        <div class="sheet-header-box sheet-HideIfNotQuest sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
            <button class="sheet-text-button-header ui-draggable sheet-api sheet-button-nodice sheet-fancyfont"
                name="roll_DevotionOnly"
                type="roll"
                value="!Earthdawn~ charID: @{character_id}~ Reason: 1 Devotion Point Only~ foreach~ DP: 1~ Roll: 0"
            title="%{selected|DevotionOnly}   Roll a single Devotion Point Die only.">&nbsp;Devotion</button>

            <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_DevotionOnlyNoAPI"
                type="roll"
                value="@{RollType} &amp;{template:default} {{name=Dev Pnt only}} {{Step: [[@{DevotionStep}]]}} {{Result: [[ [[floor({@{DevotionStep}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{@{DevotionStep}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((@{DevotionStep}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{@{DevotionStep}, 0}kh1]] ]]d4! - [[{1, 2}=[[{@{DevotionStep}, 0}kh1]] * (3 - [[{@{DevotionStep}, 0}kh1]])]] ]]}}"
            title="%{selected|DevotionOnlyNoAPI}   Roll a single Devotion Point Die only.">&nbsp;Devotion</button>
            <!-- <label title="@{show-DP-parameters}   Parametrize the way devotion behaves" >
              <input type="checkbox" name="attr_show-DP-parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white sheet-iconpaddedright"></span>
            </label> -->
          </div>

          <div class="sheet-flex-container">
            <div style="max-width:50px;">
              <div class="sheet-imgbox sheet-icon-devotion-background" >
                <div class="sheet-imgbox-content">
                  <input name="attr_DP" value="0" min="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{DP}:   How many DP (Questor Devotion Points) the character currently has left unspent.">
                </div>
                <div class="sheet-undernumber" title="@{DP_max}:   Maximum DP (Devotion Points). It is 10 times you Questor Rank. Questor Rank is recorded under 'Circle' in Discipline/Questor.">
                  <span class="sheet-label-flex"> / </span>
                  <input name="attr_DP_max"
                      value="0"
                      min="0"
                      readonly="readonly"
                      class="sheet-numShorter sheet-small"
                  type="number">
                </div>
              </div>
            </div>
            <div style="max-width:32px;" class="sheet-api">
              <label title="@{DPGlobalMode} ASK:  Toggle Devotion Points use to Ask mode, where on every Test where DP can be used, a prompt will ask for number of DP">
                <input type="checkbox" name="attr_DPGlobalMode" value="?" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-devotion-ask"></span>
              </label>
              <br>
              <input type="checkbox" name="attr_show_karma_auto" value="1" class="sheet-testCloseChecked" hidden>
              <label class="sheet-HideIfNotCloseChecked" title="@{DPGlobalMode} AUTO :  Toggle Automatic Use of Devotion Points on all Tests Parametrized for Auto-DP">
                <input type="checkbox" name="attr_DPGlobalMode" value="x" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-devotion-on"></span>
              </label>
            </div>
            <!-- <input type="checkbox" name="attr_show-DP-parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked sheet-small" style="flex:1;">
              <div>
                Max-Adj:
                <input name="attr_Misc-DP_max-Adjust" type="number" value="0" class="sheet-numShort sheet-small" title="@{Misc-DP_max-Adjust}:   Adjustment to Devotion Max.">
              </div>
              <div>

                <select name="attr_DevotionStep" class="sheet-small" style="width:5.5em;" title="@{DevotionStep}   What devotion dice does this character roll">
                  <option value="3" selected="selected" title="D4 - Step 3.">S3: D4</option>
                  <option value="4" title="D6 - Step 4.">S4:  D6</option>
                  <option value="5" title="D8 - Step 5.">S5: D8</option>
                  <option value="6" title="D10 - Step 6.">S6: D10</option>
                  <option value="7" title="D12 - Step 7.">S7: D12</option>
                  <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                  <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                  <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                  <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                  <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                  <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                  <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                  <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                  <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                  <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                  <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                  <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                  <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                </select>
              </div>
            </div> -->
          </div>
        </div>
        <!--End of Devotion Box-->

        <!--Header - Recovery Box-->
        <div>
          <div class="sheet-header-box sheet-background-frame6 sheet-frame">
            <div class="sheet-headerbar">
              <div class=" sheet-Creation sheet-headerbar" style="font-size:130%;"> Recovery t. </div>
              <button class="sheet-NotCreation sheet-text-button-header sheet-api sheet-fancyfont sheet-button-nodice"
                  name="roll_Recovery"
                  type="roll"
                  value="!Earthdawn~ charID: @{character_id}~  foreach~ mod: -?{How many Wounds not treated by Physician|@{Wounds}} ~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Recovery-Karma-Ask}: @{DPGlobalMode}@{Recovery-DP-Ask} ~Value: Recovery-Step  ~ Roll "
              title="%{selected|Recovery} Roll a Recovery Test for this Character.">  Rec: <input name="attr_Recovery-Step" class="sheet-numShorter" type="number" value="5" style="color:white; height: 16px; margin:0px;" readonly title="@{Recovery-Step}  Recovery Step." ></button>

              <button class="sheet-NotCreation sheet-text-button-header sheet-NoAPI sheet-fancyfont sheet-button-nodice" name="roll_Recovery-NoAPI" type="roll"
                  value="@{RollType} &amp;{template:default} {{name=Recovery Test}} {{Step: [[?{Step|@{Recovery-Step}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] -@{Wounds} ]]}}"
                  title="%{selected|Recovery-NoAPI} Roll a Recovery Test for this Character.">Rec:
                  <input name="attr_Recovery-Step" class="sheet-numShorter" style="color:white; height: 16px; margin:0px;"
                  type="number" value="5" readonly title="@{Recovery-Step}  Recovery Step."></button>
            </div>

            <div class="sheet-flex-container">
              <div class="sheet-flex1">
                <div class="sheet-imgbox sheet-icon-recovery-background" >
                  <div class="sheet-imgbox-content">
                    <input name="attr_Recovery-Tests" value="0" min="0" class="sheet-NotCreation sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Recovery-Tests}:   Number of Remaining Recovery Tests for today.">
                    <input name="attr_Recovery-Tests_max" value="0" min="0" class="sheet-Creation sheet-LockIfNotCreature sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Recovery-Tests_max}  Number of Recovery Tests that can be used per day.">

                  </div>
                  <div class="sheet-undernumber sheet-NotCreation">
                    <span class="sheet-label-flex"> /</span>
                    <input name="attr_Recovery-Tests_max" readonly="readonly" value="0"
                        class="sheet-numShorter sheet-small"
                        title="@{Recovery-Tests_max}  Number of Recovery Tests that can be used per day."
                        type="number">
                        <!--Init set to 0 so that it actually initializes with updateHealth-->
                  </div>
                </div>
              </div>
              <div class="sheet-flex1 sheet-NotCreation">
                <!--JBF Karma Toggle-Simple-->
                <input type="checkbox" name="attr_Recovery-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                  <input type="hidden" name="attr_Recovery-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Recovery-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Recovery-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On" >
                        <input type="checkbox" name="attr_Recovery-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Recovery-Karma} : Number of Karma Points to be spent when Karma is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Recovery-Karma} Don't Spend any Karma when Karma is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                        </span>
                        <input type="hidden" name="attr_Recovery-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                        <input type="hidden" name="attr_Recovery-Karma-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Recovery-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Recovery-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                        <select name="attr_Recovery-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Recovery-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Recovery-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Recovery-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>

                      </span>
                    </span>
                  </span>
                </span>
                <!--JBF End Of Karma Toggle-Simple-->
                <br>
                <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                <span class="sheet-DP-ControlBox">
                  <input type="hidden" name="attr_Recovery-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Recovery-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Recovery-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Recovery-DP}   Automatically Spends One Devotion when Devotion is On" >
                        <input type="checkbox" name="attr_Recovery-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Recovery-DP} : Number of Devotion Points to be spent when Devotion is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Recovery-DP} Don't Spend any Dp when Dp is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Recovery-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On"></span>
                        </span>
                        <input type="hidden" name="attr_Recovery-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                        <input type="hidden" name="attr_Recovery-DP-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Recovery-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Recovery-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                        <select name="attr_Recovery-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Recovery-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Recovery-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Recovery-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>
                <!--JBF End Of DP Toggle-->
              </div>
            </div>
          </div>
        </div>
        <!--JBF End of Recovery Box-->

        <!--Header - Wounds Box-->
        <div class="sheet-header-box sheet-background-frame6 sheet-frame">
          <div>
            <div class="sheet-Creation sheet-headerbar" style="font-size:130%;"> Wound Tr. </div>
            <div class="sheet-NotCreation sheet-headerbar" style="font-size:130%;"> Wounds </div>
          </div>
          <div class="sheet-imgbox sheet-icon-wounds-background" >
            <div class="sheet-imgbox-content">
              <input name="attr_Wounds" value="0" min="0" class="sheet-NotCreation sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Wounds}:  Number of Wounds character currently has.">
              <input name="attr_Wound-Threshold" value="0" min="0" class="sheet-Creation sheet-LockIfNotCreature sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test.">

              <input name="attr_Wounds_max" type="hidden" value="8" title="@{Wounds_max}:  Made up number to give something for the Wounds bar (bar2) to measure against."
              type="number">
            </div>
            <div class="sheet-undernumber sheet-NotCreation">
              <span class="sheet-label-flex">Tr: </span>  <input name="attr_Wound-Threshold" readonly="readonly" value="7" class="sheet-numShorter sheet-small"
              title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test."
              type="number">
            </div>
          </div>
        </div>
        <!--JBF End of Wounds Box-->


        <!--Header - Wounds Treshold Box-->
        <input type="checkbox" name="attr_show_wound_treshold" class="sheet-hidden sheet-testCloseChecked" value="1">
        <div class="sheet-header-box sheet-background-frame6 sheet-frame sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar" style="font-size:130%;"> Wnd Tres </div>
            <div class="sheet-imgbox-content">
              <span class="sheet-stepSpan sheet-bordered-bottom">
                <input name="attr_Wound-Threshold" readonly class="sheet-Bigger sheet-numHighlight sheet-StepBig sheet-StepBase" value="7" type="number" title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test.">
                <input name="attr_Wound-Threshold" readonly class="sheet-Bigger sheet-numHighlight sheet-StepBig sheet-StepTotal" value="7" type="number" title="@{Wound-Threshold}:  If take this much damage in one attack, take a wound. If take 5 more damage than this in one attack, make a knockdown test."  >
                <span title="@{Misc_Wound_Threshold-Buff}:  Manual modifications to Wound Treshold.">
                  <input name="attr_Wound-Threshold-Buff" type="hidden" class="sheet-redGreen" value="0">
                  <b class="sheet-buffSignRight sheet-buffSmall" style="margin-left:-12px;">+</b>
                  <input name="attr_Wound-Threshold-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                </span>
              </span>
          </div>
        </div>
        <!--JBF End of Wounds Treshold Box-->


        <!--Header - Damage Box-->
        <!--Shown for Objects, but not the Unc Rating-->
        <div class="sheet-NotCreation sheet-header-box sheet-background-frame6 sheet-frame sheet-ShowIfObject">
          <div class="sheet-headerbar sheet-ShowIfObject">
            <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Take-Damage" type="roll"
            title="%{selected|Take-Damage} Apply Damage to this Character."
            value="!Earthdawn~ charID: @{character_id}~ ForEach~ Damage : ?{Damage to be applied : |1} : ?{Armor| Physical,PA| Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat| None,NA} : ?{Apply Damage - Type of damage |Damage|Stun|Strain}" >Damage</button>
            <span class="sheet-headerbar sheet-NoAPI sheet-fancyfont" style="font-size:130%;"> Damage </span>
          </div>
          <div class="sheet-flex-container sheet-ShowIfObject" >
            <div style="flex:1;" class="sheet-text-center">
              <span class="sheet-icon-stun sheet-iconstaticsmall"></span>
              <br>
              <input name="attr_Damage-Unc-Rating" readonly="readonly" value="20"
              class="sheet-numShorter sheet-small"
              title="@{Damage-Unc-Rating}:   Unconscious Rating. If take more damage (Stun or Normal) than this, character is unconscious."
              type="number">
            </div>
            <div class="sheet-imgbox sheet-icon-damage-background sheet-ShowIfObject" >
              <div class="sheet-imgbox-content sheet-ShowIfObject">
                <input name="attr_Damage" value="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Damage}   Number of points of regular damage this character has taken.">
              </div>
            </div>
            <div class="sheet-text-center sheet-ShowIfObject" style="flex:1;">
              <span class="sheet-icon-death sheet-iconstaticsmall"></span>
              <br>
              <input name="attr_Damage-Death-Rating" readonly="readonly" value="25"
              class="sheet-numShorter sheet-small"
              title="@{Damage-Death-Rating}:   Death Rating. If take more (non-stun) damage than this, character dies."
              type="number">
            </div>
          </div>
        </div>
        <!--JBF End Damage Box-->


        <!--Header - Damage Creation Box-->
        <!--Shown for Objects but not the Unc Rating-->
        <div class="sheet-Creation sheet-header-box sheet-background-frame6 sheet-frame sheet-ShowIfObject">
          <div class="sheet-headerbar sheet-fancyfont sheet-ShowIfObject" style="font-size:130%;">  Health Rating</div>
          <div class="sheet-flex-container sheet-ShowIfObject" >

            <div class="sheet-imgbox sheet-icon-damage-background sheet-ShowIfObject" >
              <div class="sheet-imgbox-content sheet-ShowIfObject">
                <div class="sheet-text-center sheet-nowrap">
                  <span class="sheet-icon-stun sheet-iconstaticsmall"></span> :
                  <input name="attr_Damage-Unc-Rating" value="20"
                  class="sheet-numShort sheet-LockIfNotCreature sheet-HideSpinners "
                  title="@{Damage-Unc-Rating}:   Unconscious Rating. If take more damage (Stun or Normal) than this, character is unconscious."
                  type="number">
                </div>
                <div class="sheet-text-center sheet-nowrap sheet-ShowIfObject">
                  <span class="sheet-icon-death sheet-iconstaticsmall"></span> :
                  <input name="attr_Damage-Death-Rating" value="25"
                  class="sheet-numShort sheet-LockIfNotCreature sheet-HideSpinners "
                  title="@{Damage-Death-Rating}:   Death Rating. If take more (non-stun) damage than this, character dies."
                  type="number">
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--JBF End Damage Creation Box-->



        <!--Header - Stun Box-->
        <input type="checkbox" name="attr_show_damage_stun" hidden value="1" class="sheet-testCloseChecked">
        <div class="sheet-header-box sheet-HideIfNotCloseChecked sheet-background-frame6 sheet-frame">
          <div class="sheet-headerbar">
          <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Take-Damage-Stun" type="roll"
          title="%{selected|Take-Damage-Stun} Apply Damage to this Character."
          value="!Earthdawn~ charID: @{character_id}~ ForEach~ Damage : ?{Damage to be applied : |1} : ?{Armor| Physical,PA| Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat| None,NA} : Stun" >Stun</button>
          <span class="sheet-headerbar sheet-NoAPI sheet-fancyfont" style="font-size:130%;"> Stun </span></div>
          <div class="sheet-imgbox sheet-icon-stun-background" >
            <div class="sheet-imgbox-content">
              <input name="attr_Damage-Stun" value="0" class="sheet-Bigger sheet-HideSpinners sheet-numHighlight" type="number" title="@{Damage-Stun}   Number of points of Stun damage this character has taken.">
              <br>
              <button class="sheet-text-button sheet-api sheet-fancyfont sheet-button-nodice"
              name="roll_RecoveryStun"
              type="roll"
              value="!Earthdawn~ charID: @{character_id}~  foreach~ mod: -?{Stun Damage Recovery Test - How many Wounds not treated by Physician|@{Wounds}} ~modValue : ?{Modification|0}  ~ K-ask: @{KarmaGlobalMode}@{Recovery-Karma-Ask}: @{DPGlobalMode}@{Recovery-DP-Ask}~ Value: Recovery-Step: Wil-Step~  Roll "
              title="%{selected|RecoveryStun} Roll a Recovery Test for this Character that heals Stun damage only.">
              <span class="sheet-iconstatic sheet-icon-recovery"></span>  </button>
              <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_RecoveryStun-NoAPI"
              type="roll"
              value="@{RollType} &amp;{template:default} {{name=Recovery Test}} {{Step: [[?{Step|@{Recovery-Step}+@{Wil-Step}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] -@{Wounds} ]]}}"
              title="%{selected|RecoveryStun-NoAPI} Roll a Recovery Test for this Character that heals Stun damage only."><span class="sheet-iconstatic sheet-icon-recovery"></span>  </button>
            </div>
          </div>
        </div>
        <!--JBF End of Stun Box-->
      </div>
        <!--JBF Logo-->
        <div class="sheet-header-logo-Earthdawn sheet-HideIf1879 sheet-ShowIfObject"></div>
        <div class="sheet-header-logo-1879 sheet-HideIfNot1879 sheet-ShowIfObject"></div>

        <!--JBF Header Name Box-->
        <div class="sheet-header-name sheet-background-frame6 sheet-frame sheet-ShowIfObject" style="padding-left:15px; padding-right: 15px;">
          <div class="sheet-floatRight sheet-HideIfPrint sheet-ShowIfObject">
            <input type="checkbox" name="attr_char_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
            <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_char_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>

            <!-- <label title="@{StepDisplayFinal} Parameter to decide between displaying the Base Value (without modifiers) or Final Value (after all Modifiers) in each of the steps. If Checked displays the Final Step">
              <input type="checkbox" name="attr_StepDisplayFinal" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-sum"></span>
            </label> -->
            <span class="sheet-label-flex sheet-api">API</span>
            <span class="sheet-label-flex sheet-NoAPI">NoAPI</span>

            <button class="sheet-text-button sheet-button-nodice" name="roll_Standard-Step-Roll" type="roll"
            title="%{Standard-Step-Roll}   Just click this button to enter a step and roll it... As easy as this."
            value="@{RollType} &{template:default} {{header=@{charName}: Roll }}  {{Step=[[?{Step|0}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
            <span class="sheet-iconstatic sheet-icon-dice"></span></button>

            <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-NoAPI sheet-HideIfObject" name="act_newday" type="action"
            title="act_newday:   Clicking this button will set characters recovery tests to max and perform karma ritual.">
            <span class="sheet-iconstatic sheet-icon-newday"></span> </button>

            <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-api sheet-HideIfObject" name="button_NewDay" type="roll"
            value="!Earthdawn~ charID: @{character_id}~ ForEach: c~ Misc: NewDay"
            title="button_NewDay:   Clicking this button will set characters recovery to max and perform karma ritual.">
            <span class="sheet-iconstatic sheet-icon-newday"></span> </button>

            <button class="sheet-button-nodice sheet-api sheet-helpbutton" name="button_WikiHelp_API"
            type="roll"
            value="!Earthdawn~ ChatMenu: Help"
            title="button_WikiHelp_API:   Click this button to open this character sheets Wiki Documentation in another tab.">
            <span class="sheet-helpbutton">?</span></button>

            <button class="sheet-button-nodice sheet-NoAPI sheet-helpbutton"
            name="button_WikiHelp_NoAPI"
            type="roll"
            value="For help look in https://wiki.roll20.net/Earthdawn_-_FASA_Official"
            title="button_WikiHelp_NoAPI:   This sheets Wiki Documentation is at https://wiki.roll20.net/Earthdawn_-_FASA_Official.">
            <span class="sheet-helpbutton">?</span> </button>
          </div>

          <div class="sheet-floatRight sheet-HideIfPrint sheet-ShowIfObject">

            <span class="sheet-nowrap0" title="@{RollType}   Should rolls made from this sheet be public, gm, or hidden?">
              <!-- <span class="sheet-iconstatic sheet-icon-dice"></span>: -->
              <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
              <span class="sheet-iconselect-span">
                <span class="sheet-iconselect-icon">
                  <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                  <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                </span>
                <select name="attr_RollType" class="sheet-api sheet-text-center sheet-iconselect-select sheet-w25px">
                  <option value=" " selected  title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                  <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                  <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                  <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                  title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                </select>
                <select name="attr_RollType" class="sheet-NoAPI sheet-iconselect-select sheet-w25px">
                  <option value=" " selected title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                  <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                  <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                  title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                </select>
              </span>
            </span>

            <button class="sheet-text-button sheet-api sheet-button-nodice sheet-HideIfObject"  type="roll"
            value="!Earthdawn~ charID: @{character_id}~  TargetNum: ?{Knockdown Test, Difficulty Number|6}: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Knockdown: Adjust-Effect-Tests-Total: Defensive~ Roll"
            title="%{selected|Knockdown} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-HideIfObject"  type="roll"
            value="@{RollType} &amp;{template:default} {{name=Knockdown Test}} {{Step: [[?{Step|@{Knockdown}+@{Adjust-Effect-Tests-Total}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
            title="%{selected|Knockdown-CheckNoAPI} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span></button>

            <button class="sheet-text-button sheet-api sheet-button-nodice sheet-HideIfObject"  type="roll"
                title="%{JumpUp}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: 6: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Strain: 2~ calculateValue: JumpUp~ Roll">
            <span class="sheet-iconstatic sheet-icon-jumpup"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-HideIfObject"  type="roll"
                title="%{JumpUp-NoAPI}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="@{RollType} &{template:rolltargetnumber} {{header=@{charName}: Jump Up}} {{target_number=[[6]]}} {{Step=[[?{Step|@{Dex}+(@{condition-KnockedDown}*3) +@{Jumpup-Adjust} -@{IP}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
            <span class="sheet-iconstatic sheet-icon-jumpup"></span></button>

            <button class="sheet-text-button sheet-api sheet-button-nodice"  type="roll" title="%{selected|Dex-Initiative-Check} Click to Roll Initiative. It is important that you select your token"
                value="!Earthdawn~ charID: @{character_id}~ foreach~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Initiative-Karma-Ask}: @{DPGlobalMode}@{Initiative-DP-Ask}~ Value : Initiative~ Init">
            <span class="sheet-iconstatic sheet-icon-initiative"></span></button>

            <button class="sheet-text-button sheet-NoAPI sheet-button-nodice"  type="roll" title="%{selected|Dex-Initiative-CheckNoAPI} Click to Roll Initiative. It is important that you select your token" value="@{RollType} &amp;{template:default} {{name=Initiative}} {{Step: [[?{Step|@{Initiative}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] &amp;{tracker}]]}}"><span class="sheet-iconstatic sheet-icon-initiative"></span>  </button>
          </div>



          <div title="@{charName}   Name of character." style="overflow:hidden;" class="sheet-ShowIfObject">
            <span class="sheet-autoexpand-wrap sheet-bordered-bottom sheet-autoexpand-min">
              <input name="attr_charName"
              placeholder="Character Name"
              type="text"
              class="sheet-text-left sheet-Big sheet-fancyfont">
              <span name="attr_charName" class="sheet-autoexpand sheet-autoexpand-min sheet-Big">
              </span>
            </span>


          </div>

          <div class="sheet-nowrap" style="overflow:hidden;" class="sheet-ShowIfObject">
            <span class="sheet-autoexpand-wrap sheet-autoexpand-min" title="@{player-name}   Name of player whose character this is.">
              <input name="attr_player-name" class="sheet-text-left sheet-fancyfont sheet-bordered-bottom"
              placeholder="Player Name or Tagline"
              type="text">
              <span name="attr_player-name" class="sheet-autoexpand sheet-autoexpand-min">
              </span>
            </span>
          </div>
        </div>    <!--End of Header-Name-->
      </div>    <!-- end sheet-flex-container -->

      <!--Header -  Start of Status and Combat Option Icons-->
      <input type="checkbox" name="attr_show_options_status" value="1" class="sheet-hidden sheet-testChecked">
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
          <input type="checkbox" name="attr_combatOption-AggressiveAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-aggressive"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384)">
          <input type="checkbox" name="attr_combatOption-DefensiveStance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-defensive"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-CalledShot}   Take one Strain and -3 penalty to Attack test; if successful, attack hits designated area.">
          <input type="checkbox" name="attr_combatOption-CalledShot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-calledshot"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{combatOption-SplitMovement}   Take 1 Strain and be Harried to attack during movement. (PG p.386)">
          <input type="checkbox" name="attr_combatOption-SplitMovement" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-split"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{combatOption-Reserved}   +2 to all Target Numbers. Specify an event to interrupt. (PG p.376)">
          <input type="checkbox" name="attr_combatOption-Reserved" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-reserved"></span>
        </label>
        <label class="sheet-iconlabel2 sheet-HideIfNotTail" title="@{combatOption-TailAttack}   T'skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
          <input type="checkbox" name="attr_combatOption-TailAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-tail"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Blindsiding" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-blindsiding"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-TargetPartialCover}   Target has +2 Bonus to Physical and Mystic defenses due to cover from this attacker. (PG p.386)">
          <input type="checkbox" name="attr_condition-TargetPartialCover" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-partialcover"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
          <input type="checkbox" name="attr_condition-KnockedDown" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-knockeddown"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
          <input type="checkbox" name="attr_condition-Harried" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmed : -3 Penalty to all tests and to Physical and Mystic defenses due to 2 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="3" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried3"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmedx2 : -4 Penalty to all tests and to Physical and Mystic defenses due to 3 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried4"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Overwhelmedx3 : -5 Penalty to all tests and to Physical and Mystic defenses due to 4 harrying effects.">
          <input type="checkbox" name="attr_condition-Harried" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-harried5"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-blindsided"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
          <input type="checkbox" name="attr_condition-Surprised" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-surprised"></span>
        </label>
        <!-- <label class="sheet-iconlabel2" title="@{condition-NoShield}   Am not using shield at present. Forgo benefits and IP.">
          <input type="checkbox" name="attr_condition-NoShield" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-noshield"></span>
        </label> -->
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
          <input type="checkbox" name="attr_condition-ImpairedMovement" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-impaired"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Heavy Impaired Movement : -10 to Movement Rate (1 min). -4 Penalty to movement based texts due to footing, cramping, or vision impairments. Dex test to avoid tripping or halting.">
          <input type="checkbox" name="attr_condition-ImpairedMovement" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-impaired4"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
          <input type="checkbox" name="attr_condition-Flying" value="-1" class="sheet-iconcheckbox" checked> <span class="sheet-iconlabel-header-invert sheet-icon-flying"></span>
        </label>
        <!-- <label class="sheet-iconlabel2" title="@{attr_condition-Entangled-Grappled} Character is Entangled or Grappled.  This condition is for information only and has no sheet effect. (PG p.391)">
        <input type="checkbox" name="attr_condition-Entangled-Grappled" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-entangled"></span>  </label> -->
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-RangeLong}   -2 Penalty to Attack and Damage Tests. (PG p.389)">
          <input type="checkbox" name="attr_condition-RangeLong" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-rangelong"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Cover} Partial Cover : +2 Bonus to Physical and Mystical defenses. (PG p.386)">
          <input type="checkbox" name="attr_condition-Cover" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-cover"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{attr_condition-Cover} Full Cover : Can not be targeted by Physical or Mystic attacks.">
          <input type="checkbox" name="attr_condition-Cover" value="99" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-cover99"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
          <input type="checkbox" name="attr_condition-Health" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-stun"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
          <input type="checkbox" name="attr_condition-Health" value="-5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-death"></span>
        </label>
        <!-- <label class="sheet-iconlabel2" title="@{condition-Poisoned}  Character is Poisoned.  This condition is for information only and has no sheet effect.">
        <input type="checkbox" name="attr_condition-Poisoned" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header-invert sheet-icon-poisoned"></span>  </label> -->
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 1.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain1"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 2.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain2"></span>
        </label>
        <label class="sheet-iconlabel2" title="@{Misc-StrainPerTurn}: Set to 3.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
          <input type="checkbox" name="attr_Misc-StrainPerTurn" value="3" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-strain3"></span>
        </label>
      </div>
      <div class="sheet-header-iconbox sheet-NotCreation sheet-HideIfNotChecked">
        <input name="attr_Creature-DivingCharging_max" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <label class="sheet-iconlabel2 sheet-HideIfCloseChecked" title="@{Creature-DivingCharging}    When this status is ON,then the creature is Ether Diving or Charging. Make sure to turn OFF when creature is not Diving or Charging. (GMG p.250)">
          <input type="checkbox" name="attr_Creature-DivingCharging" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-charging"></span>
        </label>
        <input name="attr_Creature-Ambushing_max" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <label class="sheet-iconlabel2 sheet-HideIfCloseChecked" title="@{Creature-Ambushing}     When this status is ON,then the creature is ambushing. Make sure to turn OFF when creature is not ambushing. (GMG p.250)">
          <input type="checkbox" name="attr_Creature-Ambushing" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-ambush"></span>
        </label>
      </div>

      <div class="sheet-NotCreation sheet-HideIfChecked sheet-HideIfPrint">
        <span class="sheet-nowrap sheet-label"> Aggr. :
         <label class="sheet-iconlabel2" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
          <input type="checkbox" name="attr_combatOption-AggressiveAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-aggressive"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Def. :
          <label class="sheet-iconlabel2" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384)">
            <input type="checkbox" name="attr_combatOption-DefensiveStance" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Called Shot :
          <label class="sheet-iconlabel2" title="@{combatOption-CalledShot}   Take one Strain; 3 penalty to Attack test; if successful, attack hits designated area.">
            <input type="checkbox" name="attr_combatOption-CalledShot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-calledshot"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label sheet-HideIfNotTail"> Tail Atk :
          <label class="sheet-iconlabel2" title="@{combatOption-TailAttack}   T'skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
            <input type="checkbox" name="attr_combatOption-TailAttack" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-tail"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Blindsiding :
          <label class="sheet-iconlabel2" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
            <input type="checkbox" name="attr_condition-Blindsiding" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-blindsiding"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> KndDown :
          <label class="sheet-iconlabel2" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
            <input type="checkbox" name="attr_condition-KnockedDown" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-knockeddown"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Harried :
          <label class="sheet-iconlabel2" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
            <input type="checkbox" name="attr_condition-Harried" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-harried"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Blindsided :
          <label class="sheet-iconlabel2" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
            <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-blindsided"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Surprised :
          <label class="sheet-iconlabel2" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
            <input type="checkbox" name="attr_condition-Surprised" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-surprised"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Uncon. :
          <label class="sheet-iconlabel2" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
            <input type="checkbox" name="attr_condition-Health" value="5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-stun"></span>
          </label>
        </span>
        <span class="sheet-nowrap sheet-label"> Dead :
          <label class="sheet-iconlabel2" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
            <input type="checkbox" name="attr_condition-Health" value="-5" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-death"></span>
          </label>
        </span>
        <input name="attr_Creature-DivingCharging_max" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <span class="sheet-nowrap sheet-label sheet-HideIfCloseChecked"> Diving/Charging :
          <label class="sheet-iconlabel2" title="@{Creature-DivingCharging}    When this status is ON,then the creature is Ether Diving or Charging. Despite being here and not with the other Combat Options, this is a combat option checkbox. Make sure to uncheck this box when creature is not Diving or Charging. (GMG p.250)">
            <input type="checkbox" name="attr_Creature-DivingCharging" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-charging"></span>
          </label>
        </span>
        <input name="attr_Creature-Ambushing_max" type="checkbox" value="0" class="sheet-testCloseChecked" hidden checked >
        <span class="sheet-nowrap sheet-label sheet-HideIfCloseChecked"> Ambushing :
          <label class="sheet-iconlabel2" title="@{Creature-Ambushing}     When this status is ON,then the creature is ambushing. Make sure to turn OFF this box when creature is not ambushing. (GMG p.250)">
            <input type="checkbox" name="attr_Creature-Ambushing" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-ambush"></span>
          </label>
        </span>
      </div>
    </div>    <!-- end sheet-header-flex-container -->
    <!--**********************************************End of the header-flex-container-div******************************-->

    <!--API Watchdog-->
    <div class="sheet-NoAPI">
      <input type="checkbox" name="attr_API" value="2" class="sheet-hidden sheet-testCloseChecked" >
      <div class="sheet-HideIfNotCloseChecked">
        <div class="sheet-text-center"><b>Warning - Character is set to expect API but API is not responding. Temporarly displaying NoAPI version !</b></div>
        <div>- To ignore this warning and keep this character in NoAPI mode (for example a character imported from an API game to a NoAPI Game) :
        <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_stop-using-api" type="action"
        title="Click this button if you definitely stopped using the API.">Forget API</button>
        </div>

        <div>- To set all new characters to not expect the API, go to the Game default sheet settings.
        </div>
        <div>- If you think the API is running, you can try the followng button to try again communicating to the API (note that due to a roll20 restriction, on any new character, you need to initialize the communication by either hitting this button or closing/reopening the sheet)
        <button class="ui-draggable sheet-button-nodice sheet-text-button" name="roll_pingapi" type="roll"
        value="!Earthdawn~ charID: @{character_id}~ APIPing"
        title="Click this button if you confirm using the API.">Try API again</button>
      </div>
      <div>
        - If the above doesn't work, the API may be crashed. Ask the GM to go in the API Console to restart the API.
      </div>
      </div>
    </div>

    <!--Creation Mode-->

    <div>
      <div class="sheet-headerbar sheet-Creation">CREATION MODE</div>
      <div class="sheet-small sheet-Creation">In this mode you can easily modify all attributes / characteristics of your PC/NPC. Follow the step by step creation, or modify the values directly, and exit this mode with the buttons at the end of the page.</div>
    </div>

    <div class="sheet-ShowIfObject">
    <div class="sheet-HideIfPrint">
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="1" title="Overview" checked> <button type="action" name="act_tab" value="1" >Overview</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="2" title="Combat">           <button type="action" name="act_tab" value="2" class="sheet-NotCreation">Combat</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="3" title="Talents or Powers"><button type="action" name="act_tab" value="3" class="sheet-HideIfCreature">Talents</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="3" title="Talents or Powers"><button type="action" name="act_tab" value="3" class="sheet-HideIfNotCreature">Powers</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="4" title="Knacks">           <button type="action" name="act_tab" value="4" class="sheet-api sheet-NotCreation sheet-HideIfCreature">Knacks</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="5" title="Skills">           <button type="action" name="act_tab" value="5" class="sheet-HideIfCreature">Skills</button>
    <input class="sheet-testCloseChecked sheet-hidden" name="attr_Hide-Spells-Tab" type="checkbox" checked value="1"><span class="sheet-HideIfCloseChecked">
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="6" title="Spell">            <button type="action" name="act_tab" value="6">Spell</button></span>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="7" title="Equipment">        <button type="action" name="act_tab" value="7">Equipment</button>
    <!-- <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="8" title="Gear"> -->
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="9" title="Notes">            <button type="action" name="act_tab" value="9">Notes</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="10" title="Legend">          <button type="action" name="act_tab" value="10" class="sheet-NotCreation sheet-HideIfNotPC">Legend</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="11" title="Adjustments">     <button type="action" name="act_tab" value="11">Parameters</button>
  </div>

  <div class="sheet-HideIfPrint sheet-ShowIfObject sheet-HideIfNotObject">
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="1" title="Overview" checked>  <button type="action" name="act_tab" value="1">Overview</button>
    <input type="checkbox" name="attr_tab" class="sheet-tabMain" value="11" title="Adjustments">      <button type="action" name="act_tab" value="11">Parameters</button>
  </div>
</div>




    <!-- **********************************************Start of Radio Selector for Sections*****************************-->

    <input type="hidden" name="attr_tab1-attrib-view" value="1" class="sheet-show-leftpane-tab1">
    <input type="hidden" name="attr_tab1-defense-view" value="1" class="sheet-show-middlepane-tab1">
    <input type="hidden" name="attr_tab1-mods-view" value="0" class="sheet-show-rightpane-tab1">
    <input type="hidden" name="attr_tab2-attrib-view" value="0" class="sheet-show-leftpane-tab2">
    <input type="hidden" name="attr_tab2-defense-view" value="1" class="sheet-show-middlepane-tab2">
    <input type="hidden" name="attr_tab2-mods-view" value="1" class="sheet-show-rightpane-tab2">
    <input type="hidden" name="attr_tab3-attrib-view" value="0" class="sheet-show-leftpane-tab3">
    <input type="hidden" name="attr_tab3-defense-view" value="0" class="sheet-show-middlepane-tab3">
    <input type="hidden" name="attr_tab3-mods-view" value="0" class="sheet-show-rightpane-tab3">
    <input type="hidden" name="attr_tab4-attrib-view" value="0" class="sheet-show-leftpane-tab4">
    <input type="hidden" name="attr_tab4-defense-view" value="0" class="sheet-show-middlepane-tab4">
    <input type="hidden" name="attr_tab4-mods-view" value="0" class="sheet-show-rightpane-tab4">
    <input type="hidden" name="attr_tab5-attrib-view" value="0" class="sheet-show-leftpane-tab5">
    <input type="hidden" name="attr_tab5-defense-view" value="0" class="sheet-show-middlepane-tab5">
    <input type="hidden" name="attr_tab5-mods-view" value="0" class="sheet-show-rightpane-tab5">
    <input type="hidden" name="attr_tab6-attrib-view" value="0" class="sheet-show-leftpane-tab6">
    <input type="hidden" name="attr_tab6-defense-view" value="0" class="sheet-show-middlepane-tab6">
    <input type="hidden" name="attr_tab6-mods-view" value="0" class="sheet-show-rightpane-tab6">
    <input type="hidden" name="attr_tab7-attrib-view" value="0" class="sheet-show-leftpane-tab7">
    <input type="hidden" name="attr_tab7-defense-view" value="0" class="sheet-show-middlepane-tab7">
    <input type="hidden" name="attr_tab7-mods-view" value="0" class="sheet-show-rightpane-tab7">
    <input type="hidden" name="attr_tab8-attrib-view" value="0" class="sheet-show-leftpane-tab8">
    <input type="hidden" name="attr_tab8-defense-view" value="0" class="sheet-show-middlepane-tab8">
    <input type="hidden" name="attr_tab8-mods-view" value="0" class="sheet-show-rightpane-tab8">
    <input type="hidden" name="attr_tab9-attrib-view" value="0" class="sheet-show-leftpane-tab9">
    <input type="hidden" name="attr_tab9-defense-view" value="0" class="sheet-show-middlepane-tab9">
    <input type="hidden" name="attr_tab9-mods-view" value="0" class="sheet-show-rightpane-tab9">
    <input type="hidden" name="attr_tab10-attrib-view" value="0" class="sheet-show-leftpane-tab10">
    <input type="hidden" name="attr_tab10-defense-view" value="0" class="sheet-show-middlepane-tab10">
    <input type="hidden" name="attr_tab10-mods-view" value="0" class="sheet-show-rightpane-tab10">
    <input type="hidden" name="attr_tab11-attrib-view" value="0" class="sheet-show-leftpane-tab11">
    <input type="hidden" name="attr_tab11-defense-view" value="0" class="sheet-show-middlepane-tab11">
    <input type="hidden" name="attr_tab11-mods-view" value="0" class="sheet-show-rightpane-tab11">
    <div class="sheet-sec-border-top"></div>
    <!-- ********************************JBF:End of Radio Selector for Sections********************************************* -->


    <!--*********************************JBF: Overall flex-container Start********************************************* -->
    <div class="sheet-flex-container sheet-ShowIfObject sheet-PrintNoFlex">    <!-- this goes to bottom of html  -->


      <div class="sheet-ShowIfObject">   <!-- this goes to end of side panes plus step table -->

        <div class="sheet-flex-container sheet-ShowIfObject sheet-PrintNoFlex">    <!-- start of the three side panes -->
                    <!--*********************************JBF: Left Pane Attribute Start********************************************* -->
          <div class="sheet-bordered sheet-leftpane">

            <div class="sheet-headerbar sheet-NotCreation">
              Attributes
              <div class="sheet-floatRight sheet-NotCreation sheet-HideIfCreature">
                <label title="@{attributes-edit-mode} : Toggles the edit mode ." >
                  <input type="checkbox" name="attr_attributes-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label>
              </div>
            </div>
            <input class="sheet-testAttrCosts" name="attr_Attr-Costs" value="25" type="hidden">
            <div class="sheet-Creation sheet-headerbar" >
              <b class="sheet-creation-order" title="Refer to Player Guide Edition 4 p.59. Assign your 25 Attribute Points.">2-</b> Generate Attributes.
            </div>
            <div class="sheet-content sheet-Creation sheet-HideIfCreature">
              Attribute Points:  <input name="attr_Attr-Costs" class="sheet-numShort sheet-attrCostsRed"
              readonly="readonly"
              title="@{Attr-Costs}   Number of Attribute points remaining from the starting 25, after raising Racial attributes to Orig values."
              type="number">  <br>
              Karma Points : &nbsp;&nbsp;<input name="attr_Attrib-Karma-Orig" min="0" value="0" class="sheet-numShort sheet-attrCostsRed" title="@{Attrib-Karma-Orig}   Number of remaining creation points to be transferred to Karma Pool."  type="number"><br>
            </div>
              <div class=" sheet-Creation sheet-HideIfCreature sheet-small">Spend Attributes points or set the Step            </div>

            <div class="sheet-content sheet-Creation sheet-HideIfNotCreature" style="width:100px;">
              Attributes: directly set the Attribute Steps
            </div>

            <div class="sheet-content sheet-flex-container sheet-flex-column">    <!-- Everything except header of attributes sidepane -->
              <input type="checkbox" name="attr_attributes-edit-mode" value="1" hidden class="sheet-testRepEditMode">

              <!--Left Pane - DEX box-->
              <div class="sheet-table-row">

                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Dex-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Dex-Race}   Base Racial Dexterity attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Dex-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Dex-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Dex-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Dex-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Dex-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Dex-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Dex}~  foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Value: Dex~ Roll"
                        title="%{selected|Dex-Check}   Roll a Dexterity Action check for this Character - Modified for wounds and conditions.">DEX </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Dex-CheckNoAPI" type="roll"
                        value="@{RollType-Dex} &{template:default} {{name=Dexterity}} {{Step: [[?{Step|@{Dex}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Dex-CheckNoAPI}   Roll a Dexterity Action check for this Character - Modified for wounds and conditions.">&nbsp;DEX</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Dex-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Dex}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Value: Dex-Effect~ Roll"
                        title="%{selected|Dex-Effect-Check}   Roll a Dexterity Effect Check (Using 'Dex-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">DEX-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Dex-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Dex} &{template:default} {{name=Dexterity Effect Test}} {{Step: [[?{Step|@{Dex-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Dex-Effect-CheckNoAPI}   Roll a Dexterity Effect Check (Using 'Dex-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">DEX-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Dex-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Dex-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Dex-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Dex-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Dex-Step}   Dex Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Dex" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Dex}   Dex Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Dex-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Dex-Effect}   Dex step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >

                        <span title="@{Dex-Mods}   Misc Dex step mods.">
                          <input name="attr_Dex-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Dex-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Dex-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Dex-Step}   Dex Base Step - Value before Modifiers and Buffs" >
                      </span>

                    </div>

                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Dex-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Dex-Curr}   Current Dexterity Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Dex-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Dex-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->

                      <input type="checkbox" name="attr_Dex-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >

                        <input type="checkbox" name="attr_Dex-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Dex-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Dex-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Dex-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Dex-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Dex-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Dex-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Dex-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Dex-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Dex-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Dex-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Dex-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Dex-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Dex-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Dex-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Dex-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Dex-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Dex-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Dex-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Dex-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Dex-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Dex-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Dex-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Dex-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Dex-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Dex-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Dex-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Dex-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation  sheet-HideIfCreature" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Dex-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Dex-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Dex Box-->

              <!--Left Pane - STR box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Str-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Str-Race}   Base Racial Strength attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Str-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Str-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Str-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Str-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Str-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Str-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Str}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str~ Roll"
                        title="%{selected|Str-Check}   Roll a Strength Action check for this Character - Modified for wounds and conditions.">STR </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Str-CheckNoAPI" type="roll"
                        value="@{RollType-Str} &{template:default} {{name=Strength}} {{Step: [[?{Step|@{Str}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Str-CheckNoAPI}   Roll a Strength Action check for this Character - Modified for wounds and conditions.">&nbsp;STR</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Str-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Str}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Str-Effect~ Roll"
                        title="%{selected|Str-Effect-Check}   Roll a Strength Effect Check (Using 'Str-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">STR-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Str-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Str} &{template:default} {{name=Strength Effect Test}} {{Step: [[?{Step|@{Str-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Str-Effect-CheckNoAPI}   Roll a Strength Effect Check (Using 'Str-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">STR-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Str-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Str-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Str-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Str-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Str-Step}   Str Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Str" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Str}   Str Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Str-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Str-Effect}   Str step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Str-Mods}   Misc Str step mods.">
                          <input name="attr_Str-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Str-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Str-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Str-Step}   Str Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Str-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Str-Curr}   Current Strength Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Str-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Str-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Str-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Str-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Str-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Str-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Str-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Str-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Str-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Str-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Str-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Str-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Str-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Str-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Str-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Str-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Str-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Str-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Str-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Str-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Str-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Str-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Str-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Str-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Str-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Str-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Str-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Str-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Str-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Str-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Str-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Str-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Str-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Str-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Str-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Str Box-->

              <!--Left Pane - Tou box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Tou-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Tou-Race}   Base Racial Toughness attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Tou-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Tou-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Tou-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Tou-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Tou-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Tou-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Tou}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Tou-Karma-Ask}: @{DPGlobalMode}@{Tou-DP-Ask}~ Value: Tou~ Roll"
                        title="%{selected|Tou-Check}   Roll a Toughness Action check for this Character - Modified for wounds and conditions.">TOU </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Tou-CheckNoAPI" type="roll"
                        value="@{RollType-Tou} &{template:default} {{name=Toughness}} {{Step: [[?{Step|@{Tou}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Tou-CheckNoAPI}   Roll a Toughness Action check for this Character - Modified for wounds and conditions.">&nbsp;TOU</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Tou-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Tou}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Tou-Karma-Ask}: @{DPGlobalMode}@{Tou-DP-Ask}~ Value: Tou-Effect~ Roll"
                        title="%{selected|Tou-Effect-Check}   Roll a Toughness Effect Check (Using 'Tou-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">TOU-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Tou-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Tou} &{template:default} {{name=Toughness Effect Test}} {{Step: [[?{Step|@{Tou-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Tou-Effect-CheckNoAPI}   Roll a Toughness Effect Check (Using 'Tou-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">TOU-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Tou-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Tou-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Tou-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Tou-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Tou-Step}   Tou Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Tou" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Tou}   Tou Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Tou-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Tou-Effect}   Tou step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Tou-Mods}   Misc Tou step mods.">
                          <input name="attr_Tou-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Tou-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Tou-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Tou-Step}   Tou Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Tou-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Tou-Curr}   Current Toughness Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">

                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Tou-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Tou-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Tou-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Tou-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Tou-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Tou-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Tou-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Tou-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Tou-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Tou-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Tou-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Tou-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Tou-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Tou-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Tou-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Tou-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Tou-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Tou-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Tou-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Tou-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Tou-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Tou-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Tou-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Tou-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Tou-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Tou-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Tou-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Tou-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Tou-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Tou-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Tou-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" >
                    <div> <!--LP Increases-->
                      <div><b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Tou-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Tou-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Tou Box-->

              <!--Left Pane - Per box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Per-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Per-Race}   Base Racial Perception attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Per-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Per-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Per-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Per-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Per-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Per-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Per}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Per-Karma-Ask}: @{DPGlobalMode}@{Per-DP-Ask}~ Value: Per~ Roll"
                        title="%{selected|Per-Check}   Roll a Perception Action check for this Character - Modified for wounds and conditions.">PER</button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Per-CheckNoAPI" type="roll"
                        value="@{RollType-Per} &{template:default} {{name=Perception}} {{Step: [[?{Step|@{Per}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Per-CheckNoAPI}   Roll a Perception Action check for this Character - Modified for wounds and conditions.">&nbsp;PER</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Per-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Per}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Per-Karma-Ask}: @{DPGlobalMode}@{Per-DP-Ask}~ Value: Per-Effect~ Roll"
                        title="%{selected|Per-Effect-Check}   Roll a Perception Effect Check (Using 'Per-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">PER-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Per-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Per} &{template:default} {{name=Perception Effect Test}} {{Step: [[?{Step|@{Per-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Per-Effect-CheckNoAPI}   Roll a Perception Effect Check (Using 'Per-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">PER-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Per-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Per-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Per-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Per-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Per-Step}   Per Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Per" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Per}   Per Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Per-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Per-Effect}   Per step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Per-Mods}   Misc Per step mods.">
                          <input name="attr_Per-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Per-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Per-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Per-Step}   Per Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>
                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Per-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Per-Curr}   Current Perception Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Per-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Per-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Per-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Per-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Per-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Per-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Per-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Per-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Per-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Per-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Per-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Per-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Per-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Per-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Per-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Per-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Per-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Per-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Per-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Per-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Per-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Per-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Per-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Per-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Per-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Per-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Per-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Per-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Per-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Per-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Per-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Per-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Per-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Per-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Per-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--JBF End of Per Box-->

              <!--Left Pane - Wil box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Wil-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Wil-Race}   Base Racial Willpower attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Wil-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Wil-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame2 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Wil-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Wil-ActnEfct"  value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Wil-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Wil-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Wil}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Wil-Karma-Ask}: @{DPGlobalMode}@{Wil-DP-Ask}~ Value: Wil~ Roll"
                        title="%{selected|Wil-Check}   Roll a Willpower Action check for this Character - Modified for wounds and conditions.">WIL </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Wil-CheckNoAPI" type="roll"
                        value="@{RollType-Wil} &{template:default} {{name=Willpower}} {{Step: [[?{Step|@{Wil}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Wil-CheckNoAPI}   Roll a Willpower Action check for this Character - Modified for wounds and conditions.">&nbsp;WIL</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Wil-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Wil}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Wil-Karma-Ask}: @{DPGlobalMode}@{Wil-DP-Ask}~ Value: Wil-Effect~ Roll"
                        title="%{selected|Wil-Effect-Check}   Roll a Willpower Effect Check (Using 'Wil-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">WIL-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Wil-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Wil} &{template:default} {{name=Willpower Effect Test}} {{Step: [[?{Step|@{Wil-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Wil-Effect-CheckNoAPI}   Roll a Willpower Effect Check (Using 'Wil-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">WIL-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Wil-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Wil-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Wil-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Wil-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Wil-Step}   Wil Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Wil" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Wil}   Wil Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Wil-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Wil-Effect}   Wil step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Wil-Mods}   Misc Wil step mods.">
                          <input name="attr_Wil-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Wil-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Wil-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Wil-Step}   Wil Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Wil-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Wil-Curr}   Current Willpower Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Wil-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Wil-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Wil-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Wil-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Wil-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Wil-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Wil-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Wil-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Wil-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Wil-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Wil-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Wil-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Wil-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Wil-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Wil-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Wil-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Wil-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Wil-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Wil-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Wil-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Wil-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Wil-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Wil-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Wil-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Wil-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Wil-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Wil-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Wil-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Wil-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Wil-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Wil-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" >
                    <div> <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Wil-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Wil-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>    <!--JBF End of Wil Box-->

                    <!--Left Pane - Cha box-->
              <div class="sheet-table-row">
                <div class="sheet-table-data sheet-Creation sheet-HideIfCreature"><!--Creation Increases-->
                  <!--Creation Increases-->
                  <div class="sheet-content"><b>Race:</b>
                    <input name="attr_Attrib-Cha-Race"
                    value="10"
                    class="sheet-numShort sheet-LockIfNotHomeBrew"
                    title="@{Attrib-Cha-Race}   Base Racial Charisma attribute."
                    type="number">
                  </div>
                  <div class="sheet-content"><b>+ Creation:</b> </div>
                  <div class="sheet-content">
                    <input name="attr_Attrib-Cha-Orig"
                    value="0" min="-2" max="8"
                    class="sheet-numShort sheet-attrCostsRed"
                    title="@{Attrib-Cha-Orig}   Number of times Attribute was increased during character creation by spending AP."
                    type="number"><b>&nbsp;&nbsp;&nbsp;=&nbsp;</b>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-box sheet-background-frame3 sheet-frame">
                    <div class="sheet-Attrib-header">
                      <input class="sheet-testChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Cha-ActnEfct}   When checked, the modifiers displayed are for Effect Tests and the button will roll an Effect test.">
                        <input type="radio" name="attr_Cha-ActnEfct" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-effect-white sheet-iconpaddedleft"></span>
                      </label>
                      <input type="checkbox" name="attr_Cha-ActnEfct" hidden value="-1" class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-api sheet-fancyfont"
                        name="roll_Cha-Check"
                        type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Cha}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Cha-Karma-Ask}: @{DPGlobalMode}@{Cha-DP-Ask}~ Value: Cha~ Roll"
                        title="%{selected|Cha-Check}   Roll a Charisma Action check for this Character - Modified for wounds and conditions.">CHA </button>
                        <button class="sheet-text-button-header ui-draggable sheet-NoAPI sheet-fancyfont" name="roll_Cha-CheckNoAPI" type="roll"
                        value="@{RollType-Cha} &{template:default} {{name=Charisma}} {{Step: [[?{Step|@{Cha}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Cha-CheckNoAPI}   Roll a Charisma Action check for this Character - Modified for wounds and conditions.">&nbsp;CHA</button>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-api sheet-fancyfont" name="roll_Cha-Effect-Check" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ @{RollType-Cha}~  foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Cha-Karma-Ask}: @{DPGlobalMode}@{Cha-DP-Ask}~ Value: Cha-Effect~ Roll"
                        title="%{selected|Cha-Effect-Check}   Roll a Charisma Effect Check (Using 'Cha-Effect') for this Character - Modified only for Wounds and things that affect Effect Tests.">CHA-Fx</button>
                        <button class="sheet-text-button-header ui-draggable sheet-button-nodice sheet-NoAPI sheet-fancyfont" name="roll_Cha-Effect-CheckNoAPI" type="roll"
                        value="@{RollType-Cha} &{template:default} {{name=Charisma Effect Test}} {{Step: [[?{Step|@{Cha-Effect}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                        title="%{selected|Cha-Effect-CheckNoAPI}   Roll a Charisma Effect Check (Using 'Cha-Effect' ) for this Character - Modified only for Wounds and things that affect Effect Tests.">CHA-Fx</button>
                      </span>
                      <input class="sheet-testCloseChecked sheet-hidden" name="attr_show_actnefct_toggle" type="checkbox" value="1">
                      <label class="sheet-HideIfChecked sheet-HideIfNotCloseChecked sheet-NotCreation" title="@{Cha-ActnEfct}   When checked, the modifiers displayed are for Action Tests and the button will roll an Action test.">
                        <input type="radio" name="attr_Cha-ActnEfct" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-action-white sheet-iconpaddedright"></span>
                      </label>
                    </div>
                    <div class="sheet-AttribStepSpan">
                      <span class="sheet-stepSpan sheet-NotCreation">
                        <input type="checkbox" name="attr_Cha-ActnEfct" checked value="1" hidden class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked" title="@{Adjust-All-Tests-Total}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-All-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-All-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span class="sheet-HideIfChecked" title="@{Adjust-Effect-Tests-Total}   This is the automatic adjustment to Effect Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                          <input name="attr_Adjust-Effect-Tests-Total" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Adjust-Effect-Tests-Total" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Cha-Step" class="sheet-AttribStep sheet-StepBase" readonly value="5" type="number" title="@{Cha-Step}   Cha Base Step - Value before Modifiers and Buffs" >
                        <input name="attr_Cha" class="sheet-AttribStep sheet-StepTotal sheet-HideIfNotChecked" readonly value="5" type="number" title="@{Cha}   Cha Final step - Modified for Wounds and Conditions, including the Action Test modifier (at top of sheet), but not Effect Test modifier."  >
                        <input name="attr_Cha-Effect" class="sheet-AttribStep sheet-StepTotal sheet-HideIfChecked" readonly value="5" type="number" title="@{Cha-Effect}   Cha step used for Effect Tests - Modified only for Wounds and things that affect Effect Tests."  >
                        <span title="@{Cha-Mods}   Misc Cha step mods.">
                          <input name="attr_Cha-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Cha-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                      <span class="sheet-stepSpan sheet-Creation">
                        <input name="attr_Cha-Step" class="sheet-Big sheet-numShort" value="5" type="number" title="@{Cha-Step}   Cha Base Step - Value before Modifiers and Buffs" >
                      </span>
                    </div>

                    <div class="sheet-AttribValueDiv sheet-HideIfCreature">
                      <input name="attr_Attrib-Cha-Curr"
                      value="10"
                      class="sheet-numShort sheet-AttribValue" readonly
                      title="@{Attrib-Cha-Curr}   Current Charisma Attribute."
                      type="number">
                    </div>
                  </div>
                </div>
                <div class="sheet-table-data">
                  <div class="sheet-Attrib-rightbox sheet-HideIfEditMode sheet-NotCreation">
                    <!--JBF Karma Toggle-Simple-->
                    <input type="checkbox" name="attr_Cha-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                    <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                      <input type="hidden" name="attr_Cha-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Cha-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Cha-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_Cha-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Cha-Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Cha-Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_Cha-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_Cha-Karma-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Cha-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{Cha-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_Cha-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Cha-Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{Cha-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{Cha-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of Karma Toggle-Simple-->
                    <br>
                          <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_Cha-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_Cha-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_Cha-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{Cha-DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_Cha-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Cha-DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Cha-DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Cha-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_Cha-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_Cha-DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{Cha-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{Cha-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_Cha-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{Cha-DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{Cha-DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{Cha-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </div>
                  <div class="sheet-Attrib-rightbox sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" >
                    <div>   <!--LP Increases-->
                      <div>    <b>LP Incr.:</b></div>
                      <div>
                        <input name="attr_Attrib-Cha-Increases"
                        value="0"
                        min="0"
                        class="sheet-numShort"
                        title="@{Attrib-Cha-Increases}   Number of times Attribute value has been increased since character creation by paying Legend Points."
                        type="number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>    <!--JBF End of Cha Box-->
            </div>    <!-- end of everything except header of attribute sidepane -->
          </div>    <!--************************************************JBF end of Left Pane : attribute*****************************-->


                    <!--**************JBF start of Middle side Pane :defenses, Armor and Misc***************-->
          <div class="sheet-bordered sheet-middlepane sheet-ShowIfObject">
            <div class="sheet-Creation sheet-headerbar" >
              <b class="sheet-creation-order" title="Refer to Player Guide Edition 4 p.62.">3-</b> Characteristics.
            </div>
            <div class="sheet-content sheet-Creation sheet-small">
              Automatically Calculated
            </div>
            <div class="sheet-headerbar">Charact.
              <input name="attr_show_natural_toggle" class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="1">
              <div class="sheet-floatRight sheet-HideIfNotCloseChecked">
                <label title="@{attr_natural_value_show} : Toggles the display of natural values, where all armor and object bonus/penalties to defenses, armor and objects are ignored. Natural values are displayed .">
                  <input type="checkbox" name="attr_natural_value_show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-naked-white"></span>
                </label>
              </div>
            </div>

            <!--Middle Pane -  start of Others -->
            <!-- <div class="sheet-headerbar"> Others</div> -->
            <div class="sheet-content sheet-ShowIfObject  sheet-flex-container sheet-flex-column">

              <!--Middle Pane -  Start of Init Box-->
              <div class="sheet-flex-container sheet-ShowIfObject">
                <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-ShowIfObject">
                  <div class="sheet-headerbar sheet-ShowIfObject" >
                    <button class="sheet-text-button-header sheet-api sheet-button-nodice sheet-fancyfont" name="roll_Dex-Initiative-Check"
                    type="roll"
                    title="%{selected|Dex-Initiative-Check} Click to Roll Initiative. It is important that you select your token"
                    value="!Earthdawn~ charID: @{character_id}~ foreach~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Initiative-Karma-Ask}: @{DPGlobalMode}@{Initiative-DP-Ask}~ Value : Initiative~ Init">
                    Initiative</button>
                    <button class="sheet-text-button-header sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_Dex-Initiative-CheckNoAPI"
                    type="roll"
                    title="%{selected|Dex-Initiative-CheckNoAPI} Click to Roll Initiative. It is important that you select your token"
                    value="@{RollType} &amp;{template:default} {{name=Initiative}} {{Step: [[?{Step|@{Initiative}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] &amp;{tracker}]]}}">Initiative  </button>
                  </div>
                  <div class="sheet-imgbox-defense sheet-icon-initiative-background sheet-flexCenter sheet-ShowIfObject" >
                    <div class="sheet-imgbox-content sheet-NotCreation sheet-ShowIfObject">
                      <span class="sheet-stepSpan" title="@{Initiative}:   Final Initiative Step including modifiers and equipment, and @{Initiative-Step}:   Base Initiative Step before modifiers. (Depending on the Show Final Values parameter)">
                        <span title="@{Initiative-Mod-Auto}:   Initiative modifiers from wounds and equipment.">
                          <input name="attr_Initiative-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_Initiative-Mod-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Initiative" readonly value="5" class="sheet-AttribStep sheet-numHighlight sheet-StepTotal" title="@{Initiative}:   Final Initiative Step including modifiers and equipment." type="number">
                        <input name="attr_Initiative-Step" readonly value="5" class="sheet-AttribStep sheet-numHighlight sheet-StepBase" title="@{Initiative-Step}:   Base Initiative Step before modifiers." type="number">
                        <span title="@{Initiative-Mods}:   Misc Initiative Modification." >
                          <input name="attr_Initiative-Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_Initiative-Mods" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>

                    <div class="sheet-imgbox-content sheet-Creation sheet-ShowIfObject">
                      <input name="attr_Initiative-Step"  value="5"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{Initiative-Step}:   Base Initiative Step before modifiers and equipment." type="number">
                    </div>

                  </div>
                </div>
                <div>
                  <label title="@{attr_Initiative-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_Initiative-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>
              </div>
              <!--JBF Karma Toggle-Simple-->
              <div>
                <!--JBF Karma Toggle-Simple-->
                <input type="checkbox" name="attr_Initiative-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                <span class="sheet-Karma-ControlBox sheet-HideIfCloseChecked">
                  <input type="hidden" name="attr_Initiative-Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Initiative-Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Initiative-Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On" >
                        <input type="checkbox" name="attr_Initiative-Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Initiative-Karma} : Number of Karma Points to be spent when Karma is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Initiative-Karma} Don't Spend any Karma when Karma is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On"></span>
                        </span>
                        <input type="hidden" name="attr_Initiative-Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                        <input type="hidden" name="attr_Initiative-Karma-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Initiative-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                          <option value="3" title="@{Initiative-Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                        <select name="attr_Initiative-Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Initiative-Karma} Don't Spend any Karma when Karma is On.">0</option>
                          <option value="1" title="@{Initiative-Karma}   Automatically Spends One Karma when Karma is On">1</option>
                          <option value="2" title="@{Initiative-Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>   <!--JBF End Of Karma Toggle-Simple-->
                      <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                <span class="sheet-DP-ControlBox">
                  <input type="hidden" name="attr_Initiative-DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                  <input type="checkbox" name="attr_Initiative-DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked" >
                    <input type="checkbox" name="attr_Initiative-DP-Limit_max" hidden value="1" class="sheet-testChecked">
                    <span class="sheet-HideIfNotChecked">
                      <label class="sheet-labelcheckbox" hidden title="@{Initiative-DP}   Automatically Spends One Devotion when Devotion is On" >
                        <input type="checkbox" name="attr_Initiative-DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                      </label>
                    </span>
                    <span class="sheet-HideIfChecked">
                      <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{Initiative-DP} : Number of Devotion Points to be spent when Devotion is On">
                        <span class="sheet-iconselect-icon-noedit">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Initiative-DP} Don't Spend any Dp when Dp is On."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_Initiative-DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On"></span>
                        </span>
                        <input type="hidden" name="attr_Initiative-DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                        <input type="hidden" name="attr_Initiative-DP-Limit_max" class="sheet-testKarMax">
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                          <option value="0" selected title="@{Initiative-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                          <option value="3" title="@{Initiative-DP}   Automatically Spends Three Dp when Dp is On">3</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                        <select name="attr_Initiative-DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                          <option value="0" selected title="@{Initiative-DP} Don't Spend any Dp when Dp is On.">0</option>
                          <option value="1" title="@{Initiative-DP}   Automatically Spends One Dp when Dp is On">1</option>
                          <option value="2" title="@{Initiative-DP}   Automatically Spends Two Dp when Dp is On">2</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </span>   <!--JBF End Of DP Toggle-->
              </div>
                    <!-- JBF All Init related attributes-->
              <input name="attr_IP" type="hidden" value="0">   <!--JBF End of Init Box-->


              <!--Middle Pane -  Start of Knockdown Box (Creature Only)-->
              <div class="sheet-flex-container sheet-HideIfNotCreature">
                <div class="sheet-Defense-box sheet-background-frame3 sheet-frame">
                  <div class="sheet-headerbar" >
                    <button class="sheet-text-button-header sheet-api sheet-button-nodice" name="roll_Knockdown" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ TargetNum: ?{Knockdown Test, Difficulty Number|6}: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Knockdown: Adjust-Effect-Tests-Total: Defensive~ Roll"
                    title="%{selected|Knockdown} Roll a Knockdown check for this Character - Modified for wounds and conditions.">Knockdown
                    </button>
                    <button class="sheet-text-button-header sheet-NoAPI sheet-button-nodice" name="roll_KnockdownNoAPI" type="roll"
                    value="@{RollType} &amp;{template:default} {{name=Knockdown Test}} {{Step: [[?{Step|@{Knockdown}+@{Adjust-Effect-Tests-Total}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                    title="%{selected|Knockdown-NoAPI} Roll a Knockdown check for this Character - Modified for wounds and conditions.">Knockdown
                    </button>
                  </div>
                  <div class="sheet-imgbox-defense sheet-icon-knockeddown-bakcground sheet-flexCenter" >
                    <div class="sheet-imgbox-content sheet-NotCreation">
                      <span class="sheet-stepSpan" title="@{Knockdown} : Step used to resist knockdown for Creatures (Str for Namegivers)">
                        <input name="attr_Knockdown" type="checkbox"  value="99" class="sheet-hidden sheet-testCloseChecked">
                        <input name="attr_Knockdown" type="number"  value="5" class="sheet-HideIfCloseChecked sheet-AttribStep sheet-numHighlight" readonly="readonly" title="@{Knockdown} : Step used to resist knockdown for Creatures (Str for Namegivers)">
                        <b class="sheet-HideIfNotCloseChecked sheet-Big sheet-numHighlight"> NA</b>
                        </span>
                    </div>

                    <div class="sheet-imgbox-content sheet-Creation">
                      <input name="attr_Knockdown" type="checkbox"  value="99" class="sheet-hidden sheet-testCloseChecked">
                      <input name="attr_Knockdown" type="number"  value="5" class="sheet-HideIfCloseChecked sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{Knockdown} : Step used to resist knockdown for Creatures (Str for Namegivers)">
                      <b class="sheet-HideIfNotCloseChecked sheet-Big sheet-numHighlight"> NA</b>
                    </div>
                  </div>
                </div>
                <div>
                  <label title="@{attr_Knockdown-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_Knockdown-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>
              </div>



                    <!--Middle Pane - Start of Buttons, Knockdown, JumpUp-->
              <div class="sheet-HideIfPrint sheet-HideIfCreature sheet-NotCreation">
                <button class="sheet-text-button sheet-api sheet-button-nodice " name="roll_Knockdown" type="roll"
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: ?{Knockdown Test, Difficulty Number|6}: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{Str-Karma-Ask}: @{DPGlobalMode}@{Str-DP-Ask}~ Value: Knockdown: Adjust-All-Tests-Total: Defensive~ Roll"
                title="%{selected|Knockdown} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span>KnockD
                <input type="hidden" name="attr_Knockdown-Adjust" class="sheet-testNum" value="0">
                <input name="attr_Knockdown" type="number"  value="5" class="sheet-numShorter sheet-HideIfZero" readonly="readonly"></button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_KnockdownNoAPI" type="roll"
                value="@{RollType} &amp;{template:default} {{name=Knockdown Test}} {{Step: [[?{Step|@{Knockdown}+@{Adjust-All-Tests-Total}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                title="%{selected|Knockdown-NoAPI} Roll a Knockdown check for this Character - Modified for wounds and conditions."><span class="sheet-iconstatic sheet-icon-knockeddown"></span>KnockD
                <input type="hidden" name="attr_Knockdown-Adjust" class="sheet-testNum" value="0">
                <input name="attr_Knockdown" type="number"  value="5" class="sheet-numShorter sheet-HideIfZero" readonly="readonly"></button>
              </div>


              <div class="sheet-HideIfPrint sheet-NotCreation">
                <button class="sheet-text-button sheet-api sheet-button-nodice" name="roll_JumpUp" type="roll"
                title="%{JumpUp}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="!Earthdawn~ charID: @{character_id}~ TargetNum: 6: Adjust-TN-Auto: Adjust-TN-Misc~ foreach~ modValue: ?{Modification|0}~ K-ask: @{KarmaGlobalMode}@{Dex-Karma-Ask}: @{DPGlobalMode}@{Dex-DP-Ask}~ Strain: 2~ calculateValue: JumpUp~ Roll">
                <span class="sheet-iconstatic sheet-icon-jumpup"></span>JumpUp
                <input type="hidden" name="attr_JumpUp-Adjust" class="sheet-testNum" value="0">
                <input name="attr_JumpUp" type="number" disabled value="(@{Dex-Step} + @{Jumpup-Adjust})" class="sheet-numShorter sheet-HideIfZero" readonly="readonly"></button>
              </button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice" name="roll_JumpUp-NoAPI" type="roll"
                title="%{JumpUp-NoAPI}   When Knocked Down - Take 2 Strain and roll Dex to try to jump back to your feet - Alternative is to use your standard action to stand up."
                value="@{RollType} &{template:rolltargetnumber} {{header=@{charName}: Jump Up}} {{target_number=[[6]]}} {{Step=[[?{Step|@{Dex}+(@{condition-KnockedDown}*3)+ @{Jumpup-Adjust} -@{IP}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">
                <span class="sheet-iconstatic sheet-icon-jumpup"></span>JumpUp
                <input type="hidden" name="attr_JumpUp-Adjust" class="sheet-testNum" value="0">
                <input name="attr_JumpUp" type="number" disabled value="(@{Dex-Step} + @{Jumpup-Adjust})" class="sheet-numShorter sheet-HideIfZero" readonly="readonly"></button>

              </button>
              </div>

                 <!--End of Buttons, KnockDown JumpUp-->
            <!-- </div>  -->  <!--End of Others-->




            <!--Middle Pane - Defenses-->
            <!-- <div class="sheet-content sheet-ShowIfObject"> -->
              <input type="checkbox" name="attr_natural_value_show" value="1" hidden class="sheet-testChecked">

              <!-- Middle Pane - Start of PD Box-->
              <div class="sheet-flex-container sheet-ShowIfObject">
                <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-ShowIfObject">
                  <div class="sheet-headerbar sheet-ShowIfObject" > Phys. Def. </div>
                  <div class="sheet-imgbox-defense sheet-icon-PD-background sheet-flexCenter sheet-ShowIfObject" >
                    <div class="sheet-imgbox-content sheet-NotCreation  sheet-ShowIfObject">
                      <span class="sheet-stepSpan" >
                        <span title="@{PD-Mod-Auto}   This is the automatic adjustment to Physical Defense from Wounds, Conditions, Combat Options and in ED4 Shield Adjustments.">
                          <input name="attr_PD-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_PD-Mod-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <span title="@{PD}   Physical Defense or @{PD-UnMod}   Permanent Physical Defense excluding any temporary modifier depending on Show Final Values parameter">
                          <input name="attr_PD-UnMod" readonly
                          value="6"
                          class="sheet-AttribStep sheet-numHighlight sheet-StepBase sheet-HideIfChecked"
                          title="@{PD-UnMod}   Permanent Physical Defense excluding any temporary modifier."
                          type="number"
                          >
                          <input name="attr_PD" readonly
                          value="6"
                          class="sheet-AttribStep sheet-numHighlight sheet-StepTotal sheet-HideIfChecked"
                          title="@{PD}   Physical Defense."
                          type="number"
                          >
                        </span>

                        <span title="@{PD-Buff}   Buffs or other temporary modifications to Physical Defense." >
                          <input name="attr_PD-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_PD-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                    <div class="sheet-imgbox-content sheet-Creation sheet-ShowIfObject">
                      <input name="attr_PD-Nat"  value="6"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{PD-Nat}   Natural Physical Defense excluding equipment." type="number">
                    </div>
                  </div>
                </div>
                <div>
                  <label title="@{attr_PD-Nat-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_PD-Nat-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_PD-Nat" readonly
                value="6"
                class="sheet-numShorter sheet-small"
                title="@{PD-Nat}   Natural Physical Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{PD-Base}   Physical Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> PD-B:
                <input name="attr_PD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_PD-Nat" readonly type="number" value="6"
                title="@{PD-Nat}   Natural PD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <!--JBF End of PD Box-->



              <!-- Middle Pane - Start of MD Box-->
              <div class="sheet-flex-container sheet-ShowIfObject">
                <div class="sheet-Defense-box sheet-background-frame2 sheet-frame sheet-ShowIfObject">
                  <div class="sheet-headerbar sheet-ShowIfObject" > Myst. Def. </div>
                  <div class="sheet-imgbox-defense sheet-icon-MD-background sheet-flexCenter sheet-ShowIfObject" >
                    <div class="sheet-imgbox-content sheet-NotCreation sheet-ShowIfObject">
                      <span class="sheet-stepSpan" title="@{MD}   Mystic Defense or @{MD-UnMod} Permanent Mystic Defense excluding any temporary modifier depending on Show Final Values parameter.">
                        <span title="@{MD-Mod-Auto}   This is the automatic adjustment to Mystic Defense from Wounds, Conditions, Shield (ED4) and Combat Options Adjustments.">
                          <input name="attr_MD-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="attr_MD-Mod-Auto" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_MD-UnMod" readonly
                        value="6"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{MD-UnMod}   Permanent Mystic Defense excluding any temporary modifier."
                        type="number"
                        >
                        <input name="attr_MD" readonly
                        value="6"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{MD}   Mystic Defense."
                        type="number"
                        >
                        <span title="@{MD-Buff}   Buffs or other temporary modifications to Mystic Defense." >
                          <input name="attr_MD-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_MD-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                    <div class="sheet-imgbox-content sheet-Creation sheet-ShowIfObject">
                      <input name="attr_MD-Nat"  value="6"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{MD-Nat}   Natural Mystic Defense excluding equipment." type="number">
                    </div>
                  </div>
                </div>
                <div>
                  <label title="@{attr_MD-Nat-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_MD-Nat-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>
              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_MD-Nat" readonly
                value="6"
                class="sheet-numShorter sheet-small"
                title="@{MD-Nat}   Natural Mystic Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{MD-Base}   Mystic Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> MD-B:
                <input name="attr_MD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_MD-Nat" readonly type="number" value="6"
                title="@{MD-Nat}   Natural MD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <span class="sheet-hidden"><input name="attr_MD" type="number" readonly value="6" title="@{MD}   Mystic Defense.">
              </span>
              <!--JBF End of MD Box-->

              <!--Middle Pane -  Start of SD Box-->
              <!--JBF : Adjust-All-Defenses does not apply to SD-->
              <div class="sheet-flex-container">

              <div class="sheet-Defense-box sheet-background-frame3 sheet-frame">
                <div class="sheet-headerbar" > Soc. Def. </div>
                <div class="sheet-imgbox-defense sheet-icon-SD-background sheet-flexCenter" >
                  <div class="sheet-imgbox-content sheet-NotCreation">
                    <span class="sheet-stepSpan" title="@{SD}   Social Defense or @{SD-Unmod}   Permanent Social Defense excluding any temporary modifier depending on Show Final Values parameter">
                      <span title="No Automatic Adjustment for Social Defense.">
                        <input  type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft">+</b>
                        <input  type="number" readonly value="0" class="sheet-buffLeft">
                      </span>
                      <span class="sheet-StepBase" style="display:inline-block;" title="@{SD-Unmod}   Permanent Social Defense excluding any temporary modifier.">
                        <input name="attr_SD-Unmod"   disabled
                        value="(@{SD-Base} + @{Defense-Soc-Nat-Adjust} + @{Defense-Soc-Adjust} + @{Defense-Soc-Nat-Auto-Adjust})"
                        class="sheet-StepBase sheet-numHighlight sheet-AttribStep "
                        title="@{SD-Unmod}   Permanent Social Defense excluding any temporary modifier."
                        type="number">
                      </span>
                      <input name="attr_SD" readonly
                      value="6"
                      class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                      title="@{SD}   Social Defense."
                      type="number"
                      >
                      <span title="@{SD-Buff}   Buffs or other temporary modifications to Social Defense." >
                        <input name="attr_SD-Buff" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight">+</b>
                        <input name="attr_SD-Buff" type="number" class="sheet-buffRight">
                      </span>
                    </span>
                  </div>
                  <div class="sheet-imgbox-content sheet-Creation">
                    <input name="attr_SD-Nat"  value="6"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{SD-Nat}   Natural Social Defense excluding equipment." type="number">
                  </div>
                </div>
              </div>

                  <div>
                    <label title="@{attr_SD-Nat-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                      <span class="sheet-small"><b>Add SR:</b><br></span>
                      <input type="checkbox" name="attr_SD-Nat-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                    </label>
                  </div>

              </div>

              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_SD-Nat" readonly
                value="6"
                class="sheet-numShorter sheet-small"
                title="@{SD-Nat}   Natural Social Defense excluding equipment."
                type="number"
                >
              </span>
              <span class="sheet-nowrap sheet-hidden" title="@{SD-Base}   Social Defense - From attributes only - before adjustments from equipment, discipline, magic, etc."> SD-B:
                <input name="attr_SD-Base" type="number" class="sheet-numShort" readonly value="6">
              </span>
              <span class="sheet-hidden"><input name="attr_SD-Nat" readonly type="number" value="6"
                title="@{SD-Nat}   Natural SD. Includes only Attribute and any inherent bonuses from Disciplines. It does not include bonuses provided by spells, talents, or woven threads unless otherwise specified." >
              </span>
              <span class="sheet-hidden"><input name="attr_SD" type="number" readonly value="6" title="@{SD}   Social Defense.">
              </span>
              <!--JBF End of SD Box-->
            <!-- </div> -->

            <!--Middle Pane - Armors-->
            <!-- <div class="sheet-headerbar">Armor </div> -->
            <!-- <div class="sheet-content sheet-ShowIfObject"> -->
              <input type="checkbox" name="attr_natural_value_show" value="1" hidden class="sheet-testChecked">

              <!--Middle Pane -  Start of PA Box-->
              <div class="sheet-flex-container sheet-ShowIfObject">
                <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-ShowIfObject">
                  <div class="sheet-headerbar sheet-ShowIfObject" > Phys. Arm. </div>
                  <div class="sheet-imgbox-defense sheet-icon-PA-background sheet-flexCenter sheet-ShowIfObject" >
                    <div class="sheet-imgbox-content sheet-NotCreation sheet-ShowIfObject">
                      <span class="sheet-stepSpan" title="@{Physical-Armor}   Physical Armor rating.   From the Equipment tab.">
                        <span title="No Automatic Adjustment on Armor">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Physical-Armor" readonly
                        value="0"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{Physical-Armor}   Physical Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <input name="attr_Physical-Armor" readonly
                        value="0"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{Physical-Armor}   Physical Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <span title="@{PA-Buff}   Buffs or other temporary modifications to Physical Armor." >
                          <input name="attr_PA-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_PA-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                    <div class="sheet-imgbox-content sheet-Creation sheet-ShowIfObject">
                      <input name="attr_PA-Nat"  value="0"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{PA-Nat}   Natural Physical Armor excluding equipment." type="number">
                    </div>
                  </div>
                </div>
                <div>
                  <label title="@{attr_PA-Nat-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_PA-Nat-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>

              </div>





              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_PA-Nat" readonly
                value="0"
                class="sheet-numShorter sheet-small"
                title="@{PA-Nat}   Natural Physical Armor excluding equipment."
                type="number"
                >
              </span>
              <!--JBF End of PA Box-->

              <!--Middle Pane -  Start of MA Box-->
              <div class="sheet-flex-container sheet-ShowIfObject">
                <div class="sheet-Defense-box sheet-background-frame9 sheet-frame sheet-ShowIfObject">
                  <div class="sheet-headerbar sheet-ShowIfObject" > Myst. Arm. </div>
                  <div class="sheet-imgbox-defense sheet-icon-MA-background sheet-flexCenter sheet-ShowIfObject" >
                    <div class="sheet-imgbox-content sheet-NotCreation sheet-ShowIfObject">
                      <span class="sheet-stepSpan" title="@{Mystic-Armor}   Mystic Armor rating.   From the Equipment tab.">
                        <span title="No Automatic Adjustment on Armor">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft">+</b>
                          <input name="" type="number" readonly class="sheet-buffLeft">
                        </span>
                        <input name="attr_Mystic-Armor" readonly
                        value="2"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepBase"
                        title="@{Mystic-Armor}   Mystic Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <input name="attr_Mystic-Armor" readonly
                        value="2"
                        class="sheet-AttribStep sheet-numHighlight sheet-StepTotal"
                        title="@{Mystic-Armor}   Mystic Armor rating.   From the Equipment tab."
                        type="number"
                        >
                        <span title="@{MA-Buff}   Buffs or other temporary modifications to Mystic Armor." >
                          <input name="attr_MA-Buff" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight">+</b>
                          <input name="attr_MA-Buff" type="number" class="sheet-buffRight">
                        </span>
                      </span>
                    </div>
                    <div class="sheet-imgbox-content sheet-Creation sheet-ShowIfObject">
                      <input name="attr_MA-Nat"  value="2"   class="sheet-Big sheet-numHighlight sheet-LockIfNotCreature"  title="@{MA-Nat}   Natural Mystic Armor excluding equipment." type="number">
                    </div>
                </div>
                </div>
                <div>
                  <label title="@{attr_MA-Nat-addSR} : Adds the Challenge Rating (Creatures) or the Spirit Strength Rating to the Characteristic." class="sheet-Creation sheet-HideIfNotCreature">
                    <span class="sheet-small"><b>Add SR:</b><br></span>
                    <input type="checkbox" name="attr_MA-Nat-addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                  </label>
                </div>
              </div>
              <span class="sheet-HideIfNotChecked sheet-small">
                <span class="sheet-icon-naked sheet-iconstaticsmall"></span> :
                <input name="attr_MA-Nat" readonly
                value="2"
                class="sheet-numShorter sheet-small"
                title="@{MA-Nat}   Natural Mystic Armor excluding equipment."
                type="number"
                >
              </span>
              <!--JBF End of MA Box-->
            </div>
            <!--JBF End of Armors-->



          </div>    <!-- *********End of Middle side Pane (defenses armor and misc) ******** -->


                <!-- *****************Start of Right Pane (modifiers) ******** -->
          <div class="sheet-bordered sheet-rightpane sheet-HideIfPrint">
            <div class="sheet-headerbar">
              <span title="This are the global Modifiers per type that apply on any roll">Modifiers</span>
              <div class="sheet-floatRight">
                <label title="@{attr_modifiers_parameters} : Toggles the display of parameters for the Global Modifiers.">
                  <input type="checkbox" name="attr_modifiers_parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
                </label>
              </div>
            </div>

                <!--Header - Start of Action-Mod Box-->
            <input name="attr_Adjust-All-Tests-Total" type="hidden" value="0"><!--just as placeholder-->
            <!-- <input name="attr_Adjust-All-Tests-Misc" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-All-Tests-Auto" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame9 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Actions</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-All-Tests-Auto}   This is the automatic adjustment to All Action Tests from Wounds, Conditions and Combat Options Adjustments.">
                    <input name="attr_Adjust-All-Tests-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-All-Tests-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-action sheet-iconstaticBig" title="@{Adjust-All-Tests-Auto} and @{Adjust-All-Tests-Misc}   These are the total adjustment to all Actions Test from Situation Modifiers, Combat Options, Wounds and Misc Adjustments."></span>
                  <span title="@{Adjust-All-Tests-Misc}:   Enter any Misc Adjustments to all Action Tests here.">
                    <input name="attr_Adjust-All-Tests-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-All-Tests-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>    <!--End of Action Box-->

                <!--Header - Start of Effect-Mod Box-->
            <input name="attr_Adjust-Effect-Tests-Total" type="hidden" value="0"><!--just as placeholder-->
            <!-- <input name="attr_Adjust-Effect-Tests-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Effect-Tests-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <input class="sheet-testCloseChecked sheet-hidden" name="attr_effectIsAction" type="checkbox" value="1">
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation sheet-HideIfCloseChecked">
              <div class="sheet-headerbar sheet-w100p">Effects</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-Effect-Tests-Auto}   This is the automatic adjustment to Effect Tests from Wounds.">
                    <input name="attr_Adjust-Effect-Tests-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Effect-Tests-Auto" type="number" readonly class="sheet-buffLeft" value="0">
                  </span>
                  <span class="sheet-icon-effect sheet-iconstaticBig" title="@{Adjust-Effect-Tests-Auto} and @{Adjust-Effect-Tests-Misc}   These are the total adjustment to all Effect Test from Wounds and Misc Adjustments."></span>
                  <span title="@{Adjust-Effect-Tests-Misc}:   Enter any Misc Adjustments to Effect Tests here.">
                    <input name="attr_Adjust-Effect-Tests-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Effect-Tests-Misc" type="number" class="sheet-buffRight" value="0">
                  </span>
                </span>
              </div>
            </div>
            <!--End of Effect Box-->

            <!--Header -  Start of Defense-Mod Box-->
            <input name="attr_Adjust-Defenses-Total" type="hidden" value="0"> <!--just as placeholder-->
            <!-- <input name="attr_Adjust-Defenses-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Defenses-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Defenses</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-Defenses-Auto}   This is the automatic adjustment to Physical and Mystic Defenses from Conditions and Combat Options.">
                    <input name="attr_Adjust-Defenses-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Defenses-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-defenses sheet-iconstaticBig" title="@{Adjust-Defenses-Auto} and @{Adjust-Defenses-Misc}   This is the total adjustment to Physical and Mystic Defenses from Conditions, Combat Options and Misc Adjustments."></span>
                  <span title="@{Adjust-Defenses-Misc}:   Enter any Misc Adjustments to Defenses here.">
                    <input name="attr_Adjust-Defenses-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Defenses-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>
            <!--End of Defense Box-->

            <!--Header -  Start of Attacks-Mod Box-->
            <input name="attr_Adjust-Attacks-Total" type="hidden" value="0"> <!--Just as a placeholder-->
            <input name="attr_Adjust-Attacks-Total-CC" type="hidden" value="0"> <!--Just as a placeholder-->
            <!-- <input name="attr_Adjust-Attacks-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Attacks-Auto-CC" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-background-frame8 sheet-frame sheet-NotCreation">
              <input name="attr_show-CC" type="checkbox" class="sheet-testChecked" checked hidden value="1">
              <div class="sheet-headerbar sheet-w100p sheet-HideIfChecked">Attacks</div>
              <div class="sheet-headerbar sheet-w100p sheet-HideIfNotChecked">Attacks-CC</div>
              <div class="sheet-header-modbox">
                <!--Range Mode-->
                <span class="sheet-stepSpan sheet-HideIfChecked">
                  <span title="@{Adjust-Attacks-Auto}   This is the total automatic adjustment to Attacks from Wounds, Conditions and Combat Options.">
                    <input name="attr_Adjust-Attacks-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Attacks-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Attacks-Auto} and @{Adjust-Attacks-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Attacks from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-attacks"></span>
                  </label>
                  <span title="@{Adjust-Attacks-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Attacks-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
                <!--CC Mode-->
                <span class="sheet-stepSpan sheet-HideIfNotChecked">
                  <span title="@{Adjust-Attacks-Auto-CC}   This is the total automatic adjustment to Close Combat Attacks from Wounds, Conditions and Combat Options (Including Aggressive Attack).">
                    <input name="attr_Adjust-Attacks-Auto-CC" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Attacks-Auto-CC" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Attacks-Auto} and @{Adjust-Attacks-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Attacks from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-attacks-cc"></span>
                  </label>
                  <span title="@{Adjust-Attacks-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Attacks-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Attacks-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>

            <input type="checkbox" name="attr_modifiers_parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked sheet-content">
              Atk Bonus die:
              <input name="attr_Adjust-Attacks-Bonus"
              value="0"
              min="0"
              title="@{Adjust-Attacks-Bonus}:   Enter the Step number of any Bonus Die (other than karma) here."
              type="number">
            </div>    <!--End of Attacks Box-->

                <!--Header -  Start of Damage-Mod Box-->
            <input name="attr_Adjust-Damage-Total" type="hidden" value="0"> <!--just as a placeholder-->
            <input name="attr_Adjust-Damage-Total-CC" type="hidden" value="0"> <!--just as a placeholder-->
            <!-- <input name="attr_Adjust-Damage-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Damage-Auto-CC" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-header-hidden sheet-background-frame2 sheet-frame sheet-NotCreation">
              <input name="attr_show-CC" type="checkbox" class="sheet-testChecked" checked hidden value="1">
              <div class="sheet-headerbar sheet-w100p sheet-HideIfChecked">Damage</div>
              <div class="sheet-headerbar sheet-w100p sheet-HideIfNotChecked">Damage-CC</div>
              <div class="sheet-header-modbox">
                <!--Range Mode-->
                <span class="sheet-stepSpan sheet-HideIfChecked">
                  <span title="@{Adjust-Damage-Auto}   This is the total automatic adjustment to Damage from Wounds, Conditions and Combat Options.">
                    <input name="attr_Adjust-Damage-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Damage-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Damage-Auto} and @{Adjust-Damage-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Damage from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-damage"></span>
                  </label>
                  <span title="@{Adjust-Damage-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Damage-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
                <!--CC Mode-->
                <span class="sheet-stepSpan sheet-HideIfNotChecked">
                  <span title="@{Adjust-Damage-Auto-CC}   This is the total automatic adjustment to Close Combat Damage from Wounds, Conditions and Combat Options (Including Aggressive Attack).">
                    <input name="attr_Adjust-Damage-Auto-CC" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-Damage-Auto-CC" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <!--Toggle Range/CC Mode-->
                  <label title="@{Adjust-Damage-Auto} and @{Adjust-Damage-Misc}  Click to Toggle Range/CC This is the total automatic adjustment to Damage from Wounds, Conditions, Combat Options and Misc Adjustments.">
                    <input type="checkbox" name="attr_show-CC" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelbig sheet-icon-damage-cc"></span>
                  </label>
                  <span title="@{Adjust-Damage-Misc}:   Enter any Misc Adjustments to Attack Tests (Range or Close Combat) here.">
                    <input name="attr_Adjust-Damage-Misc" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-Damage-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>
            <input type="checkbox" name="attr_modifiers_parameters" hidden value="1" class="sheet-testCloseChecked">
            <div class="sheet-HideIfNotCloseChecked">
              Dmg Bonus die:
              <input name="attr_Adjust-Damage-Bonus"
              value="0"
              min="0"
              title="@{Adjust-Damage-Bonus}:   Enter the Step number of any Bonus Die (other than karma) here."
              type="number">
            </div>    <!--End of Damage Box-->


                <!--Header - Start of TN-Mod Box-->
            <input name="attr_Adjust-TN-Total" type="hidden" value="0">
            <!-- <input name="attr_Adjust-TN-Auto" type="hidden" class="sheet-testNum" value="0">
            <input name="attr_Adjust-TN-Misc" type="hidden" class="sheet-testNum" value="0"> -->
            <div class="sheet-Defense-box sheet-header-hidden sheet-background-frame8 sheet-frame sheet-NotCreation">
              <div class="sheet-headerbar sheet-w100p">Target #s</div>
              <div class="sheet-header-modbox">
                <span class="sheet-stepSpan">
                  <span title="@{Adjust-TN-Auto}   This is the automatic adjustment to all target numbers from Delayed Actions.">
                    <input name="attr_Adjust-TN-Auto" type="hidden" class="sheet-greenRed" value="0">
                    <b class="sheet-buffSignLeft">+</b>
                    <input name="attr_Adjust-TN-Auto" type="number" readonly class="sheet-buffLeft">
                  </span>
                  <span class="sheet-icon-TN sheet-iconstaticBig" title="@{Adjust-TN-Auto} and @{Adjust-TN-Misc}   These are the total adjustment to all target numbers from Delayed Actions and Misc Adjustments."></span>
                  <span title="@{Adjust-TN-Misc}:   Enter any Misc Adjustments to all Target Numbers here.">
                    <input name="attr_Adjust-TN-Misc" type="hidden" class="sheet-greenRed" value="0">
                    <b class="sheet-buffSignRight">+</b>
                    <input name="attr_Adjust-TN-Misc" type="number" class="sheet-buffRight">
                  </span>
                </span>
              </div>
            </div>    <!-- End of TN Box -->
          </div>    <!-- ********* End of Right Pane (modifiers)  ******** -->
        </div>    <!-- end of the three side panes.  -->
      </div>    <!-- end of side panes plus step table -->





            <!--*********************************JBF:Start of Main Pane - Contineus until end of html *************************-->
      <div class="sheet-w100p sheet-bordered sheet-ShowIfObject">
        <!-- APIbug:
        <input name="attr_testAPIbug" type="number" value="0" class="sheet-numShort" title="test1:   Worker Thread test - change this and see if the following one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">
        max:
        <input name="attr_testAPIbug_max" type="number" value="0" class="sheet-numShort" title="test1:   Worker Thread test - change this and see if the following one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">

        <input name="attr_testAPIbug2" type="number" value="0" class="sheet-numShort" title="test1:   Worker Thread test - change this and see if the following one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript."> -->


              <!--**************************  Start of Section Core Title***Other Sections are also labelled section-core to display in the overview -->
              <!--**************************  Sections are split between title and Content to allow for Parameter Div -->
              <div class="sheet-section sheet-section-core sheet-section-combat sheet-ShowIfObject">

                <!--Section Core - Creation Title-->
                <div class="sheet-Creation sheet-headerbar sheet-headerbar-flex sheet-ShowIfObject">
                  <div class="sheet-ShowIfObject"></div>
                  <b class="sheet-creation-order">0-</b> Choose between Building a Hero (Select PC) / or creating a Foe (Select NPC, or Mook) / or an Object
                  <div class="sheet-ShowIfObject">
                    <label title="@{attr_CreationMode} : Toggles the Creation mode ." class="sheet-HideIfNotCreature sheet-HideIfNotOverview">
                      <input type="checkbox" name="attr_CreationMode" value="1"  class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                    </label>
                  </div>
                </div>
                <div class="sheet-content sheet-Creation sheet-ShowIfObject">
                  <div class="sheet-nowrap3 sheet-ShowIfObject" title="@{NPC}   Is this character a PC, NPC, Mook, or Object?   (Mook means more than one token shares one character sheet) (Object means it is not really a character at all)">
                    PC?
                    <select name="attr_NPC" class="sheet-selShort">
                      <option value="0"  title="PC"  > PC</option>
                      <option value="1"  title="NPC" selected> NPC</option>
                      <option value="2"  title="Mook"> Mook</option>
                      <option value="-1" title="Object - The token is not really a character at all, but is an object such as a campfire or a torch."> Object</option>
                    </select>
                  </div>
                  <div class="sheet-HideIfPC" >
                    <div class="sheet-small">To Import a <i>Creature</i> from Book copy and Paste  description (starting with name) into this tiny text box. Note that for Spirits, once imported, you can adjust the Spirit Strength rating to adjust some of the characteristics.</div>
                    <!-- <div class="sheet-label sheet-floatRight">Mask:
                    <textarea name="attr_textImportMask" placeholder="text import" class="sheet-textimport" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Important Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'."></textarea>
                  </div> -->
                  <input name="attr_textImportCreature" class="sheet-hidden sheet-testPlaceholder" placeholder="text import">
                  <div class="sheet-hideIfNotPlaceholder"><span  class="sheet-label">Creature : <textarea name="attr_textImportCreature" placeholder="text import"  class="sheet-textimport" title="Into this little text box, Copy and Paste whatever huge block of text describes the Creature in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import the creature."></textarea></span></div>
                </div>

                <!--Masks-->
                <div class="sheet-HideIfPC">
                  <span class="sheet-table-data sheet-txtShortShort sheet-label">Masks: </span>
                  <div style="font-size: x-small;">
                    This section records the masks and other automatic modifiers, so that you can add / import / delete them.
                    Deleting will reverse the modifications to values (Attributes, Characteristics, Ranks), but doesn't delete Powers and Maneuvers
                  </div>
                  <fieldset class="repeating_masks">
                    <div class="sheet-nowrap">
                      <input name="attr_MSK_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                      <input name="attr_MSK_Name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                      <textarea name="attr_MSK_textImport" placeholder="text import" class="sheet-textimport sheet-hideIfNotPlaceholder" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Important Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'."></textarea>
                      <input type="text" readonly name="attr_MSK_Name" class="sheet-txtShort sheet-bordered-bottom sheet-text-left sheet-hideIfPlaceholder" placeholder="Name" title="@{repeating_masks_X_MSK_Name}: Lists the Masks applied to the character. Import to add, but you can delete here.">
                      <label class="sheet-autoexpand-wrap sheet-hideIfPlaceholder" title="@{repeating_masks_X_MSK_Details}: Mask Data.">
                        <input name="attr_MSK_Details" type="text" value="0" readonly>
                        <span name="attr_MSK_Details" class="sheet-autoexpand" readonly></span>
                      </label>
                    </div>
                  </fieldset>
                </div>
                  <!--This hidden field is for expoting creatures for compendium-->
                  <!-- <div><textarea style="height:60px;" name="attr_textExport" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"   ></textarea></div> -->
                </div>

              <!--Section Core - Non Creation Title-->
              <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-ShowIfObject">
                <div class="sheet-ShowIfObject sheet-HideIfNotObject"></div>
                <div class="sheet-HideIfNotOverview">
                  <label title="@{attr_tab1-attrib-view} : Toggles the view of Attribute in the left pane .">
                    <input type="checkbox" name="attr_tab1-attrib-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab1-defense-view} : Toggles the view of Defenses in the left pane .">
                    <input type="checkbox" name="attr_tab1-defense-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab1-mods-view} : Toggles the view of Modifiers in the left pane .">
                    <input type="checkbox" name="attr_tab1-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                </div>
                <div class="sheet-HideIfNotCombat">
                  <label title="@{attr_tab2-attrib-view} : Toggles the view of Attribute in the left pane .">
                    <input type="checkbox" name="attr_tab2-attrib-view" value="1"  class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab2-defense-view} : Toggles the view of Defenses in the left pane .">
                    <input type="checkbox" name="attr_tab2-defense-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                  <label title="@{attr_tab2-mods-view} : Toggles the view of Modifiers in the left pane .">
                    <input type="checkbox" name="attr_tab2-mods-view" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                  </label>
                </div>


                <div class="sheet-HideIfNotOverview sheet-ShowIfObject">Overview</div>
                <div class="sheet-HideIfCreature sheet-HideIfNotCombat sheet-ShowIfObject">Talents, Knacks and Skills</div>
                <div class="sheet-HideIfNotCreature sheet-HideIfNotCombat sheet-ShowIfObject">Powers</div>
                <div class="sheet-ShowIfObject">

                  <label title="@{attr_overview-combat-param-mode} : Toggles the parameters mode ." class="sheet-HideIfObject">
                    <input type="checkbox" name="attr_overview-combat-param-mode" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
                  </label>
                  <label title="@{attr_DSP-Race-edit-mode} : Toggles the edit mode." class="sheet-HideIfCreature sheet-HideIfNotOverview">
                    <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                  <label title="@{attr_CreationMode} : Toggles the Creation mode ." class="sheet-HideIfNotCreature sheet-HideIfNotOverview">
                    <input type="checkbox" name="attr_CreationMode" value="1"  class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                </div>
              </div>
            </div>    <!-- ***********  End of Section Core/Combat title -->





              <!--**************************  Start of Section Core & Combat parameters -->
        <input type="checkbox" name="attr_overview-combat-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
        <div class="sheet-section sheet-section-core sheet-section-combat sheet-HideIfNotCloseChecked sheet-bordered ">
          <div class="sheet-text-centered"><b class="sheet-heading"> Header Parameters</b></div>
          <div>
            <span class="sheet-nowrap sheet-label sheet-api"> Karma: Auto Mode :
              <select name="attr_show_karma_auto" class="sheet-selShort" title="@{show_karma_auto}   Enables the selection of the Karma Auto Mode, where each individual action can be set to automatically spend Karma or not." >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
          </div>
          <div>
            <span class="sheet-nowrap sheet-label">
              Damage - Stun: <select name="attr_show_damage_stun" class="sheet-selShort" title="@{show_damage_stun}   Show or Hide the Stun Damage and other Damage Details." >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
            <span class="sheet-nowrap sheet-label">
              Wound Threshold :<select name="attr_show_wound_treshold" class="sheet-selShort" title="@{show_wound_treshold} Show a Wound Threshold Box in the header together with a Modifier" >
                <option value="0" selected>Hide </option>
                <option value="1">Show </option>
              </select>
            </span>
          </div>
          <div>
            <span class="sheet-nowrap sheet-label" title="@{show_options_status}   Toggles the display of the options and statuses in the header, either just the basic ones, or all of them">
              Combat Options and Situation Modifiers : <select name="attr_show_options_status" class="sheet-selShort"  >
                <option value="0" selected title="Show the most common Combat Options and Statuses, with labels">Basic </option>
                <option value="1" title="Show the most common Combat Options and Statuses, with labels">All </option>
              </select>
            </span>
          </div>
          <div class="sheet-text-centered"><b class="sheet-heading"> Left Panes Parameters</b></div>
          <div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_actnefct_toggle}   Show or Hide the Action/Effect Toggles for the Attributes. These allows to select between rolling an Action or an Effect tets, that have different modifiers applying to them.">
                Attributes - Effect and Action Toggle:
                <select name="attr_show_actnefct_toggle" class="sheet-selShort" title="@{show_actnefct_toggle}   Show or Hide the Natural Defenses Toggle." >
                  <option value="0" selected>Hide </option>
                  <option value="1">Show </option>
                </select>
              </span>
            </div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_natural_toggle}   Show or Hide the Natural Defenses Toggle. Natural Defenses are the value of PD, MD, SD, PA, and MA, independantly from any equipment, but taking into account Discipline bonuses">
                Defenses - Natural Value toggle <select name="attr_show_natural_toggle" class="sheet-selShort"  >
                  <option value="0" selected>Hide </option>
                  <option value="1">Show </option>
                </select>
              </span>
            </div>
          </div>

          <div class="sheet-text-centered"><b class="sheet-heading"> Overview Combat Section Parameters</b></div>
          <div>
            <div>
              <span class="sheet-nowrap sheet-label" title="@{show_overview_miscpool}   Show or Hide the Miscellaneous Pools and Movement in the Overview and Combat">
                Overview & Combat- Misc Pools and Movement  <select name="attr_show_overview_miscpool" class="sheet-selShort"  >
                  <option selected value="0" >Hide </option>
                  <option  value="1" >Show </option>
                </select>
              </span>
            </div>
            <div>
              <!-- <span class="sheet-nowrap sheet-label" title="@{show_combat_miscpool}   Show or Hide the Miscellaneous Pools and Movement in the Overview">
                Combat - Misc Pools and Movement  <select name="attr_show_combat_miscpool" class="sheet-selShort"  >
                  <option selected value="0" >Hide </option>
                  <option  value="1" >Show</option>
                </select>
              </span> -->
            </div>
            <div>
              Optional Displays :
              <button class="sheet-button-nodice sheet-text-button" name="act_setalloptions" type="action"
              title="act_setalloptions:   Clicking this button will set All Options.">
              Set All
              </button>
              <button class="sheet-button-nodice sheet-text-button" name="act_resetalloptions" type="action"
              title="act_resetalloptions:   Clicking this button will reset All Options.">
              Reset All
              </button>
            </div>
          </div>
        </div>    <!-- end Core and Combat parameters -->


                <!--**************************  Start of Section Core Content***Other Sections are also labelled section-core to display in the overview -->
                <!--**************************  Sections are split between title and Content to allow for Parameter Div -->
        <div class="sheet-section sheet-section-core">    <!--Section Core - Discipline and Race-->
          <div class="sheet-Creation sheet-headerbar" title="Refer to Player Guide Edition 4 p.58."> <b class="sheet-creation-order">1-</b> Choose a Race and Discipline </div>
          <div class="sheet-Creation sheet-HideIfCreature sheet-small"> Racial Abilities will be automatically added</div>
          <div class="sheet-content sheet-flex-container sheet-flexwrap">
                  <!-- Section Core- First DSP Fieldset-->
            <div class="sheet-nowrap sheet-HideIfCreature">
              <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked hidden class="sheet-testRepEditMode">
              <span>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-txtMedplus">  &nbsp;Discipline / Other&nbsp;</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-txtMed sheet-HideIfNotEditMode">  Type</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-numShort" title="This might be Spirit Rating, Creature Challenge Rating, Devotion Rating, etc.">&nbsp;Circle&nbsp;</b>
                <b class="sheet-heading sheet-text-center sheet-fixed-width sheet-numShort sheet-HideIfNotEditMode">Durability</b>
              </span><br>
              <datalist id="disciplineonly">
                <option value="Air Sailor"         title="Air Sailor Durability 5"       >Air Sailor</option>
                <option value="Archer"             title="Archer Durability 5"           >Archer</option>
                <option value="Beastmaster"        title="Beastmaster Durability 7"      >Beastmaster</option>
                <option value="Boatman"            title="Boatman Durability 5"          >Boatman</option>
                <option value="Cavalryman"         title="Cavalryman Durability 7"       >Cavalryman </option>
                <option value="Elementalist"       title="Elementalist Durability 3"     >Elementalist </option>
                <option value="Gauntlet"           title="Gauntlet Durability 7"         >Gauntlet</option>
                <option value="Illusionist"        title="Illusionist Durability 3"      >Illusionist </option>
                <option value="Nethermancer"       title="Nethermancer Durability 3"     >Nethermancer </option>
                <option value="Sailor"             title="Sailor Durability 5"           >Sailor</option>
                <option value="Scout"              title="Scout Durability 5"            >Scout </option>
                <option value="Shaman"             title="Shaman Durability 3"           >Shaman</option>
                <option value="Sky Raider"         title="Sky Raider Durability 7"       >Sky Raider </option>
                <option value="Swordmaster"        title="Swordmaster  Durability 7"      >Swordmaster </option>
                <option value="Thief"              title="Thief  Durability 5"            >Thief </option>
                <option value="Troubadour"         title="Troubadour  Durability 5"       >Troubadour </option>
                <option value="Warrior"            title="Warrior  Durability 7"          >Warrior </option>
                <option value="Weaponsmith"        title="Weaponsmith  Durability 5"      >Weaponsmith </option>
                <option value="Wizard"             title="Wizard  Durability 3"           >Wizard </option>
              </datalist>

              <datalist id="discipline">
                <option disabled> Discipline</option>
                <option value="Air Sailor"         title="Air Sailor Durability 5"       >Discipline</option>
                <option value="Archer"             title="Archer Durability 5"           >Discipline</option>
                <option value="Beastmaster"        title="Beastmaster Durability 7"      >Discipline</option>
                <option value="Boatman"            title="Boatman Durability 5"          >Discipline</option>
                <option value="Cavalryman"         title="Cavalryman Durability 7"       >Discipline</option>
                <option value="Elementalist"       title="Elementalist Durability 3"     >Discipline</option>
                <option value="Gauntlet"           title="Gauntlet Durability 7"         >Discipline</option>
                <option value="Illusionist"        title="Illusionist Durability 3"      >Discipline</option>
                <option value="Nethermancer"       title="Nethermancer Durability 3"     >Discipline</option>
                <option value="Sailor"             title="Sailor Durability 5"           >Discipline</option>
                <option value="Scout"              title="Scout Durability 5"            >Discipline</option>
                <option value="Shaman"             title="Shaman Durability 3"           >Discipline</option>
                <option value="Sky Raider"         title="Sky Raider Durability 7"       >Discipline</option>
                <option value="Swordmaster"        title="Swordmaster  Durability 7"      >Discipline</option>
                <option value="Thief"              title="Thief  Durability 5"            >Discipline</option>
                <option value="Troubadour"         title="Troubadour  Durability 5"       >Discipline</option>
                <option value="Warrior"            title="Warrior  Durability 7"          >Discipline</option>
                <option value="Weaponsmith"        title="Weaponsmith  Durability 5"      >Discipline</option>
                <option value="Wizard"             title="Wizard  Durability 3"           >Discipline</option>
                <option disabled> Path</option>
                <option value="Brother of Stone"   title="Path Brother of Stone"         >Path</option>
                <option value="Fire Eater"         title="Path Fire Eater"               >Path</option>
                <option value="Horror Stalker"     title="Path Horror Stalker"           >Path</option>
                <option value="Journeyman"         title="Path Journeyman"               >Path</option>
                <option value="Liberator"          title="Path Liberator"                >Path</option>
                <option value="Messenger"          title="Path Messenger"                >Path</option>
                <option value="Outcast"            title="Path Outcast"                  >Path</option>
                <option value="Purifier"           title="Path Purifier"                 >Path</option>
                <option value="Scholar"            title="Path Scholar"                  >Path</option>
                <option value="Tail Dancer"        title="Path Tail Dancer"              >Path</option>
                <option value="Windmaster"         title="Path Windmaster"               >Path</option>
                <option value="Woodsmen"           title="Path Woodsmen"                 >Path</option>
                <option disabled> Questor</option>
                <option value="Questor-Astendar"   title="Astendar - Love, Arts, Music."></option>
                <option value="Questor-Chorrolis"  title="Chorrolis - Wealth, Trade, Envy, Desire."></option>
                <option value="Questor-Dis"        title="Dis - Confusion, Unnecessary Work, Complex Bureaucratic Hierarchies, Slavery and Mastery. (Mad version of Erendis: Order, Bureaucracy and Work)"></option>
                <option value="Questor-Floranuus"  title="Floranuus - Revelry, Energy, Victory, Motion."></option>
                <option value="Questor-Garlen"     title="Garlen - Hearth and Healing."></option>
                <option value="Questor-Jaspree"    title="Jaspree - Growth, Care of the Land, Love of the Wilderness."></option>
                <option value="Questor-Lochost"    title="Lochost - Rebellion, Change, Freedom."></option>
                <option value="Questor-Mynbruje"   title="Mynbruje - Justice, Compassion, Empathy, Truth."></option>
                <option value="Questor-Raggok"     title="Raggok - Vengeance, Bitterness, Jealousy. (Mad version of Rashomon: Leadership, Endurance, Tolerance, and Perseverance)"></option>
                <option value="Questor-Thystonius" title="Thystonius - Physical Competition, Valor."></option>
                <option value="Questor-Upandal"    title="Upandal - Building, Construction, Planning."></option>
                <option value="Questor-Vestrial"   title="Vestrial - Manipulation, Deceit. (Mad version of Trickster Prankster)"></option>
                <option disabled> Others</option>
                <option value="Spirit"       title="Use Circle to record Spirit Rating.">Other</option>
                <option value="Creature"     title="Use Circle to record Challenge Rating.">Other</option>
              </datalist>

              <!--Section Core - First fieldset-->
              <fieldset class="repeating_discipline" style="display:block;">
                <div>
                  <input name="attr_DSP_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                  <!--repeating discipline - Name-->
                  <input name="attr_DSP_Name" list="discipline" class="sheet-nowrap sheet-txtMedplus sheet-text-left sheet-LockIfNotEditMode sheet-fancyfont" type="text" title="@{repeating_discipline_X_DSP_Name}   Choose Discipline from Dropdown or type your own." placeholder="Discipline / Other">
                  <input name="attr_DSP_VariantName" type="hidden" value="">


                  <!--repeating discipline - Type-->
                  <input type="checkbox" value="HomeBrew" class="sheet-hidden sheet-testLocked" name="attr_DSP_Name_max">
                   <select name="attr_DSP_Type" class="sheet-nowrap sheet-txtMed sheet-text-left sheet-HideIfNotEditMode sheet-LockIfNotChecked" title="@{repeating_discipline_X_DSP_Type}   Choose Discipline from Dropdown or type your own.">
                    <option value="Discipline">Discipline</option>
                    <option value="Path-Journeyman">Path-Journeyman</option>
                    <option value="Path-Master">Path-Master</option>
                    <option value="Questor">Questor</option>
                    <option value="Other">Other</option>
                  </select>

                  <!-- <input readonly type="text" name="attr_DSP_Type" class="sheet-nowrap sheet-txtMed sheet-text-left sheet-HideIfNotEditMode" title="@{repeating_discipline_X_DSP_Type}   Choose Discipline from Dropdown or type your own."> -->


                  <!--repeating discipline - Circle-->
                  <input name="attr_DSP_Circle" class="sheet-numShorter sheet-Big sheet-LockIfNotEditMode" value="0" min="0" title="@{repeating_discipline_X_DSP_Circle}:   Characters Circle in this Discipline, Rank in their 'Questor Devotion' or Path, or Creature Challenge Rating or Spirit Rank." type="number">&nbsp;
                  <input name="attr_DSP_Circle_max" value="-1" type=hidden title="@{DSP_Circle_max} stores the last Circle where the create talents button was used in order to decide if it must displayed or not">


                  <!--repeating discipline - Durability-->

                  <span class="sheet-HideIfNotEditMode sheet-numShort sheet-fixed-width" title="@{repeating_discipline_X_DSP_Durability}:   Durability value for this Discipline. How much the unconsciousness rating is raised for each circle.">
                    <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Type"  value="Questor"   type="checkbox" >
                    <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Type"  value="Path-Journeyman"   type="checkbox" >
                    <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Type"  value="Path-Master"   type="checkbox" >
                    <input class="sheet-testLocked sheet-hidden" name="attr_DSP_Name_max"  value="HomeBrew"   type="checkbox" >
                    <input name="attr_DSP_Durability" type="number" class="sheet-Locked sheet-UnlockIfChecked sheet-numShort sheet-HideIfChecked"   value="0" min="0"  title="@{repeating_discipline_X_DSP_Durability}:   Durability value for this Discipline. How much the unconsciousness rating is raised for each circle."                >
                  </span>

                  <!--repeating discipline - Button-->
                  <span class="sheet-HideIfEditMode sheet-fixed-width sheet-txtMed">
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_DSP_Type" checked value="Discipline" type="checkbox">
                    <button class="sheet-text-button ui-draggable sheet-HideIfNotCloseChecked sheet-api"
                    name="roll_DSP_halfMagic"
                    type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ foreach:sct:c~ modValue : ?{Modification|0} ~ K-ask: ?{How many Karma to spend on this test|0} : 0 ~ Value: ?{What Attribute|Dex|Str|Tou|Per|Wil|Cha}~ Reason: @{DSP_Name} @{DSP_Circle} Half-Magic ?{What Attribute} test~ Roll: @{DSP_Circle}"
                    title="%{selected|DSP_halfMagic}   Roll a half magic check for this Character.">Half Magic
                   </button>
                    <input class="sheet-testChecked sheet-hidden" name="attr_DSP_Type" value="Questor" type="checkbox">
                    <button class="sheet-text-button ui-draggable sheet-HideIfNotChecked sheet-api"
                    name="roll_DSP_Questor"
                    type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ foreach:sct:c~ modValue: ?{Modification|0} ~ K-ask: 0: ?{How many DP to spend on this test|0}~ Value: Cha~ Reason: @{DSP_Name} Devotion Rank @{DSP_Circle}~ Roll: @{DSP_Circle}"
                    title="%{selected|DSP_Questor}   Roll a Questor Devotion test.">Devote  </button>
                    <button class="sheet-text-button ui-draggable sheet-HideIfNotChecked sheet-NoAPI"
                    name="roll_DSP_QuestorNoAPI"
                    type="roll"
                    value="@{RollType} &amp;{template:default} {{name=Devotion}} {{Step: [[?{Step|@{Cha}+@{DSP_Circle}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                    title="%{selected|DSP_QuestorNoAPI}   Roll a Questor Devotion test.">Devote  </button>
                  </span>


                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfPrint">
                    <!--Compendium Button-->
                    <input type="checkbox" name="attr_DSP_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                    <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_DSP_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                  </span>

                  <!--repeating discipline - Links-->
                  <span class="sheet-HideIfNotEditMode">
                    <input name="attr_DSP_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                    <input name="attr_DSP_LinksProvideValue_max" type="hidden" value="">
                    <input name="attr_DSP_LinksProvideValue" type="hidden" value="">
                  </span>




                  <input type="checkbox" value="1" name="attr_DSP_show-createbutton" class="sheet-hidden sheet-testCloseChecked">
                  <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode">
                  <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_createtalents" type="action"
                  title="act_createtalents:   Clicking this button will create the Circle 1 Talents for this discipline, and record for the LP calculation the costs of multi-disciplining if it is a second discipline .">
                  Add Talents starting at Circle :
                  <input name="attr_DSP_Circle_max" type="number" class="sheet-numShorter sheet-small" value="0" readonly>
                  </button>
                </div>
                </div>

                  <!--Test if Path-->
                  <div class="sheet-HideIfNotEditMode">
                  <input name="attr_DSP_Type" type="hidden" class="sheet-testDSPPath">
                  <div class="sheet-UnHideIfDSPPath sheet-hidden">
                    <b class="sheet-label">Base Discipline :</b>
                    <input type="text" list="disciplineonly" name="attr_DSP_BaseDisc" class="sheet-nowrap sheet-txtMed sheet-text-left" title="@{repeating_discipline_X_DSP_BaseDisc}  For pathes, this is the base Discipline, to which Thread Weaving the Discipline Knack was attached, and that will benefit from the paths modifiers." placeholder="Discipline">
                  </div>
                </div>
                  <!-- <b class="sheet-label">Data :</b>
                  <input type="text"  name="attr_DSP_Name_max" class="sheet-nowrap sheet-txtMed sheet-text-left" title="@{repeating_discipline_X_DSP_Name_max}  Holds the data for the Discipline. For Homebrew Discipline edit directly the data."> -->


                  <input type="checkbox" value="HomeBrew" class="sheet-hidden sheet-testCloseChecked" name="attr_DSP_Name_max">

                  <div class="sheet-HideIfNotEditMode sheet-HideIfNotCloseChecked">
                    <span class="sheet-label">Homebrew</span>
                  </div>

              </fieldset>
            </div>



                  <!--Section Core - Race-->
                  <input type="checkbox" name="attr_DSP-Race-edit-mode" value="1" checked hidden class="sheet-testRepEditMode">
            <div>
              <span>
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-txtShort" title="@{Race}   Character Race">   Race   </b>
              </span>
              <span class="sheet-HideIfNotEditMode">
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-numShort" title="@{Karma-Modifier}:   Races Karma Modifier.">   Karma    </b>
              </span>
              <span class="sheet-HideIfNotCreature">
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-numLong sheet-HideIfSpirit" title="@{SrRating}   Challenge or Spirit Rating">   Chlng Rtng   </b>
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-numLong sheet-HideIfNotSpirit" title="@{SrRating}   Challenge or Spirit Rating">   Spirit Rtng   </b>
              </span>
              <span class="sheet-HideIfNotCreature sheet-HideIfNotEditMode">
                <b class="sheet-heading sheet-text-centered sheet-titlespan sheet-fixed-width sheet-numLong" title="@{Creature-Durability}   This Durability adds 5 to Unconsciousness and Death Rating per Rank. Can be used for Enhance Animal Companion or to quickly adjust a homebrew creature"> "Durability"   </b>
              </span>
              <br>
              <datalist id="race">
                <option value="Dwarf" title="Movement Rate 10, Karma Modifier 4, Heat Sight, Strong Back."> Dwarf</option>
                <option value="Elf" title="Movement Rate 14, Karma Modifier 4, Low Light Vision."> Elf</option>
                <option value="Human" title="Movement Rate 12, Karma Modifier 5, Versatility."> Human</option>
                <option value="Obsidiman" title="Movement Rate 10, Karma Modifier 3, Increased Wound Threshold +3, Natural Armor +3.">    Obsidiman</option>
                <option value="Ork" title="Movement Rate 12, Karma Modifier 5, Gahad, Low Light Vision."> Ork</option>
                <option value="Troll" title="Movement Rate 14, Karma Modifier 3, Heat Sight."> Troll</option>
                <option value="T'skrang" title="Movement Rate 12, Karma Modifier 4, Tail Combat."> T'skrang</option>
                <option value="Windling" title="Movement Rate 6/16, Karma Modifier 6, Astral Sight, Flight, Increased Physical Defense +2.">  Windling</option>
                <option value="Blood Elf" title="Movement Rate 14, Karma Modifier 4, Low Light Vision, Longing, Protected, Thorned.">  Blood Elf</option>
                <!--            <option value="9" title="Movement Rate 12, Karma Modifier 5, Versatility."> Human - Vorst</option>-->
                <!-- <option value="Other" title="Not a standard name-giver. Might be creature, spirit or Horror.">    Other</option> -->
                <option value="Creature" title="Creature.">    Creature</option>
                <option value="Spirit" title="Spirits.">    Spirit</option>
                <option value="Dragon" title="Dragons and Dragonlike creatures.">    Dragon</option>
                <option value="Horror" title="Horror or Horror Construct.">    Horror</option>
              </datalist>

              <input name="attr_Race" type="text" class="sheet-txtShort sheet-LockIfNotEditMode sheet-fancyfont" title="@{Race}   Character Race" list="race" placeholder="Race" value="">

              <input name="attr_Karma-Modifier" class="sheet-numShort sheet-HideIfNotEditMode sheet-Locked sheet-UnlockIfHomeBrew sheet-UnlockIfCreature" type="number" value="0"  title="@{Karma-Modifier}:   Races Karma Modifier.">

              <span class="sheet-text-centered sheet-fixed-width sheet-numLong sheet-HideIfNotCreature">
                <input name="attr_SrRating" class="sheet-numLong  sheet-LockIfNotChecked" type="number" value="0"  title="@{SrRating}:   Spirit or Challenge Rating.">
              </span>
              <span class="sheet-text-centered sheet-fixed-width sheet-numLong sheet-HideIfNotEditMode sheet-HideIfNotCreature">
                <input name="attr_Creature-Durability" class="sheet-numLong  sheet-LockIfNotChecked" type="number" value="0"  title="@{Creature-Durability}   Pseudo Durability used to adjust quickly the health ratings with Challenge Ratings">
              </span>

              <span class="sheet-fixed-width sheet-w30px sheet-HideIfPrint">
                <!--Compendium Button-->
                <input type="checkbox" name="attr_Race-buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_Race-buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>

                <input name="attr_WeightAdjustment" type="text" class="sheet-hidden" title="@{WeightAdjustment}   Adjustment to Clothing Armor and Shield Weight as per Race" >

              </span>

              <br>
              <span class="sheet-label sheet-HideIfNotHomeBrew">Homebrew</span>
              <!-- <div class="sheet-HideIfNotHomeBrew sheet-HideIfNotEditMode">
                <span class="sheet-label">Namegiver :
                  <input type="checkbox" value="1" name="attr_isNamegiver">
                </span>
              </div> -->
            </div>


                  <!--Section Core - Movement-->
            <div class="sheet-nowrap0 sheet-titlespan sheet-text-centered sheet-HideIfNotEditMode" title="Movement">
              <input type="checkbox" name="attr_Fly_max" value="1" class="sheet-hidden sheet-testChecked">
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-selShort" title="@{Movement}:   Current Movement Rate. If conditions would lower it less than one, value is set to '1*'">
                Movement
              </b>
              <span class="sheet-hidden sheet-UnHideIfHomeBrew sheet-UnHideIfCreature">
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-selShort" title="@{Fly_max}   Is the character able to fly">
                Flight
              </b>
            </span>
              <b class="sheet-heading sheet-titlespan sheet-text-centered sheet-fixed-width sheet-selShort sheet-HideIfNotChecked" title="@{Fly_max}   Is the character able to fly">
                Fly Move
              </b>
            <br>
              <span class="sheet-fixed-width sheet-selShort sheet-bordered-bottom">
                <input name="attr_Movement-Race" value="10"  type="number" class="sheet-numShort sheet-Big sheet-Locked sheet-UnlockIfHomeBrew sheet-UnlockIfCreature" title="@{Movement-Race}:   Natural Movement Rate determined by race (unmodified)"  >
              </span>

              <span class="sheet-hidden sheet-UnHideIfHomeBrew sheet-UnHideIfCreature">
              <span class="sheet-text-center sheet-fixed-width sheet-selShort" title="@{Fly_max}   Is the character able to fly">
              <input name="attr_Fly_max" type="checkbox" class="" value="1" >
              <span class="sheet-iconstatic sheet-icon-flying sheet-HideIfNotChecked"></span>
              </span>
            </span>

              <span class="sheet-fixed-width sheet-selShort sheet-bordered-bottom sheet-HideIfNotChecked">
                <input name="attr_Fly-Movement-Race" value="16"  type="number" class="sheet-numShort sheet-Big sheet-Locked sheet-UnlockIfHomeBrew sheet-UnlockIfCreature" title="@{Fly-Movement-Race}:   Natural Fly Movement Rate determined by race (unmodified)"  >
              </span>

            </div>

          </div>    <!-- end core Discipline and Race -->
        </div>    <!-- **************************  End of Section Core ***Some other Sections are also labelled section-core to display in the overview -->





              <!-- ************Mini section - Title  Talent/Knacks/Skills are shown on the overview, instead of having one title line for each-->
        <div class="sheet-section sheet-section-core">
          <div class="sheet-headerbar sheet-NotCreation">
            <span class="sheet-HideIfCreature">Talents, Knacks and Skills</span>
            <span class="sheet-HideIfNotCreature">Powers</span>
          </div>
        </div>



              <!-- **************************Start of the Talents section - Title.**********************
              It is also labelled core and combat so that the talents can be shown directly in the overview and combat.
              In Talents all Talents are shown without exception.
              In Overview all the talents are shown, except the spellcasting talents, because they are also shown in a duplicated repeating_talents fieldset located in the section-Spells
              In Combat, only the talents with the CombatSlot checked are shown, and spellcasting talents are not shown for the same reason as overview -->
        <div class="sheet-section sheet-section-talents sheet-section-combat sheet-section-core">
                <!--Section Talents - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab3-attrib-view} : Toggles the view of Attributes in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab3-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab3-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab3-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>

            <div class="sheet-HideIfCreature">Talents</div>
            <div class="sheet-HideIfNotCreature">Powers</div>

            <div class="sheet-HideIfPrint">
              <span class="sheet-info" title="Instructions: This tab is for recording all Talents EXCEPT Matrix Talents that are recorded on the Spell Tab and should NOT be duplicated here.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_talents-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">
                <input type="checkbox" name="attr_talents-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>

          <div class="sheet-Creation sheet-headerbar sheet-HideIfNotCreature" > <b class="sheet-creation-order">4-</b> Assign Power Ranks</div>
          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature" title="Refer to Player Guide Edition 4 p.67"> <b class="sheet-creation-order">4-</b> Assign Talent Ranks</div>
          <input class="sheet-testAttrCosts" name="attr_Talents-Costs" value="8" type="hidden">
          <div class="sheet-Creation sheet-HideIfCreature" title="Refer to Player Guide Edition 4 p.67">
            <span class="sheet-small">Add below the Talents of your discipline, and spend 8 Ranks. Remaining Points :</span>
            <input name="attr_Talents-Costs" class="sheet-numShort sheet-attrCostsRed"
                readonly="readonly" value="8"
                title="@{Talents-Costs}   Number of Talent points remaining from the starting 8."
                type="number">
          </div>
          <div class="sheet-Creation sheet-HideIfCreature sheet-small" title="Refer to Player Guide Edition 4 p.67">Discipline Talents can quickly be added by the "Add Talents" button. Note that with API, the links for Free Talents will be automatically created, but may not appear until the sheet is closed and reopened. Matrixes are set in the "Spells" Section</div>
          <div class="sheet-Creation sheet-HideIfPC" > For NPCs and Creatures, quickly set all Talent/Power Ranks to  :
            <input name="attr_Talents-Default-Rank" class="sheet-numShort"
                value="1"
                title="@{Talents-Default-Rank}"
                type="number">
            <button class="sheet-button-nodice sheet-text-button" name="act_settalentdefault" type="action"
                title="act_settalentdefault:   Clicking this button will set a Default Rank to All Talents /Powers.">
                Set
            </button>
          </div>
        </div>    <!--End of Talents - Header-->

              <!-- ********************************* Start of Section Knacks Header **************** -->
        <div class="sheet-section sheet-section-knacks sheet-section-combat sheet-section-core sheet-NotCreation">

          <!--Section Knacks - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab4-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab4-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab4-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab4-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Knacks
            <div class="sheet-floatRight sheet-HideIfPrint">
              <span class="sheet-info"
              title="Instructions: This tab is for recording Knacks, but can also be used to create combos, by linking to several other properties like Talents.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_knacks-edit-mode} : Toggles the Knack view to edit mode where the main attributes of each Knacks can be changed.">
                <input type="checkbox" name="attr_knacks-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>
        </div>    <!-- ******** End of Knacks Header ******* -->

              <!-- ****************************************** Start of Section Skills -Header *********************************** -->
        <div class="sheet-section sheet-section-skills sheet-section-core sheet-section-combat">
          <!--Section Skills - Header-->
          <div class="sheet-headerbar sheet-NotCreation sheet-headerbar-flex sheet-HideIfCombat sheet-HideIfOverview">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab5-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab5-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab5-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab5-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Skills
            <div class="sheet-floatRight sheet-HideIfPrint">
              <span class="sheet-info"
              title="Instructions: This tab is for recording all Skills EXCEPT spellcasting Skills: Spellcasting, Patterncraft, Willforce, Spell weaving, and Matrix Skills are all recorded on the Spell Tab and should NOT be duplicated here.">i</span>
              <label title="@{attr_repeating-param-mode} : Toggles the view of parameters that affect all repeating sections.">
                <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <label title="@{attr_skills-edit-mode} : Toggles the Skill view to edit mode where the main attributes of each Skills can be changed.">
                <input type="checkbox" name="attr_skills-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
              </label>
            </div>
          </div>

        </div>    <!-- ******** End of Skills Header ******* -->


              <!-- ************************ Start of Repeating Sections Parameters *********************** -->
        <input type="checkbox" name="attr_repeating-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
        <div class="sheet-section sheet-section-talents sheet-section-knacks sheet-section-skills sheet-HideIfNotCloseChecked sheet-bordered">
          <div class="sheet-text-centered"><b class="sheet-heading"> Repeating Sections Parameters</b></div>
          <div>
            <span class="sheet-nowrap sheet-label"> Step Dice :
              <select name="attr_show_repeating_step_dice" class="sheet-selShort" title="@{show_repeating_step_dice}   In the Talents, Skills and Knacks, shows the Dice to be rolled corresponding to a certain step." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>

          <div>
            <span class="sheet-nowrap sheet-label"> Modifier Exceptions :
              <select name="attr_show_repeating_mod_exc" class="sheet-selShort" title="@{show_repeating_mod_exc}   In the Talents, Skills and Knacks, shows the advanced parameters for modifier exceptions. These parameters allow fine tuning of the modifiers that applies to a certain test (for example, active defenses are not affected by Defensive Stance -3 on all Action Tests). Note that the sheet has a database of the main Talents and their modifier exceptions, so you need this option only if you want to override the system." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
            <span class="sheet-nowrap sheet-label"> After roll parameters :
              <select name="attr_show_repeating_success" class="sheet-selShort" title="@{show_repeating_success}   Show all the parameters that affect the behaviour of the system after rolling. This includes special Effects, Displaying a Text, and Visibility." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
            <span class="sheet-nowrap sheet-label"> Links :
              <select name="attr_show_repeating_links" class="sheet-selShort" title="@{show_repeating_links}   Show all the parameters related to links." >
                <option selected value="0" >Hide </option>
                <option value="1" >Show </option>
              </select>
            </span>
          </div>
          <div class="sheet-api">
          <span class="sheet-nowrap sheet-label"> Special :
            <select name="attr_show_repeating_special" class="sheet-selShort" title="@{show_repeating_special}   Shows the Special field, that allows to declare to the system some specific Talents, such as Spellcasting, Initiative, Knockdown or Recovery Replacement." >
              <option selected value="0" >Hide </option>
              <option value="1" >Show </option>
            </select>
          </span>
        </div>
        <div>
          Optional Displays :
          <button class="sheet-button-nodice sheet-text-button" name="act_setalloptions" type="action"
          title="act_setalloptions:   Clicking this button will set All Options.">
          Set All
          </button>
          <button class="sheet-button-nodice sheet-text-button" name="act_resetalloptions" type="action"
          title="act_resetalloptions:   Clicking this button will reset All Options.">
          Reset All
          </button>
        </div>
          <div>
          <span class="sheet-nowrap sheet-label"> Optional Rule - Use All Talents to Advance (PG p453) :
            <select name="attr_uatta" class="sheet-txtMed" title="@{uatta}   Specifies if the optional Use All Talents To Advance Option is to be used to recommend Circle Advancement in the Talent Summary." >
              <option selected value="0" >Core - Disabled </option>
              <option value="1" >Option - Enabled </option>
            </select>
          </span>
          </div>

        </div>      <!-- **** End of repeating sections parameters ************ -->


              <!-- **************************Start of the Talents section - Content.**********************
                It is also labelled core and combat so that the talents can be shown directly in the overview and combat.
                In Talents all Talents are shown without exception.
                In Overview all the talents are shown, except the spellcasting talents, because they are also shown in a duplicated repeating_talents fieldset located in the section-Spells
                In Combat, only the talents with the CombatSlot checked are shown, and spellcasting talents are not shown for the same reason as overview -->
        <div class="sheet-section sheet-section-talents sheet-section-combat sheet-section-core sheet-ShowIfObject">


          <!-- ************************** This is a step table to be shown when printing -->
          <div class="sheet-hidden sheet-ShowIfPrint sheet-bordered sheet-floatRight">
            <div class="sheet-headerbar">
              Steps
            </div>
            <div class="sheet-content">
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;1&nbsp;</b></div><div class="sheet-table-data"> D4-2</div><div class="sheet-table-data"><b>&nbsp;16&nbsp;</b></div><div class="sheet-table-data"> D12+D8+D6</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;2&nbsp;</b></div><div class="sheet-table-data"> D4-1</div><div class="sheet-table-data"><b>&nbsp;17&nbsp;</b></div><div class="sheet-table-data"> D12+2D8</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;3&nbsp;</b></div><div class="sheet-table-data"> D4</div><div class="sheet-table-data"><b>&nbsp;18&nbsp;</b></div><div class="sheet-table-data"> D12+D10+D8</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;4&nbsp;</b></div><div class="sheet-table-data"> D6</div><div class="sheet-table-data"><b>&nbsp;19&nbsp;</b></div><div class="sheet-table-data"> D20+2D6</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;5&nbsp;</b></div><div class="sheet-table-data"> D8</div><div class="sheet-table-data"><b>&nbsp;20&nbsp;</b></div><div class="sheet-table-data"> D20+D8+D6</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;6&nbsp;</b></div><div class="sheet-table-data"> D10</div><div class="sheet-table-data"><b>&nbsp; 21&nbsp;</b></div><div class="sheet-table-data"> D20+2D8 </div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;7&nbsp;</b></div><div class="sheet-table-data"> D12</div><div class="sheet-table-data"><b>&nbsp; 22&nbsp;</b></div><div class="sheet-table-data"> D20+D10+D8</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;8&nbsp;</b></div><div class="sheet-table-data"> 2D6</div><div class="sheet-table-data"><b>&nbsp; 23&nbsp;</b></div><div class="sheet-table-data"> D20+2D10</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;9&nbsp;</b></div><div class="sheet-table-data"> D8+D6</div><div class="sheet-table-data"><b>&nbsp; 24&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D10</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;10&nbsp;</b></div><div class="sheet-table-data"> 2D8</div><div class="sheet-table-data"><b>&nbsp; 25&nbsp;</b></div><div class="sheet-table-data"> D20+2D12</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;11&nbsp;</b></div><div class="sheet-table-data"> D10+D8</div><div class="sheet-table-data"><b>&nbsp; 26&nbsp;</b></div><div class="sheet-table-data"> D20+D12+2D6</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;12&nbsp;</b></div><div class="sheet-table-data"> 2D10</div><div class="sheet-table-data"><b>&nbsp; 27&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D8+D6</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;13&nbsp;</b></div><div class="sheet-table-data"> D12+D10</div><div class="sheet-table-data"><b>&nbsp; 28&nbsp;</b></div><div class="sheet-table-data"> D20+D12+2D8</div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;14&nbsp;</b></div><div class="sheet-table-data"> 2D12</div><div class="sheet-table-data"><b>&nbsp; 29&nbsp;</b></div><div class="sheet-table-data"> D20+D12+D10+D8 </div></div>
              <div class="sheet-table-row"><div class="sheet-table-data"><b>&nbsp;15&nbsp;</b></div><div class="sheet-table-data"> D12+2D6</div><div class="sheet-table-data"><b>&nbsp; 30&nbsp;</b></div><div class="sheet-table-data"> 2D20+2D6</div></div>
            </div>
          </div>    <!--***************End of Step Table****************************-->


                <!--Section Talents - Content-->
          <div class="sheet-content sheet-ShowIfObject">
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">
            <input name="attr_show_repeating_step_dice" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption5">


            <input type="checkbox" hidden value="1" name="attr_talents-edit-mode" class="sheet-testRepEditMode" title="@{attr_talents-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">
            <div class="sheet-HideIfPrint sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfNotEditMode sheet-NotCreation sheet-HideIfCreature" style="width: 95%" title="@{TalentSummary}   Count of all talents base ranks broken down by source category. Includes all Talents on this tab and Matrix.">
              <textarea name="attr_TalentSummary" class="sheet-details-small sheet-text-center" placeholder="Talent Count" readonly> </textarea>
            </div>

            <div class="sheet-sec-spacer sheet-HideIfOverview sheet-HideIfCombat sheet-HideIfCreature"></div>
            <div class="sheet-HideIfOverview sheet-HideIfCombat sheet-HideIfCreature">
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="All" title="All Talents." checked >        <button name="act_tab-talent-filter" value="All" type="action" value="">All</button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="D1" title="Discipline 1.">                 <button name="act_tab-talent-filter" value="D1" type="action" class="sheet-HideIfZeroDisc">Disc. 1</button></button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="D2" title="Discipline 2.">                 <button name="act_tab-talent-filter" value="D2" type="action" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">Disc. 2</button></button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="D3" title="Discipline 3.">                 <button name="act_tab-talent-filter" value="D3" type="action" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">Disc. 3</button></button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="D4" title="Discipline 4.">                 <button name="act_tab-talent-filter" value="D4" type="action" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">Disc. 4</button></button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="QD" title="Questor Devotions.">            <button name="act_tab-talent-filter" value="QD" type="action" class="sheet-HideIfNotQuest">Questor</button></button>
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="PA" title="Path.">                         <button name="act_tab-talent-filter" value="PA" type="action" class="sheet-HideIfNotPath">Path</button></button>
              <!-- <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="Racial" title="Racial and Versatility.">   <button name="act_tab-talent-filter" value="Racial" type="action">Racial</button> -->
              <input type="checkbox" name="attr_tab-talent-filter" class="sheet-tabAdjust" value="Other" title="Others.">                    <button name="act_tab-talent-filter" value="Other" type="action">Other</button>
            </div>
            <!-- <div class="sheet-sec-border-line"></div> -->

            <input type="hidden" name="attr_tab-talent-filter" class="sheet-tabTalentsFilter" value="All">

            <div class="sheet-ShowIfObject">
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-HideIfCreature">&nbsp;Talent Name&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-HideIfNotCreature">&nbsp;Power Name&nbsp;&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <!-- <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode sheet-hidden" title="Exceptions from General Modifiers. Active Defenses  are respectively immune to Defensive Stancepenalties">Exc.</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode sheet-hidden" title="Special Modifiers in addition to General Modifiers. Darkness or Movement Impaired respectively apply penalties to Tests based on Vision or Movement">Sp. Mod</b> -->
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit sheet-ShowIfPrint">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfNotCreature sheet-HideIfObject">Add SR</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfObject">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotOption5">Dice</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfObject">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfObject sheet-ShowIfPrint">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan sheet-HideIfObject">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNoKarma sheet-api">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest sheet-api">DP</b>
            </div>

            <datalist id="talents">

              <!--PG Talents-->
              <option value="Acrobatic Defense"></option>
              <option value="Air Dance"></option>
              <option value="Air Sailing"></option>
              <option value="Air Speaking"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Companion Durability"></option>
              <option value="Animal Possession"></option>
              <option value="Animal Talk"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Armor Mount"></option>
              <option value="Astral Interference"></option>
              <option value="Astral Sight"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Banish"></option>
              <option value="Bank Shot"></option>
              <option value="Battle Bellow"></option>
              <option value="Battle Shout"></option>
              <option value="Blade Juggle"></option>
              <option value="Blood Share"></option>
              <option value="Book Memory"></option>
              <option value="Borrow Sense"></option>
              <option value="Call Animal Companion"></option>
              <option value="Call Missile"></option>
              <option value="Charge"></option>
              <option value="Claw Frenzy"></option>
              <option value="Claw Shape"></option>
              <option value="Climbing"></option>
              <option value="Cobra Strike"></option>
              <option value="Cold Purify"></option>
              <option value="Command Nightflyer"></option>
              <option value="Conceal Object"></option>
              <option value="Conversation"></option>
              <option value="Creature Analysis"></option>
              <option value="Crushing Blow"></option>
              <option value="Danger Sense"></option>
              <option value="Dead Fall"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm"></option>
              <option value="Disarm Trap"></option>
              <option value="Disguise Self"></option>
              <option value="Dispel Magic"></option>
              <option value="Distract"></option>
              <option value="Dominate Beast"></option>
              <option value="Double Charge"></option>
              <option value="Down Strike"></option>
              <option value="Earth Skin"></option>
              <option value="Elemental Hold"></option>
              <option value="Elemental Tongues"></option>
              <option value="Emotion Song"></option>
              <option value="Empathic Sense"></option>
              <option value="Engaging Banter"></option>
              <option value="Enhance Animal Companion"></option>
              <option value="Entertainer"></option>
              <option value="Etiquette"></option>
              <option value="Evidence Analysis"></option>
              <option value="False Sight"></option>
              <option value="Fast Hand"></option>
              <option value="Fearsome Charge"></option>
              <option value="Fireblood"></option>
              <option value="Fire Heal"></option>
              <option value="First Impression"></option>
              <option value="Flame Arrow"></option>
              <option value="Forge Armor"></option>
              <option value="Forge Weapon"></option>
              <option value="Frighten"></option>
              <option value="Gliding Stride"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Hold Thread"></option>
              <option value="Hypnotize"></option>
              <option value="Impressive Display"></option>
              <option value="Inspire Others"></option>
              <option value="Iron Constitution"></option>
              <option value="Item History"></option>
              <option value="Lasting Impression"></option>
              <option value="Leadership"></option>
              <option value="Life Check"></option>
              <option value="Lifesight"></option>
              <option value="Lion Heart"></option>
              <option value="Lock Picking"></option>
              <option value="Long Shot"></option>
              <option value="Maneuver"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Momentum Attack"></option>
              <option value="Mount Attack"></option>
              <option value="Mystic Aim"></option>
              <option value="Mystic Pursuit"></option>
              <option value="Navigation"></option>
              <option value="Orbiting Spy"></option>
              <option value="Patterncraft"></option>
              <option value="Picking Pockets"></option>
              <option value="Power Mask"></option>
              <option value="Read and Write Language"></option>
              <option value="Research"></option>
              <option value="Resist Taunt"></option>
              <option value="Riposte"></option>
              <option value="Safe Path"></option>
              <option value="Second Attack"></option>
              <option value="Second Shot"></option>
              <option value="Second Weapon"></option>
              <option value="Shield Bash"></option>
              <option value="Slough Blame"></option>
              <option value="Speak Language"></option>
              <option value="Spellcasting"></option>
              <option value="Spirit Hold"></option>
              <option value="Spirit Mount"></option>
              <option value="Spirit Talk"></option>
              <option value="Spot Armor Flaw"></option>
              <option value="Sprint"></option>
              <option value="Stealthy Stride"></option>
              <option value="Steel Thought"></option>
              <option value="Steely Stare"></option>
              <option value="Stopping Aim"></option>
              <option value="Summon"></option>
              <option value="Suppress Curse"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Tactics"></option>
              <option value="Taunt"></option>
              <option value="Temper Flesh"></option>
              <option value="Tenacious Weave"></option>
              <option value="Thought Link"></option>
              <option value="Air Weaving"></option>
              <option value="Arrow Weaving"></option>
              <option value="Beast Weaving"></option>
              <option value="Elementalism"></option>
              <option value="Gauntlet Weaving"></option>
              <option value="Illusionism"></option>
              <option value="Nethermancy"></option>
              <option value="Rider Weaving"></option>
              <option value="River Weaving"></option>
              <option value="Scout Weaving"></option>
              <option value="Sea Weaving"></option>
              <option value="Shamanism"></option>
              <option value="Sky Weaving"></option>
              <option value="Story Weaving"></option>
              <option value="Thief Weaving"></option>
              <option value="Thread Smithing"></option>
              <option value="Thread Weaving"></option>
              <option value="War Weaving"></option>
              <option value="Weapon Weaving"></option>
              <option value="Wizardry"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tiger Spring"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="True Shot"></option>
              <option value="True Sight"></option>
              <option value="Unarmed Combat"></option>
              <option value="Versatility"></option>
              <option value="Waterfall Slam"></option>
              <option value="Wheeling Attack"></option>
              <option value="Wheeling Defense"></option>
              <option value="Wilderness Survival"></option>
              <option value="Willforce"></option>
              <option value="Wind Catcher"></option>
              <option value="Winning Smile"></option>
              <option value="Wood Skin"></option>
              <option value="Wound Balance"></option>

            </datalist>


                  <!--Section Talents - Fieldset-->
            <fieldset class="repeating_talents">
              <input name="attr_T_Type" type="hidden" value="D1-Novice" class="sheet-talentType" >
              <div class="sheet-filter-box2 sheet-ShowIfObject">
              <input name="attr_T_Special" type="hidden" value="1" class="sheet-spelltab" >
              <input name="attr_T_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" >
              <div class="sheet-filter-box sheet-ShowIfObject">
                <span class="sheet-hidden"><input name="attr_T_Target-TA" type="text"> <input name="attr_T_RollType" type="text"><input name="attr_T_ModPrefix" type="hidden" value="?"> </span>
                      <!--Talent Fieldset - Main Line-->
                <input type="hidden"   class="sheet-testTOSelector" name="attr_T_Name">
                <div class="sheet-ShowIfObject sheet-HideIfTOSelector" style="margin:0px; ">    <!--Talents Fieldset - Button & Name-->
                  <input name="attr_T_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_T_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target}~  @{T_RollType}~  foreach:sct:ust:c~ modValue : @{T_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~Strain:@{T_Strain_max}~ Action: T: @{T_RowID} "
                    title="%{selected|Roll_T_Roll-fromSheet} Roll this Talent Test.">
                    <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_T_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target-TA}~  @{T_RollType}~  foreach:sct:ust:c~ modValue : @{T_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~Strain:@{T_Strain|max}~  Action: T: @{T_RowID}"
                    title="%{selected|Roll_T_Roll} Roll this Talent Test.   This version uses T_Target-TA instead of T_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>

                    <button class="sheet-text-button sheet-NoAPI" name="roll_T_Roll-NoAPI" type="roll"
                    value="@{T_RollType} &{template:rolltargetnumber} @{T_Target-NoAPI} {{header=@{charName}: @{T_Name}}} {{Step=[[?{Step|@{T_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{T_DisplayText} @{T_SuccessText}}}"
                    title="%{selected|Roll_T_Roll-NoAPI} Roll this Talent Test.">
                    <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <input name="attr_T_Name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <input name="attr_T_Name" type="text" list="talents" class="sheet-HideIfNotEditMode sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom sheet-HideIf1879" placeholder="Name">
                    <input name="attr_T_Name" type="text" list="talents" class="sheet-HideIfNotEditMode sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom sheet-HideIf1879" placeholder="Name">
                    <input name="attr_T_Name" type="text"  class="sheet-HideIfNotEditMode sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name">
                    <input name="attr_T_Name" type="text"  class="sheet-HideIfNotEditMode sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name">
                  </span>


                  <input name="attr_T_Name" type="text"  hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 100px;" title="@{repeating_talents_X_T_textImport}:   Talent Text import: This only shows up if Name is empty.">
                    <textarea type="text" name="attr_T_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">                        If you have a PDF copy of the book, you can copy an entire Talent or Questor Devotion description (starting with the name,
                      and including everything) and paste it into this tiny text box. It will be parsed and whatever fields
                      can be set based upon the text will be. You will still need to manually set some of the fields, most importantly "Modifiers".
                      You can also just type the Talent Name, and it will just be Autofilled with settings from the database.
                    </span>
                  </span>

                        <!--Talents Fieldset - Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" title="@{repeating_talents_X_T_Mod-Type}  What modifiers does this Talent apply.">
                    <span class="sheet-iconselect-icon">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>

                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Damage Poison"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-poisoned" title="No Modifiers, because it is a poison"></span>

                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-initiative" title="Modifiers that apply to Initiative Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="JumpUp"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-jumpup" title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Mod-Type" value="NoRoll"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                    </span>
                    <select name="attr_T_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                      <option value="0" title="No modifiers at all."> None</option>
                      <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                      <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                      <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                      <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                      <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                      <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                      <option value="Damage Poison" title="No modifiers because it is a poison."> Poison</option>

                      <option value="Init" title="All Initiative Modifiers applyto this test.">Initiative</option>
                      <option value="JumpUp" title=title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown.">Jump Up</option>
                      <option value="NoRoll" title="This Talent does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                    </select>
                    <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->

                    <input class="sheet-testCloseChecked" name="attr_T_Special" hidden value="Recovery" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                    <input class="sheet-testCloseChecked" name="attr_T_Special" hidden value="Knockdown" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                  </span>

                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry fields -->
                  <input type="hidden" name="attr_T_Mod-Type" class="sheet-testModType"   >
                        <!--Talents Fieldset - Rank-->
                  <span class="sheet-titlespan sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit sheet-ShowIfPrint">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                        <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_T_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <input name="attr_T_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_talents_X_T_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                      <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                      </span>
                    </span>
                  </span>

                    <span class="sheet-titlespan sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit">
                    <span class="sheet-stepSpan sheet-bordered-bottom sheet-NoAPI">
                      <input name="attr_T_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                      </span>
                    </span>

                          <!--With api, Free Talents have no editable Rank, managed through a link to discipline-->
                    <span class="sheet-HideIfNotEditMode sheet-api">
                      <input name="attr_T_Type" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Free">
                      <span class="sheet-HideIfCloseChecked sheet-stepSpan sheet-bordered-bottom"> <!--Not a Free Talent, Normal Edit-->
                        <span title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                          <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_T_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                        <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                          <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                        </span>
                      </span>

                      <span class="sheet-HideIfNotCloseChecked">
                        <input name="attr_T_LinksGetValue" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                        <span class="sheet-HideIfCloseChecked sheet-stepSpan sheet-bordered-bottom"> <!--Free Talent, Link Existing, Rank is readonly-->
                          <input name="attr_T_LinkValue" readonly value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_talents_X_T_LinkValue}:   Characters Base Rank in this talent."  type="number"  >
                          <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                            <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                            <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                            <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                          </span>
                        </span>
                        <span class="sheet-HideIfNotCloseChecked"><!--Free Talent, No Link Existing, Link Button-->
                          <!-- <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                          value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: T : @{T_RowID}"
                          title="@{repeating_talents_X_T_btnSetLink} Set the Links for this Talent. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button> -->
                          <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                          value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Linkadd1: T : @{T_RowID} : ?{What are we linking this to|Discipline,DSP|Talent,T|Skill,SK|Weapon,WPN|Thread Item,TI|Attribute} : ?{Name to link to (Make sure substring is an exact match, including case. Example - Melee)} "
                          title="@{repeating_talents_X_T_btnAddLink} Set the Links for this Talent. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        </span>
                      </span>
                    </span>
                  </span>

                  <!--Talents Fieldset -  addSR-->
            <span class="sheet-fixed-width sheet-w50px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-HideIfNotCreature sheet-HideIfObject" title="@{repeating_talents_X_T_AddSR} For Creatures, add the Challenge Rating or Strength Rating to the Rank.">
                <select name="attr_T_AddSR" class="sheet-numShort">
                  <option value="0" selected title="Do not add Circle or SR.">0</option>
                  <option value="1" title="Add Circle or SR.">1</option>
                  <option value="0.5" title="Add 1/2 Circle or SR."></option>
                </select>
              </>
            </span>


                        <!--Talents Fieldset -  Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-HideIfObject" title="@{repeating_talents_X_T_Attribute}  What attribute is associated with this talent.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_talents_X_T_Attribute}  What attribute is associated with this talent.">
                      <select name="attr_T_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This talent does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                        <option value="Initiative" title="Initiative. Use only for Initiative replacement talents">Initiative</option>

                      </select>
                    </span>
                  </span>

                        <!--Talents Fieldset - Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-bordered-bottom">
                      <span title="@{repeating_talents_X_T_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_T_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_T_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_T_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_T_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_talents_X_T_Step}:   Final action Step for this talent."  type="number"  >
                      <span title="@{repeating_talents_X_T_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                        <input name="attr_T_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_T_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                          <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode">
                      <input name="attr_T_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>


                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfNotOption5">
                      <input name="attr_T_Step_max" type="text" readonly class="sheet-w100px sheet-bordered-bottom sheet-HideIfNoRoll" title="@{repeating_talents_X_T_Step_max}:   Dice to be rolled for the corresponding step.">
                  </span>

                        <!--Talents Fieldset -  Targets
                        Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_T_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">

                      <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Talent does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Talent targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Talent targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Talent targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets individually the Physical Defense of each targets."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets individually the Mystic Defense of each targets."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets individually the Social Defense of each targets."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_T_Target" title="@{repeating_talents_X_T_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Each --</option>
                        <option value="PD-each" title="Targets individually Physical Defense of each target.">PD-each</option>
                        <option value="MD-each" title="Targets individually Mystic Defense of each target.">MD-each</option>
                        <option value="SD-each" title="Targets individually Social Defense of each target.">SD-each</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 10.">10</option>
                      </select>
                    </span>

                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_talents_X_T_Target-NoAPI}  What does this talent target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Talent does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Talent targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Talent targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Talent targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_T_Target-NoAPI">
                        <option selected value=" " title="This Talent does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Talent targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Talent targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Talent targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>

                    <!-- JBF Target Armor when Damage-->

                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">

                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Talent does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_T_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_T_ArmorType" title="@{repeating_talents_X_T_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Talent does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>

                        <!--Talents Fieldset - Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-HideIfObject" title="@{repeating_talents_X_T_Type}  How does the Adept know this talent.">
                    <select name="attr_T_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option disabled class="sheet-HideIfZeroDisc" >-- Discipline 1 --</option>
                      <option value="D1-Novice" class="sheet-HideIfZeroDisc" selected title="This is a Novice Discipline Talent for this character.">Novice</option>
                      <option value="D1-Journeyman" class="sheet-HideIfZeroDisc" title="This is a Journeyman Discipline Talent for this character." >Journeyman</option>
                      <option value="D1-Warden" class="sheet-HideIfZeroDisc" title="This is a Warden Discipline Talent for this character." >Warden</option>
                      <option value="D1-Master" class="sheet-HideIfZeroDisc" title="This is a Master Discipline Talent for this character." >Master</option>
                      <option value="TO1-Novice" class="sheet-HideIfZeroDisc" title="This is a Novice Talent Option for this character." >TO-Novice</option>
                      <option value="TO1-Journeyman" class="sheet-HideIfZeroDisc" title="This is a Journeyman Talent Option for this character." >TO-Journeyman</option>
                      <option value="TO1-Warden" class="sheet-HideIfZeroDisc" title="This is a Warden Talent Option for this character." >TO-Warden</option>
                      <option value="TO1-Master" class="sheet-HideIfZeroDisc" title="This is a Master Talent Option for this character." >TO-Master</option>
                      <option disabled class="sheet-HideIfNotQuest" >-- Questor --</option>
                      <option value="QD-Follower" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Follower</option>
                      <option value="QD-Adherent" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Adherent</option>
                      <option value="QD-Exemplar" class="sheet-HideIfNotQuest" title="This is a Questor Devotion, which we represent as a Talent, but is not.">QD-Exemplar</option>
                      <option disabled class="sheet-HideIfNotPath">-- Path --</option>
                      <option value="PA-Journeyman" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Journeyman Talent.">Path-Journeyman</option>
                      <option value="PA-Warden" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Warden Talent.">Path-Warden</option>
                      <option value="PA-Master" class="sheet-HideIfNotPath" title="This is a Path Talent Option, which is purchased as a Master Talent.">Path-Master</option>
                      <option disabled class="sheet-HideIfNotHuman">-- Versatility --</option>
                      <option value="V-Novice" class="sheet-HideIfNotHuman" title="This is a Novice Versatility Talent for this character.">Versatility Novice</option>
                      <option value="V-Journeyman" class="sheet-HideIfNotHuman" title="This is a Journeyman Versatility Talent for this character.">Versatility Journeyman</option>
                      <option value="V-Warden" class="sheet-HideIfNotHuman" title="This is a Warden Versatility Talent for this character.">Versatility Warden</option>
                      <option value="V-Master" class="sheet-HideIfNotHuman" title="This is a Master Versatility Talent for this character.">Versatility Master</option>
                      <option disabled >-- Others --</option>
                      <option value="Free" title="This is a Free Talent for one of the characters disciplines, and it's rank is always equal to his circle in that discipline.">Free</option>
                      <option value="Racial" title="This Talent is available because of the characters Race.">Racial</option>
                      <option value="Power" class="sheet-HideIfNotCreature" title="This is not really a Talent, it is really a Creature/Horror/Spirit/Dragon, Etc. Power.">Creature Power</option>
                      <option value="Item" title="This talent is granted by an Item such as a Thread Item.">Item</option>
                      <option value="Dummy" title="This is not really a Talent in and of itself, it is a placeholder for a talent-like effect or a combination of multiple talents. For example a warrior with both air dance and tiger spring might create a dummy entry for using both talents at the same time.">Dummy</option>
                      <option value="Special" title="This talent is available due to some special reason.">Special</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">-- Discipline 2 --</option>
                      <option value="D2-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Novice Discipline Talent for this characters 2nd Discipline.">D2-Novice</option>
                      <option value="D2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Journeyman Discipline Talent for this characters 2nd Discipline." >D2-Journeyman</option>
                      <option value="D2-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Warden Discipline Talent for this characters 2nd Discipline." >D2-Warden</option>
                      <option value="D2-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Master Discipline Talent for this characters 2nd Discipline." >D2-Master</option>
                      <option value="TO2-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Novice Talent Option for this characters 2nd Discipline." >TO2-Novice</option>
                      <option value="TO2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Journeyman Talent Option for this characters 2nd Discipline." >TO2-Journeyman</option>
                      <option value="TO2-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Warden Talent Option for this characters 2nd Discipline." >TO2-Warden</option>
                      <option value="TO2-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc" title="This is a Master Talent Option for this characters 2nd Discipline." >TO2-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">-- Discipline 3 --</option>
                      <option value="D3-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Novice Discipline Talent for this characters 3rd Discipline.">D3-Novice</option>
                      <option value="D3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Journeyman Discipline Talent for this characters 3rd Discipline." >D3-Journeyman</option>
                      <option value="D3-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Warden Discipline Talent for this characters 3rd Discipline." >D3-Warden</option>
                      <option value="D3-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Master Discipline Talent for this characters 3rd Discipline." >D3-Master</option>
                      <option value="TO3-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Novice Talent Option for this characters 3rd Discipline." >TO3-Novice</option>
                      <option value="TO3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Journeyman Talent Option for this characters 3rd Discipline." >TO3-Journeyman</option>
                      <option value="TO3-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Warden Talent Option for this characters 3rd Discipline." >TO3-Warden</option>
                      <option value="TO3-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc" title="This is a Master Talent Option for this characters 3rd Discipline." >TO3-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">-- Discipline 4 --</option>
                      <option value="D4-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Novice Discipline Talent for this characters 4th Discipline.">D4-Novice</option>
                      <option value="D4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Journeyman Discipline Talent for this characters 4th Discipline." >D4-Journeyman</option>
                      <option value="D4-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Warden Discipline Talent for this characters 4th Discipline." >D4-Warden</option>
                      <option value="D4-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Master Discipline Talent for this characters 4th Discipline." >D4-Master</option>
                      <option value="TO4-Novice" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Novice Talent Option for this characters 4th Discipline." >TO4-Novice</option>
                      <option value="TO4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Journeyman Talent Option for this characters 4th Discipline." >TO4-Journeyman</option>
                      <option value="TO4-Warden" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Warden Talent Option for this characters 4th Discipline." >TO4-Warden</option>
                      <option value="TO4-Master" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc" title="This is a Master Talent Option for this characters 4th Discipline." >TO4-Master</option>
                    </select>
                  </span>

                  <!--Talents Fieldset - Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder sheet-HideIfObject  sheet-ShowIfPrint" title="{repeating_talents_X_T_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Talents"></span>
                    </span>
                    <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_T_Action" >
                      <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                      <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                      <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                      <option value="Sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                      <option value="NA" title="No Action for certain Talents">NA</option>
                    </select>
                  </span>

                  <!--Talents Fieldset -  Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfObject" title="@{repeating_talents_X_T_Strain}: number of strain points per use">
                    <input name="attr_T_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_T_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_T_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                    <input name="attr_T_Strain_max"  type="hidden" value="0">

                    <!--Strain Formula, show + if there is a Formula-->
                    <input name="attr_T_StrainAdvanced" type="hidden" value="" class="sheet-testEmpty"><span class="sheet-HideIfEmpty sheet-strainadvanced sheet-api">+</span>
                  </span>


                  <!--Talents Fieldset - Karma & DP-->
                  <span class="sheet-hideIfPlaceholder sheet-HideIfObject">
                    <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_T_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_T_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{T_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_T_Karma" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_lessthan3" title="@{T_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="0" > <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="1" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_T_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{T_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_T_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3 ">
                              <option value="0"  title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3 ">
                              <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>

                          </span>
                          <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_morethan3">
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_4" min="0" max="4" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_5" min="0" max="5" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_6" min="0" max="6" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_7" min="0" max="7" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_8" min="0" max="8" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_9" min="0" max="9" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_10" min="0" max="10" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_11" min="0" max="11" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_12" min="0" max="12" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_13" min="0" max="13" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_14" min="0" max="14" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_15" min="0" max="15" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                          </span>
                        </span>
                      </span>
                    </span>
                    <!--JBF End Of Karma Toggle-Simple-->
                    <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_T_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_T_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_T_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_T_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{T_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_T_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{T_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{T_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_T_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_T_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </span>

                        <!--Talents Fieldset - Corrupt Karma-->
                  <span class="sheet-wrap0 sheet-hideIfPlaceholder sheet-HideIfObject" >
                    <input class="sheet-testCloseChecked" name="attr_T_Special" value="CorruptKarma" hidden type="checkbox">
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked sheet-api" name="roll_T_btnCorruptKarma" type="roll"
                    value="!Earthdawn~ SetToken: @{target|to have Karma Corrupted|token_id}~ Misc: CorruptKarma: ?{How many karma to corrupt|1}"
                    title="@{repeating_talents_X_T_btnCorruptKarma} Use this button to 'Corrupt Karma' during the next dice roll. It will transfer some successes from the CK pool to the CK action where it will effect the next rolls that use karma.">Corrupt Karma</button>
                  </span>

                        <!--Talents Fieldset -  Magnifier Icon to show the notes-->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_talents_X_T_ShowNotes}   Show description of Talent/Power">
                      <input type="checkbox" name="attr_T_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_talents_X_T_CombatSlot}  Should this Talent be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_T_CombatSlot" value="1" class="sheet-iconcheckbox">
                      <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode sheet-HideIfObject" title="@{repeating_talents_X_T_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_T_Parameters" value="1" class="sheet-iconcheckbox">
                      <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                    <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                      <!--Compendium Button-->
                      <input type="checkbox" name="attr_T_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                      <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_T_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                    </span>
                  </span>


                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                    <input name="attr_T_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-HideIfCloseChecked">
                      <input name="attr_T_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                      <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                    </span>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_T_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                    </span>
                  </span>
                </div>    <!--End of Play Visalization of the Talents, i.e. when all details are collapsed -->


                <!--v3.02 Talent Options Creation-->

                <input type="hidden" class="sheet-testTOSelector"  value="" name="attr_T_Name">
                <div class="sheet-HideIfNotTOSelector sheet-bordered">

                    <div>Create <input type="text" readonly name="attr_T_Type" class="sheet-txtShort"> Talents:</div>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-0" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto0"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-0"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-0"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-1" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto1"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-1"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-1"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-2" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto2"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-2"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-2"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-3" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto3"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-3"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-3"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-4" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto4"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-4"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-4"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-5" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto5"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-5"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-5"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-6" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto6"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-6"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-6"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-7" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto7"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-7"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-7"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-8" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto8"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-8"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-8"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-9" ></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto9"  type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-9"  class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-9"  title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-10"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto10" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-10" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-10" title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-11"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto11" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-11" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-11" title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-12"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto12" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-12" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-12" title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-13"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto13" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-13" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-13" title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-14"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto14" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-14" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-14" title="Compendium Info Button - Click to open compendium entry"></button></span>
                    <input type="hidden"  value="" class="sheet-testEmpty"  name="attr_T_TO-Name-15"></input><span class="sheet-nowrap0 sheet-HideIfEmpty"><button class="sheet-button-nodice sheet-text-button" name="act_addto15" type="action" title="act_addto:   Add Talent Option."><input type="text" readonly name="attr_T_TO-Name-15" class="sheet-txtMed"></button><button type="compendium" name="attr_T_TO-buttonInfo-15" title="Compendium Info Button - Click to open compendium entry"></button></span>


                </div>



                <!-- <input type="checkbox" hidden name="attr_T_Name" value="Talent Option"  class="sheet-testCloseChecked">
                <div class="sheet-HideIfNotCloseChecked sheet-titlespan sheet-text-left"title="@{repeating_talents_X_T_textImport}:   Talent Text import: This only shows up if Name is empty.">
                  <span class="sheet-label">Import :
                  </span>
                  <textarea type="text" name="attr_T_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>

                </div> -->


                      <!--Talents Fieldset -  Start of Parameter Visalization of the Talents, Where parameters are set-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_T_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom sheet-ShowIfObject">
                        <!--Talent Fieldset - Karma & DP-->
                  <div class="sheet-floatRight sheet-content sheet-api" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label sheet-api" title="@{repeating_talents_X_T_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed<span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_T_Karma-Limit_max" value="1" min="0" max="15" class="sheet-numShort" title="@{repeating_talents_X_T_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label sheet-api" title="@{repeating_talents_X_T_Karma-Limit} : Does this Talent require Karma Points to be spent every time it is used">
                      Karma Required:
                      <input type="checkbox" name="attr_T_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_talents_X_T_Karma-Limit} : Does this Talent require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label sheet-api">
                      <span title="@{repeating_talents_X_T_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed<span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_T_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_talents_X_T_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>

                      <!--Talents Fieldset -  Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_T_Type" type="hidden" value="D1-Novice">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_talents_X_T_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required:
                        <input type="checkbox"  name="attr_T_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_talents_X_T_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                    <!-- <span class="sheet-nowrap0 sheet-HideIfNoRoll" title="@{repeating_talents_X_T_CombatSlot}:   Should this Talent be summarized on the combat tab and placed in a Token Action?">
                    <span class="sheet-api">Tkn Actn</span><span class="sheet-NoAPI">Combat Tab</span>
                    <input name="attr_T_CombatSlot" type="checkbox" value="1" ></span> -->
                  </div>

                  <div class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">
                    <span class="sheet-nowrap sheet-label" title="@{repeating_talents_X_T_Type_max}   Record here Other Disciplines the Talent is a Discipline too, in the form of D2-Novice, D3-Journeyman ...etc">
                      Other Origins :
                      <span class="sheet-autoexpand-wrap">
                        <input name="attr_T_Type_max" type="text" class="sheet-bordered">
                        <span name="attr_T_Type_max" class="sheet-autoexpand"></span>
                      </span>
                    </span>


                  </div>

                        <!--Talent Fieldset - Parameters -->
                  <div class="sheet-content">
                    <!-- <input name="attr_T_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value=""> -->

                    <input type="hidden" hidden name="attr_T_Mod-Type" class="sheet-testModType"  >





                    <!--Strain Formula, edit place-->
                      <span class="sheet-nowrap sheet-label sheet-api" title="@{repeating_talents_X_T_StrainAdvanced}   Advanced Strain Formula for abilities that have a variable Strain">
                        Strain Advanced :
                        <input name="attr_T_Strain" type="number" value="0" class="sheet-numShorter" >
                        <select name="attr_T_StrainAdvanced" class="sheet-selShort">
                          <option selected value="" title="Fixed Strain">Fixed</option>
                          <option value="Ask" title="Ask number of strain">Ask</option>
                        </select>
                      </span>



                          <!--Talent Fieldset - Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-nowrap sheet-label" title="@{repeating_talents_X_T_RollType}   Rolls should be made: public, gm, or hidden?">
                        <!-- <span class="sheet-iconstatic sheet-icon-dice"></span> : -->
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_T_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>

                          <select name="attr_T_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" "       title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm"     title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm"   title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>

                          <select name="attr_T_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_T_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_talents_X_T_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Talent Fieldset - Modifier exceptions-->
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_talents_X_T_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_T_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>

                      <input class="sheet-testChecked sheet-hidden" name="attr_T_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_talents_X_T_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_T_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>

                    </div>


                                        <div class="sheet-HideIfNotPoison">
                                          <span class="sheet-label sheet-nowrap">
                                            Poison/Disease parameters:
                                            <select name="attr_T_PoisonDisease" class="sheet-selLong" title="@{repeating_talents_X_T_PoisonDisease} Poison or Disease ?">
                                              <option selected value="Poison">Poison</option>
                                              <option value="Disease">Disease</option>
                                            </select>
                                          </span>

                                          <span class="sheet-label sheet-nowrap">
                                            Type:
                                            <select name="attr_T_Poison-Type" class="sheet-selLong" title="@{repeating_talents_X_T_Poison-Type} Type of Poison/Disease">
                                              <option selected value="Damage">Damage</option>
                                              <option value="Debilitation">Debilitation</option>
                                              <option value="Paralysis">Paralysis</option>
                                              <option value="Death">Death</option>
                                              <option value="Special">Special</option>
                                            </select>
                                          </span>

                                          <span class="sheet-label sheet-nowrap">
                                            Onset:
                                            <input name="attr_T_Onset" class="sheet-selShort" type="text" value="Instant" title="@{repeating_talents_X_T_Onset} Onset of Poison/Disease, i.e. Duration after the exposure of the Poison/Disease before a first resistance test is necessary.">
                                          </span>

                                          <span class="sheet-label sheet-nowrap">
                                            Interval:
                                            <input name="attr_T_Interval_Nb" class="sheet-selShort" type="text" value="4" title="@{repeating_talents_X_T_Interval_Nb} Nb of Intervals of the Poison/Disease, i.e. maximum number of times the character exposed has to repeat the resistance test ">
                                            /
                                            <input name="attr_T_Interval_Dur" class="sheet-selShort" type="text" value="1 round" title="@{repeating_talents_X_T_Interval_Dur} Duration of Intervals of the Poison/Disease, i.e. Duration between 2 consecutive resistance tests ">
                                          </span>

                                          <span class="sheet-label sheet-nowrap">
                                            Duration:
                                            <input name="attr_T_Poison-Duration" class="sheet-selShort" type="text" value="1 hr" title="@{repeating_talents_X_T_Poison-Duration} Duration after exposure during which the Effect of the Poison/Disease apply.">
                                          </span>

                                        </div>



                            <!--Talent Fieldset - Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_talents_X_T_Special}  Certain talents or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_T_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Talent (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Talent (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                          <option value="Karma Ritual" title="This is the Karma Ritual in Older editions. Set the Karma Ritual in Adjustment to Talent, and this is the amount that will refill on new day.">Karma Ritual</option>
                          <option value="Speak Language" title="This is the Speak Language Talent, to be used in the Skills Section for the maximum number of Languages known.">Speak Language</option>
                          <option value="RW Language" title="This is the Read & Write Language Talent, to be used in the Skills Section for the maximum number of Languages known.">R/W Language</option>
                          <option value="Durability 5" title="This is the Durability 5 Devotion that adds 5 to Unconsciouness and Death Rating.">Durability 5</option>
                          <option disabled>-- Spellcasting --</option>
                          <option value="SPL-Spellcasting" title="This is a Spellcasting Talent, i.e. SpellCasting or Concise Casting.">Spellcasting</option>
                          <option value="SPL-Patterncraft" title="This is the Patterncraft Talent.">Patterncraft</option>
                          <option value="SPL-Willforce" title="This is the a Will Effect Talent, i.e. either WillForce, or a Dummy Talent for Willpower.">Will Effect</option>
                          <option value="SPL-Elementalism" title="This is an Elementalism Talent (Thread Weaving), i.e. Elementalism or a replacement talent like Elemental Mastery.">Elementalism</option>
                          <option value="SPL-Illusionism" title="This is the Illusionism Talent(Thread Weaving).">Illusionism</option>
                          <option value="SPL-Wizardry" title="This is the Wizardry Talent(Thread Weaving).">Wizardry</option>
                          <option value="SPL-Nethermancy" title="This is the Nethermancy Talent(Thread Weaving).">Nethermancy</option>
                          <option value="SPL-Shamanism" title="This is the Shamanism Talent(Thread Weaving).">Shamanism</option>
                          <option value="SPL-Other" title="This is the Weaving for another type of spellcasting (Spare for hombrewing).">Other</option>
                          <option value="SPL-Power" title="This is the Weaving for Creature Power.">Power</option>
                          <option disabled>-- Powers --</option>
                          <option value="CorruptKarma" title="This is the Corrupt Karma Horror Power. Use this power to make note of how many karma you can corrupt on this target, but use the Token Action associated with the following button to spend these successes.">Corrupt Karma</option>
                          <option value="CursedLuck" title="This is the Cursed Luck Horror Power. Use of this power will set a value into @{Creature-CursedLuck}, and that number of dice will be 'cursed' for the next roll.">Cursed Luck</option>
                        </select>
                      </span>
                    </div>

                          <!--Talent Fieldset - Link Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <span class="sheet-nowrap sheet-api sheet-label">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_T_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: T : @{T_RowID}"
                        title="@{repeating_talents_X_T_btnSetLink} Set the Links for this Talent. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_talents_X_T_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap sheet-api">
                            <input name="attr_T_LinksGetValue" readonly type="text" class="sheet-bordered">
                            <span name="attr_T_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                        </span>
                      </span>
                    </div>

                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_T_sayTotalSuccess" class="selLong" title="@{repeating_talents_X_T_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_talents_X_T_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_talents_X_T_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>

                            <!--Talent Fieldset - SFX-->
                      <span class="sheet-nowrap0 sheet-api">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_T_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: T: @{T_RowID}"
                        title="@{repeating_talents_X_T_btnSetFX} Set the Special Effects for this Talent.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_talents_X_T_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_T_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_T_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>

                            <!--Talent Fieldset - Success Text-->
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_T_DisplayText}:   Text to display whether the test succeeds or not. If there is a ~ (tilde) then only displays up until the first tilde is displayed and the rest is run through the API parser.">
                        <input name="attr_T_DisplayText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_T_DisplayText" class="sheet-autoexpand"></span>
                        <span>Display Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_T_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_T_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_T_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_T_FailText}:   Text to display if the test Fails.">
                        <input name="attr_T_FailText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_T_FailText" class="sheet-autoexpand"></span>
                        <span>Fail Text</span>
                      </label>
                      <!-- <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_T_Duration}:   Duration of the Talent in Rounds (can bea fixed value, Rk, Rk+x).">
                        <input name="attr_T_Duration" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_T_Duration" class="sheet-autoexpand"></span>
                        <span>Duration</span>
                      </label> -->


                    </div>
                  </div>    <!-- end Talent Fieldset - Parameters -->
                </div>    <!--JBF 210106 : End of Parameter  of the Talents, Where parameters are set-->

                      <!--Talent Fieldset - Start of Detail  of the Talents, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_T_ShowNotes" value="1" type="checkbox">
                <div class="sheet-HideIfNotCloseChecked sheet-ShowIfObject">
                  <!--Strain Formula, display place-->
                  <input type="hidden" name="attr_T_StrainAdvanced" class="sheet-testEmpty" value="">
                    <span class="sheet-nowrap sheet-label sheet-HideIfEmpty sheet-api" title="@{repeating_talents_X_T_StrainAdvanced_max}   Advanced Strain Formula for abilities that have a variable Strain">
                      Strain Advanced :
                      <input name="attr_T_StrainAdvanced_max" type="text"  class="sheet-txtLong" readonly>
                    </span>




                  <textarea name="attr_T_Notes" class="sheet-details" title="@{repeating_talents_X_T_Notes}   Description of Talent and how it works." placeholder="Description of the Talent and how it works."></textarea>
                </div>
                      <!--JBF 210106 : End of Detail  of the Talents, Where secundary information during play is displayed, but not parametrization-->
              </div>    <!-- end filterbox -->
            </div> <!-- end filterbox2 -->
            </fieldset>
          </div>    <!-- end of section content -->

          <!--Suggested Powers-->
          <input name="attr_SuggPowers" type="checkbox" value="" checked class="sheet-testCloseChecked sheet-hidden">
          <div class="sheet-HideIfCloseChecked">
            <div class="sheet-headerbar"> Suggested Powers</div>
            <div class="sheet-small">This are suggested powers as per the Creature/Spirit/Dragon/Horror Description. Clicking the button will add them all. Refer to the detailed description to know how many are available</div>
            <div class="sheet-content">
              <label class="sheet-autoexpand-wrap" title="@{SuggPowers}: List of Suggested Powers.">
                <input name="attr_SuggPowers" type="text" value="" readonly>
                <span name="attr_SuggPowers" class="sheet-autoexpand" readonly></span>
              </label>
              <input name="attr_SuggPowers_max" type="text" value="" class="sheet-hidden"> <!--Contains the JSON-->
              <button class="sheet-button-nodice sheet-text-button" name="act_addsuggpowers" type="action"
              title="act_addsuggpowers:   Clicking this button will add all suggested powers .">
              Add All
              </button>

            </div>
          </div>
      </div>    <!-- ********************************** End of Section Talents ************************* -->



              <!-- ********************************* Start of Section Knacks Content ******************** -->
        <div class="sheet-section sheet-section-knacks sheet-section-combat sheet-section-core sheet-NotCreation">
          <div class="sheet-content">   <!--Section Knacks - Content-->
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">
            <input name="attr_show_repeating_step_dice" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption5">
            <input type="checkbox" hidden value="1" name="attr_knacks-edit-mode" class="sheet-testRepEditMode" title="@{attr_knacks-edit-mode} : Toggles the talent view to edit mode where the main attributes of each talents can be changed.">

            <div class="sheet-HideIfNotEditMode">
              <input type="hidden" name="attr_Knack-Summary-Param" class="sheet-testNum" value="0">
              <div>
              <b class="sheet-label"> Knack Summary Report - </b>
              <b class="sheet-label">Hide :
                <input type="radio" name="attr_Knack-Summary-Param" value="0" checked title="@{Knack-Summary-Param} : Hide completely the report">
              </b>
              <b class="sheet-label">Use Current Ranks and Circle :
                <input type="radio" name="attr_Knack-Summary-Param" value="1"  title="@{Knack-Summary-Param} : Report will be generated showing only the Knacks where the conditions are already met">
              </b>
              <b class="sheet-label">Use Substitution Ranks and Circle :
                <input type="radio" name="attr_Knack-Summary-Param" value="2"  title="@{Knack-Summary-Param} : Report will be generated as if the Rank and Discipline Circle had reach a declared level, in order to plan future development">
                <input type="number" class="sheet-NumShort sheet-HideIfZero sheet-HideIfOne" name="attr_Knack-Summary-SubRank" value="15" min="0" max="21" title="@{Knack-Summary-SubRank} : This value will be used for Requirement evalutation instead of actual values">
              </b>
              <button class="ui-draggable sheet-button-nodice sheet-text-button sheet-HideIfZero" name="act_knacksummary" type="action"
              title="act_knacksummary:   Click to generate the Knack Summary."> Generate </button>
            </div>
            <div class="sheet-HideIfZero">
              <textarea name="attr_Knack-Summary" class="sheet-text-left sheet-HideIfPrint sheet-details" title="@{Knack-Summary}   Shows a Report of the Knacks accessible to the character according to his current progress."></textarea>
            </div>

            </div>




            <div style="height: 30px;" class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint">
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Knack Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotOption5">Dice</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNoKarma sheet-api">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest sheet-api">DP</b>
            </div>

            <!--Section Knacks - Fieldset-->
            <fieldset class="repeating_knacks">
              <input name="attr_NAC_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab">
              <div class="sheet-filter-box">
                <span class="sheet-hidden"> <input name="attr_NAC_Target-TA" type="text"> <input name="attr_NAC_ModPrefix" type="hidden" value="?"></span>
                <div style="margin:0px;">      <!--Knacks Fieldset - Main Line-->
                  <input name="attr_NAC_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                        <!--Knacks Fieldset- Button & Name-->
                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_NAC_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~   Target: @{NAC_Target}~ @{NAC_RollType}~ foreach:sct:ust:c~ modValue : @{NAC_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{NAC_Karma-Ask}: @{DPGlobalMode}@{NAC_DP-Ask} ~Strain:@{NAC_Strain_max} ~Action: NAC: @{NAC_RowID}"
                    title="%{selected|Roll_NAC_Roll-fromSheet} Roll this Knack Test.">
                    <input name="attr_NAC_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_NAC_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~   Target: @{NAC_Target-TA}~ @{NAC_RollType}~ foreach:sct:ust:c~ modValue : @{NAC_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{NAC_Karma-Ask}: @{DPGlobalMode}@{NAC_DP-Ask} ~Strain:@{NAC_Strain|max} ~Action: NAC: @{NAC_RowID}"
                    title="%{selected|Roll_NAC_Roll} Roll this Knack Test.   This version uses NAC_Target-TA instead of NAC_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>
                    <button class="sheet-text-button sheet-NoAPI" name="roll_NAC_Roll-NoAPI" type="roll"
                    value="@{NAC_RollType} &{template:rolltargetnumber} @{NAC_Target-NoAPI} {{header=@{charName}: @{NAC_Name}}} {{Step=[[?{Step|@{NAC_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{NAC_DisplayText} @{NAC_SuccessText}}}"
                    title="%{selected|Roll_NAC_Roll-NoAPI} Roll this Knack Test.">
                    <input name="attr_NAC_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <input name="attr_NAC_Name" type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-testPlaceholder sheet-bordered-bottom" placeholder="Name">
                    <!--JBF 210115 : In Edit mode, the name is out of the button to be editable-->
                  </span>
                  <input name="attr_NAC_Name" type="text" hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 25px;" title="@{repeating_knacks_X_NAC_textImport}:   Knack Text import: This only shows up if Name is empty.">
                    <textarea name="attr_NAC_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">
                      If you have a PDF copy of the book, you can copy an entire Knack or Questor Devotion description (starting with the name, and including everything) and paste it into this tiny text box. It will be parsed and whatever fields can be set based upon the text will be. You will still need to manually set some of the fields, most importaintly "Modifiers".
                    </span>
                  </span>

                        <!--Knacks Fieldset- Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Mod-Type}  What modifiers does this Knack apply.">
                    <span class="sheet-iconselect-icon">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-initiative" title="Modifiers that apply to Initiative Tests."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="JumpUp"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-jumpup" title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Mod-Type" value="NoRoll"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                    </span>

                    <select name="attr_NAC_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                      <option value="0" title="No modifiers at all."> None</option>
                      <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                      <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                      <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                      <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                      <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                      <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                      <option value="Init" title="All Initiative modifiers apply to this test."> Initiative </option>
                      <option value="JumpUp" title=title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown.">Jump Up</option>
                      <option value="NoRoll" title="This Knack does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                    </select>
                    <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->

                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" hidden value="Recovery" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" hidden value="Knockdown" type="checkbox">
                    <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                  </span>
                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry felds -->
                  <input type="hidden" name="attr_NAC_Mod-Type" class="sheet-testModType"   >
                        <!--Knacks Fieldset- Rank-->
                  <input name="attr_NAC_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                  <!--Links initialized, show the value-->
                  <span class="sheet-hideIfPlaceholder sheet-HideIfCloseChecked sheet-HideIfOverviewNoEdit  sheet-ShowIfPrint">
                    <span class="sheet-HideIfNotEditMode sheet-fixed-width sheet-w100px sheet-titlespan">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <input name="attr_NAC_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-api" readonly title="@{repeating_knacks_X_NAC_LinkValue}: Knack Rank is to be calculated via a Link. Go to Parameter to Link the Knack to its Base Talent, so that Base Talent Rank can be used in Knacks Step Calculation."  type="number"  >
                        <input name="attr_NAC_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners sheet-NoAPI" title="@{repeating_knacks_X_NAC_Rank}:   Characters Base Rank in this knack."  type="number"  >
                        <input name="attr_NAC_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_knacks_X_NAC_Effective-Rank}:   Characters effective Rank in this knack counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_knacks_X_NAC_Rank-Adjust}:   Adjustments to the use of this knack that increases effective rank like Thread Items.">
                          <input name="attr_NAC_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_NAC_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                        </span>
                      </span>
                    </span>

                    <span class="sheet-HideIfEditMode sheet-fixed-width sheet-w75px sheet-titlespan ">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="" title="">
                          <input name="" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>

                        <input name="attr_NAC_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-api" readonly title="@{repeating_knacks_X_NAC_LinkValue}: Knack Rank is to be calculated via a Link. Go to Parameter to Link the Knack to its Base Talent, so that Base Talent Rank can be used in Knacks Step Calculation."  type="number"  >
                        <input name="attr_NAC_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-NoAPI" readonly title="@{repeating_knacks_X_NAC_Rank}:   Characters Base Rank in this knack."  type="number"  >
                        <input name="attr_NAC_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_knacks_X_NAC_Effective-Rank}:   Characters effective Rank in this knack counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_knacks_X_NAC_Rank-Adjust}:   Adjustments to the use of this knack that increases effective rank like Thread Items.">
                          <input name="attr_NAC_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_NAC_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                        </span>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-hideIfPlaceholder sheet-HideIfNotCloseChecked sheet-HideIfOverviewNoEdit">
                  <span class="sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-titlespan ">
                    <!-- <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                    title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button> -->
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Linkadd1: NAC : @{NAC_RowID} : ?{What are we linking this to|Talent,T|Discipline,DSP|Skill,SK|Weapon,WPN|Thread Item,TI|Attribute} : ?{Name to link to (Make sure substring is an exact match, including case. Example - Melee)} "
                    title="@{repeating_talents_X_NAC_btnAddLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                  </span>

                  <span class="sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-titlespan">
                    <!-- <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                    title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button> -->
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Linkadd1: NAC : @{NAC_RowID} : ?{What are we linking this to|Talent,T|Discipline,DSP|Skill,SK|Weapon,WPN|Thread Item,TI|Attribute} : ?{Name to link to (Make sure substring is an exact match, including case. Example - Melee)} "
                    title="@{repeating_talents_X_NAC_btnAddLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                  </span>
                </span>

                        <!--Knacks Fieldset- Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Attribute}  What attribute is associated with this knack.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_knacks_X_NAC_Attribute}  What attribute is associated with this knack.">
                      <select name="attr_NAC_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This knack does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                        <option value="Initiative" title="Initiative. Use only for Initiative replacement talents">Initiative</option>
                      </select>
                    </span>
                  </span>

                        <!--Knacks Fieldset-Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-HideIfNoRoll sheet-bordered-bottom">
                      <span title="@{repeating_knacks_X_NAC_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_NAC_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_NAC_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_NAC_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_knacks_X_NAC_BaseStep}:   Permanent Step of the Knack before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_NAC_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_knacks_X_NAC_Step}:   Final action Step for this knack."  type="number"  >
                      <span title="@{repeating_knacks_X_NAC_Mods}:  Manual modifications to the use of this knack that do NOT increase effective rank.">
                        <input name="attr_NAC_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_NAC_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                    <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode sheet-HideIfNoRoll">
                      <input name="attr_NAC_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_knacks_X_NAC_BaseStep}:   Permanent Step of the Knack before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>

                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfNotOption5">
                      <input name="attr_NAC_Step_max" type="text" readonly class="sheet-w100px sheet-bordered-bottom sheet-HideIfNoRoll" title="@{repeating_knacks_X_NAC_Step_max}:   Dice to be rolled for the corresponding step.">
                  </span>

                        <!--Knacks Fieldset- Targets Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_NAC_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">
                            <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Knack does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Knack targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Knack targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Knack targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets individually Physical Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets individually Physical Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets individually Physical Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Knacks, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_NAC_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_NAC_Target" title="@{repeating_knacks_X_NAC_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Each --</option>
                        <option value="PD-each" title="Targets individually Physical Defense of each target.">PD-each</option>
                        <option value="MD-each" title="Targets individually Mystic Defense of each target.">MD-each</option>
                        <option value="SD-each" title="Targets individually Social Defense of each target.">SD-each</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 6.">10</option>
                      </select>
                    </span>

                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_knacks_X_NAC_Target-NoAPI}  What does this knack target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Knack does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Knack targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Knack targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Knack targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_NAC_Target-NoAPI">
                        <option selected value=" " title="This Knack does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Knack targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Knack targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Knack targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>

                          <!-- JBF Target Armor when Damage-->
                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">
                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Knack does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_NAC_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_NAC_ArmorType" title="@{repeating_knacks_X_NAC_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Knack does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>

                        <!--Knacks Fieldset- Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Type}  How does the Adept know this knack.">
                    <select name="attr_NAC_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option value="Knack" selected title="This is a standard Talent Knack.">Knack</option>
                      <option value="Creature" title="This is not really a Knack, it is really a Creature/Horror/Spirit/Dragon, Etc. Power.">Creature Power</option>
                      <option value="Item" title="This Knack is granted by an Item such as a Thread Item.">Item</option>
                      <option value="Dummy" title="This is not really a Knack in and of itself, it is a placeholder for a Knack-like effect or a combination of multiple talents. For example a warrior with both air dance and tiger spring might create a dummy entry for using both talents at the same time.">Dummy</option>
                      <option value="Special" title="This Knack is available due to some special reason.">Special</option>
                    </select>
                  </span>

                        <!--Knacks Fieldset- 210106 Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder sheet-ShowIfPrint" title="{repeating_knacks_X_NAC_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a knack or skill usually requires the character to spend more than one round before a test is made."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" name="attr_NAC_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Knacks"></span>
                    </span>
                    <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_NAC_Action" >
                      <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                      <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                      <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                      <option value="Sustained" title="A Sustained action for a knack or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                      <option value="NA" title="No Action for certain Knacks">NA</option>
                    </select>
                  </span>

                        <!--Knacks Fieldset- Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder" title="@{repeating_knacks_X_NAC_Strain}: number of strain points per use">
                    <input name="attr_NAC_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_NAC_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_NAC_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                    <!--Strain Formula, show + if there is a Formula-->
                    <input name="attr_NAC_Strain_max" type="hidden" value="0">
                    <input name="attr_NAC_StrainAdvanced" type="hidden" value="" class="sheet-testEmpty"><span class="sheet-HideIfEmpty sheet-strainadvanced sheet-api">+</span>


                  </span>

                        <!--Knacks Fieldset- Karma & DP-->
                  <span class="sheet-hideIfPlaceholder">
                          <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_NAC_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_NAC_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_NAC_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_NAC_Karma" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_NAC_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{NAC_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="0" > <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{NAC_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="1" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_NAC_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{NAC_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_NAC_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_NAC_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0"  title="@{NAC_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" selected title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" selected title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{NAC_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" selected title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_NAC_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0"  title="@{NAC_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" selected title="@{NAC_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{NAC_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of Karma Toggle-Simple-->
                        <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_NAC_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_NAC_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_NAC_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_NAC_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{NAC_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_NAC_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{NAC_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{NAC_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{NAC_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_NAC_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_NAC_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{NAC_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{NAC_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_NAC_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{NAC_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{NAC_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{NAC_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!--JBF End Of DP Toggle-->
                  </span>
                        <!--Knacks Fieldset- Corrupt Karma-->
                  <span class="sheet-wrap0 sheet-hideIfPlaceholder" >
                    <input class="sheet-testCloseChecked" name="attr_NAC_Special" value="CorruptKarma" hidden type="checkbox">
                    <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked sheet-api" name="roll_NAC_btnCorruptKarma" type="roll"
                    value="!Earthdawn~ SetToken: @{target|to have Karma Corrupted|token_id}~ Misc: CorruptKarma: ?{How many karma to corrupt|1}"
                    title="@{repeating_knacks_X_NAC_btnCorruptKarma} Use this button to 'Corrupt Karma' during the next dice roll. It will transfer some successes from the CK pool to the CK action where it will effect the next rolls that use karma.">Corrupt Karma</button>
                  </span>

                        <!--Knacks Fieldset- Notes Icon-->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_knacks_X_NAC_ShowNotes}   Show description of Knack/Power">
                      <input type="checkbox" name="attr_NAC_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_knacks_X_NAC_CombatSlot}  Should this Knack be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_NAC_CombatSlot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_knacks_X_NAC_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_NAC_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                    <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                      <!--Compendium Button-->
                      <input type="checkbox" name="attr_NAC_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                      <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_NAC_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                    </span>
                  </span>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                    <span class="sheet-iconstatic sheet-icon-link sheet-hidden" title="This icon indicates this Knack/Knack is linked to another, meaning that the Rank of the other Knack is added to its Effective Rank"></span>
                    <!-- NOT APPLICABLE TO KNACKS just placeholder-->
                    <input name="attr_NAC_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Knack, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                    <input name="attr_NAC_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfCloseChecked" title="This icon indicates that this ability (Knack, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                  </span>
                </div>    <!--JBF 210106 : End of Play Visalization of the Knacks, i.e. when all details are collapsed-->

                      <!--Knacks Fieldset- Start of Parameter Visalization of the Knacks, Where parameters are set-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_NAC_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom">
                        <!--Knacks Fieldset- Karma and DP Parameters-->
                  <div class="sheet-floatRight sheet-content sheet-api" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_knacks_X_NAC_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed : <span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_NAC_Karma-Limit_max" value="1" min="0" max="3" class="sheet-numShorter" title="@{repeating_knacks_X_NAC_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_knacks_X_NAC_Karma-Limit} : Does this Knack require Karma Points to be spent every time it is used">
                      Karma Required :
                      <input type="checkbox" name="attr_NAC_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_knacks_X_NAC_Karma-Limit} : Does this Knack require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label">
                      <span title="@{repeating_knacks_X_NAC_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed :  : <span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_NAC_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_knacks_X_NAC_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>
                      <!--JBF Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_NAC_Type" type="hidden">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_knacks_X_NAC_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required :
                        <input type="checkbox" name="attr_NAC_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_knacks_X_NAC_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                  </div>

                        <!--Knacks Fieldset- Parameters -->
                  <div class="sheet-content">
                    <!-- <input name="attr_NAC_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value=""> -->
                    <input type="hidden" hidden name="attr_NAC_Mod-Type" class="sheet-testModType"  >

                    <!--Knacks Fieldset-Knack Requirement-->
                    <span class="sheet-nowrap" title="@{repeating_knacks_X_NAC_Requirements}:   Rank Base Talent must be in order to learn this Knack.">Requirements Rank:
                      <input name="attr_NAC_Requirements" type="number" value="0" class="sheet-numShort">
                    </span>
                    <label class="" title="@{repeating_knacks_X_NAC_Restrictions}:   Any restrictions that need to be fulfilled in order to learn this Knack. For information only.">
                      Restrictions:&nbsp;<span class="sheet-autoexpand-wrap ">
                        <input name="attr_NAC_Restrictions" type="text" class="sheet-bordered">
                        <span name="attr_NAC_Restrictions" class="sheet-autoexpand "></span>
                      </span>
                    </label>
                    <label class="" title="@{repeating_knacks_X_NAC_BaseTalent}:   Base Talent.">
                      Base Talent:&nbsp;<span class="sheet-autoexpand-wrap ">
                        <input name="attr_NAC_BaseTalent" type="text" class="sheet-bordered">
                        <span name="attr_NAC_BaseTalent" class="sheet-autoexpand "></span>
                      </span>
                    </label>
                    <br>
                          <!--Knacks Fieldset- Link Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <span class="sheet-nowrap">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: NAC : @{NAC_RowID}"
                        title="@{repeating_knacks_X_NAC_btnSetLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Knack, Knack, Thread Item or Other to the Effective Rank of this Knack"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_knacks_X_NAC_LinksGetValue} : List of Names of properties (Knacks, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Knack, for a Free Knack to get the Circle of the Discipline, or for a combination of Knacks/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap">
                            <input name="attr_NAC_LinksGetValue" type="text" readonly class="sheet-bordered">
                            <span name="attr_NAC_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                          <input name="attr_NAC_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_knacks_X_NAC_LinksGetValue_max} : List of RowIds of properties (Knacks, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Knack, for a Free Knack to get the Circle of the Discipline, or for a combination of Knacks/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                        </span>
                      </span>
                    </div>

                    <!--Strain Formula, edit place-->
                      <span class="sheet-nowrap sheet-label sheet-api" title="@{repeating_knacks_X_NAC_StrainAdvanced}   Advanced Strain Formula for abilities that have a variable Strain">
                        Strain Advanced :
                        <input name="attr_NAC_Strain" type="number" value="0" class="sheet-numShorter" >
                        <select name="attr_NAC_StrainAdvanced" class="sheet-selShort">
                          <option selected value="" title="Fixed Strain">Fixed</option>
                          <option value="Ask" title="Ask number of strain">Ask</option>
                        </select>
                      </span>




                          <!--Knacks Fieldset- Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-label" title="@{repeating_knacks_X_NAC_RollType}   Rolls should be made: public, gm, or hidden?">
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_NAC_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_NAC_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>

                          <select name="attr_NAC_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>

                          <select name="attr_NAC_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_NAC_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_knacks_X_NAC_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Knacks Fieldset-Modifier exceptions-->
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_knacks_X_NAC_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_NAC_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>

                      <input class="sheet-testChecked sheet-hidden" name="attr_NAC_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_knacks_X_NAC_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_NAC_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>
                    </div>

                          <!--Knacks Fieldset- Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_knacks_X_NAC_Special}  Certain knacks or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_NAC_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Knack (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Knack (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                          <option value="">-- Powers --</option>
                          <option value="CorruptKarma" title="This is the Corrupt Karma Horror Power. Use this power to make note of how many karma you can corrupt on this target, but use the Token Action associated with the following button to spend these successes.">Corrupt Karma</option>
                          <option value="CursedLuck" title="This is the Cursed Luck Horror Power. Use of this power will set a value into @{Creature-CursedLuck}, and that number of dice will be 'cursed' for the next roll.">Cursed Luck</option>
                        </select>
                      </span>
                    </div>

                            <!--Knacks Fieldset- SFX-->
                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_NAC_sayTotalSuccess" class="selLong" title="@{repeating_knacks_X_NAC_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_knacks_X_NAC_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_knacks_X_NAC_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>
                      <span class="sheet-nowrap0">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_NAC_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: NAC: @{NAC_RowID}"
                        title="@{repeating_knacks_X_NAC_btnSetFX} Set the Special Effects for this Knack.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_knacks_X_NAC_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_NAC_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_NAC_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_NAC_DisplayText}:   Text to display whether the test succeeds or not. If there is a ~ (tilde) then only displays up until the first tilde is displayed and the rest is run through the API parser.">
                        <input name="attr_NAC_DisplayText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_NAC_DisplayText" class="sheet-autoexpand"></span>
                        <span>Display Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_knacks_X_NAC_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_NAC_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_NAC_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_knacks_X_NAC_FailText}:   Text to display if the test fails.">
                        <input name="attr_NAC_FailText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_NAC_FailText" class="sheet-autoexpand"></span>
                        <span>Fail Text</span>
                      </label>
                    </div>
                  </div>    <!--end Knacks Fieldset- Parameters -->
                </div>    <!-- end Knacks Fieldset- End of Parameter  of the Knacks, Where parameters are set -->
                      <!--Knacks Fieldset- Start of Detail  of the Knacks, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_NAC_ShowNotes" value="1" type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">

                  <!--Strain Formula, display place-->
                  <input type="hidden" name="attr_NAC_StrainAdvanced" class="sheet-testEmpty" value="">
                    <span class="sheet-nowrap sheet-label sheet-HideIfEmpty sheet-api" title="@{repeating_knacks_X_NAC_StrainAdvanced_max}   Advanced Strain Formula for abilities that have a variable Strain">
                      Strain Advanced :
                      <input name="attr_NAC_StrainAdvanced_max" type="text"  class="sheet-txtLong" readonly>
                    </span>

                  <textarea name="attr_NAC_Notes" class="sheet-details" title="@{repeating_knacks_X_NAC_Notes}   Description of Knack and how it works." placeholder="Description of the Knack and how it works."></textarea>
                </div>
                <!--JBF 210106 : End of Detail  of the Knacks, Where secundary information during play is displayed, but not parametrization-->
              </div>
            </fieldset>
          </div>   <!-- end of Knacks content -->
        </div>    <!--****************************************** End of Section Knacks ****************************************-->



              <!--****************************************** Start of Section Skills - Content ***********************************-->
        <div class="sheet-section sheet-section-skills sheet-section-core sheet-section-combat">

          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature"> <b class="sheet-creation-order">5-</b> Assign Skill Ranks</div>
          <input class="sheet-testAttrCosts" name="attr_Skills-Costs" value="14" type="hidden">
          <div class="sheet-Creation sheet-HideIfCreature"> 2 Rks Knowledge, 1 Rk Artisan, 2 Rks Speak Language, 1Rk R/W Language, 8 Rks Others . Remaining :
            <input name="attr_Skills-Costs" class="sheet-numShort sheet-attrCostsRed"
            readonly="readonly" value="14"
            title="@{Skills-Costs}   Number of Skill points remaining from the starting 13."
            type="number">
          </div>



          <div class="sheet-content sheet-HideIfCreature">   <!-- Section Skills - Content -->
            <input name="attr_show_repeating_mod_exc" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption1">
            <input name="attr_show_repeating_success" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption2">
            <input name="attr_show_repeating_links"   type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
            <input name="attr_show_repeating_special" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption4">
            <input name="attr_show_repeating_step_dice" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption5">

            <input type="checkbox" hidden value="1" name="attr_skills-edit-mode" class="sheet-testRepEditMode" title="@{attr_skills-edit-mode} : Toggles the Skill view to edit mode where the main attributes of each Skills can be changed.">
            <div style="height: 30px;" class="sheet-HideIfCombatNoEdit sheet-HideIfOverviewNoEdit">
              <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Type</b>
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Skill Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Type&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfEditMode sheet-HideIfOverviewNoEdit">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Attribute&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotOption5">Dice</b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">&nbsp;Origin&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfOverviewNoEdit">Actn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan  sheet-HideIfNoKarma sheet-api">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest sheet-api">DP</b>
            </div>

            <!--According to the Type of Skill, the Skill Name will be a free text with dropdown of selected options.-->
            <datalist id="general_skill">
              <!--PG Compendium-->
              <option value="Acrobatic Defense"></option>
              <option value="Air Sailing"></option>
              <option value="Alchemy"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Handling"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Artisan"></option>
              <option value="Artist"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Battle Bellow"></option>
              <option value="Battle Shout"></option>
              <option value="Blade Juggle"></option>
              <option value="Bribery"></option>
              <option value="Charge"></option>
              <option value="Climbing"></option>
              <option value="Conceal Object"></option>
              <option value="Conversation"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Craftsman"></option>
              <option value="Danger Sense"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm"></option>
              <option value="Disarm Trap"></option>
              <option value="Disguise"></option>
              <option value="Distract"></option>
              <option value="Down Strike"></option>
              <option value="Emotion Song"></option>
              <option value="Engaging Banter"></option>
              <option value="Entertainer"></option>
              <option value="Etiquette"></option>
              <option value="Evidence Analysis"></option>
              <option value="Fast Hand"></option>
              <option value="First Impression"></option>
              <option value="Flirting"></option>
              <option value="Forgery"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Hypnotize"></option>
              <option value="Impressive Display"></option>
              <option value="Knowledge"></option>
              <option value="Leadership"></option>
              <option value="Lock Picking"></option>
              <option value="Maneuver"></option>
              <option value="Mapmaking"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Mount Attack"></option>
              <option value="Navigation"></option>
              <option value="Physician"></option>
              <option value="Picking Pockets"></option>
              <option value="Pilot Boat"></option>
              <option value="Read and Write Language"></option>
              <option value="Research"></option>
              <option value="Resist Taunt"></option>
              <option value="Riposte"></option>
              <option value="Sailing"></option>
              <option value="Second Attack"></option>
              <option value="Second Shot"></option>
              <option value="Second Weapon"></option>
              <option value="Seduction"></option>
              <option value="Shield Bash"></option>
              <option value="Slough Blame"></option>
              <option value="Speak Language"></option>
              <option value="Sprint"></option>
              <option value="Stealthy Stride"></option>
              <option value="Streetwise"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Swimming"></option>
              <option value="Tactics"></option>
              <option value="Taunt"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="Unarmed Combat"></option>
              <option value="Wheeling Attack"></option>
              <option value="Wheeling Defense"></option>
              <option value="Wilderness Survival"></option>
              <option value="Wound Balance"></option>
            </datalist>

            <datalist id="general_skill_creation">
              <option value="Acrobatic Defense"></option>
              <option value="Air Sailing"></option>
              <option value="Alchemy"></option>
              <option value="Animal Bond"></option>
              <option value="Animal Handling"></option>
              <option value="Animal Training"></option>
              <option value="Anticipate Blow"></option>
              <option value="Arcane Mutterings"></option>
              <option value="Artisan"></option>
              <option value="Artist"></option>
              <option value="Avoid Blow"></option>
              <option value="Awareness"></option>
              <option value="Battle Bellow"></option>
              <option value="Battle Shout"></option>
              <option value="Blade Juggle"></option>
              <option value="Bribery"></option>
              <option value="Charge"></option>
              <option value="Climbing"></option>
              <option value="Conceal Object"></option>
              <option value="Conversation"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Craftsman"></option>
              <option value="Danger Sense"></option>
              <option value="Diplomacy"></option>
              <option value="Disarm"></option>
              <option value="Disarm Trap"></option>
              <option value="Disguise"></option>
              <option value="Distract"></option>
              <option value="Down Strike"></option>
              <option value="Emotion Song"></option>
              <option value="Engaging Banter"></option>
              <option value="Entertainer"></option>
              <option value="Etiquette"></option>
              <option value="Evidence Analysis"></option>
              <option value="Fast Hand"></option>
              <option value="First Impression"></option>
              <option value="Flirting"></option>
              <option value="Forgery"></option>
              <option value="Graceful Exit"></option>
              <option value="Great Leap"></option>
              <option value="Haggle"></option>
              <option value="Heartening Laugh"></option>
              <option value="Hypnotize"></option>
              <option value="Knowledge"></option>
              <option value="Leadership"></option>
              <option value="Lock Picking"></option>
              <option value="Maneuver"></option>
              <option value="Mapmaking"></option>
              <option value="Melee Weapons"></option>
              <option value="Mimic Voice"></option>
              <option value="Missile Weapons"></option>
              <option value="Mount Attack"></option>
              <option value="Navigation"></option>
              <option value="Physician"></option>
              <option value="Picking Pockets"></option>
              <option value="Pilot Boat"></option>
              <option value="Read and Write Language"></option>
              <option value="Research"></option>
              <option value="Resist Taunt"></option>
              <option value="Riposte"></option>
              <option value="Sailing"></option>
              <option value="Second Attack"></option>
              <option value="Second Shot"></option>
              <option value="Second Weapon"></option>
              <option value="Seduction"></option>
              <option value="Shield Bash"></option>
              <option value="Slough Blame"></option>
              <option value="Speak Language"></option>
              <option value="Sprint"></option>
              <option value="Stealthy Stride"></option>
              <option value="Streetwise"></option>
              <option value="Sure Mount"></option>
              <option value="Surprise Strike"></option>
              <option value="Swift Kick"></option>
              <option value="Swimming"></option>
              <option value="Tactics"></option>
              <option value="Taunt"></option>
              <option value="Throwing Weapons"></option>
              <option value="Tracking"></option>
              <option value="Trick Riding"></option>
              <option value="Unarmed Combat"></option>
              <option value="Wheeling Attack"></option>
              <option value="Wheeling Defense"></option>
              <option value="Wilderness Survival"></option>
              <option value="Wound Balance"></option>
            </datalist>

            <datalist id="artisan_skill">
              <option value="Acting"></option>
              <option value="Baking"></option>
              <option value="Basket Weaving"></option>
              <option value="Body Painting"></option>
              <option value="Carving"></option>
              <option value="Cooking"></option>
              <option value="Craft Armor"></option>
              <option value="Craft Weapon"></option>
              <option value="Dancing"></option>
              <option value="Embroidery"></option>
              <option value="Juggling"></option>
              <option value="Mapmaking"></option>
              <option value="Musician"></option>
              <option value="Poetry"></option>
              <option value="Rune Carving"></option>
              <option value="Sculpting"></option>
              <option value="Singing"></option>
              <option value="Storytelling"></option>
              <option value="Tattooing"></option>
              <option value="Wardrobe and Style"></option>
              <option value="Armors Runic Carving"></option>
              <option value="Beadwork"></option>
              <option value="Calligraphy"></option>
              <option value="Canvas Painting"></option>
              <option value="Carpentry"></option>
              <option value="Cat's Cradle"></option>
              <option value="Clay Sculpting"></option>
              <option value="Cloth Dyeing"></option>
              <option value="Comedy"></option>
              <option value="Composing"></option>
              <option value="Cooperage"></option>
              <option value="Costume Design"></option>
              <option value="Craftsman"></option>
              <option value="Crochet"></option>
              <option value="Crystal Carving"></option>
              <option value="Crystal Sculpting"></option>
              <option value="Decoupage"></option>
              <option value="Drawing"></option>
              <option value="Enamelling"></option>
              <option value="Felting"></option>
              <option value="Flintknapping"></option>
              <option value="Flower Arrangement"></option>
              <option value="Fretwork"></option>
              <option value="Glass beadmaking"></option>
              <option value="Glass Blowing"></option>
              <option value="Glass etching"></option>
              <option value="Goldsmithing"></option>
              <option value="Humor"></option>
              <option value="Iris folding"></option>
              <option value="Jewellery"></option>
              <option value="Knitting"></option>
              <option value="Knotting"></option>
              <option value="Lace-making"></option>
              <option value="Leather carving"></option>
              <option value="Leatherworking"></option>
              <option value="Makeup"></option>
              <option value="Metal Carving"></option>
              <option value="Metal Casting"></option>
              <option value="Mosaic"></option>
              <option value="Musical Instrument"></option>
              <option value="Needlepoint"></option>
              <option value="Oratory"></option>
              <option value="Origami"></option>
              <option value="Painting"></option>
              <option value="Papercutting"></option>
              <option value="Paper embossing"></option>
              <option value="Paper-mache"></option>
              <option value="Party like a madman"></option>
              <option value="Patchwork"></option>
              <option value="Plaster Casting"></option>
              <option value="Pottery"></option>
              <option value="Quilling"></option>
              <option value="Robe Weaving"></option>
              <option value="Rug making"></option>
              <option value="Scarification"></option>
              <option value="Smithing"></option>
              <option value="Stained glass"></option>
              <option value="Stone Carving"></option>
              <option value="Stone Sculpting"></option>
              <option value="Tailor"></option>
              <option value="Tatting"></option>
              <option value="Tinsmithing"></option>
              <option value="Weapons Runic Carving"></option>
              <option value="Weaving"></option>
              <option value="Wigmaking"></option>
              <option value="Wood Carving"></option>
              <option value="Wood Sculpting"></option>
              <option value="Wood Turning"></option>
            </datalist>
                  <!--JBF Lists from the Second Step Website with approval of Lars Gottlieb-->
            <datalist id="knowledge_skill">
              <option value="Knowledge"></option>
              <option value="Alchemy and Potions"></option>
              <option value="Ancient Weapons"></option>
              <option value="Baking"></option>
              <option value="Barsaive History"></option>
              <option value="Botany"></option>
              <option value="Court Dancing"></option>
              <option value="Creature Lore"></option>
              <option value="Discipline Lore"></option>
              <option value="Farming"></option>
              <option value="Horror Lore"></option>
              <option value="Legends and Heroes"></option>
              <option value="Military Organizations"></option>
              <option value="Province History"></option>
              <option value="Racial Lore"></option>
              <option value="Scourge History"></option>
              <option value="Trade Routes"></option>
              <option value="Wild Animals"></option>
              <option value="Accounting"></option>
              <option value="Airships"></option>
              <option value="Anatomy"></option>
              <option value="Ancient Tactics"></option>
              <option value="Bureaucracy"></option>
              <option value="Business Contacts"></option>
              <option value="Caravans"></option>
              <option value="Conspiracy"></option>
              <option value="Dwarven Trade Routes"></option>
              <option value="Dwarven Military Organization"></option>
              <option value="Economics"></option>
              <option value="Elven Ballads"></option>
              <option value="Elven LoveSongs"></option>
              <option value="Gambling"></option>
              <option value="Geography Barsaive"></option>
              <option value="Geography Vivane"></option>
              <option value="History: Air Sailing"></option>
              <option value="History: Barsaive"></option>
              <option value="History: CaraFahd"></option>
              <option value="History: Grim Legion"></option>
              <option value="History: Human"></option>
              <option value="History: Living Legend Cults"></option>
              <option value="History: Ork"></option>
              <option value="History: Political"></option>
              <option value="History: Scourge"></option>
              <option value="History: Shosara"></option>
              <option value="History: Thera"></option>
              <option value="History: Throal"></option>
              <option value="Hunting"></option>
              <option value="Law"></option>
              <option value="Legends and Heroes: Orks"></option>
              <option value="Local Geography"></option>
              <option value="Local Lore"></option>
              <option value="Blood Elf Lore"></option>
              <option value="Dwarf Lore"></option>
              <option value="Elf Lore"></option>
              <option value="Human Lore"></option>
              <option value="Obsidiman Lore"></option>
              <option value="Ork Lore"></option>
              <option value="Pale One Lore"></option>
              <option value="T'skrang Lore"></option>
              <option value="Troll Lore"></option>
              <option value="Windling Lore"></option>
              <option value="Lore: Beasts"></option>
              <option value="Lore: Blood Magic"></option>
              <option value="Lore: Creatures"></option>
              <option value="Lore: Death Magic"></option>
              <option value="Lore: Horrors"></option>
              <option value="Lore: Magic"></option>
              <option value="Lore: Scourge"></option>
              <option value="Lore: Treasures"></option>
              <option value="Lore: Verjigorm"></option>
              <option value="Lore: Weapons"></option>
              <option value="Magical Theory"></option>
              <option value="Military History"></option>
              <option value="Military Procedures"></option>
              <option value="Nature"></option>
              <option value="Obsidiman Weapons"></option>
              <option value="Old Wives' Tales"></option>
              <option value="The Passions"></option>
              <option value="Politics"></option>
              <option value="Politics: Ork"></option>
              <option value="Politics: Thera"></option>
              <option value="The Scourge"></option>
              <option value="Subterranean Throal"></option>
              <option value="The Mob"></option>
              <option value="Throalic Poetry"></option>
              <option value="Underworld Rumors"></option>
              <option value="Vivane Geography"></option>
              <option value="Rockwise"></option>
              <option value="Spiritwise"></option>
              <option value="Art History"></option>
              <option value="Plantwise"></option>
              <option value="Cats"></option>
            </datalist>

                  <!--Section Skills - Start of Fieldset-->
            <fieldset class="repeating_skills">
              <input name="attr_SK_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" >
              <div class="sheet-filter-box">
                <span class="sheet-hidden"><input name="attr_SK_RowID" type="text">  <input name="attr_SK_Target-TA" type="text"> <input name="attr_SK_ModPrefix" type="hidden" value="?"></span>
                      <!--Skills Fieldset - Play/Edit Visalization of the Skills, Parameters and Notes will appear in separate div-->
                <div style="margin:0px; ">
                  <input name="attr_SK_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                  <input name="attr_SK_Strain_max"  type="hidden" value="0">

                        <!--Skill Fieldset - Class-->
                  <input name="attr_SK_Name" type="text" hidden class="sheet-testPlaceholder" placeholder="Name" >
                  <select class="sheet-selShort sheet-HideIfNotEditMode" name="attr_SK_Class" title="@{SK_Class} : Select between General, Artisan and Knowledge to select name from appropriate dropdown list">
                    <option value="General" selected>General</option>
                    <option value="Knowledge" >Knowledge</option>
                    <option value="Artisan" >Artisan</option>
                  </select>

                        <!--Skill Fieldset - Button & Name-->
                  <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                    <button class="sheet-text-button sheet-api" name="roll_SK_Roll-fromSheet" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : @{SK_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask}~Strain:@{SK_Strain_max} ~ Action: SK: @{SK_RowID} "
                    title="%{selected|Roll_SK_Roll-fromSheet} Roll this Skill Test.">
                    <input name="attr_SK_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <button class="sheet-hidden" name="roll_SK_Roll" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target-TA}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : @{SK_ModPrefix}{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask}~Strain:@{SK_Strain|max} ~ Action: SK: @{SK_RowID} "
                    title="%{selected|Roll_SK_Roll} Roll this Skill Test.   This version uses T_Target-TA instead of T_Target. on ?D1- target type it will try to get a Token ID.">Roll  </button>
                    <button class="sheet-text-button sheet-NoAPI" name="roll_SK_Roll-NoAPI" type="roll"
                    value="@{SK_RollType} &{template:rolltargetnumber} @{SK_Target-NoAPI} {{header=@{charName}: @{SK_Name}}} {{Step=[[?{Step|@{SK_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{SK_DisplayText} @{SK_SuccessText}}}"
                    title="%{selected|Roll_SK_Roll-NoAPI} Roll this Skill Test.">
                    <input name="attr_SK_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name">  </button>
                    <!-- <input name="attr_SK_Name"  type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-bordered-bottom" placeholder="Name"> -->
                    <span class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_Name}:   Skill Name - This is an knowledge skill. Select a Skill or type your own.">
                    <input name="attr_SK_Name"  type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Knowledge" name="attr_SK_Class" >
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" list="knowledge_skill" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom" placeholder="Name">
                      <input name="attr_SK_Name" list="knowledge_skill" type="text" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom" placeholder="Name">
                    </span>
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Artisan" name="attr_SK_Class" >
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" list="artisan_skill" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-bordered-bottom" placeholder="Name">
                      <input name="attr_SK_Name" list="artisan_skill" type="text" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-bordered-bottom" placeholder="Name">
                    </span>
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" name="attr_SK_Class" checked>
                    <span class="sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_Name" type="text" list="general_skill" class="sheet-txtMed sheet-hideIfPlaceholder sheet-NotCreation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill" class="sheet-txtLong sheet-hideIfNotPlaceholder sheet-NotCreation  sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill_creation" class="sheet-txtMed sheet-hideIfPlaceholder sheet-Creation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" list="general_skill_creation" class="sheet-txtLong sheet-hideIfNotPlaceholder  sheet-Creation sheet-bordered-bottom sheet-HideIf1879" placeholder="Name" >
                      <input name="attr_SK_Name" type="text" class="sheet-txtMed sheet-hideIfPlaceholder sheet-NotCreation sheet-bordered-bottom sheet-HideIfNot1879" placeholder="Name" >

                    </span>
                  </span>

                    <!--JBF 210115 : In Edit mode, the name is out of the button to be editable-->
                  </span>
                  <span class="sheet-hideIfNotPlaceholder sheet-titlespan" style="margin-left: 100px;" title="@{repeating_skills_X_SK_textImport}:   Skill Text import: This only shows up if Name is empty.">
                    <textarea type="text" name="attr_SK_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                    <span class="sheet-small">
                      If you have a PDF copy of the book, you can copy an entire Skill or Questor Devotion description (starting with the name, and including everything) and paste it into this tiny text box. It will be parsed and whatever fields can be set based upon the text will be. You will still need to manually set some of the fields, most importaintly "Modifiers".
                      You can also just type the Skill Name, and it will just be Autofilled with settings from the database.

                    </span>
                  </span>

                        <!--Skills Fieldset - Mod-Type-->
                  <span class="sheet-fixed-width sheet-w50px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder" >
                    <span>
                      <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="Artisan" name="attr_SK_Class" >
                      <span class="sheet-HideIfNotCloseChecked">
                        <input name="attr_SK_Attribute" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Cha">
                        <span class="sheet-HideIfCloseChecked">
                          <button class="sheet-text-button sheet-api sheet-fancyfont sheet-button-nodice" name="roll_SK_Roll-Cha-fromSheet" type="roll"
                          value="!Earthdawn~ charID: @{character_id}~ Target: @{SK_Target}~ @{SK_RollType}~  foreach:sct:ust:c~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{SK_Karma-Ask}: @{DPGlobalMode}@{SK_DP-Ask} ~ Action: SKc: @{SK_RowID} "
                          title="%{selected|Roll_SK_Roll-Cha-fromSheet} Roll this Artisan Skill Test using Cha (specific to non Charisma based Artisan Skills).">
                          Cha</button>
                          <button class="sheet-text-button sheet-NoAPI" name="roll_SK_Roll-Cha-NoAPI" type="roll"
                          value="@{SK_RollType} &{template:rolltargetnumber} @{SK_Target-NoAPI} {{header=@{charName}: @{SK_Name}}} {{Step=[[?{Step|@{SK_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{SK_DisplayText} @{SK_SuccessText}}}"
                          title="%{selected|Roll_SK_Roll-NoAPI} Roll this Artisan Skill Test using Charisma as Attrbute (specific to non Charisma based Artisan Skills).">
                          Cha  </button>
                        </span>
                      </span>
                    </span>
                    <span>
                      <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Class" >
                      <span class="sheet-fixed-width sheet-w50px sheet-HideIfNotCloseChecked sheet-iconselect-span sheet-titlespan" title="@{repeating_skills_X_SK_Mod-Type}  What modifiers does this Skill apply.">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="0"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No modifiers at all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Action" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action" title="Modifiers that apply to all Action Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Effect"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-effect" title="Modifiers that apply to Effects Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Attack"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks" title="Modifiers that apply to Attacks."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Attack CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-attacks-cc" title="Modifiers that apply to Close Combat Attacks."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Damage"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage" title="Modifiers that Apply to Damages."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Damage CC"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-damage-cc" title="Modifiers that apply to close Combat Damages"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="Init"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-initiative" title="Modifiers that apply to Initiative Tests."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="JumpUp"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-jumpup" title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Mod-Type" value="NoRoll"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-interdiction" title="No Roll"></span>
                        </span>
                        <select name="attr_SK_Mod-Type" class="sheet-iconselect-select sheet-w50px">
                          <option value="0" title="No modifiers at all."> None</option>
                          <option value="Action" selected title="Modifiers that apply to all Action Tests."> Action Test</option>
                          <option value="Effect" title="Modifiers that apply to Effects Tests."> Effect Test</option>
                          <option value="Attack" title="Modifiers that apply to Attacks."> Attack Test</option>
                          <option value="Attack CC" title="Modifiers that apply to Close Combat Attacks."> Attack Test Close Combat</option>
                          <option value="Damage" title="Modifiers that apply to Damage."> Damage</option>
                          <option value="Damage CC" title="Modifiers that apply to Close Combat Damage."> Damage Close Combat</option>
                          <option value="Init" title="All Initiative modifiers apply to this test."> Initiative </option>
                          <option value="JumpUp" title=title="Modifiers that apply to Jumping Up Test, i.e. Initiative penalties and no Knockdown.">Jump Up</option>
                          <option value="NoRoll" title="This Skill does not have a step or make dice rolls. Pressing the 'Roll' button will however spend strain and load Karma."> No Roll</option>
                        </select>
                        <!-- Note that when evaluated numerically, (0) == 0. When evaluated as a string they are distinct. The API code makes use of this. -->

                        <input class="sheet-testCloseChecked" name="attr_SK_Special" hidden value="Recovery" type="checkbox">
                        <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-recovery"></span>
                        <input class="sheet-testCloseChecked" name="attr_SK_Special" hidden value="Knockdown" type="checkbox">
                        <span class="sheet-iconstaticsmall sheet-HideIfNotCloseChecked sheet-icon-knockeddown"></span>
                      </span>
                    </span>
                  </span>

                        <!--JBF Will be used for testing if NoRoll to hide many unnecassry fields -->
                  <input type="hidden" name="attr_SK_Mod-Type" class="sheet-testModType"   >

                        <!--Skills Fieldset - Rank-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfEditMode sheet-hideIfPlaceholder sheet-HideIfOverviewNoEdit sheet-ShowIfPrint">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_skills_X_SK_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Skill, like using Air Dance and Tiger Spring together.">
                        <input name="attr_SK_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_SK_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_skills_X_SK_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <input name="attr_SK_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_skills_X_SK_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Rank-Adjust}: Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_SK_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                      </span>
                    </span>
                  </span>
                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-bordered-bottom">
                      <span class="" title="@{repeating_skills_X_SK_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Skill, like using Air Dance and Tiger Spring together.">
                        <input name="attr_SK_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                      </span>
                      <input name="attr_SK_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_skills_X_SK_Rank}:   Characters Base Rank in this talent."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                        <input name="attr_SK_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                      </span>
                    </span>
                  </span>

                        <!--Skills Fieldset - Attribute-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Attribute}  What attribute is associated with this talent.">
                    <span class="sheet-HideIfNoRoll" title="@{repeating_skills_X_SK_Attribute}  What attribute is associated with this talent.">
                      <select name="attr_SK_Attribute" class="sheet-selShort">
                        <option value="0" selected title="This talent does not have an associated attribute.">None</option>
                        <option value="Dex" title="Dexterity.">Dex</option>
                        <option value="Str" title="Strength.">Str</option>
                        <option value="Tou" title="Toughness.">Tou</option>
                        <option value="Per" title="Perception.">Per</option>
                        <option value="Wil" title="Willpower.">Wil</option>
                        <option value="Cha" title="Charisma.">Cha</option>
                        <option value="Initiative" title="Initiative. Use only for Initiative replacement talents">Initiative</option>
                      </select>
                    </span>
                  </span>

                        <!--Skills Fieldset - Step-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                    <span class="sheet-stepSpan sheet-HideIfEditMode sheet-bordered-bottom">
                      <span title="@{repeating_skills_X_SK_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                        <input name="attr_SK_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                        <input name="attr_SK_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                      </span>
                      <input name="attr_SK_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_skills_X_SK_BaseStep}:   Permanent Step of the Skill before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                      <input name="attr_SK_Step" readonly class="sheet-StepBig sheet-StepTotal" title="@{repeating_skills_X_SK_Step}:   Final action Step for this talent."  type="number"  >
                      <span title="@{repeating_skills_X_SK_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                        <input name="attr_SK_Mods" type="hidden" class="sheet-redGreen" value="0">
                        <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                        <input name="attr_SK_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                      </span>
                    </span>
                          <!--JBF 2101009 : When in edit view, all the buffs disappear and the Rank becomes editable-->
                    <span class="sheet-HideIfNotEditMode ">
                      <input name="attr_SK_BaseStep" readonly class="sheet-Big sheet-NumShort sheet-bordered-bottom" type="number" title="@{repeating_skills_X_SK_BaseStep}:   Permanent Step of the Skill before any temporary situation or manual modifiers (displayed top right and left).">
                    </span>
                  </span>

                  <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfNotOption5">
                      <input name="attr_SK_Step_max" type="text" readonly class="sheet-w100px sheet-bordered-bottom sheet-HideIfNoRoll" title="@{repeating_skills_X_SK_Step_max}:   Dice to be rolled for the corresponding step.">
                  </span>

                        <!--Skills Fieldset - 210106 Targets Targets depend on API, but also if Action, it is Target, but if Effect it is Damage-->
                  <span class="sheet-fixed-width sheet-w50px sheet-text-center sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-hideIfPlaceholder">
                    <input class="sheet-testChecked sheet-hidden" name="attr_SK_ModType-ArmorType" type="checkbox" value="1">
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-api">
                            <!--Target API-->
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Skill does not target a defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Skill targets Physical Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Skill targets Mystic Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Skill targets Social Defense."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets individually Physical Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets individually Mystic Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets individually Social Defense of each target."></span>-e</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Skills, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                        <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_SK_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                      </span>

                      <select class="sheet-iconselect-select sheet-w50px" name="attr_SK_Target" title="@{repeating_skills_X_SK_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                        <option selected value="None" title="No Target Number">None</option>
                        <option disabled>-- Single Target --</option>
                        <option value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                        <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                        <option value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                        <option disabled>-- Multi --</option>
                        <option value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                        <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                        <option value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                        <option disabled>-- Multi Highest --</option>
                        <option value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                        <option value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                        <option disabled>-- Multi Each --</option>
                        <option value="PD-each" title="Targets indivdually Physical Defense of each target.">PD-each</option>
                        <option value="MD-each" title="Targets indivdually Mystic Defense of each target.">MD-each</option>
                        <option value="SD-each" title="Targets indivdually Social Defense of each target.">SD-each</option>
                        <option disabled>-- Multi Highest+1 --</option>
                        <option value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                        <option value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                        <option disabled>-- Single Natural --</option>
                        <option value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                        <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                        <option value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                        <option disabled>-- Query --</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                        <option value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                        <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                        <option value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                        <option value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                        <option disabled>-- Fixed --</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="5" title="The target number is 5.">5</option>
                        <option value="6" title="The target number is 6.">6</option>
                        <option value="10" title="The target number is 10.">10</option>
                      </select>
                    </span>
                          <!--Target NoAPI-->
                    <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_skills_X_SK_Target-NoAPI}  What does this talent target.">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value=" "><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Skill does not target a defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Skill targets Physical Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Skill targets Mystic Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Skill targets Social Defense."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                      </span>
                      <select class="sheet-iconselect-select" name="attr_SK_Target-NoAPI">
                        <option selected value=" " title="This Skill does not target a defense.">None</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Skill targets Physical Defense.">PD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Skill targets Mystic Defense.">MD</option>
                        <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Skill targets Social Defense.">SD</option>
                        <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                      </select>
                    </span>
                          <!-- JBF Target Armor when Damage-->
                    <span class="sheet-iconselect-span sheet-HideIfNotChecked sheet-HideIfNoRoll sheet-api">
                      <span class="sheet-iconselect-icon">
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="N/A" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="Not Applicable as this Skill does not do damage."></span></span>
                        <input checked type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA" ><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Physical Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Mystic Armor protects against this Damage."></span></span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="PA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PA" title="Only Natural Physical Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="MA-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MA" title="Only Natural Mystic Armor protects against this Damage."></span>-Nat</span>
                        <input type="checkbox" name="attr_SK_ArmorType" class="sheet-hidden sheet-testCloseChecked" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-interdiction" title="No Armor protects against this Damage."></span></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-w50px" name="attr_SK_ArmorType" title="@{repeating_skills_X_SK_Armortype}  What Armor would apply to resisting this Damage.">
                        <option value="N/A" title="Not Applicable as this Skill does not do damage">N/A</option>
                        <option selected value="PA" title="Physical Armor protects against this Damage">PA</option>
                        <option value="MA" title="Mystic Armor protects against this Damage">MA</option>
                        <option value="PA-Nat" title="Only Natural Physical Armor protects against this Damage">PA-Nat</option>
                        <option value="MA-Nat" title="Only Natural Mystic Armor protects against this Damage">MA-Nat</option>
                        <option value="None" title="No Armor protects against this Damage">None</option>
                      </select>
                    </span>
                  </span>
                        <!--Skills Fieldset - Origin-->
                  <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Type}  How does the Adept know this talent.">
                    <select name="attr_SK_Type" class="sheet-LockIfChecked sheet-selLong">
                      <option value="Novice" selected title="This is a Novice skill." >Novice</option>
                      <option value="Journeyman" title="This is a Journeyman skill.">Journeyman</option>
                      <option value="Warden" title="This is a Warden skill." >Warden</option>
                      <option value="Master" title="This is a Master skill." >Master</option>
                    </select>
                  </span>

                        <!--Skills Fieldset - Action-->
                  <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfOverviewNoEdit sheet-hideIfPlaceholder sheet-ShowIfPrint" title="{repeating_skills_X_SK_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Class" >
                    <span class="sheet-fixed-width sheet-w30px sheet-text-center sheet-iconselect-span sheet-titlespan sheet-HideIfNotCloseChecked" title="{repeating_skills_X_SK_Action Type of action - 3/4 black for Standard - 1/4 black for Simple - white for Free - Clock for Sustained">
                      <span class="sheet-iconselect-icon sheet-HideIfNoRoll">
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Standard" checked><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-standard" title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Simple" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Free" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="Sustained" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" name="attr_SK_Action" type="checkbox" value="NA" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="No Action for certain Skills"></span>
                      </span>
                      <select class="sheet-iconselect-select sheet-HideIfNoRoll sheet-w30px" name="attr_SK_Action" >
                        <option value="Standard" selected title="Standard Action: A character can perform one Standard action per combat round at its Initiative. A character may spend his Standard action to move, allowing him to move up to double his Movement Rate.">Standard</option>
                        <option value="Simple" title="Simple Action : Apart from his Standard Action, a character can perform a variety of Simple actions during a combat round, which may or may not require him to make a test.Technically, there is no limit to the number of Simple actions a character can perform during a combat round. However, the gamemaster may choose to limit what a character can reasonably do during a (roughly) six-second time period.">Simple</option>
                        <option value="Free" title="Free Action: Free actions are usually part of other actions a character takes, enhancing them.">Free</option>
                        <option value="Sustained" title="A Sustained action for a talent or skill usually requires the character to spend more than one round before a test is made.">Sustained</option>
                        <option value="NA" title="No Action for certain Skills">NA</option>
                      </select>
                    </span>
                  </span>

                        <!--Skills Fieldset - Strain-->
                  <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder" title="@{repeating_skills_X_SK_Strain}: number of strain points per use">
                    <input name="attr_SK_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                    <input name="attr_SK_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                    <input name="attr_SK_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                  </span>

                        <!--Skills Fieldset - Karma & DP-->
                  <span class="sheet-hideIfPlaceholder">
                          <!--JBF Karma Toggle-Simple-->
                    <span class="sheet-Karma-ControlBox">
                      <input type="hidden" name="attr_SK_Karma-Ask" value="0">  <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_SK_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_SK_Karma-Limit_max" hidden value="1" class="sheet-testCloseChecked">
                        <span class="sheet-HideIfNotCloseChecked">
                          <label class="sheet-labelcheckbox" hidden title="@{SK_Karma}   Automatically Spends One Karma when Karma is On" >
                            <input type="checkbox" name="attr_SK_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                          </label>
                        </span>
                        <input type="checkbox" name="attr_SK_Karma-Limit_max" hidden value="1" class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{SK_Karma} : Number of Karma Points to be spent when Karma is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{SK_Karma} Don't Spend any Karma when Karma is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              <input class="sheet-testNum" type="hidden" name="attr_SK_Karma" value="0"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{SK_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                            </span>
                            <input type="hidden" name="attr_SK_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                            <input type="hidden" name="attr_SK_Karma-Limit_max" value="0" class="sheet-testKarMax">
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{SK_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              <option value="3" title="@{SK_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                            <select name="attr_SK_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{SK_Karma} Don't Spend any Karma when Karma is On.">0</option>
                              <option value="1" title="@{SK_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                              <option value="2" title="@{SK_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>
                          <!--JBF End Of Karma Toggle-Simple-->
                          <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                    <span class="sheet-DP-ControlBox">
                      <input type="hidden" name="attr_SK_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                      <input type="checkbox" name="attr_SK_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked" >
                        <input type="checkbox" name="attr_SK_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                        <span class="sheet-HideIfNotChecked">
                          <input type="checkbox" name="attr_SK_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                          <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{SK_DP}   Automatically Spends One Devotion when Devotion is On" >
                            <input type="checkbox" name="attr_SK_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                          </label>
                          <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{SK_DP}   This Devotion requires one DP at each use."></span>
                        </span>
                        <span class="sheet-HideIfChecked">
                          <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{SK_DP} : Number of Devotion Points to be spent when Devotion is On">
                            <span class="sheet-iconselect-icon-noedit">
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{SK_DP} Don't Spend any Dp when Dp is On."></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{SK_DP}   Automatically Spends One Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On"></span>
                              <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On"></span>
                            </span>
                            <input type="hidden" name="attr_SK_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                            <input type="hidden" name="attr_SK_DP-Limit_max" class="sheet-testKarMax">
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                              <option value="0" selected title="@{SK_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              <option value="3" title="@{SK_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                            <select name="attr_SK_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                              <option value="0" selected title="@{SK_DP} Don't Spend any Dp when Dp is On.">0</option>
                              <option value="1" title="@{SK_DP}   Automatically Spends One Dp when Dp is On">1</option>
                              <option value="2" title="@{SK_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                            </select>
                          </span>
                        </span>
                      </span>
                    </span>   <!-- JBF End Of DP Toggle -->
                  </span>   <!-- end skills Karma and DP -->

                        <!-- Skills Fieldset -Show Notes/Parameters -->
                  <span class="sheet-nowrap0 sheet-hideIfPlaceholder sheet-HideIfPrint">
                    <label title="@{repeating_skills_X_SK_ShowNotes}   Show description of Skill/Power">
                      <input type="checkbox" name="attr_SK_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_CombatSlot}  Should this Skill be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_SK_CombatSlot" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_skills_X_SK_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_SK_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>

                    <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                      <!--Compendium Button-->
                      <input type="checkbox" name="attr_SK_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                      <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_SK_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                    </span>
                </span>
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint">
                    <input name="attr_SK_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked sheet-HideIfNotEditMode">
                      <input name="attr_SK_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                      <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                    </span>
                    <span class="sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfNotCloseChecked">
                      <input name="attr_SK_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                    </span>
                  </span>
                </div>    <!--JBF 210106 : End of Play Visalization of the Skills, i.e. when all details are collapsed-->


                      <!--Skills Fieldset - Start of Parameter Visalization of the Skills, Where parameters are set -->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SK_Parameters"  type="checkbox" value="1">
                <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-bordered-bottom">
                        <!--Skills Fieldset - Karma & DP Parameters-->
                  <div class="sheet-floatRight sheet-content sheet-api" style="height:30px">
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_skills_X_SK_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                      Max Karma Allowed :<span class="sheet-iconstatic sheet-icon-karma"></span>
                      <input type="number" name="attr_SK_Karma-Limit_max" value="0" min="0" max="3" class="sheet-numShorter" title="@{repeating_skills_X_SK_Karma-Limit_max} : Maximum number of Karma Points that can be spent on a single test from Discipline and other Abilities">
                    </span>
                    <span class="sheet-nowrap0 sheet-label" title="@{repeating_skills_X_SK_Karma-Limit} : Does this Skill require Karma Points to be spent every time it is used">
                      Karma Required :
                      <input type="checkbox"  name="attr_SK_Karma-Limit" value="1" class="sheet-numShort" title="@{repeating_skills_X_SK_Karma-Limit} : Does this Skill require Karma Points to be spent every time it is used">
                    </span>
                    <span class="sheet-HideIfNotQuest sheet-nowrap0 sheet-label">
                      <span title="@{repeating_skills_X_SK_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                        Max DP Allowed : <span class="sheet-iconstatic sheet-icon-devotion"></span>
                        <input type="number" name="attr_SK_DP-Limit_max" value="0" min="0" max="3" class="sheet-numShort" title="@{repeating_skills_X_SK_DP-Limit_max} : Maximum number of Devotion Points that can be spent on a single test from Discipline and other Abilities">
                      </span>
                      <!--JBF Devotion Required-->
                      <input class="sheet-testDevotion" name="attr_SK_Type" type="hidden">
                      <span class="sheet-hidden sheet-UnhideIfDevotion sheet-label" title="@{repeating_skills_X_SK_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                        DP Required :
                        <input type="checkbox"  name="attr_SK_DP-Limit" value="1" class="sheet-numShort" title="@{repeating_skills_X_SK_DP-Limit} : Does this Questor Devotion require Dev Points to be spent every time it is used">
                      </span>
                    </span>
                    <!-- <span class="sheet-nowrap0 sheet-HideIfNoRoll" title="@{repeating_skills_X_SK_CombatSlot}:   Should this Skill be summarized on the combat tab and placed in a Token Action?">
                    <span class="sheet-api">Tkn Actn</span><span class="sheet-NoAPI">Combat Tab</span>
                    <input name="attr_SK_CombatSlot" type="checkbox" value="1" ></span> -->
                  </div>

                        <!-- Skills Fieldset - Parameters -->
                  <div class="sheet-content">
                    <input type="hidden" hidden name="attr_SK_Mod-Type" class="sheet-testModType"  >
                          <!--Skills Fieldset - Everything related to roll : display, special, silent -->
                    <span class="sheet-nowrap">
                      <span class="sheet-nowrap sheet-label" title="@{repeating_skills_X_SK_RollType}   Rolls should be made: public, gm, or hidden?">
                        <!-- <span class="sheet-iconstatic sheet-icon-dice"></span> : -->
                        Visibility :
                        <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                        <span class="sheet-iconselect-span">
                          <span class="sheet-iconselect-icon">
                            <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_SK_RollType" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                            <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SK_RollType" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          </span>
                          <select name="attr_SK_RollType" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                          <select name="attr_SK_RollType" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                            <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                            <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                            <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                            <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                            title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                          </select>
                        </span>
                      </span>
                      <span class="sheet-nowrap sheet-HideIfNoRoll sheet-api sheet-label sheet-HideIfNoRoll">Result Mods :
                        <input name="attr_SK_Result-Mods" type="number" value="0" class="sheet-numShort" title="@{repeating_skills_X_SK_Result-Mods}:   Modifications to the test result that are applied AFTER the roll.">
                      </span>
                      <br>
                    </span>

                          <!--Skills Fieldset -Modifier exceptions-->
                    <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" value="General" checked name="attr_SK_Class" >
                    <div class="sheet-HideIfNotEditMode sheet-hideIfPlaceholder sheet-nowrap sheet-HideIfNotOption1 sheet-HideIfNoRoll sheet-HideIfNotCloseChecked">
                      <span class="sheet-label"> Modifiers Exceptions - </span>
                      <span class="sheet-label">Move Based :
                        <label title="@{repeating_skills_X_SK_MoveBased}  If checked then this is an Movement based action and suffers penalties when the characters movement is impaired">
                          <input type="checkbox" name="attr_SK_MoveBased" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-move-based"></span>
                        </label>
                      </span>

                      <input class="sheet-testChecked sheet-hidden" name="attr_SK_ActnEfct" type="checkbox" checked value="1">
                      <span class="sheet-HideIfNotChecked sheet-label">Defensive :
                        <label title="@{repeating_skills_X_SK_Defensive}   If checked, then this action is an Active Defense and the -3 penalty from Defensive Stance will not apply on Tests .">
                          <input type="checkbox" name="attr_SK_Defensive" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-defensive-exc"></span>
                        </label>
                      </span>

                    </div>

                          <!--Skills Fieldset - Special-->
                    <div class="sheet-HideIfNotOption4 sheet-api">
                      <span class="sheet-label" title="@{repeating_skills_X_SK_Special}  Certain talents or powers require special handling and have been pre-coded.">Special:
                        <select name="attr_SK_Special" class="sheet-txtShort">
                          <option value="None" selected title="No modifiers at all.">None</option>
                          <option value="Initiative" title="This is an Initiative Replacement Skill (such as Air Dance or Tiger Spring) that should have it's results sent to the turn tracker.">Initiative</option>
                          <option value="Recovery" title="This is a Recovery Replacement Skill (such as Fireblood) that should have it's results added to current health.">Recovery</option>
                          <option value="Knockdown" title="This is a Knockdown replacement Talent such as Wound Balance.">Knockdown</option>
                        </select>
                      </span>
                    </div>

                          <!--Skills Fieldset - Links Button-->
                    <div class="sheet-api sheet-HideIfNotOption3">
                      <input name="attr_SK_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-nowrap sheet-HideIfNotCloseChecked sheet-api sheet-label">
                        Link : <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SK_btnSetLink" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SK : @{SK_RowID}"
                        title="@{repeating_skills_X_SK_btnSetLink} Set the Links for this Skill. Links allow to automatically add the Rank of another Skill, Knack, Thread Item or Other to the Effective Rank of this Skill"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                        <span title="@{repeating_skills_X_SK_LinksGetValue} : List of Names of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Skill, for a Free Skill to get the Circle of the Discipline, or for a combination of Skills/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <span class="sheet-autoexpand-wrap">
                            <input name="attr_SK_LinksGetValue" type="text" readonly class="sheet-bordered">
                            <span name="attr_SK_LinksGetValue" class="sheet-autoexpand"></span>
                          </span>
                          <input name="attr_SK_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksGetValue_max} : List of RowIds of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Skill, for a Free Skill to get the Circle of the Discipline, or for a combination of Skills/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                          <input name="attr_SK_LinksProvideValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksProvideValue_max} : List of RowIds of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Skill to provide its Rank to a linked Knack.">
                          <input name="attr_SK_LinksProvideValue" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_skills_X_SK_LinksProvideValue} : List of Names of properties (Skills, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Skill to provide its Rank to a linked Knack.">
                        </span>
                      </span>
                    </div>

                          <!--Skills Fieldset - SFX-->
                    <div class="sheet-HideIfNotOption2 sheet-api">
                      <span class="sheet-label"> After roll parameters - </span>
                      <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                        <select name="attr_SK_sayTotalSuccess" class="selLong" title="@{repeating_skills_X_SK_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                          <option value="0" selected title="@{repeating_skills_X_SK_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                          <option value="1" title="@{repeating_skills_X_SK_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                        </select>
                      </span>
                      <span class="sheet-nowrap0 sheet-api">
                        <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SK_btnSetFX" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: SK: @{SK_RowID}"
                        title="@{repeating_skills_X_SK_btnSetFX} Set the Special Effects for this Skill.">SFX</button> :
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_skills_X_SK_FX}:   Special Effects command. FX command to be performed when this ability is used. Press 'SFX' button to edit this field.">
                          <input name="attr_SK_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_SK_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </span>
                            <!--Skills Fieldset - Success Text-->
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_SK_DisplayText}:   Text to display whether the test succeeds or not. If there is a ~ (tilde) then only displays up until the first tilde is displayed and the rest is run through the API parser.">
                        <input name="attr_SK_DisplayText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_SK_DisplayText" class="sheet-autoexpand"></span>
                        <span>Display Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_skills_X_SK_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the ability works.">
                        <input name="attr_SK_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_SK_SuccessText" class="sheet-autoexpand"></span>
                        <span>Success Text</span>
                      </label>
                      <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_skills_X_SK_FailText}:   Text to display if the test fails.">
                        <input name="attr_SK_FailText" type="text" class="sheet-bordered-bottom" value=" ">
                        <span name="attr_SK_FailText" class="sheet-autoexpand"></span>
                        <span>Fail Text</span>
                      </label>
                    </div>
                  </div>    <!-- end Skills Fieldset - Parameters -->
                </div>    <!--JBF 210106 : End of Parameter  of the Skills, Where parameters are set-->

                      <!--Skills Fieldset - Start of Detail  of the Skills, Where secundary information during play is displayed, but not parametrization-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SK_ShowNotes" value="1"
                type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <textarea name="attr_SK_Notes" class="sheet-details" title="@{repeating_skills_X_SK_Notes}   Description of Skill and how it works." placeholder="Description of the Skill and how it works."></textarea>
                </div>
                      <!--JBF 210106 : End of Detail  of the Skills, Where secundary information during play is displayed, but not parametrization-->
              </div>    <!-- end filterbox -->
            </fieldset>
          </div>    <!-- end  Section Skills - Content -->


                <!-- Skills Section - Languages Header
                Skills and Talents are treated differently due to the difference in learning time mechanics. For Skills, this section directly lists the Skill Rank automatically calculated from the languages Known
                For Talents, it just calculates the number of languages known but the talent will still have to be created in the Language section-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverviewNoCreation sheet-HideIfCombat sheet-HideIfCreature">
            <div></div>
            Languages Known
            <div class="sheet-floatRight">
              <span class="sheet-info"
              title="Instructions: Speak and Read/Write Skills Ranks are entered here, and with API the LPs are calculated automatically. The equivalent Talents are entered in the Talents Section. Languages known are to be recorded here, to a maximum of the Rank">i</span>
            </div>
          </div>

                <!--Skills Section - Languages-->
          <div class="sheet-content sheet-HideIfOverviewNoCreation sheet-HideIfCombat sheet-HideIfCreature">
            <div>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap"></span>
              <b class="sheet-fixed-width sheet-nowrap sheet-titlespan sheet-heading sheet-text-center" style="width:19em;">Skill</b>
              <b class="sheet-fixed-width sheet-nowrap sheet-titlespan sheet-heading sheet-text-center" style="width:19em;">Talent  </b>
            </div>
            <div>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap"></span>
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-titlespan" >
                <button class="sheet-text-button sheet-api sheet-button-nodice sheet-fancyfont" name="roll_LS-Speak-Check"
                type="roll"
                title="%{selected|LS-Speak-Check} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="!Earthdawn~ charID: @{character_id}~  foreach~ Value: LS-Speak-Rank~ Roll: ?{Modification|0}">
                Speak</button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_LS-Speak-CheckNoAPI"
                type="roll"
                title="%{selected|LS-Speak-CheckNoAPI} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="@{RollType} &{template:default} {{name=Speak Language Skill}} {{Step=[[?{Step|@{Per}+@{LS-Speak-Rank}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">Speak  </button>
                &nbsp;&nbsp;<input name="attr_LS-Speak-Rank" type="number"  value="0" readonly class="sheet-numShorter sheet-Big" title="@{LS-Speak-Rank} : This is the Rank in the Speak Language Skill. Note the difference with the Speak Language Talent that is entered in the Talent section.">
              </span>

              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap" >
                <button class="sheet-text-button sheet-api sheet-button-nodice sheet-fancyfont" name="roll_LS-ReadWrite-Check"
                type="roll"
                title="%{selected|LS-ReadWrite-Check} : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="!Earthdawn~ charID: @{character_id}~  foreach~ Value: LS-ReadWrite-Rank~ Roll: ?{Modification|0}">
                Read/Write</button>
                <button class="sheet-text-button sheet-NoAPI sheet-button-nodice sheet-fancyfont" name="roll_LS-ReadWrite-CheckNoAPI"
                type="roll"
                title="%{selected|LS-ReadWrite-CheckNoAPI} : : Roll a Speak Language Skill Test in order to learn a new Language. Cf PG p.191 "
                value="@{RollType} &{template:default} {{name=Read Write Language Skill}} {{Step=[[?{Step|@{Per}+@{LS-ReadWrite-Rank}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result: [[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}">Read/Write </button>
                <input name="attr_LS-ReadWrite-Rank" type="number" value="0" readonly class="sheet-numShorter sheet-Big" title="@{LS-ReadWrite-Rank} : This is the Rank in the Read Write Language Skill. Note the difference with the Read Write Language Talent that is entered in the Talent section.">
              </span>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" >
                Speak :
                &nbsp;<input name="attr_LT-Speak-Known" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-Speak-Known}:   Total languages spoken as Talents. Note that you need at least one Talent Rank per spoken language. Talent is entered in the Talents Section"> /
                <input name="attr_LT-Speak-Rank" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-Speak-Rank}:   Rank in the Speak Language Talent as defined in the Talents Section (Must fill in Special field o identify the right Talent)">
              </span>
              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap sheet-label" >
                Read/Write :
                <input name="attr_LT-ReadWrite-Known" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-ReadWrite-Known}:   Total languages read and written as Talents. Note that you need at least one Talent Rank per  language. Talent is entered in the Talents Section">/
                <input name="attr_LT-ReadWrite-Rank" type="number" value="0" readonly class="sheet-numShorter" title="@{LT-ReadWrite-Rank}:   Rank in the Read Write Language Talent as defined in the Talents Section (Must fill in Special field o identify the right Talent)">
              </span>
            </div>

            <input type="checkbox" checked value="1" name="attr_languages-edit-mode" class="sheet-testRepEditMode sheet-hidden" >
            <!--This is the list of Panda Gaming Grove with approval of Morgan Weeks.-->
            <!--http://pandagaminggrove.blogspot.com/search?q=language-->
            <datalist id="languages">
              <option disabled value="Simplified: Race-Language">
              <option value="Dwarf-Throalic"></option>
              <option value="Elf-Sperethiel"></option>
              <option value="Human"></option>
              <option value="Obsidiman"></option>
              <option value="Ork-Or'zet"></option>
              <option value="Troll"></option>
              <option value="T'skrang"></option>
              <option value="Windling"></option>

              <option disabled value="Full: Language(Race)-Dialect or Sublanguage">
              <option value="Scythan(Dwarf)"></option>
              <option value="Scythan(Dwarf)-Throalic" ></option>
              <option value="Kratan(pigdin)" ></option>
              <option value="Sperethiel(Elf)"></option>
              <option value="Sperethiel(Elf)-Theran" ></option>
              <option value="Sperethiel(Elf)-Queen's" ></option>
              <option value="Sperethiel(Elf)-Shosaran"></option>
              <option value="Sperethiel(Elf)-Sereathan" ></option>
              <option value="Cathan"></option>
              <option value="Landisian(Human)-Iopan" ></option>
              <option value="Landisian(Human)-Jerran" ></option>
              <option value="Landisian(Human)-Scavian" ></option>
              <option value="Landisian(Human)-Travaran" ></option>
              <option value="Landisian(Human)-Urupan" ></option>
              <option value="Marellyawenkhurtectl(Obsidiman)"></option>
              <option value="Or'Zat(Ork)"></option>
              <option value="Or'Zet(Ork)"></option>
              <option value="Shivarrotal(T'skrang)"></option>
              <option value="Shivarrotal(T'skrang)-Ishkarat" ></option>
              <option value="Shivarrotal(T'skrang)-Syrtis" ></option>
              <option value="Shivarrotal(T'skrang)-V'Strimon" ></option>
              <option value="Shivarrotal(T'skrang)-K'Tenshin" ></option>
              <option value="Shivarrotal(T'skrang)-T'Kambras" ></option>
              <option value="Shivarrotal(T'skrang)-Hengyoke" ></option>
              <option value="Spirit Wind(T'skrang)"></option>
              <option value="Ustrectish(Troll)"></option>
              <option value="Ustrectish(Troll)-Mountain Range"></option>
              <option value="Ustrectish(Troll)-Mountain Range-Clan"></option>
              <option value="Ustrectish(Troll)-Ustrectish B"></option>
              <option value="Saheerys(Windling)"></option>
              <option disabled value="Elemental Laguages (for Elemental Tongues)">

              <option value="Elemental-Air"></option>
              <option value="Elemental-Earth"></option>
              <option value="Elemental-Fire"></option>
              <option value="Elemental-Water"></option>
              <option value="Elemental-Wood"></option>

              <option disabled value="Vasgothian Languages">

              <option value="Vasgothian-Barrite"></option>
              <option value="Vasgothian-Empirist"></option>
              <option value="Caralk-Midrise"></option>
              <option value="Theran-Bear Strider"></option>
              <option value="Sosl'ree(Leafer)"></option>
            </datalist>

            <!--Skills Section - Languages Fieldset-->
            <fieldset class="repeating_skilll">
              <input name="attr_SKL_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
              <span class="sheet-fixed-width sheet-txtLong sheet-nowrap" title="@{repeating_skilll_X_SKL_Name}:   Name of language - If you want to keep it simple, just use the races... If you want to go deeper in the settings, refer to the Panda Gaming Grove Blog, used to build this list.">
                <input list="languages" name="attr_SKL_Name" type="text" class="sheet-txtLong sheet-bordered-bottom" placeholder="Race-Language or Language(Race)-Dialect" title="@{repeating_skilll_X_SKL_Name}:   Language Name - This is an Language. Select a Language or type your own.">
              </span>
              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_Speak}   Does the character Speak this language as a skill.">&nbsp;&nbsp;Speak :
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="attr_SKL_Speak" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_ReadWrite}   Does the character Read and Write this language as a skill.">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read/Write : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input name="attr_SKL_ReadWrite" type="checkbox" value="1" >
              </span>

              <span class="sheet-fixed-width sheet-txtShort sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_Speak-T}   Does the character Speak this language as a Talent (from the Talents tab).">Speak :
                &nbsp;&nbsp;&nbsp;&nbsp;<input name="attr_SKL_Speak-T" type="checkbox" value="1" >
              </span>
              <span class="sheet-fixed-width sheet-txtMed sheet-nowrap sheet-label" title="@{repeating_skilll_X_SKL_ReadWrite-T}   Does the character Read and Write this language as a Talent (from the Talents tab).">
                &nbsp;&nbsp;&nbsp;Read/Write :&nbsp;&nbsp;&nbsp;<input name="attr_SKL_ReadWrite-T" type="checkbox" value="1" >
              </span>
            </fieldset>
          </div>    <!-- end of skills languages -->
        </div>    <!-- ******************************************* End of Section Skills ******************************************* -->



                <!-- ******************************************* Start of Section Spells ******************************************* -->
        <input name="attr_Hide-Spells-Tab" hidden class="sheet-testCloseChecked" checked type="checkbox" value="1">
        <div class="sheet-section sheet-section-spells sheet-section-core sheet-section-combat sheet-HideIfCloseChecked sheet-PrintNoBreak">

          <input name="attr_show_repeating_step_dice" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption5">
                <!--Section Spells - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-NotCreation">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab6-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab6-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab6-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab6-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            <input class="sheet-testCloseChecked sheet-hidden" name="attr_tab" type="checkbox" value="6">
            <div class="sheet-HideIfCloseChecked"> Spells </div>
            <div class="sheet-HideIfNotCloseChecked">Spellcasting Talents</div>
            <div class="sheet-HideIfPrint">
              <span class=" sheet-HideIfOverview sheet-HideIfCombat">
                <span class="sheet-info" title="Instructions: In this tab are filtered spellcasting talents. Toggle edit to delete or re-create.">i</span>
                <!-- <label title="@{attr_spells-talents-edit-mode} : Toggles the spells talent view to edit mode where the talents can be deleted and recreated.">
                  <input type="checkbox" name="attr_spells-talents-edit-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label> -->
              </span>
            </div>
          </div>    <!-- end Spells - Header -->
          <div class="sheet-Creation sheet-headerbar"> <b class="sheet-creation-order">4b-</b> Spells, Spell Talents, and Matrixes</div>
          <input class="sheet-testAttrCosts" name="attr_Spells-Costs" value="5" type="hidden">
          <div class="sheet-Creation sheet-HideIfCreature sheet-small"> As a spellcaster, you have 2 Free Matrixes that do not count for your 8 Talent points. Note that with API, the links for Free Talents will be automatically created, but may not appear until the sheet is closed and reopened.</div>
          <div class="sheet-Creation sheet-HideIfCreature sheet-small"> System also created a Dummy Talent "Wil" that is used for the Effect test. Do not delete it.</div>
          <div class="sheet-Creation sheet-HideIfCreature">
            You  have to choose


            <input name="attr_Spells-Costs" class="sheet-numShort sheet-attrCostsRed"
            readonly="readonly" value="5"
            title="@{Spells-Costs}   Number of Spell points remaining from the starting Per Step."
            type="number">
            Spells of Circle 1 and 2. Go to your Grimoire (click Spell Tab, and then Grimoire subtab) to add them.
          </div>

                <!--Section Spells - Talents - Content-->
          <div class="sheet-content">
            <input hidden  type="checkbox" value="1" class="sheet-testRepEditMode">

                  <!--Section Spells - Talents - Titles-->
            <div class="sheet-HideIfOverview sheet-HideIfCombat sheet-NotCreation">
              <span class="sheet-HideIfCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Talent Name&nbsp;</b></span>
              <span class="sheet-HideIfNotCreature"><b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">&nbsp;Power Name&nbsp;&nbsp;</b></span>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan ">&nbsp;Rank&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">&nbsp;Step&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotOption5">Dice</b>

              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan">&nbsp;Target&nbsp;</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan  sheet-HideIfNoKarma sheet-api">Kma</b>
              <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest sheet-api">DP</b>
            </div>

                  <!-- Section Spells - Talents - Fieldset -->
            <div class="sheet-NotCreation">
              <input hidden  type="checkbox" value="1" class="sheet-testRepEditMode">
                    <!--This is a duplicate of the repeating_talents fieldset, that only displays the spellcasting talents. Note that the Target is editable so that it is easy to make quick out of sequence rolls-->
              <fieldset class="repeating_talents">
                <input name="attr_T_Special"   type="hidden" class="sheet-spelltab" >
                <div class="sheet-filter-box">
                  <span class="sheet-hidden"><input name="attr_T_RowID" type="text">  <input name="attr_T_Target-TA" type="text"> <input name="attr_T_RollType" type="text"> <input name="attr_T_DisplayText" type="text"> <input name="attr_T_SuccessText" type="text"></span>
                  <div style="margin:0px; ">    <!--Spells - Talent Fieldset - Button & Name-->
                    <input name="attr_T_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan">
                      <button class="sheet-text-button sheet-api"  type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Target: @{T_Target}~  @{T_RollType}~ foreach:sct:ust:c~ modValue : ?{Modification|0} ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}~Strain:@{T_Strain_max}~Action: T: @{T_RowID}"
                      title="%{selected|Roll_T_Roll-fromSheet} Roll this Talent Test.">
                      <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed" placeholder="Name">  </button>
                      <button class="sheet-text-button sheet-NoAPI"  type="roll"
                      value="@{T_RollType} &{template:rolltargetnumber} @{T_Target-NoAPI} {{header=@{charName}: @{T_Name}}} {{Step=[[?{Step|@{T_Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}} {{Text=@{T_DisplayText} @{T_SuccessText}}}"
                      title="%{selected|Roll_T_Roll-NoAPI} Roll this Talent Test.">
                      <input name="attr_T_Name" type="text" class="sheet-buttonlabel sheet-txtMed" placeholder="Name">  </button>
                    </span>

                          <!--Spells - Talent Fieldset - Rank-->
                    <span class="sheet-fixed-width sheet-w75px sheet-titlespan">
                      <input name="attr_T_Type" class="sheet-hidden sheet-testChecked" type="checkbox" value="Free">
                      <input name="attr_T_Type" type="hidden" value="D1-Novice"> <!--Necessary to not get a wrong initialization-->
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="sheet-HideIfChecked" title="@{repeating_talents_X_T_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of another Talent, like using Air Dance and Tiger Spring together.">
                          <input name="attr_T_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_T_LinkValue" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-HideIfNotChecked" readonly title="@{repeating_talents_X_T_LinkValue}: This Talent has been set as Free Talent, so Characters Base Rank in this talent is to be calculated via a Link. Go in Parameters of this Talent to Link to the Discipline."  type="number"  >
                        <input name="attr_T_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase sheet-HideIfChecked" readonly title="@{repeating_talents_X_T_Rank}:   Characters Base Rank in this talent."  type="number"  >
                        <input name="attr_T_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_talents_X_T_Effective-Rank}:   Characters effective Rank in this talent counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_talents_X_T_Rank-Adjust}:   Adjustments to the use of this talent that increases effective rank like Thread Items.">
                          <input name="attr_T_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                        </span>
                      </span>
                    </span>

                          <!--Spells - Talent Fieldset - Step-->
                    <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-hideIfPlaceholder">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span title="@{repeating_talents_X_T_Mod-Auto}: Automatic Test Modifiers coming from Combat Options, Wounds, Situation Modifiers.">
                          <input name="attr_T_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_T_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                        </span>
                        <input name="attr_T_BaseStep" readonly class="sheet-StepBig sheet-StepBase" title="@{repeating_talents_X_T_BaseStep}:   Permanent Step of the Talent before any temporary situation or manual modifiers (displayed top right and left)."  type="number">
                        <input name="attr_T_Step" readonly class="sheet-StepBig sheet-StepTotal"  title="@{repeating_talents_X_T_Step}:   Final action Step for this talent."  type="number"  >
                        <span title="@{repeating_talents_X_T_Mods}:  Manual modifications to the use of this talent that do NOT increase effective rank.">
                          <input name="attr_T_Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_T_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                        </span>
                      </span>
                    </span>

                    <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfNotOption5">
                        <input name="attr_T_Step_max" type="text" readonly class="sheet-w100px sheet-bordered-bottom sheet-HideIfNoRoll" title="@{repeating_talents_X_T_Step_max}:   Dice to be rolled for the corresponding step.">
                    </span>

                          <!--Spells - Talent Fieldset -Target-->
                    <span class="sheet-fixed-width sheet-w50px sheet-text-center">
                      <span class="sheet-iconselect-span sheet-api">
                        <!--Target API-->
                        <span class="sheet-iconselect-icon-noedit">
                          <input checked class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="None"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-action-na" title="This Talent does not target a defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="This Talent targets Physical Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="This Talent targets Mystic Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD1: @{target|Target|token_id}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="This Talent targets Social Defense."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: ?{Target Number|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-ask" title="Ask for target number when roll is made."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: MD: ?{Target Number, maybe relative to MD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Ask: SD: ?{Target Number, maybe relative to SD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3"></span><span class="sheet-iconstatic sheet-icon-ask"></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Physical Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Mystic Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets Social Defense. There could be a variable number of Targets."></span>-v</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDh"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense among all targets."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets individually Physical Defense of each target."></span>-e</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets individually Mystic Defense of each target."></span>-e</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-each"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets individually Social Defense of each target."></span>-e</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-PD" title="Targets highest Physical Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-MD" title="Targets highest Mystic Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SDhp1p"><span class="sheet-HideIfNotCloseChecked">h<span class="sheet-iconstatic sheet-icon-SD" title="Targets highest Social Defense, +1 for each additional target."></span>+1</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="PD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-PD" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="MD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-MD" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="SD-Nat"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-SD" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets."></span>-N</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span><span class="sheet-iconstatic sheet-icon-attacks" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3."></span></span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="2"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 2."></span>2</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="5"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 5."></span>5</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="6"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 6."></span>6</span>
                          <input class="sheet-testCloseChecked sheet-hidden" type="checkbox" name="attr_T_Target" value="10"><span class="sheet-HideIfNotCloseChecked"><span class="sheet-iconstatic sheet-icon-TN" title="The target number is 10."></span>10</span>
                        </span>

                        <select class="sheet-iconselect-select-noedit sheet-w50px" name="attr_T_Target" title="@{repeating_talents_X_T_Target}    How is the Target Number arrived at? What attribute is targeted and how?">
                          <option selected value="None" title="No Target Number">None</option>
                          <option hidden value="PD1: @{target|Target|token_id}" title="Targets Physical Defense. There is always exactly one Target.">PD-1</option>
                          <option value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target.">MD-1</option>
                          <option hidden value="SD1: @{target|Target|token_id}" title="Targets Social Defense. There is always exactly one Target.">SD-1</option>
                          <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made.">Ask</option>
                          <option hidden value="Ask: PD: ?{Target Number, maybe relative to PD|0}" title="Ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3">Ask PD</option>
                          <option value="Ask: MD: ?{Target Number, maybe relative to MD|0}" title="Ask for target number that may be relative to this characters MD when roll is made. IE: +3 would be this characters MD +3">Ask MD</option>
                          <option hidden value="Ask: SD: ?{Target Number, maybe relative to SD|0}" title="Ask for target number that may be relative to this characters SD when roll is made. IE: +3 would be this characters SD +3">Ask SD</option>
                          <option hidden value="PD" title="Targets Physical Defense. There could be a variable number of Targets.">PD-v</option>
                          <option value="MD" title="Targets Mystic Defense. There could be a variable number of Targets.">MD-v</option>
                          <option hidden value="SD" title="Targets Social Defense. There could be a variable number of Targets.">SD-v</option>
                          <option hidden value="PDh" title="Targets highest Physical Defense among all targets.">hPD</option>
                          <option value="MDh" title="Targets highest Mystic Defense among all targets.">hMD</option>
                          <option hidden value="SDh" title="Targets highest Social Defense among all targets.">hSD</option>
                          <option hidden value="PD-each" title="Targets highest Physical Defense among all targets.">hPD</option>
                          <option value="MD-each" title="Targets indidually Mystic Defense of each target.">MD-each</option>
                          <option hidden value="SD-each" title="Targets highest Social Defense among all targets.">hSD</option>
                          <option hidden value="PDhp1p" title="Targets highest Physical Defense, +1 for each additional target.">hPD+1p</option>
                          <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target.">hMD+1p</option>
                          <option hidden value="SDhp1p" title="Targets highest Social Defense, +1 for each additional target.">hSD+1p</option>
                          <option hidden value="PD-Nat" title="Targets Natural Physical Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">PD-Nat</option>
                          <option value="MD-Nat" title="Targets Natural Mystic Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">MD-Nat</option>
                          <option hidden value="SD-Nat" title="Targets Natural Social Defense (Does not include bonuses provided by Spells, Talents, Woven Threads, Etc.) There could be a variable number of Targets.">SD-Nat</option>
                          <option hidden value="Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}" title="Ask the user to click the Token that is being counter-attacked.    Then ask for target number that may be relative to this characters PD when roll is made. IE: +3 would be this characters PD +3.">Riposte</option>
                          <option value="2" title="The target number is 2." >2</option>
                          <option value="5" title="The target number is 5.">5</option>
                          <option value="6" title="The target number is 6.">6</option>
                          <option value="10" title="The target number is 10.">10</option>
                        </select>
                      </span>
                      <!--Target NoAPI-->
                      <span class="sheet-iconselect-span sheet-HideIfNoRoll sheet-HideIfChecked sheet-NoAPI" title="@{repeating_talents_X_T_Target-NoAPI}  What does this talent target.">
                        <span class="sheet-iconselect-icon-noedit">
                          <input checked class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value=" " ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-action-na" title="This Talent does not target a defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" ><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-PD" title="This Talent targets Physical Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="This Talent targets Mystic Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-SD" title="This Talent targets Social Defense."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" name="attr_T_Target-NoAPI" type="checkbox" value="{{target_number=?{Target Number|0}}}"><span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                        </span>
                        <select class="sheet-iconselect-select-noedit" name="attr_T_Target-NoAPI">
                          <option selected value=" " title="This Talent does not target a defense.">None</option>
                          <option disabled value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}" title="This Talent targets Physical Defense.">PD</option>
                          <option value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}" title="This Talent targets Mystic Defense.">MD</option>
                          <option disabled value="{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}" title="This Talent targets Social Defense.">SD</option>
                          <option value="{{target_number=?{Target Number|0}}}" title="Ask for target number when roll is made.">Ask</option>
                        </select>
                      </span>
                    </span>

                          <!-- Spells - Talent Fieldset - Strain -->
                    <span class="sheet-fixed-width sheet-w25px sheet-titlespan" title="@{repeating_talents_X_T_Strain}: number of strain points per use">
                      <input name="attr_T_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                      <input name="attr_T_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked " readonly="readonly" >
                    </span>

                          <!-- Spells - Talent Fieldset -Karma & DP -->
                    <span class="">
                            <!--JBF Karma Toggle-Simple-->
                      <span class="sheet-Karma-ControlBox">
                        <input type="hidden" name="attr_T_Karma-Ask" value="{ Karma mode is ASK. Choose number of Karma between 0 and 1 |0}"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_T_Karma-Limit_max" value="0" hidden class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                          <span class="sheet-HideIfNotCloseChecked">
                            <label class="sheet-labelcheckbox" hidden title="@{T_Karma}   Automatically Spends One Karma when Karma is On" >
                              <input type="checkbox" name="attr_T_Karma" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                            </label>
                          </span>
                          <input type="checkbox" name="attr_T_Karma-Limit_max" hidden value="1" checked class="sheet-testCloseChecked">
                          <span class="sheet-HideIfCloseChecked">
                            <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_lessthan3" title="@{T_Karma} : Number of Karma Points to be spent when Karma is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="0" > <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma} Don't Spend any Karma when Karma is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="1" checked> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{T_Karma}   Automatically Spends One Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                                <input class="sheet-testNum" type="hidden" name="attr_T_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfZero sheet-HideIfOne sheet-HideIfTwo sheet-HideIfThree sheet-icon-karma-on" title="@{T_Karma}   Automatically Spends More than Three Karma when Karma is On"></span>
                              </span>
                              <input type="hidden" name="attr_T_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                              <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3 ">
                                <option value="0"  title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3 ">
                                <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{T_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                                <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>
                              <select name="attr_T_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                                <option value="0"  title="@{T_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" selected title="@{T_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{T_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>

                            </span>
                            <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-Kar_morethan3">
                              <input type="hidden" name="attr_T_Karma-Limit_max" value="1" class="sheet-testKarMax">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_4" min="0" max="4" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_5" min="0" max="5" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_6" min="0" max="6" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_7" min="0" max="7" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_8" min="0" max="8" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_9" min="0" max="9" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_10" min="0" max="10" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_11" min="0" max="11" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_12" min="0" max="12" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_13" min="0" max="13" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_14" min="0" max="14" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                              <input type="number" name="attr_T_Karma" class="sheet-numShort sheet-w30px sheet-Kar_15" min="0" max="15" value="1" title="@{T_Karma} Number Karmas to be spent on the rolls in Auto mode.">
                            </span>
                          </span>
                        </span>
                      </span>
                            <!--JBF End Of Karma Toggle-Simple-->
                            <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                      <span class="sheet-DP-ControlBox">
                        <input type="hidden" name="attr_T_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_T_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_T_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                          <span class="sheet-HideIfNotChecked">
                            <input type="checkbox" name="attr_T_DP-Limit" hidden value="1" class="sheet-testCloseChecked">
                            <label class="sheet-labelcheckbox sheet-HideIfCloseChecked" hidden title="@{T_DP}   Automatically Spends One Devotion when Devotion is On" >
                              <input type="checkbox" name="attr_T_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                            </label>
                            <span class="sheet-iconstatic sheet-icon-devotion sheet-HideIfNotCloseChecked" title="@{T_DP}   This Devotion requires one DP at each use."></span>
                          </span>
                          <span class="sheet-HideIfChecked">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{T_DP} : Number of Devotion Points to be spent when Devotion is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP} Don't Spend any Dp when Dp is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{T_DP}   Automatically Spends One Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_T_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On"></span>
                              </span>
                              <input type="hidden" name="attr_T_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                              <input type="hidden" name="attr_T_DP-Limit_max" class="sheet-testKarMax">
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                                <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{T_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>
                              <select name="attr_T_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                                <option value="0" selected title="@{T_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{T_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{T_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>
                            </span>
                          </span>
                        </span>
                      </span>   <!--  JBF End Of DP Toggle  -->
                    </span>   <!--  Spells - Talent Fieldset -Karma & DP  -->
                          <!--Dummy fieldset to be hidden in edit mode to avoid overlapping the trash can-->
                    <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode"></span>
                  </div>    <!-- end Talent Fieldset -->
                </div>    <!-- end filterbox -->
              </fieldset>
            </div>    <!-- end Section Spells - Talents - Fieldset -->
          </div>    <!-- end Spells - Talents -->

                <!-- Spells - Spell Sequence -->
          <input type="checkbox" class="sheet-testCloseChecked sheet-hidden" name="attr_SS-Active" checked value="0">
                <!-- Spells - Spell Sequence - Header -->
          <div class="sheet-HideIfCloseChecked sheet-api">
            <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheer-HideIfCombat">
              <div></div>
              Active Spell Sequence
              <div>
                <span class="sheet-info" title="This sub-section gathers information of spells currently cast">i</span>
              </div>
            </div>
                  <!-- Spells - Spell Sequence - Content -->
            <div class="sheet-content">
                    <!-- Spells - Spell Sequence - Titles -->
              <div>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan">Type</b>
                <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"> <span class="sheet-iconstatic sheet-icon-weave"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">Spell Name</b>
                <b class="sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan">Sequence</b>
                <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Range</b>
                <b class="sheet-heading sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan">Duration</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Description</b>
              </div>
                    <!-- Spells - Spell Sequence - Content -->
              <div class="sheet-content">
                      <!-- Spells - Spell Sequence - Type -->
                <span class="sheet-fixed-width sheet-w50px sheet-text-center">
                  <input name="attr_SS-Type" type=checkbox value="M" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Matrix casting.">Mat.</b>
                  <input name="attr_SS-Type" type=checkbox value="G" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Could be Grimoire or Raw. Attune Grimoire to avoid Raw casting.">G/R</b>
                  <input name="attr_SS-Type" type=checkbox value="GA" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Casting from Attuned Grimoire. An additional success will be added.">Grim.</b>
                  <input name="attr_SS-Type" type=checkbox value="GR" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-Type}   Type of Casting - Casting Raw Magic.">Raw</b>
                </span>
                      <!--Spells - Spell Sequence - Remaining Threads-->
                <span class="sheet-fixed-width sheet-w30px sheet-hidden">
                  <input type="text" readonly value="/" class="sheet-numShorter" name="attr_SS-CurThreads" title="@{SS-CurThreads} : Number of threads woven vs to be Woven.">
                </span>
                      <!--Spells - Spell Sequence - Name and Master Button-->
                <span class="sheet-nowrap0">
                  <button class="sheet-text-button sheet-api" name="roll_SS-Roll" type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell:  @{SS-Active} : Sequence : @{SS-Type}"
                  title="{selected|SS-Roll} : This is the master button for the spell sequence. Click to select the next step in the spell sequence">
                  <input type="text" readonly value="" class="sheet-txtMed sheet-buttonlabel" name="attr_SS-Name"></button>
                </span>
                      <!--Spells - Spell Sequence - Effect-->
                <span class="sheet-nowrap0 sheet-titlespan sheet-fixed-width sheet-selShort" title="@{SS-WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                  <input class="sheet-testChecked sheet-hidden" name="attr_SS-WilSelect" value="None" type="checkbox">
                  <span class="sheet-HideIfChecked">
                    <input name="attr_SS-WilSelect" type="text" readonly value="Wil" class="sheet-numShorter" title="@{SS-WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                    <span class="sheet-middle">+</span>
                    <span class="sheet-nowrap0" title="@{SS-WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                      <input name="attr_SS-WilEffect" type="number" readonly value="0" class="sheet-numShorter">
                    </span>
                  </span>
                </span>
                      <!-- Spells - Spell Sequence - Current Step-->
                <span class="sheet-fixed-width sheet-selShort sheet-text-center">
                  <input name="attr_SS-SeqStep" type="checkbox" value="0" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Starting Sequence: Chosing Extra Threads.">Starting</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="1" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Started Weaving the threads necessary.">Weaving</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="2" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - All the threads have been woven.">Woven</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="3" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Spellcasting attempted but failed.">Cast. Fail.</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="4" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Spellcasting Successful.">Cast</b>
                  <input name="attr_SS-SeqStep" type="checkbox" value="5" class="sheet-hidden sheet-testCloseChecked"><b class="sheet-HideIfNotCloseChecked" title="@{SS-SeqStep} : Current Step of the Casting Sequence - Sequence is finished, Effect, if any, has been rolled.">Finished</b>
                </span>
                      <!--Spells - Spell Sequence - Range-->
                <span class="sheet-titlespan sheet-fixed-width sheet-numShort" title="@{SS-Range}:   Range spell can be cast, Usually in Yards though it may be Touch or Self. Select a predefined Range, or type your own">
                  <input name="attr_SS-Range" readonly type="text" class="sheet-numShort sheet-bordered-bottom">
                </span>
                      <!--Spells - Spell Sequence - Duration Effect and Description-->
                <span class="sheet-titlespan sheet-fixed-width sheet-selShort" title="@{SS-Duration}:   Duration of Spell.">
                  <input type="text" name="attr_SS-Duration" value="" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom" readonly>
                </span>
                <span class="sheet-txtMedplus sheet-titlespan sheet-fixed-width" title="@{SS-Effect}:   Effect of Spell.">
                  <input type="text" name="attr_SS-Effect" readonly value="" class="sheet-txtMedplus sheet-text-left sheet-bordered-bottom" >
                </span>
                <label class="sheet-api" title="@{SS-ShowNotes}   Show description of Spell currently cast">
                  <input type="checkbox" name="attr_SS-ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                </label>
                      <!--Spells - Spell Sequence - Extra Threads-->
                <input name="attr_SS-EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                <div class="sheet-HideIfCloseChecked">
                  <b class="sheet-label"> Extra Threads :</b>
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_SS-EnhThread" type="text" readonly class="sheet-bordered-bottom" title="@{SS-EnhThread} : Description of the effects any extra thread selected for this spell.">
                    <span name="attr_SS-EnhThread" class="sheet-autoexpand" ></span>
                  </span>
                </div>
                      <!--Spells - Spell Sequence - Spell Details-->
                <input class="sheet-testCloseChecked sheet-hidden" name="attr_SS-ShowNotes" value="1" type="checkbox">
                <div class="sheet-HideIfNotCloseChecked">
                  <!--Spells Fieldset - Attuning Difficutlies-->
                  <!-- <span class="sheet-nowrap">
                    <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfEdition3" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                      <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom">
                      <span name="attr_SS-Numbers" class="sheet-autoexpand"></span>
                      <span>Wv/Ratn/Dspl/Sns</span>
                    </label>
                    <label class="sheet-label-under sheet-autoexpand-wrap sheet-HideIfNotEdition3" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                      <input name="attr_SS-Numbers" type="text" class="sheet-bordered-bottom">
                      <span name="attr_SS-Numbers" class="sheet-autoexpand"></span>
                      <span>Wv/Ratn/Dspl/Dblf/Sns</span>
                    </label>
                  </span> -->
                  <span class="sheet-nowrap sheet-HideIfEdition3 sheet-label" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                    Difficulties - Weave/Reattune/Dispell/Sense:
                      <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom sheet-txtShort">
                  </span>
                  <span class="sheet-nowrap sheet-HideIfNotEdition3 sheet-label" title="@{SS-Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                      Difficulties - Weave/Reattune/Dispell/Disbelieve/Sense
                        <input name="attr_SS-Numbers" type="text" readonly class="sheet-bordered-bottom sheet-txtShort">
                  </span>
                  <textarea name="attr_SS-Notes" readonly class="sheet-details" title="@{SS-Notes}   Description of spell currently cast and how it works." placeholder="Description of the spell currently cast and how it works."></textarea>
                </div>
              </div>
            </div>    <!-- Spells - Spell Sequence - Content -->
          </div>    <!-- end Spells - Spell Sequence - Header -->


                <!--Section-Spells - Tab Selector-->
          <div class="sheet-HideIfOverview sheet-HideIfCombat">
            <!-- <input type="radio" name="attr_tab-spells" class="sheet-tabSpell sheet-hidden" value="1" title="Spellcasting Talents."  ><span>Talents</span> -->
            <input type="checkbox"         name="attr_tab-spells" class="sheet-tabSpell" value="2" title="Spell Matrices and what is In them."><button type="action" value="2" name="act_tab-spells">Matrix</button>
            <input type="checkbox" checked name="attr_tab-spells" class="sheet-tabSpell" value="3" title="Grimoire.">                          <button type="action" value="3" name="act_tab-spells">Grimoire</button>
          </div>
          <input type="hidden" name="attr_tab-spells" class="sheet-tabSpell" value="3">
          <!-- <div class="sheet-sec-border-line"></div> -->
          <div class="sheet-section-spells-talents sheet-content"></div> <!--End of Spells Talents--><!--UNUSED-->


                <!--Section Spells- Matrix Subsection-->
          <div class="sheet-section-spells-matrices sheet-repeat-counter-reset">
            <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheer-HideIfCombat">
              <div></div>
              Spell Matrices
              <div>
                <label title="@{attr_spellmatrix-edit-mode} : Toggles the matrix view to edit mode where the main attributes of each talents can be changed.">
                  <input type="checkbox" name="attr_spellmatrix-edit-mode" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                </label>
                <span class="sheet-info" title="Instructions: This tab is for recording only Matrixes. Spellcasting Talents are in another Spell Tab; and all other Talents are in the main Talents tab. Record here each of your Matrix with its Rank and Origin">i</span>
              </div>
            </div>

                  <!-- Section Spells- Matrix Subsection -Content -->
            <div class="sheet-content">
              <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">
              <input type="checkbox" name="attr_spellmatrix-edit-mode" value="1" hidden class="sheet-testRepEditMode">

                    <!--Section Spells- Matrix Subsection - Titles-->
              <div class="sheet-HideIfNotEditMode">
                <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-nowrap sheet-titlespan">Matrix</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-titlespan">Origin</b>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan"> Rank </b>
                <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-titlespan">D.Rat.</b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-titlespan">Spell Name</b>
              </div>
              <div class="sheet-HideIfEditMode">
                <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-titlespan">Mat.</b>
                <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-weave"></span></b>
                <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-titlespan">Spell Name</b>
              </div>
                    <!--Section Spells- Matrix Subsection - Spell Matrix Fieldset-->
              <fieldset class="repeating_matrix" >
                <input name="attr_SPM_CombatSlot" type="checkbox" value="1" class="sheet-hidden sheet-combattab" checked>

                <div class="sheet-bordered sheet-matrix sheet-filter-box" >
                  <span class="sheet-hidden">
                    <input name="attr_SPM_RowID" type="text" >
                    <input name="attr_SPM_spRowID" type="text" >      <!-- This is the Grimoire row ID -->
                    <input name="attr_SPM_EnhThread" type="text" >    <!-- This is the description of any extra thread woven during attuning -->
                  </span>
                        <!-- Matrix Fieldset - Type-->
                  <input name="attr_SPM_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                  <span class="sheet-repeat-count sheet-HideIfEditMode sheet-fixed-width sheet-w75px sheet-text-center">
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" checked value="-10" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix sheet-HideIfNotCloseChecked" title="Standard Matrix:  Death Rating 10, Can not hold threads."></span>
                    <input type="checkbox"  name="attr_SPM_Type" class="sheet-testCloseChecked" value="15" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-enhanced sheet-HideIfNotCloseChecked" title="Enhanced Matrix:  Death Rating 15, Can hold one thread."></span>
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" value="25" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-armored sheet-HideIfNotCloseChecked" title="Armored Matrix:   Death Rating 25, Can hold one thread."></span>
                    <input type="checkbox" name="attr_SPM_Type" class="sheet-testCloseChecked" value="-20" hidden>
                    <span class="sheet-iconstatic sheet-icon-matrix-shared sheet-HideIfNotCloseChecked" title="Shared Matrix:    Death Rating 20, Can not hold threads, May hold several spells as long as their combined circles do not exceed the rating."></span>
                    <input name="attr_SPM_Origin" class="sheet-hidden sheet-testCloseChecked" type="checkbox" value="Pseudo">
                    <b class="sheet-HideIfNotCloseChecked sheet-small" title="This is not an actual separate matrix within the game, It merely represents a spell sharing a matrix with other spells, ether because it is a shared matrix, or the spells are designed such that different spells can share the same matrix. Obviously, these 'pseudo' matrices can only be used if the correct other spells are located within the correct real matrices.">(p)</b>
                  </span>

                  <span class="sheet-nowrap sheet-repeat-count sheet-HideIfNotEditMode sheet-fixed-width sheet-txtMed">
                    <select name="attr_SPM_Type" class="sheet-nowrap sheet-txtShort" title="@{repeating_matrix_X_SPM_Type}   Type of Spell Matrix">
                      <option value="-10" selected title="Standard Matrix:  Death Rating 10, Can not hold threads.">Standard</option>
                      <option value="15" title="Enhanced Matrix:  Death Rating 15, Can hold one thread.">Enhanced</option>
                      <option value="25" title="Armored Matrix:   Death Rating 25, Can hold one thread.">Armored</option>
                      <option value="-20" title="Shared Matrix:    Death Rating 20, Can not hold threads, May hold several spells as long as their combined circles do not exceed the rating.">Shared</option>
                    </select>
                  </span>

                        <!-- Matrix Fieldset -Origin-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-txtShort">
                    <select name="attr_SPM_Origin" class="sheet-txtShort" title="@{repeating_matrix_X_SPM_Origin}   Origin of Matrix">
                      <option value="Free-link"  title="Free:  This is a free matrix granted by the spellcasters first spellcasting discipline.">Free</option>
                      <option disabled  >-- Discipline 1 --</option>
                      <option value="TO1-Novice"  selected  title="Talent Option - Novice:  This is Talent Option Matrix.">TO-Novice</option>
                      <option value="TO1-Journeyman" title="Talent Option - Journeyman:  This is Talent Option Matrix.">TO-Journeyman</option>
                      <option value="TO1-Warden"     title="Talent Option - Warden:  This is Talent Option Matrix.">TO-Warden</option>
                      <option value="TO1-Master"     title="Talent Option - Master:  This is Talent Option Matrix.">TO-Master</option>
                      <option disabled class="sheet-HideIfNotHuman">-- Versatility --</option>
                      <option value="V-Novice"     class="sheet-HideIfNotHuman" title="This is a Novice Versatility Talent for this character.">Versatility Novice</option>
                      <option value="V-Journeyman" class="sheet-HideIfNotHuman" title="This is a Journeyman Versatility Talent for this character.">Versatility Journeyman</option>
                      <option value="V-Warden"     class="sheet-HideIfNotHuman" title="This is a Warden Versatility Talent for this character.">Versatility Warden</option>
                      <option value="V-Master"     class="sheet-HideIfNotHuman" title="This is a Master Versatility Talent for this character.">Versatility Master</option>
                      <option disabled >-- Others --</option>
                      <option value="Other"          title="Other:.">Other</option>
                      <option value="Pseudo"         title="Pseudo Matrix: This is not an actual separate matrix within the game, It merely represents a spell sharing a matrix with other spells, ether because it is a shared matrix, or the spells are designed such that different spells can share the same matrix. Obviously, these 'pseudo' matrices can only be used if the correct other spells are located within the correct real matrices.">Pseudo</option>
                      <option value="Item-link"           title="Item:   This is from a matrix item.">Item</option>
                      <option disabled  >-- Spell Matrix Objects --</option>
                      <option value="SMO-Novice"     title="Spell Matrix Object - Novice:  This is Spell Matrix Object.">SMO-Novice</option>
                      <option value="SMO-Journeyman" title="Spell Matrix Object - Journeyman:  This is Spell Matrix Object.">SMO-Journeyman</option>
                      <option value="SMO-Warden"     title="Spell Matrix Object - Warden:  This is Spell Matrix Object.">SMO-Warden</option>
                      <option value="SMO-Master"     title="Spell Matrix Object - Master:  This is Spell Matrix Object.">SMO-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc">-- Discipline 2 --</option>
                      <option value="TO2-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Novice Talent Option for this characters 2nd Discipline." >TO2-Novice</option>
                      <option value="TO2-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Journeyman Talent Option for this characters 2nd Discipline." >TO2-Journeyman</option>
                      <option value="TO2-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Warden Talent Option for this characters 2nd Discipline." >TO2-Warden</option>
                      <option value="TO2-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc"  title="This is a Master Talent Option for this characters 2nd Discipline." >TO2-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">-- Discipline 3 --</option>
                      <option value="TO3-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"  title="This is a Novice Talent Option for this characters 3rd Discipline." >TO3-Novice</option>
                      <option value="TO3-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Journeyman Talent Option for this characters 3rd Discipline." >TO3-Journeyman</option>
                      <option value="TO3-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Warden Talent Option for this characters 3rd Discipline." >TO3-Warden</option>
                      <option value="TO3-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc"   title="This is a Master Talent Option for this characters 3rd Discipline." >TO3-Master</option>
                      <option disabled class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">-- Discipline 4 --</option>
                      <option value="TO4-Novice"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Novice Talent Option for this characters 4th Discipline." >TO4-Novice</option>
                      <option value="TO4-Journeyman" class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Journeyman Talent Option for this characters 4th Discipline." >TO4-Journeyman</option>
                      <option value="TO4-Warden"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Warden Talent Option for this characters 4th Discipline." >TO4-Warden</option>
                      <option value="TO4-Master"     class="sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc"   title="This is a Master Talent Option for this characters 4th Discipline." >TO4-Master</option>
                    </select>
                  </span>

                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-w50px sheet-text-center sheet-api">
                    <input name="attr_SPM_Origin" type="hidden" class="sheet-testFreeOrThread" value="TO1-Novice" >
                    <span class="sheet-HideIfFreeOrThread">
                      <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                    </span>
                    <span class="sheet-HideIfNotFreeOrThread">
                      <input name="attr_SPM_LinksGetValue" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="" checked >
                      <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-HideIfCloseChecked sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" readonly title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                      <!-- <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" name="roll_SPM_btnSetLink" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SPM : @{SPM_RowID}"
                      title="@{repeating_matrix_X_SPM_btnSetLink} Set the Links for this Matrix. Links allow to automatically add a Discipline Circle (i.e. for Free Matrixes) or an Item Rank"><span class="sheet-iconstatic sheet-icon-link"></span></button> -->
                      <button class="sheet-text-button sheet-button-nodice sheet-HideIfNotCloseChecked" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Linkadd1: SPM : @{SPM_RowID} : ?{What are we linking this to|Discipline,DSP|Talent,T|Skill,SK|Weapon,WPN|Thread Item,TI|Attribute} : ?{Name to link to (Make sure substring is an exact match, including case. Example - Melee)} "
                      title="@{repeating_talents_X_SPM_btnAddLink} Set the Links for this Knack. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Talent"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                    </span>
                  </span>
                                          <!-- Matrix Fieldset -Rank-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-w75px sheet-text-center sheet-NoAPI">
                    <input name="attr_SPM_Rank" type="number" value="0" min="0" class="sheet-nowrap sheet-numShorter sheet-Big sheet-HideIfNotEditMode" title="@{repeating_matrix_X_SPM_Rank}:   Matrix Rank." >
                  </span>

                        <!-- Matrix Fieldset -DR-->
                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-text-center sheet-w50px">
                    <input name="attr_SPM_DR" type="number" value="10" class="sheet-w50px sheet-text-center" readonly
                    title="@{repeating_matrix_X_SPM_DR}:  Death Rating of this Matrix." >
                  </span>

                  <span class="sheet-nowrap0 sheet-HideIfNotEditMode sheet-fixed-width sheet-text-center sheet-textMed">
                  <input type="text" readonly name="attr_SPM_Contains" class="sheet-txtMed " title="@{repeating_matrix_X_SPM_Contains}:   Name of the Spell currently in this Matrix.">
                </span>


                        <!-- Matrix Fieldset -Threads-->
                  <span class="sheet-fixed-width sheet-w30px sheet-HideIfEditMode">
                    <input type="number" value="0" class="sheet-numShorter sheet-NoAPI" name="attr_SPM_Threads" title="@{repeating_matrix_X_SPM_Threads}:  Threads to be woven to cast the spell in the Matrix, taking into account the base Threads of the spell and the threads held in the Matrix itself.">
                    <input name="attr_SPM_EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                    <input type="text" readonly value="+" class="sheet-numShorter sheet-api sheet-HideIfCloseChecked" title="This is an Enhanced Matrix holding a 0 Thread spell. There is an Extra Thread held by the matrix. Click on the notes icon to get details">
                    <input type="number" readonly value="0" class="sheet-numShorter sheet-api sheet-HideIfNotCloseChecked" name="attr_SPM_Threads" title="@{repeating_matrix_X_SPM_Threads}:  Threads to be woven to cast the spell in the Matrix, taking into account the base Threads of the spell and the threads held in the Matrix itself.">
                  </span>
                        <!-- Matrix Fieldset -Master Button-->
                  <button class="sheet-text-button sheet-label-under sheet-api sheet-HideIfEditMode" name="roll_SPM_Roll" type="roll"
                  value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell: @{SPM_RowID}: Sequence : M"
                  title="%{selected|SPM_Roll} Start a new Spell, or Roll to Weave Threads, Spellcasting, or an Effect test for this spell.">
                        <!-- Matrix Fieldset -Contains-->
                  <input type="text" name="attr_SPM_Contains" class="sheet-txtMed sheet-buttonlabel" title="@{repeating_matrix_X_SPM_Contains}:   Name of the Spell currently in this Matrix."></button>
                  <input type="text" name="attr_SPM_Contains" class="sheet-txtMed sheet-NoAPI sheet-HideIfEditMode" title="@{repeating_matrix_X_SPM_Contains}:   Name of the Spell currently in this Matrix.">

                        <!-- Matrix Fieldset - Details, Links and CombatSlot Icon-->
                  <label class="sheet-api sheet-HideIfEditMode sheet-HideIfPrint" title="@{repeating_matrix_X_SPM_ShowNotes}   Show description of Spell contained in Matrix">
                    <input type="checkbox" name="attr_SPM_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>

                  <label class="sheet-HideIfNotEditMode sheet-NoAPI" title="@{repeating_matrix_X_SPM_CombatSlot}  Should this Matrix be summarized on the combat tab?"> <!--Note that this is NoAPI only because with API the SP_CombatSlot will be copied in SP_CombatSlot during Attuning-->
                    <input type="checkbox" name="attr_SPM_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                  </label>

                  <span class="sheet-fixed-width sheet-w25px sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                    <input name="attr_SPM_Origin" type="hidden" class="sheet-testFreeOrThread" value="TO1-Novice" >
                    <label class="sheet-HideIfNotEditMode  sheet-HideIfNotFreeOrThread" title="@{repeating_matrix_X_SPM_Parameters}   Show detailed parameters">
                      <input type="checkbox" name="attr_SPM_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-w25px sheet-HideIfNotEditMode sheet-HideIfPrint">
                    <input name="attr_SPM_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                  </span>
                        <!-- Matrix Fieldset - Parameters-->
                  <input name="attr_SPM_Origin" type="hidden" class="sheet-testFreeOrThread" value="TO1-Novice" >
                  <div class="sheet-HideIfNotFreeOrThread">
                  <input class="sheet-testCloseChecked sheet-hidden" name="attr_SPM_Parameters"  type="checkbox" value="1">
                  <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                          <!-- Matrix Fieldset -Link Button-->
                    Link :<button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_SPM_btnSetLink" type="roll"
                    value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: SPM : @{SPM_RowID}"
                    title="@{repeating_matrix_X_SPM_btnSetLink} Set the Links for this Matrix. Links allow to automatically add a Discipline Circle (i.e. for Free Matrixes) or an Item Rank"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                    <span title="@{repeating_matrix_X_SPM_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties"></span>
                      <span class="sheet-autoexpand-wrap">
                        <input name="attr_SPM_LinksGetValue" type="text" class="sheet-bordered">
                        <span name="attr_SPM_LinksGetValue" class="sheet-autoexpand"></span>
                      </span>
                  </div>
                </div>
                        <!-- Matrix Fieldset -EnhThread and Notes-->
                  <input class="sheet-testCloseChecked sheet-hidden" name="attr_SPM_ShowNotes" value="1" type="checkbox">
                  <div class="sheet-HideIfNotCloseChecked sheet-HideIfEditMode">
                    <input name="attr_SPM_EnhThread" type="checkbox" value="x" checked class='sheet-hidden sheet-testCloseChecked' >
                    <input name="attr_SPM_EnhThread" type="text" readonly class="sheet-HideIfCloseChecked sheet-txtLong">
                  </div>
                  <!-- <div class="sheet-HideIfNotCloseChecked"> -->
                  <div class="sheet-hidden">
                    <!--Temporary disabled, because now the notes are displayed out of the fieldset. A SheetWorker routine copies the Notes to an external field-->
                    <textarea name="attr_SPM_Notes" readonly class="sheet-details" title="@{repeating_matrix_X_SPM_Notes}   Description of spell currently in the Matrix and how it works." placeholder="Description of the spell currently in the Matrix and how it works."></textarea>
                  </div>
                  <!--Dummy fieldset to be hidden in edit mode to avoid overlapping the trash can-->
                  <!-- <span class="sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode"></span> -->
                </div>    <!-- end filterbox -->
              </fieldset>
                    <!-- Matrix Fieldset - Notes-->
              <input class="sheet-testCloseChecked sheet-hidden" name="attr_Matrix-ShowNotes" value="1" type="checkbox">
              <div class="sheet-HideIfNotCloseChecked">
                <textarea name="attr_Matrix-Notes" readonly class="sheet-details" title="@{repeating_Matrix-Notes}   Description of spell currently in the Matrix and how it works." placeholder="Description of the spell currently in the Matrix and how it works."></textarea>
              </div>
            </div>    <!-- end Section Spells- Matrix Subsection -Content -->
          </div>    <!-- ********************************** End Spell Matrix section ****************************-->



                  <!-- Section Spells - Grimoire Subsection -->
          <div class="sheet-section-spells-grimoire sheet-content">
                  <!--Section Spells - Grimoire Subsection- Header & Selector-->
            <div class="sheet-repeat-counter-reset">
              <div></div>
              <div class="sheet-headerbar sheet-headerbar-flex">
                <div></div> Grimoire
                <div class="sheet-floatRight">
                  <input type="checkbox" name="attr_SP-Elementalist" value="1"  class="sheet-hidden sheet-testCloseChecked">
                  <button type="compendium" style="color:black;" class="sheet-HideIfNotCloseChecked" value="Rules:SPELL%20MAGIC#Elementalist%20Spells" title="Compendium Info Button - Click to open compendium entry">El</button>

                  <input type="checkbox" name="attr_SP-Illusionist" value="1"  class="sheet-hidden sheet-testCloseChecked">
                  <button type="compendium" style="color:black;" class="sheet-HideIfNotCloseChecked" value="Rules:SPELL%20MAGIC#Illusionist%20Spells" title="Compendium Info Button - Click to open compendium entry">Il</button>

                  <input type="checkbox" name="attr_SP-Nethermancer" value="1"  class="sheet-hidden sheet-testCloseChecked">
                  <button type="compendium" style="color:black;" class="sheet-HideIfNotCloseChecked" value="Rules:SPELL%20MAGIC#Nethermancer%20Spells" title="Compendium Info Button - Click to open compendium entry">Ne</button>

                  <input type="checkbox" name="attr_SP-Shaman" value="1"  class="sheet-hidden sheet-testCloseChecked">
                  <button type="compendium" style="color:black;" class="sheet-HideIfNotCloseChecked" value="Rules:SHAMAN%20SPELLS" title="Compendium Info Button - Click to open compendium entry">Sh</button>

                  <input type="checkbox" name="attr_SP-Wizard" value="1"  class="sheet-hidden sheet-testCloseChecked">
                  <button type="compendium" style="color:black;" class="sheet-HideIfNotCloseChecked" value="Rules:SPELL%20MAGIC#Wizard%20Spells" title="Compendium Info Button - Click to open compendium entry">Wz</button>


                  <label title="@{attr_spells-edit-mode} : Toggles the grimoire view to edit mode where the main attributes  can be changed.">
                    <input type="checkbox" name="attr_spells-edit-mode" checked value="1" class="sheet-iconcheckbox">&nbsp;&nbsp;&nbsp;&nbsp; <span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                  </label>
                </div>
              </div>

              <div class="sheet-Creation sheet-HideIfPC">
                <span> For quick NPC creation create all spells from Discipline</span>
                <select name="attr_addspells_Disc" class="sheet-selShort">
                  <option value="None">None</option>
                  <option value="El">Elementalist</option>
                  <option value="Il">Illusionist</option>
                  <option value="Ne">Nethermancer</option>
                  <option value="Wz">Wizard</option>
                </select>
                <span> up to Circle</span>
                <input name="attr_addspells_Circle" value="1" type="number" value="1" min="1" max="8" class="numShort">

                <button class="sheet-button-nodice sheet-text-button" name="act_addspells" type="action"
                title="act_addspells:   Clicking this button will add all spells up to a certain circle .">
                Add Spells
                </button>
              </div>

              <div class="sheet-sec-spacer"></div>
              <div class="sheet-NotCreation sheet-HideIfPrint">
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="0" title="All circles" checked ><button type="action" value="0" name="act_tab-grim">All</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="11" title="In Matrix" ><button type="action" value="11" name="act_tab-grim">In Matrix</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="1" title="Circle 1"><button type="action" value="1" name="act_tab-grim" class="sheet-tabshort">Cir. 1</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="2" title="Circle 2"><button type="action" value="2" name="act_tab-grim" class="sheet-tabshort">Cir. 2</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="3" title="Circle 3"><button type="action" value="3" name="act_tab-grim" class="sheet-tabshort">Cir. 3</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="4" title="Circle 4"><button type="action" value="4" name="act_tab-grim" class="sheet-tabshort">Cir. 4</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="5" title="Circle 5"><button type="action" value="5" name="act_tab-grim" class="sheet-tabshort">Cir. 5</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="6" title="Circle 6"><button type="action" value="6" name="act_tab-grim" class="sheet-tabshort">Cir. 6</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="7" title="Circle 7"><button type="action" value="7" name="act_tab-grim" class="sheet-tabshort">Cir. 7</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="8" title="Circle 8"><button type="action" value="8" name="act_tab-grim" class="sheet-tabshort">Cir. 8</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="9" title="Warden Tier Spells"><button type="action" value="9" name="act_tab-grim">Warden</button>
                <input type="checkbox" name="attr_tab-grim" class="sheet-tabGrim" value="10" title="Master Tier Spells"><button type="action" value="10" name="act_tab-grim">Master</button>
              </div>
              <input type="hidden" name="attr_tab-grim" class="sheet-tabGrim" value="0">
              <!-- <div class="sheet-sec-border-line"></div> -->

                    <!-- Section Spells - Grimoire Subsection-Titles -->
              <input type="checkbox" hidden checked value="1" name="attr_spells-edit-mode" class="sheet-testRepEditMode" >
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode sheet-HideIfPrint">Matrix</b>
              <!-- <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">Grim</b> -->
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Circle</b>
              <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Disc.</b>
              <b class="sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan"><span class="sheet-iconstatic sheet-icon-weave"></span></b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Name</b>
              <b class="sheet-fixed-width sheet-txtShort sheet-text-center sheet-titlespan sheet-HideIfNotEditMode"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
              <b class="sheet-fixed-width sheet-selShort sheet-text-center sheet-titlespan sheet-HideIfEditMode"><span class="sheet-iconstatic sheet-icon-effect"></span></b>
              <b class="sheet-heading sheet-fixed-width sheet-w50px sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode">Target</b>
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Range</b>
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-NoAPI">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfNotEditMode">Duration</b>
              <b class="sheet-heading sheet-fixed-width sheet-w25px sheet-text-center sheet-titlespan">Stn</b>
              <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">Description</b>

              <datalist id="spell_range">
                <option value="S">Self</option>
                <option value="T">Touch</option>
                <option value="10y">10y</option>
                <option value="20y">20y</option>
                <option value="30y">30y</option>
                <option value="40y">40y</option>
                <option value="50y">50y</option>
                <option value="100y">100y</option>
                <option value="1 mi">1 mile</option>
                <option value="2 mi">2 mile</option>
                <option value="3 mi">3 mile</option>
                <option value="4 mi">4 mile</option>
              </datalist>


              <datalist id="spell_name">

                <!-- Compendium PG Elementalist-->
                <option disabled  >-- Elementalist --</option>
                <option value="Air Armor"></option>
                <option value="Crunch Climb"></option>
                <option value="Earth Darts"></option>
                <option value="Flameweapon"></option>
                <option value="Heat Food"></option>
                <option value="Purify Earth"></option>
                <option value="Purify Water"></option>
                <option value="Resist Element"></option>
                <option value="Shelter"></option>
                <option value="Snuff"></option>
                <option value="Waterproof"></option>
                <option value="Air Mattress"></option>
                <option value="Fingers of Wind"></option>
                <option value="Icy Surface"></option>
                <option value="Mantle of the Woodland Hunter"></option>
                <option value="Shield Willow"></option>
                <option value="Slow Weapon"></option>
                <option value="Ice Mace and Chain"></option>
                <option value="Lightning Bolt"></option>
                <option value="Mantle of the Reflecting Pool"></option>
                <option value="Plant Feast"></option>
                <option value="Thrive"></option>
                <option value="Winds of Deflection"></option>
                <option value="Air Blast"></option>
                <option value="Blizzard Sphere"></option>
                <option value="Elemental Spear"></option>
                <option value="Grove Renewal"></option>
                <option value="Lightning Step"></option>
                <option value="Uneven Ground"></option>
                <option value="Earth Staff"></option>
                <option value="Fireball"></option>
                <option value="Heat Armor"></option>
                <option value="Nutritious Earth"></option>
                <option value="Ride the Lightning"></option>
                <option value="Shattering Stone"></option>
                <option value="Drastic Temperature"></option>
                <option value="Fireweave"></option>
                <option value="Mantle of the Fire Marauder"></option>
                <option value="Metal Wings"></option>
                <option value="Stone Rain"></option>
                <option value="Tossing Earth"></option>
                <option value="Cloud Summon"></option>
                <option value="Death Rain"></option>
                <option value="Earth Surfing"></option>
                <option value="Mantle of the Blood Elf"></option>
                <option value="Thunderclap"></option>
                <option value="Whirlwind"></option>
                <option value="Crushing Hand of Earth"></option>
                <option value="Earth Wall"></option>
                <option value="Ironskin"></option>
                <option value="Mantle of the Lightning Vanguard"></option>
                <option value="Venomous Fury"></option>
                <option value="Vital Springs"></option>

                <!-- Compendium PG  Illusionist-->
                <option disabled  >-- Illusionist --</option>
                <option value="Assuring Touch"></option>
                <option value="Best Face"></option>
                <option value="Cloak"></option>
                <option value="Disaster"></option>
                <option value="Encrypt"></option>
                <option value="Ephemeral Bolt"></option>
                <option value="Fun With Doors"></option>
                <option value="Monstrous Mantle"></option>
                <option value="Send Message"></option>
                <option value="True Ephemeral Bolt"></option>
                <option value="Trust"></option>
                <option value="Unseen Voices"></option>
                <option value="Blindness"></option>
                <option value="Displace Image"></option>
                <option value="Innocent Activity"></option>
                <option value="Mind Fog"></option>
                <option value="Phantom Flame"></option>
                <option value="See the Unseen"></option>
                <option value="And Then I Woke Up"></option>
                <option value="Blinding Glare"></option>
                <option value="Fog of Jeer"></option>
                <option value="Nobody Here"></option>
                <option value="Phantom Warrior"></option>
                <option value="Clarion Call"></option>
                <option value="Great Weapon"></option>
                <option value="Notice Not"></option>
                <option value="Phantom Lightning"></option>
                <option value="Stop Right There"></option>
                <option value="Suffocation"></option>
                <option value="Unmask"></option>
                <option value="Bond of Silence"></option>
                <option value="Eye of Truth"></option>
                <option value="Illusion"></option>
                <option value="Phantom Fireball"></option>
                <option value="Presto!"></option>
                <option value="Switch"></option>
                <option value="Astral Shadow"></option>
                <option value="Chosen Path"></option>
                <option value="Flying Carpet"></option>
                <option value="Illusory Missiles"></option>
                <option value="Memory Scribe"></option>
                <option value="True Missiles"></option>
                <option value="True Switch"></option>
                <option value="Dancing Dragon"></option>
                <option value="Silent Stampede"></option>
                <option value="Stampede"></option>
                <option value="Twisted Tongues"></option>
                <option value="Vertigo"></option>
                <option value="Walk Through"></option>
                <option value="Face Lift"></option>
                <option value="Form Exchange"></option>
                <option value="Other Place"></option>
                <option value="Rebel Limb"></option>
                <option value="Shadow Spell"></option>
                <option value="Stench"></option>

                <!-- Compendium PG  Nethermancer-->
                <option disabled  >-- Nethermancer --</option>
                <option value="Astral Spear"></option>
                <option value="Bone Circle"></option>
                <option value="Dark Messenger"></option>
                <option value="Ethereal Darkness"></option>
                <option value="Experience Death"></option>
                <option value="Life Circle of One"></option>
                <option value="Shadow Meld"></option>
                <option value="Soul Armor"></option>
                <option value="Soulless Eyes"></option>
                <option value="Spirit Dart"></option>
                <option value="Spirit Grip"></option>
                <option value="Aspect of the Fog Ghost"></option>
                <option value="Chilling Circle"></option>
                <option value="Deaths Head"></option>
                <option value="Nights Edge"></option>
                <option value="Shadows Whisper"></option>
                <option value="Shield Mist"></option>
                <option value="Summon Fog Ghost"></option>
                <option value="Arrow of Night"></option>
                <option value="Aspect of the Bone Spirit"></option>
                <option value="Aspect of the Cowardly Skulk"></option>
                <option value="Fog of Fear"></option>
                <option value="Grave Message"></option>
                <option value="Pain"></option>
                <option value="Summon Bone Spirit"></option>
                <option value="Aspect of the Menacing Tyrant"></option>
                <option value="Dark Spy"></option>
                <option value="Evil Eye"></option>
                <option value="Last Chance"></option>
                <option value="Nightflyers Cloak"></option>
                <option value="Viewpoint"></option>
                <option value="Aspect of the Cruel Physician"></option>
                <option value="Blind"></option>
                <option value="Circle of Astral Protection"></option>
                <option value="Dust to Dust"></option>
                <option value="Reverse Withering"></option>
                <option value="Wither Limb"></option>
                <option value="Astral Maw"></option>
                <option value="Bone Shatter"></option>
                <option value="Debilitating Gloom"></option>
                <option value="Friendly Darkness"></option>
                <option value="Recovery"></option>
                <option value="Step Through Shadow"></option>
                <option value="Aspect of the Casual Murderer"></option>
                <option value="Astral Beacon"></option>
                <option value="Bone Pudding"></option>
                <option value="Constrict Heart"></option>
                <option value="Foul Vapors"></option>
                <option value="Restrain Entity"></option>
                <option value="Aspect of the Astral Savant"></option>
                <option value="Horror Call"></option>
                <option value="Netherblade"></option>
                <option value="Shadow Tether"></option>
                <option value="Spirit Portal"></option>
                <option value="Wither Away"></option>

                <!-- Compendium PG Wizard-->
                <option disabled  >-- Wizard --</option>
                <option value="Astral Sense"></option>
                <option value="Bedazzling Display of Logical Analysis"></option>
                <option value="Catseyes"></option>
                <option value="Divine Aura"></option>
                <option value="Flame Flash"></option>
                <option value="Iron Hand"></option>
                <option value="Mage Armor"></option>
                <option value="Mind Dagger"></option>
                <option value="Quicken Pace"></option>
                <option value="Speed Reading"></option>
                <option value="Wall Walker"></option>
                <option value="Astral Shield"></option>
                <option value="Baseline Subtraction"></option>
                <option value="Crushing Will"></option>
                <option value="Dodge Boost"></option>
                <option value="Rope Ladder"></option>
                <option value="Seeking Sight"></option>
                <option value="Astral Targeting"></option>
                <option value="Aura Strike"></option>
                <option value="Combat Fury"></option>
                <option value="Identify Magic"></option>
                <option value="Levitate"></option>
                <option value="Wizard Mark"></option>
                <option value="Ball of String"></option>
                <option value="Binding Threads"></option>
                <option value="Evolved Consciousness"></option>
                <option value="Jugglers Touch"></option>
                <option value="Lighten Load"></option>
                <option value="Wizards Cloak"></option>
                <option value="Flight"></option>
                <option value="Giant Size"></option>
                <option value="Mystic Shock"></option>
                <option value="Sever Talent"></option>
                <option value="Slow"></option>
                <option value="Weapon Back"></option>
                <option value="Displace Self"></option>
                <option value="Energy Shield"></option>
                <option value="Loan Spell"></option>
                <option value="Rampage"></option>
                <option value="Razor Orb"></option>
                <option value="Sleep"></option>
                <option value="Call"></option>
                <option value="Confusing Weave"></option>
                <option value="Dislodge Spell"></option>
                <option value="Hypervelocity"></option>
                <option value="Mystic Net"></option>
                <option value="Spellstore"></option>
                <option value="Astral Catastrophe"></option>
                <option value="Catch Spell"></option>
                <option value="Compression Bubble"></option>
                <option value="Karma Cancel"></option>
                <option value="Spell Cage"></option>
                <option value="Spell Snatcher"></option>
              </datalist>



                    <!-- Section Spells - Grimoire Subsection- Fieldset -->
              <fieldset class="repeating_spell">
                <div>
                  <span class="sheet-hidden">
                    <input name="attr_SP_RowID" type="text" >
                    <input name="attr_SP_spmRowID" type="text" value="0">   <!-- This is the Matrix row ID for spells that are in Matrix-->
                  </span>
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab0" value="0" checked >
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab1" value="1">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab2" value="2">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab3" value="3">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab4" value="4">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab5" value="5">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab6" value="6">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab7" value="7">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab8" value="8">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="9">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="10">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="11">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab9" value="12">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="13">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="14">
                  <input type="radio" name="attr_SP_Circle" class="sheet-hidden sheet-grim-tab10" value="15">
                  <input type="checkbox" name="attr_SP_spmRowID" class="sheet-hidden sheet-grim-tab11 sheet-api" checked value="0"> <!--This is an exception where checked means NOT displayed-->

                  <div class="sheet-filter-box">    <!--Spells Fieldset - Matrix&Attune-->
                    <input name="attr_SP_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

                    <span class="sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan sheet-api sheet-HideIfEditMode sheet-HideIfPrint">
                      <input type="checkbox" name="attr_SP_spmRowID" class="sheet-hidden sheet-testChecked" value="0" checked>
                      <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-HideIfNotChecked" name="roll_SP_AttuneButton" type="roll"
                       value="!Earthdawn~ charID: @{character_id}~ ?{What Function|Attune,TuneMatrix: Spell|Create a pseudo matrix &amp; Attune,TuneMatrix: Share: ?{What type of Pseudo Matrix&amp;#124;Standard&amp;#44;Std&amp;#124;Enhanced&amp;#44;Enh&amp;#124;Armored&amp;#44;Arm&amp;#124;Shared&amp;#44;Sha&amp;rbrace;}: @{SP_RowID}"
                      title="%{selected|SP_AttuneButton}    Attune spell into a Spell Matrix. Note that creating a spell matrix and moving a spell into it is a quick way to do creature powers as well as spells that can share a matrix.">
                      <span class="sheet-iconstatic sheet-icon-matrix-attune"></span></button>
                      <span class="sheet-iconstatic sheet-icon-matrix sheet-HideIfChecked"></span>
                    </span>
                          <!--Spells Fieldset - Circle-->
                    <span class="sheet-LockIfNotEditMode sheet-numShort sheet-fixed-width sheet-titlespan sheet-HideIfNotEditMode">
                      <select name="attr_SP_Circle" class="sheet-HideIfNotEditMode sheet-numShort" title="@{repeating_spell_X_SP_Circle}   What is the spell circle?">
                        <option value="0" selected title="Please choose the circle for this spell.">-</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                      </select>
                    </span>
                          <!--Spells Fieldset - Discipline-->
                    <select name="attr_SP_Discipline" class="sheet-HideIfNotEditMode sheet-numLong sheet-titlespan" title="@{repeating_spell_X_SP_Discipline}   What Discipline does this spell belong to.">
                      <option value="0" selected>-</option>
                      <option value="Elementalism" >El </option>
                      <option value="Illusionism" >Il </option>
                      <option value="Nethermancy" >Ne </option>
                      <option value="Shamanism">Sh </option>
                      <option value="Wizardry">Wz </option>
                      <option value="Other Weaving">Other </option> -->
                      <option value="Spell Weaving">Power </option>
                    </select>
                          <!--Spells Fieldset - Threads-->
                    <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfEditMode" title="@{repeating_spell_X_SP_sThreads}:   Number of Threads required for this spell.">
                      <input name="attr_SP_sThreads" type="hidden" class="sheet-testNum" value="0" >
                      <input name="attr_SP_sThreads" type="number" readonly class="sheet-HideIfZero sheet-numShorter sheet-bordered-bottom" value="0" min="0">
                    </span>
                    <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_sThreads}:   Number of Threads required for this spell.">
                      <input name="attr_SP_sThreads" type="number" class="sheet-numShorter sheet-bordered-bottom" value="0" min="0">
                    </span>
                          <!--Spells Fieldset - Name & Master Button-->
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-api">
                      <button class="sheet-text-button sheet-label-under sheet-api" name="roll_SP_Roll" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ ForEach: inmt~ Spell: @{SP_RowID}: Sequence : G"
                      title="%{selected|SP_Roll} Start a new Spell, or Roll to Weave Threads, Spellcasting, or an Effect test for this spell.">
                      <input name="attr_SP_Name" type="text" class="sheet-buttonlabel sheet-txtMed sheet-HideIfEditMode" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                      </button>
                      <input name="attr_SP_Name" list="spell_name" type="text" class="sheet-HideIfNotEditMode sheet-txtMed sheet-testPlaceholder sheet-bordered-bottom" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                    </span>
                    <span class="sheet-fixed-width sheet-txtMedplus sheet-titlespan sheet-NoAPI">
                      <input name="attr_SP_Name" list="spell_name" type="text" class="sheet-LockIfNotEditMode sheet-txtMedplus sheet-bordered-bottom" placeholder="Name" title="@{repeating_spell_X_SP_Name}:   Name of Spell.">
                    </span>
                    <input name="attr_SP_Name" list="spell_name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                    <span class="sheet-hideIfNotPlaceholder" title="@{repeating_spell_X_SP_textImport}:   Spell Text import: This only shows up if Name is empty.">
                      <textarea name="attr_SP_textImport" placeholder="text import" class="sheet-textimport"></textarea><br>
                      If you have a PDF copy of the book, you can copy an entire Spell description (starting with the name,
                      and including everything) and paste it into this tiny text box. It will be parsed and whatever fields
                      can be set based upon the text will be. You will still need to manually set some of the fields.
                    </span>
                          <!--Spells Fieldset - Effect-->
                    <span class="sheet-fixed-width sheet-txtShort sheet-titlespan sheet-HideIfNotEditMode sheet-hideIfPlaceholder">
                      <input name="attr_SP_WilSelect" class="sheet-testChecked sheet-hidden" checked value="None" type="checkbox">
                      <select name="attr_SP_WilSelect" class="sheet-txtShort sheet-HideIfNotChecked" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <option value="None" selected>None</option>
                        <option value="Wil">Wil</option>
                        <option value="Rank">Rk</option>
                        <option value="Circle">Cir</option>
                      </select>
                      <select name="attr_SP_WilSelect" class="sheet-numLong sheet-HideIfChecked" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <option value="None" selected>None</option>
                        <option value="Wil">Wil</option>
                        <option value="Rank">Rk</option>
                        <option value="Circle">Cir</option>
                      </select>
                      <span class="sheet-middle sheet-HideIfChecked">+</span>
                      <span class="sheet-nowrap0 sheet-HideIfChecked" title="@{repeating_spell_X_SP_WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                        <input name="attr_SP_WilEffect" type="number" value="0" class="sheet-numShort sheet-LockIfNotChecked">
                      </span>
                    </span>
                    <span class="sheet-nowrap0 sheet-HideIfEditMode sheet-titlespan sheet-fixed-width sheet-selShort sheet-hideIfPlaceholder" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                      <input class="sheet-testChecked sheet-hidden" checked name="attr_SP_WilSelect" value="None" type="checkbox">
                      <span class="sheet-HideIfChecked">
                        <input name="attr_SP_WilSelect" type="text" readonly class="sheet-numShorter" title="@{repeating_spell_X_SP_WilSelect}:   Is the Will Effect based upon WIl, Spellcasting Rank, or spellcasting Circle.">
                        <span class="sheet-middle">+</span>
                        <span class="sheet-nowrap0" title="@{repeating_spell_X_SP_WilEffect}:   If this spell has a Willforce based effect, what is the spells Willforce modifier.">
                          <input name="attr_SP_WilEffect" type="number" readonly value="0" class="sheet-numShorter">
                        </span>
                      </span>
                    </span>
                          <!--Spells Fieldset - Target-->
                          <!--JBF@JBF : Non-Api to be checked-->
                    <span class=" sheet-hideIfPlaceholder sheet-iconselect-span sheet-fixed-width sheet-text-center sheet-w50px sheet-titlespan sheet-api sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_Casting}    How is the Target Number arrived at? What attribute is targeted and how?">
                      <span class="sheet-iconselect-icon">
                        <input checked class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target."> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-MD" title="Targets Mystic Defense. There is always exactly one Target."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MDh" title="Targets highest Mystic Defense among all targets." > <span class="sheet-HideIfNotCloseChecked" title="Targets highest Mystic Defense among all targets."> h<span class="sheet-iconstatic sheet-icon-MD"></span></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MD-each" title="Targets individually Mystic Defense of each target." > <span class="sheet-HideIfNotCloseChecked" title="Targets highest Mystic Defense among all targets."> <span class="sheet-iconstatic sheet-icon-MD"></span>-e</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target."> <span class="sheet-HideIfNotCloseChecked" title="Targets highest Mystic Defense, +1 for each additional target."> h<span class="sheet-iconstatic sheet-icon-MD"></span>+1</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made."> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-ask" title="Ask for target number when roll is made."></span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="2" title="The target number is 2."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 2."> <span class="sheet-iconstatic sheet-icon-TN"></span>2</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="3" title="The target number is 3."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 3."> <span class="sheet-iconstatic sheet-icon-TN"></span>3</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="4" title="The target number is 4."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 4."> <span class="sheet-iconstatic sheet-icon-TN"></span>4</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="5" title="The target number is 5."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 5."> <span class="sheet-iconstatic sheet-icon-TN"></span>5</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="6" title="The target number is 6."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 6."> <span class="sheet-iconstatic sheet-icon-TN"></span>6</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="7" title="The target number is 7."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 7."> <span class="sheet-iconstatic sheet-icon-TN"></span>7</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="8" title="The target number is 8."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 8."> <span class="sheet-iconstatic sheet-icon-TN"></span>8</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="9" title="The target number is 9."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 9."> <span class="sheet-iconstatic sheet-icon-TN"></span>9</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="10" title="The target number is 10."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 10."> <span class="sheet-iconstatic sheet-icon-TN"></span>10</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="11" title="The target number is 11."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 11."> <span class="sheet-iconstatic sheet-icon-TN"></span>11</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="12" title="The target number is 12."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 12."> <span class="sheet-iconstatic sheet-icon-TN"></span>12</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="13" title="The target number is 13."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 13."> <span class="sheet-iconstatic sheet-icon-TN"></span>13</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="14" title="The target number is 14."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 14."> <span class="sheet-iconstatic sheet-icon-TN"></span>14</span>
                        <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_SP_Casting" value="15" title="The target number is 15."> <span class="sheet-HideIfNotCloseChecked" title="The target number is 15."> <span class="sheet-iconstatic sheet-icon-TN"></span>15</span>
                      </span>
                      <select name="attr_SP_Casting" class="sheet-iconselect-select sheet-w50px">
                        <option selected value="MD1: @{target|Target|token_id}" title="Targets Mystic Defense. There is always exactly one Target."> MD-1</option>
                        <option value="MDh" title="Targets highest Mystic Defense among all targets."> h-MD</option>
                        <option value="MD-each" title="Targets individually Mystic Defense of each target."> MD-each</option>
                        <option value="MDhp1p" title="Targets highest Mystic Defense, +1 for each additional target."> h-MD+1p</option>
                        <option value="Ask: ?{Target Number|0}" title="Ask for target number when roll is made."> Ask</option>
                        <option value="2" title="The target number is 2.">2</option>
                        <option value="3" title="The target number is 3.">3</option>
                        <option value="4" title="The target number is 4."> 4</option>
                        <option value="5" title="The target number is 5."> 5</option>
                        <option value="6" title="The target number is 6."> 6</option>
                        <option value="7" title="The target number is 7."> 7</option>
                        <option value="8" title="The target number is 8."> 8</option>
                        <option value="9" title="The target number is 9."> 9</option>
                        <option value="10" title="The target number is 10."> 10</option>
                        <option value="11" title="The target number is 11."> 11</option>
                        <option value="12" title="The target number is 12."> 12</option>
                        <option value="13" title="The target number is 13."> 13</option>
                        <option value="14" title="The target number is 14."> 14</option>
                        <option value="15" title="The target number is 15."> 15</option>
                      </select>
                    </span>

                          <!--Spells Fieldset - Range-->
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-numShort" title="@{repeating_spell_X_SP_Range}:   Range spell can be cast, Usually in Yards though it may be Touch or Self. Select a predefined Range, or type your own">
                      <input name="attr_SP_Range" type="text" class="sheet-numShort sheet-bordered-bottom sheet-LockIfNotEditMode sheet-hidden">
                      <input list="spell_range" name="attr_SP_Range" type="text" class="sheet-numShort sheet-bordered-bottom sheet-LockIfNotEditMode text-center" >
                    </span>
                          <!--Spells Fieldset - Duration-->
                    <span class=" sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-numShort sheet-api sheet-HideIfEditMode" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Edit' button to edit this field.">
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-numShort sheet-bordered-bottom" readonly>
                    </span>
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-txtShort sheet-api sheet-HideIfNotEditMode" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Edit' button to edit this field.">
                      <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditDurationButton" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ chatMenu: editSpell2: @{SP_RowID}: Dur: ?{Duration|Nothing,|Rank,Rk|Circle,Cir}: ?{Duration plus|0}: ?{Duration increment|Rounds,Rd|Minutes,Min|Hours,hr|Days,d|Months,mth}"
                      title="%{selected|SP_EditDurationButton}   Edit this spell duration.">
                      <span class="sheet-iconstatic sheet-icon-edit"></span></button>
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom" readonly>
                    </span>
                    <span class="sheet-hideIfPlaceholder sheet-titlespan sheet-fixed-width sheet-selShort sheet-NoAPI" title="@{repeating_spell_X_SP_Duration}:   Duration of Spell. Press 'Do Stuff' button to edit this field.">
                      <input type="text" name="attr_SP_Duration" class="sheet-fixed-width sheet-selShort sheet-bordered-bottom sheet-LockIfNotEditMode">
                    </span>

                    <!--Spells Fieldset - Strain-->
                    <span class="sheet-fixed-width sheet-w25px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfObject" title="@{repeating_spell_X_SP_Strain}: number of strain points per use">
                      <input name="attr_SP_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                      <input name="attr_SP_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                      <input name="attr_SP_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >

                      <!--Strain Formula, show + if there is a Formula-->
                      <input name="attr_SP_Strain_max" type="hidden" value="0">
                      <input name="attr_SP_StrainAdvanced" type="hidden" value="" class="sheet-testEmpty"><span class="sheet-HideIfEmpty sheet-strainadvanced sheet-api">+</span>
                    </span>



                          <!--Spells Fieldset - Effect-->
                    <span class="sheet-hideIfPlaceholder sheet-txtMedplus sheet-titlespan sheet-fixed-width " title="@{repeating_spell_X_SP_Effect}:   Effect of Spell.">
                      <input type="text" name="attr_SP_Effect" class="sheet-txtMedplus sheet-text-left sheet-bordered-bottom sheet-LockIfNotEditMode" >
                    </span>

                          <!--Spells Fieldset -  Details and Parameters-->
                    <span class="sheet-hideIfPlaceholder sheet-nowrap">
                      <label title="@{repeating_spell_X_SP_Details}   Show details of Spell">
                        <input type="checkbox" name="attr_SP_Details" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                      </label>
                      <label class="sheet-HideIfNotEditMode sheet-api" title="@{repeating_spell_X_SP_CombatSlot}  Should this Spell be summarized on the combat tab and placed in a Token Action?. Note that this will only happen if the spell is attuned in Matrix">
                        <input type="checkbox" name="attr_SP_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                      </label>
                      <label title="@{repeating_spell_X_SP_Parameters}   Show detailed parameters" class="sheet-HideIfNotEditMode">
                        <input type="checkbox" name="attr_SP_Parameters" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-parameter"></span>
                      </label>

                      <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                        <!--Compendium Button-->
                        <input type="checkbox" name="attr_SP_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                        <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_SP_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                      </span>
                    </span>

                          <!--Spells Fieldset -  Spell Details-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Details" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked">
                            <!--Spells Fieldset - Attuning Difficutlies-->
                      <span class="sheet-nowrap">
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfEdition3" title="@{repeating_spell_X_SP_Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Sensing difficulty.">
                          <input name="attr_SP_Numbers" type="text" readonly class="sheet-bordered-bottom">
                          <span name="attr_SP_Numbers" class="sheet-autoexpand"></span>
                          <span>Wv/Ratn/Dspl/Sns</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-HideIfNotEdition3" title="@{repeating_spell_X_SP_Numbers}:   Weaving difficulty / Reattunment difficulty / Dispelling difficulty / Disbelief difficulty / Sensing difficulty.">
                          <input name="attr_SP_Numbers" type="text" class="sheet-bordered-bottom">
                          <span name="attr_SP_Numbers" class="sheet-autoexpand"></span>
                          <span>Wv/Ratn/Dspl/Dblf/Sns</span>
                        </label>
                        <!--Spells Fieldset - AoE-->
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-fixed-width sheet-numLong" title="@{repeating_spell_X_SP_AoE}:   Area of Effect - Usually in Yards.">
                          <input name="attr_SP_AoE" type="text" value=" " class="sheet-bordered-bottom" >
                          <span name="attr_SP_AoE" class="sheet-autoexpand"></span>
                          <span>AoE</span>
                        </label>
                      </span>
                            <!--Spells Fieldset - Armor-->
                      <span class="sheet-nowrap sheet-label-under" title="@{repeating_spell_X_SP_EffectArmor}:   If there is a will effect, what armor protects against it?">
                        <select name="attr_SP_EffectArmor" class="sheet-selLong">
                          <option value="N/A" selected>N/A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Not Applicable: There is no Will Effect</option>
                          <option value="NoDmg"       >No Dmg &nbsp;&nbsp; Not Applicable: The Will Effect does no damage</option>
                          <option value="MA"          >MA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mystic Armor protects against this Will Effect</option>
                          <option value="PA"          >PA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Physical Armor protects against this Will Effect</option>
                          <option value="PA-Nat"      >PA-Nat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only Natural Physical Armor protects against this Will Effect</option>
                          <option value="MA-Nat"      >MA-Nat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only Natural Mystic Armor protects against this Will Effect</option>
                          <option value="NoArmor"     >No Armor &nbsp;No Armor protects against this Will Effect damage</option>
                        </select>
                        <span>Efct Armor</span>
                      </span>
                            <!--Spells Fieldset - Extra successes-->
                      <span class="sheet-nowrap sheet-label-under" title="@{repeating_spell_X_SP_SuccessLevels}:   Effect of Extra Success Levels.">
                        <select name="attr_SP_SuccessLevels" class="sheet-txtShort">
                          <option value="None" selected >None</option>
                          <option value="Inc Efct Step (+2)">Efct +2 Step Increase</option>
                          <option value="Inc Efct (Other)"  >Efct Other Increase</option>
                          <option value="Inc Dur (+2)"      >Dur +2 Increase</option>
                          <option value="Inc Dur (Other)"   >Dur Other Increase</option>
                          <option value="Inc Area (+2)"     >Area +2 yards Increase</option>
                          <option value="Inc Area (Other)"  >Area Other Increase</option>
                          <option value="Inc Rng (+20)"     >Range +20 yards Increase</option>
                          <option value="Add Tgt (+1)"      >Target +1 Additional</option>
                          <option value="Special"           >Special</option>
                        </select>
                        <span>Extra Success</span>
                      </span>
                            <!--Spells Fieldset - Extra Thread-->
                      <span class="sheet-nowrap">
                        <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditExtraThreadsButton" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ ?{What Function|Add Extra Thread,chatMenu: editSpell2: @{SP_RowID}: MenuAddExtraThread|Remove Extra Thread,chatMenu: editSpell2: @{SP_RowID}: MenuRemoveExtraThread}"
                        title="%{selected|SP_EditExtraThreadsButton}   Edit this spell extraThreads.">
                        <span class="sheet-iconstatic sheet-icon-edit"></span></button>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api"  title="@{repeating_spell_X_SP_ExtraThreads}:   Effect of weaving extra threads to the spell.  Press 'Do Stuff' button to edit this field.">
                          <input type="text" name="attr_SP_ExtraThreads" class="sheet-bordered-bottom"  readonly>
                          <span name="attr_SP_ExtraThreads" class="sheet-autoexpand"></span>
                          <span>Extra Threads</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-NoAPI" title="@{repeating_spell_X_SP_ExtraThreads}:   Effect of weaving extra threads to the spell.  Press 'Do Stuff' button to edit this field.">
                          <input type="text" name="attr_SP_ExtraThreads" class="sheet-bordered-bottom" >
                          <span name="attr_SP_ExtraThreads" class="sheet-autoexpand"></span>
                          <span>Extra Threads</span>
                        </label>
                      </span>
                      <!--Strain Formula, display place-->
                      <input type="hidden" name="attr_SP_StrainAdvanced" class="sheet-testEmpty" value="">
                        <span class="sheet-nowrap sheet-label sheet-HideIfEmpty sheet-api" title="@{repeating_spell_X_SP_StrainAdvanced_max}   Advanced Strain Formula for abilities that have a variable Strain">
                          Strain Advanced :
                          <input name="attr_SP_StrainAdvanced_max" type="text"  class="sheet-txtLong" readonly>
                        </span>
                    </div>    <!-- end spell details -->
                          <!--Spells Fieldset -  Spell Parameters-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Parameters" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked sheet-HideIfNotEditMode">
                            <!--Spells Fieldset - Options affecting result-->
                      <div class="sheet-HideIfNotOption2 sheet-api">
                        <span class="sheet-label"> After roll parameters - </span>
                        <span class="sheet-nowrap sheet-api sheet-HideIfNoRoll" >
                          <select name="attr_SP_sayTotalSuccess" class="selLong" title="@{repeating_spell_X_SP_sayTotalSuccess} Decide to display either the tatal number of successes, or the number of extra successes above the first one">
                            <option value="0" selected title="@{repeating_spell_X_SP_sayTotalSuccess} Extra Successes - When a roll is made, Extra Successes are calculated">Say Extra Successes</option>
                            <option value="1" title="@{repeating_spell_X_SP_sayTotalSuccess} Total Successes - When a roll is made, Total Successes are calculated (i.e. including the base success)">Say Total Successes</option>
                          </select>
                        </span>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_talents_X_SP_DisplayText}:   Text to display whether the test succeeds or not. If there is a ~ (tilde) then only displays up until the first tilde is displayed and the rest is run through the API parser.">
                          <input name="attr_SP_DisplayText" type="text" class="sheet-bordered-bottom" value=" ">
                          <span name="attr_SP_DisplayText" class="sheet-autoexpand"></span>
                          <span>Display Text</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_spell_X_SP_SuccessText}:   Text to display if the test succeeds. Can optionally be used to remind people how the spell works.">
                          <input name="attr_SP_SuccessText" type="text" class="sheet-bordered-bottom" value=" ">
                          <span name="attr_SP_SuccessText" class="sheet-autoexpand"></span>
                          <span>Success Text</span>
                        </label>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-minWidth3" title="@{repeating_spell_X_SP_FailText}:   Text to display if the test fails.">
                          <input name="attr_SP_FailText" type="text" class="sheet-bordered-bottom" value=" ">
                          <span name="attr_SP_FailText" class="sheet-autoexpand"></span>
                          <span>Fail Text</span>
                        </label>

                        <!--Strain Formula, edit place-->
                          <span class="sheet-nowrap sheet-label sheet-api" title="@{repeating_spell_X_SP_StrainAdvanced}   Advanced Strain Formula for abilities that have a variable Strain">
                            Strain Advanced :
                            <input name="attr_SP_Strain" type="number" value="0" class="sheet-numShorter" >
                            <select name="attr_SP_StrainAdvanced" class="sheet-selShort">
                              <option selected value="" title="Fixed Strain">Fixed</option>
                              <option value="Ask" title="Ask number of strain">Ask</option>
                            </select>
                          </span>



                              <!--Spells Fieldset - FX-->
                        <button class="sheet-text-button sheet-label-under sheet-button-nodice sheet-api" name="roll_SP_EditSFXButton" type="roll"
                        value="!Earthdawn~ charID: @{character_id}~ chatMenu: fxSet: 0: SP: @{SP_RowID}"
                        title="%{selected|SP_EditSFXButton}   Edit this spell Special Effects.">
                        SFX</button>
                        <label class="sheet-label-under2 sheet-autoexpand-wrap sheet-api" title="@{repeating_spell_X_SP_FX}:   Special Effects command. FX command to be performed when this spell is used. Press 'Do Stuff' button to edit this field.">
                          <input name="attr_SP_FX" type="text" readonly value=" " class="sheet-bordered-bottom">
                          <span name="attr_SP_FX" class="sheet-autoexpand"></span>
                          <span>Special Effects</span>
                        </label>
                      </div>
                    </div>
                          <!--Spells Fieldset - Notes-->
                    <input class="sheet-testCloseChecked sheet-hidden" name="attr_SP_Details" type="checkbox" value="1">
                    <div class="sheet-HideIfNotCloseChecked">
                      <textarea name="attr_SP_Notes" class="sheet-details" title="@{repeating_spell_X_SP_Notes}   Description of Spell and how it works." placeholder="Description of the Spell and how it works."></textarea>
                    </div>
                  </div>    <!-- End Filtered box   -->
                </div>    <!-- end misc right inside fieldset -->
              </fieldset>
            </div>    <!-- end matrix counter -->
          </div>    <!-- end Section Spells - Grimoire Subsection -->
        </div>    <!-- ***************************************** End of Section Spells*************************************  -->


        <div class="sheet-section sheet-section-grimoire"></div>    <!--  Unused  -->



        <!-- **************************  Start of Section Combat Content ***Other Sections are also labelled section-combat to display in the overview -->
        <!--JBF There is here a duplicate of the repeating_weapons fieldset, because displaying it directly from the Equipment section made a
                very complex CSS. This is more or less the only fieldset that is duplicated instead of showing it in various sections -->
  <div class="sheet-section sheet-section-combat sheet-section-core sheet-w100p">
    <!-- <input type="checkbox" name="attr_show_overview_miscpool" class="sheet-hidden sheet-testCloseChecked" value="1">
    <div class="sheet-headerbar sheet-headerbar sheet-HideIfNotCloseChecked">Weapons and Attacks</div> -->

    <!--**************************  Start of Section Combat, Title***-->
      <!--Section Combat - Header-->
      <div class="sheet-headerbar sheet-HideIfOverviewNoCreature">
        Weapons and Attacks
      </div>    <!-- End combat Header-->

          <!--Section Combat - Content-->
    <div class="sheet-content sheet-w100p sheet-bordered sheet-HideIfOverviewNoCreature">
      <div class="sheet-api sheet-floatRight sheet-content sheet-NotCreation">
        <button class="sheet-text-button" name="roll_Damage-Target" type="roll"
        title="@{Damage-Target}   Apply damage to all targeted tokens with a dropdown selection of the applicable armor."
        value="!Earthdawn~ setToken: @{target|token_id}~ Damage : ?{Damage)|1} : ?{Armor| Physical,PA | Mystic,MA| Nat PA,PA-Nat| Nat MA,MA-Nat| None,NA } : ?{Type of damage|Damage|Stun|Strain}" ><span class="sheet-buttonlabel">Dmg Target</span></button>
      </div>
      <div class="sheet-HideIfNotCreature">
        <span class="sheet-nowrap0"><b>Nb Actions:</b>
          <input name="attr_Actions" type="number" value="1" title="@{Actions}:   Number of Standard Actions character/creature has per round." >
        </span>
        <!-- <span class="sheet-nowrap0">
          <button class="sheet-text-button sheet-api" name="roll_Attack" type="roll"
          value="!Earthdawn~ charID: @{character_id}~ Target: PD~ foreach~ Value: Attack-Step~ Roll: ?{Modification|0}"
          title="@{Attack}   Roll a generic Dex vs PD Attack modified by combat options and conditions."><span class="sheet-buttonlabel">Attack</span></button>
          <button class="sheet-text-button sheet-NoAPI" name="roll_Attack-NoAPI" type="roll"
          value="@{RollType} &{template:rolltargetnumber} {{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}} {{header=@{character_name}: Attack}} {{Step=[[?{Step|@{Attack-Step}}]] + [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
          title="@{Attack-NoAPI}   Roll a generic Dex Attack modified by combat options and conditions."><span class="sheet-buttonlabel">Attack</span></button>
        </span>
        <span class="sheet-nowrap0">
          <input name="attr_Attack-Rank" class="sheet-StepBig sheet-numShort sheet-bordered-bottom" type="number" value="0" title="@{Attack-Rank}   Rank of the generic Attack vs PD. This can be used for unarmed attacks, attacks where the character does not have the appropraite skill, or any situation when you need a generic attack." >
          <span class="sheet-stepSpan sheet-bordered-bottom" title="@{Attack-BaseStep} & @{Attack-Step} Base and Final Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting.">
            <span title="@{Adjust-Attacks-Total-CC}: Automatic Attacks Modifiers for Close Combatcoming from Combat Options, Wounds, Situation Modifiers.">
              <input name="attr_Adjust-Attacks-Total-CC" type="hidden" class="sheet-redGreen" value="0">
              <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
              <input name="attr_Adjust-Attacks-Total-CC" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
            </span>
            <input name="attr_Attack-BaseStep" readonly type="number" class="sheet-StepBig sheet-StepBase" disabled
            value="(@{Attack-Rank}+@{Dex-Step}+@{Dex-Mods})"
            title="@{Attack-BaseStep}  Base Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting.">
            <input name="attr_Attack-Step" readonly class="sheet-StepBig sheet-StepTotal"    type="number" disabled
            value="(@{Attack-Rank}+@{Dex-Step}+@{Dex-Mods}+@{Adjust-Attacks-Total-CC}+@{Attack-Step-Mod})"
            title="@{Attack-Step}   Step of this generic Dex based attack vs PD. This can be used when the character does not have a skill and is defaulting." >
            <span title="@{Attack-Step-Mod}:  Manual modifications to the Generic Attack.">
              <input name="attr_Attack-Step-Mod" type="hidden" class="sheet-redGreen" value="0">
              <b class="sheet-buffSignRight sheet-buffSmall">+</b>
              <input name="attr_Attack-Step-Mod" type="number" class="sheet-buffRight sheet-buffSmall">
            </span>
          </span>
        </span> -->
      </div>
      <input class="sheet-testRepEditMode sheet-hidden" name="attr_CreationMode" value="1" type="checkbox" > <!--JBF Necessary so that it doesn't show ADD/MODIFY except in Creation Mode-->
            <!--Section Combat - WPN fieldset-->
      <fieldset class="repeating_weapons">
        <input name="attr_WPN_CombatSlot" type="checkbox" checked value="1" class="sheet-combattab sheet-hidden" >
        <div class="sheet-filter-box">
          <input name="attr_WPN_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>

          <span class="sheet-nowrap0" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
            <!--Toggle Range/CC Mode-->
            <input type="hidden" name="attr_WPN_CloseCombat"  value="1" class="sheet-testCC">
            <label class="sheet-HideIfCC sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
              <input type="checkbox" name="attr_WPN_CloseCombat" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-attacks sheet-LockIfNotEditMode"></span>
            </label>
            <label class="sheet-HideIfRanged sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
              <input type="checkbox" name="attr_WPN_CloseCombat" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-attacks-cc sheet-LockIfNotEditMode"></span>
            </label>
          </span>


          <!--Weapon Fieldset - Name & Button-->
          <span class="sheet-nowrap0 sheet-HideIfEditMode">
            <button class="sheet-text-button sheet-api" name="roll_WPN_Roll" type="roll"
            value="!Earthdawn~ charID: @{character_id}~ @{RollType} ~ foreach:sct:ust:c~ modValue: ?{Modification|0} ~K-ask: @{KarmaGlobalMode}@{WPN_Karma-Ask}: @{DPGlobalMode}@{WPN_DP-Ask}~ Action: WPN: @{WPN_RowID} "
            title="@{repeating_weapons_X_WPN_Roll}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
            <button class="sheet-text-button sheet-NoAPI" name="roll_WPN_Roll-NoAPI" type="roll"
            value="@{RollType} &{template:default} {{name=@{WPN_Name} Dmg}} {{Step=[[?{Step|@{WPN_Damage}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
            title="@{repeating_weapons_X_WPN_Roll-NoAPI}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
          </span>
          <span class="sheet-nowrap0 sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_Name}:   Type of Weapon used.">
            &nbsp;&nbsp;&nbsp;<input name="attr_WPN_Name" list="weapons"  type="text" class="sheet-txtLong sheet-bordered-bottom" placeholder="Weapon type" >
          </span>
          <!--Weapon Fieldset - Rank-->
          <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfPrint">
            <span class="sheet-stepSpan sheet-bordered-bottom">
              <span class="" title="@{repeating_weapons_X_WPN_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of a Talent, like using Surprise Strike or Down Strike.">
                <input name="attr_WPN_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                <input name="attr_WPN_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
              </span>
              <input name="attr_WPN_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Rank}:   Weapon Base Rank of damage."  type="number"  >
              <span title="@{repeating_weapons_X_WPN_Rank-Adjust}:  Adjustments to the damage of this weapon as for example with Forge Weapon.">
                <input name="attr_WPN_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                <input name="attr_WPN_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
              </span>
            </span>
          </span>

          <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
            <span class="sheet-stepSpan sheet-bordered-bottom">
              <span title="@{repeating_weapons_X_WPN_Mod-Auto}   This is the Total adjustment to Damage from Conditions and Combat Options.">
                <input name="attr_WPN_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                <input name="attr_WPN_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
              </span>
              <input name="attr_WPN_Damage" type="number" class="sheet-StepBig sheet-StepTotal"     readonly value="0" title="@{repeating_weapons_X_WPN_Damage}   Final Damage Step this weapon does including all modifiers .">
              <input name="attr_WPN_BaseDamage" type="number"  class="sheet-StepBig sheet-StepBase" readonly value="0" title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
              <span title="@{repeating_weapons_X_WPN_Mods}   Modifications to the base damage.">
                <input name="attr_WPN_Mods" type="hidden" class="sheet-redGreen" value="0">
                <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                <input name="attr_WPN_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
              </span>
            </span>
          </span>

          <span class="sheet-nowrap0 sheet-fixed-width sheet-w30px sheet-Creation sheet-HideIfNotCreature" title="@{repeating_weapons_X_WPN_addSR} Add the challenge Rating or Spirit Strength Rating to the Weapon Rank.">
            <label class="sheet-labelcheckbox" hidden>
            <input type="checkbox" name="attr_WPN_addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
          </label>
          </span>


          <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
            <span class="sheet-stepSpan sheet-bordered-bottom">
              <input name="attr_WPN_BaseDamage" type="number"  class="sheet-StepBig" readonly  value="0" title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
            </span>
          </span>



          <span class="sheet-Karma-ControlBox">    <!--JBF Karma Toggle-Simple-->
            <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
            <span class="sheet-HideIfCloseChecked">
              <input type="hidden" name="attr_WPN_Karma-Ask" value="0">   <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
              <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
              <span class="sheet-HideIfCloseChecked" >
                <input type="checkbox" name="attr_WPN_Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                <span class="sheet-HideIfNotChecked">
                  <label class="sheet-labelcheckbox" hidden title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On" >
                    <input type="checkbox" name="attr_WPN_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                  </label>
                </span>
                <span class="sheet-HideIfChecked">
                  <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_Karma} : Number of Karma Points to be spent when Karma is On">
                    <span class="sheet-iconselect-icon-noedit">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma} Don't Spend any Karma when Karma is On."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                    </span>
                    <input type="hidden" name="attr_WPN_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                    <input type="hidden" name="attr_WPN_Karma-Limit_max" class="sheet-testKarMax">
                    <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                      <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                      <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                      <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                      <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                    </select>
                    <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                      <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                      <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                      <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                    </select>
                    <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                      <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                      <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                    </select>
                    <select name="attr_WPN_Karma" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                      <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                      <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                      <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                    </select>
                  </span>
                </span>
              </span>
            </span>   <!--JBF End Of Karma Toggle-Simple-->
          </span>
                  <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
            <span class="sheet-DP-ControlBox">
              <input type="hidden" name="attr_WPN_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
              <input type="checkbox" name="attr_WPN_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
              <span class="sheet-HideIfCloseChecked" >
                <input type="checkbox" name="attr_WPN_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                <span class="sheet-HideIfNotChecked">
                  <label class="sheet-labelcheckbox" hidden title="@{WPN_DP}   Automatically Spends One Devotion when Devotion is On" >
                    <input type="checkbox" name="attr_WPN_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                  </label>
                </span>
                <span class="sheet-HideIfChecked">
                  <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_DP} : Number of Devotion Points to be spent when Devotion is On">
                    <span class="sheet-iconselect-icon-noedit">
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP} Don't Spend any Dp when Dp is On."></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On"></span>
                      <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On"></span>
                    </span>
                    <input type="hidden" name="attr_WPN_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                    <input type="hidden" name="attr_WPN_DP-Limit_max" class="sheet-testKarMax">
                    <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_3">
                      <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                      <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                      <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                      <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                    </select>
                    <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_3">
                      <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                      <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                      <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                    </select>
                    <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_1_2">
                      <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                      <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                    </select>
                    <select name="attr_WPN_DP" class="sheet-iconselect-select-noedit sheet-w30px sheet-Kar_0_2">
                      <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                      <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                      <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                    </select>
                  </span>
                </span>
              </span>
            </span>   <!--JBF End Of DP Toggle-->
          <span class="sheet-fixed-width sheet-w25px"></span>   <!--Spacer Span, just for alignment-->
        </div>
      </fieldset>
    </div>    <!-- end combat weapons and attacks content -->
  </div>    <!--  End of Section Combat***Other Sections are also labelled section-combat to display in the overview  -->







              <!-- ***************************************** Mini Section for Miscellaneous*************************************  -->
        <div class="sheet-section sheet-section-core sheet-section-combat sheet-w100p">
          <div class="sheet-headerbar sheet-NotCreation"> Miscellaneous </div>
                <!--Misc - Racial-->
          <div class="sheet-Creation sheet-headerbar sheet-HideIfNotCreature"> <b class="sheet-creation-order">4-</b> Common Powers and Maneuvers </div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfNotCreature"> To be set in Parameters/Maneuvers. </div>

          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature"> <b class="sheet-creation-order">6-</b> Racial & Karma Abilities </div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfCreature sheet-small"> Automatically Determined by your Race and Discipline. </div>
          <div class="sheet-content sheet-HideIfCreature sheet-HideIfNotOverview">
            <span class="sheet-autoexpand-wrap" title="@{RacialAbilities}  Racial Abilities.">
              <input name="attr_RacialAbilities" class="sheet-text-left sheet-LockIfNotHomeBrew"
              placeholder="Racial Abilities"
              type="text" >
              <span name="attr_RacialAbilities" class="sheet-autoexpand">
              </span>
            </span>
            <br>
            <textarea name="attr_Karma-Ability" readonly class="sheet-details-small"  title="@{Karma-Ability : Automatically Lists all Karma Ability as per your Discipline (at this stage doesn't include Questor or Path)}">
          </div>
                <!--Misc - Maneuvers-->
          <div class="sheet-content sheet-HideIfNotCreature">
            <div>
              <b class="sheet-heading">Creature & Opponent Maneuvers : </b>
            </div>
            <div>
              <input name="attr_Creature-HardenedArmor" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-HardenedArmor}   Hardened Armor: Bonus damage resulting from additional successes on Attack tests is reduced by one per success. Typically, this means that instead of +2 damage per additional success, the attacker only gets +1 damage per additional success">
                Hardened Armor
              </span>
              <input name="attr_Creature-GrabAndBite" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-GrabAndBite}   Grab and Bite: The creature may spend an additional success from an Attack test to automatically grapple an opponent. Grappled opponents automatically take bite damage each round until the grapple is broken.">
                Grab and Bite
              </span>
              <input name="attr_Creature-Hamstring" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Hamstring}   Hamstring: The creature may spend an additional success from an Attack test to halve the opponents Movement until the end of the next round. If the attack causes a Wound, the penalty lasts until the Wound is healed.">
                Hamstring
              </span>
              <input name="attr_Creature-Overrun" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Overrun}   Overrun: The creature may spend an additional success from an Attack test to force an opponent with a lower Strength Step to make a Knockdown test against a DN equal to the Attack test result.">
                Overrun
              </span>
              <input name="attr_Creature-Pounce" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-Pounce}   Pounce: If the creature reaches its opponent with a leap and the opponent isnt too much larger, the creature may spend an additional success from the Attack test to force the opponent to make a Knockdown test against a DN equal to the Attack test result.">
                Pounce
              </span>
              <input name="attr_Creature-SqueezeTheLife" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Creature-SqueezeTheLife}   Squeeze the Life: The creature may spend two additional successes from an Attack test to automatically grapple an opponent. Grappled opponents automatically take claw damage each round until the grapple is broken">
                Squeeze the Life
              </span>
              <input name="attr_Creature-Fury" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Fury}   Fury threshold - If non-zero, instead of suffering penalties, Wounds grant this creature a bonus to tests. Once the creature has more Wounds than indicated by the Step of this ability, the bonuses are lost and the creature suffers normal penalties for Wounds.">
                Fury <input name="attr_Creature-Fury" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-ResistPain" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-ResistPain}   Resist Pain threshold - If non-zero, the creature ignores penalties for Wounds equal to this ability. For example, a creature with Resist Pain (2) ignores the penalties from the first two Wounds suffered.">
                Resist Pain <input name="attr_Creature-ResistPain" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-Willful" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Willful}   Willful threshold - If non-zero, Talents and abilities used to dominate, control, tame or train the creature require additional successes equal to the Step of this ability.">
                Willful <input name="attr_Creature-Willful" type="number" value="0" min="0" readonly>
              </span>
              <input name="attr_Creature-Ambushing_max" type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden">
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-Ambushing_max}   If the 'Ambushing' status is ON, this is the amount that is added to Initiative, Attack, and Damage.">
                <span class="sheet-iconstatic sheet-icon-ambush"></span> Ambush <input name="attr_Creature-Ambushing_max" type="number" value="0" min="0" readonly >
              </span>
              <input name="attr_Creature-DivingCharging_max"  type="checkbox" value="0" checked class="sheet-testCloseChecked sheet-hidden" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfCloseChecked" title="@{Creature-DivingCharging_max}   If the 'Diving/Charging' box is checked, this is the amount that is added to Attack, and Damage. Use this for ether Diving or Charging creature powers.">
                <span class="sheet-iconstatic sheet-icon-charging"></span>Dive/Charge <input name="attr_Creature-DivingCharging_max" type="number" value="0" min="0" readonly>
              </span>
            </div>
            <div>
              <input name="attr_Opponent-ClipTheWing" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-ClipTheWing}   Clip the Wing: The attacker may spend two additional successes from an Attack test to remove the creatures ability to fly until the end of the next round. If the attack causes a Wound, the creature cannot fly until the Wound is healed. If the creature is in flight, it falls and suffers falling damage for half the distance fallen.">
                Clip the Wing
              </span>
              <input name="attr_Opponent-CrackTheShell" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-CrackTheShell}   Crack the Shell: The attacker may spend extra successes from physical attacks (not spells) to reduce the creatures Physical Armor by 1 per success spent. This reduction takes place after damage is assessed, and lasts until the end of combat.">
                Crack the Shell
              </span>
              <input name="attr_Opponent-Defang" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Defang}   Defang: The opponent may spend additional successes to affect the creatures ability to use its poison. Each success spent reduces the Poisons Step by 2. If the attack causes a Wound, the creature cannot use its Poison power at all until the Wound is healed">
                Defang
              </span>
              <input name="attr_Opponent-Enrage" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Enrage}   Enrage: An opponent may spend additional successes from an Attack test to give a -1 penalty to the creatures Attack tests and Physical Defense until the end of the next round. Multiple successes may be spent for a cumulative effect.">
                Enrage
              </span>
              <input name="attr_Opponent-Provoke" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont sheet-HideIfNotCloseChecked" title="@{Opponent-Provoke}   Provoke: The attacker may spend two additional successes from an Attack test to enrage the creature and guarantee he will be the sole target of the creatures next set of attacks. Only the most recent application of this maneuver has any effect.">
                Provoke
              </span>
              <input name="attr_Opponent-PryLoose" type="checkbox" class="sheet-testCloseChecked sheet-hidden" value="1" >
              <span class="sheet-nowrap2 sheet-fancyfont  sheet-HideIfNotCloseChecked" title="@{Opponent-PryLoose}   Pry Loose: The attacker may spend additional successes from an Attack test to allow a grappled ally to immediately make an escape attempt with a +2 bonus per success spent on this maneuver">
                Pry Loose
              </span>
            </div>
            <input value="1" class="sheet-hidden sheet-testRepEditMode" type="checkbox">
            <fieldset class="repeating_maneuvers">
              <div>
                <input name="attr_MAN_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-testChecked sheet-hidden">
                <span class="sheet-nowrap0" >
                  <label class="sheet-HideIfNotChecked" >
                    <!-- Man_Type : 1 - CREATURE
                                    -1 - Opponent
                                    Don't get mixed up : The checkboxes are "inverted" because clicking on the checkbox will put the appropriate value in MAN_Type -->

                    <input type="checkbox" name="attr_MAN_Type" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-creature" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                  </label>
                  <label class="sheet-HideIfChecked">
                    <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-opponent" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                  </label>
                </span>
                <span class="sheet-fixed-width sheet-titlespan sheet-txtLong sheet-bordered-bottom">
                  <input name="attr_MAN_Name" type="text" class="sheet-fixed-width sheet-txtLong" placeholder="name" title="@{repeating_maneuvers_MAN_Name} Use these fields to specify a custom Maneuvers (Opponent or Creature). ">
                </span>
                <label title="@{repeating_maneuvers_X_MAN_ShowNotes}   Show description of Maneuver">
                  <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                </label>
                <span class="sheet-fixed-width sheet-w30px">
                <label class="sheet-HideIfChecked" title="@{repeating_maneuvers_MAN_Show} Use these field to hide/show Opponent maneuvers. It will not be offered up to the user as a way to spend extra successes unless the 'Show' field is checked. This allows the GM to get the opponent maneuvers all setup but not let the players see them until they have passed a knowledge test.">
                  <input type="checkbox" name="attr_MAN_Show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-maneuver-show"></span>
                </label>
              </span>
              </div>
              <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
              <div class="sheet-HideIfNotChecked">
                <textarea name="attr_MAN_Desc" class="sheet-details-small" title="@{repeating_maneuvers_MAN_Desc} Use these fields to specify a custom Maneuvers (Opponent or Creature). A text description of the maneuver." placeholder="Description of the Maneuver and how it works."></textarea>
              </div>
            </fieldset>
          </div>    <!-- end Misc - Maneuvers -->

                <!--Misc - Creation Equip-->
          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature"> <b class="sheet-creation-order">7-</b> Equip Your Character </div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfCreature sheet-small"> Basic Equipment and silver as per the Player Guide p72 has been initialized in the Equipment tab. Don't forget to pick Artisan's kit per your artisan skill</div>
          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature"> <b class="sheet-creation-order">8-</b> Flesh Out your character </div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfCreature"> Describe how he looks, and his personally traits</div>
                <!-- Misc - Movement & Misc Pools-->
          <input type="checkbox" name="attr_show_overview_miscpool" class="sheet-hidden sheet-testCloseChecked" value="1">
          <div class="sheet-content sheet-flex-container sheet-NotCreation sheet-HideIfNotCloseChecked">
                  <!--Misc -Movement-->
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="@{Movement}:   Current Movement Rate. If conditions would lower it less than one, value is set to '1*'">
              <div class="sheet-headerbar" >Movement</div>
              <div>
                <span class="sheet-stepSpan sheet-bordered-bottom">
                  <span title="@{Movement-Mod-Auto}: Automatic Adjustments to Movement.">
                    <input name="attr_Movement-Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                    <input name="attr_Movement-Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                  </span>
                  <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-hidden sheet-testCloseChecked">
                  <span class="sheet-HideIfCloseChecked">
                    <input name="attr_Fly-Movement-Base" readonly value="0" class="sheet-StepBig sheet-StepBase" title="@{Fly-Movement-Base}:   Permanent Flying Movement Rate from Race and permanent Adjustments."  type="number">
                    <input name="attr_Fly-Movement" readonly value="0" class="sheet-StepBig sheet-StepTotal" title="@{Fly-Movement}: Current Flying Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                  </span>
                  <span class="sheet-HideIfNotCloseChecked">
                    <input name="attr_Movement-Base" readonly class="sheet-StepBig sheet-StepBase" title="@{Movement-Base}:   Permanent Movement Rate from Race and permanent Adjustments."  type="number">
                    <input name="attr_Movement" readonly class="sheet-StepBig sheet-StepTotal" title="@{Movement}:    Current Movement Rate. If conditions would lower it less than one, value is set to '1*'" type="number"  >
                  </span>
                  <span title="@{Movement-Buff}   Buffs or other temporary modifications to Movement Rating.">
                    <input name="attr_Movement-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Movement-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
              <div>
                <input name="attr_Fly_max" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                <label class="sheet-iconlabel2 sheet-HideIfNotCloseChecked" title="@{condition-Flying}   Is the Creature Currently Flying. Will toggle the display of the flying movement">
                  <input type="checkbox" name="attr_condition-Flying" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabel-invert sheet-icon-flying"></span>
                </label>
                <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
                  <input type="checkbox" name="attr_condition-ImpairedMovement" value="2" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired"></span>
                </label>
                <label class="sheet-iconlabel2" title="@{attr_condition-ImpairedMovement} Heavy Impaired Movement : -10 to Movement Rate (1 min). -4 Penalty to movement based texts due to footing, cramping, or vision impairments. Dex test to avoid tripping or halting.">
                  <input type="checkbox" name="attr_condition-ImpairedMovement" value="4" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-impaired4"></span>
                </label>
              </div>
            </div>
            <input name="attr_condition-Flying" type="checkbox" value="-1" checked class="sheet-hidden sheet-testCloseChecked" >
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-HideIfCloseChecked">
              <div class="sheet-headerbar" >Flying Alt.      </div>
              <div>
                <input name="attr_condition-Flying" type="number" value="0" min="0" max="9" class="sheet-Big sheet-HideSpinners sheet-bordered-bottom" title="@{condition-Flying}:   Altitude at which the character is flying (as displayed in Token). This is between 0 and 9 because it is what the Token Marker can show. Discuss units with your GM." >
              </div>
              <div style="padding-bottom:6px">
                &nbsp;
              </div>
            </div>

                  <!--Misc - Shield-->
            <input name="attr_Shield-Name" class="sheet-hidden sheet-testPlaceholder" type="text" placeholder="Shield type">
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame sheet-hideIfPlaceholder sheet-HideIfPrint sheet-HideIfCreature">
              <!-- <input type="checkbox" name="attr_condition-NoShield" value="1" class="sheet-testChecked sheet-hidden"> -->
              <input type="checkbox" name="attr_condition-Blindsided" value="1" class="sheet-testChecked sheet-hidden">
              <span class="sheet-iconstatic sheet-icon-shield sheet-HideIfChecked"></span>
              <span class="sheet-iconstatic sheet-icon-noshield sheet-hidden sheet-UnHideIfChecked"></span>
              <div>
                <span class="sheet-iconstatic sheet-icon-PD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-PA sheet-HideIfEdition4"></span>
                <span class="sheet-stepSpan">
                  <input name="attr_Shield-Phys" type="number" value="0" class="sheet-StepBig" readonly title="@{Shield-Phys}:   Physical protection shield provides.">
                  <span title="@{Shield-Phys-Buff}   Buff or other temporary modification to PD (ED3 PA) specifically associated with their shield, and that they lose when Blindsided.">
                    <input name="attr_Shield-Phys-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Shield-Phys-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
              <div>
                <span class="sheet-iconstatic sheet-icon-MD sheet-HideIfNotEdition4"></span><span class="sheet-iconstatic sheet-icon-MA sheet-HideIfEdition4"></span>
                <span class="sheet-stepSpan">
                  <input name="attr_Shield-Myst" type="number" value="0" class="sheet-StepBig" readonly title="@
                  {Shield-Myst}:   Mystic protection shield provides.">
                  <span title="@{Shield-Myst-Buff}   Buff or other temporary modification to MD (ED3 MA) specifically associated with their shield, and that they lose when Blindsided.">
                    <input name="attr_Shield-Myst-Buff" type="hidden" class="sheet-redGreen" value="0">
                    <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                    <input name="attr_Shield-Myst-Buff" type="number" class="sheet-buffRight sheet-buffSmall">
                  </span>
                </span>
              </div>
            </div>
                  <!--Misc - Misc-Pools-->
            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-1" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-1}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-1" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-1}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-1" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-1}:   You can use this number to keep track of anything you want." >
              </div>
            </div>

            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-2" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-2}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-2" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-2}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-2" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-2}:   You can use this number to keep track of anything you want." >
              </div>
            </div>

            <div class="sheet-Defense-box sheet-background-frame3 sheet-frame" title="Misc. Pools can be used to keep track of any miscellaneous numbers you need to. For example WoodSkin results or Burning Vigor pools.">
              <div class="sheet-headerbar" >
                <input name="attr_Misc-PoolName-3" type="text" placeholder="Name" class="sheet-w100p sheet-headerbar" title="@{Misc-PoolName-3}:   You can use these to keep track of anything you want. Enter the name of what you are tracking here." >
              </div>
              <div>
                <input name="attr_Misc-PoolValue-3" type="number" placeholder="0" class="sheet-Big sheet-HideSpinners" title="@{Misc-PoolValue-3}:   You can use this number to keep track of anything you want." >
              </div>
              <div>
                <input name="attr_Misc-PoolMax-3" type="number" placeholder="0" class="sheet-small sheet-HideSpinners" title="@{Misc-PoolMax-3}:   You can use this number to keep track of anything you want." >
              </div>
            </div>
          </div>    <!-- end Misc - Movement & Misc Pools-->
        </div>    <!--************************** End of Miscellaneous Section **********************-->

        <div class="sheet-section sheet-section-gear"></div>    <!--  End of Section Gear  -->





              <!-- ****************************** Start of Notes Section ******************************* -->
        <div class="sheet-section sheet-section-notes sheet-section-core sheet-section-combat">
                <!--Notes Header-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-HideIfOverview sheet-HideIfCombat">
            <div class="sheet-HideIfPrint">
              <label title="@{attr_tab9-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-attrib-view" value="1" class="sheet-iconcheckbox" ><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab9-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab9-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab9-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>  Notes <div></div>
          </div>
                <!-- Notes - Age and Stuff-->
          <div class="sheet-content sheet-HideIfCombat sheet-HideIfCreature">
            <span class="sheet-label sheet-nowrap"> Age:&nbsp;
              <label title="@{Age}:   Characters Age.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Age" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Age" class="sheet-autoexpand">
                  </span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Sex:&nbsp;
              <label title="@{Sex}:   Characters Sex.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Sex" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Sex" class="sheet-autoexpand"></span>
                </span>
              </label>

              <label title="@{Height}:   Characters Height.">Height:&nbsp;
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Height" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Height" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Weight:&nbsp;
              <label title="@{Weight}:   Characters Weight.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Weight" type="text" class="sheet-bordered-bottom">
                  <span name="attr_Weight" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Hair:&nbsp;
              <label title="@{Hair}:   Characters Hair color and style.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Hair" type="text" class="sheet-bordered-bottom"> <span name="attr_Hair" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Eyes:&nbsp;
              <label title="@{Eyes}:   Characters Eye color and shape.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Eyes" type="text" class="sheet-bordered-bottom"> <span name="attr_Eyes" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
            <span class="sheet-label sheet-nowrap"> Skin:&nbsp;
              <label title="@{Skin}:   Characters Skin description.">
                <span class="sheet-autoexpand-wrap">
                  <input name="attr_Skin" type="text" class="sheet-bordered-bottom"> <span name="attr_Skin" class="sheet-autoexpand"></span>
                </span>
              </label>
            </span>
                  <!-- Notes - Status -->
            <div class="sheet-HideIfNotPC sheet-NotCreation">
              <span class="sheet-label sheet-nowrap"> Lgd Status:&nbsp;
                <label title="@{LP-Status}:   Legendary Status level.">
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Status" value="LP up to 10,000" readonly="readonly"
                    type="text">
                    <span name="attr_LP-Status" class="sheet-autoexpand">
                    </span>
                  </span>
                </label>
              </span>
              <span class="sheet-label sheet-nowrap"> Renown:&nbsp;
                <label title="@{LP-Renown}:   Base Difficulty Number on knowledge tests to recognize name.">
                  <span class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Renown" value="16" readonly="readonly" type="text">
                    <span name="attr_LP-Renown" class="sheet-autoexpand"></span>
                  </span>
                </label>
              </span>
              <span class="sheet-label sheet-nowrap"> Reputation:&nbsp;
                <label title="@{LP-Reputation}:   Bonus on some Interaction tests.">
                  <span
                    class="sheet-autoexpand-wrap">
                    <input name="attr_LP-Reputation" value="NA" readonly="readonly" type="text">
                    <span name="attr_LP-Reputation" class="sheet-autoexpand">
                    </span>
                  </span>
                </label>
              </span>
            </div>
          </div>    <!-- end Notes - Age and Stuff-->

                <!--Notes - Personality-->
          <div class="sheet-HideIfCombat sheet-flex-container sheet-HideIfNotPC sheet-content"> <!--JBF@JBF to be put back in creation-->
            <datalist id="personality_traits">
              <option value="Aggressive"></option>
              <option value="Aloof"></option>
              <option value="Altruistic"></option>
              <option value="Ambitious"></option>
              <option value="Amoral"></option>
              <option value="Apprehensive"></option>
              <option value="Argumentative"></option>
              <option value="Astute"></option>
              <option value="Attentive"></option>
              <option value="Bloodthirsty"></option>
              <option value="Bold"></option>
              <option value="Charismatic"></option>
              <option value="Chivalrous"></option>
              <option value="Cold"></option>
              <option value="Compassionate"></option>
              <option value="Compassionless"></option>
              <option value="Condescending"></option>
              <option value="Confident"></option>
              <option value="Conniving"></option>
              <option value="Conservative"></option>
              <option value="Courageous"></option>
              <option value="Courteous"></option>
              <option value="Cowardly"></option>
              <option value="Creative"></option>
              <option value="Cruel"></option>
              <option value="Cunning"></option>
              <option value="Curious"></option>
              <option value="Cynical"></option>
              <option value="Depraved"></option>
              <option value="Dignified"></option>
              <option value="Disciplined"></option>
              <option value="Dishonest"></option>
              <option value="Drunkard"></option>
              <option value="Easy-going"></option>
              <option value="Eloquent"></option>
              <option value="Energetic"></option>
              <option value="Extroverted"></option>
              <option value="Fanatical"></option>
              <option value="Follower"></option>
              <option value="Forgiving"></option>
              <option value="Friendly"></option>
              <option value="Generous"></option>
              <option value="Good-humored"></option>
              <option value="Gracious"></option>
              <option value="Greedy"></option>
              <option value="Gullible"></option>
              <option value="Honorable"></option>
              <option value="Humorless"></option>
              <option value="Idealistic"></option>
              <option value="Immature"></option>
              <option value="Immoral"></option>
              <option value="Insightful"></option>
              <option value="Insulting"></option>
              <option value="Intellectual"></option>
              <option value="Intense"></option>
              <option value="Intimidating"></option>
              <option value="Intolerant"></option>
              <option value="Introverted"></option>
              <option value="Intuitive"></option>
              <option value="Irrational"></option>
              <option value="Jealous"></option>
              <option value="Judgmental"></option>
              <option value="Kind"></option>
              <option value="Lazy"></option>
              <option value="Liar"></option>
              <option value="Logical"></option>
              <option value="Loner"></option>
              <option value="Loyal"></option>
              <option value="Lustful"></option>
              <option value="Malcontent"></option>
              <option value="Manipulative"></option>
              <option value="Militant"></option>
              <option value="Miserly"></option>
              <option value="Mocking"></option>
              <option value="Moral"></option>
              <option value="Naive"></option>
              <option value="Obsessive"></option>
              <option value="Opinionated"></option>
              <option value="Optimistic"></option>
              <option value="Overbearing"></option>
              <option value="Paranoid"></option>
              <option value="Passionate"></option>
              <option value="Patient"></option>
              <option value="Persuasive"></option>
              <option value="Pragmatic"></option>
              <option value="Protective"></option>
              <option value="Proud"></option>
              <option value="Rational"></option>
              <option value="Reactionary"></option>
              <option value="Realistic"></option>
              <option value="Reasonable"></option>
              <option value="Rebellious"></option>
              <option value="Reserved"></option>
              <option value="Resourceful"></option>
              <option value="Rude"></option>
              <option value="Sadistic"></option>
              <option value="Sarcastic"></option>
              <option value="Selfish"></option>
              <option value="Sensitive"></option>
              <option value="Sentimental"></option>
              <option value="Shrewd"></option>
              <option value="Spontaneous"></option>
              <option value="Superstitious"></option>
              <option value="Suspicious"></option>
              <option value="Sympathetic"></option>
              <option value="Treacherous"></option>
              <option value="Vengeful"></option>
              <option value="Witty"></option>
            </datalist>
            <div>
              <b class="sheet-label"> Personality traits :</b>
            </div>
            <fieldset class="repeating_personality">
              <!-- <input name="attr_PER_RowID" type="hidden" class="sheet-testRowID" value=""><span></span> -->
              <span class="sheet-nowrap">
                <input list="personality_traits" type="text" name="attr_PER_personality" class="sheet-txtShort sheet-bordered-bottom text-left" title="@{repeating_personality_X_PER_traits}: Flesh Out your character by chosing (or definind your own) one or several personality traits to play upon. Consult ED4 PG p.74. Traits can be Hidden and Surface Traits. GM may award additional LP if you roleplay your traits.">
              </span>
            </fieldset>
          </div>

                <!--Notes - NPC Attitude-->
          <div class="sheet-HideIfPC">
            <b class="sheet-label"> Attitude :</b>
            <select name="attr_NPC_Attitude" class="sheet-txtMed" title="@{NPC_Attitude}   Attitude of the NPC towards the players">
              <option value="0.0" title="Enemy">Enemy</option>
              <option value="1.0" title="Hostile">Hostile</option>
              <option value="2.0" title="Unfriendly">Unfriendly </option>
              <option value="3.0" selected="selected" title="Neutral">Neutral </option>
              <option value="4.0" title="Friendly">Friendly</option>
              <option value="5.0" title="Loyal">Loyal</option>
              <option value="6.0" title="Awestruck">Awestruck</option>
            </select>
          </div>

                <!--Notes - Custom Notes-->
          <div class="sheet-HideIfOverview sheet-HideIfCombat"> <!--JBF@JBF to be managed for Creation-->
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center"> <!--sheet-background-frame6 sheet-frameBig deleted-->
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes_max" placeholder="Notes" type="text"></div>
              <div class=""><textarea name="attr_general-notes" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"   placeholder="Your notes here. Customize the title (loot, bio, description, allies...). Also displayed in Overview and Combat Tab." title="@{general-notes} : Your notes here. Customize the title (loot, bio, description, allies...). Also displayed in Overview and Combat Tab."></textarea></div>
            </span>
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center">
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes-2_max" placeholder="Description" type="text" ></div>
              <div class=""><textarea name="attr_general-notes-2" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"  placeholder="Your notes here. Customize the title (loot, bio, description, allies...)" title="@{general-notes-2} : Your notes here. Customize the title (loot, bio, description, allies...)."></textarea></div>
            </span>
            <span class="sheet-notes sheet-nowrap0 sheet-w30 sheet-text-center">
              <div class="sheet-headerbar"><input class="sheet-headerbar" name="attr_general-notes-3_max" placeholder="General" type="text"></div>
              <div class=""><textarea name="attr_general-notes-3" class="sheet-text-left sheet-w30 sheet-bordered sheet-content sheet-details-big"  placeholder="Your notes here. Customize the title (loot, bio, description, allies...)" title="@{general-notes-3} : Your notes here. Customize the title (loot, bio, description, allies...)."></textarea></div>
            </span>
          </div>

          <!--Notes -Copyright-->
          <div style="font-size: xx-small;" class="sheet-HideIfOverview sheet-HideIfCombat sheet-ShowIfObject">
            <em>Earthdawn&reg; by FASA</em> Character sheet and associated API.<br>
            Earthdawn&reg; is the sole property of FASA Corporation, and is protected by copyright, trademark, and other intellectual property laws.
            You are granted a limited, revocable, non-sub-licensable right to access and use this character sheet and associated API solely for personal and non-commercial use.
            This character sheet is compatible with the Earthdawn&reg; game from FASA Games, Inc. and the Roll20 Earthdawn&reg; Compendium (Forthcoming).
            Any information copied into this character sheet maintains its original sources copyright, whether it was copied from the Compendium, or copied or typed in by the user, or by any other means.<br>
            Any use of FASA Games, Inc.s Intellectual Property other than as specifically authorized by FASA Games, Inc. is strictly prohibited and will terminate the rights granted herein.<br>
            Earthdawn&reg; is a registered trademark of FASA Corporation. Earthdawn&reg; and all associated trademarks, copyrights, and logos are used under license from FASA Corporation.  Copyright &copy; 1993-2020 FASA Corporation<br>
            Roll20 character sheet & API by Christopher D. Dickey and Jean-Baptiste Faure. Approved by FASA.
          </div>
        </div>    <!-- ***************** End of Section Notes *************** -->



              <!-- *************************************** Mini Section Notes for Overview ********************** -->
        <div class="sheet-section sheet-section-core sheet-section-combat sheet-w100p sheet-ShowIfObject">
          <div class="sheet-nowrap0 sheet-w100p sheet-text-center sheet-ShowIfObject" >
            <div class="sheet-headerbar sheet-ShowIfObject"><input class="sheet-headerbar" name="attr_general-notes_max" placeholder="General" type="text"></div>
            <div class=" sheet-ShowIfObject"><textarea name="attr_general-notes" class="sheet-text-left sheet-bordered sheet-content sheet-details"  title="@{general-notes} Your notes here. Customize the title (loot, bio, description, allies...)" placeholder="Notes 1"></textarea></div>
          </div>
          <div class="sheet-Creation sheet-headerbar sheet-api sheet-ShowIfObject"> <b class="sheet-creation-order  sheet-HideIfCreature">9-</b> <b class="sheet-creation-order  sheet-HideIfNotCreature">5-</b> Link your Token </div>
          <div class="sheet-Creation sheet-text-center sheet-api sheet-small sheet-ShowIfObject">
            With the API, most of the functions of the sheet can be accessed directly from the Token on the map. Karma, Damage and Wounds appear as bars, status and options, and general modifiers appear as markers icons on the token, and your most common actions appear as Token Action buttons when the token is selected.
            In order for those functions to work properly, you need to link the character sheet with a token on the map, by selecting this token, and pressing the button below
            <br>
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="roll_TokenLink" type="roll"
            value="!Earthdawn~ charID: @{character_id}~ LinkToken: ?{Standard both sets the token to display in the standard way and links the token|Standard|SetTokenOnly|LinkOnly}"
            title="Clicking this button will Link this Character with the selected Token on the map."> Link Token</button>
          </div>
          <div class="sheet-Creation sheet-headerbar sheet-HideIfNotCreature">
             <b class="sheet-creation-order sheet-NoAPI">5-</b>
             <b class="sheet-creation-order sheet-api">6-</b>
              Play the Game !
          </div>
          <div class="sheet-Creation sheet-headerbar sheet-HideIfCreature">
             <b class="sheet-creation-order sheet-NoAPI">9-</b>
             <b class="sheet-creation-order sheet-api">10-</b>
              Play the Game !
          </div>
          <div class="sheet-text-center sheet-Creation ">
            <div class="sheet-small">
              The sheet offers a certain number of optional displays for advanced user or special cases. The default for these displays is set in the Game Default, but you can here override the default to hide/show them all
            </div>
            Optional Displays :
            <button class="sheet-button-nodice sheet-text-button" name="act_setalloptions" type="action"
            title="act_setalloptions:   Clicking this button will set All Options.">
            Show All
            </button>
            <button class="sheet-button-nodice sheet-text-button" name="act_resetalloptions" type="action"
            title="act_resetalloptions:   Clicking this button will reset All Options.">
            Hide All
            </button>
          </div>
          <div class="sheet-sec-spacer"></div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfNotPC">
            If you created the character per the Rules, click here to exit creation and store the Free Ranks for Legend Point Tracking.
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_endcreation_post" type="action"
            title="act_endcreation_post:   Clicking this button will end the creation and set the Legend Points to 0."> Exit and Post Legend Points</button>
            <br>
            Or Here if you just want to exit without saving the LP Offset (you will have to set it manually)
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_endcreation_nopost" type="action"
            title="act_endcreation_post:   Clicking this button will end the creation. It will not set the LP to 0, so you need to manually set the LP-CreationOffset in the Journal so that you start with the right amount of LP.">Exit Without Posting Legend Points</button>
          </div>
          <div class="sheet-Creation sheet-text-center sheet-HideIfPC">
            <button class="ui-draggable sheet-button-nodice sheet-text-button" name="act_endcreation_nopost" type="action"
            title="act_endcreation_post:   Clicking this button will end the creation. It will not set the LP to 0, so you need to manually set the LP-CreationOffset in the Journal so that you start with the right amount of LP.">Exit Creation</button>
          </div>
        </div>    <!-- ************** End Mini Section ************** -->



              <!-- ****************************** Start of Section Record (renamed Legend) ********************************* -->
        <div class="sheet-section sheet-section-record">
                <!--Record - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex">
            <div>
              <label title="@{attr_tab10-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab10-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab10-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab10-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Legend
             <div>
              <label title="@{attr_legend-param-mode} : Toggles the view of parameters that affect the Legend Section.">
                <input type="checkbox" name="attr_legend-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
              </label>
              <span class="sheet-info" title="Instructions: This section is for your Legend Points and Silver Pieces Journal. The sheet offers you 2 options to record the LP in your Journal. You can use one or the other or a combination of both. In the CALCULATED MODE, you only have to record your Career Legend Points @{LP-Total}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information. In the TRANSACTION MODE, your Career and Current points can be edited. The Current is stored in a separated @{LP-Current} field. You track your LP/SP by Posting transactions in your journal. Transaction can be a Legend Award at the end of an Adventure, or the cost of increasing a Talent Rank. The API will automatically propose you to post some of the transactions. Refer to the tooltip in the TRANSACTION MODE.">i</span>
            </div>
          </div>

                <!-- Record - Mode Selection -->
          <input type="checkbox" name="attr_legend-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
          <div class="sheet-HideIfNotCloseChecked sheet-bordered">
            <div class="sheet-text-centered"><b class="sheet-heading"> Legend Parameters</b></div>
            <span class="sheet-nowrap sheet-label">
              Display - Calculated Mode :
              <input type="checkbox" name="attr_legend-calc-mode" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
            </span>
            <span class="sheet-nowrap sheet-label">
              Transaction Mode :
              <input type="checkbox" name="attr_legend-transaction-mode" checked value="1" title="@{legend-transaction-mode} : Toggle to display TRANSACTION Mode LP Tracking. In the TRANSACTION MODE, your Career and Current points can be edited. The Current is stored in a separated @{LP-Current} field. You track your LP/SP by Posting transactions in your journal. Transaction can be a Legend Award at the end of an Adventure, or the cost of increasing a Talent Rank. The API will automatically propose you to post some of the transactions. Refer to the tooltip in the TRANSACTION MODE.">
            </span>
            <div>
              Optional Displays :
              <button class="sheet-button-nodice sheet-text-button" name="act_setalloptions" type="action"
              title="act_setalloptions:   Clicking this button will set All Options.">
              Set All
              </button>
              <button class="sheet-button-nodice sheet-text-button" name="act_resetalloptions" type="action"
              title="act_resetalloptions:   Clicking this button will reset All Options.">
              Reset All
              </button>
            </div>
          </div>
          <div>
            <span class="sheet-nowrap" >
              <span class="sheet-iconstatic sheet-icon-coin-gold" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers"></span>:
              <input name="attr_Wealth_Gold"   type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers">
              <span class="sheet-iconstatic sheet-icon-coin-silver" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers"></span>:
              <input name="attr_Wealth_Silver" type="number" value="100" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers. New Characters start with 100.">
              <span class="sheet-iconstatic sheet-icon-coin-copper" title="@{Wealth_Copper}:   Number of Copper pieces owned."></span>:
              <input name="attr_Wealth_Copper" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Copper}:   Number of Copper pieces owned.">
            </span>
          </div>

                <!--Record - Calculated Mode-->
          <input type="checkbox" name="attr_legend-calc-mode" class="sheet-hidden sheet-testCloseChecked" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
          <div class="sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar"> Calculated Legend Point Tracking </div>
            <div class="sheet-content">
              <span class="sheet-nowrap1" title="@{LP-Total}:   Accumulated sum of all Legend Points ever earned."> <b class="sheet-label">Legend Points - Total :</b>
                <input name="attr_LP-Total" value="0" class="sheet-selLong" type="number">
              </span>
              <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
              <span class="sheet-HideIfNotCloseChecked">
                <span class="sheet-nowrap1" title="@{LP-CreationOffset}:  Free Legend Points for Creation, i.e. corresponding to the 8 Talents Ranks, 13 Skill Ranks and Free Spells Granted at Creation. Value should range somewhere between between 3000 and 6000 LP depending on initial spread of Ranks. An advice to quickly calculate the value, if you didn't spend any LP on skills, is to take the skills LP total from the checksum below and add 1000. You can also just set the value once to have your checksum correct, and then verify that the checksum remains correct">  <b class="sheet-label">+ Creation :</b>
                  <input name="attr_LP-CreationOffset" type="number" value="0" class="sheet-selShort"  >
                </span>
                <input name="attr_LP-SpellsOption" type="checkbox" value="1" checked class="sheet-hidden sheet-testCloseChecked">
                <span class="sheet-nowrap1 sheet-HideIfChecked sheet-HideIfNotCloseChecked" title="@{LP-CreationOffset-Spells}:  Free Legend Points for Creation only for Free Spells Granted at Creation.">  <b class="sheet-label">+ Spells :</b>
                  <input name="attr_LP-CreationOffset-Spells" type="number" value="0" class="sheet-selShort"  >
                </span>
                <span class="sheet-nowrap1" title="@{LP-Calc}:  Automatically calculated LP Cost taking into account all the purchased ranks as per the rules.">
                  <b class="sheet-label">- Cost :</b>
                  <input name="attr_LP-Calc" type="number" value="0" readonly class="sheet-selShort"  >
                  <b class="sheet-label">=</b>
                </span>
              </span>
              <span class="sheet-nowrap1 sheet-label" title="@{LP-Current-Calc}: Automatically calculated total of all legend points taking into account all the purchased ranks as per the rules, current LPs, and offset for the creation. If you initialized the LP-Creation correctly, and always recorded your talents, this should always show your current career total">
                Current Calc :
                <input name="attr_LP-Current-Calc" type="number" value="0" class="sheet-selShort" readonly >
              </span>
              <label title="@{LP_ShowNotes}   Shows the details of the calculation of the LP-Summary-Value">
                <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
              </label>
              <span class="sheet-info" title="In the CALCULATED MODE, you only have to record your Career Legend Points @{LP-Total}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. If the character was created via a sheet of version 2.0 and later, at the end of the creation mode, the @{LP-CreationOffset} will be stored automatically. For a character that was not created at Circle 1 via the sheet, you can just set @{LP-CreationOffset} to get the Current LP that you have been tracking up to now. Note that even if using Calculated Mode, you could still use the transaction posting for your Legend Awards">i</span>
              <input type="checkbox" name="attr_T_LP_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
              <div class="sheet-HideIfNotCloseChecked">
                <div class="sheet-small">
                  The Calculated Mode needs to offset the calculation by the LP equivalent of the free Talents, Skills and Spells at creation. If the character has been imported from older version or if there has been an issue at creation, you may need to set manually the Offset. Click the following button to reset the Creation offset so that Current calculated value matches the Current value from Transaction modes. Note that for Spellcaster this will be dependant on the option for Spells Costs. Set the option first.
                </div>
                <div>
                <span class="sheet-nowrap1" title="@{LP-AttribOption}:  Toggle this value for Houserule where Attributes do not cost LP.">
                  <b class="sheet-label">Attributes
                  <select name="attr_LP-AttribOption" class="sheet-selShort">
                    <option value="1" selected title="Core Rule - Spells do cost LP"> do </option>
                    <option value="0" title="Homerule - Spells do not cost LP"> don't </option>
                  </select>
                    cost LP
                  </b>
                </span>
                <input name="attr_Hide-Spells-Tab" type="checkbox" value="1" checked class="sheet-hidden sheet-testCloseChecked">
                <span class="sheet-nowrap1 sheet-HideIfCloseChecked" title="@{LP-SpellsOption}:  Toggle this value for Houserule where Spells do not cost LP.">
                  <b class="sheet-label">Spells
                  <select name="attr_LP-SpellsOption" class="sheet-selShort">
                    <option value="1" selected title="Core Rule - Spells do cost LP"> do </option>
                    <option value="0" title="Homerule - Spells do not cost LP"> don't </option>
                  </select>
                    cost LP
                  </b>
                </span>
              </div>
              <div class="sheet-nowrap1">
                <b class="sheet-label">Extra Cost :
                <input name="attr_LP-Extra-Cost" type="number" class="sheet-numLong" value="0" title="@{LP-Extra-Cost}:  Manual Cost to the Automatic Calculation. Can be used in partical for an edge case not taken into account by the calculation : a Talent Option in a first discipline that becomes a Discipline Talent in a second, will free the talent option slot, and the costs for increasing this talent will become the one of the second discipline... The Automatic Calculation will calculate as if all rank had been bought as per declared Origin, so there may be need for manual offset to correct this case. ">

                </b>
              </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc">
                  <b class="sheet-label">2nd Discipline was started when lowest circle was
                  <input name="attr_LP-D2-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D2-Circle}:  Lowest Circle when the character joined a 2nd discipline. PG456">
                  </b><b class="sheet-label">and
                    <input name="attr_LP-D2-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D2-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc">
                  <b class="sheet-label">3rd Discipline was started when lowest circle was
                  <input name="attr_LP-D3-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D3-Circle}:  Lowest Circle when the character joined a 3rd discipline. PG456">
                    </b><b class="sheet-label">and
                    <input name="attr_LP-D3-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D3-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <div class="sheet-nowrap1 sheet-HideIfZeroDisc sheet-HideIfOneDisc sheet-HideIfTwoDisc sheet-HideIfThreeDisc">
                  <b class="sheet-label">4th Discipline was started when lowest circle was
                  <input name="attr_LP-D4-Circle" type="number" class="sheet-numShort" min="1" max="15" value="5" title="@{LP-D4-Circle}:  Lowest Circle when the character joined a 4th discipline. PG456">
                    </b><b class="sheet-label">and
                    <input name="attr_LP-D4-Talents" type="number" class="sheet-numShort" min="1" max="15" value="0" title="@{LP-D4-Talents}:  Number of Discipline Talents purchased at Rank 1 to multi-discipline. PG456">
                    </b><b class="sheet-label">Discipline Talents had to be purchased at Rank 1
                  </b>
                </div>
                <button class="sheet-text-button sheet-button-nodice sheet-hideIfPlaceholder" name="act_set_lp_offset" type="action" title="Set Creation Offset so that Current calculated matches the Transactions mode">Set Creation Offset</button>
                <textarea name="attr_LP-Summary"  class="sheet-text-left sheet-HideIfPrint sheet-details-big" title="@{LP-Summary}   Automatically Calculated Report of your LP Costs."></textarea>
              </div>
            </div>
          </div>    <!-- end Record - Calculated Mode -->

                <!-- Record - Transaction Mode -->
          <input type="checkbox" name="attr_legend-transaction-mode" class="sheet-hidden sheet-testCloseChecked" checked value="1" title="@{legend-calc-mode} : Toggle to display CALCULATED Mode LP Tracking. In the CALCULATED MODE, you only have to record your Career Legend Points @{Career-LP}. Based on all your Rank values and Attribute improvements, the system will fill your Calculated Current Legend Points @{LP-Current-Calc}. Note that the system needs to know the ranks you spent for free at creation. Refer to the info in the CALCULATED MODE for more information.">
          <div class="sheet-HideIfNotCloseChecked">
            <div class="sheet-headerbar"> Transaction Legend Point Tracking </div>
            <div class="sheet-content">
              <span class="sheet-nowrap1" title="@{LP-Total}:   Accumulated sum of all Legend Points ever earned."><b class="sheet-label">Legend Points - Total :</b>
                <input name="attr_LP-Total" value="0" class="sheet-selLong" type="number">
              </span>
              <span class="sheet-nowrap1 sheet-label" title="@{LP-Current}:   Unspent Legend Points.">  Current :
                <input name="attr_LP-Current" type="number" value="0" class="sheet-selShort"  >
              </span>
              <span class="sheet-info" title="Instructions: In the TRANSACTION MODE, you use journal entries to record any transaction such as Legend Awards at the end of a Game, or the costs for increasing a Talent Rank. Note that standard Building Your Legend transactions, such as increasing Talent Ranks, Attributes, or Weaving Threads to items will be automatically detected by the API and sent to Roll20 chat to Record the transaction. Note that you can use the CALCULATED Mode, as a checksum to be sure that no transaction was forgotten in your journal">i</span>
            </div>
          </div>    <!-- end Record - Transaction Mode -->

                <!-- Record - Journal -->
          <div class="sheet-HideIfPrint">
            <div class="sheet-headerbar"> Journal Entries </div>
            <div class="sheet-content">
              <input class="sheet-testRecord" name="attr_record-item" value="LPSP" type="hidden">
              <span class="sheet-info" title="Instructions: This section is for your Legend Points and Silver Pieces Journal. Record here any transaction such as Legend Awards at the end of a Game. Record the transaction by chosing LP/SP, filling the amount, type of transaction, and filling the reason and date.
              Due to restrictions in Roll20 be sure to click outside of the Reason text box before clicking on Post. Note that standard Building Your Legend transactions, such as increasing Talent Ranks, Attributes, or Weaving Threads to items will be automatically detected and sent to Roll20 chat to Record the transaction..">i</span>
              <span class="sheet-nowrap2" title="@{record-date-throalic}:   Throalic date."><b class="sheet-label">Date Throalic: </b>
                <input name="attr_record-date-throalic" type="text" value="" class="sheet-txtShort" >
              </span>
              <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_update_dates" type="roll"
              value="!Earthdawn~ charID: @{character_id}~ updateDates : @{Party|record-date-throalic}" >Update Dates</button>
              <br>
              <b class="sheet-label">Transaction</b>
              <span class="sheet-nowrap" title="@{record-item}  Are we journaling a silver or LP transaction?">
                <select name="attr_record-item" class="sheet-selShort">
                  <option value="LPSP" selected title="Legend Points and Silver Pieces at the same time."> LP&amp;SP</option>
                  <option value="LP" title="Legend Points."> LP</option>
                  <option value="SP" title="Silver Pieces."> SP</option>
                  <option value="Other" title="Other."> Other</option>
                </select>
              </span>
              <b class="sheet-HideIfOther sheet-label">Amount :</b>
              <span class="sheet-nowrap sheet-HideIfSP sheet-HideIfOther sheet-label" title="@{record-amount-LP}:   Amount of Legend Points in this transaction.">LP:
                <input name="attr_record-amount-LP" type="number" value="0" class="sheet-selShort" >
              </span>
              <span class="sheet-nowrap sheet-HideIfLP sheet-HideIfOther sheet-label" title="@{record-amount-SP}:   Amount of Silver Pieces in this transaction.">SP:
                <input name="attr_record-amount-SP" type="number" value="0" class="sheet-selShort" >
              </span>
              <span class="sheet-nowrap sheet-HideIfOther" title="@{record-type}  Are we journaling a gain or a expenditure?">
                <select name="attr_record-type" class="sheet-selShort">
                  <option value="Gain" selected title="Gain. For LP will apply to both Career and Current."> Gain</option>
                  <option value="Spend"         title="Spend. For LP will apply only to Current without affecting Career."> Spend</option>
                  <option value="Decrease"      title="Decrease: Use this to undo a mistaken Gain .For LP will apply to both Career and Current."> Decrease</option>
                  <option value="Refund"        title="Refund: Use this to undo a mistaken Spend.For LP will apply only to Current without affecting Career."> Refund</option>
                </select>
              </span>
              <span class="sheet-nowrap2">
                <input name="attr_record-reason" type="text" style="width:20em;" class="sheet-text-left"
                title="@{record-reason}:   Detailed description of the transaction."
                placeholder="Description of transaction or other notes." >
              </span>
              <input name="attr_record-reason" type="text" class="sheet-hidden sheet-testPlaceholder"
              placeholder="Description of transaction or other notes." >
              <button class="sheet-text-button sheet-button-nodice sheet-hideIfPlaceholder" name="act_post_update" type="action" title="Post a transaction">Post</button>

              <textarea name="attr_record-journal"  class="sheet-text-left sheet-HideIfPrint sheet-details-big" title="@{record-journal}   Record things here such as LP and Silver awards and expenditures."></textarea>
            </div>
          </div>    <!-- end Record - Journal -->
        </div>    <!-- ************************  End of Section Record ******************  -->



                <!-- ***************************************** Section Equipment*************************************  -->
                <div class="sheet-section sheet-section-equipment sheet-PrintNoBreak">
                  <div class="sheet-flex-container">
                    <input name="attr_show_repeating_step_dice" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption5">

                    <!-- Equipment - Left Pane -Sub-Section Equipment -->
              <div class="sheet-bordered sheet-w100p">
                      <!--Equipment - Right Pane - Header-->
                <div class="sheet-headerbar sheet-headerbar-flex">
                  <div>
                    <label title="@{attr_tab7-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                      <input type="checkbox" name="attr_tab7-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                    </label>
                    <label title="@{attr_tab7-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                      <input type="checkbox" name="attr_tab7-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                    </label>
                    <label title="@{attr_tab7-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                      <input type="checkbox" name="attr_tab7-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
                    </label>
                  </div>

                  Equipment
                  <div class="sheet-floatRight">
                    <label title="@{attr_equipment-param-mode} : Toggles the view of parameters that affect the Equipment Section.">
                      <input type="checkbox" name="attr_equipment-param-mode" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-white sheet-icon-parameter-white"></span>
                    </label>
                    <label title="@{attr_equipment-edit-mode} : Toggles the edit mode .">
                      <input type="checkbox" name="attr_equipment-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                    </label>
                  </div>
                </div>

                      <!--**************************  Start of Section Core & Combat parameters -->
                <input type="checkbox" name="attr_equipment-param-mode" value="1" class="sheet-hidden sheet-testCloseChecked">
                <div class="sheet-section sheet-section-equipment sheet-section-combat sheet-HideIfNotCloseChecked sheet-bordered">
                  <div class="sheet-text-centered"><b class="sheet-heading"> Equipment and Inventory Parameters</b></div>
                  <div>
                    <span class="sheet-nowrap sheet-label"> Container Management :
                      <select name="attr_show_container" class="sheet-selShort" title="@{show_container}   Enables the Management of the Inventory per container." >
                        <option selected value="0" >Hide </option>
                        <option value="1" >Show </option>
                      </select>
                    </span>
                  </div>
                  <div>
                    <span class="sheet-nowrap sheet-label"> Blood Magic :
                      <select name="attr_show_blood" class="sheet-selShort" title="@{show_blood}   Enables the Management of Blood Charms." >
                        <option selected value="0" >Hide </option>
                        <option value="1" >Show </option>
                      </select>
                    </span>
                  </div>
                  <div>
                    <span class="sheet-nowrap sheet-label"> Mounts & Companions :
                      <select name="attr_show_mounts" class="sheet-selShort" title="@{show_mounts}   Enables the Management of Mounts and Companions." >
                        <option selected value="0" >Hide </option>
                        <option value="1" >Show </option>
                      </select>
                    </span>
                  </div>
                  <div>
                    <span class="sheet-nowrap sheet-label"> LifeStyle :
                      <select name="attr_show_lifestyle" class="sheet-selShort" title="@{show_lifestyle}   Enables the Management of Lifestyle." >
                        <option selected value="0" >Hide </option>
                        <option value="1" >Show </option>
                      </select>
                    </span>
                  </div>
                  <div>
                    Optional Displays :
                    <button class="sheet-button-nodice sheet-text-button" name="act_setalloptions" type="action"
                    title="act_setalloptions:   Clicking this button will set All Options.">
                    Set All
                    </button>
                    <button class="sheet-button-nodice sheet-text-button" name="act_resetalloptions" type="action"
                    title="act_resetalloptions:   Clicking this button will reset All Options.">
                    Reset All
                    </button>
                  </div>
                </div>    <!--end Core & Combat parameters -->

                      <!--Equipment - Right Pane - Armor & Weapons-->
                <div class="sheet-content">
                  <datalist id="armor">
                    <option value="Blood Pebble"></option>
                    <option value="Chain Mail"></option>
                    <option value="Crystal Plate"></option>
                    <option value="Crystal Ringlet"></option>
                    <option value="Espagra Cloak"></option>
                    <option value="Fernweave"></option>
                    <option value="Hardened Leather"></option>
                    <option value="Hide Armor"></option>
                    <option value="Leather"></option>
                    <option value="Living Crystal"></option>
                    <option value="Obsidiman Skin"></option>
                    <option value="Padded Cloth"></option>
                    <option value="Padded Leather"></option>
                    <option value="Plate Armor"></option>
                    <option value="Ring Mail"></option>
                    <option value="Wyvern Skin"></option>
                    <option value="Bark"></option>
                    <option value="CrystalWeave"></option>
                    <option value="Stone Disk"></option>
                    <option value="Stone Net"></option>
                    <option value="Trim Wood"></option>
                    <option value="Wood Tile"></option>
                    <option value="Living Metal"></option>
                    <option value="Oathshar"></option>
                  </datalist>
                  <datalist id="shield">
                    <option value="Body"></option>
                    <option value="Buckler"></option>
                    <option value="Crystal Buckler"></option>
                    <option value="Crystal Raider"></option>
                    <option value="Ferndask"></option>
                    <option value="Footmans"></option>
                    <option value="Riders"></option>
                  </datalist>
                  <datalist id="weapons">
                    <!--PG from compendium-->
                    <option value="Battle Axe"></option>
                    <option value="Blowgun"></option>
                    <option value="Bola"></option>
                    <option value="Broadsword"></option>
                    <option value="Club"></option>
                    <option value="Dagger"></option>
                    <option value="Dart"></option>
                    <option value="Dwarf Sword"></option>
                    <option value="Elven Warbow"></option>
                    <option value="Flail"></option>
                    <option value="Flight Dagger"></option>
                    <option value="Hand Axe"></option>
                    <option value="Hawk Hatchet"></option>
                    <option value="Knife"></option>
                    <option value="Lance"></option>
                    <option value="Light Crossbow"></option>
                    <option value="Longbow"></option>
                    <option value="Long Spear"></option>
                    <option value="Mace"></option>
                    <option value="Medium Crossbow"></option>
                    <option value="Net, Large"></option>
                    <option value="Net, Small"></option>
                    <option value="Pole Arm"></option>
                    <option value="Pole Axe"></option>
                    <option value="Quarterstaff"></option>
                    <option value="Sap"></option>
                    <option value="Scythan Axe"></option>
                    <option value="Short Sword"></option>
                    <option value="Shortbow"></option>
                    <option value="Sling"></option>
                    <option value="Spear"></option>
                    <option value="Spiked Mace"></option>
                    <option value="Throwing Axe"></option>
                    <option value="Throwing Dagger"></option>
                    <option value="Trispear"></option>
                    <option value="Troll Axe"></option>
                    <option value="Troll Sling"></option>
                    <option value="Troll Sword"></option>
                    <option value="Two-Handed Sword"></option>
                    <option value="Warhammer"></option>
                    <option value="Whip"></option>
                    <option value="Windling Bow"></option>
                    <option value="Windling Net"></option>
                    <option value="Windling Polearm"></option>
                    <option value="Windling Spear"></option>
                    <option value="Windling Sword"></option>

                  </datalist>


                  <input type="checkbox" name="attr_equipment-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                        <!--Equipment - Right Pane - Armor Titles-->
                  <span class="sheet-fixed-width sheet-w25px"></span>
                  <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-text-center sheet-titlespan">Armor/Shield</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">Phys</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">Myst</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan">IP</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan sheet-HideIfPrint">Equip</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-titlespan sheet-HideIfPrint sheet-HideIfNotEditMode">Piece</b>


                        <!--Equipment - Right Pane - Armor-->
                        <fieldset class="repeating_armor">
                          <input name="attr_ARM_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                          <!--Type_max holds the value to know if the equiment is equipped. Show only the equipped equipment in not Edit Mode-->

                          <input name="attr_ARM_Type_max" type="hidden"  value="2"> <!--Initialization to 2 so that a new line can be detected-->
                          <input  type="checkbox"  value="1" checked class="sheet-combattab sheet-hidden" >
                          <div class="sheet-filter-box">
                            <!--Armor fieldset - Toggle Shield/Armor on the Type-->
                            <span class="sheet-fixed-width sheet-w25px sheet-LockIfNotEditMode" title="@{repeating_armor_X_ARM_Type}   Toggle for Shield or Armor.">
                              <!--Toggle Armor-Shield Mode-->
                              <input type="checkbox" name="attr_ARM_Type" checked value="1" class="sheet-testChecked sheet-hidden">
                              <label class="sheet-HideIfNotChecked" title="@{repeating_armor_X_ARM_Type}   Toggle for Shield or Armor.">
                                <input type="checkbox" name="attr_ARM_Type" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-armor sheet-LockIfNotEditMode"></span>
                              </label>
                              <label class="sheet-HideIfChecked" title="@{repeating_armor_X_ARM_Type}   Toggle for Shield or Armor.">
                                <input type="checkbox" name="attr_ARM_Type" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-shield sheet-LockIfNotEditMode"></span>
                              </label>
                            </span>

                            <!--Armor fieldset - Name-->

                            <span class="sheet-fixed-width sheet-txtMed" title="@{repeating_armor_X_ARM_Name}:   Type of Armor/Shield Used.">
                              <input type="checkbox" name="attr_ARM_Type" checked value="1" class="sheet-testCloseChecked sheet-hidden">
                              <input name="attr_ARM_Name" list="shield" type="text" class="sheet-txtMed sheet-LockIfNotEditMode sheet-HideIfCloseChecked" placeholder="Shield type" >
                              <input name="attr_ARM_Name" list="armor" type="text" class="sheet-txtMed sheet-LockIfNotEditMode sheet-HideIfNotCloseChecked" placeholder="Armor type" >
                            </span>

                            <!--Armor fieldset - Ratings-->

                            <span class="sheet-fixed-width sheet-numLong" title="@{repeating_armor_X_ARM_Phys}:   Physical protection armor/shield provides.">
                              <input name="attr_ARM_Phys" type="number" value="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners">
                            </span>
                            <span class="sheet-fixed-width sheet-numLong" title="@{repeating_armor_X_ARM_Myst}:   Mystic protection shield provides.">
                              <!-- <span class="sheet-iconstatic sheet-icon-MA sheet-HideIfEdition4"></span>
                              <span class="sheet-iconstatic sheet-icon-MD sheet-HideIfNotEdition4"></span> -->
                              <input name="attr_ARM_Myst" type="number" value="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners">
                            </span>
                            <span class="sheet-fixed-width sheet-numLong" title="@{repeating_armor_X_ARM_IP}:   Initiative Penalty of using Armor/Shield.">
                              <input name="attr_ARM_IP" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners">
                            </span>

                            <!--Equipped-->

                            <span class="sheet-fixed-width sheet-numLong sheet-text-center sheet-HideIfPrint" title="@{repeating_armor_X_ARM_Type_max}:   Toggle Armor/Shield Equipped or not.">
                              <input name="attr_ARM_Type_max" type="checkbox" value="1" class="sheet-HideIfNotEditMode sheet-testCloseChecked">
                              <span class="sheet-HideIfNotCloseChecked sheet-HideIfEditMode"> X </span>
                              <input name="attr_ARM_Type_max" type="hidden"  value="2"> <!--Initialization to 2 so that a new line can be detected-->
                            </span>


                            <span class="sheet-fixed-width sheet-numLong sheet-text-center sheet-HideIfPrint sheet-HideIfNotEditMode" title="@{repeating_armor_X_ARM_Piece}:   Toggle if the armor is a piece of a Piecemeal (i.e. several pieces can be stacked).">
                              <input type="checkbox" name="attr_ARM_Type" checked value="1" class="sheet-testCloseChecked sheet-hidden">
                              <input name="attr_ARM_Piece" type="checkbox" value="1" class="sheet-HideIfNotCloseChecked">
                            </span>


                            <!--Armor fieldset - Icons-->

                            <label title="@{show-ARM_details}   Show or Hide the details of item">
                              <input type="checkbox"    name="attr_show-ARM_details" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                            </label>
                            <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                              <!--Compendium Button-->
                              <input type="checkbox" name="attr_ARM_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                              <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_ARM_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                            </span>
                            <input type="checkbox" name="attr_show-ARM_details" value="1" class="sheet-hidden sheet-testChecked">
                            <br>

                            <!--Armor fieldset - Details-->

                            <input name="attr_ARM_Type" type="checkbox" checked value="1" class="sheet-testCloseChecked sheet-hidden">
                            <span class="sheet-nowrap sheet-HideIfCloseChecked sheet-HideIfNotChecked sheet-label" title="@{repeating_armor_X_ARM_IP_max}:   Shatter Threshold of Shield.">Shatter :
                              <input name="attr_ARM_IP_max" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners">
                            </span>

                            <span class="sheet-nowrap sheet-HideIfNotChecked sheet-label" title="@{repeating_armor_X_ARM_Notes}:   Enhancements and Date(s) Armor/Shield was last enchanted/forged.">Notes :
                              <br>
                              <textarea name="attr_ARM_Notes" class="sheet-details-small sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_armor_X_ARM_Date}   Date Shield was last forged." placeholder="Date forged" ></textarea>
                            </span>
                          </div>
                        </fieldset>

                      <div class="sheet-hidden">
                      <input name="attr_Armor-Phys" type="number" >
                      <input name="attr_Armor-Myst" type="number" >
                      <input name="attr_Armor-IP" type="number" >
                      <input name="attr_Shield-Phys" type="number" >
                      <input name="attr_Shield-Myst" type="number" >
                      <input name="attr_Shield-IP" type="number" >
                    </div>



                  <div class="sheet-HideIfNotEditMode">
                    <input name="attr_SizeRestriction" type="checkbox" value="" checked class="sheet-hidden sheet-testCloseChecked">
                    <span class="sheet-label sheet-HideIfCloseChecked">
                      Size Restrictions:
                      <input name="attr_SizeRestriction" type="text" value=""  class="sheet-txtMedplus" readonly title="@{SizeRestriction} : Size Restrictions to Weapons linked to Race (ED4 PG403)">
                    </span>
                  </div>

                        <!--Equipment - Right Pane - Weapon Titles-->
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  <b class="sheet-heading sheet-fixed-width sheet-txtMed sheet-text-center sheet-titlespan sheet-HideIfEditMode">Weapon</b>
                  <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Weapon</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-HideIfEditMode sheet-text-center sheet-titlespan sheet-HideIfPrint">Dmg</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-HideIfNotEditMode sheet-text-center sheet-titlespan sheet-HideIfPrint">Dmg</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfNotCreature">Add SR</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w75px sheet-text-center sheet-titlespan">Step</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w100px sheet-text-center sheet-titlespan sheet-HideIfNotOption5">Dice</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotEditMode">Size</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan">Stn</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan  sheet-HideIfNoKarma sheet-api">Kma</b>
                  <b class="sheet-heading sheet-fixed-width sheet-w30px sheet-text-center sheet-titlespan sheet-HideIfNotQuest sheet-api">DP</b>
                        <!--Equipment - Right Pane - Weapon Fieldset-->
                  <input name="attr_show_repeating_links" type="checkbox" value="1" class="sheet-hidden sheet-testRepOption3">

                  <br>
                  <fieldset class="repeating_weapons">
                    <input name="attr_WPN_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                    <!--Weapon Fieldset - Close Combat-->
                    <span class="sheet-nowrap0" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                      <!--Toggle Range/CC Mode-->
                      <input type="hidden" name="attr_WPN_CloseCombat"  value="1" class="sheet-testCC">
                      <label class="sheet-HideIfCC sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                        <input type="checkbox" name="attr_WPN_CloseCombat" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-attacks sheet-LockIfNotEditMode"></span>
                      </label>
                      <label class="sheet-HideIfRanged sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_CloseCombat}   Toggle for Close Combat or Range.">
                        <input type="checkbox" name="attr_WPN_CloseCombat" value="-1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-attacks-cc sheet-LockIfNotEditMode"></span>
                      </label>

                    </span>
                    <!--Weapon Fieldset - Name & Button-->
                    <span class="sheet-nowrap0 sheet-HideIfEditMode">
                      <button class="sheet-text-button sheet-api" name="roll_WPN_Roll" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ @{RollType} ~ foreach:sct:ust:c~ modValue: ?{Modification|0} ~K-ask: @{KarmaGlobalMode}@{WPN_Karma-Ask}: @{DPGlobalMode}@{WPN_DP-Ask}~ Action: WPN: @{WPN_RowID} "
                      title="@{repeating_weapons_X_WPN_Roll}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
                      <button class="sheet-text-button sheet-NoAPI" name="roll_WPN_Roll-NoAPI" type="roll"
                      value="@{RollType} &{template:default} {{name=@{WPN_Name} Dmg}} {{Step=[[?{Step|@{WPN_Damage}}]] + Bonus Step [[?{Bonus or Karma Step|0}]]}} {{Result=[[ [[floor({?{Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Step}, 0}kh1]] * (3 - [[{?{Step}, 0}kh1]])]] + [[floor({?{Bonus or Karma Step}-8,0}kh1 / 11)]]d20! + [[ [[{1e3, 7}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{6, 7, 7, 8, 9, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d12! + [[ [[{1e3, 6}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{4, 5, 5, 6, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d10! + [[ [[{1e3, 5}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{2, 3, 3, 4, 9, 10, 10, 11}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d8! + [[ [[{1e3, 4}=[[{?{Bonus or Karma Step}, 0}kh1]] ]] + [[{1, 1, 2, 8, 8, 9}=[[{((?{Bonus or Karma Step}-8) % 11)+1,0}kh1]] ]] ]]d6! + [[{1, 2, 3}=[[{?{Bonus or Karma Step}, 0}kh1]] ]]d4! - [[{1, 2}=[[{?{Bonus or Karma Step}, 0}kh1]] * (3 - [[{?{Bonus or Karma Step}, 0}kh1]])]] ]]}}"
                      title="@{repeating_weapons_X_WPN_Roll-NoAPI}   Roll Damage for this weapon modified by combat options and conditions."><input name="attr_WPN_Name" type="text" class="sheet-txtShort sheet-HideIfEditMode sheet-buttonlabel" placeholder="Weapon type" ></button>
                    </span>
                    <span class="sheet-nowrap0 sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_Name}:   Type of Weapon used.">
                      &nbsp;&nbsp;&nbsp;<input name="attr_WPN_Name" list="weapons"  type="text" class="sheet-txtLong sheet-bordered-bottom" placeholder="Weapon type" >
                    </span>
                    <!--Weapon Fieldset - Rank-->
                    <span class="sheet-fixed-width sheet-w75px sheet-titlespan sheet-HideIfEditMode sheet-HideIfPrint">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="" title="@{repeating_weapons_X_WPN_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of a Talent, like using Surprise Strike or Down Strike.">
                          <input name="attr_WPN_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_WPN_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_WPN_Rank" value="0" min="0" class="sheet-StepBig sheet-StepBase" readonly title="@{repeating_weapons_X_WPN_Rank}:   This is the Base Damage of this Weapon."  type="number"  >
                        <input name="attr_WPN_Effective-Rank" value="0" min="0" class="sheet-StepBig sheet-StepTotal" readonly title="@{repeating_weapons_X_WPN_Effective-Rank}:   Weapons effective Rank of Damage in this weapon counting any magical threads or other effects that effectively raise the rank above it's base rank."  type="number"  >
                        <span title="@{repeating_weapons_X_WPN_Rank-Adjust}:   Adjustments to the damage of this weapon as for example with Forge Weapon.">
                          <input name="attr_WPN_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_WPN_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" readonly>
                        </span>
                      </span>
                    </span>

                    <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-HideIfNotEditMode sheet-HideIfPrint">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span class="" title="@{repeating_weapons_X_WPN_LinkValue}: This is additional Ranks due to Links. This can be for example the influence of a Talent, like using Surprise Strike or Down Strike.">
                          <input name="attr_WPN_LinkValue" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_WPN_LinkValue" type="number" class="sheet-buffLeft sheet-buffSmall sheet-nospinner" value="0" readonly>
                        </span>
                        <input name="attr_WPN_Rank" value="0" min="0" class="sheet-Big sheet-numShorter sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Rank}:   Weapon Base Rank of damage."  type="number"  >
                        <span title="@{repeating_weapons_X_WPN_Rank-Adjust}:  Adjustments to the damage of this weapon as for example with Forge Weapon.">
                          <input name="attr_WPN_Rank-Adjust" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_WPN_Rank-Adjust" type="number" class="sheet-buffRight sheet-buffSmall" >
                        </span>
                      </span>
                    </span>

                    <!--Weapon Fieldset - addSR-->

                    <span class="sheet-nowrap0 sheet-fixed-width sheet-w30px sheet-HideIfNotEditMode sheet-HideIfNotCreature" title="@{repeating_weapons_X_WPN_addSR} Add the challenge Rating or Spirit Strength Rating to the Weapon Rank.">
                      <label class="sheet-labelcheckbox" hidden>
                      <input type="checkbox" name="attr_WPN_addSR" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-circle"></span>
                    </label>
                    </span>

                    <!--Weapon Fieldset - Step-->


                    <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <span title="@{repeating_weapons_X_WPN_Mod-Auto}   This is the Total adjustment to Damage from Conditions and Combat Options.">
                          <input name="attr_WPN_Mod-Auto" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignLeft sheet-buffSmall">+</b>
                          <input name="attr_WPN_Mod-Auto" type="number" readonly class="sheet-buffLeft sheet-buffSmall">
                        </span>
                        <input name="attr_WPN_Damage" type="number" class="sheet-StepBig sheet-StepTotal"     readonly value="0" title="@{repeating_weapons_X_WPN_Damage}   Final Damage Step this weapon does including all modifiers .">
                        <input name="attr_WPN_BaseDamage" type="number"  class="sheet-StepBig sheet-StepBase" readonly value="0" title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
                        <span title="@{repeating_weapons_X_WPN_Mods}   Modifications to the base damage.">
                          <input name="attr_WPN_Mods" type="hidden" class="sheet-redGreen" value="0">
                          <b class="sheet-buffSignRight sheet-buffSmall">+</b>
                          <input name="attr_WPN_Mods" type="number" class="sheet-buffRight sheet-buffSmall">
                        </span>
                      </span>
                    </span>

                    <span class="sheet-nowrap0 sheet-fixed-width sheet-w75px sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_BaseDamage} & @{repeating_weapons_X_WPN_Damage}   Base and Final Damage Step this weapon does respectively excluding or including all modifiers .">
                      <span class="sheet-stepSpan sheet-bordered-bottom">
                        <input name="attr_WPN_BaseDamage" type="number"  class="sheet-StepBig" readonly  value="0" title="@{repeating_weapons_X_WPN_BaseDamage}   Base Damage Step this weapon does excluding modifiers.">
                      </span>
                    </span>

                    <span class="sheet-fixed-width sheet-w100px sheet-titlespan sheet-hideIfPlaceholder sheet-HideIfNotOption5">
                        <input name="attr_WPN_Damage_max" type="text" readonly class="sheet-w100px sheet-bordered-bottom sheet-HideIfNoRoll" title="@{repeating_weapons_X_WPN_Damage_max}:   Dice to be rolled for the corresponding step.">
                    </span>


                    <!--Weapon Fieldset - Size-->
                    <span class="sheet-fixed-width sheet-w30px sheet-titlespan sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_Size}: Weapon Size">
                      <input name="attr_WPN_Size" type="number" value="0" class="sheet-numShorter" >
                    </span>
                    <!--Weapon Fieldset - Strain-->
                    <span class="sheet-fixed-width sheet-w25px sheet-titlespan" title="@{repeating_weapons_X_WPN_Strain}: number of strain points per use (mostly to be used for weapons linked to talents)">
                      <input name="attr_WPN_Strain" type="checkbox" checked value="0" class="sheet-testCloseChecked sheet-hidden" >
                      <input name="attr_WPN_Strain" type="text" value="0" class="sheet-strainicon sheet-InvisibleIfCloseChecked sheet-HideIfEditMode" readonly="readonly" >
                      <input name="attr_WPN_Strain" type="number" value="0" class="sheet-numShorter sheet-HideIfNotEditMode" >
                    </span>
                    <!-- Weapon Fieldset- Karma & DP -->
                      <!--JBF Karma Toggle-Simple-->
                      <span class="sheet-Karma-ControlBox">
                      <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                      <span class="sheet-HideIfCloseChecked">
                        <input type="hidden" name="attr_WPN_Karma-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_WPN_Karma-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_WPN_Karma-Limit_max" hidden value="1" class="sheet-testChecked">
                          <span class="sheet-HideIfNotChecked">
                            <label class="sheet-labelcheckbox" hidden title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On" >
                              <input type="checkbox" name="attr_WPN_Karma" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-karma"></span>
                            </label>
                          </span>
                          <span class="sheet-HideIfChecked">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_Karma} : Number of Karma Points to be spent when Karma is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma} Don't Spend any Karma when Karma is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_Karma" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-karma3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On"></span>
                              </span>
                              <input type="hidden" name="attr_WPN_Karma-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for Karma-->
                              <input type="hidden" name="attr_WPN_Karma-Limit_max" class="sheet-testKarMax">
                              <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                                <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                                <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                                <option value="3" title="@{WPN_Karma}   Automatically Spends Three Karma when Karma is On">3</option>
                              </select>
                              <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                                <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>
                              <select name="attr_WPN_Karma" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                                <option value="0" selected title="@{WPN_Karma} Don't Spend any Karma when Karma is On.">0</option>
                                <option value="1" title="@{WPN_Karma}   Automatically Spends One Karma when Karma is On">1</option>
                                <option value="2" title="@{WPN_Karma}   Automatically Spends Two Karma when Karma is On">2</option>
                              </select>

                            </span>
                          </span>
                        </span>
                      </span>
                    </span>
                      <!--JBF End Of Karma Toggle-Simple-->
                      <!--JBF DP Toggle-Simple    To Convert Karma in DP : Replace "icon-karma" by "icon-devotion" then "Karma-" by "DP-" and finally " Karma " by " Devotion " WITH SPACES BEFORE and change default values-->
                      <span class="sheet-DP-ControlBox">
                        <input type="hidden" name="attr_WPN_DP-Ask" value="0"> <!-- JBF : Holds the string used to make the Karma Query in ask mode. See sheet-workers for details-->
                        <input type="checkbox" name="attr_WPN_DP-Limit_max" value="0" hidden checked class="sheet-testCloseChecked">
                        <span class="sheet-HideIfCloseChecked" >
                          <input type="checkbox" name="attr_WPN_DP-Limit_max" hidden value="1" class="sheet-testChecked">
                          <span class="sheet-HideIfNotChecked">
                            <label class="sheet-labelcheckbox" hidden title="@{WPN_DP}   Automatically Spends One Devotion when Devotion is On" >
                              <input type="checkbox" name="attr_WPN_DP" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel-header sheet-icon-devotion"></span>
                            </label>
                          </span>
                          <span class="sheet-HideIfChecked">
                            <span class="sheet-iconselect-span sheet-fixed-width sheet-w30px sheet-titlespan" title="@{WPN_DP} : Number of Devotion Points to be spent when Devotion is On">
                              <span class="sheet-iconselect-icon-noedit">
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="0" checked> <span class="sheet-iconlabel-header sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP} Don't Spend any Dp when Dp is On."></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="1"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="2"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On"></span>
                                <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_WPN_DP" value="3"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-devotion3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On"></span>
                              </span>
                              <input type="hidden" name="attr_WPN_DP-Limit" value="0" class="sheet-testKarReq"> <!--JBF : Not Used for DP-->
                              <input type="hidden" name="attr_WPN_DP-Limit_max" class="sheet-testKarMax">
                              <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_3">
                                <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_3">
                                <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                                <option value="3" title="@{WPN_DP}   Automatically Spends Three Dp when Dp is On">3</option>
                              </select>
                              <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_1_2">
                                <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>
                              <select name="attr_WPN_DP" class="sheet-iconselect-select sheet-w30px sheet-Kar_0_2">
                                <option value="0" selected title="@{WPN_DP} Don't Spend any Dp when Dp is On.">0</option>
                                <option value="1" title="@{WPN_DP}   Automatically Spends One Dp when Dp is On">1</option>
                                <option value="2" title="@{WPN_DP}   Automatically Spends Two Dp when Dp is On">2</option>
                              </select>

                            </span>
                          </span>
                        </span>
                      </span>   <!--JBF End Of DP Toggle-->
                      <!-- end Weapon Fieldset- Karma & DP -->
                    <label title="@{repeating_weapons_X_WPN_ShowNotes}   Show or Hide the details of item">
                      <input type="checkbox" name="attr_WPN_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                    </label>
                    <label class="sheet-HideIfNotEditMode" title="@{repeating_weapons_X_WPN_CombatSlot}  Should this Weapon be summarized on the combat tab and placed in a Token Action?">
                      <input type="checkbox" name="attr_WPN_CombatSlot" checked value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-tknactn"></span>
                    </label>
                    <span class="sheet-fixed-width sheet-w30px sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfPrint sheet-HideIfNotEditMode">
                      <input name="attr_WPN_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                      <span class="sheet-HideIfCloseChecked">
                        <input name="attr_WPN_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                        <span class="sheet-iconstatic sheet-icon-link-in-out sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                        <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfNotCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked  in both direction with other abilites and both gets and provides rank to be included in the rank calculation."></span>
                      </span>
                      <span class="sheet-HideIfNotCloseChecked">
                        <input name="attr_WPN_LinksGetValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                        <span class="sheet-iconstatic sheet-icon-link-in sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and gets in its Effective rank calculation the sum of Ranks of each linked property."></span>
                      </span>
                    </span>

                    <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                      <!--Compendium Button-->
                      <input type="checkbox" name="attr_WPN_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                      <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_WPN_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                    </span>

                    <!--Weapon Fieldset - Detail Icons-->
                    <input type="checkbox" name="attr_WPN_ShowNotes" value="1" class="sheet-hidden sheet-testCloseChecked">
                    <div class="sheet-HideIfNotCloseChecked">
                      <div>
                        <!--Weapon Fieldset - Details-->
                        <!-- <span class="sheet-nowrap0 sheet-label">Weight :<input name="attr_WPN_Weight" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Weight}   Weight of Weapon." ></span> -->
                        <!-- <span class="sheet-nowrap0 sheet-label">Min Str :<input name="attr_WPN_Str" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Str}   Min Str to use the weapon (for info only)." ></span>
                        <span class="sheet-nowrap0 sheet-label">Min Dex :<input name="attr_WPN_Dex" type="number" value="0" min="0" class="sheet-numLong sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_Dex}   Min Dex to use the weapon (for info only." ></span> -->

                        <span class="sheet-label">Type :</span>
                        <span class="sheet-nowrap0 sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_CloseCombat}   Choose the type of Weapon.">
                                <!--Choose the specific Type of Weapon-->
                          <select name="attr_WPN_CloseCombat">
                            <option disabled>Close Combat</option>
                            <option selected value="1">Melee</option>
                            <option value="2">Unarmed</option>
                            <option value="3">Attached</option>
                            <option disabled>Ranged</option>
                            <option value="-1">Missile</option>
                            <option value="-2">Thrown</option>
                            <option value="-3" class="sheet-HideIfNot1879">FireArm</option>
                            <option value="-4" class="sheet-HideIfNot1879">Heavy</option>

                          </select>
                        </span>




                        <span class=" sheet-api sheet-label">Max Karma :</span>
                        <input name="attr_WPN_Karma-Limit_max" type="number" class="sheet-numShorter sheet-LockIfNotEditMode sheet-HideSpinners sheet-api" min="0" max="3" title="@{repeating_weapons_X_WPN_Karma-Limit_max} Maximum allowed Karma Points that can be added to tests with this Weapon ">
                        <span class="sheet-nowrap sheet-HideIfNotQuest sheet-api sheet-LockIfNotEditMode sheet-HideSpinners" title="@{repeating_weapons_X_WPN_DP-Limit_max} Maximum allowed Devotion Points that can be added to tests with this Weapon">
                          <span class="sheet-label">Max DP :</span>
                          <input name="attr_WPN_DP-Limit_max" type="number" class="sheet-numShorter sheet-LockIfNotEditMode" min="0" max="3" >
                        </span>
                      </div>
                      <!-- <input type="checkbox" name="attr_WPN_CloseCombat" checked value="1" class="sheet-testCloseChecked sheet-hidden">
                      <div class=sheet-HideIfCloseChecked>
                      <span class="sheet-nowrap0 sheet-label">Ammo Qty : <input name="attr_WPN_AmmoQty" type="number" class="sheet-numLong " value="0" title="@{repeating_weapons_X_WPN_AmmoQty}   number of ammunition carried." ></span>
                      <span class="sheet-nowrap0 sheet-label">Un Wgt  : <input name="attr_WPN_AmmoWeight" type="number" class="sheet-numLong sheet-LockIfNotEditMode" value="0" title="@{repeating_weapons_X_WPN_AmmoQty}   number of ammunition carried." ></span>
                      <span class="sheet-nowrap0 sheet-label">Range : <input name="attr_WPN_Range" type="text" class="sheet-selLong sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_Range}   Short and Long range of weapon if applicable." placeholder="shrt/Lng" ></span>

                    </div> -->

                    <input type="checkbox" name="attr_WPN_CloseCombat" value="-3" class="sheet-testCloseChecked sheet-hidden">
                    <div class="sheet-HideIfNotCloseChecked">
                      <span class="sheet-nowrap0 sheet-label">Staging : <input name="attr_WPN_Staging" type="number" class="sheet-numLong sheet-LockIfNotEditMode" value="0" title="@{repeating_weapons_X_WPN_Staging} Staging Attribute of the FireArm." ></span>
                    </div>
                    <!--Weapon Fieldset - Link Button-->
                    <div class="sheet-nowrap sheet-HideIfNotEditMode sheet-HideIfNotOption3">
                      <span class="sheet-label"> Link :</span>
                      <button class="sheet-text-button sheet-button-nodice sheet-api" name="roll_WPN_btnSetLink" type="roll"
                      value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Link: WPN : @{WPN_RowID}"
                      title="@{repeating_weapons_X_WPN_btnSetLink} Set the Links for this Weapon. Links allow to automatically add the Rank of another Talent, Knack, Thread Item or Other to the Effective Rank of this Weapon"><span class="sheet-iconstatic sheet-icon-link"></span></button>
                      <span title="@{repeating_weapons_X_WPN_LinksGetValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                        <span class="sheet-autoexpand-wrap">
                          <input name="attr_WPN_LinksGetValue" type="text" readonly class="sheet-bordered">
                          <span name="attr_WPN_LinksGetValue" class="sheet-autoexpand"></span>
                        </span>
                        <input name="attr_WPN_LinksGetValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksGetValue_max} : List of RowIds of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property gets the Rank of each of the list and adds it to its own Effective Rank calculation. This can be used for a Knack to get the Rank of linked Talent, for a Free Talent to get the Circle of the Discipline, or for a combination of Talents/Weapons (like Surprise Strike with a LongSword) to get the Ranks of the combined properties">
                        <input name="attr_WPN_LinksProvideValue_max" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksProvideValue_max} : List of RowIds of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Talent to provide its Rank to a linked Knack.">
                        <input name="attr_WPN_LinksProvideValue" type="text" class="sheet-bordered sheet-hidden" title="@{repeating_weapons_X_WPN_LinksProvideValue} : List of Names of properties (Talents, Skills, Thread Items, Weapons ...etc) linked with the current property. The current property provides its Rank, and each property of the lists uses the Rank in its own Effective Rank calculation. This can be used for a Talent to provide its Rank to a linked Knack.">
                      </span>
                    </div>
                    <div>
                      <textarea name="attr_WPN_Date" class="sheet-details-small sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_weapons_X_WPN_Date}   Date weapon was last forged." placeholder="Date Forged" ></textarea>
                    </div>
                  </div>
                  </fieldset>
                </div>    <!-- end Equipment - Right Pane - Armor & Weapons -->


                      <!-- Equipment - Right Pane - Thread Items -->
                <div class="sheet-headerbar sheet-headerbar-flex">
                  <div></div>
                  Thread Items and Woven Threads
                  <div class="sheet-floatRight">
                    <label title="@{attr_thread-edit-mode} : Toggles the edit mode .">
                      <input type="checkbox" name="attr_thread-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                    </label>
                  </div>
                </div>
                <div class="sheet-content">
                  <input type="checkbox" name="attr_thread-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                  <p class="sheet-HideIfPrint sheet-HideIfNotEditMode">Note that most of these will require adjusting entries either in stats, talents, or miscellaneous adjustments on the last tab.</p>
                  <b class="sheet-heading sheet-fixed-width sheet-txtMedplus sheet-text-center sheet-titlespan">&nbsp;Items&nbsp;</b>
                  <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">&nbsp;Rank&nbsp;</b>
                  <b class="sheet-heading sheet-fixed-width sheet-selLong sheet-text-center sheet-titlespan sheet-HideIfPrint">&nbsp;Tier&nbsp;</b>
                  <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan">&nbsp;Effects&nbsp;</b>
                  <fieldset class="repeating_threads">
                    <input name="attr_TI_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                    <span class="sheet-fixed-width sheet-txtMedplus " title="@{repeating_threads_X_TI_Name}:   Name of Item, Person, or Group thread is attached to.">
                      <input name="attr_TI_Name" type="text" class="sheet-text-left sheet-txtMedplus sheet-LockIfNotEditMode"  placeholder="Item" >
                    </span>
                    <span class="sheet-fixed-width sheet-numShort" title="@{repeating_threads_X_TI_Rank}:   Rank of thread attached to Thread Item.">
                      <input name="attr_TI_Rank" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners" >
                    </span>
                    <span class="sheet-fixed-width sheet-selLong sheet-HideIfPrint" title="@{repeating_threads_X_TI_Type}  What LP cost progression tier does this Thread Item use.">
                      <select name="attr_TI_Type" class="sheet-LockIfNotEditMode sheet-selLong">
                        <option value="Novice" selected title="This item has a Novice cost progression meaning it costs as much to advance the thread rank as it does to advance a Novice Talent.">Novice</option>
                        <option value="Journeyman" title="This item has a Journeyman cost progression meaning it costs as much to advance the thread rank as it does to advance a Journeyman Talent." >Journeyman</option>
                        <option value="Warden"     title="This item has a Warden cost progression meaning it costs as much to advance the thread rank as it does to advance a Warden Talent." >Warden</option>
                        <option value="Master"     title="This item has a Master cost progression meaning it costs as much to advance the thread rank as it does to advance a Master Talent." >Master</option>
                        <option value="Free"       title="This item does not cost LP to advance.">Free</option>
                        <option value="Special"    title="This item has LP costs that are special for some reason.">Special</option>
                        <option value="Dummy"      title="This is not really a standard Thread Item in and of itself, it is a placeholder for a something else.">Dummy</option>
                      </select>
                    </span>
                    <input type="checkbox" name="attr_TI_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                    <span class="sheet-fixed-width sheet-txtLong" >
                      <input type="text" name="attr_TI_Effects" placeholder="Effect"  class="sheet-txtLong sheet-LockIfNotEditMode" title="@{repeating_threads_X_TI_Effects}:   Thread Effects." >
                    </span>
                    <label title="@{repeating_threads_X_TI_ShowNotes}   Show or Hide the details of item">
                      <input type="checkbox" name="attr_TI_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes">
                      </span>
                    </label>
                    <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                      <!--Compendium Button-->
                      <input type="checkbox" name="attr_TI_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                      <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_TI_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                    </span>
                    <input name="attr_TI_LinksProvideValue_max" class="sheet-hidden sheet-testCloseChecked" type="checkbox" checked value="">
                    <span class="sheet-iconstatic sheet-icon-link-out sheet-HideIfOverviewNoEdit sheet-HideIfCombatNoEdit sheet-HideIfCloseChecked sheet-HideIfNotEditMode" title="This icon indicates that this ability (Talent, Knack, Matrix, Skill) is linked with other abilites and provides its rank to be included to the Effective Rank calculation of each of the others."></span>
                    <input name="attr_TI_LinksProvideValue_max" type="hidden" value="">

                          <!--JBF@CD : Start of optional Thread Item Development-->
                    <div class="sheet-nowrap sheet-HideIfNotChecked" title="@{repeating_threads_X_TI_RankKnown}:   Number of Ranks discovered via Item History including power and Test Knowledges.">
                      <span class="sheet-fixed-width sheet-txtMedplus sheet-nowrap sheet-label" >Ranks known (Item History) : </span>
                      <span class="sheet-nowrap" >
                        <input name="attr_TI_RankKnown" type="number" value="0" min="0" max="15" class="sheet-numShort sheet-LockIfNotEditMode sheet-HideSpinners" >
                      </span>
                    </div>

                    <input name="attr_TI_RankKnown" type="hidden" value="0" class="sheet-testNum" >
                    <input name="attr_TI_Rank" type="hidden" value="0" class="sheet-testNum2" >

                    <div class="sheet-HideIfNotChecked sheet-HideIfLessThan1">
                      <div>
                        <span class="sheet-fixed-width sheet-numShorter" >
                        </span>
                        <b class="sheet-heading sheet-fixed-width sheet-numShorter sheet-text-center sheet-titlespan">#</b>
                        <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan">Key/Test Knowledge</b>
                        <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan">Done</b>
                        <b class="sheet-heading sheet-fixed-width sheet-txtLong sheet-text-center sheet-titlespan">Rank Effect</b>
                        <br>
                      </div>

                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                      <div>
                        <span class="sheet-fixed-width sheet-numShorter">
                          <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf1"></span>
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">1-</span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank1TestKnowledge} - Test Knowledge for this Rank">
                          <textarea name="attr_TI_Rank1TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank1KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                          <input name="attr_TI_Rank1KeyKnowledgeComplete" type="checkbox" value="1">
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank1Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                          <textarea name="attr_TI_Rank1Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                        </span>
                      </div>
                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                      <div class="sheet-HideIfLessThan2">
                        <span class="sheet-fixed-width sheet-numShorter">
                          <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf2"></span>
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">2-</span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank2TestKnowledge} - Test Knowledge for this Rank">
                          <textarea name="attr_TI_Rank2TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank2KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                          <input name="attr_TI_Rank2KeyKnowledgeComplete" type="checkbox" value="2">
                        </span>
                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank2Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                          <textarea name="attr_TI_Rank2Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                        </span>
                        <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                        <div class="sheet-HideIfLessThan3">
                          <span class="sheet-fixed-width sheet-numShorter">
                            <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf3"></span>
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">3-</span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank3TestKnowledge} - Test Knowledge for this Rank">
                            <textarea name="attr_TI_Rank3TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank3KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                            <input name="attr_TI_Rank3KeyKnowledgeComplete" type="checkbox" value="3">
                          </span>
                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank3Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                            <textarea name="attr_TI_Rank3Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                          </span>
                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                          <div class="sheet-HideIfLessThan4">
                            <span class="sheet-fixed-width sheet-numShorter">
                              <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf4"></span>
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">4-</span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank4TestKnowledge} - Test Knowledge for this Rank">
                              <textarea name="attr_TI_Rank4TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank4KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                              <input name="attr_TI_Rank4KeyKnowledgeComplete" type="checkbox" value="4">
                            </span>
                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank4Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                              <textarea name="attr_TI_Rank4Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                            </span>
                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                            <div class="sheet-HideIfLessThan5">
                              <span class="sheet-fixed-width sheet-numShorter">
                                <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf5"></span>
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">5-</span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank5TestKnowledge} - Test Knowledge for this Rank">
                                <textarea name="attr_TI_Rank5TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank5KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                <input name="attr_TI_Rank5KeyKnowledgeComplete" type="checkbox" value="5">
                              </span>
                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank5Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                <textarea name="attr_TI_Rank5Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                              </span>
                              <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                              <div class="sheet-HideIfLessThan6">
                                <span class="sheet-fixed-width sheet-numShorter">
                                  <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf6"></span>
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">6-</span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank6TestKnowledge} - Test Knowledge for this Rank">
                                  <textarea name="attr_TI_Rank6TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank6KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                  <input name="attr_TI_Rank6KeyKnowledgeComplete" type="checkbox" value="6">
                                </span>
                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank6Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                  <textarea name="attr_TI_Rank6Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                </span>
                                <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                <div class="sheet-HideIfLessThan7">
                                  <span class="sheet-fixed-width sheet-numShorter">
                                    <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf7"></span>
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">7-</span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank7TestKnowledge} - Test Knowledge for this Rank">
                                    <textarea name="attr_TI_Rank7TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank7KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                    <input name="attr_TI_Rank7KeyKnowledgeComplete" type="checkbox" value="7">
                                  </span>
                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank7Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                    <textarea name="attr_TI_Rank7Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                  </span>
                                  <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                  <div class="sheet-HideIfLessThan8">
                                    <span class="sheet-fixed-width sheet-numShorter">
                                      <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf8"></span>
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">8-</span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank8TestKnowledge} - Test Knowledge for this Rank">
                                      <textarea name="attr_TI_Rank8TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank8KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                      <input name="attr_TI_Rank8KeyKnowledgeComplete" type="checkbox" value="8">
                                    </span>
                                    <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank8Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                      <textarea name="attr_TI_Rank8Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                    </span>
                                    <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                    <div class="sheet-HideIfLessThan9">
                                      <span class="sheet-fixed-width sheet-numShorter">
                                        <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf9"></span>
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">9-</span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank9TestKnowledge} - Test Knowledge for this Rank">
                                        <textarea name="attr_TI_Rank9TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank9KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                        <input name="attr_TI_Rank9KeyKnowledgeComplete" type="checkbox" value="9">
                                      </span>
                                      <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank9Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                        <textarea name="attr_TI_Rank9Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                      </span>
                                      <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                      <div class="sheet-HideIfLessThan10">
                                        <span class="sheet-fixed-width sheet-numShorter">
                                          <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf10"></span>
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">10-</span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank10TestKnowledge} - Test Knowledge for this Rank">
                                          <textarea name="attr_TI_Rank10TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank10KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                          <input name="attr_TI_Rank10KeyKnowledgeComplete" type="checkbox" value="10">
                                        </span>
                                        <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank10Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                          <textarea name="attr_TI_Rank10Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                        </span>
                                        <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                        <div class="sheet-HideIfLessThan11">
                                          <span class="sheet-fixed-width sheet-numShorter">
                                            <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf11"></span>
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">11-</span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank11TestKnowledge} - Test Knowledge for this Rank">
                                            <textarea name="attr_TI_Rank11TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank11KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                            <input name="attr_TI_Rank11KeyKnowledgeComplete" type="checkbox" value="11">
                                          </span>
                                          <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank11Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                            <textarea name="attr_TI_Rank11Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                          </span>
                                          <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                          <div class="sheet-HideIfLessThan12">
                                            <span class="sheet-fixed-width sheet-numShorter">
                                              <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf12"></span>
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">12-</span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank12TestKnowledge} - Test Knowledge for this Rank">
                                              <textarea name="attr_TI_Rank12TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank12KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                              <input name="attr_TI_Rank12KeyKnowledgeComplete" type="checkbox" value="12">
                                            </span>
                                            <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank12Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                              <textarea name="attr_TI_Rank12Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                            </span>
                                            <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                            <div class="sheet-HideIfLessThan13">
                                              <span class="sheet-fixed-width sheet-numShorter">
                                                <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf13"></span>
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">13-</span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank13TestKnowledge} - Test Knowledge for this Rank">
                                                <textarea name="attr_TI_Rank13TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank13KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                                <input name="attr_TI_Rank13KeyKnowledgeComplete" type="checkbox" value="13">
                                              </span>
                                              <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank13Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                                <textarea name="attr_TI_Rank13Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                              </span>
                                              <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                              <div class="sheet-HideIfLessThan14">
                                                <span class="sheet-fixed-width sheet-numShorter">
                                                  <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf14"></span>
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">14-</span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank14TestKnowledge} - Test Knowledge for this Rank">
                                                  <textarea name="attr_TI_Rank14TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank14KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                                  <input name="attr_TI_Rank14KeyKnowledgeComplete" type="checkbox" value="14">
                                                </span>
                                                <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank14Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                                  <textarea name="attr_TI_Rank14Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                                </span>
                                                <!--Start Rank. Ranks are in a cascade of div for comparison need-->
                                                <div class="sheet-HideIfLessThan15">
                                                  <span class="sheet-fixed-width sheet-numShorter">
                                                    <span class="sheet-iconstatic sheet-icon-weave sheet-hidden sheet-UnhideIf15"></span>
                                                  </span>
                                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShorter sheet-text-center">15-</span>
                                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank15TestKnowledge} - Test Knowledge for this Rank">
                                                    <textarea name="attr_TI_Rank15TestKnowledge" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                                  </span>
                                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-numShort sheet-text-center sheet-titlespan" title="@{repeating_threads_TI_Rank15KeyKnowledgeComplete} - Check to keep track of completion of Key Knowledge/Deed">
                                                    <input name="attr_TI_Rank15KeyKnowledgeComplete" type="checkbox" value="15">
                                                  </span>
                                                  <span class="sheet-nowrap0 sheet-fixed-width sheet-txtLong sheet-titlespan" title="@{repeating_threads_TI_Rank15Effect} - Record here the Effect of this Rank - Prefer short text with all ranks effect, as this text will also be displayed in the Summary">
                                                    <textarea name="attr_TI_Rank15Effect" class="sheet-details-small sheet-text-left sheet-txtLong sheet-LockIfNotEditMode"></textarea>
                                                  </span>
                                                </div>
                                                <!--End Rank-->
                                              </div>
                                              <!--End Rank-->
                                            </div>
                                            <!--End Rank-->
                                          </div>
                                          <!--End Rank-->
                                        </div>
                                        <!--End Rank-->
                                      </div>
                                      <!--End Rank-->
                                    </div>
                                    <!--End Rank-->
                                  </div>
                                  <!--End Rank-->
                                </div>
                                <!--End Rank-->
                              </div>
                              <!--End Rank-->
                            </div>
                            <!--End Rank-->
                          </div>
                          <!--End Rank-->
                        </div>
                        <!--End Rank-->
                      </div>
                      <!--End Rank-->
                    </div>
                    <!--JBF@CD End of optional Thread Item development-->
                    <textarea name="attr_TI_Description" class="sheet-details sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_threads_X_TI_Description}:   Thread Item Description." ></textarea>
                  </fieldset>
                </div>    <!-- end Equipment - Right Pane - Thread Items -->

                      <!--Equipment - Right Pane - Blood Magic-->
                <input type="checkbox" name="attr_show_blood" value="1" class="sheet-testCloseChecked sheet-hidden">
                <div class="sheet-HideIfNotCloseChecked">
                  <div class="sheet-headerbar sheet-headerbar-flex">
                    <div></div>
                    Blood Magic : <input name="attr_Damage-Blood" readonly style="color:white;" type="number" value="0" min="0" class="sheet-numShort sheet-fancyfont" title="@{Damage-Blood}:  Blood Magic damage.">
                    <div class="sheet-floatRight">
                      <label title="@{attr_blood-edit-mode} : Toggles the edit mode .">
                        <input type="checkbox" name="attr_blood-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                      </label>
                    </div>
                  </div>
                  <div class="sheet-content">
                    <input type="checkbox" name="attr_blood-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                    <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">&nbsp;Items&nbsp;</b>&nbsp;&nbsp;&nbsp;
                    <b class="sheet-heading sheet-fixed-width sheet-numShort sheet-text-center">&nbsp;Dmg&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <b class="sheet-heading sheet-fixed-width sheet-txtEvenLonger sheet-text-center">&nbsp;Effects&nbsp;</b>

                    <datalist id="blood">
                      <!--Compendium PG-->
                      <option value="Absorb Blow"></option>
                      <option value="Astral-Sensitive Eye"></option>
                      <option value="Bone Charm"></option>
                      <option value="Darksight Eye"></option>
                      <option value="Death Cheat"></option>
                      <option value="Desperate Blow"></option>
                      <option value="Desperate Spell"></option>
                      <option value="Garlen Stone"></option>
                      <option value="Horn Needle"></option>
                      <option value="Horror Fend"></option>
                      <option value="Initiative Booster"></option>
                      <option value="Strength Booster"></option>
                      <option value="Targeting Eye"></option>
                      <option value="Wound Balance"></option>
                    </datalist>

                    <fieldset class="repeating_blood">
                      <input name="attr_BL_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                      <span class="sheet-nowrap">
                        <input name="attr_BL_Name" list="blood" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Name}:   Name of Blood Charm." placeholder="Item" >
                      </span>
                    <span class="sheet-nowrap">
                      <input name="attr_BL_Damage-Blood-Magic" type="number" value="0" min="0" class="sheet-numShort sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Damage-Blood-Magic}:   Number of Blood Damage" ></span>
                      <input type="checkbox" name="attr_BL_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                      <span class="sheet-nowrap sheet-fixed-width sheet-txtEvenLonger" style="height:25px; vertical-align:middle;">
                        <textarea name="attr_BL_Effects" class="sheet-details-oneline sheet-bordered-bottom sheet-txtEvenLonger sheet-HideIfChecked" title="@{repeating_blood_X_BL_Effects}:   Charm Effects." ></textarea>
                      </span>
                      <label title="@{repeating_blood_X_BL_ShowNotes}   Show or Hide the details of item">
                        <input type="checkbox" checked="checked" name="attr_BL_ShowNotes" value="1" class="sheet-iconcheckbox sheet-testChecked"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                      </label>
                      <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                        <!--Compendium Button-->
                        <input type="checkbox" name="attr_BL_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                        <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_BL_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                      </span>
                      <textarea name="attr_BL_Effects" class="sheet-details sheet-HideIfNotChecked sheet-LockIfNotEditMode" title="@{repeating_blood_X_BL_Effects}:   Charm Effects." ></textarea>
                    </fieldset>
                  </div>
                </div>

                      <!-- Equipment - Right Pane - Mounts -->
                <input type="checkbox" name="attr_show_mounts" value="1" class="sheet-testCloseChecked sheet-hidden">
                <div class="sheet-HideIfNotCloseChecked">
                  <div class="sheet-headerbar sheet-headerbar-flex"><div></div>Mounts and other Animals
                    <div class="sheet-floatRight">
                      <label title="@{attr_mount-edit-mode} : Toggles the edit mode .">
                        <input type="checkbox" name="attr_mount-edit-mode" value="1" class="sheet-iconcheckbox"> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sheet-iconlabel-white sheet-icon-edit-white"></span>
                      </label>
                    </div>
                  </div>
                  <div class="sheet-content">
                    <input type="checkbox" name="attr_mount-edit-mode" value="1" hidden class="sheet-testRepEditMode">
                    <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">Name</b>
                    <b class="sheet-heading sheet-fixed-width sheet-txtShort sheet-text-center">Animal</b>
                    <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Speed</b>
                    <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center">Carry</b>
                    <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-HideIfPrint">Feed</b>
                    <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-HideIfPrint">Stable</b>
                    <b class="sheet-heading sheet-fixed-width sheet-numLong sheet-text-center sheet-HideIfPrint">Weight</b>
                    <fieldset class="repeating_mount">
                      <input name="attr_MNT_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_NickName" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_NickName}:   Nickname of Mount or Animal." placeholder="Nickname" >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Name" type="text" class="sheet-txtShort sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Name}:   Type of Mount or Animal." placeholder="Type" >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Speed" type="text" class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Speed}:   Speed of Mount or Animal." >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Carry" type="text"  class="sheet-numLong sheet-LockIfNotEditMode" title="@{repeating_mount_X_MNT_Carry}:   How much can the Mount or Animal carry." >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Feed" type="text"  class="sheet-numLong sheet-LockIfNotEditMode sheet-HideIfPrint" title="@{repeating_mount_X_MNT_Feed}:   How much does it cost to feed the Animal per day." >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Stable" type="text"  class="sheet-numLong sheet-LockIfNotEditMode sheet-HideIfPrint" title="@{repeating_mount_X_MNT_Stable}:   How much does it usually cost to stable the Mount or Animal." >
                      </span>
                      <span class="sheet-nowrap0">
                        <input name="attr_MNT_Weight" type="text"  class="sheet-numLong sheet-LockIfNotEditMode sheet-HideIfPrint" title="@{repeating_mount_X_MNT_Weight}:   Weight." >
                      </span>
                      <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                        <!--Compendium Button-->
                        <input type="checkbox" name="attr_MNT_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                        <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_MNT_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                      </span>
                    </fieldset>
                  </div>
                </div>    <!-- end Equipment - Right Pane - Mounts -->

                      <!--Equipment - Right Pane - LifeStyle-->
                <input type="checkbox" name="attr_show_lifestyle" value="1" class="sheet-testCloseChecked sheet-hidden">
                <div class="sheet-HideIfNotCloseChecked">
                  <span class="sheet-nowrap sheet-hidden">Equipment Weight:
                    <input name="attr_Weight-Mod" type="number" value="0" min="0" class="sheet-selShort" title="@{Weight-Mod}:   Approximate weight of all carried equipment listed on Equipment tab that does not have a seperate weight field.">
                    <input name="attr_Weight-Equipment" type="number" readonly class="sheet-selShort"
                    title="@{Weight-Equipment}:   Approximate weight of all equipment listed on this tab." value="0" >
                  </span>
                  <div class="sheet-headerbar"> Lifestyle</div>
                  <span class="sheet-nowrap sheet-label" title="@{Lifestyle}  (House Rule) What Lifestyle does the character maintain. Part of your lifestyle is spent in cleaning/maintaining/repairing/replacing your possessions when they wear out.">Lifestyle
                    <select name="attr_Lifestyle" style="width:12em;">
                      <option value="Cash" selected title="Character does not use lifestyle rules and pays cash for everything.">Cash</option>
                      <option value="Destitute" title="A destitute character must track every purchase, and may need to resort to Survival checks or theft to feed himself. Most of your gear and equipment needs to be replaced after 6 months due to mold, mildew, rust, and lack of basic maintenance." >Destitute</option>
                      <option value="Squalid" title="5sp per month - Squalid. Minimum needed to avoid survival checks. You are homeless, having at most a nook, cave, or burrow. You suffer interaction penalties in social situations. Much of your gear and equipment needs to be replaced after 6 months due to mold, mildew, rust, and lack of basic maintenance.">Squalid - 5 sp/month</option>
                      <option value="Poor" title="25sp per month - Poor. You sleep on the floor of a flophouse. You buy your clothes secondhand. Meat is a luxury. You usually drink water that you fetch yourself, splurging on ale only two or three times a month. You have no funds for nonessential expenses.  All your gear and equipment is maintained in poor condition and a random piece must be lost/replaced monthly.">Poor - 25 sp/month</option>
                      <option value="Lower-Class" title="50sp per month - Lower-Class. Your bed is a straw tick or a frame with a rope net, your room has no lock. You eat sausage or fried meat with ale every three days, and you can afford warm clothes. You get a full bath monthly and wash every week. You have very little funds for discretionary expenses. Some of your gear and equipment is in poor condition and a random piecer must be replaced quarterly.">Lower-Class - 50 sp/month</option>
                      <option value="Middle-Class" title="75sp per Month - Middle-Class. You have a room with a bed, and you can bar the door when you're there. You eat meat or fish every day and drink ale or wine instead of water. Your clothes may be plain, but you bought them new, and you get a bath every week. You have modest funds to engage in discretionary expenses, vices, and hobbies. Your basic and standard gear and mount are kept in good condition.">Middle-Class - 75 sp/month</option>
                      <option value="Wealthy" title="250sp per month - Wealthy. You eat vegetables and either lean meat or fine fish every day. You drink good wine and ale. You probably have at least one servant">Wealthy - 250 sp/month</option>
                      <option value="Very Wealthy" title="1000sp per month - Very Wealthy. Your home is large and has magic locks on the doors, and you have at least several servants. You own a very fine mount and/or a coach. You wear quite a bit of distinctive or enchanted clothing, some of which is very luxurious, and about four times a month, you indulge in a sumptuous, nine-course feast.">Very Wealthy - 1000 sp/month</option>
                      <option value="Filthy Rich" title="5000sp per month or more - Filthy Rich. Your home is very large and abounds with magical amenities: heat stones, light crystals, massaging baths, as well as a staff and a stable. Unless otherwise noted, your clothing is distinctive and enchanted, and often luxurious. You enjoy sumptuous feasts every three days or so.">Filthy Rich - 5000+ sp/month</option>
                      <option value="Adept" title="50sp/circle/month. This is the lifestyle of a 'typical' adept of your circle. You never run out of basic supplies and all your gear and (common) animals are kept in very good condition. Your living conditions improve to the level that you are spending. IE: at 4th circle, you are maintaining a lifestyle that is just short of wealthy. ">Adept - 50 sp/circle/month</option>
                      <!-- Note: Barsiave boxed set gives comfortable at 150/circle/month and Wealthy at 300/circle/month    -->
                    </select>
                  </span>
                  <span class="sheet-nowrap sheet-label" title="@{Lifestyle-Adjust}:   Monthly adjustment to lifestyle for extra or exotic mounts, animals, and other extraordinary repeating expenses not normally covered by your lifestyle.">LS Adjust:
                    <input name="attr_Lifestyle-Adjust" type="number" Value="0" class="sheet-selShort">
                  </span>
                  <span class="sheet-nowrap sheet-label" title="@{Lifestyle-Prepaid}:   Date through which the lifestyle is prepaid, or alternativly a running total of the number of days you have prepaid.">Prepaid Through:
                    <input name="attr_Lifestyle-Prepaid" type="text" class="sheet-txtShort" placeholder = "yyyy/mm/dd">
                  </span>
                </div>    <!-- end Equipment - Right Pane - LifeStyle -->
              </div>    <!-- end of Left pane inventory -->

                          <!--Equipment - Right Pane - Inventory-->
                    <div class="sheet-bordered">
                      <input type="checkbox" name="attr_show_container" value="1" class="sheet-testChecked sheet-testRepOption1 sheet-hidden">
                            <!--Equipment - Left Pane - Header-->
                      <div class="sheet-headerbar" style="max-width:400px;">Inventory</div>
                            <!-- Equipment - Inventory - Pre-filled -->
                      <div class="sheet-content" style="max-width:400px;">
                        <div>
                          <input type=hidden name="attr_WeightAdjustment" value="1">
                          <span class="sheet-nowrap sheet-label">Carried/Capacity:</span>
                          <input name="attr_Carrying-Carried" readonly="readonly"
                              value="0"
                              title="@{Carrying-Carried}  Number of pounds Equipment and Gear carried ."
                              type="number"> /
                              <input name="attr_Carrying-Capacity" class="sheet-nowrap" readonly="readonly"
                              value="80"
                              title="@{Carrying-Capacity}  Number of pounds that may be carried without penalty."
                          type="number">
                        </div>
                        <div>
                          <span class="sheet-iconstatic sheet-icon-coin-gold" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers"></span>:
                          <input name="attr_Wealth_Gold" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Gold}:   Number of Gold pieces owned. 1 Gold is worth 10 silvers">
                          <span class="sheet-iconstatic sheet-icon-coin-silver" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers"></span>:
                          <input name="attr_Wealth_Silver" type="number" value="100" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Silver}:   Number of Silver pieces owned. 1 Silver is worth 10 coppers. New Characters start with 100.">
                          <span class="sheet-iconstatic sheet-icon-coin-copper" title="@{Wealth_Copper}:   Number of Copper pieces owned."></span>:
                          <input name="attr_Wealth_Copper" type="number" value="0" min="0" class="sheet-numLong sheet-HideSpinners" title="@{Wealth_Copper}:   Number of Copper pieces owned.">
                        </div>
                        <div title="@{Wealth_Other}:   Elemental Coins and Gems.">
                          <!-- <span class="sheet-iconstatic sheet-icon-wealth"></span> : -->
                          <textarea name="attr_Wealth_Other" class="sheet-details-small"  placeholder="Other Valuables" >
                        </div>
                        <div class="sheet-table-left">
                          <div class="sheet-table-row">
                            <span class="sheet-table-data" >
                              <span class="sheet-iconstatic sheet-icon-potion"></span>
                              <b class="sheet-label ">Booster P: </b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Booster" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Booster}:   Number of Booster Potions owned. - Booster Potions grant + 8 to next recovery test">
                            </span>
                            <span class="sheet-table-data" >
                              <b class="sheet-label ">S.of Closure:</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Closure" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Closure}:   Number of Salve's of Closure owned. - Heals One Wound - COnsumes one recovery test">
                            </span>
                          </div>
                          <div class="sheet-table-row ">
                            <span class="sheet-table-data" >
                                <span class="sheet-iconstatic sheet-icon-potion"></span>
                              <b class="sheet-label ">Healing P:</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Healing" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Healing}:   Number of Healing Potions owned. - Healing Potions heals one Wound and grant +8 to next Recovery Test. If No recovery Test, heals Step 8">
                            </span>
                            <span class="sheet-table-data" >
                              <b class="sheet-label ">Last Chance:</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Last_Chance" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Last_Chance}:   Number of Last Chance Salves owned. - Last chance can be applied to character dead for less than its TOU/WIL Step. The character gets all his recovery tests (min 1) with a chance to resurrect.">
                            </span>
                          </div>
                          <div class="sheet-table-row ">
                            <span class="sheet-table-data" >
                              <span class="sheet-iconstatic sheet-icon-kit"></span>
                              <b class="sheet-label "> Healing:</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Kit" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Kit}:   Number of uses in Healing Kit and all refills. - Grants +1 to next recovery Test">
                            </span>
                            <span class="sheet-table-data" >
                              <b class="sheet-label ">Physician: </b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Healing_Physician_Kit" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Healing_Physician_Kit}:   Number of uses in Physician's Kit and all refills. - To be used with physician kit - Removes Wound Penalty on Recovery Tests">
                            </span>
                          </div>
                          <div class="sheet-table-row ">
                            <span class="sheet-table-data" >
                              <span class="sheet-iconstatic sheet-icon-ration"></span>
                              <b class="sheet-label "> Trail :</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Gear_Rations_Trail" type="number" value="7" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Gear_Rations_Trail}:   Number of person/days of Trail Rations owned. New characters start with 7">
                            </span>
                            <span class="sheet-table-data" >
                              <b class="sheet-label "> Mine:</b>
                            </span>
                            <span class="sheet-table-data" >
                              <input name="attr_Gear_Rations_Mine" type="number" value="0" min="0" class="sheet-numShort sheet-HideSpinners" title="@{Gear_Rations_Mine}:   Number of person/days of Dwarvish Mine Rations owned. - Gives +1 to next recovery test">
                            </span>
                          </div>
                        </div>
                                <!--Equipment - Inventory - Containers -->
                        <div class="sheet-HideIfNotChecked">
                          <div>
                            <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Container</b>
                            <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Wght</b>
                            <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">1</b>
                            <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">2</b>
                            <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">3</b>
                          </div>

                          <div>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont1-Name" placeholder="Self" title="@{Cont1-Name} Name of first Container"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont1-Weight" value="0" title="@{Cont1-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont1-Carried" value="1" checked title="@{Cont1-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                          </div>
                          <div>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont2-Name"  placeholder="Backpack" title="@{Cont2-Name} Name of first Container"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont2-Weight" value="0" title="@{Cont2-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont2-Carried" value="1" checked title="@{Cont2-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                          </div>
                          <div>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center"> <input type="text" class="sheet-txtShort" name="attr_Cont3-Name"  placeholder="Mount" title="@{Cont3-Name} Name of first Container"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center"><input type="number" readonly class="sheet-numShort" name="attr_Cont3-Weight" value="0" title="@{Cont3-Weight} Subtotal of weight of all items listed below that are in the container"> </b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"></b>
                            <b class="sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center"><input type="checkbox" name="attr_Cont3-Carried" value="1" checked title="@{Cont3-Carried} Is the container carried, and should the weight of all items listed below be counted against the carried capacity"></b>
                          </div>
                        </div>
                              <!--Equipment - Inventory - Title Bars-->
                        <div class="sheet-HideIfChecked">
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Item</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Qty</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">Car.</b>
                        </div>

                        <div class="sheet-HideIfNotChecked">
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-txtShort sheet-text-center">Item</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-numShort sheet-text-center">Qty</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">1</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">2</b>
                          <b class="sheet-heading sheet-vaBottom sheet-fixed-width sheet-w25px sheet-text-center">3</b>
                        </div>
                              <!--Equipment - Inventory - Fieldset-->
                        <input type="checkbox" name="attr_show_container" value="1" class="sheet-testRepOption1 sheet-hidden">
                        <fieldset class="repeating_inventory">
                          <div class="sheet-nowrap0">
                            <input name="attr_INV_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                          <input class="sheet-testLocked sheet-hidden" name="attr_INV_showDetails" type="checkbox" value="3">
                          <span class="sheet-fixed-width sheet-txtShort sheet-notbordered">
                            <input name="attr_INV_Name" type="text" class="sheet-nowrap sheet-txtMed sheet-label-flex" placeholder="Name"
                            title="@{repeating_inventory_X_INV_Name}:   Name of Item.">
                          </span>
                          <span class="sheet-fixed-width sheet-numShort">
                            <input name="attr_INV_Qty" type="number" value="1" class="sheet-numShort sheet-HideSpinners"
                            title="@{repeating_inventory_X_INV_Qty}:   Quantity of the item possessed" >
                          </span>
                          <span class="sheet-fixed-width sheet-w25px sheet-text-center">
                            <input name="attr_INV_Carried1" type="checkbox" value="1" checked
                            title="@{repeating_inventory_X_INV_Carried1}:   Is item Carried in the referenced container" >
                          </span>
                          <span class="sheet-fixed-width sheet-w25px sheet-text-center sheet-HideIfNotOption1">
                            <input name="attr_INV_Carried2" type="checkbox" value="1"
                            title="@{repeating_inventory_X_INV_Carried2}:   Is item Carried in the referenced container" >
                          </span>
                          <span class="sheet-fixed-width sheet-w25px sheet-text-center sheet-HideIfNotOption1">
                            <input name="attr_INV_Carried3" type="checkbox" value="1"
                            title="@{repeating_inventory_X_INV_Carried3}:   Is item Carried in the referenced container" >
                          </span>
                          <label title="@{repeating_inventory_X_INV_ShowNotes}   Show or Hide the details of item">
                            <input type="checkbox" name="attr_INV_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                          </label>
                          <span class="sheet-fixed-width sheet-w30px sheet-hideIfPlaceholder sheet-HideIfPrint">
                            <!--Compendium Button-->
                            <input type="checkbox" name="attr_INV_buttonInfo" value="" checked class="sheet-hidden sheet-testCloseChecked">
                            <button type="compendium" class="sheet-HideIfCloseChecked" name="attr_INV_buttonInfo" title="Compendium Info Button - Click to open compendium entry"></button>
                          </span>
                        </div>
                          <input type="checkbox" name="attr_INV_ShowNotes" value="1" class="sheet-testChecked sheet-hidden">
                          <div class="sheet-HideIfNotChecked">
                            <span class="sheet-nowrap" title="@{repeating_inventory_X_INV_UnitWeight}:   Unit Weight in Pounds.">Un.Wgt.
                              <input name="attr_INV_UnitWeight" type="number" value="0" min="0" class="sheet-numShort">
                            </span>
                            <span class="sheet-nowrap" title="@{repeating_inventory_X_INV_TotalWeight}:   Total Weight in Pounds.">Tot.Wgt.
                              <input name="attr_INV_TotalWeight" type="number" value="(@{INV_UnitWeight}*@{INV_Qty})"  disabled class="sheet-numShort" readonly>
                            </span>
                            <textarea name="attr_INV_Notes" class="sheet-details-small" title="@{repeating_inventory_X_INV_Notes}   Detail of Item" placeholder="Detail of Item"></textarea>
                          </div>
                        </fieldset>
                              <!--Equipment - Inventory - Notes-->
                        <div class="sheet-headerbar">Notes</div>
                        <div class="sheet-content">
                          <span class="sheet-nowrap3 sheet-label" title="@{Weight-Gear}:   Approximate weight of all gear listed on Gear tab that your character routinly carries on his person (as opposed to saddlebags, packhorses, Etc.)" >Est. other weight:
                            <input name="attr_Weight-Gear" type="number" value="0" min="0" class="sheet-selShort">
                          </span>
                          <textarea name="attr_gear-Inventory" class="sheet-text-left sheet-autoexpand sheet-details" style="height: 100px;" title="@{gear-Inventory}" placeholder="Inventory Gear here." ></textarea>
                        </div>
                      </div>
                    </div>    <!-- end of leftpane inventory -->

                  </div>

                </div>    <!-- ********************************** End of Section Equipment  ****************************-->




              <!-- *********************************************** Start of Section Adjustment (renamed Parameter) **************************** -->
        <div class="sheet-section sheet-section-adjustments sheet-ShowIfObject">
                <!--Adjust - Header-->
          <div class="sheet-headerbar sheet-headerbar-flex sheet-ShowIfObject">
            <div>
              <label title="@{attr_tab11-attrib-view} : Toggles the view of Attributes in the left pane . " class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-attrib-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab11-defense-view} : Toggles the view of Defenses in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-defense-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
              <label title="@{attr_tab11-mods-view} : Toggles the view of Modifiers in the left pane ." class="sheet-HideIfOverview sheet-HideIfCombat">
                <input type="checkbox" name="attr_tab11-mods-view" value="1" class="sheet-iconcheckbox"><span class="sheet-iconlabel-white sheet-icon-leftpane"></span>
              </label>
            </div>
            Parameters <div></div>
          </div>
          <div class="sheet-sec-spacer sheet-ShowIfObject"></div>
          <div class=" sheet-ShowIfObject">
            <input type="checkbox" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab1" value="1" title="Character Adjustments." checked ><button type="action" value="1" name="act_tab-adjust">Adjustments</button>
            <input type="checkbox" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab2" value="2" title="Creature.">                      <button type="action" value="2" name="act_tab-adjust" class="sheet-HideIfObject">Creature</button>
            <input type="checkbox" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab3" value="3" title="Sheet Adjustments.">             <button type="action" value="3" name="act_tab-adjust">Sheet</button>
            <input type="checkbox" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab4" value="4" title="Relese Notes.">                  <button type="action" value="4" name="act_tab-adjust">R.Notes</button>
            <input type="checkbox" name="attr_tab-adjust" class="sheet-tabAdjust sheet-tab5" value="5" title="Help.">                          <button type="action" value="5" name="act_tab-adjust">Help</button>
          </div>
          <!-- <div class="sheet-sec-border-line"></div> -->

          <input type="hidden" name="attr_tab-adjust" class="sheet-tabAdjust" value="1">

                  <!--Adjust - Common Subsection-->
          <div class="sheet-section-adjustments-common sheet-ShowIfObject">
            <div class="sheet-headerbar sheet-ShowIfObject">Character Adjustments</div>
            <span class="sheet-info" title="Everything here is calculated or entered on other tabs. This is a place where more or less permanent adjustments can be made. For example: If you tie a thread to an item that gives you a +2 to Physical Defense, you should add the +2 on this tab.  Buffs and other temporary modifications to Defenses and Armor should be made on the Combat Tab. It is a very good idea to use the notes field at the bottom to document the reason for each adjustment.">i</span>
            <div class="sheet-content sheet-ShowIfObject">
              <span class="sheet-nowrap3 sheet-label" title="@{NPC}   Is this character a PC, NPC, Mook, or Object?   (Mook means more than one token shares one character sheet) (Object means it is not really a character at all)">PC / NPC?
                <select name="attr_NPC" class="sheet-selShort">
                  <option value="0" title="PC"> PC</option>
                  <option value="1" selected title="NPC" > NPC</option>
                  <option value="2" title="Mook"> Mook</option>
                  <option value="-1" title="Object - The token is not really a character at all, but is an object such as a campfire or a torch."> Object</option>
                </select>
              </span>
              <br>

                    <!--Adjust - Common - Attributes-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort sheet-table-left">Attributes :</span>
                  <span class="sheet-table-data sheet-numLong">Dex</span>
                  <span class="sheet-table-data sheet-numLong">Str</span>
                  <span class="sheet-table-data sheet-numLong">Tou</span>
                  <span class="sheet-table-data sheet-numLong">Per</span>
                  <span class="sheet-table-data sheet-numLong">Wil</span>
                  <span class="sheet-table-data sheet-numLong">Cha</span>
                  <span class="sheet-table-data sheet-numLong">Init.</span>
                  <span class="sheet-table-data sheet-numLong">Recov.</span>
                  <span class="sheet-table-data sheet-numLong">Knockd.</span>
                  <span class="sheet-table-data sheet-numLong">JumpUp</span>
                </div>
                      <!--Adjust - Common - Attributes - Value-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Value: </span>
                  <span class="sheet-table-data" title="@{Dex-Adjust-attr}:   Adjustment to the Dex attribute."> <input name="attr_Dex-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Str-Adjust-attr}:   Adjustment to the Str attribute."> <input name="attr_Str-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Tou-Adjust-attr}:   Adjustment to the Tou attribute."> <input name="attr_Tou-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Per-Adjust-attr}:   Adjustment to the Per attribute."> <input name="attr_Per-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Wil-Adjust-attr}:   Adjustment to the Wil attribute."> <input name="attr_Wil-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Cha-Adjust-attr}:   Adjustment to the Cha attribute."> <input name="attr_Cha-Adjust-attr" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                </div>
                      <!--Adjust - Common - Attributes - Step-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Step: </span>
                  <span class="sheet-table-data" title="@{Dex-Adjust}:   Adjustment to the Dex step."> <input name="attr_Dex-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Str-Adjust}:   Adjustment to the Str step."> <input name="attr_Str-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Tou-Adjust}:   Adjustment to the Tou step."> <input name="attr_Tou-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Per-Adjust}:   Adjustment to the Per step."> <input name="attr_Per-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Wil-Adjust}:   Adjustment to the Wil step."> <input name="attr_Wil-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Cha-Adjust}:   Adjustment to the Cha step."> <input name="attr_Cha-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" ></span>
                  <span class="sheet-table-data" title="@{Initiative-Adjust}:   Adjustment to the Dex Initiative step."><input name="attr_Initiative-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Initiative-Adjust}:   Misc Initiative adjustment."> </span>
                  <span class="sheet-table-data" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step."><input name="attr_Recovery-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Adjust}:   Adjustment to the Toughness Recovery step."></span>
                  <span class="sheet-table-data" title="@{Knockdown-Adjust}:   Adjustment to the Strength Knockdown step."><input name="attr_Knockdown-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Knockdown-Adjust}:   Misc Knockdown test adjustment."></span>
                  <span class="sheet-table-data" title="@{JumpUp-Adjust}:   Adjustment to the Strength JumpUp step."><input name="attr_JumpUp-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{JumpUp-Adjust}:   Misc JumpUp test adjustment."></span>
                </div>
                      <!--Adjust - Common - Attributes - Karma-Max-->
                <div class="sheet-table-row sheet-api  sheet-HideIfNoKarma">
                  <span class="sheet-table-data sheet-label sheet-table-left">Maximum Karma Allowed : </span>
                  <span class="sheet-table-data" title="@{Dex-Karma-Limit_max}:   Adjustment to the Dex step."> <input name="attr_Dex-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Str-Karma-Limit_max}:   Adjustment to the Str step."> <input name="attr_Str-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Tou-Karma-Limit_max}:   Adjustment to the Tou step."> <input name="attr_Tou-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Per-Karma-Limit_max}:   Adjustment to the Per step."> <input name="attr_Per-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Wil-Karma-Limit_max}:   Adjustment to the Wil step."> <input name="attr_Wil-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Cha-Karma-Limit_max}:   Adjustment to the Cha step."> <input name="attr_Cha-Karma-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Initiative-Karma-Limit_max}   What is the maximum number of Karma that can be used on Initiative test?">      <input type="number" min="0" max="3" value="0" name="attr_Initiative-Karma-Limit_max" class="sheet-numShort sheet-HideSpinners">            </span>
                  <span class="sheet-table-data" title="@{Recovery-Karma-Limit_max}   What is the maximum number of Karma that can be used on Recovery test?">                <input type="number" min="0" max="3" value="0" name="attr_Recovery-Karma-Limit_max" class="sheet-numShort sheet-HideSpinners">              </span>
                </div>
                      <!--Adjust - Common - Attributes - DP-Max-->
                <div class="sheet-table-row sheet-HideIfNotQuest sheet-api sheet-table-left"><span class="sheet-table-data sheet-label">Maximum DP Allowed: </span>
                  <span class="sheet-table-data" title="@{Dex-DP-Limit_max}:   Adjustment to the Dex step."> <input name="attr_Dex-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Str-DP-Limit_max}:   Adjustment to the Str step."> <input name="attr_Str-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Tou-DP-Limit_max}:   Adjustment to the Tou step."> <input name="attr_Tou-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Per-DP-Limit_max}:   Adjustment to the Per step."> <input name="attr_Per-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Wil-DP-Limit_max}:   Adjustment to the Wil step."> <input name="attr_Wil-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Cha-DP-Limit_max}:   Adjustment to the Cha step."> <input name="attr_Cha-DP-Limit_max" type="number" value="0" class="sheet-numShort sheet-HideSpinners" max="3" min="0"></span>
                  <span class="sheet-table-data" title="@{Initiative-DP-Limit_max}   What is the maximum number of Devotion Points that can be used on Initiative test?">            <input type="number" value="0" min="0" max="3" name="attr_Initiative-DP-Limit_max" class="sheet-numShort sheet-HideSpinners">          </span>
                  <span class="sheet-table-data" title="@{Recovery-DP-Limit_max}   What is the maximum number of Devotion Points that can be used on Recovery test?">            <input type="number" value="0" min="0" max="3" name="attr_Recovery-DP-Limit_max" class="sheet-numShort sheet-HideSpinners">          </span>
                </div>
                      <!--Adjust - Common - Attributes - Roll Type-->
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Visibility :</span>
                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Dex}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Dex" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Dex" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>
                        <select name="attr_RollType-Dex" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                        <select name="attr_RollType-Dex" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Str}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Str" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Str" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Str" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Str" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Tou}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Tou" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Tou" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Tou" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Tou" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Per}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Per" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Per" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Per" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Per" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Wil}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Wil" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Wil" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Wil" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Wil" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>

                  <span class="sheet-table-data">
                    <span class="" title="@{RollType-Cha}   Rolls should be made: public, gm, or hidden?">
                      <input class="sheet-testRepEditMode sheet-hidden" checked type="checkbox">
                      <span class="sheet-iconselect-span">
                        <span class="sheet-iconselect-icon">
                          <input class="sheet-hidden sheet-testCloseChecked" checked type="checkbox" name="attr_RollType-Cha" value="@{RollType}"> <span class="sheet-HideIfNotCloseChecked" title="Roll Results visibility is set in the header.">Default</span>
                          <!-- <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-dice" title="Roll Results are visible by all."></span> -->
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value=" "> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-public" title="Roll Results are visible by all."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="pgm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-PGM" title="Roll Results are visible by this player and the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="/w gm"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-GM" title="Roll Results are visible only by the GM."></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                          <input class="sheet-hidden sheet-testCloseChecked" type="checkbox" name="attr_RollType-Cha" value="?{Who should be able to see the results|Public, |GM Only,/w gm}"> <span class="sheet-iconstatic sheet-HideIfNotCloseChecked sheet-icon-rolltype-ask" title="This setting is for the visibility of roll results"></span>
                        </span>

                        <select name="attr_RollType-Cha" class="sheet-api sheet-w25px sheet-api sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="pgm" title="This setting is for the visibility of roll results"> Player&GM --- Roll results will be hidden from other players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="RollType: ?{Who should be able to see the results|Public, |Player & GM,pgm|GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>

                        <select name="attr_RollType-Cha" class="sheet-NoAPI sheet-w25px sheet-NoAPI sheet-iconselect-select">
                          <option value="@{RollType}" selected title="Default as selected on the header near the name"> Default --- The default value set in the header will be used</option>
                          <option value=" " title="This setting is for the visibility of roll results"> Public --- Roll Results will be visible to all players</option>
                          <option value="/w gm" title="This setting is for the visibility of roll results"> GM Only --- Roll Results will be visible from GM Only</option>
                          <option value="?{Who should be able to see the results|Public, |GM Only,/w gm}"
                          title="This setting is for the visibility of roll results"> Ask --- A pop-up will ask visibility for each roll</option>
                        </select>
                      </span>
                    </span>
                  </span>
                </div>
              </div>
              <br>

                    <!--Adjust - Common - Defense & Armor-->
              <div class=" sheet-ShowIfObject">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-selLong">Defense&Armor:</span>
                  <span class="sheet-table-data sheet-numLong">PD</span>
                  <span class="sheet-table-data sheet-numLong">MD</span>
                  <span class="sheet-table-data sheet-numLong">SD</span>
                  <span class="sheet-table-data sheet-numLong">PA</span>
                  <span class="sheet-table-data sheet-numLong">MA</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Natural</span>
                  <span class="sheet-table-data"><input name="attr_Defense-Phys-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Phys-Nat-Adjust}:   Misc adjustment to Natural Physical Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Myst-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Myst-Nat-Adjust}:   Misc adjustment to Natural Mystical Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Soc-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Soc-Nat-Adjust}:   Misc adjustment to Natural Social Defense. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Phys-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Phys-Nat-Adjust}:   Misc adjustment to Natural Physical Armor. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Myst-Nat-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Myst-Nat-Adjust}:   Misc adjustment to Natural Mystic Armor. In Edition 3, this does include bonuses inherent from their Discipline, but does not include bonuses provided by spells, talents, or woven threads. In Edition 4, Bonus from Disciplines are automatically added.">                    </span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Normal</span>
                  <span class="sheet-table-data"><input name="attr_Defense-Phys-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Phys-Adjust}:   Misc Physical Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Myst-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Myst-Adjust}:   Misc Mystical Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Defense-Soc-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Defense-Soc-Adjust}:   Misc Social Defense adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Phys-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Phys-Adjust}:   Misc Physical Armor adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                  <span class="sheet-table-data"><input name="attr_Armor-Myst-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Armor-Myst-Adjust}:   Misc Mystic Armor adjustment. Includes everything except bonuses inherent from Disciplines.">                    </span>
                </div>
              </div>
              <br>
                    <!--Adjust - Common - Health Ratings-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort">Health Ratings :</span>
                  <span class="sheet-table-data sheet-numLong">Unc.</span>
                  <span class="sheet-table-data sheet-numLong">Death.</span>
                  <span class="sheet-table-data sheet-nowrap">Wound Tr.</span>
                  <span class="sheet-table-data sheet-nowrap">Recov./day</span>
                  <span class="sheet-table-data sheet-nowrap">Durability</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data" ></span>
                  <span class="sheet-table-data"><input name="attr_Damage-Unconscious-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Damage-Unconscious-Adjust}:   Adjustment to the calculated Unconscious Rating."></span>
                  <span class="sheet-table-data"><input name="attr_Damage-Death-Rating-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Damage-Death-Rating-Adjust}:   Adjustment to the calculated Death Rating."></span>
                  <span class="sheet-table-data"><input name="attr_Wound-Threshold-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Wound-Threshold-Adjust}:   Adjustment to the calculated Wound Threshold."></span>
                  <span class="sheet-table-data"><input name="attr_Recovery-Tests-Misc-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Tests-Misc-Adjust}:   Adjustment to the number of Recovery Tests per day."></span>
                  <span class="sheet-table-data"><input name="attr_Durability-Rating-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Durability-Rating-Adjust}:   Adjustment to the highest Circle when calculating Durability  see PG232."></span>
                </div>
              </div>
              <br>
                    <!--Adjust - Common - Discipline Adjust-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtMed">Discipline Adjust :</span>
                  <span class="sheet-table-data sheet-numLong">PD</span>
                  <span class="sheet-table-data sheet-numLong">MD</span>
                  <span class="sheet-table-data sheet-numLong">SD</span>
                  <span class="sheet-table-data sheet-numLong">PA</span>
                  <span class="sheet-table-data sheet-numLong">MA</span>
                  <span class="sheet-table-data sheet-numLong">Init.</span>
                  <span class="sheet-table-data sheet-numLong">Recov.</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data"></span>
                  <span class="sheet-table-data" title="@{Defense-Phys-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Physical Defense"><input readonly name="attr_Defense-Phys-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Defense-Myst-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Mystical Defense"><input readonly name="attr_Defense-Myst-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Defense-Soc-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Social Defense"><input readonly name="attr_Defense-Soc-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Armor-Phys-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Physical Armor"><input readonly name="attr_Armor-Phys-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Armor-Myst-Nat-Auto-Adjust}:   Automatic adjustment from Discipline to Natural Mystic Armor"><input readonly name="attr_Armor-Myst-Nat-Auto-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" >                    </span>
                  <span class="sheet-table-data" title="@{Initiative-Auto-Adjust}:   Adjustment to the Dex Initiative step."><input name="attr_Initiative-Auto-Adjust" type="number" value="0" readonly class="sheet-numShort sheet-HideSpinners" title="@{Initiative-Auto-Adjust}:   Automatic adjustment from Discipline to Initiative."> </span>
                  <span class="sheet-table-data" title="@{Recovery-Tests-Auto-Adjust}:   Adjustment to the Toughness Recovery step."><input name="attr_Recovery-Tests-Auto-Adjust" readonly type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Recovery-Auto-Adjust}:   Automatic adjustment from Discipline to Number of Recovery Tests."></span>
                </div>
              </div>
              <div>
                <b class="sheet-label"> Custom Karma Ablities</b>
                <br>
                <textarea name="attr_Custom-Karma-Ability" class="sheet-details-small" style="width:50%" title="@{Custom-Karma-Ability}   Note here any specific Karma or Devotion Ability not automatically detected." placeholder="Custom Karma Ability. Document Here any specific Karma or Devotion Ability in addition to the ones automatically detected."></textarea>
              </div>

              <br>

                    <!--Adjust - Common - Misc-->
              <div class="">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShort">Misc :</span>
                  <span class="sheet-table-data sheet-numLong">IP</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Pool</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Mod Adjust</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Step</span>
                  <span class="sheet-table-data sheet-nowrap">Karma Ritual</span>
                  <span class="sheet-table-data sheet-nowrap sheet-HideIfNotQuest">DP Step</span>
                  <span class="sheet-table-data sheet-nowrap">Carry</span>
                  <span class="sheet-table-data sheet-nowrap">Movement</span>
                  <input name="attr_Fly_max" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                  <span class="sheet-table-data sheet-nowrap sheet-HideIfNotCloseChecked">Fly Mov</span>
                  <span class="sheet-table-data sheet-nowrap">Reknown</span>
                  <span class="sheet-table-data sheet-nowrap">Reputation</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data "></span>
                  <span class="sheet-table-data"><input name="attr_Misc-IP-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-IP-Adjust}:   Misc Initiative Penalty adjustment."></span>
                  <span class="sheet-table-data">
                    <input name="attr_Misc-Karma-max-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Karma-max-Adjust}:   Adjustment to Karma Max.">
                  </span>
                  <span class="sheet-table-data">
                    <input name="attr_Karma-Modifier-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Karma-Modifier-Adjust}:   Adjustment to the Racial Karma Modifier.">
                  </span>
                  <span class="sheet-table-data">
                    <select name="attr_KarmaStep" class="sheet-selLong" title="@{KarmaStep}   What karma dice does this character roll">
                      <option value="3" title="D4 - Step 3.">S3: D4</option>
                      <option value="4" selected="selected" title="D6 - Step 4. Standard.">S4:  D6</option>
                      <option value="5" title="D8 - Step 5.">S5: D8</option>
                      <option value="6" title="D10 - Step 6.">S6: D10</option>
                      <option value="7" title="D12 - Step 7.">S7: D12</option>
                      <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                      <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                      <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                      <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                      <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                      <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                      <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                      <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                      <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                      <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                      <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                      <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                      <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                    </select>
                  </span>
                  <span class="sheet-table-data">
                    <select class="sheet-selShort" name="attr_Misc-KarmaRitual" title="@{Misc-KarmaRitual}:   Effect of Karma Ritual (used for the NewDay button)">
                      <option selected value="-1" title="Default Setting for ED4 - Karma Ritual refills the Karma Pool"> Fill</option>
                      <option value="-2" title="Homerule Setting - Karma Ritual refills Circle Karma Points per Day to the Karma Pool"> Circle </option>
                      <option value="-3" title="Homerule Setting- Karma Ritual refills Racial Modifier Karma Points per Day to the Karma Pool"> Mod </option>
                      <option value="-4" title="Setting for older editions (API only) - Declare a Talent as Special : Karma Ritual, and it will refills its Rank per day"> Talent </option>
                      <option value="0" title="Homerule Setting - No Karma Ritual on New Day">0</option>
                      <option value="1" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">1</option>
                      <option value="2" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">2</option>
                      <option value="3" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">3</option>
                      <option value="4" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">4</option>
                      <option value="5" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">5</option>
                      <option value="6" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">6</option>
                      <option value="7" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">7</option>
                      <option value="8" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">8</option>
                      <option value="9" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">9</option>
                      <option value="10" title="Homerule Setting - Karma Ritual refills X Karma Points per Day to the Karma Pool">10</option>
                    </select>
                  </span>

                  <span class="sheet-table-data sheet-HideIfNotQuest">
                    <select name="attr_DevotionStep" class="sheet-selLong" title="@{DevotionStep}   What DP dice does this character roll">
                      <option value="3" selected="selected" title="D4 - Step 3.">S3: D4</option>
                      <option value="4" title="D6 - Step 4. Standard.">S4:  D6</option>
                      <option value="5" title="D8 - Step 5.">S5: D8</option>
                      <option value="6" title="D10 - Step 6.">S6: D10</option>
                      <option value="7" title="D12 - Step 7.">S7: D12</option>
                      <option value="8" title="2D6 - Step 8.">S8: 2D6</option>
                      <option value="9" title="D6+D8 - Step 9.">S9: D6+D8</option>
                      <option value="10" title="2D8 - Step 10.">S10: 2D8</option>
                      <option value="11" title="D8+D10 - Step 11.">S11: D8+D10</option>
                      <option value="12" title="2D10 - Step 12.">S12: 2D10</option>
                      <option value="13" title="D10+D12 - Step 13.">S13: D10+D12</option>
                      <option value="14" title="2D12 - Step 14.">S14: 2D12</option>
                      <option value="15" title="2D6+D12 - Step 15.">S15: 2D6+D12</option>
                      <option value="16" title="D6+D8+D12 - Step 16.">S16: D6+D8+D12</option>
                      <option value="17" title="2D8+D12 - Step 17.">S17: 2D8+D12</option>
                      <option value="18" title="D8+D10+D12 - Step 18.">S18: D8+D10+D12</option>
                      <option value="19" title="2D6+D20 - Step 19.">S19: 2D6+D20</option>
                      <option value="20" title="D6+D8+D20 - Step 20.">S20: D6+D8+D20</option>
                    </select>
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-Carry-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Carry-Adjust}:   Adjustment to Carrying Capacity."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Movement-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Movement-Adjust}:   Adjustment to unmounted movement."></span>
                  <input name="attr_Fly_max" type="checkbox" class="sheet-hidden sheet-testCloseChecked" value="1" >
                  <span class="sheet-table-data sheet-HideIfNotCloseChecked"><input name="attr_Misc-Fly-Movement-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Fly-Movement-Adjust}:   Adjustment to  Fly movement."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Renown-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Renown-Adjust}:   Adjustment to Renown."></span>
                  <span class="sheet-table-data"><input name="attr_Misc-Reputation-Adjust" type="number" value="0" class="sheet-numShort sheet-HideSpinners" title="@{Misc-Reputation-Adjust}:   Adjustment to Reputation."></span>
                </div>
              </div>
              <br>

                    <!--Adjust - Common - Parameters-->
              <div class="sheet-table-left">
                <div class="sheet-table-row sheet-table-header">
                  <span class="sheet-table-data sheet-txtShortShort">Parameters :</span>
                  <span class="sheet-table-data sheet-numLong">Bonus</span>
                  <span class="sheet-table-data sheet-numLong">Penalty</span>
                  <span class="sheet-table-data sheet-numLong">Strain</span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Defensive Stance</span>
                  <span class="sheet-table-data"><input name="attr_Misc-DefStance-Bonus" type="number" value="3" min="0" max="9"
                  class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-DefStance-Bonus}:   When in Defensive Stance, what is bonus to the characters PD and MD? This is usually three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-DefStance-Penalty" type="number" value="-3" min="-9" max="0"
                    class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-DefStance-Penalty}:   When in Defensive Stance, what is penalty to the characters Action Tests? This is usually minus three.">
                   </span>
                </div>
                <div class="sheet-table-row">
                  <span class="sheet-table-data sheet-label sheet-table-left">Aggressive Attack</span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Bonus" type="number" value="3" min="0" max="9" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Bonus}:   When Aggressively Attacking, what is the bonus to attacks and damage? This is usually three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Penalty" type="number" value="-3" min="-9" max="0" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Penalty}:   When Aggressively Attacking, what is the Penalty to the characters PD and MD? This is usually minus three.">
                  </span>
                  <span class="sheet-table-data"><input name="attr_Misc-AggStance-Strain" type="number" value="1" class="sheet-numShort sheet-HideSpinners"
                    title="@{Misc-AggStance-Strain}:   How much Strain does this character take with each Aggressive Attack. This is usually one except for Journeyman or higher Sky Raiders.">
                  </span>
                </div>
              </div>
                    <!--Adjust - Common - Masks-->
              <!-- <input class="sheet-testNum" name="attr_MaskList" value="0" type="hidden">
              <div class="sheet-HideIfZero">
                Masks:
                <label class="sheet-autoexpand-wrap" title="@{MaskList}   Names of Masks applied to this character.">
                  <input name="attr_MaskList" type="text" value="0" readonly>
                  <span name="attr_MaskList" class="sheet-autoexpand" ></span>
                </label><br>
                <textarea name="attr_MaskDetail" class="sheet-details" readonly title="@{MaskDetail}   Mask text detailing the Mask Template."></textarea>
              </div> -->
              <span class="sheet-table-data sheet-txtShortShort sheet-label">Masks </span>
              <div style="font-size: x-small;">
                This section tracks the masks and other automatic modifiers, so that you can delete them.
                Deleting will reverse the modifications to values (Attributes, Characteristics, Ranks), but doesn't delete Powers and Maneuvers
              </div>
              <fieldset class="repeating_masks">
                <div class="sheet-nowrap">
                  <input name="attr_MSK_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                  <input name="attr_MSK_Name" type="text" class="sheet-hidden sheet-testPlaceholder" placeholder="Name">
                  <textarea name="attr_MSK_textImport" placeholder="text import" class="sheet-textimport sheet-hideIfNotPlaceholder" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Important Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'."></textarea>
                  <input type="text" readonly name="attr_MSK_Name" class="sheet-txtShort sheet-bordered-bottom sheet-text-left sheet-hideIfPlaceholder" placeholder="Name" title="@{repeating_masks_X_MSK_Name}: Lists the Masks applied to the character. Import to add, but you can delete here.">
                  <label class="sheet-autoexpand-wrap sheet-hideIfPlaceholder" title="@{repeating_masks_X_MSK_Details}: Mask Data.">
                    <input name="attr_MSK_Details" type="text" value="0" readonly>
                    <span name="attr_MSK_Details" class="sheet-autoexpand" readonly></span>
                  </label>
                </div>
              </fieldset>


                    <!--Adjust - Common - Notes-->
              <div style="font-size: x-small;">
                Document every permanent or semi-permanent adjustment here. You or your GM should be able to glance at these notes and know why every adjustment has been made. Example typical entry might be "MD +3: +1 Wiz 2nd, +2 Group thread".
              </div>
              <textarea name="attr_Adjustment-Notes" class="sheet-details-big"  title="@{Adjustment-Notes}   Notes on why certain things are adjusted here." placeholder="Notes on why certain things are adjusted here."></textarea>
            </div>
          </div>    <!-- end Adjust - Common Subsection -->


                <!-- Adjust - Maneuvers -->
          <div class="sheet-section-adjustments-maneuvers">
            <div class="sheet-headerbar">Special Maneuvers & Powers</div>

            <div style="font-size: x-small;">
              For creatures, document here the special maneuvers that the creature have. This will control how control icons will be displayed, and how maneuver options are offered in combat
            </div>

                  <!--Adjust - Maneuvers - Creature-->
            <b class="sheet-heading sheet-text-center">Creature Powers</b>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-HardenedArmor}   Hardened Armor: Bonus damage resulting from additional successes on Attack tests is reduced by one per success. Typically, this means that instead of +2 damage per additional success, the attacker only gets +1 damage per additional success">
                Hardened Armor : <input name="attr_Creature-HardenedArmor" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{Creature-Fly_max}   Is the character able to fly.">
                <span class="sheet-iconstatic sheet-icon-flying"></span> Flight : <input name="attr_Fly_max" type="checkbox" value="1" >
              </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Creature-Fury}   Fury threshold - If non-zero, instead of suffering penalties, Wounds grant this creature a bonus to tests. Once the creature has more Wounds than indicated by the Step of this ability, the bonuses are lost and the creature suffers normal penalties for Wounds.">
                  Fury : <input name="attr_Creature-Fury" type="number" value="0" min="0" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Creature-ResistPain}   Resist Pain threshold - If non-zero, the creature ignores penalties for Wounds equal to this ability. For example, a creature with Resist Pain (2) ignores the penalties from the first two Wounds suffered.">
                  Resist Pain : <input name="attr_Creature-ResistPain" type="number" value="0" min="0" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Creature-Willful}   Willful threshold - If non-zero, Talents and abilities used to dominate, control, tame or train the creature require additional successes equal to the Step of this ability.">
                  Willful : <input name="attr_Creature-Willful" type="number" value="0" min="0" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Creature-Ambushing_max}   If the 'Ambushing' status is ON, this is the amount that is added to Initiative, Attack, and Damage.">
                  <span class="sheet-iconstatic sheet-icon-ambush"></span> Ambush : <input name="attr_Creature-Ambushing_max" type="number" value="0" min="0" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Creature-DivingCharging_max}   If the 'Diving/Charging' box is checked, this is the amount that is added to Attack, and Damage. Use this for ether Diving or Charging creature powers.">
                  <span class="sheet-iconstatic sheet-icon-charging"></span>Dive/Charge : <input name="attr_Creature-DivingCharging_max" type="number" value="0" min="0" >
                </span>
              </div>

            <b class="sheet-heading sheet-text-center">Creature Maneuvers</b>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-GrabAndBite}   Grab and Bite: The creature may spend an additional success from an Attack test to automatically grapple an opponent. Grappled opponents automatically take bite damage each round until the grapple is broken.">
                Grab and Bite : <input name="attr_Creature-GrabAndBite" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Hamstring}   Hamstring: The creature may spend an additional success from an Attack test to halve the opponents Movement until the end of the next round. If the attack causes a Wound, the penalty lasts until the Wound is healed.">
                Hamstring : <input name="attr_Creature-Hamstring" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Overrun}   Overrun: The creature may spend an additional success from an Attack test to force an opponent with a lower Strength Step to make a Knockdown test against a DN equal to the Attack test result.">
                Overrun : <input name="attr_Creature-Overrun" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title="@{Creature-Pounce}   Pounce: If the creature reaches its opponent with a leap and the opponent isnt too much larger, the creature may spend an additional success from the Attack test to force the opponent to make a Knockdown test against a DN equal to the Attack test result.">
                Pounce : <input name="attr_Creature-Pounce" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{Creature-SqueezeTheLife}   Squeeze the Life: The creature may spend two additional successes from an Attack test to automatically grapple an opponent. Grappled opponents automatically take claw damage each round until the grapple is broken">
                Squeeze the Life : <input name="attr_Creature-SqueezeTheLife" type="checkbox" value="1" >
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{TailAttack_max}   Ability to do Tail Attacks like T'skrangs.">
                <span class="sheet-iconstatic sheet-icon-tail"></span> Tail Attack : <input name="attr_TailAttack_max" type="checkbox" value="1" >
              </span>

            </div>


                  <!--Adjust - Maneuvers - Opponent-->
            <b class="sheet-heading sheet-text-center">Opponent Maneuvers</b>
            <div class="sheet-content">
              <div class="sheet-content">
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-ClipTheWing}   Clip the Wing: The attacker may spend two additional successes from an Attack test to remove the creatures ability to fly until the end of the next round. If the attack causes a Wound, the creature cannot fly until the Wound is healed. If the creature is in flight, it falls and suffers falling damage for half the distance fallen.">
                  Clip the Wing : <input name="attr_Opponent-ClipTheWing" type="checkbox" value="1" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-CrackTheShell}   Crack the Shell: The attacker may spend extra successes from physical attacks (not spells) to reduce the creatures Physical Armor by 1 per success spent. This reduction takes place after damage is assessed, and lasts until the end of combat.">
                  Crack the Shell : <input name="attr_Opponent-CrackTheShell" type="checkbox" value="1" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Defang}   Defang: The opponent may spend additional successes to affect the creatures ability to use its poison. Each success spent reduces the Poisons Step by 2. If the attack causes a Wound, the creature cannot use its Poison power at all until the Wound is healed">
                  Defang : <input name="attr_Opponent-Defang" type="checkbox" value="1" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Enrage}   Enrage: An opponent may spend additional successes from an Attack test to give a -1 penalty to the creatures Attack tests and Physical Defense until the end of the next round. Multiple successes may be spent for a cumulative effect.">
                  Enrage : <input name="attr_Opponent-Enrage" type="checkbox" value="1" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-Provoke}   Provoke: The attacker may spend two additional successes from an Attack test to enrage the creature and guarantee he will be the sole target of the creatures next set of attacks. Only the most recent application of this maneuver has any effect.">
                  Provoke : <input name="attr_Opponent-Provoke" type="checkbox" value="1" >
                </span>
                <span class="sheet-nowrap2 sheet-label" title="@{Opponent-PryLoose}   Pry Loose: The attacker may spend additional successes from an Attack test to allow a grappled ally to immediately make an escape attempt with a +2 bonus per success spent on this maneuver">
                  Pry Loose : <input name="attr_Opponent-PryLoose" type="checkbox" value="1" >
                </span>
              </div>
            </div>

                  <!--Adjust - Maneuvers - Custom-->
            <b class="sheet-heading sheet-text-center"> Custom Maneuvers </b>
            <div class="sheet-content">
              <input name="attr_ManRowIdList" type="hidden" > <!-- Keep a list of RowIDs for this fieldset, so we can process though them quicker  -->
              <fieldset class="repeating_maneuvers">
                <div>
                  <input name="attr_MAN_RowID" type="hidden" class="sheet-testRowID" value=""><span></span>
                  <input type="checkbox" name="attr_MAN_Type" value="1" checked class="sheet-testChecked sheet-hidden">
                  <span class="sheet-nowrap0">
                    <label class="sheet-HideIfNotChecked" >
                      <input type="checkbox" name="attr_MAN_Type" value="-1" checked class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-creature" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                    <label class="sheet-HideIfChecked">
                      <input type="checkbox" name="attr_MAN_Type" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelCC sheet-icon-maneuver-opponent" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver."></span>
                    </label>
                  </span>
                  <span class="sheet-fixed-width sheet-titlespan sheet-txtLong sheet-bordered-bottom">
                    <input name="attr_MAN_Name" type="text" class="sheet-fixed-width sheet-txtLong" placeholder="name" title="@{repeating_maneuvers_MAN_Name} Use these fields to specify a custom Maneuvers (Opponent or Creature). ">
                  </span>
                  <label title="@{repeating_maneuvers_X_MAN_ShowNotes}   Show description of Maneuver">
                    <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabelsmall sheet-icon-notes"></span>
                  </label>
                  <span class="sheet-fixed-width sheet-w30px">
                  <label class="sheet-HideIfChecked" title="@{repeating_maneuvers_MAN_Show} Use these field to hide/show Opponent maneuvers. It will not be offered up to the user as a way to spend extra successes unless the 'Show' field is checked. This allows the GM to get the opponent maneuvers all setup but not let the players see them until they have passed a knowledge test.">
                    <input type="checkbox" name="attr_MAN_Show" value="1" class="sheet-iconcheckbox"> <span class="sheet-iconlabel sheet-icon-maneuver-show"></span>
                  </label>
                </span>
                </div>
                <input type="checkbox" name="attr_MAN_ShowNotes" value="1" class="sheet-hidden sheet-testChecked">
                <div class="sheet-HideIfNotChecked">
                  <textarea name="attr_MAN_Desc" class="sheet-details" title="@{repeating_maneuvers_MAN_Desc} Use these fields to specify a custom Maneuvers (Opponent or Creature). A text description of the maneuver." placeholder="Description of the Maneuver and how it works."></textarea>
                </div>
              </fieldset>
            </div>

                  <!--Adjust - Maneuvers - Misc-->
            <b class="sheet-heading sheet-text-center">    Horror Powers  </b>
            <div class="sheet-content">
              <span class="sheet-nowrap2 sheet-label" title='@{Creature-CorruptKarmaBank}   This is the bank of &#34;Corrupt Karma&#34; points that horrors have accumulated against this character. Then these points are transfered to the follow field is when they actually affect the character. This will usually not be set directly using this field, instead, a Talent named &#34;Corrupt Karma&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Corrupt Karma&#34; will be run and the resulting number of successes will automatically be added to this field.'>
                Corrupt Karma : <input name="attr_Creature-CorruptKarmaBank" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2" title='@{Creature-CorruptKarma}   This is the number of Karma Dice that will be negated in the next rolls. This will usually not be set directly using this field, instead, a Talent named &#34;Corrupt Karma&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Corrupt Karma&#34; will have next to it a button (and a Token Action) that when run will transfer &#34;Corrupt Karma Points&#34; from the bank (previous field) to this field. IE: when the &#34;Corrupt Karma&#34; power is to be used, the GM should tell the players to check with them before making rolls, and when the player is making a roll with karma that the GM wishes to have corrupted, the GM should use the provided Token Action to set a value in this field.'>
                <input name="attr_Creature-CorruptKarma" type="number" value="0" min="0" >
              </span>
              <span class="sheet-nowrap2 sheet-label" title='@{Creature-CursedLuck}   This is the number of Dice that will be &#34;cursed&#34; (set to 1) during the next roll. This will usually not be set directly using this field. Instead, a Talent named &#34;Cursed Luck&#34; (the Talents tab is used for Horror Powers) that has the field &#34;Special&#34; set to &#34;Cursed Luck&#34; will be run, and it will automatically set this field to the number of successes rolled.'>
                Cursed Luck : <input name="attr_Creature-CursedLuck" type="number" value="0" min="0" >
              </span>

            </div>
          </div>    <!-- end Adjust - Creature -->

                <!-- Adjust - Sheet -->
          <div class="sheet-section-adjustments-advanced sheet-ShowIfObject">
            <div class="sheet-headerbar sheet-ShowIfObject">Sheet and API parameters</div>
            <div class="sheet-content sheet-ShowIfObject">
              <b class="sheet-heading">Sheet Options</b>
              <br>

              <!-- <span class="sheet-nowrap3 sheet-label" title="@{show_tips_startup}  Toggle to show back the tips & tricks at each opening of the sheet for PC sheets.">
              Show tips at Startup :
              <input name="attr_show_tips_startup" checked type="checkbox" value="1">
              <br>
            </span> -->

              <span class="sheet-nowrap3" title="@{StepDisplayFinal}   Parameter to decide between displaying the Base Value (without modifiers) or Final Value (after all Modifiers) in each of the steps. .">
                <select name="attr_StepDisplayFinal" class="sheet-txtLong">
                  <option value="0" title="@{StepDisplayFinal} : Show Base Value for each of the Steps, i.e. the permanent step independantly from any temporary modifier"> Show Base Values</option>
                  <option value="1" selected title="@{StepDisplayFinal} Show Final Value for each of the Steps, i.e. the current step as it will be rolled including all temporary modifier"> Show Final Values</option>
                </select>
              </span>

              <br>
                    <!-- Adjust - Advanced - Line 1 -->
              <span class="sheet-nowrap3" title="@{Hide-Spells-Tab}   Hide the Spell tabs?   If the character is not a spellcaster, might as well.">
                <select name="attr_Hide-Spells-Tab" class="sheet-txtMed" title="Show/Hide Spell Tab and Parameters">
                  <option value="0" title="Show Spells tab and parameter"> Show Spells</option>
                  <option selected value="1" title="Hide Spells tab and parameter"> Hide Spells</option>
                </select>
              </span>
              <span class="sheet-nowrap" title="@{API}   This checkbox allows to switch this particular character sheet from using the API or not. Please note that if you want to change all sheets, a special GM function in the dropdown below allows to do it if you have the API running and are in API Mode. Please also note that the checkbox doesn't disable the API, that will likely still run and detect stuff in the background. It just changes the display to hide/show some stuff that are meant to work with the API">
                <select name="attr_API" class="sheet-txtMed" title="Is API installed and running">
                  <option selected value="0" title="Sheet is running without API, API functionalities are disabled"> No API mode</option>
                  <option value="1" title="Sheet is running with API, API functionalities are enabled"> API Mode</option>
                  <option value="2" title="Sheet was running with API, but API has stopped responding. API functionalities are temporarily disabled"> Link to API nonresponsive</option>
                </select>
              </span>
              <span class="sheet-nowrap" title="@{CreationMode} To be unchecked at the end of creation to hide fields that are only used during PC creation. Check back to revert to creation Mode">
                <select name="attr_CreationMode" class="sheet-txtLong" title="Is Creation Mode Active">
                  <option selected value="0" title="Sheet is running in normal mode"> Creation Mode - Off</option>
                  <option value="1" title="Sheet is running in Creation Mode - Tips for Character Creation will be shown"> Creation Mode - On</option>
                </select>
              </span>

              <span class="sheet-nowrap" title="@{EffectIsAction} Optional Mode where the sheet is making no difference between Effect and Action Modifiers">
                <select name="attr_EffectIsAction" class="sheet-txtLong" title="Is API installed and running">
                  <option selected value="0" title="Sheet is running in normal mode where Effect and Action have separate modifiers"> Effect is NOT Action</option>
                  <option value="1" title="Optional Mode where Effect Rolls and Action Rolls have the same modifiers"> Effect is Action</option>
                </select>
              </span>

              <br>
              <br>
                    <!-- Adjust -Advanced - Line 2 -->
              <b class="sheet-heading"> Special Functions </b>
              <br>
              <!-- Adjust -Advanced - Line 3 -->
              <span class="sheet-nowrap5 sheet-api" title="@{SpecialFunction}   Select a special function?">
                <select name="attr_SpecialFunction" class="sheet-txtLong">
                  <option value="!Earthdawn~ charID: @{character_id}~ LinkToken: ?{Standard both sets the token to display in the standard way and links the token|Standard|SetTokenOnly|LinkOnly}" title="Selecting this and pressing Do SF will cause selected tokens to link to this character. Standard processing both sets Token to display in a standard way, and Links the token. The next two options do one or the other.">
                    Link Token
                  </option>     <!-- Note: if link token value ever gets changed, change .js newCharacter to exact match. -->
                  <option value="Recalc" selected title="Simply setting to this value will cause workers to recalculate all calculated values.">
                    Recalc
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Misc: SetAdjust: " title="Copy the buffs from the Combat Tab to the Adjustments Tab. This makes it easier for the GM to create monsters. He can set the values directly on the combat tab, then copy them to be on the Adjustments tab instead.">
                    Set Adjustments
                  </option>
                  <option value="!Earthdawn~ ChatMenu: gmState: ED" title="GM can set several State Variables that change how all sheets act.">
                    GM: Special Commands
                  </option>
                  <option value="!Earthdawn~ Misc: MacroCreate : ?{Macros|Refresh|Create|Delete}" title="Selecting this and pressing Do SF will create all macros used by this sheet. Option to delete them and refresh them (delete followed by create).">
                    Macros
                  </option>
                  <!-- <option value="Creature" title="This option allows a creature to be imported as a Text Block formated as the GM guild, companion, etc.">
                    Import Creature
                  </option>
                  <option value="MaskApply" title="This option allows a Mask to be applied to the character.">
                    Import Mask
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ ChatMenu: Mask" title="This option allows a Mask to be removed from the character.">
                    Mask Remove
                  </option> -->
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: RepSecFix" title="This will run API code that will look for and fix any problems with repeating sections RowID's">
                    Verify/Fix Character Sheet
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Chatmenu: Inspect" title="Allows you to inspect various variables, repeating sections, etc.">
                    Inspect
                  </option>
                  <option value="!Earthdawn~ foreach~ StatusToToken" title="Set the Token to have the same conditions and status set as its associated character.">
                    Status to Token
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: test" title="This will run API code under edParse Test">
                    Test routine run
                  </option>
                  <option value="!Earthdawn~ charID: @{character_id}~ Debug: Showeach : API" title="Test code to cause whatever attributes the API is currently set to display to appear in the API Output Console.">
                    showEach API
                  </option>
                  <option value="!Earthdawn~ Debug: SheetWorkerTest" title="Simply setting to this value (no need to press Do SF button) will cause Sheetworker test to run.">
                    Sheet Worker Test
                  </option>
                  <option value="showAPImsg" title="Put to this value to see the messages sent and received from/to API.">
                    Show API messages
                  </option>
                </select>
              </span>
              <span class="sheet-nowrap5 sheet-NoAPI" title="@{SpecialFunction}   Select a special function?">
                <select name="attr_SpecialFunction" class="sheet-txtMed">
                  <option value="Recalc" title="Simply setting to this value will cause workers to recalculate all calculated values.">  Recalc</option>
                  <option value="!Earthdawn~ Debug: SheetWorkerTest" title="Simply setting to this value (no need to press Do SF button) will cause Sheetworker test to run.">  Sheet Worker Test</option>
                </select>
              </span>
              <span>
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Recalc">
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Creature">
                <input class="sheet-testChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="MaskApply">
                <span class="sheet-nowrap5 sheet-api sheet-HideIfChecked" title="This button will run whatever code is specified by the Special Function drop down menu to the left.">
                  <button class="sheet-text-button sheet-button-nodice" name="roll_SpecialFunct" type="roll"
                  value="@{SpecialFunction}" >Do SF</button>
                </span>
              </span>
              <!-- <input class="sheet-testCloseChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="Creature">
              <span class="sheet-nowrap5 sheet-HideIfNotCloseChecked" title="Into this little text box, Copy and Paste whatever huge block of text describes the Creature in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import the creature.">
                <br>Copy and Paste <i>creature</i> description (starting with name) into this tiny text box.
                <textarea name="attr_textImportCreature" placeholder="text import" class="sheet-textimport"></textarea>
                <br>
              </span>
              <input class="sheet-testCloseChecked sheet-hidden" name="attr_SpecialFunction" type="checkbox" value="MaskApply">
              <span class="sheet-nowrap5 sheet-HideIfNotCloseChecked" title="Into this little text box, Copy and Paste whatever huge block of text describes the mask in a format identical to that used in the FASA 4th edition books, and this will attempt to parse it and import.   Importaint Note! Only paste in the part that directly describes the part of the mask being applied. For example, if you are applying the 'CADAVEROUS' Mask at the 'Moderate' level, then you would copy / past starting with 'Moderate (+1 Circle)' and ending just before the line that says 'Major (+2 Circles)'.">
                <br>Copy and Paste <i>mask</i> (starting with mask name) into this tiny text box.
                <textarea name="attr_textImportMask" placeholder="text import" class="sheet-textimport"></textarea>
                <br>
              </span> -->
              <br>
              <span class="sheet-nowrap"><b>Test worker thread -</b> Change this one.
                <input name="attr_wt-test1" type="number" value="0" class="sheet-numShort" title="test1:   Worker Thread test - change this and see if the following one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">
              </span>
              <span class="sheet-nowrap"> See if this one changes.
                <input name="attr_wt-test2" type="number" value="0" class="sheet-numShort" title="test2:   See if this one changes as well. If not the worker threads are not working, probably due to parser not being able to figure out javascript.">
              </span>
              <span class="sheet-nowrap" title="@{TestText}   Test code might put something in here to be displayed.">
                <input name="attr_TestText" type="text" >
              </span>
              <br>
              <br>
              <b class="sheet-heading"> General Information </b>
              <br>
              <!-- <span class="sheet-nowrap3 sheet-label" title="@{PlayerWho}   This is the last player who pressed a button on this sheet, and sometimes the API's best guess as to who owns this sheet. It is displayed for information and debugging purposes.">
                Last User :
                <input name="attr_playerWho" type="text" class="sheet-txtMed" value="" readonly>  <!-- Contains "/w " and the name of the last person who did a roll on this sheet. It is used so the API can with acceptable accuracy whisper messages to the person most likely to be editing the sheet. -->
              <!--</span> -->
              <span class="sheet-nowrap3 sheet-label" title="@{edition}   Earthdawn Edition on which the sheet is set.">
                Edition :
                <select name="attr_edition" class="sheet-selShort">
                  <option value="1" >ED1</option>
                  <option value="2" >ED2</option>
                  <option value="3" >ED3</option>
                  <option value="4" selected>ED4</option>
                  <option value="-1">1879</option>
                </select>
              </span>
              <span class="sheet-nowrap3 sheet-label" title="@{edition_max}   Current version of the character sheet.">
                Sheet Version : <input name="attr_edition_max" type="text" class="sheet-numShort" value="0" readonly>
              </span>
            </div>
            <input name="attr_SpecialFunction" hidden value="showAPImsg" type="checkbox"  class='sheet-testCloseChecked'>
            <div class="sheet-HideIfNotCloseChecked">
              <b class="sheet-heading"> API messages </b>
              <fieldset class="repeating_message">
                <!-- <input type="hidden" name="attr_MSG_RowID"> -->
                <input type="text" name="attr_MSG_TimeStamp" class="sheet-nowrap0 sheet-txtMedplus sheet-bordered" readonly>
                <label class="sheet-label"> toAPI: <input type="text" name="attr_MSG_toAPI" class="sheet-nowrap0 sheet-txtLong sheet-bordered" readonly title="@{repeating_message_MSG_toAPI}: this is the log of a message sent from sheetworker to API.">
                  <input type="checkbox" value="ACK" name="attr_MSG_toSheetworker_max" title="@{repeating_message_MSG_to_Sheetworker_max}: this is the log that a message has received from the sheetworker and processed by the API.">
                </label>
                <label class="sheet-label"> toSheetworker: <input type="text" name="attr_MSG_toSheetworker" class="sheet-nowrap0 sheet-txtLong sheet-bordered"   title="@{repeating_message_MSG_to_Sheetworker}: this is the log of a message sent from API to sheetworker.">
                  <input type="checkbox" value="ACK" name="attr_MSG_toAPI_max" title="@{repeating_message_MSG_toAPI_max} : this is the log that the sheetworker has received and processed this message.">
                </label>
              </fieldset>
            </div>
          </div>    <!-- end Adjust - Sheet -->

          <!-- Adjust - Release Notes -->
          <div class="sheet-section-adjustments-release sheet-ShowIfObject">
            <div class="sheet-headerbar sheet-ShowIfObject">Release Notes </div>
            <div class="sheet-content sheet-HideIfPrint sheet-ShowIfObject sheet-small">
              This section will sometimes give important instructions about actions that must be taken to keep the character sheet working correctly with the new version.<br>
              Note that by principle, upon release of a new version, the sheet only updates parameters that are necessary to keep the sheet working. It doesn't lookup in the compendium or local database for updates of your existing Talents, Skills, Knacks and Spells. This avoids to overwrite any personal setting or note that you would have taken.
              <br>If you want to lookup in the compendium for any of your existing Talents, Knacks, Skills or Spells, just drop them from the compendium, or add a space at the end of the name.
              Entries that have been looked up in the compendium are recognizeable by the (i) button that opens their compendium page.
              <br>If you want the sheet to lookup all your Talents, Knacks, Skills and Spells, and overwrite the settings by the data of the compendium, press the following button (this can be useful after importing a character from an older version, buying a new compendium expansion, or switching to the API mode). Beware of the Claw Shape Talent where the Rank-Adjust will be set back to 3.
              <br>
              <button class="sheet-button-nodice sheet-text-button" name="act_import_talents" type="action"
              title="act_import_talents:   Clicking this button will lookup all Talents, Knacks, Skills and Spells from the Compendium.">
              Update Talents
              </button>
              <button class="sheet-button-nodice sheet-text-button" name="act_import_knacks" type="action"
              title="act_import_knacks:   Clicking this button will lookup all Talents, Knacks, Skills and Spells from the Compendium.">
              Update Knacks
              </button>
              <button class="sheet-button-nodice sheet-text-button" name="act_import_skills" type="action"
              title="act_import_skills:   Clicking this button will lookup all Talents, Knacks, Skills and Spells from the Compendium.">
              Update Skills
              </button>
              <button class="sheet-button-nodice sheet-text-button" name="act_import_spells" type="action"
              title="act_import_spells:   Clicking this button will lookup all Talents, Knacks, Skills and Spells from the Compendium.">
              Update Spells
              </button>
            </div>
            <textarea name="attr_Release-notes" style="height: 250px;" class="sheet-details" title="@{Release-notes}" placeholder="Release Notes here." readonly></textarea>
          </div> <!--End Adjust Release Notes-->


                <!-- Adjust - Help -->
          <div class="sheet-section-adjustments-help">
            <div class="sheet-headerbar">Help and Tips</div>
            <div class="sheet-content">
              <div class="sheet-content sheet-bordered sheet-small">
                There is a Wiki for this character sheet. Press the red question mark in the upper right of the header and then open the  wiki in a new tab.
                The section below shows tutorial videos of some basic operation with the Character sheet.
              </div>
              <div class="sheet-header-flex-container w100p sheet-flex-container sheet-content">
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="hover your pointer on any field for a couple of seconds to get a tooltip description" > Show Tooltips </div>
                  <div>
                    <span class="sheet-tips-tooltip" ></span>          </div>
                </div>
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="Most of the values can be modified locally via a modifier box floating on its upper right corner. If another modifier applies automatically it will appear on the upper left corner">
                   Add Modifiers
                 </div>
                  <div>
                        <span class="sheet-tips-mods"></span>
                  </div>
                </div>
                <div class="sheet-bordered">
                  <div class="sheet-headerbar" title="Many semi-permanent fields can only be edited if the local edit mode toggle has been selected."> Edit Fields</div>
                  <div>
                    <span class="sheet-tips-edit"></span>
                  </div>
                </div>
              </div>
            </div>

                  <!--Adjust - Help - General Icons-->
            <div class="sheet-headerbar">General Icons</div>
            <div class="sheet-glossary sheet-content">
              <span class="sheet-info" title="This section is a glossary of the icons used on the sheet and some basic explanation on some of the functions. Hover over the icons for some more information">i
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button in the header toggles between Base Step Display of Final Step Display. In Base Step Display, the center value of each step excludes all the temporary modifiers, i.e. it is the permanent value, but the next roll will have to include the displayed modifiers. In Final Step display, the value displayed already includes all the modifiers.">
                <span class="sheet-iconstatic sheet-icon-sum"></span> : Base/Final Step
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit a certain section.">
                <span class="sheet-iconstatic sheet-icon-edit"></span> : Edit
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to show notes or details.">
                <span class="sheet-iconstatic sheet-icon-notes"></span> : Details
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit advanced parameters of a certain section.">
                <span class="sheet-iconstatic sheet-icon-parameter"></span> : Parameters
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This button is used to edit links. Links are an advanced function that allow to include the Rank of a given property (Talent, Knacks ...) into the total Step of another property (Talent, Knacks ...). They can be used for Combos, like using Tiger Spring and Air Dance, to link to the Circle in order to make the Free Talents, or to calculate the total Damage with certain Talents like Surprise Strike or Down Strike by linking the Talent with the Weapon. See Wiki for more details">
                <span class="sheet-iconstatic sheet-icon-link"></span> : Links
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Karma. In Header you will find your Karma Pool. If the API, for each Talent or Ability, there is a Karma_max parameter that specifies how many Karma in maximum can be spent in a single roll. Next to the ability will appear a Karma icon to specify if you want to automatically spend Karmas on the next roll and how many. The overall decision to spend Karma or not is a toggle next to the Karma Pool in the header.">
                <span class="sheet-iconstatic sheet-icon-karma"></span> : Karma
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Devotion Points (DP) that Questor get. In Header you will find your DP Pool. If the API, for each Talent or Ability, there is a DP_max parameter that specifies how many DP in maximum can be spent in a single roll. Next to the ability will appear a DP icon to specify if you want to automatically spend DPs on the next roll and how many. The overall decision to spend DP or not is a toggle next to the DP Pool in the header.">
                <span class="sheet-iconstatic sheet-icon-devotion"></span> : Devotion
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Physical Defense.">
                <span class="sheet-iconstatic sheet-icon-PD"></span> : Physical Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Physical Armor.">
                <span class="sheet-iconstatic sheet-icon-PA"></span> : Physical Armor
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Mystic Defense.">
                <span class="sheet-iconstatic sheet-icon-MD"></span> : Mystic Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Mystic Armor.">
                <span class="sheet-iconstatic sheet-icon-MA"></span> : Mystic Armor
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Social Defense.">
                <span class="sheet-iconstatic sheet-icon-SD"></span> : Social Defense
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Initiative.">
                <span class="sheet-iconstatic sheet-icon-initiative"></span> : Initiative
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Target Numbers for tests.">
                <span class="sheet-iconstatic sheet-icon-TN"></span> : Target Number
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Action Tests. It is defining if a Talent for example is an action, compared to being an attack, damage or initiative to interprete what modifiers should apply to its tests.">
                <span class="sheet-iconstatic sheet-icon-action"></span> : Action Test
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Effects. It is defining if a Talent for example is an Effect, compared to being an attack, damage or initiative to interprete what modifiers should apply to its tests.">
                <span class="sheet-iconstatic sheet-icon-effect"></span> : Effect Test
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for all Defenses. It is grouping the modifications that apply to both Physical Defense (PD) and Mystic Defense (MD).">
                <span class="sheet-iconstatic sheet-icon-defenses"></span> : Defenses
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Ranged Attack. It is used to identify modifiers specific to Attacks, to identify if a weapon is ranged or close combat or if a Talent is an Attack Test.">
                <span class="sheet-iconstatic sheet-icon-attacks"></span> : Attack
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Ranged Attack. It is used to identify modifiers specific to Attacks, to identify if a weapon is ranged or close combat or if a Talent is an Attack Test.">
                <span class="sheet-iconstatic sheet-icon-attacks-cc"></span> : Attack Close Combat
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Damage Tests. It is used to identify modifiers specific to Damage.">
                <span class="sheet-iconstatic sheet-icon-damage"></span> : Damage
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet as symbol for Damage in Close Combat Tests. It is used to identify modifiers specific to Damage.">
                <span class="sheet-iconstatic sheet-icon-damage-cc"></span> : Damage Close Combat
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-simple"></span> : Action - Simple
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-standard"></span> : Action - Standard
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-free"></span> : Action - Free
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used in Talent, Skills and Knacks description to refer to the type of Actions as per PG.p.373 and following. It is recorded for user information only">
                <span class="sheet-iconstatic sheet-icon-action-sustained"></span> : Action - Sustained
              </span>
              <!-- <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to set who has access to the roll results of a certain ability (can be only the GM, the GM + the player that rolled, or public to all players). A general parameter is available at the top of the sheet near the character name, and specific abilities can have in their parameters (locally or in the adjustment tab) a specific setting.">
                <span class="sheet-iconstatic sheet-icon-dice"></span> : Roll Type
              </span> -->
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to describe a spell Matrix. It is marked with a letter according to the type of Matrix">
                <span class="sheet-iconstatic sheet-icon-matrix"></span> : Spell Matrix
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="This icon is used throughout the sheet to describe the threads that have to be woven to cast a spell.">
                <span class="sheet-iconstatic sheet-icon-weave"></span> : Spell Thread
              </span>
            </div>

                  <!--Adjust - Help - Option icons-->
            <div class="sheet-headerbar">Combat Options, Status, and Modifiers</div>
            <span class="sheet-info" title="Hover on the header of the sheet to make a appear the Combat Options, Status Modifiers, and Global Modifiers. Each of the combat options (PG p.382) and Situation Modifier (PG. p 386), as well as some creature Maneuvers (GMG p.251) are represented by icons. Except oherwise specified, the status applies to the character, in some cases applies to his target. Select one in the sheet, or from the Token Markers on the Token to toggle this option. Global Modifiers to all Actions, Attacks, Damage will be calculated as per the rules and applied to relevant Talents, Skills and Knacks automatically as per the declared Type">i</span>
            <div class="sheet-glossary sheet-content">
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-AggressiveAttack}   +3 bonus to Close Combat attack and damage tests. -3 Penalty to Physical and Mystic defense. 1 Strain per Attack. (PG p.382)">
                <span class="sheet-iconstatic sheet-icon-aggressive"></span>: Option Aggressive Attack
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-DefensiveStance}   +3 Bonus to Physical and Mystic defenses. -3 to all actions except defensive rolls and Knockdown tests. (PG p.384) ">
                <span class="sheet-iconstatic sheet-icon-defensive"></span>: Option Defensive Stance
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-CalledShot}   Take one Strain and -3 penalty to Attack test; if successful, attack hits designated area.">
                <span class="sheet-iconstatic sheet-icon-calledshot"></span>: Option Called Shot
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-SplitMovement}   Take 1 Strain and be Harried to attack during movement. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-split"></span>: Option Split Movement
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-TargetPartialCover}   Target has +2 Bonus to Physical and Mystic defenses due to cover from this attacker. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-partialcover"></span> : Target in Partial Cover
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-Reserved}   +2 to all Target Numbers. Specify an event to interrupt. (PG p.376)">
                <span class="sheet-iconstatic sheet-icon-reserved"></span> : Option Reserved Action
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-KnockedDown}   -3 penalty on all defenses and tests. Movement 2. May not use Combat Option other than Jump-Up. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-knockeddown"></span> : Character Knocked Down
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-RangeLong}   -2 Penalty to Attack and Damage Tests. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-rangelong"></span> : Range - Long
              </span>
              <!-- <span class="sheet-fixed-width sheet-txtLong" title="@{condition-NoShield}   Am not using shield at present. Forgo benefits and IP.">
                <span class="sheet-iconstatic sheet-icon-noshield"></span> : No Shield
              </span> -->
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Blindsided}   -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-blindsided"></span> : Blindsided
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Surprised}   No Actions. -3 Penalty to all Defenses. (PG p.390)">
                <span class="sheet-iconstatic sheet-icon-surprised"></span> Surprised
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Blindsiding}   Target takes -2 penalty to physical and mystic defenses. Can't use shield. No active defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-blindsiding"></span> : Blindsiding(Target Blindsided)
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-ImpairedMovement} Light Impaired Movement : -5 to Movement Rate. -2 Penalty to movement based tests due to footing, cramping, or vision impairments. (PG p.389)">
                <span class="sheet-iconstatic sheet-icon-impaired"></span> : Movement Impaired
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Entangled-Grappled} Character is Entangled or Grappled.  This condition is for information only and has no sheet effect. (PG p.391)">
                <span class="sheet-iconstatic sheet-icon-entangled"></span> : Entangled - Grappled
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Darkness} Partial Darkness -2 Penalty to all sight based tests due to Darkness, Blindness or Dazzling. (PG p.387). This is just a token marker, no calculation on sheet">
                <span class="sheet-iconstatic sheet-icon-vision"></span> : Darkness
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Harried} Harried : -2 Penalty to all tests and to Physical and Mystic defenses due to 4 or more opponents or other effect. (PG p.388)">
                <span class="sheet-iconstatic sheet-icon-harried"></span> : Harried
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{attr_condition-Cover} Partial Cover : +2 Bonus to Physical and Mystical defenses. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-cover"></span> : Cover
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{combatOption-TailAttack}   T'skrang only: Make extra Attack, Damage = STR. -2 to all Tests. (PG p.386)">
                <span class="sheet-iconstatic sheet-icon-tail"></span> : Option Tail Attack (T'skrang)
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Poisoned}  Character is Poisoned.  This condition is for information only and has no sheet effect.">
                <span class="sheet-iconstatic sheet-icon-poisoned"></span> : Poisoned
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Health}  Unconscious :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
                <span class="sheet-iconstatic sheet-icon-stun"></span> : Unconscious
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{condition-Health}  Dying :  Blindsided, Knocked Down and unable to take any action other than recovery tests .">
                <span class="sheet-iconstatic sheet-icon-death"></span> : Dying
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Misc-StrainPerTurn}: Set to 1.  If you are taking miscellaneous Strain every turn (for example a Blood Charm, a Thread Item power you automatically use every turn, or any other cause) You can set this field, and the Strain will automatically be deducted when you roll Initiative.">
                <span class="sheet-iconstatic sheet-icon-strain1"></span> : Strain per turn
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Creature-Ambushing}    This is the Ambush Creature Power. If Race of the Sheet is other, and this Power is set in the ajdustment, clicking on the header will activate the maneuver modifiers (GMG p.250)">
                <span class="sheet-iconstatic sheet-icon-ambush"></span> : Creature Ambushing
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{Creature-DivingCharging}    This is the Diving/Charging Creature Power. If Race of the Sheet is other, and this Power is set in the ajdustment, clicking on the header will activate the maneuver modifiers (GMG p.250)">
                <span class="sheet-iconstatic sheet-icon-charging"></span> : Creature Diving/Charging
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{repeating_maneuvers_MAN_Type}: CREATURE - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver.">
                <span class="sheet-iconstatic sheet-icon-maneuver-creature"></span> : Creature Maneuver
              </span>
              <span class="sheet-fixed-width sheet-txtLong" title="@{repeating_maneuvers_MAN_Type}: OPPONENT - Use these fields to specify a custom Maneuvers (Opponent or Creature). Click on this icon to toggle between Opponent or Creature Maneuver.">
                <span class="sheet-iconstatic sheet-icon-maneuver-opponent"></span> : Opponent Maneuver
              </span>
            </div>

          </div>    <!-- end Adjustments - Help -->

        </div>    <!-- End of section Adjustments    -->

      </div>    <!-- end of main pane -->
    </div>    <!-- end of MAIN BODY sheet-flex-container that starts right after header and includes side panes and main pane -->
  </div>    <!-- end sheet-user-root-in -->
</div>    <!-- end sheet-user-root -->







<!-- rolltemplates -->

<rolltemplate class="sheet-rolltemplate-chatrecord">
  <table>
    {{#header}}<thead><tr><th colspan="2">{{header}}</th></tr></thead>{{/header}}
    <tbody>
      {{#miscval}}<tr><td>{{misclabel}}:</td><td>{{miscval}}</td></tr>{{/miscval}}
      {{#refund}}<tr><td colspan="2" style="text-align: center; background-color: Orange;">Refund</td></tr>{{/refund}}
      {{#throalic}}<tr><td>Throalic Date:</td><td>{{throalic}}</td></tr>{{/throalic}}
      {{#lp}}<tr><td>LP:</td><td>{{lp}}</td></tr>{{/lp}}
      {{#sp}}<tr><td>Silver:</td><td>{{sp}}</td></tr>{{/sp}}
      {{#time}}<tr><td>Time:</td><td>{{time}}</td></tr>{{/time}}
      {{#note}}<tr><td>Note:</td><td>{{note}}</td></tr>{{/note}}
    </tbody>
  </table>
  {{#button1}}&nbsp;&nbsp;&nbsp;&nbsp;To record {{button1}}{{/button1}}
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-rolltargetnumber">
  <table>
    {{#header}}<thead><tr><th colspan="2">{{header}}</th></tr></thead>{{/header}}
    <tbody>
      {{#Step}}<tr><td>Step + bonus:</td><td>{{Step}}</td></tr>{{/Step}}
      {{#target_number}}<tr><td>
        Target
        {{#target_name}}'{{target_name}}'{{/target_name}}
        {{#target_defense}}{{target_defense}}{{/target_defense}}
      </td><td>TN# {{target_number}}</td></tr>{{/target_number}}
      <tr><td>Result:</td><td>{{Result}}
        {{#target_number}}
        {{#rollLess() Result target_number}}<span style="color: red;">Failed</span>{{/rollLess() Result target_number}}
        {{#^rollLess() Result target_number}}<span style="color: green;">Success</span>{{/^rollLess() Result target_number}}
        {{/target_number}}
      </td></tr>
      {{#Text}}<tr><td>Text:</td><td>{{Text}}</td></tr>{{/Text}}
    </tbody>
  </table>
</rolltemplate>


<!-- WORKERS -->
<script type="text/worker">

var SheetVersion=3.13;

// This is Test code to see if worker threads are active (working).   If wt-test1 changes, change wt-test2. if wt-test2 does not update, sheetworkers are not working.
on("change:wt-test1", function ocwttest1() {
  'use strict';
  getAttrs([ "wt-test1", "wt-test2" ], function(values) {
    'use strict';
    setAttrs({  "wt-test2": values[ "wt-test1" ]   });
  });
});   // End on change wt-test1




// This is a wrapper for parseInt.
// If you set lg to true it will write a log entry.
// vals = values.
// fld = feild within values to get and convert to an int with a default of zero.
var getInt = function fnGetInt( vals, fld, lg ) {
  'use strict';
  if( lg )        // Note: For debugging purposes, merely comment out this line to log everything.
  console.log( "Got " +  fld + " = " + vals[ fld ]  );
  return parseInt( vals[ fld ] ) || 0;
};  // End getInt()


//An Int parser that default to 0
var parseInt2 = function fnparseInt2(val){

  return parseInt( val ) || 0;
}



// If Edition has not been set (probably because we are running without the API) then default to 4th edition. Sheetworker is supposed to initialize it, but it could fail
var getEdition = function fnGetInt( vals ) {
  'use strict';
  if (isNaN(vals[ "edition" ])||  parseInt2( vals[ "edition" ] )===0 ) return 4; else return parseInt2( vals[ "edition" ] );
  // return parseInt2( vals[ "edition" ] ) || 4;
};  // End getEdition()



//Parse securely JSONs without Syntax error. Returning dflt or {} if str is invalid
var parseJSON = function (str,dflt){
  try{ return JSON.parse(str.replace(/=&gt;/g,":").replace(/\n/," ")); } //JBF@JBF : roll20 rake is making the opposite replace, so necessary to get appropriate JSONs
  catch(err){
    if(str!=="HomeBrew") log("Earthdawn trying to parse unvalid JSON " + str);
    return dflt  ? dflt : {};
  }
}; //End parseJSON()


//merges 2 JSON, giving priority on the values of the primary
function mergeJSON(prim,sec){
  let ret={};
  for(var key in sec) ret[key]=sec[key];
  for(var key in prim) ret[key]=prim[key];
  return ret;
}//end mergeJSON


// This is a wrapper for call backs that log when callback is entered and exited.
// The console.log lines should be commented out when not actively  debugging.
var fn = function fnfn(cb){
  'use strict';
  return function fnfn2(){
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)') + "(" + JSON.stringify(arguments) +" )");//uncomment this line if you want the entry of the function with timestamp & arguments
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)'));//uncomment this line if you want the entry of the function with timestamps but not arguments
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)') + "(" + JSON.stringify(arguments) +" )");//uncomment this line if you want the entry of the function with arguments but no timestamp
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)'));//uncomment this line if you want the entry of the function without timestamp nor arguments
    cb.apply({},arguments);
    // console.log( Date.now() + ' : EarthDawn - '+(cb.name||'(anonymous function)' ) + " - End "); //uncomment this line if you want the exit of the function with timestamp
    // console.log('EarthDawn - '+(cb.name||'(anonymous function)' ) + " - End "); //uncomment this line if you want the exit of the function without timestamp
  };
};



// This will generate a log entry with the name of the function that called it.
var callstack = function fncallstack(){
  var e = new Error('dummy');
  var stack = e.stack.replace(/^[^\(]+?[\n$]/gm, '')
  .replace(/^\s+at\s+/gm, '')
  .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
  .split('\n');
  stack.shift();
  console.log(stack);
};  //end callstack



// Takes a list of values, such as gotten from getAtters and logs them.
// Note that when not activly debugging, this whole routine can be commeneted out.
var logvalues = function fnlogvalues( vals ) {
  'use strict';
  //        var txt = "getAttrs -";
  //        for(var key in vals)
  //            txt += " " + key + ": " + vals[ key ] ;
  //        console.log( txt );
};  //end logvalues



// This is just like setAttrs(), except that before it sets the attrs, it writes net new values to the console log.
// NOTE That when not actively debugging, all lines except the last can/should be commented out.
var setAttrsLog = function fnlogvalues( vals, opt, cb ) {
  // var txt = "setAttrs -";
  // for(var key in vals)
  // txt += " " + key + ": " + vals[ key ] ;
  // console.log( txt );
  setAttrs( vals, opt, cb );
};  //end setAttrsLog



// Takes a list of values, such as gotten from getAtters and logs them.
// Note that by changing specific instances of logvalues to logvalues2, you can easily turn debugging on and off for specific sections.
var logvalues2 = function fnlogvalues( vals ) {
  'use strict';
  var txt = "getAttrs -";
  for(var key in vals)
  txt += " " + key + ": " + vals[ key ] ;
  console.log( txt );
};  //end logvalues2



// This is just like setAttrs(), except that before it sets the attrs, it writes net new values to the console log.
// NOTE That by changing specific instances of setAttrsLog to setAttrsLog2, you can easily turn debugging on and off for specific sections.
var setAttrsLog2 = function fnlogvalues( vals, opt, cb ) {
  var txt = "setAttrs -";
  for(var key in vals)
  txt += " " + key + ": " + vals[ key ] ;
  console.log( txt );
  setAttrs( vals, opt, cb );
};  //end setAttrsLog2



// Get a Parameter.   IE: getParm( "1,2,3,4,5", 2, ","); will return 2. IE the 2nd item in the list.
// str:     List to scan.
// num:     Number of the parameter to return.
// delim:   Character to treat as the delimiter.
var getParam = function ( str, num, delim ) {
  'use strict';
  try {
  var found;
  var count = 0;
  var j;
  let i = -1;
  do {
    j = i + 1;
    i = str.indexOf( delim, i+1);
  } while ( (++count < num) && (i !== -1) );
  if( count === num) {
    if( i < 0)
    i = str.length;
    found = str.slice( j, i).trim();
  }
  return found;
  } catch(err) {
  log("Earthdawn:getParam() error caught: " + err + " str: " + str + " num: " + num + " delim: "+delim);
}
};  // end getParam()



var buildPre = function ( code, rowID ) {
  'use strict';
  try {
    let ret = "";
    if ( !code ) {
      log("Earthdawn:buildPre() error. invalid code: " + code + "   rowID: " + rowID);
      return;
    }
    code = code.toUpperCase();
    if ((_.isString( rowID ) && rowID.length < 4)) {
      log("Earthdawn:buildPre() error. rowId wrong format: " + rowID + "   code: " + code);
      rowID = "xYz";
    }
    if( !rowID )    rowID = "xYz";
    switch ( code ) {
      case "DSP": ret = "repeating_discipline_" + rowID + "_" + code + "_"; break;
      case "T":   ret = "repeating_talents_"    + rowID + "_" + code + "_"; break;
      case "NAC": ret = "repeating_knacks_"     + rowID + "_" + code + "_"; break;
      case "SK":  ret = "repeating_skills_"     + rowID + "_" + code + "_"; break;
      case "SKK": ret = "repeating_skillk_"     + rowID + "_" + code + "_"; break;//Obsolete
      case "SKAC":
      case "SKA": ret = "repeating_skilla_"     + rowID + "_" + code + "_"; break; //Obsolete
      case "SKL": ret = "repeating_skilll_"     + rowID + "_" + code + "_"; break;
      case "SPM": ret = "repeating_matrix_"     + rowID + "_" + code + "_"; break;
      case "SP":  ret = "repeating_spell_"      + rowID + "_" + code + "_"; break;
      case "WPN": ret = "repeating_weapons_"    + rowID + "_" + code + "_"; break;
      case "MNT": ret = "repeating_mount_"      + rowID + "_" + code + "_"; break;
      case "TI":  ret = "repeating_threads_"    + rowID + "_" + code + "_"; break;
      case "INV": ret = "repeating_inventory_"  + rowID + "_" + code + "_"; break;
      case "I":   ret = "repeating_inventory_"  + rowID + "_" + code + "_"; break;      //JBF@CD : this is only to be able to import my own game. Can be deleted afterwards
      case "BL":  ret = "repeating_blood_"      + rowID + "_" + code + "_"; break;
      case "MAN": ret = "repeating_maneuvers_"  + rowID + "_" + code + "_"; break;
      case "ARM": ret = "repeating_armor_"      + rowID + "_" + code + "_"; break;
      case "MSK": ret = "repeating_masks_"      + rowID + "_" + code + "_"; break;
      case "PER": ret = "repeating_personality_"      + rowID + "_" + code + "_"; break;
      case "MSG": ret = "repeating_message_"      + rowID + "_" + code + "_"; break;

      default: log("Earthdawn:buildPre() error. Unknown code: " + code + "   RowID: " + rowID );
    }
    return ret.replace( /_xYz_/g, "_");     // return it as "repeating_talents_name" with rowID totally gone.
  } catch(err) {
    log("Earthdawn:buildPre() error caught: " + err );
  }
};  // end buildPre



//buildShortPre will get an eventinfo (either a collection issued by the roll20 system, or a string if a subfunction was called directly), and return a prefix to build variable names.
//In the case of a string, the accepted substitute for an eventinfo is the rowid, and the system needs a full name, so buildPre will be Used
//In the case of a collection, the function was triggered through a repeating section so a short prefix (with no row id) is sufficient.
//If the code was determined during the call of buildshortpre, there is no need to get data from the eventinfo, buildPre can build the prefix from the Code
//if no code was supplied, there is no choice than to get the code from the eventinfo collection
var buildShortPre = function ( ei, code ) {
  'use strict';
  try {
  if ( !ei || (_.isString( ei ) && ei.length<4)) {log("Earthdawn:buildShortPre() error. Unknown eventinfo: " + ei + "   code: " + code); return ;}
  else if( _.isString( ei )) {
    if( code ) return buildPre( code, ei );
    else return buildPre( repeatSection( 3, ei ), repeatSection( 2, ei ));
  } else if ( code ) return buildPre(code);
  else if ( ei["sourceAttribute"] )  return buildPre(repeatSection(3,ei["sourceAttribute"]));
  log("Earthdawn:buildShortPre() error. Unknown eventinfo: " + JSON.stringify(ei));
  return;
  } catch(err) {
    log("Earthdawn:buildShortPre() error caught: " + err);
}
};  // end buildShortPre



// This routine returns just one section of a repeating section name.
// section: 0 = repeating. 1 = talents, knacks, weapons, etc. 2 = rowID, 3 = code (SP, WPN, etc.), 4 is the attribute name.
// Note that this assumes that the attribute name does NOT contain an underscore, but allows for the rowID to contain one.
var repeatSection = function ( section, str ) {
  'use strict';
  try {
    let x = str.split("_");
    if( x[ x.length -1] === "max" ) { //values with _max are the only exception where it is allowed to have an underscore in the attribute name
      x.pop();
      x[ x.length -1 ] += "_max";
    };
    if( section < 2 )
    return x[ section ];
    else if (section == 3 )
    return x[ x.length -2 ].toUpperCase();
    else if (section == 4 )
    return x[ x.length -1 ];
    else { // There is a possibility that the RowID might contain an underscore. So this is if they want section 2.
      x.pop();
      x.pop();
      if(str.startsWith("repeating")) x.shift();
      if(str.startsWith("repeating")) x.shift();
      return x.join("_");
    }
  } catch(err) {
    log("Earthdawn:repeatSection() error caught: " + err + " section: " + section+ " str: " + str);
  }
}; // end repeatSection



// a version of getSectionIDs that returns the IDs in the order that they are displayed.
// getSectionIDs returns in the order the repeating section lines were created. The user has the ability to reorder the lines.
// getAttrs( [ "_reporderrepeating_" + section_name] , ... ) returns an empty object if the lines were not reordered,
// and may return an incomplete list or a list with items that were since deleted.
// This returns a complete and accurate list in the order that they are displayed.
var getSectionIDsOrdered = function (sectionName, callback) {
  'use strict';
  try{
  getAttrs([`_reporder_${sectionName}`], function (values) {
    let reporder = values[`_reporder_${sectionName}`];
    if( !reporder )
    getSectionIDs( sectionName, callback );     // There is no ordering, so just call the standard getSectionIDs and tell it to run the callback passed to us.
    else
    getSectionIDs( sectionName, function (idArray) {
      callback([...new Set(reporder.toLowerCase().split(",").filter(x => idArray.includes(x)).concat(idArray))]);
    });
  });
  } catch(err) {
    log("Earthdawn:getSectionIDsOrdered() error caught: " + err + " sectionName: " + sectionName);
  }


};  // end getSectionIDsOrdered()



// This is a helper function. It is useful to routines that may be called as part of a repeating section,
// or as part of an iteration through a repeating section.
// In ether case it will return a standardized name of the attribute.
var fullName = function fnfullName( name, ei ) {
  'use strict';
  try{
  if( _.isString( ei )) {
    var u = name.indexOf( "_", name.indexOf( "_")+1);       // Find the 2nd underscore.
    return name.slice( 0, u+1) + ei + name.slice( u);       // If ei is a string, then insert the RowID contained within eventInfo into name and return that.
  } else
  return name;                // If ei is an actual eventInfo object, then simply return name, since the system does not need the rowID if it came from a repeating section.
  } catch(err) {
    log("Earthdawn:fullName() error caught: " + err + " name: " + name+ " ei: " + JSON.stringify(ei));
  }
};  // End fullName



// Figure out the attribute name from eventInfo.
function getAttrib ( ei ) {
  try{
  if ( !ei ) return "";
  else if( _.isString( ei )) return ei;
  else if ( ei["eventname"] ) {
    let x = ei["eventname"].split("_");
    if( x.length < 5 )
    return; // this is the event for the repeating section, not any specific attribute, so we don't have an attribute to work with.
  }
  if ( ei["sourceAttribute"] )
    return ei["sourceAttribute"];
  return ei["eventname"];
  } catch(err) {
    log("Earthdawn:getAttrib() error caught: " + err + " ei: " + JSON.stringify(ei));
  }
}; //end getAttrib


//This is a general function used everywhere
function generateRowIdNoUnderscore() {
  return generateRowID().replace(/_/g, "-")
}




//
//                      This section has the routines that are called by the "on change" routines.
//



var ConditionHealth = function fnConditionHealth() { // If Health is anything other than OK, make sure both blindsided and knocked down are set.
  'use strict';
  try{
  getAttrs([ "condition-Health", "condition-Blindsided", "condition-KnockedDown" ], function gaConditionHealth(values) {
    'use strict';
    // log ( "EarthDawn : ConditionHealth()");
    logvalues( values);
    if ( values[ "condition-Health" ] != "0" ) {
      let vals = {};
      if( values[ "condition-Blindsided" ] != "1" )
      vals[ "condition-Blindsided" ] = "1";
      if( values[ "condition-KnockedDown" ] != "1" )
      vals[ "condition-KnockedDown" ] = "1";
      if( Object.keys(vals).length > 0)
      setAttrsLog( vals );
    }
  });
  } catch(err) {
  log("Earthdawn:ConditionHealth() error caught: " + err );
  }
}; //End ConditionHealth
on("change:condition-health", fn(ConditionHealth) );



var UpdateAdjustGlobalModifiers = function fnUpdateAdjustGlobalModifiers(eventInfo) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAdjustGlobalModifiers()");
    getAttrs([ "Adjust-Effect-Tests-Auto", "effectIsAction", "Wounds",
    "Creature-Fury", "Creature-ResistPain", "Adjust-Effect-Tests-Misc" , "Adjust-Effect-Tests-Total", "combatOption-TailAttack", "condition-Harried",
    "combatOption-DefensiveStance", "Misc-DefStance-Penalty", "Misc-DefStance-Bonus", "condition-KnockedDown", "Adjust-All-Tests-Auto",
    "Adjust-All-Tests-Misc" , "Adjust-All-Tests-Total", "combatOption-AggressiveAttack", "Misc-AggStance-Bonus", "Misc-AggStance-Penalty",  "combatOption-CalledShot", "condition-RangeLong",
    "Creature-Ambushing_max", "Creature-Ambushing", "Creature-DivingCharging_max", "Creature-DivingCharging" ,"Adjust-Attacks-Misc" , "Adjust-Attacks-Total" , "Adjust-Attacks-Total-CC",
    "Adjust-Attacks-Auto", "Adjust-Attacks-Auto-CC", "Adjust-Damage-Misc", "condition-Cover","condition-Surprised",
    "condition-Blindsided", "Adjust-Defenses-Misc" , "Adjust-Defenses-Total" ], function gaUpdateAdjustGlobalModifiers(values) {
      'use strict';
      logvalues( values);
      let vals={};
      //first deal with not having Aggressive Attack and Defensive Stance active at the same time
      let agg=values[ "combatOption-AggressiveAttack" ];
      let def=values[ "combatOption-DefensiveStance" ];

      //Effect & Action
      // My interpretation of the rules (unclear) is that effect tests are adjusted for little except wounds.
      let effectauto = (getInt( values, "Wounds") * ((getInt( values, "Wounds") <= getInt( values, "Creature-Fury" )) ? 1 : -1 ))
      + Math.min( getInt( values, "Wounds"), getInt( values, "Creature-ResistPain" ));
      let effecttotal = effectauto + getInt( values, "Adjust-Effect-Tests-Misc");
      //Action

      let actionauto= effectauto + (def * getInt( values, "Misc-DefStance-Penalty"))
      - (getInt( values, "condition-Harried") + (getInt( values, "combatOption-TailAttack") * 2)
      + (getInt( values, "condition-KnockedDown") * 3));

      let actiontotal = actionauto + getInt( values, "Adjust-All-Tests-Misc");

      //Attacks

      let attauto = actiontotal + ( getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambushing_max"))
      + ( getInt( values, "Creature-DivingCharging") * getInt( values, "Creature-DivingCharging_max"))
      - ((getInt( values, "combatOption-CalledShot") * 3)
      + (getInt( values, "condition-RangeLong") *2) );

      let attautocc = attauto +  agg * getInt( values, "Misc-AggStance-Bonus");
      let atttotal = attauto + (getInt( values, "Adjust-Attacks-Misc"));
      let atttotalcc = attautocc + (getInt( values, "Adjust-Attacks-Misc"));

      //Damage

      let dmgauto = effecttotal + ( getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambushing_max"))
      + ( getInt( values, "Creature-DivingCharging") * getInt( values, "Creature-DivingCharging_max"))
      +  def * getInt( values, "Misc-DefStance-Penalty")
      - (getInt( values, "condition-RangeLong") *2);

      let  dmgautocc = dmgauto + agg * getInt( values, "Misc-AggStance-Bonus");
      let dmgtotal = (dmgauto + (getInt( values, "Adjust-Damage-Misc")));
      let dmgtotalcc = (dmgautocc + (getInt( values, "Adjust-Damage-Misc")));

      //Defenses

      let defauto = getInt( values, "condition-Cover")
      + ( getInt( values, "condition-Blindsided") ? 0 : def    * getInt( values, "Misc-DefStance-Bonus"))     // If blindsided, not only take the -2 below, but also lose Def stance.
      +  agg * ( getInt( values, "Misc-AggStance-Penalty" ))
      - ( getInt( values, "condition-Harried") + (getInt( values, "condition-Surprised") * 3)
      + ( getInt( values, "condition-Blindsided") *2) + (getInt( values, "condition-KnockedDown") *3));
      let deftotal = defauto + getInt( values, "Adjust-Defenses-Misc");

      //Log values for update

      if (actionauto!==values[ "Adjust-All-Tests-Auto" ]) vals[ "Adjust-All-Tests-Auto" ]=actionauto;
      if (actiontotal!==values[ "Adjust-All-Tests-Total" ]) vals[ "Adjust-All-Tests-Total" ]=actiontotal;

      if( values[ "effectIsAction" ] =="1" ){
        effectauto=actionauto;
        if (effectauto!==values[ "Adjust-Effect-Tests-Auto" ]) vals[ "Adjust-Effect-Tests-Auto" ]=effectauto;
        effecttotal = actiontotal; //effecttotal + getInt( values, "Adjust-Effect-Tests-Misc");
        if (effecttotal!==values[ "Adjust-Effect-Tests-Total" ]) vals[ "Adjust-Effect-Tests-Total" ]=effecttotal;
      } else
      {
        if (effectauto!==values[ "Adjust-Effect-Tests-Auto" ]) vals[ "Adjust-Effect-Tests-Auto" ]=effectauto;
        if (effecttotal!==values[ "Adjust-Effect-Tests-Total" ]) vals[ "Adjust-Effect-Tests-Total" ]=effecttotal;
      };

      if (attauto!==values[ "Adjust-Attacks-Auto" ]) vals[ "Adjust-Attacks-Auto" ]=attauto;
      if (atttotal!==values[ "Adjust-Attacks-Total" ]) vals[ "Adjust-Attacks-Total" ]=atttotal;
      if (attautocc!==values[ "Adjust-Attacks-Auto-CC" ]) vals[ "Adjust-Attacks-Auto-CC" ]=attautocc;
      if (atttotalcc!==values[ "Adjust-Attacks-Total-CC" ]) vals[ "Adjust-Attacks-Total-CC" ]=atttotalcc;

      if (dmgauto!==values[ "Adjust-Damage-Auto" ]) vals[ "Adjust-Damage-Auto" ]=dmgauto;
      if (dmgtotal!==values[ "Adjust-Damage-Total" ]) vals[ "Adjust-Damage-Total" ]=dmgtotal;
      if (dmgautocc!==values[ "Adjust-Damage-Auto-CC" ]) vals[ "Adjust-Damage-Auto-CC" ]=dmgautocc;
      if (dmgtotalcc!==values[ "Adjust-Damage-Total-CC" ]) vals[ "Adjust-Damage-Total-CC" ]=dmgtotalcc;

      if (defauto!==values[ "Adjust-Defenses-Auto" ]) vals[ "Adjust-Defenses-Auto" ]=defauto;
      if (deftotal!==values[ "Adjust-Defenses-Total" ]) vals[ "Adjust-Defenses-Total" ]=deftotal;

      setAttrsLog( vals );
      updateRepStep();
    });
  } catch(err) {
    log("Earthdawn:UpdateAdjustGlobalModifiers() error caught: " + err + " ei: " + JSON.stringify(eventInfo));
  }
}; // End UpdateAdjustGlobalModifiers()
on( "change:effectisaction change:wounds  change:creature-fury   change:creature-resistpain   change:adjust-effect-tests-misc change:combatoption-tailattack   change:condition-harried     change:misc-defstance-penalty change:condition-knockeddown  change:adjust-all-tests-misc     change:misc-aggstance-bonus    change:combatoption-calledshot   change:condition-rangelong  change:creature-ambushing_max   change:creature-ambushing   change:Creature-DivingCharging_max   change:creature-divingcharging  change:adjust-attacks-misc  change:adjust-damage-misc   change:condition-cover  change:condition-surprised  change:condition-blindsided   change:adjust-defenses-misc ",  fn(UpdateAdjustGlobalModifiers) );



on("change:combatoption-aggressiveattack change:combatoption-defensivestance", fn(function ocCoAggDef( eventInfo) {
  'use strict';
  try{
  let att =getAttrib(eventInfo).toLowerCase();
  getAttrs([ "combatOption-AggressiveAttack", "combatOption-DefensiveStance" ], function gaAggDef(values) {
    'use strict';
    logvalues( values);
    let vals={};
    //first deal with not having Aggressive Attack and Defensive Stance active at the same time
    let agg=values[ "combatOption-AggressiveAttack" ];
    let def=values[ "combatOption-DefensiveStance" ];
    let silent =(  (agg===1 && def===0 && att==="combatoption-defensivestance") ||  (agg===0 && def===1 && att==="combatoption-aggressiveattack"));// In these case, we just arrived here by a double trigger... Ignore the rest

    if (silent) return;
    if ( agg == "1" &&  def== "1"){
      switch(att){
        case "combatoption-defensivestance" : vals[ "combatOption-AggressiveAttack" ]=0; break;
        case "combatoption-aggressiveattack" : vals[ "combatOption-DefensiveStance" ]=0; break;
        default: vals[ "combatOption-AggressiveAttack" ]=0; vals[ "combatOption-DefensiveStance" ]=0;
      }
      setAttrsLog(vals);
    };
    UpdateAdjustGlobalModifiers();
  });
  } catch(err) {
    log("Earthdawn:ocCoAggDef() error caught: " + err + " ei: " + JSON.stringify(eventInfo));
  }
}));  //end ocAggDef



var updateAdjustTN = function fnUpdateAdjustTN() {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAdjustTN()");
  getAttrs([ "combatOption-Reserved", "Adjust-TN-Misc" ], function gaUpdateAdjustTN(values) {
    'use strict';
    logvalues( values);
    let vals={};
    vals["Adjust-TN-Auto"] = getInt( values, "combatOption-Reserved") * 2;
    vals["Adjust-TN-Total"] = getInt( values, "combatOption-Reserved") * 2 + getInt( values, "Adjust-TN-Misc");
    setAttrsLog(vals);
  });
  } catch(err) {
    log("Earthdawn:updateAdjustTN() error caught: " + err);
  }
};  // End updateAdjustTN()
on("change:combatoption-reserved change:adjust-tn-misc", fn(updateAdjustTN) );



// When EffectIsAction is changed, set all the attributes to make all their tests as action tests.
var updateEffectIsAction = function fnUpdateEffectIsAction( eventInfo ) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateEffectIsAction()");
  setAttrsLog({ "Dex-ActnEfct": "1", "Str-ActnEfct": "1", "Tou-ActnEfct": "1", "Per-ActnEfct": "1", "Wil-ActnEfct": "1", "Cha-ActnEfct": "1", "Test-Trigger-3": "1" });
  } catch(err) {
    log("Earthdawn:updateEffectIsAction() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));
  }
}; // End updateEffectIsAction()
on("change:effectisaction", fn(updateEffectIsAction) );



var calculateAttribCosts = function fnCalculateAttribCosts(orig) {  // calculate a single attribute cost depending on the original modifier bought by the player at character creation
  'use strict';
  try{
  var diff = parseInt2( orig );
  var cost = Math.max( diff, -2 );
  while ( diff > 3 ) {
    diff -= 3;
    cost += (diff);
  }
  return cost;
  } catch(err) {
    log("Earthdawn:calculateAttribCosts() error caught: " + err + " orig: " + orig);
  }
};  //end calculateAttribCosts



var updateAttribCosts = function fnUpdateAttribCosts() { // At character creation, everybody starts with 25 attribute points to spend
  'use strict';
  try{
  getAttrs( [ "Attrib-Dex-Orig", "Attrib-Str-Orig", "Attrib-Tou-Orig", "Attrib-Per-Orig", "Attrib-Wil-Orig", "Attrib-Cha-Orig", "Attrib-Karma-Orig", "Attr-Costs" ], function gaUpdateAttribCosts(values) {
    'use strict';
    logvalues( values);
    let val = 25;
    val -= calculateAttribCosts( values[ "Attrib-Dex-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Str-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Tou-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Per-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Wil-Orig" ]);
    val -= calculateAttribCosts( values[ "Attrib-Cha-Orig" ]);
    val -= values[ "Attrib-Karma-Orig" ];
    setAttrsLog({ "Attr-Costs": val });
  });
  } catch(err) {
    log("Earthdawn:updateAttribCosts() error caught: " + err);
  }
}; // End updateAttribCosts()
on("change:attrib-dex-orig change:attrib-str-orig change:attrib-tou-orig change:attrib-per-orig change:attrib-wil-orig change:attrib-cha-orig change:attrib-karma-orig", fn(updateAttribCosts));
//JBF : Trigger via Recalc or updateAttribCurr




// calculate the final Value for the @attrib attribute
// This function together with backfillOrigAttrib have to be treated carefully as they have the potential of circular loop. This is prevented by checking eventInfo["sourceType"] at the triggering funciton
// the silent mode of setAttrs would have been another option, but is considered unreliable
var updateAttribCurr = function fnUpdateAttribCurr( attrib) {
  'use strict';
  try{
  // log ( "EarthDawn : UpdateAttribCurr( " + attrib +" ) "  );
  var curr = "Attrib-" + attrib + "-Curr";
  var orig = "Attrib-" + attrib + "-Orig";
  var race = "Attrib-" + attrib + "-Race";
  let inc = "Attrib-" + attrib + "-Increases";
  var adjust = attrib + "-Adjust-attr";
  getAttrs( [ curr, race, orig, inc, adjust ], function gaUpdateAttribCurr(values) {
    'use strict';
    logvalues( values);
    let vals = {};
    vals[ curr ] = getInt( values, race) + getInt( values, orig) + getInt( values, inc) + getInt( values, adjust );
    if( vals[ curr ] != getInt( values, curr) ) {
      setAttrsLog( vals ); //Silent mode unreliable, so deleted, and replaced by eventInfo["sourceType"] checks at the appropriate places
    }
  });
  } catch(err) {
    log("Earthdawn:updateAttribCurr() error caught: " + err + " attrib: " + attrib);
  }
}; // End updateAttribCurr()
on("change:attrib-dex-orig change:attrib-dex-race change:attrib-dex-increases change:dex-adjust-attr", fn(_.partial(updateAttribCurr, "Dex")));
on("change:attrib-str-orig change:attrib-str-race change:attrib-str-increases change:str-adjust-attr", fn(_.partial(updateAttribCurr, "Str")));
on("change:attrib-tou-orig change:attrib-tou-race change:attrib-tou-increases change:tou-adjust-attr", fn(_.partial(updateAttribCurr, "Tou")));
on("change:attrib-per-orig change:attrib-per-race change:attrib-per-increases change:per-adjust-attr", fn(_.partial(updateAttribCurr, "Per")));
on("change:attrib-wil-orig change:attrib-wil-race change:attrib-wil-increases change:wil-adjust-attr", fn(_.partial(updateAttribCurr, "Wil")));
on("change:attrib-cha-orig change:attrib-cha-race change:attrib-cha-increases change:cha-adjust-attr", fn(_.partial(updateAttribCurr, "Cha")));
//JBF other triggers backfillOrigAttrib and Recalc



// If somebody has changed the attribute step, go back and change the orig to match,
// Note: if you change this code, make sure that updateAttribStep() is also updated and tested to not make an infinite loop due to circular reference does not result.
// IE: make sure that this produces a correct value that updateAttribStep() will not attempt to "correct" and visa versa.
// Also, to ensure no circular loop, backfillOrigAttrib won't be triggered by the API. the API Routine modify() in textImport() will have to be in sync with backfillOrigAttrib and updateAttribStep
var backfillOrigAttrib = function fnBackfillOrigAttrib( attrib ) {
  'use strict';
  try{
  // log ( "EarthDawn : BackfillOrigAttrib( "+ attrib + " )");
  var step = attrib + "-Step";
  var orig = "Attrib-" + attrib + "-Orig";
  var race = "Attrib-" + attrib + "-Race";
  let inc = "Attrib-" + attrib + "-Increases";
  var adjust = attrib + "-Adjust-attr";
  var adjuststep = attrib + "-Adjust";
  getAttrs( [ step, orig, race, inc, adjust, adjuststep ], function gabackfillOrigAttrib(values) {
    'use strict';
    logvalues( values);
    var t = ((getInt( values, step) - getInt( values, adjuststep) -2) * 3) + 1 - (getInt( values, inc) + getInt( values, race) + getInt( values, adjust));
    var cval = getInt( values, orig);
    if( cval < (t - 1) || (t + 1) < cval) {
      let vals = {};
      vals [ orig ] = t;
      setAttrsLog( vals);
      // updateAttribCurr( attrib, true); As the silent mode is unreliable there is no need any more to do manual calls
    }
  });
  } catch(err) {
    log("Earthdawn:backfillOrigAttrib() error caught: " + err + " attrib: " + attrib);
  }
}; // End backfillOrigAttrib()



// Calculate Step from Value for the @attrib attribute
var updateAttribStep = function fnUpdateAttribStep( attrib ) {
  'use strict';
  try{
  // log ( "EarthDawn : updateAttribStep( "+ attrib + " )");
  var step = attrib + "-Step";
  var curr = "Attrib-" + attrib + "-Curr";
  var adjust= attrib + "-Adjust";
  getAttrs( [ step, curr, adjust], function gaUpdateAttribStep(values) {
    'use strict';
    logvalues( values);
    let vals = {};
    vals[ step ] = Math.floor(( getInt( values, curr) - 1) / 3 ) + 2 + getInt( values, adjust);
    if( vals[ step ] != getInt( values, step) )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateAttribStep() error caught: " + err + " attrib: " + attrib);
  }
}; // End updateAttribStep()
//trigger by curr or adjust



var updateAttribFinal = function fnUpdateAttribFinal( base ) {    //calculate Action Test Step for the attribute
  'use strict';
  try{
  // log ( "EarthDawn : updateAttribFinal( "+ base + " )");
  let bs = _.isString( base ) ? base : (base[ "sourceAttribute"].slice(0, 1).toUpperCase() + base[ "sourceAttribute"].slice(1, 3)),
  efct = bs + "-Effect";
  getAttrs( [ bs + "-Step", bs + "-Mods", efct, bs,  "Adjust-Effect-Tests-Total",
  "Adjust-All-Tests-Total"], function gaUpdateAttribFinal(values) {
    'use strict';
    logvalues( values);
    let vals = {},
    both = getInt( values, bs + "-Step")  + getInt( values, bs + "-Mods");
    let e = both + getInt( values, "Adjust-Effect-Tests-Total") ,
    a = both + getInt( values, "Adjust-All-Tests-Total") ;
    if( e != getInt( values, efct) )
    vals[ efct ] = e;
    if( a != getInt( values, bs) )
    vals[ bs ] = a;
    if( _.size( vals ) > 0 )
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateAttribFinal() error caught: " + err + " base: " + base);
  }
}; // End updateAttribFinal()
on("change:adjust-all-tests-total change:adjust-effect-tests-total", fn(function ocAdjustAllAttribFinal() {
  'use strict';
  updateAttribFinal( "Dex" );
  updateAttribFinal( "Str" );
  updateAttribFinal( "Tou" );
  updateAttribFinal( "Per" );
  updateAttribFinal( "Wil" );
  updateAttribFinal( "Cha" );
}));
on("change:dex-mods change:str-mods change:tou-mods change:per-mods change:wil-mods change:cha-mods", fn(updateAttribFinal));
//JBF : Other trigger via ocXXXStep



//JBF20201211Inventory Management
/* ===== PARAMETERS ==========
destinations = the name of the attribute that stores the total quantity
can be a single attribute, or an array: ['total_cost', 'total_weight']
If more than one, the matching fields must be in the same order.
section = name of repeating fieldset, without the repeating_
fields = the name of the attribute field to be summed
destination and fields both can be a single attribute: 'weight'
or an array of attributes: ['weight','number','equipped']
*/
const repeatingSum = (destinations, section, fields) => {
  try{
  if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
  if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
  getSectionIDs(`repeating_${section}`, idArray => {
    const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
    getAttrs([...attrArray], v => {
      const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
      const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
      const output = {};
      destinations.forEach((destination, index) => {
        output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
      });
      setAttrs(output);
    });
  });
  } catch(err) {
    log("Earthdawn:repeatingSum() error caught: " + err + " destination: " + destination + " section: " + section);
  }
};//end repeatingSum
on('change:repeating_inventory remove:repeating_inventory', fn(function ocInventoryWeight() {
  repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
  repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
  repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
}));
on('change:repeating_blood remove:repeating_blood', fn(function ocBlood() {
  repeatingSum("Damage-Blood", "blood","BL_Damage-Blood-Magic"  );
}));



on("change:repeating_inventory:inv_carried1 change:repeating_inventory:inv_carried2 change:repeating_inventory:inv_carried3", fn(function ocCarried(eventInfo) {
  'use strict';
  try{
  let att =repeatSection(4,getAttrib(eventInfo)).toLowerCase();
  let pre=buildShortPre(eventInfo,"INV");
  getAttrs([ pre+ "Carried1", pre+"Carried2" , pre+"Carried3"], function gaCarried(values) {
    'use strict';
    logvalues( values);
    if(getInt(values,pre+ "Carried1")+getInt(values,pre+ "Carried2")+getInt(values,pre+ "Carried3")<=1) return; //Only one is set, do nothing
    let vals={};
    switch(att){
      case "carried1" : vals[ pre+"Carried2" ]=0; vals[ pre+"Carried3" ]=0;break;
      case "carried2" : vals[ pre+"Carried1" ]=0; vals[ pre+"Carried3" ]=0;break;
      case "carried3" : vals[ pre+"Carried1" ]=0; vals[ pre+"Carried2" ]=0;break;
      default: log("EarthDawn Mutual Exclusion between inventory containers failed");  vals[ pre+"Carried1" ]=0; vals[ pre+"Carried2" ]=0;vals[ pre+"Carried2" ]=3;
    };
    setAttrsLog(vals, {silent:true});
  });
  } catch(err) {
    log("Earthdawn:ocCarried() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));
  }
})); //End ocCarried


var UpdateCarried = function fnUpdateCarried() {
  'use strict';
  try{
  getAttrs([ "Weight-Equipment","Weight-Gear", "Weight-Supply", "Cont1-Weight","Cont2-Weight","Cont3-Weight","Cont1-Carried", "Cont2-Carried", "Cont3-Carried", "Weight-Coin" ], function gaUpdateCarried(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Weight-Equipment") + getInt( values, "Weight-Supply") + getInt( values, "Weight-Gear") +  getInt( values, "Cont1-Weight")*getInt( values, "Cont1-Carried") + getInt( values, "Cont2-Weight")*getInt( values, "Cont2-Carried") +getInt( values, "Cont3-Weight")*getInt( values, "Cont3-Carried") +getInt( values, "Weight-Coin");

    setAttrsLog({ "Carrying-Carried": val });
  });
  } catch(err) {
    log("Earthdawn:UpdateCarried() error caught: " + err);
  }
};
on("change:weight-equipment change:weight-supply change:weight-gear change:cont1-weight change:cont2-weight change:cont2-weight  change:cont1-carried change:cont2-carried change:cont3-carried change:weight-coin", fn(UpdateCarried) );




// Ensures max one non piece armor and max one shield are equipped at a given time
//If the armor is piecemeal, will take care to sum all the stats
// If it finds more than one, it will only keep the one that was just changed
// Ensures the appropriate values to Armor-Phys, Armor-Myst, Armor-IP, Shield-Phys, Shield-Myst, Shield-IP
var repEquipped = function fnrepEquipped( eventInfo ) {
  'use strict';
  try{
    if ( !eventInfo ) return;
    let att = getAttrib( eventInfo );
    let rem= _.isString(eventInfo) || eventInfo.triggerName.startsWith("remove") ;

    let pre = rem ? "" : buildPre( "ARM",repeatSection(2,att) );
    let attarray=rem ? ["edition_max"] : ["edition_max",pre+"Type",pre+"Type_max",pre+"Phys",pre+"Myst",pre+"IP",pre+"Piece"];
    getSectionIDs("repeating_armor", function(idarray) {
      for(let i=0; i < idarray.length; i++){
        attarray.push( buildPre( "ARM", idarray[ i ]) + "Type" );
        attarray.push( buildPre( "ARM", idarray[ i ]) + "Type_max" );
        attarray.push( buildPre( "ARM", idarray[ i ]) + "Phys" );
        attarray.push( buildPre( "ARM", idarray[ i ]) + "Myst" );
        attarray.push( buildPre( "ARM", idarray[ i ]) + "IP" );
        attarray.push( buildPre( "ARM", idarray[ i ]) + "Piece" );
      }
      getAttrs(attarray, function garepEquipped(values) {
        'use strict';
        logvalues( values);

        if(parseFloat( values[ "edition_max" ]) <3) {
          //log("repEquipped inhibited because older sheet version");
          return;}
        //log("repEquipped "+ JSON.stringify(eventInfo) + " remove " +rem);

        let t= rem ? 1 : getInt(values,pre+"Type"), //Shield (-1) or Armor (1)
        eq=rem ? 0 : getInt(values,pre+"Type_max"), //Equipped (1) Unequipped (0) or New Line (2)
        p=rem ? false : (getInt(values,pre+"Type")==1 && getInt(values,pre+"Piece")==1), //PieceMeal true or Full Armor false. Shield should always be false
        pre2= (t==1 ? "Armor-" : "Shield-"), //The type we are dealing with
        pre3= (t==-1 ? "Armor-" : "Shield-"), //the opposite type
        vals={"Armor-Phys":0 ,"Armor-Myst" : 0, "Armor-IP":0 , "Shield-Phys":0, "Shield-Myst":0, "Shield-IP":0}, //If we don't find any better values, we will reset
        nb=[0,0,0,0], // [nb shield, nb shield equipped, nb armor, nb full armor equipped
        n=0;
        // log("eq " + eq + " pre3 "+ pre3);


        for(let i=0; i < idarray.length; i++){
          let pre4=buildPre( "ARM", idarray[ i ]);
          nb[getInt(values, pre4 + "Type" )+1]++; //Counts numbers
          //nb[getInt(values, pre4 + "Type" )+2]+=(getInt(values, pre4 + "Type_max" )==1 ? 1 : 0); //Counts number equipped... Reminder there could be a temporary -1 value
          if(getInt(values, pre4 + "Type_max" )==1 && (getInt(values, pre4 + "Type" )==-1 || getInt(values, pre4 + "Piece" )==0)) nb[getInt(values, pre4 + "Type" )+2]+= 1; //Counts Shields, and Full Armors
        }
         //log("repEquipped nb " + JSON.stringify(nb) + " for eq " +eq);

        //Now that we know of the situation, go through the list a second time, to actually make the updates:

        for(let i=0; i < idarray.length; i++){ //start for
          if(idarray[i].toLowerCase()!==repeatSection(2,att).toLowerCase()){ //The line that triggered it all is dealt somewhere else
            let pre4=buildPre( "ARM", idarray[ i ]);
            //log("test");
            if(getInt(values, pre4 + "Type" ) == t){ //Dealing with the the type that triggered the update.
              if( !p && eq ==1 ) vals[pre4 + "Type_max"]="0"; //If we equipped a full armor, unequip all the rest
              else  if( p && eq ==1 && !(getInt(values,pre4+"Type")==1 && getInt(values,pre4+"Piece")==1)) vals[pre4 + "Type_max"]="0"; //If we equipped a piece armor, unequip all full armors
              else if(t==-1 && nb[1]>1) vals[pre4 + "Type_max"]="0"; //We are dealing with Shields, and we have more than one equipped
              else if(t==1 && nb[3]>1 && getInt(values, pre4 + "Piece" )==0) vals[pre4 + "Type_max"]="0";  //We are dealing with full equipped armor that are in excess
              else if(getInt(values,buildPre( "ARM", idarray[ i ]) + "Type_max" )==1){ //The current line is equipped, and there is no "anomaly"
                n++;
                vals[pre2+"Phys"]+=getInt(values,pre4 + "Phys");
                vals[pre2+"Myst"]+=getInt(values,pre4 + "Myst");
                vals[pre2+"IP"]+=getInt(values,pre4 + "IP");
              }
            } else { //Dealing with the type opposite to the one that triggered the update
              if(nb[getInt(values,buildPre( "ARM", idarray[ i ]) + "Type" )+2]>1) vals[buildPre( "ARM", idarray[ i ]) + "Type_max"]="0";
              else if(getInt(values,buildPre( "ARM", idarray[ i ]) + "Type_max" )==1){
                vals[pre3+"Phys"]+=getInt(values,buildPre( "ARM", idarray[ i ])+"Phys");
                vals[pre3+"Myst"]+=getInt(values,buildPre( "ARM", idarray[ i ])+"Myst");
                vals[pre3+"IP"]+=getInt(values,buildPre( "ARM", idarray[ i ])+"IP");
              }
            }
          }
        } //end for : we finished dealing with all the other lines, get bck to the triggering one

        if(eq==2){ //Finally deal with initialization of a new line...
          if((!p && n==0 ) || (p && nb[3]==0)      ){ //there is no line equipped, equip
            // log("equipping because first time")
            vals[pre+"Type_max"]="1";
            eq=1;
          }
          else vals[pre+"Type_max"]=0
        }
        if(eq==1) //If the line that triggered it is equipped, update values
        {
          vals[pre2+"Phys"]+=getInt(values,pre+"Phys");
          vals[pre2+"Myst"]+=getInt(values,pre+"Myst");
          vals[pre2+"IP"]+=getInt(values,pre+"IP");
        }
        //Deal with shield-name just to display / hide the shield buff

        //Manage the display of Shield Buffs, and their reset if there is no shield
        vals["Shield-Name"]= (nb[1]==0) ? "": "Shield";
        if(nb[1]==0){
          vals["Shield-Phys-Buff"]=0;
          vals["Shield-Myst-Buff"]=0;
        }


        //log("Shield-Name " +vals["Shield-Name"]);

        // log("vals " + JSON.stringify(vals));
        setAttrsLog( vals,null,function() {
        updateIP();
        updatePD();
        updateMD();
        updatePhysicalArmor();
        updateMysticArmor();
      });
      });
    });
  } catch(err) {log("Earthdawn:repEquipped() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repEquipped
on("change:repeating_armor:arm_piece change:repeating_armor:arm_type change:repeating_armor:arm_type_max change:repeating_armor:arm_phys change:repeating_armor:arm_myst change:repeating_armor:arm_ip change:repeating_armor:arm_name remove:repeating_armor", fn(repEquipped) );




var updateCarry = function fnUpdateCarry() {
  'use strict';
  try{
  getAttrs(["Attrib-Str-Curr", "RacialAbilities", "Misc-Carry-Adjust", "Carrying-Capacity" ], function gaUpdateCarry(values) {
    'use strict';
    logvalues( values);
    let ra=values["RacialAbilities"]||""
    var str = getInt( values, "Attrib-Str-Curr") + (( ra.includes("Strong Back") ) ? 2 : 0);
    var carry = 5 + getInt( values, "Misc-Carry-Adjust");
    while ( str > 0 ) {
      carry += (str * 5);
      str -= 5;
    }
    if( carry != values[ "Carrying-Capacity" ])
    setAttrsLog({ "Carrying-Capacity": carry });
  });
  } catch(err) {
    log("Earthdawn:updateCarry() error caught: " + err);
  }
}; // End updateCarry()
on("change:misc-carry-adjust", fn(updateCarry) );


var calcED3Death = function fnCalcED3Death(value) { // function used to calculate 3rd edition Death Rating from Tou value
  'use strict';
  try{
  if ( value == 0 ) {
    return 18;
  } else if ( value == 1 ) {
    return 19;
  } else if ( value == 2 ){
    return 20;
  } else {
    return 4 + calcED3Death( value-3 );
  }
  } catch(err) {
    log("Earthdawn:calcED3Death() error caught: " + err);
  }
}; // End calcED3Death()


//A callback ensures synchronization for the FillDataCreature
//A Backfill allows the user to modify any value directly
var updateHealth = function fnUpdateHealth(eventInfo,cb) {
  'use strict';
  try{
    //log("updateHealth " + JSON.stringify(eventInfo));
    let backfill={};
    if(eventInfo && ["damage-death-rating" , "damage-unc-rating" , "wound-threshold" , "recovery-tests_max"].includes(eventInfo.sourceAttribute.toLowerCase())){
      if(eventInfo.sourceType=="player"){
        backfill[eventInfo.sourceAttribute]=true; //We have directly edited one of the values... Do not update the others and backfill the adjustment so that it balances
      }
      else return; //Do not process any change done by sheetworker as it is likely the updateHealth itself
    }

    getAttrs([ "Damage-Unconscious-Adjust", "Attrib-Tou-Curr", "working-Durability","working-Durability_max", "Damage-Blood", "Damage-Unc-Rating",
    "Damage-Death-Rating", "Damage-Death-Rating-Adjust",  "Tou-Step", "working-Circle", "Durability-Rating-Adjust",
    "Recovery-Tests_max", "Recovery-Tests-Misc-Adjust","Recovery-Tests-Auto-Adjust", "Wound-Threshold-Buff", "Wound-Threshold", "Wound-Threshold-Adjust",
    "RacialAbilities", "edition" ], function gaUpdateHealth(values) {
      'use strict';
      logvalues( values);
      let vals = {},
      ra=values["RacialAbilities"]||"";
    //Calculating unconscioussness
      var unc = getInt( values, "Damage-Unconscious-Adjust")  - getInt( values, "Damage-Blood");
      if ( getEdition( values ) == 3 ) {  // 3rd edition Unconsciousness rating
        //Below are the tables of Unconsciousness rates and Wound thresholds for 3rd edition. (Toughness Value - 1) is used as the index to find the corresponding value.
        let ED3Uncon = [10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 24, 26, 27, 28, 30, 31, 32, 34, 35, 36, 39, 40, 41, 43, 44, 45, 47, 48, 49, 51, 52, 53, 55, 56, 57, 59, 60, 61, 63, 64, 65, 67, 68, 69, 71, 72, 73, 75, 76, 77, 80, 81, 82, 84, 85, 86, 88, 89, 90, 92, 93, 94, 96, 97, 98, 100, 101, 102, 104, 105, 106, 108, 109, 110, 112, 113, 114, 116, 117, 118, 120, 121, 122, 124, 125, 126, 128, 129, 130, 132, 133, 134, 136, 137, 138, 140, 141, 142, 144, 145,];
        unc += ED3Uncon[ ((getInt( values, "Attrib-Tou-Curr")>100)?100:getInt( values, "Attrib-Tou-Curr")) -1 ];
      }
      else  // 4th edition Unconsciousness rating
      unc += (getInt( values, "Attrib-Tou-Curr") * 2) + Math.max(getInt( values, "working-Durability"),getInt( values, "working-Durability_max"));

      //Calculating death
      let val = getInt( values, "Damage-Death-Rating-Adjust");
      if ( getEdition( values ) == 3 ) { // 3rd edition Death rating
        val += calcED3Death(getInt( values, "Attrib-Tou-Curr"));
      } else  // 4th edition Death rating
      val += (getInt( values, "Attrib-Tou-Curr") * 2) + getInt( values, "Tou-Step") - getInt( values, "Damage-Blood") +  Math.max((getInt( values, "working-Durability")+ getInt( values, "working-Circle") + getInt( values, "Durability-Rating-Adjust")),getInt( values, "working-Durability_max"))   ;
      // changed in v3.1
      // val += unc + getInt( values, "Tou-Step") + getInt( values, "working-Circle") + getInt( values, "Durability-Rating-Adjust")
      // - getInt( values, "Damage-Unconscious-Adjust");

      if( val < unc )
      unc = val;      // To simplify entering monsters, if unc has been set to higher than death rating, set unc rating to death.

      if( unc != getInt(values , "Damage-Unc-Rating" )){
        if( Object.keys(backfill).length == 0 ) vals[ "Damage-Unc-Rating" ] = unc;
        else if(backfill[ "damage-unc-rating" ]) vals["Damage-Unconscious-Adjust"] = getInt( values, "Damage-Unconscious-Adjust") - unc +  getInt(values , "Damage-Unc-Rating" );
      }

      if( val != getInt(values, "Damage-Death-Rating" )){
        if( Object.keys(backfill).length == 0 ) vals[ "Damage-Death-Rating" ] = val;
        else if(backfill[ "damage-death-rating" ])   vals["Damage-Death-Rating-Adjust"]= getInt( values, "Damage-Death-Rating-Adjust") - val + getInt(values, "Damage-Death-Rating" );
      }

      val = getInt( values, "Wound-Threshold-Buff") + getInt( values, "Wound-Threshold-Adjust") + (( ra.includes("Increased Wound Threshold")) ? 3 : 0);
      if ( getEdition( values ) == 3 ) { // 3rd edition Wound threshold
        //Below are the tables of Unconsciousness rates and Wound thresholds for 3rd edition. (Toughness Value - 1) is used as the index to find the corresponding value.
        var ED3WndTreshold = [3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 16, 16, 17, 17, 17, 18, 18, 19, 19, 19, 20, 20, 21, 21, 21, 21, 22, 22, 22, 23, 23, 23, 23, 24, 24, 24, 25, 25, 25, 25, 26, 26, 26, 27, 27, 27, 27, 27, 28, 28, 28, 28, 29, 29, 29, 29, 29, 30, 30, 30, 30, 31, 31, 31, 31, 31, 32, 32, 32, 32, 33, 33, 33, 33, 33, 34, 34, 34, 34, 35, 35, 35, 35];
        val += ED3WndTreshold[ ((getInt( values, "Attrib-Tou-Curr")>100)?100:getInt( values, "Attrib-Tou-Curr")) -1 ];
      } else { // 4th edition Wound threshold
        val += Math.floor((getInt( values, "Attrib-Tou-Curr") +1) / 2 ) +2;
      };
      if( val != getInt(values, "Wound-Threshold" )){
        if( Object.keys(backfill).length == 0 ) vals[ "Wound-Threshold" ] = val;
        else if(backfill[ "wound-threshold" ]) vals["Wound-Threshold-Adjust"]=getInt( values, "Wound-Threshold-Adjust") - val + getInt(values, "Wound-Threshold" );
      }

      val = getInt( values, "Recovery-Tests-Misc-Adjust")+getInt( values, "Recovery-Tests-Auto-Adjust")+(( ra.includes("Thorned")) ? -1 : 0);
      if ( getEdition( values ) == 3 ) {    // 3rd edition numbers of Recovery tests NB : here Tou values of 1 and 2 will produce 1 instead of "1/2", due to present version of character sheet not handling non Int values in this field
        val += Math.max( Math.ceil( ( getInt( values, "Attrib-Tou-Curr")-1 ) / 6 ) ,1 );
      } else { // 4th edition numbers of Recovery tests
        val += Math.floor((getInt( values, "Attrib-Tou-Curr") -1) / 6 ) +1;
      };

      if( val != getInt(values,"Recovery-Tests_max" )){
        if( Object.keys(backfill).length == 0 )  vals[ "Recovery-Tests_max" ] = val;
        else if(backfill[ "recovery-tests_max" ]) vals["Recovery-Tests-Misc-Adjust"] = getInt( values, "Recovery-Tests-Misc-Adjust") - val + getInt(values,"Recovery-Tests_max" );
      }

      setAttrsLog( vals ,function(){
        if(cb) cb();
      });
    });
  } catch(err) {
    log("Earthdawn:updateHealth() error caught: " + err);
  }
}; // End updateHealth()
on("change:working-durability change:working-durability_max change:damage-unconscious-adjust change:damage-death-rating-adjust change:damage-blood change:wound-threshold-adjust change:wound-threshold-buff change:recovery-tests-misc-adjust change:recovery-tests-auto-adjust", fn(updateHealth) );
on("change:recovery-tests_max change:wound-threshold change:damage-death-rating change:damage-unc-rating", fn(updateHealth) );



var updateKnockdown = function fnUpdateKnockdown(eventInfo,cb) {
  'use strict';
  try{
  // log ( "EarthDawn : updateInitiative() ");
  getAttrs([ "Str-Step", "Knockdown-Adjust", "Knockdown" , "Knockdown-addSR" , "SrRating"], function gaUpdateKnockdown(values) {
    'use strict';
    logvalues( values);
    let vals = {},backfill,

    base = getInt( values, "Str-Step") + getInt( values, "Knockdown-Adjust") + ( getInt(values, "Knockdown-addSR") * getInt(values,"SrRating"));
    base=Math.min(base,99);  //Immune creatures will have 99
    if(eventInfo && !_.isString(eventInfo) && eventInfo.sourceAttribute=="knockdown") { //This is a potentially a backfill
      if(eventInfo.sourceType=="player") backfill=true;
      else return;
    }
    if( base != getInt(values, "Knockdown" ))
    if(!backfill) vals[ "Knockdown" ] = base;
    else vals["Knockdown-Adjust" ] =getInt( values, "Knockdown-Adjust") + getInt(values, "Knockdown" ) - base ;
    setAttrsLog( vals,null,function(){
      if(cb) cb();
    });
  });
  } catch(err) {
    log("Earthdawn:updateKnockdown() error caught: " + err);
  }
}; // End updateKnockdown()
on("change:str-step change:knockdown-adjust", fn(updateKnockdown) );
on("change:knockdown change:knockdown-addsr" , fn(updateKnockdown) );



var updateInitiative = function fnUpdateInitiative(eventInfo,cb) {
  'use strict';
  try{
  // log ( "EarthDawn : updateInitiative() ");
  getAttrs([ "Initiative", "Initiative-Step", "Initiative-addSR","SrRating", "Initiative-Mod-Auto", "Dex-Step", "Dex-Mods", "Adjust-Effect-Tests-Total", "Initiative-Adjust","Initiative-Auto-Adjust", "Initiative-Mods", "IP", "Creature-Ambushing_max", "Creature-Ambushing" ], function gaUpdateInitiative(values) {
    'use strict';
    logvalues( values);
    let vals = {},backfill,
    modauto = getInt( values, "Adjust-Effect-Tests-Total") + getInt( values, "Dex-Mods")
    + (getInt( values, "Creature-Ambushing") * getInt( values, "Creature-Ambushing_max" )),
    base = getInt( values, "Dex-Step") + getInt( values, "Initiative-Adjust")  + getInt( values, "Initiative-Auto-Adjust") + ( getInt(values, "Initiative-addSR") * getInt(values,"SrRating"))  - getInt( values, "IP"),
    init = base + modauto + getInt( values, "Initiative-Mods") ;

    if(eventInfo && !_.isString(eventInfo) && eventInfo.sourceAttribute=="initiative-step") { //This is a potentially a backfill
      if(eventInfo.sourceType=="player") backfill=true;
      else return;
    }


    if( modauto != getInt(values, "Initiative-Mod-Auto" ))
    vals[ "Initiative-Mod-Auto" ] = modauto;
    if( base != getInt(values, "Initiative-Step" ))
    if(!backfill) vals[ "Initiative-Step" ] = base;
    else vals["Initiative-Adjust" ] = getInt( values, "Initiative-Adjust") + getInt(values, "Initiative-Step" ) - base;

    if( init != getInt(values, "Initiative"))
      vals[ "Initiative" ] = init;
    setAttrsLog( vals,null,function(){
      if(cb) cb();
    });
  });
  } catch(err) {
    log("Earthdawn:updateInitiative() error caught: " + err);
  }
}; // End updateInitiative()
on("change:dex-step change:adjust-effect-tests-total change:initiative-adjust change:initiative-auto-adjust change:initiative-mods change:dex-mods change:ip change:creature-ambushing_max change:creature-ambushing", fn(updateInitiative) );
on("change:initiative-step change:initiative-addsr" , fn(updateInitiative) );


var updateIP = function fnUpdateIP() {
  'use strict';
  try{
  // log ( "EarthDawn : updateIP() ");
  getAttrs([ "Armor-IP", "Shield-IP", "Misc-IP-Mod", "Misc-IP-Adjust" ], function gaUpdateIP(values) { //, "condition-NoShield"
    'use strict';
    logvalues( values);
    let val = getInt( values, "Armor-IP") +  getInt( values, "Shield-IP") //(values[ "condition-NoShield" ] == "1") ? 0 :
    + getInt( values, "Misc-IP-Mod") + getInt( values, "Misc-IP-Adjust");
    setAttrsLog({ "IP": val });
  });
  } catch(err) {
    log("Earthdawn:updateIP() error caught: " + err);
  }
};  //end updateIP
on("change:armor-ip change:shield-ip change:misc-ip-mod change:misc-ip-adjust ", fn(updateIP) ); //change:condition-noshield



var updateKarma = function fnUpdateKarma(eventInfo,cb) {
  'use strict';
  try{
    //log("updateKarma " + JSON.stringify(eventInfo));
    if(eventInfo && eventInfo.sourceType!="player" && eventInfo.sourceAttribute.toLowerCase()=="karma_max") return; //called back by the writing of Karma_max
    let backfill=((eventInfo && eventInfo.sourceType=="player" && eventInfo.sourceAttribute.toLowerCase()=="karma_max")); //We are backfilling the value, either via a direct call or via a manual change
    let vals={};
  getAttrs([ "Karma-Modifier","Karma-Modifier-Adjust", "working-Circle", "Misc-Karma-max-Adjust", "Attrib-Karma-Orig", "Karma_max",  "edition" ], function gaUpdateKarma(values) {
    'use strict';
    logvalues( values);
    let currval= getInt(values,"Karma_max");
    // if ( getEdition( values ) == 4 && getInt( values, "Karma-Modifier" ) != 0) {     // NB : Prior to 4th edition, Karma depends on Karmic Ritual rank, so is entered manually in those versions of the sheet.   Also, if karma modifier is zero (because race is not selected or is "Other", don't set anything since for Dragons we directly enter values we don't want overwritten.
    let val = ((getInt( values, "Karma-Modifier")+getInt( values, "Karma-Modifier-Adjust")) * getInt( values, "working-Circle")) + getInt( values, "Misc-Karma-max-Adjust")  + getInt( values, "Attrib-Karma-Orig") ;
    //log ( "currval " + currval + " val "+ val + val)
    if( val < 0 )
    val = 0;
    if( !backfill && val != currval) //Normal case, we want to adjust Karma_max
    vals ["Karma_max"]= val ;

    if( backfill && val != currval) //backfill : we want to adjust
    vals[ "Misc-Karma-max-Adjust"]= getInt( values, "Misc-Karma-max-Adjust")  + currval - val;
    setAttrsLog( vals,null,function(){
      if(cb) cb();
    });

  });
  } catch(err) {
    log("Earthdawn:updateKarma() error caught: " + err);
  }
}; // End updateKarma()
on("change:karma_max change:karma-modifier change:karma-modifier-adjust change:working-circle change:misc-karma-max-adjust change:attrib-karma-orig ", fn(updateKarma) );
//Race : via Karma-Modifier -- edition : No Trigger: In editions different than 4 Karma is readonly





var updateLpStatus = function fnUpdateLpStatus() {
  'use strict';
  try{
  // log ( "EarthDawn : updateLpStatus() ");
  getAttrs([ "LP-Total", "LP-Status" ], function gaUpdateLpStatus(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "LP-Total");
    let vals;
    if( val < 10000 )
    vals = { "LP-Status": "LP up to 10,000", "LP-Renown": "16", "LP-Reputation": "NA" };
    else if ( val < 100000 )
    vals = { "LP-Status": "LP 10K to 100K", "LP-Renown": "12", "LP-Reputation": "+2" };
    else if ( val < 1000000 )
    vals = { "LP-Status": "LP 100K to 1M", "LP-Renown": "9", "LP-Reputation": "+4" };
    else
    vals = { "LP-Status": "LP over 1M", "LP-Renown": "7", "LP-Reputation": "+6" };
    if( vals[ "LP-Status" ] != values[ "LP-Status" ])
    setAttrsLog( vals );
  });
  } catch(err) {
    log("Earthdawn:updateLPStatus() error caught: " + err);
  }
};//end updateLPStatus
on("change:lp-total", fn(updateLpStatus) );



var updateMaBase = function fnupdateMaBase(eventInfo,cb) {
  'use strict';
  try{
   //log ( "EarthDawn : updateMaBase() ");
  getAttrs([ "Attrib-Wil-Curr", "MA-Base", "edition" ], function gaupdateMaBase(values) {
    'use strict';
    logvalues( values);
    let val = 0,vals={};
    if ( getEdition( values ) == 3 ) { // 3rd edition MA-Base
      if ( getInt( values, "Attrib-Wil-Curr") > 10)
        val += Math.ceil( ( getInt( values, "Attrib-Wil-Curr") - 10 ) /3 );
    } else    // 4th edition MA-Base
    val += Math.floor( getInt( values, "Attrib-Wil-Curr") / 5 );
    if( val != values[ "MA-Base" ])
      vals["MA-Base"]=val;
      setAttrsLog( vals,null,function(){
        updateDefenseNatural("armor-myst",cb);
      });
  });
  } catch(err) {
    log("Earthdawn:updateMaBase() error caught: " + err);
  }
}; // End updateMA()



var calcED3Defense = function fnCalcED3Defense(value) { // function used to calculate 3rd edition Defense value from an Attribute value
  'use strict';
  try{
  if ( value < 6) {
    return Math.floor(value/2)+2;
  } else if (value == 6) {
    return 4 ;
  } else {
    return 3 + calcED3Defense( value-7 );
  };
  } catch(err) {log("Earthdawn:calcED3Defense() error caught: " + err);}
}; // End calcED3Defense()



var updateMD = function fnUpdateMD() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMD() ");
  getAttrs([ "MD-Nat", "MD-Buff", "Defense-Myst-Adjust", "Shield-Myst", "Shield-Myst-Buff", "condition-Blindsided",  "Adjust-Defenses-Total", "edition", "MD" ], function gaUpdateMD(values) { //"condition-NoShield",
    'use strict';
    logvalues( values);
    let vals={};
    let val = getInt( values, "MD-Nat") + getInt( values, "MD-Buff") + getInt( values, "Defense-Myst-Adjust" );
    let valauto = getInt(values, "Adjust-Defenses-Total");
    if((getEdition( values ) === 4) && (values[ "condition-Blindsided" ] != "1") ){ //&& (values[ "condition-NoShield" ] != "1"
      let shield = getInt( values, "Shield-Myst" ) + getInt( values, "Shield-Myst-Buff" );
      val += shield;
      valauto += shield;
    };
    let valunmod= val - valauto - getInt(values, "MD-Buff");
    vals[ "MD" ]=val;
    vals[ "MD-Mod-Auto" ]=valauto;
    vals[ "MD-UnMod" ]=valunmod;
    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:updateMD() error caught: " + err);}
}; // End updateMD()
on("change:md-nat change:defense-myst-adjust change:md-buff change:shield-myst change:shield-myst-buff ", fn(updateMD) ); //change:condition-noshield
//edition via recalc, Adjust-Defenses-Total via md-nat



var updateMovement = function fnUpdateMovement() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMovement() ");
  getAttrs([  "Fly-Movement", "Fly-Movement-Race", "Misc-Fly-Movement-Adjust", "Movement", "Movement-Race", "Misc-Movement-Adjust", "Movement-Buff", "condition-ImpairedMovement",
  "condition-KnockedDown" ], function gaUpdateMovement(values) {
    'use strict';
    logvalues( values);
    let val,fval;
    let auto;
    let base = getInt(values, "Movement-Race") + getInt(values,"Misc-Movement-Adjust");
    let fbase = getInt(values, "Fly-Movement-Race") + getInt(values,"Misc-Fly-Movement-Adjust");
    let vals = {};
    if( values[ "condition-KnockedDown" ] == "1" ) val = 2
    else
    val = base + getInt( values, "Movement-Buff");
    fval = fbase + getInt( values, "Movement-Buff");
    val -= Math.ceil( getInt( values, "condition-ImpairedMovement") * 2.45);
    fval -= Math.ceil( getInt( values, "condition-ImpairedMovement") * 2.45);
    auto = val - base - getInt( values, "Movement-Buff");
    if ( val < 1 )
    val = "1*";
    if ( fval < 1 )
    fval = "1*";
    vals[ "Movement" ] = val;
    vals[ "Movement-Base" ] = base;
    vals[ "Movement-Mod-auto" ] = auto;
    vals[ "Fly-Movement" ] = fval;
    vals[ "Fly-Movement-Base" ] = fbase;
    setAttrsLog( vals );
  });
  } catch(err) {log("Earthdawn:updateMovement() error caught: " + err);}
};  //end updateMovement
on("change:fly-movement-race change:misc-fly-movement-adjust change:movement-race change:misc-movement-adjust change:movement-buff change:condition-impairedmovement change:condition-knockeddown", fn(updateMovement) );



var updateMysticArmor = function fnUpdateMysticArmor() {
  'use strict';
  try{
  // log ( "EarthDawn : updateMysticArmor() ");
  getAttrs([ "Armor-Myst", "MA-Buff", "Armor-Myst-Adjust", "MA-Nat", "condition-Blindsided", "Shield-Myst", "edition" , "Mystic-Armor", "Shield-Myst-Buff"], function gaUpdateMysticArmor(values) { //, "condition-NoShield"
    'use strict';
    logvalues( values);
    let val = getInt( values, "Armor-Myst") + getInt( values, "Armor-Myst-Adjust") + getInt( values, "MA-Nat") +
    getInt( values, "MA-Buff");
    if((getEdition( values ) != 4) && (values[ "condition-Blindsided" ] != "1") ) //&& (values[ "condition-NoShield" ] != "1"
    val += getInt( values, "Shield-Myst" ) + getInt( values, "Shield-Myst-Buff" ) ;
    if( val != values[ "Mystic-Armor" ])
    setAttrsLog({ "Mystic-Armor": val });
  });
  } catch(err) {log("Earthdawn:updateMysticArmor() error caught: " + err);}
}; // End updateMysticArmor()
on("change:armor-myst change:ma-buff change:armor-myst-adjust change:ma-nat change:condition-blindsided change:shield-myst change:shield-myst-buff", fn(updateMysticArmor) ); // change:condition-noshield
//edition in recalc



var updateDefensebase = function fnUpdateDefensebase( attr, def,cb) {
  'use strict';
  try{
   //log ( "EarthDawn : updateDefensebase( " + attr + " , " + def + " )");
  let attrib = "Attrib-" + attr + "-Curr",
  defense = def + "-Base";
  let vals = {};

  getAttrs([ attrib, defense, "edition" ], function gaUpdateDefensebase(values) {
    'use strict';
    logvalues( values);
    let val = 0;
    if ( getEdition( values ) == 3 )  // 3rd edition defense Base
    val += calcED3Defense( getInt( values, attrib) );
    else // 4th edition defense Base
    val += Math.floor(( getInt( values, attrib) +1 ) / 2 ) + 1;
    if( val != values[ defense ]) {
      vals[ defense ] = val;}
      setAttrsLog( vals,null,function(){
        updateDefenseNatural(def,cb);
      });
  });
} catch(err) {log("Earthdawn:updateDefensebase() error caught: " + err + " attr: "+attr + " def: "+def);}
}; // End updateDefensebase()
//Directly triggered in UpdateCurr



// Natural attributes, adjusted only for things specific to Natural values, and combat options and conditions.
// A callback ensures synchronism when importing a creature or NPC
// A backfill ensures that user can directly modify the value and have it backfill to the adjustment
var updateDefenseNatural = function fnUpdateDefenseNatural( eventInfo , cb) {
  'use strict';
  try{
    let att =getAttrib(eventInfo).toLowerCase();
    let vals = {};
     //log ( "EarthDawn : updateDefenseNatural( " + att + " )");
    let att2, att3, att4, att5,backfill, defAdjust = 0;
    if(att.endsWith("-nat")) { //This is a potentially a backfill
      if(eventInfo && !_.isString(eventInfo) && eventInfo.sourceType=="player") backfill=true;
      else return;
    }
    if( att.startsWith( "defense-" ) )    // Defense-Phys/Myst/Soc-Nat-Adjust
    att2 = getParam( att, 2, "-").slice( 0,1 ) + "d";
    else if( att.startsWith( "armor-" ) )     // Armor-Phys/Myst-Nat-Adjust
    att2 = getParam( att, 2, "-").slice( 0,1 ) + "a";
    else                          // PD/MD/SD/MA-Base
    att2 = getParam( att, 1, "-");
    switch ( att2 ) {
      case "pd":      att3 = "PD";    att4 = "Defense-Phys-Nat-Adjust"; att5 = "Defense-Phys-Nat-Auto-Adjust";  defAdjust = 1;    break;
      case "md":      att3 = "MD";    att4 = "Defense-Myst-Nat-Adjust"; att5 = "Defense-Myst-Nat-Auto-Adjust";  defAdjust = 1;    break;
      case "sd":      att3 = "SD";    att4 = "Defense-Soc-Nat-Adjust";  att5 = "Defense-Soc-Nat-Auto-Adjust";           break;
      case "pa":      att3 = "PA";    att4 = "Armor-Phys-Nat-Adjust";   att5 = "Armor-Phys-Nat-Auto-Adjust";            break;
      case "ma":      att3 = "MA";    att4 = "Armor-Myst-Nat-Adjust";   att5 = "Armor-Myst-Nat-Auto-Adjust";            break;
      default:
      log("Earthdawn sheetworker error, updateDefenseNatural found " + att );
      return;
    }
    // There is no PA-Base, but this should default gracefully.
    getAttrs([ att3 + "-Base", att4, att5 , att3 + "-Nat", att3+"-Nat-addSR", "SrRating", "RacialAbilities", "Adjust-Defenses-Total"], function gaUpdateDefenseNatural(values) {
      'use strict';
      logvalues( values);
      let ra=values["RacialAbilities"]||"";
      let val = getInt( values, att3 + "-Base") + getInt( values, att4) + Math.max(0,getInt( values, att5))
      + ((getInt( values, "Adjust-Defenses-Total") ) * defAdjust)  + (getInt(values,att3+ "-Nat-addSR") * getInt(values,"SrRating"));
      if( att3 === "PD" && (ra.includes("Increased PD")||ra.includes("Increased Physical Def")))   // Windlings get 2 extra PD.
      val += 2;
      if( att3 === "PA" && ra.includes("Natural Armor"))   // Obsidimen get 3 extra PA.
      val += 3;
      if( val != getInt(values, att3 + "-Nat" )) {
        if(!backfill) vals[ att3 + "-Nat" ] = val; //Set the Nat values
        else vals[ att4 ] = getInt(values, att4 ) + getInt(values, att3 + "-Nat") - val;
      }
      setAttrsLog( vals, null , function(){
      //  log ( "EarthDawn : updateDefenseNatural( " + att + " )" + " returning " +JSON.stringify(vals));
        if(cb) cb();
      });
    });
  } catch(err) {log("Earthdawn:updateDefenseNatural() error caught: " + err + " aeventInfottr: "+JSON.stringify(eventInfo));}
}; // End updateDefenseNatural()

on("change:pd-base change:md-base change:sd-base change:defense-phys-nat-adjust change:defense-myst-nat-adjust change:defense-soc-nat-adjust change:armor-phys-nat-adjust change:armor-myst-nat-adjust change:defense-phys-nat-auto-adjust change:defense-myst-nat-auto-adjust change:defense-soc-nat-auto-adjust change:ma-base change:armor-phys-nat-auto-adjust change:armor-myst-nat-auto-adjust", fn(updateDefenseNatural) );
on("change:adjust-defenses-total ", fn(function ocAdjustDefensesTotal() {
  'use strict';
  updateDefenseNatural( "PD" );
  updateDefenseNatural( "MD" );
}));
on("change:pd-nat change:md-nat change:sd-nat change:pa-nat change:ma-nat", fn(updateDefenseNatural) );
on("change:pd-nat-addsr change:md-nat-addsr change:sd-nat-addsr change:pa-nat-addsr change:ma-nat-addsr", fn(updateDefenseNatural) );



var updatePD = function fnUpdatePD() {
  'use strict';
  try{
  // log ( "EarthDawn : updatePD() ");
  getAttrs([ "PD-Nat", "PD-Buff","Adjust-Defenses-Total", "Defense-Phys-Adjust", "Shield-Phys", "Shield-Phys-Buff", "condition-Blindsided",  "edition", "PD" ], function gaUpdatePD(values) { //"condition-NoShield",
    'use strict';
    logvalues( values);
    let vals={};
    let val = getInt( values, "PD-Nat") + getInt( values, "PD-Buff") + getInt( values, "Defense-Phys-Adjust" );
    let valauto= getInt (values, "Adjust-Defenses-Total");
    if((getEdition( values ) === 4) && (values[ "condition-Blindsided" ] != "1")){ // && (values[ "condition-NoShield" ] != "1"
      let shield = getInt( values, "Shield-Phys" ) + getInt( values, "Shield-Phys-Buff" );
      val+=shield;
      valauto+=shield;
    };
    let valunmod= val - valauto - getInt (values, "PD-Buff");
    vals[ "PD" ] =val;
    vals[ "PD-Mod-Auto" ]=valauto;
    vals[ "PD-UnMod" ]=valunmod;
    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:updatePD() error caught: " + err);}
}; // End updatePD()
on("change:pd-nat change:pd-buff change:defense-phys-adjust change:shield-phys change:shield-phys-buff change:condition-blindsided ", fn(updatePD) ); //change:condition-noshield
//edition is in recalc. Adjust-Defenses-Total changes the PD-Nat



var updatePhysicalArmor = function fnUpdatePhysicalArmor() {
  'use strict';
  try{
  // log ( "EarthDawn : updatePhysicalArmor() ");
  getAttrs([ "Armor-Phys", "PA-Buff", "Armor-Phys-Adjust", "PA-Nat", "condition-Blindsided", "Shield-Phys", "Shield-Phys-Buff", "edition", "Physical-Armor" ], function gaUpdatePhysicalArmor(values) { //, "condition-NoShield"
    'use strict';
    logvalues( values);
    let val = getInt( values, "PA-Nat" ) + getInt( values, "Armor-Phys") + getInt( values, "Armor-Phys-Adjust") + getInt( values, "PA-Buff" );
    if((getEdition( values ) != 4) && (values[ "condition-Blindsided" ] != "1") ) //&& (values[ "condition-NoShield" ] != "1"
    val += getInt( values, "Shield-Phys" ) + getInt( values, "Shield-Phys-Buff" ) ;
    if( val != values[ "Physical-Armor" ])
    setAttrsLog({ "Physical-Armor": val });
  });
  } catch(err) {log("Earthdawn:updatePhysicalArmor() error caught: " + err);}
}; // End updatePhysicalArmor()
on("change:armor-phys change:pa-buff change:armor-phys-adjust change:pa-nat change:condition-blindsided change:shield-phys change:shield-phys-buff", fn(updatePhysicalArmor) ); //change:condition-noshield
//edition is in recalc



//UpdateRace can be triggered by various events
//1-Player choosing a Race from the dropdown (changing the Race value)
//2-Player dropping a Race from the compendium (in which case CompendiumDropMgt will call directly updaterace(Name, data))
//3-Recalc will make a direct call, with no name, and recalc as eventInfo
//4-FillDataCreature will also make a direct call, with a callback
//Other calls, especially should a sheetworker make the call will be ignored
//If the race is not recognized, Race_max will be used to mark it as homebrew and unlock what couldn't

var updateRace = function fnUpdateRace(eventInfo,data,cb) { // Race based modifiers/characteristics to Attributes
  'use strict';
  try{
    getAttrs(["Race", "edition","Race_max","edition_max","NPC"], function gaUpdateRace(values) {
      'use strict';
      logvalues( values);
      var race = values["Race"];
      let edition= getEdition( values );
      let vals={};
      let rjson, //Race Data
      compsearch=true, //manual flag to inhibit the compendium search. For testing purpose only
      found=false; //Result of the search
      let trigger; //What triggered the update

      //Writes the attributes one by one with single setAttrs calls.
      //singleAttr was useful for an unknown roll20 bug, but it doesn't seem to happen in this function. Left as a backup
      function singleAttr( key, val) {
        //let vals={};
        // log("setting key " + key + " to  " + val);
        vals[ key ] = val;
        //setAttrsLog( vals );
      }

      //due to the new format of races in v3 of the sheet we don't want updaterace to trigger before updateCharacterSheet has completed
      if(parseFloat( values[ "edition_max" ]) <3) {log("updateRace inhibited because older sheet version");return;}

      if(_.isString(eventInfo)){
        if(data && data!=="" && data!=={}) {trigger="compendium"; race=eventInfo; vals["Race"]=race;}
        else if(eventInfo=="recalc") trigger="recalc";
        else {race=eventInfo; vals["Race"] = race ; trigger="NPCdrop"; } //log("Earthdawn updateRace - unknown manual trigger "); return;}
      } else {
        if(eventInfo && eventInfo.sourceType=="player" && eventInfo.previousValue!==eventInfo.newValue) trigger="player";
        else trigger="chain";
      }
      //log("update Race for " + race + " trigger " + trigger + " eventInfo " + JSON.stringify(eventInfo));
      //First check if we find a corresponding entry in the compendium
      getCompendiumPage("Races:" + race.replace("\'","%E2%80%99"), compendium_pages => { // need the replace for T'skrang
        if(trigger=="compendium") { //If we had already a direct call with data, use this data in priority
          rjson=data;
          vals["Race"]=race;
          found=true;
        }
        else {
          if(compsearch && compendium_pages && compendium_pages[0] && compendium_pages[0].id){ //We have an array instead of a JSON, so multiple matches
            log("Earthdawn-updateRace :Found multiple pages in the compendium, using the first one ??");
            rjson=compendium_pages[0].data;
            found=true;
            vals[ "Race-buttonInfo"]= "Races:" + race;
          } else  if(compsearch && compendium_pages && compendium_pages.id){ //We found a unique page
            //log("Earthdawn-updateRace :Found one page in the compendium " + compendium_pages.id);
            rjson=compendium_pages.data;
            found=true;
            vals[ "Race-buttonInfo"]= "Races:" + race;
          }
          // else {
          //   //if(race!=="" && race!=="Creature" && race!=="Spirit")
          //   log("Earthdawn-updateRace :No match in Compendium for " + race + " Using local database");
          // }

          if(values["NPC"]=="-1"){ //Objects : reset everything
            rjson={roll20_isNamegiver:0 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 0, roll20_Attrib_Tou_Race:0, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:0, roll20_Attrib_Cha_Race:0, roll20_RacialAbilities:""};
            found=true;
          //If we didn't find in the compendium, proceed searching in the local database, per edition
          } else if(!found) {
            //log("updateRace looking in local database");
            if(edition==3)
            switch(race){
              case "Dwarf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 12, roll20_Attrib_Tou_Race:13, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:8, roll20_Movement_Race:10, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 5,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Strong Back, Heat Sight"}; break;
              case "Elf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 12, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:11, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:14, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Low-Light Vision"}; break;
              case "Human" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:10, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:12, roll20_Karma_Modifier:5,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Versatility" , abilityadd:"{names:\"Versatility\",code:\"T\",rep:\"repeating_talents\",\"roll20_Type\":\"Racial\"}" }; break;
              case "Obsidiman" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 8, roll20_Attrib_Str_Race: 18, roll20_Attrib_Tou_Race:13, roll20_Attrib_Per_Race:9, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:9, roll20_Movement_Race:10, roll20_Karma_Modifier:3,roll20_Creature_ResistPain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1.25" , roll20_RacialAbilities:"Natural Armor, Increased Wound Threshold"}; break;
              case "Ork" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 13, roll20_Attrib_Tou_Race:11, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:8, roll20_Attrib_Cha_Race:9, roll20_Movement_Race:12, roll20_Karma_Modifier:5,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Gahad, Low Light Vision"}; break;
              case "Troll" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 14, roll20_Attrib_Tou_Race:12, roll20_Attrib_Per_Race:9, roll20_Attrib_Wil_Race:11, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:14, roll20_Karma_Modifier:3,roll20_Creature_ResistPain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1.25" , roll20_RacialAbilities:"Heat Sight"}; break;
              case "Tskrang" : case "T'skrang" : case "TSkrang" : case "TSkrang" : case "Tskrang" :
              case "T'skrang" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:11, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:12, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"1", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Tail Combat"}; break;
              case "Windling" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 4, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:12, roll20_Movement_Race:6,roll20_Fly_Movement_Race:16, roll20_Karma_Modifier:6,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:1, twohandmax: 2 ,roll20_Fly_max:"1", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "0.2" , roll20_RacialAbilities:"Flight, Increased PD, Astral Sight", abilityadd:"{\"names\": \"Astral Sight (Racial)\",\"code\":\"T\",\"rep\":\"repeating_talents\",\"roll20_Type\":\"Racial\"}"}; break;
              case "Blood Elf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:12, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:14, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:1, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Low-Light Vision, Longing, Pain Resistance, Protected, Thorned"}; break;
              case "" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:10, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:12, roll20_Karma_Modifier:0,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:""}; break;
              case "Spirit" : case "Creature": case "Horror": case "Dragon":
              case "Other": rjson={roll20_isNamegiver:0 ,  roll20_WeightAdjustment: "1" , roll20_RacialAbilities:""}; break;
              default: rjson="";
            } else
            switch(race){
              case "Dwarf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 9, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:12, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:11, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:10, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 5 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Strong Back, Heat Sight"}; break;
              case "Elf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 12, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:11, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:14, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Low-Light Vision"}; break;
              case "Human" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:10, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:12, roll20_Karma_Modifier:5,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Versatility" , abilityadd:"{\"names\": \"Versatility\",\"code\":\"T\",\"rep\":\"repeating_talents\",\"roll20_Type\":\"Racial\"}" }; break;
              case "Obsidiman" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 8, roll20_Attrib_Str_Race: 18, roll20_Attrib_Tou_Race:13, roll20_Attrib_Per_Race:9, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:9, roll20_Movement_Race:10, roll20_Karma_Modifier:3,roll20_Creature_ResistPain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1.25" , roll20_RacialAbilities:"Natural Armor, Increased Wound Threshold"}; break;
              case "Ork" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 13, roll20_Attrib_Tou_Race:11, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:8, roll20_Attrib_Cha_Race:9, roll20_Movement_Race:12, roll20_Karma_Modifier:5,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Gahad, Low Light Vision"}; break;
              case "Troll" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 14, roll20_Attrib_Tou_Race:12, roll20_Attrib_Per_Race:9, roll20_Attrib_Wil_Race:11, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:14, roll20_Karma_Modifier:3,roll20_Creature_ResistPain:0, onehandmin:2, onehandmax:4, twohandmax: 7 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1.25" , roll20_RacialAbilities:"Heat Sight"}; break;
              case "Tskrang" : case "T'skrang" : case "TSkrang" : case "TSkrang" : case "Tskrang" :
              case "T'skrang" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:11, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:12, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"1", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Tail Combat"}; break;
              case "Windling" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 4, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:12, roll20_Movement_Race:6,roll20_Fly_Movement_Race:16, roll20_Karma_Modifier:6,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:1, twohandmax: 2 ,roll20_Fly_max:"1", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "0.2" , roll20_RacialAbilities:"Flight, Increased PD, Astral Sight", abilityadd:"{\"names\": \"Astral Sight (Racial)\",\"code\":\"T\",\"rep\":\"repeating_talents\",\"roll20_Type\":\"Racial\"}"}; break;
              case "Blood Elf" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 11, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:8, roll20_Attrib_Per_Race:11, roll20_Attrib_Wil_Race:12, roll20_Attrib_Cha_Race:11, roll20_Movement_Race:14, roll20_Karma_Modifier:4,roll20_Creature_ResistPain:1, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:"Low-Light Vision, Longing, Pain Resistance, Protected, Thorned"}; break;
              case "" : rjson={roll20_isNamegiver:1 , roll20_Attrib_Dex_Race: 10, roll20_Attrib_Str_Race: 10, roll20_Attrib_Tou_Race:10, roll20_Attrib_Per_Race:10, roll20_Attrib_Wil_Race:10, roll20_Attrib_Cha_Race:10, roll20_Movement_Race:12, roll20_Karma_Modifier:0,roll20_Creature_ResistPain:0, onehandmin:1, onehandmax:3, twohandmax: 6 ,roll20_Fly_max:"0", roll20_TailAttack_max:"0", roll20_WeightAdjustment: "1" , roll20_RacialAbilities:""}; break;
              case "Spirit" : case "Creature": case "Horror": case "Dragon":
              case "Other": rjson={roll20_isNamegiver:0 ,  roll20_WeightAdjustment: "1" , roll20_RacialAbilities:""}; break;
              default: rjson="";
            }
            //log("rjson" + JSON.stringify(rjson));
            if(rjson!=="") found=true;
            else vals["Race_max"]="HomeBrew";
            vals["Race-buttonInfo"]=""; //Reset the button info if the race had been previously set by compendium
          }
        } //end of the search for data, proceeding to process it

        if(found){

          //Commented out v3.1
          //vals["Creature-Durability"] = ((race=="Creature" ||race=="Horror" || race=="Dragon") ? "5" :  "0"); //Creatures have a fake durability to help scaling them with Challenge Rating

          vals["Race_max"]="";
          let fields=["isNamegiver","Attrib-Dex-Race","Attrib-Str-Race","Attrib-Tou-Race","Attrib-Per-Race","Attrib-Wil-Race","Attrib-Cha-Race","Movement-Race","Creature-ResistPain","RacialAbilities","Karma-Modifier","Fly-Movement-Race","Fly_max","TailAttack_max","WeightAdjustment"];

          //Process each data prefixed by roll20_ that is meant to be copied as is
          for (const field of fields)
          if(rjson["roll20_"+field.replace(/\-/g,"_")]!=undefined)     singleAttr( field,rjson["roll20_"+field.replace(/\-/g,"_")] ); //the replace is necessary because JSON doesn't take - as separator...

          //Process abilityadd that creates the racial Talents
          if(rjson.abilityadd){
            //log(rjson.abilityadd);
            let newdata=parseJSON(rjson.abilityadd);
             //log("processing new data " + JSON.stringify(newdata));
            if( newdata.names && newdata.code && newdata.rep)
            AbilityDrop(newdata.names,newdata.rep,newdata.code,"",newdata,"AbilityAdd");
          }

          //Process size restrictions
          if(rjson.onehandmin) vals["SizeRestriction"]="One Hand : " + rjson.onehandmin +(rjson.onehandmin==rjson.onehandmax? "" : ("-"+rjson.onehandmax))
          +" ,Two Hands : " + (parseInt2(rjson.onehandmax)+1) +((parseInt2(rjson.onehandmax)+1)==rjson.twohandmax? "" : ("-"+rjson.twohandmax));
        }

        //Some cases we had a direct call, not due to a change of the attribute, so make sure Race is up to date
        // if(race && race!=="0" &&  trigger !=="recalc" && values["Race"]!==race)
        //   vals["Race"]=race;

        setAttrsLog(vals,null,function(){
          updateCarry();
          updateKarma();
          updateDefenseNatural( "PD",function(){
            updateDefenseNatural( "PA",function(){
              updateDurability(null,function(){
                updateHealth(null,function(){
                  updateRecovery(null, function(){
                  if(cb) cb();
                });
                });
              });
            });
          });
        });
      });
    });
  } catch(err) {log("Earthdawn:updateRace() error caught: " + err);}
}; // End on updateRace()
on("change:race change:npc", fn(updateRace) );


//callback added for fillentrycreature
var updateRecovery = function fnUpdateRecovery(eventInfo,cb) {
  'use strict';
  try{
  // log ( "EarthDawn : updateRecovery() ");
  getAttrs([ "Recovery-Step", "Tou-Step","Tou-Mods","Adjust-Effect-Tests-Total", "Recovery-Adjust", "Recovery-Buff", "Wounds", "Creature-Fury", "Creature-ResistPain"  ], function gaUpdateRecovery(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "Tou-Step" ) + getInt( values, "Tou-Mods" ) + getInt(values, "Adjust-Effect-Tests-Total") + getInt( values, "Recovery-Adjust") + getInt( values, "Recovery-Buff" )
    - (getInt( values, "Wounds") * (getInt( values, "Wounds") <= getInt( values, "Creature-Fury" ) ? 0 : -1 ))
    - Math.min( getInt( values, "Wounds"), getInt( values, "Creature-ResistPain" ));

    setAttrsLog({ "Recovery-Step": val },null,function() {
      if(cb) cb();
    });
  });
} catch(err) {log("Earthdawn:updateRecovery() error caught: " + err);}
}; // End updateRecovery()
on("change:tou-effect change:recovery-adjust change:recovery-buff", fn(updateRecovery) );
//on("change:adjust-all-tests-auto change:adjust-all-tests-misc change:adjust-effect-tests-auto change:adjust-effect-tests-misc change:combatoption-tailattack", fn(function ocConAdjustAllTestsMisc() {
//  'use strict';
//  updateRecovery();
//}));



var updateSD = function fnUpdateSD() {
  'use strict';
  try{
  // log ( "EarthDawn : updateSD() ");
  getAttrs([ "SD-Nat","Defense-Soc-Adjust", "SD-Buff", "SD" ], function gaUpdateSD(values) {
    'use strict';
    logvalues( values);
    let val = getInt( values, "SD-Nat") + getInt( values, "Defense-Soc-Adjust" ) + getInt( values, "SD-Buff");
    // In most cases SD does not get adjusted with the other ones.
    //  + getInt( values, "Adjust-Defenses-Total" )
    if( val != values[ "SD" ])
    setAttrsLog({ "SD": val });
  });
} catch(err) {log("Earthdawn:updateSD() error caught: " + err);}
}; // End updateSD()
on("change:sd-nat change:defense-soc-adjust change:sd-buff", fn(updateSD) );



var updateWeightCoin = function fnUpdateWeightCoin() {
  'use strict';
  try{
  getAttrs([ "Wealth_Gold", "Wealth_Silver", "Wealth_Copper", "Weight-Coin" ], function gaUpdateWeightCoin(values) {
    'use strict';
    logvalues( values);
    let gold = getInt( values, "Wealth_Gold"), silver = getInt( values, "Wealth_Silver"), copper = getInt( values, "Wealth_Copper"),
    gchanged = false, schanged = false, cchanged = false, loop,
    vals = {};
    do {
      loop = false;   // If a coin is negative, try making change until everything is positive.
      if( gold > 0 && silver < 0 ) { --gold; silver += 10; gchanged = schanged = loop = true;}
      if( (gold > 0 || silver > 0) && copper < 0 ) { --silver; copper += 10; schanged = cchanged = loop = true;}
      if( copper > 99 || silver > 9 && gold < 0 ) { ++gold;   silver -= 10; gchanged = schanged = loop = true;}
      if( copper > 9 && silver < 0 ) { ++silver; copper -= 10; schanged = cchanged = loop = true;}
    } while ( loop );
    let val = Math.round((gold / 80) + (silver / 64 ) + (copper / 48));
    if( val != values[ "Weight-Coin" ])   vals[ "Weight-Coin" ] = val;
    if( gchanged )              vals[ "Wealth_Gold" ] = gold;
    if( schanged )              vals[ "Wealth_Silver" ] = silver;
    if( cchanged )              vals[ "Wealth_Copper" ] = copper;
    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
  } catch(err) {log("Earthdawn:updateWeightCoin() error caught: " + err);}
};
on("change:wealth_gold change:wealth_silver change:wealth_copper", fn(updateWeightCoin) );



var updateWeightEquipment = function fnUpdateWeightEquipment() {
  try{
  'use strict';
  let inArray = [];
  inArray.push( "Weight-Equipment" );
  // inArray.push( "Armor-Weight" );
  // inArray.push( "Shield-Weight" );
  inArray.push( "Weight-Mod" );
  // getSectionIDs("weapons", function(idarray) {
  //   for(let i=0; i < idarray.length; i++){
  //     inArray.push( buildPre( "WPN", idarray[ i ]) + "Weight" );
  //     inArray.push( buildPre( "WPN", idarray[ i ]) + "AmmoQty" );
  //     inArray.push( buildPre( "WPN", idarray[ i ]) + "AmmoWeight" );
  // }
    getAttrs( inArray, function gaUpateWeightEquipment(values) {
      'use strict';
      logvalues( values);
      let val = 0;
      // val += getInt( values, "Armor-Weight");
      // val += getInt( values, "Shield-Weight");
      val += getInt( values, "Weight-Mod");
      // for( let i=0; i < idarray.length; i++ ){
      //   val += parseFloat( (values[ buildPre( "WPN", idarray[ i ]) + "Weight"])||"0");
      //   val += getInt( values, buildPre( "WPN", idarray[ i ]) + "AmmoQty")*parseFloat( (values[ buildPre( "WPN", idarray[ i ]) + "AmmoWeight"])||"0");
      // }
      if( val !== getInt( values, "Weight-Equipment" ))
      setAttrsLog({ "Weight-Equipment": val });
    });
  // });
  } catch(err) {log("Earthdawn:updateWeightEquipment() error caught: " + err);}
}; //end updateWeightEquipment
on("change:armor-weight change:shield-weight change:weight-mod change:repeating_weapons:wpn_weight change:repeating_weapons:wpn_ammoweight change:repeating_weapons:wpn_ammoqty", fn(updateWeightEquipment) );



var updateWeightSupply = function fnUpdateWeightSupply() {
  try{
  'use strict';
  getAttrs([ "Healing_Booster", "Healing_Healing", "Healing_Last_Chance", "Healing_Closure", "Healing_Kit", "Healing_Physician_Kit", "Gear_Rations_Trail", "Gear_Rations_Mine", "Weight-Supply" ], function gaUpdateWeightSupply(values) {
    'use strict';
    logvalues( values);
    let val = Math.round((getInt( values, "Healing_Booster") * 2) + (getInt( values, "Healing_Healing") * 2 ) + getInt( values, "Healing_Last_Chance") +
    getInt( values, "Healing_Closure") + (getInt( values, "Gear_Rations_Trail") * 1.428 ) + (getInt( values, "Gear_Rations_Mine") * 0.8571));
    if( getInt( values, "Healing_Kit") > 0)
    val += 5;
    if( getInt( values, "Healing_Physician_Kit") > 0)
    val += Math.floor((getInt( values, "Healing_Physician_Kit") + 8) / 3);
    if( val != values[ "Weight-Supply" ])
    setAttrsLog({ "Weight-Supply": val });
  });
  } catch(err) {log("Earthdawn:updateWeightSupply() error caught: " + err);}
};  // end updateWeightSupply
on("change:healing_booster change:healing_healing change:healing_last_chance change:healing_closure change:healing_kit change:healing_physician_kit change:gear_rations_trail change:gear_rations_mine", fn(updateWeightSupply) );



var updateTalentSummary = function fnupdateTalentSummary() {
  'use strict';
  try{
    var attarray = ["uatta","edition"];
    // log ( "EarthDawn : updateTalentSummary() ");
    getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(marray) {
      for( let i = 0; i < marray.length; i++) {
        attarray.push( buildPre( "SPM", marray[ i ] ) + "Rank");
        attarray.push( buildPre( "SPM", marray[ i ] ) + "Origin");
      }
      getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
        for( let i = 0; i < tarray.length; i++) {
          attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
          attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
          attarray.push( buildPre( "T", tarray[ i ] ) + "Type_max");
          attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
        }
        getSectionIDsOrdered("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
          for( let i = 0; i < darray.length; i++){
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Name_max");
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Type");
            attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
          }
          getAttrs( attarray , function gaTalentSummary(values) {
            'use strict';
            logvalues( values);
            var s = "",
            nbDisc = 0,
            arr = [],
            circle, ddata,
            vrnk=0,
            uatta=(values["uatta"]=="1"),
            tmp, rnk,val="",nbtalent=0,broken=false;

            for( let i = 0; i < marray.length; i++) {
              rnk = values[ buildPre( "SPM", marray[ i ] ) + "Rank" ];
              tmp = values[ buildPre( "SPM", marray[ i ] ) + "Origin" ];
              if( tmp && tmp.indexOf( "-" ) !== -1 && tmp !== "Item-link" && tmp !== "Free-link")
              arr.push( { type: getParam( tmp, 1, "-"), level: getParam( tmp, 2, "-"), rank: rnk} );
            }

            for( let i = 0; i < tarray.length; i++) {
              rnk = values[ buildPre( "T", tarray[ i ] ) + "Rank" ];
              if(values[ buildPre( "T", tarray[ i ] ) + "Name" ].toLowerCase().startsWith("versatility")) vrnk=rnk; //We have versatility
              tmp = values[ buildPre( "T", tarray[ i ] ) + "Type" ];
              if( !tmp || tmp=="" || tmp=="0") tmp= "D1-Novice";
              if( tmp.indexOf( "-" ) != -1) arr.push( { type: getParam( tmp, 1, "-"), level: getParam( tmp, 2, "-"), rank: rnk} ); //We're only interested in values with - as they are either Versatility or Discipline or Path or QD
              tmp = values[ buildPre( "T", tarray[ i ] ) + "Type_max" ]; //Dealing with talents of multiple disciplines, comma separated list of Origins
              if(tmp){
                let tmp2=tmp.split(",");
                for(let i=0; i<tmp2.length;i++)
                  if( tmp2[i].indexOf( "-" ) != -1) arr.push( { type: getParam( tmp2[i], 1, "-"), level: getParam( tmp2[i], 2, "-"), rank: rnk} ); //We're only interested in values with - as they are either Versatility or Discipline or Path or QD
              }
            }

            var artype = _.groupBy( arr, "type");       // Now artype is an object whose named properties are objects (groups) that contain arrays of objects.
            // var artype2 = _.sortBy( artype, x => x[0].type);  // artype2 is an array of arrays of objects.

            // log("artype " + JSON.stringify(artype));
            // log("artype2 " + JSON.stringify(artype2));

            if(vrnk>0 || (artype["V"])){
              let vnb=(artype["V"] ? artype["V"].length : 0);

              val+="Versatility: " + vnb + " of " + vrnk;
              artype["V"]=[];
              //testing if broken
              if (vnb>vrnk)
              val+= " - Abnormal number of Talents!!!";
              val+="\n"
            }

            for( let i = 0; i < darray.length; i++) {
              let dname=values[buildPre( "DSP", darray[ i ] ) + "Name"]||"",
              dtype=values[buildPre( "DSP", darray[ i ] ) + "Type"]||"";

              if( dtype=="Discipline") { //Discipline D1 - (name) - C5 - Novice DT 8 of 8 TO: 3 of 4, Journeyman DT 1 of 1, TO 0 of 1.   5 of 8 at rank 6+
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                ++nbDisc; // nbDisc is now the number of disciplines

                if(nbDisc<=4){
                  let dtn=(artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Novice"}).length) : 0),
                  dtnm=( Math.min(8, circle+4)),
                  ton=(artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Novice"}).length) : 0),
                  tonm=( Math.min(4, circle)),
                  dtj=(artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Journeyman"}).length) : 0),
                  dtjm= ( Math.min(4, Math.max(0,circle-4))),
                  toj=(artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Journeyman"}).length) : 0),
                  tojm=( Math.min(4, Math.max(0,circle-4))),
                  dtw=(artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Warden"}).length) : 0),
                  dtwm=( Math.min(4, Math.max(0,circle-8))),
                  tow=(artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Warden"}).length) : 0),
                  towm=( Math.min(4, Math.max(0,circle-8))),
                  dtm=(artype["D"+nbDisc] ? (_.where(artype["D"+nbDisc],{level: "Master"}).length) : 0),
                  dtmm=( Math.min(4, Math.max(0,circle-12))),
                  tom=(artype["TO"+nbDisc] ? (_.where(artype["TO"+nbDisc],{level: "Master"}).length) : 0),
                  tomm=( Math.min(4, Math.max(0,circle-12)));

                  // Generating the text
                  val+="D" + nbDisc + "- " + dname + " - C" + circle
                  + " - Novice DT: " + dtn + " of " + dtnm
                  + ", TO: " +  ton + " of " + tonm;
                  if(circle > 4 ||  dtj>0 ||  toj>0 )
                  val+=" - Journeyman DT: " + dtj + " of " + dtjm
                  + ", TO: " +  toj + " of " + tojm;
                  if(circle > 8 ||  dtw>0 ||  tow>0)
                  val+=" - Warden DT: " + dtw + " of " + dtwm
                  + ", TO: " + tow + " of " + towm;
                  if(circle > 12 ||  dtm>0 ||  tom>0)
                  val+=" - Master DT: " + dtm + " of " + dtmm
                  + ", TO: " + tom + " of " + tomm;

                  //testing if broken
                  if (dtn>dtnm || dtj>dtjm || dtw>dtwm || dtm>dtmm  || ton>tonm || toj>tojm || tow>towm || tom>tomm || (circle <= 4 &&  (dtj>0 ||  toj>0 )) || (circle <= 8 &&  (dtw>0 ||  tow>0)) || (circle <= 12 &&  (dtm>0 ||  tom>0)))
                  val+= " - Abnormal number of Talents!!!"

                  //Counting Talents
                  nbtalent=0;
                  if(artype["D"+nbDisc])
                  for(let j=0;j<artype["D"+nbDisc].length;j++)
                  if(artype["D"+nbDisc][j]["rank"]>circle) nbtalent++;
                  if(uatta && artype["TO"+nbDisc])
                  for(let j=0;j<artype["TO"+nbDisc].length;j++)
                  if(artype["TO"+nbDisc][j]["rank"]>circle) nbtalent++;

                  val+=" - " + nbtalent + " of " + (circle+4) + " at rank "+(circle+1)+ (nbtalent>=(circle+4) ? (" - Ready for Next Circle " +(uatta ? " (UATTA: you need 1 talent from last circle)":"")) : "") + "\n";

                }
                else val+="D" + nbDisc + "- " + dname +" - The 4th disipline and all the next are counted together. Refer above for the count of Talents \n";
              }
              else if(dtype.startsWith("Path")){ //Path Path - (name) - Rk5 - Journeyman 4 of 4 , Master  1 of 1
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                let paj=(artype["PA"] ? (_.where(artype["PA"],{level: "Journeyman"}).length) : 0),
                pajm=( Math.min(4, circle)),
                paw=(artype["PA"] ? (_.where(artype["PA"],{level: "Warden"}).length) : 0),
                pawm=( Math.min(4, Math.max(0,circle-4))),
                pam=(artype["PA"] ? (_.where(artype["PA"],{level: "Master"}).length) : 0),
                pamm=( Math.min(8, Math.max(0,circle-8)));


                val+="Path" + "- " + dname + " - Rk " + circle
                + " - Journeyman : " + paj+ " of " + pajm;
                if(circle > 4 ||  paw>0)
                val+=" - Warden: " + paw + " of " + pawm;
                if(circle > 8 ||  pam)
                val+=" - Master: " + pam+ " of " + pamm;

                //testing if broken
                if (paj>pajm || paw>pawm || pam>pamm ||  (circle <= 4 &&  paw>0) || (circle <= 8 &&  pam>0))
                val+= " - Abnormal number of Talents!!!"
                val+="\n";
              }
              else if(dtype=="Questor"){ //QD - (name) - Rk5 - Wollower 4 of 4 , Adherant  1 of 1
                circle=getInt(values, buildPre( "DSP", darray[ i ] ) + "Circle" );
                let qdn=(artype["QD"] ? (_.where(artype["QD"],{level: "Follower"}).length) : 0),
                qdnm= ( Math.min(4, circle)),
                qdj=(artype["QD"] ? (_.where(artype["QD"],{level: "Adherent"}).length) : 0),
                qdjm=( Math.min(4, Math.max(0,circle-4))),
                qdw=(artype["QD"] ? (_.where(artype["QD"],{level: "Exemplar"}).length) : 0),
                qdwm= ( Math.min(8, Math.max(0,circle-8)));

                val+="Questor- Rk" + circle
                + " - Follower : " + qdn + " of " + qdnm;
                if(circle > 4 ||  qdj>0)
                val+=" - Adherent: " + qdj+ " of " + qdjm;
                if(circle > 8 ||  qdw>0)
                val+=" - Exemplar: " + qdw + " of " + qdwm;
                //testing if broken
                if (qdn>qdnm || qdj>qdjm || qdw>qdwm  || (circle <= 4 &&  qdj>0) || (circle <= 8 &&  qdw>0))
                val+= " - Abnormal number of Talents!!!"
                val+="\n";
              }
            }
          setAttrsLog({ "TalentSummary": val });
        });
      });
    });
  });
  } catch(err) {log("Earthdawn:updateTalentSummary() error caught: " + err);}
}; // End updateTalentSummary()
on("change:uatta change:repeating_discipline change:repeating_matrix:spm_rank change:repeating_matrix:spm_origin change:repeating_talents:t_rank change:repeating_talents:t_type change:repeating_talents:t_type_max remove:repeating_talents remove:repeating_matrix", fn(updateTalentSummary) );



// Split movement can only have two values, checked or . So if it is checked, it must have been  a second ago and visa versa.
// So adjust the value of Harried, assuming that SM used to be in its other state.
var CoSplitMovement = function fnCoSplitMovement() {
  'use strict';
  try{
  getAttrs([ "combatOption-SplitMovement", "condition-Harried" ], function gaCoSplitMovement(values) {
    'use strict';
    logvalues( values);
    var harr = getInt( values, "condition-Harried");
    if( getInt( values, "combatOption-SplitMovement" ))
    harr += (( harr == 0) ? 2 : 1);
    else
    harr -= (( harr == 2) ? 2 : 1);
    harr = Math.max( harr, 0);
    setAttrsLog({ "condition-Harried": harr });
  });
} catch(err) {log("Earthdawn:CoSplitMovement() error caught: " + err);}
};
on("change:combatoption-splitmovement", fn(CoSplitMovement) );



// Note: this routine just sets two hidden values, working-durability and working-circle. These are used in other calculations
//JBF it also sets the Circle for Free Talents and Matrixes, if the appropriate links have been created
// It also sets durability if durability-rating-adjust changed.
//For Creatures and Spirits, it takes into account the SrRating
var updateDurability = function fnupdateDurability(eventInfo,cb) {
  'use strict';
  try{
    //log ( "EarthDawn : updateDurability() " + JSON.stringify(eventInfo));
  // Go through all the discipline ranks and calculate durability.
  getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
    let i;
    var attarray = [];
    attarray.push("working-Durability");
    attarray.push("working-Circle");
    attarray.push("Durability-Rating-Adjust");
    attarray.push("DP_max");
    attarray.push("DevotionStep");
    attarray.push("SrRating");
    attarray.push("Creature-Durability");
    attarray.push("isNamegiver");

    for( i = 0; i < darray.length; i++) {
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Type");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "Durability");
      attarray.push( buildPre( "DSP", darray[ i ] ) + "LinksProvideValue_max");
    }
    getAttrs( attarray , function gaRdAttarray(values) {
      'use strict';
      logvalues( values);
      let i;
      var resarray = [],
      res2 = [];;
      let vals = {};
      var linkOutList;
      let ng = values["isNamegiver"]=="1"; //Is it a namegiver
        if(ng){
        for( i = 0; i < darray.length; i++) {
          linkOutList= values[buildPre( "DSP", darray[ i ] ) + "LinksProvideValue_max"];
          if( linkOutList.length > 2  ) UpdateLinkValue( linkOutList );
          var str1 = buildPre( "DSP", darray[ i ] ) + "Durability";
          var str2 = buildPre( "DSP", darray[ i ] ) + "Circle";
          var str3 = buildPre( "DSP", darray[ i ] ) + "Type";
          var durStored = values[ str1 ] || "-1";
          // var tmp = values[ str3 ] || "0";
          // var durCalc = parseInt2(tmp.slice( tmp.indexOf( ".") +1)); No more calculated durability by the code
          let sCircle = values[ str2 ] || "0";
          if (values[str3] === "Questor" ) {    // Questor - make sure devotion points and devotion step are right.
            let circle = parseInt2( sCircle );
            let calc = circle * 10;
            if( getInt(values,"DP_max" ) != calc )
            vals[ "DP_max" ] = calc;
            calc = Math.floor((circle + 11) / 4);
            if( calc != values[ "DevotionStep" ])
            vals[ "DevotionStep" ] = calc.toString();
          }
          // else if( durStored != durCalc && tmp != "0.5" && tmp != "89.0" && tmp != "98.5" && tmp != "99.5") {     // Don't do this if Discipline is Other/Misc or Questor as then the user enters durability manually.
          //   durStored = durCalc.toString();
          //   vals[ str1 ] = durCalc;
          // }  No more durCalc
          if( parseInt2( durStored ) > 0  && !["Questor" ,"Path-Journeyman","Path-Master" ].includes(values[str3])) {      // Skip questor and path
            resarray.push( ("000" + durStored).slice(-3) + ("000" + sCircle).slice(-3) );   // This gives 0DD0CC   Where DD is durability and CC is circle.
            res2.push( ("000" + sCircle).slice(-3) + ("000" + durStored).slice(-3));        // This gives 0CC0DD
          }
        }
        resarray.sort();    // Sorted by Durability followed by Circle.
        var dur = 0,
        cir = 0;
        for( i = resarray.length - 1; i > -1; i--) {      // Go through backwards so starting at highest durability
          var rank = parseInt2( resarray[ i ].slice( -3 ));
          if( rank > cir ) {
            dur += (rank - cir) * parseInt2(resarray[ i ].slice(0, 3));
            cir = rank;
          }
        }
        res2.sort();
        if( res2.length > 0 )   // Now do Durability Rank Adjust for whatever discipline has the highest rank.
        dur += getInt( values, "Durability-Rating-Adjust") * parseInt2( res2[ res2.length -1 ].slice(4));
         // console.log( "Durability: " + dur + " Circle: " + cir);
       } //end Namegiver case
       else { //Creature Case

         dur=getInt(values,"Creature-Durability")*5;
         cir="0";

         //Changed in v3.1 from a "fake Durability" to a Durability Rank
         // dur=getInt(values,"Creature-Durability")*getInt(values,"SrRating");
         // cir=values["SrRating"]||"0";
       } //end Creature Case
      if( dur != values[ "working-Durability" ])
      vals[ "working-Durability" ] = dur;
      if( cir != values[ "working-Circle" ])
      vals[ "working-Circle" ] = cir;
      //log("updateDurability " + JSON.stringify(vals));
      setAttrsLog( vals,null,function(){
      if(cb) cb()
      });
    });
  });
} catch(err) {log("Earthdawn:updateDurability() error caught: " + err);}
}; // End updateDurability
on("change:repeating_discipline change:durability-rating-adjust change:srrating change:creature-durability change:isnamegiver", fn(updateDurability) );



//JBF@CD This section is for routines used for the management of the links
//LinksProvideValue format is as follows
// Code;RowId,another link
var UpdateLinkValue = function fnUpdateLinkValue( linkOutList ) {
  'use strict';
  try {
      // log("Earthdawn UpdateLinkValue " + JSON.stringify(linkOutList));
    let linkout,
        code, rowid,
        linkOutArray = [];
    if( linkOutList.length > 2 ) {
//      linkoutlist2 = linkOutList.replace( "+" , ",")
      linkOutArray = linkOutList.split( "," );
    };
    for( let i = 0; i < linkOutArray.length; i++ ) {
      linkout = linkOutArray[ i ];
      code = getParam( linkout, 1 , ";" ) ;
      rowid = getParam( linkout, 2 , ";" );
      switch( code ) {//Extract the code
        case "NAC":
        case "WPN":
        case "SK":
        case "T":   repRanks( rowid, code , true); break;
        case "SPM": repMatrixType( rowid ); break;
        // case "DSP":
        // case "SKK":
        // case "SKAC":
        // case "SKA":
        // case "SKL":
        // case "TI":
        default: log("Earthdawn : Error in UpdateLinkValue : Not a Valid Link" + linkout);
      };
    };
  } catch(err) {log("Earthdawn:UpdateLinkValue() error caught: " + err + " linkOutList: "+ linkOutList);}
};//end UpdateLinkValue


// Calculate the Effective-Rank of repeating sections, including adjustments and links.
// This section has routines that might be called directly by an on change event,
// but could also be called by recalc() as part of an iteration through all their repeating sections.
var repRanks = function fnrepRanks( eventInfo ,code, sil) {
  'use strict';
  try{
        //log("repRanks " + JSON.stringify(eventInfo));
    if ( !eventInfo ) return;
    let att = getAttrib( eventInfo );
    if( !_.isString( eventInfo )) {
      let nm = repeatSection( 4, att ).toLowerCase();
      switch( nm ) {      // only continue with this routine if the name is one of those below, otherwise return without further processing.
        case "addsr":
        case "linksgetvalue":
        case "type":
        case "linksgetvalue_max":
        case "linksprovidevalue":
        case "linksprovidevalue_max":
        case "rank":
        case "rank-adjust":
        case "special": break;
        default : return;
      }
    }; //JBF This is code to deal with the fact that API SetWithWorkers doesn't trigger correctly on capitalized repeating_section. Could be deleted if roll20 gets its stuff together :)
    if( !code )     code = repeatSection( 3, att).toUpperCase();
    let pre = buildShortPre( eventInfo, code );
     //log("repranks for code " + code + " and pre " + pre + " and att "+att + " and eventInfo "+ JSON.stringify(eventInfo));

    let strT = pre + "Effective-Rank",
      strS1 = pre + "Rank",
      strS2 = pre + "Rank-Adjust",
      strS3 = pre + "Special",
      strN  = pre + "Name",
      strli = pre + "LinksGetValue_max",
      strlo = pre + "LinksProvideValue_max",
      straddsr = pre + "AddSR",
      strlv = pre + "LinkValue",
      strog = pre + "Type";
    getAttrs([ "SrRating" , straddsr, strS1, strS2, strS3, strT, strli, strlv, strlo, strN, strog ], function gaRepRank(values) {
      'use strict';
      logvalues( values);
      let linkInList = values[ strli ] || "",
        linkOutList = values[ strlo ] || "",
        linkInArray = [];
      if( linkInList.length > 2 ) linkInArray = linkInList.split(",");
        getAttrs( linkInArray, function gaRepRank2( values2 ) {
          'use strict';
          let link = 0, link2 = 0, vals = {}, val;
          for ( let i = 0; i < linkInArray.length; ++i ) {
            if( repeatSection( 3, linkInArray[ i ]).toUpperCase() == "DSP" && values[ strog ] == "Free" )
              link2 += getInt(values2, linkInArray [ i ]);  //for Free Talents Discipline links are summed in the Rank, not in the LinkedValue
            else
              link += getInt(values2, linkInArray [ i ]);
          };
          switch(values[straddsr]){
            case "1" : link += getInt(values,"SrRating"); break;
            case "0.5" : link += Math.ceil(getInt(values,"SrRating") /2); break;
          }



          if( getInt( values, strlv) != link)
            vals[ strlv ] = link;    // if the total we just calculated was not what we had stored, update what we have stored.
          if( linkInArray.length > 0 && getInt( values, strS1) != link2 && values[ strog ]=="Free") {
            vals[ strS1 ] = link2;    //If we are dealing with a free Talent, that is initialized (i.e. has already a link) use link2 as Rank
            val = link2;
          } else
            val = getInt( values, strS1);
          val +=  getInt( values, strS2) + link;    // Rank + Rank-Adjust + link value
          if( values[ strS3 ] === "Karma Ritual")     vals[ "KarmaRitual-Rank" ] = val;   // S3 is (code)_Special.
          if( values[ strS3 ] === "Speak Language")   vals[ "LT-Speak-Rank" ] = val;
          if( values[ strS3 ] === "RW Language")      vals[ "LT-ReadWrite-Rank" ] = val;
          if( values[ strS3 ] === "Durability 5")      vals[ "working-Durability_max" ] = val*5;
          // if( val != values[ strT ])
          vals[ strT ] = val;



          // if( vals.length > 0 )
          setAttrsLog( vals,null,function(){
          if( linkOutList.length > 2  && !sil )
            UpdateLinkValue( linkOutList );
          if(( code === "T" || code === "SK" || code === "NAC") && att.toLowerCase().includes( "getvalue" ))
            updateRepStep( att );   // too many unnecessary calls. Another way needs to be found to update after creating a link
        });
      });
    });
  } catch(err) {log("Earthdawn:repRanks() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repRanks
// on("change:repeating_talents:t_rank change:repeating_talents:t_rank-adjust change:repeating_talents:t_special change:repeating_talents:t_LinksGetValue change:repeating_talents:t_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_weapons:wpn_rank change:repeating_weapons:wpn_rank-adjust change:repeating_weapons:wpn_special change:repeating_weapons:wpn_LinksGetValue change:repeating_weapons:wpn_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_knacks:nac_rank change:repeating_knacks:nac_rank-adjust change:repeating_knacks:nac_special change:repeating_knacks:nac_LinksGetValue change:repeating_knacks:nac_LinksProvidevalue", fn(repRanks) );
// on("change:repeating_skills:sk_rank change:repeating_skills:sk_rank-adjust change:repeating_skills:sk_special change:repeating_skills:sk_LinksGetValue change:repeating_skills:sk_LinksProvidevalue", fn(repRanks) );
//JBF This is commented out code to deal with the fact that API SetWithWorkers doesn't trigger correctly on capitalized repeating_section. Could be deleted if roll20 gets its stuff together :)
on("change:repeating_skills change:repeating_weapons change:repeating_talents change:repeating_knacks", fn(repRanks) );



// Update the Karma-Limit_max according to the
var repTType = function fnrepTType( eventInfo) {
  'use strict';
  try{
    //log("repTType " + JSON.stringify(eventInfo));
    if ( !eventInfo || _.isString(eventInfo) || eventInfo.sourceType!=="player" || !eventInfo.previousValue) return;
    let att = getAttrib( eventInfo );
    let code = repeatSection( 3, att).toUpperCase();
    let pre = buildShortPre( eventInfo, code );
    let vals={},
    pr=eventInfo.previousValue,nw;

    getAttrs([pre+"Type",pre+"Karma-Limit_max",pre+"DP-Limit_max"], function garepTType(values) {
      nw=values[pre+"Type"];

      var processType = function(t){
        if(t.match(/TO\d\-/) || t.match(/D\d\-/) || t=="Free") return "D";
        else if(t.startsWith("QD-")) return "QD";
        else if (t.startsWith("PA-")) return "PA";
        else if (t=="Racial") return "R";
        else if (t.startsWith("V-")) return "V";
        else return "O";
      }

      let prt=processType(pr),
      nwt=processType(nw);

      switch(nwt){
        case "QD" :
          vals[pre+"Karma-Limit_max"]=0;
          vals[pre+"DP-Limit_max"]=1;
          break;
        case "R" :
        case "V" :
          vals[pre+"Karma-Limit_max"]=0;
          vals[pre+"DP-Limit_max"]=0;
          break;
        case "PA":
        case "D" : //For Discipline and PA, we only want to make a change if we switch back from any of the other cases. Not from another discipline to not overwrite
          if(prt=="QD" || prt=="R" ||prt=="V"){
            vals[pre+"Karma-Limit_max"]=1;
            vals[pre+"DP-Limit_max"]=0;
            break;
          }
        default : return;
      }

      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:repTType() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repTType
on("change:repeating_talents:t_type", fn(repTType) );




var ocSrRating = function fnocSrRating() {
  'use strict';
  try{
    updateDefenseNatural( "PD" );
    updateDefenseNatural( "MD" );
    updateDefenseNatural( "SD" );
    updateDefenseNatural( "PA" );
    updateDefenseNatural( "MA" );
    updateInitiative();
    updateKnockdown();
    getSectionIDs("repeating_talents", function gsIdocSrRating(tarray) {
      for( let i = 0; i < tarray.length; i++) repRanks(tarray[i],"T")
  });
  getSectionIDs("repeating_weapons", function gsIdocSrRating(tarray) {
    for( let i = 0; i < tarray.length; i++) repRanks(tarray[i],"WPN")
});
} catch(err) {log("Earthdawn:ocSrRating() error caught: " + err );}
}; // End ocSrRating
on("change:srrating", fn(ocSrRating) );



var repThreadRanks = function fnrepThreadRanks( eventInfo) {
  'use strict';
  try{
  //eventInfo can only be either an automatic eventInfo format generated by a sheetworker change(on trigger, or a string substitute in the format of a full name attribute type repeating_talents_-kgfjghfsdjgsdf-_T_Name. Beware that the name must not contain any underscore
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let code = repeatSection(3,att);
  let rowid = repeatSection(2,att);
  if(rowid && rowid.length<4) log("repThreadRanks incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
  let pre = buildPre(code,rowid);
  let strlo = pre + "LinksProvideValue_max";
  getAttrs([strlo], function gaRepThreadRank(values) {
    'use strict';
    logvalues( values);
    var linkOutList= values[strlo];
    if( linkOutList.length > 2 ) UpdateLinkValue( linkOutList );
  });
} catch(err) {log("Earthdawn:repThreadRanks() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repThreadRanks
on("change:repeating_threads:ti_rank", fn(repThreadRanks) );




var repStrain = function fnrepStrain( eventInfo) {
  'use strict';
  try{
    //log("repStrain");
  //eventInfo can only be either an automatic eventInfo format generated by a sheetworker change(on trigger, or a string substitute in the format of a full name attribute type repeating_talents_-kgfjghfsdjgsdf-_T_Name. Beware that the name must not contain any underscore
  let att =getAttrib(eventInfo);
  if (att==="") return;
  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let code = repeatSection(3,att);
  let rowid = repeatSection(2,att);
  if(rowid && rowid.length<4) log("repStrain incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
  let pre = buildPre(code,rowid);
  let strs = pre + "Strain",
  strsm = pre + "Strain_max",
  strsa = pre + "StrainAdvanced",
  strsam = pre + "StrainAdvanced_max";
  getAttrs([strs,strsm,strsa,strsam], function gaRepStrain(values) {
    'use strict';
    logvalues( values);
    let vals={};

    if(values[pre+"StrainAdvanced"] && values[pre+"StrainAdvanced"]){ //There is a strain formula
      if(values[pre+"StrainAdvanced"]=="Ask"){
        vals[pre+"Strain_max"]="?{How Many Strain?|" + getInt(values,pre+"Strain") +"}";
        vals[pre+"StrainAdvanced_max"]="Variable Strain (Default: "+ getInt(values,pre+"Strain") +")";
      }
      else{
        vals[pre+"Strain_max"]=getInt(values,pre+"Strain") + values[pre+"StrainAdvanced"];
        vals[pre+"StrainAdvanced_max"]=getInt(values,pre+"Strain") + values[pre+"StrainAdvanced"];
      }
    } else{ //No strain formula, just numerical
      vals[pre+"Strain_max"]=getInt(values,pre+"Strain");
      vals[pre+"StrainAdvanced_max"]="";
    }

    setAttrsLog(vals);

  });
} catch(err) {log("Earthdawn:repStrain() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repThreadRanks
on("change:repeating_talents:t_strain change:repeating_talents:t_strainadvanced change:repeating_knacks:nac_strain change:repeating_knacks:nac_strainadvanced change:repeating_skills:sk_strain change:repeating_skills:sk_strainadvanced change:repeating_spell:sp_strain change:repeating_spell:sp_strainadvanced", fn(repStrain) );



var repMatrixType = function fnrepMatrixType( eventInfo ) {
  'use strict';
  try{
     //log("Earthdawn repMatrixType " + JSON.stringify(eventInfo));
    //if (eventInfo["sourceType"] =="API") return;
  let pre=buildShortPre(eventInfo,"SPM");
  let strS1 = pre + "Type",
  strT1 = pre + "DR",
  strO1 = pre + "Origin",
  strL1 = pre + "LinksGetValue",
  strLM = pre + "LinksGetValue_max",
  strR1 = pre + "Rank";
  getAttrs([ strS1, strO1, strLM ], function gaRmTMatrixType(values) {
    'use strict';
    logvalues( values);
    let val = values[ strS1 ];
    let orig = values[ strO1 ]
    let linkInList= values[strLM];
    let linkInArray =[];
    if(linkInList && linkInList.length>2) linkInArray = linkInList.split(",");
    getAttrs(linkInArray , function gaRmTMatrixType2(values2) {
      if( val === undefined )
      val = -10;
      let vals = {};
      //sets the DR
      vals[ strT1 ] = Math.abs(val);
      // vals[ strT2 ] = ((val > 0) ? 1 : 0);
      //sets the link
      if(orig!=="Free-link" && orig!=="Item-link"){
        vals[ strL1 ] = "";
        vals[ strLM ] = ""; //only Free Matrix and Item Matrix are allowed for a link... Reset Links
      } else{
        let i, link=0;
        for( i = 0; i <linkInArray.length; i++ ) { link += getInt(values2, linkInArray [ i ]); };
        if(link>0) vals[ strR1 ] = link;
      };
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:repMatrixType() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repMatrixType
on("change:repeating_matrix:spm_type change:repeating_matrix:spm_origin change:repeating_matrix:spm_linksgetvalue_max", fn(repMatrixType) );
//on("change:repeating_matrix", fn(repMatrixType) );




// With a new discipline, we need a new durability
// eventInfo default is a rowId
// We can't use BuildShortPre like other functions, because short prefix do not work in getcompendiumpage

var repDiscipline = function fnrepDiscipline( eventInfo , source, data , cb) {
  'use strict';
  try{
    let att =getAttrib(eventInfo);
    if (att==="") return;
    //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
    let code = "DSP";
    let rowid = _.isString(eventInfo) ? eventInfo : repeatSection(2,att);
    let pre = buildPre(code,rowid);
    let strT= pre +"Durability",
    strTy= pre +"Type",
    strdata= pre +"Name_max",
    strvn=pre+"VariantName",
    nm = pre + "Name",
    circle = pre + "Circle",
    cmax = pre + "Circle_max",
    ddata={},
    database=[],
    vals={},
    trigger;// = (!_.isString( eventInfo ) && eventInfo.sourceType=="player"); // trigger will confirm if the function was actually triggered by an actual change of the discipline code i.e. by a compendium drop or player action
    let compsearch=true,found=false;

    getAttrs([ "edition", "edition_max","Durability-Rating-Adjust",circle,cmax,strT,strTy,nm,strdata], function gaRepDiscipline(values) {
      'use strict';
      logvalues( values);

      if(parseFloat( values[ "edition_max" ]) <3) {log("repDiscipline inhibited because older sheet version");return;}

      //log("repDiscipline with name " + nm  +" eventInfo " + JSON.stringify(eventInfo) + " data " + data );

      let dnm=values[nm];

      if(_.isString(eventInfo)){
        if(data && data!=="" && data!=={}) {trigger="compendium";}
        else trigger="recalc";
      } else {
        if(eventInfo.sourceType=="player" && eventInfo.previousValue!==eventInfo.newValue) trigger="player";
        else trigger="chain";
      }

//      getCompendiumPage("Disciplines:" + dnm.replace("\'","%E2%80%99"), compendium_pages => {
        getCompendiumQuery2(BuildCompendiumQuery(dnm.replace("\'","%E2%80%99"),"DSP"),null, compendium_pages => {

        if(trigger=="compendium") {
          ddata=data;
          found=true;
        } else {

          //log( "Earthdawn-repdiscipline : Compendium Search result for " + dnm + " \n" +  JSON.stringify(compendium_pages));
          if(compsearch && compendium_pages && compendium_pages[0] && compendium_pages[0].data && compendium_pages[0].data.Category){ //We have an array instead of a JSON, so multiple matches
            //log("Earthdawn-repdiscipline :Found multiple pages in the compendium, using the first one ??");
            ddata=compendium_pages[0].data;
            found=true;
            vals[ pre+"buttonInfo"]= compendium_pages[0].data.Category + ":" + dnm;

          } else  if(compsearch && compendium_pages && compendium_pages.data && compendium_pages.data.Category){ //We found a unique page
            //log("Earthdawn-repdiscipline :Found one page in the compendium " + compendium_pages.id);
            ddata=compendium_pages.data;
            found=true;
            vals[ pre+"buttonInfo"]= compendium_pages[0].data.Category + ":" + dnm;
          } else {
          //log("Earthdawn-repDiscipline :No match in Compendium. Using local database");
        }
        }
          //No compendium match, go to the local database
          if(!found) {
            vals[ pre+"buttonInfo"]= "";
            if(values["edition"]=="3" )database=[

              {"name": "Air Sailor","Type":"Discipline","Durability":"5"},
              {"name": "Archer","Type":"Discipline","Durability":"5"},
              {"name": "Beastmaster","Type":"Discipline","Durability":"7"},
              {"name": "Cavalryman","Type":"Discipline","Durability":"7"},
              {"name": "Elementalist","Type":"Discipline","issc":"1","Durability":"3"},
              {"name": "Illusionist","Type":"Discipline","issc":"1","Durability":"3"},
              {"name": "Nethermancer","Type":"Discipline","issc":"1","Durability":"3"},
              {"name": "Scout","Type":"Discipline","Durability":"5"},
              {"name": "Sky Raider","Type":"Discipline","Durability":"7"},
              {"name": "Swordmaster","Type":"Discipline","Durability":"7"},
              {"name": "Thief","Type":"Discipline","Durability":"5"},
              {"name": "Troubadour","Type":"Discipline","Durability":"5"},
              {"name": "Warrior","Type":"Discipline","Durability":"7"},
              {"name": "Weaponsmith","Type":"Discipline","Durability":"5"},
              {"name": "Wizard","Type":"Discipline","issc":"1","Durability":"3"},
            ];

            else database=[
              {"name": "Air Sailor","Type":"Discipline","Durability":"5","TO_Novice":"Acrobatic Defense, Distract, First Impression, Great Leap, Haggle, Maneuver, Navigation, Speak Language, Taunt, Throwing Weapons","Free_C1":"Air Sailing","DT_C1":"Avoid Blow, Climbing, Melee Weapons, Air Weaving, Wind Catcher","Karma_C1":"The adept may spend Karma once per round on any action taken while onboard an airship.","DT_C2":"Awareness","Buff_C2":"+1 to Physical Defense","DT_C3":"Empathic Sense","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Wound Balance","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Air Speaking, Battle Bellow, Conceal Object, Engaging Banter, Etiquette, Graceful Exit, Leadership, Resist Taunt, Second Weapon, Surprise Strike","DT_C5":"Heartening Laugh","Karma_C5":"The adept may spend 1 Karma Point on Interaction tests","DT_C6":"Air Dance","Buff_C6":"+2 to Physical Defense","DT_C7":"Inspire Others","Buff_C7":"+1 Recovery test","DT_C8":"Lion Heart","Buff_C8":"+3 to Physical Defense","TO_Warden":"Astral Sight, Blood Share, Cold Purify, Defensive Posture, Down Strike, Eagle Eye, Gliding Stride, Impressive Display, Relentless Recovery, Spot Armor Flaw","DT_C9":"Lasting Impression","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Thought Link","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Lion Spirit","Karma_C11":"The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Rally","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Champion Challenge, Critical Hit, Disarming Smile, Fluid Movement, Life Check, Second Chance, Soul Aegis, Undermine","DT_C13":"Second Attack","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Song of Battle","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Concentrated Assault","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},
              {"name": "Archer","Type":"Discipline","Durability":"5","TO_Novice":"Awareness, Climbing,Creature Analysis, First Impression, Impressive Display, Navigation, Stealthy Stride, Throwing Weapons, Tracking, Wilderness Survival","Free_C1":"Call Missile","DT_C1":"Avoid Blow, Missile Weapons, Mystic Aim, Arrow Weaving, True Shot","Karma_C1":"The adept may spend a Karma Point on Perception tests that rely on sight.","DT_C2":"Mystic Pursuit","Buff_C2":"+1 to Physical Defense","DT_C3":"Anticipate Blow","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Long Shot","Buff_C4":"+1 to Mystic Defense","TO_Journeyman":"Conversation, Danger Sense, Distract, Etiquette, Evidence Analysis, Resist Taunt, Speak Language, Steel Thought, Stopping Aim, Tiger Spring","DT_C5":"Spot Armor Flaw","Karma_C5":"The adept may spend 1 Karma Point on Damage tests made with ranged weapons.","DT_C6":"Bank Shot","Buff_C6":"+2 to Physical Defense","DT_C7":"Flame Arrow","Buff_C7":"+1 Step to Initiative","DT_C8":"Second Shot","Buff_C8":"+3 to Physical Defense","TO_Warden":"Astral Sight, Chameleon, Critical Hit, Defensive Posture, Ethereal Weapon, Lasting Impression, Lifesight, Matrix Sight, True Sight, Wood Skin","DT_C9":"Blind Fire","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Spirit Strike","Buff_C10":"+2 to Mystic Defense;+1 to Mystic Armor","DT_C11":"Eagle Eye","Karma_C11":"The adept may spend a Karma Point once per round on a Perception-based test against an opponent they have damaged since the beginning of the previous round.","Buff_C11":"+1 to Social Defense","DT_C12":"Missile Lock","Buff_C12":"+4 to Physical Defense;+2 Step to Initiative","TO_Master":"Lion Heart, Orbiting Spy, Relentless Recovery, Second Chance, Soul Aegis, Venom, Vital Strike, Vital Ward","DT_C13":"Influence Missile","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Mystic Defense;+1 Recovery test","DT_C14":"Snapshot","Buff_C14":"+5 to Physical Defense;+2 Step to Mystic Armor","DT_C15":"Multi-Shot ","Buff_C15":"+2 to Social Defense;+3 Step to Initiative"},
              {"name": "Beastmaster","Type":"Discipline","Durability":"7","TO_Novice":"Acrobatic Defense, Animal Bond, Animal Training, Borrow Sense, Climbing, Creature Analysis, Danger Sense, Enhance Animal Companion, Stealthy Stride, Tracking","DT_C1":"Avoid Blow, Claw Shape, Beast Weaving, Unarmed Combat, Wilderness Survival","DT_C2":"Awareness","Buff_C2":"+1 to Physical Defense","DT_C3":"Dominate Beast","Karma_C3":"The adept may spend a Karma Point on Recovery tests.","DT_C4":"Great Leap","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Animal Companion Durability, Animal Possession, Battle Bellow, Call Animal Companion, Cobra Strike, Iron Constitution, Lion Heart, Sprint, Swift Kick, Tiger Spring","DT_C5":"Blood Share","Karma_C5":"The adept may spend a point of Karma on any unarmed Damage test.","DT_C6":"Animal Talk","Buff_C6":"+2 to Physical Defense","DT_C7":"Down Strike","Buff_C7":"+1 Recovery test","DT_C8":"Claw Frenzy","Buff_C8":"+3 to Physical Defense","TO_Warden":"Armor Mount, Bloodhound Form, Burning Vigor, Chameleon, Defensive Posture, Eagle Eye, Goring Attack, Life Check, Resist Pain, Steely Stare","DT_C9":"Relentless Recovery","Karma_C9":"The adept may spend a Karma Point per round on any noncombat test made while in the wilderness.","DT_C10":"Critical Hit","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Unflinching Fortitude","Karma_C11":"The adept may spend a Karma Point on an Attack test made against a target they have previously damaged.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Momentum Attack","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Alley Cat Approach, Animal Leadership, Aura Armor, Echolocation, Lion Spirit, Second Chance, Vital Strike, Vital Ward","DT_C13":"Howl","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Vicious Wound","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Venom","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},
              {"name": "Cavalryman","Type":"Discipline","Durability":"7","TO_Novice":"Avoid Blow, Battle Shout, Blood Share, Conversation, Creature Analysis, Dominate Beast, First Impression, Heartening Laugh, Speak Language, Sure Mount","DT_C1":"Discipline Talents: Animal Bond, Charge, Melee Weapons, Rider Weaving, Trick Riding","DT_C2":"Animal Training","Buff_C2":"+1 to Physical Defense","DT_C3":"Enhance Animal Companion","Karma_C3":"The adept may spend a Karma Point on Attack tests made while charging.","DT_C4":"Call Animal Companion","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Animal Companion Durability, Empathic Sense, Etiquette, Fearsome Charge, Leadership, Lion Heart, Missile Weapons, Mount Attack, Spirit Mount, Tactics","DT_C5":"Armor Mount","Karma_C5":"The adept may spend a Karma Point on any Damage tests made while mounted.","DT_C6":"Wheeling Attack","Buff_C6":"+2 to Physical Defense","DT_C7":"Wheeling Attack","Buff_C7":"+1 Recovery test","DT_C8":"Double Charge","Buff_C8":"+3 to Physical Defense","TO_Warden":"Battle Bellow, Defensive Posture, Down Strike, Fireblood, Impressive Display, Iron Constitution, Lasting Impression, Life Check, Resist Taunt, Steel Thought","DT_C9":"Goring Attack","Karma_C9":"The adept may spend a Karma Point on a Recovery test.","DT_C10":"Relentless Recovery","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Momentum Attack","Karma_C11":"The adept may spend a Karma Point on Damage tests made by their mount.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Animal Talk","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Champion Challenge, Lion Spirit, Rally, Resist Pain, Second Chance, Thought Link, Unflinching Fortitude, Vicious Wound","DT_C13":"Critical Hit","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Thunderstruck","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Multi-Charge","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},
              {"name": "Elementalist","Type":"Discipline","issc":"1","Durability":"3","TO_Novice":"Air Speaking, Arcane Mutterings, Astral Sight, Avoid Blow, Climbing, Item History, Standard Matrix, Tracking, Wilderness Survival, Wind Catcher","Free_C1":"Standard Matrix, Standard Matrix","DT_C1":"Awareness, Patterncraft, Spellcasting, Elementalism, Wood Skin","DT_C2":"Fire Heal","Buff_C2":"+1 to Mystic Defense","DT_C3":"Elemental Tongues","Karma_C3":"The adept may spend a Karma Point on Recovery tests.","DT_C4":"Elemental Hold","Buff_C4":"+1 to Physical Defense","TO_Journeyman":"Banish, Cold Purify, Dispel Magic, Enhanced Matrix, Fireblood, Gliding Stride, Navigation, Safe Path, Steel Thought, Tenacious Weave","Free_C5":"One of the adepts free Standard Matrix talents is upgraded to an Enhanced Matrix.","DT_C5":"Summon (Elemental Spirits)","Karma_C5":"The adept may spend a Karma Point to target an additional ally with a spell he is casting.","DT_C6":"Willforce","Buff_C6":"+2 to Mystic Defense","DT_C7":"Earth Skin","Buff_C7":"+1 Recovery test","DT_C8":"Hold Thread","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Armored Matrix, Contest of Wills, Evidence Analysis, Iron Constitution, Perfect Focus, Plant Talk, Range Pattern, Summoning Circle, Suppress Curse, Temper Flesh","DT_C9":"Thunderous Resolve","Karma_C9":"The adept may spend a Karma Point when designing or crafting an item.","DT_C10":"Elemental Mastery","Buff_C10":"+2 to Physical Defense;+1 to Mystic Armor","DT_C11":"Vine Armor","Karma_C11":"The adept may spend a Karma Point to improve one bonus from a spell they cast on an ally by +2.","Buff_C11":"+1 to Social Defense","DT_C12":"Concise Casting","Buff_C12":"+4 to Mystic Defense;+2 Recovery test","TO_Master":"Burning Vigor, Casting Pattern, Effect Pattern, Life Check, Second Chance, Shared Matrix, Shock Treatment, Unflinching Fortitude","DT_C13":"Elemental Walk","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Physical Defense;+1 Step to Initiative","DT_C14":"Stone Skin","Buff_C14":"+5 to Mystic Defense;+2 to Mystic Armor","DT_C15":"Spliced Weave","Buff_C15":"+2 to Social Defense;+3 Recovery test"},
              {"name": "Illusionist","Type":"Discipline","issc":"1","Durability":"3","TO_Novice":"Arcane Mutterings, Astral Sight, Awareness, Dead Fall, Mimic Voice, Speak Language, Standard Matrix, Stealthy Stride, Taunt, Winning Smile","Free_C1":"Standard Matrix, Standard Matrix","DT_C1":"False Sight, First Impression, Patterncraft, Spellcasting, Illusionism","DT_C2":"True Sight","Buff_C2":"+1 to Mystic Defense","DT_C3":"Conversation","Karma_C3":"The adept may spend a Karma Point on Interaction tests.","DT_C4":"Disguise Self","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Conceal Object, Dispel Magic, Engaging Banter, Enhanced Matrix, Fast Hand, Frighten, Resist Taunt, Slough Blame, Steel Thought, Tenacious Weave","Free_C5":"One of the adepts free Standard Matrix talents is upgraded to an Enhanced Matrix.","DT_C5":"Power Mask","Karma_C5":"The adept may spend a Karma Point to add a +2 bonus to a spells Effect Step. The bonus lasts for the full spell duration, even if the spell has multiple Effect tests.","DT_C6":"Willforce","Buff_C6":"+2 to Mystic Defense","DT_C7":"Hypnotize","Buff_C7":"+1 Step to Initiative","DT_C8":"Hold Thread","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Armored Matrix, Astral Pocket, Empathic Sense, Etiquette, Graceful Exit, Lasting Impression, Range Pattern, Safe Thought, Thought Link, Undermine","DT_C9":"Disarming Smile","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Infuse Memory","Buff_C10":"+2 to Social Defense;+1 to Mystic Armor","DT_C11":"Truth Through Lies","Karma_C11":"The adept may spend a Karma Point to target an additional opponent with a spell they are casting. The duplicate spell is an illusion (whether or not the original was), allowing for disbelief or Sensing tests as appropriate.","Buff_C11":"+1 to Physical Defense","DT_C12":"Concise Casting","Buff_C12":"+4 Mystic Defense;+2 Step to Initiative","TO_Master":"Bardic Voice, Casting Pattern, Effect Pattern, Impossible Hide, Second Chance, Shared Matrix, Soul Aegis, Witty Repartee","DT_C13":"Enthralling Visions","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 Recovery test","DT_C14":"Memory Probe","Buff_C14":"+5 to Mystic Defense;+2 to Mystic Armor","DT_C15":"Spliced Weave","Buff_C15":"+2 to Physical Defense;+3 Step to Initiative"},
              {"name": "Nethermancer","Type":"Discipline","issc":"1","Durability":"3","TO_Novice":"Arcane Mutterings, Avoid Blow, Awareness, Command Nightflyer, Dispel Magic, Read and Write Language, Speak Language, Standard Matrix, Stealthy Stride, Suppress Curse","Free_C1":"Standard Matrix, Standard Matrix","DT_C1":"Astral Sight, Frighten, Patterncraft, Spellcasting, Nethermancy","DT_C2":"Steel Thought","Buff_C2":"+1 to Mystic Defense","DT_C3":"Spirit Talk","Karma_C3":"The adept may spend a Karma Point once per round on any test against a Horror, Horror Construct, or undead target.","DT_C4":"Spirit Hold","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Astral Interference, Banish, Blood Share, Enhanced Matrix, Lifesight, Lion Heart, Research, Spirit Mount, Steely Stare, Tenacious Weave","Free_C5":"One of the adepts free Standard Matrix talents is upgraded to an Enhanced Matrix.","DT_C5":"Summon (Ally Spirits)","Karma_C5":"Karma: The adept may spend a Karma Point to increase the targets penalty from a spell he is casting by 2.","DT_C6":"Willforce","Buff_C6":"+2 to Mystic Defense","DT_C7":"Orbiting Spy","Buff_C7":"+1 to Mystic Armor","DT_C8":"Hold Thread","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Armored Matrix, Astral Pocket, Contest of Wills, Evidence Analysis, Item History, Perfect Focus, Range Pattern, Safe Thought, Soul Aegis, Summoning Circle","DT_C9":"Matrix Sight","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Blood Insight","Buff_C10":"+2 to Social Defense;+1 Recovery test","DT_C11":"Netherwalk","Karma_C11":"The adept may spend a Karma Point on a Summon or Binding spell they are casting to improve a bonus or Effect Step from the spell by 2, or reduce a penalty from the spell by 2.","Buff_C11":"+1 to Physical Defense","DT_C12":"Concise Casting","Buff_C12":"+4 Mystic Defense;+2 to Mystic Armor","TO_Master":"Animal Possession, Casting Pattern, Confront Horror, Effect Pattern, Lion Spirit, Resist Pain, Second Chance, Shared Matrix","DT_C13":"Astral Domain","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 Step to Initiative","DT_C14":"Nethersoul","Buff_C14":"+5 to Mystic Defense;+2 Recovery test","DT_C15":"Spliced Weave","Buff_C15":"+2 to Physical Defense;+3 to Mystic Armor"},
              {"name": "Scout","Type":"Discipline","Durability":"5","TO_Novice":"Anticipate Blow, Avoid Blow, Creature Analysis, Disarm Trap, Great Leap, Lock Picking, Melee Weapons, Missile Weapons, Read and Write Language, Speak Language","Free_C1":"Navigation","DT_C1":"Awareness, Climbing, Scout Weaving, Tracking, Wilderness Survival","Karma_C1":"The adept may spend a Karma Point on tests made to find something","DT_C2":"Stealthy Stride","Buff_C2":"+1 to Physical Defense","DT_C3":"Mystic Pursuit","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Danger Sense","Buff_C4":"+1 to Mystic Defense","TO_Journeyman":"Animal Bond, Borrow Sense, Conceal Object, Disguise Self, Spirit Mount, Spot Armor Flaw, Sprint, Surprise Strike, Tiger Spring, True Sight","DT_C5":"Evidence Analysis","Karma_C5":"The adept may spend a Karma Point on Recovery tests.","DT_C6":"Astral Sight","Buff_C6":"+2 to Physical Defense","DT_C7":"Safe Path","Buff_C7":"+1 Step to Initiative","DT_C8":"Orbiting Spy","Buff_C8":"+3 to Physical Defense","TO_Warden":"Animal Possession, Animal Talk, Animal Training, Critical Hit, Etiquette, Iron Constitution, Life Check, Plant Talk, Relentless Recovery, Wood Skin","DT_C9":"Eagle Eye","Karma_C9":"The adept may spend a Karma Point on any test made to escape detection.","DT_C10":"Chameleon","Buff_C10":"+2 to Mystic Defense;+1 Recovery test","DT_C11":"Echolocation","Karma_C11":"The adept may spend a Karma Point on Attack tests made against opponents who have not yet attacked the adept in that encounter.","Buff_C11":"+1 to Social Defense","DT_C12":"Bloodhound Form","Buff_C12":"+4 to Physical Defense;+2 Step to Initiative","TO_Master":"Eidetic Memory, Matrix Sight, Netherwalk, Second Attack, Second Chance, Second Shot, Soul Aegis, Spirit Strike","DT_C13":"Alley Cat Approach","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Mystic Defense;+1 to Mystic Armor","DT_C14":"Elemental Walk","Buff_C14":"+5 to Physical Defense;+2 Recovery test","DT_C15":"World Pulse","Buff_C15":"+2 to Social Defense;+3 Step to Initiative"},
              {"name": "Sky Raider","Type":"Discipline","Durability":"7","TO_Novice":"Air Sailing, Air Speaking, Avoid Blow, Danger Sense, Navigation, Shield Bash, Throwing Weapons, Unarmed Combat, Wilderness Survival, Wind Catcher","DT_C1":"Battle Shout, Climbing, Fireblood, Melee Weapons, Sky Weaving","DT_C2":"Great Leap","Buff_C2":"+1 to Physical Defense","DT_C3":"Wound Balance","Karma_C3":"The adept may spend a Karma Point on Recovery tests.","DT_C4":"Fire Heal","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Distract, First Impression, Iron Constitution, Leadership, Lion Heart, Second Weapon, Sprint, Swift Kick, Tactics, Tiger Spring","DT_C5":"Battle Bellow","Karma_C5":"The adept may spend a Karma Point on Damage tests made with melee or throwing weapons at or above the characters one-handed Size limit.","DT_C6":"Steely Stare","Buff_C6":"+2 to Physical Defense","DT_C7":"Down Strike","Buff_C7":"+1 Recovery test","DT_C8":"Momentum Attack","Buff_C8":"+3 to Physical Defense","TO_Warden":"Air Dance, Impressive Display, Lasting Impression, Life Check, Lion Spirit, Relentless Recovery, Resist Pain, Resist Taunt, Storm Shield, Vital Ward","DT_C9":"Burning Vigor","Karma_C9":"The adept may spend a Karma Point on tests to intimidate or cause fear.","DT_C10":"Unflinching Fortitude","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Vital Strike","Karma_C11":"The adept may spend a Karma Point on Attack tests made against an opponent suffering from a fear or intimidation effect.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Second Attack","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Aura Armor, Champion Challenge, Critical Hit, Eagle Eye, Second Chance, Temper Flesh, Undermine, Weapon Breaker","DT_C13":"Thunderstruck","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Vicious Wound","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Blood of Death's Sea","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},
              {"name": "Swordmaster","Type":"Discipline","Durability":"7","TO_Novice":"Acrobatic Defense, Anticipate Blow, Danger Sense, Distract, Impressive Display, Speak Language, Tiger Spring, Unarmed Combat, Winning Smile, Wound Balance","DT_C1":"Avoid Blow, Maneuver, Melee Weapons, Taunt, Weapon Weaving","DT_C2":"First Impression","Buff_C2":"+1 to Social Defense","DT_C3":"Riposte","Karma_C3":"The adept may spend a Karma Point on Interaction tests.","DT_C4":"Heartening Laugh","Buff_C4":"+1 to Physical Defense","TO_Journeyman":"Cobra Strike, Engaging Banter, Etiquette, Gliding Stride, Graceful Exit, Lasting Impression, Lion Heart, Spot Armor Flaw, Sprint, Swift Kick","DT_C5":"Second Weapon","Karma_C5":"The adept may spend a Karma Point on Damage tests made with a melee weapon.","DT_C6":"Disarm","Buff_C6":"+2 to Social Defense","DT_C7":"Resist Taunt","Buff_C7":"+1 Step to Initiative","DT_C8":"Second Attack","Buff_C8":"+2 to Physical Defense","TO_Warden":"Champion Challenge, Empathic Sense, Ethereal Weapon, Life Check, Lion Spirit, Matrix Sight, Relentless Recovery, Spirit Strike, Undermine, Witty Repartee","DT_C9":"Critical Hit","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Defensive Posture","Buff_C10":"+3 to Social Defense;+1 Recovery test","DT_C11":"Momentum Attack","Karma_C11":"The adept may spend a Karma Point on an Attack test made against an opponent currently affected by Taunt.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Fluid Movement","Buff_C12":"+3 to Physical Defense;+2 Step to Initiative","TO_Master":"Aura Armor, Bardic Voice, Chilling Strike, Resist Pain, Second Chance, Soul Aegis, Unflinching Fortitude, Vital Ward","DT_C13":"Cutting Words","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+4 to Social Defense;+1 to Mystic Armor","DT_C14":"Vicious Wound","Buff_C14":"+4 to Physical Defense;+2 Recovery test","DT_C15":"Multi-Strike","Buff_C15":"+2 to Mystic Defense;+3 Step to Initiative"},
              {"name": "Thief","Type":"Discipline","Durability":"5","TO_Novice":"Avoid Blow, Climbing, First Impression, Great Leap, Melee Weapons, Missile Weapons, Sprint, Surprise Strike, Taunt, Throwing Weapons","Free_C1":"Danger Sense","DT_C1":"Awareness, Lock Picking, Picking Pockets, Stealthy Stride, Thief Weaving","Karma_C1":"The adept may spend a Karma Point on any Charisma- based test when the adept is attempting to deceive a target.","DT_C2":"Disarm Trap","Buff_C2":"+1 to Physical Defense","DT_C3":"Haggle","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Conceal Object","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Blade Juggle, Call Missile, Dead Fall, Disguise Self, Graceful Exit, Mimic Voice, Mystic Pursuit, Second Weapon, Spot Armor Flaw, True Sight","DT_C5":"Engaging Banter","Karma_C5":"The adept may spend a Karma Point on Attack tests against a Surprised or Blindsided opponent.","DT_C6":"Slough Blame","Buff_C6":"+2 to Physical Defense","DT_C7":"Fast Hand","Buff_C7":"+1 Step to Initiative","DT_C8":"False Sight","Buff_C8":"+3 to Physical Defense","TO_Warden":"Acrobatic Defense, Anticipate Blow, Astral Sight, Echolocation, Escape Plan, Orbiting Spy, Perfect Focus, Resist Taunt, Tiger Spring, Wind Catcher","DT_C9":"Power Mask","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Astral Pocket","Buff_C10":"+2 to Social Defense;+1 Recovery test","DT_C11":"Chameleon","Karma_C11":"The adept may spend a Karma Point on Damage tests made against targets suffering a penalty to their Physical Defense.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Beguiling Blade","Buff_C12":"+4 to Physical Defense;+2 Step to Initiative","TO_Master":"Alley Cat Approach, Critical Hit, Defensive Posture, Disarming Smile, Fluid Movement, Netherwalk, Second Chance, Spirit Strike","DT_C13":"Impossible Hide","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Snatch Talent","Buff_C14":"+5 to Physical Defense;+2 Recovery test","DT_C15":"Dream Thief","Buff_C15":"+2 to Mystic Defense;+3 Step to Initiative"},
              {"name": "Troubadour","Type":"Discipline","Durability":"5","TO_Novice":"Avoid Blow, Conversation, Haggle, Impressive Display, Melee Weapons, Read and Write Language, Speak Language, Taunt, Throwing Weapons, Winning Smile","Free_C1":"Entertainer","DT_C1":"Emotion Song, First Impression, Heartening Laugh, Item History, Story Weaving","Karma_C1":"The adept may spend a Karma Point on Interaction tests","DT_C2":"Etiquette","Buff_C2":"+1 to Social Defense","DT_C3":"Empathic Sense","Karma_C3":"The adept may spend a Karma Point on any test to gain or recall information, including Knowledge skill tests.","DT_C4":"Research","Buff_C4":"+1 to Mystic Defense","TO_Journeyman":"Air Speaking, Blade Juggle, Diplomacy, Disguise Self, Engaging Banter, Graceful Exit, Hypnotize, Leadership, Lion Heart, Mimic Voice","DT_C5":"Inspire Others","Karma_C5":"Once per round the adept may spend a Karma Point to add to another characters test by offering encouragement. The target must be able to hear and/or see the Troubadour.","DT_C6":"Lasting Impression","Buff_C6":"+2 to Social Defense","DT_C7":"Resist Taunt","Buff_C7":"+1 Step to Initiative","DT_C8":"Slough Blame","Buff_C8":"+3 to Social Defense","TO_Warden":"Acrobatic Defense, Anticipate Blow, Book Memory, Cold Purify, Disarming Smile, Eidetic Memory, Second Weapon, Steel Thought, Thought Link, True Sight","DT_C9":"Bardic Voice","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Rally","Buff_C10":"+2 to Mystic Defense;+1 to Mystic Armor","DT_C11":"Undermine","Karma_C11":"The adept may spend a Karma Point once per turn on any test made while adjacent to an ally.","Buff_C11":"+1 to Physical Defense","DT_C12":"Witty Repartee","Buff_C12":"+4 to Social Defense;+2 Step to Initiative","TO_Master":"Confront Horror, Critical Hit, Lion Spirit, Memory Probe, Perfect Focus, Safe Thought, Second Chance, Soul Aegis","DT_C13":"Cutting Words","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Mystic Defense;+1 Recovery test","DT_C14":"Song of Deflection","Buff_C14":"+5 to Social Defense;+2 to Mystic Armor","DT_C15":"Song of Battle","Buff_C15":"+2 Physical Defense;+3 Step to Initiative"},
              {"name": "Warrior","Type":"Discipline","Durability":"7","TO_Novice":"Acrobatic Defense, Anticipate Blow, Danger Sense, Distract, Fireblood, Maneuver, Missile Weapons, Shield Bash, Tactics, Unarmed Combat","DT_C1":"Avoid Blow, Melee Weapons, War Weaving, Tiger Spring, Wood Skin","DT_C2":"Wound Balance","Buff_C2":"+1 to Physical Defense","DT_C3":"Air Dance","Karma_C3":"The adept may spend a Karma Point on a Recovery test.","DT_C4":"Waterfall Slam","Buff_C4":"+1 to Mystic Defense","TO_Journeyman":"Disarm, Etiquette, Leadership, Life Check, Lion Heart, Momentum Attack, Second Weapon, Spot Armor Flaw, Steely Stare, Swift Kick","DT_C5":"Earth Skin","Karma_C5":"The adept may spend a Karma Point on any Damage test made in close combat.","DT_C6":"Temper Flesh","Buff_C6":"+2 to Physical Defense","DT_C7":"Crushing Blow","Buff_C7":"+1 Recovery test","DT_C8":"Second Attack","Buff_C8":"+3 to Physical Defense","TO_Warden":"Burning Vigor, Critical Hit, Defensive Posture, Iron Constitution, Lion Spirit, Rally, Resist Pain, Steel Thought, Storm Shield, Vital Strike","DT_C9":"Relentless Recovery","Karma_C9":"The adept may spend a Karma Point once per round on any test made when adjacent to an ally in combat.","DT_C10":"Unflinching Fortitude","Buff_C10":"+2 to Mystic Defense;+1 Step to Initiative","DT_C11":"Chilling Strike","Karma_C11":"The adept may spend a Karma Point on an Attack test made against an opponent that has attacked the adept since the start of the previous round.","Buff_C11":"+1 to Social Defense","DT_C12":"Vine Armor","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Champion Challenge, Ethereal Weapon, Fluid Movement, Second Chance, Soul Aegis, Spirit Strike, Vicious Wound, Vital Ward","DT_C13":"Aura Armor","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Mystic Defense;+1 to Mystic Armor","DT_C14":"Stone Skin","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Multi-Strike","Buff_C15":"+2 to Social Defense;+3 Recovery test"},
              {"name": "Weaponsmith","Type":"Discipline","Durability":"5","TO_Novice":"Avoid Blow, Awareness, Danger Sense, Disarm Trap, Fireblood, First Impression, Haggle, Read and Write Language, Shield Bash, Speak Language","Free_C1":"Craftsman","DT_C1":"Forge Weapon, Item History, Melee Weapons, Steel Thought, Thread Smithing","Karma_C1":"The adept can spend a Karma Point on any test to craft or repair an item.","DT_C2":"Conversation","Buff_C2":"+1 to Mystic Defense","DT_C3":"Suppress Curse","Karma_C3":"The adept may spend a Karma Point on Recovery tests.","DT_C4":"Wound Balance","Buff_C4":"+1 to Physical Defense","TO_Journeyman":"Battle Shout, Diplomacy, Earth Skin, Etiquette, Fire Heal, Heartening Laugh, Iron Constitution, Leadership, Missile Weapons, Resist Taunt","DT_C5":"Forge Armor","Karma_C5":"The adept can spend a Karma Point on Damage tests he makes with a weapon he crafted.","DT_C6":"Temper Flesh","Buff_C6":"+2 to Mystic Defense","DT_C7":"Spot Armor Flaw","Buff_C7":"+1 to Mystic Armor","DT_C8":"Lion Heart","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Astral Sight, Evidence Analysis, Lion Spirit, Matrix Sight, Momentum Attack, Relentless Recovery, Spirit Strike, Steely Stare, True Sight, Unflinching Fortitude","DT_C9":"Perfect Focus","Karma_C9":"The adept may spend a Karma Point once per round on any test being performed by an adjacent ally.","DT_C10":"Dispel Magic","Buff_C10":"+2 to Physical Defense;+1 Recovery test","DT_C11":"Living Weapon","Karma_C11":"The adept may spend a Karma Point on any test to resist the effects of a spell or Horror power.","Buff_C11":"+1 to Social Defense","DT_C12":"Forge Flesh","Buff_C12":"+4 to Mystic Defense;+2 to Mystic Armor","TO_Master":"Burning Vigor, Crushing Blow, Ethereal Weapon, Resist Pain, Second Chance, Vital Strike, Vital Ward, Weapon Breaker","DT_C13":"Aura Armor","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Physical Defense;+1 Step to Initiative","DT_C14":"Soul Aegis","Buff_C14":"+5 to Mystic Defense;+2 Recovery test","DT_C15":"Confront Horror","Buff_C15":"+2 to Social Defense;+3 Mystic Armor"},
              {"name": "Wizard","Type":"Discipline","issc":"1","Durability":"3","TO_Novice":"Arcane Mutterings, Awareness, Book Memory, Conversation, Creature Analysis, Etiquette, Item History, Read and Write Language, Speak Language, Standard Matrix","Free_C1":"Standard Matrix, Standard Matrix","DT_C1":"Dispel Magic, Patterncraft, Research, Spellcasting, Wizardry","DT_C2":"Astral Sight","Buff_C2":"+1 to Mystic Defense","DT_C3":"Tenacious Weave","Karma_C3":"The adept may spend a Karma Point on Recovery tests.","Buff_C3":"Karma: The adept may spend a Karma Point on any test to recall information (including Knowledge tests).","DT_C4":"Steel Thought","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Avoid Blow, Diplomacy, Enhanced Matrix, Evidence Analysis, Hypnotize, Lifesight, Mystic Pursuit, Power Mask, Resist Taunt, True Sight","Free_C5":"One of the adepts free Standard Matrix talents is upgraded to an Enhanced Matrix.","DT_C5":"Astral Interference","Karma_C5":"Karma: The adept may spend a Karma Point to change the range of a spell from Self to Touch.","DT_C6":"Willforce","Buff_C6":"+2 to Mystic Defense","DT_C7":"Hold Thread","Buff_C7":"+1 to Mystic Armor","DT_C8":"Suppress Curse","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Armored Matrix, Astral Pocket, Empathic Sense, First Impression, Graceful Exit, Matrix Sight, Perfect Focus, Range Pattern, Safe Thought, Thought Link","DT_C9":"Eidetic Memory","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Glyph of Unweaving","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Glyph of Shielding","Karma_C11":"The adept may spend a Karma Point to allow an additional extra thread on a spell they are casting. The normal requirements for extra threads still apply; it must be declared in advance and woven as normal. This ability does allow an extra thread when it would otherwise not apply.","Buff_C11":"+1 to Physical Defense","DT_C12":"Concise Casting","Buff_C12":"+4 to Mystic Defense;+2 to Mystic Armor","TO_Master":"Astral Domain, Casting Pattern, Effect Pattern, Memory Probe, Second Chance, Shared Matrix, Soul Aegis, Undermine","DT_C13":"Glyph of Attunement","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 Recovery test","DT_C14":"Glyph of Reversal","Buff_C14":"+5 to Mystic Defense;+2 Step to Initiative","DT_C15":"Spliced Weave","Buff_C15":"+2 to Physical Defense;+3 to Mystic Armor"},

              //Questor
              {"name": "Questor-Astendar","Type":"Questor","Buff_C3":"+1 to Social Defense","Buff_C6":"+2 to Social Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Mystic Defense","Buff_C10":"+3 to Social Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Mystic Defense;+2 to Mystic Armor"},
              {"name": "Questor-Chorrolis","Type":"Questor","Buff_C3":"+1 to Social Defense","Buff_C6":"+2 to Social Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Mystic Defense","Buff_C10":"+3 to Social Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Mystic Defense;+1 Step to Initiative"},
              {"name": "Questor-Dis","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+2 to Mystic Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Social Defense","Buff_C10":"+3 to Mystic Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Social Defense;+1 to Mystic Armor"},
              {"name": "Questor-Floranuus","Type":"Questor","Buff_C3":"+1 to Physical Defense","Buff_C6":"+2 to Physical Defense","Buff_C7":"+1 Step to Initiative","Buff_C8":"+1 to Social Defense","Buff_C10":"+3 to Physical Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Social Defense;+2 Step to Initiative"},
              {"name": "Questor-Garlen","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+2 to Mystic Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Social Defense","Buff_C10":"+3 to Mystic Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Social Defense;+2 to Mystic Armor"},
              {"name": "Questor-Jaspree","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+1 to Physical Defense","Buff_C7":"+1 Recovery test","Buff_C8":"+2 to Mystic Defense","Buff_C10":"+2 to Physical Defense","Buff_C11":"+1 Step to Initiative","Buff_C12":"+2 to Social Defense;+2 Recovery test"},
              {"name": "Questor-Lochost","Type":"Questor","Buff_C3":"+1 to Social Defense","Buff_C6":"+1 to Physical Defense","Buff_C7":"+1 Recovery test","Buff_C8":"+2 to Social Defense","Buff_C10":"+2 to Physical Defense","Buff_C11":"+1 Step to Initiative","Buff_C12":"+1 to Mystic Defense;+2 Recovery test"},
              {"name": "Questor-Mynbruje","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+2 to Mystic Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Social Defense","Buff_C10":"+3 to Mystic Defense","Buff_C11":"+2 to Mystic Armor","Buff_C12":"+2 to Social Defense;+3 to Mystic Armor"},
              {"name": "Questor-Raggok","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+1 to Physical Defense","Buff_C7":"+1 Recovery test","Buff_C8":"+2 to Mystic Defense","Buff_C10":"+2 to Physical Defense","Buff_C11":"+1 to Mystic Armor","Buff_C12":"+3 to Mystic Defense;+2 Recovery test"},
              {"name": "Questor-Thystonius","Type":"Questor","Buff_C3":"+1 to Physical Defense","Buff_C6":"+2 to Physical Defense","Buff_C7":"+1 Recovery test","Buff_C8":"+2 to Social Defense","Buff_C10":"+3 to Physical Defense","Buff_C11":"+1 Step to Initiative","Buff_C12":"+1 to Mystic Defense;+2 Recovery test"},
              {"name": "Questor-Upandal","Type":"Questor","Buff_C3":"+1 to Mystic Defense","Buff_C6":"+2 to Mystic Defense","Buff_C7":"+1 to Mystic Armor","Buff_C8":"+1 to Social Defense","Buff_C10":"+3 to Mystic Defense","Buff_C11":"+1 Recovery test","Buff_C12":"+2 to Social Defense;+2 to Mystic Armor"},
              {"name": "Questor-Vestrial","Type":"Questor","Buff_C3":"+1 to Social Defense","Buff_C6":"+2 to Social Defense","Buff_C7":"+1 Step to Initiative","Buff_C8":"+1 to Physical Defense","Buff_C10":"+3 to Social Defense","Buff_C11":"+1 to Mystic Armor","Buff_C12":"+1 to Mystic Defense;+2 Step to Initiative"},

              //Mystic Path
              {"name": "Brother of Stone","Type":"Path-Master","Buff_C2":"+1 to Mystic Defense","Buff_C4":"+1 to Physical Defense","Buff_C7":"+2 to Mystic Defense","Buff_C8":"+1 Recovery test","Buff_C9":"+2 to Physical Defense","Buff_C10":"+2 Recovery test"},
              {"name": "Fire Eater","Type":"Path-Journeyman","Buff_C2":"+1 to Social Defense","Buff_C4":"+1 to Physical Defense"},
              {"name": "Horror Stalker","Type":"Path-Master","Buff_C2":"+1 to Mystic Defense","Buff_C4":"+1 to Physical Defense","Buff_C6":"+2 to Mystic Defense","Buff_C8":"+1 to Mystic Armor","Buff_C9":"+2 to Physical Defense","Buff_C10":"+1 Recovery test"},
              {"name": "Journeyman","Type":"Path-Master"},
              {"name": "Liberator","Type":"Path-Master","Buff_C2":"+1 to Physical Defense","Buff_C4":"+1 to Social Defense","Buff_C6":"+2 to Physical Defense","Buff_C8":"+1 Recovery test","Buff_C9":"+2 to Social Defense","Buff_C10":"+2 Recovery test"},
              {"name": "Messenger","Type":"Path-Master","Buff_C2":"+1 to Social Defense","Buff_C4":"+1 to Mystic Defense","Buff_C6":"+1 to Physical Defense","Buff_C8":"+1 Recovery test","Buff_C9":"+2 to Social Defense","Buff_C10":"+2 Step to Initiative"},
              {"name": "Outcast","Type":"Path-Journeyman","Buff_C2":"+1 to Social Defense","Buff_C4":"+2 to Social Defense"},
              {"name": "Purifier","Type":"Path-Journeyman","Buff_C2":"+1 to Mystic Defense","Buff_C4":"+2 to Mystic Defense"},
              {"name": "Scholar","Type":"Path-Journeyman","Buff_C2":"+1 to Social Defense","Buff_C4":"+1 to Mystic Defense"},
              {"name": "Tail Dancer","Type":"Path-Master","Buff_C2":"+1 to Physical Defense","Buff_C4":"+1 to Social Defense","Buff_C6":"+2 to Physical Defense","Buff_C8":"+1 Step to Initiative","Buff_C9":"+2 to Social Defense","Buff_C10":"+2 Step to Initiative"},
              {"name": "Windmaster","Type":"Path-Master","Buff_C2":"+1 to Physical Defense","Buff_C4":"+1 to Mystic Defense","Buff_C6":"+2 to Physical Defense","Buff_C8":"+1 Recovery test","Buff_C9":"+3 to Physical Defense","Buff_C10":"+1 Step to Initiative"},
              {"name": "Woodsmen","Type":"Path-Master","Buff_C2":"+1 to Physical Defense","Buff_C4":"+1 to Mystic Defense","Buff_C6":"+2 to Physical Defense","Buff_C8":"+1 Step to Initiative","Buff_C9":"+2 to Mystic Defense","Buff_C10":"+1 Recovery test"},

              {"name": "Boatman","VariantName": "Air Sailor" , "Type":"Discipline","Durability":"5","TO_Novice":"Acrobatic Defense, Unarmed Combat, First Impression, Great Leap, Haggle, Maneuver, Read River, Speak Language, Taunt, Throwing Weapons","Free_C1":"Pilot Boat","DT_C1":"Avoid Blow, Climbing, Melee Weapons, River Weaving, Swimming","Karma_C1":"The adept may spend a Karma Point once per round on any action while on board a riverboat.","DT_C2":"Awareness","Buff_C2":"+1 to Physical Defense","DT_C3":"Empathic Sense","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Wound Balance","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Swift Kick, Battle Bellow, Conceal Object, Engaging Banter, Etiquette, Graceful Exit, Leadership, Resist Taunt, Second Weapon, Surprise Strike","DT_C5":"Heartening Laugh","Karma_C5":"The adept may spend 1 Karma Point on Interaction tests","DT_C6":"Disarm","Buff_C6":"+2 to Physical Defense","DT_C7":"Inspire Others","Buff_C7":"+1 Recovery test","DT_C8":"Lion Heart","Buff_C8":"+3 to Physical Defense","TO_Warden":"Astral Sight, Blood Share, Cold Purify, Defensive Posture, Down Strike, Eagle Eye, Gliding Stride, Impressive Display, Relentless Recovery, Spot Armor Flaw","DT_C9":"Lasting Impression","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Thought Link","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Lion Spirit","Karma_C11":"The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Rally","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Champion Challenge, Critical Hit, Disarming Smile, Fluid Movement, Life Check, Second Chance, Soul Aegis, Undermine","DT_C13":"Second Attack","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Song of Battle","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Concentrated Assault","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},

              {"name": "Sailor","VariantName": "Air Sailor","Type":"Discipline","Durability":"5","TO_Novice":"Acrobatic Defense, Distract, First Impression, Great Leap, Haggle, Maneuver, Navigation, Speak Language, Taunt, Throwing Weapons","Free_C1":"Sailing","DT_C1":"Avoid Blow, Climbing, Melee Weapons, Dea Weaving, Swimming","Karma_C1":"The adept may spend Karma once per round on any action taken while onboard an airship.","DT_C2":"Awareness","Buff_C2":"+1 to Physical Defense","DT_C3":"Empathic Sense","Karma_C3":"The adept may spend a Karma Point on Initiative tests.","DT_C4":"Wound Balance","Buff_C4":"+1 to Social Defense","TO_Journeyman":"Air Speaking, Battle Bellow, Conceal Object, Engaging Banter, Etiquette, Graceful Exit, Leadership, Resist Taunt, Second Weapon, Surprise Strike","DT_C5":"Heartening Laugh","Karma_C5":"The adept may spend 1 Karma Point on Interaction tests","DT_C6":"Air Dance","Buff_C6":"+2 to Physical Defense","DT_C7":"Inspire Others","Buff_C7":"+1 Recovery test","DT_C8":"Lion Heart","Buff_C8":"+3 to Physical Defense","TO_Warden":"Astral Sight, Blood Share, Cold Purify, Defensive Posture, Down Strike, Eagle Eye, Gliding Stride, Impressive Display, Relentless Recovery, Spot Armor Flaw","DT_C9":"Lasting Impression","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Thought Link","Buff_C10":"+2 to Social Defense;+1 Step to Initiative","DT_C11":"Lion Spirit","Karma_C11":"The adept may spend a Karma Point once per round on an Action test made when adjacent to an ally.","Buff_C11":"+1 to Mystic Defense","DT_C12":"Rally","Buff_C12":"+4 to Physical Defense;+2 Recovery test","TO_Master":"Champion Challenge, Critical Hit, Disarming Smile, Fluid Movement, Life Check, Second Chance, Soul Aegis, Undermine","DT_C13":"Second Attack","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Social Defense;+1 to Mystic Armor","DT_C14":"Song of Battle","Buff_C14":"+5 to Physical Defense;+2 Step to Initiative","DT_C15":"Concentrated Assault","Buff_C15":"+2 to Mystic Defense;+3 Recovery test"},

              {"name": "Gauntlet","Type":"Discipline","Durability":"7","TO_Novice":"Awareness, Battle Shout, Danger Sense, Etiquette,Fireblood, Item History, Maneuver, Mystic Pursuit, Wilderness Survival, Wood Skin","DT_C1":"Avoid Blow, Body Control, Gauntlet Weaving, Unarmed Combat, Wound Balance","DT_C2":"Deliberate Assault","Buff_C2":"+1 to Physical Defense","DT_C3":"Steel Thought","Karma_C3":"The adept may spend a Karma Point on a Recovery test.","DT_C4":"Studied Counter","Buff_C4":"+1 to Mystic Defense","TO_Journeyman":"Astral Sight, Cold Purify,Evidence Analysis, Fire Heal,Iron Constitution, Lion Heart,Resist Taunt, Spot Armor Flaw,Steely Stare, Waterfall Slam","DT_C5":"Earth Skin","Karma_C5":"The adept may spend a Karma Point on any unarmed Damage test.","DT_C6":"Temper Flesh","Buff_C6":"+2 to Physical Defense","DT_C7":"Crushing Blow","Buff_C7":"+1 Recovery test","DT_C8":"Focused Strike","Buff_C8":"+2 to Mystic Defense","TO_Warden":"Blood Share, Burning Vigor, Defensive Posture, Life Check, Lion Spirit, Matrix Sight, Relentless Recovery, Resist Pain, Vine Armor, Vital Strike","DT_C9":"Critical Hit","Karma_C9":"The adept may spend a Karma Point on any active defense test (e.g.,Avoid Blow, Resist Taunt, Steel Thought, etc.)","DT_C10":"Unflinching Fortitude","Buff_C10":"+3 to Physical Defense;+1 to Mystic Armor","DT_C11":"Spirit Strike","Karma_C11":"The adept may spend a Karma Point on any unarmed Attack test once per round.","Buff_C11":"+1 to Social Defense","DT_C12":"Patient Resilience","Buff_C12":"+3 to Mystic Defense;+2 Recovery test","TO_Master":"Aura Armor, Champion Challenge, Chilling Strike, Elemental Walk, Ethereal Weapon, Second Chance, Soul Aegis, Vital Ward","DT_C13":"Stone Skin","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+4 to Physical Defense;+1 Step to Initiative","DT_C14":"Vicious Wound","Buff_C14":"+4 to Mystic Defense;+2 to Mystic Armor","DT_C15":"Shatter Will","Buff_C15":"+2 to Social Defense;+3 Recovery test"},

              {"name": "Shaman","Type":"Discipline","issc":"1","Durability":"3","TO_Novice":"Animal Bond, Animal Training, Avoid Blow, Climbing, Creature Analysis, Enhance Animal Companion, Navigation, Standard Matrix,Stealthy Stride, Tracking","Free_C1":"Standard Matrix, Standard Matrix","DT_C1":"Awareness, Patterncraft, Spellcasting, Shamanism, Wilderness Survival","DT_C2":"Astral Sight","Buff_C2":"+1 to Mystic Defense","DT_C3":"Spirit Talk","Karma_C3":"The adept may spend a Karma Point on a test to Summon or interact with a spirit.","DT_C4":"Danger Sense","Buff_C4":"+1 to Physical Defense","TO_Journeyman":"Animal Companion Durability, Animal Talk, Anticipate Blow, Borrow Sense, Call Animal Companion, Enhanced Matrix, Safe Path, Spirit Mount, Steel Thought, Tenacious Weave","Free_C5":"One of the adepts free Standard Matrix talents is upgraded to an Enhanced Matrix.","DT_C5":"Summon (Beast Spirits)","Karma_C5":"The adept may spend a Karma Point to gain the benefit of an extra thread woven for Increased Effect on a spell with the Binding or Spirit keyword. This does not require weaving an extra thread or count against the adepts limits for extra threads.","DT_C6":"Willforce","Buff_C6":"+2 to Mystic Defense","DT_C7":"Lifesight","Buff_C7":"+1 Step to Initiative","DT_C8":"Lion Heart","Buff_C8":"+3 to Mystic Defense","TO_Warden":"Armor Mount, Armored Matrix, Banish, Blood Share, Bloodhound Form, Dispel Magic, Eagle Eye, Hold Thread, Orbiting Spy, Tiger Spring","DT_C9":"Summoning Circle","Karma_C9":"The adept may spend a Karma Point on Recovery tests.","DT_C10":"Spirit Covenant","Buff_C10":"+2 to Physical Defense;+1 to Mystic Armor","DT_C11":"Lion Spirit","Karma_C11":"The adept may spend a Karma Point to gain the benefit of an extra thread woven for Increased Range on a spell with the Pack or Spirit keyword. This does not require weaving an extra thread or count against the adepts limits for extra threads.","Buff_C11":"+1 to Social Defense","DT_C12":"Concise Casting","Buff_C12":"+4 to Mystic Defense;+2 Step to Initiative","TO_Master":"Animal Leadership, Chameleon, Echolocation, Effect Pattern, Netherwalk, Resist Pain, Shared Matrix, Unflinching Fortitude","DT_C13":"Ancient Bonds","Karma_C13":"The adept increases their Karma +1 Step to a d8.","Buff_C13":"+3 to Physical Defense;+1 Recovery test","DT_C14":"Soul Aegis","Buff_C14":"+5 to Mystic Defense;+2 to Mystic Armor","DT_C15":"Spliced Weave","Buff_C15":"+2 to Social Defense;+3 Step to Initiative"},
            ];

            let i=database.findIndex( key => key.name === dnm);

            if(i!==-1) {
              ddata=database[i]; //Found in the database, use it
              found=true;
            }
            else vals[strdata]="HomeBrew";
            //parseJSON(values[strdata],
            //  {"name": "Homebrew discipline Name","Type":"Discipline","Durability":"0","TO_Novice":"Talent1,Talent2,Talent3","Free_C1":"FreeTalent","DT_C1":"Talent1,Talent2,Talent3","DT_C2":"Talent","Buff_C2":"+1 to Mystic Defense","DT_C3":"Talent","Karma_C3":"Fill in Talent Description."}); //Use the existing JSON that can have been modified by the user, or a default
          }
        //After this point we should have a valid ddata.
        if(found){
          if(!ddata.name) ddata.name=dnm; //No Name with comp drops
          vals[strvn]=ddata.VariantName||"";
          //If Spellcaster make appropriate updates
          if(ddata.issc){
            vals[ "SP-" + ddata.name ] = 1;
            vals["Hide-Spells-Tab"]=0;
          }
          vals[strTy]=ddata.Type||"Discipline";
          //Set Durability
          if( ddata.Type !== "Questor" )  vals[ strT ] = ddata.Durability||"0"; // Never update for Discipline Other/Misc or Questors. They have user set Durability.
          //Record the data
          vals[strdata]=JSON.stringify(ddata);
        } //end valid ddata... The rest is common


        vals[ pre+"show-createbutton" ] = ( (ddata["DT_C1"] || ddata["TO_Novice"] || ddata["TO_Journeyman"]) && (!values[cmax] || getInt(values,circle)>getInt(values,cmax)))  ? 1 :0; //trigger is important to not put back the button on a recalc.

        setAttrsLog( vals,null,function(){
          countDiscipline(null,function(){
            if(cb) cb();
          });
        });
      });
   });
  } catch(err) {log("Earthdawn:repDiscipline() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repDiscipline
on("change:repeating_discipline:dsp_name change:repeating_discipline:dsp_circle", fn(repDiscipline) );



// Count Disciplines
 var countDiscipline = function fncountDiscipline(eventInfo,cb) {
   'use strict';
  try{
  let getV=["edition","Defense-Phys-Nat-Auto-Adjust","Defense-Phys-Nat-Adjust","Defense-Myst-Nat-Adjust","Defense-Soc-Nat-Adjust","Armor-Phys-Nat-Adjust","Armor-Myst-Nat-Adjust","Initiative-Auto-Adjust","Recovery-Tests-Misc-Adjust","Custom-Karma-Ability"];
  let pre,pre2,i,j,k,l;
  let pd=[0,0,0],md=[0,0,0],sd=[0,0,0],pa=[0,0,0],ma=[0,0,0],rec=[0,0,0],ini=[0,0,0]; //[0] is the global, [1] is current discipline, [2] is Path
  let array2=[],ddata,ddata2;
  let s="",
  primdisc;//Primary Discipline
  getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(tarray) {
    for( i = 0; i < tarray.length; i++){
      pre = buildPre( "DSP", tarray[ i ]);
      getV = _.union( getV, [ pre + "Name",pre + "Type", pre+"Circle",pre+"Name_max", pre+"BaseDisc" ]);
    }
    getAttrs( getV , function gacountDiscipline(values) {
      'use strict';
      let disc=0,path=0,quest=0,el=0,il=0,ne=0,wi=0,sh=0;
      let ed=getEdition(values)==4,
          vals ={};
          for( i = 0; i < tarray.length; i++ ){
            pre = buildPre( "DSP", tarray[ i ]);
            array2=[];
            ddata=parseJSON(values[pre+"Name_max"]);
            // log("countDiscipline for " + values[pre+"Name_max"]);
            if(ddata.Type=="Discipline") disc++;
            if(ddata.Type=="Discipline" && disc==1) primdisc=values[pre+"Name"]; //Store the Primary Discipline to be used with a Path
            if(ddata.Type=="Questor") quest++;
            if(ddata.Type && ddata.Type.startsWith("Path")) path++;
            //process array
            for(j=0;j<=getInt(values,pre+"Circle");j++){
              if(ddata["Buff_C"+j]) {
                array2=ddata["Buff_C"+j].split(";");
                for( k=0 ;k<array2.length ; k++ ) {
                  if(array2[k].includes("Physical Defense")) pd[1]=Math.max(pd[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Mystic Defense")) md[1]=Math.max(md[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Social Defense")) sd[1]=Math.max(sd[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Physical Armor")) pa[1]=Math.max(pa[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Mystic Armor")) ma[1]=Math.max(ma[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Initiative")) ini[1]=Math.max(ini[1],parseInt2(array2[k].trim().charAt(1)));
                  else if(array2[k].includes("Recovery")) rec[1]=Math.max(rec[1],parseInt2(array2[k].trim().charAt(1)));
                };
              }
              if(ddata["Karma_C"+j] && !s.includes(ddata["Karma_C"+j])) s+=ddata["Karma_C"+j] + "\n";

            }
            //reprocess all DSP to detect attached paths
            for( l = 0; l < tarray.length; l++ ){
              pre2 = buildPre( "DSP", tarray[ l ]);
              array2=[];


              if(( values[pre2 + "Type"] &&  values[pre2 + "Type"].includes("Path") ) && (values[pre2 + "BaseDisc"]==values[pre + "Name"] || (!values[pre2 + "BaseDisc"] && primdisc==values[pre+"Name"]))) {//If non initialized Path, take the primary Disciplines
                if(!values[pre2 + "BaseDisc"]) vals[pre2 + "BaseDisc"]=primdisc; //Initialize BaseDisc to Primary Discipline
              //  log("processing Path " + values[pre2 + "Name"] + " with data " + values[pre2 + "Name_max"]);
                ddata2=parseJSON(values[pre2 + "Name_max"]);
                //process array
                for(j=0;j<=getInt(values,pre2+"Circle");j++){
                  if(ddata2["Buff_C"+j]) {
                    array2=ddata2["Buff_C"+j].split(";");
                    for( k=0 ;k<array2.length ; k++ ) {
                      log("processing Buff for Path " + array2[k]);
                      // if(array2[k].startsWith("Karma:") && !s.includes(array2[k])) s+=(array2[k].substring(array2[k].search("Karma:")+6) + "\n");
                      if(array2[k].includes("Physical Defense")) pd[2]=Math.max(pd[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Mystic Defense")) md[2]=Math.max(md[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Social Defense")) sd[2]=Math.max(sd[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Physical Armor")) pa[2]=Math.max(pa[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Mystic Armor")) ma[2]=Math.max(ma[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Initiative")) ini[2]=Math.max(ini[2],parseInt2(array2[k].trim().charAt(1)));
                      else if(array2[k].includes("Recovery")) rec[2]=Math.max(rec[2],parseInt2(array2[k].trim().charAt(1)));
                    };
                  }
                }
            //    log("processing Path " + values[pre2 + "Name"] + " with pd " +pd[2] );

              }
            }
            //Copy discipline & path result in the global var
            pd[0]=Math.max(pd[1]+pd[2],pd[0]);
            md[0]=Math.max(md[1]+md[2],md[0]);
            sd[0]=Math.max(sd[1]+sd[2],sd[0]);
            pa[0]=Math.max(pa[1]+pa[2],pa[0]);
            ma[0]=Math.max(ma[1]+ma[2],ma[0]);
            ini[0]=Math.max(ini[1]+ini[2],ini[0]);
            rec[0]=Math.max(rec[1]+rec[2],rec[0]);
            //reset discipline & path
            pd[1]=0;
            md[1]=0;
            sd[1]=0;
            pa[1]=0;
            ma[1]=0;
            ini[1]=0;
            rec[1]=0;
            pd[2]=0;
            md[2]=0;
            sd[2]=0;
            pa[2]=0;
            ma[2]=0;
            ini[2]=0;
            rec[2]=0;
            if( ddata.Type=="Discipline" && getInt(values,pre+"Circle")>=13)
            vals["KarmaStep"]="5";

            if(ddata.issc)
            vals["SP-"+ddata.name]=1;

          };

      vals["IsQuestor"]=quest;
      vals["IsPath"]=path;
      vals["NbDisc"]=disc;


      vals["Defense-Phys-Nat-Auto-Adjust"]=pd[0];
      vals["Defense-Myst-Nat-Auto-Adjust"]=md[0];
      vals["Defense-Soc-Nat-Auto-Adjust"]=sd[0];
      vals["Armor-Phys-Nat-Auto-Adjust"]=pa[0];
      vals["Armor-Myst-Nat-Auto-Adjust"]=ma[0];
      vals["Initiative-Auto-Adjust"]=ini[0];
      vals["Recovery-Tests-Auto-Adjust"]=rec[0];
      vals["Karma-Ability"]=s + (values["Custom-Karma-Ability"]||"");
      if(getInt(values,"Defense-Phys-Nat-Auto-Adjust")==-1){ //JBF@CD : Dirty trick : this means this that this just came out of the importer to v2. Offset the adjustments to avoid double accounting
        vals["Defense-Phys-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Phys-Nat-Auto-Adjust")-pd[0]);
        vals["Defense-Myst-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Myst-Nat-Adjust")-md[0]);
        vals["Defense-Soc-Nat-Adjust"]=Math.max(0,getInt(values,"Defense-Soc-Nat-Adjust")-sd[0]);
        vals["Armor-Phys-Nat-Adjust"]=Math.max(0,getInt(values,"Armor-Phys-Nat-Adjust")-pa[0]);
        vals["Armor-Myst-Nat-Adjust"]=Math.max(0,getInt(values,"Armor-Myst-Nat-Adjust")-ma[0]);
        vals["Initiative-Adjust"]=Math.max(0,getInt(values,"Initiative-Adjust")-ini[0]);
        vals["Recovery-Tests-Misc-Adjust"]=Math.max(0,getInt(values,"Recovery-Tests-Misc-Adjust")-rec[0]);
      }
      setAttrsLog( vals,null,function(){
        if(cb) cb();
      });
    });
  });
} catch(err) {log("Earthdawn:countDiscipline() error caught: " + err );}
}; // End countDiscipline
on("change:repeating_discipline remove:repeating_discipline change:custom-karma-ability", fn(countDiscipline) );



// New spell name, See if brand new record that needs a circle and type.
var repSpellName = function fnrepSpellName( eventInfo ) {
  'use strict';
  try{
  let pre=buildShortPre(eventInfo,"SP");
  var rowID = _.isString( eventInfo ) ? eventInfo : eventInfo["sourceAttribute"].slice(16, eventInfo["sourceAttribute"].lastIndexOf("_") -3);
  var strS1 = pre+"Circle";
  var strS2 = pre+"Discipline";
  getAttrs([ strS1, "tab-grim", strS2, "SP-Elementalist", "SP-Illusionist", "SP-Nethermancer", "SP-Shaman", "SP-Wizard", "SP-Power", "edition", "API" ], function gaRsSpellName(values) {
    'use strict';
    logvalues( values);
    var circle = getInt( values, strS1);
    let vals = {};
    if( getInt( values, "API" ) == 0 )    // If the API is not already doing this correctly, then do what you can (store the lowercased variable)
    vals[ pre+"RowID"] = rowID;
    // if( getInt( values, "edition") == 0 ) {     // Due to a bug in Welcome Package, sometimes the api does not run "on add character" and edition ends up being blank. If it is blank, just assign it to 4th edition and hope it is correct. Note that this is also the case if the API is not installed.
    //   values[ "edition" ] = "4";
    //   //   vals[ "edition" ] = "4";
    // }
    var t = getInt( values, "tab-grim");
    if(( circle  == 0) && (t != 0) && (t != 11)) {
      circle = t;
      vals[ strS1 ] = circle;
    }
    if( !(getInt( values, strS2) > 0)) {    // If this record still has SP_Discipline of "-".
      let d1 = getInt( values, "SP-Elementalist"),
      d2 = getInt( values, "SP-Illusionist"),
      d3 = getInt( values, "SP-Nethermancer"),
      d4 = getInt( values, "SP-Wizard"),
      d5 = getInt( values, "SP-Shaman"),
      d6 = getInt( values, "SP-Power");
      if( (d1 + d2 + d3 + d4 + d5 + d6) == 1) {     // If the character only has Talent in one magical art, use that one.
        if( d1 == 1)
        vals[ strS2 ] = "Elementalism";
        else if( d2 == 1)
        vals[ strS2 ] = "Illusionism";
        else if( d3 == 1)
        vals[ strS2 ] = "Nethermancy";
        else if( d4 == 1)
        vals[ strS2 ] = "Wizardry";
        else if( d5 == 1)
        vals[ strS2 ] = "Shamanism";
        else if( d6 == 1)
        vals[ strS2 ] = "Spell Weaving";
      } else if ((d1 + d2 + d3 + d4 + d5) == 0 )
      vals[ strS2 ] = "Other Weaving";
    }
    if ( circle != 0 )
    if ( getEdition( values ) == 4 )
    vals[ pre+"Numbers"] = circle + 4 + " / " + (circle + 9) + " / " + (circle + 10) + " / " + (circle + 15);
    else if ( getEdition( values ) == 3 )     // Note: Dispelling, Disbelief, and Sensing Difficulty numbers are real 3rd edition numbers.
    // Weaving and Attuning number are just made up as there was no formula I could find, so I just
    // slapped some numbers in. When in 3rd edition the field is editable, so user can change to the real numbers.
    vals[ pre+"Numbers" ] = ( circle + 4 ) + " / " + (circle + 9)
    + " / " + [ "9", "9", "11", "13", "15", "16", "17", "18", "20", "21", "23", "24", "25", "26", "28", "29"][circle]     // Dispel Difficulty
    + " / " + (circle + 5)      // Disbelief Difficulty
    + " / " + [ "13", "13", "15", "16", "18", "20", "21", "23", "25", "26", "27", "28", "30", "31", "33", "34"][circle];    //  Sensing Difficulty.
    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:repSpellName() error caught: " + err + " eventInfo: " + JSON.stringify(eventInfo));}
}; // End repSpellName
on("change:repeating_spell:sp_name change:repeating_spell:sp_circle", fn(repSpellName ) );



// Copies the spell Effect of the current spell in all talents
var updateSSWillEffect = function fnupdateSSWillEffect(  ) {
  'use strict';
  try{
  let vals =[];
  getSectionIDs("repeating_talents", function gsIdRepeatingTalent(tarray) {
    getAttrs([ "SS-WilEffect"], function gaupdateSSWillEffect(values) {
      'use strict';
      logvalues( values);
      let w = getInt(values,"SS-WilEffect");
      for( let i = 0; i < tarray.length; i++) {
        vals[buildPre("T",tarray[i]) + "WilEffect"]=w;
      }
      setAttrsLog( vals );
    });
  });
} catch(err) {log("Earthdawn:updateSSWillEffect() error caught: " + err );}
}; // End updateSSWillEffect
on("change:ss-wileffect", fn(updateSSWillEffect) );



// If a modification type changes, see if we should hide or reveal the armor type field and the defensive fields.
//    ModType-ArmorType determines if field asking what type of armor resists the damage shows up. 1 if damage modifiers are used.
//    ActnEfct determines if defensive fields are displayed.    1 if Action, -1 if Effect. 0 if no Roll.
// Also takes care of updating ModPrefix, that enables/disables Modifiers "?" will trigger a rightly formated query while "x" will make an unvalid query
var repModType = function fnrepModType( eventInfo,code ) {
  try{
  let pre=buildShortPre(eventInfo,code);
  getAttrs([ pre + "Mod-Type", pre + "ModType-ArmorType", pre + "Target", pre + "RowID", pre+"Armor-Type" , pre + "Poison-Type"], function gaRModType(values) {
    'use strict';
    logvalues( values);
    let mt = values[ pre + "Mod-Type" ],
      vals={};
    if ( !mt )
    mt = "Action";

    if(mt=="Damage Poison"){
      if(values[pre+"Poison-Type"]=="Damage"){ //Damage Poisons are treated like Damage
        vals[ pre + "Target" ] = "None";
        vals[ pre + "ModType-ArmorType" ] = "1";
        vals[ pre + "Defensive" ] = "0";
        vals [pre+"ArmorType"]= "None";
        vals[ pre + "ActnEfct" ] = "-1";
      } else { //Other Poisons have a Target
        vals[ pre + "Target" ] = "Ask: ?{Target Number|0}";
        vals[ pre + "ModType-ArmorType" ] = "0";
        vals[ pre + "Defensive" ] = "0";
        vals [pre+"ArmorType"]= "N/1";
        vals[ pre + "ActnEfct" ] = "1";
        vals[ pre + "sayTotalSuccess" ] = "1";

        if(values[pre+"Poison-Type"]=="Paralysis") vals[pre+"SuccessText"]="Paralysis Poison : the Effect test is compared to the victims Toughness step. For each success, the character suffers a -2 penalty to all action tests. If the total penalty equals or exceeds the characters Strength Step, the character is fully paralyzed and cannot move. Character dies if the total penalty from the poison equals their total STR and TOU Steps for paralytic poisons."
        else if(values[pre+"Poison-Type"]=="Debilitation") vals[pre+"SuccessText"]="Debilitation Poison : the Effect test is compared to the victims Toughness, and he suffers a -2 test penalty for each success. If the penalty from a debilitating poison equals or exceeds the victims Toughness Step, the character is bedridden, and may not make action tests (other than Resistance tests) until the penalty has been reduced. Character dies if the total penalty from the poison equals twice their TOU Step for debilitating poisons."

      }
    }else{

    let dmg = mt.startsWith( "Damage" ) ? "1" : "0";
    if ( dmg === "1" && values[ pre + "Target" ] !== "None" )
      vals[ pre + "Target" ] = "None";
    if( values[ pre + "ModType-ArmorType" ] !== dmg )
      vals[ pre + "ModType-ArmorType" ] = dmg;
    if( mt === "Action" || mt == "JumpUp" || mt.startsWith( "Attack" ) )
      vals[ pre + "ActnEfct" ] = "1";
    else {
      vals[ pre + "Defensive" ] = "0";
      if( values[ pre + "Mod-Type" ] === "0" || values[ pre + "Mod-Type" ] === "NoRoll" )
      {vals[ pre + "ActnEfct" ] = "0";
      vals [pre+"Target"]= "None";
      vals [pre+"ArmorType"]= "N/A";
      }
      else
      vals[ pre + "ActnEfct" ] = "-1";
    }
  }

    vals[pre+"ModPrefix"]= vals[ pre + "ActnEfct" ]=="0" ? "x" :"?";
    if( Object.keys(vals).length > 0)
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:repModType() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End repModType
on("change:repeating_talents:t_mod-type change:repeating_knacks:nac_mod-type change:repeating_skills:sk_mod-type", fn(repModType) );
on("change:repeating_talents:t_poison-type change:repeating_knacks:nac_poison-type change:repeating_skills:sk_poison-type", fn(repModType) );



//Sets the ArmorType for a Poison

// var repPoisonType = function fnrepModType( eventInfo,code ) {
//   try{
//   let pre=buildShortPre(eventInfo,code);
//   getAttrs([ pre + "Mod-Type", pre + "Poison-Type"], function gaPoisonType(values) {
//     //log("reppoison " + values[ pre + "Mod-Type" ] + values[ pre + "Poison-Type" ]);
//     'use strict';
//     logvalues( values);
//     if(values[ pre + "Mod-Type" ]=="Damage Poison") {
//     let vals={};
//     if(!values[ pre + "Poison-Type" ] || values[ pre + "Poison-Type" ]=="Damage")
//       vals[pre+"ArmorType"]="None";
//     else vals[pre+"ArmorType"]="N/A";
//
//     setAttrsLog( vals );
//   }
//   });
// } catch(err) {log("Earthdawn:repPoisonType() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
// }; // End repModType
// on("change:repeating_talents:t_mod-type change:repeating_knacks:nac_mod-type change:repeating_skills:sk_mod-type", fn(repPoisonType) );
// on("change:repeating_talents:t_poison-type change:repeating_knacks:nac_poison-type change:repeating_skills:sk_poison-type", fn(repPoisonType) );
//





// Takes an Earthdawn step number, and returns a string containing the dice to be rolled.
// If step is less than 1, returns an empty string.
StepToDice = function( stepNum , edition)  {
'use strict';
try {
let dice = "";

if ( stepNum < 0 )
stepNum = 0;
if ( stepNum < 8 ) {         // The step numbers less than 8 don't follow the same pattern as the rest of the table and should just be set to the correct value.
switch( stepNum ) {
case 1:     dice = ((edition == 3) ? "{{1d6!-3}+d1}kh1+" : "{{1d4!-2}+d1}kh1+" );     break;         // Roll a d4 minus something, but also roll a "d1" and keep only the highest one.
case 2:     dice = ((edition == 3) ? "{{1d6!-2}+d1}kh1+" : "{{1d4!-1}+d1}kh1+" );     break;
case 3:     dice = ((edition == 3) ? "{{1d6!-1}+d1}kh1+" : "d4!+" );     break;
case 4:     dice = "d6!+";      break;
case 5:     dice = "d8!+";      break;
case 6:     dice = "d10!+";     break;
case 7:     dice = "d12!+";     break;
}
}  // end step 7 or less
else if( edition == 3 ) {        // Earthdawn 3rd edition.
var baseNum = stepNum - 6;
var twelves = 0;
if( stepNum > 12 )        // Calculate the number of d12's we need to roll.
twelves = Math.floor( baseNum / 7);
baseNum = ( baseNum % 7 ) + 6;    // We now have a number between 6 and 12. The chart repeats the same sequence, differing only in the number of d12's, which we have already calculated.

switch( baseNum ) {
case  6:     dice = "d10!+";            break;
case  7:     ++twelves;                 break;
case  8:     dice = "2d6!+";            break;
case  9:     dice = "d8!+d6!+";         break;
case 10:     dice = "2d8!+";            break;
case 11:     dice = "d10!+d8!+";        break;
case 12:     dice = "2d10!+";           break;
}
if( twelves > 0 )
dice = ((twelves === 1) ? "" : twelves.toString()) + "d12!+" + dice;
} else {        // This is Earthdawn 4th edition.
var baseNum = stepNum - 8;
if( stepNum > 18 )          // Calculate the number of d20's we need to roll.
dice = Math.floor( baseNum / 11).toString() + "d20!+";
baseNum = ( baseNum % 11 ) + 8;    // We now have a number between 8 and 18. The chart repeats the same sequence, differing only in the number of d2o's, which we have already calculated.
switch( baseNum ) {
case  8:     dice += "2d6!+";           break;
case  9:     dice += "d8!+d6!+";        break;
case 10:     dice += "2d8!+";           break;
case 11:     dice += "d10!+d8!+";       break;
case 12:     dice += "2d10!+";          break;
case 13:     dice += "d12!+d10!+";      break;
case 14:     dice += "2d12!+";          break;
case 15:     dice += "d12!+2d6!+";      break;
case 16:     dice += "d12!+d8!+d6!+";   break;
case 17:     dice += "d12!+2d8!+";      break;
case 18:     dice += "d12!+d10!+d8!+";  break;
}
} // End 4th edition
return dice.slice(0,-1);     // Trim off the trailing "+"
} catch(err) { log( "ED.StepToDice() error caught: " + err); }
};  //   End StepToDice()


// updateRepStep
// When anything changes that a repeating section (talents, knacks, skills, weapons) step number is based upon,
// Go through all the step numbers and recalculate them!
//
// If it is within a repeating section, just need to get the values to calculate one thing.
// If it is an attribute step or a condition that changed, then get all values for all rows, and
//    go through each row and see if it has than attribute or condition and recalculate mods and steps.
var updateRepStep = function fnupdateRepStep( eventInfo ) {
  'use strict';
  try {
     // log("updaterepstep " + JSON.stringify(eventInfo))
      //eventInfo can only be either an automatic eventInfo format generated by a sheetworker change(on trigger, or a string substitute in the format of a full name attribute type repeating_talents_-kgfjghfsdjgsdf-_T_Name. Beware that the name must not contain any underscore
    let att = getAttrib( eventInfo ),
      vals = {},
      getV = [ "condition-ImpairedMovement", "combatOption-DefensiveStance", "Misc-DefStance-Bonus", "condition-KnockedDown",
          "Adjust-All-Tests-Total", "Adjust-Effect-Tests-Total", "Adjust-Attacks-Total", "Adjust-Attacks-Total-CC",
          "Adjust-Damage-Total", "Adjust-Damage-Total-CC", "Initiative-Mods", "IP",
          "Dex-Step",  "Dex-Mods", "Str-Step",  "Str-Mods", "Tou-Step",  "Tou-Mods",
          "Per-Step",  "Per-Mods", "Wil-Step",  "Wil-Mods", "Cha-Step",  "Cha-Mods", "Initiative-Mod-Auto" ,"Initiative","Initiative-Step"];


    // this calculates the step value for one row, and puts them into val
    // rid is rowID all lower-cased as it is in values.
    function doRow( code, rid, values ) {
      try {
        if( rid && rid.length < 4) log("updateRepStep-Dorow incorrect rowid : " + rid + "    code: " + code );
        let pre = buildPre( code, rid),
          preWrite = buildPre( code, values[ pre + "RowID" ] || rid),
          workingMods = ( (values[ pre + "ActnEfct" ] !== "1" ) ? 0
              : ((getInt( values, pre + "Defensive" )  * getInt( values, "combatOption-DefensiveStance") * getInt( values, "Misc-DefStance-Bonus"))))
              - ((getInt( values, pre + "MoveBased" )  * getInt( values, "condition-ImpairedMovement" ))),
          attribMods = 0,
          modType = 0,
          att = "";
        switch ( values[ pre + "Mod-Type" ] ) {
          case "Action":    modType = getInt( values,  "Adjust-All-Tests-Total" );    break;
          case "Effect":    modType = getInt( values,  "Adjust-Effect-Tests-Total" ); break;
          case "Attack":    modType = getInt( values,  "Adjust-Attacks-Total" );      break;
          case "Attack CC": modType = getInt( values,  "Adjust-Attacks-Total-CC" );   break;
          case "Damage":    modType = getInt( values,  "Adjust-Damage-Total" );       break;
          case "Damage CC": modType = getInt( values,  "Adjust-Damage-Total-CC" );    break;
          case "Init":      modType = getInt( values,  "Initiative-Mod-Auto" );       break;
          case "JumpUp":  modType = getInt( values,  "Adjust-All-Tests-Total" ) - getInt( values,  "IP" );    break;
          default: modType = 0;
        }
        att = values[ pre + "Attribute" ];
        if( att && att !== "0" )        attribMods =  getInt( values, att + "-Mods" );
        let modAuto = attribMods + workingMods + modType;
        if( modAuto !== getInt( values, pre + "Mod-Auto" ))         vals[ preWrite + "Mod-Auto" ] = modAuto;
        let baseStep = getInt( values, pre + "Effective-Rank" ) + ((att && att !== "0" ) ? getInt( values, att + "-Step" ) : 0 );
        // if( baseStep !== getInt( values, pre + "BaseStep" ))
        vals[ preWrite + "BaseStep" ] = baseStep;
        let step = baseStep + getInt( values, pre + "Mods" ) + modAuto;
        // if( step !== getInt( values, pre + "Step" ))
        vals[ preWrite + "Step" ] = step;
        vals[ preWrite + "Step_max" ] = StepToDice(step);
      } catch(err) { log( "Earthdawn:updateRepStep-doRow() error caught: " + err + "   for code: " + code + " rid: " + rid + "values: "); log( values ); }
    } // end of function doRow()


    if ( att.startsWith( "repeating_" )) {    // Since the attribute that changed is in a repeating section, all we need to get are the values inside this specific repeating section, and all the outside values.
      let direct = _.isString(eventInfo),     //If it is a direct call we will need full names
        code,
        rid = direct ? repeatSection(2, att) : undefined;

      switch( repeatSection( 1, att )) {
        case "talents" : code = "T";    break;
        case "skills"  : code = "SK";   break;
        case "knacks"  : code = "NAC";  break;
        default: log("Earthdawn : Error illegal att in updateRepStep: " + att);
      }
      let     pre = buildPre( code, rid );

      if ( att.startsWith( "repeating_talents" ) || att.startsWith( "repeating_skills" ) || att.startsWith( "repeating_knacks" )) {
        getV = _.union(getV, [ pre+"RowID", pre+"MoveBased",
        pre+"Defensive", pre+"ActnEfct",
        pre+"Mod-Auto", pre+"Mod-Type", pre+"Attribute" , pre+"BaseStep",
        pre+"Step", pre+"Mods", pre+"Effective-Rank" ]);
      } else log("Earthdawn : Error illegal att in updateRepStep: " + att );
      getAttrs( getV, function gaUpdateRepStepRepeating(values) {
        'use strict';

        doRow( code, rid, values );

        if( Object.keys(vals).length )
        setAttrsLog( vals );
      });
    } else {      // Since the value that changed is not inside a repeating section, we need to get all the  values needed for our calculations outside the repeating section, plus ALL the repeating sections and their values!
      let i = 0, pre;
      getSectionIDs("repeating_talents", function gsRepStepIdTalents(tarray) {
        for( i = 0; i < tarray.length; i++ ) {
          pre = buildPre( "T", tarray[ i ]);
          getV = _.union( getV, [ pre + "RowID", pre + "MoveBased",  pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto",  pre + "Attribute" , pre + "BaseStep",
          pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
        }
        getSectionIDs("repeating_knacks", function gsRepStepIdKnacks(karray) {
          for( i = 0; i < karray.length; i++ ) {
            pre = buildPre( "NAC", karray[ i ]);
            getV = _.union( getV, [ pre + "RowID", pre + "MoveBased",  pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto",  pre + "Attribute" , pre + "BaseStep",
            pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
          }
          getSectionIDs("repeating_skills", function gsRepStepIdSkills(skarray) {
            for( i = 0; i < skarray.length; i++ ) {
              pre = buildPre( "SK", skarray[ i ]);
              getV = _.union( getV, [ pre + "RowID", pre + "MoveBased",  pre + "Defensive", pre + "ActnEfct" , pre + "Mod-Type" , pre + "Mod-Auto",  pre + "Attribute" , pre + "BaseStep",
              pre + "Step", pre + "Mods", pre + "Effective-Rank"]);
            }
            getAttrs( getV , function gaUpdateRepStepRepeating(values) {
              'use strict';
              for( i = 0; i < tarray.length; i++ ){
                doRow( "T", tarray[ i ], values );
              };
              for( i = 0; i < karray.length; i++ ){
                doRow( "NAC", karray[ i ], values );
              };
              for( i = 0; i < skarray.length; i++ ){
                doRow( "SK", skarray[ i ], values );
              };
              //if( Object.keys(vals).length )
              setAttrsLog( vals );
            });
          });
        });
      });
    } // end not repeating.
  } catch(err) {log("Earthdawn:updateRepStep() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateRepStep()
on("change:repeating_talents:t_movebased  change:repeating_talents:t_actnefct change:repeating_talents:t_defensive change:repeating_talents:t_mod-type change:repeating_talents:t_attribute change:repeating_talents:t_mods change:repeating_talents:t_effective-rank", fn( updateRepStep ));
on("change:repeating_skills:sk_movebased  change:repeating_skills:sk_actnefct change:repeating_skills:sk_defensive change:repeating_skills:sk_mod-type change:repeating_skills:sk_attribute change:repeating_skills:sk_mods change:repeating_skills:sk_effective-rank", fn( updateRepStep ));
on("change:repeating_knacks:nac_movebased  change:repeating_knacks:nac_actnefct change:repeating_knacks:nac_defensive change:repeating_knacks:nac_mod-type change:repeating_knacks:nac_attribute change:repeating_knacks:nac_mods change:repeating_knacks:nac_effective-rank", fn( updateRepStep ));
on("change:condition-impairedmovement  change:initiative-mods change:initiative-mod-auto change:initiative-step change:dex-step change:dex-mods change:str-step change:str-mods change:tou-step  change:tou-mods change:per-step  change:per-mods change:wil-step change:wil-mods change:cha-step change:cha-mods", fn( updateRepStep ));



    /*        // If an NPC or Mook, default is GM only. If PC or Item, default is public.
    var updateNPC = function fnUpdateNPC() {
    'use strict';

    getAttrs([ "NPC", "RollType" ], function gaUpdateNPC(values) {
    'use strict';
    logvalues( values);

    if ( parseInt2( values[ "NPC" ] ) > 0 )    // NPC or Mook
    var x = "/w gm";
    else
    var x = " ";
    if( values[ "RollType"] != x )
    setAttrsLog({ "RollType": x });
  });
};
*/



var updateLanguage = function fnUpdateLangauge( code ) {
  'use strict';
  try{
  getSectionIDs("repeating_skilll", function(idArray) {
    var toGet = [];
    for( let i = 0; i < idArray.length; ++i) {
      toGet.push( buildPre( "SKL", idArray[ i ] ) + (code.endsWith( "S" ) ? "Speak" : "ReadWrite" )
      + (code.startsWith( "T" ) ? "-T" : ""));
    }
    getAttrs( toGet, function gaUpdateLangauge(values) {
      'use strict';
      logvalues( values);
      var cnt = 0, t;
      for( let l = 0; l < toGet.length; ++l){
        t = getInt( values, toGet[ l ] );
        if( t )
        cnt += 1;
      }
      let vals = {};
      // vals[ "SKL_Total" + code.slice( 0, 1) + ( code.endsWith( "S" ) ? "-Speak" : "-ReadWrite") ] = cnt;
      vals[ ( code.startsWith( "S" ) ? "LS" :   "LT") + ( code.endsWith( "S" ) ? "-Speak" : "-ReadWrite") +  ( code.startsWith( "S" ) ? "-Rank" :   "-Known") ] = cnt;
      setAttrsLog( vals );
    });
  });
  } catch(err) {log("Earthdawn:updateLanguage() error caught: " + err +" code: " +code);}
}; // End updateLanguage()

on("change:repeating_skilll:skl_speak", fn(_.partial(updateLanguage, "SS")));
on("change:repeating_skilll:skl_readwrite", fn(_.partial(updateLanguage, "SR")));
on("change:repeating_skilll:skl_speak-t", fn(_.partial(updateLanguage, "TS")));
on("change:repeating_skilll:skl_readwrite-t", fn(_.partial(updateLanguage, "TR")));



var updateSkillType = function fnupdateSkillType( eventInfo ) {
  'use strict';
  try{
  let pre=buildShortPre(eventInfo,"SK");
  let vals={};
  getAttrs( [pre+"Class",pre+"Attribute"], function gaupdateSkillType(values) {
    'use strict';
    logvalues(values);
    switch (values[pre+"Class"]){
      case "Knowledge" :
      vals[pre+"Attribute"]="Per";
      vals[pre+"Target"]="None";
      vals[pre+"Target-NoAPI"]="None";
      break;
      case "Artisan" :
      if(!values[pre+"Attribute"] || values[pre+"Attribute"]=="0") vals[pre+"Attribute"]="Cha";
      vals[pre+"Target"]="None";
      vals[pre+"Target-NoAPI"]="None";
      break;
      default:
      //vals[pre+"Attribute"]="0";
    }
    setAttrsLog( vals );
  });
} catch(err) {log("Earthdawn:updateSkillType() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateSkillType()
on("change:repeating_skills:sk_class", fn(updateSkillType));



var updateCreatureFlags = function fnUpdateCreatureFlags() {
  'use strict';
  try{
  getAttrs([ "Creature-ResistPain", "Creature-Fury", "Creature-HardenedArmor", "Creature-GrabAndBite", "Creature-Hamstring", "Creature-Overrun",
  "Creature-Pounce", "Creature-SqueezeTheLife",  "Opponent-ClipTheWing", "Opponent-CrackTheShell", "Opponent-Defang", "Opponent-Enrage", "Opponent-Provoke", "Opponent-PryLoose","CreatureFlags" ], function gaUpdateCreatureFlags(values) {
    'use strict';
    logvalues( values);
    let flagsCreature = {         // Note: If you change this, also change in .js file.
      Fury:           0x0001,
      ResistPain:     0x0002,
      HardenedArmor:  0x0004,
      GrabAndBite:    0x0100,
      Hamstring:      0x0200,
      Overrun:        0x0400,
      Pounce:         0x0800,
      SqueezeTheLife: 0x1000,
      CreatureMask:   0xffff,
      ClipTheWing:    0x00100000,
      CrackTheShell:  0x00200000,
      Defang:         0x00400000,
      Enrage:         0x00800000,
      Provoke:        0x01000000,
      PryLoose:       0x02000000,
      OpponentMask:   0x1ff00000
    };
    let val = 0;
    if( values[ "Creature-Fury" ] === "1" )           val += flagsCreature.Fury;
    if( values[ "Creature-ResistPain" ] === "1" )     val += flagsCreature.ResistPain;
    if( values[ "Creature-HardenedArmor" ] === "1" )  val += flagsCreature.HardenedArmor;
    if( values[ "Creature-GrabAndBite" ] === "1" )    val += flagsCreature.GrabAndBite;
    if( values[ "Creature-Hamstring" ] === "1" )      val += flagsCreature.Hamstring;
    if( values[ "Creature-Overrun" ] === "1" )        val += flagsCreature.Overrun;
    if( values[ "Creature-Pounce" ] === "1" )         val += flagsCreature.Pounce;
    if( values[ "Creature-SqueezeTheLife" ] === "1" ) val += flagsCreature.SqueezeTheLife;
    if( values[ "Opponent-ClipTheWing" ] === "1" )    val += flagsCreature.ClipTheWing;
    if( values[ "Opponent-CrackTheShell" ] === "1" )  val += flagsCreature.CrackTheShell;
    if( values[ "Opponent-Defang" ] === "1" )         val += flagsCreature.Defang;
    if( values[ "Opponent-Enrage" ] === "1" )         val += flagsCreature.Enrage;
    if( values[ "Opponent-Provoke" ] === "1" )        val += flagsCreature.Provoke;
    if( values[ "Opponent-PryLoose" ] === "1" )       val += flagsCreature.PryLoose;
    if( val != values[ "CreatureFlags" ])
    setAttrsLog({ "CreatureFlags": val });
  });
} catch(err) {log("Earthdawn:updateCreatureFlags() error caught: " + err);}
}; // End updateCreatureFlags()
on("change:creature-resistpain change:creature-fury change:creature-hardenedarmor change:creature-grabandbite change:creature-hamstring change:creature-overrun change:creature-pounce change:creature-squeezethelife change:opponent-clipthewing change:opponent-cracktheshell change:opponent-defang change:opponent-enrage change:opponent-provoke change:opponent-pryloose", fn(updateCreatureFlags));



// When rolling from a sheet, button can use:   @{target|Target|token_id}
// When called from a token action:             @{selected|token_id}
// is much better. If the target has the first, put the second into another variable.
var updateTarget = function fnupdateTarget( eventInfo ) {
  'use strict';
  try{
  let x = (_.isString( eventInfo ) ? eventInfo : eventInfo[ "sourceAttribute"]).split("_");
  x[ x.length -2 ] = x[ x.length -2 ].toUpperCase();
  x.pop();
  x.splice( 2, 1 );   // eventInfo is vandalized by the system. It has been all lowercased, Easiest to just strip the RowID out and let system figure it out (which it does).
  let sa = x.join("_") + "_Target-TA",
  val = eventInfo[ "newValue" ],
  vals = {};
  if( val.slice( 1, 13) == "D1: @{target" )
  val += ": @{selected|token_id}";
  vals[ sa ] = val;
  setAttrsLog( vals );
} catch(err) {log("Earthdawn:updateTarget() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateTarget()
on("change:repeating_talents:t_target change:repeating_knacks:nac_target change:repeating_skills:sk_target", fn( updateTarget ));



// Given an attribute name and value, look at the value and see if it is problematic (has double brackets, quotes, etc) and if so remove the problematic characters.
var sanitize = function fnsanitize( name, value) {
  'use strict';
  try {
     //log("sanitize " + value + " for " + name);
    let beg = value, end = "";
    if( name.endsWith( "_DisplayText" ) || name.endsWith( "_SuccessText" ) || name.endsWith( "_FailText" )) {
      let i = value.indexOf( "~" );     // These three have a display part and a code part. Only sanitize them up to the first Tilda.
      if( i > -1 ) {
        beg = value.slice( 0, i );
        end = value.slice( i );
    } }
    let newVal = beg.replace( /[\"|\,|\;|\:\~\\+]/gi, "") // Remove all  double quotes, commas, colons, semicolons or Tilda and character #192 which we use as a flag to trigger this routine.
    .replace("\'","") //Replace single quotes U+0027 that can be seen as string delimiter by apostrophe U+2019 that is just a character for apostrophe
        .replace( /\@\{/gi, "{")        // and all @ signs followed by {
        .replace( /\[+/gi, "[" ).replace( /\]+/gi, "]" ).replace( /\{+/gi, "{" ).replace( /\}+/gi, "}" ).replace( /\(+/gi, "(" ).replace( /\)+/gi, ")" )    // All sequences of more than one [] {} () get replaced by a single one.
        + end;
      // log("sanitize " + value +" into "+newVal + " for " + name);
    if ( value !== newVal ) {
      let vals = {};
      vals[ name ] = newVal;
      setAttrsLog( vals );
      if(name.endsWith("_Name") && ["T","SK","SP","ARM","WPN","INV","BL","MNT","NAC"].includes(repeatSection(3,name))) AutoFill(name,"sanitize",newVal);
      //JBF@JBF compendium : should call directly Autofill
    }
  } catch(err) {log("Earthdawn:sanitize() error caught: " + err );}
}; // End sanitize()



  // Given an attribute name and value, look at the value and shortens Range, Duration ...etc
  var spellsanitize = function fnspellsanitize( name, value) {
    'use strict';
    try{
      //log("spellsanitize "+name + " "+value);
    let newVal = value.replace( /yards/gi, " y").replace( /Touch/gi, "T").replace( /Self/gi, "S").replace( /Rank/gi, "Rk").replace( /Rnd/gi, "Rd")
    .replace( /hours/gi, "Hr").replace( /Minutes/gi, "Min").replace( /miles/gi, "Mi").replace( /Circle/gi, "Cir").replace( /square-yard/gi, "Sq-y").replace( /area/gi, "");     // Replace yards by y, Touch by T, Self by S, remove space
    if ( value !== newVal ) {
      let vals = {};
      vals[ name ] = newVal;
      setAttrsLog( vals );
    }
  } catch(err) {log("Earthdawn:spellsanitize() error caught: " + err );}
}; // End spellsanitize()



// Triggered directly by the change of the value
var spellsanitize2 = function fnspellsanitize2( eventInfo ) {
  'use strict';
  try{
    let isStr = _.isString( eventInfo ),
    att, newAtt;
    if( isStr )
    att = eventInfo;
    else {
      att = eventInfo["sourceAttribute"];
    }
    if(!att) return;
    getAttrs([ att ], function gaspellSanitize(values) {
      if(values[att]) spellsanitize(att,values[att]);
  });
} catch(err) {log("Earthdawn:spellsanitize2() error caught: " + err );}
}; // End spellsanitize2()
  on("change:repeating_spell:sp_aoe change:repeating_spell:sp_duration change:repeating_spell:sp_range", fn( spellsanitize2 ));



  // Often Sanitize is called by other routines which are doing other work on that attribute anyway. This routine if for those values that have no other work to be done. It just calls sanitize.
  var preSanitize = function fnpreSanitize( eventInfo ) {
    'use strict';
    try{
    let isStr = _.isString( eventInfo ),
    att, newAtt;
    if( isStr )
    att = eventInfo;
    else {
      // if( eventInfo[ "sourceType" ] !== "player" ) //Deleted these lines to be able to trigger preSanitize during updatecharactersheet
      // return;
      att = eventInfo["sourceAttribute"];
    }
    // log("presanitize " + att);
    // Clumsily deal the the name vandalism.
    if( att.startsWith( "repeating_" ))
    {
      // let ar = att.split( "_" );
      // let pre = buildPre( ar[ ar.length - 2 ] );
      let pre= buildPre( repeatSection( 3, att ), repeatSection( 2, att ));

      if( att.search( /_name$/gi ) !== -1)
      newAtt = pre + "Name";
      else if( att.search( /displaytext/gi ) !== -1)
      newAtt = pre + "DisplayText";
      else if( att.search( /successtext/gi ) !== -1)
      newAtt = pre + "SuccessText";
      else if( att.search( /failtext/gi ) !== -1)
      newAtt = pre + "FailText";
      else if( att.search( /basetalent/gi ) !== -1)
      newAtt = pre + "BaseTalent";
      else if( att.search( /restrictions/gi ) !== -1)
      newAtt = pre + "Restrictions";
      else if( att.search( /range/gi ) !== -1)
      newAtt = pre + "Range";
      else if( att.search( /date/gi ) !== -1)
      newAtt = pre + "Date";
      else if( att.search( /aoe/gi ) !== -1)
      newAtt = pre + "AoE";
      else if( att.search( /man_desc/gi ) !== -1)
      newAtt = pre + "Desc";
    } else {
      newAtt = att.replace( /misc-poolname/gi, "Misc-PoolName" );
      newAtt = att.replace( /armor-name/gi, "Armor-Name" );
      newAtt = att.replace( /armor-date/gi, "Armor-Date" );
      newAtt = att.replace( /shield-name/gi, "Shield-Name" );
      newAtt = att.replace( /shield-date/gi, "Shield-Date" );
      newAtt = att.replace( /wealth_other/gi, "Wealth_Other" );
    }
    if( !isStr && "newValue" in eventInfo)
    sanitize( newAtt, eventInfo[ "newValue"] );
    else
    getAttrs([ newAtt ], function gapreSanitize(values) {
      'use strict';
      sanitize( newAtt, values[ newAtt ] );
    });
  } catch(err) {log("Earthdawn:preSanitize() error caught: " + err );}
}; // End preSanitize()
  on("change:player-name change:charname change:misc-poolname-1 change:misc-poolname-2 change:misc-poolname-3 change:armor-name change:shield-name change:record-date-real change:record-date-throalic change:record-reason change:wealth_other  change:repeating_talents:t_name change:repeating_talents:t_displaytext change:repeating_talents:t_successtext change:repeating_talents:t_failtext change:repeating_knacks:nac_name change:repeating_knacks:nac_displaytext change:repeating_knacks:nac_successtext change:repeating_knacks:nac_failtext change:repeating_knacks:nac_basetalent change:repeating_knacks:nac_restrictions change:repeating_skills:sk_name change:repeating_skills:sk_displaytext change:repeating_skills:sk_successtext change:repeating_skills:sk_failtext change:repeating_skilll:skl_name ", fn( preSanitize ));
  on("change:repeating_spell:sp_name change:repeating_spell:sp_displaytext change:repeating_spell:sp_successtext change:repeating_spell:sp_failtext change:repeating_spell:sp_range change:repeating_spell:sp_aoe change:repeating_weapons:wpn_name change:repeating_weapons:wpn_range change:repeating_weapons:wpn_date change:repeating_mount:mnt_name change:repeating_threads:ti_name change:repeating_maneuvers:man_name change:repeating_maneuvers:man_desc change:repeating_armor:arm_name", fn( preSanitize ));



  //JBF  Step Display for Damage of repeating_weapons
  var updateAllWeaponDamage = function fnupdateAllWeaponDamage( eventInfo ) {
    'use strict';
    try{
    let i;
    getSectionIDs("repeating_weapons", function gsupdateAllWeaponDamage(tarray) {
      for( i = 0; i < tarray.length; i++)
      UpdateWeaponDamage( tarray[ i ]);
    });
  } catch(err) {log("Earthdawn:updateAllWeaponDamage() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End updateAllWeaponDamage
  on("change:adjust-damage-total-cc change:str-mods change:str-step change:str-adjust", fn(updateAllWeaponDamage) );



  var UpdateWeaponDamage = function fnUpdateWeaponDamage( eventInfo ) {
    'use strict';
    try{
    let pre = buildShortPre(eventInfo,"WPN"),
     strCC     = pre +"CloseCombat",
     strRk     = pre +"Effective-Rank",
     strMod    = pre +"Mods";
    getAttrs([ "Str-Step", "Adjust-Damage-Total", "Adjust-Damage-Total-CC", "Str-Mods", strCC, strRk, strMod], function gaUpdateWeaponDamage(values) {
      'use strict';
      logvalues( values);
      let cc=getInt(values,strCC),
       vals={},
       AutoMod= getInt(values,"Str-Mods");
      if (cc>=0)         AutoMod +=getInt(values,"Adjust-Damage-Total-CC");
      else                        AutoMod +=getInt(values,"Adjust-Damage-Total");
      vals[ pre + "Mod-Auto" ] =AutoMod;
      vals[ pre+"BaseDamage"]=getInt(values,"Str-Step")+getInt(values,strRk);
      vals[ pre+"Damage"]=vals[ pre+"BaseDamage"] + getInt(values,strMod)+AutoMod;
      vals[ pre + "Damage_max" ] = StepToDice(vals[ pre+"Damage"]);
      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:updateWeaponDamage() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}; // End UpdateWeaponDamage
  on("change:repeating_weapons", fn(UpdateWeaponDamage) );
  //on("change:repeating_weapons:wpn_closecombat change:repeating_weapons:wpn_mods change:repeating_weapons:wpn_effective-rank", fn(UpdateWeaponDamage) );



  // This sets the unc rating (minus stun damage taken) into Damage_max, where token bars use it.
  on("change:damage-stun change:damage-unc-rating", fn(function ocDamageStun( eventInfo ) {
    'use strict';
    try{
    getAttrs([ "Damage-Unc-Rating", "Damage-Stun" ], function gaDamageStun(values) {
      'use strict';
      logvalues( values);
      let vals = {};
      vals[ "Damage_max" ] = getInt( values, "Damage-Unc-Rating" ) - getInt( values, "Damage-Stun" );
      setAttrsLog( vals );
    });
  } catch(err) {log("Earthdawn:ocDamageStun() error caught: " + err +" eventInfo: " +JSON.stringify(eventInfo));}
}));//end ocDamageStun



  on("change:attrib-dex-curr change:dex-adjust", fn(function ocDexCurr() {
    'use strict';
    updateAttribStep("Dex");
    updateDefensebase( "Dex", "PD");
  }));

  on("change:attrib-str-curr change:str-adjust", fn(function ocStrCurr() {
    'use strict';
    updateAttribStep("Str");
    updateCarry();
  }));

  on("change:attrib-tou-curr change:tou-adjust", fn(function ocTouCurr() {
    'use strict';
    updateAttribStep("Tou");
    updateHealth();
  }));

  on("change:attrib-per-curr change:per-adjust", fn(function ocPerCurr() {
    'use strict';
    updateAttribStep("Per");
    updateDefensebase( "Per", "MD");
  }));

  on("change:attrib-wil-curr change:wil-adjust", fn(function ocWilCurr() {
    'use strict';
    updateAttribStep("Wil");
    updateMaBase();
  }));

  on("change:attrib-cha-curr change:cha-adjust", fn(function ocCharCurr() {
    'use strict';
    updateAttribStep("Cha");
    updateDefensebase( "Cha", "SD");
  }));

  on("change:dex-step", fn(function ocDexStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Dex" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Dex" );
  }));

  on("change:str-step", fn(function ocStrStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Str" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Str" );
  }));

  on("change:tou-step", fn(function ocTouStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Tou" );
    updateHealth();
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Tou" )
  }));

  on("change:per-step", fn(function ocPerStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Per" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Per" );
  }));

  on("change:wil-step", fn(function ocWilStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Wil" );
    if( eventInfo.sourceType === "player" )
    backfillOrigAttrib( "Wil" );
  }));

  on("change:cha-step", fn(function ocChaStep(eventInfo) {
    'use strict';
    updateAttribFinal( "Cha" );
    if( eventInfo.sourceType === "player")
    backfillOrigAttrib( "Cha" );
  }));



  var recalc = function fnrecalc(eventInfo){     // Recalculate all calculated fields.
    'use strict';
    try{
    getAttrs([ "wt-test1", "wt-test2", "edition" ], function(values) {         // This is just an event to let the user know that recalculatin has started.
      'use strict';
      //log("EarthDawn : Start Recalc( " + JSON.stringify(eventInfo) + " )");
      let v = {},
      x = getInt( values, "wt-test1" ) + 7;
      if(!values["edition"]) {
        log("Earthdawn-Recalc : defaulting new character to Ed.4")
        v["edition"]=4;
        }
      v[ "wt-test2" ] = x;
      setAttrsLog( v );
    });
    let timer = Date.now();
    updateEffectIsAction("True");
    //updateRace( "recalc" );
    repEquipped("recalc");
    updateAttribCurr( "Dex" );
    updateAttribCurr( "Str" );
    updateAttribCurr( "Tou" );
    updateAttribCurr( "Per" );
    updateAttribCurr( "Wil" );
    updateAttribCurr( "Cha" );
    updateAttribStep( "Dex" );
    updateAttribStep( "Str" );
    updateAttribStep( "Tou" );
    updateAttribStep( "Per" );
    updateAttribStep( "Wil" );
    updateAttribStep( "Cha" );
    updateAttribFinal( "Dex" );
    updateAttribFinal( "Str" );
    updateAttribFinal( "Tou" );
    updateAttribFinal( "Per" );
    updateAttribFinal( "Wil" );
    updateAttribFinal( "Cha" );
    UpdateKask("Dex-Karma");
    UpdateKask("Str-Karma");
    UpdateKask("Tou-Karma");
    UpdateKask("Per-Karma");
    UpdateKask("Wil-Karma");
    UpdateKask("Cha-Karma");
    UpdateKask("Initiative-Karma");
    UpdateKask("Recovery-Karma");
    UpdateKask("Dex-DP");
    UpdateKask("Str-DP");
    UpdateKask("Tou-DP");
    UpdateKask("Per-DP");
    UpdateKask("Wil-DP");
    UpdateKask("Cha-DP");
    UpdateKask("Initiative-DP");
    UpdateKask("Recovery-DP");
    updateDurability();
    updateAttribCosts();
    updateCarry();
    updateHealth();
    updateInitiative();
    updateKnockdown();
    updateIP();
    updateKarma();
    updateLpStatus();
    updateMovement();
    updateDefensebase( "Dex", "PD");
    updateDefensebase( "Per", "MD");
    updateDefensebase( "Cha", "SD");
    updateMaBase();
    updateDefenseNatural( "PD" );
    updateDefenseNatural( "MD" );
    updateDefenseNatural( "SD" );
    updateDefenseNatural( "PA" );
    updateDefenseNatural( "MA" );
    updatePD();
    updateMD();
    updateSD();
    updatePhysicalArmor();
    updateMysticArmor();
    updateRecovery();
    UpdateAdjustGlobalModifiers();
    updateAdjustTN();
    updateWeightCoin();
    updateWeightEquipment();
    updateWeightSupply();
    UpdateCarried();
    ConditionHealth();
    updateCreatureFlags();
    repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
    repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
    repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
    repeatingSum("Damage-Blood", "blood","BL_Damage-Blood-Magic");
    updateRepStep();
    countDiscipline();
    let i;
    getSectionIDs("repeating_discipline", function gsIdRepeatingDiscipline(tarray) {
      for( i = 0; i < tarray.length; i++)
      repDiscipline(tarray[ i ]);
    });
    //JBF@JBF@CD : repDiscipline has sometimes been commented out, but it creates issues when loading a new sheet, so put back

    getSectionIDs("repeating_spell", function gsIdRepeatingSpellName(tarray) {
      for( i = 0; i < tarray.length; i++){
        repSpellName( tarray[ i ]);
        let pre = buildPre( "SP", tarray[ i ]);
        // spellsanitize2(pre+"Range");
        // spellsanitize2(pre+"AoE");
        // spellsanitize2(pre+"Duration");
        repStrain(buildPre("SP",tarray[ i ])+"Strain");

      }
    });
    getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(tarray) {
      for( i = 0; i < tarray.length; i++)
      repMatrixType( tarray[ i ]);
    });
    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( i = 0; i < tarray.length; i++) {
        preSanitize(buildPre("T",tarray[ i ])+"Name")
        repRanks( tarray[ i ],"T");
        repModType(tarray[ i ],"T");
        UpdateKask(buildPre("T",tarray[ i ])+"Karma");
        UpdateKask(buildPre("T",tarray[ i ])+"DP");
        repStrain(buildPre("T",tarray[ i ])+"Strain");

      }
    });
    getSectionIDs("repeating_knacks", function gsIdRepeatingKnacks(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("NAC",tarray[ i ])+"Name")
        repRanks(tarray[ i ],"NAC");
        repModType(tarray[ i ],"NAC");
        UpdateKask(buildPre("NAC",tarray[ i ])+"Karma");
        UpdateKask(buildPre("NAC",tarray[ i ])+"DP");
        repStrain(buildPre("NAC",tarray[ i ])+"Strain");

      }
    });
    getSectionIDs("repeating_skills", function gsIdRepeatingSkills(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("SK",tarray[ i ])+"Name")
        repRanks(tarray[ i ],"SK");
        repModType(tarray[ i ],"SK");
        UpdateKask(buildPre("SK",tarray[ i ])+"Karma");
        UpdateKask(buildPre("SK",tarray[ i ])+"DP");
        repStrain(buildPre("SK",tarray[ i ])+"Strain");

      }
    });
    getSectionIDs("repeating_weapons", function gsIdRepeatingWeapons(tarray) {
      for( i = 0; i < tarray.length; i++){
        preSanitize(buildPre("WPN",tarray[ i ])+"Name")
        UpdateKask(buildPre("WPN",tarray[ i ])+"Karma");
        UpdateKask(buildPre("WPN",tarray[ i ])+"DP");
        repRanks(tarray[ i ],"WPN");
        UpdateWeaponDamage(tarray[ i ]);
      }
    });
    updateTalentSummary();
    getAttrs([ "wt-test1", "wt-test2" ], function(values) {         // This is just an event to let the user know that recalculation has finished.
      'use strict';
      var x = getInt( values, "wt-test1" ) + 1;
      setAttrsLog({  "wt-test2": x });
    });
    //log("Ending recalc() after " + (Date.now() - timer) + " ms.");
  } catch(err) {log("Earthdawn:recalc() error caught: " + err );}
} // end recalc()
  on("change:edition", fn(recalc));



  on("change:specialfunction", fn(function ocSpecialFunction() {
    'use strict';
    try{
    getAttrs(["SpecialFunction" ], function gaSpecialFunction(values) {
      'use strict';
      logvalues( values);
      if( values[ "SpecialFunction" ].trim().endsWith( "Recalc" ))
      recalc();                   // If SpecialFunction has been set to Recalc - Recalculate all calculated fields.
      else if (values[ "SpecialFunction" ].trim().endsWith( "SheetWorkerTest")) {
        log("Earhdawn : SpecialFunction SheetWorkerTest");
      } // End SheetWrokerTest code
    });
  } catch(err) {log("Earthdawn:ocSpecialFunct() error caught: " + err );}
})); // End ocSpecialFunct



  on("clicked:newday", fn(function ocNewDay() {
    'use strict';
    try{
    getAttrs([ "Karma_max","Karma", "Recovery-Tests","Recovery-Tests_max", "Misc-KarmaRitual", "working-Circle","Karma-Modifier" ,"KarmaRitual-Rank"], function(values) {
      let vals = {};
      let ritual =getInt(values, "Misc-KarmaRitual");
      //Function Refills Recovery Tests to Max
      vals["Recovery-Tests"] =  Math.max (getInt(values,"Recovery-Tests"),getInt(values,"Recovery-Tests_max"));
      //vals["Karma"] =  Math.max (getInt(values,"Karma"),getInt(values,"Karma_max"));
      //Function Refills Karma Pool according to settings
      switch( ritual )
      {
        case 0 : return; // 0 : No Karma Ritual
        case -1 : vals["Karma"] = getInt(values,"Karma_max"); break; //Default : Ed4 rule
        case -2 : vals["Karma"] =Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"working-Circle")); break; //Homerule option: refill circle per day
        case -3 : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"Karma-Modifier")); break; //Homerule option : Refill as per race modifier
        case -4 : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"KarmaRitual-Rank")); break; //For ED3, Create a Karma Ritual Talent (with T_Type)
        default : vals["Karma"] = Math.min (getInt(values,"Karma_max"),getInt(values,"Karma")+getInt(values,"Misc-KarmaRitual")); //Homerule : refill fixed per day
      }
      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:ocNewDay() error caught: " + err );}
}));//end ocNewDay



on("clicked:setalloptions clicked:resetalloptions", fn(function ocSetAllOptions(eventInfo) {
  'use strict';
  try{
    let vals = {};
    let m= (eventInfo && eventInfo.triggerName.match("resetalloptions")) ? "0" : "1";
    log(JSON.stringify(eventInfo));
    vals["show_karma_auto"]= m;
    vals["show_damage_stun"]= m;
    vals["show_wound_treshold"]= m;
    vals["show_options_status"]= m;
    vals["show_natural_toggle"]= m;
    vals["show_actnefct_toggle"]= m;
    vals["show_overview_miscpool"]= m;
    vals["show_repeating_mod_exc"]= m;
    vals["show_repeating_success"]= m;
    vals["show_repeating_links"]= m;
    vals["show_repeating_special"]= m;
    vals["show_repeating_step_dice"]= m;
    vals["show_container"]= m;
    vals["show_blood"]= m;
    vals["show_mounts"]= m;
    vals["show_lifestyle"]= m;
    vals["legend-transaction-mode"]= m;
    vals["legend-calc-mode"]= m;
    setAttrsLog(vals);
} catch(err) {log("Earthdawn:ocSetAllOptions() error caught: " + err );}
}));//end ocSetAllOptions



on("clicked:settalentdefault", fn(function ocSetTalentDefault() {
  'use strict';
  try{
    getSectionIDs("repeating_talents", function gsSetTalentDefault(tarray) {
      getAttrs(["Talents-Default-Rank"],function gaSetTalentDefault(values) {
        let vals = {};
          for(let i=0 ; i<tarray.length;++i)
          vals[buildPre("T",tarray[i]) + "Rank"]=values["Talents-Default-Rank"];
    setAttrsLog(vals);
});
});
} catch(err) {log("Earthdawn:ocSetTalentDefault() error caught: " + err );}
}));//end ocSetTalentDefault



  // If this is a brand new PC character sheet (as tested by no languages existing)
  // then create standard skills and inventory
  var checkIfNewPC = function fncheckIfNewPC() {
    'use strict';
    try{
    getAttrs([ "NPC"], function gacheckIfNewPC(values) {
      'use strict';
      if ( values[ "NPC" ] === "0" ) { //Check If PC was selected
        getSectionIDs("repeating_skilll", function(idArray) {
          if( idArray.length === 0 ) {
            var newRow = {};
            newRow["LS-Speak-Rank"] = "2";
            newRow["LS-ReadWrite-Rank"] = "1";
            let newId = generateRowIdNoUnderscore();
            let newInfo = buildPre( "SKL", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Dwarf: (Throalic)";
            newRow[newInfo + "Speak"] = "1";
            newRow[newInfo + "ReadWrite"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "SKL", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Speak"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Adventurer's Kit";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "14";
            newRow[newInfo + "Notes"] = "backpack, bedroll,flint & steel, torch, waterskin, large sack";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Artisan's Tool";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "3";
            newRow[newInfo + "Notes"] = "relevant to characters Artisan skill; needs gamemaster approval";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Traveller's Garb";
            newRow[newInfo + "Qty"] = "1";
            newRow[newInfo + "Carried"] = "1";
            newRow[newInfo + "UnitWeight"] = "3";
            newRow[newInfo + "Notes"] = "soft boots, shirt, belt,robe or breeches, travelers cloak";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "WPN", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Dagger";
            newRow[newInfo + "CombatSlot"] = "0";
            newRow[newInfo + "Rank"] = "2";
            newRow[newInfo + "Effective-Rank"] = "2";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "INV", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Name"] = "Dagger";
            newRow[newInfo + "Weight"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "ARM", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Type"] = "1";
            newRow[newInfo + "Type_max"] = "1";
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "ARM", newId );
            newRow[newInfo + "RowID"] = newId;
            newRow[newInfo + "Type"] = "-1";
            newRow[newInfo + "Type_max"] = "1";
            newRow["Wealth_Silver"] = "100";
            newRow["LS-Speak-Rank"] = "2";
            newRow["LS-ReadWrite-Rank"] = "1";
            setAttrsLog(newRow, undefined,function fnAfterNewPC(tarray) {
              repeatingSum("Cont1-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried1"]  );
              repeatingSum("Cont2-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried2"]  );
              repeatingSum("Cont3-Weight", "Inventory",["INV_UnitWeight","INV_Qty","INV_Carried3"]  );
              UpdateCarried();
            });
          }
        });
      };
    });
  } catch(err) {log("Earthdawn:checkIfNewPC() error caught: " + err );}
}; // End checkIfNewPC()
  //called on change of NPC
  on("change:npc", fn(checkIfNewPC));



  // Update character sheet from a previous version to the current version.
  // showNotes -1: new sheet so show welcome message, 0: Nothing, 1: show latest version notes.
  var updateCharactersheet = function fnUpdateCharactersheet( newSheetVersion, fromSheetVersion, origSheetVersion, recurse, values, showNotes, notes , flags) {
    'use strict';
    try{
    log("EarthDawn : UpdateCharacterSheet : Conversion to: " + newSheetVersion + " from: " + fromSheetVersion + " orig: " + origSheetVersion + " recurse: " +recurse );
    let vals = [];
    let newflags=flags;
    let toSheetVersion;

    if( isNaN( fromSheetVersion) || fromSheetVersion === 0 ) {  // v0 This is a blank new sheet. We want to initialize a certain number of stuff
      let newId = generateRowIdNoUnderscore();
      let newInfo = buildPre( "DSP", newId );
      vals[newInfo + "RowID"] = newId;
      // vals[newInfo + "Code"] = "0.0";
      // vals[newInfo + "Name"] = "None";
      // vals[newInfo + "Durability" ] = "0";
      vals[newInfo + "Circle"] = "1";
      vals["CreationMode"] = "1";

      var newNotes = "Earthdawn by FASA Character Sheet version: " + newSheetVersion + " by Chris Dickey and JB Faure.\n\n"
      + "Welcome to the Earthdawn character sheet.\n"
      + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
      + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n\n"
      + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set(WIKI Section 4.1.2).\n"
      + "Go to the Overview tab to first set the Name of your character and whether it is a PC or NPC \n"
      + "you can then create it step by step, or for NPC import its statistics directly from the SourceBooks.\n"
      +" Be sure to provide a Token and link it using the character sheet functions in Adjust. "
      + "See the help file for more details. \n\n";
      // Comment this line out if not to change tab to force release notes visible.
      //      showNotes = (showNotes === -1) ? -1 : 1;

      setAttrsLog( vals, undefined, function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, newSheetVersion, origSheetVersion, recurse + 1, values, -1, newNotes, newflags);        // Recursively call this routine to finalize, but will end the recursion
      });
    } // End ver 0.000 New Character
    /*
    */
    // There is currently nothing to update in the 1.0002 version, so this would just skip
    else if( fromSheetVersion < 1.0002 ) {
      toSheetVersion = 1.0002;
      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n\n"
      // Note: Put update stuff here.
      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
      setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      });
      else
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    } // End ver 1.002
    /*
    */
    else {
      if( fromSheetVersion < 2.0 ) {
        toSheetVersion = 2.0;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "This is a complete New Version with some new design and features. Read the Wiki:\n\n"
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- A new Legend Point tracking is available. It inspects all your ranks and increases and calculates your LP Total. For an imported character, you need to set the offset corresponding to your creation Free Ranks (See Wiki Section 2.8.1)\n"
        + "- Display of Steps and temporary modifiers has been improved. There is now an imporant difference between temporary modifiers (that will be highlighted in the Step) and permanent adjustments (that will be blended in the value)\n"
        + "  Think about reviewing them to better differentiate temporary effects of spells, potions, situations ...etc\n"
        + "- Automatic filling of Discipline parameters (PD, MD, SD, MA), and most Talent parameters as per the Ed4 PG. No need to edit manually anymore\n"
        + "- Inventory Management is now via a reperating list instead of a text field, and offers container management\n"
        + "- Spell Sequence was completely redesigned. It now suggests the next step, but let's you bypass any of the steps of the sequence\n"
        + "  It also supports Grimoire Casting, Attuning on the Fly, and Raw Magic (including Warp damage and Horror Mark tests)\n"
        + "- 2 different modes for Legend Tracking. See the Wiki\n"
        + "- Sheet is now PRINTABLE (with compatible browsers like Chrome). Pop-out the character sheet (Roll20 button with the 2 squares), and print.\n"
        + "- Blood Magic is now via a reperating list instead of a number field. A dummy bloodcharm has been created for you\n"
        + "- Give a Name to your Mounts and Companions !\n"
        + "- New Day Button refills your recovery Tests, and Makes your Karma Ritual. Selector for Homerule in Adjustment\n"
        + "- Creature/Opponent Custom Maneuver are now a repeating list. No limit to 3 anymore. Old ones are imported\n"
        + "- SpellCasting Talents are now directly in the list of other Talents\n"
        + "- LINKS function has been extended. Links allow to automatically add another value to the Rank of A Talent, Knack, Skill or Weapon\n"
        + "- You can now link also from Talents and Matrix, and link to a discipline. Use links to Disciplines for Free Talents and Matrix\n"
        + "  They are practical for Knacks, Talent combos, Free Talents (linking to Circle), Thread Items special properties...\n"
        + "- Your existing links have been converted EXCEPT links from KNACK to KNACK\n"
        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = ["Misc-IP-Buff","Wound-Threshold-Buff", "Wound-Threshold-Adjust","Damage-Death-Rating-Adjust","Health-Buff", "Damage-Unconscious-Adjust","Armor-Weight","Description-notes", "Misc-Aggressive-Penalty","Misc-Aggressive-Strain", "character_name", "Damage-Blood-Magic", "Misc-Initiative-Buff", "Creature-Custom1Name", "Creature-Custom1Desc", "Creature-Custom2Name", "Creature-Custom2Desc", "Creature-Custom3Name", "Creature-Custom3Desc", "Opponent-Custom1Name", "Opponent-Custom1Desc", "Opponent-Custom2Name", "Opponent-Custom2Desc", "Opponent-Custom3Name", "Opponent-Custom3Desc", "Opponent-Custom1Show", "Opponent-Custom2Show","Opponent-Custom3Show", "SKL_TotalS-Speak", "SKL_TotalT-Speak", "SKL_TotalS-ReadWrite", "SKL_TotalT-ReadWrite","Karma_max","Race","Misc-PoolName-1","Misc-PoolValue-1","Misc-Pool-Name-2","Misc-Pool-Value-2","Misc-Pool-Name-3","Misc-Pool-Value-3","LifeStyle","LifeStyle-Adjust","LifeStyle-Prepaid"];

        let i = 0, j=0, pre,newId,newInfo,linkArray;
        let sp = ["Spellcasting", "Patterncraft", "Elementalism", "Illusionism", "Nethermancy", "Shamanism", "Wizardry", "Power", "Willforce"];
        let spsuff=["Rank", "Rank-Mods", "Type", "Mods"];
        let sprid ={};
        let rowflags;

        for( i = 0; i < sp.length; i++ ) {
          for   ( j = 0; j < spsuff.length; j++ )
          getV.push( "SP-" + sp[i ] + "-" + spsuff[j]);
        }
        getSectionIDs("repeating_talents", function gsUpdateCharacterSheetIdTalents(tarray) {
          'use strict';
          for( i = 0; i < tarray.length; i++ ) {
            pre = buildPre( "T", tarray[ i ]);
            getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods", pre + "Parameters", pre+"Type", pre+"Karma-Control"]);
          }
          getSectionIDs("repeating_knacks", function gsUpdateCharacterSheetIdKnacks(karray) {
            'use strict';
            for( i = 0; i < karray.length; i++ ) {
              pre = buildPre( "NAC", karray[ i ]);
              getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods" , pre + "Parameters", pre+"Type", pre+ "Linked", pre+"Karma-Control"]);
            }
            getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
              'use strict';
              for( i = 0; i < skarray.length; i++ ) {
                pre = buildPre( "SK", skarray[ i ]);
                getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "NotMoveBased", pre + "NotVisionBased", pre + "Attribute", pre + "Mod-Type", pre + "Rank-Mods", pre + "Parameters", pre+"Type", pre+"Karma-Control"]);
              }
              getSectionIDs("repeating_skilla", function gsUpdateCharacterSheetIdSkillsArtisan(skaarray) {
                'use strict';
                for( i = 0; i < skaarray.length; i++ ) {
                  pre = buildPre( "SKA", skaarray[ i ]);
                  getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Mods", pre + "Rank", pre + "Attribute", pre + "RollType", pre + "RollType", pre + "CombatSlot", pre + "Parameters"]);
                }
                getSectionIDs("repeating_skillk", function gsUpdateCharacterSheetIdSkillsKnow(skkarray) {
                  'use strict';
                  for( i = 0; i < skkarray.length; i++ ) {
                    pre = buildPre( "SKK", skkarray[ i ]);
                    getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Mods", pre + "Rank",  pre + "RollType", pre + "RollType", pre + "CombatSlot", pre + "Parameters"]);
                  }
                  getSectionIDs("repeating_inventory", function gsUpdateCharacterSheetIdInventory(iarray) {
                    'use strict';
                    for( i = 0; i < iarray.length; i++ ) {
                      pre = buildPre( "I", iarray[ i ]);
                      getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Qty", pre + "Carried", pre + "UnitWeight", pre + "Notes"]);
                    }
                    getSectionIDs("repeating_weapons", function gsUpdateCharacterSheetIdInventory(warray) {
                      'use strict';
                      for( i = 0; i < warray.length; i++ ) {
                        pre = buildPre( "WPN", warray[ i ]);
                        getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Base"]);
                      }
                      getSectionIDs("repeating_spell", function gsUpdateCharacterSheetIdSpell(sarray) {
                        'use strict';
                        for( i = 0; i < sarray.length; i++ ) {
                          pre = buildPre( "SP", sarray[ i ]);
                          getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Range", pre + "AoE", pre + "Duration"]);
                        }
                        getSectionIDs("repeating_matrix", function gsUpdateCharacterSheetIdMatrix(marray) {
                          'use strict';
                          for( i = 0; i < marray.length; i++ ) {
                            pre = buildPre( "SPM", marray[ i ]);
                            getV = _.union( getV, [ pre + "RowID", pre + "Origin", pre+"Type"]);
                          }
                          getSectionIDs("repeating_threads", function gsUpdateCharacterSheetIdThreads(tiarray) {
                            'use strict';
                            for( i = 0; i < tiarray.length; i++ ) {
                              pre = buildPre( "TI", tiarray[ i ]);
                              getV = _.union( getV, [ pre + "Effects"]);
                            }

                            getSectionIDs("repeating_mount", function gsUpdateCharacterSheetIdMounts(mntarray) {
                              'use strict';
                              for( i = 0; i < mntarray.length; i++ ) {
                                pre = buildPre( "MNT", mntarray[ i ]);
                                getV = _.union( getV, [ pre + "Name"]);
                              }

                          getAttrs( getV , function gaUpdateCharacterSheet(values) {
                            'use strict';

                            function updateRow( code, rid, flags)  {
                              if(rid && rid.length<4) log("updateCharacterSheet incorrect rowid: " +rid+ "     code: "+code);
                              pre = buildPre( code, rid);
                              rowflags=flags;
                              vals[pre + "Name"]= values[pre + "Name"]+"";     //Name is overwritten to trigger Autofill. Adding a charcter 192 will trigger a change, and the sanitize should do the rest
                              vals[pre + "MoveBased"]= 1-getInt(values, pre + "NotMoveBased");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"NotMoveBased" );
                              vals[pre + "VisionBased"]= 1-getInt(values, pre + "NotVisionBased");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"NotVisionBased" );
                              vals[pre + "Rank-Adjust"]= getInt(values, pre + "Rank-Mods");
                              rowflags=addAPIflag( rowflags, "RemoveAttr", pre+"Rank-Mods" );
                              if(values[pre+"Karma-Control"]=="-1") vals[pre+"Karma-Limit_max"]=0;
                              vals[pre + "Parameters"]= "0";
                              if (values[pre + "Type"]==="Versatility") vals[pre + "Type"] = "V-Novice";
                              if (values[pre + "Type"].startsWith("F1-")) vals[pre + "Type"] = "Novice"; //Correct bug created by API
                              switch (values[pre + "Attribute"]){
                                case "(@{Dex-Step}+@{Dex-Adjust}+@{Dex-Mods})" : vals[pre + "Attribute"] = "Dex"; break ;
                                case "(@{Str-Step}+@{Str-Adjust}+@{Str-Mods})" : vals[pre + "Attribute"] = "Str"; break ;
                                case "(@{Tou-Step}+@{Tou-Adjust}+@{Tou-Mods})" : vals[pre + "Attribute"] = "Tou"; break ;
                                case "(@{Per-Step}+@{Per-Adjust}+@{Per-Mods})" : vals[pre + "Attribute"]= "Per"; break ;
                                case "(@{Wil-Step}+@{Wil-Adjust}+@{Wil-Mods})" : vals[pre + "Attribute"]= "Wil"; break ;
                                case "(@{Cha-Step}+@{Cha-Adjust}+@{Cha-Mods})" : vals[pre + "Attribute"]= "Cha"; break ;
                                default: vals[pre + "Attribute"]= "0";
                              }
                              switch (values[pre + "Mod-Type"]){
                                case "0"                                          : vals[pre + "Mod-Type"] = "0"; break ;
                                case "@{Adjust-All-Tests-Total}"                  : vals[pre + "Mod-Type"] = "Action"; break ;
                                case "@{Adjust-Effect-Tests-Total}"               : vals[pre + "Mod-Type"] = "Effect"; break ;
                                case "@{Adjust-Attacks-Total}"                    : vals[pre + "Mod-Type"] = "Attack"; break ;
                                case "@{Adjust-Attacks-Total-CC}"                 : vals[pre + "Mod-Type"] = "Attack CC"; break ;
                                case "@{Adjust-Damage-Total}"                     : vals[pre + "Mod-Type"] = "Damage"; break ;
                                case "@{Adjust-Damage-Total-CC}"                  : vals[pre + "Mod-Type"] = "Damage CC"; break ;
                                case "@{Adjust-All-Tests-Total}+(-1*@{IP})"       : vals[pre + "Mod-Type"] = "Init"; break ;
                                case "@{Adjust-All-Tests-Total}+(-1*@{Armor-IP})" : vals[pre + "Mod-Type"] = "Armor IP"; break ;
                                case "(0)"                                        : vals[pre + "Mod-Type"] = "(0)"; break ;
                                default : vals[pre + "Mod-Type"]= "Action"; //If never set, it remained as Action
                              }
                              return rowflags;
                            };
                            //Other changes that need to be done

                            //Spell Talents
                            for( i = 0; i < sp.length; i++ ) if(getInt(values,"SP-" + sp[i] + "-Rank")>0 || getInt(values,"SP-" + sp[i] + "-Rank-Mods")>0 || getInt(values,"SP-" + sp[i] + "-Mods")>0)  {
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "T", newId );
                              vals[newInfo + "RowID"] = newId;
                              sprid[sp[i]]=newId;
                              pre="SP-" + sp[i] + "-";
                              vals[newInfo + "CombatSlot"] = 1;
                              vals[newInfo + "Name"] = sp[i];
                              vals[newInfo + "Parameters"]= "0";
                              if( sp[i]=="Willforce") vals[newInfo + "Mod-Type"]= "Effect"; else vals[newInfo + "Mod-Type"]= "Action";
                              if (values[pre + "Rank"]) vals[newInfo + "Rank"] = values[pre + "Rank"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Rank" );
                              if (values[pre + "Rank-Mods"]) vals[newInfo + "Rank-Adjust"] = values[pre + "Rank-Mods"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Rank-Mods" );
                              if (values[pre + "Mods"]) vals[newInfo + "Mods"] = values[pre + "Mods"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Mods" );
                              if( sp[i]=="Willforce") vals[newInfo + "Attribute"]= "Wil"; else vals[newInfo + "Attribute"]= "Per";
                              if( sp[i]=="Willforce") vals[newInfo + "Target"]= "None";;
                              if (values[pre + "Type"]) vals[newInfo + "Type"] = "D1"+values[pre + "Type"];
                              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Type" );
                              if( sp[i]=="Willforce") vals[newInfo + "Action"]= "Free"; else vals[newInfo + "Action"]= "Standard";
                              if( sp[i]=="Willforce") vals[newInfo + "Strain"]= "1"; else vals[newInfo + "Strain"]= "0";
                              vals[newInfo + "Special"]= "SPL-" + sp[i];
                              if( sp[i]=="Spellcasting")
                              {
                                newId = generateRowIdNoUnderscore();
                                newInfo = buildPre( "T", newId );
                                vals[newInfo + "RowID"] = newId;
                                vals[newInfo + "Name"] = "Wil";
                                vals[newInfo + "Mod-Type"]= "Effect";
                                vals[newInfo + "Attribute"]= "Wil";
                                vals[newInfo + "Action"]= "Free";
                                vals[newInfo + "Special"]= "SPL-Willforce";
                                vals[newInfo + "Type"] ="Special";
                                vals[newInfo + "Target"] ="None";
                                vals[newInfo + "Karma-Limit_max"] ="0";
                                vals[newInfo + "Karma"] ="0";
                                vals[newInfo + "Parameters"]= "0";
                                vals[newInfo + "Notes"]= "This is a dummy Talent, that holds the willpower value that will be used for Spell Effect Tests. Do Not delete except if character is a non-spellcaster";
                              }
                            }

                            //Talents
                            for( i = 0; i < tarray.length; i++ ){
                              newflags=updateRow( "T", tarray[i],newflags);
                            };

                            //Knacks
                            for( i = 0; i < karray.length; i++ ){
                              newflags=updateRow( "NAC", karray[i],newflags);

                              let prev=buildPre("NAC", karray[i]), //vandalized
                              pre=buildPre("NAC",values[prev+"RowID"]); //non vandalized
                              let links = values[prev+"Linked"];
                              if (links){ // This section is for importing links. Up to v2, only Knacks had links and links were unidirectional
                                 log ("links before sanitizing" + links) ;
                                links = links.replace( /[\{|\(|\)|\@|\}]/gi, ""); //Sanitizing.links if it exists is in the form of an autocalc i.e (@{fully_qualifiedname}+@{fully_qualifiedname}). After sanitizing they will be fully_qualifiedname+fully_qualifiedname
                                linkArray=links.split("+");// Now we split the list by +, so we get an array [ fully_qualifiedname,fully_qualifiedname]
                                for(j=0;j<linkArray.length;j++){
                                  if(linkArray[j].startsWith("SP-")){ //Spellcasting Talents were SP-Spellcasting-Effective-Rank
                                    let tal= getParam(linkArray[j],2,"-");
                                    let rid= sprid[tal]; //In v1 Spellcasting talents were hardcoded. We converted them to newly repeating_talents. The rowid was conveniently stored above
                                    if (rid){
                                      newflags=addAPIflag( newflags, "LinkAdd2", "NAC : " + values[prev+"RowID"] + " : T : " + rid); //APIFlag syntax is LinkAdd2,code,rowid,code,rid, the first set being the attribute Getting the value, and the second the one providing

                                    }
                                    else log("EarthDawn UpdateCharacterSheet() Tried to create a link to a non existing spellcasting talent : " + tal);
                                  } else if(linkArray[j].startsWith("repeating")){ //Non Spellcasting Talents are on the repeating_XXX-RowId format
                                    let rid= repeatSection(2,linkArray[j]);
                                    let pre2v=buildPre(repeatSection(3,linkArray[j]),rid.toLowerCase()), // Really don't know why, but we need a vandalized rowid
                                    pre2=buildPre(repeatSection(3,linkArray[j]),rid)
                                    let tal= values[pre2v+"Name"];

                                    if(! tal)  log ("Earthdawn: UpdateCharacterSheet - Tried to create a link to an ability that doesn't exist: " + rid); // This line is to get rid of dead links...
                                    else {if (!linkArray[j].endsWith("Mods") && tal!==undefined && repeatSection(3,linkArray[j])!=="NAC"){ //Links with Talents and Weapons have 2 entries, so one of them has to be skipped

                                      newflags=addAPIflag( newflags, "LinkAdd2", "NAC : " + values[prev+"RowID"] + " :" +repeatSection(3,linkArray[j]) + " : " + values[pre2v+"RowID"]); //APIFlag syntax is LinkAdd2,code,rowid,code,rid, the first set being the attribute Getting the value, and the second the one providing

                                    }
                                  }
                                }
                              }
                            }
                            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Linked" );
                            newflags=addAPIflag( newflags, "RemoveAttr", pre+"LinkDisplay" );
                          };
                          if(i>0) vals["show_repeating_links"]="1"; //If there was a Knack, we need links, so we want to display them

                          //Skills
                          for( i = 0; i < skarray.length; i++ ){
                            newflags=updateRow( "SK", skarray[i],newflags);
                            if (values[pre + "Type"]!=="Journeyman" && values[pre + "Type"]!=="Warden" && values[pre + "Type"]!=="Master")
                              vals[pre + "Type"] = "Novice"; //Corrects a bug in the API that put invalid values in SK_Type
                          };
                          for( i = 0; i < skaarray.length; i++ ){
                            pre = buildPre( "SKA", skaarray[ i ]);
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "SK", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Category"] = "Artisan";
                            vals[newInfo + "Parameters"]= "0";
                            if(values[pre +"Name"]) vals[newInfo + "Name"]=values[pre+ "Name"];
                            if(values[pre +"Mods"]) vals[newInfo + "Rank-Adjust"]=values[pre+ "Mods"];
                            if(values[pre +"Rank"]) vals[newInfo + "Rank"]=values[pre+ "Rank"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"CombatSlot"]) vals[newInfo + "CombatSlot"]=values[pre+ "CombatSlot"];
                            switch (values[pre + "Attribute"]){
                              case "(@{Dex-Step}+@{Dex-Adjust}+@{Dex-Mods})" : vals[newInfo + "Attribute"] = "Dex"; break ;
                              case "(@{Str-Step}+@{Str-Adjust}+@{Str-Mods})" : vals[newInfo + "Attribute"] = "Str"; break ;
                              case "(@{Tou-Step}+@{Tou-Adjust}+@{Tou-Mods})" : vals[newInfo + "Attribute"] = "Tou"; break ;
                              case "(@{Per-Step}+@{Per-Adjust}+@{Per-Mods})" : vals[newInfo + "Attribute"]= "Per"; break ;
                              case "(@{Wil-Step}+@{Wil-Adjust}+@{Wil-Mods})" : vals[newInfo + "Attribute"]= "Wil"; break ;
                              case "(@{Cha-Step}+@{Cha-Adjust}+@{Cha-Mods})" : vals[newInfo + "Attribute"]= "Cha"; break ;
                              default: vals[pre + "Attribute"]= "Cha";
                            }
                            newflags=addAPIflag( newflags, "RemoveRow", "SKA,"+skaarray[ i ] );
                          };

                          for( i = 0; i < skkarray.length; i++ ){
                            pre = buildPre( "SKK", skkarray[ i ]);
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "SK", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Category"] = "Knowledge";
                            vals[newInfo + "Parameters"]= "0";
                            if(values[pre +"Name"]) vals[newInfo + "Name"]=values[pre+ "Name"];
                            if(values[pre +"Mods"]) vals[newInfo + "Rank-Adjust"]=values[pre+ "Mods"];
                            if(values[pre +"Rank"]) vals[newInfo + "Rank"]=values[pre+ "Rank"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"RollType"]) vals[newInfo + "RollType"]=values[pre+ "RollType"];
                            if(values[pre +"CombatSlot"]) vals[newInfo + "CombatSlot"]=values[pre+ "CombatSlot"];
                            vals[newInfo + "Attribute"] = "Per";
                            newflags=addAPIflag( newflags, "RemoveRow", "SKK,"+skkarray[ i ] );
                          };

                          // Thread Items
                          for( i = 0; i < tiarray.length; i++ ){
                            pre = buildPre( "TI", tiarray[ i ]);
                            if(values[pre +"Effects"]){
                             vals[pre + "Description"]=values[pre+ "Effects"];
                             vals[pre + "Effects"]="";}
                           };


                          //Misc
                          if(values["character_name"]) vals["charName"]=values["character_name"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "character_name" );

                          if(values["Description-notes"]) vals["general-notes-2"]=values["Description-notes"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Description-notes" );

                          if(values["Armor-Weight"]) vals["Armor-Wght"]=values["Armor-Weight"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Armor-Weight" );

                          if(getInt(values,"Race")>9) vals["Misc-Karma-max-Adjust"]=getInt(values,"Karma_max");

                          vals["KarmaGlobalMode"]="?";

                          if(values["Misc-PoolName-1"]!==undefined||values["Misc-PoolValue-1"]!==undefined||values["Misc-Pool-Name-2"]!==undefined||values["Misc-Pool-Value-2"]!==undefined||values["Misc-Pool-Name-3"]!==undefined||values["Misc-Pool-Value-3"]!==undefined){
                            vals["show_overview_miscpool"]="1";
                            //vals["show_combat_miscpool"]="1";
                          }
                          if(values["LifeStyle"]!==undefined||values["LifeStyle-Adjust"]!==undefined||values["LifeStyle-Prepaid"]!==undefined) vals["show_lifestyle"]="1";

                          if(mntarray.length>0) vals["show_mounts"]="1";


                          //Blood Magic
                          if (getInt(values, "Damage-Blood-Magic") !="0"){
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "BL", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Name"] = "Misc Blood Charm";
                            vals[newInfo + "Damage-Blood-Magic"] = getInt(values, "Damage-Blood-Magic");
                            vals[newInfo + "Effects"] = "Line created automatically during import to sheet rev2";
                            vals["show_blood"]="1";
                          };
                          if(values["Misc-Initiative-Buff"]) vals["Initiative-Mods"]=values["Misc-Initiative-Buff"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Initiative-Buff" );

                          if(values["Misc-Aggressive-Penalty"]) vals["Misc-AggStance-Penalty"]=values["Misc-Aggressive-Penalty"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Aggressive-Penalty" );

                          if(values["Misc-Aggressive-Strain"]) vals["Misc-AggStance-Strain"]=values["Misc-Aggressive-Strain"];
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Aggressive-Strain" );

                          vals["Damage-Unconscious-Adjust"]=getInt(values,"Damage-Unconscious-Adjust")+getInt(values,"Health-Buff");
                          vals["Damage-Death-Rating-Adjust"]=getInt(values,"Damage-Death-Rating-Adjust")+getInt(values,"Health-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Health-Buff" );

                          vals["Recovery-Adjust"]=getInt(values,"Recovery-Adjust")+getInt(values,"Recovery-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Recovery-Buff" );

                          vals["Wound-Threshold-Adjust"]=getInt(values,"Wound-Threshold-Adjust");

                          vals["Misc-IP-Mod"]=getInt(values,"Misc-IP-Buff");
                          newflags=addAPIflag( newflags, "RemoveAttr", "Misc-IP-Buff" );

                          //Maneuvers
                          for( i = 1; i < 4; i++ ){
                            if(values["Creature-Custom"+ i.toString() + "Name"]   || values["Creature-Custom"+ i.toString() + "Desc"]  ){
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "MAN", newId );
                              vals[newInfo + "RowID"] = newId;
                              if (values["Creature-Custom"+ i.toString() + "Name"]) vals[newInfo + "Name"] = values["Creature-Custom"+ i.toString() + "Name"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Creature-Custom"+ i.toString() + "Name" );
                              if (values["Creature-Custom"+ i.toString() + "Desc"]) vals[newInfo + "Desc"] = values["Creature-Custom"+ i.toString() + "Desc"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Creature-Custom"+ i.toString() + "Desc" );
                              vals[newInfo + "Type"] = "1";
                            }
                            if(values["Opponent-Custom"+ i.toString() + "Name"]   || values["Opponent-Custom"+ i.toString() + "Desc"]  ){
                              newId = generateRowIdNoUnderscore();
                              newInfo = buildPre( "MAN", newId );
                              vals[newInfo + "RowID"] = newId;
                              if (values["Opponent-Custom"+ i.toString() + "Name"]) vals[newInfo + "Name"] = values["Opponent-Custom"+ i.toString() + "Name"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Opponent-Custom"+ i.toString() + "Name" );
                              if (values["Opponent-Custom"+ i.toString() + "Desc"]) vals[newInfo + "Desc"] = values["Opponent-Custom"+ i.toString() + "Desc"];
                              newflags=addAPIflag( newflags, "RemoveAttr", "Opponent-Custom"+ i.toString() + "Desc" );
                              vals[newInfo + "Type"] = "-1";
                            }
                          };


                          //JBF@CD : this is only to be able to import my own game. Can be deleted afterwards
                          for( i = 0; i < iarray.length; i++ ){
                            pre = buildPre( "I", iarray[ i ]);
                            let pre2 = buildPre( "INV", iarray[ i ]);
                            if(values[pre + "Name"]) vals[pre2 + "Name"]= values[pre + "Name"];
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Name" );
                            if (getInt(values, pre + "Qty")) vals[pre2 + "Qty"]= getInt(values, pre + "Qty");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Qty" );
                            if(getInt(values, pre + "Carried")) vals[pre2 + "Carried"]= getInt(values, pre + "Carried");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Carried" );
                            if(getInt(values, pre + "UnitWeight")) vals[pre2 + "UnitWeight"]= getInt(values, pre + "UnitWeight");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "UnitWeight" );
                            if(values[pre + "Notes"])  vals[pre2 + "Notes"]= values[pre + "Notes"];
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Notes" );
                          };

                          //Spells
                          for( i = 0; i < sarray.length; i++ ){
                            pre = buildPre( "SP", sarray[ i ]);
                            if (values[pre+"Range"]) spellsanitize(pre+"Range", values[pre+"Range"]);
                            if (values[pre+"AoE"]) spellsanitize(pre+"AoE", values[pre+"AoE"]);
                            if (values[pre+"Duration"]) spellsanitize(pre+"Duration", values[pre+"Duration"]);
                            if (! values[pre+"Casting"] || values[pre+"Casting"]==="MDh") vals[pre + "Casting"]= "MD1: @{target|Target|token_id}"; //JBF Spells default now to MD1 and not hMD
                          };

                          //Matrix
                          for( i = 0; i < marray.length; i++ ){
                            pre = buildPre( "SPM", marray[ i ]);
                            if (values[pre+"Origin"]==="Free") vals[pre + "Origin"]="Free-link";
                            if (values[pre+"Origin"]==="Item") vals[pre + "Origin"]="Item-link";
                            if (values[pre + "Type"]==="Versatility") vals[pre + "Type"] = "V-Novice";
                          };

                          //Weapon
                          for( i = 0; i < warray.length; i++ ){
                            pre = buildPre( "WPN", warray[ i ]);
                            if (getInt(values, pre + "Base")) vals[pre + "Rank"]= getInt(values, pre + "Base");
                            newflags=addAPIflag( newflags, "RemoveAttr", pre + "Base" );
                          };

                          //Languages
                          if(getInt(values,"SKL_TotalS-Speak")>0) vals["LS-Speak-Rank"]=getInt(values,"SKL_TotalS-Speak");
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalS-Speak" );
                          if(getInt(values,"SKL_TotalS-ReadWrite")>0) vals["LS-ReadWrite-Rank"]=getInt(values,"SKL_TotalS-ReadWrite");
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalS-ReadWrite" );
                          if(getInt(values,"SKL_TotalT-Speak")>0) {
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "T", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Name"] = "Speak Language";
                            vals[newInfo + "Rank"] = getInt(values,"SKL_TotalT-Speak");
                            vals[newInfo + "Attribute"] = "Per";
                            vals[newInfo + "Target"] = "None";
                            vals[newInfo + "Strain"] = "1";
                          };
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalT-Speak" );
                          if(getInt(values,"SKL_TotalT-ReadWrite")>0) {
                            newId = generateRowIdNoUnderscore();
                            newInfo = buildPre( "T", newId );
                            vals[newInfo + "RowID"] = newId;
                            vals[newInfo + "Name"] = "Read Write Language";
                            vals[newInfo + "Rank"] = getInt(values,"SKL_TotalT-ReadWrite");
                            vals[newInfo + "Attribute"] = "Per";
                            vals[newInfo + "Target"] = "None";
                            vals[newInfo + "Strain"] = "1";
                          };
                          newflags=addAPIflag( newflags, "RemoveAttr", "SKL_TotalT-ReadWrite" );

                          vals["Defense-Phys-Nat-Auto-Adjust"] = "-1"; //Dirty trick to tell to CountDiscipline it needs to offset the various -Adjust values from the -Auto-Adjust due to import

                          newflags=addAPIflag( newflags, "WipeMatrix",Math.random()); //This is used o Wipe all the Matrix to get rid of obsolete Token Actions

                          // setAttrsLog( vals );

                          if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
                          setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
                            'use strict';
                            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
                          });
                          else{
                            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
                          }
                        });
                      });
                    });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    } // End ver 2.000

    else  if( fromSheetVersion < 2.03 ) {
      toSheetVersion = 2.03;
      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
      // Note: Put update stuff here.
      + "- Data entry for Talents and Skills just got easier ! You can still import by pasting extract from the PDFs, but you can now type the first letters of the name, and a dropdown list will appear. Autofill will then fill all except the description (for obvious I.P. reasons)\n"
      + "- Knacks-Report !! Go to the Knack Tab, and edit, and you will be able to generate a report of the Knacks you can presently buy, or set a value for the rank/circle of all your Disciplines and Talents, and check the knacks available when you reach it\n"
      + "- Default value for sheet parameters can now be set from your roll20 Game Settings. This allows you to set campaign wide parameters for sheet display or some homerules. See roll20 documentation on how to extend parameters to existing sheets.\n"
      + "- LP Summary now calculates the costs of joining a path or becoming a questor, and offers fields for multi-disciplining costs (when joining before Circle 5)\n"
      + "- Questors and Path now also benefit from automatic calculation of their adjustments... Note that if you had some existing adjustments you may need to remove them to avoid double counting!!\n"
      + "- Various Bug Fixes\n"

      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
      setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      });
      else
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    } // End ver 2.03


    else  if( fromSheetVersion < 2.04 ) {
      toSheetVersion = 2.04;

      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
      // Note: Put update stuff here.
      + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
      + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
      + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
      + "- Character Creation and multi-disciplining got easier. Click the Add C1 Talents button and get your starting talents prefilled\n"
      + "   Multidisciplining LP Costs will be posted in the automatic calculation\n"
      + "- Set the default values for various visualization and Optional/Home Rules from the roll20 Game Settings\n"
      + "- Blood Elves added as playable race as per Elven Nation Game Information\n"
      + "- Added Karma Modifier Adjustment in order to give all tool to implement DragonKin\n"
      + "- Various Bug Fixes\n"
      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      let getV = ["Race","Armor-Wght"];
      let i,pre;


      getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
        'use strict';
        for( i = 0; i < skarray.length; i++ ) {
          pre = buildPre( "SK", skarray[ i ]);
          getV = _.union( getV, [pre+"Type",pre+"Name"]);
        }
        getSectionIDs("repeating_discipline", function gsUpdateCharacterSheetIdDiscipline(darray) {
          'use strict';
          for( i = 0; i < darray.length; i++ ) {
            pre = buildPre( "DSP", darray[ i ]);
            getV = _.union( getV, []);
          }

          getAttrs( getV , function gaUpdateCharacterSheet(values) {
            'use strict';
            //Races
            switch(values["Race"]){
              case "1" : vals["Race"]= "Dwarf"; break;
              case "2" : vals["Race"]= "Elf";break;
              case "3" : vals["Race"]= "Human";break;
              case "4" : vals["Race"]= "Obsidiman";break;
              case "5" : vals["Race"]= "Ork";break;
              case "6" : vals["Race"]= "Troll";break;
              case "7" : vals["Race"]= "Tskrang";break;
              case "8" : vals["Race"]= "Windling";break;
              case "99" : vals["Race"]= "Other";break;
              default : vals["Race"]="None";
            }

            if(values["Armor-Wght"]) vals["Armor-Weight"]=values["Armor-Wght"];
            newflags=addAPIflag( newflags, "RemoveAttr", "Armor-Wght" );


            //Skills
            for( i = 0; i < skarray.length; i++ ){
              pre = buildPre( "SK", skarray[ i ]);
              if (values[pre + "Type"]!=="Journeyman" && values[pre + "Type"]!=="Warden" && values[pre + "Type"]!=="Master"){
                vals[pre + "Type"] = "Novice"; //Corrects a bug in the API that put invalid values in SK_Type
              }
            };

            for( i = 0; i < darray.length; i++ ){
              pre = buildPre( "DSP",darray[ i ]);
              vals[pre + "show-createbutton"] = 0;
            };

              if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
              setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
                'use strict';
                updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
              });
              else{
                updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
              }
            });
          });
        });
      } // End ver 2.04

      else  if( fromSheetVersion < 2.05 ) {
        toSheetVersion = 2.05;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- Autofill database has now the Questor Devotions\n"
        + "- Bug fix : Autofill will not set the attribute for creatures because ib the book format for importing the Rank is directly the Step\n"

        + "- Various Bug Fixes\n"
        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = ["Hide-Spells-tab"];
        let i,pre;



            getAttrs( getV , function gaUpdateCharacterSheet(values) {
              'use strict';

              // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
              // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
              // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
              // log("corrected Hide-Spells-Tab bug ");




        if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
        setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
          'use strict';
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        });
        else{
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        }

      });
        } // End ver 2.05

        else  if( fromSheetVersion < 2.06 ) {
          toSheetVersion = 2.06;

          var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
          // Note: Put update stuff here.
          + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
          + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
          + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
          + "- Added Support for Ammo Weight and Quantity\n"
          + "- Corrected Range of the ShortBow\n"
          + "- Corrected the LP Calculation for Versatility \n"
          + "- Various Bug Fixes\n"
          + notes;
          // Comment this line out if not to change tab to force release notes visible.
          showNotes = (showNotes === -1) ? -1 : 1;

          let getV = [""];
          let i,pre;



              getAttrs( getV , function gaUpdateCharacterSheet(values) {
                'use strict';

                // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
                // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
                // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
                // log("corrected Hide-Spells-Tab bug ");




          if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
          setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
            'use strict';
            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
          });
          else{
            updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
          }

        });
      } // End ver 2.06

      else  if( fromSheetVersion < 2.07 ) {
        toSheetVersion = 2.07;

        var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
        // Note: Put update stuff here.
        + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
        + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
        + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
        + "- Reviewed the Autofill database for movement based and sight based... Note that these are no official ruling though, so up to GM interpretation\n"

        + notes;
        // Comment this line out if not to change tab to force release notes visible.
        showNotes = (showNotes === -1) ? -1 : 1;

        let getV = [""];
        let i,pre;



            getAttrs( getV , function gaUpdateCharacterSheet(values) {
              'use strict';

              // log("Hide-Spells-Tab" + values["Hide-Spells-tab"]);
              // vals["Hide-Spells-Tab"]=values["Hide-Spells-tab"]||"1";
              // newflags=addAPIflag( newflags, "RemoveAttr", "Hide-Spells-tab" );
              // log("corrected Hide-Spells-Tab bug ");




        if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
        setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
          'use strict';
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        });
        else{
          updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
        }

      });
    } // End ver 2.07

    else if( fromSheetVersion < 3.00 ) {
      toSheetVersion = 3.00;

      var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
      // Note: Put update stuff here.
      + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
      + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
      + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
      + "\n"
      + "- New Version is print friendly (now that the function is available at roll20)... Ready for in person games !\n"
      + "- New Version with Compendium Compatibility !!\n"
      + "- Compendium books will be available from the roll20 marketplace\n"
      + "- With the player's guide, drag and drop talents, skills, spells, equipments ...etc to the sheet to update/add to character\n"
      + "- Look for the (i) button to open the compendium page\n"
      + "- Even without compendium, the Autofill database has been updated to include spells and blood charms. Note that to ensure compendium compatibility, data from other books than the PG have been removed from the database for now\n"
      + "- Armor and Shields are now a repeating section which allows you to equip/unequip and have different configurations\n"
      + "- The Create Talents button near your discipline will create all the discipline talents starting from the last use of the button (or the conversion to current version for existing characters) up to the current circle\n"
      + "- Text Import functions are now available without API\n"
      + "- FASA clarified the Effect/Action definition, making the Resistance test exception useless. Also the exception sight based has been deleted and is now just a token marker\n"

      + notes;
      // Comment this line out if not to change tab to force release notes visible.
      showNotes = (showNotes === -1) ? -1 : 1;

      let getV = ["Questor","Flight","Creature-Ambush","Creature-DiveCharge","Armor-Name","Armor-Phys","Armor-Myst","Armor-IP","Armor-Date","Armor-Weight","Shield-Name","Shield-Phys","Shield-Myst","Shield-IP","Shield-Date","Shield-Weight","Shield-Shatter","SP-Elementalist", "SP-Illusionist", "SP-Nethermancer", "SP-Shaman", "SP-Wizard", "SP-Power" ,"Race"];
      let i,pre,newId,newInfo;

      getSectionIDs("repeating_weapons", function gsUpdateCharacterSheetIdWeapons(warray) {
        'use strict';
        for( i = 0; i < warray.length; i++ ) {
          pre = buildPre( "WPN", warray[ i ]);
          getV = _.union( getV, [ pre + "RowID", pre + "Name", pre + "Weight", pre + "AmmoQty", pre + "AmmoWeight", pre+"Range", pre+"Date"]);
        }
        getSectionIDs("repeating_spell", function gsUpdateCharacterSheetIdSpells(sparray) {
          'use strict';
          for( i = 0; i < sparray.length; i++ ) {
            pre = buildPre( "SP", sparray[ i ]);
            getV = _.union( getV, [  pre + "Discipline"]);
          }
          getSectionIDs("repeating_discipline", function gsUpdateCharacterSheetIdSpells(darray) {
            'use strict';
            for( i = 0; i < darray.length; i++ ) {
              pre = buildPre( "DSP", darray[ i ]);
              getV = _.union( getV, [  pre + "PathName" , pre+"Code", pre+"Durability",pre+"Circle"]);
            }
            getSectionIDs("repeating_talents", function gsUpdateCharacterSheetIdTalents(tarray) {
              'use strict';
              for( i = 0; i < tarray.length; i++ ) {
                pre = buildPre( "T", tarray[ i ]);
                getV = _.union( getV, [  pre + "Mod-Type"]);
              }
              getSectionIDs("repeating_knacks", function gsUpdateCharacterSheetIdKnacks(karray) {
                'use strict';
                for( i = 0; i < karray.length; i++ ) {
                  pre = buildPre( "NAC", karray[ i ]);
                  getV = _.union( getV, [ pre + "Mod-Type"]);
                }
                getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
                  'use strict';
                  for( i = 0; i < skarray.length; i++ ) {
                    pre = buildPre( "SK", skarray[ i ]);
                    getV = _.union( getV, [ pre + "Mod-Type",pre+"Category"]);
                  }


          getAttrs( getV , function gaUpdateCharacterSheet(values) {
            'use strict';

            if(values["Flight"]) vals["Fly_max"]=values["Flight"];
            newflags=addAPIflag( newflags, "RemoveAttr", "Flight" );
            if(values["Creature-Ambush"]) vals["Creature-Ambushing_max"]=values["Creature-Ambush"];
            newflags=addAPIflag( newflags, "RemoveAttr", "Creature-Ambush" );
            if(values["Creature-DiveCharge"]) vals["Creature-DivingCharging_max"]=values["Creature-DiveCharge"];
            newflags=addAPIflag( newflags, "RemoveAttr", "Creature-DiveCharge" );
            newflags=addAPIflag( newflags, "RemoveAttr", "Condition-Darkness" );

            let prefix=["Armor-","Shield-"]
            for(let i=0;i<2;i++){
              if(values[prefix[i]+"Name"]||( getInt(values,prefix[i]+"Phys")>0 )||( getInt(values,prefix[i]+"Myst")>0 )||( getInt(values,prefix[i]+"IP")>0 )){
                newId = generateRowIdNoUnderscore();   // Create an armor line
                let newId2 = generateRowIdNoUnderscore();   // Create an inv line
                newInfo = buildPre( "ARM", newId );
                let newInfo2 = buildPre( "INV", newId );
                vals[newInfo + "RowID"] = newId;
                vals[newInfo2 + "RowID"] = newId2;
                vals[newInfo + "Type"] = (i==0 ?"1": "-1"); //Shield or Armor
                vals[newInfo + "Type_max"] ="1"; //Automatically Equip
                if(values[prefix[i]+"Name"]) {
                  vals[newInfo + "Name"]=values[prefix[i]+"Name"];
                  vals[newInfo2 + "Name"]=values[prefix[i]+"Name"];
                }
                newflags=addAPIflag( newflags, "RemoveAttr", prefix[i]+"Name" );
                if(values[prefix[i]+"Phys"]) vals[newInfo + "Phys"]=values[prefix[i]+"Phys"];
                if(values[prefix[i]+"Myst"]) vals[newInfo + "Myst"]=values[prefix[i]+"Myst"];
                if(values[prefix[i]+"IP"]) vals[newInfo + "IP"]=values[prefix[i]+"IP"];
                if(values[prefix[i]+"Date"])
                {vals[newInfo + "Notes"]=values[prefix[i]+"Date"];
                vals[newInfo2 + "Notes"]=values[prefix[i]+"Date"];
              }
              newflags=addAPIflag( newflags, "RemoveAttr", prefix[i]+"Date" );
              if(values[prefix[i]+"Shatter"]) vals[newInfo + "IP_max"]=values[prefix[i]+"Shatter"];
              newflags=addAPIflag( newflags, "RemoveAttr", prefix[i]+"Shatter" );
              if(values[prefix[i]+"Weight"]) vals[newInfo2 + "UnitWeight"]=values[prefix[i]+"Weight"];
              newflags=addAPIflag( newflags, "RemoveAttr", prefix[i]+"Weight" );

            }
          }

          for( i = 0; i < darray.length; i++ ){
            pre = buildPre( "DSP", darray[ i ]);
            if(values[pre+"Circle"]) vals[pre+"Circle_max"]=values[pre+"Circle"]; //Initialize Circle_max so that the CreateTalents button starts from current circle
            switch(values[pre+"Code"]){
              case "0.5" :{ //Other : create a JSON
                vals[pre+"Name"]=values[pre+"PathName"]||"";
                vals[pre+"Type"]="Discipline";
              } break;
              case "81.0": //Path Journeyman
              case "83.0": {//Path Master
                vals[pre+"Type"]="Path-" + (values[pre+"Code"]=="81.0" ? "Journeyman" : "Master");
                vals[pre+"Name"]=values[pre+"PathName"]||"";

              }break;
              case "89.0": {//Questor
                vals[pre+"Type"]="Questor";
                vals[pre+"Name"]="Questor-" + (values["Questor"]||"");
              }break;
              case "98.5": {//Spirit
                vals["SrRating"]=values[pre+"Circle"];
                vals["Race"]="Spirit";
                newflags=addAPIflag( newflags, "RemoveRow", "DSP,"+darray[i] );
              }break;
              case "99.5": {//Creature
                vals["SrRating"]=values[pre+"Circle"];
                vals["Creature-Durability"]="5";
                vals["Race"]="Creature";
                newflags=addAPIflag( newflags, "RemoveRow", "DSP,"+darray[i] );
              }break;
            }
          }

          for( i = 0; i < tarray.length; i++ ) {
            pre = buildPre( "T", tarray[ i ]);
            if(values[pre+"Mod-Type"]=="(0)") vals[pre+"Mod-Type"]="NoRoll";
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"VisionBased" );
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Resistance" );
          }
          for( i = 0; i < skarray.length; i++ ) {
            pre = buildPre( "SK", skarray[ i ]);
            if(values[pre+"Mod-Type"]=="(0)") vals[pre+"Mod-Type"]="NoRoll";
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"VisionBased" );
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Resistance" );
            if(values[pre+"Category"]) vals[pre+"Class"]=values[pre+"Category"];
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Category" );


          }
          for( i = 0; i < karray.length; i++ ) {
            pre = buildPre( "NAC", karray[ i ]);
            if(values[pre+"Mod-Type"]=="(0)") vals[pre+"Mod-Type"]="NoRoll";
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"VisionBased" );
            newflags=addAPIflag( newflags, "RemoveAttr", pre+"Resistance" );
          }

          let spdflt="0";
          let d1 = getInt( values, "SP-Elementalist"),
          d2 = getInt( values, "SP-Illusionist"),
          d3 = getInt( values, "SP-Nethermancer"),
          d4 = getInt( values, "SP-Wizard"),
          d5 = getInt( values, "SP-Shaman"),
          d6 = getInt( values, "SP-Power");
          if( (d1 + d2 + d3 + d4 + d5 + d6) == 1) {     // If the character only has Talent in one magical art, use that one.
            if( d1 == 1)
            spdflt = "Elementalism";
            else if( d2 == 1)
            spdflt = "Illusionism";
            else if( d3 == 1)
            spdflt = "Nethermancy";
            else if( d4 == 1)
            spdflt = "Wizardry";
            else if( d5 == 1)
            spdflt = "Shamanism";
            else if( d6 == 1)
            spdflt = "Spell Weaving";


          }
          for( i = 0; i < sparray.length; i++ ){
            pre = buildPre( "SP", sparray[ i ]);
            switch(values[pre+"Discipline"]){
              case "5.3" : vals[pre+"Discipline"]="Elementalism";
              case "6.3" : vals[pre+"Discipline"]="Illusionism";
              case "7.3" : vals[pre+"Discipline"]="Nethermancy";
              case "22.3" : vals[pre+"Discipline"]="Shamanism";
              case "16.3" : vals[pre+"Discipline"]="Wizardry";
              case "80" : vals[pre+"Discipline"]="Spell Weaving";
              case "81" : vals[pre+"Discipline"]="Other Weaving";
              default : vals[pre+"Discipline"]=spdflt;
          }
          }

            for( i = 0; i < warray.length; i++ ){
              pre = buildPre( "WPN", warray[ i ]);
              if (getInt(values, pre + "Weight")>0)
                {
                  newId = generateRowIdNoUnderscore();   // Create an inventory line
                  newInfo = buildPre( "INV", newId );
                  vals[newInfo + "RowID"] = newId;
                  vals[newInfo + "Name"] = values[pre+"Name"];
                  vals[newInfo + "UnitWeight"] = values[pre+"Weight"];
                  vals[newInfo + "Qty"] = "1";
                  vals[newInfo + "Notes"] = values[pre+"Date"] ||"";
                  vals[newInfo + "ShowNotes"] = "0";
                 }
              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Weight" );

              if (getInt(values, pre + "AmmoQty")>0)
                {
                  newId = generateRowIdNoUnderscore();   // Create an inventory line
                  newInfo = buildPre( "INV", newId );
                  vals[newInfo + "RowID"] = newId;
                  vals[newInfo + "Name"] = values[pre+"Name"] + " Ammo";
                  vals[newInfo + "UnitWeight"] = values[pre+"AmmoWeight"] ||"";
                  vals[newInfo + "Qty"] = getInt(values, pre + "AmmoQty");
                  vals[newInfo + "Notes"] = values[pre+"Date"] ||"";
                  vals[newInfo + "ShowNotes"] = "0";
                 }
              newflags=addAPIflag( newflags, "RemoveAttr", pre + "AmmoQty" );
              newflags=addAPIflag( newflags, "RemoveAttr", pre + "AmmoWeight" );

              if(values[pre+"Range"]) vals[pre+"Date"]= "Range : " + values[pre+"Range"] + "\n" + (values[pre+"Date"] ||"");
              newflags=addAPIflag( newflags, "RemoveAttr", pre + "Range" );
            };

            if(values["Race"] && values["Race"].toLowerCase().replace("'","")=="tskrang") vals["Race"]="T'skrang";
            if(values["Race"] && (values["Race"].toLowerCase()=="none" || values["Race"] =="0")) vals["Race"]="";



      if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
      setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
        'use strict';
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      });
      else{
        updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
      }
    });
    });
    });
    });
    });
    });
    });
  } // End ver 3.00


  else if( fromSheetVersion < 3.01 ) {
    toSheetVersion = 3.01;

    var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
    // Note: Put update stuff here.
    + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
    + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
    + "If you have a Pro roll20 account, it is highly recommended to install the Earthdawn API and Custom Token Marker Set (WIKI Section 4.1.2).\n"
    + "\n"
    + "- Various small bug fixes !\n"
    + "- Navigation tabs have been redone for some devices that had alignment issues !\n"
    + "- Printing layout has been reworked to save some lost space !\n"
    + "- An option (in repeating section options) to display the Dice to be rolled for all Talents has been added for the lucky ones playing IRL !\n"
    + notes;
    // Comment this line out if not to change tab to force release notes visible.
    showNotes = (showNotes === -1) ? -1 : 1;



    if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
    setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
      'use strict';
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    });
    else{
      updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
    }

} // End ver 3.01

else if( fromSheetVersion < 3.1 ) {
  toSheetVersion = 3.1;

  var newNotes = "Earthdawn by FASA Character Sheet version: " + toSheetVersion + " by Chris Dickey and JB Faure .\n"
  // Note: Put update stuff here.
  + "Access the WIKI by pressing the red '?' button at the top right of the character name. "
  + "Alternatively the url is 'https://wiki.roll20.net/Earthdawn_-_FASA_Official'. Read it.\n"
  + "-Display of Initiative penalty for Initiative, and Initiative replacement talents has been reworked. There is now a 7th Attribute Initiative for replacement Talents."
  + "-FASA clarified JumpUp and JumpUp replacements are penalized by the whole IP, not just IP. Talent Type Armor-IP has been replaced by JumpUp"
  + "-Strain has been reworked to allow some special cases to be asked via a query"
  + "-Strain has been added to spells in order to support Improved Spell Knacks (Mystic Paths)"
  + "-A new targetting mode has been introduced PD-each, MD-each, SD-each for cases where an area of effect applies to each target which defense is exceeded. Mode is not implemented yet and will fall back to the Highest Defense mode"
  + "-Durability has been reworked for Creatures and Questors"
  + "-Durability for Creatures now works as a Durability Rank that adds +5 to both Health Rating"
  + "-Durability for Questors has been removed from the Discipline, and has to be entered as a Devotion"
  + "-Piecemeal Armor is now possible."
  + "-Some support of Poisons has been added, with a dedicated Type (that will skip any modifier like Wounds and so on), Poisons listed with the Damages when you hit with an Attack, and Poison stats added to Creatures in the compendium for easier use by the GM."


  + notes;
  // Comment this line out if not to change tab to force release notes visible.
  showNotes = (showNotes === -1) ? -1 : 1;

  let getV = ["Initiative-Base", "Misc-Initiative-Adjust","Initiative-Auto-Adjust","Initiative-Mods-Auto","Creature-Durability","SrRating","Damage-Unc-Rating","Damage-Death-Rating","Race","Damage-Death-Rating-Adjust","Damage-Unconscious-Adjust"];
  let i,pre,newId,newInfo;

  getSectionIDs("repeating_weapons", function gsUpdateCharacterSheetIdWeapons(warray) {
    'use strict';
    for( i = 0; i < warray.length; i++ ) {
      pre = buildPre( "WPN", warray[ i ]);
      getV = _.union( getV, []);
    }
    getSectionIDs("repeating_spell", function gsUpdateCharacterSheetIdSpells(sparray) {
      'use strict';
      for( i = 0; i < sparray.length; i++ ) {
        pre = buildPre( "SP", sparray[ i ]);
        getV = _.union( getV, []);
      }
      getSectionIDs("repeating_discipline", function gsUpdateCharacterSheetIdSpells(darray) {
        'use strict';
        for( i = 0; i < darray.length; i++ ) {
          pre = buildPre( "DSP", darray[ i ]);
          getV = _.union( getV, [pre+"Type",pre+"Durability"]);
        }
        getSectionIDs("repeating_talents", function gsUpdateCharacterSheetIdTalents(tarray) {
          'use strict';
          for( i = 0; i < tarray.length; i++ ) {
            pre = buildPre( "T", tarray[ i ]);
            getV = _.union( getV, [  pre + "Mod-Type", pre + "Special" , pre+"Rank-Adjust", pre+"Name" , pre+"Strain"]);
          }
          getSectionIDs("repeating_knacks", function gsUpdateCharacterSheetIdKnacks(karray) {
            'use strict';
            for( i = 0; i < karray.length; i++ ) {
              pre = buildPre( "NAC", karray[ i ]);
              getV = _.union( getV, [  pre + "Mod-Type", pre + "Special", pre+"Rank-Adjust", pre+"Name", pre+"Strain"]);
            }
            getSectionIDs("repeating_skills", function gsUpdateCharacterSheetIdSkills(skarray) {
              'use strict';
              for( i = 0; i < skarray.length; i++ ) {
                pre = buildPre( "SK", skarray[ i ]);
                getV = _.union( getV, [  pre + "Mod-Type", pre + "Special", pre+"Rank-Adjust", pre+"Name", pre+"Strain"]);
              }


      getAttrs( getV , function gaUpdateCharacterSheet(values) {
        'use strict';

        if(values["Initiative-Base"]) vals["Initiative-Step"]=values["Initiative-Base"];
        newflags=addAPIflag( newflags, "RemoveAttr", "Initiative-Base" );
        if(values["Misc-Initiative-Adjust"]) vals["Initiative-Adjust"]=values["Misc-Initiative-Adjust"];
        newflags=addAPIflag( newflags, "RemoveAttr", "Misc-Initiative-Adjust" );
        if(values["Initiative-Mods-Auto"]) vals["Initiative-Mod-Auto"]=values["Initiative-Mods-Auto"];
        newflags=addAPIflag( newflags, "RemoveAttr", "Initiative-Mods-Auto" );

        //Remove the Creature Durability-Ratings that is now a rank adding 5 to each rating, instead of SrRatingx5 to Unc and SrRatingx6 to Death
        if(["Horror","Dragon","Spirit","Creature"].includes(values["Race"]) && getInt(values,"Creature-Durability")>0){
          vals["Creature-Durability"]="0";
          vals["Damage-Unconscious-Adjust"]=getInt(values,"Damage-Unconscious-Adjust") + getInt(values,"SrRating") *getInt(values,"Creature-Durability");
          vals["Damage-Death-Rating-Adjust"]=getInt(values,"Damage-Death-Rating-Adjust")+ getInt(values,"SrRating") * (getInt(values,"Creature-Durability") + 1);
        }



        for( i = 0; i < darray.length; i++ ) {
          pre = buildPre( "DSP", darray[ i ]);
          if(["Questor", "Path-Journeyman","Path-Master"].includes (values[pre+"Type"]) && values[pre+"Durability"] && values[pre+"Durability"] !=="0") vals[pre+"Durability"]="0";
        }


      for( i = 0; i < tarray.length; i++ ) {
        pre = buildPre( "T", tarray[ i ]);
        if(values[pre+"Strain"]) vals[pre+"Strain_max"]=getInt(values,pre+"Strain");
        if(values[pre+"Mod-Type"]=="Init"|| values[pre+"Special"]=="Initiative"){
          vals[pre+"Mod-Type"]="Init";
          vals[pre+"Special"]="Initiative";
          vals[pre+"Attribute"]="Initiative";
          if(values["Misc-Initiative-Adjust"] || values["Initiative-Auto-Adjust"]) {
            let nm=values[pre+"Name"]||"";
            if ((nm.includes("Tiger") && nm.includes("Dance")) || (nm.includes("Tiger") && nm.includes("Cobra")) || (nm.includes("Air") && nm.includes("Cobra")) || (nm.includes("Cobra") && nm.includes("Dance")))
              vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")+getInt(values,"Misc-Initiative-Adjust")+getInt(values,"Initiative-Auto-Adjust");
            else vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")-getInt(values,"Misc-Initiative-Adjust")-getInt(values,"Initiative-Auto-Adjust");
          }
        }
        else if(values[pre+"Mod-Type"]=="Armor IP") vals[pre+"Mod-Type"]="JumpUp";
      }

      for( i = 0; i < skarray.length; i++ ) {
        pre = buildPre( "SK", skarray[ i ]);
        if(values[pre+"Strain"]) vals[pre+"Strain_max"]=getInt(values,pre+"Strain");
        if(values[pre+"Mod-Type"]=="Init"|| values[pre+"Special"]=="Initiative"){
          vals[pre+"Mod-Type"]="Init";
          vals[pre+"Special"]="Initiative";
          vals[pre+"Attribute"]="Initiative";
          if(values["Misc-Initiative-Adjust"] || values["Initiative-Auto-Adjust"]) {
            let nm=values[pre+"Name"]
            if ((nm.includes("Tiger") && nm.includes("Dance")) || (nm.includes("Tiger") && nm.includes("Cobra")) || (nm.includes("Air") && nm.includes("Cobra")) || (nm.includes("Cobra") && nm.includes("Dance")))
              vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")+getInt(values,"Misc-Initiative-Adjust")+getInt(values,"Initiative-Auto-Adjust");
            else vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")-getInt(values,"Misc-Initiative-Adjust")-getInt(values,"Initiative-Auto-Adjust");
          }
        }
        else if(values[pre+"Mod-Type"]=="Armor IP") vals[pre+"Mod-Type"]="JumpUp";
      }

      for( i = 0; i < karray.length; i++ ) {
        pre = buildPre( "NAC", karray[ i ]);
        if(values[pre+"Strain"]) vals[pre+"Strain_max"]=getInt(values,pre+"Strain");
        if(values[pre+"Mod-Type"]=="Init"|| values[pre+"Special"]=="Initiative"){
          vals[pre+"Mod-Type"]="Init";
          vals[pre+"Special"]="Initiative";
          vals[pre+"Attribute"]="Initiative";
          if(values["Misc-Initiative-Adjust"] || values["Initiative-Auto-Adjust"]) {
            let nm=values[pre+"Name"]
            if ((nm.includes("Tiger") && nm.includes("Dance")) || (nm.includes("Tiger") && nm.includes("Cobra")) || (nm.includes("Air") && nm.includes("Cobra")) || (nm.includes("Cobra") && nm.includes("Dance")))
              vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")+getInt(values,"Misc-Initiative-Adjust")+getInt(values,"Initiative-Auto-Adjust");
            else vals[pre+"Rank-Adjust"]=getInt(values,pre+"Rank-Adjust")-getInt(values,"Misc-Initiative-Adjust")-getInt(values,"Initiative-Auto-Adjust");
          }
        }
        else if(values[pre+"Mod-Type"]=="Armor IP") vals[pre+"Mod-Type"]="JumpUp";
      }
      for( i = 0; i < sparray.length; i++ ){
        pre = buildPre( "SP", sparray[ i ]);
      }


        for( i = 0; i < warray.length; i++ ){
          pre = buildPre( "WPN", warray[ i ]);
        };


  if( Object.keys(vals).length > 0 )    // If the code above just changed some values, do those before making the recursive call.
  setAttrsLog( vals, undefined , function fnUpdateCharactersheetSetAttrsLog( vals ) {
    'use strict';
    updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
  });
  else{
    updateCharactersheet( newSheetVersion, toSheetVersion, origSheetVersion, recurse + 1, values, showNotes, newNotes, newflags);        // Recursively call this routine to do any subsequent updates.
  }
});
});
});
});
});
});
});
} // End ver 3.1





    else  {

      vals[ "edition_max" ] = newSheetVersion.toString();
      // vals[ "edition" ] = 4;
      let flag  =addAPIflag( newflags, "SheetUpdate", origSheetVersion.toString() + "," + newSheetVersion.toString() + ", ED" );
      //vals[ "APIflag" ]=flag;
      vals[ "Release-notes" ] = notes;
      if( showNotes ) {
        // vals[ "show-release-notes" ] = "1";
        // vals[ "tab" ] = "9";
         vals[ "tab" ] = "11";
         vals[ "tab-adjust" ] = "4";
      }
      setAttrsLog( vals );
      updateRace("recalc");
      recalc();       // If we actually updated something, recalculate every field.
    }
  }
} catch(err) {log("Earthdawn:updatecharactersheet() error caught: " + err );}
}; // End updatecharactersheet()



// When a sheet is first opened, see if it needs to be updated from a previous version.

var onSheetOpened = function fnOnSheetOpened(){
  'use strict';
  try{
  // edition_max is character sheet version
  // getAttrs(["edition_max", "NPC", "show_tips_startup" ], function gaSheetOpened(values) {
    getAttrs(["edition_max", "NPC", "API", "API_max"], function gaSheetOpened(values) {
    'use strict';
    logvalues( values);
          //API Watchdog - Set to NoAPI no matter what, if the API is active it will reset to API.
          //Temporarily disabled until API is released
    let vals={};
    switch( values[ "API" ] ) {
      case undefined :
        vals["API"]="0";
      case "0": case 0:
        if( values[ "API_max" ] == "10" )
          vals[ "API_max" ] = "0";
        else
          vals[ "API_max" ] = "10";
      break;
      case "1": case 1:
        vals[ "API" ] = "2";
        vals[ "API_max" ] = "2";
        break;
      case "2": case 2:
        if( values[ "API_max" ] == "2" )
          vals[ "API_max" ] = "12";
        else
          vals[ "API_max" ] = "2";
    }
    setAttrsLog( vals );
    var newSheetVersion = SheetVersion;          // The Version number is set as a global variable at the beginning of the sheet-worker. It is changed with every revision of the sheet that needs to call this routine. Also updated twice above and in .js file.
    var oldSheetVersion = parseFloat( values[ "edition_max" ] );

    if( oldSheetVersion != newSheetVersion ) {
      updateCharactersheet( newSheetVersion, oldSheetVersion, oldSheetVersion, 0, values, 0, "" );
    } // End there are updates to perform
  });
  cleanupMsgs();
  recalc();       // recalc on sheet opened whether updated anything or not.
} catch(err) {log("Earthdawn:OnSheetOpened() error caught: " + err );}
};//end OnSheetOpened
on('sheet:opened', fn(onSheetOpened));


// addAPIflag() This routine builds a list of commands for the API to process.
// The list is newline delimited.
// Each item on the list has a command, a comma, and some data for the command. Each command has its own requirements for format.
// cmd tells the API what exact type of communication this is.
// line is the details needed to process this command.
// The flag eventually needs to be written in attr_APIflag
// RemoveRow, (code), (rowID) // remove everything with this rowID.
// RemoveAttr, (fully qualified attribute name). Remove this attribute.
var addAPIflag = function fnaddAPIflag( flag, cmd, line ) {
  'use strict';
  try{
  let newflag = cmd + "," + line + "\n",
  d = new Date(),
  vals={},
  newID= generateRowIdNoUnderscore(),
  pre=buildPre("MSG",newID);

  vals[pre+"TimeStamp"]=d.toString();
  vals[pre+"toAPI"]=newflag;
  setAttrsLog(vals);
  return ((flag||"") + newflag);
} catch(err) {log("Earthdawn:addAPIflag() error caught: " + err );}
}; // End addAPIflag()



// fnprocessSWflag() This routine receives a list of commands from the API to process.
// The list is newline delimited.
// Each item on the list has a command, a comma, and some data for the command. Each command has its own requirements for format.
// cmd tells  what exact type of communication this is.
// line is the details needed to process this command.
// accepted commands are
// recalc, that will trigger recalc()
// trigger,fully qualified attribute name,value that will use setAttrsLog to write the value in the attribute (triggering any sheetworker routine necessary)
// The flag eventually has been written in attr_SWflag
// var processSWflag = function fnprocessSWflag(eventInfo) {
//   'use strict';
//   try{
//   if( eventInfo[ "sourceType" ].toLowerCase() !== "api" || !( "newValue" in eventInfo  )) return;   //The routine resets the value of SWflag at the end, and the silent mode of setAttrs is erratic. We want to avoid circular loop
//   let flags = eventInfo[ "newValue" ];
//   //log("Earthdawn SWflag :" + flags);
//   if( flags ) flags = flags.trim();
//   if( !flags ) { log("Earthdawn:processSWflag() error : SWflag is undefined"); return;};
//   let cmdArray = flags.split("\n") ;
//   let i, cmdLine;
//   let vals={};
//   for( i = 0; i < cmdArray.length; i++ ) {
//     cmdLine = cmdArray[ i ];
//     switch(getParam( cmdLine, 1, ",").toLowerCase()) {
//       case "ping" : break; //Just used for the watchdog
//       case "recalc" : recalc(); break;
//       case "sheetupdate" : onSheetOpened(); break;
//       case "trigger" :{     // Trigger, (attribute name to trigger) (: colon) (data to be written to activate the trigger). (newline).
//         let comma = cmdLine.indexOf(",");
//         let colon = cmdLine.indexOf(":");
//         if( comma === -1 || colon <= comma ) {log("Earthdawn:processSWflag() error. cmd trigger, cmdLine improperly formatted: " + cmdLine); break;}
//         vals[ cmdLine.substring(comma +1, colon).trim() ] = cmdLine.substring( colon +1 ).trim();
//       };
//       break;
//       case "trigger2" :  {   // Trigger2, routine to call, fully qualified attribute name to be passed as eventInfo. (newline).
//         let trig2 = getParam( cmdLine, 2, ",").toLowerCase();
//         //log('trigger2 '+trig2)
//
//         if( trig2 === "autofill" )
//           AutoFill( getParam( cmdLine, 3, "," ),"API");
//         else if( trig2.endsWith( "getvalue" ) || trig2.endsWith( "providevalue" ))
//           switch(  repeatSection( 3, getParam( cmdLine, 2, ",")).toUpperCase() ) {     //code Let's make sure after a link or an Autofill that we locally recalculate
//             case "NAC":
//             case "SK" :
//             case "WPN" :
//             case "T" : repRanks( repeatSection( 2, getParam( cmdLine, 2, ",")) , repeatSection( 3, getParam( cmdLine, 2, ",")).toUpperCase()); break;
//             case "SPM" : repMatrixType( repeatSection( 2, getParam( cmdLine, 2, ","))); break; //rowid
//             default :   log("Earthdawn:processSWflag() error : invalid trigger2 getvalue: " + cmdLine );
//           }
//         else
//           log("Earthdawn:processSWflag() error : invalid trigger2: " + cmdLine );
//       }
//       break;
//       default: log("Earthdawn:processSWflag() error. Unknown cmd: " + cmdLine);
//     };
//   };
//   vals[ "SWflag" ] = "";
//   //API Watchdog - If any flag is received, the API must be running
//   vals["API"]="1";
//   vals["API_max"]="1";
//
//
//   setAttrsLog( vals );
//
// } catch(err) {log("Earthdawn:processSWflag() error caught: " + err );}
// }; // End processSWflag()
// on("change:swflag", fn(processSWflag));



// fnprocessMsgtoSW() This routine receives a message from the API to process.
// The message has a command, a comma, and some data for the command. Each command has its own requirements for format.
// cmd tells  what exact type of communication this is.
// line is the details needed to process this command.
// accepted commands are
// recalc, that will trigger recalc()
// trigger,fully qualified attribute name,value that will use setAttrsLog to write the value in the attribute (triggering any sheetworker routine necessary)
// The message has been written in a repeating_message structure
var processMsgtoSW = function fnprocessMsgtoSW(eventInfo) {
  'use strict';
  try{

  //log("Earthdawn Msg_toSheetworker :" + JSON.stringify(eventInfo));

  let att =getAttrib(eventInfo);
  if (!att || att==="") return;

  let code = repeatSection(3,att),
   rowid = repeatSection(2,att),
   pre = buildPre(code,rowid),
   vals={};


getAttrs( [pre+"toSheetworker" , pre+"toSheetworker_max"] , function gacleanupMsgs(values) {

  if(att.endsWith("max")){ //Triggers by max are either an ACK, or a ghost trigger when receiving a real toSheetworker message
    if(values[pre+"toSheetworker_max"]=="ACK"){
    //log("SW received ACK fromAPI, trying to remove message " + JSON.stringify(att));
    removeRepeatingRow("repeating_message_" + repeatSection(2,att)); //this is an acknocledgement from API that he processed the message. Delete it
  }
  vals["API"]="1";
  vals["API_max"]="1";
  setAttrsLog( vals );
    return;
  }



  //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
  let cmdLine = values[pre+"toSheetworker"];

  if(!cmdLine || cmdLine.length<2){ //It looks like the ACK in the _max triggers the current in any case with no new value... ignore
    //log("empty message " + JSON.stringify(eventInfo));
    return;
  }

    switch(getParam( cmdLine, 1, ",").toLowerCase()) {
      case "ping" : break; //Just used for the watchdog
      case "recalc" : recalc(); break;
      case "sheetupdate" : onSheetOpened(); break;
      case "trigger" :{     // Trigger, (attribute name to trigger) (: colon) (data to be written to activate the trigger). (newline).
        let comma = cmdLine.indexOf(",");
        let colon = cmdLine.indexOf(":");
        if( comma === -1 || colon <= comma ) {log("Earthdawn:processMsgtoSW() error. cmd trigger, cmdLine improperly formatted: " + cmdLine); break;}
        vals[ cmdLine.substring(comma +1, colon).trim() ] = cmdLine.substring( colon +1 ).trim();
      };
      break;
      case "trigger2" :  {   // Trigger2, routine to call, fully qualified attribute name to be passed as eventInfo. (newline).
        let trig2 = getParam( cmdLine, 2, ",").toLowerCase();
        //log("trigger2 cmdline " + cmdLine + " trig2 " + trig2 + " rowid " + getParam( cmdLine, 2, ",") + " rowid2 " + repeatSection( 2, getParam( cmdLine, 2, ",")))

        if( trig2 === "autofill" )
          AutoFill( getParam( cmdLine, 3, "," ),"API");
        else if( trig2.endsWith( "value" ) ) //Only getvalue or providevalue
          switch(  repeatSection( 3, getParam( cmdLine, 2, ",")).toUpperCase() ) {     //code Let's make sure after a link or an Autofill that we locally recalculate
            case "NAC":
            case "SK" :
            case "WPN" :
            case "T" : repRanks( repeatSection( 2, getParam( cmdLine, 2, ",")) , repeatSection( 3, getParam( cmdLine, 2, ",")).toUpperCase()); break;
            case "SPM" : repMatrixType( repeatSection( 2, getParam( cmdLine, 2, ","))); break; //rowid
            default :   log("Earthdawn:processMsgtoSW() error : invalid trigger2 getvalue: " + cmdLine );
          }
        else
          log("Earthdawn:processMsgtoSW() error : invalid trigger2: " + cmdLine );
      }
      break;
      default: log("Earthdawn:processMsgtoSW() error. Unknown cmd: " + cmdLine);
    };
  // //API Watchdog - If any flag is received, the API must be running
  vals["API"]="1";
  vals["API_max"]="1";

  //In case we want acknocledgement
  //vals[pre+"toAPI_max"]="ACK";

  //In case we don't want acknocledgement
   //log(" processed message " + rowid + " removing row ");
   removeRepeatingRow("repeating_message_" +rowid)


  setAttrsLog( vals );

});

} catch(err) {log("Earthdawn:processMsgtoSW() error caught: " + err );}
}; // End processMsgtoSW()
on("change:repeating_message:msg_tosheetworker change:repeating_message:msg_tosheetworker_max", fn(processMsgtoSW));


// cleanupMsgs is called every time sheet is opened and makes a cleanup of the messages
// Unprocessed messages toAPI are deleted (potentially the API is dead and we don't want buildUp)
// Unprocessed messages toSheetworker are processed.

var cleanupMsgs = function fncleanupMsgs(eventInfo) {
  'use strict';
  try{
    let attarray=[],
    d=new Date();

    getSectionIDs("repeating_message", function gsIdRepeatingMessage(marray) {
      for( let i = 0; i < marray.length; i++) {
        attarray.push( buildPre( "MSG", marray[ i ] ) + "TimeStamp");
        attarray.push( buildPre( "MSG", marray[ i ] ) + "toAPI");
        attarray.push( buildPre( "MSG", marray[ i ] ) + "toAPI_max");
        attarray.push( buildPre( "MSG", marray[ i ] ) + "toSheetworker");
        attarray.push( buildPre( "MSG", marray[ i ] ) + "toSheetworker_max");
      }
      getAttrs( attarray , function gacleanupMsgs(values) {
        for( let i = 0; i < marray.length; i++) {
          let pre= buildPre( "MSG", marray[ i ] ),
          tdiff= Math.abs(d- (new Date( values[pre + "TimeStamp"]))),
          told = tdiff > 50000;
          //log("tdiff " + tdiff + " told " + told + " d " + d.toString() + " dold  " + (new Date( values[pre + "TimeStamp"])));
          if( values[pre + "toSheetworker"] ){
          //log("Msgtosheetworker")
          if(told || values[pre+"toAPI_max"]) //old messages or processed messages are deleted
          removeRepeatingRow("repeating_message_" +marray[ i ]);
          else { //it is a recent message, so process it
          processMsgtoSW({sourceAttribute : pre+"toSheetworker", newValue:values[pre+"toSheetworker"], sourceType:"directcall"})
          }

        }
          else if( values[pre + "toAPI"] ){
          //log("MsgtoAPI")
          if(told || values[pre+"toSheetworker_max"])
          removeRepeatingRow("repeating_message_" +marray[ i ]);
        }
          else{
            //log("Empty msg")
          //removeRepeatingRow("repeating_message_" +marray[ i ]);
          }
        }
      });
    });
  } catch(err) {log("Earthdawn:cleanupMsgs() error caught: " + err );}
}; // End cleanupMsgs()




// resetEditMode : whenever leaving a section, all the edit modes are reset
// While in Creation mode, everything is in edit mode
var resetEditMode = function fnresetEditMode() {
  'use strict';
  try{
  getAttrs( [ "CreationMode","tab" ] , function garesetEditMode(values) {
    let i=getInt(values,"CreationMode");
    let vals={};
    if(values["tab"]=="1" || values["tab"]=="2"){
    vals["attributes-edit-mode"]=i;
    vals["DSP-Race-edit-mode"]=i;
    vals["talents-edit-mode"]=i;
    vals["knacks-edit-mode"]=i;
    vals["skills-edit-mode"]=i;
    vals["spells-talents-edit-mode"]=i;
    vals["spellmatrix-edit-mode"]=i;
    vals["spells-edit-mode"]=i;
    vals["equipment-edit-mode"]=i;
    vals["thread-edit-mode"]=i;
    vals["blood-edit-mode"]=i;
    vals["mount-edit-mode"]=i;
    setAttrsLog(vals);
  }
  });
} catch(err) {log("Earthdawn:resetEditMode() error caught: " + err );}
}; // End resetEditMode()
on("change:tab change:creationmode", fn(resetEditMode));



//UpdateKask() : Karma mode works with 2 modes
//In AUTO KarmaGlobalMode-Auto==1, any roll of an ability ABC will be done with exactly ABC_Karma Karma points
//In ASK, KarmaGlobalMode-Ask==1, any roll will trigger a query asking how many Karma to spend between ABC_Karma-Limit and ABC_Karma-Limit_max
// This routine ensures the attribute ABC_Karma-Ask is filled with {How many karma to spend between "Karma_req" and "Karma_max"| 0 } with the appropriate values
// This is achieved by having the following syntax in the button : ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: @{DPGlobalMode}@{T_DP-Ask}
// When KarmaGlobalMode is not ask, the string ~ K-ask: @{KarmaGlobalMode}@{T_Karma-Ask}: will be invalid and ignored
// When KarmaGlobalMode is ask, the string will make an appropriate query
// This routine also ensures that T_Karma is updated when T_Karma-Limit_max is changed
var UpdateKask = function fnUpdateKask(eventInfo) {
  'use strict';
  try{
    //log("UpdateKask " + JSON.stringify(eventInfo));
  //Start by splitting the eventInfo to find what we are working with
  let rec= _.isString(eventInfo); //records if we got called by the recalc function, in which case we will have a complete rowid
  let att =getAttrib(eventInfo);
  let kdp = ( att.toLowerCase().includes("karma")  ? "Karma" : ( att.toLowerCase().includes( "dp" )  ? "DP" : undefined));
  let chgmax = att.toLowerCase().includes("max");
  if (!kdp) {log("Earthdawn: UpdateKask() error. Invalid eventInfo:" + att); return;};
  let att2 = att.substring(0, att.toLowerCase().lastIndexOf(kdp.toLowerCase()));
  let pre;
  if (att.startsWith( "repeating") && !rec){ // we got called locally by the trigger repeating sections are vandalized, we have to go back through buildPre
    let code= repeatSection(3,att2);
    pre=buildPre(code); // BuildPre based with no RowId as it is anyways vandalized, and we could only get called locally
  }
  else if (att.startsWith( "repeating") && rec){ // we got called by recalc with a complete name
    let code= repeatSection(3,att2);
    let rid= repeatSection(2,att2);
    if(rid && rid.length<4) log("updateKask incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
    pre=buildPre(code,rid); // BuildPre complete as we got called via the recalc with a complete name
  }
  else{
    pre=att2.charAt(0).toUpperCase()+ att2.substring(1); // Devandalize by re-adding the upper case
  }
  getAttrs( [ pre + kdp, pre+kdp+"-Limit_max", pre+kdp+"-Limit" ] , function gaUpdateKask(values) {
    'use strict';
    let min =  getInt(values,pre+kdp+"-Limit");
    let max=  getInt(values,pre+kdp+"-Limit_max");
    let kma= getInt(values,pre+kdp);
    let def=  Math.max(getInt(values,pre+kdp),min);
    let vals={};
    if (min<max) vals[pre+kdp+"-Ask"]="{ " + kdp + " mode is ASK. Choose number of " + kdp + " between " + min + " and " + max +" |"+ min+ "}"; //Changed to min instead of def
    else vals[pre+kdp+"-Ask"]="0";
    //We only want to offer a choice if min<max
    if(kma<min) vals[pre+kdp]=min; //ensures karma or dp remains withing boundaries
    else if(kma>max) vals[pre+kdp]=max;
    else if(!rec && chgmax && eventInfo) //ensures karma or dp follows the max when it was equal and it changed
      vals[pre+kdp]=max;

    setAttrsLog(vals);
  });
  } catch(err) {log("Earthdawn:UpdateKask() error caught: " + err );}
}; //end UpdateKask()
on("change:dex-karma-limit_max change:dex-karma change:dex-karma-limit", fn(UpdateKask));
on("change:str-karma-limit_max change:str-karma change:str-karma-limit", fn(UpdateKask));
on("change:tou-karma-limit_max change:tou-karma change:tou-karma-limit", fn(UpdateKask));
on("change:per-karma-limit_max change:per-karma change:per-karma-limit", fn(UpdateKask));
on("change:wil-karma-limit_max change:wil-karma change:wil-karma-limit", fn(UpdateKask));
on("change:cha-karma-limit_max change:cha-karma change:cha-karma-limit", fn(UpdateKask));
on("change:initiative-karma-limit_max change:initiative-karma change:initiative-karma-limit", fn(UpdateKask));
on("change:recovery-karma-limit_max change:recovery-karma change:recovery-karma-limit", fn(UpdateKask));
on("change:dex-dp-limit_max change:dex-dp change:dex-dp-limit", fn(UpdateKask));
on("change:str-dp-limit_max change:str-dp change:str-dp-limit", fn(UpdateKask));
on("change:tou-dp-limit_max change:tou-dp change:tou-dp-limit", fn(UpdateKask));
on("change:per-dp-limit_max change:per-dp change:per-dp-limit", fn(UpdateKask));
on("change:wil-dp-limit_max change:wil-dp change:wil-dp-limit", fn(UpdateKask));
on("change:cha-dp-limit_max change:cha-dp change:cha-dp-limit", fn(UpdateKask));
on("change:initiative-dp-limit_max change:initiative-dp change:initiative-dp-limit", fn(UpdateKask));
on("change:recovery-dp-limit_max change:recovery-dp change:recovery-dp-limit", fn(UpdateKask));
on("change:repeating_talents:t_karma-limit_max change:repeating_talents:t_karma change:repeating_talents:t_karma-limit", fn(UpdateKask));
on("change:repeating_talents:t_dp-limit_max change:repeating_talents:t_dp change:repeating_talents:t_dp-limit", fn(UpdateKask));
on("change:repeating_knacks:nac_karma-limit_max change:repeating_knacks:nac_karma change:repeating_knacks:nac_karma-limit", fn(UpdateKask));
on("change:repeating_knacks:nac_dp-limit_max change:repeating_knacks:nac_dp change:repeating_knacks:nac_dp-limit", fn(UpdateKask));
on("change:repeating_skills:sk_karma-limit_max change:repeating_skills:sk_karma change:repeating_skills:sk_karma-limit", fn(UpdateKask));
on("change:repeating_skills:sk_dp-limit_max change:repeating_skills:sk_dp change:repeating_skills:sk_dp-limit", fn(UpdateKask));
on("change:repeating_weapons:wpn_karma-limit_max change:repeating_weapons:wpn_karma change:repeating_weapons:wpn_karma-limit", fn(UpdateKask));
on("change:repeating_weapons:wpn_dp-limit_max change:repeating_weapons:wpn_dp change:repeating_weapons:wpn_dp-limit", fn(UpdateKask));



var repMatrixNotes = function fnrepMatrixNotes( eventInfo) {
  'use strict';
  try{
  //Start by splitting the eventInfo to find what we are working with
  let att =getAttrib(eventInfo);
  if (att==="" || eventInfo["sourceType"] !=="player") return;
  let show=eventInfo["newValue"];
  let rowid = repeatSection(2,att);
  if(rowid && rowid.length<4) log("repMatrixNotes incorrect rowid for eventInfo: " +JSON.stringify(eventInfo));
  let pre = buildPre("SPM",rowid);
  let vals={};
  getSectionIDs("repeating_matrix", function gsUpdateCharacterSheetIdMatrix(marray) {
    getAttrs( [pre+"spRowID"] , function garepMatrixNotes(values) {
      let pre2=buildPre("SP",values[pre+"spRowID"])
      getAttrs( [pre2+"Notes"] , function garepMatrixNotes2(values2) {
        for(let i=0; i < marray.length; i++) if(marray[i].toLowerCase()!== rowid.toLowerCase()) vals[buildPre("SPM", marray[i]) + "ShowNotes"]=0;
        vals["Matrix-ShowNotes"]=show;
        vals["Matrix-Notes"]=values2[pre2 + "Notes"] ||"";
        setAttrsLog(vals, {silent:true});
      });
    });
  });
} catch(err) {log("Earthdawn:repMatrixNotes() error caught: " + err );}
}; //end repMatrixNotes()
on("change:repeating_matrix:spm_shownotes", fn(repMatrixNotes));


// When a Spell combat slot changes, see if the spell is in a matrix, and if so change the SPM_CombatSlot
var repSpellCombatSlot = function fnrepSpellCombatSlot( eventInfo) {
  'use strict';
  try{
  let att =getAttrib(eventInfo);
  if (att==="" || eventInfo["sourceType"] !=="player") return;
  let spAtt = buildPre("SP", repeatSection(2, att)) + "spmRowID";
  let vals={};
  getAttrs( [ spAtt ] , function gaSpellCombatSlot(values) {
    let spmrID = values[ spAtt ];
    if( spmrID && spmrID.length > 2 ) {
      vals[ buildPre( "SPM", spmrID ) + "CombatSlot" ] = eventInfo[ "newValue" ];
      setAttrsLog(vals, {silent:true});
    }
  });
} catch(err) {log("Earthdawn:repSpellCombatSlot() error caught: " + err );}
}; //end repSpellCombatSlot()
on("change:repeating_spell:sp_combatslot", fn(repSpellCombatSlot));



// This function creates all missing Discipline Talents
on("clicked:repeating_discipline:createtalents", fn(function ocCreateTalents(eventInfo) {
  'use strict';
  try {
    //log("Create")
    //Important Comment : Action Buttons in repeating sections DO NOT WORK, if there is an underscore, so it can't follow the usual repeating_section_rowid_code_name syntax. The button itself will have no code
    let att = getAttrib(eventInfo),
        rid = att.split("_")[2],
        pre = buildPre("DSP",rid),
        vals = {},
        attarray = [pre+"Name_max",pre+"Name",pre+"Type", pre+"Circle",pre+"Circle_max","NPC"]; //Need to have them also directly because pre will be normally cased, while darray will be loweredcased

    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type_max");

      }
      getSectionIDsOrdered("repeating_discipline", function gsIdRepeatingDiscipline(darray) {
        for( let i = 0; i < darray.length; i++){
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Type");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name_max");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
        }

        getSectionIDsOrdered("repeating_matrix", function gsIdRepeatingMatrix(marray) {
          for( let i = 0; i < marray.length; i++){
            attarray.push( buildPre( "SPM", marray[ i ] ) + "Type");
            attarray.push( buildPre( "SPM", marray[ i ] ) + "Origin");

          }

        getAttrs( attarray , function gaCreateTalents(values) {
          let ddata = parseJSON(values[pre+"Name_max"]);


          if(!ddata["DT_C1"] && !ddata["TO_Novice"] && !ddata["TO_Journeyman"]) {
            log("Earthdawn CreateTalent error. Tried to create for uneligible discipline " + values[pre+"Name"]);
            return;
          }

          let tnamearray = [], ridarray=[];
          let nbdisc = 0,
              nbsc = 0,nbsc5=0,
              ddatatmp, newId, newInfo,mnewId, mnewInfo, flags = "", dtarr, mincircle = 15, multinb = 0,nbto=[0,0,0,0];

          let circletotier=[],
               circletoquest=["","Follower","Follower","Follower","Follower","Adherent","Adherent","Adherent","Adherent","Exemplar","Exemplar","Exemplar","Exemplar"];

          if(ddata.Type=="Path-Journeyman" || ddata.Type=="Path-Master") {//Strange cases for Paths
            if(values[pre+"Name"]=="Journeyman")//Journeyman has Tiers 1-2, 3-5, 5
              circletotier=["","Journeyman","Journeyman","Warden","Warden","Master"];
            else circletotier=["","Journeyman","Journeyman","Journeyman","Journeyman","Warden","Warden","Warden","Warden","Master","Master"];

          }else circletotier=["","Novice","Novice","Novice","Novice","Journeyman","Journeyman","Journeyman","Journeyman","Warden","Warden","Warden","Warden","Master","Master","Master"]

          // log("tnamearray "+JSON.stringify(tnamearray));


          //JBF@JBF : need to rethink how to identify the discipline number
          for( let i = 0; i < darray.length; i++) { //Count the number of disciplines and spellcasting
            ddatatmp= parseJSON(values [buildPre( "DSP", darray[ i ] ) + "Name_max"]);
            if(ddatatmp.Type=="Discipline") nbdisc++;
            if(ddatatmp.issc) nbsc++;
            if(ddatatmp.issc && getInt(values,buildPre( "DSP", darray[ i ] ) + "Circle")>=5) nbsc5++;
            if(ddatatmp.Type=="Discipline" && values[buildPre( "DSP", darray[ i ] ) + "Name"] !== values [pre + "Name"])
              mincircle=Math.min(mincircle, getInt(values,buildPre( "DSP", darray[ i ] ) + "Circle"));
          }
          nbdisc=Math.min(nbdisc,4);

          for( let i = 0; i < tarray.length; i++) {//Create an array of all pre-existing Talents to detect duplicates
          let ty="D1-Novice";
          if(values[buildPre( "T", tarray[ i ] ) + "Type"]) ty=values[buildPre( "T", tarray[ i ] ) + "Type"];
          if( !ty.startsWith("V") && !ty.startsWith("QD")){ //Talents learned through Versatility will actually be duplicated, and Devotions are just not Talents
            tnamearray.push( values[buildPre( "T", tarray[ i ] ) + "Name"].toLowerCase().trim());
            ridarray.push( tarray[ i ]);

            if(ty.startsWith("TO"+nbdisc)) //Count TO that we have already
            if(ty.endsWith("Novice")) nbto[0]++;
            else if(ty.endsWith("Journeyman")) nbto[1]++;
            else if(ty.endsWith("Warden")) nbto[2]++;
            else if(ty.endsWith("Master")) nbto[3]++;
          }
        }

          let cmin=Math.max(1,getInt(values,pre+"Circle_max")+1),
          cmax=Math.max(1,getInt(values,pre+"Circle")); //Naming looks crazy, but DSP_Circle_max actually holds the last Circle to which the button was used,
          //The Math.max will allow Circle 1 talents to be created even with Circle=0 which could be useful for multi-disciplining

          //Circle 1 Free Talents : create the free talent only if processing the circle 1
          if(getInt(values,pre+"Circle")>=1 && cmin <=1 && ddata["Free_C1"] ) {
            if(ddata["issc"]=="1"){ // Spellcaster case : Deal with the Free Matrix only if it is the first and only Matrix
              if(nbsc==1){
                log("Earthdawn CreateTalents - First Spellcaster Discipline - Creating Matrixes and WIL");

                if(cmax>=5) // We created a spellcaster directly at Circle >=5. The first matrix must be enhanced
                  AbilityDrop("Enhanced Matrix","repeating_matrix","SPM","Magic:Enhanced Matrix",{roll20_Origin:"Free-link",linkadd:"DSP;"+ddata.name},"noduplicate");
                else
                  AbilityDrop("Standard Matrix","repeating_matrix","SPM","Magic:Standard Matrix",{roll20_Origin:"Free-link",linkadd:"DSP;"+ddata.name},"noduplicate");

                AbilityDrop("Standard Matrix","repeating_matrix","SPM","Magic:Standard Matrix",{roll20_Origin:"Free-link",linkadd:"DSP;"+ddata.name},"noduplicate");

              // for(let i=0; i<2; i++ ){
              //   mnewId = generateRowIdNoUnderscore();
              //   mnewInfo = buildPre( "SPM", mnewId );
              //   vals[mnewInfo+"RowID"]=mnewId;
              //   vals[mnewInfo+"Origin"]="Free-link";
              //   flags=addAPIflag( flags, "LinkAdd1", "SPM : " + mnewId + " : DSP : " + ddata.name); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing
              //   if(cmax>=5 && i==0) // We created a spellcaster directly at Circle >=5. The first matrix must be enhanced
              //   vals[mnewInfo+"Type"]="15";}


              //Creation of the Will Talent
              //log("creating WIL");
              newId = generateRowIdNoUnderscore();
              newInfo = buildPre( "T", newId );
              vals[newInfo+"RowID"]=newId;
              vals[newInfo+"Name"]="Wil";
              AutoFill(newInfo+"Name","CreateTalents","Wil");
              vals[newInfo+"Type"]="Special";
            }
            } else
            //JBF@JBF Commented out, I think we don't have the choice than to recreate the talent in double if( tnamearray.indexOf(ddata["Free_C1"].toLowerCase().trim()) ==-1) //Non-spellcaster case, check if the talent already exists
            {
              newId = generateRowIdNoUnderscore();
              newInfo = buildPre( "T", newId );
              vals[newInfo+"RowID"]=newId;
              vals[newInfo+"Name"]=ddata["Free_C1"].trim();
              vals[newInfo+"Type"]="Free";
              AutoFill(newInfo+"Name","CreateTalents",ddata["Free_C1"].trim());
              flags=addAPIflag( flags, "LinkAdd1", "T : " + newId + " : DSP : " + ddata.name); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing
            }
          }

          //Free Enhanced Matrix at Circle 5. Case where we just created the character has already been dealt at C1
          // Now we need to be sure that this is not a second sc discipline above 1
          if(cmax>=5 && cmin <=5 && cmin >1 && ddata["issc"]=="1" &&nbsc5==1) { //This is the first spellcaster discipline above Circle 5
            let nbsm=0,nbem=0,mpre2; //Number of free Standard Matrix and free Enhanced Matrixes
            for( let i = 0; i < marray.length; i++){
              let mpre=buildPre("SPM",marray[i]);
              //log("counting Matrixes " + values[mpre+"Origin"] + " " + values[mpre+"Type"])
              if(values[mpre+"Origin"]=="Free-link" && values[mpre+"Type"]=="15") nbem++;
              if(values[mpre+"Origin"]=="Free-link" &&  (values[mpre+"Type"]||"-10")=="-10")
              {nbsm++;
                mpre2=mpre;// store the prefix of one of the free matrixes
              }
            }
            if(nbem==0 && nbsm==2){
              vals[mpre2+"Type"]="15";
            }  else log("Earthdawn CreateTalent Error - Abnormal number of Free Matrixes - Nb Enhanced" + nbem + "nbStandard " + nbsm);
          } //End creation of Circle 5 Enhanced Matrix


          //Discipline Talents, first pull them all from the compendium

          let comp_query_array=[];
          for(let j=cmin; j<=cmax;j++) {
          if(ddata["DT_C" + j]) {
            dtarr=ddata["DT_C" + j].split(",");
            for( let i = 0; i < dtarr.length; i++)
              comp_query_array.push("Category:Talents Name:"+dtarr[i].trim());
          }
        }
          getCompendiumQuery(comp_query_array, function(comp_data) {


          //Discipline Talents
          for(let j=cmin; j<=cmax;j++) {
          if(ddata["DT_C" + j]) {
            dtarr=ddata["DT_C" + j].split(",");
            for( let i = 0; i < dtarr.length; i++) {
              if( tnamearray.indexOf(dtarr[i].toLowerCase().trim()) ==-1 ) { //process only if the talent doesn't already exist
                newId = generateRowIdNoUnderscore();
                newInfo = buildPre( "T", newId );
                vals[newInfo+"RowID"]=newId;
                vals[newInfo+"Name"]=dtarr[i].trim();
                if(values["NPC"]!=="0") vals[newInfo+"Rank"]=cmax; //When creating an NPC, make the rank==Circle for faster NPC creation
                AutoFill(newInfo+"Name","CreateTalents",dtarr[i].trim(),null,comp_data);
                vals[newInfo+"Type"]="D"+nbdisc+"-"+(j>=13 ? "Master" : (j>=9?"Warden":(j>=5?"Journeyman":"Novice")));
                if(j==1) multinb++;
          } else { //we have been trying to recreate a Talent that was already Existing
            let rid=ridarray[tnamearray.indexOf(dtarr[i].toLowerCase().trim())],
            pre=buildPre("T",rid),
            tt="D"+nbdisc+"-"+(j>=13 ? "Master" : (j>=9?"Warden":(j>=5?"Journeyman":"Novice"))),
            ttm=values[pre+"Type_max"]||"";
            if(values[pre+"Type"]!== tt && !ttm.includes(tt))
              vals[pre+"Type_max"]=(ttm=="" ? tt : (ttm+","+tt));
          }
         } }
          if(ddata["abilityadd_C" + j]){
            //log(ddata["abilityadd_C" + j]);
            let newdata=parseJSON(ddata["abilityadd_C" + j])
            // log("processing new data " + JSON.stringify(newdata));
            if( newdata.names && newdata.code && newdata.rep)
            AbilityDrop(newdata.names,newdata.rep,newdata.code,"",newdata,"AbilityAdd");
          }

      //  }


        //   Talent Options
          //for(let j=cmin; j<=cmax;j++) {
          if(ddata["TO_" + circletotier[j]]) { //Path start at Journeyman
            dtarr=ddata["TO_" + circletotier[j]].split(",");
            newId = generateRowIdNoUnderscore();
            newInfo = buildPre( "T", newId );
            if(ddata.Type=="Questor") vals[newInfo+"Type"]="QD-" + circletoquest[j];
            else if(ddata.Type=="Path-Journeyman" || ddata.Type=="Path-Master") vals[newInfo+"Type"]="PA-"+ circletotier[j];
            else vals[newInfo+"Type"]="TO"+nbdisc+"-" + circletotier[j];
            vals[newInfo+"RowID"]=newId;
            let k=0;
            for( let i = 0; i < dtarr.length; i++) {
              if( tnamearray.indexOf(dtarr[i].toLowerCase().trim()) ==-1 ) { //process only if the talent doesn't already exist
                vals[newInfo+"Name"]="TO-Selector"; // Name shouldn't be empty to not default the ability drop during creation
                vals[newInfo+"TO-Name-"+k]=dtarr[i].trim();
                vals[newInfo+"TO-buttonInfo-"+k]=(["Standard Matrix","Enhanced Matrix","Shared Matrix","Armored Matrix"].includes(dtarr[i].trim()) ? "Magic:" : (ddata.Type=="Questor" ? "Devotions:" : "Talents:")) + dtarr[i].trim();
                k++;
          } } }
        }

          if( nbdisc >= 2 && cmin<=1 && ddata.Type=="Discipline") {
            log("recording multidisciplining");
            vals["LP-D"+nbdisc+"-Talents"]=multinb;
            vals["LP-D"+nbdisc+"-Circle"]=mincircle;
          }
          // if( flags !== "" )
          //   vals[ "APIflag" ] = flags;
          vals[pre+"Circle_max"] = values[pre+"Circle"]; //Store the last Circle processed
          vals[pre+"show-createbutton"] = 0;
          setAttrsLog( vals );
        });
      });
      });
      });
    });
  } catch(err) {log("Earthdawn:ocCreateTalents() error caught: " + err );}
})); //End ocCreateTalents()


// This function creates Talent Options
on("clicked:repeating_talents:addto0 clicked:repeating_talents:addto1 clicked:repeating_talents:addto2 clicked:repeating_talents:addto3 clicked:repeating_talents:addto4 clicked:repeating_talents:addto5 clicked:repeating_talents:addto6 clicked:repeating_talents:addto7 clicked:repeating_talents:addto8 clicked:repeating_talents:addto9 clicked:repeating_talents:addto10 clicked:repeating_talents:addto11 clicked:repeating_talents:addto12 clicked:repeating_talents:addto13 clicked:repeating_talents:addto14 clicked:repeating_talents:addto15", fn(function ocAddTalentOption(eventInfo) {
    'use strict';
    try {

      //Important Comment : Action Buttons in repeating sections DO NOT WORK, if there is an underscore, so it can't follow the usual repeating_section_rowid_code_name syntax. The button itself will have no code
      let att = getAttrib(eventInfo),
          rid = att.split("_")[2],
          pre = buildPre("T",rid),
          vals = {},
          ti=att.replace("addto","T_TO-Name-"),
          attarray=[pre+"Type", ti];

          getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
            for( let i = 0; i < tarray.length; i++) {
              for( let j = 0; j < 16; j++)
                attarray.push( buildPre( "T", tarray[ i ] ) + "TO-Name-"+j);
            }

          getAttrs( attarray , function gaCreateTalents(values) {
            let tn=values[ti]||"",
            ismat=["Standard Matrix","Enhanced Matrix","Shared Matrix","Armored Matrix"].includes(tn.trim()),
            rep=ismat ? "repeating_matrix" : "repeating_talents",
            code= ismat ? "SPM" : "T",
            newdata={names : tn , Type : values[pre+"Type"], roll20_Origin: values[pre+"Type"], rep:rep , code : code};


            for( let i = 0; i < tarray.length; i++) {
              for( let j = 0; j < 16; j++)
              if(values[ buildPre( "T", tarray[ i ] ) + "TO-Name-"+j]==tn) vals[ buildPre( "T", tarray[ i ] ) + "TO-Name-"+j]="";
            }

            //Version in a new lines

            if(ismat){
            AbilityDrop(newdata.names,newdata.rep,newdata.code,"",newdata,"AbilityAdd noduplicate");
            setAttrsLog( vals,null, function(){
              removeRepeatingRow( "repeating_talents_" +rid);
              });
            } else{
            //version in the own line
            AutoFill(buildPre( "T", rid ) + "Name","API",tn,newdata);
            for( let j = 0; j < 16; j++)
            vals[ buildPre( "T", rid ) + "TO-Name-"+j]="";
            setAttrsLog( vals);
            }

        });
      });
    } catch(err) {log("Earthdawn:ocAddtalentOption() error caught: " + err );}
  })); //End ocAddTalentOption()




var updateLPSummary = function fnupdateLPSummary() {
  'use strict';
  try{
  let statarray = ["Dex","Str","Tou","Per","Wil","Cha"];
  let attarray = ["Attrib-Dex-Increases","Attrib-Str-Increases","Attrib-Tou-Increases","Attrib-Per-Increases","Attrib-Wil-Increases","Attrib-Cha-Increases","LP-CreationOffset","LP-CreationOffset-Spells","LS-Speak-Rank","LS-ReadWrite-Rank","LP-Current","LP-Total", "LP-SpellsOption","Per-Step","NbDisc","LP-AttribOption","LP-Extra-Cost","LP-D2-Circle","LP-D3-Circle","LP-D4-Circle","LP-D2-Talents","LP-D3-Talents","LP-D4-Talents"];

  // log ( "EarthDawn : updateLPSummary() ");
  getSectionIDs("repeating_matrix", function gsIdRepeatingMatrix(marray) {
    for( let i = 0; i < marray.length; i++) {
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Rank");
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Origin");
      attarray.push( buildPre( "SPM", marray[ i ] ) + "Type");
    }
    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
      }
      getSectionIDs("repeating_discipline", function gsIdRepeatingTalents(darray) {
        for( let i = 0; i < darray.length; i++) {
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Type");
        }
        getSectionIDsOrdered("repeating_knacks", function gsIdRepeatingKnack(karray) {
          for( let i = 0; i < karray.length; i++){
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Requirements");
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Type");
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Name");
          }
          getSectionIDsOrdered("repeating_spell", function gsIdRepeatingSpells(sparray) {
            for( let i = 0; i < sparray.length; i++){
              attarray.push( buildPre( "SP", sparray[ i ] ) + "Circle");
              attarray.push( buildPre( "SP", sparray[ i ] ) + "Name");
            }
            getSectionIDsOrdered("repeating_threads", function gsIdRepeatingThreads(tiarray) {
              for( let i = 0; i < tiarray.length; i++){
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Rank");
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Type");
                attarray.push( buildPre( "TI", tiarray[ i ] ) + "Name");
              }
              getSectionIDsOrdered("repeating_skills", function gsIdRepeatingSkills(skarray) {
                for( let i = 0; i < skarray.length; i++){
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Rank");
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Type");
                  attarray.push( buildPre( "SK", skarray[ i ] ) + "Name");
                }
                getAttrs( attarray , function gaTalentSummary(values) {
                  'use strict';
                  logvalues( values);

                  var CalcOffset = function(t,d,n) { //calcoffset to be determined depending on the discipline and the tier
                    'use strict';                     //t = tier, d="TO1","V1"...
                    let o;
                    switch(t.toLowerCase()){
                      case "follower":
                      case "novice" : o=0; break;
                      case "adherant":
                      case "adherent":
                      case "journeyman" : o=1; break;
                      case "exemplar" :
                      case "warden" : o=2; break;
                      case "master" : o=3; break;
                      default : log("EarthDawn LPSummary - CalcOffset - Unknown discipline Tier for "+ n +" : "+ JSON.stringify(t)); return 0;
                    }
                    if(!d) return o; //If no discipline number specified, calculate just with the offset due to tier
                    if( isNaN(parseInt(d[d.length-1]))) {log("EarthDawn LPSummary - CalcOffset - Unknown discipline number : "+ JSON.stringify(d)); return o;}
                    else return (Math.min(3,o+parseInt2(d[d.length-1])-1)); //1st discipline, no offset, each subsequent discipline counts as 1 rank higher in the Fibonacci
                  };//end CalcOffset()

                  let fibocost= [0,100,200,300,500,800,1300,2100,3400,5500,8900,14400,23300,37700,61000,98700,159700,258400,418100];
                  let rnk=0,off=0,orig=0,inc=0,st=0;
                  let trnk=8, skrnk=14;
                  let sprnk=getInt(values,"Per-Step")
                  let s="";
                  let val=0;
                  let spval=0;
                  let vals={};
                  s+="*************************************************************** LEGEND POINTS REPORT ***************************************************************\n";
                  // s+="Free LP (corresponding to character creation) : " + getInt(values,"LP-CreationOffset") +"\n";
                  // s+="Current available LP" + getInt(values,"LP-Current") +"\n";
                  // s+=((getInt(values,"LP-SpellsOption")===1) ? "Spells Cost LP \n" : "Spells Cost no LP \n");
                  //LP Cost Attribute
                  if(getInt(values,"LP-AttribOption")==1)
                  for( let i = 0; i < statarray.length; i++) {
                    rnk = getInt( values, "Attrib-" + statarray[ i ]  + "-Increases" );
                    if(rnk>0)  {
                      inc=0;
                      for(let j=1; j<=rnk; j++)   inc+=fibocost[j+4]; //Attributes : Increase 1 is 800, like Rank 5 novice
                      val+=inc;
                      s+= statarray[ i ] + " increased by " + rnk + " LP-Cost : " + inc + "\n";
                    }
                  };

                  //Path and Questor
                  for(let i = 0; i < darray.length; i++) {
                    let pre=buildPre( "DSP", darray[ i ] );
                    rnk = getInt( values, pre + "Circle" );
                    let disc= values[pre+"Type"];
                    switch(disc){
                      case "Path-Journeyman" : off=1; s+= "Path " + (values[pre+"Name"] || "" ) + " costing like Journeyman :"; break;
                      case "Path-Master" : off=3; s+= "Path " + (values[pre+"Name"] || "" ) + " costing like Master :";break;
                      case "Questor" : off=1; s+= "Questor devotion costing like Journeyman :";break;
                      default : off=-1;
                    }
                    if (off !==-1){ //other cases don't cost anything.
                      inc=0;
                      for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                      val+=inc;
                      s+= " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };

                  //Multi-Discipline Extra costs
                  val+=getInt(values,"LP-Extra-Cost");
                  s+= "Extra Cost : " + getInt(values,"LP-Extra-Cost") +"\n";
                  if(getInt(values,"NbDisc")>=2){
                    off=1;
                    inc= getInt(values,"LP-D2-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D2-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 2nd Discipline " + getInt(values,"LP-D2-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D2-Circle") + " extra LP-Cost: " +  inc +"\n";

                  }
                  if(getInt(values,"NbDisc")>=3){
                    off=2;
                    inc= getInt(values,"LP-D3-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D3-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 3rd Discipline " + getInt(values,"LP-D3-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D3-Circle") + " extra LP-Cost: " +  inc +"\n";
                  }
                  if(getInt(values,"NbDisc")>=4){
                    off=3;
                    inc= getInt(values,"LP-D4-Talents") * (fibocost[Math.max(1,6-getInt(values,"LP-D4-Circle"))+off] - fibocost[1+off]);
                    val+=inc;
                    s+= "Multidiscipline to 4th Discipline " + getInt(values,"LP-D4-Talents") + " Discipline Talents to be purchased when lowest Circle was " + getInt(values,"LP-D4-Circle") + " extra LP-Cost: " +  inc +"\n";
                  }

                  //LP Cost Talents
                  for( let i = 0; i < tarray.length; i++) {
                    let pre=buildPre( "T", tarray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="D1-Novice";
                    if(rnk>0){
                      off=-1;
                      if(orig==="Racial")
                      off=0; //Racial talents like Novice
                      if(orig.startsWith("D") && orig!=="Dummy") //Discipline Talent. This is the default
                      off=CalcOffset(orig.substring(3),orig.substring(0,2),values[pre+"Name"]);
                      else if(orig.startsWith("TO")) //Talent Option
                      off=CalcOffset(orig.substring(4),orig.substring(0,3),values[pre+"Name"]);
                      else if (orig.startsWith("PA"))  //Path
                      off=CalcOffset(orig.substring(3),undefined,values[pre+"Name"]);
                      else if (orig.startsWith("QD"))  //Questor
                      off=CalcOffset(orig.substring(3),undefined,values[pre+"Name"]);
                      else if (orig.startsWith("V-"))  //Versatility
                      off=CalcOffset(orig.substring(2),undefined,values[pre+"Name"])+1;
                      if (off !==-1){ //other cases don't cost anything.
                        trnk-=rnk;
                        inc=0;
                        for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                        val+=inc;
                        st+=inc;
                        s+= "Talent " + values[buildPre( "T", tarray[ i ] ) + "Name"] +" with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                      }
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL TALENTS : " + st +"\n";
                  st=0;
                  //LP Cost Matrix
                  for( let i = 0; i < marray.length; i++) {
                    let pre=buildPre( "SPM", marray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Origin" ];
                    inc=0;
                    if(rnk>0){
                      switch (orig.charAt(0)){
                        case "V" : off=CalcOffset(orig.substring(2),undefined,values[pre+"Name"]); break;//Versatility No break
                        case "S" : off=CalcOffset(orig.substring(4),undefined,values[pre+"Name"]); break;//SMO
                        case "T" : off=CalcOffset(orig.substring(4),orig.substring(0,3),values[pre+"Name"]); break;
                        default: off=-1 ;
                      };
                      if(off >=0 ){
                        for(let j=1; j<=rnk; j++)   inc+=fibocost[j+off];
                        val+=inc;
                        st+=inc;
                        trnk-=rnk;
                        s+= "Matrix " + " with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                      }
                    };
                  };
                  s+= "************************************************************************************ SUBTOTAL MATRIX : " + st +"\n";
                  st=0;
                  //LP Cost Knacks
                  for( let i = 0; i < karray.length; i++) {
                    rnk = getInt( values, buildPre( "NAC", karray[ i ] ) + "Requirements" );
                    orig=values[buildPre( "NAC", karray[ i ] ) + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Knack";
                    if(rnk>0 && orig=="Knack")   {
                      inc=fibocost[rnk]; //Knacks cost like Novice Talents, no offset
                      val+=inc;
                      st+=inc;
                      s+= "Knack " + values[buildPre( "NAC", karray[ i ] ) + "Name"] + " with required Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL KNACKS : " + st +"\n";
                  st=0;
                  //LP Cost Skills
                  for( let i = 0; i < skarray.length; i++) {
                    let pre=buildPre( "SK", skarray[ i ] );
                    rnk = getInt( values,  pre+ "Rank" );
                    orig=values[pre + "Type"];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Novice";
                    if(rnk>0){
                      inc=0;
                      skrnk-=rnk;
                      off=CalcOffset(orig,undefined,values[pre+"Name"])+1; //Novice Skills count like Journeyman Talent
                      for(let j=1; j<=rnk; j++) inc+=fibocost[j+off];
                      val+=inc;
                      st+=inc;
                      s+= "Skill " + values[buildPre( "SK", skarray[ i ] ) + "Name"] +" with Origin " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  //ReadWrite and Speak are novice Skills, that count like Journeyman Talents
                  if(getInt(values,"LS-Speak-Rank")>0){
                    skrnk-=getInt(values,"LS-Speak-Rank");
                    inc=0
                    for(let j=1; j<=getInt(values,"LS-Speak-Rank"); j++) inc+=fibocost[j+1];
                    val+=inc;
                    st+=inc;
                    s+= "Skill Speak Languages (that counts as Novice) at Rank " + getInt(values,"LS-Speak-Rank") + " LP-Cost : " + inc +"\n";
                  }
                  if(getInt(values,"LS-ReadWrite-Rank")>0){
                    skrnk-=getInt(values,"LS-ReadWrite-Rank");
                    inc=0
                    for(let j=1; j<=getInt(values,"LS-ReadWrite-Rank"); j++) inc+=fibocost[j+1];
                    val+=inc;
                    st+=inc;
                    s+= "Skill R/W Languages (that counts as Novice) at Rank " + getInt(values,"LS-ReadWrite-Rank") + " LP-Cost : " + inc +"\n";
                  }
                  s+= "************************************************************************************ SUBTOTAL SKILLS & LANGUAGES : " + st +"\n";
                  st=0;
                  //Thread Items
                  for( let i = 0; i < tiarray.length; i++) {
                    let pre=buildPre( "TI", tiarray[ i ] );
                    rnk = getInt( values, pre + "Rank" );
                    orig=values[pre + "Type" ];
                    if(!orig  || !_.isString(orig) || orig=="0") orig="Novice";
                    off=CalcOffset(orig,undefined,values[pre+"Name"]); //Will return undefined if not one of the Tiers
                    if(rnk>0 &&(orig=="Novice"|| orig=="Journeyman"|| orig=="Warden"|| orig=="Master"))
                    {
                      inc=0
                      for(let j=1; j<=rnk; j++) inc+=fibocost[j+off];  //Thread Items like Talents
                      val+=inc;
                      st+=inc;
                      s+= "Thread Item " + values[buildPre( "TI", tiarray[ i ] ) + "Name"] +" with Tier " + orig + " at Rank " + rnk + " LP-Cost : " + inc +"\n";
                    }
                  };
                  s+= "************************************************************************************ SUBTOTAL THREADS : " + st +"\n";
                  st=0;
                  //LP Cost Spells
                  for( let i = 0; i < sparray.length; i++) {
                    rnk = getInt( values, buildPre( "SP", sparray[ i ] ) + "Circle" );
                    if(rnk>0)  {
                      sprnk-=rnk;
                      inc=fibocost[rnk]; //Spells cost like Novice Talents, no offset
                      spval+=inc;
                      st+=inc
                      if(getInt(values,"LP-SpellsOption")===1)
                      s+= "Spell " + values[buildPre( "SP", sparray[ i ] ) + "Name"]  + " of Circle" + rnk + " LP-Cost : " + inc +"\n";
                    };
                  }
                  if(getInt(values,"LP-SpellsOption")===1) {s+= "************************************************************************************ SUBTOTAL SPELLS : " + st +"\n"; val+=spval}
                  st=0;
                  vals["LP-Summary"]=s;
                  vals["LP-Calc"]=val;
                  vals["Talents-Costs"]=trnk;
                  vals["Skills-Costs"]=skrnk;
                  vals["Spells-Costs"]=sprnk;
                  vals["LP-Current-Calc"]=getInt(values,"LP-Total") + getInt(values,"LP-CreationOffset") + ((getInt(values,"LP-SpellsOption")===1)? getInt(values,"LP-CreationOffset-Spells"): 0) -val;
                  setAttrsLog(vals);
                });
              });
            });
          });
        });
      });
    });
  });
} catch(err) {log("Earthdawn:updateLPSummary() error caught: " + err );}
}; // End updateLPSummary()
on("change:repeating_skills:sk_rank change:repeating_skills:sk_type change:repeating_threads:ti_rank change:repeating_threads:ti_type change:repeating_matrix:spm_rank change:repeating_matrix:spm_origin change:repeating_talents:t_rank change:repeating_talents:t_type change:repeating_knacks:nac_requirements change:repeating_knacks:nac_type change:repeating_spell remove:repeating_talents remove:repeating_matrix remove:repeating_spell remove:repeating_knacks remove:repeating_threads remove:repeating_skills change:repeating_discipline remove:repeating_discipline", fn(updateLPSummary) );
on("change:attrib-dex-increases change:attrib-str-increases change:attrib-tou-increases change:attrib-per-increases change:attrib-wil-increases change:attrib-cha-increases change:lp-creationoffset change:lp-creationoffset-spells change:lp-current change:lp-total change:lp-spellsoption change:per-step change:ls-speak-rank change:ls-readwrite-rank change:lp-attriboption change:lp-extra-cost change:nbdisc change:lp-d2-circle change:lp-d3-circle change:lp-d4-circle change:lp-d2-talents change:lp-d3-talents change:lp-d4-talents", fn(updateLPSummary) );





on("clicked:post_update", fn(function ocPost_Update() {
  'use strict';
  try{
  getAttrs([ "record-type","record-reason", "record-item","record-journal", "record-amount-LP" , "record-amount-SP","record-date-throalic","LP-Total","LP-Current","Wealth_Silver"], function(values) {
    let vals = {};
    let d = new Date(),
     n = d.getFullYear()+"-"+(d.getMonth() +1)+"-"+d.getDate(),
     i=(values["record-item"] || "SP"),
     lp= i.startsWith("LP"),
     sp= i.endsWith("SP");

     if(sp) switch((values["record-type"] || "Gain")){
       case "Spend" :
       case "Decrease" : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") - getInt(values,"record-amount-SP"); break;
       case "Gain" :
       case "Refund" : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") + getInt(values,"record-amount-SP"); break;
       default : vals["Wealth_Silver"]=getInt(values,"Wealth_Silver") + getInt(values,"record-amount-SP");
     }

     if(lp) switch((values["record-type"] || "Gain")){
       case "Decrease" :   vals["LP-Total"]=getInt(values,"LP-Total") - getInt(values,"record-amount-LP");
       case "Spend" : vals["LP-Current"]=getInt(values,"LP-Current") - getInt(values,"record-amount-LP"); break;
       case "Gain" : vals["LP-Total"]=getInt(values,"LP-Total") + getInt(values,"record-amount-LP");
       case "Refund" : vals["LP-Current"]=getInt(values,"LP-Current") + getInt(values,"record-amount-LP"); break;
       default :
       vals["LP-Total"]=getInt(values,"LP-Total") + getInt(values,"record-amount-LP");
       vals["LP-Current"]=getInt(values,"LP-Current") + getInt(values,"record-amount-LP");
     }

     vals["record-journal"]= n + "   " + (values["record-date-throalic"] ||"")+ " "
      + ((lp || sp ) ? (values["record-type"] ||"") : "")
      + " "
      + (lp ? (getInt(values,"record-amount-LP") + " LP (New Total " + vals["LP-Current"] + " LP)  ") :"")
      + (lp &&sp ? " & " :"")
      + (sp ? (getInt(values,"record-amount-SP") + " SP (New Total " + vals["Wealth_Silver"] + " SP)  ") :"")
      + " : " + (values["record-reason"] ||"") + "\n" + (values["record-journal"] ||"");
     vals["record-reason"]="";
    setAttrsLog(vals);
  });
} catch(err) {log("Earthdawn:ocPost_Update() error caught: " + err );}
})); //End ocPost_Update




on("clicked:endcreation_post", fn(function ocEndAndPost() {
  'use strict';
  getAttrs([ "Per-Step","LP-Calc", "Spells-Costs", "NPC" ,"Karma_max" , "Recovery-Tests_max" , "DP_max"], function(values) {
    let vals = {};
    // vals["show_tips"] = values["NPC"]=="0"? "1" :"0";
    vals[ "tab" ] = values["NPC"]=="0"? "11" :"1";
    vals[ "tab-adjust" ] = "4";

    vals["CreationMode"]=0;
    vals["LP-CreationOffset-Spells"]=100*(getInt(values,"Per-Step")-getInt(values,"Spells-Costs")); //Spells at creation are level 1 or level 2, so 100 per Rank. Store separately the offset for the number of spells known
    vals["LP-CreationOffset"]=getInt(values,"LP-Calc")-vals["LP-CreationOffset-Spells"]; //Store only the current LP-Cost as the offset
    vals["Karma"]=values["Karma_max"];
    vals["DP"]=values["DP_max"];
    vals["Damage"]=0;
    vals["Wounds"]=0;
    vals["Recovery-Tests"]=values["Recovery-Tests_max"];
    setAttrsLog(vals);
  });
})); //End ocEndCreationAndPost


on("clicked:set_lp_offset", fn(function ocSetLPOffset() {
  'use strict';
  getAttrs([ "LP-Current","LP-Total", "LP-Calc"], function(values) {
    let vals = {};

    vals["LP-CreationOffset"]=getInt(values,"LP-Current")-getInt(values,"LP-Total")+getInt(values,"LP-Calc");
    vals["LP-CreationOffset-Spells"]=0;
    setAttrsLog(vals);
  });
})); //End ocEndCreationAndPost




on("clicked:endcreation_nopost", fn(function ocEndAndNoPost() {
  'use strict';
  let vals = {};
  getAttrs([ "NPC" ,,"Karma_max" , "Recovery-Tests_max" , "DP_max" ], function(values) {
  // vals["show_tips"] = values["NPC"]=="0"? "1" :"0";
  vals[ "tab" ] = values["NPC"]=="0"? "11" :"1";
  vals[ "tab-adjust" ] = "4";
  vals["CreationMode"]=0;
  vals["Damage"]=0;
  vals["Wounds"]=0;

  vals["Karma"]=values["Karma_max"];
  vals["DP"]=values["DP_max"];
  vals["Recovery-Tests"]=values["Recovery-Tests_max"];
  setAttrsLog(vals);
});
})); //End ocEndCreationAndNpoPost




//Autofill can be triggered by various chain of events, that corresponds to direct ways of entering repitems:
//1- Manual creation by player.
//    +Player creates a new rep_item
//    +Player fills in the name
//    +Autofill triggers, with a complete eventInfo. (alternatively, if the name had a forbidden character, sanitize will trigger and call for the Autofill directly with a text)
//    +Autofill looks in compendium, and as backup local database for the data of this rep_item, and if found calls FillEntryData to fill in
//2- API import rep_item
//    +Player creates a new rep_item
//    +Player pastes the rep_item data in the import box
//    +API fills in some of the data including the name, where the marker ApItRiGgEr is added
//    +Autofill triggers with an eventInfo, SourceType player. The ApItRiGgEr is used to differentiate that it comes from API
//    +Autofill looks in compendium, and as backup local database for the data of this rep_item, and if found calls FillEntryData to fill in only the non-API data (not, an exception list exists where everything is overwritten)
//3-Compendium Drop
//    +Player drops a page from the compendium
//    +CompendiumDropMgt triggers, and depending on the Category/data will make several calls to AbilityDrop
//    +AbilityDrop will check for matching existing rep_items. Depending on the mode the existing can be overwritten, quantity can be incremented, or a new line could be created
//    +Autofill is called on all rep_items, looks for compendium/local database and calls FillEntryData
//4-abilityAdd
//    +Player drops a compendium page with a abilityadd field, or choses a race with a abilityadd (racial talent), or circlesup (createtalents) with an abilityadd(Journeyman/Warden/master abilities)
//    +AbilityDrop is called and checks for duplicates
//    +Autofill is called, and looks into compendium, local database, and in last backup the JSON embedded in the abilityadd
//5-Text Import of Creature /Mask
//    +Player creates a new character and pastes the PDF content in the import box
//    +TextImport parses it into a JSON
//    +FIllDataCreature will process the JSON and call AbilityDrop
//    +Abilitydrop will call autofill
//    +Autofill should behave as usual, but in addition should manage existing steps/ranks and adjustments
//    +If it comes from a Mask, it should also adjust positively or negatively (case of mask deletion)
//5-Compendium Drop of Creature
//    +Player drops a creature/NPC from compendium
//    +FillDataCreature is called and then it is like a text import

var AutoFill = function fnAutoFill(eventInfo,trigger,nm,data,comp_data) {
  'use strict';
  try{
    let att =getAttrib(eventInfo);
    if (att==="") return;
    //log("Autofill att " +att + " for nm " + nm + " comp_data " + JSON.stringify(comp_data));
    //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
    let code = repeatSection(3,att);
    let rowid = repeatSection(2,att);
    let pre = buildPre(code,rowid);
    var APItrigger="TrIgGeR";
    let fromAPI=false;
    //Start by splitting the eventInfo to find what we are working with
    let trigger2="",source="";

    //log("AutoFill nm "+ nm+ " JSON " + JSON.stringify(eventInfo) + " from trigger " + trigger + " rowid " +rowid );

    if(_.isString(eventInfo)){
      switch(trigger){
        case "API" : trigger2="API"; fromAPI=true; break;
        case "CreateTalents" : trigger2="CreateTalents"; break;
        case "Import" : trigger2="Import"; break;
        case "AbilityAdd" : trigger2="AbilityAdd"; fromAPI=true; break;
        case "sanitize" : trigger2="player"; break;
        default : log("Autofill unknown call from trigger " + trigger); trigger2="unknown";
      }
    } else {
      switch(eventInfo.sourceType){
        case "player" :
          if( eventInfo.newValue.includes(APItrigger)) {trigger2="API"; fromAPI=true;}
          else trigger2="player";
          break;
        case "API" : trigger2="API"; fromAPI=true; break;
        default :
        //log("Autofill triggered by sheetworker, return");
        return;
      }
    }
  //  log("AutoFill processed in trigger2 " + trigger2);



    getAttrs( [pre+"Name",pre+"Notes",pre+"Rank",pre+"Attribute",pre+"RowID","edition","APIflag","isNamegiver","Dex-Step","Str-Step","Tou-Step","Per-Step","Wil-Step","Cha-Step","Initative-Step","WeightAdjustment","Race"], function gaAutoFill(values) {

      let entry,
      names=[],
      nonexactmatch,found=false,cat,vals={},catarray;
      let compsearch=true; //This is a test switch to bypass the compendium search to test without compendium

      let tname=nm?nm :values[pre+"Name"].replace(APItrigger,"").trim(); //If a name was passed as parameter, we can use it, if not we get the name from getAttrs

      if(fromAPI) vals[pre+"Name"] = tname;


      // //JBF@JBF : some thoughts to be given : I have included all categories, but I believe some categories are actually moot.
      // switch(code){
      //   case "T" : //For Talents/Powers, the place we look in the database depends on the Race
      //     if(values["Race"]=="Creature"){ cat=""; catarray=["Creature Powers","Skills","Talents"];} //This is the list of Category we will look at in order
      //     else if(values["Race"]=="Spirit"){ cat=""; catarray=["Spirit Powers","Talents","Skills"];}
      //     else if(values["Race"]=="Dragon"){ cat=""; catarray=["Dragon Powers","Talents","Skills","Creature Powers"];}
      //     else if(values["Race"]=="Horror"){ cat=""; catarray=["Horror Powers","Talents","Skills","Creature Powers"];}
      //     else cat="Talents:"; break;
      //   case "SK": cat="Skills:"; break;
      //   case "SKL": cat="NA:"; break;
      //   case "SP": cat=""; catarray=["Spells - Illusionist", "Spells - Nethermancer", "Spells - Elementalist", "Spells - Wizard", "Spells - Shaman"]; break; //Spells are in various categories, we can't filter the category
      //   case "ARM":
      //   case "WPN":
      //   case "INV":
      //   case "BL": cat="Goods and Services:"; break;
      //   case "MNT": cat="Mounts:"; break;
      //   case "SPM": cat="Magic:"; break;
      //   case "NAC": cat="Knacks:"; break;
      //   case "MAN": cat="NA:"; break;//There is no category for maneuver, and it is not supported
      //   case "TI": cat="Thread Items:"; break;
      //   default : log("Earthdawn:AutoFill() unknown code: " + code ); return;
      // }
      //
      //
      // getCompendiumPage(cat + tname.replace("\'","%E2%80%99"), compendium_pages => {
      //

       getCompendiumQuery2(BuildCompendiumQuery(tname,code),comp_data, compendium_pages => {

        //log( "Earthdawn-Autofill : Compendium Search result for " + code + ": " + tname + " \n" +  JSON.stringify(compendium_pages));

        if(compsearch && compendium_pages && compendium_pages[0] && compendium_pages[0].data && compendium_pages[0].data.Category){
        //log("Earthdawn-Autofill :Found " + compendium_pages.length + " page(s) in the compendium for"+ code + ": " + tname + " \n");
        let ind=0; //Index of the page we will use... Default is 0, but in some cases, we can make less randomly
        if(code=="T"){ //for talents, we will have to chose between different categories...
          let catarray;
          if(values["Race"]=="Creature")          catarray=["Creature Powers","Skills","Talents","Devotions","Spirit Powers","Dragon Powers","Horror Powers"]; //This is the list of Category we will look at in order
          else if(values["Race"]=="Spirit")       catarray=["Spirit Powers","Creature Powers","Talents","Skills","Devotions","Dragon Powers","Horror Powers"];
          else if(values["Race"]=="Dragon")       catarray=["Dragon Powers","Creature Powers","Talents","Skills","Devotions","Spirit Powers","Horror Powers"];
          else if(values["Race"]=="Horror")       catarray=["Horror Powers","Creature Powers","Talents","Skills","Devotions","Spirit Powers","Dragon Powers"];
          else                                    catarray=["Talents","Skills","Devotions","Horror Powers","Dragon Powers","Spirit Powers","Creature Powers"];

          for(let i=0;i<catarray.length;i++) {//Explore the categories by order
            ind=compendium_pages.findIndex(page => page.data.Category.replace(/\s/,"%20")==catarray[i].replace(/\s/,"%20"));
            if(ind!==-1) {
              //log("Earthdawn-Autofill : Compendium Search result for " + code + ": " + tname + " using "+ JSON.stringify(compendium_pages[ind].data));
              break; //we found it
            }
          }

          if(ind==-1) {
            //log("Earthdawn-Autofill : Compendium Search result for " + code + ": " + tname + " didn't find entry in preferred categories "+ JSON.stringify(catarray) + " defaulting to " + compendium_pages[0].data.Category);
            ind=0;
          }
        }
          entry=compendium_pages[ind].data;
          found=true;
          source="compendium";
          vals[ pre+"buttonInfo"]= entry.Category+":" + tname;


        } else {
          //log("Earthdawn-Autofill :No match in Compendium. for "+ tname + " Using local database");
        }


        if(!found) { //Using the local database
          if(trigger2=="player") vals[ pre+"buttonInfo"]= ""; //If there was a button info, reset it.
          //if(nm && nm.toLowerCase().includes("thread")) log("Autofill "+nm+ "no match in compendium" )


          // if (att==="" || eventInfo["sourceType"] !=="player") return;
          // To populate database from the Excel, Copy all the lines in the Excel, paste within the [], remove the last ,
          let masterdatabase;
          if(values["edition"]=="-1")
          masterdatabase={}; //1879
          else masterdatabase={//ED All editions. Done for ED4, but close enough for other editions

            //Compendium Database is redone by category as a JSON

            "SK":[
              //Skills-PG
              {names: "Acrobatic Defense"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG124"}	,
              {names: "Acting"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"											,roll20_extra_note: "Autofilled - PG191"}	,
              {names: "Air Sailing"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"		,roll20_Target:"6"												,roll20_extra_note: "Talent Autofilled - PG125"}	,
              {names: "Alchemy"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"											,roll20_extra_note: "Autofilled"}	,
              {names: "Animal Bond"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG125"}	,
              {names: "Animal Handling"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"											,roll20_extra_note: "Autofilled"}	,
              {names: "Animal Training"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG127"}	,
              {names: "Anticipate Blow"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG128"}	,
              {names: "Arcane Mutterings"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG128"}	,
              {names: "Artisan"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Artist"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Avoid Blow"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: PD: ?{Target Number, maybe relative to PD|0}"				,roll20_Defensive:"1"		,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Awareness"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"0"										,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Battle Bellow"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"												,roll20_extra_note: "Talent Autofilled - PG130"}	,
              {names: "Battle Shout"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG131"}	,
              {names: "Blade Juggle"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG131"}	,
              {names: "Bribery"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Charge"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG133"}	,
              {names: "Climbing"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"								,roll20_MoveBased:"1"						,roll20_extra_note: "Talent Autofilled - PG134"}	,
              {names: "Conceal Object"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG135"}	,
              {names: "Conversation"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG136"}	,
              {names: "Craft Armor"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Craft Weapon"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Craftsman"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Danger Sense"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG137"}	,
              {names: "Diplomacy"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disarm"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disarm Trap"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"0"				,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disguise"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Distract"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG139"}	,
              {names: "Down Strike"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG140"}	,
              {names: "Emotion Song"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG141"}	,
              {names: "Engaging Banter"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG143"}	,
              {names: "Entertainer"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Etiquette"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG144"}	,
              {names: "Evidence Analysis"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG144"}	,
              {names: "Fast Hand"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG145"}	,
              {names: "First Impression"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG147"}	,
              {names: "Flirting"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Forgery"	,roll20_Attribute:"Dex"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Graceful Exit"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG151"}	,
              {names: "Great Leap"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"					,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG151"}	,
              {names: "Haggle"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG152"}	,
              {names: "Heartening Laugh"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG152"}	,
              {names: "Hypnotize"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG153"}	,
              {names: "Impressive Display"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Talent Autofilled - PG154"}	,
              {names: "Knowledge"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Leadership"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"					,roll20_exactmatch:"1"									,roll20_extra_note: "Talent Autofilled - PG156"}	,
              {names: "Lock Picking"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG157"}	,
              {names: "Maneuver"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Mapmaking"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Melee Weapons,Melee Weapon"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Mimic Voice"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Missile Weapons"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Mount Attack"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG159"}	,
              {names: "Navigation"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG160"}	,
              {names: "Physician"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Picking Pockets"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG161"}	,
              {names: "Pilot Boat"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Read and Write Language"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Research"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG163"}	,
              {names: "Resist Taunt"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"				,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG164"}	,
              {names: "Riposte"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"	,roll20_Mod_Type:"Action"	,roll20_Target:"Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"				,roll20_Defensive:"1"		,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG165"}	,
              {names: "Sailing"	,roll20_Attribute:"Dex"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Second Attack"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"2"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Second Shot"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"2"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Second Weapon"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Seduction"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Shield Bash"	,roll20_Attribute:"Str"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Slough Blame"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG167"}	,
              {names: "Speak Language"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Sprint"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG170"}	,
              {names: "Stealthy Stride"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG170"}	,
              {names: "Streetwise"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Sure Mount"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Knockdown"		,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Surprise Strike"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Swift Kick"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Swimming"	,roll20_Attribute:"Str"		,roll20_Action:"Standard"															,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Tactics"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Taunt"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG173"}	,
              {names: "Throwing Weapons"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG175"}	,
              {names: "Tracking"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG175"}	,
              {names: "Trick Riding"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"						,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG176"}	,
              {names: "Unarmed Combat"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG177"}	,
              {names: "Wheeling Attack"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG178"}	,
              {names: "Wheeling Defense"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG178"}	,
              {names: "Wilderness Survival"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG179"}	,
              {names: "Wound Balance"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Knockdown"		,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG181"}	,
              //Skills - Companion (to be filled later)

            ],

            "T" : [
              //Creature Powers- GM, put first so that it overrides any Talent with identical name
              //Enhanced Sense needs the "nonexactmatch"
              {names: "Ambush"	,Race:"Creature"	,Hardcoded:"Creature-Ambushing_max"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers. It can be activated like the combat options via the icons on top of the sheet"	},
              {names: "Charge"	,Race:"Creature"	,Hardcoded:"Creature-DivingCharging_max"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers. It can be activated like the combat options via the icons on top of the sheet"	},
              {names: "Climbing (Movement)"	,Race:"Creature"				,roll20_Mod_Type:"NoRoll"		},
              {names: "Creature Power"	,Race:"Creature"				,roll20_Mod_Type:"Action"		},
              {names: "Dive"	,Race:"Creature"	,Hardcoded:"Creature-DivingCharging_max"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers. It can be activated like the combat options via the icons on top of the sheet"	},
              {names: "Enhanced Sense", nonexactmatch:"1"	,Race:"Creature"			,roll20_Attribute:"Per"	,roll20_Mod_Type:"Action"		},
              {names: "Fury"	,Race:"Creature"	,Hardcoded:"Creature-Fury"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers."	},
              {names: "Great Leap"	,Race:"Creature"				,roll20_Mod_Type:"NoRoll"		},
              {names: "Hardened Armor"	,Race:"Creature"	,Hardcoded:"Creature-HardenedArmor"	,Checkbox:"1"			,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers."	},
              {names: "Resist Pain"	,Race:"Creature"	,Hardcoded:"Creature-ResistPain"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers."	},
              {names: "Swimming"	,Race:"Creature"				,roll20_Mod_Type:"NoRoll"		},
              {names: "Swooping Attack"	,Race:"Creature"				,roll20_Mod_Type:"NoRoll"		},
              {names: "Willful"	,Race:"Creature"	,Hardcoded:"Creature-Willful"				,roll20_extra_note:"This Power is hardcoded in the character sheet and can be found in the Parameters/Maneuvers."	},

              //Spirit Powers- GM
              {names: "Adaptability"	,Race:"Spirit"		,roll20_Action:"Free"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Aid Summoner"	,Race:"Spirit"	,roll20_Attribute:"CHA"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Astral Portal"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Confusion"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Curse"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Destroy Weapon"	,Race:"Spirit"		,roll20_Action:"NA"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Detect True Element"	,Race:"Spirit"		,roll20_Action:"Standard"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Elemental Aura"	,Race:"Spirit"		,roll20_Action:"NA"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Engulf"	,Race:"Spirit"	,roll20_Attribute:"STR"	,roll20_Action:"Free"						,roll20_Mod_Type:"Damage"							,roll20_extra_note: "Autofilled"}	,
              {names: "Enhance Summoner"	,Race:"Spirit"	,roll20_Attribute:"CHA"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Enrage Element"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Damage"							,roll20_extra_note: "Autofilled"}	,
              {names: "Find"	,Race:"Spirit"	,roll20_Attribute:"PER"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Hardened Armor"	,Race:"Spirit"		,roll20_Action:"NA"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Insubstantial"	,Race:"Spirit"		,roll20_Action:"NA"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Invisibility"	,Race:"Spirit"	,roll20_Attribute:"DEX"	,roll20_Action:"NA"													,roll20_extra_note: "Autofilled"}	,
              {names: "Karma"	,Race:"Spirit"		,roll20_Action:"NA"													,roll20_extra_note: "Autofilled"}	,
              {names: "Manifest"	,Race:"Spirit"		,roll20_Action:"Standard"						,roll20_Mod_Type:"NoRoll"							,roll20_extra_note: "Autofilled"}	,
              {names: "Manipulate Element"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Poison"	,Race:"Spirit"		,roll20_Action:"NA"		,roll20_ArmorType : "None"				,roll20_Mod_Type:"Damage Poison"							,roll20_extra_note: "Autofilled"}	,
              {names: "Remove Element"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Share Knowledge"	,Race:"Spirit"	,roll20_Attribute:"PER"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Soothe"	,Race:"Spirit"	,roll20_Attribute:"CHA"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,
              {names: "Spear"	,Race:"Spirit"	,roll20_Attribute:"STR"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Damage"							,roll20_extra_note: "Autofilled"}	,
              {names: "Temperature"	,Race:"Spirit"	,roll20_Attribute:"WIL"	,roll20_Action:"Standard"						,roll20_Mod_Type:"Action"							,roll20_extra_note: "Autofilled"}	,


              //Dragon Powers - GM
              {names: "Armored Scales"	,Race:"Dragon"	,Hardcoded:"Dragon-HardenedArmor"	,Checkbox:"1"			,roll20_Action:"NA"																								,roll20_extra_note: "Autofilled"}	,
              {names: "Dispel Magic"	,Race:"Dragon"			,roll20_Attribute:"Wil"		,roll20_Action:"Simple"										,roll20_Mod_Type:"Action"														,roll20_extra_note: "Autofilled"}	,
              {names: "Disrupt Fate"	,Race:"Dragon"			,roll20_Attribute:"Wil"		,roll20_Action:"Free"										,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"													,roll20_extra_note: "Autofilled"}	,
              {names: "Dominate Beast"	,Race:"Dragon"			,roll20_Attribute:"Wil"		,roll20_Action:"Standard"										,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"													,roll20_extra_note: "Autofilled"}	,
              {names: "Dragon Breath"	,Race:"Dragon"				,roll20_Rank_Adjust:"15"	,roll20_Action:"Simple"	,Strain:"1"	,roll20_Strain:"1"								,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"													,roll20_extra_note: "Autofilled"}	,
              {names: "Dragonsight"	,Race:"Dragon"			,roll20_Attribute:"Per"		,roll20_Action:"Simple"										,roll20_Mod_Type:"Action"														,roll20_extra_note: "Autofilled"}	,
              {names: "Dragonspeech"	,Race:"Dragon"			,roll20_Attribute:"Cha"		,roll20_Action:"Free"										,roll20_Mod_Type:"Action"														,roll20_extra_note: "Autofilled"}	,
              {names: "Fear"	,Race:"Dragon"			,roll20_Attribute:"Cha"		,roll20_Action:"Simple"										,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"													,roll20_extra_note: "Autofilled"}	,
              {names: "Karma Cancel"	,Race:"Dragon"			,roll20_Attribute:"Wil"		,roll20_Action:"Simple"										,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"													,roll20_extra_note: "Autofilled"}	,
              {names: "Lair Sense"	,Race:"Dragon"			,roll20_Attribute:"Per"		,roll20_Action:"Free"										,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"													,roll20_extra_note: "Autofilled"}	,
              {names: "Poison"	,Race:"Dragon"			,roll20_Attribute:"Tou"		,roll20_Action:"NA"										,roll20_Mod_Type:"Damage Poison"		,roll20_ArmorType:"None"												,roll20_extra_note: "Autofilled"}	,
              {names: "Regeneration"	,Race:"Dragon"			,roll20_Attribute:"Tou"		,roll20_Action:"Simple"							,roll20_DisplayText:"costs 1 Karma ~Decrement:Karma:Min:0"			,roll20_Mod_Type:"Effect"			,roll20_Special:"Recovery"											,roll20_extra_note: "Autofilled"}	,
              {names: "Suppress Magic"	,Race:"Dragon"			,roll20_Attribute:"Wil"		,roll20_Action:"Standard"										,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"													,roll20_extra_note: "Autofilled"}	,
              {names: "Wingbeat"	,Race:"Dragon"			,roll20_Attribute:"Str"		,roll20_Action:"Standard"										,roll20_Mod_Type:"Effect"														,roll20_extra_note: "Autofilled"}	,

              //Horror Powers - GM
              {names: "Animate Dead"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"															},
              {names: "Astral Camouflage"	,Race:"Horror"	,roll20_Action:"Standard"																									},
              {names: "Aura of Awe"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"															},
              {names: "Corrupt Compromise"	,Race:"Horror"	,roll20_Action:"Standard"							,roll20_DisplayText:"Used one Karma Points~Decrement:Karma:1"		,roll20_Mod_Type:"NoRoll"																},
              {names: "Corrupt Karma"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"		,roll20_Special:"CorruptKarma"												,roll20_extra_note:"Corrupt Karma Power is coded in the roll20 Sheet. See Wiki"	},
              {names: "Corrupt Reality"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"															},
              {names: "Cursed Luck"	,Race:"Horror"	,roll20_Action:"Free"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"		,roll20_Special:"CursedLuck"												,roll20_extra_note:"Cursed Luck Power is coded in the roll20 Sheet. See Wiki"	},
              {names: "Damage Shift"	,Race:"Horror"	,roll20_Action:"Simple"									,roll20_Mod_Type:"Damage"		,roll20_ArmorType:"None"														},
              {names: "Disease"	,Race:"Horror"	,roll20_Action:"NA"									,roll20_Mod_Type:"NoRoll"																},
              {names: "Displace"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"NoRoll"																},
              {names: "Disrupt Magic"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"																},
              {names: "Forge Construct"	,Race:"Horror"	,roll20_Action:"Sustained"							,roll20_DisplayText:"Used five Karma Points~Decrement:Karma:5"		,roll20_Mod_Type:"Action"																},
              {names: "Forge Trap"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Effect"																},
              {names: "Harvest Energy"	,Race:"Horror"	,roll20_Action:"Free"									,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"															},
              {names: "Horror Power"	,Race:"Horror"	,roll20_Action:"NA"									,roll20_Mod_Type:"Action"																},
              {names: "Horror Mark"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"															},
              {names: "Horror Thread"	,Race:"Horror"	,roll20_Action:"Standard"							,roll20_DisplayText:"costs 1 Karma ~Decrement:Karma:Min:0"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"															},
              {names: "Karma Boost"	,Race:"Horror"	,roll20_Action:"Free"									,roll20_Mod_Type:"NoRoll"																},
              {names: "Karma Drain"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"															},
              {names: "Poison"	,Race:"Horror"	,roll20_Action:"NA"									,roll20_Mod_Type:"Damage Poison"		,roll20_ArmorType:"None"														},
              {names: "Skin Shift"	,Race:"Horror"	,roll20_Action:"Simple"									,roll20_Mod_Type:"Damage"		,roll20_ArmorType:"None"														},
              {names: "Suppress Mark"	,Race:"Horror"	,roll20_Action:"Standard"																									},
              {names: "Terror"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"															},
              {names: "Unnatural Life"	,Race:"Horror"	,roll20_Action:"Standard"									,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"															},
              //Talents -PG
              {names: "Acrobatic Defense"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG124"}	,
              {names: "Air Dance"	,roll20_Attribute:"Initiative"		,roll20_Action:"Free"	,roll20_Strain:"2"	,roll20_Mod_Type:"Effect"	,roll20_Target:"None"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG124"}	,
              {names: "Air Sailing"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"		,roll20_Target:"6"												,roll20_extra_note: "Talent Autofilled - PG125"}	,
              {names: "Air Speaking"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG125"}	,
              {names: "Animal Bond"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG125"}	,
              {names: "Animal Companion Durability"			,roll20_Action:"NA"	,roll20_Strain:"0"	,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Talent Autofilled - PG126"}	,
              {names: "Animal Possession"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"														,roll20_extra_note: "Talent Autofilled - PG126"}	,
              {names: "Animal Talk"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG127"}	,
              {names: "Animal Training"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG127"}	,
              {names: "Anticipate Blow"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG128"}	,
              {names: "Arcane Mutterings"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG128"}	,
              {names: "Armor Mount"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Talent Autofilled - PG128"}	,
              {names: "Astral Interference"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Astral Sight"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"6"												,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Avoid Blow"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: PD: ?{Target Number, maybe relative to PD|0}"				,roll20_Defensive:"1"		,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Awareness"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"0"										,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG129"}	,
              {names: "Banish"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG130"}	,
              {names: "Bank Shot"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG130"}	,
              {names: "Battle Bellow"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"												,roll20_extra_note: "Talent Autofilled - PG130"}	,
              {names: "Battle Shout"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG131"}	,
              {names: "Blade Juggle"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG131"}	,
              {names: "Blood Share"	,roll20_Attribute:"Tou"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG132"}	,
              {names: "Book Memory"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"		,roll20_Target:"5"												,roll20_extra_note: "Talent Autofilled - PG132"}	,
              {names: "Borrow Sense"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG132"}	,
              {names: "Call Animal Companion"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG133"}	,
              {names: "Call Missile"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG133"}	,
              {names: "Charge"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG133"}	,
              {names: "Claw Frenzy"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG134"}	,
              {names: "Claw Shape"	,roll20_Attribute:"Str"	,roll20_Rank_Adjust:"3"	,roll20_Action:"Simple"	,roll20_Strain:"0"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG134"}	,
              {names: "Climbing"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"								,roll20_MoveBased:"1"						,roll20_extra_note: "Talent Autofilled - PG134"}	,
              {names: "Cobra Strike"	,roll20_Attribute:"Initiative"		,roll20_Action:"Free"	,roll20_Strain:"2"	,roll20_Mod_Type:"Effect"	,roll20_Target:"None"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG135"}	,
              {names: "Cold Purify"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG135"}	,
              {names: "Command Nightflyer"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG135"}	,
              {names: "Conceal Object"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG135"}	,
              {names: "Conversation"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG136"}	,
              {names: "Creature Analysis"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG136"}	,
              {names: "Crushing Blow"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG137"}	,
              {names: "Danger Sense"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG137"}	,
              {names: "Dead Fall"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG137"}	,
              {names: "Diplomacy"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disarm"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"	,roll20_exactmatch:"1"			,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disarm Trap"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"0"				,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Disguise Self"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG138"}	,
              {names: "Dispel Magic"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG139"}	,
              {names: "Distract"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG139"}	,
              {names: "Dominate Beast"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG140"}	,
              {names: "Double Charge"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG140"}	,
              {names: "Down Strike"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG140"}	,
              {names: "Earth Skin"	,roll20_Attribute:"Tou"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG140"}	,
              {names: "Elemental Hold"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG141"}	,
              {names: "Elemental Tongues"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG141"}	,
              {names: "Emotion Song"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG141"}	,
              {names: "Empathic Sense"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG142"}	,
              {names: "Engaging Banter"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG143"}	,
              {names: "Enhance Animal Companion"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG143"}	,
              {names: "Entertainer"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled"}	,
              {names: "Etiquette"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG144"}	,
              {names: "Evidence Analysis"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG144"}	,
              {names: "False Sight"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG145"}	,
              {names: "Fast Hand"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG145"}	,
              {names: "Fearsome Charge"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"2"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG146"}	,
              {names: "Fireblood"	,roll20_Attribute:"Tou"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"	,roll20_Special:"Recovery"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG146"}	,
              {names: "Fire Heal"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG147"}	,
              {names: "First Impression"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG147"}	,
              {names: "Flame Arrow"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG147"}	,
              {names: "Forge Armor"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG148"}	,
              {names: "Forge Weapon"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG148"}	,
              {names: "Frighten"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG149"}	,
              {names: "Gliding Stride"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"					,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG149"}	,
              {names: "Graceful Exit"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG151"}	,
              {names: "Great Leap"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"					,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG151"}	,
              {names: "Haggle"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG152"}	,
              {names: "Heartening Laugh"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG152"}	,
              {names: "Hold Thread"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG152"}	,
              {names: "Hypnotize"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG153"}	,
              {names: "Impressive Display"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Talent Autofilled - PG154"}	,
              {names: "Inspire Others"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"												,roll20_extra_note: "Talent Autofilled - PG154"}	,
              {names: "Iron Constitution"	,roll20_Attribute:"Tou"		,roll20_Action:"Free"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG154"}	,
              {names: "Item History"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG155"}	,
              {names: "Lasting Impression"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG155"}	,
              {names: "Leadership"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"0"							,roll20_exactmatch:"1"							,roll20_extra_note: "Talent Autofilled - PG156"}	,
              {names: "Life Check"	,roll20_Attribute:"Tou"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"			,roll20_Special:"Recovery"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG156"}	,
              {names: "Lifesight"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG156"}	,
              {names: "Lion Heart"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG157"}	,
              {names: "Lock Picking"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG157"}	,
              {names: "Long Shot"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG157"}	,
              {names: "Maneuver"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Melee Weapons,Melee Weapon"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Mimic Voice"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Missile Weapons"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Momentum Attack"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG158"}	,
              {names: "Mount Attack"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG159"}	,
              {names: "Mystic Aim"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG159"}	,
              {names: "Mystic Pursuit"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"2"														,roll20_extra_note: "Talent Autofilled - PG159"}	,
              {names: "Navigation"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG160"}	,
              {names: "Orbiting Spy"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"		,roll20_Target:"6"												,roll20_extra_note: "Talent Autofilled - PG160"}	,
              {names: "Patterncraft"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Patterncraft"										,roll20_extra_note: "Talent Autofilled - PG161"}	,
              {names: "Picking Pockets"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Talent Autofilled - PG161"}	,
              {names: "Power Mask"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG162"}	,
              {names: "Read and Write Language,RW Language,Read & Write Language,Read&Write Language,R/W Language,Read/Write Language"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"RW Language"										,roll20_extra_note: "Talent Autofilled - PG162"}	,
              {names: "Research"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG163"}	,
              {names: "Resist Taunt"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"				,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG164"}	,
              {names: "Riposte"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"	,roll20_Mod_Type:"Action"	,roll20_Target:"Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"				,roll20_Defensive:"1"		,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG165"}	,
              {names: "Safe Path"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG165"}	,
              {names: "Second Attack"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"2"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Second Shot"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"2"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Second Weapon"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Shield Bash"	,roll20_Attribute:"Str"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG166"}	,
              {names: "Slough Blame"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG167"}	,
              {names: "Speak Language"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Speak Language"										,roll20_extra_note: "Talent Autofilled - PG167"}	,
              {names: "Spellcasting"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"		,roll20_Special:"SPL-Spellcasting"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG168"}	,
              {names: "Spirit Hold"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG168"}	,
              {names: "Spirit Mount"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Target:"6"												,roll20_extra_note: "Talent Autofilled - PG168"}	,
              {names: "Spirit Talk"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG169"}	,
              {names: "Spot Armor Flaw"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG169"}	,
              {names: "Sprint"			,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG170"}	,
              {names: "Stealthy Stride"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG170"}	,
              {names: "Steel Thought"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"				,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG170"}	,
              {names: "Steely Stare"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG171"}	,
              {names: "Stopping Aim"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG171"}	,
              {names: "Summon"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG171"}	,
              {names: "Suppress Curse"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG171"}	,
              {names: "Sure Mount"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Knockdown"		,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Surprise Strike"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Swift Kick"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Tactics"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG172"}	,
              {names: "Taunt"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Talent Autofilled - PG173"}	,
              {names: "Temper Flesh"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG173"}	,
              {names: "Tenacious Weave"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG173"}	,
              {names: "Thought Link"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG173"}	,
              {names: "Air Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Arrow Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Beast Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Elementalism"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Elementalism"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Gauntlet Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Illusionism"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Illusionism"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Nethermancy"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Nethermancy"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Rider Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "River Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Scout Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Sea Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Shamanism"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Shamanism"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Sky Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Story Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Thief Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Thread Smithing"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Thread Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "War Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Weapon Weaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Wizardry"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Wizardry"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG174"}	,
              {names: "Throwing Weapons"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG175"}	,
              {names: "Tiger Spring"	,roll20_Attribute:"Initiative"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"	,roll20_Target:"None"			,roll20_Karma_Limit_max:"0"			,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG175"}	,
              {names: "Tracking"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG175"}	,
              {names: "Trick Riding"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"						,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG176"}	,
              {names: "True Shot"			,roll20_Action:"Free"	,roll20_Strain:"2"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG176"}	,
              {names: "True Sight"			,roll20_Action:"NA"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG176"}	,
              {names: "Unarmed Combat"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG177"}	,
              {names: "Versatility"			,roll20_Action:"NA"	,roll20_Strain:"0", roll20_Type:"Racial"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"									,roll20_extra_note: "Talent Autofilled - PG177"}	,
              {names: "Waterfall Slam"			,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"NoRoll"				,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG178"}	,
              {names: "Wheeling Attack"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"1"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG178"}	,
              {names: "Wheeling Defense"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"	,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"						,roll20_MoveBased:"1"		,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG178"}	,
              {names: "Wilderness Survival"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG179"}	,
              {names: "Willforce"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"	,roll20_Mod_Type:"Effect"			,roll20_Special:"SPL-Willforce"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG180"}	,
              {names: "Wind Catcher"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"														,roll20_extra_note: "Talent Autofilled - PG180"}	,
              {names: "Winning Smile"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"														,roll20_extra_note: "Talent Autofilled - PG180"}	,
              {names: "Wood Skin"	,roll20_Attribute:"Tou"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"	,roll20_Special:"Recovery"						,roll20_CombatSlot:"1"				,roll20_extra_note: "Talent Autofilled - PG180"},
              {names: "Wound Balance"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"		,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Knockdown"		,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled - PG181"},

              {names: "AutofillTest"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"		,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"Knockdown"		,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled - PG181"},

              //Talents - Companion
              {names: "Alley Cat Approach"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Animal Leadership"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Astral Domain"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Astral Pocket"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Aura Armor"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"		,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"											,roll20_extra_note: "Autofilled"}	,
              {names: "Bardic Voice"	,roll20_Attribute:"Cha"		,roll20_Action:"Free"	,roll20_Strain:"1"						,roll20_Karma_Limit_max:"0"									,roll20_extra_note: "Autofilled"}	,
              {names: "Beguiling Blade"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Effect"									,roll20_CombatSlot:"1"		,roll20_linkadd:"Conceal Object"		,roll20_extra_note: "Autofilled"}	,
              {names: "Blind Fire"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"MD1: @{target|Target|token_id}"							,roll20_VisionBased:"0"	,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Blood Insight"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Blood of Deaths Sea"	,roll20_Attribute:"Tou"		,roll20_Action:"Simple"	,roll20_Strain:"0"		,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"	,roll20_Special:"Recovery"			,roll20_Resistance:"1"			,roll20_CombatSlot:"1"		,roll20_linkadd:"Fireblood"		,roll20_extra_note: "Autofilled"}	,
              {names: "Bloodhound Form"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"													,roll20_linkadd:"Tracking"		,roll20_extra_note: "Autofilled"}	,
              {names: "Burning Vigor"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Casting Pattern"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"2"			,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Chameleon"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"											,roll20_CombatSlot:"1"		,roll20_linkadd:"Stealthy Stride"		,roll20_extra_note: "Autofilled"}	,
              {names: "Champion Challenge"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"			,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Chilling Strike"			,roll20_Action:"Free"	,roll20_Strain:"1"											,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Concentrated Assault"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"			,roll20_Target:"SDhp1p"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Concise Casting"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"		,roll20_Special:"SPL-Spellcasting"					,roll20_VisionBased:"1"	,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Confront Horror"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"5"			,roll20_Target:"SD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Contest of Wills"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Critical Hit"			,roll20_Action:"Free"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Cutting Words"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack"	,roll20_Target:"SD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Defensive Posture"			,roll20_Action:"Free"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Disarming Smile"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Dream Thief"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"2"															,roll20_extra_note: "Autofilled"}	,
              {names: "Eagle Eye"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"								,roll20_VisionBased:"1"	,roll20_CombatSlot:"1"		,roll20_linkadd:"Awareness"		,roll20_extra_note: "Autofilled"}	,
              {names: "Echolocation"	,roll20_Attribute:"Per"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"									,roll20_CombatSlot:"1"		,roll20_linkadd:"Awareness"		,roll20_extra_note: "Autofilled"}	,
              {names: "Effect Pattern"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"2"											,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Eidetic Memory"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Elemental Mastery"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Elementalism"						,roll20_CombatSlot:"1"		,roll20_linkadd:"Elementalism"		,roll20_extra_note: "Autofilled"}	,
              {names: "Elemental Walk"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"		,roll20_Mod_Type:"Effect"													,roll20_extra_note: "Autofilled"}	,
              {names: "Enthralling Visions"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"			,roll20_Target:"MDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Escape Plan"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"1"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Ethereal Weapon"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Fluid Movement"			,roll20_Action:"Simple"	,roll20_Strain:"1"											,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Forge Flesh"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Glyph of Attunement"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"3"		,roll20_Mod_Type:"Action"	,roll20_Target:"Ask: ?{Target Number|0}"		,roll20_Special:"SPL-Patterncraft"										,roll20_extra_note: "Autofilled"}	,
              {names: "Glyph of Reversal"	,roll20_Attribute:"Per"		,roll20_Action:"Free"	,roll20_Strain:"2"			,roll20_Target:"Ask: ?{Target Number|0}"				,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Glyph of Shielding"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Glyph of Unweaving"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"2"											,roll20_CombatSlot:"1"		,roll20_linkadd:"Dispel Magic"		,roll20_extra_note: "Autofilled"}	,
              {names: "Goring Attack"			,roll20_Action:"Free"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Howl"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"2"			,roll20_Target:"SDhp1p"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Impossible Hide"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"3"		,roll20_Mod_Type:"Action"											,roll20_linkadd:"Stealthy Stride"		,roll20_extra_note: "Autofilled"}	,
              {names: "Influence Missile"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"				,roll20_Defensive:"1"								,roll20_extra_note: "Autofilled"}	,
              {names: "Infuse Memory"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"											,roll20_CombatSlot:"1"		,roll20_linkadd:"False Sight"		,roll20_extra_note: "Autofilled"}	,
              {names: "Lion Spirit"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Living Weapon"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Matrix Sight"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Memory Probe"	,roll20_Attribute:"Cha"		,roll20_Action:"Sustained"	,roll20_Strain:"3"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Missile Lock"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Multi-Charge"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Multi-Shot"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Multi-Strike"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"PDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Nethersoul"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"			,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Netherwalk"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"5"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Perfect Focus"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"0"			,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Plant Talk"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"0"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Rally"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"0"			,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Range Pattern"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"Ask: ?{Target Number|0}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Relentless Recovery"	,roll20_Attribute:"Tou"		,roll20_Action:"Free"	,roll20_Strain:"0"		,roll20_Mod_Type:"Effect"		,roll20_ArmorType:"N/A"	,roll20_Special:"Recovery"			,roll20_Resistance:"1"							,roll20_extra_note: "Autofilled"}	,
              {names: "Resist Pain"			,roll20_Action:"NA"	,roll20_Strain:"0"		,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Autofilled"}	,
              {names: "Safe Thought"			,roll20_Action:"Free"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Second Chance"	,roll20_Attribute:"Cha"		,roll20_Action:"Free"	,roll20_Strain:"3"															,roll20_extra_note: "Autofilled"}	,
              {names: "Shock Treatment"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Snapshot"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack"	,roll20_Target:"PD1: @{target|Target|token_id}"							,roll20_VisionBased:"1"	,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Snatch Talent"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Song of Battle"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"								,roll20_CombatSlot:"1"		,roll20_linkadd:"Inspire Others"		,roll20_extra_note: "Autofilled"}	,
              {names: "Song of Deflection"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"												,roll20_extra_note: "Autofilled"}	,
              {names: "Soul Aegis"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Spirit Strike"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack"	,roll20_Target:"MD1: @{target|Target|token_id}"							,roll20_VisionBased:"1"	,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Spliced Weave"			,roll20_Action:"Simple"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Stone Skin"			,roll20_Action:"Standard"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Storm Shield"			,roll20_Action:"Standard"	,roll20_Strain:"2"															,roll20_extra_note: "Autofilled"}	,
              {names: "Summoning Circle"			,roll20_Action:"Sustained"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Thunderstruck"	,roll20_Attribute:"Str"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"NoRoll"									,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Thunderous Resolve"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Truth Through Lies"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"2"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Undermine"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Unflinching Fortitude"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Venom"	,roll20_Attribute:"Tou"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Damage"		,roll20_ArmorType:"None"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Vicious Wound"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"2"			,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Vine Armor"			,roll20_Action:"Free"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Vital Strike"	,roll20_Attribute:"Tou"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Damage"		,roll20_ArmorType:"MA-Nat"											,roll20_extra_note: "Autofilled"}	,
              {names: "Vital Ward"			,roll20_Action:"Free"	,roll20_Strain:"1"															,roll20_extra_note: "Autofilled"}	,
              {names: "Weapon Breaker"			,roll20_Action:"Free"	,roll20_Strain:"0"		,roll20_Mod_Type:"Damage CC"													,roll20_extra_note: "Autofilled"}	,
              {names: "Witty Repartee"	,roll20_Attribute:"Cha"		,roll20_Action:"Free"	,roll20_Strain:"2"			,roll20_Target:"Ask: ?{Target Number|0}"				,roll20_Defensive:"1"				,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "World Pulse"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"3"			,roll20_Target:"Ask: ?{Target Number|0}"												,roll20_extra_note: "Autofilled"}	,
              //Talents - Mystic Path
              {names: "Swimming"	,roll20_Attribute:"Str"		,roll20_Action:"Standard"																,roll20_extra_note: "Autofilled"}	,
              {names: "Sailing"	,roll20_Attribute:"Dex"		,roll20_Action:"Sustained"																,roll20_extra_note: "Autofilled"}	,
              {names: "Pilot Boat"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"			,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Ancient Bonds"	,roll20_Attribute:"Per"		,roll20_Action:"Special"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Applied Knowledge"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Bane Strike"			,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Bear Mark"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Body Control"	,roll20_Attribute:"Str"		,roll20_Action:"Simple"	,roll20_Strain:"0"		,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Brother of Stone"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Call of Harrow"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Chtard Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Chtard Pierce"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Dance Partner"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Deliberate Assault"			,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"NoRoll"									,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Dive Attack"			,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Earth Bond"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"0"		,roll20_Mod_Type:"Action"		,roll20_ArmorType:"5"											,roll20_extra_note: "Autofilled"}	,
              {names: "Earth Speak"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Earth Walk"			,roll20_Action:"Sustained"	,roll20_Strain:"1"		,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Autofilled"}	,
              {names: "Edo Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"		,roll20_ArmorType:"SDh"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Edo Sweep"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Engaging Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Expansive Expertise"			,roll20_Action:"NA"	,roll20_Strain:"0"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Fire Eater"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Fires of Gahad"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"									,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Focused Strike"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Forest Sense"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Gaze into the Abyss"	,roll20_Attribute:"Per"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Guardians Service"			,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Autofilled"}	,
              {names: "Horror Stalker"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Journeyman"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Liberation"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"												,roll20_extra_note: "Autofilled"}	,
              {names: "Liberator"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Messenger"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Morphism"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"MDh"												,roll20_extra_note: "Autofilled"}	,
              {names: "Outcast"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Patient Resilience"			,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"NoRoll"									,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Purge Karma"	,roll20_Attribute:"Wil"		,roll20_Action:"Simple"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Purification"	,roll20_Attribute:"Wil"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Purifier"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Read River"	,roll20_Attribute:"Per"		,roll20_Action:"Sustained"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Rite of Khopesh"			,roll20_Action:"Sustained"	,roll20_Strain:"2"		,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Autofilled"}	,
              {names: "Scholar"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Sense Captive"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Sense Horrorspawn"	,roll20_Attribute:"Per"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Shatter Will"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Shivoavara Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"											,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Shivoavara Escalation"	,roll20_Attribute:"Dex"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"10"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Shout of Justice"	,roll20_Attribute:"Cha"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDh"												,roll20_extra_note: "Autofilled"}	,
              {names: "Skora Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SDhp1p"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Skora Slam"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"2"		,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Spirit Covenant"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Studied Counter"	,roll20_Attribute:"Per"		,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"MD1: @{target|Target|token_id}"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Tail Dance"	,roll20_Attribute:"Dex"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"10"								,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Tail Dancer"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Tail Spike"	,roll20_Attribute:"Str"	,roll20_Rank_Adjust:"3"	,roll20_Action:"Simple"	,roll20_Strain:"0"		,roll20_Mod_Type:"Damage CC"		,roll20_ArmorType:"PA"							,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Tyrannys Ruin"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"	,roll20_Target:"SD1: @{target|Target|token_id}"												,roll20_extra_note: "Autofilled"}	,
              {names: "Windmaster"	,roll20_Attribute:"Dex"		,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,
              {names: "Wing Blitz"			,roll20_Attribute:"Initiative"	,roll20_Action:"Free"	,roll20_Strain:"1"		,roll20_Mod_Type:"Effect"	,roll20_Target:"None"			,roll20_Karma_Limit_max:"0"					,roll20_CombatSlot:"1"				,roll20_extra_note: "Autofilled"}	,
              {names: "Wisdom of Ages"	,roll20_Attribute:"Wil"		,roll20_Action:"Sustained"	,roll20_Strain:"2"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Wood Speak"	,roll20_Attribute:"Cha"		,roll20_Action:"Standard"	,roll20_Strain:"1"		,roll20_Mod_Type:"Action"													,roll20_extra_note: "Autofilled"}	,
              {names: "Wood Walk"			,roll20_Action:"Simple"	,roll20_Strain:"1"		,roll20_Mod_Type:"NoRoll"													,roll20_extra_note: "Autofilled"}	,
              {names: "Woodsman"			,roll20_Action:"NA"	,roll20_Strain:"0"															,roll20_extra_note: "Autofilled"}	,


              //Questor Devotions


              //Other Abilities

              //SpecialFunction
              {names: "Wil"	,roll20_Attribute:"Wil"		,roll20_Action:"Free"		,roll20_Mod_Type:"Effect"			,roll20_Special:"SPL-Willforce",roll20_Karma_Limit_max:"0"		,roll20_Type:"Special"			,roll20_extra_note: "This is a Dummy Talent created by roll20 to hold the raw Wil attribute for spell effects. Do not delete"},
              {names: "Atk"	, nonexactmatch:"1" ,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"							,roll20_CombatSlot:"1"}	,
              {names: "Attack,Attacks"	,roll20_Attribute:"Dex"		,roll20_Action:"Standard"	,roll20_Strain:"0"	,roll20_Mod_Type:"Attack CC"	,roll20_Target:"PD1: @{target|Target|token_id}"							,roll20_CombatSlot:"1"},
              {names: "Tiger Dance",roll20_Attribute:"Initiative"		,roll20_Action:"Free"		,roll20_Strain:"3"	,roll20_Type:"Special"				,Description:"This is a Dummy Talent when Combining Tiger Spring and Air Dance"	,roll20_Mod_Type:"Effect"								,roll20_CombatSlot:"1"		,roll20_linkadd:"Tiger Spring|Air Dance"					},
              {names: "Cobra Tiger",roll20_Attribute:"Initiative"		,roll20_Action:"Free"		,roll20_Strain:"3"	,roll20_Type:"Special"				,Description:"This is a Dummy Talent when Combining Tiger Spring and Cobra Strike"	,roll20_Mod_Type:"Effect"								,roll20_CombatSlot:"1"		,roll20_linkadd:"Tiger Spring|Cobra Strike"					},
              {names: "Tiger Cobra",roll20_Attribute:"Initiative"		,roll20_Action:"Free"		,roll20_Strain:"3"	,roll20_Type:"Special"				,Description:"This is a Dummy Talent when Combining Tiger Spring and Cobra Strike"	,roll20_Mod_Type:"Effect"								,roll20_CombatSlot:"1"		,roll20_linkadd:"Tiger Spring|Cobra Strike"					},

            ],

            "SP" :[
              //PG Elementalist
              {names: "Air Armor"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 rd"		,roll20_Effect:"+3 Physical Armor"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 Physical Armor), Add Tgt (+Rank)"	}	,
              {names: "Crunch Climb"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"+3 Climbing test bonus"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Add Tgt (+Rank)"	}	,
              {names: "Earth Darts"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL + 3/Physical and -2 Physical Armor"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (-2 Physical Armor), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Flameweapon"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 rd"		,roll20_Effect:"Adds Step 4/D6 fire damage to weapon/Physical"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Add Tgt (+Rank)"	}	,
              {names: "Heat Food"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"Heats and rejuvenates one meal"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Efect (Other) (+1 meal)"	}	,
              {names: "Purify Earth"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"10 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"Purifies earth and soil"				,roll20_SuccessLevels:"Inc Area (+2)"	,roll20_ExtraThreads:"Inc Area (2 yards)."	}	,
              {names: "Purify Water"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 8"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"8"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2)"	}	,
              {names: "Resist Element"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"+3 Physical and Mystic Armor vs. element"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 bonus), Add Tgt (+Rank)"	}	,
              {names: "Shelter"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"4"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"20 yards"	,roll20_Duration:"10 hr"		,roll20_Effect:"Creates a suitable shelter for one person"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Person), Inc Efect (Other) (+2 Detection), Inc Rng (10 yards)"	}	,
              {names: "Snuff"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"WIL + 5"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Area (2 yards)"	}	,
              {names: "Waterproof"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Repels water"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 cubic yard), Inc Rng (10 yards), Add Tgt (+Rank) "	}	,
              {names: "Air Mattress"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"10 hr"		,roll20_Effect:"+2 Recovery test bonus"				,roll20_SuccessLevels:"Add Tgt (+1)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Efect (Other) (-1 hour sleep required, minimum 4 hours), Add Tgt (+Rank)"	}	,
              {names: "Fingers of Wind"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"2"	,roll20_Casting:"6"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"WIL"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (+10 pounds), Inc Rng (10 yards)"	}	,
              {names: "Icy Surface"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 rd"	,roll20_AoE:"60-square-yard area*"	,roll20_Effect:"WIL"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Area (10 square yards)"	}	,
              {names: "Mantle of the Woodland Hunter"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Listen and travel swiftly through the forest to find something"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 to search-related tests), Inc Efect (Other) (+2 Movement Rate)"	}	,
              {names: "Shield Willow"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"+2 to its Physical and Mystic Defense"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 bonus), Add Tgt (+Rank)"	}	,
              {names: "Slow Weapon"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"4 Damage test penalty"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (-2 Damage penalty), Add Tgt (+1) "	}	,
              {names: "Ice Mace and Chain"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL + 2/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Lightning Bolt"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 6/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Add Tgt (+1)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Mantle of the Reflecting Pool"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk +10 min"		,roll20_Effect:"Grant insight into a target through empathy"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 to Conversation tests)"	}	,
              {names: "Plant Feast"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"3"	,roll20_Casting:"6"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk hr"		,roll20_Effect:"WIL + 2"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2),"	}	,
              {names: "Thrive"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"8"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"Accelerates plant growth"				,roll20_SuccessLevels:"Inc Area (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 day of growth), Inc Area (2 yards)"	}	,
              {names: "Winds of Deflection"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Improves Avoid Blow tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Dur (2) "	}	,
              {names: "Air Blast"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"4"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"6 yards wide"	,roll20_Effect:"WIL + 5"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Blizzard Sphere"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MDh"	,roll20_Range:"30 yards"	,roll20_Duration:"Rk rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL + 2/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Elemental Spear"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Varies (see text)"	,roll20_AoE:"Varies (see text)"	,roll20_Effect:"WIL + 4/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Grove Renewal"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk +5 rd"		,roll20_Effect:"Grants the target continual healing"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 damage healed), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Lightning Step"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"0"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+2 to Initiative, Movement Rate and Physical Defense"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 to all effects)"	}	,
              {names: "Uneven Ground"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"	,roll20_AoE:"10-yard radius"	,roll20_Effect:"Penalties to character actions"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Area (2 yards), Rmv Tgt (-Rank) "	,roll20_extra_note: "Elect only one Target. Comparison with MD of other targets has to be done Manually"}	,
              {names: "Earth Staff"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 10 min"		,roll20_Effect:"Increase successes on Elementalism spells"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Wpn Dmg (+2 Steps)"	}	,
              {names: "Fireball"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MDh"	,roll20_Range:"30 yards"	,roll20_Duration:"2 rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL + 4/Physical and Partial Blindness"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards), Rmv Tgt (-Rank)"	}	,
              {names: "Heat Armor"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL/Physical (Armor does not protect)"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"NoArmor"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Nutritious Earth"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"4"	,roll20_Circle:"5"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"A year and a day"	,roll20_AoE:"100-yard radius"	,roll20_Effect:"Makes land fertile"				,roll20_SuccessLevels:"Inc Area (Other)"	,roll20_ExtraThreads:"Inc Area (10 yards)"	}	,
              {names: "Ride the Lightning"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self; 4 miles"	,roll20_Duration:"One rd"		,roll20_Effect:"Travel by lightning"				,roll20_SuccessLevels:"Special"	,roll20_ExtraThreads:"Inc Rng (2 miles)"	}	,
              {names: "Shattering Stone"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL + 5/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards) "	}	,
              {names: "Drastic Temperature"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"6"	,roll20_Casting:"6"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk min"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"WIL + 2/NA"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"NoArmor"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Fireweave"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+2/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Add Tgt (+1)"	}	,
              {names: "Mantle of the Fire Marauder"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Elementalist Circle+2"	,roll20_WilSelect:"Circle"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2)"	}	,
              {names: "Metal Wings"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk +10 min"		,roll20_Effect:"Flight; +6 bonus to Strength for lifting"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Strength bonus), Inc Efect (Other) (+2 Movement Rate), Add Tgt (+Rank)"	}	,
              {names: "Stone Rain"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"WIL+5/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Tossing Earth"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"6"	,roll20_Casting:"6"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk hr"	,roll20_AoE:"10-yard radius"	,roll20_Effect:"WIL"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (+2 Step distance), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Cloud Summon"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"7"	,roll20_Casting:"8"	,roll20_Range:"1 mile (see text)"	,roll20_Duration:"Rk hr"		,roll20_Effect:"WIL + 6"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2)"	}	,
              {names: "Death Rain"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"7"	,roll20_Casting:"MDh"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"	,roll20_AoE:"20-yard radius"	,roll20_Effect:"Step 8 (WIL+8; see text)/Physical"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Area (2-yard radius)"	}	,
              {names: "Earth Surfing"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"6"	,roll20_Range:"Self"	,roll20_Duration:"2 hr"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Creates earth wave"				,roll20_SuccessLevels:"Inc Dur (Other)"	,roll20_ExtraThreads:"Inc Dur (1), Inc Efect (Other) (+2 Movement Rate), Inc Area (2 yards)"	}	,
              {names: "Mantle of the Blood Elf"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Ignore Wound penalties and create temporary obstructions for a price"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2),Inc Rng (10 yards)"	}	,
              {names: "Thunderclap"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"2 rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"6 penalty to Action tests; causes deafness"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (-2 penalty), Inc Rng (2 yards), Rmv Tgt (-Rank)"	,roll20_extra_note: "Elect only one Target. Comparison with MD of other targets has to be done Manually"}	,
              {names: "Whirlwind"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"6"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL + 2/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards), Rmv Tgt (-Rank) "	,roll20_extra_note: "For the extra Spellcasting test, roll directly"}	,
              {names: "Crushing Hand of Earth"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL + 2/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Earth Wall"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"8"	,roll20_Casting:"10"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Create a contiguous wall of earth"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Additional Sections (+2), Inc Rng (10 yards)"	}	,
              {names: "Ironskin"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+3 to Physical Armor, Wound Threshold and Knockdown test"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+1 to all bonuses), Add Tgt (+1)"	}	,
              {names: "Mantle of the Lightning Vanguard"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"3"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk x10 min"		,roll20_Effect:"Target gains flight and increased speed"				,roll20_SuccessLevels:"Inc Dur (Other)"	,roll20_ExtraThreads:"Inc Dur (10), Inc Efect (Other) (+2 Movement Rate), Inc Efect (Other) (+2 Initiative)"	}	,
              {names: "Venomous Fury"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+3 to close combat Damage tests and poison"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 Damage bonus), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Vital Springs"	,roll20_Discipline:"Elementalism"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MDh"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"	,roll20_AoE:"10-yard radius"	,roll20_Effect:"Heals all allies within the area of effect"				,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 Recovery test bonus), Inc Area (2 yards)"	}	,

              //PG Illusionist

              {names: "Assuring Touch"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"+3 to Mystic and Social Defense; +3 Willpower test bonus against fear"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 bonus), Add Tgt (+Rank)"	}	,
              {names: "Best Face"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 min"		,roll20_Effect:"+3 bonus to Charisma-based tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Add Tgt (+1)"	}	,
              {names: "Cloak"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"+3 bonus to stealthy Action tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
              {names: "Disaster"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Create a distraction"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Rng (10 yards)"	}	,
              {names: "Encrypt"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Makes text incomprehensible"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2)"	}	,
              {names: "Ephemeral Bolt"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL+4/Mystic and -2 to Willpower tests"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Fun With Doors"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk + 10 min"		,roll20_Effect:"Creates/alters door appearances"					,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Monstrous Mantle"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+2 close combat Attack and Damage tests, and +2 Physical Defense"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 to all bonuses), Add Tgt (+Rank)"	}	,
              {names: "Send Message"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self (see text)"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Passes a paper message to a chosen target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+20 words), Add Tgt (+1)"	}	,
              {names: "True Ephemeral Bolt"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+1/Mystic and -2 Penalty to next Sensing test"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"1"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (-2 penalty), Inc Efect (Other) (Penalty applies to additional Sensing test), Add Tgt (+1)"	}	,
              {names: "Trust"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"Creates a friendly relationship between magician and target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Unseen Voices"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Creates unseen voices"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Rng (10 yards) "	}	,
              {names: "Blindness"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"Obscures the targets vision"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2)"	}	,
              {names: "Displace Image"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Projects image of the target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Add Tgt (+1)"	}	,
              {names: "Innocent Activity"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk+10 rd"		,roll20_Effect:"Covers up true activity"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Add Tgt (+1)"	}	,
              {names: "Mind Fog"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"WIL+3"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Phantom Flame"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL+6/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "See the Unseen"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 min"		,roll20_Effect:"+5 bonus to sight-based Perception tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 bonus), Add Tgt (+Rank) "	}	,
              {names: "And Then I Woke Up"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"2 rd"		,roll20_Effect:"+5 bonus to Sensing tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 bonus)"	}	,
              {names: "Blinding Glare"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MDh"	,roll20_Range:"10 yards"		,roll20_AoE:"4-yard radius"	,roll20_Effect:"Inflicts the Full Darkness status on everyone in the area of effect"					,roll20_ExtraThreads:"Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Fog of Jeer"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rds"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Enrages and humiliates all within area of effect"					,roll20_ExtraThreads:"Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Nobody Here"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MDh"	,roll20_Range:"Self"	,roll20_Duration:"Rk + 5 min"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Make onlookers ignore a group of characters"					,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (2 yards)"	}	,
              {names: "Phantom Warrior"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Creates three images of the target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Image) Inc Rng (10 yards), Add Tgt (+Rank) "	}	,
              {names: "Clarion Call"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"4"	,roll20_Casting:"MDhp1p"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"N/A"		,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards)"	}	,
              {names: "Great Weapon"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Harries opponents"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Add Tgt (+1)"	}	,
              {names: "Notice Not"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Creates an illusion that the target is not there"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Add Tgt (+1)"	}	,
              {names: "Phantom Lightning"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 7/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"7"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Add Tgt (+1)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Stop Right There"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Suffocation"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"4"	,roll20_Casting:"MDh"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk rds"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL+2/Mystic"	,roll20_WilSelect:"2"		,roll20_EffectArmor:"MA"		,roll20_ExtraThreads:"Inc Dur (2 rounds), Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Unmask"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"0"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+5 to Dispel Magic tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank) "	}	,
              {names: "Bond of Silence"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Add Tgt (+1)"	}	,
              {names: "Eye of Truth"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 min"		,roll20_Effect:"+5 bonus to Sensing tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Add Tgt (+Rank)"	}	,
              {names: "Illusion"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"5"	,roll20_Casting:"6"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"	,roll20_AoE:"10-yard radius"	,roll20_Effect:"Creates illusions"					,roll20_ExtraThreads:"Inc Dur (2 minutes), Inc Rng (10 yards), Inc Area (10 yards)"	}	,
              {names: "Phantom Fireball"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MDh"	,roll20_Range:"40 yards"	,roll20_Duration:"2 rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL+5/Physical and Partial Blindness"	,roll20_WilSelect:"5"		,roll20_EffectArmor:"PA"		,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Presto!"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"6"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rds"		,roll20_Effect:"Links two small openings"					,roll20_ExtraThreads:"Inc Dur (2 rounds), Inc Rng (10 yards)"	}	,
              {names: "Switch"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"Switches magicians appearance with target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards) "	}	,
              {names: "Astral Shadow"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Conceals target from astral space"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Add Tgt (+Rank)"	}	,
              {names: "Chosen Path"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"6"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hrs"	,roll20_AoE:"60 yards"	,roll20_Effect:"WIL+8"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"8"			,roll20_ExtraThreads:"Inc Dur (2 hours), Inc Efct Step (2), Inc Area (10 yards)"	}	,
              {names: "Flying Carpet"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"7"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hrs"		,roll20_Effect:"Creates the classical mode of transportation for magicians"					,roll20_ExtraThreads:"Inc Dur (2 hours), Inc Efct (Other) (+200 pounds), Inc Efct (Other) (+2 Movement Rate)"	}	,
              {names: "Illusory Missiles"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MDh"	,roll20_Range:"40 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"WIL+8/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"8"	,roll20_EffectArmor:"PA"		,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Memory Scribe"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"4"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"WIL+6"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Add Tgt (+1)"	}	,
              {names: "True Missiles"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"WIL+4/Physical and -2 to next Sensing test"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "True Switch"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"Switches magician location with target"				,roll20_SuccessLevels:"None"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (+2 Step distance), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
              {names: "Dancing Dragon"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"4"	,roll20_Circle:"7"	,roll20_Casting:"12"	,roll20_Range:"60 yards"	,roll20_Duration:"Rk rds"		,roll20_Effect:"Illusionist Circle +8/Physical"	,roll20_WilSelect:"Circle"	,roll20_WilEffect:"8"	,roll20_EffectArmor:"PA"		,roll20_ExtraThreads:"Inc Dur (2 rounds), Inc Efct Step (2), Inc Rng (10 yards)"	}	,
              {names: "Silent Stampede"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"4"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Silences sound"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
              {names: "Stampede"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Causes targets to become Harried"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Twisted Tongues"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MDhp1p"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"Jumbles targets speech"					,roll20_ExtraThreads:"Inc Dur (2 minutes), Inc Rng (10 yards)"	}	,
              {names: "Vertigo"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"30 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"2 penalty to Action tests per success"				,roll20_SuccessLevels:"Special"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Success), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Walk Through"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+15 rd"		,roll20_Effect:"Creates temporary pathway through an obstacle"				,roll20_SuccessLevels:"Special"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 success) "	}	,
              {names: "Face Lift"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Removes targets facial features"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Form Exchange"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"4"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"Trade location and appearance with a target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
              {names: "Other Place"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"3"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"1 mile"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Links two doorways"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (1 mile)"	}	,
              {names: "Rebel Limb"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards)"	}	,
              {names: "Shadow Spell"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
              {names: "Stench"	,roll20_Discipline:"Illusionism"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rds"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Prevent actions due to overpowering stench"					,roll20_ExtraThreads:"Inc Rng (10 yards), Inc Area (2 yards)"	}	,

            //PG Nethermancer

            {names: "Astral Spear"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 4/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Bone Circle"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"3"	,roll20_Circle:"1"	,roll20_Casting:"Ask: ?{Target Number|0}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk month"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"Nethermancer Circle"	,roll20_WilSelect:"Circle"		,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2)"	}	,
            {names: "Dark Messenger"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Sends nightflyer to deliver a message"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+Rank words), Inc Efect (Other) (+2 movement rate),"	}	,
            {names: "Ethereal Darkness"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Creates magical darkness"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Experience Death"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk + 5 rd"		,roll20_Effect:"WIL + 5"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards)"	}	,
            {names: "Life Circle of One"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL + 2/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Area (2 yards)"	,roll20_extra_note: "Extra tests have to be rolled directly as Spellcasting"}	,
            {names: "Shadow Meld"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"+ 4 to Stealthy Stride tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Soul Armor"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"+3 to Mystic Armor"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Mystic Armor), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Soulless Eyes"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"+3 to Intimidation tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Spirit Dart"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL + 2/Mystic and reduce Mystic Armor by 2"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (-2 Mystic Armor), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Spirit Grip"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL + 2/Mystic and reduce Defenses by 2."	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (-1 Defenses) "	}	,
            {names: "Aspect of the Fog Ghost"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+3 to close combat Attack and Damage tests, +3 to Physical Defense"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 bonus), Inc Rng (10 yards)"	}	,
            {names: "Chilling Circle"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MDh"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"Nethermancer Circle+4/Mystic"	,roll20_WilSelect:"Circle"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Area (2 yards), Rmv Tgt (-Rank)"	}	,
            {names: "Deaths Head"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Use Frighten as Simple Action"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus to Frighten)"	}	,
            {names: "Nights Edge"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Adds Step 3/D4 cold damage to weapon/Physical and reduces targets"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 Damage Step), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Shadows Whisper"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"100 yards"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"Eavesdrop through a shadow"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (2 yards from shadow), Incr Rng (50)"	}	,
            {names: "Shield Mist"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk +5 rd"		,roll20_Effect:"+ 4 bonus to Avoid Blow tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Summon Fog Ghost"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Nethermancer Circle+10/Mystic"	,roll20_WilSelect:"Circle"	,roll20_WilEffect:"10"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards) "	}	,
            {names: "Arrow of Night"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"2 rd"		,roll20_Effect:"+6 bonus to a missile Damage test and a -2 penalty to Mystic Armor"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 Damage), Inc Efect (Other) (-2 Mystic Armor penalty), Add Tgt (+Rank)"	}	,
            {names: "Aspect of the Bone Spirit"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Binds a bone spirit"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Rng (10 miles)"	}	,
            {names: "Aspect of the Cowardly Skulk"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"3"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Grants a target superior scouting abilities at a cost"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Fog of Fear"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"6"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Allows Frighten use against multiple targets at range"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus to talent), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Grave Message"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"4"	,roll20_Circle:"3"	,roll20_Casting:"6"	,roll20_Range:"20 miles"	,roll20_Duration:"Rk days"		,roll20_Effect:"Sends message to a Namegiver"				,roll20_SuccessLevels:"Inc Rng (+20)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (20 miles)"	}	,
            {names: "Pain"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Cause the target 3 temporary Wounds and reduce movement"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Wound), Inc Rng (10 yards)"	}	,
            {names: "Summon Bone Spirit"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"Ask: ?{Target Number|0}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Summons a bone spirit"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 miles) "	}	,
            {names: "Aspect of the Menacing Tyrant"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Grant target bonuses to social interaction at a cost"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 to Interaction (Intimidate) tests)"	}	,
            {names: "Dark Spy"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"See and hear through a nightflyers senses"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Perception tests), Inc Rng (1 mile), Inc Rng (10 yards)"	}	,
            {names: "Evil Eye"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Improves the effect of Frighten"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 additional Success to Frighten tests)"	}	,
            {names: "Last Chance"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"		,roll20_Effect:"Grants +4 bonus Recovery test to a dead character"				,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Nightflyers Cloak"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk + 10 min"		,roll20_Effect:"Transforms caster into a nightflyer"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 to Perception tests while in creature form)"	}	,
            {names: "Viewpoint"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk + 5 min"		,roll20_Effect:"See through a physical barrier"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2) "	}	,
            {names: "Aspect of the Cruel Physician"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Grants Recovery tests for a price"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Blind"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Target is rendered blind"				,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 to effective Willpower Step), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Circle of Astral Protection"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MDh"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 min"	,roll20_AoE:"8-yard radius"	,roll20_Effect:"+4 to Mystic Armor"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Area (2 yards)"	}	,
            {names: "Dust to Dust"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 8/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"8"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Reverse Withering"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"3"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"		,roll20_Effect:"Restores withered limb"				,roll20_SuccessLevels:"None"	,roll20_ExtraThreads:"NA"	}	,
            {names: "Wither Limb"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"3"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 6/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards) "	}	,
            {names: "Astral Maw"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Nethermancer Circle + 10/Physical"	,roll20_WilSelect:"Circle"	,roll20_WilEffect:"10"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards)"	}	,
            {names: "Bone Shatter"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL + 6/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Special"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (+1 Success), Inc Rng (10 yards)"	}	,
            {names: "Debilitating Gloom"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"Cloud of life-draining mist"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Friendly Darkness"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MDh"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"Creates magical darkness; +2 bonus to one type of Action test for friendly"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Area (2 yards)"	}	,
            {names: "Recovery"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"1 rd"		,roll20_Effect:"Recovery test with a +5 bonus"				,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Step Through Shadow"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self; 100 yards"	,roll20_Duration:"Rk + 5 rd"		,roll20_Effect:"Creates astral passageway"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (+2 Step distance), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Aspect of the Casual Murderer"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"+5 to Attack and Damage tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 bonus)"	}	,
            {names: "Astral Beacon"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"3"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"Creates a beacon in astral space"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Circle), Inc Rng (10 yards)"	}	,
            {names: "Bone Pudding"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"4"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Turns bones to sludge"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+1 Wound), Inc Rng (10 yards)"	}	,
            {names: "Constrict Heart"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"4"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL/NA"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"NoArmor"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards)"	}	,
            {names: "Foul Vapors"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MDh"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"	,roll20_AoE:"10-yard radius"	,roll20_Effect:"WIL + 5/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Area (2 yards), Rmv Tgt (-Rank)"	}	,
            {names: "Restrain Entity"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk min"		,roll20_Effect:"WIL + Nethermancer Circle"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"N/A"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards) "	,roll20_extra_note: "Note that Wil + Nethermancer Circle is currently not implemented. Add Circle Manually"}	,
            {names: "Aspect of the Astral Savant"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Grants unfettered perception into astral space"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 to Astral Sight tests)"	}	,
            {names: "Horror Call"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"6"	,roll20_Circle:"8"	,roll20_Casting:"Ask: ?{Target Number|0}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"Summons and binds a Horror"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Dispel Difficulty)"	}	,
            {names: "Netherblade"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"0"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Allows a weapon to affect targets in astral space."				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Damage), Add Tgt (+Rank)"	}	,
            {names: "Shadow Tether"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Prevents targets from moving and are Harried"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Rng (10 yards)"	}	,
            {names: "Spirit Portal"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"4"	,roll20_Circle:"8"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk x10 min"		,roll20_Effect:"WIL + 10 (see text)"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"10"	,roll20_EffectArmor:"NoDmg"	,roll20_SuccessLevels:"Inc Dur (Other)"	,roll20_ExtraThreads:"Inc Dur (10), Inc Efct Step (2)"	}	,
            {names: "Wither Away"	,roll20_Discipline:"Nethermancy"	,roll20_sThreads:"5"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk month"		,roll20_Effect:"WIL/Mystic"	,roll20_WilSelect:"Wil"		,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2)"	}	,

                  //PG Wizard

            {names: "Astral Sense"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk+10 min"	,roll20_AoE:"30 yards"	,roll20_Effect:"Enhance astral sensing"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Area (10 yards)"	}	,
            {names: "Bedazzling Display of Logical Analysis"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk min"		,roll20_Effect:"+4 bonus to verbal Charisma-based tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Catseyes"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Target gets Low-Light Vision"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Add Tgt (+Rank)"	}	,
            {names: "Divine Aura"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"Glean information about a targets state of being."				,roll20_SuccessLevels:"Special"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Success), Inc Rng (10 yards)"	}	,
            {names: "Flame Flash"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL+5/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Iron Hand"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+3 bonus to close combat Damage tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Mage Armor"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+3 bonus to Physical Armor"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 Physical Armor), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Mind Dagger"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL+2/Mystic and a -2 penalty to Physical Defense"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (-2 penalty to Physical Defense), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Quicken Pace"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"+2 yards to Movement Rate"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Movement Rate), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Speed Reading"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Gives the target a +4 bonus to all Research tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 to Research tests)"	}	,
            {names: "Wall Walker"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"1"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"+4 bonus to Climbing tests."				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Add Tgt (+Rank), Inc Rng (10 yards) "	}	,
            {names: "Astral Shield"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rds"		,roll20_Effect:"+2 to Mystic Defense"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 Mystic Defense), Inc Rng (10 yards)"	}	,
            {names: "Baseline Subtraction"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rds"		,roll20_Effect:"Eliminate the penalties of Astral Interference"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Rng (10 yards)"	}	,
            {names: "Crushing Will"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"50 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"WIL+3/Mystic and a -2 penalty to targets Mystic Defense"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (-2 to Mystic Defense), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Dodge Boost"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"+2 bonus to Avoid Blow tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Rope Ladder"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"2"	,roll20_Casting:"6"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"	,roll20_AoE:"50-yard radius"	,roll20_Effect:"Create ladder from rope"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Area (10 yards)"	}	,
            {names: "Seeking Sight"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"2"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"+3 bonus to ranged Attack tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank) "	}	,
            {names: "Astral Targeting"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Gain a +2 bonus to Spellcasting and Effect tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min)"	}	,
            {names: "Aura Strike"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+3/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Combat Fury"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+10 rd"		,roll20_Effect:"+2 bonus to close combat Attack tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Identify Magic"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"Identifies type of magic"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Efect (Other) (+1 Success), Inc Rng (10 yards)"	}	,
            {names: "Levitate"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"3"	,roll20_Casting:"MDh"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk+10minin"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"Levitate up to 1,000 pounds"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Area (2 yards)"	}	,
            {names: "Wizard Mark"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"3"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Places astral mark on target"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards), Add Tgt (+1) "	}	,
            {names: "Ball of String"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"3"	,roll20_Circle:"4"	,roll20_Casting:"6"	,roll20_Range:"Varies (see text)"	,roll20_Duration:"Rk hr"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2)"	}	,
            {names: "Binding Threads"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+3"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Evolved Consciousness"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk min"		,roll20_Effect:"Grants a +4 bonus to Knowledge and Patterncraft tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus)"	}	,
            {names: "Jugglers Touch"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"4"	,roll20_Casting:"MDh"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk rds"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"WIL + 6/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (2 yards from shadow), Inc Rng (50 yards)"	}	,
            {names: "Lighten Load"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"Ask: ?{Target Number|0}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk hr"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"WIL + 2"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Wizards Cloak"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"4"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk min"		,roll20_Effect:"Increases Mystic Defense against attempts to detect target astrally"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank) "	}	,
            {names: "Flight"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk x 10 min"		,roll20_Effect:"Grants flight at Movement Rate 12"				,roll20_SuccessLevels:"Inc Dur (Other)"	,roll20_ExtraThreads:"Inc Dur (10), Inc Efect (Other) (+2 Movement Rate)"	}	,
            {names: "Giant Size"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"+4 bonus to Strength and Toughness related tests, and Damage tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Mystic Shock"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+4/Mystic"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Sever Talent"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"2 rd"		,roll20_Effect:"Removes the ability to use a talent"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Slow"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Halves movement; 5 penalty to Dexterity-based tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (-2 penalty), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Weapon Back"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"5"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch; 100 yards"	,roll20_Duration:"Rk weeks"		,roll20_Effect:"WIL + 6"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"6"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards) "	}	,
            {names: "Displace Self"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"0"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Enhances Avoid Blow tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2)"	}	,
            {names: "Energy Shield"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Creates a shield of energy to deflect incoming attacks"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (min), Inc Efect (Other) (+2 bonus), Inc Rng (10 yards), Add Tgt (+Rank)"	}	,
            {names: "Loan Spell"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk+10 rd"		,roll20_Effect:"Loans spell to another"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards), Inc Efect (Other) (Matrix is shared between target and caster; 2 threads)"	}	,
            {names: "Rampage"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"Rk+5 rd"		,roll20_Effect:"Grants a +3 bonus to close combat Attack and Damage tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 bonus), Inc Rng (2)"	}	,
            {names: "Razor Orb"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"3"	,roll20_Circle:"6"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+7/Physical and reduces Physical Armor by -4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"7"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Efect (Other) (-2 to Physical Armor), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Sleep"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"6"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rds"	,roll20_AoE:"8-yard radius"	,roll20_Effect:"Puts target to sleep"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (+2 Willpower Step), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Call"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"100 miles"	,roll20_Duration:"1 rd"		,roll20_Effect:"Delivers a message"				,roll20_SuccessLevels:"Inc Efct (Other)"	,roll20_ExtraThreads:"Inc Efect (Other) (+Rank words), Inc Rng (20 miles)"	}	,
            {names: "Confusing Weave"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MDhp1p"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"	,roll20_AoE:"4-yard radius"	,roll20_Effect:"WIL"	,roll20_WilSelect:"Wil"			,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Inc Area (2 yards),"	}	,
            {names: "Dislodge Spell"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+5"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"		,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Hypervelocity"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"7"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+2/NA"	,roll20_EffectArmor:"NoArmor"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"		,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Mystic Net"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"3"	,roll20_Circle:"7"	,roll20_Casting:"MDh"	,roll20_Range:"Self"	,roll20_Duration:"Rk+5 rd"	,roll20_AoE:"16-yard radius"	,roll20_Effect:"WIL+3"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Area (2 yards)"	}	,
            {names: "Spellstore"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"7"	,roll20_Casting:"Ask: ?{Target Number|0}"	,roll20_Range:"Touch"	,roll20_Duration:"Rk hr"		,roll20_Effect:"Temporarily store a spell within an object"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2) "	}	,
            {names: "Astral Catastrophe"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MDh"	,roll20_Range:"30 yards"	,roll20_Duration:"1 Rd"	,roll20_AoE:"6-yard radius"	,roll20_Effect:"WIL+5/Mystic and -2 to all Action tests"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"5"	,roll20_EffectArmor:"MA"	,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Efect (Other) (-2 penalties), Inc Rng (10 yards), Inc Area (2 yards)"	}	,
            {names: "Catch Spell"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"1"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"Self"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+2"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"2"		,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2)"	}	,
            {names: "Compression Bubble"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"WIL+3/Physical"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"3"	,roll20_EffectArmor:"PA"	,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efct Step (2), Inc Rng (10 yards), Add Tgt (+1)"	}	,
            {names: "Karma Cancel"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"40 yards"	,roll20_Duration:"Rk rd"		,roll20_Effect:"Prevents use of Karma"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Rng (10 yards)"	}	,
            {names: "Spell Cage"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MDh"	,roll20_Range:"20 yards"	,roll20_Duration:"Rk+5 rd"	,roll20_AoE:"2-yard radius"	,roll20_Effect:"-5 penalty to Spellcasting and Thread Weaving tests"				,roll20_SuccessLevels:"Inc Dur (+2)"	,roll20_ExtraThreads:"Inc Dur (2), Inc Efect (Other) (-1 penalty), Inc Efect (Other) (+10 Death Rating), Add Tgt (+1)"	}	,
            {names: "Spell Snatcher"	,roll20_Discipline:"Wizardry"	,roll20_sThreads:"2"	,roll20_Circle:"8"	,roll20_Casting:"MD1: @{target|Target|token_id}"	,roll20_Range:"10 yards"	,roll20_Duration:"1 rd"		,roll20_Effect:"WIL+4"	,roll20_WilSelect:"Wil"	,roll20_WilEffect:"4"		,roll20_SuccessLevels:"Inc Efct Step (+2)"	,roll20_ExtraThreads:"Inc Efct Step (2), Inc Rng (10 yards)"	}	,

                ],

            "WPN" :
            [
              //PG
              {names: "Battle Axe"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"6"		,roll20_Qty:"1"	,roll20_UnitWeight:"6"		,roll20_Str_Min:"13"			,roll20_Rank:"7"	,roll20_Size:"5"	}	,
              {names: "Blowgun"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"0,625"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,625"		,roll20_Str_Min:"3"	,roll20_Range:"SR8,LR16"		,roll20_Rank:"1"	,roll20_Size:"1"	}	,
              {names: "Bola"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"		,roll20_Str_Min:"6"	,roll20_Range:"SR12,LR24"		,roll20_Rank:"3"	,roll20_Size:"2"	,roll20_extra_note: "Entangle on one Extra Success, Entangling Difficulty 9"}	,
              {names: "Broadsword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"		,roll20_Str_Min:"12"			,roll20_Rank:"5"	,roll20_Size:"3"	}	,
              {names: "Club"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"3"		,roll20_Qty:"1"	,roll20_UnitWeight:"3"		,roll20_Str_Min:"7"			,roll20_Rank:"3"	,roll20_Size:"2"	}	,
              {names: "Dagger"	,Type:"Weapon"	,MWpn:"Melee"	,RWpn:"Thrown"				,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"		,roll20_Str_Min:"4"	,roll20_Range:"SR10,LR20"		,roll20_Rank:"2"	,roll20_Size:"1"	}	,
              {names: "Dart"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"0,5"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,5"		,roll20_Str_Min:"4"	,roll20_Range:"SR18,LR36"		,roll20_Rank:"1"	,roll20_Size:"1"	}	,
              {names: "Dwarf Sword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"		,roll20_Str_Min:"12"			,roll20_Rank:"4"	,roll20_Size:"2"	}	,
              {names: "Elven Warbow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"	,roll20_Dex_Min:"15"	,roll20_Str_Min:"12"	,roll20_Range:"SR48,LR96"		,roll20_Rank:"5"	,roll20_Size:"5"	}	,
              {names: "Flail"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"	,roll20_Dex_Min:"7"	,roll20_Str_Min:"10"			,roll20_Rank:"5"	,roll20_Size:"3"	}	,
              {names: "Flight Dagger"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"0,75"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,75"		,roll20_Str_Min:"4"	,roll20_Range:"SR20,LR40"		,roll20_Rank:"2"	,roll20_Size:"1"	}	,
              {names: "Hand Axe"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"3"		,roll20_Qty:"1"	,roll20_UnitWeight:"3"		,roll20_Str_Min:"8"			,roll20_Rank:"4"	,roll20_Size:"2"	}	,
              {names: "Hawk Hatchet"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"		,roll20_Str_Min:"8"	,roll20_Range:"SR24,LR48"		,roll20_Rank:"4"	,roll20_Size:"3"	}	,
              {names: "Knife"	,Type:"Weapon"	,MWpn:"Melee"	,RWpn:"Thrown"				,roll20_TotalWeight:"0,625"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,625"		,roll20_Str_Min:"3"	,roll20_Range:"SR8,LR16"		,roll20_Rank:"1"	,roll20_Size:"1"	}	,
              {names: "Lance"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"10"		,roll20_Qty:"1"	,roll20_UnitWeight:"10"		,roll20_Str_Min:"14"			,roll20_Rank:"6"	,roll20_Size:"6"	}	,
              {names: "Light Crossbow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"		,roll20_Str_Min:"9"	,roll20_Range:"SR32,LR64"		,roll20_Rank:"4"	,roll20_Size:"3"	}	,
              {names: "Longbow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"	,roll20_Dex_Min:"13"	,roll20_Str_Min:"11"	,roll20_Range:"SR40,LR80"		,roll20_Rank:"4"	,roll20_Size:"5"	}	,
              {names: "Long Spear"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"7"		,roll20_Qty:"1"	,roll20_UnitWeight:"7"		,roll20_Str_Min:"13"			,roll20_Rank:"5"	,roll20_Size:"5"	}	,
              {names: "Mace"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"		,roll20_Str_Min:"13"			,roll20_Rank:"4"	,roll20_Size:"3"	}	,
              {names: "Medium Crossbow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"7"		,roll20_Qty:"1"	,roll20_UnitWeight:"7"		,roll20_Str_Min:"12"	,roll20_Range:"SR40,LR80"		,roll20_Rank:"5"	,roll20_Size:"4"	}	,
              {names: "Net, Large"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"		,roll20_Str_Min:"8"	,roll20_Range:"SR6,LR12"		,roll20_Rank:"NA"	,roll20_Size:"6"	,roll20_extra_note: "Entangle on one Extra Success, Entangling Difficulty 12"}	,
              {names: "Net, Small"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"		,roll20_Str_Min:"4"	,roll20_Range:"SR6,LR12"		,roll20_Rank:"NA"	,roll20_Size:"3"	,roll20_extra_note: "Entangle on one Extra Success, Entangling Difficulty 12"}	,
              {names: "Pole Arm"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"44842"		,roll20_Qty:"1"	,roll20_UnitWeight:"8"		,roll20_Str_Min:"14"			,roll20_Rank:"7"	,roll20_Size:"5"	}	,
              {names: "Pole Axe"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"10"		,roll20_Qty:"1"	,roll20_UnitWeight:"10"		,roll20_Str_Min:"16"			,roll20_Rank:"8"	,roll20_Size:"6"	}	,
              {names: "Quarterstaff"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"	,roll20_Dex_Min:"7"	,roll20_Str_Min:"6"			,roll20_Rank:"4"	,roll20_Size:"5"	,roll20_extra_note: "+1 to PD when using Defensive Stance"}	,
              {names: "Sap"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"	,roll20_Dex_Min:"7"	,roll20_Str_Min:"3"			,roll20_Rank:"1"	,roll20_Size:"1"	,roll20_extra_note: "+1 to Damage when employing the Attacking to Stun combat option"}	,
              {names: "Scythan Axe"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"3"		,roll20_Qty:"1"	,roll20_UnitWeight:"3"		,roll20_Str_Min:"12"			,roll20_Rank:"5"	,roll20_Size:"3"	}	,
              {names: "Short Sword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"		,roll20_Str_Min:"8"			,roll20_Rank:"4"	,roll20_Size:"2"	}	,
              {names: "Shortbow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"3"		,roll20_Qty:"1"	,roll20_UnitWeight:"3"		,roll20_Str_Min:"8"	,roll20_Range:"SR30,LR60"		,roll20_Rank:"3"	,roll20_Size:"3"	}	,
              {names: "Sling"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"		,roll20_Str_Min:"5"	,roll20_Range:"SR20,LR40"		,roll20_Rank:"2"	,roll20_Size:"2"	}	,
              {names: "Spear"	,Type:"Weapon"	,MWpn:"Melee"	,RWpn:"Thrown"				,roll20_TotalWeight:"3"		,roll20_Qty:"1"	,roll20_UnitWeight:"3"		,roll20_Str_Min:"9"	,roll20_Range:"SR10,LR20"		,roll20_Rank:"4"	,roll20_Size:"3"	}	,
              {names: "Spiked Mace"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"7"		,roll20_Qty:"1"	,roll20_UnitWeight:"7"		,roll20_Str_Min:"13"			,roll20_Rank:"6"	,roll20_Size:"4"	}	,
              {names: "Throwing Axe"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"		,roll20_Str_Min:"7"	,roll20_Range:"SR12,LR24"		,roll20_Rank:"3"	,roll20_Size:"3"	}	,
              {names: "Throwing Dagger"	,Type:"Weapon"		,RWpn:"Thrown"				,roll20_TotalWeight:"0,75"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,75"		,roll20_Str_Min:"4"	,roll20_Range:"SR16,LR32"		,roll20_Rank:"2"	,roll20_Size:"1"	}	,
              {names: "Trispear"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"		,roll20_Str_Min:"11"			,roll20_Rank:"5"	,roll20_Size:"4"	}	,
              {names: "Troll Axe"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"8"		,roll20_Qty:"1"	,roll20_UnitWeight:"8"		,roll20_Str_Min:"17"			,roll20_Rank:"8"	,roll20_Size:"6"	}	,
              {names: "Troll Sling"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"4"		,roll20_Qty:"1"	,roll20_UnitWeight:"4"		,roll20_Str_Min:"10"	,roll20_Range:"SR30,LR60"		,roll20_Rank:"4"	,roll20_Size:"4"	}	,
              {names: "Troll Sword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"6"		,roll20_Qty:"1"	,roll20_UnitWeight:"6"		,roll20_Str_Min:"13"			,roll20_Rank:"6"	,roll20_Size:"4"	}	,
              {names: "Two-Handed Sword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"7"		,roll20_Qty:"1"	,roll20_UnitWeight:"7"		,roll20_Str_Min:"15"			,roll20_Rank:"8"	,roll20_Size:"6"	}	,
              {names: "Warhammer"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"8"		,roll20_Qty:"1"	,roll20_UnitWeight:"8"		,roll20_Str_Min:"15"			,roll20_Rank:"7"	,roll20_Size:"5"	}	,
              {names: "Whip"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"	,roll20_Dex_Min:"7"	,roll20_Str_Min:"7"			,roll20_Rank:"3"	,roll20_Size:"3"	,roll20_extra_note: "Entangle on one Extra Success, Entangling Difficulty 9,May be used to entangle an opponent up to 3 yards away"}	,
              {names: "Windling Bow"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"0,875"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,875"		,roll20_Str_Min:"5"	,roll20_Range:"SR24,LR48"		,roll20_Rank:"3"	,roll20_Size:"2"	}	,
              {names: "Windling Net"	,Type:"Weapon"		,RWpn:"Missile"				,roll20_TotalWeight:"0,75"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,75"		,roll20_Str_Min:"3"	,roll20_Range:"SR6,LR12"		,roll20_Rank:"NA"	,roll20_Size:"2"	}	,
              {names: "Windling Polearm"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"2"		,roll20_Qty:"1"	,roll20_UnitWeight:"2"		,roll20_Str_Min:"7"			,roll20_Rank:"4"	,roll20_Size:"2"	}	,
              {names: "Windling Spear"	,Type:"Weapon"	,MWpn:"Melee"	,RWpn:"Thrown"				,roll20_TotalWeight:"0,5"		,roll20_Qty:"1"	,roll20_UnitWeight:"0,5"		,roll20_Str_Min:"4"	,roll20_Range:"SR8,LR16"		,roll20_Rank:"2"	,roll20_Size:"1"	}	,
              {names: "Windling Sword"	,Type:"Weapon"	,MWpn:"Melee"					,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"		,roll20_Str_Min:"6"			,roll20_Rank:"3"	,roll20_Size:"1"	}	,
            ],
            "BL" :
            [
              //PG
              {names: "Absorb Blow"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"2"			,roll20_extra_note: "Single Use - Absorbs 12 Damage"}	,
              {names: "Astral-Sensitive Eye"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"2"			,roll20_extra_note: "1 Strain - Astral Sensing +1"}	,
              {names: "Bone Charm, Common"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"1"			,roll20_extra_note: "Permanent - Recovery Tests +1"}	,
              {names: "Darksight Eye"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"2"			,roll20_extra_note: "Single Use - Absorbs 12 Damage"}	,
              {names: "Death Cheat"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Permanent - Grants Low Light Vision"}	,
              {names: "Desperate Blow"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Single Use - Upon death, Recovery test at +6 to revive"}	,
              {names: "Desperate Spell"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Reusable - +6 to Attack or Damage Test"}	,
              {names: "Garlen Stone"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"4"			,roll20_extra_note: "Reusable - +6 to Spellcasting or Effect Test"}	,
              {names: "Horn Needle"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Reusable - 2 Strain - Cures 1 Wound"}	,
              {names: "Horror Fend"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Reusable - 2 Strain - +3 Tou and MD against Poison/Disease"}	,
              {names: "Initiative Booster"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"4"			,roll20_extra_note: "Reusable - 1 Strain - +3 PD & MD for 1 rd"}	,
              {names: "Strength Booster"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"2"			,roll20_extra_note: "Reusable - +1 Initiative per strain"}	,
              {names: "Targeting Eye"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"2"			,roll20_extra_note: "Reusable - +1 Strength per 2 strain"}	,
              {names: "Wound Balance"	,Type:"Blood Charm"						,roll20_TotalWeight:"1"		,roll20_Qty:"1"	,roll20_UnitWeight:"1"				,roll20_Damage_Blood_Magic:"3"			,roll20_extra_note: "Reusable - +2 Ranged Attack for 1 strain"}
            ],
            "INV" :
            [
              //PG
            ],

            "TI" :
            [
              //PG
            ],

            "SPM" :
            [
              //N / A
            ],

            "SKL" :
            [
              //N / A
            ],

            "MAN" :
            [
              //N / A
            ],

            "NAC" :
            [
              //N / A
            ],

            "ARM" :
            [
              //PG

              {names: "Blood Pebble"	,Type:"Armor"			,roll20_Phys:"5"	,roll20_Myst:"3"	,roll20_IP:"1"	,roll20_TotalWeight:"0"		,roll20_Qty:"1"	,roll20_UnitWeight:"0"				,roll20_Damage_Blood_Magic:"4"			}	,
              {names: "Chain Mail"	,Type:"Armor"			,roll20_Phys:"7"	,roll20_Myst:"0"	,roll20_IP:"3"	,roll20_TotalWeight:"40"		,roll20_Qty:"1"	,roll20_UnitWeight:"40"							}	,
              {names: "Crystal Plate"	,Type:"Armor"			,roll20_Phys:"7"	,roll20_Myst:"7"	,roll20_IP:"5"	,roll20_TotalWeight:"90"		,roll20_Qty:"1"	,roll20_UnitWeight:"90"							}	,
              {names: "Crystal Ringlet"	,Type:"Armor"			,roll20_Phys:"4"	,roll20_Myst:"4"	,roll20_IP:"2"	,roll20_TotalWeight:"45"		,roll20_Qty:"1"	,roll20_UnitWeight:"45"							}	,
              {names: "Espagra Cloak"	,Type:"Armor"			,roll20_Phys:"3"	,roll20_Myst:"1"	,roll20_IP:"0"	,roll20_TotalWeight:"10"		,roll20_Qty:"1"	,roll20_UnitWeight:"10"							}	,
              {names: "Fernweave"	,Type:"Armor"			,roll20_Phys:"2"	,roll20_Myst:"3"	,roll20_IP:"0"	,roll20_TotalWeight:"15"		,roll20_Qty:"1"	,roll20_UnitWeight:"15"							}	,
              {names: "Hardened Leather"	,Type:"Armor"			,roll20_Phys:"5"	,roll20_Myst:"0"	,roll20_IP:"1"	,roll20_TotalWeight:"20"		,roll20_Qty:"1"	,roll20_UnitWeight:"20"							}	,
              {names: "Hide Armor"	,Type:"Armor"			,roll20_Phys:"5"	,roll20_Myst:"1"	,roll20_IP:"1"	,roll20_TotalWeight:"25"		,roll20_Qty:"1"	,roll20_UnitWeight:"25"							}	,
              {names: "Leather"	,Type:"Armor"			,roll20_Phys:"3"	,roll20_Myst:"0"	,roll20_IP:"0"	,roll20_TotalWeight:"15"		,roll20_Qty:"1"	,roll20_UnitWeight:"15"							}	,
              {names: "Living Crystal"	,Type:"Armor"			,roll20_Phys:"6"	,roll20_Myst:"3"	,roll20_IP:"2"	,roll20_TotalWeight:"0"		,roll20_Qty:"1"	,roll20_UnitWeight:"0"				,roll20_Damage_Blood_Magic:"5"			}	,
              {names: "Obsidiman Skin"	,Type:"Armor"			,roll20_Phys:"3"	,roll20_Myst:"1"	,roll20_IP:"0"	,roll20_TotalWeight:"20"		,roll20_Qty:"1"	,roll20_UnitWeight:"20"							}	,
              {names: "Padded Cloth"	,Type:"Armor"			,roll20_Phys:"2"	,roll20_Myst:"0"	,roll20_IP:"0"	,roll20_TotalWeight:"5"		,roll20_Qty:"1"	,roll20_UnitWeight:"5"							}	,
              {names: "Padded Leather"	,Type:"Armor"			,roll20_Phys:"4"	,roll20_Myst:"0"	,roll20_IP:"0"	,roll20_TotalWeight:"20"		,roll20_Qty:"1"	,roll20_UnitWeight:"20"							}	,
              {names: "Plate Armor"	,Type:"Armor"			,roll20_Phys:"9"	,roll20_Myst:"0"	,roll20_IP:"4"	,roll20_TotalWeight:"60"		,roll20_Qty:"1"	,roll20_UnitWeight:"60"							}	,
              {names: "Ring Mail"	,Type:"Armor"			,roll20_Phys:"6"	,roll20_Myst:"0"	,roll20_IP:"2"	,roll20_TotalWeight:"30"		,roll20_Qty:"1"	,roll20_UnitWeight:"30"							}	,
              {names: "Wyvern Skin"	,Type:"Armor"			,roll20_Phys:"8"	,roll20_Myst:"1"	,roll20_IP:"3"	,roll20_TotalWeight:"50"		,roll20_Qty:"1"	,roll20_UnitWeight:"50"							}	,
              {names: "Body"	,Type:"Shield"			,roll20_Phys:"3"	,roll20_Myst:"0"	,roll20_IP:"2"	,roll20_TotalWeight:"15"	,roll20_Shatter:"21"	,roll20_Qty:"1"	,roll20_UnitWeight:"15"							}	,
              {names: "Buckler"	,Type:"Shield"			,roll20_Phys:"1"	,roll20_Myst:"0"	,roll20_IP:"0"	,roll20_TotalWeight:"3"	,roll20_Shatter:"17"	,roll20_Qty:"1"	,roll20_UnitWeight:"3"							}	,
              {names: "Crystal Buckler"	,Type:"Shield"			,roll20_Phys:"1"	,roll20_Myst:"1"	,roll20_IP:"0"	,roll20_TotalWeight:"5"	,roll20_Shatter:"17"	,roll20_Qty:"1"	,roll20_UnitWeight:"5"							}	,
              {names: "Crystal Raider"	,Type:"Shield"			,roll20_Phys:"2"	,roll20_Myst:"2"	,roll20_IP:"2"	,roll20_TotalWeight:"15"	,roll20_Shatter:"18"	,roll20_Qty:"1"	,roll20_UnitWeight:"15"							}	,
              {names: "Ferndask"	,Type:"Shield"			,roll20_Phys:"1"	,roll20_Myst:"2"	,roll20_IP:"2"	,roll20_TotalWeight:"5"	,roll20_Shatter:"16"	,roll20_Qty:"1"	,roll20_UnitWeight:"5"							}	,
              {names: "Footmans"	,Type:"Shield"			,roll20_Phys:"2"	,roll20_Myst:"0"	,roll20_IP:"1"	,roll20_TotalWeight:"10"	,roll20_Shatter:"19"	,roll20_Qty:"1"	,roll20_UnitWeight:"10"							}	,
              {names: "Riders"	,Type:"Shield"			,roll20_Phys:"2"	,roll20_Myst:"0"	,roll20_IP:"1"	,roll20_TotalWeight:"8"	,roll20_Shatter:"19"	,roll20_Qty:"1"	,roll20_UnitWeight:"8"							}
                        ]
          };

          let database = masterdatabase[code];
          let race=values["Race"];

          tname=tname.replace(/\s/g, '').replace(APItrigger,"").toLowerCase(); //We now simplify tname to avoid case sensitivity


          for(let i=0; i< database.length;i++){
            entry=database[i];
            let matchrace= !entry.Race || (race == entry.Race); //if the entry has a race like Creature, Spirit, Dragon or Horror, it is a power specific to this race, and only applies if the character is from this race. Note that Horrors and Dragons are in fact race==Creature
            names=entry.names.toLowerCase().replace(/\s/g, '').split(","); //Array of possible names for the database entry
            nonexactmatch=(entry.roll20_nonexactmatch=="1" || entry.nonexactmatch=="1"); //If true we accept a non exact match
            //nonexactmatch=true; //JBF@JBF : turning back to only exact matches
            if( matchrace && (names.find(element => ((tname == element) || ( nonexactmatch && tname.includes(element)))))){
              found=true;
              i=database.length;
            }
          }

          if(found) {
          //log("Earthdawn Autofill found it in local database" + JSON.stringify(entry));
          //if(nm && nm.toLowerCase().includes("thread")) log("Autofill "+nm+ " found match in local database" )

          source="local";
        }

        //if(nm && nm.toLowerCase().includes("thread")) log("Autofill "+nm+ " testing the Abilityadd " + found + " trigger "+trigger + " data "+JSON.stringify(data));

          if(!found && trigger=="AbilityAdd" && data) //For an add ability, fall back to the JSON if not found somewhere else {
            {
              entry=data;
              source="AbilityAdd";
              found=true;
              //log("Didn't find it, but falling back to the passed data!! "+tname);
            }

        } //End of search in local database
        //Process the data found


        if(fromAPI){
          source="text Import";
          if(found) {
            if(data.Name && data.Name.toLowerCase().trim()=="tiger spring") data.roll20_Attribute="Initiative"; //Overwrite Tiger Spring because it is an exception
            if(data.Name && data.Name.toLowerCase().trim()=="true sight") data.roll20_Attribute="Per"; //Overwrite True Sight because it is an exception
            entry=mergeJSON(data,entry); //merge the JSON with priority on the import
            //log("merged data is " +  JSON.stringify(entry));
          }
          else entry=data;
          found=true;
        }

        setAttrsLog(vals);
        if(found) FillEntryData(eventInfo,tname,trigger2,source,entry); //Pass the found data to FillEntryData

      });
    });
  } catch(err) {log("Earthdawn:AutoFill() error caught: " + err );}
}; //end AutoFill()
  on("change:repeating_talents:t_name change:repeating_skills:sk_name change:repeating_spell:sp_name change:repeating_weapons:wpn_name change:repeating_blood:bl_name change:repeating_armor:arm_name", fn(AutoFill));
  //In updateCharacterSheet, Autofill is triggered by rewriting the name




//Given the different source of data with the addition of the compendium, the original Autofill functionality has been split in several Functions
//FillEntryData, given a JSON from the compendium or from the local database will fill the data to the referenced repitem
     var FillEntryData = function fnFillEntryData(eventInfo,tname,trigger,source,entry) {
      'use strict';
      try{

      let fromAPI= (trigger=="API" || trigger== "text Import");

      //Start by splitting the eventInfo to find what we are working with

      let att =getAttrib(eventInfo);
      //log("Fillentry att " +att);
      if (att==="" || !entry) return;
      //after this line, because eventInfo is either a roll20 eventInfo, or a fullname string substitute, we know for a fact that we have att in the full name format
      let code = repeatSection(3,att);
      let rowid = repeatSection(2,att);
      let pre = buildPre(code,rowid);
      let vals={};

      //if(tname && tname.toLowerCase().includes("thread")) log("FillEntry "+tname+ "no match in compendium" )

      //log("Earthdawn - FillEntryData " + eventInfo+ " trigger " + trigger + " tf " + tname + " data "+  JSON.stringify(entry) );

      //log("Earthdawn - FillEntryData "+ " tf " + tname);// + " data "+  JSON.stringify(entry) );

      //compendium list of fields for which we will push data from the database
      let fields=[],notesnm="";

      switch(code){
        case "T" :
        case "SK":
        fields=["SuccessText","DisplayText","FailText","Attribute","Rank-Adjust","Action","Strain","StrainAdvanced","Mod-Type","Target","ArmorType","Special","Karma-Limit","Karma-Limit_max","Defensive","MoveBased","CombatSlot","Type","Class","DP-Limit","DP-Limit_max","Duration","sayTotalSuccess","Poison-Type","Onset","Interval_Dur","Interval_Nb","Poison-Duration","PoisonDisease"];
        notesnm="Notes";
        break;
        case "SKL":
        fields=["Speak","Speak-T","ReadWrite","ReadWrite-T"];
        notesnm="";
        break;
        case "NAC":
        fields=["Restrictions","SuccessText","DisplayText","FailText","Attribute","Rank-Adjust","Action","Strain","StrainAdvanced","Mod-Type","Target","ArmorType","Special","Karma-Limit","Karma-Limit_max","Defensive","MoveBased","CombatSlot","DP-Limit","DP-Limit_max","Type","Duration","sayTotalSuccess"];
        notesnm="Notes";
        break;
        case "SP":
        fields=["Discipline","sThreads","Circle","Casting","Range","Duration","AoE","Effect","WilSelect","WilEffect","EffectArmor","SuccessLevels","ExtraThreads","Strain","StrainAdvanced"];
        notesnm="Notes";
        break;
        case "WPN":
        fields=["Rank","Size","CloseCombat","CloseCombat_max","Rank-Adjust","CombatSlot","Karma-Limit_max"];
        notesnm="Date";
        break;
        case "INV":
        fields=["UnitWeight"]; //Decision to be taken between Weight and UnitWeight
        notesnm="Notes";
        break;
        case "BL":
        fields=["Damage-Blood-Magic"];
        notesnm="Effects";
        break;
        case "MNT":
        fields=["Speed","Carry","Feed","Stable","Weight"];
        notesnm="";
        break;
        case "ARM":
        fields=["Phys","Myst","IP","IP_max","Piece"];
        notesnm="Notes";
        break;
        case "TI":
        fields=["Type","Effects"];
        notesnm="Description";
        break;
        case "SPM":
        fields=["Type","Origin"];
        notesnm="";
        break;
        case "MAN":
        fields=["Type"];
        notesnm="Desc";
        break;
        default : log("Earthdawn:FillEntryData() unknown code: " + code ); return;
      }

      let attarray=["Adjustment-Notes","Race", "Movement","SrRating",pre+"Name",pre+"Notes",pre+"Rank",pre+"Rank-Adjust",pre+"Attribute",pre+"RowID","edition","APIflag","isNamegiver","Dex-Step","Str-Step","Tou-Step","Per-Step","Wil-Step","Cha-Step","Initiative-Step","WeightAdjustment"];
      if(entry.roll20_attmodnm) attarray.push(entry.roll20_attmodnm);

      getAttrs(attarray , function gaFillEntryData(values) {

        function singleAttr( key, val) {
          //let vals={};
          vals[ pre + key ] = val;
          //setAttrsLog( vals );
        }
        let notes="",stepisrank;

        //Certain abilities do a direct adjustment to values
        if(entry.roll20_attmodnm && !values["Adjustment-Notes"].includes(entry.roll20_attmodnm)){
          vals[entry.roll20_attmodnm]=getInt(values,entry.roll20_attmodnm)+parseInt2(entry.roll20_attmodval)
          vals["Adjustment-Notes"]=tname + " : " + entry.roll20_attmodnm + " Adjusted by " + parseInt2(entry.roll20_attmodval) + " to value " +vals[entry.roll20_attmodnm]
          +"\n"+values["Adjustment-Notes"];
        }

        //Some exceptions need to be taken into account

        if(["tigerspring","truesight"].includes(tname.toLowerCase().replace(/\s/,""))) stepisrank=true; //This talents are defined in the books with no attribute, but are used with an attribute, so the listed step
        if( values["isNamegiver"] == "0" && (["swimming","greatleap"].includes(tname.toLowerCase().replace(/\s/,"")))) { //Those correspond to Talents, but are in fact slightly different
          stepisrank=true;
          entry.roll20_Attribute=undefined;
          entry.roll20_Mod_Type="NoRoll";
        }
        if( values["isNamegiver"] == "0" && (["surprisestrike"].includes(tname.toLowerCase().replace(/\s/,"")) || tname.match(/enhanced\s*sense/i))) stepisrank=true; //Surprise Strike is listed as a Rank for Creatures, and not as a step

        if( values["isNamegiver"] == "0" && !entry.roll20_Mod_Type && !entry.Step) entry.roll20_Mod_Type="NoRoll"; //For Creatures, Powers that didn't come with a step are most of the time NoRoll


        if(code=="ARM") singleAttr("Type", (entry.Type =="Shield") ? -1 : 1);

        if(code=="NAC" && entry.roll20_Requirements ){ //for Knacks, requirements are in the form of "Rank X", sometimes with "Rank X, somethingelse"
          let m=entry.roll20_Requirements.match(/Rank\s*(\d+)/i);
          if(m) singleAttr("Requirements", m[1]);
          else log("Earthdawn.FillEntrydata unrecognized Requirement for Knacks" + JSON.stringify(entry));
        }

      if(code=="SK" && entry.Class=="Knowledge") entry.roll20_Attribute="Per";
      if(code=="SK" && entry.Class=="Artisan" && !entry.roll20_Attribute) entry.roll20_Attribute="Cha";

      if(entry.Rank)  singleAttr("Rank",entry.Rank);

      if(entry.roll20_Target) {
        switch(entry.roll20_Target){
//PD
          case "PD"  :
          case "PD-each"  :
          case "PDh"  :
          case "PDhp1p"  :
          case "PD-Nat"  :
          case "PD1: @{target|Target|token_id}"  : singleAttr("Target-NoAPI","{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|PD}]]}} {{target_defense=PD}}"); break;
//MD
          case "MD"  :
          case "MD-each"  :
          case "MDh"  :
          case "MDhp1p"  :
          case "MD-Nat"  :
          case "MD1: @{target|Target|token_id}"  : singleAttr("Target-NoAPI","{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|MD}]]}} {{target_defense=MD}}"); break;
//SD
          case "SD"  :
          case "SD-each"  :
          case "SDh"  :
          case "SDhp1p"  :
          case "SD-Nat"  :
          case "SD1: @{target|Target|token_id}"  : singleAttr("Target-NoAPI","{{target_name=@{target|Target|token_name}}} {{target_number=[[@{target|Target|SD}]]}} {{target_defense=SD}}"); break;
//ASK
          case "Ask: ?{Target Number|0}"  :
          case "Ask: PD: ?{Target Number, maybe relative to PD|0}"  :
          case "Ask: MD: ?{Target Number, maybe relative to MD|0}"  :
          case "Ask: SD: ?{Target Number, maybe relative to SD|0}"  :
          case "Riposte: @{target|Counter-attack Target|token_id}: PD: ?{Target Number, maybe relative to PD|0}"  : singleAttr("Target-NoAPI","{{target_number=?{Target Number|0}}}"); break;
//None
          case "None"  :
          case "2"  :
          case "5"  :
          case "6"  :
          case "10"  : break;
        }
      }



      if(entry.Step){    // We have a step that we want to use, possibly we come from a Creature Import. This step has been parsed with rgStep, so it can come from many different formats
        //log("Processing " +entry.Name + " Step is " + entry.Step);
        let tf= JSON.stringify(entry.Step);
        if(tf.match( new RegExp(rgNumSR,"i"))){
          //log("numSR "+tname);
          singleAttr("addSR",tf.match("") ? "0.5" : "1");
          let val = parseInt2(tf.replace(new RegExp(rgSR,"i"),"").replace(/\+|\"/,"")); //get rid of the circle
          if( entry.roll20_Attribute)  val-= getInt(values, (entry.roll20_Attribute.trim() + "-Step"));
          if( code=="WPN" ) val-= getInt(values,"Str-Step");
          //log("addSR " +entry.Name + " val "+ val + " data " +JSON.stringify(entry));
          //if( entry.roll20_Attribute) log("Attribute " +entry.Name + " Attribute name is "+(entry.roll20_Attribute.trim() + "-Step")+ " "+getInt(values, (entry.roll20_Attribute + "-Step")));
          singleAttr( "Rank", val);
        } else if(tf.match( new RegExp(rgMove,"i"))){
          //log("Move "+tname);
          singleAttr( "Attribute", "0");
          singleAttr( "Mod-Type", "NoRoll");
          singleAttr( "Rank", getInt(values,"Movement") + getInt(entry,"Step"));
        } else if(tf.match( new RegExp(rgHDmg,"i"))){
          //log("Highest Damage "+tname);
          singleAttr( "Rank", getInt(entry,"Rank"));
        } else if(tf.match( new RegExp(rgHAtk,"i")) || tf.match( new RegExp(rgAtk,"i"))){
          //log("Highest Atk "+tname);
          singleAttr( "Rank", getInt(entry,"Rank"));
        // } else if(tf.match( new RegExp(rgAtk,"i"))){
           log("Attack "+tname);
        } else if(tf.match( new RegExp(rgAttSR,"i"))){
          //log("Attribute + Circle "+tname);
          singleAttr("addSR",tf.match("") ? "0.5" : "1");
          if(tf.match(/dex/i)) singleAttr("Attribute","Dex");
          else if(tf.match(/str/i)) singleAttr("Attribute","Str");
          else if(tf.match(/tou/i)) singleAttr("Attribute","Tou");
          else if(tf.match(/per/i)) singleAttr("Attribute","Per");
          else if(tf.match(/wil/i)) singleAttr("Attribute","Wil");
          else if(tf.match(/cha/i)) singleAttr("Attribute","Cha");

        } else if(tf.match( new RegExp(rgSR,"i"))){
          //log("Circle "+tname);
          singleAttr("addSR",tf.match("") ? "0.5" : "1");

        } else if(tf.match( new RegExp(rgNumSign,"i"))){ // This number has a sign, so it is an adjustment
          //log("Adjustment "+tname);
          singleAttr( "Rank-Adjust", getInt(entry,"Step") + getInt(values,pre+"Rank-Adjust"));

        } else if(tf.match( new RegExp(rgNum,"i"))){ // It s a pure number, just adjust the Rank
          //log("Number "+tname + "code " +code);
          let val=getInt(entry,"Step");
          if( entry.roll20_Attribute && !stepisrank)  val-= getInt(values, (entry.roll20_Attribute.trim() + "-Step"));
          if( code=="WPN" ) val-= getInt(values,"Str-Step");
          //if( code=="WPN" ) log("Step Calculation for Damage, Step was " + getInt(entry,"Step") + " substracting Str " + getInt(values,"Str-Step"));
          //if( entry.roll20_Attribute) log("Attribute " +entry.Name + " Attribute name is "+(entry.roll20_Attribute.trim() + "-Step")+ " "+getInt(values, (entry.roll20_Attribute + "-Step")));
          if(entry.Rank) singleAttr("Rank-Adjust",val - getInt(entry,"Rank")); //We were given a Rank, let's use it

          else if(entry.roll20_Rank_Adjust) singleAttr("Rank",val - getInt(entry,"roll20_Rank_Adjust")); //There is a rank adjustment, potentially from the Talent/Power description
          else singleAttr( "Rank", val);

          singleAttr("Effective-Rank",val);

          //log("Number " +entry.Name + " Step " +entry.Step + " Rank "+ entry.Rank + " Attribute " + entry.roll20_Attribute + " of value "+ getInt(values, (entry.roll20_Attribute.trim() + "-Step")));

        }
      } else if(values["Race"]=="Spirit") singleAttr("addSR","1"); //For Spirits, if there is no step specified, use the SR

      if(entry.Step_Info && !entry.roll20_Action){
        if(entry.Step_Info.match(/Standard/i)) singleAttr("Action","Standard");
        else if(entry.Step_Info.match(/Free/i)) singleAttr("Action","Free");
        else if(entry.Step_Info.match(/Simple/i)) singleAttr("Action","Simple");
        else if(entry.Step_Info.match(/Free/i)) singleAttr("Action","Free");
      }


      if(code=="INV" && values["WeightAdjustment"] !== "1" && entry["roll20_UnitWeight"] && ["Clothing","Shield","Armor"].includes(entry["Type"])   )
      {
        entry["roll20_UnitWeight"]=JSON.stringify(parseFloat(values["WeightAdjustment"]) * parseFloat(entry["roll20_UnitWeight"].replace(/\,/g,".")));
        log("Weight Adjustment of " + values["WeightAdjustment"] + " for a result of " + entry["roll20_UnitWeight"]);
        entry.roll20_extra_note= "Weight Adjusted due to Race by a factor " + values["WeightAdjustment"] +"\n"+ (entry.roll20_extra_note ||"");
      }

      if(entry.Category=="Devotions" || (entry.roll20_Type && entry.roll20_Type.startsWith("QD-"))){ //Default Devotions
        //log("Devotion");
        entry.roll20_Karma_Limit_max="0"; //No Karma on Devotions
        if(!entry.roll20_DP_Limit_max) entry.roll20_DP_Limit_max="1"; //Default devotions to enhabling DP
      }




      for (const field of fields) {//We look first if there is a value prefixed by roll20 and second without the prefix to be more modular
         //log(" for tname " +tname + " and field " + field + " value1 (roll20) " + entry["roll20_"+field.replace(/\-/g,"_")]+ " value2 " + entry[field.replace(/\-/g,"_")]);

        if(entry["roll20_"+field.replace(/\-/g,"_")]){
          singleAttr( field,field=="UnitWeight" ? entry["roll20_"+field.replace(/\-/g,"_")].replace(/\,/g,".") : entry["roll20_"+field.replace(/\-/g,"_")] ); //the replace is necessary because JSON doesn't take - as separator. The second replace is necessary to get rid of issue with . or , as separators
        } else if(entry[field.replace(/\-/g,"_")]){
          singleAttr( field,field=="UnitWeight" ? entry[field.replace(/\-/g,"_")].replace(/\,/g,".") : entry[field.replace(/\-/g,"_")] ); //the replace is necessary because JSON doesn't take - as separator. The second replace is necessary to get rid of issue with . or , as separators
        }
      }


            // singleAttr( field,entry["roll20_"+field.replace(/\-/g,"_")] ); //the replace is necessary because JSON doesn't take - as separator. The parsefloat is necessary to get rid of issue with . or , as separators

      //Create the links
      if(code=="NAC" && entry.roll20_BaseTalent){
        let code2="T",
        nm2=entry.roll20_BaseTalent;
        let flag=addAPIflag( "", "LinkAdd1", code + " : " + (values[pre+"RowID"]||rowid) + " : "+code2+" : " + nm2);
        //setAttrsLog( { "APIflag" : flag }); //APIFlag syntax is LinkAdd1,code,rowid,code,name, the first set being the attribute Getting the value, and the second the one providing
        //log("trying to create link to " +nm2);
      } else if(entry.linkadd || entry.roll20_linkadd){
        let la = (entry.linkadd || entry.roll20_linkadd).split("|"), //list of links to be created
        code2,nm2,m,
        apiflag="";
        //log("la "+ JSON.stringify(la));
        for(let i=0;i<la.length;i++){
          if(entry.linkadd && (m=la[i].match(/(.*)\;(.*)/))){
            code2=m[1];
            nm2=m[2];
          }else {
            code2="T";
            nm2=la[i];
          }
          //log("trying to create link to " +nm2);
          apiflag=addAPIflag( apiflag, "LinkAdd1", code + " : " + (values[pre+"RowID"]||rowid) + " : "+code2+" : " + nm2);
        }
        //setAttrsLog({ "APIflag" :apiflag});
      }



    if(code=="TI" && entry.Thread){
      let tarray= parseJSON(entry.Thread);
      if(tarray && tarray.length>0)
      for(let i=0;i<tarray.length;i++){
        if(tarray[i]["Effect"]) singleAttr( "Rank" + (i+1) + "Effect", tarray[i]["Effect"]);
        if(tarray[i]["KeyKnowledge"]) singleAttr( "Rank" + (i+1) + "TestKnowledge", tarray[i]["KeyKnowledge"]);
      }
    }


      // JBF@JBF a strategy will have to be found for Devotions
      //if(code=="T" && entry.talenttype && entry.talenttype.startsWith("QD-")) singleAttr( "DP-Limit_max", "1" );
      //if(entry.devotionrequired) singleAttr( "DP-Limit",      entry.devotionrequired );

      let d= new Date();
      notes= ((trigger=="player" && values[pre+notesnm] && values[pre+notesnm].length>0)? (values[pre+notesnm]+"\n") : "")||""; //When Autofilling don't overwrite the notes
      notes+= (entry.Step_Info && !notes.includes(entry.Step_Info) ? (entry.Step_Info+"\n") : ""); //Add the Step_Info
      notes+= (entry.roll20_extra_note && !notes.includes(entry.roll20_extra_note) ? (entry.roll20_extra_note+"\n") : ""); //Add the extra note if not already there
      notes+= (entry.Description && !notes.includes(entry.Description) ? (  entry.Description+"\n") : ""); //Add the extra note if not already there
      notes+= d.getFullYear()+"-"+(d.getMonth() +1)+"-"+d.getDate() + " : Entry update triggered by ";
      switch(trigger){
        case "API" : notes+= "Text import" ; break;
        case "player" : notes+= "Player Manual Input" ; break;
        case "CreateTalents" : notes+= "Circle Up (Create Talents Button)" ; break;
        case "AbilityAdd" : notes+= "Addition of another ability" ; break;
        case "AbilityDrop" : notes+= "Compendium Drop" ; break;
        default : notes+= " unknown trigger ";
      }
      notes += " - data comes from ";
      switch(source){
        case "compendium" : notes+= "compendium" ; break;
        case "local" : notes+= "Character Sheet database" ; break;
        case "AbilityAdd" : notes+= "embedded data in other ability" ; break;
        default : notes+= " unknown source ";
      }

         notes+="\n";

        //log("Earthdawn : Entry " + values[ pre + "Name" ] + " processed via " + source);

      if(entry.roll20_Dex_min) notes+="Minimum Dexterity : " + entry.roll20_Dex_min+"\n";
      if(entry.roll20_Str_min) notes+="Minimum Strength : " + entry.roll20_Str_min+"\n";
      if(entry.roll20_Range) notes+="Range : " + entry.roll20_Range+"\n";
      if(entry.roll20_Capacity) notes+="Capacity : " + entry.roll20_Capacity+"\n";
      if(entry.roll20_RateOfFire) notes+="Range : " + entry.roll20_RateOfFire+"\n";

      singleAttr( notesnm, notes);

      //Process Ranged Weapons only if they are Range Only
      if(entry.RWpn && !entry.MWpn)
      switch(entry.RWpn){
        case "Missile"  : singleAttr("CloseCombat","-1"); break;
        case "Thrown"  : singleAttr("CloseCombat","-2"); break;
        case "FireArm"  : singleAttr("CloseCombat","-3"); break;
        case "Heavy"  : singleAttr("CloseCombat","-4"); break;
        default  : singleAttr("CloseCombat","-1");
      }
      //log("values " + JSON.stringify(vals));

      //log("vals "+ JSON.stringify(vals));

      setAttrsLog( vals,null,function(){
        if(["T","SK","WPN","NAC"].indexOf(code)!==-1)         repRanks( rowid,code);
        //log("Fillentry " + tname +  " data " + JSON.stringify(vals));
      });
    //For an unknown reason, Weapons Rank don't trigger repRanks... So let's make sure it triggers
  });
} catch(err) {log("Earthdawn:FillEntryData() error caught: " + err );}
}; //end FillEntryData()




var updateKnackSummary = function fnupdateKnackSummary() {
  'use strict';
  try{
    let attarray = ["Race","Attrib-Str-Curr","Knack-Summary-Param","Knack-Summary-SubRank"];
    let charray=[],
    s="",ss="",
    pre,
    vals=[],
    dfltrk,dflt,
    maxvalue=0,filtered,knackn,knacklist;
    // log ( "EarthDawn : updateKnackSummary() ");

    let database=[

      //Companion
    {"talent":"Acrobatic Defense","knacks":[	{"knackname":"Acrobatic Recovery","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Acrobatic Strike","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Control the Tempo","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Deny Terrain","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Air Sailing","knacks":[	{"knackname":"Air Legs","requirement":"Rank 3","page":"Companion"}
  ,	{"knackname":"Pilot Boat","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Sailing","requirement":"Rank 4","page":"Companion"}
  ]},{"talent":"Animal Bond","knacks":[	{"knackname":"Heal Animal Companion","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Animal Training","knacks":[	{"knackname":"Animal Handling","requirement":"Rank 4","page":"Companion"}
  ]},{"talent":"Anticipate Blow","knacks":[	{"knackname":"Anticipate Movement","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Anticipate Spell","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Foresee Aggression","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Take the Hit","requirement":"Rank 6","restrictions":"Warrior 5, Swordmaster 6, Scout 8","page":"Companion"}
  ]},{"talent":"Arcane Mutterings","knacks":[	{"knackname":"Arcane Curses [Special Maneuver]","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Jinx","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Astral Interference","knacks":[	{"knackname":"Mobile Interference","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Push Against the Horror","requirement":"Rank 7","restrictions":"Nethermancer 7","page":"Companion"}
  ]},{"talent":"Avoid Blow","knacks":[	{"knackname":"Arrow Cutting [Special Maneuver]","requirement":"Rank 5","restrictions":"Melee Weapons Rank 5, Unarmed Combat Rank 5","page":"Companion"}
  ,	{"knackname":"Redirect Attack [Special Maneuver]","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Roll With the Punches","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Awareness","knacks":[	{"knackname":"Lip Reading","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Battle Bellow","knacks":[	{"knackname":"Intimidating Bellow","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Battle Shout","knacks":[	{"knackname":"Defiant Shout","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Destructive Shout","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Book Memory","knacks":[	{"knackname":"Photographic Memory","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Remember Conversation","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Borrow Sense","knacks":[	{"knackname":"One Eye Open","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Other Sense","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Call Animal Companion","knacks":[	{"knackname":"Beast Summons","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Empathic Command","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Call Missile","knacks":[	{"knackname":"Call Any Missile","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Charge","knacks":[	{"knackname":"Overrun [Special Maneuver]","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Claw Shape","knacks":[	{"knackname":"Claw Tool","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Savage Limbs","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Wrecking Claws","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Climbing","knacks":[	{"knackname":"Spider Climb","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Swinging Move","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Cold Purify","knacks":[	{"knackname":"Halt Disease","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Conversation","knacks":[	{"knackname":"Getting to Know You [Special Maneuver]","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Danger Sense","knacks":[	{"knackname":"Detect Poison","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Detect Weapon","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Diplomacy","knacks":[	{"knackname":"Assess Intentions","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Poisoned Influence","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Disarm","knacks":[	{"knackname":"Ill Take That [Special Maneuver]","requirement":"Rank 6","restrictions":"Swordmaster 5, Any Discipline 7","page":"Companion"}
  ]},{"talent":"Disguise Self","knacks":[	{"knackname":"Ideal Appearance","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Dominate Beast","knacks":[	{"knackname":"Tame Animal","requirement":"Rank 8","restrictions":"Beastmaster 7, Cavalryman 8","page":"Companion"}
  ]},{"talent":"Elementalism","knacks":[	{"knackname":"Create Orichalcum","requirement":"Rank 10","restrictions":"Elementalist 9, Weaponsmith 10","page":"Companion"}
  ,	{"knackname":"Detect Spirit","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Detect True Element","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Harvest True Element","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Emotion Song","knacks":[	{"knackname":"Accompaniment","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Telling the Tale","requirement":"Rank 1","page":"Companion"}
  ]},{"talent":"Engaging Banter","knacks":[	{"knackname":"Bribery","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Enhance Animal Companion","knacks":[	{"knackname":"Augment Allys Form","requirement":"Rank 5","restrictions":"Beastmaster 5, Cavalryman 5","page":"Companion"}
  ,	{"knackname":"Mold Allys Form","requirement":"Rank 9, Augment Allys Form","restrictions":"Beastmaster 9, Cavalryman","page":"Companion"}
  ,	{"knackname":"Sculpt Allys Form","requirement":"Rank 13, Mold Allys Form","restrictions":"Beastmaster 13, Cavalryman 13","page":"Companion"}
  ]},{"talent":"Evidence Analysis","knacks":[	{"knackname":"Astral Survey","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Cold Case","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"First Impression","knacks":[	{"knackname":"Grand Entrance","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Forge Armor","knacks":[	{"knackname":"Efficient Armor Forging","requirement":"Rank 5","restrictions":"Weaponsmith 5","page":"Companion"}
  ,	{"knackname":"Rapid Armor Forging [Special Maneuver]","requirement":"Rank 6","restrictions":"Weaponsmith 6","page":"Companion"}
  ]},{"talent":"Forge Weapon","knacks":[	{"knackname":"Efficient Weapon Forging","requirement":"Rank 5","restrictions":"Weaponsmith 5","page":"Companion"}
  ,	{"knackname":"Rapid Weapon Forging [Special Maneuver]","requirement":"Rank 6","restrictions":"Weaponsmith 6","page":"Companion"}
  ]},{"talent":"Great Leap","knacks":[	{"knackname":"Pounce [Special Maneuver]","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Vault Opponent","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Haggle","knacks":[	{"knackname":"Evaluate","requirement":"Rank 1","page":"Companion"}
  ]},{"talent":"Item History","knacks":[	{"knackname":"Psychometry","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Touching the Past","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Lock Picking","knacks":[	{"knackname":"Shackle Shrug","requirement":"Rank 3","page":"Companion"}
  ]},{"talent":"Long Shot","knacks":[	{"knackname":"Extend Range","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Maneuver","knacks":[	{"knackname":"Aggressive Maneuver","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Feint","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Hamstring [Special Maneuver]","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Patient Maneuver","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Setup","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Melee Weapons","knacks":[	{"knackname":"Deflect Blow","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Give Ground [Special Maneuver]","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Harrying Attack [Special Maneuver]","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Improved Improvised Weapon","requirement":"Rank 7, Improvised Weapon","page":"Companion"}
  ,	{"knackname":"Improvised Weapon","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Mind Blade","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Overpower [Special Maneuver]","requirement":"Rank 7","restrictions":"Strength 14","page":"Companion"}
  ,	{"knackname":"Swing Attack","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Tail Weapon","requirement":"Rank 4","restrictions":"Tail Combat","page":"Companion"}
  ]},{"talent":"Missile Weapons","knacks":[	{"knackname":"Flare","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Point-Blank Shot","requirement":"Rank 3","page":"Companion"}
  ,	{"knackname":"Wind Bow","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Mystic Aim","knacks":[	{"knackname":"Precise Shot","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Navigation","knacks":[	{"knackname":"Mapmaking","requirement":"Rank 2","page":"Companion"}
  ,	{"knackname":"Read River","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Nethermancy","knacks":[	{"knackname":"Detect Spirit","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Patterncraft","knacks":[	{"knackname":"Craft Blood Charm","requirement":"Rank 5","restrictions":"Nethermancer 5","page":"Companion"}
  ,	{"knackname":"Craft Common Magic Item","requirement":"Rank 5","restrictions":"Elementalist 4, Wizard 5","page":"Companion"}
  ,	{"knackname":"Craft True Pattern","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"Companion"}
  ,	{"knackname":"Design Enchanting Pattern","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Handle Elements","requirement":"Rank 5","restrictions":"Elementalist 4, Weaponsmith 5","page":"Companion"}
  ,	{"knackname":"Improvised Pattern","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Incorporate Bound Spirit","requirement":"Rank 6","restrictions":"Elementalist 6, Nethermancer 5","page":"Companion"}
  ,	{"knackname":"Incorporate Glyph","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"Companion"}
  ]},{"talent":"Picking Pockets","knacks":[	{"knackname":"Streetwise","requirement":"Rank 4","page":"Companion"}
  ]},{"talent":"Resist Taunt","knacks":[	{"knackname":"Make Concession","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Riposte","knacks":[	{"knackname":"Claw Riposte","requirement":"Rank 5","page":"Companion"}
  ]},{"talent":"Scout Weaving","knacks":[	{"knackname":"Craft Poison","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"Companion"}
  ,	{"knackname":"Detect Spirit","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Detect True Element","requirement":"Rank 4","page":"Companion"}
  ]},{"talent":"Shield Bash","knacks":[	{"knackname":"Shield Drive","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Slough Blame","knacks":[	{"knackname":"Forgery","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Spellcasting","knacks":[	{"knackname":"Acid Splash","requirement":"Rank 2","restrictions":"Elementalist 2","page":"Companion"}
  ,	{"knackname":"Arcane Accuracy","requirement":"Rank 2","restrictions":"Wizard 2","page":"Companion"}
  ,	{"knackname":"Arcane Edge","requirement":"Rank 3","restrictions":"Wizard 3","page":"Companion"}
  ,	{"knackname":"Astral Strain","requirement":"Rank 2","restrictions":"Nethermancer 2","page":"Companion"}
  ,	{"knackname":"Astral Ward","requirement":"Rank 2","restrictions":"Wizard 2","page":"Companion"}
  ,	{"knackname":"Befuddle","requirement":"Rank 2","restrictions":"Illusionist 2","page":"Companion"}
  ,	{"knackname":"Bleed","requirement":"Rank 3","restrictions":"Nethermancer 3","page":"Companion"}
  ,	{"knackname":"Burst of Speed","requirement":"Rank 3","restrictions":"Elementalist 3","page":"Companion"}
  ,	{"knackname":"Courage","requirement":"Rank 2","restrictions":"Illusionist 2","page":"Companion"}
  ,	{"knackname":"Deflection","requirement":"Rank 4","restrictions":"Wizard 4","page":"Companion"}
  ,	{"knackname":"Doubt","requirement":"Rank 4","restrictions":"Illusionist 4","page":"Companion"}
  ,	{"knackname":"Fluster","requirement":"Rank 5","restrictions":"Illusionist 5","page":"Companion"}
  ,	{"knackname":"Fortify Armor","requirement":"Rank 2","restrictions":"Elementalist 2","page":"Companion"}
  ,	{"knackname":"Fortify Pattern","requirement":"Rank 5","restrictions":"Wizard 5","page":"Companion"}
  ,	{"knackname":"Grasping Vines","requirement":"Rank 5","restrictions":"Elementalist 5","page":"Companion"}
  ,	{"knackname":"Pattern Stress","requirement":"Rank 4","restrictions":"Nethermancer 4","page":"Companion"}
  ,	{"knackname":"Soothe Venom","requirement":"Rank 4","restrictions":"Elementalist 4","page":"Companion"}
  ,	{"knackname":"Sprain","requirement":"Rank 5","restrictions":"Nethermancer 5","page":"Companion"}
  ,	{"knackname":"Stutter","requirement":"Rank 3","restrictions":"Illusionist 3","page":"Companion"}
  ,	{"knackname":"Unsettle","requirement":"Rank 2","restrictions":"Nethermancer 2","page":"Companion"}
  ]},{"talent":"Stealthy Stride","knacks":[	{"knackname":"Astral Stealth","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Subtle Casting","requirement":"Rank 6","page":"Companion"}
  ,	{"knackname":"Traceless Stride","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Steel Thought","knacks":[	{"knackname":"Absorb Spell","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Surprise Strike","knacks":[	{"knackname":"Dirty Fighting","requirement":"Rank 7","page":"Companion"}
  ]},{"talent":"Tactics","knacks":[	{"knackname":"Opening [Special Maneuver]","requirement":"Rank 8","page":"Companion"}
  ]},{"talent":"Thief Weaving","knacks":[	{"knackname":"Craft Poison","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"Companion"}
  ]},{"talent":"Thread Smithing","knacks":[	{"knackname":"Craft True Pattern","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"Companion"}
  ,	{"knackname":"Create Orichalcum","requirement":"Rank 10","restrictions":"Elementalist 9, Weaponsmith 10","page":"Companion"}
  ,	{"knackname":"Design Enchanting Pattern","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Detect True Element","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Handle Elements","requirement":"Rank 5","restrictions":"Elementalist 4, Weaponsmith 5","page":"Companion"}
  ]},{"talent":"Thread Weaving","knacks":[	{"knackname":"Ghost Master Ritual","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Mind Armor","requirement":"Rank 8","page":"Companion"}
  ,	{"knackname":"Strength of Bronze","requirement":"Rank 5","restrictions":"Strength 14, Dwarf","page":"Companion"}
  ,	{"knackname":"Strength of Iron","requirement":"Rank 9, Strength of Bronze","restrictions":"Strength 16, Dwarf","page":"Companion"}
  ,	{"knackname":"Strength of Steel","requirement":"Rank 13, Strength of Iron","restrictions":"Strength 18, Dwarf","page":"Companion"}
  ]},{"talent":"Throwing Weapons","knacks":[	{"knackname":"Flare","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Point-Blank Shot","requirement":"Rank 3","page":"Companion"}
  ,	{"knackname":"Returning","requirement":"Rank 4","page":"Companion"}
  ,	{"knackname":"Throw Anything","requirement":"Rank 4","page":"Companion"}
  ]},{"talent":"Unarmed Combat","knacks":[	{"knackname":"Body Blade","requirement":"Rank 5","page":"Companion"}
  ,	{"knackname":"Eye Gouge [Special Maneuver]","requirement":"Rank 7","page":"Companion"}
  ,	{"knackname":"Give Ground [Special Maneuver]","requirement":"Rank 6","page":"Companion"}
  ]},{"talent":"Wind Catcher","knacks":[	{"knackname":"Glide","requirement":"Rank 6","page":"Companion"}
]},{"talent":"Winning Smile","knacks":[	{"knackname":"Flirting","requirement":"Rank 4","page":"Companion"}]},

//MP Knacks

{"talent":"Air Dance","knacks":[	{"knackname":"Cant Catch Me [Special Maneuver]","requirement":"Rank 10","restrictions":"Windmaster 7","page":"AJMP"}
,	{"knackname":"Im Not Done with You Yet","requirement":"Rank 5","restrictions":"Windmaster rank 2, any Discipline Circle 8","page":"AJMP"}
,	{"knackname":"Speed Freak [Special Maneuver]","requirement":"Rank 8","restrictions":"Windmaster 5","page":"AJMP"}
,	{"knackname":"Speed Kills [Special Maneuver]","requirement":"Rank 9","restrictions":"Windmaster 6","page":"AJMP"}
]},{"talent":"Air Sailing","knacks":[	{"knackname":"Sweeping Current","requirement":"Rank 7","restrictions":"Air Sailor Circle 7","page":"AJMP"}
]},{"talent":"Air Speaking","knacks":[	{"knackname":"Wind Dance","requirement":"Rank 4","page":"AJMP"}
]},{"talent":"Anticipate Blow","knacks":[	{"knackname":"Aerial Ace","requirement":"Rank 10,","restrictions":"Windmaster rank 7 Air Dance rank 5","page":"AJMP"}
]},{"talent":"Applied Knowledge","knacks":[	{"knackname":"Lector [Special Maneuver]","requirement":"Rank 6","restrictions":"Scholar rank 5","page":"AJMP"}
]},{"talent":"Astral Interference","knacks":[	{"knackname":"Push Against the Horror","requirement":"Rank 7","restrictions":"Nethermancer 7,Horror Stalker 5","page":"AJMP"}
]},{"talent":"Awareness","knacks":[	{"knackname":"Clear View","requirement":"Rank 9","restrictions":"Messenger rank 7, Scout Circle 9, Thief Circle 9","page":"AJMP"}
,	{"knackname":"Eavesdrop","requirement":"Rank 6","restrictions":"Messenger rank 3, Scout Circle 6, Thief Circle 6","page":"AJMP"}
,	{"knackname":"Voices Carry","requirement":"Rank 8","restrictions":"Messenger rank 5, Scout Circle 6, Thief Circle 6","page":"AJMP"}
]},{"talent":"Banish","knacks":[	{"knackname":"Expel Horror","requirement":"Rank 9","restrictions":"Horror Stalker rank 9, Nethermancer Circle 12","page":"AJMP"}
]},{"talent":"Battle Shout","knacks":[	{"knackname":"Flames of Battle","requirement":"Rank 6, Fires of Gahad rank 4","restrictions":"Fire Eater rank 2","page":"AJMP"}
,	{"knackname":"Katoshs Challenge","requirement":"Rank 5, Rite of Khopesh rank 5","restrictions":"Outcast rank 1","page":"AJMP"}
,	{"knackname":"Scorching Breath","requirement":"Rank 9, Fires of Gahad rank 7","restrictions":"Fire Eater rank 5","page":"AJMP"}
]},{"talent":"Bear Mark","knacks":[	{"knackname":"Bear Corruption","requirement":"Rank 3","restrictions":"Horror Stalker rank 3","page":"AJMP"}
,	{"knackname":"Bitter Taste","requirement":"Rank 4","restrictions":"Horror Stalker rank 4","page":"AJMP"}
,	{"knackname":"Debilitating Harvest","requirement":"Rank 7, Bitter Taste","restrictions":"Horror Stalker rank 7","page":"AJMP"}
,	{"knackname":"Poisoned Harvest","requirement":"Rank 9, Bitter Taste, Debilitating Harvest","restrictions":"Horror Stalker rank 9","page":"AJMP"}
,	{"knackname":"Trace Horror","requirement":"Rank 5","restrictions":"Horror Stalker rank 5","page":"AJMP"}
]},{"talent":"Book Memory","knacks":[	{"knackname":"Font of Knowledge","requirement":"Rank 5, Expansive Expertise rank 3","restrictions":"Scholar rank 2","page":"AJMP"}
,	{"knackname":"Transcribe Document","requirement":"Rank 5","restrictions":"Messenger 1","page":"AJMP"}
]},{"talent":"Brother of Stone","knacks":[	{"knackname":"Earth Brother [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Earth Cloak [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Earth Elemental Affinity [Karma]","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Earth Sense [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Force of Stone [Karma]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Resilience of Stone [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Stability of Stone [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Stone Flesh [Karma]","requirement":"Rank 9","page":"AJMP"}
]},{"talent":"Burning Vigor","knacks":[	{"knackname":"Burning Strength","requirement":"Rank 5, Fires of Gahad rank 3","restrictions":"Fire Eater rank 1","page":"AJMP"}
]},{"talent":"Call of Harrow","knacks":[	{"knackname":"All Tied Up [Special Maneuver]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Assault [Special Maneuver]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Dispersing Strike [Special Maneuver]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Exploit Corruption","requirement":"Rank 5","restrictions":"Horror Stalker rank 5","page":"AJMP"}
,	{"knackname":"Lance Bloatform [Special Maneuver]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Mold Baggi [Special Maneuver]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Never Deceived [Special Maneuver]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Pattern Recognition [Special Maneuver]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Trap Horror","requirement":"Rank 7","restrictions":"Horror Stalker rank 7","page":"AJMP"}
]},{"talent":"Chtard Dance","knacks":[	{"knackname":"Chtard Heel Turn [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Chtard Sting","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Chtard Strike [Special Maneuver]","requirement":"Rank 1, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Double Cut [Special Maneuver]","requirement":"Rank 9, Unarmed Combat rank 9","restrictions":"Tail Dancer 9","page":"AJMP"}
]},{"talent":"Climbing","knacks":[	{"knackname":"Light as a Leaf","requirement":"Rank 8, Race Through the Canopy","restrictions":"Woodsman rank 6, any Discipline Circle 10","page":"AJMP"}
,	{"knackname":"Race Through the Canopy","requirement":"Rank 7","restrictions":"Woodsman rank 5, any Discipline Circle 9","page":"AJMP"}
]},{"talent":"Cold Purify","knacks":[	{"knackname":"Cleansing Chill","requirement":"Rank 5","restrictions":"Purifier rank 2, any Discipline Circle 8","page":"AJMP"}
,	{"knackname":"Mending Frost","requirement":"Rank 9","restrictions":"Purifier rank 5","page":"AJMP"}
]},{"talent":"Conceal Object","knacks":[	{"knackname":"One with the Message","requirement":"Rank 10","restrictions":"Messenger rank 9","page":"AJMP"}
]},{"talent":"Deliberate Assault","knacks":[	{"knackname":"Deliberate Spellcasting","requirement":"Rank 5","restrictions":"Brother of Stone rank 1","page":"AJMP"}
]},{"talent":"Dispel Magic","knacks":[	{"knackname":"Disrupt Horror Power","requirement":"Rank 7","restrictions":"Horror Stalker rank 7, Nethermancer Circle 9","page":"AJMP"}
]},{"talent":"Distract","knacks":[	{"knackname":"Aggravating Assault","requirement":"Rank 10","restrictions":"Windmaster rank 7","page":"AJMP"}
,	{"knackname":"Buzz","requirement":"Rank 6","restrictions":"Windmaster rank 3","page":"AJMP"}
,	{"knackname":"Incite [Special Maneuver]","requirement":"Rank 6","restrictions":"Windmaster 3","page":"AJMP"}
,	{"knackname":"Infuriate [Special Maneuver]","requirement":"Rank 5","restrictions":"Windmaster 2","page":"AJMP"}
,	{"knackname":"Mosquito Bite","requirement":"Rank 9","restrictions":"Windmaster rank 6","page":"AJMP"}
]},{"talent":"Dive Attack","knacks":[	{"knackname":"Bluffing Dive","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Fearsome Dive","requirement":"Rank 8","restrictions":"Windmaster rank 8","page":"AJMP"}
]},{"talent":"Earth Bond","knacks":[	{"knackname":"Connect with Earths Pattern","requirement":"Rank 9","restrictions":"Brother of Stone rank 5, Purifier rank 5","page":"AJMP"}
,	{"knackname":"Earth Mending","requirement":"Rank 6, Earth Slumber","restrictions":"Brother of Stone rank 3","page":"AJMP"}
,	{"knackname":"Earth Slumber","requirement":"Rank 5","restrictions":"Brother of Stone rank 2","page":"AJMP"}
,	{"knackname":"Earths Avenger","requirement":"Rank 8","restrictions":"Brother of Stone rank 6, Purifier rank 5","page":"AJMP"}
,	{"knackname":"Earths Bounty","requirement":"Rank 6, Wild Growth","restrictions":"Purifier rank 3","page":"AJMP"}
,	{"knackname":"Empower Purify","requirement":"Rank 5, Patterncraft","restrictions":"None rank 5","page":"AJMP"}
,	{"knackname":"Shared Bond, Shared Blood","requirement":"Rank 7","restrictions":"Brother of Stone rank 4, Purifier rank 4","page":"AJMP"}
,	{"knackname":"Wild Growth","requirement":"Rank 5","restrictions":"Purifier rank 2","page":"AJMP"}
]},{"talent":"Earth Skin","knacks":[	{"knackname":"Earth Armor","requirement":"Rank 7","restrictions":"Brother of Stone rank 4","page":"AJMP"}
,	{"knackname":"Stillness of Stone","requirement":"Rank 5","restrictions":"Brother of Stone rank 1","page":"AJMP"}
]},{"talent":"Earth Walk","knacks":[	{"knackname":"Earth Awareness","requirement":"Rank 6","restrictions":"Brother of Stone rank 6","page":"AJMP"}
,	{"knackname":"Earth Dash","requirement":"Rank 7","restrictions":"Brother of Stone rank 7","page":"AJMP"}
,	{"knackname":"Earth Excursion","requirement":"Rank 9","restrictions":"Brother of Stone rank 9","page":"AJMP"}
,	{"knackname":"Stone Walk","requirement":"Rank 8","restrictions":"Brother of Stone rank 8","page":"AJMP"}
,	{"knackname":"Travel Through the Earth","requirement":"Rank 10","restrictions":"Brother of Stone rank 10","page":"AJMP"}
,	{"knackname":"Tremorsense","requirement":"Rank 9, Stone Walk","restrictions":"Brother of Stone rank 9","page":"AJMP"}
]},{"talent":"Edo Dance","knacks":[	{"knackname":"Edo Feather Step [Special Maneuver]","requirement":"Rank 1, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Edo Trip [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Leading the Dance [Special Maneuver]","requirement":"Rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Prehensile Tail","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Quick Step","requirement":"Rank 9, Unarmed Combat rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Slow Dance","requirement":"Rank 6, Unarmed Combat rank 4","restrictions":"Tail Dancer rank 4","page":"AJMP"}
]},{"talent":"Emotion Song","knacks":[	{"knackname":"Inflame Passion","requirement":"Rank 6, Fires of Gahad rank 4","restrictions":"Fire Eater rank 2","page":"AJMP"}
]},{"talent":"Empathic Sense","knacks":[	{"knackname":"Captivitys Mark","requirement":"Rank 6","restrictions":"Liberator rank 3","page":"AJMP"}
,	{"knackname":"Sense Allegiance","requirement":"Rank 7","restrictions":"Liberator rank 4","page":"AJMP"}
,	{"knackname":"Sense Manipulation","requirement":"Rank 8","restrictions":"Liberator rank 5","page":"AJMP"}
,	{"knackname":"Sense Passion","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Slaverys Mark","requirement":"Rank 5","restrictions":"Liberator rank 2","page":"AJMP"}
,	{"knackname":"Set Aside Your Bias","requirement":"Rank 8","restrictions":"Liberator rank 6","page":"AJMP"}
]},{"talent":"Engaging Dance","knacks":[	{"knackname":"Take the Lead [Special Maneuver]","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Enhance Animal Companion","knacks":[	{"knackname":"Augment Allys Form","requirement":"Rank 5","restrictions":"Beastmaster 5, Cavalryman 5, Shaman 5","page":"AJMP"}
,	{"knackname":"Mold Allys Form","requirement":"Rank 9, Augment Allys Form","restrictions":"Beastmaster 9, Cavalryman 9, Shaman 9","page":"AJMP"}
,	{"knackname":"Sculpt Allys Form","requirement":"Rank 13, Mold Allys Form","restrictions":"Beastmaster 13, Cavalryman 13, Shaman 13","page":"AJMP"}
]},{"talent":"Etiquette","knacks":[	{"knackname":"Courtesy Lessons","requirement":"Rank 6","restrictions":"Messenger rank 3, Troubadour Circle 6","page":"AJMP"}
,	{"knackname":"Group Alibi","requirement":"Rank 10, Improvised Alibi","restrictions":"Messenger rank 8","page":"AJMP"}
,	{"knackname":"Improvised Alibi","requirement":"Rank 9","restrictions":"Messenger rank 6","page":"AJMP"}
,	{"knackname":"Well Connected","requirement":"Rank 8","restrictions":"Messenger rank 5, Air Sailor Circle 7","page":"AJMP"}
]},{"talent":"Evidence Analysis","knacks":[	{"knackname":"Investigative Expertise","requirement":"Rank 7, Expansive Expertise rank 6","restrictions":"Scholar rank 5","page":"AJMP"}
,	{"knackname":"Peer Review","requirement":"Rank 7","restrictions":"Scholar rank 5","page":"AJMP"}
]},{"talent":"Fire Eater","knacks":[	{"knackname":"Communal Gahad [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Control Gahad [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Harmony with Gahad [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Harness Gahad [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Restrain Gahad [Karma]","requirement":"Rank 1","page":"AJMP"}
]},{"talent":"Fireblood","knacks":[	{"knackname":"Burning Intimidation","requirement":"Rank 5","restrictions":"Fire Eater rank 1, Outcast rank 1, Sky Raider Circle 6","page":"AJMP"}
,	{"knackname":"Heart Burn","requirement":"Rank 6, Fires of Gahad rank 4","restrictions":"Fire Eater rank 2","page":"AJMP"}
]},{"talent":"Fires of Gahad","knacks":[	{"knackname":"Sense Passion","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Blazing Gahad","requirement":"Rank 8","restrictions":"Fire Eater rank 4","page":"AJMP"}
,	{"knackname":"Burning for You","requirement":"Rank 8","restrictions":"Fire Eater rank 4","page":"AJMP"}
,	{"knackname":"Im Always Angry","requirement":"Rank 10","restrictions":"Fire Eater rank 5","page":"AJMP"}
,	{"knackname":"Share Gahad","requirement":"Rank 8","restrictions":"Fire Eater rank 4","page":"AJMP"}
,	{"knackname":"Slow Burn","requirement":"Rank 6","restrictions":"Fire Eater rank 2","page":"AJMP"}
,	{"knackname":"Stoking the Flames","requirement":"Rank 1","restrictions":"Fire Eater rank 1","page":"AJMP"}
,	{"knackname":"Towering Inferno","requirement":"Rank 3","restrictions":"Fire Eater rank 1","page":"AJMP"}
]},{"talent":"Forest Sense","knacks":[	{"knackname":"The Forest is My Sense","requirement":"Rank 10","restrictions":"Woodsman rank 10","page":"AJMP"}
,	{"knackname":"The Forests Grasp [Special Maneuver]","requirement":"Rank 9","page":"AJMP"}
,	{"knackname":"Foliage Harassment [Special Maneuver]","requirement":"Rank 10","restrictions":"Woodsman rank 10","page":"AJMP"}
]},{"talent":"Gaze into the Abyss","knacks":[	{"knackname":"Abyss Gazes Back","requirement":"Rank 6","restrictions":"Horror Stalker rank 6","page":"AJMP"}
]},{"talent":"Heartening Laugh","knacks":[	{"knackname":"Shared Anger","requirement":"Rank 7, Fires of Gahad rank 5","restrictions":"Fire Eater rank 3","page":"AJMP"}
,	{"knackname":"Warming Laughter","requirement":"Rank 5, Fires of Gahad rank 3","restrictions":"Fire Eater rank 1","page":"AJMP"}
]},{"talent":"Horror Stalker","knacks":[	{"knackname":"All Tied Up [Special Maneuver]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Assault [Special Maneuver]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Dispersing Strike [Special Maneuver]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Lance Bloatform [Special Maneuver]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Mold Baggi [Special Maneuver]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Never Deceived [Special Maneuver]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Pattern Recognition [Special Maneuver]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Defend Against the Darkness [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Hunter Hunted [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Knowledge is Power [Karma]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Stab at the Spawn [Karma]","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Strike the Darkness [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Their Weakness is My Strength","requirement":"Rank 5","restrictions":"Horror Stalker rank 5","page":"AJMP"}
]},{"talent":"Impressive Display","knacks":[	{"knackname":"Fiery Display","requirement":"Rank 5, Fires of Gahad rank 3","restrictions":"Fire Eater rank 1","page":"AJMP"}
]},{"talent":"Iron Constitution","knacks":[	{"knackname":"Altitude Inclined","requirement":"Rank 5","restrictions":"Outcast rank 2, any Discipline Circle 7","page":"AJMP"}
,	{"knackname":"Energy Reserves","requirement":"Rank 9","restrictions":"Outcast rank 5, any Discipline Circle 11","page":"AJMP"}
,	{"knackname":"Exposure Resistance","requirement":"Rank 5","restrictions":"Outcast rank 1","page":"AJMP"}
,	{"knackname":"Iron Fortitude","requirement":"Rank 8, Iron Perseverance","restrictions":"Outcast rank 5, any Discipline Circle 10","page":"AJMP"}
,	{"knackname":"Iron Perseverance","requirement":"Rank 7","restrictions":"Outcast rank 4, any Discipline Circle 9","page":"AJMP"}
,	{"knackname":"Tireless Spirit","requirement":"Rank 6, Unflagging Endurance","restrictions":"Outcast rank 3","page":"AJMP"}
,	{"knackname":"Unflagging Endurance","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Item History","knacks":[	{"knackname":"Historian [Special Maneuver]","requirement":"Rank 6","restrictions":"Scholar rank 2, any Discipline Circle 8","page":"AJMP"}
]},{"talent":"Journeyman","knacks":[	{"knackname":"Applied Versatility [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Practiced Versatility [Karma]","requirement":"Rank 3, Versatility rank 8","page":"AJMP"}
,	{"knackname":"Skilled Versatility [Karma]","requirement":"Rank 5, Versatility rank 10","page":"AJMP"}
]},{"talent":"Leadership","knacks":[	{"knackname":"Free Mind","requirement":"Rank 9","restrictions":"Liberator rank 8","page":"AJMP"}
,	{"knackname":"It Starts with a Spark","requirement":"Rank 8","restrictions":"Liberator rank 6","page":"AJMP"}
]},{"talent":"Liberator","knacks":[	{"knackname":"Blending In [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Freedom Crusade [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Inquisition of Tyrants [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Insurgency [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Liberators Reprisal [Karma]","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Liberators Vengeance [Karma]","requirement":"Rank 9","page":"AJMP"}
,	{"knackname":"Sowing Dissent [Karma]","requirement":"Rank 3","page":"AJMP"}
]},{"talent":"Lifesight","knacks":[	{"knackname":"Dreadsight","requirement":"Rank 7","restrictions":"Horror Stalker rank 5, Nethermancer Circle 8","page":"AJMP"}
,	{"knackname":"Lay of the Land","requirement":"Rank 5","restrictions":"Purifier rank 1, any Discipline Circle 7","page":"AJMP"}
]},{"talent":"Lion Heart","knacks":[	{"knackname":"Blazing Glory [Special Maneuver]","requirement":"Rank 10, Fires of Gahad rank 8","restrictions":"Fire Eater 5","page":"AJMP"}
,	{"knackname":"Crewmates Courage","requirement":"Rank 9","restrictions":"Air Sailor Circle 9","page":"AJMP"}
,	{"knackname":"Fuel My Fire [Special Maneuver]","requirement":"Rank 8, Fires of Gahad 6","restrictions":"Fire Eater 4","page":"AJMP"}
,	{"knackname":"Outcast Stoicism","requirement":"Rank 8","restrictions":"Outcast rank 4","page":"AJMP"}
]},{"talent":"Locking Picking","knacks":[	{"knackname":"False Shackles","requirement":"Rank 6","restrictions":"Liberator rank 4, any Discipline Circle 8","page":"AJMP"}
,	{"knackname":"Hidden Uprising","requirement":"Rank 8, False Shackles","restrictions":"Liberator rank 7, any Discipline Circle 12","page":"AJMP"}
,	{"knackname":"Unchained Gang","requirement":"Rank 7, Shackle Shrug","restrictions":"Liberator rank 6, any Discipline Circle 11","page":"AJMP"}
]},{"talent":"Maneuver","knacks":[	{"knackname":"Aerial Maneuver","requirement":"Rank 7, Air Dance rank 5","restrictions":"Windmaster rank 4","page":"AJMP"}
,	{"knackname":"Slippery Little Devil","requirement":"Rank 5","restrictions":"Windmaster rank 1","page":"AJMP"}
,	{"knackname":"Wind Dodge","requirement":"Rank 10","restrictions":"Windmaster rank 7","page":"AJMP"}
]},{"talent":"Melee Weapons","knacks":[	{"knackname":"Wind Slash","requirement":"Rank 10","restrictions":"Windmaster rank 8, any Discipline Circle 12","page":"AJMP"}
]},{"talent":"Messenger","knacks":[	{"knackname":"Bland Pleasantries [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Faceless Messenger [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Making the Rounds [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Messengers Duty [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Messengers Encouragement [Karma]","requirement":"Rank 8, Messengers Perseverance","page":"AJMP"}
,	{"knackname":"Messengers Endurance [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Messengers Perseverance [Karma]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Messengers Vow","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"See the Message [Karma]","requirement":"Rank 7","page":"AJMP"}
]},{"talent":"Morphism","knacks":[	{"knackname":"Adaptive Form [Special Maneuver]","requirement":"Rank 4","restrictions":"Journeyman rank 5","page":"AJMP"}
,	{"knackname":"Divergent Form","requirement":"Rank 7, Adaptive Form","restrictions":"Journeyman rank 5","page":"AJMP"}
,	{"knackname":"Metamorphosis","requirement":"Rank 10, Divergent Form","restrictions":"Journeyman rank 5","page":"AJMP"}
,	{"knackname":"Quick Shift","requirement":"Rank 6","restrictions":"Journeyman rank 5","page":"AJMP"}
,	{"knackname":"Versatile Form","requirement":"Rank 5","restrictions":"Journeyman rank 5","page":"AJMP"}
]},{"talent":"Mystic Aim","knacks":[	{"knackname":"Missile Path","requirement":"Rank 7","restrictions":"Woodsman rank 4","page":"AJMP"}
]},{"talent":"Mystic Pursuit","knacks":[	{"knackname":"Trail Blaze","requirement":"Rank 7, Fires of Gahad rank 5","restrictions":"Fire Eater rank 3","page":"AJMP"}
]},{"talent":"Navigation","knacks":[	{"knackname":"Navigate Through the Earth","requirement":"Rank 5","restrictions":"Brother of Stone rank 1","page":"AJMP"}
]},{"talent":"Orbiting Spy","knacks":[	{"knackname":"Horror Seeker","requirement":"Rank 6","restrictions":"Horror Stalker rank 6","page":"AJMP"}
,	{"knackname":"Orbiting Watcher","requirement":"Rank 10","restrictions":"Messenger rank 7, any Discipline Circle 12","page":"AJMP"}
]},{"talent":"Outcast","knacks":[	{"knackname":"Outcasts Honor [Karma]","requirement":"Rank 3, Rite of Khopesh rank 5","page":"AJMP"}
,	{"knackname":"Outcasts Redemption [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Relentless Outcast [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Unbent Outcast [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Unyielding Outcast [Karma]","requirement":"Rank 2","page":"AJMP"}
]},{"talent":"Patterncraft","knacks":[	{"knackname":"Brother of Stone Spells","requirement":"Rank 7","restrictions":"Brother of Stone rank 4","page":"AJMP"}
,	{"knackname":"Channel Fire","requirement":"Rank 9, Fires of Gahad rank 7","restrictions":"Fire Eater rank 5","page":"AJMP"}
,	{"knackname":"Learn Improved Spells","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Liberator Spells","requirement":"Rank 7","restrictions":"Liberator rank 4","page":"AJMP"}
,	{"knackname":"Messenger Spells","requirement":"Rank 7","restrictions":"Messenger rank 4","page":"AJMP"}
,	{"knackname":"Purifier Spells","requirement":"Rank 7","restrictions":"Purifier rank 4","page":"AJMP"}
,	{"knackname":"Scholar Spells","requirement":"Rank 7","restrictions":"Scholar rank 4","page":"AJMP"}
,	{"knackname":"Woodsman Spells","requirement":"Rank 7","restrictions":"Woodsman rank 4","page":"AJMP"}
]},{"talent":"Pilot Boat","knacks":[	{"knackname":"Sweeping Current","requirement":"Rank 7","restrictions":"Air Sailor Circle 7","page":"AJMP"}
,	{"knackname":"Air Sailing","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"River Legs","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Sailing","requirement":"Rank 4","page":"AJMP"}
]},{"talent":"Purification","knacks":[	{"knackname":"Focused Purification","requirement":"Rank 9","restrictions":"Purifier rank 5","page":"AJMP"}
,	{"knackname":"Purifying Touch","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Purifier","knacks":[	{"knackname":"Purifiers Auspices [Karma]","requirement":"Rank 2, Purifiers Touch","page":"AJMP"}
,	{"knackname":"Purifiers Retaliation [Karma]","requirement":"Rank 4, Purifiers Vengeance","page":"AJMP"}
,	{"knackname":"Purifiers Touch [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Purifiers Vengeance [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Tear Out the Root [Karma]","requirement":"Rank 5, Earths Retaliation","page":"AJMP"}
]},{"talent":"Read and Write Language","knacks":[	{"knackname":"Cryptic Cipher","requirement":"Rank 5","restrictions":"Messenger rank 1, any Discipline Circle 7","page":"AJMP"}
,	{"knackname":"Decipher Message","requirement":"Rank 7, Cryptic Message, Hidden Message, Veiled Message","restrictions":"Messenger Rank 4","page":"AJMP"}
,	{"knackname":"Empower Encrypt","requirement":"Rank 5, Patterncraft rank 5, Veiled Cipher","restrictions":"Messenger rank 1","page":"AJMP"}
,	{"knackname":"Evocative Message","requirement":"Rank 9","restrictions":"Messenger rank 5","page":"AJMP"}
,	{"knackname":"Hidden Message","requirement":"Rank 6","restrictions":"Messenger rank 3","page":"AJMP"}
,	{"knackname":"Unbreakable Cipher","requirement":"Rank 8, Cryptic Cipher","restrictions":"Messenger rank 5","page":"AJMP"}
,	{"knackname":"Undetectable Cipher","requirement":"Rank 9, Hidden Message, Veiled Cipher","restrictions":"Messenger rank 6","page":"AJMP"}
,	{"knackname":"Veiled Cipher","requirement":"Rank 5","restrictions":"Messenger rank 2","page":"AJMP"}
]},{"talent":"Read River","knacks":[	{"knackname":"Navigation","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Research","knacks":[	{"knackname":"Consult with Colleagues","requirement":"Rank 5","restrictions":"Scholar rank 1, any Discipline Circle 7","page":"AJMP"}
,	{"knackname":"Librarian [Special Maneuver]","requirement":"Rank 5","restrictions":"Scholar rank 1, any Discipline Circle 7","page":"AJMP"}
,	{"knackname":"Research Expertise","requirement":"Rank 6, Expansive Expertise rank 4","restrictions":"Scholar rank 2","page":"AJMP"}
]},{"talent":"Rite of Khopesh","knacks":[	{"knackname":"Embody Katosh","requirement":"Rank 7","restrictions":"Outcast rank 3","page":"AJMP"}
,	{"knackname":"Embracing Katosh","requirement":"Rank 9","restrictions":"Outcast rank 5","page":"AJMP"}
,	{"knackname":"Katoshs Rebuke","requirement":"Rank 6","restrictions":"Outcast rank 2","page":"AJMP"}
,	{"knackname":"Tenacity of Katosh","requirement":"Rank 10","restrictions":"Outcast rank 5","page":"AJMP"}
,	{"knackname":"What Katosh Demands","requirement":"Rank 8","restrictions":"Outcast rank 4","page":"AJMP"}
]},{"talent":"Sailing","knacks":[	{"knackname":"Sweeping Current","requirement":"Rank 7","restrictions":"Air Sailor Circle 7","page":"AJMP"}
,	{"knackname":"Air Sailing","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Sea Legs","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Pilot Boat","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Scholar","knacks":[	{"knackname":"Critical Thinking","requirement":"Rank 2, Expansive","restrictions":"None Expertise rank 5","page":"AJMP"}
,	{"knackname":"Mnemonics Master [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Practical Learning [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Sages Insight [Karma]","requirement":"Rank 4","page":"AJMP"}
]},{"talent":"Second Weapon","knacks":[	{"knackname":"Cast Net","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Dragging Parry","requirement":"Rank 8, Cast Net","page":"AJMP"}
,	{"knackname":"Entangling Cloak","requirement":"Rank 9, Cast Net","page":"AJMP"}
,	{"knackname":"Tail Attack","requirement":"Rank 5","restrictions":"Tail Dancer rank 2","page":"AJMP"}
]},{"talent":"Sense Captive","knacks":[	{"knackname":"Captivitys Mark","requirement":"Rank 6","restrictions":"Liberator rank 3","page":"AJMP"}
,	{"knackname":"Sense Allegiance","requirement":"Rank 7","restrictions":"Liberator rank 4","page":"AJMP"}
,	{"knackname":"Sense Manipulation","requirement":"Rank 8","restrictions":"Liberator rank 5","page":"AJMP"}
,	{"knackname":"Slaverys Mark","requirement":"Rank 5","restrictions":"Liberator rank 2","page":"AJMP"}
,	{"knackname":"Sense Chattel","requirement":"Rank 5","restrictions":"Liberator rank 2","page":"AJMP"}
]},{"talent":"Sense Horrorspawn","knacks":[	{"knackname":"Sense Corruption","requirement":"Rank 5","restrictions":"Horror Stalker rank 5","page":"AJMP"}
]},{"talent":"Shamanism","knacks":[	{"knackname":"Detect Spirit","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Shivoavara Dance","knacks":[	{"knackname":"Dancing in the Dark [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Elusive Dancer [Special Maneuver]","requirement":"Rank 7, Unarmed Combat rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Shivoavara Spring [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Shivoavara Strike [Special Maneuver]","requirement":"Rank 6, Unarmed Combat rank 6","restrictions":"Tail Dancer 6","page":"AJMP"}
,	{"knackname":"Shivoavara Swiftness [Special Maneuver]","requirement":"Rank 1, Unarmed Combat rank 5","page":"AJMP"}
]},{"talent":"Skora Dance","knacks":[	{"knackname":"Elusive Dancer [Special Maneuver]","requirement":"Rank 7, Unarmed Combat rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Iron Tail","requirement":"Rank 7, Unarmed Combat rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Cutting In","requirement":"Rank 8, Unarmed Combat rank 8","restrictions":"Tail Dancer rank 8","page":"AJMP"}
,	{"knackname":"Skora Defense [Special Maneuver]","requirement":"Rank 1, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Skora Parry [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Skora Slide [Special Maneuver]","requirement":"Rank 7, Unarmed Combat rank 6","restrictions":"Tail Dancer 6","page":"AJMP"}
,	{"knackname":"Steel Dance","requirement":"Rank 6, Unarmed Combat rank 6","restrictions":"Tail Dancer rank 6","page":"AJMP"}
]},{"talent":"Skora Slam","knacks":[	{"knackname":"Skora Stagger [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","page":"AJMP"}
,	{"knackname":"Tail Sweep [Special Maneuver]","requirement":"Rank 9, Unarmed Combat rank 9","restrictions":"Tail Dancer rank 9","page":"AJMP"}
]},{"talent":"Speak Language","knacks":[	{"knackname":"Doublespeak","requirement":"Rank 7","restrictions":"Messenger rank 5","page":"AJMP"}
,	{"knackname":"Doublethink","requirement":"Rank 8, Doublespeak","restrictions":"Messenger rank 6","page":"AJMP"}
]},{"talent":"Spellcasting","knacks":[	{"knackname":"Fire Attunement","requirement":"Rank 8, Fires of Gahad rank 6","restrictions":"Fire Eater rank 4","page":"AJMP"}
,	{"knackname":"Lick Wounds","requirement":"Rank 3","restrictions":"Shaman 3","page":"AJMP"}
,	{"knackname":"Pack Cover","requirement":"Rank 4","restrictions":"Shaman 4","page":"AJMP"}
,	{"knackname":"Pack Strike","requirement":"Rank 2","restrictions":"Shaman 2","page":"AJMP"}
,	{"knackname":"Sure-Footed","requirement":"Rank 5","restrictions":"Shaman 5","page":"AJMP"}
,	{"knackname":"Wriggle","requirement":"Rank 2","restrictions":"Shaman 2","page":"AJMP"}
]},{"talent":"Spirit Mount","knacks":[	{"knackname":"Spirit Team","requirement":"Rank 9","restrictions":"Messenger rank 6, any Discipline Circle 11","page":"AJMP"}
]},{"talent":"Spirit Talk","knacks":[	{"knackname":"Horror Tongue","requirement":"Rank 5","restrictions":"Horror Stalker rank 5","page":"AJMP"}
]},{"talent":"Stealthy Stride","knacks":[	{"knackname":"Ambush Tactics","requirement":"Rank 8, Hidden Allies","restrictions":"Woodsman rank 5, Scout Circle 8","page":"AJMP"}
,	{"knackname":"Bland Cloak","requirement":"Rank 7, Bland Stride","restrictions":"Messenger rank 4","page":"AJMP"}
,	{"knackname":"Bland Stride","requirement":"Rank 5","restrictions":"Messenger rank 1","page":"AJMP"}
,	{"knackname":"Hidden Allies","requirement":"Rank 5","restrictions":"Woodsman rank 1, Scout Circle 5","page":"AJMP"}
]},{"talent":"Steel Thought","knacks":[	{"knackname":"Harden Heart","requirement":"Rank 7","restrictions":"Outcast rank 3","page":"AJMP"}
]},{"talent":"Summon","knacks":[	{"knackname":"Binding Secrets","requirement":"Rank 6","page":"AJMP"}
]},{"talent":"Swift Kick","knacks":[	{"knackname":"Quick Tail","requirement":"Rank 5","restrictions":"Tail Dancer rank 1","page":"AJMP"}
]},{"talent":"Swimming","knacks":[	{"knackname":"Deep Diver","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Improved Gills","requirement":"Rank 9, Deep Diver","restrictions":"Tskrang","page":"AJMP"}
]},{"talent":"Tail Dance","knacks":[	{"knackname":"Balanced Dance [Special Maneuver]","requirement":"Rank 3, Unarmed Combat rank 5","restrictions":"Tail Dancer rank 3","page":"AJMP"}
,	{"knackname":"Clear the Floor [Special Maneuver]","requirement":"Rank 7, Unarmed Combat rank 7","restrictions":"Tail Dancer rank 7","page":"AJMP"}
,	{"knackname":"Set the Tempo [Special Maneuver]","requirement":"Rank 5, Unarmed Combat rank 5","restrictions":"Tail Dancer rank 5","page":"AJMP"}
,	{"knackname":"Unfettered Dance [Special Maneuver]","requirement":"Rank 1, Unarmed Combat rank 5","page":"AJMP"}
]},{"talent":"Tail Dancer","knacks":[	{"knackname":"Chtard Stab [Karma]","requirement":"Rank 6, Chtard Dance rank 5","page":"AJMP"}
,	{"knackname":"Course of the River [Karma]","requirement":"Rank 8","page":"AJMP"}
,	{"knackname":"Edo Flick [Karma]","requirement":"Rank 6, Edo Dance rank 5","page":"AJMP"}
,	{"knackname":"River Dance [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Shivoavara Advance [Karma]","requirement":"Rank 6, Shivoavara Dance rank 5","page":"AJMP"}
,	{"knackname":"Skora Twist [Karma]","requirement":"Rank 6, Skora Dance rank 5","page":"AJMP"}
,	{"knackname":"Tail Defense","requirement":"Rank 1","restrictions":"Tskrang","page":"AJMP"}
,	{"knackname":"Tail Rush [Karma]","requirement":"Rank 4","page":"AJMP"}
]},{"talent":"Taunt","knacks":[	{"knackname":"Incite [Special Maneuver]","requirement":"Rank 6","restrictions":"Windmaster 3","page":"AJMP"}
,	{"knackname":"Infuriate [Special Maneuver]","requirement":"Rank 5","restrictions":"Windmaster 2","page":"AJMP"}
]},{"talent":"Temper Flesh","knacks":[	{"knackname":"Temper Spirit","requirement":"Rank 8","restrictions":"Outcast rank 4, any Discipline Circle 10","page":"AJMP"}
]},{"talent":"Thread Weaving","knacks":[	{"knackname":"Craft Poison","requirement":"Rank 5","restrictions":"Windmaster Rank 5, Woodsman Rank 5","page":"AJMP"}
,	{"knackname":"Streetwise","requirement":"Rank 4","restrictions":"Messenger 5","page":"AJMP"}
,	{"knackname":"Strength of Bronze","requirement":"Rank 5","restrictions":"Strength 14, Dwarf, Windmaster 3","page":"AJMP"}
,	{"knackname":"Strength of Iron","requirement":"Rank 9, Strength of Bronze","restrictions":"Strength 16, Dwarf, Windmaster 6","page":"AJMP"}
,	{"knackname":"Strength of Steel","requirement":"Rank 13, Strength of Iron","restrictions":"Strength 18, Dwarf, Windmaster 10","page":"AJMP"}
,	{"knackname":"Tail Defense","requirement":"Rank 1","restrictions":"Tskrang","page":"AJMP"}
,	{"knackname":"Dive Mastery","requirement":"Rank 5","restrictions":"Windmaster rank 1","page":"AJMP"}
,	{"knackname":"Falling Rocks [Special Maneuver]","requirement":"Rank 7","restrictions":"Brother of Stone 4","page":"AJMP"}
,	{"knackname":"Shifting Earth [Special Maneuver]","requirement":"Rank 10","restrictions":"Brother of Stone 8","page":"AJMP"}
,	{"knackname":"Stone Shudder [Special Maneuver]","requirement":"Rank 12","restrictions":"Brother of Stone 10","page":"AJMP"}
,	{"knackname":"Stone Strike [Special Maneuver]","requirement":"Rank 9","restrictions":"Brother of Stone 6","page":"AJMP"}
,	{"knackname":"Wind Mastery","requirement":"Rank 10","restrictions":"Windmaster rank 10","page":"AJMP"}
,	{"knackname":"Wing Mastery","requirement":"Rank 8","restrictions":"Windmaster rank 5","page":"AJMP"}
]},{"talent":"Tiger Spring","knacks":[	{"knackname":"Greased Lightning [Special Maneuver]","requirement":"Rank 7","restrictions":"Windmaster 4","page":"AJMP"}
]},{"talent":"Tracking","knacks":[	{"knackname":"Trail Blaze","requirement":"Rank 7, Fires of Gahad rank 5","restrictions":"Fire Eater rank 3","page":"AJMP"}
,	{"knackname":"Hunters Strike","requirement":"Rank 5","restrictions":"Woodsman rank 2, any Discipline Circle 7","page":"AJMP"}
,	{"knackname":"Track Astral Form","requirement":"Rank 8","restrictions":"Horror Stalker rank 8, Scout Circle 10","page":"AJMP"}
]},{"talent":"Tyrannys Ruin","knacks":[	{"knackname":"Hoard Blows","requirement":"Rank 8","restrictions":"Liberator rank 8","page":"AJMP"}
,	{"knackname":"Shared Pain","requirement":"Rank 6, Empathic Sense rank 5","restrictions":"Liberator rank 6","page":"AJMP"}
]},{"talent":"Unarmed Combat","knacks":[	{"knackname":"Backslash","requirement":"Rank 6","restrictions":"Tail Dancer rank 8, Chtard Dance rank 6","page":"AJMP"}
]},{"talent":"Wilderness Survival","knacks":[	{"knackname":"Wastelander","requirement":"Rank 6","restrictions":"Horror Stalker rank 3, Purifier rank 3, Scout Circle 8","page":"AJMP"}
]},{"talent":"Windmaster","knacks":[	{"knackname":"Annoying Little... [Karma]","requirement":"Rank 2","page":"AJMP"}
,	{"knackname":"Death From Above [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Maz-Shyera-tis [Karma]","requirement":"Rank 10, Shyera-tis","page":"AJMP"}
,	{"knackname":"Never Alone [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Shyera-tis [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Windmaster Technique [Karma]","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Windmaster Training [Karma]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Windmasters Advantage [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Windmasters Dance [Karma]","requirement":"Rank 9","page":"AJMP"}
,	{"knackname":"Windmasters Resilience [Karma]","requirement":"Rank 8","page":"AJMP"}
]},{"talent":"Wood Skin","knacks":[	{"knackname":"Share Wood Skin","requirement":"Rank 7","restrictions":"Woodsman rank 4","page":"AJMP"}
,	{"knackname":"Wood Blend","requirement":"Rank 6","restrictions":"Woodsman rank 3","page":"AJMP"}
,	{"knackname":"Wood Wings","requirement":"Rank 5","page":"AJMP"}
]},{"talent":"Wood Walk","knacks":[	{"knackname":"Light as a Leaf","requirement":"Rank 8, Race Through the Canopy","restrictions":"Woodsman rank 6, any Discipline Circle 10","page":"AJMP"}
,	{"knackname":"Race Through the Canopy","requirement":"Rank 7","restrictions":"Woodsman rank 5, any Discipline Circle 9","page":"AJMP"}
,	{"knackname":"Enemy of the Court","requirement":"Rank 9, Wood Excursion","restrictions":"Woodsman rank 9","page":"AJMP"}
,	{"knackname":"The Forest Knows My Feet","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"The Forest Knows My Friends","requirement":"Rank 7, The Forest Knows My Feet","restrictions":"Woodsman rank 7","page":"AJMP"}
,	{"knackname":"Leaf on the Wind","requirement":"Rank 7","restrictions":"Woodsman rank 7","page":"AJMP"}
,	{"knackname":"Traverse Forest","requirement":"Rank 9","restrictions":"Woodsman rank 9","page":"AJMP"}
,	{"knackname":"Wood Dash","requirement":"Rank 8","restrictions":"Woodsman rank 8","page":"AJMP"}
,	{"knackname":"Wood Excursion","requirement":"Rank 6","restrictions":"Woodsman rank 6","page":"AJMP"}
]},{"talent":"Woodsman","knacks":[	{"knackname":"Nordal Defender [Karma]","requirement":"Rank 8","page":"AJMP"}
,	{"knackname":"Resp ke Felyat [Karma]","requirement":"Rank 3","page":"AJMP"}
,	{"knackname":"Resp ke Lavota [Karma]","requirement":"Rank 5","page":"AJMP"}
,	{"knackname":"Resp ke Thiel [Karma]","requirement":"Rank 9, Forest Sense rank 5","page":"AJMP"}
,	{"knackname":"Resp ke Vardan [Karma]","requirement":"Rank 6","page":"AJMP"}
,	{"knackname":"Retishay [Karma]","requirement":"Rank 4","page":"AJMP"}
,	{"knackname":"Wood Elemental Affinity [Karma]","requirement":"Rank 7","page":"AJMP"}
,	{"knackname":"Woodsmans Home [Karma]","requirement":"Rank 1","page":"AJMP"}
,	{"knackname":"Woodmans Hunt [Karma]","requirement":"Rank 2","page":"AJMP"}
]},{"talent":"Wound Balance","knacks":[	{"knackname":"Earth Rise","requirement":"Rank 8, Earth Walk 5","restrictions":"Brother of Stone 5","page":"AJMP"}

//MP Improved Spell knacks
]},{"talent":"Crunch Climb","knacks":[	{"knackname":"Mountain Climb","requirement":"Patterncraft Rank 5, Crunch Climb","restrictions":"Brother of Stone rank 1, Elementalist Circle 7","page":"AJMP"}
]},{"talent":"Purify Earth","knacks":[	{"knackname":"Cleansing Force","requirement":"Patterncraft Rank 5, Purify Earth","restrictions":"Purifier rank 1","page":"AJMP"}
]},{"talent":"Resist Element (Earth)","knacks":[	{"knackname":"Extended Resist Earth","requirement":"Patterncraft Rank 5, Resist Element (Earth)","restrictions":"Brother of Stone rank 1, Elementalist Circle 7","page":"AJMP"}
]},{"talent":"Resist Element (Wood)","knacks":[	{"knackname":"Extended Resist Wood","requirement":"Patterncraft Rank 5, Resist Element (Wood)","restrictions":"Woodsman rank 1, Elementalist Circle 7","page":"AJMP"}
]},{"talent":"Shelter","knacks":[	{"knackname":"Natural Formation","requirement":"Patterncraft Rank 5, Shelter","restrictions":"Woodsman rank 1, Elementalist Circle 7","page":"AJMP"}
]},{"talent":"Shield Willow","knacks":[	{"knackname":"Entangling Shield","requirement":"Patterncraft Rank 6, Shield Willow","restrictions":"Woodsman rank 3, Elementalist Circle 8","page":"AJMP"}
]},{"talent":"Thrive","knacks":[	{"knackname":"Bountiful Harvest","requirement":"Patterncraft Rank 6, Thrive","restrictions":"Purifier rank 3, Elementalist Circle 7","page":"AJMP"}
,	{"knackname":"Explosive Growth","requirement":"Patterncraft Rank 7, Thrive","restrictions":"Purifier rank 4, Elementalist Circle 8","page":"AJMP"}
]},{"talent":"Elemental Spear (Earth)","knacks":[	{"knackname":"Shattering Spear","requirement":"Patterncraft Rank 8, Elemental Spear (Earth)","restrictions":"Brother of Stone rank 5","page":"AJMP"}
]},{"talent":"Elemental Spear (Wood)","knacks":[	{"knackname":"Wyrm Wood Spear","requirement":"Patterncraft Rank 8, Elemental Spear (Wood)","restrictions":"Woodsman rank 5","page":"AJMP"}
]},{"talent":"Grove Renewal","knacks":[	{"knackname":"Cultivated Renewal","requirement":"Patterncraft Rank 9, Grove Renewal","restrictions":"Woodsman rank 6","page":"AJMP"}
,	{"knackname":"Fortified Renewal","requirement":"Patterncraft Rank 8, Grove Renewal","restrictions":"Woodsman rank 5, Elementalist Circle 10","page":"AJMP"}
]},{"talent":"Uneven Ground","knacks":[	{"knackname":"Treacherous Ground","requirement":"Patterncraft Rank 7, Uneven Ground","restrictions":"Brother of Stone rank 4","page":"AJMP"}
]},{"talent":"Nutritious Earth","knacks":[	{"knackname":"Earths Renewal","requirement":"Patterncraft rank 8, Purify Earth, Nutritious Earth","restrictions":"Purifier rank 5, Elementalist Circle 9","page":"AJMP"}
]},{"talent":"Shattering Stone","knacks":[	{"knackname":"Contained Blast","requirement":"Patterncraft Rank 9, Shattering Stone","restrictions":"Brother of Stone rank 6","page":"AJMP"}
]},{"talent":"Tossing Earth","knacks":[	{"knackname":"Selective Tremors","requirement":"Patterncraft Rank 7, Tossing Earth","restrictions":"Brother of Stone rank 7","page":"AJMP"}
]},{"talent":"Earth Surfing","knacks":[	{"knackname":"Earths Passage","requirement":"Patterncraft rank 8, Earth Walk rank 5, Earth Surfing","restrictions":"Brother of Stone rank 8","page":"AJMP"}
]},{"talent":"Crushing Hand of Earth","knacks":[	{"knackname":"Crushing Hand of Stone","requirement":"Patterncraft Rank 10, Crushing Hand of Earth","restrictions":"Brother of Stone rank 10, Elementalist Circle 13","page":"AJMP"}
]},{"talent":"Earth Wall","knacks":[	{"knackname":"Stone Wall","requirement":"Patterncraft Rank 9, Earth Wall","restrictions":"Brother of Stone rank 9, Elementalist Circle 12","page":"AJMP"}
]},{"talent":"Venomous Fury","knacks":[	{"knackname":"Deadly Venom","requirement":"Patterncraft Rank 9, Venomous Fury","restrictions":"Woodsman rank 9 in service of Blood Wood","page":"AJMP"}
,	{"knackname":"The Queens Kiss","requirement":"Patterncraft rank 10, Deadly Venom, Venomous Missile, Venomous Fury","restrictions":"Woodsman rank 10 in service of Blood Wood","page":"AJMP"}
,	{"knackname":"Venomous Missile","requirement":"Patterncraft Rank 9, Venomous Fury","restrictions":"Woodsman rank 9, Elementalist Circle 12","page":"AJMP"}
]},{"talent":"Assuring Touch","knacks":[	{"knackname":"Remove Doubt","requirement":"Patterncraft Rank 5, Assuring Touch","restrictions":"Liberator rank 1, Illusionist Circle 6","page":"AJMP"}
]},{"talent":"Best Face","knacks":[	{"knackname":"Unassuming Face","requirement":"Patterncraft Rank 5, Best Face","restrictions":"Liberator rank 2, Illusionist Circle 6","page":"AJMP"}
]},{"talent":"Cloak","knacks":[	{"knackname":"Part of the Crowd","requirement":"Patterncraft Rank 5, Cloak","restrictions":"Liberator rank 2, Illusionist Circle 6","page":"AJMP"}
]},{"talent":"Encrypt","knacks":[	{"knackname":"Blood Encryption","requirement":"Patterncraft rank 7, Extend Encryption, Encrypt","restrictions":"Messenger rank 5, Illusionist Circle 9","page":"AJMP"}
,	{"knackname":"Extend Encryption","requirement":"Patterncraft Rank 5, Encrypt","restrictions":"Messenger rank 1, Illusionist Circle 6","page":"AJMP"}
,	{"knackname":"Innocuous Text","requirement":"Patterncraft Rank 5, Encrypt","restrictions":"Liberator rank 4, Messenger rank 2, Illusionist Circle 6","page":"AJMP"}
]},{"talent":"Send Message","knacks":[	{"knackname":"Encoded Communique","requirement":"Patterncraft rank 5,Encrypt, Send Message","restrictions":"Messenger rank 3, Illusionist Circle 7","page":"AJMP"}
,	{"knackname":"Temporary Tattoo","requirement":"Patterncraft Rank 5, Send Message","restrictions":"Liberator rank 2, Messenger rank 4, Illusionist Circle 6","page":"AJMP"}
]},{"talent":"Innocent Activity","knacks":[	{"knackname":"Innocent Bustle","requirement":"Patterncraft Rank 7, Innocent Activity","restrictions":"Liberator rank 5, Illusionist Circle 7","page":"AJMP"}
]},{"talent":"Nobody Here","knacks":[	{"knackname":"Nobody There","requirement":"Patterncraft Rank 8, Nobody Here","restrictions":"Liberator rank 6, Illusionist Circle 8","page":"AJMP"}
]},{"talent":"Bond of Silence","knacks":[	{"knackname":"Days of Silence","requirement":"Patterncraft rank 10, Hours of Silence, Bond of Silence","restrictions":"Messenger rank 8, Illusionist Circle 12","page":"AJMP"}
,	{"knackname":"Hours of Silence","requirement":"Patterncraft Rank 9, Bond of Silence","restrictions":"Messenger rank 6, Illusionist Circle 10","page":"AJMP"}
]},{"talent":"Presto!","knacks":[	{"knackname":"Chango!","requirement":"Patterncraft Rank 7, Presto!","restrictions":"Messenger rank 4, Illusionist Circle 9","page":"AJMP"}
,	{"knackname":"Nothing Up My Sleeves","requirement":"Patterncraft Rank 8, Presto!","restrictions":"Messenger rank 5, Illusionist Circle 10","page":"AJMP"}
]},{"talent":"Bone Circle","knacks":[	{"knackname":"Name Bone Circle","requirement":"Patterncraft Rank 7, Bone Circle","restrictions":"Messenger rank 3, Nethermancer Circle 7","page":"AJMP"}
,	{"knackname":"Share Bone Circle","requirement":"Patterncraft Rank 5, Bone Circle","restrictions":"Messenger rank 1, Nethermancer Circle 6","page":"AJMP"}
]},{"talent":"Shadows Whisper","knacks":[	{"knackname":"Shadow Box","requirement":"Patterncraft Rank 6, Shadows Whisper","restrictions":"Messenger rank 2, Nethermancer Circle 7","page":"AJMP"}
]},{"talent":"Grave Message","knacks":[	{"knackname":"Named Grave Message","requirement":"Patterncraft Rank 7, Grave Message","restrictions":"Messenger rank 5","page":"AJMP"}
,	{"knackname":"Transcribe Grave Message","requirement":"Patterncraft Rank 6, Grave Message","restrictions":"Messenger rank 3, Nethermancer Circle 7","page":"AJMP"}
]},{"talent":"Viewpoint","knacks":[	{"knackname":"Piercing Surveillance","requirement":"Patterncraft Rank 7, Viewpoint","restrictions":"Messenger rank 4, Nethermancer Circle 8","page":"AJMP"}
,	{"knackname":"Ranged Surveillance","requirement":"Patterncraft Rank 8, Viewpoint","restrictions":"Messenger rank 5, Nethermancer Circle 9","page":"AJMP"}
]},{"talent":"Divine Aura","knacks":[	{"knackname":"Monitor Emotions","requirement":"Patterncraft Rank 5, Divine Aura","restrictions":"Messenger rank 1, Wizard Circle 6","page":"AJMP"}
]},{"talent":"Quicken Pace","knacks":[	{"knackname":"Overland Travel","requirement":"Patterncraft Rank 5, Quicken Pace","restrictions":"Messenger rank 2, Wizard Circle 7","page":"AJMP"}
]},{"talent":"Speed Reading","knacks":[	{"knackname":"Cram Session","requirement":"Patterncraft Rank 7, Speed Reading","restrictions":"Scholar rank 5, Wizard Circle 7","page":"AJMP"}
]},{"talent":"Evolved Consciousness","knacks":[	{"knackname":"Uplifted Cognizance","requirement":"Patterncraft Rank 8, Evolved Consciousness","restrictions":"Scholar rank 5, Wizard Circle 8","page":"AJMP"}

//MP paths
]},{"talent":"Thread Weaving","knacks":[	{"knackname":"Brother of Stone","requirement":"Rank 5, Speak Obsidiman, Read and Write Obsidiman, Obsidiman Lore 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Fire Eater","requirement":"Rank 5, ork","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Horror Stalker","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Journeyman","requirement":"Rank 5, Versatility rank 5, Human","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Liberator","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Messenger","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Outcast","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Purifier","requirement":"Rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Scholar","requirement":"Rank 5, Knowledge skill rank 5","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Tail Dancer","requirement":"Rank 5, Dancing 5, Melee Weapons rank 5, tskrang","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Tail Dancer (Chtard)","requirement":"Rank 5, Dancing 5, Melee Weapons rank 5, tskrang","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Tail Dancer (Edo)","requirement":"Rank 5, Dancing 5, Melee Weapons rank 5, tskrang","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Tail Dancer (Shivoavara)","requirement":"Rank 5, Dancing 5, Melee Weapons rank 5, tskrang","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Tail Dancer (Skora)","requirement":"Rank 5, Dancing 5, Melee Weapons rank 5, tskrang","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Windmaster","requirement":"Rank 5, Melee Weapons rank 5, windling","restrictions":"Any Discipline 5","page":"AJMP"}
,	{"knackname":"Woodsman","requirement":"Rank 5, Speak Elf, Read and Write Elf (Sperethiel), Elf Lore 5","restrictions":"Any Discipline 5","page":"AJMP"}


]}
    ];

    var printKnack =function(knack){
      let s="         ";
      if("knackname" in knack ) s+=" KnackName : " + knack.knackname ;
      if("requirement" in knack ) s+="   Requirement : " + knack.requirement;
      if("restrictions" in knack ) s+="   Restriction : " + knack.restrictions;
      if("page" in knack ) s+="   cf. " + knack.page;
      return s;
    };



    var checkRequirement =function(req,trk,lg ){
      let req2,nork,rk,meet=false;
      if(lg) log("req " + req + " trk "+trk);
      if(!req || req.length <=3 ) return true;
      req2=req.toLowerCase().trim();
      nork= isNaN(req2[req2.length-1]);
      rk= nork? 0 : parseInt2(req2.substring(req2.length-2).trim()); //Requirement end with a one or 2 digit number, separated by a space
      req2=nork ? req2 : req2.substring(0,req2.length-2).trim();            //Removed the found rank if any
      if(lg) log("req2 " + req2 + " rk "+rk);

      if(req2=="rank") {
        return ((dflt ? dfltrk : trk)>=rk); //Case of just Rank X, referring directly to the rank of the tested talent
      }
      req2=req2.replace("rank","").replace("circle","").trim(); //We have a requirement on another entry to test... we will have to find this entry in chararray
      let filtered = _.where(charray, {name: req2});

      if(lg) log("req3 " + req2 + " filtered "+JSON.stringify(filtered));


      for(let j=0; j<filtered.length;j++){
        let rrk =  ("rank" in filtered[j]) ? parseInt(filtered[j].rank) : 0;
        meet= meet || ( (dflt ? dfltrk : rrk)>=rk  );
      }
      return meet;
    };

    var meetsRequirement =function(req,op,trk,lg){
      let req2,meet;
      meet = (op=="and"); //When op is and, we test requirement, with "and", if not, we test restrictions with "or"
      if(!req || req.length <=3 ) return true;
      else req2=req.split(",");
      for(let l=0;l<req2.length;l++){
        meet=(op=="and") ? (meet && checkRequirement(req2[l],trk,lg) ) : (meet || checkRequirement(req2[l],trk,lg));
      }
      return meet;
    };


    getSectionIDs("repeating_talents", function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( "T", tarray[ i ] ) + "Rank");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Type");
        attarray.push( buildPre( "T", tarray[ i ] ) + "LinkedValue");
        attarray.push( buildPre( "T", tarray[ i ] ) + "Name");
      }
      getSectionIDs("repeating_discipline", function gsIdRepeatingTalents(darray) {
        for( let i = 0; i < darray.length; i++) {
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "VariantName");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Type");
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Circle");
        }
        getSectionIDsOrdered("repeating_knacks", function gsIdRepeatingKnack(karray) {
          for( let i = 0; i < karray.length; i++){
            attarray.push( buildPre( "NAC", karray[ i ] ) + "Name");
          }

          getSectionIDsOrdered("repeating_skills", function gsIdRepeatingSkills(skarray) {
            for( let i = 0; i < skarray.length; i++){
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Rank");
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Name");
              attarray.push( buildPre( "SK", skarray[ i ] ) + "Class");
            }

            getSectionIDsOrdered("repeating_language", function gsIdRepeatingLanguage(larray) {
              for( let i = 0; i < larray.length; i++){
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Name");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Speak");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "Speak-T");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "ReadWrite");
                attarray.push( buildPre( "SKL", larray[ i ] ) + "ReadWrite-T");
              }
              getSectionIDsOrdered("repeating_spell", function gsIdRepeatingSpells(sparray) {
                for( let i = 0; i < sparray.length; i++){
                  attarray.push( buildPre( "SP", sparray[ i ] ) + "Name");

                }
              getAttrs( attarray , function gaTalentSummary(values) {
                'use strict';
                logvalues( values);
                dfltrk=getInt(values,"Knack-Summary-SubRank");
                dflt=(values["Knack-Summary-Param"]==2); //If true, the defltrk will be used to calculated the criterias

                //building the character array with everything that defines the character
                charray.push({"name": values["Race"].toLowerCase()});
                charray.push({"name": "strength", "rank" : getInt(values,"Attrib-Str-Curr")});
                for( let i = 0; i < tarray.length; i++){
                  let rk= ((values[ buildPre( "T", tarray[ i ] ) + "Type"] =="Free") ? values[ buildPre( "T", tarray[ i ] ) + "LinkedValue"] :  values[ buildPre( "T", tarray[ i ] ) + "Rank"])||"0"
                charray.push({ "name": values[buildPre( "T", tarray[ i ] ) + "Name"].toLowerCase()||"" , "rank" : rk });
              }
                maxvalue=0
                for( let i = 0; i < darray.length; i++){
                  pre=buildPre( "DSP", darray[ i ] );
                  charray.push({ "name": values[pre + "Name"].toLowerCase()||"" , "rank" : values[pre + "Circle"]||"0" });
                  if(values[pre + "VariantName"])   charray.push({ "name": values[pre + "VariantName"].toLowerCase()||"" , "rank" : values[pre + "Circle"]||"0" });
                  if(!values[pre + "Type"] || values[pre + "Type"]=="Discipline")
                  maxvalue= Math.max(maxvalue,getInt(values,pre + "Circle"));
                }
                charray.push({ "name": "any discipline", "rank" : maxvalue });

                for( let i = 0; i < sparray.length; i++){
                  pre=buildPre( "SP", sparray[ i ] );
                  charray.push({ "name": values[pre + "Name"].toLowerCase()||""});
                }


                for( let i = 0; i < karray.length; i++)
                charray.push({ "name": values[buildPre( "NAC", karray[ i ] ) + "Name"].toLowerCase()||""});
                maxvalue=0;
                for( let i = 0; i < skarray.length; i++) {
                  pre=buildPre( "SK", skarray[ i ] );
                  let name = values[pre + "Name"]||"";
                  if(values[pre + "Class"] =="Knowledge" && (name.includes("Elven")  || name.includes("Elf"))) name="Elf Lore";
                  if(values[pre + "Class"] =="Knowledge" && name.includes("Obsidi")) name="Obsidiman Lore"; //A bit of extra specificity is needed to help with brother of stones and Woodsmen
                  charray.push({ "name": values[pre + "Name"].toLowerCase()||"" , "rank" : values[pre + "Rank"]||"0" });
                  if(values[pre + "Class"] =="Knowledge")
                  maxvalue= Math.max(maxvalue,getInt(values,pre + "Rank"));
                }
                charray.push({ "name": "knowledge skill" , "rank" : maxvalue });
                for( let i = 0; i < larray.length; i++){
                  pre=buildPre( "SKL", larray[ i ] );
                  let name = values[pre + "Name"]||"";
                  if(name.includes("Elven") || name.includes("Spere") || name.includes("Elf")) name="Elf";
                  if(name.includes("Obsidi")) name="Obsidiman"; //A bit of extra specificity is needed to help with brother of stones and Woodsmen
                  if(values[pre+"Speak"]=="1" || values[pre+"Speak-T"]=="1")
                  charray.push({ "name": "speak "+ name.toLowerCase()||"" });
                  if(values[pre+"ReadWrite"]=="1" || values[pre+"ReadWrite-T"]=="1")
                  charray.push({ "name": "readwrite "+ name.toLowerCase()||"" });
                }
                //end of character array creation

                //Testing all Talents
                for( let i = 0; i < tarray.length; i++){
                  ss="";
                  pre=buildPre( "T", tarray[ i ] );
                  let nm=values[pre+"Name"];
                  let ty=values[pre+"Type"];
                  if(!ty || ty=="0" || ty.startsWith("D") || ty.startsWith("TO") || ty.startsWith("PA")) { // 20220705: Addition : Only discipline/TO and Path Talents are open for Knacks
                    let rk=getInt(values,pre+"Rank");
                    filtered = _.where(database, {talent: nm});
                    if((nm!=="Thread Weaving" && nm.includes("Thread Weaving")) ||
                    ["Arrow Weaving","Beast Weaving","Elementalism","Gauntlet Weaving","Illusionism","Nethermancy","Rider Weaving","River Weaving","Scout Weaving","Sea Weaving","Shamanism","Sky Weaving","Story Weaving","Thief Weaving","Thread Smithing","Weapon Weaving","Wizardry"].indexOf(nm)!==-1    )
                    filtered =filtered.concat(_.where(database, {talent: "Thread Weaving"}));

                    if(filtered.length>0){
                      //log("filter for " +nm  + " " + JSON.stringify(filtered));
                      for(let j=0; j<filtered.length;j++){
                        knacklist=filtered[j].knacks;
                        for(let k=0; k<knacklist.length;k++){
                          if(meetsRequirement (knacklist[k].requirement,"and",rk) && ( !("restrictions" in knacklist[k]) || meetsRequirement (knacklist[k].restrictions,"or",rk)))
                          ss+="      "+ printKnack(knacklist[k]) + "\n";
                        }
                      }
                    }
                    if(ss.length>0) s+= "List of Knacks for " + nm +" : \n" +ss;
                  }
              }

                //Testing Disciplines, because Path Talents are recorded as DSP
                for( let i = 0; i < darray.length; i++){
                  ss="";
                  pre=buildPre( "DSP", darray[ i ] );
                  let nm=values[pre+"Name"]||"";
                  let rk=getInt(values,pre+"Circle");
                  //log("Testing for " +nm);
                  if(nm!=""){
                    filtered = _.where(database, {talent: nm});
                    //need to join thread weaving too
                    //log("filtered "+ JSON.stringify(filtered));
                    if(filtered.length>0){
                      for(let j=0; j<filtered.length;j++){
                        knacklist=filtered[j].knacks;
                        // s+= "    " +JSON.stringify(filtered[j])+" \n";
                        for(let k=0; k<knacklist.length;k++){
                          if(meetsRequirement (knacklist[k].requirement,"and",rk) && ( !("restrictions" in knacklist[k]) || meetsRequirement (knacklist[k].restrictions,"or",rk)))
                          ss+="      "+ printKnack(knacklist[k]) + "\n";
                        }
                      }
                    }
                  }
                  if(ss.length>0) s+= "List of Knacks for " + nm +" : \n" +ss;
                }

                //Testing Spells for Improved Spell Knack
                for( let i = 0; i < sparray.length; i++){
                  ss="";
                  pre=buildPre( "SP", sparray[ i ] );
                  let nm=values[pre+"Name"]||"";
                  //let rk=getInt(values,pre+"Circle");
                  //log("Testing for " +nm);
                  if(nm!=""){
                    filtered = _.where(database, {talent: nm});
                    //need to join thread weaving too
                    //log("filtered "+ JSON.stringify(filtered));
                    if(filtered.length>0){
                      for(let j=0; j<filtered.length;j++){
                        knacklist=filtered[j].knacks;
                        // s+= "    " +JSON.stringify(filtered[j])+" \n";
                        for(let k=0; k<knacklist.length;k++){
                          if(meetsRequirement (knacklist[k].requirement,"and",0) && ( !("restrictions" in knacklist[k]) || meetsRequirement (knacklist[k].restrictions,"or",0)))
                          ss+="      "+ printKnack(knacklist[k]) + "\n";
                        }
                      }
                    }
                  }
                  if(ss.length>0) s+= "List of Improved Spell Knacks for " + nm +" : \n" +ss;
                }



                // log("charray "+ JSON.stringify(charray))
                // s+=JSON.stringify(charray);
                vals["Knack-Summary"]=s;
                setAttrsLog(vals);
                });
              });
            });
          });
        });
      });
    });

  } catch(err) {log("Earthdawn:updateKnackSummary() error caught: " + err );}
}; // End updateKnackSummary()
on("clicked:knacksummary", fn(updateKnackSummary) );



//API Watchdog

on("clicked:stop-using-api", fn(function ocStopUsingApi() {
  'use strict';
  setAttrsLog({ "API": "0", "API_max": "0"});
})); //end API Watchdog()

// on("clicked:confirm-api", fn(function ocConfirmApi() {
//   'use strict';
//   setAttrsLog({ "API": "1", "API_max": "1"});
// })); //end API Watchdog()


// Processes the compendium drop of a Talents, Skills, Knack.
// nm is the name, rep is the type of repeating_section, code is the Code
// Will identify existing rowid with the same name (or create a rowid) and update the name and buttonInfo
// Also used when an Ability is indirectly added (i.e. via the abilityadd field of the compendium)
var AbilityDrop = function fnAbilityDrop(nm,rep,code,un,data,mode,comp_data) { // Except if nodup==true will search in the repeating_section rep if any rep_item has Name==nm, and return the rowid. If not found, will return a new rowID
  let attarray=[],
  rowID,found=false,newInfo,
  nodup=(mode && mode.includes("noduplicate")), //Allows 2 entries of the same name to be created, (useful for WPN)
  addqty=(mode && mode.includes("addqty")), //When detecting a duplicate, will update the Qty (useful for INV)
  ovw=(mode && mode.includes("overwrite")), //Considers the data that is passed as lower priority as what will come from the compendium. Useful for Creature Imports to pass the Rank/Step, but still having Autofill lookout the compendium
  mul=(mode && mode.includes("del") ? -1 : 1),
  abadd=(mode && mode.includes("AbilityAdd")),
  vals={},
  hardcoded=false,
  chk;
  //log("AbilityDrop nm: " + nm + " code: "+ code  +" mode: "+ mode + " un "+un + " data: " + JSON.stringify(data));



  getSectionIDs(rep, function gsIdRepeating(tarray) {
    for( let i = 0; i < tarray.length; i++) {
      attarray.push( buildPre( code, tarray[ i ] ) + "Name");
      attarray.push( buildPre( code, tarray[ i ] ) + "Rank");
      attarray.push( buildPre( code, tarray[ i ] ) + "Type");
      attarray.push( buildPre( code, tarray[ i ] ) + "Rank-Adjust");
      if(addqty) attarray.push( buildPre( code, tarray[ i ] ) + "Qty");
    }

    if(["standard matrix", "enhanced matrix" , "shared matrix", "armored matrix"].includes(nm.trim().toLowerCase()))
      {
        if(code=="T" && (data.roll20_Type || data.Type )) data.roll20_Origin=data.roll20_Type || data.Type;     //Case of Matrix : Listed as Talents, but entered as SPM
        if(data.roll20_Origin=="Free") data.roll20_Origin="Free-link";
        if(data.roll20_Origin=="Item") data.roll20_Origin="Item-link";
        switch(nm.trim().toLowerCase()){
          case "enhanced matrix" : data.roll20_Type="15" ; break;
          case "shared matrix" : data.roll20_Type="25" ; break;
          case "armored matrix" : data.roll20_Type="-20" ; break;
          case "standard matrix" :
          default:
           data.roll20_Type="-10" ;
        }
        code="SPM"; //We change to an SPM
      vals["Hide-Spells-Tab"]="0";
    }

    if(["spellcasting", "spells"].includes(nm.trim().toLowerCase()))
      vals["Hide-Spells-Tab"]="0";

      getAttrs( ["isNamegiver"], function gaRepName2(values2) {
    //management of the hardcoded value
    if(values2["isNamegiver"]=="0"){ //Because some powers also exist with same name as talents, we have to be careful
    switch(nm.toLowerCase().trim()){
      case "hydra armor":
      case "armored scales" :
      case "hardened armor" : chk=true; hardcoded="Creature-HardenedArmor"; break;
      case "fury" : hardcoded="Creature-Fury"; break;
      case "resist pain" : hardcoded="Creature-ResistPain"; break;
      case "willful" : hardcoded="Creature-Willful"; break;
      case "ambush" : hardcoded="Creature-Ambushing_max"; break;
      case "dive" :
      case "charge" : hardcoded="Creature-DivingCharging_max"; break;
      case "grab and bite" : chk=true; hardcoded="Creature-GrabAndBite"; break;
      case "hamstring" : chk=true; hardcoded="Creature-Hamstring"; break;
      case "overrun" : chk=true; hardcoded="Creature-Overrun"; break;
      case "pounce" : chk=true; hardcoded="Creature-Pounce"; break;
      case "squeeze the life" : chk=true; hardcoded="Creature-SqueezeTheLife"; break;
      case "clip the wing" : chk=true; hardcoded="Opponent-ClipTheWing"; break;
      case "crack the shell" : chk=true; hardcoded="Opponent-CrackTheShell"; break;
      case "defang" : chk=true; hardcoded="Opponent-Defang"; break;
      case "enrage" : chk=true; hardcoded="Opponent-Enrage"; break;
      case "provoke" : chk=true; hardcoded="Opponent-Provoke"; break;
      case "pry loose" : chk=true; hardcoded="Opponent-PryLoose"; break;
    }
  }
    if(data.Hardcoded) hardcoded=data.Hardcoded;

    if(hardcoded) attarray.push(hardcoded);


    getAttrs( attarray, function gaRepName(values) { //Get an array of all the names
      if(!nodup && !hardcoded && !(code=="SPM"))
      for( let i = 0; i < tarray.length; i++) {
        //if(nm=="Charge") log("AbilityDrop nm: " + nm + " checking name against : " + values[buildPre( code, tarray[ i ] ) + "Name"]);
        if(!values[buildPre( code, tarray[ i ] ) + "Name"] || values[buildPre( code, tarray[ i ] ) + "Name"]=="" || values[buildPre( code, tarray[ i ] ) + "Name"].toLowerCase().replace(/\s/g, '')==nm.toLowerCase().replace(/\s/g,'') //Remove space and case sensitivity
      || (values[buildPre( code, tarray[ i ] ) + "Type"]=="Racial" &&  data.roll20_Type=="Racial")  && ( //additional intent to catch and avoid duplicates for Astral Sight and Versatility
        (values[buildPre( code, tarray[ i ] ) + "Name"].toLowerCase().startsWith("astral") && nm.toLowerCase().startsWith("astral")) ||
        (values[buildPre( code, tarray[ i ] ) + "Name"].toLowerCase().startsWith("versa") && nm.toLowerCase().startsWith("versa"))
      ))
        {
          log("Compendium Drop, entry with same name " + nm +  " or no name found with rowID " + tarray[i]);
          rowID=tarray[i];
          i=tarray.length;
          found=true;
        }
      }

      //if(nm=="Charge") log("AbilityDrop nm: " + nm + " found : " + found + " code " + code + " rowID " + rowID);


      if(hardcoded) {//Case of Hardcoded.
        if(chk) vals[hardcoded]= (mul==1) ? "1"  : "0"; //Checkbox
        else if(addqty) vals[hardcoded]= (getInt(values,hardcoded)+(data.roll20_Qty ? (parseInt(data.roll20_Qty))||1 : 1)); //INV
        else vals[hardcoded]= (getInt(values,hardcoded) + (mul * getInt(data,"Step"))); //General Case
      } else if(nm=="Karma"){
        if(data.Step) vals["KarmaStep"]=data.Step;
        if(data.Step_Info) vals["Karma_max"]=data.Step_Info;
        else vals["Karma-Modifier"]="10";
        vals["KarmaGlobalMode"]="?";
      } else {    //Case of not Hardcoded : we go for the rep item
        if(!rowID ) {
          rowID=generateRowIdNoUnderscore();
          if(nm=="Charge") log("AbilityDrop nm: " + nm +  " code " + code + " rowID " + rowID);

          vals[buildPre( code, rowID )+"RowID"]=rowID;
        }
        //From here we have a rowID, either new or already existing
        //if(nm=="Charge") log("code " + code + " rowID " + rowID);
        newInfo = buildPre( code, rowID );
        // vals[newInfo+"RowID"]=newId;

        vals[newInfo+"Name"]=(nm)||"";
        vals[newInfo+"buttonInfo"]=un||"";
        if(addqty) vals[newInfo+"Qty"]= getInt(values,newInfo+"Qty")+(data.roll20_Qty ? (parseInt(data.roll20_Qty))||1 : 1);
      }

      if(code=="BL") vals["show_blood"]="1";
      if(code=="MNT") vals["show_mounts"]="1";


        if(code=="INV" && (data.roll20_Cost || data.Cost)) {//For inventory, record costs // ChatRecord, SP: 0: (sp price): Spend: Buy a broadsword
          let flag=addAPIflag( "", "ChatRecord", "SP : 0 :"+ (data.roll20_Cost || data.Cost) + " :" +
        " Spend : " +
         " Buy " + ((data.roll20_Qty ? (parseInt(data.roll20_Qty))||1 : 1)==1 ? "a " : parseInt(data.roll20_Qty) + " Units of ") + (nm||""));
        //vals["APIflag"]=flag;
}
          setAttrsLog( vals,null,function(){
          if(rowID && code=="DSP") repDiscipline(rowID,data);
          else if(rowID && abadd || code=="SPM") AutoFill(newInfo+"Name","AbilityAdd",nm,data,comp_data);
          else if(rowID && ovw) AutoFill(newInfo+"Name","API",nm,data,comp_data);
          else if(rowID) FillEntryData(newInfo+"Name",nm,"AbilityDrop","compendium",data);
          //If it was an abilityadd, we should see via Autofill if there is valid data from the compendium
          //If it was a drop, we go directly to fill the data
        });
        });
      });
    });
  }; // End AbilityDrop





//Handler of the compendium drops : will determine the appropriate case and call the subfunction
var CompendiumDropMgt = function fnCompendiumDropMgt(eventInfo) {
  'use strict';
  try{
    //log("starting Drop Management " +JSON.stringify(eventInfo));
    if(!eventInfo.newValue || eventInfo.newValue === ""  ) return; // function has been triggered a second time after all the drops have been reset
    let vals={},
    nm,un,data;

    getAttrs( ["drop_name","drop_category","drop_unique_name","drop_type","drop_data"], function gaCompendiumDropMgt(values) {
      //log("DropManagement " + values["drop_data"]);
      nm=values["drop_name"];
      un=values["drop_unique_name"];
      if(!un) {
        un=(values["drop_category"] + ":" + values["drop_name"]);
        un=un.replace(/\s/,"%20")
      }
      data=parseJSON(values["drop_data"]);
      //log("dropping " + nm + " "+ un);


      switch(values["drop_category"]){
        case "Dragons": if(!data["Race"]) data["Race"]="Dragon"; //Set the Race
        case "Spirits": if(!data["Race"]) data["Race"]="Spirit"; //Set the Race
        case "Horrors": if(!data["Race"]) data["Race"]="Horror"; //Set the Race
        case  "Creatures" : if(!data["Race"]) data["Race"]="Creature"; //Set the Race
        case  "NPCs" : {
          vals["charName"]=nm;
          FillDataCreature(data);
          vals["tab"]="1";
          vals["char_buttonInfo"]=un;
          break;} // end NPCs, Creatures
        case  "Traps" : {
          vals["NPC"]=-1;
          vals["charName"]=nm;
           FillDataTrap(data);
          vals["tab"]="1";
          vals["char_buttonInfo"]=un;
          break;} // end Traps
        case  "Masks" :{
          data.Name=nm;
          FillDataMask(data,1);
          vals["tab"]="1";
          let newID= generateRowIdNoUnderscore(),
          pre=buildShortPre(newID,"MSK");
          vals[pre+"RowID"]=newID;
          vals[pre+"Name"]=data.Name;
          vals[pre+"Details"]=JSON.stringify(data);
          break;} // end Masks

        case "Paths" :
        case "Questors" :
        case  "Disciplines" :{
          AbilityDrop(nm,"repeating_discipline","DSP",un,data);
          if(data["roll20_Damage_Blood_Magic"]||data["Damage_Blood_Magic"])  AbilityDrop(nm,"repeating_blood","BL",un,data,"noduplicate");
          vals["tab"]="1";
          break;} // end Disciplines

          case  "Races" :{
            updateRace(nm,data);
            //vals["Race"]=nm;
            vals["Race-buttonInfo"]=values["drop_unique_name"]||"";
            vals["tab"]="1";
            break;
          } // end Race
          case  "Poisons and Diseases" :{
            data.roll20_Mod_Type="Damage Poison";
            data.roll20_Type="Special";
            if(data.Effect) data.Step=data.Effect;
            AbilityDrop(nm,"repeating_talents","T",un,data);
            vals["tab"]="3";

            break;
          } // end Poisons and Diseases
          case "Devotions": data.roll20_Type= data.roll20_Type || "QD-Follower"; //Flowdown, but if no other data, default to it
          case  "Dragon Powers" :
          case  "Horror Powers" :
          case  "Spirit Powers" :
          case  "Creature Powers" :
          case  "Talents" :{
            AbilityDrop(nm,"repeating_talents","T",un,data);
            vals["tab"]="3";
            if(data["abilityadd"]){ //Process AbilityAdd
              let addjson=parseJSON(data["abilityadd"]);
              log("abilityadd " +JSON.stringify(addjson));
              if(addjson.names && addjson.rep && addjson.code) AbilityDrop(addjson.names,addjson.rep,addjson.code,un,addjson,"AbilityAdd");
              else log("Earthdawn CompendiumDropMgt - Trying to Add nested Ability with invalid JSON");
             }
            break;
          } // end talents
          case  "Skills" :{
            AbilityDrop(nm,"repeating_skills","SK",un,data);
            vals["tab"]="5";
            break;
          } // end skills
          case  "Knacks" :{
            AbilityDrop(data["roll20_KnackName"],"repeating_knacks","NAC",un,data,"noduplicate"); //In the case of Knacks, the Name of the page is in fact roll20BaseTalent, roll20KnackName. Also certain Knacks can be learned multiple times
            vals["tab"]="4";
            break;
          } // end knacks
          case  "Spells - Improved Spell Knacks" : nm=data.roll20_KnackName||nm;
          case  "Spells - Elementalist" :
          case  "Spells - Illusionist" :
          case  "Spells - Nethermancer" :
          case  "Spells - Wizard" :{
            AbilityDrop(nm,"repeating_spell","SP",un,data);
            vals["tab"]="6";
            vals["tab-spells"]="3";
            break;
          } // end spells
          case  "Magic" : {

            if(data["roll20_Damage_Blood_Magic"])  AbilityDrop(nm,"repeating_blood","BL",un,data,"noduplicate");
            if(data["Thread"])  AbilityDrop(nm,"repeating_threads","TI",un,data,"noduplicate");
            if(data["abilityadd"]){ //Process AbilityAdd
              let addjson=parseJSON(data["abilityadd"]);
              log("abilityadd " +JSON.stringify(addjson));
              if(addjson.names && addjson.rep && addjson.code) AbilityDrop(addjson.names,addjson.rep,addjson.code,un,addjson,"AbilityAdd");
              else log("Earthdawn CompendiumDropMgt - Trying to Add nested Ability with invalid JSON");
             }
            if(data["Type"]=="Matrix")  {
              AbilityDrop(nm,"repeating_matrix","SPM",un,data,"noduplicate");
              vals["tab"]= "6";
              vals["tab-spells"]="2";
              vals["spellmatrix-edit-mode"]="1";
            } else vals["tab"]= "7";

          }
          break; // end Magic
          case  "Goods and Services" : {
            vals["tab"]="7";
            //Logics to look at the data fields to know what you need to do:
            if( data["MWpn"] ){ //Melee Weapons
              let data2=parseJSON(values["drop_data"]);
              switch(data["MWpn"]){
                case  "Unarmed" :  data2["roll20_CloseCombat"]= "2" ; break;
                case  "Attached" : data2["roll20_CloseCombat"]= "3" ; break;
                default :          data2["roll20_CloseCombat"]= "1" ;
              };
              AbilityDrop(nm,"repeating_weapons","WPN",un,data2,"noduplicate");
            }
            if( data["RWpn"] ){ //Ranged Weapons
              let data3=parseJSON(values["drop_data"]);
              switch(data["MWpn"]){
                case  "Thrown" :  data3["roll20_CloseCombat"]= "-2" ; break;
                case  "Heavy" :   data3["roll20_CloseCombat"]= "-4" ; break;
                case  "FireArm" : data3["roll20_CloseCombat"]= "-3" ; break;
                default :         data3["roll20_CloseCombat"]= "-1" ;
              };
              AbilityDrop(nm,"repeating_weapons","WPN",un,data3,"noduplicate");
            }

            if(data["roll20_Damage_Blood_Magic"])  AbilityDrop(nm,"repeating_blood","BL",un,data);
            if(data["roll20_Phys"]||data["roll20_Myst"])  {
              data["roll20_Type"]= (data["Type"]=="Shield" ? "-1" : "1");
              data["roll20_Piece"]= (data["Type"]=="Armor Piece" ? "1" : "0");
              AbilityDrop(nm,"repeating_armor","ARM",un,data,"noduplicate");
            }

              if(data["roll20_Qty"])  AbilityDrop(nm,"repeating_inventory","INV",un,data,"addqty"); //version 1
              //  if(data["roll20_UnitWeight"] && data["roll20_UnitWeight"]!=="NA")  AbilityDrop(nm,"repeating_inventory","INV",un,data,"addqty"); //version 2

              if(data["abilityadd"]){ //Process AbilityAdd
                let addjson=parseJSON(data["abilityadd"]);
                log("abilityadd " +JSON.stringify(addjson));
                if(addjson.names && addjson.rep && addjson.code) AbilityDrop(addjson.names,addjson.rep,addjson.code,un,addjson,"AbilityAdd");
                else log("Earthdawn CompendiumDropMgt - Trying to Add nested Ability with invalid JSON");
               }


              vals["drop_data"]=""; //JBF@JBF In the case of a non-droppable, we also reset the data... In other cases the data has to be processed first
            }
            break; // end Goods and Services
            case "Thread Items" :{
              AbilityDrop(nm,"repeating_threads","TI",un,data,"noduplicate");
              vals["tab"]="7";
              break;
            }// end Thread Items

            case  "Mounts" :{
              AbilityDrop(nm,"repeating_mount","MNT",un,data,"noduplicate");
              vals["tab"]="7";
              break;
            }// end Mounts

            default: // If category doesn't correspond, just reset and exit
            log("Earthdawn:CompendiumDropMgt() non droppable compendium category " + values["drop_category"]);
            vals["drop_data"]=""; //In the case of a non-droppable, we also reset the data... In other cases the data has to be processed first
          }

      //We reset here what we have  already processed
      vals["drop_name"]="";
      vals["drop_category"]="";
      vals["drop_unique_name"]="";
      vals["drop_unique_data"]="";
      vals["drop_type"]="";
      vals["drop_data"]="";

      //log(JSON.stringify(vals));
      setAttrsLog( vals );
    });

  }
  catch(err) {log("Earthdawn:CompendiumDropMgt() error caught: " + err );}
}; //end CompendiumDropMgt()
 on("change:drop_name", fn(CompendiumDropMgt));



 //The standard RegEx that we want to use
 var rgNumNoSign="\\s*" + "[\\d]+" + "\\s*",
     rgNumSign="\\s*" + "[\\+\\-]\\s*" + rgNumNoSign  + "\\s*",
     rgSR ="\\s*" +"?" + "\\s*" + "(?:SR|Circle)" + "\\s*",
     rgNum="\\s*" + "[\\+\\-]?\\s*" + rgNumNoSign  + "\\s*",
     rgNumSR="\\s*" + rgNum+"\\s*[\\+\\-]\\s*"+rgSR + "\\s*"+ "|"+
                "\\s*" + rgSR+"\\s*[\\+\\-]\\s*"+rgNum + "\\s*",  // Number + SR or Number + Circl
     rgMove="\\s*" + "Move" +"\\s*[\\+\\-]\\s*" + rgNumNoSign + "\\s*", //Move (+Number)?
     rgHDmg="\\s*" + "Highest\\s*Damage\\s*(?:[\\+\\-]\\s*"+rgNum +")?" + "\\s*", // Highest Damage (+ number)?
     rgHAtk="\\s*" +  "Highest\\s*Attack\\s*(?:Step)?(?:[\\+\\-]\\s*"+rgNum +")?" + "\\s*", // Highest Attack (Step?) (+ number)?
     rgAtk="\\s*" +  "Step\\s*\=\\s*Attack" + "\\s*",
     rgAttSR="\\s*" + "[a-z]{3}\\s*\\+\\s*" + rgSR  + "\\s*" + "|"+   // Attribute + Circle or SR
              rgSR + "\\s*\\+\\s*..." + "\\s*", // Circle + Attribute
     rgWords="\\s*" + "(?:\[a-z\']\\s*)+" + "\\s*",
     rgStep="\\s*" + "(?:"+
                rgNumSR+"|"+
                rgMove+"|"+  // Move + Number
      //          "(?:)?+\\s*(?:SR|Circle)\\s*[\\+\\-]\\s*" + rgNum +"|"+  // (1/2)? Circle + Number
                rgHDmg +"|"+
                rgHAtk + "|"+
                rgAtk +"|"+
                rgAttSR+"|"+
                rgSR + "|"+ //SR or Circle alone
                rgNum+")" + "\\s*"; // Number



 //v3 textImport transferred from API to Sheetworker
 var textImport = function fntextImport(eventInfo) {
   'use strict';
   try{
     //log("textImport " + JSON.stringify(eventInfo));
     let vals = {},
     data={};
     let code;



     if(!eventInfo) {log("Earthdawn:textImport() no eventInfo"); return;}
     if(eventInfo.sourceType!=="player") {
       if(eventInfo.newValue && eventInfo.newValue!=="") log("Earthdawn:textImport() not triggered by player");
       return;
     }
     if(!eventInfo.newValue) {log("Earthdawn:textImport() unknown newValue " +  JSON.stringify(eventInfo)); return;}

     if(eventInfo.sourceAttribute.toLowerCase()=="textimportcreature") code="creature";
     else if(eventInfo.sourceAttribute.startsWith("repeating_masks")) code="mask";
     else if(eventInfo.sourceAttribute.startsWith("repeating_talents")) code="T";
     else if(eventInfo.sourceAttribute.startsWith("repeating_skills")) code="SK";
     else if(eventInfo.sourceAttribute.startsWith("repeating_knacks")) code="NAC";
     else if(eventInfo.sourceAttribute.startsWith("repeating_spell")) code="SP";
     else {log("Earthdawn:textImport() unknown sourceAttribute in eventInfo " +  JSON.stringify(eventInfo)); return;}


     getAttrs([  "edition" ], function gatextImport(values) {

       let fullText = eventInfo.newValue.trim() + " ",
       followup = "",
       locTextStart = 0,
       //save = {},    // keep some values between sections.
       block, blockOffset = 0, blockIndexArray = [];

       if(code!=="creature") vals[eventInfo.sourceAttribute]=""; //Reset the textImport that actually triggered


       // When pasting from a pdf, you also get page numbers and chapter titles.
       // Page number is a line with nothing but whitespace and digits.
       // With a page header, the line following a page number might be entirely upper case.
       // Strip all such, but write warning if stripping a suspected header.
       //
       // This operates on section variable fullText.

       function removePageNumbers() {
         'use strict';
         let eol = fullText.length,
         prev = eol,
         i = fullText.lastIndexOf( '\n', eol -1 );
         while (i !== -1) {
           //  Note: In questors sometimes get something that looks like   "\n~Colm\n"   for no good reason I see. Strip it out.
           if( fullText.slice( i, eol ).match( /^\s*(\d+|\SCol\S)\s*$/ ) ) {
             let x = fullText.slice( eol, prev ).match( /^[A-Z\s]+$/ );
             if( x ) {
               log( "Warning. Stripped out string '" + x[0].trim() + "' because it looked like a chapter heading across a page break. If not, you probably ought to add it back in again manually.");
               fullText = fullText.slice( 0, i) + fullText.slice( prev );    // Page Number and Page Header. Strip the current line and the next.
             } else
             fullText = fullText.slice( 0, i) + fullText.slice( eol );   // Page Number only. Strip the current line out.
           }
           prev = eol;
           eol = i;
           i = fullText.lastIndexOf( '\n', i -1 );
         }
       } // end removePageNumbers


       // This operates on section variables fullText and name.
       // Sanitize the name by removing special characters.
       function getName () {   // Name needs to be alone on first line.
         'use strict';
         let i = fullText.indexOf( '\n' );
         //locTextStart = i + 1; //Line Deleted because we want to proceed the Name Line anyway, because it may contain the str rating
         let nm=fullText.slice( 0, i).trim()                // Name is everything on the first line (up to the first newline).
         .replace( /[\'|\"|\,|\;|\:\~\\+]/gi, "")     // Remove all single and double quotes, commas, colons, semicolons or tildes and character #192 which we use as a flag to trigger this routine.
         .replace( /\@\{/gi, "{")                      // and all @ signs followed by {
           .replace( /\[+/gi, "[" ).replace( /\]+/gi, "]" ).replace( /\{+/gi, "{" ).replace( /\}+/gi, "}" ).replace( /\(+/gi, "(" ).replace( /\)+/gi, ")" )   // All sequences of more than one [] {} () get replaced by a single one.
           .replace( /\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});   // Make sure the first letter of every word is capitalized and that all others are lowercase.

           //Masks will have a name like Major (+2 Circles)
           let fnd=nm.match(/\((.*)\)/);
           if(fnd){
             nm=nm.replace(fnd[0],"").trim();
             let fnd2=fnd[1].match(new RegExp( "(" +rgNum + ")" + "\\s*" + "Circle[s]?" ,"i"))
             if(fnd2) data.SrRating=fnd2[1];
           }

           data.Name=nm;
          return nm;
         } // end getName


         // Try to figure out where the paragraphs really end.
         // We are passed a text block with an end-of-line character wherever the pdf chose to put one.
         // Return the text, with all eol characters removed, except where we think a paragraph actually ends.
         // This would be when a newline is found between a punctuation mark and a Capital, and the line is shorter than the others.
         //
         // Note: This does not work very well, because the PDF sometimes has hard newlines, and sometimes does not! It is probably better than nothing!
         // Explore not doing the 95% test, and just keeping all the candidates.
         //
         // This routine is self-contained and does not operate on section variables.
         function textBlock( tBlock, liberal ) {
           'use strict';
           if( typeof tBlock !== 'string' ) {
             log( "Earthdawn textImport.textBlock: Bad Value" +JSON.stringify(tBlock));
             return;
           }
           // So if we find a newline that we are going to keep, and then a line that starts with a capital letter and has 4 or less words before the next newline, and then a Capital letter, keep the 2nd newline as well.
           let nlnew = 0, ind = [ 0 ], ma;
           if ( liberal )
           ma = tBlock.match( /[\\.\\?\\!\\)\\:\\;]\s*\n\s*[A-Z]/g );    // As below, but also accept an end paran, end bracket, colon, or semi-colon.
           else
           ma = tBlock.match( /[\\.\\?\\!]\s*\n\s*[A-Z]/g );       // All occurrences of, a punctuation mark, a newline, and then a capital letter.
           let mb = tBlock.match( /(^|\n)\s*[A-Z]\s*(\w+\b\W*){1,4}\s*(?=(\n\s*[A-Z]|$))/g ),    // For some reason lines "Immune to (Fear or whatever)" don't end with punctuation.  newline Capital one to four words a newline and a capital.
           mc = tBlock.match( /(^|\n)\s*(Fury|Resist Pain|Willful|Ambush|Dive|Charge)\s*\(.*?\)\s*(?=(\s*\n|$))/gi ),    // start of line, certain words, start and ending paren and everything inside, than another newline, keep both newlines.
           md = tBlock.match(  /(^|\n)\s*Enhanced Sense\s*(.*?\b){1,6}\s*(?=(\n\s*[A-Z]|$))/g );

           // we don't want to keep a \n inside a (), [], or {}.
           // if a backward search finds a ( before a ), and a forward search finds a ) before a (, then keep
           function inside( cr, opn, cls ) {
             'use strict';
             let opnloc = tBlock.lastIndexOf( opn, cr );
             if( opnloc === -1 ) return false;
             let clsloc = tBlock.lastIndexOf( cls, cr );
             if( clsloc === -1 || (clsloc < opnloc)) {
               clsloc = tBlock.indexOf( cls, cr );
               if( clsloc === -1 ) return false;
               opnloc = tBlock.indexOf( opn, cr );
               if( opnloc === -1 || clsloc < opnloc)
               return true;
             }
             return false;
           }
           // Find a list (ind) of newlines that we are going to keep.
           // flags bit 1, keep the newline at the front.    // flags bit 2, keep the newline at the end.
           function keep( m, flags ) {
             'use strict';
             if( !m ) return;
             let curr = -1;
             for (let i = 0; i < m.length; ++i ) {
               curr = tBlock.indexOf( m[ i ], curr + 1);
               if( curr !== -1 )
               if (!inside( curr, "(", ")" ) && !inside( curr, "[", "]" ) && !inside( curr, "{", "}" )) {
                 if( flags & 1 )
                 ind.push( tBlock.indexOf( "\n", curr -1));      // We want the first newline (for match ma it will be the 2nd character, for md and me it will be the first)
                 if( flags & 2) {
                   let t = tBlock.indexOf( "\n", curr +1);
                   if(( flags & 2) && (t !== -1))    // mb and mc only are kept if we already determined that the FIRST newline in the string is to be kept.
                   ind.push( t );      // for match mb, mc, md and me, we want the 2nd newline, so skip the first character (which is the first newline)
                 }
               }
             }
           }
           keep( mc, 3);
           keep( ma, 1);
           keep( mb, 2);   keep( md, 2);
           while( (nlnew = tBlock.indexOf( '\n', nlnew +1 )) !== -1) {       // Check every newline in tBlock
             if( ind.indexOf( nlnew ) === -1 )                 // ind array is list of newlines we want to KEEP.
             tBlock = tBlock.slice( 0, nlnew) + " " + tBlock.slice( nlnew +1 );    // replace all \n that are not where we think the paragraph ends with space.
           }
           //log( tBlock);
           return tBlock;
         } // end textBlock


         // Find all the expected Labels in the block of text.
         // Find toFind, and save it's index.
         // This operates upon section variables block and blockIndexArray
         // NoColon will look at the toFind without adding a Colon
         function blockIndex( toFind, newline ,noColon) {
           'use strict';
           let x = findToken( toFind, newline ,noColon);
           if( x > -1) {
             if( newline )     // If we insisted toFind be the first thing after a newline, find the first non-whitespace character as the real start.
             while( /\s/.test( block.charAt( x )) )
             ++x;
             blockIndexArray.push( {name: toFind, index: x + blockOffset});
           }
         } //end BlockIndex



         // return indexOf toFind within block.
         // This routine uses the section variable block, which must be set before this is called.
         // if newline is true, then the text toLine must immediately be preceded by a newline or at least three spaces (indicating it is the start of a column).
         function findToken( toFind, newline ,NoColon) {
           'use strict';
           let tf = (newline ? "(\\n\\s*|\\s{3,})" : "") + toFind.replace( /\s+/g, "\\s*" ) + (NoColon ? "\\s*:?\\s*" : "\\s*:\\s*");    // rationalize all whitespace.
           let fnd = block.search( new RegExp( tf, "gi" ) );
           if( fnd != -1)
           return fnd;
         } //end findToken




         // statBlock
         // process a statBlock entry.
         // arrayIndex is the index of the blockIndexArray where we are currently processing.
         //    Grab everything between this index and the next and return it as ret[ "raw" ] Strip off the label and return everything as [ "field" ]
         //   If arrayIndex is a string, then don't do the lookup in block, instead do it upon the text passed here.
         // toFind:  Is the label that should start the index. We are looking for the values after this label.

         // attrib If attrib exists, then stuff whatever we find for ret[ "val" ] into the data collevction at the passed name
         // cmd:   Tells us what/how to find the desired information.
         //    NoColon:  All fields are of type "Label: Information", except for these fields, there is no colon, it is "Label Information" with no colon.
         //    NoCut:    Don't cut the field out of block, leave block unchanged.
         //    Word:     ret[ "val" ] is to be the first "word" of non space characters.
         //    Val or Num: ret[ "val" ] is to be the first number it finds.
         //    otherwise,  there is no ret[ "val" ] and the system is interested in Field. .

         // returns: a collection with the following members.
         //          raw:  The raw field (everything between this label and the next) including label.
         //          field:  raw, minus the label.
         //          val:  The data (number or word) we were told to look for.
         //          remain: anything else that is not label or val. These are often secondary values that the program will be looking for.
         // Note: It is important that blockIndex() has found all the indexes and stored them correctly in blockIndexArray[].
         //    It is important that this routine be called in REVERSE index order IE: read and delete stuff from the back of the block to the front.

         // This operates on section variable block, which must have been set prior to calling this.
         // It modifies block, removing found items.
         function statBlock( arrayIndex, toFind, attrib, cmd) {
           'use strict';
           try {
             if( cmd === undefined ) cmd = "";
             let ret = {}, curr,
             //noColon = cmd.search( /nocolon/i ) !== -1,
             word = cmd.search( /word/i ) !== -1,
             value = (cmd.search( /val/i ) !== -1) || (cmd.search( /num/i ) !== -1);

             if( typeof arrayIndex === 'number'  ) {
               curr = block.slice( blockIndexArray[ arrayIndex ]["index"] - blockOffset, blockIndexArray[ arrayIndex + 1 ]["index"] - blockOffset).trim();
               if (cmd.search( /nocut/i ) == -1)     // If this not here, then remove this field from block.
               block = block.slice( 0, blockIndexArray[ arrayIndex ]["index"] - blockOffset) + block.slice( blockIndexArray[ arrayIndex + 1 ]["index"] - blockOffset );
             }
             else if( typeof arrayIndex === 'string' )   // arrayIndex really holds the string to operate upon instead of block.
             curr = arrayIndex;
             else {
               log( "Earthdawn statBlock() bad parameter: typeof arrayIndex " + typeof arrayIndex );
               log( arrayIndex );
               return;
             }

             ret[ "raw" ] = curr.trim();
             let tf = toFind.replace( /\s+/g, "\\s*" ) + "\\s*" + ":?\\s*",//(noColon ? "" : ":\\s*"),      // Look for toFind. Rationalize all whitespace. we usually look for a colon between the label and the value.
             fnd2;
             if( word || value )
             fnd2 = curr.match( new RegExp( tf + (word ? "[\\w\\+\\-]+\\s*" : rgStep), "i" ));
             if( fnd2 ) {      // We looked for and found a value.
               let fnd3 = fnd2[ 0 ].match( new RegExp( tf, "i" ));
               if( fnd3 ) {
                 let c = fnd2[ 0 ].replace( fnd3[ 0 ], "" ).trim();
                 //log( "statBlock " + toFind + "   " + c);
                 ret[ "field" ] = curr.replace( fnd2[ 0 ], c ).trim()
                 ret[ "val" ] = c;
               } else {
                 log( "Earthdawn statBlock() data error.   Somehow did not find: " + tf + "     in " + fnd2[ 0 ] );
                 log( "toFind: " + toFind + "   arrayIndex: " + arrayIndex + "   cmd: " + cmd + "   attrib: " + attrib);
               }
               ret[ "remain" ] = curr.replace( fnd2[ 0 ], "").trim();
             } else {    // We ether did not look for, or did not find a value. Let's just try for Field.
               let fnd = curr.match( new RegExp( tf, "gi" ));
               if( fnd )
               ret[ "field" ] = curr.replace( fnd[ 0 ], "").trim();      // strip off the label.
               else
               followup += "Warning! Failed to find Stat Block entry: " + toFind + ".\n";
               ret[ "remain" ] = ret[ "field" ] ? ret[ "field" ] : curr;
             }
             if( attrib )
             data[attrib]=("val" in ret ) ? ret[ "val" ] :
             (("field" in ret) ? ret[ "field" ] : (( "raw" in ret)?  ret[ "raw"] : "" ));   // if have a val, use it. otherwise use what we have.
             return ret;
           } catch(err) {
             log("Earthdawn statBlock() error caught: " + err );
             log( "toFind: " + toFind + "   arrayIndex: " + arrayIndex + "   cmd: " + cmd + "   attrib: " + attrib);
           }
         } // end statBlock()


        //Look for the character lookup between character open and close and replaces by repl.
        //Useful to remove commas between brackets when commas are also separator for entries
         function saveComma(str, open, close, repl ,lookup) {
             let ret=str,
             m = str.match( new RegExp( "\\" + open + "[^\\" + close + "]*?" + "\\" +lookup + ".*?" + "\\" + close, "g" ));   // open, anything, comma, anything, close.
           if( m )
           for( let i = 0; i < m.length; ++i ) {
             let n = m[ i ].replace( new RegExp( "\\" + lookup, "g"), repl ).replace( /\n/g, " ");
             ret=ret.replace( m[ i ], n);
           }
         return ret
       }// end SaveComma


         // process the creature or mask.
         // This operates on section variable block, which must be set before calling this.

         // Creature - Expected format.
         //
         // Name alone on first line.
         // a text block description of the creature, probably more than one paragraph.
         // Challenge: tier (nn circle)         (Note, this might not be here (spirits, and 1879 they will not)
         // stat block
         // Movement: 12 (Climb 12)
         // Actions: 2; Bite: 12 (8), Barbs x2: 12 (7, Poison)
         // Powers:
         // List of Powers, each one will start a new line, but some are several lines long.
         // Enhanced Sense [Smell] (2)
         // Poison (8): A victim hit by the barbs on the inside of a preces forearms is exposed to the damaging poison. The poison is Step 8 [Onset: 1 round, Interval: 5/1 round]. The pain caused by the poison also applies a -1 penalty to the victims tests.
         // Great Leap (6)
         // Look for newline, 1 to 4 words, then a paran, number, endparen. might also have brackets. If get that, might have new power.
         // Enhanced Sense [Sight]: Low-Light Vision
         // Except might not get the paren number endparen. Could also look for short lines with short lines above. and/or colons.
         // Or just look for lines starting Enhanced Sense [Sight] might be worth doing.
         // For Dragons, instead of Powers: might get Starting Powers: and a list, Power Ranks, a number and text, and Sample Distribution. If so, a list of the suggested powers will appear with the possibility to put them manually
         // or Additional Powers (Choose Three): and a list.
         // Special Maneuvers:
         // Defang (Opponent)
         // Loot: (optional).
         function parseCreature(name ) {
           'use strict';
           try {
             //log( "parse " + name); log(block);

             let lastBlock = 9999,   // This holds the index number of the first label that is not a short simple value. The short simple values are all lumped into one afterblock. The ones after this index all have special processing.
             carryover="",
             spells, third,atkArray=[],pwrArray=[],suggpwrArray=[],manArray=[],spArray=[],wpnArray=[];
             let HorrorPowerArray=["Animate Dead", "Astral Camouflage", "Aura of Awe", "Corrupt Compromise", "Corrupt Karma", "Corrupt Reality", "Cursed Luck", "Damage Shift","Disrupt Magic", "Forge Construct", "Forge Trap", "Harvest Energy", "Horror Power", "Horror Mark", "Horror Thread", "Karma Boost", "Karma Drain","Skin Shift","Suppress Mark","Terror", "Unnatural Life"],
             DragonPowerArray=["Armored Scales", "Disrupt Fate", "Dragon Breath", "Dragonsight", "Dragonspeech", "Karma Cancel", "Lair Sense", "Suppress Magic","Wingbeat"]; //These arrays are used to detect if we are dealing with an Horror or Dragon by some reserved Powers


             //Race is dealt multiple ways,
             //In the Block Index Strength Rating, if we found something, it means it is a Spirit
             //If we find a number + SR it means it is a spirit too

             if(fullText.match(/\d\s{0,1}[\+\-]\s{0,1}SR[a-z|A-Z]/)) data.Race="Spirit";

             blockIndex( "Attributes" );       // 1st Ed.
             blockIndex( "Challenge" );        blockIndex( "Legend Award" ); blockIndex( "Strength Rating",null,true ); // Challenge is 4th edition, Legend Award is 3rd, Spirits have listed a Strength Rating range..
             blockIndex( "DEX" );
             blockIndex( "STR" );
             blockIndex( "TOU" );
             blockIndex( "PER" );
             blockIndex( "WIL" );
             blockIndex( "CHA" );
             blockIndex( "Initiative" );
             blockIndex( "Unconsciousness" );  blockIndex( "Uncon" );    blockIndex( "Unconsciousness Rating" );
             blockIndex( "Death Rating" );     blockIndex( "Death" );
             blockIndex( "Wound Threshold" );  blockIndex( "Wound" );
             blockIndex( "Recovery Tests" );
             blockIndex( "Knockdown" );
             blockIndex( "Physical Defense" ); blockIndex( "PhyDef" );
             blockIndex( "Mystic Defense" );   blockIndex( "MysDef" );       blockIndex( "Spell Defense" );
             blockIndex( "Social Defense" );   blockIndex( "SocDef" );
             blockIndex( "Mystic Armor" );     blockIndex( "MysArm" );       blockIndex( "Armor", true );
             blockIndex( "Physical Armor" );   blockIndex( "PhyArm" );
             blockIndex( "Karma" );
             blockIndex( "Combat Movement" );  blockIndex( "Full Movement" );  blockIndex( "Movement" ,true);
             blockIndex( "Move" );
             blockIndex( "Actions" );         blockIndex( "Number of Attacks" );            blockIndex( "Number of Spells", true );
             blockIndex( "Attack", true );    // ED 1st Ed.
             blockIndex( "Attack \\( \\d* \\)", true );    // ED 3rd ed     Attack (2)
             blockIndex( "Spellcasting" );       // ED 1st Ed.
             blockIndex( "Damage" );                       // ED 3rd ed
             blockIndex( "Effect", true );       // ED 1st Ed.
             blockIndex( "Starting Powers" );
             blockIndex( "Powers", true );
             blockIndex( "Suggested Powers" );
             blockIndex( "Sample Distribution" );
             blockIndex( "Additional Power(s)?\\s*\\([\\w\\s]*\\)");
             blockIndex( "Special Maneuvers" ); blockIndex( "Combat Options" );
             blockIndex( "Legend Points" );      // ED 1st Ed.
             blockIndex( "Equipment" );
             blockIndex( "Loot" );
             blockIndex( "Spells" ); blockIndex( "Spells\\s*\\([^\\(]*\\)" ); //Spells (Players Guide)


             blockIndexArray = _.sortBy( blockIndexArray, "index" );
             if( blockIndexArray.length < 1) {
               log( "Warning, TextImport was not able to parse that at all");
               return;
             }
             blockIndexArray.push( {name: "eof", index: block.length + blockOffset});
             block = block.slice( blockIndexArray[0].index - blockOffset ).trim();   // block now just consists of our identified statblock.
             blockOffset = blockIndexArray[ 0 ].index;
             let toUpdate = [];


             for( let i = blockIndexArray.length -2; i > -1; --i) {      // loop 1
               let tf = blockIndexArray[ i ][ "name"].toLowerCase();
               switch( tf ) {
                 case "attributes":   break;    // ED 1st Ed.  Do nothing.
                 case "dex":         statBlock( i, tf, "Dex_Step", "Num" ); break;
                 case "str":         statBlock( i, tf, "Str_Step", "Num" );   break;
                 case "tou":         statBlock( i, tf, "Tou_Step", "Num" );   break;
                 case "per":         statBlock( i, tf, "Per_Step", "Num" );   break;
                 case "wil":         statBlock( i, tf, "Wil_Step", "Num" );   break;
                 case "cha":         statBlock( i, tf, "Cha_Step", "Num" );   break;        // Above we actually changed stuff. Below we save information for next loop.
                 case "initiative":  statBlock( i, tf, "Initiative", "Num" ); break;
                 case "knockdown":   statBlock( i, tf, "Knockdown", "Word" );   break; //Word to be able to process NA or Immune
                 case "unconsciousness rating":
                 case "uncon": case "unconsciousness":     statBlock( i, tf, "Damage_Unc_Rating", "Word" );     break; //Word to be able to process NA or Immune
                 case "death": case "death rating":        statBlock( i, tf, "Damage_Death_Rating", "Num" );   break;
                 case "wound": case "wound threshold":     statBlock( i, tf, "Wound_Threshold", "Num" );        break;
                 case "recovery tests":                    statBlock( i, tf, "Recovery_Tests_max", "Num" );     break;
                 case "phydef":  case "physical defense":  statBlock( i, tf, "PD", "Num" );             break;
                 case "spell defense":
                 case "mysdef":  case "mystic defense":    statBlock( i, tf, "MD", "Num" );             break;
                 case "socdef":  case "social defense":    statBlock( i, tf, "SD", "Num" );             break;
                 case "armor":   case "phyarm":    case "physical armor": {
                   let x=statBlock( i, tf, "PA", "Num" );
                   if( "remain" in x && x[ "remain" ] ) //ED3, Damage lines are carried over several lines, save them for future use
                   carryover += x[ "remain" ];
                 } break;
                 case "mysarm":  case "mystic armor": {
                   let x=statBlock( i, tf, "MA", "Num" );
                   if( "remain" in x && x[ "remain" ] ) //ED3, Damage lines are carried over several lines, save them for future use
                   carryover += x[ "remain" ];
                 } break;
                 case "attack":                      // ED 1st Ed. Attack: 7
                 case "spellcasting":
                 case "attack \\( \\d* \\)": {       // ED 3rd Ed, Attack (5): 11
                   //log("attack");
                   let sc = (tf === "spellcasting");
                   let pwrtmp={},
                   x=statBlock( i, tf, null, "Num" );
                   pwrArray.push({Name: (sc ? "Spellcasting" : "Attack") , Step: x["val"].trim()});
                 } break;


                 case "effect": {    // ED 1st Ed.   Effect: Poison (see below)
                   let x = x=statBlock( i, tf, null, "Word" );
                   if( !isNaN( x[ "val" ] )) {
                     pwrArray.push({Name: "Effect" , Mod_Type:"Effect", Step: x["val"]});
                   }
                 } break;


                 case "damage": {    // ED 3rd ED. The problem here is that the actual damage step(s) may be on the line(2) below.
                                     // Damage: Bite (1): 6; Physical Armor: 0
                                     // 2Claws (2): 7; Tail (3): 8 Mystic Armor: 1
                                     // Rule. if Physical Armor and/or Mystic Armor have a newline in them. Then that part is really the continuation of damage.
                                     // ED 1st ED.   Damage: 8
                   let t = (statBlock( i, tf, null, "num")[ "field" ] + carryover);   // slice off the label (damage:)

                  t=saveComma(t, "(", ")"," ",";");   // Replace ; by -
                  t=saveComma(t, "[", "]"," ",";");
                  t=saveComma(t, "{", "}"," ",";");
                   let dmgarr = t.split( ";" );
                   for( let i = 0; i < dmgarr.length; ++i ) {
                     //log("trying to pars dmg " + dmgarr[i]);
                     let beg = dmgarr[ i ].indexOf( "(" ),
                         end = dmgarr[ i ].indexOf( ")" );
                     if( beg !== -1 && end !== -1 ) {
                       let nm = dmgarr[ i ].slice(0, beg).trim(),
                       dmgrk=parseInt( dmgarr[ i ].slice( beg + 1, end )),
                       dmgtxt=dmgarr[i].slice( end+2 , dmgarr[i].length ),
                       fnd=dmgtxt.match(new RegExp( "\\s*" + "("+rgNum+")" + "(.*)","i"  )),
                       entry={};
                       entry.Name=nm + ((fnd && fnd[2]) ? (" " + fnd[2].trim()) : ""); //append to the name anything remaining like a (poison; see text)
                       if(fnd && fnd[1]) entry.Step=fnd[1].trim();
                       entry.Rank=dmgrk;
                       wpnArray.push( entry);
                       log ("fnd " + JSON.stringify(fnd));
                     } else
                       log( "ED.textImport.Damage: unable to parse: '" + dmgarr[ i ] + "' of " + t);
                   }
                   carryover = "";
                 } break;


                 case "karma": {       // Karma: 8 (32)   This means they start with 32 step 8 karma!
                   let x = statBlock( i, tf, "KarmaStep", "num");
                   if( "remain" in x ) {
                     let fnd = x[ "remain" ].match( /\(.+?\)/ );     // everything inside paren
                     if( fnd ) {
                       let k = fnd[0].replace( /[\(\,\)]/g, "" ).trim();    // trim off ( and ) and comma
                       if( k ) data["Karma_max"]=k;
                       //Case of Spirits will be dealt in Powers, their Karma Step is based on CR.
                     } }
                   } break;

                   case "legend award": third = true;
                   case "strength rating" :
                   case "challenge": {     // new creature only.     // Challenge: Journeyman (Seventh Circle)
                     let ord,cr,
                     x = statBlock( i, tf, null, "Word"+ (tf=="strength rating" ? " nocolon" : ""));     // This will get the tier, such as "Journeyman"
                     //log("dealing with SR " + JSON.stringify(x));
                     if(tf=="strength rating" && x && x["field"]){ //For spirit Strength rating, we take the first occurence of the strength rating range
                       data["Race"]="Spirit";
                       let y=x["field"].match(new RegExp(rgNum,"i"));
                       //log(" y " + JSON.stringify(y));
                       if(y && y[0]) cr=y[0];
                     }

                     if ( third )
                     ord = x[ "val" ].toLowerCase();
                     else {
                       let fnd = ( "remain" in x ) ? x[ "remain" ].match( /\(\w+/i ) : undefined;    // get circle as first word inside paren
                       if( fnd )
                       ord = fnd[0].slice(1).toLowerCase();
                     }
                     if( ord ) {
                       cr = [ "zero", "first", "second", "third", "fourth", "fifth", "sixth", "seventh", "eighth", "ninth",
                       "tenth", "eleventh", "twelfth", "thirteenth", "fourteenth", "fifteenth", "sixteenth" ].indexOf( ord );
                     }
                       if( cr !== -1 ) data["SrRating"]=cr

                     } break;
                     case "move":      case "combat movement":     case "full movement":
                     case "movement": {
                       //log("parsing movement");                    // Movement: 4 (Flying 18)
                       let x = statBlock( i, tf, "Movement", "Word" );
                       //log('Movement :' + x["remain"]);
                       if( x[ "remain" ] && x[ "remain" ].length > 4 ) { //We have an alternate movement
                         let rg="\\(?\\s*" + "(?<name>"+ rgWords + ")" + "\\s*" + "[\\(\\)\\[\\]]?" + "(?<rate>" +rgStep+ ")"+ "[\\(\\)\\[\\]]?" +"\\s*\\)?"; // <Name> <Rate> with rate potentially between brackets
                         let f = x["remain"].match(new RegExp( rg , "i" ));
                         //log("Movement remain lookup " + JSON.stringify(f));
                         //Look for (<name><rate>?)
                         if(f){
                           data["Movement2"]=f[1].replace("(","").replace(")","");
                           if(f[2]) data["Movement2_Rate"]=f[2];
                         }
                         else data["Movement2"]=x["remain"].replace("(","").replace(")","");

                         // if(x["remain"].toLowerCase().includes("fly")){//Flying : we have a specific field for that
                         //   data["Fly_max"]="1";
                         //   data["Fly_Movement_Race"]=x["remain"].match(/\d+/) ? x["remain"].match(/\d+/)[0] : x["val"]; //some have flying with no value
                         // }
                         // else { //add Special Movement as a power
                         //   pwrArray.push( {Name : x[ "remain" ].trim(), Description: x[ "remain" ].trim()});
                         // }
                       }
                       // save[ tf ] = "<b>" + tf.slice(0, 1).toUpperCase() + tf.slice( 1 ) + ":</b> " + x[ "field" ];
                       lastBlock = Math.min(i, lastBlock);
                     } break;

                     case "number of attacks":   case "number of spells":
                     case "actions": {   // Actions: 2; Bite: 18 (14), Claw x2: 18 (13)
                       // Actions: 0; Attack +3 (Damage +0)   or   Actions: 4; Bite 23 (30), Claws x4 23 (28) // Actions: 1; Horns 11 (18), Trample 11 (16)
                       // Actions: 0; Attack +3 (Damage +1)
                       let t = statBlock( i, tf, "Actions", "num");
                       if(  t && t[ "remain" ] ) {     // This is a new creature, and we have attacks and damage to add.
                         let ttmp = t[ "remain" ].replace( /\)\s*[\,\;]/g, ")" + "|");   // comma sometimes comes inside a damage paren, so can't just split on comma.
                         //let gmnotes = "<b>" + tf.slice(0, 1).toUpperCase() + tf.slice( 1 ) + ":</b> " + t[ "val" ] + " - ";
                         let att = ttmp.split( "|");
                         for( let i = 0; att && i < att.length; ++i ) {
                           let a2 = att[ i ],atk,dmg,disp;
                           a2=a2.replace(/\n/,"");
                           let fnd3 = a2.match( /\s+x\d+[\:\s]+/g );   // if there is something that looks like space an x, digits, an optional colon and a space, it is number of claws the creature has, get rid of it.
                           if( fnd3 )
                           a2 = a2.replace( fnd3[ 0 ], " " );
                           let fnd = a2.match( /\(.+?\)/ );   //JBF@JBF was  /\(.+?\)/  // everything inside paren
                           if( fnd ) {
                             let dmgMaybe = fnd[0].replace( /[\(\,\)]/g, "" ).trim();    // trim off ( and ) and comma
                             //log("with a2 " + a2 + " dmgMaybe is "+ dmgMaybe);
                             let fnd9 = dmgMaybe.match( new RegExp( rgStep ,"i")); //JBF@JBF was "/[\d\sSR\+\-]+$/"//looking for the damage in numerical or 5+SR form
                             dmg = fnd9 ? fnd9[0].trim() : dmgMaybe ;//getSR(dmgMaybe),                      //JBF@JBF : this one is questionable... we coulod have a 5+SR that we want to keep, but we could also hane notes like Poison
                             //log("dmg is "+dmg);
                             disp = dmgMaybe.replace( dmg, "" ).trim();    // If there is anything else left over after the damage has been removed, display it when talent is used. This is likely a note like "Poison", etc.
                             a2 = a2.replace( fnd[ 0 ], "" );    // get rid of paren and everything inside it.
                            }
                             let fnd2 = a2.match(new RegExp( rgStep +"$","i")); //JBF Was /[\d\sSR\+\-]+$/ and befor  "/[\d\sSR\+\-]+$/"    // digits near the end.
                             //log( "a2 "+ a2 + " fnd2 " + JSON.stringify(fnd2));
                             if( fnd2 ) {
                               atk = fnd2[0].trim();
                               a2 = a2.replace( fnd2[ 0 ], "");
                             }
                            let typ = a2.replace( /[:;,]/g, "" ).trim()+(fnd3 ? (" " + fnd3[0].replace("\:","").trim()) : "");

                             // let pwrnm= (typ=="Attack" ? "Attack" : "Atk " + typ + (disp ? " (" + disp + ")" : ""));
                             // let dmgnm= (typ=="Attack" ? "Damage" : "Dmg " + typ + (disp ? " (" + disp + ")" : ""));
                             // //log(pwrnm);
                             // wpnArray.push( {Name: dmgnm, Step: dmg});//, Description: disp});
                             // pwrArray.push( {Name: pwrnm, Step: atk});//, Description: disp});
                             let atkdata={"Name":typ , "Atk_Step" : atk , "Dmg_Step" : dmg };
                             if(disp) atkdata["Atk_Info"]=disp;

                             atkArray.push(atkdata);

                         }
                       } else

                       lastBlock = Math.min(i, lastBlock);

                     } break;  // end Actions

                     //JBF@JBF still need to deal with ED3 syntax
                     case "additional power(s)?\\s*\\([\\w\\s]*\\)" :
                     log("found additional powers "+tf);
                     let y=statBlock(i,"additional power(s)?",null,"Word nocolon nocut"),
                     numsugg,numsugg2;
                     log("trying to do y" +JSON.stringify(y));
                     if(y && y.raw){
                       numsugg=y["raw"].match(new RegExp("\\(choose\\s*([a-z]+)\\)","i"));
                       log("keep parsing " +JSON.stringify(numsugg));
                       if(numsugg && numsugg[1]){
                         numsugg2=0;
                         switch(numsugg[1].trim().toLowerCase()){
                           case "one" : numsugg2=1; break; case "two" :numsugg2=2;break;case "three" :numsugg2=3;break;case "four" :numsugg2=4;break;case "five" :numsugg2=5;break;case "six" :numsugg2=6;break;
                           case "seven" :numsugg2=7;break;case "eight" :numsugg2=8;break;case "nine" :numsugg2=9;break;
                         }
                         log("found numsugg2 " + numsugg2);
                          data["numSuggPowers"]=numsugg2;
                       }
                     }
                     case "suggested powers":
                     case "sample distribution":
                     var sugPowers = true;     // We fall through on purpose, these are processed the same way.
                     case "starting powers":
                     case "powers": {

                      //ED4 Sample Distribution: Armored Scales, Dispel Magic (28), Disrupt Fate (28)
                      //    Powers: Astral Sight, Manifest, Power, Spellcasting
                      //    Powers:
                      // Awareness (7): As the skill, Players Guide, p. 129.
                      // Enhanced Sense [Sight]: Heat Sight
                      // Enhanced Sense [Smell] (4)
                      // Enhanced Sense [Taste] (4)
                      // 355
                      // Poison (16): The poison is Step 16 [Onset: 1 round, Interval: 4/2 rounds] (see Poison,
                      // p. 171). Unlike most debilitating poisons, witherfang venom and has an effect similar
                      // to the Wither Limb spell (Players Guide, p. 333). The penalty from the poison only
                      // affects tests made with the affected limb. The effect lasts until reversed with powerful
                      // magic like Reverse
                      //Spikes (6, Poison): A character who fails an attack against a ghoul lizard must make a
                      //Dexterity (7) test. If failed, the attacker is struck by one of the lizards spikes, taking
                      //Step 6 damage, reduced by Physical Armor. If the character takes damage, the lizards
                      //poison affects them.

                      //ED3 : Powers: Camouflage (5): 9, Climbing S (5): 12, Durability (5)

                       let t = statBlock( i, tf );
                       lastBlock = Math.min(i, lastBlock);
                       if( !t )
                       break;
                       let sp = t[ "field" ],
                       cntnewlines = t[ "raw" ].match( /\n/g ),
                       cntnewlinesagain = sp.match( /\n/g ),
                       //gmnotes = "<b>" + tf.slice(0, 1).toUpperCase() + tf.slice( 1 ) + ":</b> ",
                       lst, lst2 = "", cnt = 0;
                       if( !sugPowers && cntnewlines && cntnewlinesagain && cntnewlines.length !== cntnewlinesagain.length ) {   // One of the newlines got stripped off when we removed the label. that means the label terminated in a newline, therefore there is no lst, only lst2. !sugPowers is because sugPowers are always a comma delimited
                         lst = "";     // There is no list of standard powers such as spirits have.
                         lst2 = sp;      // This is the list of custom powers.
                       } else {    // Spirits and some dragons have a comma delimited short list of standard powers, followed by a longer list of custom powers. Get both.
                         let endlist = sp.search( /\nPowers\n/ );
                         if( endlist === -1 )
                         endlist = sp.search( /\n.+:/ );     // Find end of comma delimited list of common powers, and start of list of custom powers. We do different things with these two lists.
                         else
                         sp = sp.replace( /\nPowers\n/, "\n" );    // In sample spirits, we get powers summary, suggested powers summary, and then custom powers. Get rid of that third label.
                         if( endlist != -1 ) {
                           lst =sp.slice( 0, endlist).replace( "\n", " " );   //JBF@JBF cancelled starting and ending with a comma, makes searching easier.
                           lst2 = sp.slice( endlist);
                         } else
                         lst = sp.replace( "\n", " " ); //JBF@JBF cancelled starting and ending with a comma, makes searching easier.
                       }
                       //log( "tf " + tf + " lst  " + lst); log( "lst2 " + lst2);

                       if( lst ) {                     // Dragons : Armored Scales, Dragonsight (21), Dragonspeech (19), Resist Pain (2) or
                                                      //ED3 : Powers: Camouflage (5): 9, Climbing S (5): 12, Durability (5)

                         //lst = lst.replace( /\,/g, "|");     // change all comma's to a pipe
                         lst=saveComma(lst, "(", ")",";",",");   // Replace commas by ;
                         lst=saveComma(lst, "[", "]",";",",");
                         lst=saveComma(lst, "{", "}",";",",");

                         let lst3=lst.split(",");
                         //log("lst3 "+ JSON.stringify(lst3));

                         for(let j=0; j<lst3.length;j++){
                           let p=lst3[j],
                           entry={},
                           fnd5=p.match(/\((.*)\)/i),
                           val1,val2,val3,rem,coli,rstr,fnd7;
                           //log("for p "+p + " fnd5 is " +JSON.stringify(fnd5));
                           if(fnd5 && fnd5[1]) {//There is something between brackets
                             let fnd6=fnd5[1].match(new RegExp(rgStep,"i"));
                             //log("for p "+p + " fnd6 is " +JSON.stringify(fnd6));
                             if(fnd6) { // We found a number in the brackets use it as number
                               val1=fnd6[0].trim();
                               p=p.replace(fnd5[0],"").trim();
                               rem=fnd5[1].replace(fnd6[0],"").replace(";","").trim();
                               if(rem!="") val2=rem;
                             }
                           }
                           coli=p.indexOf( ":" ) //there is something ater the :
                            if(coli!==-1){
                            rstr=p.slice(coli+1,p.length);
                            p=p.slice(0,coli-1);

                            fnd7=rstr.match(new RegExp (rgNum,"i"));
                            //log("looking for a val3 in " +rstr+ " & fnd7 is "+JSON.stringify(fnd7));

                            if(fnd7){ //we found a number after the :
                              val3=fnd7[0].trim();
                              rstr=rstr.replace(fnd7[0],"").trim();
                              if(rstr && rstr.length>0) p= p + "-" + rstr;
                            }
                          }
                           entry.Name=p;
                           if(!data["Race"] && HorrorPowerArray.includes(p)) data["Race"]="Horror"; //Test if the power is in the restricted list of Dragons/Horror to guess the Race
                           if(!data["Race"] && DragonPowerArray.includes(p)) data["Race"]="Dragon";

                           // In an ED3 format we have now <name> (<rank> <ranktxt>) : <Step> <comment>? detected with val1=rank, val2=ranktxt and val3=Step
                           //In an ED4 format we will have <name> (<step> <steptext>) so val1=Step
                           if(val3){
                             entry.Step=val3;
                            if(val1) entry.Rank=val1;
                          } else if(val1) entry.Step=val1
                           if(val2) entry.Step_Info=val2; //when there is a secundary value in the brackets.
                           if(sugPowers) suggpwrArray.push(entry);
                           else pwrArray.push(entry);
                         }
                       } // end lst not blank (purposely indented wrong).

                       //Now dealing with the Powers that all start with a newline
                       sp = textBlock( lst2, true ).trim();
                       if( sp )
                       sp = sp.split( "\n" );
                       else
                       sp = [];
                       let tar = [];     // make a list of things we think should NOT have been broken.
                       for( let i = 1; i < sp.length; ++i )
                       if( sp[ i ].length > 40) {        // if shorter than 40 characters, don't merge.
                         let tind = sp[ i ].indexOf( ":" );
                         if( tind > 40 || tind === -1)             // if longer than 40, and don't have colon in first 40, merge.
                         tar.push( i );
                       }
                       while( tar.length ) {       // This is list of powers that might have accedently been split, merge them back together.
                         let merge = tar.pop();
                         sp[ merge - 1] += "\n" + sp[ merge ];
                         sp.splice( merge, 1);
                       }
                       for( let i = 0; i < sp.length; ++i ) {    // Array of powers, split by newlines.
                         let toCheck = sp[ i ].trim(),
                         cnt = 0, rnk, nmpos = 99999,info,
                         tnm = toCheck.indexOf( ":" );
                         //log("processing lst2 " + toCheck)
                         if( toCheck.trim().length < 2 || toCheck.trim() === "Powers" )    // Some have powers listed after suggested powers. Ignore duplicate.
                         continue;
                         let pwr  = (tnm !== -1) ? toCheck.slice( 0, tnm).trim() : toCheck,
                         ptxt = (tnm !== -1) ? toCheck.slice( tnm +1 ).trim() : "";
                         let fnd = pwr.match( /\(.*?\)/ );     // Everything inside paren
                         if( fnd ) {
                           rnk = fnd[ 0 ].slice( 1, -1).trim();
                           let fnd2=rnk.match(new RegExp("(" + rgStep + ")" +"\\s*\\,\\s*" + "("+rgWords +"(?:\," + "("+rgWords+"))?" +")" ,"i")); //If the value between brackets  is in the form "<step>,<info>" with info a word, or "word,"word"
                           if(fnd2) {
                             //log("fnd2");
                             rnk=fnd2[1];
                             if(fnd2[2]) info=fnd2[2]
                           }
                           pwr = pwr.replace( fnd[ 0 ], "");
                         }

                         pwr = pwr.trim();
                         // gmnotes += "<br>" + "<i>" + pwr + "</i>" + (rnk ? " (" + rnk + ")" : "") + (ptxt ? " " + ptxt : "");

                         let entry={};
                         entry.Name=pwr;
                         if(!data["Race"] && HorrorPowerArray.includes(pwr)) data["Race"]="Horror"; //Test if the power is in the restricted list of Dragons/Horror to guess the Race
                         if(!data["Race"] && DragonPowerArray.includes(pwr)) data["Race"]="Dragon";
                         if(rnk) entry.Step=rnk;
                         if(ptxt) entry.Description=ptxt;
                         if(info) entry.Step_Info=info;
                         if(sugPowers) suggpwrArray.push(entry);
                         else pwrArray.push(entry);
                       } // end for each power
                       // if( sugPowers )
                       //   save[ "suggested powers" ] = gmnotes.trim().replace( /<br>$/, "");
                       // else
                       //   save[ "powers" ] = gmnotes.trim().replace( /<br>$/, "");
                       sugPowers = undefined;    // be ready for the next time it arrives here!
                     } break;    // powers

                     // Overrun (Dyre, Trample)    Provoke (Opponent, Close Combat)       Horn Sweep (Dyre, Horns): The dyre may ...
                     case "combat options" :
                     case "special maneuvers": {         // No Change   or    Dispelling Strike (Creature, Close Combat): The creature may ...
                       function checkbx( toCheck, toFind, box ) {
                         'use strict';
                         let fnd = toCheck.match( new RegExp( "^" + toFind.replace( /\s+/g, "\\s*")   , "gi" ) );
                         if( fnd ) {
                           let mandata={Name:toFind}; //was box
                           let tf2=toCheck.replace(fnd[0],"").trim();
                           let fnd2=tf2.match(new RegExp("\\((.*)\\)","i"))
                           if (fnd2 && fnd2[1]) mandata["Info"]=fnd2[1].trim();
                           manArray.push(mandata);
                           return 1;
                         } else return 0;
                       }
                       let x = statBlock( i, tf );
                       lastBlock = Math.min(i, lastBlock);
                       //let gmnotes = "<b>" + tf.slice(0, 1).toUpperCase() + tf.slice( 1 ) + ":</b><br>";
                       let  sp = textBlock( x[ "field" ].trim(), true ).split( "\n" );   // First textBlock groups them into lines that are hopefully right (one manuver per line), then we split them on those lines, so we can process each individually.
                       for( let i = 0; i < sp.length; ++i ) {
                         let toCheck = sp[ i ].trim(),
                         cnt = 0, nmpos = 99999,
                         tnm = toCheck.indexOf( "(" );

                         if( toCheck.search( /No Change/gi ) !== -1)
                         continue;
                         if( tnm !== -1 )
                         nmpos = tnm;
                         tnm = toCheck.indexOf( ":" );
                         if( tnm !== -1 && tnm < nmpos )
                         nmpos = tnm;
                         // if( nmpos != -1 && nmpos < 99999)
                         //   gmnotes += "<i>" + toCheck.slice(0, nmpos) + "</i>" + toCheck.slice( nmpos) + "<br>";   // highlight up to first colon or open paren.
                         // else
                         //   gmnotes += toCheck + "<br>";

                         // cnt += checkbx( toCheck, "Clip the Wing");//, "Opponent-ClipTheWing");
                         // cnt += checkbx( toCheck, "Crack the Shell");//, "Opponent-CrackTheShell");
                         // cnt += checkbx( toCheck, "Defang");//, "Opponent-Defang");
                         // cnt += checkbx( toCheck, "Enrage");//, "Opponent-Enrage");
                         // cnt += checkbx( toCheck, "Provoke");//, "Opponent-Provoke");
                         // cnt += checkbx( toCheck, "Pry Loose");//, "Opponent-PryLoose");
                         // cnt += checkbx( toCheck, "Hardened Armor");//, "Creature-HardenedArmor");
                         // cnt += checkbx( toCheck, "Grab and Bite");//, "Creature-GrabAndBite");
                         // cnt += checkbx( toCheck, "Hamstring");//, "Creature-Hamstring");
                         // cnt += checkbx( toCheck, "Overrun");//, "Creature-Overrun");
                         // cnt += checkbx( toCheck, "Pounce");//, "Creature-Pounce");
                         // cnt += checkbx( toCheck, "Squeeze the Life");//, "Creature-SqueezeTheLife");

                         if( !cnt ) {    // The Special Maneuver we found does not appear to be a standard one.
                           let l = toCheck.indexOf( ":" ),
                           nm=toCheck,
                           opponent,mandata;
                           if( l != -1 ) nm = toCheck.slice( 0, l);
                           if( nm.search( /\(.*?Opponent.*?\)/i ) !== -1)  opponent = true;     // The word Opponent anywhere inside of parentheses.
                           //nm = nm.replace( /Opponent\,*/gi, "" );     // remove the word Opponent
                           //log ("Opponent " + (opponent ? "-1" : "1"));
                           mandata={Name:nm , Type: (opponent ? "-1" : "1")}
                           if(l != -1 ) mandata.Description=toCheck.slice( l+1);
                           //nm = nm.replace( new RegExp( "(" + name.replace(",", "|" ).replace( /\s+/g, "") + ")+"+"[\s\,]*", "gi" ), "");  // remove creature name
                           //nm = nm.replace( /\(\s*/, "(").replace( /\s*\)/, ")").replace( /\s*\([\s\,]*\)\s*/gi, "").trim();   // if we now have an empty paren, remove that.
                           let fndinfo=nm.match(new RegExp("\\((.*)\\)","i"));
                           //log('nm '+nm);
                           if(fndinfo){
                             //log("fndinfo "+ fndinfo[0]);
                             nm=nm.replace(fndinfo[0],"").trim();
                             mandata["Name"]=nm;
                             mandata["Info"]=fndinfo[0].slice(1,fndinfo[0].length-1).trim();
                           }


                           manArray.push(mandata);
                           // } else    // could not find a colon.
                           // log( "Warning!   Could not parse Special Maneuver " + toCheck + "   Do it manually. ");
                         }
                       }
                     } break;      // End maneuver
                       case "legend points":     // ED 1st Ed.
                       case "equipment":         // Equipment: Cave Axe (Size 6, Damage Step 8, worth 50 silver), Hide Armor
                       case "loot": {            // Loot: Crystal shards and fragments of Elemental earth worth 3D620 silver pieces (worth Legend Points).
                         let x = statBlock( i, tf );
                         data[tf]=x[ "field" ];
                         lastBlock = Math.min(i, lastBlock);
                       } break;

                       case "spells\\s*\\([^\\(]*\\)" : //Spells (Players Guide): (These are typical spells to choose from) Astral Spear (p. 317),
                                                        //Ethereal Darkness (p. 319), Soul Armor (p. 321), Spirit Dart (p. 322), Spirit Grip (p.
                                                        //322), Shadows Whisper (p. 324), Pain (p. 327), Viewpoint (p. 330), Blind (p. 331)
                       case "spells": { //Air Armor, Fingers of Wind, Slow Weapon, Winds of Deflection, Air Blast
                         let t = statBlock( i, tf );
                         lastBlock = Math.min(i, lastBlock);
                         if( !t ) break;
                         let sp = t[ "field" ].replace("\n", " ").split(",");
                         for(let i=0;i<sp.length;i++) {
                           log(sp[i].trim())
                           let entry={};
                           entry["Name"]=sp[i].replace(/\n/," ").replace(/\./,"").replace(/\(.*\)/,"").trim(); //Remove anything between parenthesis
                           spArray.push(entry);
                         } // end for each spell
                       } break;    // spells
                       default:
                       log( "ED.textImport.Creature: Somehow got value of: " + tf);
                     } // end switch
                   } // end for each label found

                   if(atkArray.length>0) data["Attacks"]=atkArray;
                   if(pwrArray.length>0) data["Powers"]=pwrArray;
                   if(suggpwrArray.length>0) data["SuggPowers"]=suggpwrArray;
                   if(manArray.length>0) data["Maneuvers"]=manArray;
                   if(spArray.length>0) data["Spells"]=spArray;
                   if(wpnArray.length>0) data["Weapons"]=wpnArray;

                 } catch(err) { log( "Earthdawn.textImport.parseCreature() error caught: " + err); }
                 return true;
               } // end parseCreature


               //
               // Start of textImport main routine processing section.
               //
               switch( code ) {
                 case "mask" :
                 case "creature": {
                   removePageNumbers();
                   //vals["NPC"]="1"; //it is an NPC JBF@CD: can't understand why, but this makes a double trigger with UpdateRace that interferes with other stuff...
                   let name = getName();
                   blockOffset = locTextStart;
                   block = fullText.slice( blockOffset ).trim();   // Everything but name. JBF : I have put the name back to deal sith the Spirit Rating... To be discussed
                   parseCreature( name );
                 } break;  // end Creature

                 case "T":
                 case "SK":
                 case "NAC": {
                   // This should handle any Talent, Skill, Knack, Devotion, or spell found in Earthdawn players, Earthdawn Companion,
                   // Earthdawn Questors, Earthdawn Mystic Paths, and 1879.

                   removePageNumbers();
                   let name = getName();
                   blockOffset = locTextStart;
                   block = fullText.slice( blockOffset ).trim();
                   blockIndex( "Talent" );
                   blockIndex( "Requirements" );
                   blockIndex( "Restrictions" );
                   blockIndex( "Step Number" );      // 1st Ed.
                   blockIndex( "Step" );
                   blockIndex( "Default" );
                   blockIndex( "Action" );
                   blockIndex( "Requires Karma" );     // 1st Ed.
                   blockIndex( "Karma" );
                   blockIndex( "Strain" );
                   blockIndex( "Skill Use" );
                   blockIndex( "Devotion Required");
                   blockIndex( "Cost" );
                   blockIndex( "Discipline Talent Use" );      // 1st Ed
                   blockIndex( "Tier" );
                   blockIndexArray = _.sortBy( blockIndexArray, "index" );
                   if( blockIndexArray.length < 1) {
                     log( "Earthdawn textImport : Warning, TextImport was not able to parse that at all");
                     return;
                   }
                   let end = block.indexOf( "\n", blockIndexArray[ blockIndexArray.length -1 ][ "index" ] + 2 - blockOffset );   // First newline after last stat block entry
                   blockIndexArray.push( {name: "eof", index: end + blockOffset});
                   block = block.slice( 0, end ).trim();   // block now just consists of our identified statblock.
                   let afterBlock = block.replace( /\n/g, "   " );

                   for( let i = blockIndexArray.length -2; i > -1; --i) {
                     let tf = blockIndexArray[ i ][ "name"];
                     switch( tf.toLowerCase() ) {
                       case "action":            // It just gets the first word, so Sustained (10 minutes) is OK.      Action: Sustained
                       let x= statBlock( i, tf, null, "Word" );
                       log(JSON.stringify(x));
                         if(x["field"].toLowerCase().includes("standard")) data["roll20_Action"]="Standard";
                         else if(x["field"].toLowerCase().includes("sustained")) data["roll20_Action"]="Sustained";
                         else if(x["field"].toLowerCase().includes("free")) data["roll20_Action"]="Free";
                         else if(x["field"].toLowerCase().includes("simple")) data["roll20_Action"]="Simple";
                         else if(x["field"].toLowerCase().replace(/[\s\/]/,"")=="na") data["roll20_Action"]="NA"; //NA or N/A
                           else data["roll20_Action"]="Standard";

                       break;
                       case "cost":    // Earthdawn Skills       Cost: Novice
                       if( code == "SK" ) {
                         let x = statBlock( i, tf, null, "Word" );
                         data["roll20_Type"]= (edition!=="-1" ? "" : "F1-") + x[ "val" ];
                       } else
                       followup += "Warning, this appears to be a Skill, not a Talent.   ";
                       break;
                       case "default":   // 1879     This is 1879 field saying if a skill is default-able. Just add it to afterBlock.
                       break;
                       case "devotion required": {     // Questor Devotions      Devotions Required: Yes, No Karma, Default type to QD-Follower
                         let x = statBlock( i, tf, null, "Word" ), b;
                         if( x && "val" in x ) {
                           b = ( x[ "val" ].trim().slice(0, 1).toUpperCase() === "Y" );
                           data["roll20_DP-Limit"]= (b ? "1" : "0");
                           data["roll20_Karma_Limit_max"]="0";
                           data["roll20_DP_Limit_max"]="1"
                           data["roll20_Type"]="QD-Follower";
                         }
                       } break;
                       case "discipline talent use":   // 1st Ed     This is a 1st Ed field saying the Talent is a Discipline Talent for certain Disciplines. Just add it to afterBlock.
                       break;
                       case "requires karma":    // 1st Ed.
                       case "karma": {           // 1879
                         let x = statBlock( i, tf, null, "Word" );
                         let y = x[ "val" ].toUpperCase();
                         if( y.indexOf( "Y" ) > -1 || y.indexOf( "Q" ) > -1) {   // Yes or Required
                           data[ "roll20_Karma_Limit"]="1";
                           // This needs update. CDD ToDo
                         }
                       } break;
                       case "requirements": {    // Knacks.              Requirements: Rank 3
                         let x = statBlock( i, tf ), rnk = 0;
                         let res = x[ "field" ].match( /\d+/ );
                         if( res !== null ) {
                           rnk = parseInt( res[ 0 ] );
                           data["roll20_Requirements"] =rnk;
                         }
                         //     JBF@JBF@CD        // If this is a PC, post an accounting entry for them.

                       } break;
                       case "restrictions":    // Knacks. Just paste it in.
                       statBlock( i, tf, "roll20_Restrictions" );
                       break;
                       case "step number":
                       case "step": {
                         let x = statBlock( i, tf ), set = false;
                         let y = x[ "field" ].toUpperCase();
                         for( let i = 0; i < 6; ++i ) {
                           let z = [ "Dex", "Str", "Tou", "Per", "Wil", "Cha"][i];
                           if ( y.indexOf( z.toUpperCase()) !== -1) {
                             data["roll20_Attribute"]= z;
                             set = true;
                             break;
                           } }
                           if( !set )
                           data["roll20_Mod-Type"]= "NoRoll";     // If don't have an Attribute, then set Mod-Type to No Roll.
                         } break;
                         case "skill use": {       // Earthdawn Talents
                           let x = statBlock( i, tf );
                           if( code == "SK" )
                           if( x[ "field" ].toLowerCase().indexOf( "yes" ) !== -1) {
                             let res = x[ "field" ].match( /\(\w+\)/ );
                             if( res !== null )
                             data["roll20_Type"]= res[0].slice(1,-1);
                             else    // 1st Ed does not have the (Novice) part.
                             data["roll20_Type"]= "Novice";
                           } else
                           followup += "Warning, This is not normally a skill.";
                         } break;
                         case "strain":
                         statBlock( i, tf, "roll20_Strain", "Num" );
                         break;
                         case "talent": {      // Knacks.
                           let x = statBlock( i, tf, "roll20_BaseTalent" );
                           if(x) data["roll20_linkadd"]=x.field; //to be checked when we do the actual Autofill for Knacks
                         } break;
                         case "tier": {        // 1879
                           let x = statBlock( i, tf, null, "Word" );
                           data["roll20_Type"] (( code == "SK" ) ? "F1-" : "TO1-") + x[ "val" ];
                         } break;
                         default:
                         log( "ED.textImport.Talent: Somehow got value of: " + tf, po );
                       } // end switch tofind
                     } // end for blockindex array

                     if( followup.length > 0 )
                     log( "Earthdawn textImport" + followup.trim());
                     data["Description"]= textBlock( fullText.slice( end + blockOffset ).trim()) + "\n" + afterBlock.trim();
                     data["Name"]= name;    // Set name last, so autofill does not trigger while this is still running.
                   } break;    // end Talents, Knacks, and Skills.

                   case "SP": {    // Spell
                     // CDD Note: when 1879 spell tab is finalized, don't forget to come back here and adjust.
                     // let code = ssa[ 1 ],
                     //   rowID = ssa[ 2],
                     //   pre = Earthdawn.buildPre( code, rowID );
                     // Earthdawn.findOrMakeObj({ _type: 'attribute', _characterid: po.charID, name: pre + "RowID" }, rowID);
                     removePageNumbers();
                     let name = getName();
                     blockOffset = locTextStart;
                     block = fullText.slice( blockOffset ).trim();   // everything but name.
                     blockIndex( "Threads" );
                     blockIndex( "Tier" );
                     blockIndex( "Weaving Difficulty" );
                     blockIndex( "Weaving" );
                     blockIndex( "Casting Difficulty" );
                     blockIndex( "Casting Time" );
                     blockIndex( "Casting" );          // Should be OK, since the others don't have colon directly after Casting.
                     blockIndex( "Range" );
                     blockIndex( "Duration" );
                     blockIndex( "AoE" );
                     blockIndex( "Area of Effect" );
                     blockIndex( "Effect", true );     // Effect must start the line (so does not get confused with Area of Effect.
                       blockIndex( "Strain" );
                       blockIndex( "Success Level" );      // Sometimes it is Level, sometimes Levels. Accept both.
                       blockIndex( "Success Levels" );
                       blockIndex( "Extra Threads" );
                       blockIndexArray = _.sortBy( blockIndexArray, "index" );
                       if( blockIndexArray.length < 1) {
                         log( "Earthdawn textImport : Warning, TextImport was not able to parse that at all");
                         return;
                       }
                       let end = block.length,
                       effect, succ, extra, txt, afterBlock;
                       blockIndexArray.push( {name: "eof", index: end + blockOffset });
                       //log(block ); log( blockIndexArray);

                       for( let i = blockIndexArray.length -2; i > -1; --i) {
                         let tf = blockIndexArray[ i ][ "name"];
                         //log( tf);
                         switch( tf.toLowerCase() ) {
                           case "area of effect":        // Both
                           case "aoe":
                           statBlock( i, tf,"roll20_AoE" );
                           break;
                           case "casting difficulty":    // 1879
                           case "casting": {       // Earthdawn
                             let cd,
                             x = statBlock( i, tf ),
                             y = getInt( x,  "field" );
                             if( x[ "field" ].indexOf( "TMD" ) !== -1 || x[ "field" ].indexOf( "Target" ) !== -1 )
                             cd = "MD1: @{target|Target|token_id}";
                             else if (!isNaN( y ))
                             cd = y;
                             else
                             cd = "Ask: ?{Target Number&amp;#124;0&amp;#125;";
                             data["roll20_Casting"]= cd;
                           } break;
                           case "casting time":      // 1879
                           statBlock( i, tf, "roll20_Casting_Time" );
                           break;
                           case "duration": {        // Both
                             let x = statBlock( i, tf );
                             data["roll20_Duration"]= x[ "field" ].replace(/Rank/ig, "Rk").replace( /Rou\w*/ig, "Rnd").replace( /Min\w*/ig, "Min");
                           } break;
                           case "effect": {        // Both
                             let x = statBlock( i, tf );
                             effect = x[ "field" ];
                             if( !txt ) {    // for 1879 txt will have been set when processing strain. The below does it for Earthdawn.
                               let j = effect.indexOf( "\n" );     // Note, there is at LEAST one spell entry that has a multi-line effect. To bad, cut it off.
                               if( j !== -1 ) {
                                 txt = effect.slice( j ).trim();       // everything after the first newline.
                                 effect = effect.slice( 0, j).trim();    // everything before the newline.
                               }       // Unlike Strain, afterBlock includes everything previous to Effect.
                               afterBlock = (fullText.slice( blockIndexArray[ 0 ]["index"], blockIndexArray[ i ]["index"] ).trim() ).replace( /\n/g, "   " );
                             }
                             let res = effect.match( /(WIL|Rank|Circle|\s|\+|\-|\d|\/|Physical|Mystic|NA|No|Armor|Nat\w*)+/i );
                             if( res && res[ 0 ].trim().length > 3) {
                               let fnd = res[ 0 ].replace( "\/", "").toLowerCase(),
                               ae = "N/A";   // default is armor effect is not applicable.
                               data["roll20_Effect"]= effect.replace( res[ 0 ], "" ).replace( /^\s*and\s*/i, "" );

                               let res2 = fnd.match( /[\+\-]*\s*\d+/ );
                               if( res2 ) {
                                 data["roll20_WilEffect"] =  parseInt( res2[0].replace( /\s+/g, "" ));     // Need to get rid of whitespace here to get rid of nbsp characters in pdf.
                                 ae = "NoDmg";   // Since we have a wil effect, New default is that armor effect is No Damage from wil effect,
                               }
                               res2 = fnd.match( /(Wil|Rank|Circle)+/i );
                               if( res2 ) {
                                 data["roll20_WilSelect"] =  res2[ 0 ].slice( 0, 1).toUpperCase() + res2[ 0 ].slice( 1 ).toLowerCase();
                               }
                               let aepost = "";
                               if( fnd.indexOf( "nat" ) != -1 ) {
                                 aepost = "-Nat";
                                 fnd = fnd.replace( /nat\w*/, "" );    // get rid of natural, because are going to be searching for NA in a second.
                               }
                               if( fnd.indexOf( "phy" ) != -1 )
                               ae = "PA" + aepost;
                               else if( fnd.indexOf( "mys" ) != -1 )
                               ae = "MA" + aepost;
                               else if( fnd.indexOf( "na" ) != -1 || fnd.indexOf( "no" ) != -1)
                               ae = "NoArmor";
                               data["roll20_EffectArmor"] =  ae;
                             } else
                             data["roll20_Effect"]= effect;
                           } break;
                           case "range":           // Both
                           statBlock( i, tf, "roll20_Range" );
                           break;
                           case "strain": {        // 1879
                             let x = statBlock( i, tf );
                             let y = x[ "field" ];
                             if( !txt ) {
                               let j = y.indexOf( "\n" );
                               if( j !== -1 ) {
                                 txt = y.slice( j ).trim();
                                 y = y.slice( 0, j).trim();
                               }         // The i -1 means that afterBlock does not include Effect. But does include Strain.
                               afterBlock = (fullText.slice( blockIndexArray[ 0 ]["index"], blockIndexArray[ i -1 ]["index"] ).trim() + "   " + tf + ":" + y ).replace( /\n/g, "   " );
                             }
                             data["roll20_Strain"] =  y;
                             // Note: ToDo right once sheet tab is done.
                           } break;
                           case "threads":         // Earthdawn
                           statBlock( i, tf, "roll20_sThreads", "Num" );
                           break;
                           case "tier":          // 1879
                           // Note: ToDo right once sheet tab is done.
                           statBlock( i, tf, "roll20_Circle", "Word" );
                           break;
                           case "weaving difficulty":
                           case "weaving": {       // Earthdawn
                             let x = statBlock( i, tf, null, "Num" );
                             let y = getInt( x, "val"  ) - 4;
                             data["roll20_Circle"] =  y;
                             data["roll20_Numbers"] =  (y+4).toString() + "/" + (y+9) + "/" + (y+10) + "/" + (y+15);
                           } break;
                           case "success level":   // sometimes it is level, sometimes levels
                           case "success levels": {      // Earthdawn
                             let x = statBlock( i, tf );
                             succ = x[ "field" ].replace( /\n/g, " ");
                             data[ "roll20_SuccessLevels"]= parseThreads( 0, succ );
                           } break;
                           case "extra threads": {       // Earthdawn
                             let x = statBlock( i, tf );
                             extra = x[ "field" ].replace( /\n/g, " ");
                             data["roll20_ExtraThreads"] =  parseThreads( 1, extra );
                           } break;
                           default:
                           log( "ED.textImport.Spell: Somehow got value of: " + tf );
                         } // end switch tofind
                       } // End for each token found.

                       // what 0 is Extra Successes. One item that must be made to conform to the dropdown list.
                       // what 1 is extra threads. A comma delimited list of items.
                       function parseThreads( what, input ) {
                         'use strict';
                         let ret = ",",
                         arr = input.split( "," );
                         for( let i = 0; i < arr.length; ++i ) {
                           let t = arr[ i ].toLowerCase();
                           let paran = arr[ i ].match( /\(.+?\)/ );    // If we got a value in parentheses, grab that.
                           if( t.indexOf( "add" ) !== -1 && t.indexOf( "tar" ) !== -1 )      // Additional Target (+1) or (+Rank)
                           ret += what ? "Add Tgt" + (paran ? " " + paran[ 0 ] + "," : ",") : "Add Tgt (+1),";
                           else if( t.indexOf( "rem" ) !== -1 && t.indexOf( "tar" ) !== -1 )   // Remove Targets (-Rank)
                           ret += "Add Tgt" + (paran ? " " + paran[ 0 ] + "," : ",");
                           else if( t.indexOf( "inc" ) !== -1 ) {                  // Increase (something else)
                             if( t.indexOf( "area" ) !== -1 || t.indexOf( "aeo" ) !== -1 )   // Increase Area or AoE (+2 yards)
                             ret += what ? "Inc Area" + (paran ? " " + paran[ 0 ] + "," : ",") : ( t.indexOf( "2" ) !== -1 ? "Inc Area (+2)," : "Inc Area (Other),") ;
                             else if( t.indexOf( "dur" ) !== -1 )                //  Increase Duration (+2 minutes)
                             ret += what ? "Inc Dur" + (paran ? " " + paran[ 0 ] + "," : ",") : ( t.indexOf( "2" ) !== -1 ? "Inc Dur (+2)," : "Inc Dur (Other),") ;
                             else if( t.indexOf( "eff" ) !== -1 )                // Increase Effect (+2 Effect Step)
                             ret += what ? "Inc Efct" + (paran ? " " + paran[ 0 ] + "," : ",") : ( t.indexOf( "2" ) !== -1 ? "Inc Efct Step (+2)," : "Inc Efct (Other),") ;
                             else if( t.indexOf( "ran" ) !== -1 || t.indexOf( "rng" ) !== -1 ) // Increase Range (+10 yards),
                             ret += what ? "Inc Rng" + (paran ? " " + paran[ 0 ] + "," : ",") : "Inc Rng (+20),";
                             else
                             ret += what ? "Special (" + arr[ i ].trim() + ")," : "Special,";
                           } else
                           ret += what ? "Special (" + arr[ i ].trim() + ")," : "Special,";
                         }
                         return ret.slice( 1, -1);
                       } // end ParseThreads

                       data["Description"]= (succ ? "Success Levels: " + succ  + "\n" : "")
                       + (extra ? "Extra Threads: "  + extra + "\n" : "")
                       + (effect ? "Effect: "  + effect + "\n" : "")
                       + (txt ? textBlock( txt ) + "\n" : "")
                       + afterBlock.trim();
                       data["Name"] = name;
                       if( followup.length > 0 )
                       log( followup.trim());
                     } break;      // End Spell import


                     default:
                     log( "ED.textImport() Unknown code" + code);
                   } // end Switch



                   if(["T","SK","NAC","SP"].includes(code)) AutoFill(eventInfo.sourceAttribute,"API",data.Name,data)

                   if(code=="creature") FillDataCreature(data);
                   if(code=="mask") FillDataMask(data,1);


                   if(code=="mask"){ //Save the mask in the repeatng_masks
                     let pre=buildShortPre(eventInfo,"MSK");
                     vals[pre+"Name"]=data.Name;
                     vals[pre+"Details"]=JSON.stringify(data);
                   }

                     // textExport(data,code);

                   //log("textImport returning with data " + JSON.stringify(data));

                   setAttrsLog(vals);

                 });
               } catch(err) {log("Earthdawn:textImport() error caught: " + err );}
             }; //end textImport()
  on("change:textimportcreature change:repeating_masks:msk_textimport change:repeating_talents:t_textimport change:repeating_knacks:nac_textimport change:repeating_skills:sk_textimport change:repeating_spell:sp_textimport", fn(textImport));

var textExport = function(data,code){
let exp="";
let tags =
["Name","CreatureSize","SrRating","Dex_Step" , "Str_Step" , "Tou_Step" , "Per_Step" , "Wil_Step" , "Cha_Step" , "Initiative" , "PD" , "MD" , "SD" , "PA" , "MA" , "Damage_Unc_Rating" , "Damage_Death_Rating" , "Wound_Threshold", "Knockdown","Recovery_Tests_max"  , "Movement" ,"Movement2","Movement2_Rate","Movement3","Movement3_Rate","Description", "Karma_max", "KarmaStep", "loot" ,"Actions"],
atktags=["Name","Atk_Step","Dmg_Step","Atk_Info"],
mantags=["Name","Type","Info","Description"],
pwrtags=["Name","Rank","Step","Step_Info","ModType","ArmorType","Target","Description"],
sptags=["Name"];
//log("textExport " + code + " "+tags);

data["CreatureSize"]=Math.ceil((getInt(data,"Str_Step") +1)/ 10 );

for(let i=0;i<tags.length;i++)
 exp += "\'" +(data[tags[i]]||"")+"\t";


//if(data["Attacks"])
  for(let j=0;j<5;j++)
    for(let i=0;i<atktags.length;i++)
      exp += "\'" +(data["Attacks"] && data["Attacks"][j] ? (data["Attacks"][j][atktags[i]]||"") : "") +"\t";

//if(data["Powers"])
  for(let j=0;j<15;j++)
    for(let i=0;i<pwrtags.length;i++)
      exp += "\'" +(data["Powers"] && data["Powers"][j] ? (data["Powers"][j][pwrtags[i]]||"") :"") +"\t";

//if(data["Maneuvers"])
  for(let j=0;j<8;j++)
    for(let i=0;i<mantags.length;i++)
      exp += "\'" + (data["Maneuvers"] && data["Maneuvers"][j] ? (data["Maneuvers"][j][mantags[i]]||""): "") +"\t";

exp += "\'" +(data["numSuggPowers"]||"") +"\t";
//if(data["SuggPowers"])
  for(let j=0;j<18;j++)
    for(let i=0;i<pwrtags.length;i++)
      exp += "\'" +(data["SuggPowers"] && data["SuggPowers"][j] ? (data["SuggPowers"][j][pwrtags[i]]||"") :"") +"\t";

  //if(data["SuggPowers"])
    for(let j=0;j<22;j++)
      for(let i=0;i<sptags.length;i++)
        exp += "\'" +(data["Spells"] && data["Spells"][j] ? (data["Spells"][j][sptags[i]]||"") :"") +"\t";



exp=exp.replace(/\n/g," ");

//log("textExport " + exp);

setAttrsLog({"textExport" : exp});
}


// Gives the appropriate Query for a certain search to the compendium
// Returns a JSON

var BuildCompendiumQuery = function fnBuildCompendiumQuery(nm,code) {
  'use strict';
  try{
    let q=""
    switch(code){
      case "T" : //For Talents/Powers, the place we look in the database depends on the Race
        // if(!values["Race"] || values["Race"]=="Creature"){ cat=""; catarray=["Creature Powers","Skills","Talents"];} //This is the list of Category we will look at in order
        // else if(values["Race"]=="Spirit"){ cat=""; catarray=["Spirit Powers","Talents","Skills"];}
        // else if(values["Race"]=="Dragon"){ cat=""; catarray=["Dragon Powers","Talents","Skills","Creature Powers"];}
        // else if(values["Race"]=="Horror"){ cat=""; catarray=["Horror Powers","Talents","Skills","Creature Powers"];}
        // else
        q="Category:\"Talents\"|\"Skills\"|\"Horror Powers\"|\"Creature Powers\"|\"Dragon Powers\"|\"Spirit Powers\"|\"Devotions\" Name:" + nm; break;
      case "SK":  q="Category:\"Skills\" Name:" + nm; break;
      case "SP":  q="Category:\"Spells - Illusionist\"|\"Spells - Nethermancer\"|\"Spells - Elementalist\"|\"Spells - Wizard\"|\"Spells - Shaman\" Name:"+nm; break; //Spells are in various categories, we can't filter the category
      case "ARM": q="Category:\"Goods and Services\" Type:\"Armor\"|\"Shield\" Name:" + nm; break;
      case "WPN": q="Category:\"Goods and Services\" Type:\"Weapon\" Name:" + nm; break;
      case "INV": q="Category:\"Goods and Services\" Name:" + nm; break;
      case "BL":  q="Category:\"Goods and Services\" Type:\"Blood Charm\" Name:" + nm; break;
      case "MNT": q="Category:\"Mounts\" Name:" + nm; break;
      case "NAC": q="Category:\"Knacks\" Name:" + nm; break;
      case "DSP":  q="Category:\"Disciplines\"|\"Questors\"|\"Paths\" Name:"+nm; break; //Disciplines come from various categories
      case "SPM": q="Category:\"Magic\" Name:" + nm; break;
      case "SKL":
      case "MAN":
      case "TI":
      default : q="";
    }

return q.replace("\'","%E2%80%99");

} catch(err) {log("Earthdawn:BuildCompendiumQuery() error caught: " + err );}
}; //end CompendiumQuery()


// Replaces getCompendiumQuery
// If a comp_data has been passed, there has already been a call for this query, so we need to find it in the data
//If no comp_data has been passed, this is a new query, just cb GetCompendiumQuery

var getCompendiumQuery2 = function fngetCompendiumQuery2(q,comp_data,cb) {
  'use strict';
  try{
    if(!comp_data) getCompendiumQuery(q,cb);
    else{
      //log("gcq2  " + q + " data "+ JSON.stringify(comp_data));
      let results=[];
      let fnd=q.match(/Name\:\s*(.*)\s*/i);
      if(fnd && fnd[1])
        results=comp_data.filter(elements => elements.name==fnd[1]);
      cb(results);
    }
} catch(err) {log("Earthdawn:getCompendiumQuery2() error caught: " + err );}
}; //end GetCompendiumQuery2()



on("clicked:import_talents clicked:import_knacks clicked:import_skills clicked:import_spells", fn(function ocImportAll(eventInfo) {
  'use strict';
  try{
    let comp_query_array=[];
    let attarray=[];
    let rep,code,nac=false;
    switch(eventInfo.triggerName){
      case "clicked:import_talents" : rep="repeating_talents"; code="T"; break;
      case "clicked:import_skills" : rep="repeating_skills"; code="SK"; break;
      case "clicked:import_spells" : rep="repeating_spell"; code="SP"; break;
      case "clicked:import_knacks" : rep="repeating_knacks"; code="NAC"; nac=true; break;
      default : log("Earthdawn:ocImportAll() unknown eventInfo: " + JSON.stringify(eventInfo) ); return;
    }

    getSectionIDs(rep, function gsIdRepeatingTalents(tarray) {
      for( let i = 0; i < tarray.length; i++) {
        attarray.push( buildPre( code, tarray[ i ] ) + "Name");
        attarray.push( buildPre( code, tarray[ i ] ) + "BaseTalent");

      }
      getAttrs( attarray , function gaTalentSummary(values) {
        'use strict';

          for( let i = 0; i < tarray.length; i++) {
            let nm= nac ? values[buildPre( code, tarray[ i ] ) + "BaseTalent"] +", "+values[buildPre( code, tarray[ i ] ) + "Name"]
            : values[buildPre( code, tarray[ i ] ) + "Name"];
            let compq= BuildCompendiumQuery(nm,code);
            if(compq!=="") comp_query_array.push(compq);
          }

    //log("compqueryarray " + JSON.stringify(comp_query_array));

     getCompendiumQuery(comp_query_array, function(comp_data) {
       //log("received the query" + JSON.stringify(comp_data))
       for( let i = 0; i < tarray.length; i++) {
         let nm= nac ? values[buildPre( code, tarray[ i ] ) + "BaseTalent"] +", "+values[buildPre( code, tarray[ i ] ) + "Name"]
         : values[buildPre( code, tarray[ i ] ) + "Name"];
         AutoFill(buildPre( code, tarray[ i ] )+"Name","Import",nm,null,comp_data);
       }

});
});
  });
} catch(err) {log("Earthdawn:ocImportAll() error caught: " + err );}
}));//end ocImportAll


on("clicked:tab clicked:tab-spells clicked:tab-grim clicked:tab-adjust clicked:tab-talent-filter", fn(function octabMgmt(eventInfo) {
  'use strict';
  try{
    //log("eventInfo "+JSON.stringify(eventInfo));
    let vals={},
    trigger=eventInfo.triggerName.replace("clicked:",""),
    tv=eventInfo.htmlAttributes.value;
    //log("trigger "+trigger + " tv "+tv);
    vals[trigger]=tv
    setAttrsLog(vals);

} catch(err) {log("Earthdawn:ocTabMgmt() error caught: " + err );}
}));//end ocTabMgmt




  // // //v3 textImport transferred from API to Sheetworker
  // // //This Routine actually processes the data
  // The routine will work by successive loops that will update:
  //Loop 1 : Race and Discipline
  //Loop 2 : Attributes
  //Loop 3 : Characteristics, Powers, Talents ...etc

  var FillDataCreature = function fnFillDataCreature(data) {
    'use strict';
    try{
      let vals={},attarray=[],newId;
      //log("FillData  data " + JSON.stringify(data));
      getSectionIDs("repeating_discipline", function gsIdRepeatingTalents(darray) {
        for( let i = 0; i < darray.length; i++) {
          attarray.push( buildPre( "DSP", darray[ i ] ) + "Name");
        }
      getAttrs(attarray, function gaFillDataCreature(values) {
        //Name
        if(data.Name) vals["charName"] = data.Name;
        if(data.CreatureSize) vals["CreatureSize"] = data.CreatureSize;

        //Update Race and SrRating
        if(data.SrRating) vals["SrRating"] = data.SrRating;
        setAttrsLog(vals,null,function(){
          vals={};
          updateRace(data.Race||"Creature",null,function(){
          //We need to deal with the Disciplines, and once done move to Attributes via callback
           if(data.Discipline){
             let dsparr=parseJSON(data.Discipline);
             //log("dsparr "+ JSON.stringify(dsparr));

             //Search for a blank dsp line or a line that already matches the discipline
             for( let i = 0; i < darray.length; i++)
               if( !values[buildPre( "DSP", darray[ i ] ) + "Name"] || values[buildPre( "DSP", darray[ i ] ) + "Name"].length<2 || values[buildPre( "DSP", darray[ i ] ) + "Name"]==dsparr[0].Name)
                newId=darray[ i ];
             if(!newId)  newId = generateRowIdNoUnderscore();

             let newInfo = buildPre( "DSP", newId );
             vals[newInfo+"RowID"]=newId;
             vals[newInfo+"Name"]=dsparr[0].Name;
             vals[newInfo+"Circle"]=dsparr[0].Circle;
             vals[newInfo+"Circle_max"]=dsparr[0].Circle;




             setAttrsLog(vals,{"silent" : true},function(){
               vals={};
               repDiscipline(newId,null,null,function(){
                updateDurability(null,function(){
                  updateHealth(null,function(){
                    FillDataCreature2(data);
                  });
                });
              });
             });
            } else FillDataCreature2(data);
          });
        });
      });
      });
    } catch(err) {log("Earthdawn:FillDataCreature() error caught: " + err );}
  }; //end FillDataCreature()


  // // //v3 textImport transferred from API to Sheetworker
  // The routine will work by successive loops that will update:
  //Loop 1 : Race and Discipline
  //Loop 2 : Attributes
  //Loop 3 : Characteristics, Powers, Talents ...etc

  var FillDataCreature2 = function fnFillDataCreature2(data) {
    'use strict';
    try{
      let vals={};
      let attarray=["SrRating", "working-Circle", "Creature-Durability",
      //"Dex-Step", "Str-Step", "Tou-Step", "Per-Step","Wil-Step", "Cha-Step",
      //"Attrib-Dex-Curr", "Attrib-Str-Curr", "Attrib-Tou-Curr", "Attrib-Per-Curr","Attrib-Wil-Curr", "Attrib-Cha-Curr",
      ,"PD-Nat","MD-Nat","SD-Nat","PA-Nat","MA-Nat","Initiative","Knockdown",
      "Attrib-Dex-Race", "Attrib-Str-Race", "Attrib-Tou-Race", "Attrib-Per-Race","Attrib-Wil-Race", "Attrib-Cha-Race",
      //"Dex-Adjust", "Str-Adjust", "Tou-Adjust", "Per-Adjust", "Wil-Adjust", "Cha-Adjust",
      "Damage-Death-Rating" , "Damage-Unc-Rating" ,  "Recovery-Tests_max" , "Wound-Threshold" ,"Recovery-Step"
      //"Knockdown-Adjust","Initiative-Adjust","Misc-Movement-Adjust","Movement-Race","Fly-Movement-Race","Fly_max",
      //"Defense-Phys-Nat-Adjust","Defense-Myst-Nat-Adjust","Defense-Soc-Nat-Adjust","Armor-Phys-Nat-Adjust","Armor-Myst-Nat-Adjust",
      //"Creature-Fury","Creature-ResistPain","Creature-Willful","Creature-Ambushing_max","Creature-DivingCharging_max"
    ];


      getAttrs(attarray, function gaFillDataCreature(values) {
        //log("FillDataCreature Loop 2 start" + JSON.stringify(values))
        //Name

        function AdjustAtt(att){
        if(data["Attrib_" + att + "_Curr"]){ //For Namegivers we usually have the Value and the step, sometimes we have an increase
          //log("FillDataCreature, calculating " + att + " Race " + getInt(values,"Attrib-" + att + "-Race") + " Curr (data) " + getInt(data,"Attrib_" + att + "_Curr") + " Increases (data) " + getInt(data,"Attrib_" + att + "_Increases"));
            if(data["Attrib_" + att + "_Increases"]) vals["Attrib-" + att + "-Increases"]= getInt(data,"Attrib_" + att + "_Increases");
            vals["Attrib-" + att + "-Orig"]= getInt(data,"Attrib_" + att + "_Curr") - getInt(values,"Attrib-" + att + "-Race") - getInt(data,"Attrib_" + att + "_Increases"); //backfill Orig
            vals["Attrib-" + att + "-Curr"]= getInt(data,"Attrib_" + att + "_Curr"); //FIll the current
            let step= Math.floor(( getInt( data, "Attrib_" + att + "_Curr") - 1) / 3 ) + 2;
            vals[att+"-Step"]=getInt(data,att+"_Step");
            let stepadj=getInt(data,att+"_Step") - step;
            if(stepadj!==0) vals[att+"-Adjust"] = stepadj;
          } else if(data[att+"_Step"]){ //For creatures we have only the Step
            vals[att + "-Step"] = getInt( data, att+"_Step");
            vals["Attrib-" + att + "-Curr"] = ((getInt( data, att+"_Step") -2) * 3) + 1;
            vals["Attrib-" + att + "-Orig"] = ((getInt( data, att+"_Step") -2) * 3) + 1 - getInt(values,"Attrib-" + att + "-Race") ;
          }
        } //end AdjustAtt

        let attarr=["Dex","Str","Tou","Per","Wil","Cha"];

        for(let i=0;i<6;i++) AdjustAtt(attarr[i]);


        // Useful as Initialization for the bars
        // vals["Damage"]="0";
        // vals["Damage_max"]="25"
        vals["Wounds"]="0";
        vals["Wounds_max"]="8";
        // vals["Karma"]="10";
        // vals["Karma_max"]="10";


        //log("FillCreature2 result" + JSON.stringify(vals));
        setAttrsLog(vals,{"silent" : true},function(){
          updateInitiative(null,function(){
            updateKnockdown(null,function(){
              updateKarma(null,function(){
                updateDefensebase( "Dex", "PD",function(){
                  updateDefensebase( "Per", "MD",function(){
                    updateDefensebase( "Cha", "SD",function(){
                      updateMaBase(null,function(){
                        updateDefenseNatural( "PA",function(){
                          updateDurability(null,function(){
                            updateHealth(null,function(){
                              updateRecovery(null,function (){
                              FillDataCreature3(data);
                            });
                            });
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    } catch(err) {log("Earthdawn:FillDataCreature2() error caught: " + err );}
  }; //end FillDataCreature2()


  // // //v3 textImport transferred from API to Sheetworker
  // The routine will work by successive loops that will update:
  //Loop 1 : Race and Discipline
  //Loop 2 : Attributes
  //Loop 3 : Characteristics, Powers, Talents ...etc

  var FillDataCreature3 = function fnFillDataCreature3(data) {
    'use strict';
    try{
      let vals={};
      let attarray=["SrRating", "working-Circle", "Creature-Durability",
      ,"PD-Nat","MD-Nat","SD-Nat","PA-Nat","MA-Nat","Initiative","Knockdown",
      "Damage-Death-Rating" , "Damage-Unc-Rating" ,  "Recovery-Tests_max" , "Wound-Threshold" ,
      "Knockdown-Adjust","Initiative-Adjust","Misc-Movement-Adjust","Movement-Race","Fly-Movement-Race","Fly_max","Karma_max","KarmaStep","Misc-Karma-max-Adjust",
      "Damage-Death-Rating" , "Damage-Death-Rating-Adjust" , "Damage-Unc-Rating" , "Damage-Unconscious-Adjust", "Recovery-Tests_max" , "Recovery-Tests-Misc-Adjust", "Wound-Threshold" , "Wound-Threshold-Adjust" , "Recovery-Step" , "Recovery-Adjust",
      "Defense-Phys-Nat-Adjust","Defense-Myst-Nat-Adjust","Defense-Soc-Nat-Adjust","Armor-Phys-Nat-Adjust","Armor-Myst-Nat-Adjust",
      //"Creature-Fury","Creature-ResistPain","Creature-Willful","Creature-Ambushing_max","Creature-DivingCharging_max"
    ];


      getAttrs(attarray, function gaFillDataCreature3(values) {
        //log("FillDataCreature Loop 3 start values " + JSON.stringify(values))

        let mult=0;

        function AdjustChar(attdata,att,attadj,adj2){
          if(data[attdata] && ["immune","na","-"].includes(data[attdata].trim().toLowerCase())) //Dealing with immunities
          vals[ attadj ? attadj : att] = "999";
          else if(data[attdata]){
            let adj=getInt(data,attdata) - getInt(values,att)-(adj2||0);
            if(adj!==0){
               if(attadj) vals[attadj] = adj + getInt(values,attadj); //Adjust via adjustment
               else vals[att]=getInt(data,attdata)-(adj2||0); //Adjustment directly in the target value
            }
            //log("AdjustChar " + att + " value to reach " + getInt(data,attdata) + " value before " + getInt(values,att) + " adj2 is " +adj2 + " adj is " + adj);
            if(data[attdata].match(rgSR)) vals[att + "-addSR"]="1";
          }
        } //end AdjustChar
        let ip=0,ma=0,pa=0,pd=0,md=0;

        if(data["Armor_Name"]){
          let newId=generateRowIdNoUnderscore();
          let pre=buildPre("ARM",newId);
          vals[pre+"RowID"]=newId;
          vals[pre+"Name"]=data["Armor_Name"];
          vals[pre+"Type"]=1;
          vals[pre+"Phys"]=getInt(data,"Armor_Phys");
          pa+=getInt(data,"Armor_Phys");
          vals[pre+"Myst"]=getInt(data,"Armor_Myst");
          ma+=getInt(data,"Armor_Myst");
          vals[pre+"IP"]=getInt(data,"Armor_IP");
          ip-=getInt(data,"Armor_IP");
        }
        if(data["Shield_Name"]){
          let newId=generateRowIdNoUnderscore();
          let pre=buildPre("ARM",newId);
          vals[pre+"RowID"]=newId;
          vals[pre+"Name"]=data["Shield_Name"];
          vals[pre+"Type"]=-1;
          vals[pre+"Phys"]=getInt(data,"Shield_Phys");
          pd+=getInt(data,"Shield_Phys");
          vals[pre+"Myst"]=getInt(data,"Shield_Myst");
          md+=getInt(data,"Shield_Myst");
          vals[pre+"IP"]=getInt(data,"Shield_IP");
          ip-=getInt(data,"Shield_IP");
        }



        //Characteristics
        AdjustChar("Initiative","Initiative","Initiative-Adjust",ip);
        AdjustChar("PD","PD-Nat","Defense-Phys-Nat-Adjust",pd);
        AdjustChar("PA","PA-Nat","Armor-Phys-Nat-Adjust",pa);
        AdjustChar("MD","MD-Nat","Defense-Myst-Nat-Adjust",md);
        AdjustChar("MA","MA-Nat","Armor-Myst-Nat-Adjust",ma);
        AdjustChar("SD","SD-Nat","Defense-Soc-Nat-Adjust");
        AdjustChar("Damage_Unc_Rating","Damage-Unc-Rating","Damage-Unconscious-Adjust");
        AdjustChar("Damage_Death_Rating","Damage-Death-Rating","Damage-Death-Rating-Adjust");
        AdjustChar("Recovery_Tests_max","Recovery-Tests_max","Recovery-Tests-Misc-Adjust");
        AdjustChar("Recovery_Tests_max","Recovery-Tests"); //In order to start with max recoveries
        AdjustChar("Recovery_Step","Recovery-Step","Recovery-Adjust");
        AdjustChar("Knockdown","Knockdown","Knockdown-Adjust");
        AdjustChar("Wound_Threshold","Wound-Threshold","Wound-Threshold-Adjust");
        AdjustChar("Karma_max","Karma_max","Misc-Karma-max-Adjust");
        AdjustChar("Karma_max","Karma"); //in order to start with max karma
        AdjustChar("KarmaStep","KarmaStep");
        AdjustChar("Actions","Actions");

        if(data["Karma_max"] || data["KarmaStep"]) vals["KarmaGlobalMode"]="?";

        if(data["Misc_AggStance_Strain"]) vals["Misc-AggStance-Strain"]=data["Misc_AggStance_Strain"];

        for(let i=0; i<3; i++){
          let nm=["Cha","Initiative","Recovery"][i];
          if(data[nm+"_Karma_Limit_Max"]) vals[nm+"-Karma-Limit_max"] = data[nm+"_Karma_Limit_Max"]; //Did the mistake of making a capped _Max... won't rake the data again
          if(data[nm+"_Karma_Limit_max"]) vals[nm+"-Karma-Limit_max"] = data[nm+"_Karma_Limit_max"];

        }

        AdjustChar("Movement","Movement-Race");
        //Alternative Movement Movement2
        for(let i=2;i<4;i++){
        if(data["Movement"+i]){ //
          if(data["Movement"+i].match(/fly/i)){ //The creature is flying,
              vals["Fly_max"]= "1";
              vals["Fly-Movement-Race"]=data["Movement" + i + "_Rate"] ? data["Movement" + i +"_Rate"] : data["Movement"];
          } else { //Non Flying movement will be added as a Power with Step as the rate
            let movdata={};
            movdata.Name=data["Movement"+i] + " (Movement)";
            movdata.Mod_Type="NoRoll";
            if(data["Movement" + i + "_Rate"]) movdata.Step = data["Movement" + i + "_Rate"];
            AbilityDrop(movdata.Name,"repeating_talents","T",null,movdata);
          }
        }
      }


        if(data["Attacks"]){
          let arr;
          if(typeof data["Attacks"] =="string") arr=parseJSON(data["Attacks"]);
          else arr=data["Attacks"];
            for(let j=0; j<arr.length ; j++){
              if(arr[j]["Name"]) {
                let nm=arr[j]["Name"].trim();
              let datacopy={},datacopy2={};
              datacopy["Name"]="Dmg-" + nm;
              datacopy["Step"]= arr[j]["Dmg_Step"];
              datacopy["roll20_CombatSlot"]="1";
              if(arr[j]["ArmorType"]=="PA|MA") { //Dual Nature Damage, create as a talent
                datacopy["Mod_Type"]="Damage CC";
                datacopy["roll20_ArmorType"]="PA";
                datacopy["roll20_CombatSlot"]="1";
                datacopy["roll20_Type"]="Power";
                datacopy["Name"]="Dmg-" + nm+"-Phys";
                AbilityDrop("Dmg-" + nm +"-Phys","repeating_talents","T",null,datacopy);
                let datacopy3=Object.assign({}, datacopy); //We need a copy
                datacopy3["roll20_ArmorType"]="MA";
                datacopy3["Name"]="Dmg-" + nm+"-Myst";
                AbilityDrop("Dmg-" + nm +"-Myst","repeating_talents","T",null,datacopy3);
              } else if(arr[j]["ArmorType"]=="MA") {
                datacopy["Mod_Type"]="Damage CC";
                datacopy["roll20_ArmorType"]="MA";
                datacopy["roll20_CombatSlot"]="1";
                datacopy["roll20_Type"]="Power";
                AbilityDrop("Dmg-" + nm,"repeating_talents","T",null,datacopy);
              } else AbilityDrop("Dmg-" + nm,"repeating_weapons","WPN",null,datacopy); //If no target is specified, we will do a Weapon


              datacopy2["Name"]="Atk-" + nm;
              datacopy2["Step"]= arr[j]["Atk_Step"];
              datacopy2["Mod_Type"]="Attack CC";
              datacopy2["roll20_Attribute"]="Dex";
              datacopy2["roll20_Target"]="PD1: @{target|Target|token_id}";
              datacopy2["roll20_CombatSlot"]="1";
              datacopy2["roll20_Type"]="Power";
              if(arr[j]["Target"]=="PD|MD") { //Dual Nature Damage, create as a talent
                datacopy2["Name"]="Atk-" + nm+"-Phys";
                AbilityDrop("Atk-" + nm +"-Phys","repeating_talents","T",null,datacopy2);
                let datacopy3=Object.assign({}, datacopy2); //We need a copy
                datacopy3["roll20_Target"]="MD1: @{target|Target|token_id}";
                datacopy3["Name"]="Atk-" + nm+"-Myst";
                AbilityDrop("Atk-" + nm +"-Myst","repeating_talents","T",null,datacopy3);
              } else if(arr[j]["Target"]=="MD") {
                datacopy2["roll20_Target"]="MD1: @{target|Target|token_id}";
                AbilityDrop("Atk-" + nm,"repeating_talents","T",null,datacopy2);
              } else AbilityDrop("Atk-" + nm,"repeating_talents","T",null,datacopy2);

            } else log("Earthdawn.FillEntryCreature Error : Trying to create Attack with undefined name :" +JSON.stringify(arr[j]));
           }
          }//end attacks

            //Talents
            AbilityArrayDrop (data["Talents"],"repeating_talents","T");
            //SKILLS
            AbilityArrayDrop (data["Skills"],"repeating_skills","SK");
            //SPELLS
            AbilityArrayDrop (data["Spells"],"repeating_spell","SP");
            if(data["Spells"])       vals["Hide-Spells-Tab"]="0";
            //Powers
            AbilityArrayDrop (data["Powers"],"repeating_talents","T",null,true,"Power"); //Default all Powers to CombatSlot=1
            //Maneuvers
            AbilityArrayDrop (data["Maneuvers"],"repeating_maneuvers","MAN");



            //LANGUAGES
            AbilityArrayDrop (data["Language"],"repeating_language","SKL");
            //Weapons
            AbilityArrayDrop (data["Weapons"],"repeating_weapons","WPN",null,true); //Default all Weapons to CombatSlot=1

            AbilityArrayDrop (data["TI"],"repeating_threads","TI");


            //Suggested powers : save them so that they can be added
            if(data["SuggPowers"]){
              let arr,lst="";
              arr=(typeof data["SuggPowers"] =="string") ? parseJSON(data["SuggPowers"]) : data["SuggPowers"];
              //log("dealing with SuggPower " + JSON.stringify(arr));
              for(let j=0; j<arr.length ; j++){
                if(j>0) lst+=", ";
                lst+=arr[j].Name;
                if(arr[j].Step) lst+= " (" + arr[j].Step +")";
              }
              vals["SuggPowers"]=lst;
              vals["SuggPowers_max"]=JSON.stringify(arr);
              //log("writing SuggPowers " +lst);
            }


            let note="";
            if(data.Equipment) note+="Equipment : " + data.Equipment + "\n";
            if(data.Abilities) note+="Abilities : " + data.Abilities + "\n";
            if(data.loot) note+="Loot: " + data.loot + "\n";
            if(data.Description) note+="\n" + data.Description + "\n";
            vals["general-notes"]=note;




        //log("FillCreature3 result" + JSON.stringify(vals));
        setAttrsLog(vals,{"silent" : true},function(){
          recalc();
        });
      });
    } catch(err) {log("Earthdawn:FillDataCreature3() error caught: " + err );}
  }; //end FillDataCreature3()


//Add all the powers on the suggested list
  on("clicked:addsuggpowers", fn(function ocAddSuggPowers() {
    'use strict';
    try{
    getAttrs([ "SuggPowers_max"], function(values) {
      let vals = {};
      vals["SuggPowers"]="";
      vals["SuggPowers_max"]="";

      let data=parseJSON(values["SuggPowers_max"]);

      if(data) AbilityArrayDrop (data,"repeating_talents","T",null,true);

      setAttrsLog(vals);
    });
  } catch(err) {log("Earthdawn:ocAddSuggPowers() error caught: " + err );}
}));//end ocAddSUggPowers

//Add all the powers on the suggested list
  on("clicked:addspells", fn(function ocAddSpells() {
    'use strict';
    try{
    getAttrs([ "addspells_Circle" , "addspells_Disc"], function(values) {

      let database={
        "El" :["",
        "Air Armor,Crunch Climb,Earth Darts,Flameweapon,Heat Food,Purify Earth,Purify Water,Resist Element,Shelter,Snuff,Waterproof"
        ,"Air Mattress,Fingers of Wind,Icy Surface,Mantle of the Woodland Hunter,Shield Willow,Slow Weapon"
        ,"Ice Mace and Chain,Lightning Bolt,Mantle of the Reflecting Pool,Plant Feast,Thrive,Winds of Deflection"
        ,"Air Blast,Blizzard Sphere,Elemental Spear,Grove Renewal,Lightning Step,Uneven Ground"
        ,"Earth Staff,Fireball,Heat Armor,Nutritious Earth,Ride the Lightning,Shattering Stone"
        ,"Drastic Temperature,Fireweave,Mantle of the Fire Marauder,Metal Wings,Stone Rain,Tossing Earth"
        ,"Cloud Summon,Death Rain,Earth Surfing,Mantle of the Blood Elf,Thunderclap,Whirlwind"
        ,"Crushing Hand of Earth,Earth Wall,Ironskin,Mantle of the Lightning Vanguard,Venomous Fury,Vital Springs"
      ],
        "Il" : ["",
        "Assuring Touch,Best Face,Cloak,Disaster,Encrypt,Ephemeral Bolt,Fun With Doors,Monstrous Mantle,Send Message,True Ephemeral Bolt,Trust,Unseen Voices"
        ,"Blindness,Displace Image,Innocent Activity,Mind Fog,Phantom Flame,See the Unseen"
        ,"And Then I Woke Up,Blinding Glare,Fog of Jeer,Nobody Here,Phantom Warrior"
        ,"Clarion Call,Great Weapon,Notice Not,Phantom Lightning,Stop Right There,Suffocation,Unmask"
        ,"Bond of Silence,Eye of Truth,Illusion,Phantom Fireball,Presto!,Switch"
        ,"Astral Shadow,Chosen Path,Flying Carpet,Illusory Missiles,Memory Scribe,True Missiles,True Switch"
        ,"Dancing Dragon,Silent Stampede,Stampede,Twisted Tongues,Vertigo,Walk Through"
        ,"Face Lift,Form Exchange,Other Place,Rebel Limb,Shadow Spell,Stench"
],
        "Ne" :["",
        "Astral Spear,Bone Circle,Dark Messenger,Ethereal Darkness,Experience Death,Life Circle of One,Shadow Meld,Soul Armor,Soulless Eyes,Spirit Dart,Spirit Grip"
        ,"Aspect of the Fog Ghost,Chilling Circle,Deaths Head,Nights Edge,Shadows Whisper,Shield Mist,Summon Fog Ghost"
        ,"Arrow of Night,Aspect of the Bone Spirit,Aspect of the Cowardly Skulk,Fog of Fear,Grave Message,Pain,Summon Bone Spirit"
        ,"Aspect of the Menacing Tyrant,Dark Spy,Evil Eye,Last Chance,Nightflyers Cloak,Viewpoint"
        ,"Aspect of the Cruel Physician,Blind,Circle of Astral Protection,Dust to Dust,Reverse Withering,Wither Limb"
        ,"Astral Maw,Bone Shatter,Debilitating Gloom,Friendly Darkness,Recovery,Step Through Shadow"
        ,"Aspect of the Casual Murderer,Astral Beacon,Bone Pudding,Constrict Heart,Foul Vapors,Restrain Entity"
        ,"Aspect of the Astral Savant,Horror Call,Netherblade,Shadow Tether,Spirit Portal,Wither Away"
],
        "Wz" : ["",
        "Astral Sense,Bedazzling Display of Logical Analysis,Catseyes,Divine Aura,Flame Flash,Iron Hand,Mage Armor,Mind Dagger,Quicken Pace,Speed Reading,Wall Walker"
        ,"Astral Shield,Baseline Subtraction,Crushing Will,Dodge Boost,Rope Ladder,Seeking Sight"
        ,"Astral Targeting,Aura Strike,Combat Fury,Identify Magic,Levitate,Wizard Mark"
        ,"Ball of String,Binding Threads,Evolved Consciousness,Jugglers Touch,Lighten Load,Wizards Cloak"
        ,"Flight,Giant Size,Mystic Shock,Sever Talent,Slow,Weapon Back"
        ,"Displace Self,Energy Shield,Loan Spell,Rampage,Razor Orb,Sleep"
        ,"Call,Confusing Weave,Dislodge Spell,Hypervelocity,Mystic Net,Spellstore"
        ,"Astral Catastrophe,Catch Spell,Compression Bubble,Karma Cancel,Spell Cage,Spell Snatcher"
]
      }

      let data=database[values["addspells_Disc"]];
      if(!data){
        log("Earthdawn.addspells, unknown discipline " + values["addspells_Disc"]);
        return;
      }

      let data2=[];

      for(let i=1; i<=Math.min(8,getInt(values,"addspells_Circle")); i++){
        let datac=data[i].split(",");
        for(let j=0; j<datac.length;j++){
          data2.push({Name:datac[j]})
        }
      }

      AbilityArrayDrop (data2,"repeating_spell","SP");
    });
  } catch(err) {log("Earthdawn:ocAddSpells() error caught: " + err );}
}));//end ocAddSpells



  //v3 textImport transferred from API to Sheetworker
  //This Routine actually processes the data of masks
  var FillDataMask = function fnFillDataMask(data,mult) {
    'use strict';
    try{
      let vals={};
      let attarray=[  "charName" ,"SrRating", "working-Circle", "Creature-Durability",
      "Dex-Step", "Str-Step", "Tou-Step", "Per-Step","Wil-Step", "Cha-Step","Initiative-Step",
      "Attrib-Dex-Curr", "Attrib-Str-Curr", "Attrib-Tou-Curr", "Attrib-Per-Curr","Attrib-Wil-Curr", "Attrib-Cha-Curr",
      "Dex-Adjust", "Str-Adjust", "Tou-Adjust", "Per-Adjust", "Wil-Adjust", "Cha-Adjust",
      "Damage-Death-Rating" , "Damage-Death-Rating-Adjust" , "Damage-Unc-Rating" , "Damage-Unconscious-Adjust", "Recovery-Tests_max" , "Recovery-Tests-Misc-Adjust", "Wound-Threshold" , "Wound-Threshold-Adjust",
      "Knockdown-Adjust","Initiative-Adjust","Misc-Movement-Adjust","Movement-Race","Fly-Movement-Race","Fly_max",
      "Defense-Phys-Nat-Adjust","Defense-Myst-Nat-Adjust","Defense-Soc-Nat-Adjust","Armor-Phys-Nat-Adjust","Armor-Myst-Nat-Adjust",
      "Creature-Fury","Creature-ResistPain","Creature-Willful","Creature-Ambushing_max","Creature-DivingCharging_max"];

      getSectionIDs("repeating_weapons", function(warray) {
        for(let i=0; i < warray.length; i++){
          attarray.push( buildPre( "WPN", warray[ i ]) + "Rank" );
          attarray.push( buildPre( "WPN", warray[ i ]) + "Rank-Adjust" );
          attarray.push( buildPre( "WPN", warray[ i ]) + "Effective-Rank" );
          attarray.push( buildPre( "WPN", warray[ i ]) + "BaseDamage" );
        }

        getSectionIDs("repeating_talents", function(tarray) {
          for(let i=0; i < tarray.length; i++){
            attarray.push( buildPre( "T", tarray[ i ]) + "Rank" );
            attarray.push( buildPre( "T", tarray[ i ]) + "Name" );
            attarray.push( buildPre( "T", tarray[ i ]) + "Rank-Adjust" );
            attarray.push( buildPre( "T", tarray[ i ]) + "Mod-Type" );
            attarray.push( buildPre( "T", tarray[ i ]) + "Attribute" );
            attarray.push( buildPre( "T", tarray[ i ]) + "Effective-Rank" );
            attarray.push( buildPre( "T", tarray[ i ]) + "BaseStep" );
          }
          getSectionIDs("repeating_maneuvers", function(marray) {
            for(let i=0; i < marray.length; i++){
              attarray.push( buildPre( "MAN", marray[ i ]) + "Name" );
            }

            log("FillMask " + mult + " data " + JSON.stringify(data));
            getAttrs(attarray, function gaFillDataMask(values) {
              let SrRating=0,
              tmp;

              //Adjust att by the value in data[tf], with potentially an offset adj
              function Adjust(data2,tf,att,adj) {
                'use strict';
                try {
                  if(data2[tf]){
                    let v=getInt(data2,tf) + (adj||0);
                    vals[att] = getInt(values,att) + mult * v;
                  }
                } catch(err) {   log( "Earthdawn FillMask.Adjust() error caught: " + err );    }
              }//end Adjust

              // Start of the main Code

              //Name
              if(data.Name){
                if(mult==-1)
                vals["charName"]=(values["charName"]||"").replace("- " + data.Name,"");
                else vals["charName"]=(values["charName"]||"") + "- " + data.Name;
              }

              //Challenge Rating
              Adjust(data,"SrRating","SrRating")

              //Attributes
              for( let i=0;i<6;i++ ){
                let att=["Dex","Str","Tou","Per","Wil","Cha"][i]
                Adjust(data,att+"_Step",att + "-Adjust");
              }

              Adjust(data,"Initiative", "Initiative-Adjust", -getInt(data,"Dex_Step") );//We want to offset the adjustment from the Dex to not double count it
              Adjust(data,"PD", "Defense-Phys-Nat-Adjust");
              Adjust(data,"MD", "Defense-Myst-Nat-Adjust");
              Adjust(data,"SD", "Defense-Soc-Nat-Adjust");
              Adjust(data,"PA", "Armor-Phys-Nat-Adjust");
              Adjust(data,"MA", "Armor-Myst-Nat-Adjust");
              Adjust(data,"Knockdown", "Knockdown-Adjust", -getInt(data,"Str_Step") ); //We want to offset the adjustment from the Str to not double count it
              Adjust(data,"Movement", "Movement-Race");


              if(data["Movement2"]) //
                if(data["Movement2"].match(/fly/i)){ //The masks adds flying, results will be different depending if the creature is already flying or not
                  if(values["Fly_max"]=="1") {//The Creature has already flight, so should have already a flying speed apply to it the adjustment
                    vals["Fly_max"]= mult>0 ? "1" : "0";
                    Adjust(data,data["Movement2_Rate"] ? "Fly_Movement_Race" : "Movement", "Fly-Movement-Race");
                    }
                  else{ //Creature doesn't have flying... add flying to it, and potentially add the adjustment
                    vals["Fly_max"]= mult>0 ? "1" : "0";
                    vals["Fly-Movement-Race"]= getInt(values,"Movement-Race");
                    vals["Fly-Movement-Race"]+= mult * ( data["Movement2_Rate"] ? getInt(data,"Movement2_Rate") : getInt(data,"Movement"));
                  }
                } else if(mult>0){ //Non Flying movement will be added as a Power with Step as the rate
                  let movdata={};
                  movdata.Name=data["Movement2"];
                  movdata.Mod_Type="NoRoll";
                  if(data["Movement2_Rate"]) movdata.Step = data["Movement2_Rate"];
                  AbilityDrop(movdata.Name,"repeating_talents","T",null,movdata);
                }


              //Health Ratings
              //log("Death rating correction " + ( - (getInt(data,"SrRating") * (getInt(values,"Creature-Durability") + 1 )) -getInt(data,"Tou_Step")));
              // Adjust(data,"Damage_Death_Rating" , "Damage-Death-Rating-Adjust",   - (getInt(data,"SrRating") * (getInt(values,"Creature-Durability") + 1 )) -getInt(data,"Tou_Step") );
              // Adjust(data, "Damage_Unc_Rating" , "Damage-Unconscious-Adjust", - (getInt(data,"SrRating") * getInt(values,"Creature-Durability"))); //Changes in the Tou Step won't affect the rating, but change in SrRating will

              //changed in v3.1
              Adjust(data,"Damage_Death_Rating" , "Damage-Death-Rating-Adjust", -getInt(data,"Tou_Step") );
              Adjust(data, "Damage_Unc_Rating" , "Damage-Unconscious-Adjust");

              Adjust(data, "Recovery_Tests_max" , "Recovery-Tests-Misc-Adjust");
              Adjust(data, "Wound_Threshold" , "Wound-Threshold-Adjust");
              Adjust(data, "Actions" , "Actions");

              //Attacks
              let dmgmax=0;
              for(let i=0;i<warray.length; i++){
                let pre=buildPre("WPN", warray[i]);
                //log("Adjusting "  + values[pre+"Name"] + " from " + values[pre+"Rank-Adjust"] + " of " + data["Weapon"][j]["Step"]);
                dmgmax=Math.max(dmgmax,getInt(values,pre+"Effective-Rank"));
              }
              let atkmax=0;
              for(let i=0;i<tarray.length; i++){
                let pre=buildPre("T", tarray[i]);
                //log("Adjusting "  + values[pre+"Name"] + " from " + values[pre+"Rank-Adjust"] + " of " + data["Weapon"][j]["Step"]);
                if(values[pre+"Mod-Type"].startsWith("Attack"))
                atkmax=Math.max(atkmax,getInt(values,pre+"Effective-Rank"));
              }
              //log("atkmax " + atkmax + " dmg " + dmgmax);

              if(data["Attacks"]){
                let arr;
                if(typeof data["Attacks"] =="string") arr=parseJSON(data["Attacks"]);
                else arr=data["Attacks"];
              for(let j=0; j<arr.length ; j++){
                log("Adjusting " + JSON.stringify(arr[j]["Name"]));
                if(arr[j]["Name"]=="Attack"){
                  dmgmax+=getInt(arr[j],"Dmg_Step")-getInt(data,"Str_Step");//Old version with the Rank
                  atkmax+=getInt(arr[j],"Atk_Step")-getInt(data,"Dex_Step");//Old version with the Rank
                  for(let i=0;i<warray.length; i++){
                    let pre=buildPre("WPN", warray[i]);
                    //log("Adjusting "  + values[pre+"Name"] + " from " + values[pre+"Rank-Adjust"] + " of " + data["Weapon"][j]["Step"]);
                    Adjust(arr[j],"Dmg_Step",pre+"Rank-Adjust",-getInt(data,"Str_Step"));
                  }
                  for(let i=0;i<tarray.length; i++){
                    let pre=buildPre("T", tarray[i]);
                    //log("Adjusting "  + values[pre+"Name"] + " from " + values[pre+"Rank-Adjust"] + " of " + data["Weapon"][j]["Step"]);
                    if(values[pre+"Mod-Type"].startsWith("Attack"))
                    Adjust(arr[j],"Atk_Step",pre+"Rank-Adjust",-getInt(data,values[pre+"Attribute"] + "_Step"));
                  }
                } else { //A couple of masks add tranmple with the damage max
                  if(mult>0) { // We need to deal with a very special case where it is referred as highest attack and highest damage
                    // log("processing exceptional attack " + atkmax + " dmg " + dmgmax);
                    // log("details dmg " + dmgmax  + " " + getInt(arr[j],"Dmg_Step"));
                    // log("details atk " + atkmax  + " " + getInt(arr[j],"Atk_Step"));

                    let nm=arr[j]["Name"].trim();
                    let datacopy={},datacopy2={};
                    let atkadj,dmgadj;
                    datacopy["Name"]="Dmg-" + nm;
                    datacopy["Step"]= arr[j]["Dmg_Step"];
                    dmgadj=parseInt2(arr[j]["Dmg_Step"].replace(/highest\s*damage/i,"").replace(/highest\s*attack/i,"").replace(/\(\s*\)/,"").trim())||0;
                    datacopy["Rank"]= JSON.stringify(dmgmax  + dmgadj);
                    // if(arr[j]["Dmg_Step"].match(/highest\s*damage/i,"") || arr[j]["Dmg_Step"].match(/highest\s*attack/i,"")){
                    //   dmgadj=parseInt2(arr[j]["Dmg_Step"].replace(/highest\s*damage/i,"").replace(/highest\s*attack/i,"").replace(/\(\s*\)/,"").trim())||0;
                    //   datacopy["Step"]= JSON.stringify(dmgmax  + dmgadj);
                    // } else datacopy["Step"]= arr[j]["Dmg_Step"];

                    datacopy["CombatSlot"]="1";
                    AbilityDrop("Dmg-" + nm,"repeating_weapons","WPN",null,datacopy);
                    datacopy2["Name"]="Atk-" + nm;

                    datacopy2["Step"]= arr[j]["Atk_Step"];
                    atkadj=parseInt2(arr[j]["Atk_Step"].replace(/highest\s*damage/i,"").replace(/highest\s*attack/i,"").replace(/\(\s*\)/,"").trim())||0;
                    datacopy2["Rank"]= JSON.stringify(atkmax  + atkadj);
                    // if(arr[j]["Atk_Step"].match(/highest\s*damage/i,"") || arr[j]["Atk_Step"].match(/highest\s*attack/i,"")){
                    //   atkadj=parseInt2(arr[j]["Atk_Step"].replace(/highest\s*damage/i,"").replace(/highest\s*attack/i,"").replace(/\(\s*\)/,"").trim())||0;
                    //   datacopy2["Step"]= JSON.stringify(atkmax  + atkadj);
                    // } else datacopy2["Step"]= arr[j]["Atk_Step"];

                    datacopy2["Mod_Type"]="Attack CC";
                    datacopy2["roll20_Attribute"]="Dex";
                    datacopy2["roll20_Target"]="PD1: @{target|Target|token_id}";
                    datacopy2["CombatSlot"]="1";
                    datacopy2["roll20_Type"]="Power";
                    AbilityDrop("Atk-" + nm,"repeating_talents","T",null,datacopy2);
                  }
                }
              }//end attacks
            }

              //SPELLS
              AbilityArrayDrop (data["Spells"],"repeating_spell","SP");
              if(data["Spells"])       vals["Hide-Spells-Tab"]="0";
              //Weapons
              AbilityArrayDrop (data["Weapons"],"repeating_weapons","WPN",null,true);
              //Powers
              AbilityArrayDrop (data["Powers"],"repeating_talents","T",atkmax,true,"Power");
              //Maneuvers
              AbilityArrayDrop (data["Maneuvers"],"repeating_maneuvers","MAN");


              //log("FillMask "+ JSON.stringify(vals));
              setAttrsLog(vals);
            });
          });
        });
      });
    } catch(err) {log("Earthdawn:FillMask() error caught: " + err );}
  }; //end FillDataMask()



  //This Routine actually processes the data of traps
  var FillDataTrap = function fnFillDataTrap(data) {
    'use strict';
    try{
      let vals={};
      let attarray=["Damage-Death-Rating" , "Damage-Death-Rating-Adjust","Initiative","Initiative-Adjust","PD","PD-Nat","Defense-Phys-Nat-Adjust","PA","PA-Nat","Armor-Phys-Nat-Adjust","MD","MD-Nat","Defense-Myst-Nat-Adjust","MA","MA-Nat","Armor-Myst-Nat-Adjust",];

            log("FillTrap  data " + JSON.stringify(data));
            getAttrs(attarray, function gaFillDataTrap(values) {


              function AdjustChar(attdata,att,attadj,adj2){
                if(data[attdata] && ["immune","na","-"].includes(data[attdata].trim().toLowerCase())) //Dealing with immunities
                vals[ attadj ? attadj : att] = "999";
                else if(data[attdata]){
                  let adj=getInt(data,attdata) - getInt(values,att)-(adj2||0);
                  if(adj!==0){
                     if(attadj) vals[attadj] = adj + getInt(values,attadj); //Adjust via adjustment
                     else vals[att]=getInt(data,attdata)-(adj2||0); //Adjustment directly in the target value
                  }
                  //log("AdjustChar " + att + " value to reach " + getInt(data,attdata) + " value before " + getInt(values,att) + " adj2 is " +adj2 + " adj is " + adj);
                  if(data[attdata].match(rgSR)) vals[att + "-addSR"]="1";
                }
              } //end AdjustChar



              AdjustChar("Initiative","Initiative","Initiative-Adjust",0);
              AdjustChar("PD","PD-Nat","Defense-Phys-Nat-Adjust",0);
              AdjustChar("PA","PA-Nat","Armor-Phys-Nat-Adjust",0);
              AdjustChar("MD","MD-Nat","Defense-Myst-Nat-Adjust",0);
              AdjustChar("MA","MA-Nat","Armor-Myst-Nat-Adjust",0);
              //Health Ratings
              AdjustChar("Damage_Death_Rating","Damage-Death-Rating","Damage-Death-Rating-Adjust");

              //Powers
              AbilityArrayDrop (data["Powers"],"repeating_talents","T",null,true,"Power");
              //log("FillMask "+ JSON.stringify(vals));

              let note="";
              if(data.Detection) note+="Detection : " + data.Detection + "\n";
              if(data.Disarm) note+="Disarm : " + data.Disarm + "\n";
              if(data.Description) note+="Description : \n" + data.Description + "\n";
              if(data.Trigger) note+="Trigger : \n" + data.Trigger + "\n";
              if(data.Effect) note+="Effect : \n" + data.Effect + "\n";

              vals["general-notes"]=note;


              setAttrsLog(vals);

      });
    } catch(err) {log("Earthdawn:FillDataTrap() error caught: " + err );}
  }; //end FillDataTrap()


  //For Any array like Talents, Power etc in the JSON for textimport or creature drop, fills in the array
  //if combatslot is set, set it for all
var AbilityArrayDrop = function fnAbilityArrayDrop (data,rep,code,atkmax,combatslot,type) {
  'use strict';
  try{
    let arr,matnum=0;
    if(typeof data =="string") arr=parseJSON(data);
    else arr=data;
    if(!arr) return;

//JBF@JBF test
let comp_query_array=[];
for(let j=0; j<arr.length ; j++){
  let compq= BuildCompendiumQuery(arr[j]["Name"],code);
  if(compq!=="") comp_query_array.push(compq);
}
//log("compqueryarray " + JSON.stringify(comp_query_array));

 getCompendiumQuery(comp_query_array, function(comp_data) {
//log("compdata for code " + code + " data " + JSON.stringify(comp_data));
//JBF@JBF testend
  for(let j=0; j<arr.length ; j++){

      //log("processing Talent " + arr[j]["Name"]);
          let nm=arr[j]["Name"];
          if(!nm.match(/No\s*Change/i)){
          let datacopy=arr[j];
          datacopy["Name"]=nm;
          if(["Standard Matrix","Enhanced Matrix"].includes(nm)){
            matnum++;
            if(matnum<3) datacopy.roll20_Origin="Free-link";
          }
          if(datacopy.Step && (datacopy.Step.match(new RegExp(rgAtk,"i")) || datacopy.Step.match(new RegExp(rgHAtk,"i")))){ //If the Step is defined as = Attack, use Dex and highest Attack rank to match the Step
            datacopy.Rank=atkmax;
            datacopy.roll20_Attribute="Dex";
          }
          if(combatslot) datacopy.roll20_CombatSlot="1";
          if(type) datacopy.roll20_Type=type
          //if(!(arr[j]["Step"]))   datacopy["roll20_Mod_Type"]="NoRoll";
          let mode=["T","SK","SP"].includes(code) ? "overwrite,AbilityAdd" : //Those will go through Autofill
          ""; //Others won't which avoids overloading autofill

          AbilityDrop(nm,rep,code,null,datacopy,mode,comp_data);
          //log("processing Talent " + arr[j]["Name"] + " with data " +JSON.stringify(datacopy));

         }
       }
       });
  } catch(err) {log("Earthdawn:AbilityArrayDrop () error caught: " + err );}
}; //end AbilityArrayDrop ()





  //v3 RemoveMask will take care of removing the masks when deleted in the repeating section
var RemoveMask = function fnFillDataCreature(eventInfo) {
  'use strict';
  try{
    //log("RemoveMask " + JSON.stringify(eventInfo));
    let data;
    if(eventInfo.removedInfo)
      for(var key in eventInfo.removedInfo)
        if (key.endsWith("Details")) data=parseJSON(eventInfo.removedInfo[key]);
    if(data)     FillDataMask(data,-1);
  } catch(err) {log("Earthdawn:RemoveMask() error caught: " + err );}
}; //end RemoveMask()
on("remove:repeating_masks", fn(RemoveMask) );



//Copy of the DnD code that sets the bars in a compendium drop
on("sheet:compendium-drop", fn(function onCompDrop() {
  'use strict';
  try{
    //log("compdrop");
    getAttrs(["CreatureSize","NPC"], function gaCompDrop(values) {
      if(values["NPC"]!=="-1"){
          let tokenOutput = {"bar1_link":"Karma","bar2_link":"Wounds", "bar3_link":"Damage"};
      let crsize = Math.max(1,getInt(values,"CreatureSize")) * 70; //Adjust the Token Size to the Creature Size
        tokenOutput.height=crsize;
        tokenOutput.width=crsize;
    setDefaultToken(tokenOutput);
  }
  });
} catch(err) {log("Earthdawn:ocCompDrop error caught: " + err );}
}));






</script>
