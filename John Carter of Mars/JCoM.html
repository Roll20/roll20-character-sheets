<!-- Sheet Tab Buttons -->
<div>
    <button type="action" name="act_PC">PC</button>
<!--    <button type="action" name="act_PCdetail">PC-Detail</button>-->
    <button type="action" name="act_Beast">Beast of Barsoom</button>
<!-- <button type="action" name="act_GM">GM Panel</button> -->
</div>

<!-- Sheet Tabs -->

<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="PC">
<input type="hidden" name="attr_initialized" value=0>

<div class="sheet-PC">
    <div class="characterinfo">
        <input class="charname_label" name="attr_character_name"><br>
        <table>
            <tr>
                <td>
                    <span class="attributelabel-NP">Title </span>
                </td>
                <td width=10>
                    
                </td>
                <td>
                    <input type="text" class="shorttext" name="attr_title">
                </td>
            </tr>  
            <tr>
                <td>
                    <span class="attributelabel-NP">Race </span>
                </td>
                <td width=10>
                    
                </td>
                <td>
                    <input type="text" class="shorttext" name="attr_race">
                </td>
            </tr>
            
        </table>
    </div>
    <div class="bannerleft">
     .   
    </div>
    <div class="bannerright">
       
    </div>
	<div class="weaponpanel">
	    
        <span class="2d20header">Equipment</span>
       	<fieldset class="repeating_coreequ">
            <input type="text" class="talentlabel" name="attr_coreequ" value="Equipment" title="Equipment name">
            <select name="attr_equclass" class="shorttext3" title="Core or not?">
				<option value="core">Core</option>
				<option value="noncore">-</option>
	            </select>
			<input type="text" class="text35" name="attr_coreequdesc" value="Description" title="Equipment desc">
		</fieldset>
        <hr class="minorbreak">	    
        <span class="2d20header">Weapons</span>
        <input name="attr_loadbonus" type="hidden" value=0>
		<fieldset class="repeating_weapons">
            <input type="text" class="weaponheader" value="Weapon Name" name="attr_WeaName" title="Weapon name">
			<select name="attr_wea_class" class="shorttext" title="weapon class">
				<option value="@{melee_bonus}">Melee</option>
				<option value="@{ranged_bonus}">Near</option>
                <option value="@{threat_bonus}">Away</option>
                <option value="@{threat_bonus}">Threaten</option>
            </select>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Spacerflower.png" width="30">
            Dmg <input type="number" class="die-value" value="cd" name="attr_CD" title="Damage dice" value="1">
            + <input type="number" class="die-value" value="cd" name="attr_momCD" title="Bonus damage dice from momentum" value="0">

            <button type="roll" title="Damage roll" value="&{template:CDroll}{{name=@{character_name}}}{{weaponname=@{WeaName}}}{{effects=@{effects}}}{{bonus=@{momCD}}}{{result=[[[[@{cd}+@{momCD}]]t[CD]]]}}"></button>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Spacerflower.png" width="30">
            Notes <input type="text" value="Notes" name="attr_effects" class="shorttext">
          <BR>
		</fieldset>
	</div>
    <div class="attributepanel">
        <span class="2d20header">Character Attributes</span><br><br>
        <table class="attributetable">
            <TR>
                <td><span class="talentlabel"></span></td><td><span class="talentlabel">Name</span></td><td><span class="talentlabel">Score</span></td><td><span class="talentlabel"></span></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_cunning1">A</button></p></td>
                <Td><span class="skilllabel" title="Used for all attacks, insults and thefts.">Cunning</span></td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_cunning" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_cunning2">B</button></p></td>
            </TR>
            <TR class="skillrow">
                <td><p align="center"><button type="action" name="act_daring1">A</button></p></td>
                <Td><span class="skilllabel" title="Used when at risk and movement is important.">Daring</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_daring" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_daring2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_empathy1">A</button></p></td>
                <Td><span class="skilllabel" title="Used to understand or heal another.">Empathy</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_empathy" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_empathy2">B</button></p></td>
            </TR>
            <TR class="skillrow">
                <td><p align="center"><button type="action" name="act_might1">A</button></p></td>
                <Td><span class="skilllabel" title="Used to apply force to the inanimate world.">Might</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_might" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_might2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_passion1">A</button></p></td>
                <Td><span class="skilllabel" title="Used for attempts to lead, love or entertain.">Passion</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_passion" type="number" value=0></Td>
				<td><p align="center"><button type="action" name="act_passion2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_reason1">A</button></p></td>
                <Td><span class="skilllabel" title="Used for actions that used the mind or the senses.">Reason</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_reason" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_reason2">B</button></p></td>
            </TR>
        </table>
    </div>

    <!-- ********************************** -->
    <!-- MOMENTUM & LUCK -->
    <!-- ********************************** -->
    <div class="momentumpanel">
        <span class="2d20header">Momentum</span><BR>
        <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Mometumgem.png" width="70" title="Max momentum that can be saved turn to turn.">
      <input type="number" class="big-value" name="attr_maxpool" value="0"> <!-- <button class="blankroll" type="roll" value="!spendmomentum @{character_id} ?{how much|1} Miscellaneous"><img src="https://i.imgur.com/2aj8eEM.png" title="spend momentum" width="20" height="20"></button>-->
    </div>

    <div class="luckpanel">
        <span class="2d20header">Luck</span> 
        <table>
            <tr>
                <td>
                    <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Luckcoin.png" width="70" title="Manually tracked Luck pool">
                    <input type="number" class="big-value" name="attr_fortune" value=0><br>
                </td>

            </tr>
        </table>        
    </div>
    <!-- ********************************** -->
    <!-- STRESS & HARM PANEL -->
    <!-- ********************************** -->
    <div class="stresspanel">
 
        <table class="stresstable">
            <tr>
                <td>
                    <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/JCOMSpacerGem_blue.png" width="40">  
                    </td>
                <TD>
                    <span class="2d20header">Confusion</span><BR>
                    (Empathy & Reason)<br>
					<input name="attr_confusion_current" type="number" value=0 class="die_value">/
					<input type="number" name="attr_maxconfusion" class="attributelabel-NP" value="0">
                    <br>
				    <input name="attr_madness1" type="checkbox" value="1">
                    <input name="attr_madness2" type="checkbox" value="1">
                    <input name="attr_madness3" type="checkbox" value="1">
                    <input name="attr_madness4" type="checkbox" value="1">
                    <input name="attr_madness5" type="checkbox" value="1"><br>Madness
					<input type="hidden" class="die-value" name="attr_totalmadness" value="0">
                </TD>
				<td>
                <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/JCOMSpacerGem_green.png" width="40">
				</td>
                <TD>
                    <span class="2d20header">Fear</span><BR>
                    (Daring & Passion) <br>
					<input name="attr_fear_current" type="number" value=0 class="die_value">/
                    <input type="number" name="attr_maxfear" class="attributelabel-NP" value="0" >
				    <br>
                    <input name="attr_trauma1" type="checkbox" value="1">
                    <input name="attr_trauma2" type="checkbox" value="1">
                    <input name="attr_trauma3" type="checkbox" value="1">
                    <input name="attr_trauma4" type="checkbox" value="1">
                    <input name="attr_trauma5" type="checkbox" value="1"><br>Trauma
					<input type="hidden" class="die-value" name="attr_totaltrauma" value="0">
                </TD>
                <td>
                    <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/JCOMSpacerGem_red.png" width="40">
    
				</td>
                <TD>
                    <span class="2d20header">Injury</span><BR> 
                    (Cunning & Might)<br>
					<input name="attr_injury_current" type="number" value=0 class="die_value">/
                    <input type="number" name="attr_maxinjury" class="attributelabel-NP" value="0" >
				    <br>
                    <input name="attr_wound1" type="checkbox" value="1">
                    <input name="attr_wound2" type="checkbox" value="1">
                    <input name="attr_wound3" type="checkbox" value="1">
                    <input name="attr_wound4" type="checkbox" value="1">
                    <input name="attr_wound5" type="checkbox" value="1"><br>Wounds
					
					<input type="hidden" class="die-value" name="attr_totalwounds" value="0">
                </TD>
            </tr>
        </table><br>
        <p align="center"><button type="action" name="act_resetstress">Reset Stress</button></p>
    </div>

    <!-- ********************************** -->
    <!-- DIE CONTROL PANEL -->
    <!-- ********************************** -->
    <div class="diecontrol">
        <span class="2d20header">2d20 Dice Roller<span><br>
        <span class="attributelabel">1. Set Difficulty</span>
        <button type="action" name="act_d0">0</button>
        <button type="action" name="act_d1">1</button>
        <button type="action" name="act_d2">2</button>
        <button type="action" name="act_d3">3</button>
        <button type="action" name="act_d4">4</button>
        <button type="action" name="act_d5">5</button>
        <br>
        <span class="dielabel">2. attributes:</span><br>
        A. <input type="text" name="attr_attribute1" value="None" class="shorttext" readonly> + B. <input type="text" name="attr_attribute2" value="None" class="shorttext" readonly><br>
        <input type="hidden" name="attr_attribval1" value="0" readonly>
        <input type="hidden" name="attr_attribval2" value="0" readonly>
        <span class="dielabel">> TN:</span><input type="number" class="attributelabel-5" name="attr_TN" value="[[@{attribval1}+@{attribval2}]]" disabled>
        <span class="dielabel">FC:</span><input type="number" class="attributelabel-5" name="attr_FC" value=10 readonly><BR>
        
        <!-- Hidden fields to calculate difficulties based on harm and skill type -->
        <input type="hidden" name="attr_currenttype" value="">
        <input type="hidden" name="attr_currentfail" value="20">
        <input type="hidden" name="attr_currenttrauma" value="0">
        <input type="hidden" class="die-value" name="attr_adjusted_difficulty" value="[[@{difficulty}+@{currentharm}]]" disabled>    

        <span class="attributelabel">> vs. difficulty</span>
        <input type="number" name="attr_difficulty" class="die_value" readonly> <span class="attributelabel-NP">+ Harms</span><input class="die-value" type="number" value="0" name="attr_currentharm"> (Max D5)<br>

        <span class="attributelabel">3. Choose dice to add to your roll here</span><BR>
		<p align="center">
			<input type="hidden" name="attr_baseroll" value="[[2+@{d20momentum}+@{d20doom}]]">
			<input type="hidden" name="attr_fortuneroll" value="[[@{d20fortune}<@{currentFC}]]">
            <button type="action" title="+1d20 from momentum." name="act_adddie_momentum"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Mometumgem.png" width="35" height="30"></button>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
            <button type="action" title="Give GM 1 doom for +1d20." name="act_adddie_doom"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/skullandcross.png" width="35" height="30"></button>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
            <button type="action" title="+1d20 from Luck, rolled as a 1." name="act_addlucky20"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Luckcoin.png" width="35" height="30"></button>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
            <button type="action" title="+1d20, no cost, make up deficiencies from loads etc." name="act_add20"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Question.png" width="35" height="30"></button><br><br>
            <button type="action" name="act_cleardice" title="Redistribute points">Reset Dice</button>
            

        </p>
        <hr class="minorbreak">
        Current dice being rolled...<BR>
            <p align="center">

            <span class="dielabel">2d20 +</span>
            <input type="hidden" name="attr_d20momentum" class="die_value" readonly value=0 title="Dice from momentum">
            <input type="hidden" name="attr_spentmom" value=0>
            <input type="hidden" name="attr_d20doom" class="die_value" readonly value=0 title="Dice from doom">
            <input type="hidden" name="attr_d20fortune" class="die_value" readonly value=0 title="Dice from fortune">
            <input type="hidden" name="attr_d20exception" class="die_value" readonly value=0 title="Dice from talents/loads/equipment">
            <input type="number" class="big-value" name="attr_totaldice" value="[[@{d20momentum}+@{d20fortune}+@{d20doom}+@{d20exception}]]" readonly disabled>
            <input type="hidden" name="attr_dicetoroll" value="[[2+@{d20momentum}+@{d20doom}+@{d20exception}]]" readonly disabled>
 
            <!-- API COMMAND -->   
            <!-- <button type="roll" name="skill_check" value="!skillcheck @{character_id} skill 2">4. Roll</button> -->

            <!--<button type="roll" name="skill_check" value="&{template:conanroll}{{name=@{character_name}}}{{skill=@{currentskillname}}}{{diff=@{adjusted_difficulty}}}{{momentumdice=@{d20momentum}}}{{spentmomentum=@{spentmom}}}{{doomdice=@{d20doom}}}{{fortunedice=@{d20fortune}}}{{result=[[@{baseroll}d20<@{TN}cs@{FC}cf@{currentFail}]]}}{{fortune=[[@{d20fortune}d1<@{currentTN}cf@{currentFC}]]}}">Roll Dice</button>-->
            <button type="roll" name="skill_check" value="&{template:JCOMroll}{{momentumicon=1}}{{name=@{character_name}}}{{attribute1=@{attribute1}}}{{attribute2=@{attribute2}}}{{diff=@{adjusted_difficulty}}}{{momentumdice=@{d20momentum}}}{{spentmomentum=@{spentmom}}}{{doomdice=@{d20doom}}}{{fortunedice=@{d20fortune}}}{{result=[[@{dicetoroll}d20<@{TN}cs<@{FC}cf20]]}}{{fortune=[[@{d20fortune}d1<@{TN}cf20]]}}">Roll Dice</button>

            <!--<button type="roll" value="[[[[2+@{totaldice}]]d20<@{TN}cs<@{FC}]]">Roll</button>-->
		</p>
    </div>

    <!-- ********************************** -->
    <!-- TALENT PANEL -->
    <!-- ********************************** -->
    <div class="talentpanel">
        <span class="2d20header">Flaw</span><br>
        <input type="text" name="attr_flaw" class="longtext">
        <hr class="minorbreak">
	    <span class="2d20header">Talents</span><Br>
		<input type="hidden" value="1" name="attr_deftblade">
		<fieldset class="repeating_talents">
			<input type="text" class="talentlabel" name="attr_talentname" value="Talent name">
            Grade<input type="number" class="die-value" name="attr_talentgrade" value="0">
            Circ:<input type="text" name="attr_talentcircumstance">
            Eff:<input type="text" name="attr_talenteffect">
			<button class="blankroll" type="roll" name="act_activate_talent" value="&{template:conantalent}{{name=@{character_name}}}{{talent=@{talentname}}}{{grade=@{talentgrade}}}{{circumstance=@{talentcircumstance}}}{{effect=@{talenteffect}}}">Use</button>
		</fieldset>
    </div>

    <!-- ********************************** -->
    <!-- RENOWNPANEL -->
    <!-- ********************************** -->
    <div class="renownpanel">
       <span class="2d20header">Renown</span>
       <table class="stresstable">
           <tr>
               <td><span class="skilllabel">Unspent</span></td><td><span class="skilllabel">Spent</span></td><td><span class="skilllabel">Total</span></td>
           </tr>
           <tr>
               <td><input type="number" class="die-value" name="attr_unspentrenown"></td>
               <td><input type="number" class="die-value" name="attr_spentrenown"></td>
               <td><input type="number" class="die-value" name="attr_totalrenown"></td>
           </tr>
       </table><BR>
        <hr class="minorbreak">
        <span class="2d20header">Experience</span>
        <input type="text" name="attr_experience" value="0"><BR>
        <hr class="minorbreak">        
        <span class="2d20header">Allies</span>
       	<fieldset class="repeating_allies">
			<input type="text" class="text35" name="attr_ally" value="Ally">
        </fieldset>
     </div>
    <div class="starshipsandsteel">
        <a href="www.starshipsandsteel.com">www.starshipsandsteel.com</a>
    </div>
</div>

    <!-- ********************************** -->
    <!-- BEAST OF BARSOOM SHEET -->
    <!-- ********************************** -->

<div class="sheet-Beast">
    <div class="beastbanner">
    </div>
	<div class="BeastName">
        <table class="stresstable">
            <tr>
                <TD colspan=2>
                    <input class="charname_label" name="attr_character_name"><BR>
                <td>
            </Tr>
            <tr>
                <td padding="2px">
                    <input type="radio" name="attr_based20" value="1"><span class="tinytext">Minion</span>
                    <input type="radio" name="attr_based20" value="2"><span class="tinytext">Monster</span><BR>
                    <span class="tinytext">Pack Count</span><BR>
                    <input type="checkbox" name="attr_minion1" value="0">
                    <input type="checkbox" name="attr_minion2" value="1">
                    <input type="checkbox" name="attr_minion3" value="1">
                    <input type="checkbox" name="attr_minion4" value="1">
                    <input type="checkbox" name="attr_minion5" value="1">
                    <input type="hidden" name="attr_mobsize" class="die-value" value="@{minion2}+@{minion3}+@{minion4}+@{minion5}" disabled>
                </TD>
                <td>
                    <span class="2d20header">Menace</span><input type="number" class="big-value" name="attr_beastmenace">/<input type="number" class="attributelabel-NP" name="attr_maxbeastmenace" value="3"><br>
                    Stress<input type="number" class="die_value" name="attr_beaststress">/<input type="number" class="attributelabel-NP" name="attr_maxbeaststress" value="3">
                </td>
            </tr>
        </table>

	</div>
	<div class="BeastAttribs">
        <br>
        <span class="2d20header">Beast Attributes</span><br><br>
        <table class="attributetable">
            <TR>
                <td><span class="talentlabel"></span></td><td><span class="talentlabel">Name</span></td><td><span class="talentlabel">Score</span></td><td><span class="talentlabel"></span></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_cunning1">A</button></p></td>
                <Td><span class="skilllabel">Cunning</span></td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_cunning" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_cunning2">B</button></p></td>
            </TR>
            <TR class="skillrow">
                <td><p align="center"><button type="action" name="act_daring1">A</button></p></td>
                <Td><span class="skilllabel">Daring</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_daring" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_daring2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_empathy1">A</button></p></td>
                <Td><span class="skilllabel">Empathy</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_empathy" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_empathy2">B</button></p></td>
            </TR>
            <TR class="skillrow">
                <td><p align="center"><button type="action" name="act_might1">A</button></p></td>
                <Td><span class="skilllabel">Might</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_might" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_might2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_passion1">A</button></p></td>
                <Td><span class="skilllabel">Passion</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_passion" type="number" value=0></Td>
				<td><p align="center"><button type="action" name="act_passion2">B</button></p></td>
            </TR>
            <TR  class="skillrow">
                <td><p align="center"><button type="action" name="act_reason1">A</button></p></td>
                <Td><span class="skilllabel">Reason</span></Td>
                <td class="skillvaluecell"><input class="attributelabel" name="attr_reason" type="number" value=0></Td>
                <td><p align="center"><button type="action" name="act_reason2">B</button></p></td>
            </TR>
        </table>
    </div>
<!--******************-->
<!--  Beast Special abilities PANEL -->
<!--******************-->
<div class="beasttalents">
    <span class="2d20header">Talents</span><br>
    <fieldset class="repeating_talents">
        <input type="text" class="talentlabel" name="attr_talentname" value="Talent name">
        Grade<input type="number" class="die-value" name="attr_talentgrade" value="0">
        Circ:<input type="text" name="attr_talentcircumstance">
        Eff:<input type="text" name="attr_talenteffect">
        <button class="blankroll" type="roll" name="act_activate_talent" value="&{template:conantalent}{{name=@{character_name}}}{{talent=@{talentname}}}{{grade=@{talentgrade}}}{{circumstance=@{talentcircumstance}}}{{effect=@{talenteffect}}}">Use</button>
    </fieldset>
</div>>



    <div class="beastweapons">
        <span class="2d20header">Beast Weapons</span>
        <input name="attr_loadbonus" type="hidden" value=0>
		<fieldset class="repeating_weapons">
            <input type="text" class="weaponheader" value="Weapon Name" name="attr_WeaName" title="Weapon name">
			<select name="attr_wea_class" class="shorttext" title="weapon class">
				<option value="@{melee_bonus}">Melee</option>
				<option value="@{ranged_bonus}">Ranged</option>
				<option value="@{threat_bonus}">Threaten</option>
            </select>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Spacerflower.png" width="30">
            Dmg <input type="number" class="die-value" value="cd" name="attr_CD" title="Damage dice" value="1">
            + <input type="number" class="die-value" value="cd" name="attr_momCD" title="Bonus damage dice from momentum" value="0">

            <button type="roll" title="Damage roll" value="&{template:CDroll}{{name=@{character_name}}}{{weaponname=@{WeaName}}}{{effects=@{effects}}}{{bonus=@{momCD}}}{{result=[[[[@{cd}+@{momCD}]]t[CD]]]}}"></button>
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Spacerflower.png" width="30">
            Notes <input type="text" value="Notes" name="attr_effects" class="shorttext">
          <BR>
		</fieldset>
	</div>
<!--******************-->
<!--  Beast DIE CONTROL -->
<!--******************-->
    <div class="diecontrol">
        <span class="2d20header">2d20 Dice Roller<span><br>
            <span class="attributelabel">1. Set Difficulty</span>
            <button type="action" name="act_d0">0</button>
            <button type="action" name="act_d1">1</button>
            <button type="action" name="act_d2">2</button>
            <button type="action" name="act_d3">3</button>
            <button type="action" name="act_d4">4</button>
            <button type="action" name="act_d5">5</button>
            <br>
            <span class="dielabel">2. attributes:</span><br>
            A. <input type="text" name="attr_attribute1" value="None" class="shorttext" readonly> + B. <input type="text" name="attr_attribute2" value="None" class="shorttext" readonly><br>
            <input type="hidden" name="attr_attribval1" value="0" readonly>
            <input type="hidden" name="attr_attribval2" value="0" readonly>
            <span class="dielabel">> TN:</span><input type="number" class="attributelabel-5" name="attr_TN" value="[[@{attribval1}+@{attribval2}]]" disabled>
            <span class="dielabel">FC:</span><input type="number" class="attributelabel-5" name="attr_FC" value=10 readonly><BR>
            
            <!-- Hidden fields to calculate difficulties based on harm and skill type -->
            <input type="hidden" name="attr_currenttype" value="">
            <input type="hidden" name="attr_currentfail" value="20">
            <input type="hidden" name="attr_currenttrauma" value="0">
            <input type="hidden" class="die-value" name="attr_adjusted_difficulty" value="[[@{difficulty}+@{currentharm}]]" disabled>    
    
            <span class="attributelabel">> vs. difficulty</span>
            <input type="number" name="attr_difficulty" class="die_value" readonly> <span class="attributelabel-NP">+ Harms</span><input class="die_value" type="number" value="0" name="attr_currentharm"> (Max D5)<br>
    
            <span class="attributelabel">3. Choose dice to add to your roll here</span><BR>
            <p align="center">
                <input type="hidden" name="attr_baseroll" value="[[2+@{d20momentum}+@{d20doom}]]">
                <input type="hidden" name="attr_fortuneroll" value="[[@{d20fortune}<@{currentFC}]]">
                <button type="action" title="+1d20 from momentum." name="act_adddie_momentum"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Mometumgem.png" width="35" height="30"></button>
                <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
                <button type="action" title="Give GM 1 doom for +1d20." name="act_adddie_doom"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/skullandcross.png" width="35" height="30"></button>
                <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
                <button type="action" title="+1d20 from Luck, rolled as a 1." name="act_addlucky20"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Luckcoin.png" width="35" height="30"></button>
                <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Chaos.png" width="20" height="20" title="">
                <button type="action" title="+1d20, no cost, make up deficiencies from loads etc." name="act_add20"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Question.png" width="35" height="30"></button><br><br>
                <button type="action" name="act_cleardice" title="Redistribute points">Reset Dice</button>
                
    
            </p>
            <hr class="minorbreak">
            Current dice being rolled...<BR>
            <p align="center">
                <input type="number" name="attr_based20" class="dielabel" readonly>
                <span class="dielabel">d20 +</span>
                <input type="hidden" name="attr_d20momentum" class="die_value" readonly value=0 title="Dice from momentum">
                <input type="hidden" name="attr_spentmom" value=0>
                <input type="hidden" name="attr_d20doom" class="die_value" readonly value=0 title="Dice from doom">
                <input type="hidden" name="attr_d20fortune" class="die_value" readonly value=0 title="Dice from fortune">
                <input type="hidden" name="attr_d20exception" class="die_value" readonly value=0 title="Dice from talents/loads/equipment">
                <input type="number" class="big-value" name="attr_totaldice" value="[[@{d20momentum}+@{d20fortune}+@{d20doom}+@{d20exception}+@{mobsize}]]" readonly disabled>
                <input type="hidden" name="attr_dicetoroll" value="[[2+@{d20momentum}+@{d20doom}+@{d20exception}]]" readonly disabled>
     
                <!-- API COMMAND -->   
                <!-- <button type="roll" name="skill_check" value="!skillcheck @{character_id} skill 2">4. Roll</button> -->
    
                <!--<button type="roll" name="skill_check" value="&{template:conanroll}{{name=@{character_name}}}{{skill=@{currentskillname}}}{{diff=@{adjusted_difficulty}}}{{momentumdice=@{d20momentum}}}{{spentmomentum=@{spentmom}}}{{doomdice=@{d20doom}}}{{fortunedice=@{d20fortune}}}{{result=[[@{baseroll}d20<@{TN}cs@{FC}cf@{currentFail}]]}}{{fortune=[[@{d20fortune}d1<@{currentTN}cf@{currentFC}]]}}">Roll Dice</button>-->
                <button type="roll" name="skill_check" value="&{template:JCOMroll}{{momentumicon=1}}{{name=@{character_name}}}{{attribute1=@{attribute1}}}{{attribute2=@{attribute2}}}{{diff=@{adjusted_difficulty}}}{{momentumdice=@{d20momentum}}}{{spentmomentum=@{spentmom}}}{{doomdice=@{d20doom}}}{{fortunedice=@{d20fortune}}}{{result=[[@{dicetoroll}d20<@{TN}cs<@{FC}cf20]]}}{{fortune=[[@{d20fortune}d1<@{TN}cf20]]}}">Roll Dice</button>
    
                <!--<button type="roll" value="[[[[2+@{totaldice}]]d20<@{TN}cs<@{FC}]]">Roll</button>-->
            </p>
</div>

<div class="sheet-GM">
    <div class="gmpanel">
        <input type="number" name="attr_momentum"><button type="roll" class="blankroll" title="Subtract 1 from Momentum" value="!decreasemomentum GMPANEL 1"><img src="https://imgur.com/DxddPM7.png" width="22"></button><br>
        <label>Momentum</label>
        <input type="number" name="attr_doom"><button type="roll" class="blankroll" title="Report Doom" name="reportdoom" value="!reportdoom GMPANEL"><img src="https://i.imgur.com/J08Xe7w.png" width="22"></button>
        <label>Doom</label>
       <!-- <input type="number" name="attr_GMdifficulty"><label>GM Difficulty</label>
        <input type="number" name="attr_difficulty"><label>Difficulty</label>-->
    </div>
    <div class="combatpanel">
        <input type="number" name="attr_currentround" value="1"><label>Round</label>
        <button type="action" name="act_nextround">Next Round</button><BR>
        <button type="action" name="act_startcombat">Start Combat</button>

    </div>
    <div class="playerpanel">
        <fieldset class="repeating_players">
            <input type="text" class="talentlabel" name="attr_playername">
            <input type="checkbox" name="attr_takenturn">
		</fieldset>
    </div>
    <div class="swordfooter">
        <button type="roll" class="blankroll" value="!init @{character_id}">
            <img src="https://i.imgur.com/GvDDrVy.png" title="End Turn">
        </button>

		<!-- Zero Momentum spends -->
		<!-- Report remaning Momentum -->
		<!-- Zero dice-->
		<!-- Reset talents -->
    </div>
</div>

<!-- Roll Templates -->

<!-- Main Skill & Attribute Template -->

<rolltemplate class="sheet-rolltemplate-JCOMroll">
    <div class="sheet-JCOM-container">
        {{#momentumicon}}
                <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/2d20.png" width="60" title="Momentum" class="center" style="padding-top: 6px; padding-left:3px">
        {{/momentumicon}}
        <div class="sheet-JCOM-roll-header">
            {{name}}
        </div>
        <div class="sheet-JCOM-type">
            {{attribute1}} + {{attribute2}}
        </div>
        <div class="sheet-JCOM-dice">
            <br>
            Cost<BR>
			<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Mometumgem.png" width="20" height="20" title="Momentum"> {{spentmomentum}}
			<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/skullandcross.png" width="30" height="30" title="Doom"> {{doomdice}}
			<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/John%20Carter%20of%20Mars/Images/Luckcoin.png" width="30" height="30" title="Fortune"> {{fortunedice}}
        </div>
        <div class="conan-JCOM-result">
            {{rolls}}<br>
        </div>
        {{#SUCCEED}}
        <div class="sheet-JCOM-success">
            SUCCESS<br>
        </div>
        {{/SUCCEED}}
        {{#FAIL}}
        <div class="sheet-JCOM-fail">
            FAILURE<br>
        </div>
        {{/FAIL}}

        <div class="JCOM-roll-result">
            Difficulty: {{diff}}<br>
            Dice: {{result}} + 
            Luck: {{fortune}}<BR>
            {{button}}
        </div>
    </div>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-conantalent">
    <div class="sheet-conan-talent-container">
        <div class="sheet-conan-talent-header">
			{{name}}<BR><BR>
        </div>
        <div class="sheet-conan-talent-name">
            {{talent}}
        </div>
        <div class="sheet-conan-talent-cost">
            Grade: {{grade}} 
        </div>
        <div class="sheet-conan-talent-desc">
            <b>Circumstance</b><BR> {{circumstance}}<br>
            <b>Effect</b><br> {{effect}}
        </div>
    </div>
</rolltemplate>




<rolltemplate class="sheet-rolltemplate-CDroll">
    <div class="sheet-CD-container">
	<BR><BR><BR>
        <div class="sheet-CD-roll-header">
        	{{name}}<BR>

        </div>
        <div class="sheet-CD-type">
            {{weaponname}}<br><BR>
            <b>DAMAGE</b><br>
            {{#bonus}}   
            Momentum: {{bonus}}<br>
            {{/bonus}}
        </div>
        <div class="sheet-CD-dice">
            {{effects}}
        </div>
        <div class="sheet-CD-roll-header">
			<br>
			{{result}}<BR>
        </div>
		<div class="sheet-CD-smalltext">
		            Hover for number of Effects<BR>
		</div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-momentumspend">
    <div class="sheet-momentum-container">
        <BR><BR><BR><BR>
        <div class="sheet-momentum-header">
            {{name}}
        </div>
        <div class="sheet-momentum-spent">
            {{#spend_name}}
            {{spend_name}}<BR>
            {{/spend_name}}    
        </div>
        <div class="sheet-momentum-amount">
             - {{spend_cost}} -
        </div>
        <div class="sheet-momentum-smalltext">
        </div>

    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-doompool">
    <div class="sheet-doompool-container">
        <div class="sheet-doompool-header">
             {{header}}
        </div>
        <div class="sheet-doompool-total">
            <BR>
            {{doom}}   
        </div>
    </div>
</rolltemplate>


<!-- Sheet Workers -->

<script type="text/worker">

const buttonlist = ["PC","Beast","GM","PCdetail"];
const harmupdate=["totalmadness","totalwounds","totaltrauma","attribute1","attribute2","difficulty","beastdiff","maxbeastmenace","beastmenace"];
const injuryharms =["wound1","wound2","wound3","wound4","wound5"];
const confusionharms =["madness1","madness2","madness3","madness4","madness5"];
const fearharms =["trauma1","trauma2","trauma3","trauma4","trauma5"];
const damagebonus =["brawn","coordination","personality"];
const attribbuttons = ["Cunning1","Cunning2","Daring1","Daring2","Empathy1","Empathy2","Passion1","Passion2","Reason1","Reason2","Might1","Might2"];
const npcexpertise =["Combat","Movement","Senses","Knowledge","Social","Fortitude"];
const attributes =["cunning","daring","empathy","might","passion","reason"];
const mentalskills=["Alchemy","Animal_Handling","Command","Counsel","Craft","Discipline","Healing","Linguistics","Lore","Observation","Persuade","Society","Sorcery","Warfare"];
const fortunebuttons=["addlucky20","subtractlucky20","recoverfortunevigor","recoverfortuneresolve","ignorewounds","ignoretrauma","secondaction"];

const stressrecover=["resetstress"];

buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
        setAttrs({
            sheetTab: button
        });
    });
});

attributes.forEach(maxup => {
    on(`change:${maxup}`, function() {
        getAttrs(attributes, function(values){
            var emp=parseInt(values.empathy)||0;
            var cun=parseInt(values.cunning)||0;
            var mig=parseInt(values.might)||0;
            var pas=parseInt(values.passion)||0;
            var dar=parseInt(values.daring)||0;
            var rea=parseInt(values.reason)||0;
            if (emp>rea){
                mxcon=emp;
            } else {
                mxcon=rea;
            }
            if (dar>pas){
                mxfear=dar;
            } else {
                mxfear=pas;
            }
            if (cun>mig){
                mxinj=cun;
            } else {
                mxinj=mig;
            }

            var poolmom=Math.min(emp,cun,mig,pas,dar,rea);
            setAttrs({
               maxconfusion:mxcon,
               maxfear:mxfear,
               maxinjury:mxinj,
               maxpool:poolmom
            });
        });
    });
});


attributes.forEach(button => {
    on(`clicked:${button}`, function(){
        getAttrs([button,"currentFC"], function(values){
            var attrib=parseInt(values[button])||0;
            var FC=parseInt(values.currentFC)||0;
            var TN=attrib+FC;
            setAttrs({
                currentattribute:attrib,
                currentattributename:button,
                currentTN:TN
            });
        });
    });
});

npcexpertise.forEach(button => {
    on(`clicked:${button}`, function(){
        getAttrs([button,"currentattribute"], function(values){
            var exp=parseInt(values[button])||0;
            var attrib=parseInt(values.currentattribute)||0;
            var TN=attrib+exp;
            setAttrs({
                currentFC:exp,
                currentTN:TN,
                currentskillname:button
            });
        });
    });
});

stressrecover.forEach(button =>{
    on(`clicked:${button}`, function(){
        switch(button){
            case "resetstress":
                getAttrs(["maxconfusion","maxfear","maxinjury"], function(values){
                    var maxc=parseInt(values.maxconfusion)||0;
                    var maxf=parseInt(values.maxfear)||0;
                    var maxi=parseInt(values.maxinjury)||0;
                    setAttrs({
                        confusion_current:maxc,
                        fear_current:maxf,
                        injury_current:maxi
                    });
                });
            break;
        }
    });
});


fortunebuttons.forEach(button =>{
	on(`clicked:${button}`, function(){
        switch(button){
            case "secondaction":
                getAttrs(["fortune"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    if (fort-1>=0){
                        fort=fort-1;
                        setAttrs({
                            fortune:fort
                        });
                    }
                });
            break;
            case "addlucky20":
                getAttrs(["fortune","d20momentum","d20fortune","d20doom","d20exception"], function(values){
                    var d20fort=parseInt(values.d20fortune)||0;
                    var d20mom=parseInt(values.d20momentum)||0;
                    var d20doom=parseInt(values.d20doom)||0;
                    var d20excp=parseInt(values.d20exception)||0;
                    var fort=parseInt(values.fortune)||0;

                    var totald20=d20fort+d20doom+d20mom+d20excp;

                    if (totald20+1<=3){
//                        fort=fort-1;
                        d20fort=d20fort+1;
                        setAttrs({
//                            fortune:fort,
                            d20fortune:d20fort
                        });
                    } 
                });
            break;
            case "subtractlucky20":
                getAttrs(["fortune","d20fortune"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    var d20fort=parseInt(values.d20fortune)||0;
                    if (d20fort-1>=0){
                        fort=fort+1;
                        d20fort=d20fort-1;
                        setAttrs({
                            Fortune:fort,
                            d20fortune:d20fort
                        });
                    }
                });
            break;
            case "ignorewounds":
                getAttrs(["fortune"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    var ig=1;
                    if (fort-1>=0){
                        fort=fort-1;
                        setAttrs({
                            ignorewounds:ig,
                            fortune:fort
                        });
                    }
                });
            break;
            case "ignoretrauma":
                getAttrs(["fortune"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    var ig=1;
                    if (fort-1>=0){
                        fort=fort-1;
                        setAttrs({
                            ignoretrauma:ig,
                            fortune:fort
                        });
                    }
                });
            break;
            case "recoverfortunevigor":
                getAttrs(["fortune","brawn","resistance_exp","totalfatigue"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    var brwn=parseInt(values.brawn)||0;
                    var rest=parseInt(values.resistance_exp)||0;
                    var tf=parseInt(values.totalfatigue)||0;
                    var maxv=brwn+rest-tf;
                    if (fort-1>=0){
                        fort=fort-1;
                        setAttrs({
                            fortune: fort,
                            vigor_current:maxv
                        });
                    }
                });
            break;
            case "recoverfortuneresolve":
                getAttrs(["fortune","willpower","discipline_exp","totaldespair"], function(values){
                    var fort=parseInt(values.fortune)||0;
                    var will=parseInt(values.willpower)||0;
                    var disc=parseInt(values.discipline_exp)||0;
                    var td=parseInt(values.totaldespair)||0;
                    var maxr=will+disc-td;
                    if (fort-1>=0){
                        fort=fort-1;
                        setAttrs({
                            fortune: fort,
                            resolve_current:maxr
                        });
                    }
                });
            break;
        }
    });
});


harmupdate.forEach(harmup => {
	on(`change:${harmup}`, function(){
		getAttrs(["totalmadness","totalwounds","totaltrauma","attribute1","attribute2","difficulty","sheetTab","maxbeastmenace","beastmenace"], function(values){
//			var ctype=values.currenttype;
			var tmadness=values.totalmadness;
            var twounds=values.totalwounds;
            var ttrauma=values.totaltrauma;
            var attr1=values.attribute1;
            var attr2=values.attribute2;
            var currentafflictions=0;
            var diff=values.difficulty;
            var mbeastm=values.maxbeastmenace;
            var beastm=values.beastmenace;
            var sTab=values.sheetTab;
            console.log(attr1);
            console.log(attr2);
            if (sTab=="Beast"){
                console.log("TASTE THE BEAST!");
                currentafflictions=mbeastm-beastm;
            } else {
                if (attr1=="Empathy" || attr2=="Empathy"){
                    currentafflictions=currentafflictions+tmadness;
                }
                if (attr1=="Daring" || attr2=="Daring"){
                    currentafflictions=currentafflictions+ttrauma;
                }
                if (attr1=="Cunning" || attr2=="Cunning"){
                    currentafflictions=currentafflictions+twounds;
                }
                if (attr1=="Reason" || attr2=="Reason"){
                    currentafflictions=currentafflictions+tmadness;
                }
                if (attr1=="Might" || attr2=="Might"){
                    currentafflictions=currentafflictions+twounds;
                }
                if (attr1=="Passion" || attr2=="Passion"){
                    currentafflictions=currentafflictions+ttrauma;
                }
            }
            console.log(diff+currentafflictions);
            var totaldiff=diff+currentafflictions;
            if (totaldiff>5){
                var diffadj=totaldiff-5;
                currentafflictions=currentafflictions-diffadj;
                if (currentafflictions<0){
                    currentafflictions=0;
                }
            }
			setAttrs({
				currentharm:currentafflictions
			});
		});
	});
});



injuryharms.forEach(harm => {
    on(`change:${harm}`, function() {
        getAttrs(injuryharms, function(values){
            var w1=parseInt(values.wound1)||0;
            var w2=parseInt(values.wound2)||0;
            var w3=parseInt(values.wound3)||0;
            var w4=parseInt(values.wound4)||0;
            var w5=parseInt(values.wound5)||0;
            var tw=w1+w2+w3+w4+w5;
            if (tw<=0){
                tw=0;
            }
            console.log ("Wound: "+tw);
            setAttrs({
                totalwounds:tw
            });
        });    
    });
});

confusionharms.forEach(mental_harm => {
    on(`change:${mental_harm}`, function() {
        getAttrs(confusionharms, function(values){
            var t1=parseInt(values.madness1)||0;
            var t2=parseInt(values.madness2)||0;
            var t3=parseInt(values.madness3)||0;
            var t4=parseInt(values.madness4)||0;
            var t5=parseInt(values.madness5)||0;
            var tt=t1+t2+t3+t4+t5;
            if (tt<=0){
                tt=0;
            }
            console.log ("Madness: "+tt);
            setAttrs({
                totalmadness:tt
            });
        });    
    });
});

fearharms.forEach(harm => {
    on(`change:${harm}`, function() {
        getAttrs(fearharms, function(values){
            var t1=parseInt(values.trauma1)||0;
            var t2=parseInt(values.trauma2)||0;
            var t3=parseInt(values.trauma3)||0;
            var t4=parseInt(values.trauma4)||0;
            var t5=parseInt(values.trauma5)||0;
            var tt=t1+t2+t3+t4+t5;
            if (tt<=0){
                tt=0;
            }
            console.log ("Trauma: "+tt);
            setAttrs({
                totaltrauma:tt
            });
        });    
    });
});



damagebonus.forEach(bonus => {
    on(`change:${bonus}`, function() {
        getAttrs([bonus], function(values){
            var bonval=parseInt(values[bonus])||0;
            var dambon=0;
            if (bonval>=16){
                dambon=5;
            } else if (bonval>=14) {
                dambon=4;
            } else if (bonval>=12) {
                dambon=3;
            } else if (bonval>=10) {
                dambon=2;
            } else if (bonval>=9) {
                dambon=1;
            } else {
                dambon=0;
            }
            switch (bonus){
                case "brawn":
                    setAttrs({melee_bonus:dambon});
                break;
                case "coordination":
                    setAttrs({ranged_bonus:dambon});
                break;
                case "personality":
                    setAttrs({threat_bonus:dambon});
                break;
            }
        });
    });
});

attribbuttons.forEach(button => {
    on(`clicked:${button}`, function(){
        var attribname=button.substring(0,button.length-1);
        var attribpos=button.substring(button.length-1,button.length);
        getAttrs([attribname,"FC","attribval1","attribval2"], function(values){
            var attribvalue=parseInt(values[attribname])||0;
            var a1=parseInt(values.attribval1)||0;
            var a2=parseInt(values.attribval2)||0;

            switch (attribpos){
                case "1":
                    var minatt=Math.min(attribvalue,a2);
                    setAttrs({
                        attribute1:attribname,
                        attribval1:attribvalue,
                        FC:minatt
                    });
                break;
                case"2":
                    var minatt=Math.min(a1,attribvalue)
                    setAttrs({
                        attribute2:attribname,
                        attribval2:attribvalue,
                        FC:minatt
                    });
                break;
            }    
		});
    });
});

on("clicked:nextround", function(){
    getAttrs(["currentround","momentum"], function(values){
        var rnd=parseInt(values.currentround)||0;
        var mom=parseInt(values.momentum)||0;
        rnd=rnd+1;
        mom=mom-1;
        if (mom<=0){
            mom=0;
        }
        setAttrs({
            currentround:rnd,
            momentum:mom
        });
    });
});

on("clicked:startcombat", function() {
    var rnd=1;
    setAttrs({
            currentround:rnd
    });
});

on("clicked:d0", function(){
    setAttrs({
        difficulty:0
    });
});
on("clicked:d1", function(){
    setAttrs({
        difficulty:1
    });
});
on("clicked:d2", function(){
    setAttrs({
        difficulty:2
    });
});
on("clicked:d3", function(){
    setAttrs({
        difficulty:3
    });
});
on("clicked:d4", function(){
    setAttrs({
        difficulty:4
    });
});
on("clicked:d5", function(){
    setAttrs({
        difficulty:5
    });
});

on("clicked:adddie_momentum",function () {
    getAttrs(["d20momentum","d20doom","d20fortune","momentum","bloodonsteel","spentmom","d20exception"],function(values){
        var dieM=parseInt(values.d20momentum)||0;
        var dieD=parseInt(values.d20doom)||0;
        var dieF=parseInt(values.d20fortune)||0;
        var dieE=parseInt(values.d20exception)||0;
        var mom=parseInt(values.momentum)||0;
		var bos=parseInt(values.bloodonsteel)||0;
		var spmom=parseInt(values.spentmom)||0;
				
        var totalDice=2+dieM+dieD+dieF+dieE;
		var diepermom=1;
		
		if (bos==1){
			diepermom=2;
        }
         
        if (totalDice+diepermom<=5){
//            if (mom-1>=0){
                dieM=dieM+diepermom;
				spmom=spmom+1;
//                mom=mom-1;
                setAttrs({
					spentmom: spmom,
                    d20momentum:dieM,
                    momentum:mom
                });
 //           }
        }        
    });
});

on("change:GMdifficulty", function() {  
    getAttrs(["GMdifficulty"],function(values){
        var dif=parseInt(values.GMdifficulty)||0;
        setAttrs({
            difficulty:dif
        });
    });
});

on("clicked:adddie_doom",function() {
    getAttrs(["d20momentum","d20doom","d20fortune","d20exception"],function(values){
        var dieM=parseInt(values.d20momentum)||0;
        var dieD=parseInt(values.d20doom)||0;
        var dieF=parseInt(values.d20fortune)||0;
        var dieE=parseInt(values.d20exception)||0;
        var totalDice=2+dieM+dieD+dieF+dieE;
        if (totalDice+1<=5){
            dieD=dieD+1;
            setAttrs({
                d20doom:dieD
            });
        }        
    });
});

on("clicked:add20",function() {
    getAttrs(["d20momentum","d20doom","d20fortune","d20exception"],function(values){
        var dieM=parseInt(values.d20momentum)||0;
        var dieD=parseInt(values.d20doom)||0;
        var dieF=parseInt(values.d20fortune)||0;
        var dieE=parseInt(values.d20exception)||0;
        var totalDice=2+dieM+dieD+dieF+dieE;
        if (totalDice+1<=5){
            dieE=dieE+1;
            setAttrs({
                d20exception:dieE
            });
        }        
    });
});


on("clicked:cleardice", function() {
    let zero=0;
    getAttrs(["d20momentum","momentum","d20fortune","fortune","spentmom","d20exception"], function(values) {
        var d20mom=parseInt(values.d20momentum)||0;
		var spmom=parseInt(values.spentmom)||0;
        var mom=parseInt(values.momentum)||0;
		var fort=parseInt(values.fortune)||0;
		var d20fort=parseInt(values.d20fortune)||0;
        var d20excep=parseInt(values.d20exception)||0;
		fort=fort+d20fort;
//        mom=mom+spmom;
        setAttrs({
			spentmom:zero,
            d20doom:zero,
            d20momentum:zero,
            d20fortune:zero,
//			fortune:fort,
            d20exception:zero,
//            momentum:mom
        });
    });
});

on("clicked:repeating_equipment:equip", function(eventInfo) {
    getAttrs(["repeating_equipment_equbonus","equipedbonus"], function(values){
        let newbonus=parseInt(values.repeating_equipment_equbonus)||0;
        let bonus=parseInt(values.equipedbonus)||0;
        setAttrs({
            "equipedbonus": newbonus+bonus
        });
    });
});

</script>
